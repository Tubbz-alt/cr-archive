<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.compiler/share/classes/com/sun/tools/javac/parser/DocCommentParser.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../model/JavacElements.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="JavaTokenizer.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.compiler/share/classes/com/sun/tools/javac/parser/DocCommentParser.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2012, 2017, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 171         loop:
 172         while (bp &lt; buflen) {
 173             switch (ch) {
 174                 case &#39;\n&#39;: case &#39;\r&#39;: case &#39;\f&#39;:
 175                     newline = true;
 176                     // fallthrough
 177 
 178                 case &#39; &#39;: case &#39;\t&#39;:
 179                     nextChar();
 180                     break;
 181 
 182                 case &#39;&amp;&#39;:
 183                     entity(trees);
 184                     break;
 185 
 186                 case &#39;&lt;&#39;:
 187                     newline = false;
 188                     if (isFileContent) {
 189                         switch (phase) {
 190                             case PREAMBLE:
<span class="line-modified"> 191                                 if (peek(&quot;body&quot;)) {</span>
 192                                     trees.add(html());
 193                                     if (textStart == -1) {
 194                                         textStart = bp;
 195                                         lastNonWhite = -1;
 196                                     }
 197                                     // mark this as the start, for processing purposes
 198                                     newline = true;
 199                                     break loop;
 200                                 }
 201                                 break;
 202                             case BODY:
<span class="line-modified"> 203                                 if (peek(&quot;/body&quot;)) {</span>
 204                                     addPendingText(trees, lastNonWhite);
 205                                     break loop;
 206                                 }
 207                                 break;
 208                             default:
 209                                 // fallthrough
 210                         }
 211                     }
 212                     addPendingText(trees, bp - 1);
 213                     trees.add(html());
 214 
 215                     if (phase == Phase.PREAMBLE || phase == Phase.POSTAMBLE) {
 216                         break; // Ignore newlines after html tags, in the meta content
 217                     }
 218                     if (textStart == -1) {
 219                         textStart = bp;
 220                         lastNonWhite = -1;
 221                     }
 222                     break;
 223 
</pre>
<hr />
<pre>
 770                     nextChar();
 771                     while (isHexDigit(ch))
 772                         nextChar();
 773                     name = names.fromChars(buf, namep, bp - namep);
 774                 }
 775             }
 776         } else if (isIdentifierStart(ch)) {
 777             name = readIdentifier();
 778         }
 779 
 780         if (name == null)
 781             return erroneous(&quot;dc.bad.entity&quot;, p);
 782         else {
 783             if (ch != &#39;;&#39;)
 784                 return erroneous(&quot;dc.missing.semicolon&quot;, p);
 785             nextChar();
 786             return m.at(p).newEntityTree(name);
 787         }
 788     }
 789 
























































































 790     boolean peek(String s) {
 791         final int savedpos = bp;
 792         try {
 793             if (ch == &#39;&lt;&#39;)
 794                 nextChar();
 795 
 796             if (ch == &#39;/&#39;) {
 797                 if (s.charAt(0) != ch) {
 798                     return false;
 799                 } else {
 800                     s = s.substring(1, s.length());
 801                     nextChar();
 802                 }
 803             }
 804 
 805             if (isIdentifierStart(ch)) {
 806                 Name name = readIdentifier();
 807                 return StringUtils.toLowerCase(name.toString()).equals(s);
 808             }
 809             return false;
</pre>
<hr />
<pre>
 825             List&lt;DCTree&gt; attrs = htmlAttrs();
 826             if (attrs != null) {
 827                 boolean selfClosing = false;
 828                 if (ch == &#39;/&#39;) {
 829                     nextChar();
 830                     selfClosing = true;
 831                 }
 832                 if (ch == &#39;&gt;&#39;) {
 833                     nextChar();
 834                     DCTree dctree = m.at(p).newStartElementTree(name, attrs, selfClosing).setEndPos(bp);
 835                     return dctree;
 836                 }
 837             }
 838         } else if (ch == &#39;/&#39;) {
 839             nextChar();
 840             if (isIdentifierStart(ch)) {
 841                 Name name = readIdentifier();
 842                 skipWhitespace();
 843                 if (ch == &#39;&gt;&#39;) {
 844                     nextChar();
<span class="line-modified"> 845                     return m.at(p).newEndElementTree(name);</span>
 846                 }
 847             }
 848         } else if (ch == &#39;!&#39;) {
 849             nextChar();
 850             if (ch == &#39;-&#39;) {
 851                 nextChar();
 852                 if (ch == &#39;-&#39;) {
 853                     nextChar();
 854                     while (bp &lt; buflen) {
 855                         int dash = 0;
 856                         while (ch == &#39;-&#39;) {
 857                             dash++;
 858                             nextChar();
 859                         }
 860                         // Strictly speaking, a comment should not contain &quot;--&quot;
 861                         // so dash &gt; 2 is an error, dash == 2 implies ch == &#39;&gt;&#39;
 862                         // See http://www.w3.org/TR/html-markup/syntax.html#syntax-comments
 863                         // for more details.
 864                         if (dash &gt;= 2 &amp;&amp; ch == &#39;&gt;&#39;) {
 865                             nextChar();
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2012, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 171         loop:
 172         while (bp &lt; buflen) {
 173             switch (ch) {
 174                 case &#39;\n&#39;: case &#39;\r&#39;: case &#39;\f&#39;:
 175                     newline = true;
 176                     // fallthrough
 177 
 178                 case &#39; &#39;: case &#39;\t&#39;:
 179                     nextChar();
 180                     break;
 181 
 182                 case &#39;&amp;&#39;:
 183                     entity(trees);
 184                     break;
 185 
 186                 case &#39;&lt;&#39;:
 187                     newline = false;
 188                     if (isFileContent) {
 189                         switch (phase) {
 190                             case PREAMBLE:
<span class="line-modified"> 191                                 if (isEndPreamble()) {</span>
 192                                     trees.add(html());
 193                                     if (textStart == -1) {
 194                                         textStart = bp;
 195                                         lastNonWhite = -1;
 196                                     }
 197                                     // mark this as the start, for processing purposes
 198                                     newline = true;
 199                                     break loop;
 200                                 }
 201                                 break;
 202                             case BODY:
<span class="line-modified"> 203                                 if (isEndBody()) {</span>
 204                                     addPendingText(trees, lastNonWhite);
 205                                     break loop;
 206                                 }
 207                                 break;
 208                             default:
 209                                 // fallthrough
 210                         }
 211                     }
 212                     addPendingText(trees, bp - 1);
 213                     trees.add(html());
 214 
 215                     if (phase == Phase.PREAMBLE || phase == Phase.POSTAMBLE) {
 216                         break; // Ignore newlines after html tags, in the meta content
 217                     }
 218                     if (textStart == -1) {
 219                         textStart = bp;
 220                         lastNonWhite = -1;
 221                     }
 222                     break;
 223 
</pre>
<hr />
<pre>
 770                     nextChar();
 771                     while (isHexDigit(ch))
 772                         nextChar();
 773                     name = names.fromChars(buf, namep, bp - namep);
 774                 }
 775             }
 776         } else if (isIdentifierStart(ch)) {
 777             name = readIdentifier();
 778         }
 779 
 780         if (name == null)
 781             return erroneous(&quot;dc.bad.entity&quot;, p);
 782         else {
 783             if (ch != &#39;;&#39;)
 784                 return erroneous(&quot;dc.missing.semicolon&quot;, p);
 785             nextChar();
 786             return m.at(p).newEntityTree(name);
 787         }
 788     }
 789 
<span class="line-added"> 790     /**</span>
<span class="line-added"> 791      * Returns whether this is the end of the preamble of an HTML file.</span>
<span class="line-added"> 792      * The preamble ends with start of {@code body} element followed by</span>
<span class="line-added"> 793      * possible whitespace and the start of a {@code main} element.</span>
<span class="line-added"> 794      *</span>
<span class="line-added"> 795      * @return whether this is the end of the preamble</span>
<span class="line-added"> 796      */</span>
<span class="line-added"> 797     boolean isEndPreamble() {</span>
<span class="line-added"> 798         final int savedpos = bp;</span>
<span class="line-added"> 799         try {</span>
<span class="line-added"> 800             if (ch == &#39;&lt;&#39;)</span>
<span class="line-added"> 801                 nextChar();</span>
<span class="line-added"> 802 </span>
<span class="line-added"> 803             if (isIdentifierStart(ch)) {</span>
<span class="line-added"> 804                 String name = StringUtils.toLowerCase(readIdentifier().toString());</span>
<span class="line-added"> 805                 switch (name) {</span>
<span class="line-added"> 806                     case &quot;body&quot;:</span>
<span class="line-added"> 807                         // Check if also followed by &lt;main&gt;</span>
<span class="line-added"> 808                         // 1. skip rest of &lt;body&gt;</span>
<span class="line-added"> 809                         while (ch != -1 &amp;&amp; ch != &#39;&gt;&#39;) {</span>
<span class="line-added"> 810                             nextChar();</span>
<span class="line-added"> 811                         }</span>
<span class="line-added"> 812                         if (ch == &#39;&gt;&#39;) {</span>
<span class="line-added"> 813                             nextChar();</span>
<span class="line-added"> 814                         }</span>
<span class="line-added"> 815                         // 2. skip any whitespce</span>
<span class="line-added"> 816                         while (ch != -1 &amp;&amp; Character.isWhitespace(ch)) {</span>
<span class="line-added"> 817                             nextChar();</span>
<span class="line-added"> 818                         }</span>
<span class="line-added"> 819                         // 3. check if looking at &quot;&lt;main...&quot;</span>
<span class="line-added"> 820                         if (ch == &#39;&lt;&#39;) {</span>
<span class="line-added"> 821                             nextChar();</span>
<span class="line-added"> 822                             if (isIdentifierStart(ch)) {</span>
<span class="line-added"> 823                                 name = StringUtils.toLowerCase(readIdentifier().toString());</span>
<span class="line-added"> 824                                 if (name.equals(&quot;main&quot;)) {</span>
<span class="line-added"> 825                                     return false;</span>
<span class="line-added"> 826                                 }</span>
<span class="line-added"> 827                             }</span>
<span class="line-added"> 828                         }</span>
<span class="line-added"> 829                         // if &lt;body&gt; is _not_ followed by &lt;main&gt; then this is the</span>
<span class="line-added"> 830                         // end of the preamble</span>
<span class="line-added"> 831                         return true;</span>
<span class="line-added"> 832 </span>
<span class="line-added"> 833                     case &quot;main&quot;:</span>
<span class="line-added"> 834                         // &lt;main&gt; is unconditionally the end of the preamble</span>
<span class="line-added"> 835                         return true;</span>
<span class="line-added"> 836                 }</span>
<span class="line-added"> 837             }</span>
<span class="line-added"> 838             return false;</span>
<span class="line-added"> 839         } finally {</span>
<span class="line-added"> 840             bp = savedpos;</span>
<span class="line-added"> 841             ch = buf[bp];</span>
<span class="line-added"> 842         }</span>
<span class="line-added"> 843     }</span>
<span class="line-added"> 844 </span>
<span class="line-added"> 845     /**</span>
<span class="line-added"> 846      * Returns whether this is the end of the main body of the content in a standalone</span>
<span class="line-added"> 847      * HTML file.</span>
<span class="line-added"> 848      * The content ends with the closing tag for a {@code main} or {@code body} element.</span>
<span class="line-added"> 849      *</span>
<span class="line-added"> 850      * @return whether this is the end of the main body of the content</span>
<span class="line-added"> 851      */</span>
<span class="line-added"> 852     boolean isEndBody() {</span>
<span class="line-added"> 853         final int savedpos = bp;</span>
<span class="line-added"> 854         try {</span>
<span class="line-added"> 855             if (ch == &#39;&lt;&#39;)</span>
<span class="line-added"> 856                 nextChar();</span>
<span class="line-added"> 857 </span>
<span class="line-added"> 858             if (ch == &#39;/&#39;) {</span>
<span class="line-added"> 859                 nextChar();</span>
<span class="line-added"> 860                 if (isIdentifierStart(ch)) {</span>
<span class="line-added"> 861                     String name = StringUtils.toLowerCase(readIdentifier().toString());</span>
<span class="line-added"> 862                     switch (name) {</span>
<span class="line-added"> 863                         case &quot;body&quot;:</span>
<span class="line-added"> 864                         case &quot;main&quot;:</span>
<span class="line-added"> 865                             return true;</span>
<span class="line-added"> 866                     }</span>
<span class="line-added"> 867                 }</span>
<span class="line-added"> 868             }</span>
<span class="line-added"> 869 </span>
<span class="line-added"> 870             return false;</span>
<span class="line-added"> 871         } finally {</span>
<span class="line-added"> 872             bp = savedpos;</span>
<span class="line-added"> 873             ch = buf[bp];</span>
<span class="line-added"> 874         }</span>
<span class="line-added"> 875 </span>
<span class="line-added"> 876     }</span>
<span class="line-added"> 877 </span>
 878     boolean peek(String s) {
 879         final int savedpos = bp;
 880         try {
 881             if (ch == &#39;&lt;&#39;)
 882                 nextChar();
 883 
 884             if (ch == &#39;/&#39;) {
 885                 if (s.charAt(0) != ch) {
 886                     return false;
 887                 } else {
 888                     s = s.substring(1, s.length());
 889                     nextChar();
 890                 }
 891             }
 892 
 893             if (isIdentifierStart(ch)) {
 894                 Name name = readIdentifier();
 895                 return StringUtils.toLowerCase(name.toString()).equals(s);
 896             }
 897             return false;
</pre>
<hr />
<pre>
 913             List&lt;DCTree&gt; attrs = htmlAttrs();
 914             if (attrs != null) {
 915                 boolean selfClosing = false;
 916                 if (ch == &#39;/&#39;) {
 917                     nextChar();
 918                     selfClosing = true;
 919                 }
 920                 if (ch == &#39;&gt;&#39;) {
 921                     nextChar();
 922                     DCTree dctree = m.at(p).newStartElementTree(name, attrs, selfClosing).setEndPos(bp);
 923                     return dctree;
 924                 }
 925             }
 926         } else if (ch == &#39;/&#39;) {
 927             nextChar();
 928             if (isIdentifierStart(ch)) {
 929                 Name name = readIdentifier();
 930                 skipWhitespace();
 931                 if (ch == &#39;&gt;&#39;) {
 932                     nextChar();
<span class="line-modified"> 933                     return m.at(p).newEndElementTree(name).setEndPos(bp);</span>
 934                 }
 935             }
 936         } else if (ch == &#39;!&#39;) {
 937             nextChar();
 938             if (ch == &#39;-&#39;) {
 939                 nextChar();
 940                 if (ch == &#39;-&#39;) {
 941                     nextChar();
 942                     while (bp &lt; buflen) {
 943                         int dash = 0;
 944                         while (ch == &#39;-&#39;) {
 945                             dash++;
 946                             nextChar();
 947                         }
 948                         // Strictly speaking, a comment should not contain &quot;--&quot;
 949                         // so dash &gt; 2 is an error, dash == 2 implies ch == &#39;&gt;&#39;
 950                         // See http://www.w3.org/TR/html-markup/syntax.html#syntax-comments
 951                         // for more details.
 952                         if (dash &gt;= 2 &amp;&amp; ch == &#39;&gt;&#39;) {
 953                             nextChar();
</pre>
</td>
</tr>
</table>
<center><a href="../model/JavacElements.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="JavaTokenizer.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>