<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.compiler/share/classes/com/sun/tools/javac/main/Main.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JavaCompiler.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="Option.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.compiler/share/classes/com/sun/tools/javac/main/Main.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
267         // handle this here so it works even if no other options given
268         String showClass = options.get(&quot;showClass&quot;);
269         if (showClass != null) {
270             if (showClass.equals(&quot;showClass&quot;)) // no value given for option
271                 showClass = &quot;com.sun.tools.javac.Main&quot;;
272             showClass(showClass);
273         }
274 
275         ok &amp;= args.validate();
276         if (!ok || log.nerrors &gt; 0)
277             return Result.CMDERR;
278 
279         if (args.isEmpty())
280             return Result.OK;
281 
282         // init Dependencies
283         if (options.isSet(&quot;debug.completionDeps&quot;)) {
284             Dependencies.GraphDependencies.preRegister(context);
285         }
286 


287         // init plugins
288         Set&lt;List&lt;String&gt;&gt; pluginOpts = args.getPluginOpts();
<span class="line-modified">289         if (!pluginOpts.isEmpty() || context.get(PlatformDescription.class) != null) {</span>
<span class="line-removed">290             BasicJavacTask t = (BasicJavacTask) BasicJavacTask.instance(context);</span>
<span class="line-removed">291             t.initPlugins(pluginOpts);</span>
<span class="line-removed">292         }</span>
293 
294         // init multi-release jar handling
295         if (fileManager.isSupportedOption(Option.MULTIRELEASE.primaryName) == 1) {
296             Target target = Target.instance(context);
297             List&lt;String&gt; list = List.of(target.multiReleaseValue());
298             fileManager.handleOption(Option.MULTIRELEASE.primaryName, list.iterator());
299         }
300 
301         // init JavaCompiler
302         JavaCompiler comp = JavaCompiler.instance(context);
303 
304         // init doclint
305         List&lt;String&gt; docLintOpts = args.getDocLintOpts();
306         if (!docLintOpts.isEmpty()) {
<span class="line-removed">307             BasicJavacTask t = (BasicJavacTask) BasicJavacTask.instance(context);</span>
308             t.initDocLint(docLintOpts);
309         }
310 
311         if (options.get(Option.XSTDOUT) != null) {
312             // Stdout reassigned - ask compiler to close it when it is done
313             comp.closeables = comp.closeables.prepend(log.getWriter(WriterKind.NOTICE));
314         }
315 
316         boolean printArgsToFile = options.isSet(&quot;printArgsToFile&quot;);
317         try {
318             comp.compile(args.getFileObjects(), args.getClassNames(), null, List.nil());
319 
320             if (log.expectDiagKeys != null) {
321                 if (log.expectDiagKeys.isEmpty()) {
322                     log.printRawLines(&quot;all expected diagnostics found&quot;);
323                     return Result.OK;
324                 } else {
325                     log.printRawLines(&quot;expected diagnostic keys not found: &quot; + log.expectDiagKeys);
326                     return Result.ERROR;
327                 }
</pre>
<hr />
<pre>
460 
461     /** Print a message reporting an uncaught exception from an
462      * annotation processor.
463      */
464     void pluginMessage(Throwable ex) {
465         log.printLines(PrefixKind.JAVAC, &quot;msg.plugin.uncaught.exception&quot;);
466         ex.printStackTrace(log.getWriter(WriterKind.NOTICE));
467     }
468 
469     /** Display the location and checksum of a class. */
470     void showClass(String className) {
471         PrintWriter pw = log.getWriter(WriterKind.NOTICE);
472         pw.println(&quot;javac: show class: &quot; + className);
473 
474         URL url = getClass().getResource(&#39;/&#39; + className.replace(&#39;.&#39;, &#39;/&#39;) + &quot;.class&quot;);
475         if (url != null) {
476             pw.println(&quot;  &quot; + url);
477         }
478 
479         try (InputStream in = getClass().getResourceAsStream(&#39;/&#39; + className.replace(&#39;.&#39;, &#39;/&#39;) + &quot;.class&quot;)) {
<span class="line-modified">480             final String algorithm = &quot;MD5&quot;;</span>
481             byte[] digest;
482             MessageDigest md = MessageDigest.getInstance(algorithm);
483             try (DigestInputStream din = new DigestInputStream(in, md)) {
484                 byte[] buf = new byte[8192];
485                 int n;
486                 do { n = din.read(buf); } while (n &gt; 0);
487                 digest = md.digest();
488             }
489             StringBuilder sb = new StringBuilder();
490             for (byte b: digest)
491                 sb.append(String.format(&quot;%02x&quot;, b));
492             pw.println(&quot;  &quot; + algorithm + &quot; checksum: &quot; + sb);
493         } catch (NoSuchAlgorithmException | IOException e) {
494             pw.println(&quot;  cannot compute digest: &quot; + e);
495         }
496     }
497 
498     // TODO: update this to JavacFileManager
499     private JavaFileManager fileManager;
500 
</pre>
</td>
<td>
<hr />
<pre>
267         // handle this here so it works even if no other options given
268         String showClass = options.get(&quot;showClass&quot;);
269         if (showClass != null) {
270             if (showClass.equals(&quot;showClass&quot;)) // no value given for option
271                 showClass = &quot;com.sun.tools.javac.Main&quot;;
272             showClass(showClass);
273         }
274 
275         ok &amp;= args.validate();
276         if (!ok || log.nerrors &gt; 0)
277             return Result.CMDERR;
278 
279         if (args.isEmpty())
280             return Result.OK;
281 
282         // init Dependencies
283         if (options.isSet(&quot;debug.completionDeps&quot;)) {
284             Dependencies.GraphDependencies.preRegister(context);
285         }
286 
<span class="line-added">287         BasicJavacTask t = (BasicJavacTask) BasicJavacTask.instance(context);</span>
<span class="line-added">288 </span>
289         // init plugins
290         Set&lt;List&lt;String&gt;&gt; pluginOpts = args.getPluginOpts();
<span class="line-modified">291         t.initPlugins(pluginOpts);</span>



292 
293         // init multi-release jar handling
294         if (fileManager.isSupportedOption(Option.MULTIRELEASE.primaryName) == 1) {
295             Target target = Target.instance(context);
296             List&lt;String&gt; list = List.of(target.multiReleaseValue());
297             fileManager.handleOption(Option.MULTIRELEASE.primaryName, list.iterator());
298         }
299 
300         // init JavaCompiler
301         JavaCompiler comp = JavaCompiler.instance(context);
302 
303         // init doclint
304         List&lt;String&gt; docLintOpts = args.getDocLintOpts();
305         if (!docLintOpts.isEmpty()) {

306             t.initDocLint(docLintOpts);
307         }
308 
309         if (options.get(Option.XSTDOUT) != null) {
310             // Stdout reassigned - ask compiler to close it when it is done
311             comp.closeables = comp.closeables.prepend(log.getWriter(WriterKind.NOTICE));
312         }
313 
314         boolean printArgsToFile = options.isSet(&quot;printArgsToFile&quot;);
315         try {
316             comp.compile(args.getFileObjects(), args.getClassNames(), null, List.nil());
317 
318             if (log.expectDiagKeys != null) {
319                 if (log.expectDiagKeys.isEmpty()) {
320                     log.printRawLines(&quot;all expected diagnostics found&quot;);
321                     return Result.OK;
322                 } else {
323                     log.printRawLines(&quot;expected diagnostic keys not found: &quot; + log.expectDiagKeys);
324                     return Result.ERROR;
325                 }
</pre>
<hr />
<pre>
458 
459     /** Print a message reporting an uncaught exception from an
460      * annotation processor.
461      */
462     void pluginMessage(Throwable ex) {
463         log.printLines(PrefixKind.JAVAC, &quot;msg.plugin.uncaught.exception&quot;);
464         ex.printStackTrace(log.getWriter(WriterKind.NOTICE));
465     }
466 
467     /** Display the location and checksum of a class. */
468     void showClass(String className) {
469         PrintWriter pw = log.getWriter(WriterKind.NOTICE);
470         pw.println(&quot;javac: show class: &quot; + className);
471 
472         URL url = getClass().getResource(&#39;/&#39; + className.replace(&#39;.&#39;, &#39;/&#39;) + &quot;.class&quot;);
473         if (url != null) {
474             pw.println(&quot;  &quot; + url);
475         }
476 
477         try (InputStream in = getClass().getResourceAsStream(&#39;/&#39; + className.replace(&#39;.&#39;, &#39;/&#39;) + &quot;.class&quot;)) {
<span class="line-modified">478             final String algorithm = &quot;SHA-256&quot;;</span>
479             byte[] digest;
480             MessageDigest md = MessageDigest.getInstance(algorithm);
481             try (DigestInputStream din = new DigestInputStream(in, md)) {
482                 byte[] buf = new byte[8192];
483                 int n;
484                 do { n = din.read(buf); } while (n &gt; 0);
485                 digest = md.digest();
486             }
487             StringBuilder sb = new StringBuilder();
488             for (byte b: digest)
489                 sb.append(String.format(&quot;%02x&quot;, b));
490             pw.println(&quot;  &quot; + algorithm + &quot; checksum: &quot; + sb);
491         } catch (NoSuchAlgorithmException | IOException e) {
492             pw.println(&quot;  cannot compute digest: &quot; + e);
493         }
494     }
495 
496     // TODO: update this to JavacFileManager
497     private JavaFileManager fileManager;
498 
</pre>
</td>
</tr>
</table>
<center><a href="JavaCompiler.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="Option.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>