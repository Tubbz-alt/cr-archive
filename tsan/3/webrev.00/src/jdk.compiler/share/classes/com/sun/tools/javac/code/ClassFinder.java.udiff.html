<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.compiler/share/classes/com/sun/tools/javac/code/ClassFinder.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Attribute.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="DeferredCompletionFailureHandler.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.compiler/share/classes/com/sun/tools/javac/code/ClassFinder.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -31,10 +31,11 @@</span>
  import java.util.HashMap;
  import java.util.Iterator;
  import java.util.Map;
  import java.util.NoSuchElementException;
  import java.util.Set;
<span class="udiff-line-added">+ import java.util.function.Supplier;</span>
  
  import javax.lang.model.SourceVersion;
  import javax.tools.JavaFileManager;
  import javax.tools.JavaFileManager.Location;
  import javax.tools.JavaFileObject;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -220,11 +221,11 @@</span>
              useCtProps = false;
          }
          jrtIndex = useCtProps &amp;&amp; JRTIndex.isAvailable() ? JRTIndex.getSharedInstance() : null;
  
          profile = Profile.instance(context);
<span class="udiff-line-modified-removed">-         cachedCompletionFailure = new CompletionFailure(null, (JCDiagnostic) null, dcfh);</span>
<span class="udiff-line-modified-added">+         cachedCompletionFailure = new CompletionFailure(null, () -&gt; null, dcfh);</span>
          cachedCompletionFailure.setStackTrace(new StackTraceElement[0]);
      }
  
  
  /************************************************************************
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -296,13 +297,16 @@</span>
          } else if (sym.kind == PCK) {
              PackageSymbol p = (PackageSymbol)sym;
              try {
                  fillIn(p);
              } catch (IOException ex) {
<span class="udiff-line-modified-removed">-                 JCDiagnostic msg =</span>
<span class="udiff-line-modified-removed">-                         diagFactory.fragment(Fragments.ExceptionMessage(ex.getLocalizedMessage()));</span>
<span class="udiff-line-modified-removed">-                 throw new CompletionFailure(sym, msg, dcfh).initCause(ex);</span>
<span class="udiff-line-modified-added">+                 throw new CompletionFailure(</span>
<span class="udiff-line-modified-added">+                         sym,</span>
<span class="udiff-line-modified-added">+                         () -&gt; diagFactory.fragment(</span>
<span class="udiff-line-added">+                             Fragments.ExceptionMessage(ex.getLocalizedMessage())),</span>
<span class="udiff-line-added">+                         dcfh)</span>
<span class="udiff-line-added">+                     .initCause(ex);</span>
              }
          }
          if (!reader.filling)
              annotate.flush(); // finish attaching annotations
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -335,13 +339,12 @@</span>
      /** Fill in definition of class `c&#39; from corresponding class or
       *  source file.
       */
      void fillIn(ClassSymbol c) {
          if (completionFailureName == c.fullname) {
<span class="udiff-line-modified-removed">-             JCDiagnostic msg =</span>
<span class="udiff-line-modified-removed">-                     diagFactory.fragment(Fragments.UserSelectedCompletionFailure);</span>
<span class="udiff-line-removed">-             throw new CompletionFailure(c, msg, dcfh);</span>
<span class="udiff-line-modified-added">+             throw new CompletionFailure(</span>
<span class="udiff-line-modified-added">+                 c, () -&gt; diagFactory.fragment(Fragments.UserSelectedCompletionFailure), dcfh);</span>
          }
          currentOwner = c;
          JavaFileObject classfile = c.classfile;
          if (classfile != null) {
              JavaFileObject previousClassFile = currentClassFile;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -388,29 +391,28 @@</span>
              throw classFileNotFound(c);
          }
      }
      // where
          private CompletionFailure classFileNotFound(ClassSymbol c) {
<span class="udiff-line-modified-removed">-             JCDiagnostic diag =</span>
<span class="udiff-line-modified-removed">-                 diagFactory.fragment(Fragments.ClassFileNotFound(c.flatname));</span>
<span class="udiff-line-removed">-             return newCompletionFailure(c, diag);</span>
<span class="udiff-line-modified-added">+             return newCompletionFailure(</span>
<span class="udiff-line-modified-added">+                 c, () -&gt; diagFactory.fragment(Fragments.ClassFileNotFound(c.flatname)));</span>
          }
          /** Static factory for CompletionFailure objects.
           *  In practice, only one can be used at a time, so we share one
           *  to reduce the expense of allocating new exception objects.
           */
          private CompletionFailure newCompletionFailure(TypeSymbol c,
<span class="udiff-line-modified-removed">-                                                        JCDiagnostic diag) {</span>
<span class="udiff-line-modified-added">+                                                        Supplier&lt;JCDiagnostic&gt; diag) {</span>
              if (!cacheCompletionFailure) {
                  // log.warning(&quot;proc.messager&quot;,
                  //             Log.getLocalizedString(&quot;class.file.not.found&quot;, c.flatname));
                  // c.debug.printStackTrace();
                  return new CompletionFailure(c, diag, dcfh);
              } else {
                  CompletionFailure result = cachedCompletionFailure;
                  result.sym = c;
<span class="udiff-line-modified-removed">-                 result.diag = diag;</span>
<span class="udiff-line-modified-added">+                 result.resetDiagnostic(diag);</span>
                  return result;
              }
          }
          private final CompletionFailure cachedCompletionFailure;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -780,11 +782,11 @@</span>
      public static class BadClassFile extends CompletionFailure {
          private static final long serialVersionUID = 0;
  
          public BadClassFile(TypeSymbol sym, JavaFileObject file, JCDiagnostic diag,
                  JCDiagnostic.Factory diagFactory, DeferredCompletionFailureHandler dcfh) {
<span class="udiff-line-modified-removed">-             super(sym, createBadClassFileDiagnostic(file, diag, diagFactory), dcfh);</span>
<span class="udiff-line-modified-added">+             super(sym, () -&gt; createBadClassFileDiagnostic(file, diag, diagFactory), dcfh);</span>
          }
          // where
          private static JCDiagnostic createBadClassFileDiagnostic(
                  JavaFileObject file, JCDiagnostic diag, JCDiagnostic.Factory diagFactory) {
              String key = (file.getKind() == JavaFileObject.Kind.SOURCE
</pre>
<center><a href="Attribute.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="DeferredCompletionFailureHandler.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>