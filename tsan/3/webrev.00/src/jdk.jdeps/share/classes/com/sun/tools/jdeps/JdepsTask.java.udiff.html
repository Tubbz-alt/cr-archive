<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.jdeps/share/classes/com/sun/tools/jdeps/JdepsTask.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ClassFileReader.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ModuleAnalyzer.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jdeps/share/classes/com/sun/tools/jdeps/JdepsTask.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2012, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2012, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -913,23 +913,28 @@</span>
              if (options.hasFilter()) {
                  reportError(&quot;err.invalid.options&quot;, &quot;--package, --regex, --require&quot;,
                              option);
                  return false;
              }
<span class="udiff-line-added">+             if (!options.rootModules.isEmpty()) {</span>
<span class="udiff-line-added">+                 reportError(&quot;err.invalid.options&quot;, &quot;-m or --module&quot;,</span>
<span class="udiff-line-added">+                             option);</span>
<span class="udiff-line-added">+                 return false;</span>
<span class="udiff-line-added">+             }</span>
              return true;
          }
  
          @Override
          boolean run(JdepsConfiguration config) throws IOException {
              // check if any JAR file contains unnamed package
              for (String arg : inputArgs) {
<span class="udiff-line-modified-removed">-                 try (ClassFileReader reader = ClassFileReader.newInstance(Paths.get(arg))) {</span>
<span class="udiff-line-modified-added">+                 try (ClassFileReader reader = ClassFileReader.newInstance(Paths.get(arg), config.getVersion())) {</span>
                      Optional&lt;String&gt; classInUnnamedPackage =
                          reader.entries().stream()
<span class="udiff-line-modified-removed">-                              .filter(n -&gt; n.endsWith(&quot;.class&quot;))</span>
<span class="udiff-line-modified-removed">-                              .filter(cn -&gt; toPackageName(cn).isEmpty())</span>
<span class="udiff-line-modified-removed">-                              .findFirst();</span>
<span class="udiff-line-modified-added">+                               .filter(n -&gt; n.endsWith(&quot;.class&quot;))</span>
<span class="udiff-line-modified-added">+                               .filter(cn -&gt; toPackageName(cn).isEmpty())</span>
<span class="udiff-line-modified-added">+                               .findFirst();</span>
  
                      if (classInUnnamedPackage.isPresent()) {
                          if (classInUnnamedPackage.get().equals(&quot;module-info.class&quot;)) {
                              reportError(&quot;err.genmoduleinfo.not.jarfile&quot;, arg);
                          } else {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -940,14 +945,14 @@</span>
                  }
              }
  
              ModuleInfoBuilder builder
                   = new ModuleInfoBuilder(config, inputArgs, dir, openModule);
<span class="udiff-line-modified-removed">-             boolean ok = builder.run();</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-removed">-             if (!ok &amp;&amp; !options.nowarning) {</span>
<span class="udiff-line-modified-added">+             boolean ok = builder.run(options.ignoreMissingDeps, log, options.nowarning);</span>
<span class="udiff-line-modified-added">+             if (!ok) {</span>
                  reportError(&quot;err.missing.dependences&quot;);
<span class="udiff-line-added">+                 log.println();</span>
                  builder.visitMissingDeps(new SimpleDepVisitor());
              }
              return ok;
          }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -979,11 +984,11 @@</span>
                  String list = config.initialArchives().stream()
                                      .map(Archive::getPathName).collect(joining(&quot; &quot;));
                  throw new UncheckedBadArgs(new BadArgs(&quot;err.invalid.options&quot;,
                                                         list, &quot;--check&quot;));
              }
<span class="udiff-line-modified-removed">-             return new ModuleAnalyzer(config, log, modules).run();</span>
<span class="udiff-line-modified-added">+             return new ModuleAnalyzer(config, log, modules).run(options.ignoreMissingDeps);</span>
          }
  
          /*
           * Returns true to analyze all modules
           */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1039,11 +1044,11 @@</span>
                                                                         reduced,
                                                                         log,
                                                                         separator);
              boolean ok = analyzer.run(options.depth(), options.ignoreMissingDeps);
              if (!ok) {
<span class="udiff-line-modified-removed">-                 reportError(&quot;err.cant.list.module.deps&quot;);</span>
<span class="udiff-line-modified-added">+                 reportError(&quot;err.missing.dependences&quot;);</span>
                  log.println();
                  analyzer.visitMissingDeps(new SimpleDepVisitor());
              }
              return ok;
          }
</pre>
<center><a href="ClassFileReader.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ModuleAnalyzer.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>