<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.jdeps/share/classes/com/sun/tools/javap/AttributeWriter.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../classfile/ClassWriter.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ClassWriter.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jdeps/share/classes/com/sun/tools/javap/AttributeWriter.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2007, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2007, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -23,10 +23,12 @@</span>
   * questions.
   */
  
  package com.sun.tools.javap;
  
<span class="udiff-line-added">+ import java.util.Collection;</span>
<span class="udiff-line-added">+ </span>
  import com.sun.tools.classfile.AccessFlags;
  import com.sun.tools.classfile.AnnotationDefault_attribute;
  import com.sun.tools.classfile.Attribute;
  import com.sun.tools.classfile.Attributes;
  import com.sun.tools.classfile.BootstrapMethods_attribute;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -38,10 +40,12 @@</span>
  import com.sun.tools.classfile.ConstantPool.CONSTANT_Class_info;
  import com.sun.tools.classfile.ConstantPoolException;
  import com.sun.tools.classfile.ConstantValue_attribute;
  import com.sun.tools.classfile.DefaultAttribute;
  import com.sun.tools.classfile.Deprecated_attribute;
<span class="udiff-line-added">+ import com.sun.tools.classfile.Descriptor;</span>
<span class="udiff-line-added">+ import com.sun.tools.classfile.Descriptor.InvalidDescriptor;</span>
  import com.sun.tools.classfile.EnclosingMethod_attribute;
  import com.sun.tools.classfile.Exceptions_attribute;
  import com.sun.tools.classfile.InnerClasses_attribute;
  import com.sun.tools.classfile.InnerClasses_attribute.Info;
  import com.sun.tools.classfile.LineNumberTable_attribute;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -54,30 +58,37 @@</span>
  import com.sun.tools.classfile.ModulePackages_attribute;
  import com.sun.tools.classfile.ModuleResolution_attribute;
  import com.sun.tools.classfile.ModuleTarget_attribute;
  import com.sun.tools.classfile.NestHost_attribute;
  import com.sun.tools.classfile.NestMembers_attribute;
<span class="udiff-line-added">+ import com.sun.tools.classfile.Record_attribute;</span>
  import com.sun.tools.classfile.RuntimeInvisibleAnnotations_attribute;
  import com.sun.tools.classfile.RuntimeInvisibleParameterAnnotations_attribute;
  import com.sun.tools.classfile.RuntimeInvisibleTypeAnnotations_attribute;
  import com.sun.tools.classfile.RuntimeParameterAnnotations_attribute;
  import com.sun.tools.classfile.RuntimeVisibleAnnotations_attribute;
  import com.sun.tools.classfile.RuntimeVisibleParameterAnnotations_attribute;
  import com.sun.tools.classfile.RuntimeVisibleTypeAnnotations_attribute;
<span class="udiff-line-added">+ import com.sun.tools.classfile.Signature;</span>
  import com.sun.tools.classfile.Signature_attribute;
  import com.sun.tools.classfile.SourceDebugExtension_attribute;
  import com.sun.tools.classfile.SourceFile_attribute;
  import com.sun.tools.classfile.SourceID_attribute;
  import com.sun.tools.classfile.StackMapTable_attribute;
  import com.sun.tools.classfile.StackMap_attribute;
  import com.sun.tools.classfile.Synthetic_attribute;
<span class="udiff-line-added">+ import com.sun.tools.classfile.Type;</span>
  
  import static com.sun.tools.classfile.AccessFlags.*;
  
  import com.sun.tools.javac.util.Assert;
  import com.sun.tools.javac.util.StringUtils;
  
<span class="udiff-line-added">+ import java.util.stream.Collectors;</span>
<span class="udiff-line-added">+ import java.util.stream.IntStream;</span>
<span class="udiff-line-added">+ import java.util.stream.Stream;</span>
<span class="udiff-line-added">+ </span>
  /*
   *  A writer for writing Attributes as text.
   *
   *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
   *  If you write code that depends on this, you do so at your own risk.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -124,13 +135,10 @@</span>
          }
      }
  
      @Override
      public Void visitDefault(DefaultAttribute attr, Void ignore) {
<span class="udiff-line-removed">-         if (attr.reason != null) {</span>
<span class="udiff-line-removed">-             report(attr.reason);</span>
<span class="udiff-line-removed">-         }</span>
          byte[] data = attr.info;
          int i = 0;
          int j = 0;
          print(&quot;  &quot;);
          try {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -138,11 +146,15 @@</span>
          } catch (ConstantPoolException e) {
              report(e);
              print(&quot;attribute name = #&quot; + attr.attribute_name_index);
          }
          print(&quot;: &quot;);
<span class="udiff-line-modified-removed">-         println(&quot;length = 0x&quot; + toHex(attr.info.length));</span>
<span class="udiff-line-modified-added">+         print(&quot;length = 0x&quot; + toHex(attr.info.length));</span>
<span class="udiff-line-added">+         if (attr.reason != null) {</span>
<span class="udiff-line-added">+             print(&quot; (&quot; + attr.reason + &quot;)&quot;);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         println();</span>
  
          print(&quot;   &quot;);
  
          while (i &lt; data.length) {
              print(toHex(data[i], 2));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -711,10 +723,90 @@</span>
              throw new AssertionError(ex);
          }
          return null;
      }
  
<span class="udiff-line-added">+     @Override</span>
<span class="udiff-line-added">+     public Void visitRecord(Record_attribute attr, Void p) {</span>
<span class="udiff-line-added">+         println(&quot;Record:&quot;);</span>
<span class="udiff-line-added">+         indent(+1);</span>
<span class="udiff-line-added">+         for (Record_attribute.ComponentInfo componentInfo : attr.component_info_arr) {</span>
<span class="udiff-line-added">+             Signature_attribute sigAttr = (Signature_attribute) componentInfo.attributes.get(Attribute.Signature);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             if (sigAttr == null)</span>
<span class="udiff-line-added">+                 print(getJavaFieldType(componentInfo.descriptor));</span>
<span class="udiff-line-added">+             else {</span>
<span class="udiff-line-added">+                 try {</span>
<span class="udiff-line-added">+                     Type t = sigAttr.getParsedSignature().getType(constant_pool);</span>
<span class="udiff-line-added">+                     print(getJavaName(t.toString()));</span>
<span class="udiff-line-added">+                 } catch (ConstantPoolException e) {</span>
<span class="udiff-line-added">+                     // report error?</span>
<span class="udiff-line-added">+                     // fall back on non-generic descriptor</span>
<span class="udiff-line-added">+                     print(getJavaFieldType(componentInfo.descriptor));</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             print(&quot; &quot;);</span>
<span class="udiff-line-added">+             try {</span>
<span class="udiff-line-added">+                 print(componentInfo.getName(constant_pool));</span>
<span class="udiff-line-added">+             } catch (ConstantPoolException e) {</span>
<span class="udiff-line-added">+                 report(e);</span>
<span class="udiff-line-added">+                 return null;</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+             print(&quot;;&quot;);</span>
<span class="udiff-line-added">+             println();</span>
<span class="udiff-line-added">+             indent(+1);</span>
<span class="udiff-line-added">+             if (options.showDescriptors) {</span>
<span class="udiff-line-added">+                 println(&quot;descriptor: &quot; + getValue(componentInfo.descriptor));</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+             if (options.showAllAttrs) {</span>
<span class="udiff-line-added">+                 for (Attribute componentAttr: componentInfo.attributes)</span>
<span class="udiff-line-added">+                     write(componentInfo, componentAttr, constant_pool);</span>
<span class="udiff-line-added">+                 println();</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+             indent(-1);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         indent(-1);</span>
<span class="udiff-line-added">+         return null;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     String getValue(Descriptor d) {</span>
<span class="udiff-line-added">+         try {</span>
<span class="udiff-line-added">+             return d.getValue(constant_pool);</span>
<span class="udiff-line-added">+         } catch (ConstantPoolException e) {</span>
<span class="udiff-line-added">+             return report(e);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     void writeList(String prefix, Collection&lt;?&gt; items, String suffix) {</span>
<span class="udiff-line-added">+         print(prefix);</span>
<span class="udiff-line-added">+         String sep = &quot;&quot;;</span>
<span class="udiff-line-added">+         for (Object item: items) {</span>
<span class="udiff-line-added">+             print(sep);</span>
<span class="udiff-line-added">+             print(item);</span>
<span class="udiff-line-added">+             sep = &quot;, &quot;;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         print(suffix);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     String getJavaFieldType(Descriptor d) {</span>
<span class="udiff-line-added">+         try {</span>
<span class="udiff-line-added">+             return getJavaName(d.getFieldType(constant_pool));</span>
<span class="udiff-line-added">+         } catch (ConstantPoolException e) {</span>
<span class="udiff-line-added">+             return report(e);</span>
<span class="udiff-line-added">+         } catch (InvalidDescriptor e) {</span>
<span class="udiff-line-added">+             return report(e);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     void writeModifiers(Collection&lt;String&gt; items) {</span>
<span class="udiff-line-added">+         for (Object item: items) {</span>
<span class="udiff-line-added">+             print(item);</span>
<span class="udiff-line-added">+             print(&quot; &quot;);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      @Override
      public Void visitRuntimeVisibleAnnotations(RuntimeVisibleAnnotations_attribute attr, Void ignore) {
          println(&quot;RuntimeVisibleAnnotations:&quot;);
          indent(+1);
          for (int i = 0; i &lt; attr.annotations.length; i++) {
</pre>
<center><a href="../classfile/ClassWriter.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ClassWriter.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>