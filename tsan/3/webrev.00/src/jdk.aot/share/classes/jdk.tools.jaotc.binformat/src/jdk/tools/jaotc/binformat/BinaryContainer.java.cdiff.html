<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.aot/share/classes/jdk.tools.jaotc.binformat/src/jdk/tools/jaotc/binformat/BinaryContainer.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../../../jdk.accessibility/windows/native/libwindowsaccessbridge/WinAccessBridge.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../jdk.tools.jaotc.test/src/jdk/tools/jaotc/test/NativeOrderOutputStreamTest.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.aot/share/classes/jdk.tools.jaotc.binformat/src/jdk/tools/jaotc/binformat/BinaryContainer.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2016, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2016, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 29,22 ***</span>
  
  import java.io.ByteArrayOutputStream;
  import java.io.DataOutputStream;
  import java.io.IOException;
  import java.util.ArrayList;
  import java.util.HashMap;
  import java.util.List;
  import java.util.Map;
  
  import jdk.tools.jaotc.binformat.Symbol.Binding;
  import jdk.tools.jaotc.binformat.Symbol.Kind;
  import jdk.tools.jaotc.binformat.elf.JELFRelocObject;
  import jdk.tools.jaotc.binformat.macho.JMachORelocObject;
  import jdk.tools.jaotc.binformat.pecoff.JPECoffRelocObject;
<span class="line-removed">- import org.graalvm.compiler.hotspot.GraalHotSpotVMConfig;</span>
<span class="line-removed">- import org.graalvm.compiler.nodes.graphbuilderconf.GraphBuilderConfiguration;</span>
<span class="line-removed">- import org.graalvm.compiler.options.OptionValues;</span>
  
  /**
   * A format-agnostic container class that holds various components of a binary.
   *
   * &lt;p&gt;
<span class="line-new-header">--- 29,25 ---</span>
  
  import java.io.ByteArrayOutputStream;
  import java.io.DataOutputStream;
  import java.io.IOException;
  import java.util.ArrayList;
<span class="line-added">+ import java.util.Arrays;</span>
  import java.util.HashMap;
  import java.util.List;
  import java.util.Map;
  
<span class="line-added">+ import org.graalvm.compiler.hotspot.GraalHotSpotVMConfig;</span>
<span class="line-added">+ import org.graalvm.compiler.nodes.graphbuilderconf.GraphBuilderConfiguration;</span>
<span class="line-added">+ import org.graalvm.compiler.options.OptionValues;</span>
<span class="line-added">+ import org.graalvm.compiler.serviceprovider.JavaVersionUtil;</span>
<span class="line-added">+ </span>
  import jdk.tools.jaotc.binformat.Symbol.Binding;
  import jdk.tools.jaotc.binformat.Symbol.Kind;
  import jdk.tools.jaotc.binformat.elf.JELFRelocObject;
  import jdk.tools.jaotc.binformat.macho.JMachORelocObject;
  import jdk.tools.jaotc.binformat.pecoff.JPECoffRelocObject;
  
  /**
   * A format-agnostic container class that holds various components of a binary.
   *
   * &lt;p&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 141,10 ***</span>
<span class="line-new-header">--- 144,11 ---</span>
  
      //@formatter:off
      private static final String[][] map = {
          {&quot;CompilerToVM::Data::SharedRuntime_deopt_blob_unpack&quot;,         &quot;_aot_deopt_blob_unpack&quot;},
          {&quot;CompilerToVM::Data::SharedRuntime_deopt_blob_uncommon_trap&quot;,  &quot;_aot_deopt_blob_uncommon_trap&quot;},
<span class="line-added">+         {&quot;CompilerToVM::Data::SharedRuntime_deopt_blob_unpack_with_exception_in_tls&quot;,  &quot;_aot_deopt_blob_unpack_with_exception_in_tls&quot;},</span>
          {&quot;CompilerToVM::Data::SharedRuntime_ic_miss_stub&quot;,              &quot;_aot_ic_miss_stub&quot;},
          {&quot;CompilerToVM::Data::SharedRuntime_handle_wrong_method_stub&quot;,  &quot;_aot_handle_wrong_method_stub&quot;},
          {&quot;SharedRuntime::exception_handler_for_return_address&quot;,         &quot;_aot_exception_handler_for_return_address&quot;},
          {&quot;SharedRuntime::register_finalizer&quot;,                           &quot;_aot_register_finalizer&quot;},
          {&quot;SharedRuntime::OSR_migration_end&quot;,                            &quot;_aot_OSR_migration_end&quot;},
</pre>
<hr />
<pre>
<span class="line-old-header">*** 201,10 ***</span>
<span class="line-new-header">--- 205,12 ---</span>
  
          {&quot;StubRoutines::_aescrypt_encryptBlock&quot;, &quot;_aot_stub_routines_aescrypt_encryptBlock&quot;},
          {&quot;StubRoutines::_aescrypt_decryptBlock&quot;, &quot;_aot_stub_routines_aescrypt_decryptBlock&quot;},
          {&quot;StubRoutines::_cipherBlockChaining_encryptAESCrypt&quot;, &quot;_aot_stub_routines_cipherBlockChaining_encryptAESCrypt&quot;},
          {&quot;StubRoutines::_cipherBlockChaining_decryptAESCrypt&quot;, &quot;_aot_stub_routines_cipherBlockChaining_decryptAESCrypt&quot;},
<span class="line-added">+         {&quot;StubRoutines::_electronicCodeBook_encryptAESCrypt&quot;, &quot;_aot_stub_routines_electronicCodeBook_encryptAESCrypt&quot;},</span>
<span class="line-added">+         {&quot;StubRoutines::_electronicCodeBook_decryptAESCrypt&quot;, &quot;_aot_stub_routines_electronicCodeBook_decryptAESCrypt&quot;},</span>
          {&quot;StubRoutines::_updateBytesCRC32&quot;, &quot;_aot_stub_routines_update_bytes_crc32&quot;},
          {&quot;StubRoutines::_crc_table_adr&quot;, &quot;_aot_stub_routines_crc_table_adr&quot;},
  
          {&quot;StubRoutines::_sha1_implCompress&quot;, &quot;_aot_stub_routines_sha1_implCompress&quot; },
          {&quot;StubRoutines::_sha1_implCompressMB&quot;, &quot;_aot_stub_routines_sha1_implCompressMB&quot; },
</pre>
<hr />
<pre>
<span class="line-old-header">*** 223,10 ***</span>
<span class="line-new-header">--- 229,12 ---</span>
          {&quot;StubRoutines::_squareToLen&quot;, &quot;_aot_stub_routines_squareToLen&quot; },
          {&quot;StubRoutines::_mulAdd&quot;, &quot;_aot_stub_routines_mulAdd&quot; },
          {&quot;StubRoutines::_montgomeryMultiply&quot;, &quot;_aot_stub_routines_montgomeryMultiply&quot; },
          {&quot;StubRoutines::_montgomerySquare&quot;, &quot;_aot_stub_routines_montgomerySquare&quot; },
          {&quot;StubRoutines::_vectorizedMismatch&quot;, &quot;_aot_stub_routines_vectorizedMismatch&quot; },
<span class="line-added">+         {&quot;StubRoutines::_bigIntegerRightShiftWorker&quot;, &quot;_aot_stub_routines_bigIntegerRightShiftWorker&quot; },</span>
<span class="line-added">+         {&quot;StubRoutines::_bigIntegerLeftShiftWorker&quot;, &quot;_aot_stub_routines_bigIntegerLeftShiftWorker&quot; },</span>
  
          {&quot;StubRoutines::_throw_delayed_StackOverflowError_entry&quot;, &quot;_aot_stub_routines_throw_delayed_StackOverflowError_entry&quot; },
  
  
          {&quot;os::javaTimeMillis&quot;, &quot;_aot_os_javaTimeMillis&quot;},
</pre>
<hr />
<pre>
<span class="line-old-header">*** 330,31 ***</span>
          // @Checkstyle: stop
          // @formatter:off
          boolean[] booleanFlags = { graalHotSpotVMConfig.cAssertions, // Debug VM
                                     graalHotSpotVMConfig.useCompressedOops,
                                     graalHotSpotVMConfig.useCompressedClassPointers,
<span class="line-removed">-                                    graalHotSpotVMConfig.compactFields,</span>
                                     graalHotSpotVMConfig.useTLAB,
                                     graalHotSpotVMConfig.useBiasedLocking,
                                     TieredAOT.getValue(graalOptions),
                                     graalHotSpotVMConfig.enableContended,
                                     graalHotSpotVMConfig.restrictContended,
                                     graphBuilderConfig.omitAssertions(),
<span class="line-removed">-                                    graalHotSpotVMConfig.threadLocalHandshakes</span>
          };
  
          int[] intFlags         = { graalHotSpotVMConfig.getOopEncoding().getShift(),
                                     graalHotSpotVMConfig.getKlassEncoding().getShift(),
                                     graalHotSpotVMConfig.contendedPaddingWidth,
<span class="line-removed">-                                    graalHotSpotVMConfig.fieldsAllocationStyle,</span>
                                     1 &lt;&lt; graalHotSpotVMConfig.logMinObjAlignment(),
                                     graalHotSpotVMConfig.codeSegmentSize,
                                     gc
          };
          // @formatter:on
          // @Checkstyle: resume
  
          byte[] booleanFlagsAsBytes = flagsToByteArray(booleanFlags);
          int size0 = configContainer.getByteStreamSize();
  
          // @formatter:off
          int computedSize = booleanFlagsAsBytes.length * Byte.BYTES    + // size of boolean flags
<span class="line-new-header">--- 338,34 ---</span>
          // @Checkstyle: stop
          // @formatter:off
          boolean[] booleanFlags = { graalHotSpotVMConfig.cAssertions, // Debug VM
                                     graalHotSpotVMConfig.useCompressedOops,
                                     graalHotSpotVMConfig.useCompressedClassPointers,
                                     graalHotSpotVMConfig.useTLAB,
                                     graalHotSpotVMConfig.useBiasedLocking,
                                     TieredAOT.getValue(graalOptions),
                                     graalHotSpotVMConfig.enableContended,
                                     graalHotSpotVMConfig.restrictContended,
                                     graphBuilderConfig.omitAssertions(),
          };
  
          int[] intFlags         = { graalHotSpotVMConfig.getOopEncoding().getShift(),
                                     graalHotSpotVMConfig.getKlassEncoding().getShift(),
                                     graalHotSpotVMConfig.contendedPaddingWidth,
                                     1 &lt;&lt; graalHotSpotVMConfig.logMinObjAlignment(),
                                     graalHotSpotVMConfig.codeSegmentSize,
                                     gc
          };
          // @formatter:on
          // @Checkstyle: resume
  
<span class="line-added">+         if (JavaVersionUtil.JAVA_SPEC &lt; 14) {</span>
<span class="line-added">+             // See JDK-8220049. Thread local handshakes are on by default since JDK14, the command line option has been removed.</span>
<span class="line-added">+             booleanFlags = Arrays.copyOf(booleanFlags, booleanFlags.length + 1);</span>
<span class="line-added">+             booleanFlags[booleanFlags.length - 1] = graalHotSpotVMConfig.threadLocalHandshakes;</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
          byte[] booleanFlagsAsBytes = flagsToByteArray(booleanFlags);
          int size0 = configContainer.getByteStreamSize();
  
          // @formatter:off
          int computedSize = booleanFlagsAsBytes.length * Byte.BYTES    + // size of boolean flags
</pre>
<center><a href="../../../../../../../../../jdk.accessibility/windows/native/libwindowsaccessbridge/WinAccessBridge.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../jdk.tools.jaotc.test/src/jdk/tools/jaotc/test/NativeOrderOutputStreamTest.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>