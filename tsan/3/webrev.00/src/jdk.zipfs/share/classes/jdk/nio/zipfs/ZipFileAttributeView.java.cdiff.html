<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.zipfs/share/classes/jdk/nio/zipfs/ZipFileAttributeView.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ZipConstants.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ZipFileAttributes.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.zipfs/share/classes/jdk/nio/zipfs/ZipFileAttributeView.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2009, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2009, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 25,20 ***</span>
  
  package jdk.nio.zipfs;
  
  import java.io.IOException;
  import java.nio.file.attribute.BasicFileAttributeView;
<span class="line-modified">! import java.nio.file.attribute.FileAttributeView;</span>
  import java.nio.file.attribute.FileTime;
  import java.util.LinkedHashMap;
  import java.util.Map;
  
  /**
   * @author Xueming Shen, Rajendra Gutupalli, Jaya Hangal
   */
  class ZipFileAttributeView implements BasicFileAttributeView {
<span class="line-modified">!     private static enum AttrID {</span>
          size,
          creationTime,
          lastAccessTime,
          lastModifiedTime,
          isDirectory,
<span class="line-new-header">--- 25,22 ---</span>
  
  package jdk.nio.zipfs;
  
  import java.io.IOException;
  import java.nio.file.attribute.BasicFileAttributeView;
<span class="line-modified">! import java.nio.file.attribute.BasicFileAttributes;</span>
  import java.nio.file.attribute.FileTime;
<span class="line-added">+ import java.nio.file.attribute.PosixFilePermission;</span>
  import java.util.LinkedHashMap;
  import java.util.Map;
<span class="line-added">+ import java.util.Set;</span>
  
  /**
   * @author Xueming Shen, Rajendra Gutupalli, Jaya Hangal
   */
  class ZipFileAttributeView implements BasicFileAttributeView {
<span class="line-modified">!     static enum AttrID {</span>
          size,
          creationTime,
          lastAccessTime,
          lastModifiedTime,
          isDirectory,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 46,49 ***</span>
          isSymbolicLink,
          isOther,
          fileKey,
          compressedSize,
          crc,
<span class="line-modified">!         method</span>
<span class="line-modified">!     };</span>
  
<span class="line-modified">!     private final ZipPath path;</span>
      private final boolean isZipView;
  
<span class="line-modified">!     private ZipFileAttributeView(ZipPath path, boolean isZipView) {</span>
          this.path = path;
          this.isZipView = isZipView;
      }
  
<span class="line-removed">-     @SuppressWarnings(&quot;unchecked&quot;) // Cast to V</span>
<span class="line-removed">-     static &lt;V extends FileAttributeView&gt; V get(ZipPath path, Class&lt;V&gt; type) {</span>
<span class="line-removed">-         if (type == null)</span>
<span class="line-removed">-             throw new NullPointerException();</span>
<span class="line-removed">-         if (type == BasicFileAttributeView.class)</span>
<span class="line-removed">-             return (V)new ZipFileAttributeView(path, false);</span>
<span class="line-removed">-         if (type == ZipFileAttributeView.class)</span>
<span class="line-removed">-             return (V)new ZipFileAttributeView(path, true);</span>
<span class="line-removed">-         return null;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     static ZipFileAttributeView get(ZipPath path, String type) {</span>
<span class="line-removed">-         if (type == null)</span>
<span class="line-removed">-             throw new NullPointerException();</span>
<span class="line-removed">-         if (type.equals(&quot;basic&quot;))</span>
<span class="line-removed">-             return new ZipFileAttributeView(path, false);</span>
<span class="line-removed">-         if (type.equals(&quot;zip&quot;))</span>
<span class="line-removed">-             return new ZipFileAttributeView(path, true);</span>
<span class="line-removed">-         return null;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
      @Override
      public String name() {
          return isZipView ? &quot;zip&quot; : &quot;basic&quot;;
      }
  
<span class="line-modified">!     public ZipFileAttributes readAttributes() throws IOException {</span>
<span class="line-modified">!         return path.getAttributes();</span>
      }
  
      @Override
      public void setTimes(FileTime lastModifiedTime,
                           FileTime lastAccessTime,
<span class="line-new-header">--- 48,32 ---</span>
          isSymbolicLink,
          isOther,
          fileKey,
          compressedSize,
          crc,
<span class="line-modified">!         method,</span>
<span class="line-modified">!         owner,</span>
<span class="line-added">+         group,</span>
<span class="line-added">+         permissions</span>
<span class="line-added">+     }</span>
  
<span class="line-modified">!     final ZipPath path;</span>
      private final boolean isZipView;
  
<span class="line-modified">!     ZipFileAttributeView(ZipPath path, boolean isZipView) {</span>
          this.path = path;
          this.isZipView = isZipView;
      }
  
      @Override
      public String name() {
          return isZipView ? &quot;zip&quot; : &quot;basic&quot;;
      }
  
<span class="line-modified">!     @Override</span>
<span class="line-modified">!     public BasicFileAttributes readAttributes() throws IOException {</span>
<span class="line-added">+         return path.readAttributes();</span>
      }
  
      @Override
      public void setTimes(FileTime lastModifiedTime,
                           FileTime lastAccessTime,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 96,30 ***</span>
          throws IOException
      {
          path.setTimes(lastModifiedTime, lastAccessTime, createTime);
      }
  
      void setAttribute(String attribute, Object value)
          throws IOException
      {
          try {
              if (AttrID.valueOf(attribute) == AttrID.lastModifiedTime)
                  setTimes((FileTime)value, null, null);
              if (AttrID.valueOf(attribute) == AttrID.lastAccessTime)
                  setTimes(null, (FileTime)value, null);
              if (AttrID.valueOf(attribute) == AttrID.creationTime)
                  setTimes(null, null, (FileTime)value);
<span class="line-modified">!             return;</span>
<span class="line-modified">!         } catch (IllegalArgumentException x) {}</span>
<span class="line-modified">!         throw new UnsupportedOperationException(&quot;&#39;&quot; + attribute +</span>
<span class="line-modified">!             &quot;&#39; is unknown or read-only attribute&quot;);</span>
      }
  
      Map&lt;String, Object&gt; readAttributes(String attributes)
          throws IOException
      {
<span class="line-modified">!         ZipFileAttributes zfas = readAttributes();</span>
          LinkedHashMap&lt;String, Object&gt; map = new LinkedHashMap&lt;&gt;();
          if (&quot;*&quot;.equals(attributes)) {
              for (AttrID id : AttrID.values()) {
                  try {
                      map.put(id.name(), attribute(id, zfas));
<span class="line-new-header">--- 81,37 ---</span>
          throws IOException
      {
          path.setTimes(lastModifiedTime, lastAccessTime, createTime);
      }
  
<span class="line-added">+     public void setPermissions(Set&lt;PosixFilePermission&gt; perms) throws IOException {</span>
<span class="line-added">+         path.setPermissions(perms);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     @SuppressWarnings(&quot;unchecked&quot;)</span>
      void setAttribute(String attribute, Object value)
          throws IOException
      {
          try {
              if (AttrID.valueOf(attribute) == AttrID.lastModifiedTime)
                  setTimes((FileTime)value, null, null);
              if (AttrID.valueOf(attribute) == AttrID.lastAccessTime)
                  setTimes(null, (FileTime)value, null);
              if (AttrID.valueOf(attribute) == AttrID.creationTime)
                  setTimes(null, null, (FileTime)value);
<span class="line-modified">!             if (AttrID.valueOf(attribute) == AttrID.permissions)</span>
<span class="line-modified">!                 setPermissions((Set&lt;PosixFilePermission&gt;)value);</span>
<span class="line-modified">!         } catch (IllegalArgumentException x) {</span>
<span class="line-modified">!             throw new UnsupportedOperationException(&quot;&#39;&quot; + attribute +</span>
<span class="line-added">+                 &quot;&#39; is unknown or read-only attribute&quot;);</span>
<span class="line-added">+         }</span>
      }
  
      Map&lt;String, Object&gt; readAttributes(String attributes)
          throws IOException
      {
<span class="line-modified">!         ZipFileAttributes zfas = (ZipFileAttributes)readAttributes();</span>
          LinkedHashMap&lt;String, Object&gt; map = new LinkedHashMap&lt;&gt;();
          if (&quot;*&quot;.equals(attributes)) {
              for (AttrID id : AttrID.values()) {
                  try {
                      map.put(id.name(), attribute(id, zfas));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 166,9 ***</span>
<span class="line-new-header">--- 158,16 ---</span>
              break;
          case method:
              if (isZipView)
                  return zfas.method();
              break;
<span class="line-added">+         case permissions:</span>
<span class="line-added">+             if (isZipView) {</span>
<span class="line-added">+                 return zfas.storedPermissions().orElse(null);</span>
<span class="line-added">+             }</span>
<span class="line-added">+             break;</span>
<span class="line-added">+         default:</span>
<span class="line-added">+             break;</span>
          }
          return null;
      }
  }
</pre>
<center><a href="ZipConstants.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ZipFileAttributes.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>