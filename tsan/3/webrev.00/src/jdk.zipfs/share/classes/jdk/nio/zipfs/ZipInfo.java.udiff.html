<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.zipfs/share/classes/jdk/nio/zipfs/ZipInfo.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ZipFileSystemProvider.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ZipPath.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.zipfs/share/classes/jdk/nio/zipfs/ZipInfo.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2009, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2009, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -26,10 +26,11 @@</span>
  package jdk.nio.zipfs;
  
  import java.nio.file.Paths;
  import java.util.Collections;
  import java.util.Map;
<span class="udiff-line-added">+ import java.util.zip.ZipException;</span>
  
  import static jdk.nio.zipfs.ZipConstants.*;
  import static jdk.nio.zipfs.ZipUtils.dosToJavaTime;
  import static jdk.nio.zipfs.ZipUtils.unixToJavaTime;
  import static jdk.nio.zipfs.ZipUtils.winToJavaTime;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -63,29 +64,29 @@</span>
                  // use size CENHDR as the extra bytes to read, just in case the
                  // loc.extra is bigger than the cen.extra, try to avoid to read
                  // twice
                  long len = LOCHDR + CENNAM(cen, pos) + CENEXT(cen, pos) + CENHDR;
                  if (zfs.readFullyAt(buf, 0, len, locoff(cen, pos)) != len)
<span class="udiff-line-modified-removed">-                     ZipFileSystem.zerror(&quot;read loc header failed&quot;);</span>
<span class="udiff-line-modified-added">+                     throw new ZipException(&quot;read loc header failed&quot;);</span>
                  if (LOCEXT(buf) &gt; CENEXT(cen, pos) + CENHDR) {
                      // have to read the second time;
                      len = LOCHDR + LOCNAM(buf) + LOCEXT(buf);
                      if (zfs.readFullyAt(buf, 0, len, locoff(cen, pos)) != len)
<span class="udiff-line-modified-removed">-                         ZipFileSystem.zerror(&quot;read loc header failed&quot;);</span>
<span class="udiff-line-modified-added">+                         throw new ZipException(&quot;read loc header failed&quot;);</span>
                  }
                  printLOC(buf);
                  pos += CENHDR + CENNAM(cen, pos) + CENEXT(cen, pos) + CENCOM(cen, pos);
              }
              zfs.close();
          }
      }
  
<span class="udiff-line-modified-removed">-     static void print(String fmt, Object... objs) {</span>
<span class="udiff-line-modified-added">+     private static void print(String fmt, Object... objs) {</span>
          System.out.printf(fmt, objs);
      }
  
<span class="udiff-line-modified-removed">-     static void printLOC(byte[] loc) {</span>
<span class="udiff-line-modified-added">+     private static void printLOC(byte[] loc) {</span>
          print(&quot;%n&quot;);
          print(&quot;[Local File Header]%n&quot;);
          print(&quot;    Signature   :   %#010x%n&quot;, LOCSIG(loc));
          if (LOCSIG(loc) != LOCSIG) {
             print(&quot;    Wrong signature!&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -105,11 +106,11 @@</span>
          print(&quot;    ExtraLength :       %#6x%n&quot;, LOCEXT(loc));
          if (LOCEXT(loc) != 0)
              printExtra(loc, LOCHDR + LOCNAM(loc), LOCEXT(loc));
      }
  
<span class="udiff-line-modified-removed">-     static void printCEN(byte[] cen, int off) {</span>
<span class="udiff-line-modified-added">+     private static void printCEN(byte[] cen, int off) {</span>
          print(&quot;[Central Directory Header]%n&quot;);
          print(&quot;    Signature   :   %#010x%n&quot;, CENSIG(cen, off));
          if (CENSIG(cen, off) != CENSIG) {
             print(&quot;    Wrong signature!&quot;);
             return;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -138,11 +139,11 @@</span>
          print(&quot;    AttrsEx     :   %#10x%n&quot;, CENATX(cen, off));
          print(&quot;    LocOff      :   %#10x%n&quot;, CENOFF(cen, off));
  
      }
  
<span class="udiff-line-modified-removed">-     static long locoff(byte[] cen, int pos) {</span>
<span class="udiff-line-modified-added">+     private static long locoff(byte[] cen, int pos) {</span>
          long locoff = CENOFF(cen, pos);
          if (locoff == ZIP64_MINVAL) {    //ZIP64
              int off = pos + CENHDR + CENNAM(cen, pos);
              int end = off + CENEXT(cen, pos);
              while (off + 4 &lt; end) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -162,11 +163,11 @@</span>
              // should never be here
          }
          return locoff;
      }
  
<span class="udiff-line-modified-removed">-     static void printExtra(byte[] extra, int off, int len) {</span>
<span class="udiff-line-modified-added">+     private static void printExtra(byte[] extra, int off, int len) {</span>
          int end = off + len;
          while (off + 4 &lt;= end) {
              int tag = SH(extra, off);
              int sz = SH(extra, off + 2);
              print(&quot;        [tag=0x%04x, sz=%d, data= &quot;, tag, sz);
</pre>
<center><a href="ZipFileSystemProvider.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ZipPath.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>