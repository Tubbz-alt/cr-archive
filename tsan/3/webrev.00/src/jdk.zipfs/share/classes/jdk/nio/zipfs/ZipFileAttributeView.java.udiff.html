<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.zipfs/share/classes/jdk/nio/zipfs/ZipFileAttributeView.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ZipConstants.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ZipFileAttributes.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.zipfs/share/classes/jdk/nio/zipfs/ZipFileAttributeView.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2009, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2009, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -25,20 +25,22 @@</span>
  
  package jdk.nio.zipfs;
  
  import java.io.IOException;
  import java.nio.file.attribute.BasicFileAttributeView;
<span class="udiff-line-modified-removed">- import java.nio.file.attribute.FileAttributeView;</span>
<span class="udiff-line-modified-added">+ import java.nio.file.attribute.BasicFileAttributes;</span>
  import java.nio.file.attribute.FileTime;
<span class="udiff-line-added">+ import java.nio.file.attribute.PosixFilePermission;</span>
  import java.util.LinkedHashMap;
  import java.util.Map;
<span class="udiff-line-added">+ import java.util.Set;</span>
  
  /**
   * @author Xueming Shen, Rajendra Gutupalli, Jaya Hangal
   */
  class ZipFileAttributeView implements BasicFileAttributeView {
<span class="udiff-line-modified-removed">-     private static enum AttrID {</span>
<span class="udiff-line-modified-added">+     static enum AttrID {</span>
          size,
          creationTime,
          lastAccessTime,
          lastModifiedTime,
          isDirectory,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -46,49 +48,32 @@</span>
          isSymbolicLink,
          isOther,
          fileKey,
          compressedSize,
          crc,
<span class="udiff-line-modified-removed">-         method</span>
<span class="udiff-line-modified-removed">-     };</span>
<span class="udiff-line-modified-added">+         method,</span>
<span class="udiff-line-modified-added">+         owner,</span>
<span class="udiff-line-added">+         group,</span>
<span class="udiff-line-added">+         permissions</span>
<span class="udiff-line-added">+     }</span>
  
<span class="udiff-line-modified-removed">-     private final ZipPath path;</span>
<span class="udiff-line-modified-added">+     final ZipPath path;</span>
      private final boolean isZipView;
  
<span class="udiff-line-modified-removed">-     private ZipFileAttributeView(ZipPath path, boolean isZipView) {</span>
<span class="udiff-line-modified-added">+     ZipFileAttributeView(ZipPath path, boolean isZipView) {</span>
          this.path = path;
          this.isZipView = isZipView;
      }
  
<span class="udiff-line-removed">-     @SuppressWarnings(&quot;unchecked&quot;) // Cast to V</span>
<span class="udiff-line-removed">-     static &lt;V extends FileAttributeView&gt; V get(ZipPath path, Class&lt;V&gt; type) {</span>
<span class="udiff-line-removed">-         if (type == null)</span>
<span class="udiff-line-removed">-             throw new NullPointerException();</span>
<span class="udiff-line-removed">-         if (type == BasicFileAttributeView.class)</span>
<span class="udiff-line-removed">-             return (V)new ZipFileAttributeView(path, false);</span>
<span class="udiff-line-removed">-         if (type == ZipFileAttributeView.class)</span>
<span class="udiff-line-removed">-             return (V)new ZipFileAttributeView(path, true);</span>
<span class="udiff-line-removed">-         return null;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     static ZipFileAttributeView get(ZipPath path, String type) {</span>
<span class="udiff-line-removed">-         if (type == null)</span>
<span class="udiff-line-removed">-             throw new NullPointerException();</span>
<span class="udiff-line-removed">-         if (type.equals(&quot;basic&quot;))</span>
<span class="udiff-line-removed">-             return new ZipFileAttributeView(path, false);</span>
<span class="udiff-line-removed">-         if (type.equals(&quot;zip&quot;))</span>
<span class="udiff-line-removed">-             return new ZipFileAttributeView(path, true);</span>
<span class="udiff-line-removed">-         return null;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
      @Override
      public String name() {
          return isZipView ? &quot;zip&quot; : &quot;basic&quot;;
      }
  
<span class="udiff-line-modified-removed">-     public ZipFileAttributes readAttributes() throws IOException {</span>
<span class="udiff-line-modified-removed">-         return path.getAttributes();</span>
<span class="udiff-line-modified-added">+     @Override</span>
<span class="udiff-line-modified-added">+     public BasicFileAttributes readAttributes() throws IOException {</span>
<span class="udiff-line-added">+         return path.readAttributes();</span>
      }
  
      @Override
      public void setTimes(FileTime lastModifiedTime,
                           FileTime lastAccessTime,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -96,30 +81,37 @@</span>
          throws IOException
      {
          path.setTimes(lastModifiedTime, lastAccessTime, createTime);
      }
  
<span class="udiff-line-added">+     public void setPermissions(Set&lt;PosixFilePermission&gt; perms) throws IOException {</span>
<span class="udiff-line-added">+         path.setPermissions(perms);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     @SuppressWarnings(&quot;unchecked&quot;)</span>
      void setAttribute(String attribute, Object value)
          throws IOException
      {
          try {
              if (AttrID.valueOf(attribute) == AttrID.lastModifiedTime)
                  setTimes((FileTime)value, null, null);
              if (AttrID.valueOf(attribute) == AttrID.lastAccessTime)
                  setTimes(null, (FileTime)value, null);
              if (AttrID.valueOf(attribute) == AttrID.creationTime)
                  setTimes(null, null, (FileTime)value);
<span class="udiff-line-modified-removed">-             return;</span>
<span class="udiff-line-modified-removed">-         } catch (IllegalArgumentException x) {}</span>
<span class="udiff-line-modified-removed">-         throw new UnsupportedOperationException(&quot;&#39;&quot; + attribute +</span>
<span class="udiff-line-modified-removed">-             &quot;&#39; is unknown or read-only attribute&quot;);</span>
<span class="udiff-line-modified-added">+             if (AttrID.valueOf(attribute) == AttrID.permissions)</span>
<span class="udiff-line-modified-added">+                 setPermissions((Set&lt;PosixFilePermission&gt;)value);</span>
<span class="udiff-line-modified-added">+         } catch (IllegalArgumentException x) {</span>
<span class="udiff-line-modified-added">+             throw new UnsupportedOperationException(&quot;&#39;&quot; + attribute +</span>
<span class="udiff-line-added">+                 &quot;&#39; is unknown or read-only attribute&quot;);</span>
<span class="udiff-line-added">+         }</span>
      }
  
      Map&lt;String, Object&gt; readAttributes(String attributes)
          throws IOException
      {
<span class="udiff-line-modified-removed">-         ZipFileAttributes zfas = readAttributes();</span>
<span class="udiff-line-modified-added">+         ZipFileAttributes zfas = (ZipFileAttributes)readAttributes();</span>
          LinkedHashMap&lt;String, Object&gt; map = new LinkedHashMap&lt;&gt;();
          if (&quot;*&quot;.equals(attributes)) {
              for (AttrID id : AttrID.values()) {
                  try {
                      map.put(id.name(), attribute(id, zfas));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -166,9 +158,16 @@</span>
              break;
          case method:
              if (isZipView)
                  return zfas.method();
              break;
<span class="udiff-line-added">+         case permissions:</span>
<span class="udiff-line-added">+             if (isZipView) {</span>
<span class="udiff-line-added">+                 return zfas.storedPermissions().orElse(null);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+             break;</span>
<span class="udiff-line-added">+         default:</span>
<span class="udiff-line-added">+             break;</span>
          }
          return null;
      }
  }
</pre>
<center><a href="ZipConstants.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ZipFileAttributes.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>