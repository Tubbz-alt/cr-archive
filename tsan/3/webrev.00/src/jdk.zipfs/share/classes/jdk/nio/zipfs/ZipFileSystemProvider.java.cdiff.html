<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.zipfs/share/classes/jdk/nio/zipfs/ZipFileSystemProvider.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ZipFileSystem.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ZipInfo.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.zipfs/share/classes/jdk/nio/zipfs/ZipFileSystemProvider.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2009, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2009, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 50,11 ***</span>
  
  /**
   * @author Xueming Shen, Rajendra Gutupalli, Jaya Hangal
   */
  public class ZipFileSystemProvider extends FileSystemProvider {
<span class="line-removed">- </span>
      private final Map&lt;Path, ZipFileSystem&gt; filesystems = new HashMap&lt;&gt;();
  
      public ZipFileSystemProvider() {}
  
      @Override
<span class="line-new-header">--- 50,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 102,24 ***</span>
              if (ensureFile(path)) {
                  realPath = path.toRealPath();
                  if (filesystems.containsKey(realPath))
                      throw new FileSystemAlreadyExistsException();
              }
<span class="line-modified">!             ZipFileSystem zipfs = null;</span>
<span class="line-removed">-             try {</span>
<span class="line-removed">-                 if (env.containsKey(&quot;multi-release&quot;)) {</span>
<span class="line-removed">-                     zipfs = new JarFileSystem(this, path, env);</span>
<span class="line-removed">-                 } else {</span>
<span class="line-removed">-                     zipfs = new ZipFileSystem(this, path, env);</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             } catch (ZipException ze) {</span>
<span class="line-removed">-                 String pname = path.toString();</span>
<span class="line-removed">-                 if (pname.endsWith(&quot;.zip&quot;) || pname.endsWith(&quot;.jar&quot;))</span>
<span class="line-removed">-                     throw ze;</span>
<span class="line-removed">-                 // assume NOT a zip/jar file</span>
<span class="line-removed">-                 throw new UnsupportedOperationException();</span>
<span class="line-removed">-             }</span>
              if (realPath == null) {  // newly created
                  realPath = path.toRealPath();
              }
              filesystems.put(realPath, zipfs);
              return zipfs;
<span class="line-new-header">--- 101,11 ---</span>
              if (ensureFile(path)) {
                  realPath = path.toRealPath();
                  if (filesystems.containsKey(realPath))
                      throw new FileSystemAlreadyExistsException();
              }
<span class="line-modified">!             ZipFileSystem zipfs = getZipFileSystem(path, env);</span>
              if (realPath == null) {  // newly created
                  realPath = path.toRealPath();
              }
              filesystems.put(realPath, zipfs);
              return zipfs;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 129,18 ***</span>
      @Override
      public FileSystem newFileSystem(Path path, Map&lt;String, ?&gt; env)
          throws IOException
      {
          ensureFile(path);
<span class="line-modified">!          try {</span>
<span class="line-modified">!              ZipFileSystem zipfs;</span>
<span class="line-modified">!              if (env.containsKey(&quot;multi-release&quot;)) {</span>
<span class="line-modified">!                  zipfs = new JarFileSystem(this, path, env);</span>
<span class="line-modified">!              } else {</span>
<span class="line-modified">!                  zipfs = new ZipFileSystem(this, path, env);</span>
<span class="line-removed">-              }</span>
<span class="line-removed">-             return zipfs;</span>
          } catch (ZipException ze) {
              String pname = path.toString();
              if (pname.endsWith(&quot;.zip&quot;) || pname.endsWith(&quot;.jar&quot;))
                  throw ze;
              throw new UnsupportedOperationException();
<span class="line-new-header">--- 115,16 ---</span>
      @Override
      public FileSystem newFileSystem(Path path, Map&lt;String, ?&gt; env)
          throws IOException
      {
          ensureFile(path);
<span class="line-modified">!         return getZipFileSystem(path, env);</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     private ZipFileSystem getZipFileSystem(Path path, Map&lt;String, ?&gt; env) throws IOException {</span>
<span class="line-modified">!         try {</span>
<span class="line-modified">!             return new ZipFileSystem(this, path, env);</span>
          } catch (ZipException ze) {
              String pname = path.toString();
              if (pname.endsWith(&quot;.zip&quot;) || pname.endsWith(&quot;.jar&quot;))
                  throw ze;
              throw new UnsupportedOperationException();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 173,11 ***</span>
              return zipfs;
          }
      }
  
      // Checks that the given file is a UnixPath
<span class="line-modified">!     static final ZipPath toZipPath(Path path) {</span>
          if (path == null)
              throw new NullPointerException();
          if (!(path instanceof ZipPath))
              throw new ProviderMismatchException();
          return (ZipPath)path;
<span class="line-new-header">--- 157,11 ---</span>
              return zipfs;
          }
      }
  
      // Checks that the given file is a UnixPath
<span class="line-modified">!     private static ZipPath toZipPath(Path path) {</span>
          if (path == null)
              throw new NullPointerException();
          if (!(path instanceof ZipPath))
              throw new ProviderMismatchException();
          return (ZipPath)path;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 209,11 ***</span>
  
      @Override
      public &lt;V extends FileAttributeView&gt; V
          getFileAttributeView(Path path, Class&lt;V&gt; type, LinkOption... options)
      {
<span class="line-modified">!         return ZipFileAttributeView.get(toZipPath(path), type);</span>
      }
  
      @Override
      public FileStore getFileStore(Path path) throws IOException {
          return toZipPath(path).getFileStore();
<span class="line-new-header">--- 193,11 ---</span>
  
      @Override
      public &lt;V extends FileAttributeView&gt; V
          getFileAttributeView(Path path, Class&lt;V&gt; type, LinkOption... options)
      {
<span class="line-modified">!         return toZipPath(path).getFileAttributeView(type);</span>
      }
  
      @Override
      public FileStore getFileStore(Path path) throws IOException {
          return toZipPath(path).getFileStore();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 239,11 ***</span>
      @Override
      public AsynchronousFileChannel newAsynchronousFileChannel(Path path,
              Set&lt;? extends OpenOption&gt; options,
              ExecutorService exec,
              FileAttribute&lt;?&gt;... attrs)
<span class="line-removed">-             throws IOException</span>
      {
          throw new UnsupportedOperationException();
      }
  
      @Override
<span class="line-new-header">--- 223,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 284,30 ***</span>
      {
          return toZipPath(path).newOutputStream(options);
      }
  
      @Override
<span class="line-removed">-     @SuppressWarnings(&quot;unchecked&quot;) // Cast to A</span>
      public &lt;A extends BasicFileAttributes&gt; A
          readAttributes(Path path, Class&lt;A&gt; type, LinkOption... options)
          throws IOException
      {
<span class="line-modified">!         if (type == BasicFileAttributes.class || type == ZipFileAttributes.class)</span>
<span class="line-removed">-             return (A)toZipPath(path).getAttributes();</span>
<span class="line-removed">-         return null;</span>
      }
  
      @Override
      public Map&lt;String, Object&gt;
<span class="line-modified">!         readAttributes(Path path, String attribute, LinkOption... options)</span>
          throws IOException
      {
<span class="line-modified">!         return toZipPath(path).readAttributes(attribute, options);</span>
      }
  
      @Override
<span class="line-modified">!     public Path readSymbolicLink(Path link) throws IOException {</span>
          throw new UnsupportedOperationException(&quot;Not supported.&quot;);
      }
  
      @Override
      public void setAttribute(Path path, String attribute,
<span class="line-new-header">--- 267,27 ---</span>
      {
          return toZipPath(path).newOutputStream(options);
      }
  
      @Override
      public &lt;A extends BasicFileAttributes&gt; A
          readAttributes(Path path, Class&lt;A&gt; type, LinkOption... options)
          throws IOException
      {
<span class="line-modified">!         return toZipPath(path).readAttributes(type);</span>
      }
  
      @Override
      public Map&lt;String, Object&gt;
<span class="line-modified">!         readAttributes(Path path, String attributes, LinkOption... options)</span>
          throws IOException
      {
<span class="line-modified">!         return toZipPath(path).readAttributes(attributes, options);</span>
      }
  
      @Override
<span class="line-modified">!     public Path readSymbolicLink(Path link) {</span>
          throw new UnsupportedOperationException(&quot;Not supported.&quot;);
      }
  
      @Override
      public void setAttribute(Path path, String attribute,
</pre>
<center><a href="ZipFileSystem.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ZipInfo.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>