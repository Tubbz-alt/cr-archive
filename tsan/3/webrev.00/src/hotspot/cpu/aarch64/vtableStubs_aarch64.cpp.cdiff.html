<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/cpu/aarch64/vtableStubs_aarch64.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="vmreg_aarch64.inline.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../arm/abstractInterpreter_arm.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/aarch64/vtableStubs_aarch64.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * Copyright (c) 2014, Red Hat Inc. All rights reserved.
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * Copyright (c) 2014, Red Hat Inc. All rights reserved.
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
</pre>
<hr />
<pre>
<span class="line-old-header">*** 168,15 ***</span>
  
    // Entry arguments:
    //  rscratch2: CompiledICHolder
    //  j_rarg0: Receiver
  
<span class="line-modified">!   // Most registers are in use; we&#39;ll use r16, rmethod, r10, r11</span>
    const Register recv_klass_reg     = r10;
    const Register holder_klass_reg   = r16; // declaring interface klass (DECC)
    const Register resolved_klass_reg = rmethod; // resolved interface klass (REFC)
    const Register temp_reg           = r11;
    const Register icholder_reg       = rscratch2;
  
    Label L_no_such_interface;
  
    __ ldr(resolved_klass_reg, Address(icholder_reg, CompiledICHolder::holder_klass_offset()));
<span class="line-new-header">--- 168,17 ---</span>
  
    // Entry arguments:
    //  rscratch2: CompiledICHolder
    //  j_rarg0: Receiver
  
<span class="line-modified">!   // This stub is called from compiled code which has no callee-saved registers,</span>
<span class="line-added">+   // so all registers except arguments are free at this point.</span>
    const Register recv_klass_reg     = r10;
    const Register holder_klass_reg   = r16; // declaring interface klass (DECC)
    const Register resolved_klass_reg = rmethod; // resolved interface klass (REFC)
    const Register temp_reg           = r11;
<span class="line-added">+   const Register temp_reg2          = r15;</span>
    const Register icholder_reg       = rscratch2;
  
    Label L_no_such_interface;
  
    __ ldr(resolved_klass_reg, Address(icholder_reg, CompiledICHolder::holder_klass_offset()));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 187,33 ***</span>
    // get receiver klass (also an implicit null-check)
    address npe_addr = __ pc();
    __ load_klass(recv_klass_reg, j_rarg0);
  
    // Receiver subtype check against REFC.
<span class="line-removed">-   // Destroys recv_klass_reg value.</span>
    __ lookup_interface_method(// inputs: rec. class, interface
                               recv_klass_reg, resolved_klass_reg, noreg,
                               // outputs:  scan temp. reg1, scan temp. reg2
<span class="line-modified">!                              recv_klass_reg, temp_reg,</span>
                               L_no_such_interface,
                               /*return_method=*/false);
  
    const ptrdiff_t  typecheckSize = __ pc() - start_pc;
    start_pc = __ pc();
  
    // Get selected method from declaring class and itable index
<span class="line-removed">-   __ load_klass(recv_klass_reg, j_rarg0);   // restore recv_klass_reg</span>
    __ lookup_interface_method(// inputs: rec. class, interface, itable index
                               recv_klass_reg, holder_klass_reg, itable_index,
                               // outputs: method, scan temp. reg
                               rmethod, temp_reg,
                               L_no_such_interface);
  
    const ptrdiff_t lookupSize = __ pc() - start_pc;
  
    // Reduce &quot;estimate&quot; such that &quot;padding&quot; does not drop below 8.
<span class="line-modified">!   const ptrdiff_t estimate = 152;</span>
    const ptrdiff_t codesize = typecheckSize + lookupSize;
    slop_delta  = (int)(estimate - codesize);
    slop_bytes += slop_delta;
    assert(slop_delta &gt;= 0, &quot;itable #%d: Code size estimate (%d) for lookup_interface_method too small, required: %d&quot;, itable_index, (int)estimate, (int)codesize);
  
<span class="line-new-header">--- 189,31 ---</span>
    // get receiver klass (also an implicit null-check)
    address npe_addr = __ pc();
    __ load_klass(recv_klass_reg, j_rarg0);
  
    // Receiver subtype check against REFC.
    __ lookup_interface_method(// inputs: rec. class, interface
                               recv_klass_reg, resolved_klass_reg, noreg,
                               // outputs:  scan temp. reg1, scan temp. reg2
<span class="line-modified">!                              temp_reg2, temp_reg,</span>
                               L_no_such_interface,
                               /*return_method=*/false);
  
    const ptrdiff_t  typecheckSize = __ pc() - start_pc;
    start_pc = __ pc();
  
    // Get selected method from declaring class and itable index
    __ lookup_interface_method(// inputs: rec. class, interface, itable index
                               recv_klass_reg, holder_klass_reg, itable_index,
                               // outputs: method, scan temp. reg
                               rmethod, temp_reg,
                               L_no_such_interface);
  
    const ptrdiff_t lookupSize = __ pc() - start_pc;
  
    // Reduce &quot;estimate&quot; such that &quot;padding&quot; does not drop below 8.
<span class="line-modified">!   const ptrdiff_t estimate = 124;</span>
    const ptrdiff_t codesize = typecheckSize + lookupSize;
    slop_delta  = (int)(estimate - codesize);
    slop_bytes += slop_delta;
    assert(slop_delta &gt;= 0, &quot;itable #%d: Code size estimate (%d) for lookup_interface_method too small, required: %d&quot;, itable_index, (int)estimate, (int)codesize);
  
</pre>
<center><a href="vmreg_aarch64.inline.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../arm/abstractInterpreter_arm.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>