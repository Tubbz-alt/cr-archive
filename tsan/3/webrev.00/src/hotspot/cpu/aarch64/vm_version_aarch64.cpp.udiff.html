<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/cpu/aarch64/vm_version_aarch64.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="templateTable_aarch64.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="vm_version_aarch64.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/aarch64/vm_version_aarch64.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,8 +1,8 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-removed">-  * Copyright (c) 2015, Red Hat Inc. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2015, 2019, Red Hat Inc. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -26,22 +26,19 @@</span>
  #include &quot;precompiled.hpp&quot;
  #include &quot;asm/macroAssembler.hpp&quot;
  #include &quot;asm/macroAssembler.inline.hpp&quot;
  #include &quot;memory/resourceArea.hpp&quot;
  #include &quot;runtime/java.hpp&quot;
<span class="udiff-line-added">+ #include &quot;runtime/os.hpp&quot;</span>
  #include &quot;runtime/stubCodeGenerator.hpp&quot;
<span class="udiff-line-added">+ #include &quot;runtime/vm_version.hpp&quot;</span>
  #include &quot;utilities/macros.hpp&quot;
<span class="udiff-line-removed">- #include &quot;vm_version_aarch64.hpp&quot;</span>
  
  #include OS_HEADER_INLINE(os)
  
<span class="udiff-line-removed">- #ifndef BUILTIN_SIM</span>
  #include &lt;sys/auxv.h&gt;
  #include &lt;asm/hwcap.h&gt;
<span class="udiff-line-removed">- #else</span>
<span class="udiff-line-removed">- #define getauxval(hwcap) 0</span>
<span class="udiff-line-removed">- #endif</span>
  
  #ifndef HWCAP_AES
  #define HWCAP_AES   (1&lt;&lt;3)
  #endif
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -69,10 +66,11 @@</span>
  int VM_Version::_model;
  int VM_Version::_model2;
  int VM_Version::_variant;
  int VM_Version::_revision;
  int VM_Version::_stepping;
<span class="udiff-line-added">+ bool VM_Version::_dcpop;</span>
  VM_Version::PsrInfo VM_Version::_psr_info   = { 0, };
  
  static BufferBlob* stub_blob;
  static const int stub_size = 550;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -90,14 +88,10 @@</span>
    address generate_getPsrInfo() {
      StubCodeMark mark(this, &quot;VM_Version&quot;, &quot;getPsrInfo_stub&quot;);
  #   define __ _masm-&gt;
      address start = __ pc();
  
<span class="udiff-line-removed">- #ifdef BUILTIN_SIM</span>
<span class="udiff-line-removed">-     __ c_stub_prolog(1, 0, MacroAssembler::ret_type_void);</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">- </span>
      // void getPsrInfo(VM_Version::PsrInfo* psr_info);
  
      address entry = __ pc();
  
      __ enter();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -127,12 +121,15 @@</span>
  
    getPsrInfo_stub(&amp;_psr_info);
  
    int dcache_line = VM_Version::dcache_line_size();
  
<span class="udiff-line-added">+   // Limit AllocatePrefetchDistance so that it does not exceed the</span>
<span class="udiff-line-added">+   // constraint in AllocatePrefetchDistanceConstraintFunc.</span>
    if (FLAG_IS_DEFAULT(AllocatePrefetchDistance))
<span class="udiff-line-modified-removed">-     FLAG_SET_DEFAULT(AllocatePrefetchDistance, 3*dcache_line);</span>
<span class="udiff-line-modified-added">+     FLAG_SET_DEFAULT(AllocatePrefetchDistance, MIN2(512, 3*dcache_line));</span>
<span class="udiff-line-added">+ </span>
    if (FLAG_IS_DEFAULT(AllocatePrefetchStepSize))
      FLAG_SET_DEFAULT(AllocatePrefetchStepSize, dcache_line);
    if (FLAG_IS_DEFAULT(PrefetchScanIntervalInBytes))
      FLAG_SET_DEFAULT(PrefetchScanIntervalInBytes, 3*dcache_line);
    if (FLAG_IS_DEFAULT(PrefetchCopyIntervalInBytes))
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -170,13 +167,14 @@</span>
  
    _features = auxv;
  
    int cpu_lines = 0;
    if (FILE *f = fopen(&quot;/proc/cpuinfo&quot;, &quot;r&quot;)) {
<span class="udiff-line-modified-removed">-     char buf[128], *p;</span>
<span class="udiff-line-modified-added">+     // need a large buffer as the flags line may include lots of text</span>
<span class="udiff-line-added">+     char buf[1024], *p;</span>
      while (fgets(buf, sizeof (buf), f) != NULL) {
<span class="udiff-line-modified-removed">-       if (p = strchr(buf, &#39;:&#39;)) {</span>
<span class="udiff-line-modified-added">+       if ((p = strchr(buf, &#39;:&#39;)) != NULL) {</span>
          long v = strtol(p+1, NULL, 0);
          if (strncmp(buf, &quot;CPU implementer&quot;, sizeof &quot;CPU implementer&quot; - 1) == 0) {
            _cpu = v;
            cpu_lines++;
          } else if (strncmp(buf, &quot;CPU variant&quot;, sizeof &quot;CPU variant&quot; - 1) == 0) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -184,16 +182,29 @@</span>
          } else if (strncmp(buf, &quot;CPU part&quot;, sizeof &quot;CPU part&quot; - 1) == 0) {
            if (_model != v)  _model2 = _model;
            _model = v;
          } else if (strncmp(buf, &quot;CPU revision&quot;, sizeof &quot;CPU revision&quot; - 1) == 0) {
            _revision = v;
<span class="udiff-line-added">+         } else if (strncmp(buf, &quot;flags&quot;, sizeof(&quot;flags&quot;) - 1) == 0) {</span>
<span class="udiff-line-added">+           if (strstr(p+1, &quot;dcpop&quot;)) {</span>
<span class="udiff-line-added">+             _dcpop = true;</span>
<span class="udiff-line-added">+           }</span>
          }
        }
      }
      fclose(f);
    }
  
<span class="udiff-line-added">+   if (os::supports_map_sync()) {</span>
<span class="udiff-line-added">+     // if dcpop is available publish data cache line flush size via</span>
<span class="udiff-line-added">+     // generic field, otherwise let if default to zero thereby</span>
<span class="udiff-line-added">+     // disabling writeback</span>
<span class="udiff-line-added">+     if (_dcpop) {</span>
<span class="udiff-line-added">+       _data_cache_line_flush_size = dcache_line;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
    // Enable vendor specific features
  
    // Ampere eMAG
    if (_cpu == CPU_AMCC &amp;&amp; (_model == 0) &amp;&amp; (_variant == 0x3)) {
      if (FLAG_IS_DEFAULT(AvoidUnalignedAccesses)) {
</pre>
<center><a href="templateTable_aarch64.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="vm_version_aarch64.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>