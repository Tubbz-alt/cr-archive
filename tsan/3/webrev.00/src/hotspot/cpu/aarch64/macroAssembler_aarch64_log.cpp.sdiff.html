<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/cpu/aarch64/macroAssembler_aarch64_log.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="macroAssembler_aarch64.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="macroAssembler_aarch64_trig.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/aarch64/macroAssembler_aarch64_log.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
269     lea(rscratch2, ExternalAddress((address)_L_tbl));
270     movz(tmp5, 0x7F);
271     add(tmp1, rscratch1, tmp4);
272     cmp(tmp2, rscratch1);
273     lsr(tmp3, rscratch1, 29);
274     ccmp(tmp1, tmp4, 0b1101 /* LE */, NE);
275     bfm(tmp3, tmp5, 41, 8);
276     fmovs(vtmp5, tmp3);
277     // Load coefficients from table. All coefficients are organized to be
278     // in specific order, because load below will load it in vectors to be used
279     // later in vector instructions. Load will be performed in parallel while
280     // branches are taken. C1 will contain vector of {C1_0, C1_1}, C2 =
281     // {C2_0, C2_1}, C3 = {C3_0, C3_1}, C4 = {C4_0, C4_1}
282     ld1(C1, C2, C3, C4, T2D, post(rscratch2, 64));
283     br(LE, CHECK_CORNER_CASES);
284   bind(CHECKED_CORNER_CASES);
285     // all corner cases are handled
286     frecpe(vtmp5, vtmp5, S);                   // vtmp5 ~= 1/vtmp5
287     lsr(tmp2, rscratch1, 48);
288     movz(tmp4, 0x77f0, 48);
<span class="line-modified">289     fmovd(vtmp4, 1.0d);</span>
290     movz(tmp1, INF_OR_NAN_PREFIX, 48);
291     bfm(tmp4, rscratch1, 0, 51);               // tmp4 = 0x77F0 &lt;&lt; 48 | mantissa(X)
292     // vtmp1 = AS_DOUBLE_BITS(0x77F0 &lt;&lt; 48 | mantissa(X)) == mx
293     fmovd(vtmp1, tmp4);
294     subw(tmp2, tmp2, 16);
295     subs(zr, tmp2, 0x8000);
296     br(GE, SMALL_VALUE);
297   bind(MAIN);
298     fmovs(tmp3, vtmp5);                        // int intB0 = AS_INT_BITS(B);
299     mov(tmp5, 0x3FE0);
300     mov(rscratch1, 0xffffe00000000000);
301     andr(tmp2, tmp2, tmp1, LSR, 48);           // hiWord &amp; 0x7FF0
302     sub(tmp2, tmp2, tmp5);                     // tmp2 = hiWord &amp; 0x7FF0 - 0x3FE0
303     scvtfwd(vtmp5, tmp2);                      // vtmp5 = (double)tmp2;
304     addw(tmp3, tmp3, 0x8000);                  // tmp3 = B
305     andr(tmp4, tmp4, rscratch1);               // tmp4 == hi_part(mx)
306     andr(rscratch1, rscratch1, tmp3, LSL, 29); // rscratch1 = hi_part(B)
307     ubfm(tmp3, tmp3, 16, 23);                  // int index = (intB0 &gt;&gt; 16) &amp;&amp; 0xFF
308     ldrq(vtmp2, Address(rscratch2, tmp3, Address::lsl(4))); // vtmp2 = _L_tbl[index]
309     // AS_LONG_BITS(vtmp1) &amp; 0xffffe00000000000 // hi_part(mx)
</pre>
<hr />
<pre>
341       frecpe(vtmp5, vtmp5, S);
342       shl(vtmp1, T2D, vtmp1, 12);
343       ushr(vtmp1, T2D, vtmp1, 12);
344       b(MAIN);
345   }
346 
347   block_comment(&quot;Corner cases&quot;); {
348     bind(RETURN_MINF_OR_NAN);
349       movz(tmp1, MINF_OR_MNAN_PREFIX, 48);
350       orr(rscratch1, rscratch1, tmp1);
351       fmovd(v0, rscratch1);
352       ret(lr);
353     bind(CHECK_CORNER_CASES);
354       movz(tmp1, INF_OR_NAN_PREFIX, 48);
355       cmp(rscratch1, zr);
356       br(LE, RETURN_MINF_OR_NAN);
357       cmp(rscratch1, tmp1);
358       br(GE, DONE);
359       cmp(rscratch1, tmp2);
360       br(NE, CHECKED_CORNER_CASES);
<span class="line-modified">361       fmovd(v0, 0.0d);</span>
362   }
363   bind(DONE);
364     ret(lr);
365 }
</pre>
</td>
<td>
<hr />
<pre>
269     lea(rscratch2, ExternalAddress((address)_L_tbl));
270     movz(tmp5, 0x7F);
271     add(tmp1, rscratch1, tmp4);
272     cmp(tmp2, rscratch1);
273     lsr(tmp3, rscratch1, 29);
274     ccmp(tmp1, tmp4, 0b1101 /* LE */, NE);
275     bfm(tmp3, tmp5, 41, 8);
276     fmovs(vtmp5, tmp3);
277     // Load coefficients from table. All coefficients are organized to be
278     // in specific order, because load below will load it in vectors to be used
279     // later in vector instructions. Load will be performed in parallel while
280     // branches are taken. C1 will contain vector of {C1_0, C1_1}, C2 =
281     // {C2_0, C2_1}, C3 = {C3_0, C3_1}, C4 = {C4_0, C4_1}
282     ld1(C1, C2, C3, C4, T2D, post(rscratch2, 64));
283     br(LE, CHECK_CORNER_CASES);
284   bind(CHECKED_CORNER_CASES);
285     // all corner cases are handled
286     frecpe(vtmp5, vtmp5, S);                   // vtmp5 ~= 1/vtmp5
287     lsr(tmp2, rscratch1, 48);
288     movz(tmp4, 0x77f0, 48);
<span class="line-modified">289     fmovd(vtmp4, 1.0);</span>
290     movz(tmp1, INF_OR_NAN_PREFIX, 48);
291     bfm(tmp4, rscratch1, 0, 51);               // tmp4 = 0x77F0 &lt;&lt; 48 | mantissa(X)
292     // vtmp1 = AS_DOUBLE_BITS(0x77F0 &lt;&lt; 48 | mantissa(X)) == mx
293     fmovd(vtmp1, tmp4);
294     subw(tmp2, tmp2, 16);
295     subs(zr, tmp2, 0x8000);
296     br(GE, SMALL_VALUE);
297   bind(MAIN);
298     fmovs(tmp3, vtmp5);                        // int intB0 = AS_INT_BITS(B);
299     mov(tmp5, 0x3FE0);
300     mov(rscratch1, 0xffffe00000000000);
301     andr(tmp2, tmp2, tmp1, LSR, 48);           // hiWord &amp; 0x7FF0
302     sub(tmp2, tmp2, tmp5);                     // tmp2 = hiWord &amp; 0x7FF0 - 0x3FE0
303     scvtfwd(vtmp5, tmp2);                      // vtmp5 = (double)tmp2;
304     addw(tmp3, tmp3, 0x8000);                  // tmp3 = B
305     andr(tmp4, tmp4, rscratch1);               // tmp4 == hi_part(mx)
306     andr(rscratch1, rscratch1, tmp3, LSL, 29); // rscratch1 = hi_part(B)
307     ubfm(tmp3, tmp3, 16, 23);                  // int index = (intB0 &gt;&gt; 16) &amp;&amp; 0xFF
308     ldrq(vtmp2, Address(rscratch2, tmp3, Address::lsl(4))); // vtmp2 = _L_tbl[index]
309     // AS_LONG_BITS(vtmp1) &amp; 0xffffe00000000000 // hi_part(mx)
</pre>
<hr />
<pre>
341       frecpe(vtmp5, vtmp5, S);
342       shl(vtmp1, T2D, vtmp1, 12);
343       ushr(vtmp1, T2D, vtmp1, 12);
344       b(MAIN);
345   }
346 
347   block_comment(&quot;Corner cases&quot;); {
348     bind(RETURN_MINF_OR_NAN);
349       movz(tmp1, MINF_OR_MNAN_PREFIX, 48);
350       orr(rscratch1, rscratch1, tmp1);
351       fmovd(v0, rscratch1);
352       ret(lr);
353     bind(CHECK_CORNER_CASES);
354       movz(tmp1, INF_OR_NAN_PREFIX, 48);
355       cmp(rscratch1, zr);
356       br(LE, RETURN_MINF_OR_NAN);
357       cmp(rscratch1, tmp1);
358       br(GE, DONE);
359       cmp(rscratch1, tmp2);
360       br(NE, CHECKED_CORNER_CASES);
<span class="line-modified">361       fmovd(v0, 0.0);</span>
362   }
363   bind(DONE);
364     ret(lr);
365 }
</pre>
</td>
</tr>
</table>
<center><a href="macroAssembler_aarch64.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="macroAssembler_aarch64_trig.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>