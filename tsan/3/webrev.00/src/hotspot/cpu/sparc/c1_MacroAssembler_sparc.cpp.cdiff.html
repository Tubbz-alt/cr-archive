<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/cpu/sparc/c1_MacroAssembler_sparc.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="c1_LIRGenerator_sparc.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="c1_Runtime1_sparc.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/sparc/c1_MacroAssembler_sparc.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 28,11 ***</span>
  #include &quot;c1/c1_Runtime1.hpp&quot;
  #include &quot;classfile/systemDictionary.hpp&quot;
  #include &quot;gc/shared/collectedHeap.hpp&quot;
  #include &quot;interpreter/interpreter.hpp&quot;
  #include &quot;oops/arrayOop.hpp&quot;
<span class="line-modified">! #include &quot;oops/markOop.hpp&quot;</span>
  #include &quot;runtime/basicLock.hpp&quot;
  #include &quot;runtime/biasedLocking.hpp&quot;
  #include &quot;runtime/os.hpp&quot;
  #include &quot;runtime/sharedRuntime.hpp&quot;
  #include &quot;runtime/stubRoutines.hpp&quot;
<span class="line-new-header">--- 28,11 ---</span>
  #include &quot;c1/c1_Runtime1.hpp&quot;
  #include &quot;classfile/systemDictionary.hpp&quot;
  #include &quot;gc/shared/collectedHeap.hpp&quot;
  #include &quot;interpreter/interpreter.hpp&quot;
  #include &quot;oops/arrayOop.hpp&quot;
<span class="line-modified">! #include &quot;oops/markWord.hpp&quot;</span>
  #include &quot;runtime/basicLock.hpp&quot;
  #include &quot;runtime/biasedLocking.hpp&quot;
  #include &quot;runtime/os.hpp&quot;
  #include &quot;runtime/sharedRuntime.hpp&quot;
  #include &quot;runtime/stubRoutines.hpp&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 64,13 ***</span>
    save_frame_c1(frame_size_in_bytes);
  }
  
  
  void C1_MacroAssembler::verified_entry() {
<span class="line-modified">!   if (C1Breakpoint) breakpoint_trap();</span>
<span class="line-modified">!   // build frame</span>
<span class="line-modified">!   verify_FPU(0, &quot;method_entry&quot;);</span>
  }
  
  
  void C1_MacroAssembler::lock_object(Register Rmark, Register Roop, Register Rbox, Register Rscratch, Label&amp; slow_case) {
    assert_different_registers(Rmark, Roop, Rbox, Rscratch);
<span class="line-new-header">--- 64,13 ---</span>
    save_frame_c1(frame_size_in_bytes);
  }
  
  
  void C1_MacroAssembler::verified_entry() {
<span class="line-modified">!   if (C1Breakpoint) {</span>
<span class="line-modified">!     breakpoint_trap();</span>
<span class="line-modified">!   }</span>
  }
  
  
  void C1_MacroAssembler::lock_object(Register Rmark, Register Roop, Register Rbox, Register Rscratch, Label&amp; slow_case) {
    assert_different_registers(Rmark, Roop, Rbox, Rscratch);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 95,16 ***</span>
  
    // Save Rbox in Rscratch to be used for the cas operation
    mov(Rbox, Rscratch);
  
    // and mark it unlocked
<span class="line-modified">!   or3(Rmark, markOopDesc::unlocked_value, Rmark);</span>
  
    // save unlocked object header into the displaced header location on the stack
    st_ptr(Rmark, Rbox, BasicLock::displaced_header_offset_in_bytes());
  
<span class="line-modified">!   // compare object markOop with Rmark and if equal exchange Rscratch with object markOop</span>
    assert(mark_addr.disp() == 0, &quot;cas must take a zero displacement&quot;);
    cas_ptr(mark_addr.base(), Rmark, Rscratch);
    // if compare/exchange succeeded we found an unlocked object and we now have locked it
    // hence we are done
    cmp(Rmark, Rscratch);
<span class="line-new-header">--- 95,16 ---</span>
  
    // Save Rbox in Rscratch to be used for the cas operation
    mov(Rbox, Rscratch);
  
    // and mark it unlocked
<span class="line-modified">!   or3(Rmark, markWord::unlocked_value, Rmark);</span>
  
    // save unlocked object header into the displaced header location on the stack
    st_ptr(Rmark, Rbox, BasicLock::displaced_header_offset_in_bytes());
  
<span class="line-modified">!   // compare object markWord with Rmark and if equal exchange Rscratch with object markWord</span>
    assert(mark_addr.disp() == 0, &quot;cas must take a zero displacement&quot;);
    cas_ptr(mark_addr.base(), Rmark, Rscratch);
    // if compare/exchange succeeded we found an unlocked object and we now have locked it
    // hence we are done
    cmp(Rmark, Rscratch);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 142,11 ***</span>
      ld_ptr(Rbox, BasicObjectLock::obj_offset_in_bytes(), Roop);
      verify_oop(Roop);
    }
  
    // Check if it is still a light weight lock, this is is true if we see
<span class="line-modified">!   // the stack address of the basicLock in the markOop of the object</span>
    cas_ptr(mark_addr.base(), Rbox, Rmark);
    cmp(Rbox, Rmark);
  
    brx(Assembler::notEqual, false, Assembler::pn, slow_case);
    delayed()-&gt;nop();
<span class="line-new-header">--- 142,11 ---</span>
      ld_ptr(Rbox, BasicObjectLock::obj_offset_in_bytes(), Roop);
      verify_oop(Roop);
    }
  
    // Check if it is still a light weight lock, this is is true if we see
<span class="line-modified">!   // the stack address of the basicLock in the markWord of the object</span>
    cas_ptr(mark_addr.base(), Rbox, Rmark);
    cmp(Rbox, Rmark);
  
    brx(Assembler::notEqual, false, Assembler::pn, slow_case);
    delayed()-&gt;nop();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 177,11 ***</span>
  void C1_MacroAssembler::initialize_header(Register obj, Register klass, Register len, Register t1, Register t2) {
    assert_different_registers(obj, klass, len, t1, t2);
    if (UseBiasedLocking &amp;&amp; !len-&gt;is_valid()) {
      ld_ptr(klass, in_bytes(Klass::prototype_header_offset()), t1);
    } else {
<span class="line-modified">!     set((intx)markOopDesc::prototype(), t1);</span>
    }
    st_ptr(t1, obj, oopDesc::mark_offset_in_bytes());
    if (UseCompressedClassPointers) {
      // Save klass
      mov(klass, t1);
<span class="line-new-header">--- 177,11 ---</span>
  void C1_MacroAssembler::initialize_header(Register obj, Register klass, Register len, Register t1, Register t2) {
    assert_different_registers(obj, klass, len, t1, t2);
    if (UseBiasedLocking &amp;&amp; !len-&gt;is_valid()) {
      ld_ptr(klass, in_bytes(Klass::prototype_header_offset()), t1);
    } else {
<span class="line-modified">!     set((intx)markWord::prototype().value(), t1);</span>
    }
    st_ptr(t1, obj, oopDesc::mark_offset_in_bytes());
    if (UseCompressedClassPointers) {
      // Save klass
      mov(klass, t1);
</pre>
<center><a href="c1_LIRGenerator_sparc.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="c1_Runtime1_sparc.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>