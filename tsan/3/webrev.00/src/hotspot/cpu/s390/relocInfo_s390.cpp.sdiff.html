<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/cpu/s390/relocInfo_s390.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="register_s390.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="relocInfo_s390.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/s390/relocInfo_s390.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
147     if (toc_offset&gt;=0) {
148       NativeFarCall* call = nativeFarCall_at(inst_addr);
149       call-&gt;set_destination(x, toc_offset);
150       return;
151     }
152   }
153 
154   if (NativeCall::is_call_at(inst_addr)) {
155     NativeCall* call = nativeCall_at(inst_addr);
156     if (call-&gt;is_pcrelative()) {
157       call-&gt;set_destination_mt_safe(x);
158       return;
159     }
160   }
161 
162   // constant is absolute, must use x
163   nativeMovConstReg_at(inst_addr)-&gt;set_data(((intptr_t)x));
164 }
165 
166 
<span class="line-removed">167 // store the new target address into an oop_Relocation cell, if any</span>
<span class="line-removed">168 // return indication if update happened.</span>
<span class="line-removed">169 bool relocInfo::update_oop_pool(address begin, address end, address newTarget, CodeBlob* cb) {</span>
<span class="line-removed">170 </span>
<span class="line-removed">171   //  Try to find the CodeBlob, if not given by caller</span>
<span class="line-removed">172   if (cb == NULL) cb = CodeCache::find_blob(begin);</span>
<span class="line-removed">173 #ifdef ASSERT</span>
<span class="line-removed">174   else</span>
<span class="line-removed">175     assert(cb == CodeCache::find_blob(begin), &quot;consistency&quot;);</span>
<span class="line-removed">176 #endif</span>
<span class="line-removed">177 </span>
<span class="line-removed">178   //  &#39;RelocIterator&#39; requires an nmethod</span>
<span class="line-removed">179   nmethod*  nm = cb ? cb-&gt;as_nmethod_or_null() : NULL;</span>
<span class="line-removed">180   if (nm != NULL) {</span>
<span class="line-removed">181     RelocIterator iter(nm, begin, end);</span>
<span class="line-removed">182     oop* oop_addr = NULL;</span>
<span class="line-removed">183     Metadata** metadata_addr = NULL;</span>
<span class="line-removed">184     while (iter.next()) {</span>
<span class="line-removed">185       if (iter.type() == relocInfo::oop_type) {</span>
<span class="line-removed">186         oop_Relocation *r = iter.oop_reloc();</span>
<span class="line-removed">187         if (oop_addr == NULL) {</span>
<span class="line-removed">188           oop_addr = r-&gt;oop_addr();</span>
<span class="line-removed">189           *oop_addr = (oop)newTarget;</span>
<span class="line-removed">190         } else {</span>
<span class="line-removed">191           assert(oop_addr == r-&gt;oop_addr(), &quot;must be only one set-oop here&quot;);</span>
<span class="line-removed">192         }</span>
<span class="line-removed">193       }</span>
<span class="line-removed">194       if (iter.type() == relocInfo::metadata_type) {</span>
<span class="line-removed">195         metadata_Relocation *r = iter.metadata_reloc();</span>
<span class="line-removed">196         if (metadata_addr == NULL) {</span>
<span class="line-removed">197           metadata_addr = r-&gt;metadata_addr();</span>
<span class="line-removed">198           *metadata_addr = (Metadata*)newTarget;</span>
<span class="line-removed">199         } else {</span>
<span class="line-removed">200           assert(metadata_addr == r-&gt;metadata_addr(), &quot;must be only one set-metadata here&quot;);</span>
<span class="line-removed">201         }</span>
<span class="line-removed">202       }</span>
<span class="line-removed">203     }</span>
<span class="line-removed">204     return oop_addr || metadata_addr;</span>
<span class="line-removed">205   }</span>
<span class="line-removed">206   return false;</span>
<span class="line-removed">207 }</span>
<span class="line-removed">208 </span>
<span class="line-removed">209 </span>
210 address* Relocation::pd_address_in_code() {
211  ShouldNotReachHere();
212  return 0;
213 }
214 
215 address Relocation::pd_get_address_from_code() {
216    return  (address) (nativeMovConstReg_at(addr())-&gt;data());
217 }
218 
219 void poll_Relocation::fix_relocation_after_move(const CodeBuffer* src, CodeBuffer* dest) {
220 }
221 
222 void metadata_Relocation::pd_fix_value(address x) {
223 }
</pre>
</td>
<td>
<hr />
<pre>
147     if (toc_offset&gt;=0) {
148       NativeFarCall* call = nativeFarCall_at(inst_addr);
149       call-&gt;set_destination(x, toc_offset);
150       return;
151     }
152   }
153 
154   if (NativeCall::is_call_at(inst_addr)) {
155     NativeCall* call = nativeCall_at(inst_addr);
156     if (call-&gt;is_pcrelative()) {
157       call-&gt;set_destination_mt_safe(x);
158       return;
159     }
160   }
161 
162   // constant is absolute, must use x
163   nativeMovConstReg_at(inst_addr)-&gt;set_data(((intptr_t)x));
164 }
165 
166 











































167 address* Relocation::pd_address_in_code() {
168  ShouldNotReachHere();
169  return 0;
170 }
171 
172 address Relocation::pd_get_address_from_code() {
173    return  (address) (nativeMovConstReg_at(addr())-&gt;data());
174 }
175 
176 void poll_Relocation::fix_relocation_after_move(const CodeBuffer* src, CodeBuffer* dest) {
177 }
178 
179 void metadata_Relocation::pd_fix_value(address x) {
180 }
</pre>
</td>
</tr>
</table>
<center><a href="register_s390.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="relocInfo_s390.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>