<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/cpu/x86/nativeInst_x86.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="methodHandles_x86.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="nativeInst_x86.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/x86/nativeInst_x86.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 353,85 ***</span>
    }
  
    return off;
  }
  
<span class="line-modified">! address NativeMovRegMem::instruction_address() const {</span>
<span class="line-removed">-   return addr_at(instruction_start());</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- address NativeMovRegMem::next_instruction_address() const {</span>
<span class="line-removed">-   address ret = instruction_address() + instruction_size;</span>
<span class="line-removed">-   u_char instr_0 =  *(u_char*) instruction_address();</span>
<span class="line-removed">-   switch (instr_0) {</span>
<span class="line-removed">-   case instruction_operandsize_prefix:</span>
<span class="line-removed">- </span>
<span class="line-removed">-     fatal(&quot;should have skipped instruction_operandsize_prefix&quot;);</span>
<span class="line-removed">-     break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-   case instruction_extended_prefix:</span>
<span class="line-removed">-     fatal(&quot;should have skipped instruction_extended_prefix&quot;);</span>
<span class="line-removed">-     break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-   case instruction_code_mem2reg_movslq: // 0x63</span>
<span class="line-removed">-   case instruction_code_mem2reg_movzxb: // 0xB6</span>
<span class="line-removed">-   case instruction_code_mem2reg_movsxb: // 0xBE</span>
<span class="line-removed">-   case instruction_code_mem2reg_movzxw: // 0xB7</span>
<span class="line-removed">-   case instruction_code_mem2reg_movsxw: // 0xBF</span>
<span class="line-removed">-   case instruction_code_reg2mem:        // 0x89 (q/l)</span>
<span class="line-removed">-   case instruction_code_mem2reg:        // 0x8B (q/l)</span>
<span class="line-removed">-   case instruction_code_reg2memb:       // 0x88</span>
<span class="line-removed">-   case instruction_code_mem2regb:       // 0x8a</span>
<span class="line-removed">- </span>
<span class="line-removed">-   case instruction_code_lea:            // 0x8d</span>
<span class="line-removed">- </span>
<span class="line-removed">-   case instruction_code_float_s:        // 0xd9 fld_s a</span>
<span class="line-removed">-   case instruction_code_float_d:        // 0xdd fld_d a</span>
<span class="line-removed">- </span>
<span class="line-removed">-   case instruction_code_xmm_load:       // 0x10</span>
<span class="line-removed">-   case instruction_code_xmm_store:      // 0x11</span>
<span class="line-removed">-   case instruction_code_xmm_lpd:        // 0x12</span>
<span class="line-removed">-     {</span>
<span class="line-removed">-       // If there is an SIB then instruction is longer than expected</span>
<span class="line-removed">-       u_char mod_rm = *(u_char*)(instruction_address() + 1);</span>
<span class="line-removed">-       if ((mod_rm &amp; 7) == 0x4) {</span>
<span class="line-removed">-         ret++;</span>
<span class="line-removed">-       }</span>
<span class="line-removed">-     }</span>
<span class="line-removed">-   case instruction_code_xor:</span>
<span class="line-removed">-     fatal(&quot;should have skipped xor lead in&quot;);</span>
<span class="line-removed">-     break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-   default:</span>
<span class="line-removed">-     fatal(&quot;not a NativeMovRegMem&quot;);</span>
<span class="line-removed">-   }</span>
<span class="line-removed">-   return ret;</span>
<span class="line-removed">- </span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- int NativeMovRegMem::offset() const{</span>
    int off = data_offset + instruction_start();
    u_char mod_rm = *(u_char*)(instruction_address() + 1);
    // nnnn(r12|rsp) isn&#39;t coded as simple mod/rm since that is
    // the encoding to use an SIB byte. Which will have the nnnn
    // field off by one byte
    if ((mod_rm &amp; 7) == 0x4) {
      off++;
    }
<span class="line-modified">!   return int_at(off);</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- void NativeMovRegMem::set_offset(int x) {</span>
<span class="line-removed">-   int off = data_offset + instruction_start();</span>
<span class="line-removed">-   u_char mod_rm = *(u_char*)(instruction_address() + 1);</span>
<span class="line-removed">-   // nnnn(r12|rsp) isn&#39;t coded as simple mod/rm since that is</span>
<span class="line-removed">-   // the encoding to use an SIB byte. Which will have the nnnn</span>
<span class="line-removed">-   // field off by one byte</span>
<span class="line-removed">-   if ((mod_rm &amp; 7) == 0x4) {</span>
<span class="line-removed">-     off++;</span>
<span class="line-removed">-   }</span>
<span class="line-removed">-   set_int_at(off, x);</span>
  }
  
  void NativeMovRegMem::verify() {
    // make sure code pattern is actually a mov [reg+offset], reg instruction
    u_char test_byte = *(u_char*)instruction_address();
<span class="line-new-header">--- 353,20 ---</span>
    }
  
    return off;
  }
  
<span class="line-modified">! int NativeMovRegMem::patch_offset() const {</span>
    int off = data_offset + instruction_start();
    u_char mod_rm = *(u_char*)(instruction_address() + 1);
    // nnnn(r12|rsp) isn&#39;t coded as simple mod/rm since that is
    // the encoding to use an SIB byte. Which will have the nnnn
    // field off by one byte
    if ((mod_rm &amp; 7) == 0x4) {
      off++;
    }
<span class="line-modified">!   return off;</span>
  }
  
  void NativeMovRegMem::verify() {
    // make sure code pattern is actually a mov [reg+offset], reg instruction
    u_char test_byte = *(u_char*)instruction_address();
</pre>
<center><a href="methodHandles_x86.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="nativeInst_x86.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>