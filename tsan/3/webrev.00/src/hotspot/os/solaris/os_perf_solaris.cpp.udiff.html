<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/os/solaris/os_perf_solaris.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="globals_solaris.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="os_solaris.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/os/solaris/os_perf_solaris.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -26,10 +26,11 @@</span>
  #include &quot;jvm.h&quot;
  #include &quot;memory/allocation.inline.hpp&quot;
  #include &quot;runtime/os.hpp&quot;
  #include &quot;runtime/os_perf.hpp&quot;
  #include &quot;os_solaris.inline.hpp&quot;
<span class="udiff-line-added">+ #include &quot;utilities/globalDefinitions.hpp&quot;</span>
  #include &quot;utilities/macros.hpp&quot;
  
  #include CPU_HEADER(vm_version_ext)
  
  #include &lt;sys/types.h&gt;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -298,16 +299,13 @@</span>
    if (_counters.nProcs == 0) {
      return false;
    }
  
    // Data structure(s) for saving CPU load (one per CPU)
<span class="udiff-line-modified-removed">-   size_t tick_array_size = _counters.nProcs * sizeof(CPUPerfTicks);</span>
<span class="udiff-line-modified-removed">-   _counters.jvmTicks = (CPUPerfTicks*)NEW_C_HEAP_ARRAY(char, tick_array_size, mtInternal);</span>
<span class="udiff-line-modified-removed">-   if (NULL == _counters.jvmTicks) {</span>
<span class="udiff-line-removed">-     return false;</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">-   memset(_counters.jvmTicks, 0, tick_array_size);</span>
<span class="udiff-line-modified-added">+   size_t array_entry_count = _counters.nProcs;</span>
<span class="udiff-line-modified-added">+   _counters.jvmTicks = NEW_C_HEAP_ARRAY(CPUPerfTicks, array_entry_count, mtInternal);</span>
<span class="udiff-line-modified-added">+   memset(_counters.jvmTicks, 0, array_entry_count * sizeof(*_counters.jvmTicks));</span>
  
    // Get kstat cpu_stat counters for every CPU
    // loop over kstat to find our cpu_stat(s)
    int i = 0;
    for (kstat_t* kstat = _counters.kstat_ctrl-&gt;kc_chain; kstat != NULL; kstat = kstat-&gt;ks_next) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -324,13 +322,11 @@</span>
    }
    return true;
  }
  
  CPUPerformanceInterface::CPUPerformance::~CPUPerformance() {
<span class="udiff-line-modified-removed">-   if (_counters.jvmTicks != NULL) {</span>
<span class="udiff-line-removed">-     FREE_C_HEAP_ARRAY(char, _counters.jvmTicks);</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-modified-added">+   FREE_C_HEAP_ARRAY(char, _counters.jvmTicks);</span>
    if (_counters.kstat_ctrl != NULL) {
      kstat_close(_counters.kstat_ctrl);
    }
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -432,11 +428,11 @@</span>
    _impl = NULL;
  }
  
  bool CPUPerformanceInterface::initialize() {
    _impl = new CPUPerformanceInterface::CPUPerformance();
<span class="udiff-line-modified-removed">-   return _impl != NULL &amp;&amp; _impl-&gt;initialize();</span>
<span class="udiff-line-modified-added">+   return _impl-&gt;initialize();</span>
  }
  
  CPUPerformanceInterface::~CPUPerformanceInterface(void) {
    if (_impl != NULL) {
      delete _impl;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -574,14 +570,12 @@</span>
        (psinfo_data.pr_psargs != NULL)) {
      char *path_substring = strstr(psinfo_data.pr_psargs, psinfo_data.pr_fname);
      if (path_substring != NULL) {
        int len = path_substring - psinfo_data.pr_psargs;
        exe_path = NEW_C_HEAP_ARRAY(char, len+1, mtInternal);
<span class="udiff-line-modified-removed">-       if (exe_path != NULL) {</span>
<span class="udiff-line-modified-removed">-         jio_snprintf(exe_path, len, &quot;%s&quot;, psinfo_data.pr_psargs);</span>
<span class="udiff-line-removed">-         exe_path[len] = &#39;\0&#39;;</span>
<span class="udiff-line-removed">-       }</span>
<span class="udiff-line-modified-added">+       jio_snprintf(exe_path, len, &quot;%s&quot;, psinfo_data.pr_psargs);</span>
<span class="udiff-line-modified-added">+       exe_path[len] = &#39;\0&#39;;</span>
      }
    }
  
    process_info-&gt;set_pid(atoi(_entry-&gt;d_name));
    process_info-&gt;set_name(allocate_string(psinfo_data.pr_fname));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -642,11 +636,11 @@</span>
    _iterator = NULL;
  }
  
  bool SystemProcessInterface::SystemProcesses::initialize() {
    _iterator = new SystemProcessInterface::SystemProcesses::ProcessIterator();
<span class="udiff-line-modified-removed">-   return _iterator != NULL &amp;&amp; _iterator-&gt;initialize();</span>
<span class="udiff-line-modified-added">+   return _iterator-&gt;initialize();</span>
  }
  
  SystemProcessInterface::SystemProcesses::~SystemProcesses() {
    if (_iterator != NULL) {
      delete _iterator;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -689,11 +683,11 @@</span>
    _impl = NULL;
  }
  
  bool SystemProcessInterface::initialize() {
    _impl = new SystemProcessInterface::SystemProcesses();
<span class="udiff-line-modified-removed">-   return _impl != NULL &amp;&amp; _impl-&gt;initialize();</span>
<span class="udiff-line-modified-added">+   return _impl-&gt;initialize();</span>
  
  }
  
  SystemProcessInterface::~SystemProcessInterface() {
    if (_impl != NULL) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -705,13 +699,10 @@</span>
    _cpu_info = NULL;
  }
  
  bool CPUInformationInterface::initialize() {
    _cpu_info = new CPUInformation();
<span class="udiff-line-removed">-   if (_cpu_info == NULL) {</span>
<span class="udiff-line-removed">-     return false;</span>
<span class="udiff-line-removed">-   }</span>
    _cpu_info-&gt;set_number_of_hardware_threads(VM_Version_Ext::number_of_threads());
    _cpu_info-&gt;set_number_of_cores(VM_Version_Ext::number_of_cores());
    _cpu_info-&gt;set_number_of_sockets(VM_Version_Ext::number_of_sockets());
    _cpu_info-&gt;set_cpu_name(VM_Version_Ext::cpu_name());
    _cpu_info-&gt;set_cpu_description(VM_Version_Ext::cpu_description());
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -745,12 +736,11 @@</span>
  
  class NetworkPerformanceInterface::NetworkPerformance : public CHeapObj&lt;mtInternal&gt; {
    friend class NetworkPerformanceInterface;
   private:
    NetworkPerformance();
<span class="udiff-line-modified-removed">-   NetworkPerformance(const NetworkPerformance&amp; rhs); // no impl</span>
<span class="udiff-line-removed">-   NetworkPerformance&amp; operator=(const NetworkPerformance&amp; rhs); // no impl</span>
<span class="udiff-line-modified-added">+   NONCOPYABLE(NetworkPerformance);</span>
    bool initialize();
    ~NetworkPerformance();
    int network_utilization(NetworkInterface** network_interfaces) const;
  };
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -820,11 +810,11 @@</span>
    }
  }
  
  bool NetworkPerformanceInterface::initialize() {
    _impl = new NetworkPerformanceInterface::NetworkPerformance();
<span class="udiff-line-modified-removed">-   return _impl != NULL &amp;&amp; _impl-&gt;initialize();</span>
<span class="udiff-line-modified-added">+   return _impl-&gt;initialize();</span>
  }
  
  int NetworkPerformanceInterface::network_utilization(NetworkInterface** network_interfaces) const {
    return _impl-&gt;network_utilization(network_interfaces);
  }
</pre>
<center><a href="globals_solaris.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="os_solaris.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>