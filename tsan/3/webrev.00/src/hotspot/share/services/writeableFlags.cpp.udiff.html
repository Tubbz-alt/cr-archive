<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/services/writeableFlags.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="virtualMemoryTracker.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../tsan/tsan.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/services/writeableFlags.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -36,12 +36,12 @@</span>
  
  static void buffer_concat(char* buffer, const char* src) {
    strncat(buffer, src, TEMP_BUF_SIZE - 1 - strlen(buffer));
  }
  
<span class="udiff-line-modified-removed">- static void print_flag_error_message_bounds(const char* name, char* buffer) {</span>
<span class="udiff-line-modified-removed">-   JVMFlagRange* range = JVMFlagRangeList::find(name);</span>
<span class="udiff-line-modified-added">+ static void print_flag_error_message_bounds(const JVMFlag* flag, char* buffer) {</span>
<span class="udiff-line-modified-added">+   JVMFlagRange* range = JVMFlagRangeList::find(flag);</span>
    if (range != NULL) {
      buffer_concat(buffer, &quot;must have value in range &quot;);
  
      stringStream stream;
      range-&gt;print(&amp;stream);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -57,15 +57,16 @@</span>
      }
      buffer[j] = &#39;\0&#39;;
    }
  }
  
<span class="udiff-line-modified-removed">- static void print_flag_error_message_if_needed(JVMFlag::Error error, const char* name, FormatBuffer&lt;80&gt;&amp; err_msg) {</span>
<span class="udiff-line-modified-added">+ static void print_flag_error_message_if_needed(JVMFlag::Error error, const JVMFlag* flag, FormatBuffer&lt;80&gt;&amp; err_msg) {</span>
    if (error == JVMFlag::SUCCESS) {
      return;
    }
  
<span class="udiff-line-added">+   const char* name = flag-&gt;_name;</span>
    char buffer[TEMP_BUF_SIZE] = {&#39;\0&#39;};
    if ((error != JVMFlag::MISSING_NAME) &amp;&amp; (name != NULL)) {
      buffer_concat(buffer, name);
      buffer_concat(buffer, &quot; error: &quot;);
    } else {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -77,11 +78,11 @@</span>
      case JVMFlag::MISSING_VALUE:
        buffer_concat(buffer, &quot;parsing the textual form of the value.&quot;); break;
      case JVMFlag::NON_WRITABLE:
        buffer_concat(buffer, &quot;flag is not writeable.&quot;); break;
      case JVMFlag::OUT_OF_BOUNDS:
<span class="udiff-line-modified-removed">-       if (name != NULL) { print_flag_error_message_bounds(name, buffer); } break;</span>
<span class="udiff-line-modified-added">+       if (name != NULL) { print_flag_error_message_bounds(flag, buffer); } break;</span>
      case JVMFlag::VIOLATES_CONSTRAINT:
        buffer_concat(buffer, &quot;value violates its flag&#39;s constraint.&quot;); break;
      case JVMFlag::INVALID_FLAG:
        buffer_concat(buffer, &quot;there is no flag with the given name.&quot;); break;
      case JVMFlag::ERR_OTHER:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -105,12 +106,13 @@</span>
    err_msg.print(&quot;flag value must be a boolean (1/0 or true/false)&quot;);
    return JVMFlag::WRONG_FORMAT;
  }
  
  JVMFlag::Error WriteableFlags::set_bool_flag(const char* name, bool value, JVMFlag::Flags origin, FormatBuffer&lt;80&gt;&amp; err_msg) {
<span class="udiff-line-modified-removed">-   JVMFlag::Error err = JVMFlag::boolAtPut(name, &amp;value, origin);</span>
<span class="udiff-line-modified-removed">-   print_flag_error_message_if_needed(err, name, err_msg);</span>
<span class="udiff-line-modified-added">+   JVMFlag* flag = JVMFlag::find_flag(name);</span>
<span class="udiff-line-modified-added">+   JVMFlag::Error err = JVMFlag::boolAtPut(flag, &amp;value, origin);</span>
<span class="udiff-line-added">+   print_flag_error_message_if_needed(err, flag, err_msg);</span>
    return err;
  }
  
  // set a int global flag
  JVMFlag::Error WriteableFlags::set_int_flag(const char* name, const char* arg, JVMFlag::Flags origin, FormatBuffer&lt;80&gt;&amp; err_msg) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -122,12 +124,13 @@</span>
    err_msg.print(&quot;flag value must be an integer&quot;);
    return JVMFlag::WRONG_FORMAT;
  }
  
  JVMFlag::Error WriteableFlags::set_int_flag(const char* name, int value, JVMFlag::Flags origin, FormatBuffer&lt;80&gt;&amp; err_msg) {
<span class="udiff-line-modified-removed">-   JVMFlag::Error err = JVMFlag::intAtPut(name, &amp;value, origin);</span>
<span class="udiff-line-modified-removed">-   print_flag_error_message_if_needed(err, name, err_msg);</span>
<span class="udiff-line-modified-added">+   JVMFlag* flag = JVMFlag::find_flag(name);</span>
<span class="udiff-line-modified-added">+   JVMFlag::Error err = JVMFlag::intAtPut(flag, &amp;value, origin);</span>
<span class="udiff-line-added">+   print_flag_error_message_if_needed(err, flag, err_msg);</span>
    return err;
  }
  
  // set a uint global flag
  JVMFlag::Error WriteableFlags::set_uint_flag(const char* name, const char* arg, JVMFlag::Flags origin, FormatBuffer&lt;80&gt;&amp; err_msg) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -139,12 +142,13 @@</span>
    err_msg.print(&quot;flag value must be an unsigned integer&quot;);
    return JVMFlag::WRONG_FORMAT;
  }
  
  JVMFlag::Error WriteableFlags::set_uint_flag(const char* name, uint value, JVMFlag::Flags origin, FormatBuffer&lt;80&gt;&amp; err_msg) {
<span class="udiff-line-modified-removed">-   JVMFlag::Error err = JVMFlag::uintAtPut(name, &amp;value, origin);</span>
<span class="udiff-line-modified-removed">-   print_flag_error_message_if_needed(err, name, err_msg);</span>
<span class="udiff-line-modified-added">+   JVMFlag* flag = JVMFlag::find_flag(name);</span>
<span class="udiff-line-modified-added">+   JVMFlag::Error err = JVMFlag::uintAtPut(flag, &amp;value, origin);</span>
<span class="udiff-line-added">+   print_flag_error_message_if_needed(err, flag, err_msg);</span>
    return err;
  }
  
  // set a intx global flag
  JVMFlag::Error WriteableFlags::set_intx_flag(const char* name, const char* arg, JVMFlag::Flags origin, FormatBuffer&lt;80&gt;&amp; err_msg) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -156,12 +160,13 @@</span>
    err_msg.print(&quot;flag value must be an integer&quot;);
    return JVMFlag::WRONG_FORMAT;
  }
  
  JVMFlag::Error WriteableFlags::set_intx_flag(const char* name, intx value, JVMFlag::Flags origin, FormatBuffer&lt;80&gt;&amp; err_msg) {
<span class="udiff-line-modified-removed">-   JVMFlag::Error err = JVMFlag::intxAtPut(name, &amp;value, origin);</span>
<span class="udiff-line-modified-removed">-   print_flag_error_message_if_needed(err, name, err_msg);</span>
<span class="udiff-line-modified-added">+   JVMFlag* flag = JVMFlag::find_flag(name);</span>
<span class="udiff-line-modified-added">+   JVMFlag::Error err = JVMFlag::intxAtPut(flag, &amp;value, origin);</span>
<span class="udiff-line-added">+   print_flag_error_message_if_needed(err, flag, err_msg);</span>
    return err;
  }
  
  // set a uintx global flag
  JVMFlag::Error WriteableFlags::set_uintx_flag(const char* name, const char* arg, JVMFlag::Flags origin, FormatBuffer&lt;80&gt;&amp; err_msg) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -173,12 +178,13 @@</span>
    err_msg.print(&quot;flag value must be an unsigned integer&quot;);
    return JVMFlag::WRONG_FORMAT;
  }
  
  JVMFlag::Error WriteableFlags::set_uintx_flag(const char* name, uintx value, JVMFlag::Flags origin, FormatBuffer&lt;80&gt;&amp; err_msg) {
<span class="udiff-line-modified-removed">-   JVMFlag::Error err = JVMFlag::uintxAtPut(name, &amp;value, origin);</span>
<span class="udiff-line-modified-removed">-   print_flag_error_message_if_needed(err, name, err_msg);</span>
<span class="udiff-line-modified-added">+   JVMFlag* flag = JVMFlag::find_flag(name);</span>
<span class="udiff-line-modified-added">+   JVMFlag::Error err = JVMFlag::uintxAtPut(flag, &amp;value, origin);</span>
<span class="udiff-line-added">+   print_flag_error_message_if_needed(err, flag, err_msg);</span>
    return err;
  }
  
  // set a uint64_t global flag
  JVMFlag::Error WriteableFlags::set_uint64_t_flag(const char* name, const char* arg, JVMFlag::Flags origin, FormatBuffer&lt;80&gt;&amp; err_msg) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -190,12 +196,13 @@</span>
    err_msg.print(&quot;flag value must be an unsigned 64-bit integer&quot;);
    return JVMFlag::WRONG_FORMAT;
  }
  
  JVMFlag::Error WriteableFlags::set_uint64_t_flag(const char* name, uint64_t value, JVMFlag::Flags origin, FormatBuffer&lt;80&gt;&amp; err_msg) {
<span class="udiff-line-modified-removed">-   JVMFlag::Error err = JVMFlag::uint64_tAtPut(name, &amp;value, origin);</span>
<span class="udiff-line-modified-removed">-   print_flag_error_message_if_needed(err, name, err_msg);</span>
<span class="udiff-line-modified-added">+   JVMFlag* flag = JVMFlag::find_flag(name);</span>
<span class="udiff-line-modified-added">+   JVMFlag::Error err = JVMFlag::uint64_tAtPut(flag, &amp;value, origin);</span>
<span class="udiff-line-added">+   print_flag_error_message_if_needed(err, flag, err_msg);</span>
    return err;
  }
  
  // set a size_t global flag
  JVMFlag::Error WriteableFlags::set_size_t_flag(const char* name, const char* arg, JVMFlag::Flags origin, FormatBuffer&lt;80&gt;&amp; err_msg) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -207,12 +214,13 @@</span>
    err_msg.print(&quot;flag value must be an unsigned integer&quot;);
    return JVMFlag::WRONG_FORMAT;
  }
  
  JVMFlag::Error WriteableFlags::set_size_t_flag(const char* name, size_t value, JVMFlag::Flags origin, FormatBuffer&lt;80&gt;&amp; err_msg) {
<span class="udiff-line-modified-removed">-   JVMFlag::Error err = JVMFlag::size_tAtPut(name, &amp;value, origin);</span>
<span class="udiff-line-modified-removed">-   print_flag_error_message_if_needed(err, name, err_msg);</span>
<span class="udiff-line-modified-added">+   JVMFlag* flag = JVMFlag::find_flag(name);</span>
<span class="udiff-line-modified-added">+   JVMFlag::Error err = JVMFlag::size_tAtPut(flag, &amp;value, origin);</span>
<span class="udiff-line-added">+   print_flag_error_message_if_needed(err, flag, err_msg);</span>
    return err;
  }
  
  // set a double global flag
  JVMFlag::Error WriteableFlags::set_double_flag(const char* name, const char* arg, JVMFlag::Flags origin, FormatBuffer&lt;80&gt;&amp; err_msg) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -224,19 +232,21 @@</span>
    err_msg.print(&quot;flag value must be a double&quot;);
    return JVMFlag::WRONG_FORMAT;
  }
  
  JVMFlag::Error WriteableFlags::set_double_flag(const char* name, double value, JVMFlag::Flags origin, FormatBuffer&lt;80&gt;&amp; err_msg) {
<span class="udiff-line-modified-removed">-   JVMFlag::Error err = JVMFlag::doubleAtPut(name, &amp;value, origin);</span>
<span class="udiff-line-modified-removed">-   print_flag_error_message_if_needed(err, name, err_msg);</span>
<span class="udiff-line-modified-added">+   JVMFlag* flag = JVMFlag::find_flag(name);</span>
<span class="udiff-line-modified-added">+   JVMFlag::Error err = JVMFlag::doubleAtPut(flag, &amp;value, origin);</span>
<span class="udiff-line-added">+   print_flag_error_message_if_needed(err, flag, err_msg);</span>
    return err;
  }
  
  // set a string global flag using value from AttachOperation
  JVMFlag::Error WriteableFlags::set_ccstr_flag(const char* name, const char* value, JVMFlag::Flags origin, FormatBuffer&lt;80&gt;&amp; err_msg) {
<span class="udiff-line-modified-removed">-   JVMFlag::Error err = JVMFlag::ccstrAtPut((char*)name, &amp;value, origin);</span>
<span class="udiff-line-modified-removed">-   print_flag_error_message_if_needed(err, name, err_msg);</span>
<span class="udiff-line-modified-added">+   JVMFlag* flag = JVMFlag::find_flag(name);</span>
<span class="udiff-line-modified-added">+   JVMFlag::Error err = JVMFlag::ccstrAtPut(flag, &amp;value, origin);</span>
<span class="udiff-line-added">+   print_flag_error_message_if_needed(err, flag, err_msg);</span>
    return err;
  }
  
  /* sets a writeable flag to the provided value
   *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -265,11 +275,11 @@</span>
    if (value == NULL) {
      err_msg.print(&quot;flag value is missing&quot;);
      return JVMFlag::MISSING_VALUE;
    }
  
<span class="udiff-line-modified-removed">-   JVMFlag* f = JVMFlag::find_flag((char*)name, strlen(name));</span>
<span class="udiff-line-modified-added">+   JVMFlag* f = JVMFlag::find_flag(name);</span>
    if (f) {
      // only writeable flags are allowed to be set
      if (f-&gt;is_writeable()) {
        return setter(f, value, origin, err_msg);
      } else {
</pre>
<center><a href="virtualMemoryTracker.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../tsan/tsan.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>