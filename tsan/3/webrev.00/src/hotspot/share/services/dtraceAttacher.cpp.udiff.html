<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/services/dtraceAttacher.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="diagnosticFramework.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="gcNotifier.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/services/dtraceAttacher.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2006, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2006, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -31,30 +31,13 @@</span>
  #include &quot;runtime/vmOperations.hpp&quot;
  #include &quot;services/dtraceAttacher.hpp&quot;
  
  #ifdef SOLARIS
  
<span class="udiff-line-modified-removed">- class VM_DeoptimizeTheWorld : public VM_Operation {</span>
<span class="udiff-line-modified-removed">-  public:</span>
<span class="udiff-line-modified-removed">-   VMOp_Type type() const {</span>
<span class="udiff-line-removed">-     return VMOp_DeoptimizeTheWorld;</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">-   void doit() {</span>
<span class="udiff-line-removed">-     CodeCache::mark_all_nmethods_for_deoptimization();</span>
<span class="udiff-line-removed">-     ResourceMark rm;</span>
<span class="udiff-line-removed">-     DeoptimizationMarker dm;</span>
<span class="udiff-line-removed">-     // Deoptimize all activations depending on marked methods</span>
<span class="udiff-line-removed">-     Deoptimization::deoptimize_dependents();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     // Mark the dependent methods non entrant</span>
<span class="udiff-line-removed">-     CodeCache::make_marked_nmethods_not_entrant();</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- };</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- static void set_bool_flag(const char* flag, bool value) {</span>
<span class="udiff-line-removed">-   JVMFlag::boolAtPut((char*)flag, strlen(flag), &amp;value,</span>
<span class="udiff-line-removed">-                               JVMFlag::ATTACH_ON_DEMAND);</span>
<span class="udiff-line-modified-added">+ static void set_bool_flag(const char* name, bool value) {</span>
<span class="udiff-line-modified-added">+   JVMFlag* flag = JVMFlag::find_flag(name);</span>
<span class="udiff-line-modified-added">+   JVMFlag::boolAtPut(flag, &amp;value, JVMFlag::ATTACH_ON_DEMAND);</span>
  }
  
  // Enable only the &quot;fine grained&quot; flags. Do *not* touch
  // the overall &quot;ExtendedDTraceProbes&quot; flag.
  void DTrace::enable_dprobes(int probes) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -72,12 +55,12 @@</span>
      changed = true;
    }
  
    if (changed) {
      // one or more flags changed, need to deoptimize
<span class="udiff-line-modified-removed">-     VM_DeoptimizeTheWorld op;</span>
<span class="udiff-line-modified-removed">-     VMThread::execute(&amp;op);</span>
<span class="udiff-line-modified-added">+     CodeCache::mark_all_nmethods_for_deoptimization();</span>
<span class="udiff-line-modified-added">+     Deoptimization::deoptimize_all_marked();</span>
    }
  }
  
  // Disable only the &quot;fine grained&quot; flags. Do *not* touch
  // the overall &quot;ExtendedDTraceProbes&quot; flag.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -95,12 +78,12 @@</span>
      set_bool_flag(&quot;DTraceMonitorProbes&quot;, false);
      changed = true;
    }
    if (changed) {
      // one or more flags changed, need to deoptimize
<span class="udiff-line-modified-removed">-     VM_DeoptimizeTheWorld op;</span>
<span class="udiff-line-modified-removed">-     VMThread::execute(&amp;op);</span>
<span class="udiff-line-modified-added">+     CodeCache::mark_all_nmethods_for_deoptimization();</span>
<span class="udiff-line-modified-added">+     Deoptimization::deoptimize_all_marked();</span>
    }
  }
  
  // Do clean-up on &quot;all door clients detached&quot; event.
  void DTrace::detach_all_clients() {
</pre>
<center><a href="diagnosticFramework.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="gcNotifier.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>