<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/services/mallocTracker.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="mallocTracker.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="management.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/services/mallocTracker.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 53,28 ***</span>
    }
  
    inline void allocate(size_t sz) {
      Atomic::inc(&amp;_count);
      if (sz &gt; 0) {
<span class="line-modified">!       Atomic::add(sz, &amp;_size);</span>
        DEBUG_ONLY(_peak_size = MAX2(_peak_size, _size));
      }
      DEBUG_ONLY(_peak_count = MAX2(_peak_count, _count);)
    }
  
    inline void deallocate(size_t sz) {
      assert(_count &gt; 0, &quot;Nothing allocated yet&quot;);
      assert(_size &gt;= sz, &quot;deallocation &gt; allocated&quot;);
      Atomic::dec(&amp;_count);
      if (sz &gt; 0) {
<span class="line-modified">!       Atomic::sub(sz, &amp;_size);</span>
      }
    }
  
<span class="line-modified">!   inline void resize(long sz) {</span>
      if (sz != 0) {
<span class="line-modified">!       Atomic::add(size_t(sz), &amp;_size);</span>
        DEBUG_ONLY(_peak_size = MAX2(_size, _peak_size);)
      }
    }
  
    inline size_t count() const { return _count; }
<span class="line-new-header">--- 53,29 ---</span>
    }
  
    inline void allocate(size_t sz) {
      Atomic::inc(&amp;_count);
      if (sz &gt; 0) {
<span class="line-modified">!       Atomic::add(&amp;_size, sz);</span>
        DEBUG_ONLY(_peak_size = MAX2(_peak_size, _size));
      }
      DEBUG_ONLY(_peak_count = MAX2(_peak_count, _count);)
    }
  
    inline void deallocate(size_t sz) {
      assert(_count &gt; 0, &quot;Nothing allocated yet&quot;);
      assert(_size &gt;= sz, &quot;deallocation &gt; allocated&quot;);
      Atomic::dec(&amp;_count);
      if (sz &gt; 0) {
<span class="line-modified">!       Atomic::sub(&amp;_size, sz);</span>
      }
    }
  
<span class="line-modified">!   inline void resize(ssize_t sz) {</span>
      if (sz != 0) {
<span class="line-modified">!       assert(sz &gt;= 0 || _size &gt;= size_t(-sz), &quot;Must be&quot;);</span>
<span class="line-added">+       Atomic::add(&amp;_size, size_t(sz));</span>
        DEBUG_ONLY(_peak_size = MAX2(_size, _peak_size);)
      }
    }
  
    inline size_t count() const { return _count; }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 111,11 ***</span>
  
    inline void record_arena_free() {
      _arena.deallocate(0);
    }
  
<span class="line-modified">!   inline void record_arena_size_change(long sz) {</span>
      _arena.resize(sz);
    }
  
    inline size_t malloc_size()  const { return _malloc.size(); }
    inline size_t malloc_count() const { return _malloc.count();}
<span class="line-new-header">--- 112,11 ---</span>
  
    inline void record_arena_free() {
      _arena.deallocate(0);
    }
  
<span class="line-modified">!   inline void record_arena_size_change(ssize_t sz) {</span>
      _arena.resize(sz);
    }
  
    inline size_t malloc_size()  const { return _malloc.size(); }
    inline size_t malloc_count() const { return _malloc.count();}
</pre>
<hr />
<pre>
<span class="line-old-header">*** 205,11 ***</span>
  
     static inline void record_arena_free(MEMFLAGS flag) {
       as_snapshot()-&gt;by_type(flag)-&gt;record_arena_free();
     }
  
<span class="line-modified">!    static inline void record_arena_size_change(long size, MEMFLAGS flag) {</span>
       as_snapshot()-&gt;by_type(flag)-&gt;record_arena_size_change(size);
     }
  
     static void snapshot(MallocMemorySnapshot* s) {
       as_snapshot()-&gt;copy_to(s);
<span class="line-new-header">--- 206,11 ---</span>
  
     static inline void record_arena_free(MEMFLAGS flag) {
       as_snapshot()-&gt;by_type(flag)-&gt;record_arena_free();
     }
  
<span class="line-modified">!    static inline void record_arena_size_change(ssize_t size, MEMFLAGS flag) {</span>
       as_snapshot()-&gt;by_type(flag)-&gt;record_arena_size_change(size);
     }
  
     static void snapshot(MallocMemorySnapshot* s) {
       as_snapshot()-&gt;copy_to(s);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 359,11 ***</span>
  
    static inline void record_arena_free(MEMFLAGS flags) {
      MallocMemorySummary::record_arena_free(flags);
    }
  
<span class="line-modified">!   static inline void record_arena_size_change(int size, MEMFLAGS flags) {</span>
      MallocMemorySummary::record_arena_size_change(size, flags);
    }
   private:
    static inline MallocHeader* malloc_header(void *memblock) {
      assert(memblock != NULL, &quot;NULL pointer&quot;);
<span class="line-new-header">--- 360,11 ---</span>
  
    static inline void record_arena_free(MEMFLAGS flags) {
      MallocMemorySummary::record_arena_free(flags);
    }
  
<span class="line-modified">!   static inline void record_arena_size_change(ssize_t size, MEMFLAGS flags) {</span>
      MallocMemorySummary::record_arena_size_change(size, flags);
    }
   private:
    static inline MallocHeader* malloc_header(void *memblock) {
      assert(memblock != NULL, &quot;NULL pointer&quot;);
</pre>
<center><a href="mallocTracker.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="management.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>