<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/hotspot/share/jvmci/jvmciCompiler.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 #ifndef SHARE_JVMCI_JVMCICOMPILER_HPP
 25 #define SHARE_JVMCI_JVMCICOMPILER_HPP
 26 
 27 #include &quot;compiler/abstractCompiler.hpp&quot;
 28 #include &quot;jvmci/jvmciEnv.hpp&quot;
 29 #include &quot;utilities/exceptions.hpp&quot;
 30 
 31 class JVMCICompiler : public AbstractCompiler {
 32 private:
 33   bool _bootstrapping;
 34 
 35   /**
 36    * True if we have seen a bootstrap compilation request.
 37    */
 38   volatile bool _bootstrap_compilation_request_handled;
 39 
 40   /**
 41    * Number of methods successfully compiled by a call to
 42    * JVMCICompiler::compile_method().
 43    */
 44   volatile int _methods_compiled;
 45 
 46   static JVMCICompiler* _instance;
 47 
 48   static elapsedTimer _codeInstallTimer;
 49 
 50   /**
 51    * Exits the VM due to an unexpected exception.
 52    */
 53   static void exit_on_pending_exception(oop exception, const char* message);
 54 
 55 public:
 56   JVMCICompiler();
 57 
 58   static JVMCICompiler* instance(bool require_non_null, TRAPS) {
 59     if (!EnableJVMCI) {
 60       THROW_MSG_NULL(vmSymbols::java_lang_InternalError(), &quot;JVMCI is not enabled&quot;)
 61     }
 62     if (_instance == NULL &amp;&amp; require_non_null) {
 63       THROW_MSG_NULL(vmSymbols::java_lang_InternalError(), &quot;The JVMCI compiler instance has not been created&quot;);
 64     }
 65     return _instance;
 66   }
 67 
 68   virtual const char* name() { return &quot;JVMCI&quot;; }
 69 
 70   virtual bool supports_native()                 { return true; }
 71   virtual bool supports_osr   ()                 { return true; }
 72 
 73   bool is_jvmci()                                { return true; }
 74   bool is_c1   ()                                { return false; }
 75   bool is_c2   ()                                { return false; }
 76 
 77   bool needs_stubs            () { return false; }
 78 
 79   // Initialization
 80   virtual void initialize();
 81 
 82   /**
 83    * Initialize the compile queue with the methods in java.lang.Object and
 84    * then wait until the queue is empty.
 85    */
 86   void bootstrap(TRAPS);
 87 
 88   bool is_bootstrapping() const { return _bootstrapping; }
 89 
 90   // Compilation entry point for methods
 91   virtual void compile_method(ciEnv* env, ciMethod* target, int entry_bci, DirectiveSet* directive);
 92 
 93   void compile_method(const methodHandle&amp; target, int entry_bci, JVMCIEnv* env);
 94 
 95   // Print compilation timers and statistics
 96   virtual void print_timers();
 97 
 98   /**
 99    * Gets the number of methods that have been successfully compiled by
100    * a call to JVMCICompiler::compile_method().
101    */
102   int methods_compiled() { return _methods_compiled; }
103 
104   // Print compilation timers and statistics
105   static void print_compilation_timers();
106 
107   static elapsedTimer* codeInstallTimer() { return &amp;_codeInstallTimer; }
108 };
109 
110 #endif // SHARE_JVMCI_JVMCICOMPILER_HPP
    </pre>
  </body>
</html>