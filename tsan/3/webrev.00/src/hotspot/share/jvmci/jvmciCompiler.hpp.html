<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/hotspot/share/jvmci/jvmciCompiler.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 #ifndef SHARE_JVMCI_JVMCICOMPILER_HPP
 25 #define SHARE_JVMCI_JVMCICOMPILER_HPP
 26 
 27 #include &quot;compiler/abstractCompiler.hpp&quot;
 28 #include &quot;runtime/atomic.hpp&quot;
 29 
 30 class JVMCICompiler : public AbstractCompiler {
 31 private:
 32   bool _bootstrapping;
 33 
 34   /**
 35    * True if we have seen a bootstrap compilation request.
 36    */
 37   volatile bool _bootstrap_compilation_request_handled;
 38 
 39   /**
 40    * Number of methods successfully compiled by a call to
 41    * JVMCICompiler::compile_method().
 42    */
 43   volatile int _methods_compiled;
 44 
 45   static JVMCICompiler* _instance;
 46 
 47   static elapsedTimer _codeInstallTimer;
 48 
 49   /**
 50    * Exits the VM due to an unexpected exception.
 51    */
 52   static void exit_on_pending_exception(oop exception, const char* message);
 53 
 54 public:
 55   JVMCICompiler();
 56 
 57   static JVMCICompiler* instance(bool require_non_null, TRAPS) {
 58     if (!EnableJVMCI) {
 59       THROW_MSG_NULL(vmSymbols::java_lang_InternalError(), &quot;JVMCI is not enabled&quot;)
 60     }
 61     if (_instance == NULL &amp;&amp; require_non_null) {
 62       THROW_MSG_NULL(vmSymbols::java_lang_InternalError(), &quot;The JVMCI compiler instance has not been created&quot;);
 63     }
 64     return _instance;
 65   }
 66 
 67   virtual const char* name() { return UseJVMCINativeLibrary ? &quot;JVMCI-native&quot; : &quot;JVMCI&quot;; }
 68 
 69   virtual bool supports_native()                 { return true; }
 70   virtual bool supports_osr   ()                 { return true; }
 71 
 72   bool is_jvmci()                                { return true; }
 73   bool is_c1   ()                                { return false; }
 74   bool is_c2   ()                                { return false; }
 75 
 76   bool needs_stubs            () { return false; }
 77 
 78   // Initialization
 79   virtual void initialize();
 80 
 81   /**
 82    * Initialize the compile queue with the methods in java.lang.Object and
 83    * then wait until the queue is empty.
 84    */
 85   void bootstrap(TRAPS);
 86 
 87   // Should force compilation of method at CompLevel_simple?
 88   bool force_comp_at_level_simple(const methodHandle&amp; method);
 89 
 90   bool is_bootstrapping() const { return _bootstrapping; }
 91 
 92   void set_bootstrap_compilation_request_handled() {
 93     _instance-&gt;_bootstrap_compilation_request_handled = true;
 94   }
 95 
 96   // Compilation entry point for methods
 97   virtual void compile_method(ciEnv* env, ciMethod* target, int entry_bci, DirectiveSet* directive);
 98 
 99   // Print compilation timers and statistics
100   virtual void print_timers();
101 
102   /**
103    * Gets the number of methods that have been successfully compiled by
104    * a call to JVMCICompiler::compile_method().
105    */
106   int methods_compiled() { return _methods_compiled; }
107 
108   void inc_methods_compiled() {
109     Atomic::inc(&amp;_methods_compiled);
110   }
111 
112   // Print compilation timers and statistics
113   static void print_compilation_timers();
114 
115   static elapsedTimer* codeInstallTimer() { return &amp;_codeInstallTimer; }
116 };
117 
118 #endif // SHARE_JVMCI_JVMCICOMPILER_HPP
    </pre>
  </body>
</html>