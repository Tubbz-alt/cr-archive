<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/jvmci/jvmciCompiler.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="jvmciCompiler.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="jvmciCompilerToVM.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jvmci/jvmciCompiler.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 #ifndef SHARE_JVMCI_JVMCICOMPILER_HPP
 25 #define SHARE_JVMCI_JVMCICOMPILER_HPP
 26 
 27 #include &quot;compiler/abstractCompiler.hpp&quot;
<span class="line-modified"> 28 #include &quot;jvmci/jvmciEnv.hpp&quot;</span>
<span class="line-removed"> 29 #include &quot;utilities/exceptions.hpp&quot;</span>
 30 
 31 class JVMCICompiler : public AbstractCompiler {
 32 private:
 33   bool _bootstrapping;
 34 
 35   /**
 36    * True if we have seen a bootstrap compilation request.
 37    */
 38   volatile bool _bootstrap_compilation_request_handled;
 39 
 40   /**
 41    * Number of methods successfully compiled by a call to
 42    * JVMCICompiler::compile_method().
 43    */
 44   volatile int _methods_compiled;
 45 
 46   static JVMCICompiler* _instance;
 47 
 48   static elapsedTimer _codeInstallTimer;
 49 
 50   /**
 51    * Exits the VM due to an unexpected exception.
 52    */
 53   static void exit_on_pending_exception(oop exception, const char* message);
 54 
 55 public:
 56   JVMCICompiler();
 57 
 58   static JVMCICompiler* instance(bool require_non_null, TRAPS) {
 59     if (!EnableJVMCI) {
 60       THROW_MSG_NULL(vmSymbols::java_lang_InternalError(), &quot;JVMCI is not enabled&quot;)
 61     }
 62     if (_instance == NULL &amp;&amp; require_non_null) {
 63       THROW_MSG_NULL(vmSymbols::java_lang_InternalError(), &quot;The JVMCI compiler instance has not been created&quot;);
 64     }
 65     return _instance;
 66   }
 67 
<span class="line-modified"> 68   virtual const char* name() { return &quot;JVMCI&quot;; }</span>
 69 
 70   virtual bool supports_native()                 { return true; }
 71   virtual bool supports_osr   ()                 { return true; }
 72 
 73   bool is_jvmci()                                { return true; }
 74   bool is_c1   ()                                { return false; }
 75   bool is_c2   ()                                { return false; }
 76 
 77   bool needs_stubs            () { return false; }
 78 
 79   // Initialization
 80   virtual void initialize();
 81 
 82   /**
 83    * Initialize the compile queue with the methods in java.lang.Object and
 84    * then wait until the queue is empty.
 85    */
 86   void bootstrap(TRAPS);
 87 



 88   bool is_bootstrapping() const { return _bootstrapping; }
 89 




 90   // Compilation entry point for methods
 91   virtual void compile_method(ciEnv* env, ciMethod* target, int entry_bci, DirectiveSet* directive);
 92 
<span class="line-removed"> 93   void compile_method(const methodHandle&amp; target, int entry_bci, JVMCIEnv* env);</span>
<span class="line-removed"> 94 </span>
 95   // Print compilation timers and statistics
 96   virtual void print_timers();
 97 
 98   /**
 99    * Gets the number of methods that have been successfully compiled by
100    * a call to JVMCICompiler::compile_method().
101    */
102   int methods_compiled() { return _methods_compiled; }
103 




104   // Print compilation timers and statistics
105   static void print_compilation_timers();
106 
107   static elapsedTimer* codeInstallTimer() { return &amp;_codeInstallTimer; }
108 };
109 
110 #endif // SHARE_JVMCI_JVMCICOMPILER_HPP
</pre>
</td>
<td>
<hr />
<pre>
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 #ifndef SHARE_JVMCI_JVMCICOMPILER_HPP
 25 #define SHARE_JVMCI_JVMCICOMPILER_HPP
 26 
 27 #include &quot;compiler/abstractCompiler.hpp&quot;
<span class="line-modified"> 28 #include &quot;runtime/atomic.hpp&quot;</span>

 29 
 30 class JVMCICompiler : public AbstractCompiler {
 31 private:
 32   bool _bootstrapping;
 33 
 34   /**
 35    * True if we have seen a bootstrap compilation request.
 36    */
 37   volatile bool _bootstrap_compilation_request_handled;
 38 
 39   /**
 40    * Number of methods successfully compiled by a call to
 41    * JVMCICompiler::compile_method().
 42    */
 43   volatile int _methods_compiled;
 44 
 45   static JVMCICompiler* _instance;
 46 
 47   static elapsedTimer _codeInstallTimer;
 48 
 49   /**
 50    * Exits the VM due to an unexpected exception.
 51    */
 52   static void exit_on_pending_exception(oop exception, const char* message);
 53 
 54 public:
 55   JVMCICompiler();
 56 
 57   static JVMCICompiler* instance(bool require_non_null, TRAPS) {
 58     if (!EnableJVMCI) {
 59       THROW_MSG_NULL(vmSymbols::java_lang_InternalError(), &quot;JVMCI is not enabled&quot;)
 60     }
 61     if (_instance == NULL &amp;&amp; require_non_null) {
 62       THROW_MSG_NULL(vmSymbols::java_lang_InternalError(), &quot;The JVMCI compiler instance has not been created&quot;);
 63     }
 64     return _instance;
 65   }
 66 
<span class="line-modified"> 67   virtual const char* name() { return UseJVMCINativeLibrary ? &quot;JVMCI-native&quot; : &quot;JVMCI&quot;; }</span>
 68 
 69   virtual bool supports_native()                 { return true; }
 70   virtual bool supports_osr   ()                 { return true; }
 71 
 72   bool is_jvmci()                                { return true; }
 73   bool is_c1   ()                                { return false; }
 74   bool is_c2   ()                                { return false; }
 75 
 76   bool needs_stubs            () { return false; }
 77 
 78   // Initialization
 79   virtual void initialize();
 80 
 81   /**
 82    * Initialize the compile queue with the methods in java.lang.Object and
 83    * then wait until the queue is empty.
 84    */
 85   void bootstrap(TRAPS);
 86 
<span class="line-added"> 87   // Should force compilation of method at CompLevel_simple?</span>
<span class="line-added"> 88   bool force_comp_at_level_simple(const methodHandle&amp; method);</span>
<span class="line-added"> 89 </span>
 90   bool is_bootstrapping() const { return _bootstrapping; }
 91 
<span class="line-added"> 92   void set_bootstrap_compilation_request_handled() {</span>
<span class="line-added"> 93     _instance-&gt;_bootstrap_compilation_request_handled = true;</span>
<span class="line-added"> 94   }</span>
<span class="line-added"> 95 </span>
 96   // Compilation entry point for methods
 97   virtual void compile_method(ciEnv* env, ciMethod* target, int entry_bci, DirectiveSet* directive);
 98 


 99   // Print compilation timers and statistics
100   virtual void print_timers();
101 
102   /**
103    * Gets the number of methods that have been successfully compiled by
104    * a call to JVMCICompiler::compile_method().
105    */
106   int methods_compiled() { return _methods_compiled; }
107 
<span class="line-added">108   void inc_methods_compiled() {</span>
<span class="line-added">109     Atomic::inc(&amp;_methods_compiled);</span>
<span class="line-added">110   }</span>
<span class="line-added">111 </span>
112   // Print compilation timers and statistics
113   static void print_compilation_timers();
114 
115   static elapsedTimer* codeInstallTimer() { return &amp;_codeInstallTimer; }
116 };
117 
118 #endif // SHARE_JVMCI_JVMCICOMPILER_HPP
</pre>
</td>
</tr>
</table>
<center><a href="jvmciCompiler.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="jvmciCompilerToVM.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>