<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/hotspot/share/jvmci/jvmci_globals.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
    <script type="text/javascript" src="../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #include &quot;precompiled.hpp&quot;
 26 #include &quot;jvm.h&quot;
 27 #include &quot;jvmci/jvmci_globals.hpp&quot;
 28 #include &quot;gc/shared/gcConfig.hpp&quot;
 29 #include &quot;utilities/defaultStream.hpp&quot;
<a name="2" id="anc2"></a>
 30 #include &quot;runtime/globals_extension.hpp&quot;
 31 
<a name="3" id="anc3"></a><span class="line-modified"> 32 JVMCI_FLAGS(MATERIALIZE_DEVELOPER_FLAG, \</span>
<span class="line-removed"> 33             MATERIALIZE_PD_DEVELOPER_FLAG, \</span>
<span class="line-removed"> 34             MATERIALIZE_PRODUCT_FLAG, \</span>
<span class="line-removed"> 35             MATERIALIZE_PD_PRODUCT_FLAG, \</span>
<span class="line-removed"> 36             MATERIALIZE_DIAGNOSTIC_FLAG, \</span>
<span class="line-removed"> 37             MATERIALIZE_PD_DIAGNOSTIC_FLAG, \</span>
<span class="line-removed"> 38             MATERIALIZE_EXPERIMENTAL_FLAG, \</span>
<span class="line-removed"> 39             MATERIALIZE_NOTPRODUCT_FLAG,</span>
<span class="line-removed"> 40             IGNORE_RANGE, \</span>
<span class="line-removed"> 41             IGNORE_CONSTRAINT, \</span>
<span class="line-removed"> 42             IGNORE_WRITEABLE)</span>
 43 
 44 // Return true if jvmci flags are consistent.
 45 bool JVMCIGlobals::check_jvmci_flags_are_consistent() {
 46 
 47 #ifndef PRODUCT
 48 #define APPLY_JVMCI_FLAGS(params3, params4) \
<a name="4" id="anc4"></a><span class="line-modified"> 49   JVMCI_FLAGS(params4, params3, params4, params3, params4, params3, params4, params4, IGNORE_RANGE, IGNORE_CONSTRAINT, IGNORE_WRITEABLE)</span>
 50 #define JVMCI_DECLARE_CHECK4(type, name, value, doc) bool name##checked = false;
 51 #define JVMCI_DECLARE_CHECK3(type, name, doc)        bool name##checked = false;
 52 #define JVMCI_FLAG_CHECKED(name)                          name##checked = true;
 53   APPLY_JVMCI_FLAGS(JVMCI_DECLARE_CHECK3, JVMCI_DECLARE_CHECK4)
 54 #else
 55 #define JVMCI_FLAG_CHECKED(name)
 56 #endif
 57 
 58   // Checks that a given flag is not set if a given guard flag is false.
 59 #define CHECK_NOT_SET(FLAG, GUARD)                     \
 60   JVMCI_FLAG_CHECKED(FLAG)                             \
 61   if (!GUARD &amp;&amp; !FLAG_IS_DEFAULT(FLAG)) {              \
 62     jio_fprintf(defaultStream::error_stream(),         \
 63         &quot;Improperly specified VM option &#39;%s&#39;: &#39;%s&#39; must be enabled\n&quot;, #FLAG, #GUARD); \
 64     return false;                                      \
 65   }
 66 
<a name="5" id="anc5"></a>








 67   JVMCI_FLAG_CHECKED(UseJVMCICompiler)
 68   JVMCI_FLAG_CHECKED(EnableJVMCI)
<a name="6" id="anc6"></a>
 69 
 70   CHECK_NOT_SET(BootstrapJVMCI,   UseJVMCICompiler)
 71   CHECK_NOT_SET(PrintBootstrap,   UseJVMCICompiler)
 72   CHECK_NOT_SET(JVMCIThreads,     UseJVMCICompiler)
 73   CHECK_NOT_SET(JVMCIHostThreads, UseJVMCICompiler)
 74 
 75   if (UseJVMCICompiler) {
<a name="7" id="anc7"></a>







 76     if (!FLAG_IS_DEFAULT(EnableJVMCI) &amp;&amp; !EnableJVMCI) {
 77       jio_fprintf(defaultStream::error_stream(),
 78           &quot;Improperly specified VM option UseJVMCICompiler: EnableJVMCI cannot be disabled\n&quot;);
 79       return false;
 80     }
 81     FLAG_SET_DEFAULT(EnableJVMCI, true);
<a name="8" id="anc8"></a>



 82   }
 83 
 84   if (!EnableJVMCI) {
 85     // Switch off eager JVMCI initialization if JVMCI is disabled.
 86     // Don&#39;t throw error if EagerJVMCI is set to allow testing.
 87     if (EagerJVMCI) {
 88       FLAG_SET_DEFAULT(EagerJVMCI, false);
 89     }
 90   }
 91   JVMCI_FLAG_CHECKED(EagerJVMCI)
 92 
 93   CHECK_NOT_SET(JVMCITraceLevel,              EnableJVMCI)
 94   CHECK_NOT_SET(JVMCICounterSize,             EnableJVMCI)
 95   CHECK_NOT_SET(JVMCICountersExcludeCompiler, EnableJVMCI)
 96   CHECK_NOT_SET(JVMCIUseFastLocking,          EnableJVMCI)
 97   CHECK_NOT_SET(JVMCINMethodSizeLimit,        EnableJVMCI)
 98   CHECK_NOT_SET(MethodProfileWidth,           EnableJVMCI)
 99   CHECK_NOT_SET(JVMCIPrintProperties,         EnableJVMCI)
<a name="9" id="anc9"></a><span class="line-modified">100   CHECK_NOT_SET(TraceUncollectedSpeculations, EnableJVMCI)</span>












101 
102 #ifndef PRODUCT
103 #define JVMCI_CHECK4(type, name, value, doc) assert(name##checked, #name &quot; flag not checked&quot;);
104 #define JVMCI_CHECK3(type, name, doc)        assert(name##checked, #name &quot; flag not checked&quot;);
105   // Ensures that all JVMCI flags are checked by this method.
106   APPLY_JVMCI_FLAGS(JVMCI_CHECK3, JVMCI_CHECK4)
107 #undef APPLY_JVMCI_FLAGS
108 #undef JVMCI_DECLARE_CHECK3
109 #undef JVMCI_DECLARE_CHECK4
110 #undef JVMCI_CHECK3
111 #undef JVMCI_CHECK4
112 #undef JVMCI_FLAG_CHECKED
<a name="10" id="anc10"></a><span class="line-modified">113 #endif</span>
114 #undef CHECK_NOT_SET
<a name="11" id="anc11"></a>









115   return true;
116 }
<a name="12" id="anc12"></a>









































117 void JVMCIGlobals::check_jvmci_supported_gc() {
118   if (EnableJVMCI) {
119     // Check if selected GC is supported by JVMCI and Java compiler
<a name="13" id="anc13"></a><span class="line-modified">120     if (!(UseSerialGC || UseParallelGC || UseParallelOldGC || UseG1GC)) {</span>
121       vm_exit_during_initialization(&quot;JVMCI Compiler does not support selected GC&quot;, GCConfig::hs_err_name());
122       FLAG_SET_DEFAULT(EnableJVMCI, false);
123       FLAG_SET_DEFAULT(UseJVMCICompiler, false);
124     }
125   }
126 }
<a name="14" id="anc14"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="14" type="hidden" />
</body>
</html>