<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/classfile/classFileStream.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="classFileStream.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="classListParser.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/classfile/classFileStream.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 27 
 28 #include &quot;memory/allocation.hpp&quot;
 29 #include &quot;utilities/bytes.hpp&quot;
 30 #include &quot;utilities/exceptions.hpp&quot;
 31 
 32 // Input stream for reading .class file
 33 //
 34 // The entire input stream is present in a buffer allocated by the caller.
 35 // The caller is responsible for deallocating the buffer and for using
 36 // ResourceMarks appropriately when constructing streams.
 37 
 38 class ClassPathEntry;
 39 
 40 class ClassFileStream: public ResourceObj {
 41  private:
 42   const u1* const _buffer_start; // Buffer bottom
 43   const u1* const _buffer_end;   // Buffer top (one past last element)
 44   mutable const u1* _current;    // Current buffer position
 45   const char* const _source;     // Source of stream (directory name, ZIP/JAR archive name)
 46   bool _need_verify;             // True if verification is on for the class file
<span class="line-modified"> 47 </span>
 48   void truncated_file_error(TRAPS) const ;
 49 
 50  protected:
 51   const u1* clone_buffer() const;
 52   const char* const clone_source() const;
 53 
 54  public:
 55   static const bool verify;
 56 
 57   ClassFileStream(const u1* buffer,
 58                   int length,
 59                   const char* source,
<span class="line-modified"> 60                   bool verify_stream = verify); // to be verified by default</span>

 61 
 62   virtual const ClassFileStream* clone() const;
 63 
 64   // Buffer access
 65   const u1* buffer() const { return _buffer_start; }
 66   int length() const { return _buffer_end - _buffer_start; }
 67   const u1* current() const { return _current; }
 68   void set_current(const u1* pos) const {
 69     assert(pos &gt;= _buffer_start &amp;&amp; pos &lt;= _buffer_end, &quot;invariant&quot;);
 70     _current = pos;
 71   }
 72 
 73   // for relative positioning
 74   juint current_offset() const {
 75     return (juint)(_current - _buffer_start);
 76   }
 77   const char* source() const { return _source; }
 78   bool need_verify() const { return _need_verify; }
 79   void set_verify(bool flag) { _need_verify = flag; }

 80 
 81   void check_truncated_file(bool b, TRAPS) const {
 82     if (b) {
 83       truncated_file_error(THREAD);
 84     }
 85   }
 86 
 87   void guarantee_more(int size, TRAPS) const {
 88     size_t remaining = (size_t)(_buffer_end - _current);
 89     unsigned int usize = (unsigned int)size;
 90     check_truncated_file(usize &gt; remaining, CHECK);
 91   }
 92 
 93   // Read u1 from stream
 94   u1 get_u1_fast() const {
 95     return *_current++;
 96   }
 97   u1 get_u1(TRAPS) const {
 98     if (_need_verify) {
 99       guarantee_more(1, CHECK_0);
</pre>
</td>
<td>
<hr />
<pre>
 27 
 28 #include &quot;memory/allocation.hpp&quot;
 29 #include &quot;utilities/bytes.hpp&quot;
 30 #include &quot;utilities/exceptions.hpp&quot;
 31 
 32 // Input stream for reading .class file
 33 //
 34 // The entire input stream is present in a buffer allocated by the caller.
 35 // The caller is responsible for deallocating the buffer and for using
 36 // ResourceMarks appropriately when constructing streams.
 37 
 38 class ClassPathEntry;
 39 
 40 class ClassFileStream: public ResourceObj {
 41  private:
 42   const u1* const _buffer_start; // Buffer bottom
 43   const u1* const _buffer_end;   // Buffer top (one past last element)
 44   mutable const u1* _current;    // Current buffer position
 45   const char* const _source;     // Source of stream (directory name, ZIP/JAR archive name)
 46   bool _need_verify;             // True if verification is on for the class file
<span class="line-modified"> 47   bool _from_boot_loader_modules_image;  // True if this was created by ClassPathImageEntry.</span>
 48   void truncated_file_error(TRAPS) const ;
 49 
 50  protected:
 51   const u1* clone_buffer() const;
 52   const char* const clone_source() const;
 53 
 54  public:
 55   static const bool verify;
 56 
 57   ClassFileStream(const u1* buffer,
 58                   int length,
 59                   const char* source,
<span class="line-modified"> 60                   bool verify_stream = verify,  // to be verified by default</span>
<span class="line-added"> 61                   bool from_boot_loader_modules_image = false);</span>
 62 
 63   virtual const ClassFileStream* clone() const;
 64 
 65   // Buffer access
 66   const u1* buffer() const { return _buffer_start; }
 67   int length() const { return _buffer_end - _buffer_start; }
 68   const u1* current() const { return _current; }
 69   void set_current(const u1* pos) const {
 70     assert(pos &gt;= _buffer_start &amp;&amp; pos &lt;= _buffer_end, &quot;invariant&quot;);
 71     _current = pos;
 72   }
 73 
 74   // for relative positioning
 75   juint current_offset() const {
 76     return (juint)(_current - _buffer_start);
 77   }
 78   const char* source() const { return _source; }
 79   bool need_verify() const { return _need_verify; }
 80   void set_verify(bool flag) { _need_verify = flag; }
<span class="line-added"> 81   bool from_boot_loader_modules_image() const { return _from_boot_loader_modules_image; }</span>
 82 
 83   void check_truncated_file(bool b, TRAPS) const {
 84     if (b) {
 85       truncated_file_error(THREAD);
 86     }
 87   }
 88 
 89   void guarantee_more(int size, TRAPS) const {
 90     size_t remaining = (size_t)(_buffer_end - _current);
 91     unsigned int usize = (unsigned int)size;
 92     check_truncated_file(usize &gt; remaining, CHECK);
 93   }
 94 
 95   // Read u1 from stream
 96   u1 get_u1_fast() const {
 97     return *_current++;
 98   }
 99   u1 get_u1(TRAPS) const {
100     if (_need_verify) {
101       guarantee_more(1, CHECK_0);
</pre>
</td>
</tr>
</table>
<center><a href="classFileStream.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="classListParser.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>