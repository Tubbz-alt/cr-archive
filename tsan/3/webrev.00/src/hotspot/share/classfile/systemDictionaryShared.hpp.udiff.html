<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/classfile/systemDictionaryShared.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="systemDictionaryShared.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="tsanIgnoreList.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/classfile/systemDictionaryShared.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -25,10 +25,11 @@</span>
  #ifndef SHARE_CLASSFILE_SYSTEMDICTIONARYSHARED_HPP
  #define SHARE_CLASSFILE_SYSTEMDICTIONARYSHARED_HPP
  
  #include &quot;oops/klass.hpp&quot;
  #include &quot;classfile/dictionary.hpp&quot;
<span class="udiff-line-added">+ #include &quot;classfile/packageEntry.hpp&quot;</span>
  #include &quot;classfile/systemDictionary.hpp&quot;
  #include &quot;memory/filemap.hpp&quot;
  
  
  /*===============================================================================
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -106,10 +107,11 @@</span>
  class DumpTimeSharedClassTable;
  class RunTimeSharedClassInfo;
  class RunTimeSharedDictionary;
  
  class SystemDictionaryShared: public SystemDictionary {
<span class="udiff-line-added">+   friend class ExcludeDumpTimeSharedClasses;</span>
  public:
    enum {
      FROM_FIELD_IS_PROTECTED = 1 &lt;&lt; 0,
      FROM_IS_ARRAY           = 1 &lt;&lt; 1,
      FROM_IS_OBJECT          = 1 &lt;&lt; 2
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -208,19 +210,26 @@</span>
                                   Handle class_loader,
                                   Handle protection_domain,
                                   const ClassFileStream* cfs,
                                   TRAPS);
    static DumpTimeSharedClassInfo* find_or_allocate_info_for(InstanceKlass* k);
<span class="udiff-line-modified-removed">-   static void write_dictionary(RunTimeSharedDictionary* dictionary, bool is_builtin);</span>
<span class="udiff-line-modified-added">+   static void write_dictionary(RunTimeSharedDictionary* dictionary,</span>
<span class="udiff-line-added">+                                bool is_builtin,</span>
<span class="udiff-line-added">+                                bool is_static_archive = true);</span>
    static bool is_jfr_event_class(InstanceKlass *k);
    static void warn_excluded(InstanceKlass* k, const char* reason);
<span class="udiff-line-added">+   static bool should_be_excluded(InstanceKlass* k);</span>
  
<span class="udiff-line-modified-removed">-   DEBUG_ONLY(static bool _checked_excluded_classes;)</span>
<span class="udiff-line-modified-added">+   DEBUG_ONLY(static bool _no_class_loading_should_happen;)</span>
  public:
    static InstanceKlass* find_builtin_class(Symbol* class_name);
  
<span class="udiff-line-modified-removed">-   static const RunTimeSharedClassInfo* find_record(RunTimeSharedDictionary* dict, Symbol* name);</span>
<span class="udiff-line-modified-added">+   static const RunTimeSharedClassInfo* find_record(RunTimeSharedDictionary* static_dict,</span>
<span class="udiff-line-added">+                                                    RunTimeSharedDictionary* dynamic_dict,</span>
<span class="udiff-line-added">+                                                    Symbol* name);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   static bool has_platform_or_app_classes();</span>
  
    // Called by PLATFORM/APP loader only
    static InstanceKlass* find_or_load_shared_class(Symbol* class_name,
                                                 Handle class_loader,
                                                 TRAPS);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -231,11 +240,10 @@</span>
  
    // Check if sharing is supported for the class loader.
    static bool is_sharing_possible(ClassLoaderData* loader_data);
    static bool is_shared_class_visible_for_classloader(InstanceKlass* ik,
                                                        Handle class_loader,
<span class="udiff-line-removed">-                                                       const char* pkg_string,</span>
                                                        Symbol* pkg_name,
                                                        PackageEntry* pkg_entry,
                                                        ModuleEntry* mod_entry,
                                                        TRAPS);
    static PackageEntry* get_package_entry(Symbol* pkg,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -285,20 +293,42 @@</span>
    static void check_verification_constraints(InstanceKlass* klass,
                                               TRAPS) NOT_CDS_RETURN;
    static bool is_builtin(InstanceKlass* k) {
      return (k-&gt;shared_classpath_index() != UNREGISTERED_INDEX);
    }
<span class="udiff-line-removed">-   static bool should_be_excluded(InstanceKlass* k);</span>
    static void check_excluded_classes();
    static void validate_before_archiving(InstanceKlass* k);
    static bool is_excluded_class(InstanceKlass* k);
    static void dumptime_classes_do(class MetaspaceClosure* it);
<span class="udiff-line-modified-removed">-   static void write_to_archive();</span>
<span class="udiff-line-modified-removed">-   static void serialize_dictionary_headers(class SerializeClosure* soc);</span>
<span class="udiff-line-modified-added">+   static size_t estimate_size_for_archive();</span>
<span class="udiff-line-modified-added">+   static void write_to_archive(bool is_static_archive = true);</span>
<span class="udiff-line-added">+   static void serialize_dictionary_headers(class SerializeClosure* soc,</span>
<span class="udiff-line-added">+                                            bool is_static_archive = true);</span>
    static void print() { return print_on(tty); }
    static void print_on(outputStream* st) NOT_CDS_RETURN;
    static void print_table_statistics(outputStream* st) NOT_CDS_RETURN;
<span class="udiff-line-added">+   static bool empty_dumptime_table() NOT_CDS_RETURN_(true);</span>
  
<span class="udiff-line-modified-removed">-   DEBUG_ONLY(static bool checked_excluded_classes() {return _checked_excluded_classes;})</span>
<span class="udiff-line-modified-added">+   DEBUG_ONLY(static bool no_class_loading_should_happen() {return _no_class_loading_should_happen;})</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #ifdef ASSERT</span>
<span class="udiff-line-added">+   class NoClassLoadingMark: public StackObj {</span>
<span class="udiff-line-added">+   public:</span>
<span class="udiff-line-added">+     NoClassLoadingMark() {</span>
<span class="udiff-line-added">+       assert(!_no_class_loading_should_happen, &quot;must not be nested&quot;);</span>
<span class="udiff-line-added">+       _no_class_loading_should_happen = true;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     ~NoClassLoadingMark() {</span>
<span class="udiff-line-added">+       _no_class_loading_should_happen = false;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+   };</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   template &lt;typename T&gt;</span>
<span class="udiff-line-added">+   static unsigned int hash_for_shared_dictionary(T* ptr) {</span>
<span class="udiff-line-added">+     assert(ptr &gt; (T*)SharedBaseAddress, &quot;must be&quot;);</span>
<span class="udiff-line-added">+     address p = address(ptr) - SharedBaseAddress;</span>
<span class="udiff-line-added">+     return primitive_hash&lt;address&gt;(p);</span>
<span class="udiff-line-added">+   }</span>
  };
  
  #endif // SHARE_CLASSFILE_SYSTEMDICTIONARYSHARED_HPP
</pre>
<center><a href="systemDictionaryShared.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="tsanIgnoreList.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>