<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/classfile/compactHashtable.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="compactHashtable.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="defaultMethods.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/classfile/compactHashtable.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -98,11 +98,11 @@</span>
        return (_value == other._value &amp;&amp; _hash == other._hash);
      }
    }; // class CompactHashtableWriter::Entry
  
  private:
<span class="udiff-line-modified-removed">-   int _num_entries;</span>
<span class="udiff-line-modified-added">+   int _num_entries_written;</span>
    int _num_buckets;
    int _num_empty_buckets;
    int _num_value_only_buckets;
    int _num_other_buckets;
    GrowableArray&lt;Entry&gt;** _buckets;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -110,30 +110,28 @@</span>
    Array&lt;u4&gt;* _compact_buckets;
    Array&lt;u4&gt;* _compact_entries;
  
  public:
    // This is called at dump-time only
<span class="udiff-line-modified-removed">-   CompactHashtableWriter(int num_buckets, CompactHashtableStats* stats);</span>
<span class="udiff-line-modified-added">+   CompactHashtableWriter(int num_entries, CompactHashtableStats* stats);</span>
    ~CompactHashtableWriter();
  
    void add(unsigned int hash, u4 value);
  
  private:
    void allocate_table();
    void dump_table(NumberSeq* summary);
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-removed">- public:</span>
<span class="udiff-line-removed">-   void dump(SimpleCompactHashtable *cht, const char* table_name);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   static int default_num_buckets(size_t num_entries) {</span>
<span class="udiff-line-removed">-     return default_num_buckets((int)num_entries);</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">-   static int default_num_buckets(int num_entries) {</span>
<span class="udiff-line-modified-added">+   static int calculate_num_buckets(int num_entries) {</span>
      int num_buckets = num_entries / SharedSymbolTableBucketSize;
      // calculation of num_buckets can result in zero buckets, we need at least one
      return (num_buckets &lt; 1) ? 1 : num_buckets;
    }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ public:</span>
<span class="udiff-line-added">+   void dump(SimpleCompactHashtable *cht, const char* table_name);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   static size_t estimate_size(int num_entries);</span>
  };
  #endif // INCLUDE_CDS
  
  #define REGULAR_BUCKET_TYPE       0
  #define VALUE_ONLY_BUCKET_TYPE    1
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -212,24 +210,20 @@</span>
      _entry_count = 0;
      _buckets = 0;
      _entries = 0;
    }
  
<span class="udiff-line-modified-removed">-   void init(address base_address, u4 entry_count, u4 bucket_count, u4* buckets, u4* entries) {</span>
<span class="udiff-line-removed">-     _base_address = base_address;</span>
<span class="udiff-line-removed">-     _bucket_count = bucket_count;</span>
<span class="udiff-line-removed">-     _entry_count = entry_count;</span>
<span class="udiff-line-removed">-     _buckets = buckets;</span>
<span class="udiff-line-removed">-     _entries = entries;</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-modified-added">+   void init(address base_address, u4 entry_count, u4 bucket_count, u4* buckets, u4* entries);</span>
  
    // Read/Write the table&#39;s header from/to the CDS archive
    void serialize_header(SerializeClosure* soc) NOT_CDS_RETURN;
  
    inline bool empty() {
      return (_entry_count == 0);
    }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   static size_t calculate_header_size();</span>
  };
  
  template &lt;
    typename K,
    typename V,
</pre>
<center><a href="compactHashtable.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="defaultMethods.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>