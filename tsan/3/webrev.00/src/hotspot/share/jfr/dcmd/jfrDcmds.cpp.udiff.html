<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/jfr/dcmd/jfrDcmds.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../interpreter/templateInterpreter.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrDcmds.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/dcmd/jfrDcmds.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2012, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2012, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -169,12 +169,12 @@</span>
  
  static oop construct_dcmd_instance(JfrJavaArguments* args, TRAPS) {
    assert(args != NULL, &quot;invariant&quot;);
    DEBUG_ONLY(JfrJavaSupport::check_java_thread_in_vm(THREAD));
    assert(args-&gt;klass() != NULL, &quot;invariant&quot;);
<span class="udiff-line-modified-removed">-   args-&gt;set_name(&quot;&lt;init&gt;&quot;, CHECK_NULL);</span>
<span class="udiff-line-modified-removed">-   args-&gt;set_signature(&quot;()V&quot;, CHECK_NULL);</span>
<span class="udiff-line-modified-added">+   args-&gt;set_name(&quot;&lt;init&gt;&quot;);</span>
<span class="udiff-line-modified-added">+   args-&gt;set_signature(&quot;()V&quot;);</span>
    JfrJavaSupport::new_object(args, CHECK_NULL);
    return (oop)args-&gt;result()-&gt;get_jobject();
  }
  
  JfrDumpFlightRecordingDCmd::JfrDumpFlightRecordingDCmd(outputStream* output,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -347,20 +347,22 @@</span>
    _duration(&quot;duration&quot;, &quot;Duration of recording in (s)econds, (m)inutes, (h)ours, or (d)ays, e.g. 300s.&quot;, &quot;NANOTIME&quot;, false, &quot;0&quot;),
    _disk(&quot;disk&quot;, &quot;Recording should be persisted to disk&quot;, &quot;BOOLEAN&quot;, false),
    _filename(&quot;filename&quot;, &quot;Resulting recording filename, e.g. \\\&quot;&quot; JFR_FILENAME_EXAMPLE &quot;\\\&quot;&quot;, &quot;STRING&quot;, false),
    _maxage(&quot;maxage&quot;, &quot;Maximum time to keep recorded data (on disk) in (s)econds, (m)inutes, (h)ours, or (d)ays, e.g. 60m, or 0 for no limit&quot;, &quot;NANOTIME&quot;, false, &quot;0&quot;),
    _maxsize(&quot;maxsize&quot;, &quot;Maximum amount of bytes to keep (on disk) in (k)B, (M)B or (G)B, e.g. 500M, or 0 for no limit&quot;, &quot;MEMORY SIZE&quot;, false, &quot;0&quot;),
<span class="udiff-line-added">+   _flush_interval(&quot;flush-interval&quot;, &quot;Minimum time before flushing buffers, measured in (s)econds, e.g. 4 s, or 0 for flushing when a recording ends&quot;, &quot;NANOTIME&quot;, false, &quot;1s&quot;),</span>
    _dump_on_exit(&quot;dumponexit&quot;, &quot;Dump running recording when JVM shuts down&quot;, &quot;BOOLEAN&quot;, false),
    _path_to_gc_roots(&quot;path-to-gc-roots&quot;, &quot;Collect path to GC roots&quot;, &quot;BOOLEAN&quot;, false, &quot;false&quot;) {
    _dcmdparser.add_dcmd_option(&amp;_name);
    _dcmdparser.add_dcmd_option(&amp;_settings);
    _dcmdparser.add_dcmd_option(&amp;_delay);
    _dcmdparser.add_dcmd_option(&amp;_duration);
    _dcmdparser.add_dcmd_option(&amp;_disk);
    _dcmdparser.add_dcmd_option(&amp;_filename);
    _dcmdparser.add_dcmd_option(&amp;_maxage);
    _dcmdparser.add_dcmd_option(&amp;_maxsize);
<span class="udiff-line-added">+   _dcmdparser.add_dcmd_option(&amp;_flush_interval);</span>
    _dcmdparser.add_dcmd_option(&amp;_dump_on_exit);
    _dcmdparser.add_dcmd_option(&amp;_path_to_gc_roots);
  };
  
  int JfrStartFlightRecordingDCmd::num_arguments() {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -409,10 +411,14 @@</span>
    jobject maxsize = NULL;
    if (_maxsize.is_set()) {
      maxsize = JfrJavaSupport::new_java_lang_Long(_maxsize.value()._size, CHECK);
    }
  
<span class="udiff-line-added">+   jobject flush_interval = NULL;</span>
<span class="udiff-line-added">+   if (_flush_interval.is_set()) {</span>
<span class="udiff-line-added">+     flush_interval = JfrJavaSupport::new_java_lang_Long(_flush_interval.value()._nanotime, CHECK);</span>
<span class="udiff-line-added">+   }</span>
    jobject duration = NULL;
    if (_duration.is_set()) {
      duration = JfrJavaSupport::new_java_lang_Long(_duration.value()._nanotime, CHECK);
    }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -436,11 +442,17 @@</span>
      path_to_gc_roots = JfrJavaSupport::new_java_lang_Boolean(_path_to_gc_roots.value(), CHECK);
    }
  
    jobjectArray settings = NULL;
    if (_settings.is_set()) {
<span class="udiff-line-modified-removed">-     const int length = _settings.value()-&gt;array()-&gt;length();</span>
<span class="udiff-line-modified-added">+     int length = _settings.value()-&gt;array()-&gt;length();</span>
<span class="udiff-line-added">+     if (length == 1) {</span>
<span class="udiff-line-added">+       const char* c_str = _settings.value()-&gt;array()-&gt;at(0);</span>
<span class="udiff-line-added">+       if (strcmp(c_str, &quot;none&quot;) == 0) {</span>
<span class="udiff-line-added">+         length = 0;</span>
<span class="udiff-line-added">+       }</span>
<span class="udiff-line-added">+     }</span>
      settings = JfrJavaSupport::new_string_array(length, CHECK);
      assert(settings != NULL, &quot;invariant&quot;);
      for (int i = 0; i &lt; length; ++i) {
        jobject element = JfrJavaSupport::new_string(_settings.value()-&gt;array()-&gt;at(i), CHECK);
        assert(element != NULL, &quot;invariant&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -456,11 +468,11 @@</span>
  
    static const char klass[] = &quot;jdk/jfr/internal/dcmd/DCmdStart&quot;;
    static const char method[] = &quot;execute&quot;;
    static const char signature[] = &quot;(Ljava/lang/String;[Ljava/lang/String;Ljava/lang/Long;&quot;
      &quot;Ljava/lang/Long;Ljava/lang/Boolean;Ljava/lang/String;&quot;
<span class="udiff-line-modified-removed">-     &quot;Ljava/lang/Long;Ljava/lang/Long;Ljava/lang/Boolean;Ljava/lang/Boolean;)Ljava/lang/String;&quot;;</span>
<span class="udiff-line-modified-added">+     &quot;Ljava/lang/Long;Ljava/lang/Long;Ljava/lang/Long;Ljava/lang/Boolean;Ljava/lang/Boolean;)Ljava/lang/String;&quot;;</span>
  
    JfrJavaArguments execute_args(&amp;result, klass, method, signature, CHECK);
    execute_args.set_receiver(h_dcmd_instance);
  
    // arguments
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -470,10 +482,11 @@</span>
    execute_args.push_jobject(duration);
    execute_args.push_jobject(disk);
    execute_args.push_jobject(filename);
    execute_args.push_jobject(maxage);
    execute_args.push_jobject(maxsize);
<span class="udiff-line-added">+   execute_args.push_jobject(flush_interval);</span>
    execute_args.push_jobject(dump_on_exit);
    execute_args.push_jobject(path_to_gc_roots);
  
    JfrJavaSupport::call_virtual(&amp;execute_args, THREAD);
    handle_dcmd_result(output(), (oop)result.get_jobject(), source, THREAD);
</pre>
<center><a href="../../interpreter/templateInterpreter.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrDcmds.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>