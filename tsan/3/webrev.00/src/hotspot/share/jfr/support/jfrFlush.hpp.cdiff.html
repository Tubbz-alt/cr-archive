<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/jfr/support/jfrFlush.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="jfrFlush.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrIntrinsics.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/support/jfrFlush.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 46,14 ***</span>
  bool jfr_save_stacktrace(Thread* t);
  void jfr_clear_stacktrace(Thread* t);
  
  template &lt;typename Event&gt;
  class JfrConditionalFlush {
   public:
    typedef JfrBuffer Type;
<span class="line-modified">!   JfrConditionalFlush(Thread* t) {</span>
<span class="line-modified">!     if (jfr_is_event_enabled(Event::eventId)) {</span>
        jfr_conditional_flush(Event::eventId, sizeof(Event), t);
      }
    }
  };
  
<span class="line-new-header">--- 46,16 ---</span>
  bool jfr_save_stacktrace(Thread* t);
  void jfr_clear_stacktrace(Thread* t);
  
  template &lt;typename Event&gt;
  class JfrConditionalFlush {
<span class="line-added">+  protected:</span>
<span class="line-added">+   bool _enabled;</span>
   public:
    typedef JfrBuffer Type;
<span class="line-modified">!   JfrConditionalFlush(Thread* t) : _enabled(jfr_is_event_enabled(Event::eventId)) {</span>
<span class="line-modified">!     if (_enabled) {</span>
        jfr_conditional_flush(Event::eventId, sizeof(Event), t);
      }
    }
  };
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 61,11 ***</span>
  class JfrConditionalFlushWithStacktrace : public JfrConditionalFlush&lt;Event&gt; {
    Thread* _t;
    bool _owner;
   public:
    JfrConditionalFlushWithStacktrace(Thread* t) : JfrConditionalFlush&lt;Event&gt;(t), _t(t), _owner(false) {
<span class="line-modified">!     if (Event::has_stacktrace() &amp;&amp; jfr_has_stacktrace_enabled(Event::eventId)) {</span>
        _owner = jfr_save_stacktrace(t);
      }
    }
    ~JfrConditionalFlushWithStacktrace() {
      if (_owner) {
<span class="line-new-header">--- 63,11 ---</span>
  class JfrConditionalFlushWithStacktrace : public JfrConditionalFlush&lt;Event&gt; {
    Thread* _t;
    bool _owner;
   public:
    JfrConditionalFlushWithStacktrace(Thread* t) : JfrConditionalFlush&lt;Event&gt;(t), _t(t), _owner(false) {
<span class="line-modified">!     if (this-&gt;_enabled &amp;&amp; Event::has_stacktrace() &amp;&amp; jfr_has_stacktrace_enabled(Event::eventId)) {</span>
        _owner = jfr_save_stacktrace(t);
      }
    }
    ~JfrConditionalFlushWithStacktrace() {
      if (_owner) {
</pre>
<center><a href="jfrFlush.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrIntrinsics.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>