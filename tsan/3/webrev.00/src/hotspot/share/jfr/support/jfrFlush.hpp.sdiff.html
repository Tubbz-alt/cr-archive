<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/jfr/support/jfrFlush.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="jfrFlush.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrIntrinsics.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/support/jfrFlush.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
31 
32 class Thread;
33 
34 class JfrFlush : public StackObj {
35  public:
36   typedef JfrBuffer Type;
37   JfrFlush(Type* old, size_t used, size_t requested, Thread* t);
38   Type* result() const { return _result; }
39  private:
40   Type* _result;
41 };
42 
43 void jfr_conditional_flush(JfrEventId id, size_t size, Thread* t);
44 bool jfr_is_event_enabled(JfrEventId id);
45 bool jfr_has_stacktrace_enabled(JfrEventId id);
46 bool jfr_save_stacktrace(Thread* t);
47 void jfr_clear_stacktrace(Thread* t);
48 
49 template &lt;typename Event&gt;
50 class JfrConditionalFlush {


51  public:
52   typedef JfrBuffer Type;
<span class="line-modified">53   JfrConditionalFlush(Thread* t) {</span>
<span class="line-modified">54     if (jfr_is_event_enabled(Event::eventId)) {</span>
55       jfr_conditional_flush(Event::eventId, sizeof(Event), t);
56     }
57   }
58 };
59 
60 template &lt;typename Event&gt;
61 class JfrConditionalFlushWithStacktrace : public JfrConditionalFlush&lt;Event&gt; {
62   Thread* _t;
63   bool _owner;
64  public:
65   JfrConditionalFlushWithStacktrace(Thread* t) : JfrConditionalFlush&lt;Event&gt;(t), _t(t), _owner(false) {
<span class="line-modified">66     if (Event::has_stacktrace() &amp;&amp; jfr_has_stacktrace_enabled(Event::eventId)) {</span>
67       _owner = jfr_save_stacktrace(t);
68     }
69   }
70   ~JfrConditionalFlushWithStacktrace() {
71     if (_owner) {
72       jfr_clear_stacktrace(_t);
73     }
74   }
75 };
76 
77 #endif // SHARE_JFR_SUPPORT_JFRFLUSH_HPP
</pre>
</td>
<td>
<hr />
<pre>
31 
32 class Thread;
33 
34 class JfrFlush : public StackObj {
35  public:
36   typedef JfrBuffer Type;
37   JfrFlush(Type* old, size_t used, size_t requested, Thread* t);
38   Type* result() const { return _result; }
39  private:
40   Type* _result;
41 };
42 
43 void jfr_conditional_flush(JfrEventId id, size_t size, Thread* t);
44 bool jfr_is_event_enabled(JfrEventId id);
45 bool jfr_has_stacktrace_enabled(JfrEventId id);
46 bool jfr_save_stacktrace(Thread* t);
47 void jfr_clear_stacktrace(Thread* t);
48 
49 template &lt;typename Event&gt;
50 class JfrConditionalFlush {
<span class="line-added">51  protected:</span>
<span class="line-added">52   bool _enabled;</span>
53  public:
54   typedef JfrBuffer Type;
<span class="line-modified">55   JfrConditionalFlush(Thread* t) : _enabled(jfr_is_event_enabled(Event::eventId)) {</span>
<span class="line-modified">56     if (_enabled) {</span>
57       jfr_conditional_flush(Event::eventId, sizeof(Event), t);
58     }
59   }
60 };
61 
62 template &lt;typename Event&gt;
63 class JfrConditionalFlushWithStacktrace : public JfrConditionalFlush&lt;Event&gt; {
64   Thread* _t;
65   bool _owner;
66  public:
67   JfrConditionalFlushWithStacktrace(Thread* t) : JfrConditionalFlush&lt;Event&gt;(t), _t(t), _owner(false) {
<span class="line-modified">68     if (this-&gt;_enabled &amp;&amp; Event::has_stacktrace() &amp;&amp; jfr_has_stacktrace_enabled(Event::eventId)) {</span>
69       _owner = jfr_save_stacktrace(t);
70     }
71   }
72   ~JfrConditionalFlushWithStacktrace() {
73     if (_owner) {
74       jfr_clear_stacktrace(_t);
75     }
76   }
77 };
78 
79 #endif // SHARE_JFR_SUPPORT_JFRFLUSH_HPP
</pre>
</td>
</tr>
</table>
<center><a href="jfrFlush.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrIntrinsics.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>