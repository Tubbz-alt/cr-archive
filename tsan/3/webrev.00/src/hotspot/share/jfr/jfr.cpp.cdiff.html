<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/jfr/jfr.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="instrumentation/jfrJvmtiAgent.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="jfr.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/jfr.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 43,19 ***</span>
  
  bool Jfr::is_recording() {
    return JfrRecorder::is_recording();
  }
  
<span class="line-modified">! void Jfr::on_vm_init() {</span>
<span class="line-modified">!   if (!JfrRecorder::on_vm_init()) {</span>
<span class="line-modified">!     vm_exit_during_initialization(&quot;Failure when starting JFR on_vm_init&quot;);</span>
    }
  }
  
<span class="line-modified">! void Jfr::on_vm_start() {</span>
<span class="line-modified">!   if (!JfrRecorder::on_vm_start()) {</span>
<span class="line-modified">!     vm_exit_during_initialization(&quot;Failure when starting JFR on_vm_start&quot;);</span>
    }
  }
  
  void Jfr::on_unloading_classes() {
    if (JfrRecorder::is_created()) {
<span class="line-new-header">--- 43,25 ---</span>
  
  bool Jfr::is_recording() {
    return JfrRecorder::is_recording();
  }
  
<span class="line-modified">! void Jfr::on_create_vm_1() {</span>
<span class="line-modified">!   if (!JfrRecorder::on_create_vm_1()) {</span>
<span class="line-modified">!     vm_exit_during_initialization(&quot;Failure when starting JFR on_create_vm_1&quot;);</span>
    }
  }
  
<span class="line-modified">! void Jfr::on_create_vm_2() {</span>
<span class="line-modified">!   if (!JfrRecorder::on_create_vm_2()) {</span>
<span class="line-modified">!     vm_exit_during_initialization(&quot;Failure when starting JFR on_create_vm_2&quot;);</span>
<span class="line-added">+   }</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ void Jfr::on_create_vm_3() {</span>
<span class="line-added">+   if (!JfrRecorder::on_create_vm_3()) {</span>
<span class="line-added">+     vm_exit_during_initialization(&quot;Failure when starting JFR on_create_vm_3&quot;);</span>
    }
  }
  
  void Jfr::on_unloading_classes() {
    if (JfrRecorder::is_created()) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 69,10 ***</span>
<span class="line-new-header">--- 75,22 ---</span>
  
  void Jfr::on_thread_exit(Thread* t) {
    JfrThreadLocal::on_exit(t);
  }
  
<span class="line-added">+ void Jfr::exclude_thread(Thread* t) {</span>
<span class="line-added">+   JfrThreadLocal::exclude(t);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ void Jfr::include_thread(Thread* t) {</span>
<span class="line-added">+   JfrThreadLocal::include(t);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ bool Jfr::is_excluded(Thread* t) {</span>
<span class="line-added">+   return t != NULL &amp;&amp; t-&gt;jfr_thread_local()-&gt;is_excluded();</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  void Jfr::on_java_thread_dismantle(JavaThread* jt) {
    if (JfrRecorder::is_recording()) {
      JfrCheckpointManager::write_thread_checkpoint(jt);
    }
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 82,11 ***</span>
      JfrEmergencyDump::on_vm_shutdown(exception_handler);
    }
  }
  
  void Jfr::weak_oops_do(BoolObjectClosure* is_alive, OopClosure* f) {
<span class="line-modified">!   LeakProfiler::oops_do(is_alive, f);</span>
  }
  
  bool Jfr::on_flight_recorder_option(const JavaVMOption** option, char* delimiter) {
    return JfrOptionSet::parse_flight_recorder_option(option, delimiter);
  }
<span class="line-new-header">--- 100,13 ---</span>
      JfrEmergencyDump::on_vm_shutdown(exception_handler);
    }
  }
  
  void Jfr::weak_oops_do(BoolObjectClosure* is_alive, OopClosure* f) {
<span class="line-modified">!   if (LeakProfiler::is_running()) {</span>
<span class="line-added">+     LeakProfiler::weak_oops_do(is_alive, f);</span>
<span class="line-added">+   }</span>
  }
  
  bool Jfr::on_flight_recorder_option(const JavaVMOption** option, char* delimiter) {
    return JfrOptionSet::parse_flight_recorder_option(option, delimiter);
  }
</pre>
<center><a href="instrumentation/jfrJvmtiAgent.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="jfr.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>