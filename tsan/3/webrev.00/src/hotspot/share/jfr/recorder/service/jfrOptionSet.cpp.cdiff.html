<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/jfr/recorder/service/jfrOptionSet.cpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../repository/jfrRepository.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="jfrOptionSet.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/recorder/service/jfrOptionSet.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2012, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2012, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 25,10 ***</span>
<span class="line-new-header">--- 25,11 ---</span>
  #include &quot;precompiled.hpp&quot;
  #include &quot;jfr/dcmd/jfrDcmds.hpp&quot;
  #include &quot;jfr/recorder/service/jfrMemorySizer.hpp&quot;
  #include &quot;jfr/recorder/service/jfrOptionSet.hpp&quot;
  #include &quot;jfr/utilities/jfrAllocation.hpp&quot;
<span class="line-added">+ #include &quot;jfr/utilities/jfrTypes.hpp&quot;</span>
  #include &quot;logging/log.hpp&quot;
  #include &quot;memory/allocation.inline.hpp&quot;
  #include &quot;memory/resourceArea.hpp&quot;
  #include &quot;runtime/java.hpp&quot;
  #include &quot;runtime/thread.inline.hpp&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 104,14 ***</span>
  
  u4 JfrOptionSet::stackdepth() {
    return _stack_depth;
  }
  
<span class="line-removed">- static const u4 STACK_DEPTH_DEFAULT = 64;</span>
<span class="line-removed">- static const u4 MIN_STACK_DEPTH = 1;</span>
<span class="line-removed">- static const u4 MAX_STACK_DEPTH = 2048;</span>
<span class="line-removed">- </span>
  void JfrOptionSet::set_stackdepth(u4 depth) {
    if (depth &lt; MIN_STACK_DEPTH) {
      _stack_depth = MIN_STACK_DEPTH;
    } else if (depth &gt; MAX_STACK_DEPTH) {
      _stack_depth = MAX_STACK_DEPTH;
<span class="line-new-header">--- 105,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 678,11 ***</span>
      *delimiter = &#39;=&#39;;
    }
    return false;
  }
  
<span class="line-modified">! static GrowableArray&lt;const char*&gt;* startup_recording_options_array = NULL;</span>
  
  bool JfrOptionSet::parse_start_flight_recording_option(const JavaVMOption** option, char* delimiter) {
    assert(option != NULL, &quot;invariant&quot;);
    assert(delimiter != NULL, &quot;invariant&quot;);
    assert((*option)-&gt;optionString != NULL, &quot;invariant&quot;);
<span class="line-new-header">--- 675,11 ---</span>
      *delimiter = &#39;=&#39;;
    }
    return false;
  }
  
<span class="line-modified">! static GrowableArray&lt;const char*&gt;* start_flight_recording_options_array = NULL;</span>
  
  bool JfrOptionSet::parse_start_flight_recording_option(const JavaVMOption** option, char* delimiter) {
    assert(option != NULL, &quot;invariant&quot;);
    assert(delimiter != NULL, &quot;invariant&quot;);
    assert((*option)-&gt;optionString != NULL, &quot;invariant&quot;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 701,30 ***</span>
      value = delimiter + 1;
    }
    assert(value != NULL, &quot;invariant&quot;);
    const size_t value_length = strlen(value);
  
<span class="line-modified">!   if (startup_recording_options_array == NULL) {</span>
<span class="line-modified">!     startup_recording_options_array = new (ResourceObj::C_HEAP, mtTracing) GrowableArray&lt;const char*&gt;(8, true, mtTracing);</span>
    }
<span class="line-modified">!   assert(startup_recording_options_array != NULL, &quot;invariant&quot;);</span>
    char* const startup_value = NEW_C_HEAP_ARRAY(char, value_length + 1, mtTracing);
    strncpy(startup_value, value, value_length + 1);
    assert(strncmp(startup_value, value, value_length) == 0, &quot;invariant&quot;);
<span class="line-modified">!   startup_recording_options_array-&gt;append(startup_value);</span>
    return false;
  }
  
<span class="line-modified">! const GrowableArray&lt;const char*&gt;* JfrOptionSet::startup_recording_options() {</span>
<span class="line-modified">!   return startup_recording_options_array;</span>
  }
  
<span class="line-modified">! void JfrOptionSet::release_startup_recording_options() {</span>
<span class="line-modified">!   if (startup_recording_options_array != NULL) {</span>
<span class="line-modified">!     const int length = startup_recording_options_array-&gt;length();</span>
      for (int i = 0; i &lt; length; ++i) {
<span class="line-modified">!       FREE_C_HEAP_ARRAY(char, startup_recording_options_array-&gt;at(i));</span>
      }
<span class="line-modified">!     delete startup_recording_options_array;</span>
<span class="line-modified">!     startup_recording_options_array = NULL;</span>
    }
  }
<span class="line-new-header">--- 698,30 ---</span>
      value = delimiter + 1;
    }
    assert(value != NULL, &quot;invariant&quot;);
    const size_t value_length = strlen(value);
  
<span class="line-modified">!   if (start_flight_recording_options_array == NULL) {</span>
<span class="line-modified">!     start_flight_recording_options_array = new (ResourceObj::C_HEAP, mtTracing) GrowableArray&lt;const char*&gt;(8, true, mtTracing);</span>
    }
<span class="line-modified">!   assert(start_flight_recording_options_array != NULL, &quot;invariant&quot;);</span>
    char* const startup_value = NEW_C_HEAP_ARRAY(char, value_length + 1, mtTracing);
    strncpy(startup_value, value, value_length + 1);
    assert(strncmp(startup_value, value, value_length) == 0, &quot;invariant&quot;);
<span class="line-modified">!   start_flight_recording_options_array-&gt;append(startup_value);</span>
    return false;
  }
  
<span class="line-modified">! const GrowableArray&lt;const char*&gt;* JfrOptionSet::start_flight_recording_options() {</span>
<span class="line-modified">!   return start_flight_recording_options_array;</span>
  }
  
<span class="line-modified">! void JfrOptionSet::release_start_flight_recording_options() {</span>
<span class="line-modified">!   if (start_flight_recording_options_array != NULL) {</span>
<span class="line-modified">!     const int length = start_flight_recording_options_array-&gt;length();</span>
      for (int i = 0; i &lt; length; ++i) {
<span class="line-modified">!       FREE_C_HEAP_ARRAY(char, start_flight_recording_options_array-&gt;at(i));</span>
      }
<span class="line-modified">!     delete start_flight_recording_options_array;</span>
<span class="line-modified">!     start_flight_recording_options_array = NULL;</span>
    }
  }
</pre>
<center><a href="../repository/jfrRepository.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="jfrOptionSet.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>