<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/jfr/recorder/checkpoint/types/traceid/jfrTraceIdMacros.hpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="jfrTraceIdEpoch.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../jfrRecorder.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/recorder/checkpoint/types/traceid/jfrTraceIdMacros.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -23,165 +23,127 @@</span>
   */
  
  #ifndef SHARE_JFR_RECORDER_CHECKPOINT_TYPES_TRACEID_JFRTRACEIDMACROS_HPP
  #define SHARE_JFR_RECORDER_CHECKPOINT_TYPES_TRACEID_JFRTRACEIDMACROS_HPP
  
<span class="udiff-line-removed">- #include &quot;jfr/recorder/checkpoint/types/traceid/jfrTraceIdBits.inline.hpp&quot;</span>
<span class="udiff-line-removed">- #include &quot;jfr/recorder/checkpoint/types/traceid/jfrTraceIdEpoch.hpp&quot;</span>
<span class="udiff-line-removed">- #include &quot;jfr/support/jfrKlassExtension.hpp&quot;</span>
<span class="udiff-line-removed">- #include &quot;utilities/globalDefinitions.hpp&quot;</span>
<span class="udiff-line-removed">- </span>
  /**
   *
   * If a traceid is used, depending on epoch, either the first or the second bit is tagged.
   * If a class member (method) is used, either the third or fourth bit is tagged.
   * Which bit to set is a function of the epoch. This allows for concurrent tagging.
   *
<span class="udiff-line-modified-removed">-  * LeakProfiler subsystem gets its own byte and uses the same tagging scheme but is shifted up 8.</span>
<span class="udiff-line-removed">-  *</span>
<span class="udiff-line-removed">-  * We also tag the individual method by using the TraceFlag field,</span>
<span class="udiff-line-modified-added">+  * We also tag individual methods by using the _trace_flags field,</span>
   * (see jfr/support/jfrTraceIdExtension.hpp for details)
   *
   */
  
<span class="udiff-line-modified-removed">- // these are defined in jfr/support/jfrKlassExtension.hpp</span>
<span class="udiff-line-modified-added">+ // the following are defined in jfr/support/jfrKlassExtension.hpp</span>
  //
<span class="udiff-line-modified-removed">- // #define JDK_JFR_EVENT_SUBKLASS  16</span>
<span class="udiff-line-modified-removed">- // #define JDK_JFR_EVENT_KLASS     32</span>
<span class="udiff-line-modified-removed">- // #define EVENT_HOST_KLASS        64</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define IS_JDK_JFR_EVENT_SUBKLASS(ptr) (((ptr)-&gt;trace_id() &amp; (JDK_JFR_EVENT_SUBKLASS)) != 0)</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define ANY_USED_BITS (USED_EPOCH_2_BIT         | \</span>
<span class="udiff-line-modified-removed">-                        USED_EPOCH_1_BIT         | \</span>
<span class="udiff-line-modified-removed">-                        METHOD_USED_EPOCH_2_BIT  | \</span>
<span class="udiff-line-modified-removed">-                        METHOD_USED_EPOCH_1_BIT  | \</span>
<span class="udiff-line-modified-removed">-                        LEAKP_USED_EPOCH_2_BIT   | \</span>
<span class="udiff-line-modified-removed">-                        LEAKP_USED_EPOCH_1_BIT)</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define TRACE_ID_META_BITS (EVENT_HOST_KLASS | JDK_JFR_EVENT_KLASS | JDK_JFR_EVENT_SUBKLASS | ANY_USED_BITS)</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define ANY_EVENT                       (EVENT_HOST_KLASS | JDK_JFR_EVENT_KLASS | JDK_JFR_EVENT_SUBKLASS)</span>
<span class="udiff-line-modified-removed">- #define IS_JDK_JFR_EVENT_KLASS(ptr)     (((ptr)-&gt;trace_id() &amp; JDK_JFR_EVENT_KLASS) != 0)</span>
<span class="udiff-line-modified-removed">- #define IS_EVENT_HOST_KLASS(ptr)        (((ptr)-&gt;trace_id() &amp; EVENT_HOST_KLASS) != 0)</span>
<span class="udiff-line-modified-removed">- #define IS_NOT_AN_EVENT_KLASS(ptr)      (!IS_EVENT_KLASS(ptr))</span>
<span class="udiff-line-modified-removed">- #define IS_NOT_AN_EVENT_SUB_KLASS(ptr)  (!IS_JDK_JFR_EVENT_SUBKLASS(ptr))</span>
<span class="udiff-line-modified-removed">- #define IS_NOT_JDK_JFR_EVENT_KLASS(ptr) (!IS_JDK_JFR_EVENT_KLASS(ptr))</span>
<span class="udiff-line-modified-removed">- #define EVENT_FLAGS_MASK(ptr)           (((ptr)-&gt;trace_id() &amp; ANY_EVENT) != 0)</span>
<span class="udiff-line-modified-removed">- #define UNEVENT(ptr)                    ((ptr)-&gt;set_trace_id(((ptr)-&gt;trace_id()) &amp; ~ANY_EVENT))</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define TRACE_ID_SHIFT 16</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define TRACE_ID_MASKED(id)             (id &amp; ~TRACE_ID_META_BITS)</span>
<span class="udiff-line-modified-removed">- #define TRACE_ID_VALUE(id)              (TRACE_ID_MASKED(id) &gt;&gt; TRACE_ID_SHIFT)</span>
<span class="udiff-line-modified-removed">- #define TRACE_ID_MASKED_PTR(ptr)        (TRACE_ID_MASKED((ptr)-&gt;trace_id()))</span>
<span class="udiff-line-modified-removed">- #define TRACE_ID_RAW(ptr)               ((ptr)-&gt;trace_id())</span>
<span class="udiff-line-modified-removed">- #define TRACE_ID(ptr)                   (TRACE_ID_MASKED_PTR(ptr) &gt;&gt; TRACE_ID_SHIFT)</span>
<span class="udiff-line-modified-removed">- #define METHOD_ID(kls, meth)            (TRACE_ID_MASKED_PTR(kls) | (meth)-&gt;method_idnum())</span>
<span class="udiff-line-modified-removed">- #define SET_TAG(ptr, tag)               (set_traceid_bits(tag, (ptr)-&gt;trace_id_addr()))</span>
<span class="udiff-line-modified-removed">- #define SET_LEAKP_TAG(ptr, tag)         (set_leakp_traceid_bits(tag, (ptr)-&gt;trace_id_addr()))</span>
<span class="udiff-line-modified-removed">- #define SET_TAG_CAS(ptr, tag)           (set_traceid_bits_cas(tag, (ptr)-&gt;trace_id_addr()))</span>
<span class="udiff-line-modified-removed">- #define SET_LEAKP_TAG_CAS(ptr, tag)     (set_leakp_traceid_bits_cas(tag, (ptr)-&gt;trace_id_addr()))</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define IN_USE_THIS_EPOCH_BIT           (JfrTraceIdEpoch::in_use_this_epoch_bit())</span>
<span class="udiff-line-modified-removed">- #define IN_USE_PREV_EPOCH_BIT           (JfrTraceIdEpoch::in_use_prev_epoch_bit())</span>
<span class="udiff-line-modified-removed">- #define LEAKP_IN_USE_THIS_EPOCH_BIT     (JfrTraceIdEpoch::leakp_in_use_this_epoch_bit())</span>
<span class="udiff-line-modified-removed">- #define LEAKP_IN_USE_PREV_EPOCH_BIT     (JfrTraceIdEpoch::leakp_in_use_prev_epoch_bit())</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define METHOD_IN_USE_THIS_EPOCH_BIT    (JfrTraceIdEpoch::method_in_use_this_epoch_bit())</span>
<span class="udiff-line-modified-removed">- #define METHOD_IN_USE_PREV_EPOCH_BIT    (JfrTraceIdEpoch::method_in_use_prev_epoch_bit())</span>
<span class="udiff-line-modified-removed">- #define METHOD_AND_CLASS_IN_USE_THIS_EPOCH_BITS (JfrTraceIdEpoch::method_and_class_in_use_this_epoch_bits())</span>
<span class="udiff-line-modified-removed">- #define METHOD_AND_CLASS_IN_USE_PREV_EPOCH_BITS (JfrTraceIdEpoch::method_and_class_in_use_prev_epoch_bits())</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define UNUSE_THIS_EPOCH_MASK           (~(IN_USE_THIS_EPOCH_BIT))</span>
<span class="udiff-line-modified-removed">- #define UNUSE_PREV_EPOCH_MASK           (~(IN_USE_PREV_EPOCH_BIT))</span>
<span class="udiff-line-modified-removed">- #define LEAKP_UNUSE_THIS_EPOCH_MASK     UNUSE_THIS_EPOCH_MASK</span>
<span class="udiff-line-modified-removed">- #define LEAKP_UNUSE_PREV_EPOCH_MASK     UNUSE_PREV_EPOCH_MASK</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define UNUSE_METHOD_THIS_EPOCH_MASK    (~(METHOD_IN_USE_THIS_EPOCH_BIT))</span>
<span class="udiff-line-modified-removed">- #define UNUSE_METHOD_PREV_EPOCH_MASK    (~(METHOD_IN_USE_PREV_EPOCH_BIT))</span>
<span class="udiff-line-modified-removed">- #define LEAKP_UNUSE_METHOD_THIS_EPOCH_MASK (~(UNUSE_METHOD_THIS_EPOCH_MASK))</span>
<span class="udiff-line-modified-removed">- #define LEAKP_UNUSE_METHOD_PREV_EPOCH_MASK (~UNUSE_METHOD_PREV_EPOCH_MASK))</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define UNUSE_METHOD_AND_CLASS_THIS_EPOCH_MASK (~(METHOD_IN_USE_THIS_EPOCH_BIT | IN_USE_THIS_EPOCH_BIT))</span>
<span class="udiff-line-modified-removed">- #define UNUSE_METHOD_AND_CLASS_PREV_EPOCH_MASK (~(METHOD_IN_USE_PREV_EPOCH_BIT | IN_USE_PREV_EPOCH_BIT))</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define SET_USED_THIS_EPOCH(ptr)        (SET_TAG(ptr, IN_USE_THIS_EPOCH_BIT))</span>
<span class="udiff-line-modified-removed">- #define SET_USED_PREV_EPOCH(ptr)        (SET_TAG_CAS(ptr, IN_USE_PREV_EPOCH_BIT))</span>
<span class="udiff-line-modified-removed">- #define SET_LEAKP_USED_THIS_EPOCH(ptr)  (SET_LEAKP_TAG(ptr, IN_USE_THIS_EPOCH_BIT))</span>
<span class="udiff-line-modified-removed">- #define SET_LEAKP_USED_PREV_EPOCH(ptr)  (SET_LEAKP_TAG(ptr, IN_USE_PREV_EPOCH_BIT))</span>
<span class="udiff-line-modified-removed">- #define SET_METHOD_AND_CLASS_USED_THIS_EPOCH(kls) (SET_TAG(kls, METHOD_AND_CLASS_IN_USE_THIS_EPOCH_BITS))</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define USED_THIS_EPOCH(ptr)            (((ptr)-&gt;trace_id() &amp; IN_USE_THIS_EPOCH_BIT) != 0)</span>
<span class="udiff-line-modified-removed">- #define NOT_USED_THIS_EPOCH(ptr)        (!USED_THIS_EPOCH(ptr))</span>
<span class="udiff-line-modified-removed">- #define USED_PREV_EPOCH(ptr)            (((ptr)-&gt;trace_id() &amp; IN_USE_PREV_EPOCH_BIT) != 0)</span>
<span class="udiff-line-modified-removed">- #define NOT_USED_PREV_EPOCH(ptr)        (!USED_PREV_EPOCH(ptr))</span>
<span class="udiff-line-modified-removed">- #define USED_ANY_EPOCH(ptr)             (((ptr)-&gt;trace_id() &amp; (USED_EPOCH_2_BIT | USED_EPOCH_1_BIT)) != 0)</span>
<span class="udiff-line-modified-removed">- #define NOT_USED_ANY_EPOCH(ptr)         (!USED_ANY_EPOCH(ptr))</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define LEAKP_USED_THIS_EPOCH(ptr)      (((ptr)-&gt;trace_id() &amp; LEAKP_IN_USE_THIS_EPOCH_BIT) != 0)</span>
<span class="udiff-line-modified-removed">- #define LEAKP_NOT_USED_THIS_EPOCH(ptr)  (!LEAKP_USED_THIS_EPOCH(ptr))</span>
<span class="udiff-line-modified-removed">- #define LEAKP_USED_PREV_EPOCH(ptr)      (((ptr)-&gt;trace_id() &amp; LEAKP_IN_USE_PREV_EPOCH_BIT) != 0)</span>
<span class="udiff-line-modified-removed">- #define LEAKP_NOT_USED_PREV_EPOCH(ptr)  (!LEAKP_USED_PREV_EPOCH(ptr))</span>
<span class="udiff-line-modified-removed">- #define LEAKP_USED_ANY_EPOCH(ptr)       (((ptr)-&gt;trace_id() &amp; (LEAKP_USED_EPOCH_2_BIT | LEAKP_USED_EPOCH_1_BIT)) != 0)</span>
<span class="udiff-line-modified-removed">- #define LEAKP_NOT_USED_ANY_EPOCH(ptr)   (!LEAKP_USED_ANY_EPOCH(ptr))</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define ANY_USED_THIS_EPOCH(ptr)        (((ptr)-&gt;trace_id() &amp; (LEAKP_IN_USE_THIS_EPOCH_BIT | IN_USE_THIS_EPOCH_BIT)) != 0)</span>
<span class="udiff-line-modified-removed">- #define ANY_NOT_USED_THIS_EPOCH(ptr)    (!ANY_USED_THIS_EPOCH(ptr))</span>
<span class="udiff-line-modified-removed">- #define ANY_USED_PREV_EPOCH(ptr)        (((ptr)-&gt;trace_id() &amp; (LEAKP_IN_USE_PREV_EPOCH_BIT | IN_USE_PREV_EPOCH_BIT)) != 0)</span>
<span class="udiff-line-modified-removed">- #define ANY_NOT_USED_PREV_EPOCH(ptr)    (!ANY_USED_PREV_EPOCH(ptr))</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define METHOD_USED_THIS_EPOCH(kls)     (((kls)-&gt;trace_id() &amp; METHOD_IN_USE_THIS_EPOCH_BIT) != 0)</span>
<span class="udiff-line-modified-removed">- #define METHOD_NOT_USED_THIS_EPOCH(kls) (!METHOD_USED_THIS_EPOCH(kls))</span>
<span class="udiff-line-modified-removed">- #define METHOD_USED_PREV_EPOCH(kls)     (((kls)-&gt;trace_id() &amp; METHOD_IN_USE_PREV_EPOCH_BIT) != 0)</span>
<span class="udiff-line-modified-removed">- #define METHOD_NOT_USED_PREV_EPOCH(kls) (!METHOD_USED_PREV_EPOCH(kls))</span>
<span class="udiff-line-modified-removed">- #define METHOD_USED_ANY_EPOCH(kls)      (((kls)-&gt;trace_id() &amp; (METHOD_IN_USE_PREV_EPOCH_BIT | METHOD_IN_USE_THIS_EPOCH_BIT)) != 0)</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define METHOD_NOT_USED_ANY_EPOCH(kls)  (!METHOD_USED_ANY_EPOCH(kls))</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define METHOD_AND_CLASS_USED_THIS_EPOCH(kls) ((((kls)-&gt;trace_id() &amp; METHOD_AND_CLASS_IN_USE_THIS_EPOCH_BITS) == \</span>
<span class="udiff-line-modified-removed">-                                                                      METHOD_AND_CLASS_IN_USE_THIS_EPOCH_BITS) != 0)</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define METHOD_AND_CLASS_USED_PREV_EPOCH(kls) ((((kls)-&gt;trace_id() &amp; METHOD_AND_CLASS_IN_USE_PREV_EPOCH_BITS) == \</span>
<span class="udiff-line-modified-removed">-                                                                      METHOD_AND_CLASS_IN_USE_PREV_EPOCH_BITS) != 0)</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define METHOD_AND_CLASS_USED_ANY_EPOCH(kls)     ((METHOD_USED_ANY_EPOCH(kls) &amp;&amp; USED_ANY_EPOCH(kls)) != 0)</span>
<span class="udiff-line-modified-removed">- #define METHOD_AND_CLASS_NOT_USED_ANY_EPOCH(kls) (!METHOD_AND_CLASS_USED_ANY_EPOCH(kls))</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define LEAKP_METHOD_IN_USE_THIS_EPOCH  (LEAKP_IN_USE_THIS_EPOCH_BIT | METHOD_IN_USE_THIS_EPOCH_BIT)</span>
<span class="udiff-line-modified-removed">- #define LEAKP_METHOD_IN_USE_PREV_EPOCH  (LEAKP_IN_USE_PREV_EPOCH_BIT | METHOD_IN_USE_PREV_EPOCH_BIT)</span>
<span class="udiff-line-modified-removed">- #define LEAKP_METHOD_USED_THIS_EPOCH(ptr)  ((((ptr)-&gt;trace_id() &amp; LEAKP_METHOD_IN_USE_THIS_EPOCH) == \</span>
<span class="udiff-line-modified-removed">-                                                                   LEAKP_METHOD_IN_USE_THIS_EPOCH) != 0)</span>
<span class="udiff-line-modified-removed">- #define LEAKP_METHOD_NOT_USED_THIS_EPOCH(kls) (!LEAKP_METHOD_USED_THIS_EPOCH(kls))</span>
<span class="udiff-line-removed">- #define LEAKP_METHOD_USED_PREV_EPOCH(ptr)  ((((ptr)-&gt;trace_id() &amp; LEAKP_METHOD_IN_USE_PREV_EPOCH) == \</span>
<span class="udiff-line-removed">-                                                                   LEAKP_METHOD_IN_USE_PREV_EPOCH) != 0)</span>
<span class="udiff-line-removed">- #define LEAKP_METHOD_NOT_USED_PREV_EPOCH(kls) (!LEAKP_METHOD_USED_PREV_EPOCH(kls))</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- #define UNUSE_THIS_EPOCH(ptr)           (set_traceid_mask(UNUSE_THIS_EPOCH_MASK, (ptr)-&gt;trace_id_addr()))</span>
<span class="udiff-line-removed">- #define UNUSE_PREV_EPOCH(ptr)           (set_traceid_mask(UNUSE_PREV_EPOCH_MASK, (ptr)-&gt;trace_id_addr()))</span>
<span class="udiff-line-removed">- #define UNUSE_METHOD_THIS_EPOCH(kls)    (set_traceid_mask(UNUSE_METHOD_THIS_EPOCH_MASK, (kls)-&gt;trace_id_addr()))</span>
<span class="udiff-line-removed">- #define UNUSE_METHOD_PREV_EPOCH(kls)    (set_traceid_mask(UNUSE_METHOD_PREV_EPOCH_MASK, (kls)-&gt;trace_id_addr()))</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- #define LEAKP_UNUSE_THIS_EPOCH(ptr)     (set_leakp_traceid_mask(UNUSE_THIS_EPOCH_MASK, (ptr)-&gt;trace_id_addr()))</span>
<span class="udiff-line-removed">- #define LEAKP_UNUSE_PREV_EPOCH(ptr)     (set_leakp_traceid_mask(UNUSE_PREV_EPOCH_MASK, (ptr)-&gt;trace_id_addr()))</span>
<span class="udiff-line-removed">- #define LEAKP_UNUSE_METHOD_THIS_EPOCH(kls) (set_leakp_traceid_mask(UNUSE_METHOD_THIS_EPOCH_MASK, (kls)-&gt;trace_id_addr()))</span>
<span class="udiff-line-removed">- #define LEAKP_UNUSE_METHOD_PREV_EPOCH(kls) (set_leakp_traceid_mask(UNUSE_METHOD_PREV_EPOCH_MASK, (kls)-&gt;trace_id_addr()))</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- #define ANY_USED(ptr)                   (((ptr)-&gt;trace_id() &amp; ANY_USED_BITS) != 0)</span>
<span class="udiff-line-removed">- #define ANY_NOT_USED(ptr)               (!ANY_USED(ptr))</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- #define UNUSE_METHOD_AND_CLASS_THIS_EPOCH(kls) (set_traceid_mask(UNUSE_METHOD_AND_CLASS_THIS_EPOCH_MASK, (kls)-&gt;trace_id_addr()))</span>
<span class="udiff-line-removed">- #define LEAKP_UNUSE_METHOD_AND_CLASS_THIS_EPOCH(kls) (set_leakp_traceid_mask(UNUSE_METHOD_AND_CLASS_THIS_EPOCH_MASK, (kls)-&gt;trace_id_addr()))</span>
<span class="udiff-line-removed">- #define UNUSE_METHOD_AND_CLASS_PREV_EPOCH(kls) (set_traceid_mask(UNUSE_METHOD_AND_CLASS_PREV_EPOCH_MASK, (kls)-&gt;trace_id_addr()))</span>
<span class="udiff-line-removed">- #define LEAKP_UNUSE_METHODS_AND_CLASS_PREV_EPOCH(kls) (set_leakp_traceid_mask(UNUSE_METHOD_AND_CLASS_PREV_EPOCH_MASK, (kls)-&gt;trace_id_addr()))</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- #define METHOD_FLAG_USED_THIS_EPOCH(m)       ((m)-&gt;is_trace_flag_set((jbyte)JfrTraceIdEpoch::in_use_this_epoch_bit()))</span>
<span class="udiff-line-removed">- #define METHOD_FLAG_NOT_USED_THIS_EPOCH(m)   (!METHOD_FLAG_USED_THIS_EPOCH(m))</span>
<span class="udiff-line-removed">- #define SET_METHOD_FLAG_USED_THIS_EPOCH(m)   ((m)-&gt;set_trace_flag((jbyte)JfrTraceIdEpoch::in_use_this_epoch_bit()))</span>
<span class="udiff-line-removed">- #define METHOD_FLAG_USED_PREV_EPOCH(m)       ((m)-&gt;is_trace_flag_set((jbyte)JfrTraceIdEpoch::in_use_prev_epoch_bit()))</span>
<span class="udiff-line-removed">- #define METHOD_FLAG_NOT_USED_PREV_EPOCH(m)   (!METHOD_FLAG_USED_PREV_EPOCH(m))</span>
<span class="udiff-line-removed">- #define METHOD_FLAG_USED_ANY_EPOCH(m)        ((METHOD_FLAG_USED_THIS_EPOCH(m) || METHOD_FLAG_USED_PREV_EPOCH(m)) != 0)</span>
<span class="udiff-line-removed">- #define METHOD_FLAG_NOT_USED_ANY_EPOCH(m)    ((METHOD_FLAG_NOT_USED_THIS_EPOCH(m) &amp;&amp; METHOD_FLAG_NOT_USED_PREV_EPOCH(m)) != 0)</span>
<span class="udiff-line-removed">- #define CLEAR_METHOD_FLAG_USED_THIS_EPOCH(m) (clear_bits_cas((jbyte)JfrTraceIdEpoch::in_use_this_epoch_bit(), (m)-&gt;trace_flags_addr()))</span>
<span class="udiff-line-removed">- #define CLEAR_METHOD_FLAG_USED_PREV_EPOCH(m) (clear_bits_cas((jbyte)JfrTraceIdEpoch::in_use_prev_epoch_bit(), (m)-&gt;trace_flags_addr()))</span>
<span class="udiff-line-modified-added">+ // #define JDK_JFR_EVENT_SUBKLASS                 16</span>
<span class="udiff-line-modified-added">+ // #define JDK_JFR_EVENT_KLASS                    32</span>
<span class="udiff-line-modified-added">+ // #define EVENT_HOST_KLASS                       64</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ // static bits</span>
<span class="udiff-line-modified-added">+ #define META_SHIFT                                8</span>
<span class="udiff-line-modified-added">+ #define EPOCH_1_CLEARED_META_BIT                  USED_BIT</span>
<span class="udiff-line-modified-added">+ #define EPOCH_1_CLEARED_BIT                       (EPOCH_1_CLEARED_META_BIT &lt;&lt; META_SHIFT)</span>
<span class="udiff-line-modified-added">+ #define EPOCH_2_CLEARED_META_BIT                  (USED_BIT &lt;&lt; 1)</span>
<span class="udiff-line-modified-added">+ #define EPOCH_2_CLEARED_BIT                       (EPOCH_2_CLEARED_META_BIT &lt;&lt; META_SHIFT)</span>
<span class="udiff-line-modified-added">+ #define LEAKP_META_BIT                            (USED_BIT &lt;&lt; 2)</span>
<span class="udiff-line-modified-added">+ #define LEAKP_BIT                                 (LEAKP_META_BIT &lt;&lt; META_SHIFT)</span>
<span class="udiff-line-modified-added">+ #define TRANSIENT_META_BIT                        (USED_BIT &lt;&lt; 3)</span>
<span class="udiff-line-modified-added">+ #define TRANSIENT_BIT                             (TRANSIENT_META_BIT &lt;&lt; META_SHIFT)</span>
<span class="udiff-line-modified-added">+ #define SERIALIZED_META_BIT                       (USED_BIT &lt;&lt; 4)</span>
<span class="udiff-line-modified-added">+ #define SERIALIZED_BIT                            (SERIALIZED_META_BIT &lt;&lt; META_SHIFT)</span>
<span class="udiff-line-modified-added">+ #define TRACE_ID_SHIFT                            16</span>
<span class="udiff-line-modified-added">+ #define METHOD_ID_NUM_MASK                        ((1 &lt;&lt; TRACE_ID_SHIFT) - 1)</span>
<span class="udiff-line-modified-added">+ #define META_BITS                                 (SERIALIZED_BIT | TRANSIENT_BIT | LEAKP_BIT | EPOCH_2_CLEARED_BIT | EPOCH_1_CLEARED_BIT)</span>
<span class="udiff-line-modified-added">+ #define EVENT_BITS                                (EVENT_HOST_KLASS | JDK_JFR_EVENT_KLASS | JDK_JFR_EVENT_SUBKLASS)</span>
<span class="udiff-line-modified-added">+ #define USED_BITS                                 (METHOD_USED_EPOCH_2_BIT | METHOD_USED_EPOCH_1_BIT | USED_EPOCH_2_BIT | USED_EPOCH_1_BIT)</span>
<span class="udiff-line-modified-added">+ #define ALL_BITS                                  (META_BITS | EVENT_BITS | USED_BITS)</span>
<span class="udiff-line-modified-added">+ #define ALL_BITS_MASK                             (~(ALL_BITS))</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ // epoch relative bits</span>
<span class="udiff-line-modified-added">+ #define IN_USE_THIS_EPOCH_BIT                     (JfrTraceIdEpoch::in_use_this_epoch_bit())</span>
<span class="udiff-line-modified-added">+ #define IN_USE_PREV_EPOCH_BIT                     (JfrTraceIdEpoch::in_use_prev_epoch_bit())</span>
<span class="udiff-line-modified-added">+ #define METHOD_IN_USE_THIS_EPOCH_BIT              (JfrTraceIdEpoch::method_in_use_this_epoch_bit())</span>
<span class="udiff-line-modified-added">+ #define METHOD_IN_USE_PREV_EPOCH_BIT              (JfrTraceIdEpoch::method_in_use_prev_epoch_bit())</span>
<span class="udiff-line-modified-added">+ #define METHOD_AND_CLASS_IN_USE_THIS_EPOCH_BITS   (JfrTraceIdEpoch::method_and_class_in_use_this_epoch_bits())</span>
<span class="udiff-line-modified-added">+ #define METHOD_AND_CLASS_IN_USE_PREV_EPOCH_BITS   (JfrTraceIdEpoch::method_and_class_in_use_prev_epoch_bits())</span>
<span class="udiff-line-modified-added">+ #define METHOD_FLAG_IN_USE_THIS_EPOCH_BIT         ((jbyte)IN_USE_THIS_EPOCH_BIT)</span>
<span class="udiff-line-modified-added">+ #define METHOD_FLAG_IN_USE_PREV_EPOCH_BIT         ((jbyte)IN_USE_PREV_EPOCH_BIT)</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ // operators</span>
<span class="udiff-line-modified-added">+ #define TRACE_ID_RAW(ptr)                         ((ptr)-&gt;trace_id())</span>
<span class="udiff-line-modified-added">+ #define TRACE_ID(ptr)                             (TRACE_ID_RAW(ptr) &gt;&gt; TRACE_ID_SHIFT)</span>
<span class="udiff-line-modified-added">+ #define TRACE_ID_MASKED(ptr)                      (TRACE_ID_RAW(ptr) &amp; ALL_BITS_MASK)</span>
<span class="udiff-line-modified-added">+ #define TRACE_ID_PREDICATE(ptr, bits)             ((TRACE_ID_RAW(ptr) &amp; bits) != 0)</span>
<span class="udiff-line-modified-added">+ #define TRACE_ID_TAG(ptr, bits)                   (set_traceid_bits(bits, (ptr)-&gt;trace_id_addr()))</span>
<span class="udiff-line-modified-added">+ #define TRACE_ID_TAG_CAS(ptr, bits)               (set_traceid_bits_cas(bits, (ptr)-&gt;trace_id_addr()))</span>
<span class="udiff-line-modified-added">+ #define TRACE_ID_CLEAR(ptr, bits)                 (set_traceid_mask(bits, (ptr)-&gt;trace_id_addr()))</span>
<span class="udiff-line-modified-added">+ #define TRACE_ID_META_TAG(ptr, bits)              (set_traceid_meta_bits(bits, (ptr)-&gt;trace_id_addr()))</span>
<span class="udiff-line-modified-added">+ #define TRACE_ID_META_CLEAR(ptr, bits)            (set_traceid_meta_mask(bits, (ptr)-&gt;trace_id_addr()))</span>
<span class="udiff-line-modified-added">+ #define METHOD_ID(kls, method)                    (TRACE_ID_MASKED(kls) | (method)-&gt;orig_method_idnum())</span>
<span class="udiff-line-modified-added">+ #define METHOD_FLAG_PREDICATE(method, bits)       ((method)-&gt;is_trace_flag_set(bits))</span>
<span class="udiff-line-modified-added">+ #define METHOD_FLAG_TAG(method, bits)             (set_bits(bits, (method)-&gt;trace_flags_addr()))</span>
<span class="udiff-line-modified-added">+ #define METHOD_META_TAG(method, bits)             (set_meta_bits(bits, (method)-&gt;trace_meta_addr()))</span>
<span class="udiff-line-modified-added">+ #define METHOD_FLAG_CLEAR(method, bits)           (clear_bits_cas(bits, (method)-&gt;trace_flags_addr()))</span>
<span class="udiff-line-modified-added">+ #define METHOD_META_CLEAR(method, bits)           (set_meta_mask(bits, (method)-&gt;trace_meta_addr()))</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ // predicates</span>
<span class="udiff-line-modified-added">+ #define USED_THIS_EPOCH(ptr)                      (TRACE_ID_PREDICATE(ptr, (TRANSIENT_BIT | IN_USE_THIS_EPOCH_BIT)))</span>
<span class="udiff-line-modified-added">+ #define NOT_USED_THIS_EPOCH(ptr)                  (!(USED_THIS_EPOCH(ptr)))</span>
<span class="udiff-line-modified-added">+ #define USED_PREV_EPOCH(ptr)                      (TRACE_ID_PREDICATE(ptr, (TRANSIENT_BIT | IN_USE_PREV_EPOCH_BIT)))</span>
<span class="udiff-line-modified-added">+ #define USED_ANY_EPOCH(ptr)                       (TRACE_ID_PREDICATE(ptr, (TRANSIENT_BIT | USED_EPOCH_2_BIT | USED_EPOCH_1_BIT)))</span>
<span class="udiff-line-modified-added">+ #define METHOD_USED_THIS_EPOCH(kls)               (TRACE_ID_PREDICATE(kls, (METHOD_IN_USE_THIS_EPOCH_BIT)))</span>
<span class="udiff-line-modified-added">+ #define METHOD_NOT_USED_THIS_EPOCH(kls)           (!(METHOD_USED_THIS_EPOCH(kls)))</span>
<span class="udiff-line-modified-added">+ #define METHOD_USED_PREV_EPOCH(kls)               (TRACE_ID_PREDICATE(kls, (METHOD_IN_USE_PREV_EPOCH_BIT)))</span>
<span class="udiff-line-modified-added">+ #define METHOD_USED_ANY_EPOCH(kls)                (TRACE_ID_PREDICATE(kls, (METHOD_IN_USE_PREV_EPOCH_BIT | METHOD_IN_USE_THIS_EPOCH_BIT)))</span>
<span class="udiff-line-modified-added">+ #define METHOD_AND_CLASS_USED_THIS_EPOCH(kls)     (TRACE_ID_PREDICATE(kls, (METHOD_AND_CLASS_IN_USE_THIS_EPOCH_BITS)))</span>
<span class="udiff-line-modified-added">+ #define METHOD_AND_CLASS_USED_PREV_EPOCH(kls)     (TRACE_ID_PREDICATE(kls, (METHOD_AND_CLASS_IN_USE_PREV_EPOCH_BITS)))</span>
<span class="udiff-line-modified-added">+ #define METHOD_AND_CLASS_USED_ANY_EPOCH(kls)      (METHOD_USED_ANY_EPOCH(kls) &amp;&amp; USED_ANY_EPOCH(kls))</span>
<span class="udiff-line-modified-added">+ #define METHOD_FLAG_USED_THIS_EPOCH(method)       (METHOD_FLAG_PREDICATE(method, (METHOD_FLAG_IN_USE_THIS_EPOCH_BIT)))</span>
<span class="udiff-line-modified-added">+ #define METHOD_FLAG_NOT_USED_THIS_EPOCH(method)   (!(METHOD_FLAG_USED_THIS_EPOCH(method)))</span>
<span class="udiff-line-modified-added">+ #define METHOD_FLAG_USED_PREV_EPOCH(method)       (METHOD_FLAG_PREDICATE(method, (METHOD_FLAG_IN_USE_PREV_EPOCH_BIT)))</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ // setters</span>
<span class="udiff-line-modified-added">+ #define SET_USED_THIS_EPOCH(ptr)                  (TRACE_ID_TAG(ptr, IN_USE_THIS_EPOCH_BIT))</span>
<span class="udiff-line-modified-added">+ #define SET_METHOD_AND_CLASS_USED_THIS_EPOCH(kls) (TRACE_ID_TAG(kls, METHOD_AND_CLASS_IN_USE_THIS_EPOCH_BITS))</span>
<span class="udiff-line-modified-added">+ #define SET_METHOD_FLAG_USED_THIS_EPOCH(method)   (METHOD_FLAG_TAG(method, METHOD_FLAG_IN_USE_THIS_EPOCH_BIT))</span>
<span class="udiff-line-modified-added">+ #define CLEAR_METHOD_AND_CLASS_PREV_EPOCH_MASK    (~(METHOD_IN_USE_PREV_EPOCH_BIT | IN_USE_PREV_EPOCH_BIT))</span>
<span class="udiff-line-modified-added">+ #define CLEAR_METHOD_AND_CLASS_PREV_EPOCH(kls)    (TRACE_ID_CLEAR(kls, CLEAR_METHOD_AND_CLASS_PREV_EPOCH_MASK))</span>
<span class="udiff-line-modified-added">+ #define CLEAR_METHOD_FLAG_USED_PREV_EPOCH(method) (METHOD_FLAG_CLEAR(method, METHOD_FLAG_IN_USE_PREV_EPOCH_BIT))</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ // types</span>
<span class="udiff-line-modified-added">+ #define IS_JDK_JFR_EVENT_KLASS(kls)               (TRACE_ID_PREDICATE(kls, JDK_JFR_EVENT_KLASS))</span>
<span class="udiff-line-modified-added">+ #define IS_JDK_JFR_EVENT_SUBKLASS(kls)            (TRACE_ID_PREDICATE(kls, JDK_JFR_EVENT_SUBKLASS))</span>
<span class="udiff-line-modified-added">+ #define IS_NOT_AN_EVENT_SUB_KLASS(kls)            (!(IS_JDK_JFR_EVENT_SUBKLASS(kls)))</span>
<span class="udiff-line-modified-added">+ #define IS_EVENT_HOST_KLASS(kls)                  (TRACE_ID_PREDICATE(kls, EVENT_HOST_KLASS))</span>
<span class="udiff-line-modified-added">+ #define SET_JDK_JFR_EVENT_KLASS(kls)              (TRACE_ID_TAG(kls, JDK_JFR_EVENT_KLASS))</span>
<span class="udiff-line-modified-added">+ #define SET_JDK_JFR_EVENT_SUBKLASS(kls)           (TRACE_ID_TAG(kls, JDK_JFR_EVENT_SUBKLASS))</span>
<span class="udiff-line-modified-added">+ #define SET_EVENT_HOST_KLASS(kls)                 (TRACE_ID_TAG(kls, EVENT_HOST_KLASS))</span>
<span class="udiff-line-modified-added">+ #define EVENT_KLASS_MASK(kls)                     (TRACE_ID_RAW(kls) &amp; EVENT_BITS)</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ // meta</span>
<span class="udiff-line-modified-added">+ #define META_MASK                                 (~(SERIALIZED_META_BIT | TRANSIENT_META_BIT | LEAKP_META_BIT))</span>
<span class="udiff-line-modified-added">+ #define SET_LEAKP(ptr)                            (TRACE_ID_META_TAG(ptr, LEAKP_META_BIT))</span>
<span class="udiff-line-modified-added">+ #define IS_LEAKP(ptr)                             (TRACE_ID_PREDICATE(ptr, LEAKP_BIT))</span>
<span class="udiff-line-modified-added">+ #define SET_TRANSIENT(ptr)                        (TRACE_ID_META_TAG(ptr, TRANSIENT_META_BIT))</span>
<span class="udiff-line-modified-added">+ #define IS_SERIALIZED(ptr)                        (TRACE_ID_PREDICATE(ptr, SERIALIZED_BIT))</span>
<span class="udiff-line-modified-added">+ #define IS_NOT_SERIALIZED(ptr)                    (!(IS_SERIALIZED(ptr)))</span>
<span class="udiff-line-modified-added">+ #define SHOULD_TAG(ptr)                           (NOT_USED_THIS_EPOCH(ptr))</span>
<span class="udiff-line-modified-added">+ #define SHOULD_TAG_KLASS_METHOD(ptr)              (METHOD_NOT_USED_THIS_EPOCH(ptr))</span>
<span class="udiff-line-modified-added">+ #define SET_SERIALIZED(ptr)                       (TRACE_ID_META_TAG(ptr, SERIALIZED_META_BIT))</span>
<span class="udiff-line-modified-added">+ #define CLEAR_SERIALIZED(ptr)                     (TRACE_ID_META_CLEAR(ptr, META_MASK))</span>
<span class="udiff-line-modified-added">+ #define SET_PREV_EPOCH_CLEARED_BIT(ptr)           (TRACE_ID_META_TAG(ptr, IN_USE_PREV_EPOCH_BIT))</span>
<span class="udiff-line-modified-added">+ #define IS_METHOD_SERIALIZED(method)              (METHOD_FLAG_PREDICATE(method, SERIALIZED_BIT))</span>
<span class="udiff-line-modified-added">+ #define IS_METHOD_LEAKP_USED(method)              (METHOD_FLAG_PREDICATE(method, LEAKP_BIT))</span>
<span class="udiff-line-modified-added">+ #define METHOD_NOT_SERIALIZED(method)             (!(IS_METHOD_SERIALIZED(method)))</span>
<span class="udiff-line-modified-added">+ #define SET_METHOD_LEAKP(method)                  (METHOD_META_TAG(method, LEAKP_META_BIT))</span>
<span class="udiff-line-modified-added">+ #define SET_METHOD_SERIALIZED(method)             (METHOD_META_TAG(method, SERIALIZED_META_BIT))</span>
<span class="udiff-line-modified-added">+ #define CLEAR_METHOD_SERIALIZED(method)           (METHOD_META_CLEAR(method, META_MASK))</span>
<span class="udiff-line-modified-added">+ #define SET_PREV_EPOCH_METHOD_CLEARED_BIT(ptr)    (METHOD_META_TAG(ptr, IN_USE_PREV_EPOCH_BIT))</span>
<span class="udiff-line-modified-added">+ #define CLEAR_LEAKP(ptr)                          (TRACE_ID_META_CLEAR(ptr, (~(LEAKP_META_BIT))))</span>
<span class="udiff-line-modified-added">+ #define CLEAR_THIS_EPOCH_CLEARED_BIT(ptr)         (TRACE_ID_META_CLEAR(ptr,(~(IN_USE_THIS_EPOCH_BIT))))</span>
<span class="udiff-line-modified-added">+ #define CLEAR_THIS_EPOCH_METHOD_CLEARED_BIT(ptr)  (METHOD_META_CLEAR(ptr,(~(IN_USE_THIS_EPOCH_BIT))))</span>
  
  #endif // SHARE_JFR_RECORDER_CHECKPOINT_TYPES_TRACEID_JFRTRACEIDMACROS_HPP
</pre>
<center><a href="jfrTraceIdEpoch.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../jfrRecorder.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>