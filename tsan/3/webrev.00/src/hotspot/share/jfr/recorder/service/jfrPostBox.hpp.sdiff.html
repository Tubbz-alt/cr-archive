<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/jfr/recorder/service/jfrPostBox.hpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="jfrPostBox.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="jfrRecorderService.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/recorder/service/jfrPostBox.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
24 
25 #ifndef SHARE_JFR_RECORDER_SERVICE_JFRPOSTBOX_HPP
26 #define SHARE_JFR_RECORDER_SERVICE_JFRPOSTBOX_HPP
27 
28 #include &quot;jfr/utilities/jfrAllocation.hpp&quot;
29 
30 #define MSGBIT(e) (1&lt;&lt;(e))
31 
32 enum JFR_Msg {
33   MSG_ALL_MSGS = -1,
34   MSG_CLONE_IN_MEMORY = 0,
35   MSG_START,
36   MSG_STOP,
37   MSG_ROTATE,
38   MSG_FULLBUFFER,
39   MSG_CHECKPOINT,
40   MSG_WAKEUP,
41   MSG_SHUTDOWN,
42   MSG_VM_ERROR,
43   MSG_DEADBUFFER,

44   MSG_NO_OF_MSGS
45 };
46 
47 /**
48  *  Jfr messaging.
49  *
50  *  Synchronous messages (posting thread waits for message completion):
51  *
52  *  MSG_CLONE_IN_MEMORY (0) ; MSGBIT(MSG_CLONE_IN_MEMORY) == (1 &lt;&lt; 0) == 0x1
53  *  MSG_START(1)            ; MSGBIT(MSG_START) == (1 &lt;&lt; 0x1) == 0x2
54  *  MSG_STOP (2)            ; MSGBIT(MSG_STOP) == (1 &lt;&lt; 0x2) == 0x4
55  *  MSG_ROTATE (3)          ; MSGBIT(MSG_ROTATE) == (1 &lt;&lt; 0x3) == 0x8
<span class="line-modified">56  *  MSG_VM_ERROR (8)        ; MSGBIT(MSG_VM_ERROR) == (1 &lt;&lt; 8) == 0x100</span>

57  *
58  *  Asynchronous messages (posting thread returns immediately upon deposit):
59  *
60  *  MSG_FULLBUFFER (4)      ; MSGBIT(MSG_FULLBUFFER) == (1 &lt;&lt; 0x4) == 0x10
<span class="line-modified">61  *  MSG_CHECKPOINT (5)      ; MSGBIT(CHECKPOINT) == (1 &lt;&lt; 5) == 0x20</span>
<span class="line-modified">62  *  MSG_WAKEUP (6)          ; MSGBIT(WAKEUP) == (1 &lt;&lt; 6) == 0x40</span>
<span class="line-modified">63  *  MSG_SHUTDOWN (7)        ; MSGBIT(MSG_SHUTDOWN) == (1 &lt;&lt; 7) == 0x80</span>
<span class="line-modified">64  *  MSG_DEADBUFFER (9)      ; MSGBIT(MSG_DEADBUFFER) == (1 &lt;&lt; 9) == 0x200</span>
65  */
66 
67 class JfrPostBox : public JfrCHeapObj {
68   friend class JfrRecorder;
69  public:
70   void post(JFR_Msg msg);
71 
72  private:
73   uintptr_t _msg_read_serial;
74   uintptr_t _msg_handled_serial;
75   volatile int _messages;
76   bool _has_waiters;
77 
78   JfrPostBox();
79   static JfrPostBox&amp; instance();
80   static JfrPostBox* create();
81   static void destroy();
82 
83   void asynchronous_post(int msg);
84   void synchronous_post(int msg);
</pre>
</td>
<td>
<hr />
<pre>
24 
25 #ifndef SHARE_JFR_RECORDER_SERVICE_JFRPOSTBOX_HPP
26 #define SHARE_JFR_RECORDER_SERVICE_JFRPOSTBOX_HPP
27 
28 #include &quot;jfr/utilities/jfrAllocation.hpp&quot;
29 
30 #define MSGBIT(e) (1&lt;&lt;(e))
31 
32 enum JFR_Msg {
33   MSG_ALL_MSGS = -1,
34   MSG_CLONE_IN_MEMORY = 0,
35   MSG_START,
36   MSG_STOP,
37   MSG_ROTATE,
38   MSG_FULLBUFFER,
39   MSG_CHECKPOINT,
40   MSG_WAKEUP,
41   MSG_SHUTDOWN,
42   MSG_VM_ERROR,
43   MSG_DEADBUFFER,
<span class="line-added">44   MSG_FLUSHPOINT,</span>
45   MSG_NO_OF_MSGS
46 };
47 
48 /**
49  *  Jfr messaging.
50  *
51  *  Synchronous messages (posting thread waits for message completion):
52  *
53  *  MSG_CLONE_IN_MEMORY (0) ; MSGBIT(MSG_CLONE_IN_MEMORY) == (1 &lt;&lt; 0) == 0x1
54  *  MSG_START(1)            ; MSGBIT(MSG_START) == (1 &lt;&lt; 0x1) == 0x2
55  *  MSG_STOP (2)            ; MSGBIT(MSG_STOP) == (1 &lt;&lt; 0x2) == 0x4
56  *  MSG_ROTATE (3)          ; MSGBIT(MSG_ROTATE) == (1 &lt;&lt; 0x3) == 0x8
<span class="line-modified">57  *  MSG_VM_ERROR (8)        ; MSGBIT(MSG_VM_ERROR) == (1 &lt;&lt; 0x8) == 0x100</span>
<span class="line-added">58  *  MSG_FLUSHPOINT (10)     ; MSGBIT(MSG_FLUSHPOINT) == (1 &lt;&lt; 0xa) == 0x400</span>
59  *
60  *  Asynchronous messages (posting thread returns immediately upon deposit):
61  *
62  *  MSG_FULLBUFFER (4)      ; MSGBIT(MSG_FULLBUFFER) == (1 &lt;&lt; 0x4) == 0x10
<span class="line-modified">63  *  MSG_CHECKPOINT (5)      ; MSGBIT(CHECKPOINT) == (1 &lt;&lt; 0x5) == 0x20</span>
<span class="line-modified">64  *  MSG_WAKEUP (6)          ; MSGBIT(WAKEUP) == (1 &lt;&lt; 0x6) == 0x40</span>
<span class="line-modified">65  *  MSG_SHUTDOWN (7)        ; MSGBIT(MSG_SHUTDOWN) == (1 &lt;&lt; 0x7) == 0x80</span>
<span class="line-modified">66  *  MSG_DEADBUFFER (9)      ; MSGBIT(MSG_DEADBUFFER) == (1 &lt;&lt; 0x9) == 0x200</span>
67  */
68 
69 class JfrPostBox : public JfrCHeapObj {
70   friend class JfrRecorder;
71  public:
72   void post(JFR_Msg msg);
73 
74  private:
75   uintptr_t _msg_read_serial;
76   uintptr_t _msg_handled_serial;
77   volatile int _messages;
78   bool _has_waiters;
79 
80   JfrPostBox();
81   static JfrPostBox&amp; instance();
82   static JfrPostBox* create();
83   static void destroy();
84 
85   void asynchronous_post(int msg);
86   void synchronous_post(int msg);
</pre>
</td>
</tr>
</table>
<center><a href="jfrPostBox.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="jfrRecorderService.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>