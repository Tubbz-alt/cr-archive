<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/jfr/recorder/storage/jfrStorage.hpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="jfrStorage.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="jfrStorageControl.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/recorder/storage/jfrStorage.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
51   JfrStorageAgeMspace* _age_mspace;
52   JfrChunkWriter&amp; _chunkwriter;
53   JfrPostBox&amp; _post_box;
54 
55   // mspace callbacks
56   void register_full(Buffer* t, Thread* thread);
57   void lock();
58   void unlock();
59   DEBUG_ONLY(bool is_locked() const;)
60 
61   Buffer* acquire_large(size_t size, Thread* t);
62   Buffer* acquire_transient(size_t size, Thread* thread);
63   bool flush_regular_buffer(Buffer* const buffer, Thread* t);
64   Buffer* flush_regular(Buffer* cur, const u1* cur_pos, size_t used, size_t req, bool native, Thread* t);
65   Buffer* flush_large(Buffer* cur, const u1* cur_pos, size_t used, size_t req, bool native, Thread* t);
66   Buffer* provision_large(Buffer* cur, const u1* cur_pos, size_t used, size_t req, bool native, Thread* t);
67   void release(Buffer* buffer, Thread* t);
68 
69   size_t clear();
70   size_t clear_full();
<span class="line-removed">71   size_t write();</span>
72   size_t write_full();
73   size_t write_at_safepoint();
74   size_t scavenge();
75 
76   JfrStorage(JfrChunkWriter&amp; cw, JfrPostBox&amp; post_box);
77   ~JfrStorage();
78 
79   static JfrStorage&amp; instance();
80   static JfrStorage* create(JfrChunkWriter&amp; chunkwriter, JfrPostBox&amp; post_box);
81   bool initialize();
82   static void destroy();
83 
84  public:
85   static Buffer* acquire_thread_local(Thread* t, size_t size = 0);
86   static void release_thread_local(Buffer* buffer, Thread* t);
87   void release_large(Buffer* const buffer, Thread* t);
88   static Buffer* flush(Buffer* cur, size_t used, size_t req, bool native, Thread* t);
89   void discard_oldest(Thread* t);
90   static JfrStorageControl&amp; control();
91 


92   friend class JfrRecorder;
93   friend class JfrRecorderService;
94   template &lt;typename, template &lt;typename&gt; class, typename&gt;
95   friend class JfrMemorySpace;
96 };
97 
98 #endif // SHARE_JFR_RECORDER_STORAGE_JFRSTORAGE_HPP
</pre>
</td>
<td>
<hr />
<pre>
51   JfrStorageAgeMspace* _age_mspace;
52   JfrChunkWriter&amp; _chunkwriter;
53   JfrPostBox&amp; _post_box;
54 
55   // mspace callbacks
56   void register_full(Buffer* t, Thread* thread);
57   void lock();
58   void unlock();
59   DEBUG_ONLY(bool is_locked() const;)
60 
61   Buffer* acquire_large(size_t size, Thread* t);
62   Buffer* acquire_transient(size_t size, Thread* thread);
63   bool flush_regular_buffer(Buffer* const buffer, Thread* t);
64   Buffer* flush_regular(Buffer* cur, const u1* cur_pos, size_t used, size_t req, bool native, Thread* t);
65   Buffer* flush_large(Buffer* cur, const u1* cur_pos, size_t used, size_t req, bool native, Thread* t);
66   Buffer* provision_large(Buffer* cur, const u1* cur_pos, size_t used, size_t req, bool native, Thread* t);
67   void release(Buffer* buffer, Thread* t);
68 
69   size_t clear();
70   size_t clear_full();

71   size_t write_full();
72   size_t write_at_safepoint();
73   size_t scavenge();
74 
75   JfrStorage(JfrChunkWriter&amp; cw, JfrPostBox&amp; post_box);
76   ~JfrStorage();
77 
78   static JfrStorage&amp; instance();
79   static JfrStorage* create(JfrChunkWriter&amp; chunkwriter, JfrPostBox&amp; post_box);
80   bool initialize();
81   static void destroy();
82 
83  public:
84   static Buffer* acquire_thread_local(Thread* t, size_t size = 0);
85   static void release_thread_local(Buffer* buffer, Thread* t);
86   void release_large(Buffer* const buffer, Thread* t);
87   static Buffer* flush(Buffer* cur, size_t used, size_t req, bool native, Thread* t);
88   void discard_oldest(Thread* t);
89   static JfrStorageControl&amp; control();
90 
<span class="line-added">91   size_t write();</span>
<span class="line-added">92 </span>
93   friend class JfrRecorder;
94   friend class JfrRecorderService;
95   template &lt;typename, template &lt;typename&gt; class, typename&gt;
96   friend class JfrMemorySpace;
97 };
98 
99 #endif // SHARE_JFR_RECORDER_STORAGE_JFRSTORAGE_HPP
</pre>
</td>
</tr>
</table>
<center><a href="jfrStorage.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="jfrStorageControl.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>