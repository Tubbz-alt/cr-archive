<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/jfr/writers/jfrStorageAdapter.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="jfrJavaEventWriter.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrWriterHost.inline.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/writers/jfrStorageAdapter.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 65 
 66   u1* pos() {
 67     assert(_storage != NULL, &quot;invariant&quot;);
 68     return _storage-&gt;pos();
 69   }
 70 
 71   const u1* end() const {
 72     assert(_storage != NULL, &quot;invariant&quot;);
 73     return _storage-&gt;end();
 74   }
 75 
 76   void commit(u1* position) {
 77     assert(_storage != NULL, &quot;invariant&quot;);
 78     _storage-&gt;set_pos(position);
 79   }
 80 
 81   bool flush(size_t used, size_t requested) {
 82     assert(_thread != NULL, &quot;invariant&quot;);
 83     Flush f(_storage, used, requested, _thread);
 84     _storage = f.result();
<span class="line-modified"> 85     return _storage != NULL;</span>
 86   }
 87 
 88   void release() {
 89     if (_storage != NULL &amp;&amp; _storage-&gt;lease()) {
 90       // This flush call will return the lease
 91       // of a temporary storage area.
 92       // Since the requested size is 0,
 93       // the flush implementation will accomodate
 94       // that &#39;size&#39; request in the
 95       // original thread local storage,
 96       // by implication restoring the original
 97       // in the process of returning a lease.
 98       flush(0, 0);
 99     }
100   }
101 
102  private:
103   StorageType* _storage;
104   Thread* _thread;
105 };
</pre>
<hr />
<pre>
219   u1* _end;
220   size_t _size;
221 
222  public:
223   typedef u1 StorageType;
224   NoOwnershipAdapter(u1* storage, size_t size) : _start(storage), _pos(storage), _end(storage + size), _size(size) {}
225   NoOwnershipAdapter(u1* storage, Thread* thread) : _start(storage), _pos(storage), _end(storage), _size(0) {
226     ShouldNotCallThis();
227   }
228   NoOwnershipAdapter(Thread* thread) : _start(NULL), _pos(NULL), _end(NULL), _size(0) {
229     ShouldNotCallThis();
230   }
231   StorageType* storage() { return _start; }
232   const u1* start() const { return _start; }
233   u1* pos() { return _pos; }
234   void commit(u1* position) { _pos = position; }
235   const u1* end() const { return _end; }
236   void release() {}
237   bool flush(size_t used, size_t requested) {
238     // don&#39;t flush/expand a buffer that is not our own
<span class="line-modified">239     return false;</span>

240   }
241 };
242 
243 #endif // SHARE_JFR_WRITERS_JFRSTORAGEADAPTER_HPP
</pre>
</td>
<td>
<hr />
<pre>
 65 
 66   u1* pos() {
 67     assert(_storage != NULL, &quot;invariant&quot;);
 68     return _storage-&gt;pos();
 69   }
 70 
 71   const u1* end() const {
 72     assert(_storage != NULL, &quot;invariant&quot;);
 73     return _storage-&gt;end();
 74   }
 75 
 76   void commit(u1* position) {
 77     assert(_storage != NULL, &quot;invariant&quot;);
 78     _storage-&gt;set_pos(position);
 79   }
 80 
 81   bool flush(size_t used, size_t requested) {
 82     assert(_thread != NULL, &quot;invariant&quot;);
 83     Flush f(_storage, used, requested, _thread);
 84     _storage = f.result();
<span class="line-modified"> 85     return _storage != NULL &amp;&amp; !_storage-&gt;excluded();</span>
 86   }
 87 
 88   void release() {
 89     if (_storage != NULL &amp;&amp; _storage-&gt;lease()) {
 90       // This flush call will return the lease
 91       // of a temporary storage area.
 92       // Since the requested size is 0,
 93       // the flush implementation will accomodate
 94       // that &#39;size&#39; request in the
 95       // original thread local storage,
 96       // by implication restoring the original
 97       // in the process of returning a lease.
 98       flush(0, 0);
 99     }
100   }
101 
102  private:
103   StorageType* _storage;
104   Thread* _thread;
105 };
</pre>
<hr />
<pre>
219   u1* _end;
220   size_t _size;
221 
222  public:
223   typedef u1 StorageType;
224   NoOwnershipAdapter(u1* storage, size_t size) : _start(storage), _pos(storage), _end(storage + size), _size(size) {}
225   NoOwnershipAdapter(u1* storage, Thread* thread) : _start(storage), _pos(storage), _end(storage), _size(0) {
226     ShouldNotCallThis();
227   }
228   NoOwnershipAdapter(Thread* thread) : _start(NULL), _pos(NULL), _end(NULL), _size(0) {
229     ShouldNotCallThis();
230   }
231   StorageType* storage() { return _start; }
232   const u1* start() const { return _start; }
233   u1* pos() { return _pos; }
234   void commit(u1* position) { _pos = position; }
235   const u1* end() const { return _end; }
236   void release() {}
237   bool flush(size_t used, size_t requested) {
238     // don&#39;t flush/expand a buffer that is not our own
<span class="line-modified">239     _pos = _start;</span>
<span class="line-added">240     return true;</span>
241   }
242 };
243 
244 #endif // SHARE_JFR_WRITERS_JFRSTORAGEADAPTER_HPP
</pre>
</td>
</tr>
</table>
<center><a href="jfrJavaEventWriter.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrWriterHost.inline.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>