<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/hotspot/share/jfr/jni/jfrJniMethodRegistration.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
 1 /*
 2  * Copyright (c) 2016, 2018, Oracle and/or its affiliates. All rights reserved.
 3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 4  *
 5  * This code is free software; you can redistribute it and/or modify it
 6  * under the terms of the GNU General Public License version 2 only, as
 7  * published by the Free Software Foundation.
 8  *
 9  * This code is distributed in the hope that it will be useful, but WITHOUT
10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
12  * version 2 for more details (a copy is included in the LICENSE file that
13  * accompanied this code).
14  *
15  * You should have received a copy of the GNU General Public License version
16  * 2 along with this work; if not, write to the Free Software Foundation,
17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
18  *
19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
20  * or visit www.oracle.com if you need additional information or have any
21  * questions.
22  *
23  */
24 
25 #include &quot;precompiled.hpp&quot;
26 #include &quot;jfr/jni/jfrJniMethod.hpp&quot;
27 #include &quot;jfr/jni/jfrJniMethodRegistration.hpp&quot;
28 #include &quot;logging/log.hpp&quot;
29 #include &quot;runtime/interfaceSupport.inline.hpp&quot;
30 #include &quot;runtime/thread.hpp&quot;
31 #include &quot;utilities/exceptions.hpp&quot;
32 
33 JfrJniMethodRegistration::JfrJniMethodRegistration(JNIEnv* env) {
34   assert(env != NULL, &quot;invariant&quot;);
35   jclass jfr_clz = env-&gt;FindClass(&quot;jdk/jfr/internal/JVM&quot;);
36   if (jfr_clz != NULL) {
37     JNINativeMethod method[] = {
38       (char*)&quot;beginRecording&quot;, (char*)&quot;()V&quot;, (void*)jfr_begin_recording,
39       (char*)&quot;endRecording&quot;, (char*)&quot;()V&quot;, (void*)jfr_end_recording,
40       (char*)&quot;counterTime&quot;, (char*)&quot;()J&quot;, (void*)jfr_elapsed_counter,
41       (char*)&quot;createJFR&quot;, (char*)&quot;(Z)Z&quot;, (void*)jfr_create_jfr,
42       (char*)&quot;destroyJFR&quot;, (char*)&quot;()Z&quot;, (void*)jfr_destroy_jfr,
43       (char*)&quot;emitEvent&quot;, (char*)&quot;(JJJ)Z&quot;, (void*)jfr_emit_event,
44       (char*)&quot;getAllEventClasses&quot;, (char*)&quot;()Ljava/util/List;&quot;, (void*)jfr_get_all_event_classes,
45       (char*)&quot;getClassIdNonIntrinsic&quot;, (char*)&quot;(Ljava/lang/Class;)J&quot;, (void*)jfr_class_id,
46       (char*)&quot;getPid&quot;, (char*)&quot;()Ljava/lang/String;&quot;, (void*)jfr_get_pid,
47       (char*)&quot;getStackTraceId&quot;, (char*)&quot;(I)J&quot;, (void*)jfr_stacktrace_id,
48       (char*)&quot;getThreadId&quot;, (char*)&quot;(Ljava/lang/Thread;)J&quot;, (void*)jfr_id_for_thread,
49       (char*)&quot;getTicksFrequency&quot;, (char*)&quot;()J&quot;, (void*)jfr_elapsed_frequency,
50       (char*)&quot;subscribeLogLevel&quot;, (char*)&quot;(Ljdk/jfr/internal/LogTag;I)V&quot;, (void*)jfr_subscribe_log_level,
51       (char*)&quot;log&quot;, (char*)&quot;(IILjava/lang/String;)V&quot;, (void*)jfr_log,
52       (char*)&quot;retransformClasses&quot;, (char*)&quot;([Ljava/lang/Class;)V&quot;, (void*)jfr_retransform_classes,
53       (char*)&quot;setEnabled&quot;, (char*)&quot;(JZ)V&quot;, (void*)jfr_set_enabled,
54       (char*)&quot;setFileNotification&quot;, (char*)&quot;(J)V&quot;, (void*)jfr_set_file_notification,
55       (char*)&quot;setGlobalBufferCount&quot;, (char*)&quot;(J)V&quot;, (void*)jfr_set_global_buffer_count,
56       (char*)&quot;setGlobalBufferSize&quot;, (char*)&quot;(J)V&quot;, (void*)jfr_set_global_buffer_size,
57       (char*)&quot;setMethodSamplingInterval&quot;, (char*)&quot;(JJ)V&quot;, (void*)jfr_set_method_sampling_interval,
58       (char*)&quot;setOutput&quot;, (char*)&quot;(Ljava/lang/String;)V&quot;, (void*)jfr_set_output,
59       (char*)&quot;setSampleThreads&quot;, (char*)&quot;(Z)V&quot;, (void*)jfr_set_sample_threads,
60       (char*)&quot;setStackDepth&quot;, (char*)&quot;(I)V&quot;, (void*)jfr_set_stack_depth,
61       (char*)&quot;setStackTraceEnabled&quot;, (char*)&quot;(JZ)V&quot;, (void*)jfr_set_stacktrace_enabled,
62       (char*)&quot;setThreadBufferSize&quot;, (char*)&quot;(J)V&quot;, (void*)jfr_set_thread_buffer_size,
63       (char*)&quot;setMemorySize&quot;, (char*)&quot;(J)V&quot;, (void*)jfr_set_memory_size,
64       (char*)&quot;setThreshold&quot;, (char*)&quot;(JJ)Z&quot;, (void*)jfr_set_threshold,
65       (char*)&quot;storeMetadataDescriptor&quot;, (char*)&quot;([B)V&quot;, (void*)jfr_store_metadata_descriptor,
66       (char*)&quot;getAllowedToDoEventRetransforms&quot;, (char*)&quot;()Z&quot;, (void*)jfr_allow_event_retransforms,
67       (char*)&quot;isAvailable&quot;, (char*)&quot;()Z&quot;, (void*)jfr_is_available,
68       (char*)&quot;getTimeConversionFactor&quot;, (char*)&quot;()D&quot;, (void*)jfr_time_conv_factor,
69       (char*)&quot;getTypeId&quot;, (char*)&quot;(Ljava/lang/Class;)J&quot;, (void*)jfr_type_id,
70       (char*)&quot;getEventWriter&quot;, (char*)&quot;()Ljava/lang/Object;&quot;, (void*)jfr_get_event_writer,
71       (char*)&quot;newEventWriter&quot;, (char*)&quot;()Ljdk/jfr/internal/EventWriter;&quot;, (void*)jfr_new_event_writer,
72       (char*)&quot;flush&quot;, (char*)&quot;(Ljdk/jfr/internal/EventWriter;II)Z&quot;, (void*)jfr_event_writer_flush,
73       (char*)&quot;setRepositoryLocation&quot;, (char*)&quot;(Ljava/lang/String;)V&quot;, (void*)jfr_set_repository_location,
74       (char*)&quot;abort&quot;, (char*)&quot;(Ljava/lang/String;)V&quot;, (void*)jfr_abort,
75       (char*)&quot;getEpochAddress&quot;, (char*)&quot;()J&quot;,(void*)jfr_get_epoch_address,
76       (char*)&quot;addStringConstant&quot;, (char*)&quot;(ZJLjava/lang/String;)Z&quot;, (void*)jfr_add_string_constant,
77       (char*)&quot;uncaughtException&quot;, (char*)&quot;(Ljava/lang/Thread;Ljava/lang/Throwable;)V&quot;, (void*)jfr_uncaught_exception,
78       (char*)&quot;setForceInstrumentation&quot;, (char*)&quot;(Z)V&quot;, (void*)jfr_set_force_instrumentation,
79       (char*)&quot;getUnloadedEventClassCount&quot;, (char*)&quot;()J&quot;, (void*)jfr_get_unloaded_event_classes_count,
80       (char*)&quot;setCutoff&quot;, (char*)&quot;(JJ)Z&quot;, (void*)jfr_set_cutoff,
81       (char*)&quot;emitOldObjectSamples&quot;, (char*)&quot;(JZ)V&quot;, (void*)jfr_emit_old_object_samples,
82       (char*)&quot;shouldRotateDisk&quot;, (char*)&quot;()Z&quot;, (void*)jfr_should_rotate_disk
83     };
84 
85     const size_t method_array_length = sizeof(method) / sizeof(JNINativeMethod);
86     if (env-&gt;RegisterNatives(jfr_clz, method, (jint)method_array_length) != JNI_OK) {
87       JavaThread* jt = JavaThread::thread_from_jni_environment(env);
88       assert(jt != NULL, &quot;invariant&quot;);
89       assert(jt-&gt;thread_state() == _thread_in_native, &quot;invariant&quot;);
90       ThreadInVMfromNative transition(jt);
91       log_error(jfr, system)(&quot;RegisterNatives for JVM class failed!&quot;);
92     }
93     env-&gt;DeleteLocalRef(jfr_clz);
94   }
95 }
    </pre>
  </body>
</html>