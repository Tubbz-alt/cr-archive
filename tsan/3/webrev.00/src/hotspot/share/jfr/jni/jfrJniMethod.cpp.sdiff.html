<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/jfr/jni/jfrJniMethod.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="jfrJavaSupport.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrJniMethod.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/jni/jfrJniMethod.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
</pre>
<hr />
<pre>
175 
176 NO_TRANSITION(jboolean, jfr_should_rotate_disk(JNIEnv* env, jobject jvm))
177   return JfrChunkRotation::should_rotate() ? JNI_TRUE : JNI_FALSE;
178 NO_TRANSITION_END
179 
180 /*
181  * JVM_ENTRY_NO_ENV entries
182  *
183  * Transitions:
184  *   Entry: _thread_in_native -&gt; _thread_in_vm
185  *   Exit:  _thread_in_vm -&gt; _thread_in_native
186  *
187  * Current JavaThread available as &quot;thread&quot; variable
188  */
189 
190 JVM_ENTRY_NO_ENV(jboolean, jfr_create_jfr(JNIEnv* env, jobject jvm, jboolean simulate_failure))
191   if (JfrRecorder::is_created()) {
192     return JNI_TRUE;
193   }
194   if (!JfrRecorder::create(simulate_failure == JNI_TRUE)) {
<span class="line-modified">195     JfrJavaSupport::throw_illegal_state_exception(&quot;Unable to start Jfr&quot;, thread);</span>


196     return JNI_FALSE;
197   }
198   return JNI_TRUE;
199 JVM_END
200 
201 JVM_ENTRY_NO_ENV(jboolean, jfr_destroy_jfr(JNIEnv* env, jobject jvm))
202   JfrRecorder::destroy();
203   return JNI_TRUE;
204 JVM_END
205 
206 JVM_ENTRY_NO_ENV(void, jfr_begin_recording(JNIEnv* env, jobject jvm))
207   if (JfrRecorder::is_recording()) {
208     return;
209   }
210   JfrRecorder::start_recording();
211 JVM_END
212 




213 JVM_ENTRY_NO_ENV(void, jfr_end_recording(JNIEnv* env, jobject jvm))
214   if (!JfrRecorder::is_recording()) {
215     return;
216   }
217   JfrRecorder::stop_recording();
218 JVM_END
219 



220 
221 JVM_ENTRY_NO_ENV(jboolean, jfr_emit_event(JNIEnv* env, jobject jvm, jlong eventTypeId, jlong timeStamp, jlong when))
222   JfrPeriodicEventSet::requestEvent((JfrEventId)eventTypeId);
223   return thread-&gt;has_pending_exception() ? JNI_FALSE : JNI_TRUE;
224 JVM_END
225 
226 JVM_ENTRY_NO_ENV(jobject, jfr_get_all_event_classes(JNIEnv* env, jobject jvm))
227   return JfrEventClasses::get_all_event_classes(thread);
228 JVM_END
229 
230 JVM_ENTRY_NO_ENV(jlong, jfr_class_id(JNIEnv* env, jclass jvm, jclass jc))
231   return JfrTraceId::use(jc);
232 JVM_END
233 
234 JVM_ENTRY_NO_ENV(jlong, jfr_stacktrace_id(JNIEnv* env, jobject jvm, jint skip))
235   return JfrStackTraceRepository::record(thread, skip);
236 JVM_END
237 
238 JVM_ENTRY_NO_ENV(void, jfr_log(JNIEnv* env, jobject jvm, jint tag_set, jint level, jstring message))
239   JfrJavaLog::log(tag_set, level, message, thread);
</pre>
<hr />
<pre>
267   JfrMetadataEvent::update(descriptor);
268 JVM_END
269 
270 // trace thread id for a thread object
271 JVM_ENTRY_NO_ENV(jlong, jfr_id_for_thread(JNIEnv* env, jobject jvm, jobject t))
272   return JfrJavaSupport::jfr_thread_id(t);
273 JVM_END
274 
275 JVM_ENTRY_NO_ENV(jobject, jfr_get_event_writer(JNIEnv* env, jclass cls))
276   return JfrJavaEventWriter::event_writer(thread);
277 JVM_END
278 
279 JVM_ENTRY_NO_ENV(jobject, jfr_new_event_writer(JNIEnv* env, jclass cls))
280   return JfrJavaEventWriter::new_event_writer(thread);
281 JVM_END
282 
283 JVM_ENTRY_NO_ENV(jboolean, jfr_event_writer_flush(JNIEnv* env, jclass cls, jobject writer, jint used_size, jint requested_size))
284   return JfrJavaEventWriter::flush(writer, used_size, requested_size, thread);
285 JVM_END
286 




287 JVM_ENTRY_NO_ENV(void, jfr_set_repository_location(JNIEnv* env, jobject repo, jstring location))
288   return JfrRepository::set_path(location, thread);
289 JVM_END
290 
291 JVM_ENTRY_NO_ENV(void, jfr_uncaught_exception(JNIEnv* env, jobject jvm, jobject t, jthrowable throwable))
292   JfrJavaSupport::uncaught_exception(throwable, thread);
293 JVM_END
294 
295 JVM_ENTRY_NO_ENV(void, jfr_abort(JNIEnv* env, jobject jvm, jstring errorMsg))
296   JfrJavaSupport::abort(errorMsg, thread);
297 JVM_END
298 
299 JVM_ENTRY_NO_ENV(jlong, jfr_type_id(JNIEnv* env, jobject jvm, jclass jc))
300   return JfrTraceId::get(jc);
301 JVM_END
302 
303 JVM_ENTRY_NO_ENV(jboolean, jfr_add_string_constant(JNIEnv* env, jclass jvm, jboolean epoch, jlong id, jstring string))
304   return JfrStringPool::add(epoch == JNI_TRUE, id, string, thread) ? JNI_TRUE : JNI_FALSE;
305 JVM_END
306 
307 JVM_ENTRY_NO_ENV(void, jfr_set_force_instrumentation(JNIEnv* env, jobject jvm, jboolean force_instrumentation))
308   JfrEventClassTransformer::set_force_instrumentation(force_instrumentation == JNI_TRUE);
309 JVM_END
310 
311 JVM_ENTRY_NO_ENV(void, jfr_emit_old_object_samples(JNIEnv* env, jobject jvm, jlong cutoff_ticks, jboolean emit_all))
312   LeakProfiler::emit_events(cutoff_ticks, emit_all == JNI_TRUE);
313 JVM_END


























</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
</pre>
<hr />
<pre>
175 
176 NO_TRANSITION(jboolean, jfr_should_rotate_disk(JNIEnv* env, jobject jvm))
177   return JfrChunkRotation::should_rotate() ? JNI_TRUE : JNI_FALSE;
178 NO_TRANSITION_END
179 
180 /*
181  * JVM_ENTRY_NO_ENV entries
182  *
183  * Transitions:
184  *   Entry: _thread_in_native -&gt; _thread_in_vm
185  *   Exit:  _thread_in_vm -&gt; _thread_in_native
186  *
187  * Current JavaThread available as &quot;thread&quot; variable
188  */
189 
190 JVM_ENTRY_NO_ENV(jboolean, jfr_create_jfr(JNIEnv* env, jobject jvm, jboolean simulate_failure))
191   if (JfrRecorder::is_created()) {
192     return JNI_TRUE;
193   }
194   if (!JfrRecorder::create(simulate_failure == JNI_TRUE)) {
<span class="line-modified">195     if (!thread-&gt;has_pending_exception()) {</span>
<span class="line-added">196       JfrJavaSupport::throw_illegal_state_exception(&quot;Unable to start Jfr&quot;, thread);</span>
<span class="line-added">197     }</span>
198     return JNI_FALSE;
199   }
200   return JNI_TRUE;
201 JVM_END
202 
203 JVM_ENTRY_NO_ENV(jboolean, jfr_destroy_jfr(JNIEnv* env, jobject jvm))
204   JfrRecorder::destroy();
205   return JNI_TRUE;
206 JVM_END
207 
208 JVM_ENTRY_NO_ENV(void, jfr_begin_recording(JNIEnv* env, jobject jvm))
209   if (JfrRecorder::is_recording()) {
210     return;
211   }
212   JfrRecorder::start_recording();
213 JVM_END
214 
<span class="line-added">215 JVM_ENTRY_NO_ENV(jboolean, jfr_is_recording(JNIEnv * env, jobject jvm))</span>
<span class="line-added">216   return JfrRecorder::is_recording() ? JNI_TRUE : JNI_FALSE;</span>
<span class="line-added">217 JVM_END</span>
<span class="line-added">218 </span>
219 JVM_ENTRY_NO_ENV(void, jfr_end_recording(JNIEnv* env, jobject jvm))
220   if (!JfrRecorder::is_recording()) {
221     return;
222   }
223   JfrRecorder::stop_recording();
224 JVM_END
225 
<span class="line-added">226 JVM_ENTRY_NO_ENV(void, jfr_mark_chunk_final(JNIEnv * env, jobject jvm))</span>
<span class="line-added">227   JfrRepository::mark_chunk_final();</span>
<span class="line-added">228 JVM_END</span>
229 
230 JVM_ENTRY_NO_ENV(jboolean, jfr_emit_event(JNIEnv* env, jobject jvm, jlong eventTypeId, jlong timeStamp, jlong when))
231   JfrPeriodicEventSet::requestEvent((JfrEventId)eventTypeId);
232   return thread-&gt;has_pending_exception() ? JNI_FALSE : JNI_TRUE;
233 JVM_END
234 
235 JVM_ENTRY_NO_ENV(jobject, jfr_get_all_event_classes(JNIEnv* env, jobject jvm))
236   return JfrEventClasses::get_all_event_classes(thread);
237 JVM_END
238 
239 JVM_ENTRY_NO_ENV(jlong, jfr_class_id(JNIEnv* env, jclass jvm, jclass jc))
240   return JfrTraceId::use(jc);
241 JVM_END
242 
243 JVM_ENTRY_NO_ENV(jlong, jfr_stacktrace_id(JNIEnv* env, jobject jvm, jint skip))
244   return JfrStackTraceRepository::record(thread, skip);
245 JVM_END
246 
247 JVM_ENTRY_NO_ENV(void, jfr_log(JNIEnv* env, jobject jvm, jint tag_set, jint level, jstring message))
248   JfrJavaLog::log(tag_set, level, message, thread);
</pre>
<hr />
<pre>
276   JfrMetadataEvent::update(descriptor);
277 JVM_END
278 
279 // trace thread id for a thread object
280 JVM_ENTRY_NO_ENV(jlong, jfr_id_for_thread(JNIEnv* env, jobject jvm, jobject t))
281   return JfrJavaSupport::jfr_thread_id(t);
282 JVM_END
283 
284 JVM_ENTRY_NO_ENV(jobject, jfr_get_event_writer(JNIEnv* env, jclass cls))
285   return JfrJavaEventWriter::event_writer(thread);
286 JVM_END
287 
288 JVM_ENTRY_NO_ENV(jobject, jfr_new_event_writer(JNIEnv* env, jclass cls))
289   return JfrJavaEventWriter::new_event_writer(thread);
290 JVM_END
291 
292 JVM_ENTRY_NO_ENV(jboolean, jfr_event_writer_flush(JNIEnv* env, jclass cls, jobject writer, jint used_size, jint requested_size))
293   return JfrJavaEventWriter::flush(writer, used_size, requested_size, thread);
294 JVM_END
295 
<span class="line-added">296 JVM_ENTRY_NO_ENV(void, jfr_flush(JNIEnv* env, jobject jvm))</span>
<span class="line-added">297   JfrRepository::flush(thread);</span>
<span class="line-added">298 JVM_END</span>
<span class="line-added">299 </span>
300 JVM_ENTRY_NO_ENV(void, jfr_set_repository_location(JNIEnv* env, jobject repo, jstring location))
301   return JfrRepository::set_path(location, thread);
302 JVM_END
303 
304 JVM_ENTRY_NO_ENV(void, jfr_uncaught_exception(JNIEnv* env, jobject jvm, jobject t, jthrowable throwable))
305   JfrJavaSupport::uncaught_exception(throwable, thread);
306 JVM_END
307 
308 JVM_ENTRY_NO_ENV(void, jfr_abort(JNIEnv* env, jobject jvm, jstring errorMsg))
309   JfrJavaSupport::abort(errorMsg, thread);
310 JVM_END
311 
312 JVM_ENTRY_NO_ENV(jlong, jfr_type_id(JNIEnv* env, jobject jvm, jclass jc))
313   return JfrTraceId::get(jc);
314 JVM_END
315 
316 JVM_ENTRY_NO_ENV(jboolean, jfr_add_string_constant(JNIEnv* env, jclass jvm, jboolean epoch, jlong id, jstring string))
317   return JfrStringPool::add(epoch == JNI_TRUE, id, string, thread) ? JNI_TRUE : JNI_FALSE;
318 JVM_END
319 
320 JVM_ENTRY_NO_ENV(void, jfr_set_force_instrumentation(JNIEnv* env, jobject jvm, jboolean force_instrumentation))
321   JfrEventClassTransformer::set_force_instrumentation(force_instrumentation == JNI_TRUE);
322 JVM_END
323 
324 JVM_ENTRY_NO_ENV(void, jfr_emit_old_object_samples(JNIEnv* env, jobject jvm, jlong cutoff_ticks, jboolean emit_all))
325   LeakProfiler::emit_events(cutoff_ticks, emit_all == JNI_TRUE);
326 JVM_END
<span class="line-added">327 </span>
<span class="line-added">328 JVM_ENTRY_NO_ENV(void, jfr_exclude_thread(JNIEnv* env, jobject jvm, jobject t))</span>
<span class="line-added">329   JfrJavaSupport::exclude(t);</span>
<span class="line-added">330 JVM_END</span>
<span class="line-added">331 </span>
<span class="line-added">332 JVM_ENTRY_NO_ENV(void, jfr_include_thread(JNIEnv* env, jobject jvm, jobject t))</span>
<span class="line-added">333   JfrJavaSupport::include(t);</span>
<span class="line-added">334 JVM_END</span>
<span class="line-added">335 </span>
<span class="line-added">336 JVM_ENTRY_NO_ENV(jboolean, jfr_is_thread_excluded(JNIEnv* env, jobject jvm, jobject t))</span>
<span class="line-added">337   return JfrJavaSupport::is_excluded(t);</span>
<span class="line-added">338 JVM_END</span>
<span class="line-added">339 </span>
<span class="line-added">340 JVM_ENTRY_NO_ENV(jlong, jfr_chunk_start_nanos(JNIEnv* env, jobject jvm))</span>
<span class="line-added">341   return JfrRepository::current_chunk_start_nanos();</span>
<span class="line-added">342 JVM_END</span>
<span class="line-added">343 </span>
<span class="line-added">344 JVM_ENTRY_NO_ENV(jobject, jfr_get_handler(JNIEnv * env, jobject jvm, jobject clazz))</span>
<span class="line-added">345   return JfrJavaSupport::get_handler(clazz, thread);</span>
<span class="line-added">346 JVM_END</span>
<span class="line-added">347 </span>
<span class="line-added">348 JVM_ENTRY_NO_ENV(jboolean, jfr_set_handler(JNIEnv * env, jobject jvm, jobject clazz, jobject handler))</span>
<span class="line-added">349   return JfrJavaSupport::set_handler(clazz, handler, thread);</span>
<span class="line-added">350 JVM_END</span>
<span class="line-added">351 </span>
<span class="line-added">352 </span>
</pre>
</td>
</tr>
</table>
<center><a href="jfrJavaSupport.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrJniMethod.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>