<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/jfr/jni/jfrJniMethod.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="jfrJavaSupport.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrJniMethod.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/jni/jfrJniMethod.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2014, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2014, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -190,11 +190,13 @@</span>
  JVM_ENTRY_NO_ENV(jboolean, jfr_create_jfr(JNIEnv* env, jobject jvm, jboolean simulate_failure))
    if (JfrRecorder::is_created()) {
      return JNI_TRUE;
    }
    if (!JfrRecorder::create(simulate_failure == JNI_TRUE)) {
<span class="udiff-line-modified-removed">-     JfrJavaSupport::throw_illegal_state_exception(&quot;Unable to start Jfr&quot;, thread);</span>
<span class="udiff-line-modified-added">+     if (!thread-&gt;has_pending_exception()) {</span>
<span class="udiff-line-added">+       JfrJavaSupport::throw_illegal_state_exception(&quot;Unable to start Jfr&quot;, thread);</span>
<span class="udiff-line-added">+     }</span>
      return JNI_FALSE;
    }
    return JNI_TRUE;
  JVM_END
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -208,17 +210,24 @@</span>
      return;
    }
    JfrRecorder::start_recording();
  JVM_END
  
<span class="udiff-line-added">+ JVM_ENTRY_NO_ENV(jboolean, jfr_is_recording(JNIEnv * env, jobject jvm))</span>
<span class="udiff-line-added">+   return JfrRecorder::is_recording() ? JNI_TRUE : JNI_FALSE;</span>
<span class="udiff-line-added">+ JVM_END</span>
<span class="udiff-line-added">+ </span>
  JVM_ENTRY_NO_ENV(void, jfr_end_recording(JNIEnv* env, jobject jvm))
    if (!JfrRecorder::is_recording()) {
      return;
    }
    JfrRecorder::stop_recording();
  JVM_END
  
<span class="udiff-line-added">+ JVM_ENTRY_NO_ENV(void, jfr_mark_chunk_final(JNIEnv * env, jobject jvm))</span>
<span class="udiff-line-added">+   JfrRepository::mark_chunk_final();</span>
<span class="udiff-line-added">+ JVM_END</span>
  
  JVM_ENTRY_NO_ENV(jboolean, jfr_emit_event(JNIEnv* env, jobject jvm, jlong eventTypeId, jlong timeStamp, jlong when))
    JfrPeriodicEventSet::requestEvent((JfrEventId)eventTypeId);
    return thread-&gt;has_pending_exception() ? JNI_FALSE : JNI_TRUE;
  JVM_END
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -282,10 +291,14 @@</span>
  
  JVM_ENTRY_NO_ENV(jboolean, jfr_event_writer_flush(JNIEnv* env, jclass cls, jobject writer, jint used_size, jint requested_size))
    return JfrJavaEventWriter::flush(writer, used_size, requested_size, thread);
  JVM_END
  
<span class="udiff-line-added">+ JVM_ENTRY_NO_ENV(void, jfr_flush(JNIEnv* env, jobject jvm))</span>
<span class="udiff-line-added">+   JfrRepository::flush(thread);</span>
<span class="udiff-line-added">+ JVM_END</span>
<span class="udiff-line-added">+ </span>
  JVM_ENTRY_NO_ENV(void, jfr_set_repository_location(JNIEnv* env, jobject repo, jstring location))
    return JfrRepository::set_path(location, thread);
  JVM_END
  
  JVM_ENTRY_NO_ENV(void, jfr_uncaught_exception(JNIEnv* env, jobject jvm, jobject t, jthrowable throwable))
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -309,5 +322,31 @@</span>
  JVM_END
  
  JVM_ENTRY_NO_ENV(void, jfr_emit_old_object_samples(JNIEnv* env, jobject jvm, jlong cutoff_ticks, jboolean emit_all))
    LeakProfiler::emit_events(cutoff_ticks, emit_all == JNI_TRUE);
  JVM_END
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ JVM_ENTRY_NO_ENV(void, jfr_exclude_thread(JNIEnv* env, jobject jvm, jobject t))</span>
<span class="udiff-line-added">+   JfrJavaSupport::exclude(t);</span>
<span class="udiff-line-added">+ JVM_END</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ JVM_ENTRY_NO_ENV(void, jfr_include_thread(JNIEnv* env, jobject jvm, jobject t))</span>
<span class="udiff-line-added">+   JfrJavaSupport::include(t);</span>
<span class="udiff-line-added">+ JVM_END</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ JVM_ENTRY_NO_ENV(jboolean, jfr_is_thread_excluded(JNIEnv* env, jobject jvm, jobject t))</span>
<span class="udiff-line-added">+   return JfrJavaSupport::is_excluded(t);</span>
<span class="udiff-line-added">+ JVM_END</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ JVM_ENTRY_NO_ENV(jlong, jfr_chunk_start_nanos(JNIEnv* env, jobject jvm))</span>
<span class="udiff-line-added">+   return JfrRepository::current_chunk_start_nanos();</span>
<span class="udiff-line-added">+ JVM_END</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ JVM_ENTRY_NO_ENV(jobject, jfr_get_handler(JNIEnv * env, jobject jvm, jobject clazz))</span>
<span class="udiff-line-added">+   return JfrJavaSupport::get_handler(clazz, thread);</span>
<span class="udiff-line-added">+ JVM_END</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ JVM_ENTRY_NO_ENV(jboolean, jfr_set_handler(JNIEnv * env, jobject jvm, jobject clazz, jobject handler))</span>
<span class="udiff-line-added">+   return JfrJavaSupport::set_handler(clazz, handler, thread);</span>
<span class="udiff-line-added">+ JVM_END</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
</pre>
<center><a href="jfrJavaSupport.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrJniMethod.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>