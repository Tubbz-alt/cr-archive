<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/jfr/jni/jfrJavaCall.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="jfrGetAllEventClasses.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrJavaCall.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/jni/jfrJavaCall.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2017, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -36,13 +36,13 @@</span>
  static bool is_large_value(const JavaValue&amp; value) {
    return value.get_type() == T_LONG || value.get_type() == T_DOUBLE;
  }
  #endif // ASSERT
  
<span class="udiff-line-modified-removed">- static Symbol* resolve(const char* str, TRAPS) {</span>
<span class="udiff-line-modified-added">+ static Symbol* resolve(const char* str) {</span>
    assert(str != NULL, &quot;invariant&quot;);
<span class="udiff-line-modified-removed">-   return SymbolTable::lookup(str, (int)strlen(str), THREAD);</span>
<span class="udiff-line-modified-added">+   return SymbolTable::new_symbol(str);</span>
  }
  
  static Klass* resolve(Symbol* k_sym, TRAPS) {
    assert(k_sym != NULL, &quot;invariant&quot;);
    return SystemDictionary::resolve_or_fail(k_sym, true, THREAD);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -71,11 +71,11 @@</span>
  
  void JfrJavaArguments::Parameters::set_receiver(const oop receiver) {
    assert(_storage != NULL, &quot;invariant&quot;);
    assert(receiver != NULL, &quot;invariant&quot;);
    JavaValue value(T_OBJECT);
<span class="udiff-line-modified-removed">-   value.set_jobject((jobject)receiver);</span>
<span class="udiff-line-modified-added">+   value.set_jobject(cast_from_oop&lt;jobject&gt;(receiver));</span>
    _storage[0] = value;
  }
  
  void JfrJavaArguments::Parameters::set_receiver(Handle receiver) {
    set_receiver(receiver());
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -94,11 +94,11 @@</span>
    return _storage[0].get_type() == T_OBJECT;
  }
  
  void JfrJavaArguments::Parameters::push_oop(const oop obj) {
    JavaValue value(T_OBJECT);
<span class="udiff-line-modified-removed">-   value.set_jobject((jobject)obj);</span>
<span class="udiff-line-modified-added">+   value.set_jobject(cast_from_oop&lt;jobject&gt;(obj));</span>
    push(value);
  }
  
  void JfrJavaArguments::Parameters::push_oop(Handle h_obj) {
    push_oop(h_obj());
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -182,37 +182,37 @@</span>
          ShouldNotReachHere();
      }
    }
  }
  
<span class="udiff-line-modified-removed">- JfrJavaArguments::JfrJavaArguments(JavaValue* result) : _result(result), _klass(NULL), _name(NULL), _signature(NULL), _array_length(0) {</span>
<span class="udiff-line-modified-added">+ JfrJavaArguments::JfrJavaArguments(JavaValue* result) : _result(result), _klass(NULL), _name(NULL), _signature(NULL), _array_length(-1) {</span>
    assert(result != NULL, &quot;invariant&quot;);
  }
  
  JfrJavaArguments::JfrJavaArguments(JavaValue* result, const char* klass_name, const char* name, const char* signature, TRAPS) :
    _result(result),
    _klass(NULL),
    _name(NULL),
    _signature(NULL),
<span class="udiff-line-modified-removed">-   _array_length(0) {</span>
<span class="udiff-line-modified-added">+   _array_length(-1) {</span>
    assert(result != NULL, &quot;invariant&quot;);
    if (klass_name != NULL) {
      set_klass(klass_name, CHECK);
    }
    if (name != NULL) {
<span class="udiff-line-modified-removed">-     set_name(name, CHECK);</span>
<span class="udiff-line-modified-added">+     set_name(name);</span>
    }
    if (signature != NULL) {
<span class="udiff-line-modified-removed">-     set_signature(signature, THREAD);</span>
<span class="udiff-line-modified-added">+     set_signature(signature);</span>
    }
  }
  
  JfrJavaArguments::JfrJavaArguments(JavaValue* result, const Klass* klass, const Symbol* name, const Symbol* signature) : _result(result),
    _klass(NULL),
    _name(NULL),
    _signature(NULL),
<span class="udiff-line-modified-removed">-   _array_length(0) {</span>
<span class="udiff-line-modified-added">+   _array_length(-1) {</span>
    assert(result != NULL, &quot;invariant&quot;);
    if (klass != NULL) {
      set_klass(klass);
    }
    if (name != NULL) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -228,11 +228,11 @@</span>
    return const_cast&lt;Klass*&gt;(_klass);
  }
  
  void JfrJavaArguments::set_klass(const char* klass_name, TRAPS) {
    assert(klass_name != NULL, &quot;invariant&quot;);
<span class="udiff-line-modified-removed">-   Symbol* const k_sym = resolve(klass_name, CHECK);</span>
<span class="udiff-line-modified-added">+   Symbol* const k_sym = resolve(klass_name);</span>
    assert(k_sym != NULL, &quot;invariant&quot;);
    const Klass* const klass = resolve(k_sym, CHECK);
    set_klass(klass);
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -244,13 +244,13 @@</span>
  Symbol* JfrJavaArguments::name() const {
    assert(_name != NULL, &quot;invariant&quot;);
    return const_cast&lt;Symbol*&gt;(_name);
  }
  
<span class="udiff-line-modified-removed">- void JfrJavaArguments::set_name(const char* name, TRAPS) {</span>
<span class="udiff-line-modified-added">+ void JfrJavaArguments::set_name(const char* name) {</span>
    assert(name != NULL, &quot;invariant&quot;);
<span class="udiff-line-modified-removed">-   const Symbol* const sym = resolve(name, CHECK);</span>
<span class="udiff-line-modified-added">+   const Symbol* const sym = resolve(name);</span>
    set_name(sym);
  }
  
  void JfrJavaArguments::set_name(const Symbol* name) {
    assert(name != NULL, &quot;invariant&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -260,13 +260,13 @@</span>
  Symbol* JfrJavaArguments::signature() const {
    assert(_signature != NULL, &quot;invariant&quot;);
    return const_cast&lt;Symbol*&gt;(_signature);
  }
  
<span class="udiff-line-modified-removed">- void JfrJavaArguments::set_signature(const char* signature, TRAPS) {</span>
<span class="udiff-line-modified-added">+ void JfrJavaArguments::set_signature(const char* signature) {</span>
    assert(signature != NULL, &quot;invariant&quot;);
<span class="udiff-line-modified-removed">-   const Symbol* const sym = resolve(signature, CHECK);</span>
<span class="udiff-line-modified-added">+   const Symbol* const sym = resolve(signature);</span>
    set_signature(sym);
  }
  
  void JfrJavaArguments::set_signature(const Symbol* signature) {
    assert(signature != NULL, &quot;invariant&quot;);
</pre>
<center><a href="jfrGetAllEventClasses.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrJavaCall.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>