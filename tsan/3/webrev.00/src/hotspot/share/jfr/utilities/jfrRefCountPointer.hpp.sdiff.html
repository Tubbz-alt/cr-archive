<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/jfr/utilities/jfrRefCountPointer.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="jfrLogTagSets.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrTryLock.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/utilities/jfrRefCountPointer.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 75   bool valid() const {
 76     return _ptr != NULL;
 77   }
 78 
 79   const T &amp; operator-&gt;() const {
 80     return *_ptr;
 81   }
 82 
 83   T&amp; operator-&gt;() {
 84     return *const_cast&lt;T*&gt;(_ptr);
 85   }
 86 };
 87 
 88 class MultiThreadedRefCounter {
 89  private:
 90   mutable volatile int _refs;
 91  public:
 92   MultiThreadedRefCounter() : _refs(0) {}
 93 
 94   void inc() const {
<span class="line-modified"> 95     Atomic::add(1, &amp;_refs);</span>
 96   }
 97 
 98   bool dec() const {
<span class="line-modified"> 99     return 0 == Atomic::add((-1), &amp;_refs);</span>
100   }
101 
102   int current() const {
103    return _refs;
104   }
105 };
106 
107 template &lt;typename T, typename RefCountImpl = MultiThreadedRefCounter&gt;
108 class RefCountPointer : public JfrCHeapObj {
109   template &lt;typename&gt;
110   friend class RefCountHandle;
111   typedef RefCountHandle&lt;RefCountPointer&lt;T, RefCountImpl&gt; &gt; RefHandle;
112  private:
113   const T* _ptr;
114   mutable RefCountImpl _refs;
115 
116   // disallow multiple copies
117   RefCountPointer(const RefCountPointer&lt;T, RefCountImpl&gt;&amp; rhs);
118   void operator=(const RefCountPointer&lt;T, RefCountImpl&gt;&amp; rhs);
119 
</pre>
</td>
<td>
<hr />
<pre>
 75   bool valid() const {
 76     return _ptr != NULL;
 77   }
 78 
 79   const T &amp; operator-&gt;() const {
 80     return *_ptr;
 81   }
 82 
 83   T&amp; operator-&gt;() {
 84     return *const_cast&lt;T*&gt;(_ptr);
 85   }
 86 };
 87 
 88 class MultiThreadedRefCounter {
 89  private:
 90   mutable volatile int _refs;
 91  public:
 92   MultiThreadedRefCounter() : _refs(0) {}
 93 
 94   void inc() const {
<span class="line-modified"> 95     Atomic::add(&amp;_refs, 1);</span>
 96   }
 97 
 98   bool dec() const {
<span class="line-modified"> 99     return 0 == Atomic::add(&amp;_refs, (-1));</span>
100   }
101 
102   int current() const {
103    return _refs;
104   }
105 };
106 
107 template &lt;typename T, typename RefCountImpl = MultiThreadedRefCounter&gt;
108 class RefCountPointer : public JfrCHeapObj {
109   template &lt;typename&gt;
110   friend class RefCountHandle;
111   typedef RefCountHandle&lt;RefCountPointer&lt;T, RefCountImpl&gt; &gt; RefHandle;
112  private:
113   const T* _ptr;
114   mutable RefCountImpl _refs;
115 
116   // disallow multiple copies
117   RefCountPointer(const RefCountPointer&lt;T, RefCountImpl&gt;&amp; rhs);
118   void operator=(const RefCountPointer&lt;T, RefCountImpl&gt;&amp; rhs);
119 
</pre>
</td>
</tr>
</table>
<center><a href="jfrLogTagSets.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrTryLock.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>