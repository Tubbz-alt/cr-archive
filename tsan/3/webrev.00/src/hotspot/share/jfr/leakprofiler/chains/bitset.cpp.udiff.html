<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/jfr/leakprofiler/chains/bitset.cpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="bfsClosure.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="bitset.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/leakprofiler/chains/bitset.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -20,39 +20,27 @@</span>
   * or visit www.oracle.com if you need additional information or have any
   * questions.
   *
   */
  #include &quot;precompiled.hpp&quot;
<span class="udiff-line-modified-removed">- #include &quot;jfr/leakprofiler/chains/bitset.hpp&quot;</span>
<span class="udiff-line-removed">- #include &quot;jfr/recorder/storage/jfrVirtualMemory.hpp&quot;</span>
<span class="udiff-line-removed">- #include &quot;memory/memRegion.hpp&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;jfr/leakprofiler/chains/bitset.inline.hpp&quot;</span>
  
<span class="udiff-line-modified-removed">- BitSet::BitSet(const MemRegion&amp; covered_region) :</span>
<span class="udiff-line-modified-removed">-   _vmm(NULL),</span>
<span class="udiff-line-modified-removed">-   _region_start(covered_region.start()),</span>
<span class="udiff-line-removed">-   _region_size(covered_region.word_size()) {</span>
<span class="udiff-line-modified-added">+ BitSet::BitMapFragment::BitMapFragment(uintptr_t granule, BitMapFragment* next) :</span>
<span class="udiff-line-modified-added">+     _bits(_bitmap_granularity_size &gt;&gt; LogMinObjAlignmentInBytes, mtTracing, true /* clear */),</span>
<span class="udiff-line-modified-added">+     _next(next) {</span>
  }
  
<span class="udiff-line-modified-removed">- BitSet::~BitSet() {</span>
<span class="udiff-line-modified-removed">-   delete _vmm;</span>
<span class="udiff-line-modified-added">+ BitSet::BitSet() :</span>
<span class="udiff-line-modified-added">+     _bitmap_fragments(32),</span>
<span class="udiff-line-added">+     _fragment_list(NULL),</span>
<span class="udiff-line-added">+     _last_fragment_bits(NULL),</span>
<span class="udiff-line-added">+     _last_fragment_granule(0) {</span>
  }
  
<span class="udiff-line-modified-removed">- bool BitSet::initialize() {</span>
<span class="udiff-line-modified-removed">-   assert(_vmm == NULL, &quot;invariant&quot;);</span>
<span class="udiff-line-modified-removed">-   _vmm = new JfrVirtualMemory();</span>
<span class="udiff-line-modified-removed">-   if (_vmm == NULL) {</span>
<span class="udiff-line-modified-removed">-     return false;</span>
<span class="udiff-line-modified-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   const BitMap::idx_t bits = _region_size &gt;&gt; LogMinObjAlignment;</span>
<span class="udiff-line-removed">-   const size_t words = bits / BitsPerWord;</span>
<span class="udiff-line-removed">-   const size_t raw_bytes = words * sizeof(BitMap::idx_t);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   // the virtual memory invocation will reserve and commit the entire space</span>
<span class="udiff-line-removed">-   BitMap::bm_word_t* map = (BitMap::bm_word_t*)_vmm-&gt;initialize(raw_bytes, raw_bytes);</span>
<span class="udiff-line-removed">-   if (map == NULL) {</span>
<span class="udiff-line-removed">-     return false;</span>
<span class="udiff-line-modified-added">+ BitSet::~BitSet() {</span>
<span class="udiff-line-modified-added">+   BitMapFragment* current = _fragment_list;</span>
<span class="udiff-line-modified-added">+   while (current != NULL) {</span>
<span class="udiff-line-modified-added">+     BitMapFragment* next = current-&gt;next();</span>
<span class="udiff-line-modified-added">+     delete current;</span>
<span class="udiff-line-modified-added">+     current = next;</span>
    }
<span class="udiff-line-removed">-   _bits = BitMapView(map, bits);</span>
<span class="udiff-line-removed">-   return true;</span>
  }
<span class="udiff-line-removed">- </span>
</pre>
<center><a href="bfsClosure.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="bitset.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>