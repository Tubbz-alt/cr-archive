<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/jfr/leakprofiler/sampling/objectSampler.hpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="objectSampler.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="sampleList.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/leakprofiler/sampling/objectSampler.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -26,53 +26,63 @@</span>
  #define SHARE_JFR_LEAKPROFILER_SAMPLING_OBJECTSAMPLER_HPP
  
  #include &quot;memory/allocation.hpp&quot;
  #include &quot;jfr/utilities/jfrTime.hpp&quot;
  
<span class="udiff-line-added">+ typedef u8 traceid;</span>
<span class="udiff-line-added">+ </span>
  class BoolObjectClosure;
<span class="udiff-line-added">+ class JavaThread;</span>
  class OopClosure;
  class ObjectSample;
<span class="udiff-line-removed">- class ObjectSampler;</span>
  class SampleList;
  class SamplePriorityQueue;
<span class="udiff-line-removed">- class Thread;</span>
  
  // Class reponsible for holding samples and
  // making sure the samples are evenly distributed as
  // new entries are added and removed.
  class ObjectSampler : public CHeapObj&lt;mtTracing&gt; {
    friend class LeakProfiler;
<span class="udiff-line-removed">-   friend class ObjectSampleCheckpoint;</span>
    friend class StartOperation;
    friend class StopOperation;
<span class="udiff-line-removed">-   friend class EmitEventOperation;</span>
   private:
    SamplePriorityQueue* _priority_queue;
    SampleList* _list;
    JfrTicks _last_sweep;
    size_t _total_allocated;
    size_t _threshold;
    size_t _size;
<span class="udiff-line-removed">-   volatile int _tryLock;</span>
    bool _dead_samples;
  
<span class="udiff-line-added">+   // Lifecycle</span>
    explicit ObjectSampler(size_t size);
    ~ObjectSampler();
<span class="udiff-line-added">+   static bool create(size_t size);</span>
<span class="udiff-line-added">+   static bool is_created();</span>
<span class="udiff-line-added">+   static void destroy();</span>
  
<span class="udiff-line-modified-removed">-   void add(HeapWord* object, size_t size, JavaThread* thread);</span>
<span class="udiff-line-modified-removed">-   void remove_dead(ObjectSample* sample);</span>
<span class="udiff-line-modified-added">+   // Sampling</span>
<span class="udiff-line-modified-added">+   static void sample(HeapWord* object, size_t size, JavaThread* thread);</span>
<span class="udiff-line-added">+   void add(HeapWord* object, size_t size, traceid thread_id, JavaThread* thread);</span>
    void scavenge();
<span class="udiff-line-added">+   void remove_dead(ObjectSample* sample);</span>
  
    // Called by GC
<span class="udiff-line-modified-removed">-   void oops_do(BoolObjectClosure* is_alive, OopClosure* f);</span>
<span class="udiff-line-modified-added">+   static void weak_oops_do(BoolObjectClosure* is_alive, OopClosure* f);</span>
  
<span class="udiff-line-removed">-  public:</span>
    const ObjectSample* item_at(int index) const;
    ObjectSample* item_at(int index);
    int item_count() const;
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+  public:</span>
<span class="udiff-line-added">+   static ObjectSampler* sampler();</span>
<span class="udiff-line-added">+   // For operations that require exclusive access (non-safepoint)</span>
<span class="udiff-line-added">+   static ObjectSampler* acquire();</span>
<span class="udiff-line-added">+   static void release();</span>
<span class="udiff-line-added">+ </span>
    const ObjectSample* first() const;
<span class="udiff-line-modified-removed">-   const ObjectSample* last() const;</span>
<span class="udiff-line-modified-added">+   ObjectSample* last() const;</span>
    const ObjectSample* last_resolved() const;
    void set_last_resolved(const ObjectSample* sample);
    const JfrTicks&amp; last_sweep() const;
  };
  
</pre>
<center><a href="objectSampler.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="sampleList.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>