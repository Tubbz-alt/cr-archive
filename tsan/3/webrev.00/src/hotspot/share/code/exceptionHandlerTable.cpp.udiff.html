<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/code/exceptionHandlerTable.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="dependencyContext.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="exceptionHandlerTable.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/code/exceptionHandlerTable.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 1998, 2016, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 1998, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -174,26 +174,40 @@</span>
    *(adr(l)  ) = exec_off;
    *(adr(l)+1) = cont_off;
    _len = l+1;
  };
  
<span class="udiff-line-modified-removed">- uint ImplicitExceptionTable::at( uint exec_off ) const {</span>
<span class="udiff-line-modified-added">+ uint ImplicitExceptionTable::continuation_offset( uint exec_off ) const {</span>
    uint l = len();
    for( uint i=0; i&lt;l; i++ )
      if( *adr(i) == exec_off )
        return *(adr(i)+1);
    return 0;                     // Failed to find any execption offset
  }
  
  void ImplicitExceptionTable::print(address base) const {
<span class="udiff-line-modified-removed">-   tty-&gt;print(&quot;{&quot;);</span>
<span class="udiff-line-modified-removed">-   for( uint i=0; i&lt;len(); i++ )</span>
<span class="udiff-line-modified-removed">-     tty-&gt;print(&quot;&lt; &quot; INTPTR_FORMAT &quot;, &quot; INTPTR_FORMAT &quot; &gt; &quot;, p2i(base + *adr(i)), p2i(base + *(adr(i)+1)));</span>
<span class="udiff-line-modified-removed">-   tty-&gt;print_cr(&quot;}&quot;);</span>
<span class="udiff-line-modified-added">+   const uint n = len();</span>
<span class="udiff-line-modified-added">+   if (n &gt; 0) {</span>
<span class="udiff-line-modified-added">+     const uint items_per_line = 3;</span>
<span class="udiff-line-modified-added">+     uint i;</span>
<span class="udiff-line-added">+     tty-&gt;print_cr(&quot;ImplicitExceptionTable (size = %d entries, %d bytes):&quot;, n, size_in_bytes());</span>
<span class="udiff-line-added">+     tty-&gt;print(&quot;{&quot;);</span>
<span class="udiff-line-added">+     for (i = 0; i &lt; n; i++) {</span>
<span class="udiff-line-added">+       if (i%items_per_line == 0) {</span>
<span class="udiff-line-added">+         tty-&gt;cr();</span>
<span class="udiff-line-added">+         tty-&gt;fill_to(3);</span>
<span class="udiff-line-added">+       }</span>
<span class="udiff-line-added">+       tty-&gt;print(&quot;&lt; &quot; INTPTR_FORMAT &quot;, &quot; INTPTR_FORMAT &quot; &gt; &quot;, p2i(base + *adr(i)), p2i(base + *(adr(i)+1)));</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     tty-&gt;bol();</span>
<span class="udiff-line-added">+     tty-&gt;print_cr(&quot;}&quot;);</span>
<span class="udiff-line-added">+   } else {</span>
<span class="udiff-line-added">+     tty-&gt;print_cr(&quot;ImplicitExceptionTable is empty&quot;);</span>
<span class="udiff-line-added">+   }</span>
  }
  
<span class="udiff-line-modified-removed">- ImplicitExceptionTable::ImplicitExceptionTable(const nmethod* nm) {</span>
<span class="udiff-line-modified-added">+ ImplicitExceptionTable::ImplicitExceptionTable(const CompiledMethod* nm) {</span>
    if (nm-&gt;nul_chk_table_size() == 0) {
      _len = 0;
      _data = NULL;
    } else {
      // the first word is the length if non-zero, so read it out and
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -205,22 +219,26 @@</span>
    _size = len();
    assert(size_in_bytes() &lt;= nm-&gt;nul_chk_table_size(), &quot;size of space allocated in nmethod incorrect&quot;);
  }
  
  void ImplicitExceptionTable::copy_to( nmethod* nm ) {
<span class="udiff-line-modified-removed">-   assert(size_in_bytes() &lt;= nm-&gt;nul_chk_table_size(), &quot;size of space allocated in nmethod incorrect&quot;);</span>
<span class="udiff-line-modified-added">+   copy_bytes_to(nm-&gt;nul_chk_table_begin(), nm-&gt;nul_chk_table_size());</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ void ImplicitExceptionTable::copy_bytes_to(address addr, int size) {</span>
<span class="udiff-line-added">+   assert(size_in_bytes() &lt;= size, &quot;size of space allocated in nmethod incorrect&quot;);</span>
    if (len() != 0) {
<span class="udiff-line-modified-removed">-     implicit_null_entry* nmdata = (implicit_null_entry*)nm-&gt;nul_chk_table_begin();</span>
<span class="udiff-line-modified-added">+     implicit_null_entry* nmdata = (implicit_null_entry*)addr;</span>
      // store the length in the first uint
      nmdata[0] = _len;
      nmdata++;
      // copy the table after the length
      memmove( nmdata, _data, 2 * len() * sizeof(implicit_null_entry));
    } else {
      // zero length table takes zero bytes
      assert(size_in_bytes() == 0, &quot;bad size&quot;);
<span class="udiff-line-modified-removed">-     assert(nm-&gt;nul_chk_table_size() == 0, &quot;bad size&quot;);</span>
<span class="udiff-line-modified-added">+     assert(size == 0, &quot;bad size&quot;);</span>
    }
  }
  
  void ImplicitExceptionTable::verify(nmethod *nm) const {
    for (uint i = 0; i &lt; len(); i++) {
</pre>
<center><a href="dependencyContext.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="exceptionHandlerTable.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>