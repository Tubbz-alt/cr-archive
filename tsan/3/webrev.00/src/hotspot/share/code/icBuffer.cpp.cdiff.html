<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/code/icBuffer.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="exceptionHandlerTable.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="nmethod.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/code/icBuffer.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 30,17 ***</span>
  #include &quot;code/scopeDesc.hpp&quot;
  #include &quot;gc/shared/collectedHeap.inline.hpp&quot;
  #include &quot;interpreter/interpreter.hpp&quot;
  #include &quot;interpreter/linkResolver.hpp&quot;
  #include &quot;memory/resourceArea.hpp&quot;
<span class="line-removed">- #include &quot;memory/universe.hpp&quot;</span>
  #include &quot;oops/method.hpp&quot;
  #include &quot;oops/oop.inline.hpp&quot;
  #include &quot;runtime/handles.inline.hpp&quot;
  #include &quot;runtime/mutexLocker.hpp&quot;
  #include &quot;runtime/stubRoutines.hpp&quot;
<span class="line-modified">! #include &quot;runtime/thread.hpp&quot;</span>
  
  DEF_STUB_INTERFACE(ICStub);
  
  StubQueue* InlineCacheBuffer::_buffer    = NULL;
  
<span class="line-new-header">--- 30,16 ---</span>
  #include &quot;code/scopeDesc.hpp&quot;
  #include &quot;gc/shared/collectedHeap.inline.hpp&quot;
  #include &quot;interpreter/interpreter.hpp&quot;
  #include &quot;interpreter/linkResolver.hpp&quot;
  #include &quot;memory/resourceArea.hpp&quot;
  #include &quot;oops/method.hpp&quot;
  #include &quot;oops/oop.inline.hpp&quot;
  #include &quot;runtime/handles.inline.hpp&quot;
  #include &quot;runtime/mutexLocker.hpp&quot;
  #include &quot;runtime/stubRoutines.hpp&quot;
<span class="line-modified">! #include &quot;runtime/thread.inline.hpp&quot;</span>
  
  DEF_STUB_INTERFACE(ICStub);
  
  StubQueue* InlineCacheBuffer::_buffer    = NULL;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 164,15 ***</span>
    // We could potential get an async. exception at this point.
    // In that case we will rethrow it to ourselvs.
    if (HAS_PENDING_EXCEPTION) {
      oop exception = PENDING_EXCEPTION;
      CLEAR_PENDING_EXCEPTION;
<span class="line-modified">!     Thread::send_async_exception(JavaThread::current()-&gt;threadObj(), exception);</span>
    }
  }
  
<span class="line-removed">- </span>
  void InlineCacheBuffer::update_inline_caches() {
    if (buffer()-&gt;number_of_stubs() &gt; 0) {
      if (TraceICBuffer) {
        tty-&gt;print_cr(&quot;[updating inline caches with %d stubs]&quot;, buffer()-&gt;number_of_stubs());
      }
<span class="line-new-header">--- 163,14 ---</span>
    // We could potential get an async. exception at this point.
    // In that case we will rethrow it to ourselvs.
    if (HAS_PENDING_EXCEPTION) {
      oop exception = PENDING_EXCEPTION;
      CLEAR_PENDING_EXCEPTION;
<span class="line-modified">!     JavaThread::current()-&gt;set_pending_async_exception(exception);</span>
    }
  }
  
  void InlineCacheBuffer::update_inline_caches() {
    if (buffer()-&gt;number_of_stubs() &gt; 0) {
      if (TraceICBuffer) {
        tty-&gt;print_cr(&quot;[updating inline caches with %d stubs]&quot;, buffer()-&gt;number_of_stubs());
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 256,11 ***</span>
  
  // Enqueue this icholder for release during the next safepoint.  It&#39;s
  // not safe to free them until them since they might be visible to
  // another thread.
  void InlineCacheBuffer::queue_for_release(CompiledICHolder* icholder) {
<span class="line-modified">!   MutexLockerEx mex(InlineCacheBuffer_lock, Mutex::_no_safepoint_check_flag);</span>
    icholder-&gt;set_next(_pending_released);
    _pending_released = icholder;
    _pending_count++;
    if (TraceICBuffer) {
      tty-&gt;print_cr(&quot;enqueueing icholder &quot; INTPTR_FORMAT &quot; to be freed&quot;, p2i(icholder));
<span class="line-new-header">--- 254,11 ---</span>
  
  // Enqueue this icholder for release during the next safepoint.  It&#39;s
  // not safe to free them until them since they might be visible to
  // another thread.
  void InlineCacheBuffer::queue_for_release(CompiledICHolder* icholder) {
<span class="line-modified">!   MutexLocker mex(InlineCacheBuffer_lock, Mutex::_no_safepoint_check_flag);</span>
    icholder-&gt;set_next(_pending_released);
    _pending_released = icholder;
    _pending_count++;
    if (TraceICBuffer) {
      tty-&gt;print_cr(&quot;enqueueing icholder &quot; INTPTR_FORMAT &quot; to be freed&quot;, p2i(icholder));
</pre>
<center><a href="exceptionHandlerTable.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="nmethod.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>