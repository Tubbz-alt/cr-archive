<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/c1/c1_Canonicalizer.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../asm/codeBuffer.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="c1_CodeStubs.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/c1/c1_Canonicalizer.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1999, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  *
</pre>
<hr />
<pre>
 337       default       : ShouldNotReachHere();
 338     }
 339   }
 340 }
 341 
 342 
 343 void Canonicalizer::do_ArithmeticOp   (ArithmeticOp*    x) { do_Op2(x); }
 344 
 345 
 346 void Canonicalizer::do_ShiftOp        (ShiftOp*         x) {
 347   ValueType* t = x-&gt;x()-&gt;type();
 348   ValueType* t2 = x-&gt;y()-&gt;type();
 349   if (t-&gt;is_constant()) {
 350     switch (t-&gt;tag()) {
 351     case intTag   : if (t-&gt;as_IntConstant()-&gt;value() == 0)         { set_constant(0); return; } break;
 352     case longTag  : if (t-&gt;as_LongConstant()-&gt;value() == (jlong)0) { set_constant(jlong_cast(0)); return; } break;
 353     default       : ShouldNotReachHere();
 354     }
 355     if (t2-&gt;is_constant()) {
 356       if (t-&gt;tag() == intTag) {
<span class="line-modified"> 357         int value = t-&gt;as_IntConstant()-&gt;value();</span>
<span class="line-modified"> 358         int shift = t2-&gt;as_IntConstant()-&gt;value() &amp; 31;</span>
<span class="line-removed"> 359         jint mask = ~(~0 &lt;&lt; (32 - shift));</span>
<span class="line-removed"> 360         if (shift == 0) mask = ~0;</span>
 361         switch (x-&gt;op()) {
<span class="line-modified"> 362           case Bytecodes::_ishl:  set_constant(value &lt;&lt; shift); return;</span>
<span class="line-modified"> 363           case Bytecodes::_ishr:  set_constant(value &gt;&gt; shift); return;</span>
<span class="line-modified"> 364           case Bytecodes::_iushr: set_constant((value &gt;&gt; shift) &amp; mask); return;</span>
 365           default:                break;
 366         }
 367       } else if (t-&gt;tag() == longTag) {
 368         jlong value = t-&gt;as_LongConstant()-&gt;value();
<span class="line-modified"> 369         int shift = t2-&gt;as_IntConstant()-&gt;value() &amp; 63;</span>
<span class="line-removed"> 370         jlong mask = ~(~jlong_cast(0) &lt;&lt; (64 - shift));</span>
<span class="line-removed"> 371         if (shift == 0) mask = ~jlong_cast(0);</span>
 372         switch (x-&gt;op()) {
<span class="line-modified"> 373           case Bytecodes::_lshl:  set_constant(value &lt;&lt; shift); return;</span>
<span class="line-modified"> 374           case Bytecodes::_lshr:  set_constant(value &gt;&gt; shift); return;</span>
<span class="line-modified"> 375           case Bytecodes::_lushr: set_constant((value &gt;&gt; shift) &amp; mask); return;</span>
 376           default:                break;
 377         }
 378       }
 379     }
 380   }
 381   if (t2-&gt;is_constant()) {
 382     switch (t2-&gt;tag()) {
 383       case intTag   : if (t2-&gt;as_IntConstant()-&gt;value() == 0)  set_canonical(x-&gt;x()); return;
 384       case longTag  : if (t2-&gt;as_LongConstant()-&gt;value() == (jlong)0)  set_canonical(x-&gt;x()); return;
 385       default       : ShouldNotReachHere(); return;
 386     }
 387   }
 388 }
 389 
 390 
 391 void Canonicalizer::do_LogicOp        (LogicOp*         x) { do_Op2(x); }
 392 void Canonicalizer::do_CompareOp      (CompareOp*       x) {
 393   if (x-&gt;x() == x-&gt;y()) {
 394     switch (x-&gt;x()-&gt;type()-&gt;tag()) {
 395       case longTag: set_constant(0); break;
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1999, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  *
</pre>
<hr />
<pre>
 337       default       : ShouldNotReachHere();
 338     }
 339   }
 340 }
 341 
 342 
 343 void Canonicalizer::do_ArithmeticOp   (ArithmeticOp*    x) { do_Op2(x); }
 344 
 345 
 346 void Canonicalizer::do_ShiftOp        (ShiftOp*         x) {
 347   ValueType* t = x-&gt;x()-&gt;type();
 348   ValueType* t2 = x-&gt;y()-&gt;type();
 349   if (t-&gt;is_constant()) {
 350     switch (t-&gt;tag()) {
 351     case intTag   : if (t-&gt;as_IntConstant()-&gt;value() == 0)         { set_constant(0); return; } break;
 352     case longTag  : if (t-&gt;as_LongConstant()-&gt;value() == (jlong)0) { set_constant(jlong_cast(0)); return; } break;
 353     default       : ShouldNotReachHere();
 354     }
 355     if (t2-&gt;is_constant()) {
 356       if (t-&gt;tag() == intTag) {
<span class="line-modified"> 357         jint value = t-&gt;as_IntConstant()-&gt;value();</span>
<span class="line-modified"> 358         jint shift = t2-&gt;as_IntConstant()-&gt;value();</span>


 359         switch (x-&gt;op()) {
<span class="line-modified"> 360           case Bytecodes::_ishl:  set_constant(java_shift_left(value, shift)); return;</span>
<span class="line-modified"> 361           case Bytecodes::_ishr:  set_constant(java_shift_right(value, shift)); return;</span>
<span class="line-modified"> 362           case Bytecodes::_iushr: set_constant(java_shift_right_unsigned(value, shift)); return;</span>
 363           default:                break;
 364         }
 365       } else if (t-&gt;tag() == longTag) {
 366         jlong value = t-&gt;as_LongConstant()-&gt;value();
<span class="line-modified"> 367         jint shift = t2-&gt;as_IntConstant()-&gt;value();</span>


 368         switch (x-&gt;op()) {
<span class="line-modified"> 369           case Bytecodes::_lshl:  set_constant(java_shift_left(value, shift)); return;</span>
<span class="line-modified"> 370           case Bytecodes::_lshr:  set_constant(java_shift_right(value, shift)); return;</span>
<span class="line-modified"> 371           case Bytecodes::_lushr: set_constant(java_shift_right_unsigned(value, shift)); return;</span>
 372           default:                break;
 373         }
 374       }
 375     }
 376   }
 377   if (t2-&gt;is_constant()) {
 378     switch (t2-&gt;tag()) {
 379       case intTag   : if (t2-&gt;as_IntConstant()-&gt;value() == 0)  set_canonical(x-&gt;x()); return;
 380       case longTag  : if (t2-&gt;as_LongConstant()-&gt;value() == (jlong)0)  set_canonical(x-&gt;x()); return;
 381       default       : ShouldNotReachHere(); return;
 382     }
 383   }
 384 }
 385 
 386 
 387 void Canonicalizer::do_LogicOp        (LogicOp*         x) { do_Op2(x); }
 388 void Canonicalizer::do_CompareOp      (CompareOp*       x) {
 389   if (x-&gt;x() == x-&gt;y()) {
 390     switch (x-&gt;x()-&gt;type()-&gt;tag()) {
 391       case longTag: set_constant(0); break;
</pre>
</td>
</tr>
</table>
<center><a href="../asm/codeBuffer.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="c1_CodeStubs.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>