<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/c1/c1_LIRAssembler.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="c1_LIR.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="c1_LIRAssembler.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/c1/c1_LIRAssembler.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 160,10 ***</span>
<span class="line-new-header">--- 160,13 ---</span>
  
  bool LIR_Assembler::needs_icache(ciMethod* method) const {
    return !method-&gt;is_static();
  }
  
<span class="line-added">+ bool LIR_Assembler::needs_clinit_barrier_on_entry(ciMethod* method) const {</span>
<span class="line-added">+   return VM_Version::supports_fast_class_init_checks() &amp;&amp; method-&gt;needs_clinit_barrier();</span>
<span class="line-added">+ }</span>
  
  int LIR_Assembler::code_offset() const {
    return _masm-&gt;offset();
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 476,11 ***</span>
    // Record if this method has MethodHandle invokes.
    if (op-&gt;is_method_handle_invoke()) {
      compilation()-&gt;set_has_method_handle_invokes(true);
    }
  
<span class="line-modified">! #if defined(X86) &amp;&amp; defined(TIERED)</span>
    // C2 leave fpu stack dirty clean it
    if (UseSSE &lt; 2) {
      int i;
      for ( i = 1; i &lt;= 7 ; i++ ) {
        ffree(i);
<span class="line-new-header">--- 479,11 ---</span>
    // Record if this method has MethodHandle invokes.
    if (op-&gt;is_method_handle_invoke()) {
      compilation()-&gt;set_has_method_handle_invokes(true);
    }
  
<span class="line-modified">! #if defined(IA32) &amp;&amp; defined(TIERED)</span>
    // C2 leave fpu stack dirty clean it
    if (UseSSE &lt; 2) {
      int i;
      for ( i = 1; i &lt;= 7 ; i++ ) {
        ffree(i);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 527,21 ***</span>
          _masm-&gt;nop();
        }
        safepoint_poll(op-&gt;in_opr(), op-&gt;info());
        break;
  
      case lir_fxch:
        fxch(op-&gt;in_opr()-&gt;as_jint());
        break;
  
      case lir_fld:
        fld(op-&gt;in_opr()-&gt;as_jint());
        break;
<span class="line-modified">! </span>
<span class="line-removed">-     case lir_ffree:</span>
<span class="line-removed">-       ffree(op-&gt;in_opr()-&gt;as_jint());</span>
<span class="line-removed">-       break;</span>
  
      case lir_branch:
        break;
  
      case lir_push:
<span class="line-new-header">--- 530,19 ---</span>
          _masm-&gt;nop();
        }
        safepoint_poll(op-&gt;in_opr(), op-&gt;info());
        break;
  
<span class="line-added">+ #ifdef IA32</span>
      case lir_fxch:
        fxch(op-&gt;in_opr()-&gt;as_jint());
        break;
  
      case lir_fld:
        fld(op-&gt;in_opr()-&gt;as_jint());
        break;
<span class="line-modified">! #endif // IA32</span>
  
      case lir_branch:
        break;
  
      case lir_push:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 619,35 ***</span>
        if (needs_icache(compilation()-&gt;method())) {
          check_icache();
        }
        offsets()-&gt;set_value(CodeOffsets::Verified_Entry, _masm-&gt;offset());
        _masm-&gt;verified_entry();
        build_frame();
        offsets()-&gt;set_value(CodeOffsets::Frame_Complete, _masm-&gt;offset());
        break;
  
      case lir_osr_entry:
        offsets()-&gt;set_value(CodeOffsets::OSR_Entry, _masm-&gt;offset());
        osr_entry();
        break;
  
<span class="line-modified">!     case lir_24bit_FPU:</span>
<span class="line-modified">!       set_24bit_FPU();</span>
<span class="line-modified">!       break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     case lir_reset_FPU:</span>
<span class="line-removed">-       reset_FPU();</span>
        break;
  
      case lir_breakpoint:
        breakpoint();
        break;
  
<span class="line-removed">-     case lir_fpop_raw:</span>
<span class="line-removed">-       fpop();</span>
<span class="line-removed">-       break;</span>
<span class="line-removed">- </span>
      case lir_membar:
        membar();
        break;
  
      case lir_membar_acquire:
<span class="line-new-header">--- 620,32 ---</span>
        if (needs_icache(compilation()-&gt;method())) {
          check_icache();
        }
        offsets()-&gt;set_value(CodeOffsets::Verified_Entry, _masm-&gt;offset());
        _masm-&gt;verified_entry();
<span class="line-added">+       if (needs_clinit_barrier_on_entry(compilation()-&gt;method())) {</span>
<span class="line-added">+         clinit_barrier(compilation()-&gt;method());</span>
<span class="line-added">+       }</span>
        build_frame();
        offsets()-&gt;set_value(CodeOffsets::Frame_Complete, _masm-&gt;offset());
        break;
  
      case lir_osr_entry:
        offsets()-&gt;set_value(CodeOffsets::OSR_Entry, _masm-&gt;offset());
        osr_entry();
        break;
  
<span class="line-modified">! #ifdef IA32</span>
<span class="line-modified">!     case lir_fpop_raw:</span>
<span class="line-modified">!       fpop();</span>
        break;
<span class="line-added">+ #endif // IA32</span>
  
      case lir_breakpoint:
        breakpoint();
        break;
  
      case lir_membar:
        membar();
        break;
  
      case lir_membar_acquire:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 778,10 ***</span>
<span class="line-new-header">--- 776,11 ---</span>
    _masm-&gt;build_frame(initial_frame_size_in_bytes(), bang_size_in_bytes());
  }
  
  
  void LIR_Assembler::roundfp_op(LIR_Opr src, LIR_Opr tmp, LIR_Opr dest, bool pop_fpu_stack) {
<span class="line-added">+   assert(strict_fp_requires_explicit_rounding, &quot;not required&quot;);</span>
    assert((src-&gt;is_single_fpu() &amp;&amp; dest-&gt;is_single_stack()) ||
           (src-&gt;is_double_fpu() &amp;&amp; dest-&gt;is_double_stack()),
           &quot;round_fp: rounds register -&gt; stack location&quot;);
  
    reg2stack (src, dest, src-&gt;type(), pop_fpu_stack);
</pre>
<center><a href="c1_LIR.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="c1_LIRAssembler.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>