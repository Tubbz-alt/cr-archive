<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/memory/arena.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="arena.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="filemap.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/memory/arena.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 26,10 ***</span>
<span class="line-new-header">--- 26,11 ---</span>
  #define SHARE_MEMORY_ARENA_HPP
  
  #include &quot;memory/allocation.hpp&quot;
  #include &quot;runtime/globals.hpp&quot;
  #include &quot;utilities/globalDefinitions.hpp&quot;
<span class="line-added">+ #include &quot;utilities/powerOfTwo.hpp&quot;</span>
  
  #include &lt;new&gt;
  
  // The byte alignment to be used by Arena::Amalloc.  See bugid 4169348.
  // Note: this value must be a power of 2
</pre>
<hr />
<pre>
<span class="line-old-header">*** 104,15 ***</span>
    char *_hwm, *_max;            // High water mark and max in current chunk
    // Get a new Chunk of at least size x
    void* grow(size_t x, AllocFailType alloc_failmode = AllocFailStrategy::EXIT_OOM);
    size_t _size_in_bytes;        // Size of arena (used for native memory tracking)
  
<span class="line-removed">-   NOT_PRODUCT(static julong _bytes_allocated;) // total #bytes allocated since start</span>
<span class="line-removed">-   friend class AllocStats;</span>
    debug_only(void* malloc(size_t size);)
    debug_only(void* internal_malloc_4(size_t x);)
<span class="line-removed">-   NOT_PRODUCT(void inc_bytes_allocated(size_t x);)</span>
  
    void signal_out_of_memory(size_t request, const char* whence) const;
  
    bool check_for_overflow(size_t request, const char* whence,
        AllocFailType alloc_failmode = AllocFailStrategy::EXIT_OOM) const {
<span class="line-new-header">--- 105,12 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 146,11 ***</span>
      assert(is_power_of_2(ARENA_AMALLOC_ALIGNMENT) , &quot;should be a power of 2&quot;);
      x = ARENA_ALIGN(x);
      debug_only(if (UseMallocOnly) return malloc(x);)
      if (!check_for_overflow(x, &quot;Arena::Amalloc&quot;, alloc_failmode))
        return NULL;
<span class="line-removed">-     NOT_PRODUCT(inc_bytes_allocated(x);)</span>
      if (_hwm + x &gt; _max) {
        return grow(x, alloc_failmode);
      } else {
        char *old = _hwm;
        _hwm += x;
<span class="line-new-header">--- 144,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 161,11 ***</span>
    void *Amalloc_4(size_t x, AllocFailType alloc_failmode = AllocFailStrategy::EXIT_OOM) {
      assert( (x&amp;(sizeof(char*)-1)) == 0, &quot;misaligned size&quot; );
      debug_only(if (UseMallocOnly) return malloc(x);)
      if (!check_for_overflow(x, &quot;Arena::Amalloc_4&quot;, alloc_failmode))
        return NULL;
<span class="line-removed">-     NOT_PRODUCT(inc_bytes_allocated(x);)</span>
      if (_hwm + x &gt; _max) {
        return grow(x, alloc_failmode);
      } else {
        char *old = _hwm;
        _hwm += x;
<span class="line-new-header">--- 158,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 183,11 ***</span>
      size_t delta = (((size_t)_hwm + DALIGN_M1) &amp; ~DALIGN_M1) - (size_t)_hwm;
      x += delta;
  #endif
      if (!check_for_overflow(x, &quot;Arena::Amalloc_D&quot;, alloc_failmode))
        return NULL;
<span class="line-removed">-     NOT_PRODUCT(inc_bytes_allocated(x);)</span>
      if (_hwm + x &gt; _max) {
        return grow(x, alloc_failmode); // grow() returns a result aligned &gt;= 8 bytes.
      } else {
        char *old = _hwm;
        _hwm += x;
<span class="line-new-header">--- 179,10 ---</span>
</pre>
<center><a href="arena.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="filemap.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>