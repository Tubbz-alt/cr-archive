<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/memory/metaspace.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="metaspace.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="metaspace/chunkManager.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/memory/metaspace.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 26,10 ***</span>
<span class="line-new-header">--- 26,12 ---</span>
  
  #include &quot;memory/allocation.hpp&quot;
  #include &quot;memory/memRegion.hpp&quot;
  #include &quot;memory/metaspaceChunkFreeListSummary.hpp&quot;
  #include &quot;memory/virtualspace.hpp&quot;
<span class="line-added">+ #include &quot;memory/metaspace/metaspaceSizesSnapshot.hpp&quot;</span>
<span class="line-added">+ #include &quot;runtime/globals.hpp&quot;</span>
  #include &quot;utilities/exceptions.hpp&quot;
  
  // Metaspace
  //
  // Metaspaces are Arenas for the VM&#39;s metadata.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 137,10 ***</span>
<span class="line-new-header">--- 139,12 ---</span>
    static metaspace::ChunkManager* _chunk_manager_metadata;
    static metaspace::ChunkManager* _chunk_manager_class;
  
    static const MetaspaceTracer* _tracer;
  
<span class="line-added">+   static bool _initialized;</span>
<span class="line-added">+ </span>
   public:
    static metaspace::VirtualSpaceList* space_list()       { return _space_list; }
    static metaspace::VirtualSpaceList* class_space_list() { return _class_space_list; }
    static metaspace::VirtualSpaceList* get_space_list(MetadataType mdtype) {
      assert(mdtype != MetadataTypeCount, &quot;MetadaTypeCount can&#39;t be used as mdtype&quot;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 166,24 ***</span>
    }
    static void assert_not_frozen() {
      assert(!_frozen, &quot;sanity&quot;);
    }
  #ifdef _LP64
<span class="line-modified">!   static void allocate_metaspace_compressed_klass_ptrs(char* requested_addr, address cds_base);</span>
  #endif
  
   private:
  
  #ifdef _LP64
<span class="line-modified">!   static void set_narrow_klass_base_and_shift(address metaspace_base, address cds_base);</span>
<span class="line-removed">- </span>
<span class="line-removed">-   // Returns true if can use CDS with metaspace allocated as specified address.</span>
<span class="line-removed">-   static bool can_use_cds_with_metaspace_addr(char* metaspace_base, address cds_base);</span>
  
    static void initialize_class_space(ReservedSpace rs);
  #endif
  
   public:
  
    static void ergo_initialize();
    static void global_initialize();
    static void post_initialize();
<span class="line-new-header">--- 170,30 ---</span>
    }
    static void assert_not_frozen() {
      assert(!_frozen, &quot;sanity&quot;);
    }
  #ifdef _LP64
<span class="line-modified">!   static void allocate_metaspace_compressed_klass_ptrs(ReservedSpace metaspace_rs, char* requested_addr, address cds_base);</span>
  #endif
  
   private:
  
  #ifdef _LP64
<span class="line-modified">!   static void set_narrow_klass_base_and_shift(ReservedSpace metaspace_rs, address cds_base);</span>
  
    static void initialize_class_space(ReservedSpace rs);
  #endif
  
<span class="line-added">+   static ReservedSpace reserve_space(size_t size, size_t alignment,</span>
<span class="line-added">+                                      char* requested_addr, bool use_requested_addr);</span>
<span class="line-added">+ </span>
<span class="line-added">+ #ifdef PREFERRED_METASPACE_ALIGNMENT</span>
<span class="line-added">+   static ReservedSpace reserve_preferred_space(size_t size, size_t alignment,</span>
<span class="line-added">+                                                bool large_pages, char *requested_addr,</span>
<span class="line-added">+                                                bool use_requested_addr);</span>
<span class="line-added">+ #endif</span>
<span class="line-added">+ </span>
   public:
  
    static void ergo_initialize();
    static void global_initialize();
    static void post_initialize();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 222,10 ***</span>
<span class="line-new-header">--- 232,12 ---</span>
  
    static bool is_class_space_allocation(MetadataType mdType) {
      return mdType == ClassType &amp;&amp; using_class_space();
    }
  
<span class="line-added">+   static bool initialized() { return _initialized; }</span>
<span class="line-added">+ </span>
  };
  
  // Manages the metaspace portion belonging to a class loader
  class ClassLoaderMetaspace : public CHeapObj&lt;mtClass&gt; {
    friend class CollectedHeap; // For expand_and_allocate()
</pre>
<hr />
<pre>
<span class="line-old-header">*** 327,15 ***</span>
    static size_t free_chunks_total_words(Metaspace::MetadataType mdtype);
  
    // Helper for print_xx_report.
    static void print_vs(outputStream* out, size_t scale);
  
<span class="line-removed">-   // Utils to check if a pointer or range is part of a committed metaspace region</span>
<span class="line-removed">-   // without acquiring any locks.</span>
<span class="line-removed">-   static metaspace::VirtualSpaceNode* find_enclosing_virtual_space(const void* p);</span>
<span class="line-removed">-   static bool is_range_in_committed(const void* from, const void* to);</span>
<span class="line-removed">- </span>
  public:
  
    // Collect used metaspace statistics. This involves walking the CLDG. The resulting
    // output will be the accumulated values for all live metaspaces.
    // Note: method does not do any locking.
<span class="line-new-header">--- 339,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 413,12 ***</span>
    static void print_report(outputStream* out, size_t scale = 0, int flags = 0);
  
    static bool has_chunk_free_list(Metaspace::MetadataType mdtype);
    static MetaspaceChunkFreeListSummary chunk_free_list_summary(Metaspace::MetadataType mdtype);
  
<span class="line-modified">!   // Print change in used metadata.</span>
<span class="line-modified">!   static void print_metaspace_change(size_t prev_metadata_used);</span>
    static void print_on(outputStream * out);
  
    // Prints an ASCII representation of the given space.
    static void print_metaspace_map(outputStream* out, Metaspace::MetadataType mdtype);
  
<span class="line-new-header">--- 420,12 ---</span>
    static void print_report(outputStream* out, size_t scale = 0, int flags = 0);
  
    static bool has_chunk_free_list(Metaspace::MetadataType mdtype);
    static MetaspaceChunkFreeListSummary chunk_free_list_summary(Metaspace::MetadataType mdtype);
  
<span class="line-modified">!   // Log change in used metadata.</span>
<span class="line-modified">!   static void print_metaspace_change(const metaspace::MetaspaceSizesSnapshot&amp; pre_meta_values);</span>
    static void print_on(outputStream * out);
  
    // Prints an ASCII representation of the given space.
    static void print_metaspace_map(outputStream* out, Metaspace::MetadataType mdtype);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 436,15 ***</span>
  
    // The current high-water-mark for inducing a GC.
    // When committed memory of all metaspaces reaches this value,
    // a GC is induced and the value is increased. Size is in bytes.
    static volatile size_t _capacity_until_GC;
<span class="line-removed">- </span>
<span class="line-removed">-   // For a CMS collection, signal that a concurrent collection should</span>
<span class="line-removed">-   // be started.</span>
<span class="line-removed">-   static bool _should_concurrent_collect;</span>
<span class="line-removed">- </span>
    static uint _shrink_factor;
  
    static size_t shrink_factor() { return _shrink_factor; }
    void set_shrink_factor(uint v) { _shrink_factor = v; }
  
<span class="line-new-header">--- 443,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 458,15 ***</span>
                                      size_t* new_cap_until_GC = NULL,
                                      size_t* old_cap_until_GC = NULL,
                                      bool* can_retry = NULL);
    static size_t dec_capacity_until_GC(size_t v);
  
<span class="line-removed">-   static bool should_concurrent_collect() { return _should_concurrent_collect; }</span>
<span class="line-removed">-   static void set_should_concurrent_collect(bool v) {</span>
<span class="line-removed">-     _should_concurrent_collect = v;</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- </span>
    // The amount to increase the high-water-mark (_capacity_until_GC)
    static size_t delta_capacity_until_GC(size_t bytes);
  
    // Tells if we have can expand metaspace without hitting set limits.
    static bool can_expand(size_t words, bool is_class);
<span class="line-new-header">--- 460,10 ---</span>
</pre>
<center><a href="metaspace.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="metaspace/chunkManager.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>