<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/memory/allocation.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../logging/logTag.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="allocation.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/memory/allocation.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 26,12 ***</span>
  #include &quot;memory/allocation.hpp&quot;
  #include &quot;memory/allocation.inline.hpp&quot;
  #include &quot;memory/arena.hpp&quot;
  #include &quot;memory/metaspaceShared.hpp&quot;
  #include &quot;memory/resourceArea.hpp&quot;
<span class="line-removed">- #include &quot;memory/universe.hpp&quot;</span>
<span class="line-removed">- #include &quot;runtime/atomic.hpp&quot;</span>
  #include &quot;runtime/os.hpp&quot;
  #include &quot;runtime/task.hpp&quot;
  #include &quot;runtime/threadCritical.hpp&quot;
  #include &quot;services/memTracker.hpp&quot;
  #include &quot;utilities/ostream.hpp&quot;
<span class="line-new-header">--- 26,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 63,10 ***</span>
<span class="line-new-header">--- 61,11 ---</span>
      vm_exit_out_of_memory(size, OOM_MALLOC_ERROR, &quot;ReallocateHeap&quot;);
    }
    return p;
  }
  
<span class="line-added">+ // handles NULL pointers</span>
  void FreeHeap(void* p) {
    os::free(p);
  }
  
  void* MetaspaceObj::_shared_metaspace_base = NULL;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 82,12 ***</span>
                                   MetaspaceObj::Type type, TRAPS) throw() {
    // Klass has it&#39;s own operator new
    return Metaspace::allocate(loader_data, word_size, type, THREAD);
  }
  
<span class="line-modified">! bool MetaspaceObj::is_metaspace_object() const {</span>
<span class="line-modified">!   return Metaspace::contains((void*)this);</span>
  }
  
  void MetaspaceObj::print_address_on(outputStream* st) const {
    st-&gt;print(&quot; {&quot; INTPTR_FORMAT &quot;}&quot;, p2i(this));
  }
<span class="line-new-header">--- 81,18 ---</span>
                                   MetaspaceObj::Type type, TRAPS) throw() {
    // Klass has it&#39;s own operator new
    return Metaspace::allocate(loader_data, word_size, type, THREAD);
  }
  
<span class="line-modified">! bool MetaspaceObj::is_valid(const MetaspaceObj* p) {</span>
<span class="line-modified">!   // Weed out obvious bogus values first without traversing metaspace</span>
<span class="line-added">+   if ((size_t)p &lt; os::min_page_size()) {</span>
<span class="line-added">+     return false;</span>
<span class="line-added">+   } else if (!is_aligned((address)p, sizeof(MetaWord))) {</span>
<span class="line-added">+     return false;</span>
<span class="line-added">+   }</span>
<span class="line-added">+   return Metaspace::contains((void*)p);</span>
  }
  
  void MetaspaceObj::print_address_on(outputStream* st) const {
    st-&gt;print(&quot; {&quot; INTPTR_FORMAT &quot;}&quot;, p2i(this));
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 252,29 ***</span>
  
  void AllocatedObj::print_value_on(outputStream* st) const {
    st-&gt;print(&quot;AllocatedObj(&quot; INTPTR_FORMAT &quot;)&quot;, p2i(this));
  }
  
<span class="line-removed">- AllocStats::AllocStats() {</span>
<span class="line-removed">-   start_mallocs      = os::num_mallocs;</span>
<span class="line-removed">-   start_frees        = os::num_frees;</span>
<span class="line-removed">-   start_malloc_bytes = os::alloc_bytes;</span>
<span class="line-removed">-   start_mfree_bytes  = os::free_bytes;</span>
<span class="line-removed">-   start_res_bytes    = Arena::_bytes_allocated;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- julong  AllocStats::num_mallocs() { return os::num_mallocs - start_mallocs; }</span>
<span class="line-removed">- julong  AllocStats::alloc_bytes() { return os::alloc_bytes - start_malloc_bytes; }</span>
<span class="line-removed">- julong  AllocStats::num_frees()   { return os::num_frees - start_frees; }</span>
<span class="line-removed">- julong  AllocStats::free_bytes()  { return os::free_bytes - start_mfree_bytes; }</span>
<span class="line-removed">- julong  AllocStats::resource_bytes() { return Arena::_bytes_allocated - start_res_bytes; }</span>
<span class="line-removed">- void    AllocStats::print() {</span>
<span class="line-removed">-   tty-&gt;print_cr(UINT64_FORMAT &quot; mallocs (&quot; UINT64_FORMAT &quot;MB), &quot;</span>
<span class="line-removed">-                 UINT64_FORMAT &quot; frees (&quot; UINT64_FORMAT &quot;MB), &quot; UINT64_FORMAT &quot;MB resrc&quot;,</span>
<span class="line-removed">-                 num_mallocs(), alloc_bytes()/M, num_frees(), free_bytes()/M, resource_bytes()/M);</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
  ReallocMark::ReallocMark() {
  #ifdef ASSERT
    Thread *thread = Thread::current();
    _nesting = thread-&gt;resource_area()-&gt;nesting();
  #endif
<span class="line-new-header">--- 257,10 ---</span>
</pre>
<center><a href="../logging/logTag.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="allocation.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>