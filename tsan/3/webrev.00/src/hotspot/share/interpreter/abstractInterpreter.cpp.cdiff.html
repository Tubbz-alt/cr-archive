<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/interpreter/abstractInterpreter.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../include/jvm.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="abstractInterpreter.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/interpreter/abstractInterpreter.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 26,18 ***</span>
<span class="line-new-header">--- 26,21 ---</span>
  #include &quot;asm/macroAssembler.hpp&quot;
  #include &quot;asm/macroAssembler.inline.hpp&quot;
  #include &quot;compiler/disassembler.hpp&quot;
  #include &quot;interpreter/bytecodeHistogram.hpp&quot;
  #include &quot;interpreter/bytecodeInterpreter.hpp&quot;
<span class="line-added">+ #include &quot;interpreter/bytecodeStream.hpp&quot;</span>
  #include &quot;interpreter/interpreter.hpp&quot;
  #include &quot;interpreter/interpreterRuntime.hpp&quot;
  #include &quot;interpreter/interp_masm.hpp&quot;
  #include &quot;interpreter/templateTable.hpp&quot;
  #include &quot;memory/allocation.inline.hpp&quot;
  #include &quot;memory/metaspaceShared.hpp&quot;
  #include &quot;memory/resourceArea.hpp&quot;
  #include &quot;oops/arrayOop.hpp&quot;
<span class="line-added">+ #include &quot;oops/constantPool.hpp&quot;</span>
<span class="line-added">+ #include &quot;oops/cpCache.inline.hpp&quot;</span>
  #include &quot;oops/methodData.hpp&quot;
  #include &quot;oops/method.hpp&quot;
  #include &quot;oops/oop.inline.hpp&quot;
  #include &quot;prims/forte.hpp&quot;
  #include &quot;prims/jvmtiExport.hpp&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 57,13 ***</span>
  
    // make sure &#39;imported&#39; classes are initialized
    if (CountBytecodes || TraceBytecodes || StopInterpreterAt) BytecodeCounter::reset();
    if (PrintBytecodeHistogram)                                BytecodeHistogram::reset();
    if (PrintBytecodePairHistogram)                            BytecodePairHistogram::reset();
<span class="line-removed">- </span>
<span class="line-removed">-   InvocationCounter::reinitialize();</span>
<span class="line-removed">- </span>
  }
  
  void AbstractInterpreter::print() {
    tty-&gt;cr();
    tty-&gt;print_cr(&quot;----------------------------------------------------------------------&quot;);
<span class="line-new-header">--- 60,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 203,11 ***</span>
  
  #if INCLUDE_CDS
  
  address AbstractInterpreter::get_trampoline_code_buffer(AbstractInterpreter::MethodKind kind) {
    const size_t trampoline_size = SharedRuntime::trampoline_size();
<span class="line-modified">!   address addr = MetaspaceShared::cds_i2i_entry_code_buffers((size_t)(AbstractInterpreter::number_of_method_entries) * trampoline_size);</span>
    addr += (size_t)(kind) * trampoline_size;
  
    return addr;
  }
  
<span class="line-new-header">--- 203,11 ---</span>
  
  #if INCLUDE_CDS
  
  address AbstractInterpreter::get_trampoline_code_buffer(AbstractInterpreter::MethodKind kind) {
    const size_t trampoline_size = SharedRuntime::trampoline_size();
<span class="line-modified">!   address addr = MetaspaceShared::i2i_entry_code_buffers((size_t)(AbstractInterpreter::number_of_method_entries) * trampoline_size);</span>
    addr += (size_t)(kind) * trampoline_size;
  
    return addr;
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 217,10 ***</span>
<span class="line-new-header">--- 217,11 ---</span>
      _cds_entry_table[kind] = trampoline;
  
      CodeBuffer buffer(trampoline, (int)(SharedRuntime::trampoline_size()));
      MacroAssembler _masm(&amp;buffer);
      SharedRuntime::generate_trampoline(&amp;_masm, _entry_table[kind]);
<span class="line-added">+     _masm.flush();</span>
  
      if (PrintInterpreter) {
        Disassembler::decode(buffer.insts_begin(), buffer.insts_end());
      }
    }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 238,13 ***</span>
  }
  
  // Return true if the interpreter can prove that the given bytecode has
  // not yet been executed (in Java semantics, not in actual operation).
  bool AbstractInterpreter::is_not_reached(const methodHandle&amp; method, int bci) {
<span class="line-modified">!   Bytecodes::Code code = method()-&gt;code_at(bci);</span>
<span class="line-modified">! </span>
<span class="line-modified">!   if (!Bytecodes::must_rewrite(code)) {</span>
      // might have been reached
      return false;
    }
  
    // the bytecode might not be rewritten if the method is an accessor, etc.
<span class="line-new-header">--- 239,41 ---</span>
  }
  
  // Return true if the interpreter can prove that the given bytecode has
  // not yet been executed (in Java semantics, not in actual operation).
  bool AbstractInterpreter::is_not_reached(const methodHandle&amp; method, int bci) {
<span class="line-modified">!   BytecodeStream s(method, bci);</span>
<span class="line-modified">!   Bytecodes::Code code = s.next();</span>
<span class="line-modified">! </span>
<span class="line-added">+   if (Bytecodes::is_invoke(code)) {</span>
<span class="line-added">+     assert(!Bytecodes::must_rewrite(code), &quot;invokes aren&#39;t rewritten&quot;);</span>
<span class="line-added">+     ConstantPool* cpool = method()-&gt;constants();</span>
<span class="line-added">+ </span>
<span class="line-added">+     Bytecode invoke_bc(s.bytecode());</span>
<span class="line-added">+ </span>
<span class="line-added">+     switch (code) {</span>
<span class="line-added">+       case Bytecodes::_invokedynamic: {</span>
<span class="line-added">+         assert(invoke_bc.has_index_u4(code), &quot;sanity&quot;);</span>
<span class="line-added">+         int method_index = invoke_bc.get_index_u4(code);</span>
<span class="line-added">+         return cpool-&gt;invokedynamic_cp_cache_entry_at(method_index)-&gt;is_f1_null();</span>
<span class="line-added">+       }</span>
<span class="line-added">+       case Bytecodes::_invokevirtual:   // fall-through</span>
<span class="line-added">+       case Bytecodes::_invokeinterface: // fall-through</span>
<span class="line-added">+       case Bytecodes::_invokespecial:   // fall-through</span>
<span class="line-added">+       case Bytecodes::_invokestatic: {</span>
<span class="line-added">+         if (cpool-&gt;has_preresolution()) {</span>
<span class="line-added">+           return false; // might have been reached</span>
<span class="line-added">+         }</span>
<span class="line-added">+         assert(!invoke_bc.has_index_u4(code), &quot;sanity&quot;);</span>
<span class="line-added">+         int method_index = invoke_bc.get_index_u2_cpcache(code);</span>
<span class="line-added">+         constantPoolHandle cp(Thread::current(), cpool);</span>
<span class="line-added">+         Method* resolved_method = ConstantPool::method_at_if_loaded(cp, method_index);</span>
<span class="line-added">+         return (resolved_method == NULL);</span>
<span class="line-added">+       }</span>
<span class="line-added">+       default: ShouldNotReachHere();</span>
<span class="line-added">+     }</span>
<span class="line-added">+   } else if (!Bytecodes::must_rewrite(code)) {</span>
      // might have been reached
      return false;
    }
  
    // the bytecode might not be rewritten if the method is an accessor, etc.
</pre>
<center><a href="../include/jvm.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="abstractInterpreter.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>