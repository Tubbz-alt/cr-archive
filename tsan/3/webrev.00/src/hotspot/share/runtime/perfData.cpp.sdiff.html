<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/runtime/perfData.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="park.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="perfMemory.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/runtime/perfData.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2001, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
</pre>
<hr />
<pre>
 68   &quot;com.sun.rt&quot;,
 69   &quot;sun.rt&quot;,
 70   &quot;java.os&quot;,                // Operating System name spaces
 71   &quot;com.sun.os&quot;,
 72   &quot;sun.os&quot;,
 73   &quot;java.threads&quot;,           // Threads System name spaces
 74   &quot;com.sun.threads&quot;,
 75   &quot;sun.threads&quot;,
 76   &quot;java.property&quot;,          // Java Property name spaces
 77   &quot;com.sun.property&quot;,
 78   &quot;sun.property&quot;,
 79   &quot;&quot;,
 80 };
 81 
 82 PerfData::PerfData(CounterNS ns, const char* name, Units u, Variability v)
 83                   : _name(NULL), _v(v), _u(u), _on_c_heap(false), _valuep(NULL) {
 84 
 85   const char* prefix = PerfDataManager::ns_to_string(ns);
 86 
 87   _name = NEW_C_HEAP_ARRAY(char, strlen(name) + strlen(prefix) + 2, mtInternal);
<span class="line-modified"> 88   assert(_name != NULL &amp;&amp; strlen(name) != 0, &quot;invalid name&quot;);</span>
 89 
 90   if (ns == NULL_NS) {
 91      // No prefix is added to counters with the NULL_NS namespace.
 92      strcpy(_name, name);
 93      // set the F_Supported flag based on the counter name prefix.
 94      if (PerfDataManager::is_stable_supported(_name) ||
 95          PerfDataManager::is_unstable_supported(_name)) {
 96        _flags = F_Supported;
 97      }
 98      else {
 99        _flags = F_None;
100      }
101   }
102   else {
103     sprintf(_name, &quot;%s.%s&quot;, prefix, name);
104     // set the F_Supported flag based on the given namespace.
105     if (PerfDataManager::is_stable_supported(ns) ||
106         PerfDataManager::is_unstable_supported(ns)) {
107       _flags = F_Supported;
108     }
109     else {
110       _flags = F_None;
111     }
112   }
113 }
114 
115 PerfData::~PerfData() {
<span class="line-modified">116   if (_name != NULL) {</span>
<span class="line-removed">117     FREE_C_HEAP_ARRAY(char, _name);</span>
<span class="line-removed">118   }</span>
119   if (is_on_c_heap()) {
120     FREE_C_HEAP_ARRAY(PerfDataEntry, _pdep);
121   }
122 }
123 
124 void PerfData::create_entry(BasicType dtype, size_t dsize, size_t vlen) {
125 
126   size_t dlen = vlen==0 ? 1 : vlen;
127 
128   size_t namelen = strlen(name()) + 1;  // include null terminator
129   size_t size = sizeof(PerfDataEntry) + namelen;
130   size_t pad_length = ((size % dsize) == 0) ? 0 : dsize - (size % dsize);
131   size += pad_length;
132   size_t data_start = size;
133   size += (dsize * dlen);
134 
135   // align size to assure allocation in units of 8 bytes
136   int align = sizeof(jlong) - 1;
137   size = ((size + align) &amp; ~align);
138   char* psmp = PerfMemory::alloc(size);
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2001, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
</pre>
<hr />
<pre>
 68   &quot;com.sun.rt&quot;,
 69   &quot;sun.rt&quot;,
 70   &quot;java.os&quot;,                // Operating System name spaces
 71   &quot;com.sun.os&quot;,
 72   &quot;sun.os&quot;,
 73   &quot;java.threads&quot;,           // Threads System name spaces
 74   &quot;com.sun.threads&quot;,
 75   &quot;sun.threads&quot;,
 76   &quot;java.property&quot;,          // Java Property name spaces
 77   &quot;com.sun.property&quot;,
 78   &quot;sun.property&quot;,
 79   &quot;&quot;,
 80 };
 81 
 82 PerfData::PerfData(CounterNS ns, const char* name, Units u, Variability v)
 83                   : _name(NULL), _v(v), _u(u), _on_c_heap(false), _valuep(NULL) {
 84 
 85   const char* prefix = PerfDataManager::ns_to_string(ns);
 86 
 87   _name = NEW_C_HEAP_ARRAY(char, strlen(name) + strlen(prefix) + 2, mtInternal);
<span class="line-modified"> 88   assert(strlen(name) != 0, &quot;invalid name&quot;);</span>
 89 
 90   if (ns == NULL_NS) {
 91      // No prefix is added to counters with the NULL_NS namespace.
 92      strcpy(_name, name);
 93      // set the F_Supported flag based on the counter name prefix.
 94      if (PerfDataManager::is_stable_supported(_name) ||
 95          PerfDataManager::is_unstable_supported(_name)) {
 96        _flags = F_Supported;
 97      }
 98      else {
 99        _flags = F_None;
100      }
101   }
102   else {
103     sprintf(_name, &quot;%s.%s&quot;, prefix, name);
104     // set the F_Supported flag based on the given namespace.
105     if (PerfDataManager::is_stable_supported(ns) ||
106         PerfDataManager::is_unstable_supported(ns)) {
107       _flags = F_Supported;
108     }
109     else {
110       _flags = F_None;
111     }
112   }
113 }
114 
115 PerfData::~PerfData() {
<span class="line-modified">116   FREE_C_HEAP_ARRAY(char, _name);</span>


117   if (is_on_c_heap()) {
118     FREE_C_HEAP_ARRAY(PerfDataEntry, _pdep);
119   }
120 }
121 
122 void PerfData::create_entry(BasicType dtype, size_t dsize, size_t vlen) {
123 
124   size_t dlen = vlen==0 ? 1 : vlen;
125 
126   size_t namelen = strlen(name()) + 1;  // include null terminator
127   size_t size = sizeof(PerfDataEntry) + namelen;
128   size_t pad_length = ((size % dsize) == 0) ? 0 : dsize - (size % dsize);
129   size += pad_length;
130   size_t data_start = size;
131   size += (dsize * dlen);
132 
133   // align size to assure allocation in units of 8 bytes
134   int align = sizeof(jlong) - 1;
135   size = ((size + align) &amp; ~align);
136   char* psmp = PerfMemory::alloc(size);
</pre>
</td>
</tr>
</table>
<center><a href="park.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="perfMemory.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>