<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/runtime/vmThread.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="vmThread.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="vm_version.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/runtime/vmThread.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -28,10 +28,15 @@</span>
  #include &quot;runtime/perfData.hpp&quot;
  #include &quot;runtime/thread.hpp&quot;
  #include &quot;runtime/task.hpp&quot;
  #include &quot;runtime/vmOperations.hpp&quot;
  
<span class="udiff-line-added">+ class VM_QueueHead : public VM_None {</span>
<span class="udiff-line-added">+  public:</span>
<span class="udiff-line-added">+   VM_QueueHead() : VM_None(&quot;QueueHead&quot;) {}</span>
<span class="udiff-line-added">+ };</span>
<span class="udiff-line-added">+ </span>
  //
  // Prioritized queue of VM operations.
  //
  // Encapsulates both queue management and
  // and priority policy
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -46,44 +51,33 @@</span>
  
    // We maintain a doubled linked list, with explicit count.
    int           _queue_length[nof_priorities];
    int           _queue_counter;
    VM_Operation* _queue       [nof_priorities];
<span class="udiff-line-modified-removed">-   // we also allow the vmThread to register the ops it has drained so we</span>
<span class="udiff-line-modified-removed">-   // can scan them from oops_do</span>
<span class="udiff-line-removed">-   VM_Operation* _drain_list;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   static VM_QueueHead _queue_head[nof_priorities];</span>
  
    // Double-linked non-empty list insert.
    void insert(VM_Operation* q,VM_Operation* n);
    void unlink(VM_Operation* q);
  
    // Basic queue manipulation
    bool queue_empty                (int prio);
<span class="udiff-line-modified-removed">-   void queue_add_front            (int prio, VM_Operation *op);</span>
<span class="udiff-line-removed">-   void queue_add_back             (int prio, VM_Operation *op);</span>
<span class="udiff-line-modified-added">+   void queue_add                  (int prio, VM_Operation *op);</span>
    VM_Operation* queue_remove_front(int prio);
<span class="udiff-line-removed">-   void queue_oops_do(int queue, OopClosure* f);</span>
<span class="udiff-line-removed">-   void drain_list_oops_do(OopClosure* f);</span>
    VM_Operation* queue_drain(int prio);
    // lock-free query: may return the wrong answer but must not break
    bool queue_peek(int prio) { return _queue_length[prio] &gt; 0; }
  
   public:
    VMOperationQueue();
  
    // Highlevel operations. Encapsulates policy
<span class="udiff-line-modified-removed">-   bool add(VM_Operation *op);</span>
<span class="udiff-line-modified-added">+   void add(VM_Operation *op);</span>
    VM_Operation* remove_next();                        // Returns next or null
<span class="udiff-line-removed">-   VM_Operation* remove_next_at_safepoint_priority()   { return queue_remove_front(SafepointPriority); }</span>
    VM_Operation* drain_at_safepoint_priority() { return queue_drain(SafepointPriority); }
<span class="udiff-line-removed">-   void set_drain_list(VM_Operation* list) { _drain_list = list; }</span>
    bool peek_at_safepoint_priority() { return queue_peek(SafepointPriority); }
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   // GC support</span>
<span class="udiff-line-removed">-   void oops_do(OopClosure* f);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   void verify_queue(int prio) PRODUCT_RETURN;</span>
  };
  
  
  // VM operation timeout handling: warn or abort the VM when VM operation takes
  // too long. Periodic tasks do not participate in safepoint protocol, and therefore
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -121,11 +115,11 @@</span>
    static PerfCounter* _perf_accumulated_vm_operation_time;
    static uint64_t _coalesced_count;
  
    static VMOperationTimeoutTask* _timeout_task;
  
<span class="udiff-line-modified-removed">-   static VM_Operation* no_op_safepoint(bool check_time);</span>
<span class="udiff-line-modified-added">+   static VM_Operation* no_op_safepoint();</span>
  
    void evaluate_operation(VM_Operation* op);
  
   public:
    // Constructor
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -137,14 +131,14 @@</span>
    }
  
  
    // Tester
    bool is_VM_thread() const                      { return true; }
<span class="udiff-line-removed">-   bool is_GC_thread() const                      { return true; }</span>
  
    // The ever running loop for the VMThread
    void loop();
<span class="udiff-line-added">+   static void check_for_forced_cleanup();</span>
  
    // Called to stop the VM thread
    static void wait_for_vm_thread_exit();
    static bool should_terminate()                  { return _should_terminate; }
    static bool is_terminated()                     { return _terminated == true; }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -158,13 +152,10 @@</span>
    static uint64_t get_coalesced_count()           { return _coalesced_count; }
  
    // Returns the single instance of VMThread.
    static VMThread* vm_thread()                    { return _vm_thread; }
  
<span class="udiff-line-removed">-   // GC support</span>
<span class="udiff-line-removed">-   void oops_do(OopClosure* f, CodeBlobClosure* cf);</span>
<span class="udiff-line-removed">- </span>
    void verify();
  
    // Performance measurement
    static PerfCounter* perf_accumulated_vm_operation_time()               { return _perf_accumulated_vm_operation_time; }
  
</pre>
<center><a href="vmThread.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="vm_version.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>