<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/hotspot/share/runtime/stubCodeGenerator.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #ifndef SHARE_RUNTIME_STUBCODEGENERATOR_HPP
 26 #define SHARE_RUNTIME_STUBCODEGENERATOR_HPP
 27 
 28 #include &quot;asm/assembler.hpp&quot;
 29 #include &quot;memory/allocation.hpp&quot;
 30 
 31 // All the basic framework for stub code generation/debugging/printing.
 32 
 33 
 34 // A StubCodeDesc describes a piece of generated code (usually stubs).
 35 // This information is mainly useful for debugging and printing.
 36 // Currently, code descriptors are simply chained in a linked list,
 37 // this may have to change if searching becomes too slow.
 38 
 39 class StubCodeDesc: public CHeapObj&lt;mtCode&gt; {
 40  private:
 41   static StubCodeDesc* _list;                  // the list of all descriptors
 42   static bool          _frozen;                // determines whether _list modifications are allowed
 43 
 44   StubCodeDesc*        _next;                  // the next element in the linked list
 45   const char*          _group;                 // the group to which the stub code belongs
 46   const char*          _name;                  // the name assigned to the stub code
 47   address              _begin;                 // points to the first byte of the stub code    (included)
 48   address              _end;                   // points to the first byte after the stub code (excluded)
 49 
 50   void set_end(address end) {
 51     assert(_begin &lt;= end, &quot;begin &amp; end not properly ordered&quot;);
 52     _end = end;
 53   }
 54 
 55   void set_begin(address begin) {
 56     assert(begin &gt;= _begin, &quot;begin may not decrease&quot;);
 57     assert(_end == NULL || begin &lt;= _end, &quot;begin &amp; end not properly ordered&quot;);
 58     _begin = begin;
 59   }
 60 
 61   friend class StubCodeMark;
 62   friend class StubCodeGenerator;
 63 
 64  public:
 65   static StubCodeDesc* first() { return _list; }
 66   static StubCodeDesc* next(StubCodeDesc* desc)  { return desc-&gt;_next; }
 67 
 68   static StubCodeDesc* desc_for(address pc);     // returns the code descriptor for the code containing pc or NULL
 69   static const char*   name_for(address pc);     // returns the name of the code containing pc or NULL
 70 
 71   StubCodeDesc(const char* group, const char* name, address begin, address end = NULL) {
 72     assert(!_frozen, &quot;no modifications allowed&quot;);
 73     assert(name != NULL, &quot;no name specified&quot;);
 74     _next           = _list;
 75     _group          = group;
 76     _name           = name;
 77     _begin          = begin;
 78     _end            = end;
 79     _list           = this;
 80   };
 81 
 82   static void freeze();
 83 
 84   const char* group() const                      { return _group; }
 85   const char* name() const                       { return _name; }
 86   address     begin() const                      { return _begin; }
 87   address     end() const                        { return _end; }
 88   int         size_in_bytes() const              { return _end - _begin; }
 89   bool        contains(address pc) const         { return _begin &lt;= pc &amp;&amp; pc &lt; _end; }
 90   void        print_on(outputStream* st) const;
 91   void        print() const;
 92 };
 93 
 94 // The base class for all stub-generating code generators.
 95 // Provides utility functions.
 96 
 97 class StubCodeGenerator: public StackObj {
 98  private:
 99   bool _print_code;
100 
101  protected:
102   MacroAssembler*  _masm;
103 
104  public:
105   StubCodeGenerator(CodeBuffer* code, bool print_code = false);
106   ~StubCodeGenerator();
107 
108   MacroAssembler* assembler() const              { return _masm; }
109 
110   virtual void stub_prolog(StubCodeDesc* cdesc); // called by StubCodeMark constructor
111   virtual void stub_epilog(StubCodeDesc* cdesc); // called by StubCodeMark destructor
112 };
113 
114 
115 // Stack-allocated helper class used to associate a stub code with a name.
116 // All stub code generating functions that use a StubCodeMark will be registered
117 // in the global StubCodeDesc list and the generated stub code can be identified
118 // later via an address pointing into it.
119 
120 class StubCodeMark: public StackObj {
121  private:
122   StubCodeGenerator* _cgen;
123   StubCodeDesc*      _cdesc;
124 
125  public:
126   StubCodeMark(StubCodeGenerator* cgen, const char* group, const char* name);
127   ~StubCodeMark();
128 
129 };
130 
131 #endif // SHARE_RUNTIME_STUBCODEGENERATOR_HPP
    </pre>
  </body>
</html>