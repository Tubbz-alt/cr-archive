<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/hotspot/share/runtime/flags/jvmFlagConstraintList.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
    <script type="text/javascript" src="../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #ifndef SHARE_RUNTIME_FLAGS_JVMFLAGCONSTRAINTLIST_HPP
 26 #define SHARE_RUNTIME_FLAGS_JVMFLAGCONSTRAINTLIST_HPP
 27 
 28 #include &quot;runtime/flags/jvmFlag.hpp&quot;
 29 #include &quot;utilities/growableArray.hpp&quot;
 30 
 31 /*
 32  * Here we have a mechanism for extracting constraints (as custom functions) for flags,
 33  * which otherwise can not be expressed via simple range check, specified in flag macro tables.
 34  *
 35  * An example of a constraint is &quot;flag1 &lt; flag2&quot; where both flag1 and flag2 can change.
 36  *
 37  * See runtime &quot;runtime/flags/jvmFlagConstraintsCompiler.hpp&quot;,
 38  * &quot;runtime/flags/jvmFlagConstraintsGC.hpp&quot; and
 39  * &quot;runtime/flags/jvmFlagConstraintsRuntime.hpp&quot; for the functions themselves.
 40  */
 41 
 42 typedef JVMFlag::Error (*JVMFlagConstraintFunc_bool)(bool value, bool verbose);
 43 typedef JVMFlag::Error (*JVMFlagConstraintFunc_int)(int value, bool verbose);
 44 typedef JVMFlag::Error (*JVMFlagConstraintFunc_intx)(intx value, bool verbose);
 45 typedef JVMFlag::Error (*JVMFlagConstraintFunc_uint)(uint value, bool verbose);
 46 typedef JVMFlag::Error (*JVMFlagConstraintFunc_uintx)(uintx value, bool verbose);
 47 typedef JVMFlag::Error (*JVMFlagConstraintFunc_uint64_t)(uint64_t value, bool verbose);
 48 typedef JVMFlag::Error (*JVMFlagConstraintFunc_size_t)(size_t value, bool verbose);
 49 typedef JVMFlag::Error (*JVMFlagConstraintFunc_double)(double value, bool verbose);
 50 
 51 class JVMFlagConstraint : public CHeapObj&lt;mtArguments&gt; {
 52 public:
 53   // During VM initialization, constraint validation will be done order of ConstraintType.
 54   enum ConstraintType {
 55     // Will be validated during argument processing (Arguments::parse_argument).
 56     AtParse         = 0,
 57     // Will be validated inside Threads::create_vm(), right after Arguments::apply_ergo().
 58     AfterErgo       = 1,
 59     // Will be validated inside universe_init(), right after Metaspace::global_initialize().
 60     AfterMemoryInit = 2
 61   };
 62 
<a name="1" id="anc1"></a><span class="line-added"> 63 protected:</span>
<span class="line-added"> 64   const JVMFlag* const _flag;</span>
<span class="line-added"> 65 </span>
 66 private:
<a name="2" id="anc2"></a>
 67   ConstraintType _validate_type;
 68 
 69 public:
 70   // the &quot;name&quot; argument must be a string literal
<a name="3" id="anc3"></a><span class="line-modified"> 71   JVMFlagConstraint(const JVMFlag* flag, ConstraintType type) : _flag(flag), _validate_type(type) {}</span>
<span class="line-modified"> 72   ~JVMFlagConstraint() {}</span>
<span class="line-modified"> 73   const JVMFlag* flag() const { return _flag; }</span>
 74   ConstraintType type() const { return _validate_type; }
 75   virtual JVMFlag::Error apply(bool verbose = true) { ShouldNotReachHere(); return JVMFlag::ERR_OTHER; };
 76   virtual JVMFlag::Error apply_bool(bool value, bool verbose = true) { ShouldNotReachHere(); return JVMFlag::ERR_OTHER; };
 77   virtual JVMFlag::Error apply_int(int value, bool verbose = true) { ShouldNotReachHere(); return JVMFlag::ERR_OTHER; };
 78   virtual JVMFlag::Error apply_intx(intx value, bool verbose = true) { ShouldNotReachHere(); return JVMFlag::ERR_OTHER; };
 79   virtual JVMFlag::Error apply_uint(uint value, bool verbose = true) { ShouldNotReachHere(); return JVMFlag::ERR_OTHER; };
 80   virtual JVMFlag::Error apply_uintx(uintx value, bool verbose = true) { ShouldNotReachHere(); return JVMFlag::ERR_OTHER; };
 81   virtual JVMFlag::Error apply_uint64_t(uint64_t value, bool verbose = true) { ShouldNotReachHere(); return JVMFlag::ERR_OTHER; };
 82   virtual JVMFlag::Error apply_size_t(size_t value, bool verbose = true) { ShouldNotReachHere(); return JVMFlag::ERR_OTHER; };
 83   virtual JVMFlag::Error apply_double(double value, bool verbose = true) { ShouldNotReachHere(); return JVMFlag::ERR_OTHER; };
 84 };
 85 
 86 class JVMFlagConstraintList : public AllStatic {
 87 private:
 88   static GrowableArray&lt;JVMFlagConstraint*&gt;* _constraints;
 89   // Latest constraint validation type.
 90   static JVMFlagConstraint::ConstraintType _validating_type;
 91 public:
 92   static void init();
 93   static int length() { return (_constraints != NULL) ? _constraints-&gt;length() : 0; }
 94   static JVMFlagConstraint* at(int i) { return (_constraints != NULL) ? _constraints-&gt;at(i) : NULL; }
<a name="4" id="anc4"></a><span class="line-modified"> 95   static JVMFlagConstraint* find(const JVMFlag* flag);</span>
<span class="line-modified"> 96   static JVMFlagConstraint* find_if_needs_check(const JVMFlag* flag);</span>
 97   static void add(JVMFlagConstraint* constraint) { _constraints-&gt;append(constraint); }
 98   // True if &#39;AfterErgo&#39; or later constraint functions are validated.
 99   static bool validated_after_ergo() { return _validating_type &gt;= JVMFlagConstraint::AfterErgo; };
100   static bool check_constraints(JVMFlagConstraint::ConstraintType type);
101 };
102 
103 #endif // SHARE_RUNTIME_FLAGS_JVMFLAGCONSTRAINTLIST_HPP
<a name="5" id="anc5"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="5" type="hidden" />
</body>
</html>