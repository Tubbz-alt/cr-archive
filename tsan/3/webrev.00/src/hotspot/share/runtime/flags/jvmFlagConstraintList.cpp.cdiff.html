<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/runtime/flags/jvmFlagConstraintList.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="jvmFlag.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jvmFlagConstraintList.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/runtime/flags/jvmFlagConstraintList.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2015, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2015, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 29,241 ***</span>
  #include &quot;runtime/arguments.hpp&quot;
  #include &quot;runtime/flags/jvmFlag.hpp&quot;
  #include &quot;runtime/flags/jvmFlagConstraintList.hpp&quot;
  #include &quot;runtime/flags/jvmFlagConstraintsCompiler.hpp&quot;
  #include &quot;runtime/flags/jvmFlagConstraintsRuntime.hpp&quot;
  #include &quot;runtime/os.hpp&quot;
  #include &quot;utilities/macros.hpp&quot;
<span class="line-removed">- #ifdef COMPILER1</span>
<span class="line-removed">- #include &quot;c1/c1_globals.hpp&quot;</span>
<span class="line-removed">- #endif</span>
<span class="line-removed">- #ifdef COMPILER2</span>
<span class="line-removed">- #include &quot;opto/c2_globals.hpp&quot;</span>
<span class="line-removed">- #endif</span>
  
  class JVMFlagConstraint_bool : public JVMFlagConstraint {
    JVMFlagConstraintFunc_bool _constraint;
<span class="line-removed">-   const bool* _ptr;</span>
  
  public:
<span class="line-modified">!   // the &quot;name&quot; argument must be a string literal</span>
<span class="line-modified">!   JVMFlagConstraint_bool(const char* name, const bool* ptr,</span>
<span class="line-modified">!                                  JVMFlagConstraintFunc_bool func,</span>
<span class="line-removed">-                                  ConstraintType type) : JVMFlagConstraint(name, type), _constraint(func), _ptr(ptr) {}</span>
  
    JVMFlag::Error apply(bool verbose) {
<span class="line-modified">!     bool value = *_ptr;</span>
<span class="line-removed">-     return _constraint(value, verbose);</span>
    }
  
    JVMFlag::Error apply_bool(bool value, bool verbose) {
      return _constraint(value, verbose);
    }
  };
  
  class JVMFlagConstraint_int : public JVMFlagConstraint {
    JVMFlagConstraintFunc_int _constraint;
<span class="line-removed">-   const int* _ptr;</span>
  
  public:
<span class="line-modified">!   // the &quot;name&quot; argument must be a string literal</span>
<span class="line-modified">!   JVMFlagConstraint_int(const char* name, const int* ptr,</span>
<span class="line-modified">!                                 JVMFlagConstraintFunc_int func,</span>
<span class="line-removed">-                                 ConstraintType type) : JVMFlagConstraint(name, type), _constraint(func), _ptr(ptr) {}</span>
  
    JVMFlag::Error apply(bool verbose) {
<span class="line-modified">!     int value = *_ptr;</span>
<span class="line-removed">-     return _constraint(value, verbose);</span>
    }
  
    JVMFlag::Error apply_int(int value, bool verbose) {
      return _constraint(value, verbose);
    }
  };
  
  class JVMFlagConstraint_intx : public JVMFlagConstraint {
    JVMFlagConstraintFunc_intx _constraint;
<span class="line-removed">-   const intx* _ptr;</span>
  
  public:
<span class="line-modified">!   // the &quot;name&quot; argument must be a string literal</span>
<span class="line-modified">!   JVMFlagConstraint_intx(const char* name, const intx* ptr,</span>
<span class="line-modified">!                                  JVMFlagConstraintFunc_intx func,</span>
<span class="line-removed">-                                  ConstraintType type) : JVMFlagConstraint(name, type), _constraint(func), _ptr(ptr) {}</span>
  
    JVMFlag::Error apply(bool verbose) {
<span class="line-modified">!     intx value = *_ptr;</span>
<span class="line-removed">-     return _constraint(value, verbose);</span>
    }
  
    JVMFlag::Error apply_intx(intx value, bool verbose) {
      return _constraint(value, verbose);
    }
  };
  
  class JVMFlagConstraint_uint : public JVMFlagConstraint {
    JVMFlagConstraintFunc_uint _constraint;
<span class="line-removed">-   const uint* _ptr;</span>
  
  public:
<span class="line-modified">!   // the &quot;name&quot; argument must be a string literal</span>
<span class="line-modified">!   JVMFlagConstraint_uint(const char* name, const uint* ptr,</span>
<span class="line-modified">!                                  JVMFlagConstraintFunc_uint func,</span>
<span class="line-removed">-                                  ConstraintType type) : JVMFlagConstraint(name, type), _constraint(func), _ptr(ptr) {}</span>
  
    JVMFlag::Error apply(bool verbose) {
<span class="line-modified">!     uint value = *_ptr;</span>
<span class="line-removed">-     return _constraint(value, verbose);</span>
    }
  
    JVMFlag::Error apply_uint(uint value, bool verbose) {
      return _constraint(value, verbose);
    }
  };
  
  class JVMFlagConstraint_uintx : public JVMFlagConstraint {
    JVMFlagConstraintFunc_uintx _constraint;
<span class="line-removed">-   const uintx* _ptr;</span>
  
  public:
<span class="line-modified">!   // the &quot;name&quot; argument must be a string literal</span>
<span class="line-modified">!   JVMFlagConstraint_uintx(const char* name, const uintx* ptr,</span>
<span class="line-modified">!                                   JVMFlagConstraintFunc_uintx func,</span>
<span class="line-removed">-                                  ConstraintType type) : JVMFlagConstraint(name, type), _constraint(func), _ptr(ptr) {}</span>
  
    JVMFlag::Error apply(bool verbose) {
<span class="line-modified">!     uintx value = *_ptr;</span>
<span class="line-removed">-     return _constraint(value, verbose);</span>
    }
  
    JVMFlag::Error apply_uintx(uintx value, bool verbose) {
      return _constraint(value, verbose);
    }
  };
  
  class JVMFlagConstraint_uint64_t : public JVMFlagConstraint {
    JVMFlagConstraintFunc_uint64_t _constraint;
<span class="line-removed">-   const uint64_t* _ptr;</span>
  
  public:
<span class="line-modified">!   // the &quot;name&quot; argument must be a string literal</span>
<span class="line-modified">!   JVMFlagConstraint_uint64_t(const char* name, const uint64_t* ptr,</span>
<span class="line-modified">!                                      JVMFlagConstraintFunc_uint64_t func,</span>
<span class="line-removed">-                                  ConstraintType type) : JVMFlagConstraint(name, type), _constraint(func), _ptr(ptr) {}</span>
  
    JVMFlag::Error apply(bool verbose) {
<span class="line-modified">!     uint64_t value = *_ptr;</span>
<span class="line-removed">-     return _constraint(value, verbose);</span>
    }
  
    JVMFlag::Error apply_uint64_t(uint64_t value, bool verbose) {
      return _constraint(value, verbose);
    }
  };
  
  class JVMFlagConstraint_size_t : public JVMFlagConstraint {
    JVMFlagConstraintFunc_size_t _constraint;
<span class="line-modified">!   const size_t* _ptr;</span>
  public:
<span class="line-modified">!   // the &quot;name&quot; argument must be a string literal</span>
<span class="line-modified">!   JVMFlagConstraint_size_t(const char* name, const size_t* ptr,</span>
<span class="line-modified">!                                    JVMFlagConstraintFunc_size_t func,</span>
<span class="line-removed">-                                  ConstraintType type) : JVMFlagConstraint(name, type), _constraint(func), _ptr(ptr) {}</span>
  
    JVMFlag::Error apply(bool verbose) {
<span class="line-modified">!     size_t value = *_ptr;</span>
<span class="line-removed">-     return _constraint(value, verbose);</span>
    }
  
    JVMFlag::Error apply_size_t(size_t value, bool verbose) {
      return _constraint(value, verbose);
    }
  };
  
  class JVMFlagConstraint_double : public JVMFlagConstraint {
    JVMFlagConstraintFunc_double _constraint;
<span class="line-removed">-   const double* _ptr;</span>
  
  public:
<span class="line-modified">!   // the &quot;name&quot; argument must be a string literal</span>
<span class="line-modified">!   JVMFlagConstraint_double(const char* name, const double* ptr,</span>
<span class="line-modified">!                                    JVMFlagConstraintFunc_double func,</span>
<span class="line-removed">-                                  ConstraintType type) : JVMFlagConstraint(name, type), _constraint(func), _ptr(ptr) {}</span>
  
    JVMFlag::Error apply(bool verbose) {
<span class="line-modified">!     double value = *_ptr;</span>
<span class="line-removed">-     return _constraint(value, verbose);</span>
    }
  
    JVMFlag::Error apply_double(double value, bool verbose) {
      return _constraint(value, verbose);
    }
  };
  
  // No constraint emitting
<span class="line-modified">! void emit_constraint_no(...)                                                      { /* NOP */ }</span>
  
  // No constraint emitting if function argument is NOT provided
<span class="line-modified">! void emit_constraint_bool(const char* /*name*/, const bool* /*value*/)            { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_ccstr(const char* /*name*/, const ccstr* /*value*/)          { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_ccstrlist(const char* /*name*/, const ccstrlist* /*value*/)  { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_int(const char* /*name*/, const int* /*value*/)              { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_intx(const char* /*name*/, const intx* /*value*/)            { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_uint(const char* /*name*/, const uint* /*value*/)            { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_uintx(const char* /*name*/, const uintx* /*value*/)          { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_uint64_t(const char* /*name*/, const uint64_t* /*value*/)    { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_size_t(const char* /*name*/, const size_t* /*value*/)        { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_double(const char* /*name*/, const double* /*value*/)        { /* NOP */ }</span>
  
  // JVMFlagConstraint emitting code functions if function argument is provided
<span class="line-modified">! void emit_constraint_bool(const char* name, const bool* ptr, JVMFlagConstraintFunc_bool func, JVMFlagConstraint::ConstraintType type) {</span>
<span class="line-modified">!   JVMFlagConstraintList::add(new JVMFlagConstraint_bool(name, ptr, func, type));</span>
  }
<span class="line-modified">! void emit_constraint_int(const char* name, const int* ptr, JVMFlagConstraintFunc_int func, JVMFlagConstraint::ConstraintType type) {</span>
<span class="line-modified">!   JVMFlagConstraintList::add(new JVMFlagConstraint_int(name, ptr, func, type));</span>
  }
<span class="line-modified">! void emit_constraint_intx(const char* name, const intx* ptr, JVMFlagConstraintFunc_intx func, JVMFlagConstraint::ConstraintType type) {</span>
<span class="line-modified">!   JVMFlagConstraintList::add(new JVMFlagConstraint_intx(name, ptr, func, type));</span>
  }
<span class="line-modified">! void emit_constraint_uint(const char* name, const uint* ptr, JVMFlagConstraintFunc_uint func, JVMFlagConstraint::ConstraintType type) {</span>
<span class="line-modified">!   JVMFlagConstraintList::add(new JVMFlagConstraint_uint(name, ptr, func, type));</span>
  }
<span class="line-modified">! void emit_constraint_uintx(const char* name, const uintx* ptr, JVMFlagConstraintFunc_uintx func, JVMFlagConstraint::ConstraintType type) {</span>
<span class="line-modified">!   JVMFlagConstraintList::add(new JVMFlagConstraint_uintx(name, ptr, func, type));</span>
  }
<span class="line-modified">! void emit_constraint_uint64_t(const char* name, const uint64_t* ptr, JVMFlagConstraintFunc_uint64_t func, JVMFlagConstraint::ConstraintType type) {</span>
<span class="line-modified">!   JVMFlagConstraintList::add(new JVMFlagConstraint_uint64_t(name, ptr, func, type));</span>
  }
<span class="line-modified">! void emit_constraint_size_t(const char* name, const size_t* ptr, JVMFlagConstraintFunc_size_t func, JVMFlagConstraint::ConstraintType type) {</span>
<span class="line-modified">!   JVMFlagConstraintList::add(new JVMFlagConstraint_size_t(name, ptr, func, type));</span>
  }
<span class="line-modified">! void emit_constraint_double(const char* name, const double* ptr, JVMFlagConstraintFunc_double func, JVMFlagConstraint::ConstraintType type) {</span>
<span class="line-modified">!   JVMFlagConstraintList::add(new JVMFlagConstraint_double(name, ptr, func, type));</span>
  }
  
  // Generate code to call emit_constraint_xxx function
<span class="line-modified">! #define EMIT_CONSTRAINT_PRODUCT_FLAG(type, name, value, doc)      ); emit_constraint_##type(#name,&amp;name</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_DIAGNOSTIC_FLAG(type, name, value, doc)   ); emit_constraint_##type(#name,&amp;name</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_EXPERIMENTAL_FLAG(type, name, value, doc) ); emit_constraint_##type(#name,&amp;name</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_MANAGEABLE_FLAG(type, name, value, doc)   ); emit_constraint_##type(#name,&amp;name</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_PRODUCT_RW_FLAG(type, name, value, doc)   ); emit_constraint_##type(#name,&amp;name</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_PD_PRODUCT_FLAG(type, name, doc)          ); emit_constraint_##type(#name,&amp;name</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_PD_DIAGNOSTIC_FLAG(type, name, doc)       ); emit_constraint_##type(#name,&amp;name</span>
  #ifndef PRODUCT
<span class="line-modified">! #define EMIT_CONSTRAINT_DEVELOPER_FLAG(type, name, value, doc)    ); emit_constraint_##type(#name,&amp;name</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_PD_DEVELOPER_FLAG(type, name, doc)        ); emit_constraint_##type(#name,&amp;name</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_NOTPRODUCT_FLAG(type, name, value, doc)   ); emit_constraint_##type(#name,&amp;name</span>
  #else
<span class="line-modified">! #define EMIT_CONSTRAINT_DEVELOPER_FLAG(type, name, value, doc)    ); emit_constraint_no(#name,&amp;name</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_PD_DEVELOPER_FLAG(type, name, doc)        ); emit_constraint_no(#name,&amp;name</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_NOTPRODUCT_FLAG(type, name, value, doc)   ); emit_constraint_no(#name,&amp;name</span>
  #endif
  #ifdef _LP64
<span class="line-modified">! #define EMIT_CONSTRAINT_LP64_PRODUCT_FLAG(type, name, value, doc) ); emit_constraint_##type(#name,&amp;name</span>
  #else
<span class="line-modified">! #define EMIT_CONSTRAINT_LP64_PRODUCT_FLAG(type, name, value, doc) ); emit_constraint_no(#name,&amp;name</span>
  #endif
  
  // Generate func argument to pass into emit_constraint_xxx functions
  #define EMIT_CONSTRAINT_CHECK(func, type)                         , func, JVMFlagConstraint::type
  
  // the &quot;name&quot; argument must be a string literal
<span class="line-new-header">--- 29,218 ---</span>
  #include &quot;runtime/arguments.hpp&quot;
  #include &quot;runtime/flags/jvmFlag.hpp&quot;
  #include &quot;runtime/flags/jvmFlagConstraintList.hpp&quot;
  #include &quot;runtime/flags/jvmFlagConstraintsCompiler.hpp&quot;
  #include &quot;runtime/flags/jvmFlagConstraintsRuntime.hpp&quot;
<span class="line-added">+ #include &quot;runtime/globals.hpp&quot;</span>
<span class="line-added">+ #include &quot;runtime/globals_extension.hpp&quot;</span>
  #include &quot;runtime/os.hpp&quot;
  #include &quot;utilities/macros.hpp&quot;
  
  class JVMFlagConstraint_bool : public JVMFlagConstraint {
    JVMFlagConstraintFunc_bool _constraint;
  
  public:
<span class="line-modified">!   JVMFlagConstraint_bool(const JVMFlag* flag,</span>
<span class="line-modified">!                          JVMFlagConstraintFunc_bool func,</span>
<span class="line-modified">!                          ConstraintType type) : JVMFlagConstraint(flag, type), _constraint(func) {}</span>
  
    JVMFlag::Error apply(bool verbose) {
<span class="line-modified">!     return _constraint(_flag-&gt;get_bool(), verbose);</span>
    }
  
    JVMFlag::Error apply_bool(bool value, bool verbose) {
      return _constraint(value, verbose);
    }
  };
  
  class JVMFlagConstraint_int : public JVMFlagConstraint {
    JVMFlagConstraintFunc_int _constraint;
  
  public:
<span class="line-modified">!   JVMFlagConstraint_int(const JVMFlag* flag,</span>
<span class="line-modified">!                         JVMFlagConstraintFunc_int func,</span>
<span class="line-modified">!                         ConstraintType type) : JVMFlagConstraint(flag, type), _constraint(func) {}</span>
  
    JVMFlag::Error apply(bool verbose) {
<span class="line-modified">!     return _constraint(_flag-&gt;get_int(), verbose);</span>
    }
  
    JVMFlag::Error apply_int(int value, bool verbose) {
      return _constraint(value, verbose);
    }
  };
  
  class JVMFlagConstraint_intx : public JVMFlagConstraint {
    JVMFlagConstraintFunc_intx _constraint;
  
  public:
<span class="line-modified">!   JVMFlagConstraint_intx(const JVMFlag* flag,</span>
<span class="line-modified">!                          JVMFlagConstraintFunc_intx func,</span>
<span class="line-modified">!                          ConstraintType type) : JVMFlagConstraint(flag, type), _constraint(func) {}</span>
  
    JVMFlag::Error apply(bool verbose) {
<span class="line-modified">!     return _constraint(_flag-&gt;get_intx(), verbose);</span>
    }
  
    JVMFlag::Error apply_intx(intx value, bool verbose) {
      return _constraint(value, verbose);
    }
  };
  
  class JVMFlagConstraint_uint : public JVMFlagConstraint {
    JVMFlagConstraintFunc_uint _constraint;
  
  public:
<span class="line-modified">!   JVMFlagConstraint_uint(const JVMFlag* flag,</span>
<span class="line-modified">!                          JVMFlagConstraintFunc_uint func,</span>
<span class="line-modified">!                          ConstraintType type) : JVMFlagConstraint(flag, type), _constraint(func) {}</span>
  
    JVMFlag::Error apply(bool verbose) {
<span class="line-modified">!     return _constraint(_flag-&gt;get_uint(), verbose);</span>
    }
  
    JVMFlag::Error apply_uint(uint value, bool verbose) {
      return _constraint(value, verbose);
    }
  };
  
  class JVMFlagConstraint_uintx : public JVMFlagConstraint {
    JVMFlagConstraintFunc_uintx _constraint;
  
  public:
<span class="line-modified">!   JVMFlagConstraint_uintx(const JVMFlag* flag,</span>
<span class="line-modified">!                           JVMFlagConstraintFunc_uintx func,</span>
<span class="line-modified">!                           ConstraintType type) : JVMFlagConstraint(flag, type), _constraint(func) {}</span>
  
    JVMFlag::Error apply(bool verbose) {
<span class="line-modified">!     return _constraint(_flag-&gt;get_uintx(), verbose);</span>
    }
  
    JVMFlag::Error apply_uintx(uintx value, bool verbose) {
      return _constraint(value, verbose);
    }
  };
  
  class JVMFlagConstraint_uint64_t : public JVMFlagConstraint {
    JVMFlagConstraintFunc_uint64_t _constraint;
  
  public:
<span class="line-modified">!   JVMFlagConstraint_uint64_t(const JVMFlag* flag,</span>
<span class="line-modified">!                              JVMFlagConstraintFunc_uint64_t func,</span>
<span class="line-modified">!                              ConstraintType type) : JVMFlagConstraint(flag, type), _constraint(func) {}</span>
  
    JVMFlag::Error apply(bool verbose) {
<span class="line-modified">!     return _constraint(_flag-&gt;get_uint64_t(), verbose);</span>
    }
  
    JVMFlag::Error apply_uint64_t(uint64_t value, bool verbose) {
      return _constraint(value, verbose);
    }
  };
  
  class JVMFlagConstraint_size_t : public JVMFlagConstraint {
    JVMFlagConstraintFunc_size_t _constraint;
<span class="line-modified">! </span>
  public:
<span class="line-modified">!   JVMFlagConstraint_size_t(const JVMFlag* flag,</span>
<span class="line-modified">!                            JVMFlagConstraintFunc_size_t func,</span>
<span class="line-modified">!                            ConstraintType type) : JVMFlagConstraint(flag, type), _constraint(func) {}</span>
  
    JVMFlag::Error apply(bool verbose) {
<span class="line-modified">!     return _constraint(_flag-&gt;get_size_t(), verbose);</span>
    }
  
    JVMFlag::Error apply_size_t(size_t value, bool verbose) {
      return _constraint(value, verbose);
    }
  };
  
  class JVMFlagConstraint_double : public JVMFlagConstraint {
    JVMFlagConstraintFunc_double _constraint;
  
  public:
<span class="line-modified">!   JVMFlagConstraint_double(const JVMFlag* flag,</span>
<span class="line-modified">!                            JVMFlagConstraintFunc_double func,</span>
<span class="line-modified">!                            ConstraintType type) : JVMFlagConstraint(flag, type), _constraint(func) {}</span>
  
    JVMFlag::Error apply(bool verbose) {
<span class="line-modified">!     return _constraint(_flag-&gt;get_double(), verbose);</span>
    }
  
    JVMFlag::Error apply_double(double value, bool verbose) {
      return _constraint(value, verbose);
    }
  };
  
  // No constraint emitting
<span class="line-modified">! void emit_constraint_no(...)                            { /* NOP */ }</span>
  
  // No constraint emitting if function argument is NOT provided
<span class="line-modified">! void emit_constraint_bool(const JVMFlag* /*flag*/)      { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_ccstr(const JVMFlag* /*flag*/)     { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_ccstrlist(const JVMFlag* /*flag*/) { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_int(const JVMFlag* /*flag*/)       { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_intx(const JVMFlag* /*flag*/)      { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_uint(const JVMFlag* /*flag*/)      { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_uintx(const JVMFlag* /*flag*/)     { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_uint64_t(const JVMFlag* /*flag*/)  { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_size_t(const JVMFlag* /*flag*/)    { /* NOP */ }</span>
<span class="line-modified">! void emit_constraint_double(const JVMFlag* /*flag*/)    { /* NOP */ }</span>
  
  // JVMFlagConstraint emitting code functions if function argument is provided
<span class="line-modified">! void emit_constraint_bool(const JVMFlag* flag, JVMFlagConstraintFunc_bool func, JVMFlagConstraint::ConstraintType type) {</span>
<span class="line-modified">!   JVMFlagConstraintList::add(new JVMFlagConstraint_bool(flag, func, type));</span>
  }
<span class="line-modified">! void emit_constraint_int(const JVMFlag* flag, JVMFlagConstraintFunc_int func, JVMFlagConstraint::ConstraintType type) {</span>
<span class="line-modified">!   JVMFlagConstraintList::add(new JVMFlagConstraint_int(flag, func, type));</span>
  }
<span class="line-modified">! void emit_constraint_intx(const JVMFlag* flag, JVMFlagConstraintFunc_intx func, JVMFlagConstraint::ConstraintType type) {</span>
<span class="line-modified">!   JVMFlagConstraintList::add(new JVMFlagConstraint_intx(flag, func, type));</span>
  }
<span class="line-modified">! void emit_constraint_uint(const JVMFlag* flag, JVMFlagConstraintFunc_uint func, JVMFlagConstraint::ConstraintType type) {</span>
<span class="line-modified">!   JVMFlagConstraintList::add(new JVMFlagConstraint_uint(flag, func, type));</span>
  }
<span class="line-modified">! void emit_constraint_uintx(const JVMFlag* flag, JVMFlagConstraintFunc_uintx func, JVMFlagConstraint::ConstraintType type) {</span>
<span class="line-modified">!   JVMFlagConstraintList::add(new JVMFlagConstraint_uintx(flag, func, type));</span>
  }
<span class="line-modified">! void emit_constraint_uint64_t(const JVMFlag* flag, JVMFlagConstraintFunc_uint64_t func, JVMFlagConstraint::ConstraintType type) {</span>
<span class="line-modified">!   JVMFlagConstraintList::add(new JVMFlagConstraint_uint64_t(flag, func, type));</span>
  }
<span class="line-modified">! void emit_constraint_size_t(const JVMFlag* flag, JVMFlagConstraintFunc_size_t func, JVMFlagConstraint::ConstraintType type) {</span>
<span class="line-modified">!   JVMFlagConstraintList::add(new JVMFlagConstraint_size_t(flag, func, type));</span>
  }
<span class="line-modified">! void emit_constraint_double(const JVMFlag* flag, JVMFlagConstraintFunc_double func, JVMFlagConstraint::ConstraintType type) {</span>
<span class="line-modified">!   JVMFlagConstraintList::add(new JVMFlagConstraint_double(flag, func, type));</span>
  }
  
  // Generate code to call emit_constraint_xxx function
<span class="line-modified">! #define EMIT_CONSTRAINT_START       (void)(0</span>
<span class="line-modified">! #define EMIT_CONSTRAINT(type, name) ); emit_constraint_##type(JVMFlagEx::flag_from_enum(FLAG_MEMBER_ENUM(name))</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_NO          ); emit_constraint_no(0</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_PRODUCT_FLAG(type, name, value, doc)      EMIT_CONSTRAINT(type, name)</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_DIAGNOSTIC_FLAG(type, name, value, doc)   EMIT_CONSTRAINT(type, name)</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_EXPERIMENTAL_FLAG(type, name, value, doc) EMIT_CONSTRAINT(type, name)</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_MANAGEABLE_FLAG(type, name, value, doc)   EMIT_CONSTRAINT(type, name)</span>
<span class="line-added">+ #define EMIT_CONSTRAINT_PRODUCT_RW_FLAG(type, name, value, doc)   EMIT_CONSTRAINT(type, name)</span>
<span class="line-added">+ #define EMIT_CONSTRAINT_PD_PRODUCT_FLAG(type, name, doc)          EMIT_CONSTRAINT(type, name)</span>
<span class="line-added">+ #define EMIT_CONSTRAINT_PD_DIAGNOSTIC_FLAG(type, name, doc)       EMIT_CONSTRAINT(type, name)</span>
  #ifndef PRODUCT
<span class="line-modified">! #define EMIT_CONSTRAINT_DEVELOPER_FLAG(type, name, value, doc)    EMIT_CONSTRAINT(type, name)</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_PD_DEVELOPER_FLAG(type, name, doc)        EMIT_CONSTRAINT(type, name)</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_NOTPRODUCT_FLAG(type, name, value, doc)   EMIT_CONSTRAINT(type, name)</span>
  #else
<span class="line-modified">! #define EMIT_CONSTRAINT_DEVELOPER_FLAG(type, name, value, doc)    EMIT_CONSTRAINT_NO</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_PD_DEVELOPER_FLAG(type, name, doc)        EMIT_CONSTRAINT_NO</span>
<span class="line-modified">! #define EMIT_CONSTRAINT_NOTPRODUCT_FLAG(type, name, value, doc)   EMIT_CONSTRAINT_NO</span>
  #endif
  #ifdef _LP64
<span class="line-modified">! #define EMIT_CONSTRAINT_LP64_PRODUCT_FLAG(type, name, value, doc) EMIT_CONSTRAINT(type, name)</span>
  #else
<span class="line-modified">! #define EMIT_CONSTRAINT_LP64_PRODUCT_FLAG(type, name, value, doc) EMIT_CONSTRAINT_NO</span>
  #endif
<span class="line-added">+ #define EMIT_CONSTRAINT_END         );</span>
  
  // Generate func argument to pass into emit_constraint_xxx functions
  #define EMIT_CONSTRAINT_CHECK(func, type)                         , func, JVMFlagConstraint::type
  
  // the &quot;name&quot; argument must be a string literal
</pre>
<hr />
<pre>
<span class="line-old-header">*** 273,82 ***</span>
  
  // Check the ranges of all flags that have them or print them out and exit if requested
  void JVMFlagConstraintList::init(void) {
    _constraints = new (ResourceObj::C_HEAP, mtArguments) GrowableArray&lt;JVMFlagConstraint*&gt;(INITIAL_CONSTRAINTS_SIZE, true);
  
<span class="line-modified">!   emit_constraint_no(NULL VM_FLAGS(EMIT_CONSTRAINT_DEVELOPER_FLAG,</span>
<span class="line-modified">!                                    EMIT_CONSTRAINT_PD_DEVELOPER_FLAG,</span>
<span class="line-modified">!                                    EMIT_CONSTRAINT_PRODUCT_FLAG,</span>
<span class="line-modified">!                                    EMIT_CONSTRAINT_PD_PRODUCT_FLAG,</span>
<span class="line-modified">!                                    EMIT_CONSTRAINT_DIAGNOSTIC_FLAG,</span>
<span class="line-modified">!                                    EMIT_CONSTRAINT_PD_DIAGNOSTIC_FLAG,</span>
<span class="line-modified">!                                    EMIT_CONSTRAINT_EXPERIMENTAL_FLAG,</span>
<span class="line-modified">!                                    EMIT_CONSTRAINT_NOTPRODUCT_FLAG,</span>
<span class="line-modified">!                                    EMIT_CONSTRAINT_MANAGEABLE_FLAG,</span>
<span class="line-modified">!                                    EMIT_CONSTRAINT_PRODUCT_RW_FLAG,</span>
<span class="line-modified">!                                    EMIT_CONSTRAINT_LP64_PRODUCT_FLAG,</span>
<span class="line-modified">!                                    IGNORE_RANGE,</span>
<span class="line-modified">!                                    EMIT_CONSTRAINT_CHECK,</span>
<span class="line-modified">!                                    IGNORE_WRITEABLE));</span>
<span class="line-modified">! </span>
<span class="line-modified">!   EMIT_CONSTRAINTS_FOR_GLOBALS_EXT</span>
<span class="line-modified">! </span>
<span class="line-removed">-   emit_constraint_no(NULL ARCH_FLAGS(EMIT_CONSTRAINT_DEVELOPER_FLAG,</span>
<span class="line-removed">-                                      EMIT_CONSTRAINT_PRODUCT_FLAG,</span>
<span class="line-removed">-                                      EMIT_CONSTRAINT_DIAGNOSTIC_FLAG,</span>
<span class="line-removed">-                                      EMIT_CONSTRAINT_EXPERIMENTAL_FLAG,</span>
<span class="line-removed">-                                      EMIT_CONSTRAINT_NOTPRODUCT_FLAG,</span>
<span class="line-removed">-                                      IGNORE_RANGE,</span>
<span class="line-removed">-                                      EMIT_CONSTRAINT_CHECK,</span>
<span class="line-removed">-                                      IGNORE_WRITEABLE));</span>
<span class="line-removed">- </span>
<span class="line-removed">- </span>
<span class="line-removed">- #ifdef COMPILER1</span>
<span class="line-removed">-   emit_constraint_no(NULL C1_FLAGS(EMIT_CONSTRAINT_DEVELOPER_FLAG,</span>
<span class="line-removed">-                                    EMIT_CONSTRAINT_PD_DEVELOPER_FLAG,</span>
<span class="line-removed">-                                    EMIT_CONSTRAINT_PRODUCT_FLAG,</span>
<span class="line-removed">-                                    EMIT_CONSTRAINT_PD_PRODUCT_FLAG,</span>
<span class="line-removed">-                                    EMIT_CONSTRAINT_DIAGNOSTIC_FLAG,</span>
<span class="line-removed">-                                    EMIT_CONSTRAINT_PD_DIAGNOSTIC_FLAG,</span>
<span class="line-removed">-                                    EMIT_CONSTRAINT_NOTPRODUCT_FLAG,</span>
<span class="line-removed">-                                    IGNORE_RANGE,</span>
<span class="line-removed">-                                    EMIT_CONSTRAINT_CHECK,</span>
<span class="line-removed">-                                    IGNORE_WRITEABLE));</span>
<span class="line-removed">- #endif // COMPILER1</span>
<span class="line-removed">- </span>
<span class="line-removed">- #ifdef COMPILER2</span>
<span class="line-removed">-   emit_constraint_no(NULL C2_FLAGS(EMIT_CONSTRAINT_DEVELOPER_FLAG,</span>
<span class="line-removed">-                                    EMIT_CONSTRAINT_PD_DEVELOPER_FLAG,</span>
<span class="line-removed">-                                    EMIT_CONSTRAINT_PRODUCT_FLAG,</span>
<span class="line-removed">-                                    EMIT_CONSTRAINT_PD_PRODUCT_FLAG,</span>
<span class="line-removed">-                                    EMIT_CONSTRAINT_DIAGNOSTIC_FLAG,</span>
<span class="line-removed">-                                    EMIT_CONSTRAINT_PD_DIAGNOSTIC_FLAG,</span>
<span class="line-removed">-                                    EMIT_CONSTRAINT_EXPERIMENTAL_FLAG,</span>
<span class="line-removed">-                                    EMIT_CONSTRAINT_NOTPRODUCT_FLAG,</span>
<span class="line-removed">-                                    IGNORE_RANGE,</span>
<span class="line-removed">-                                    EMIT_CONSTRAINT_CHECK,</span>
<span class="line-removed">-                                    IGNORE_WRITEABLE));</span>
<span class="line-removed">- #endif // COMPILER2</span>
  }
  
<span class="line-modified">! JVMFlagConstraint* JVMFlagConstraintList::find(const char* name) {</span>
    JVMFlagConstraint* found = NULL;
    for (int i=0; i&lt;length(); i++) {
      JVMFlagConstraint* constraint = at(i);
<span class="line-modified">!     if (strcmp(constraint-&gt;name(), name) == 0) {</span>
        found = constraint;
        break;
      }
    }
    return found;
  }
  
<span class="line-modified">! // Find constraints by name and return only if found constraint&#39;s type is equal or lower than current validating type.</span>
<span class="line-modified">! JVMFlagConstraint* JVMFlagConstraintList::find_if_needs_check(const char* name) {</span>
    JVMFlagConstraint* found = NULL;
<span class="line-modified">!   JVMFlagConstraint* constraint = find(name);</span>
<span class="line-modified">!   if (constraint &amp;&amp; (constraint-&gt;type() &lt;= _validating_type)) {</span>
      found = constraint;
    }
    return found;
  }
  
<span class="line-new-header">--- 250,46 ---</span>
  
  // Check the ranges of all flags that have them or print them out and exit if requested
  void JVMFlagConstraintList::init(void) {
    _constraints = new (ResourceObj::C_HEAP, mtArguments) GrowableArray&lt;JVMFlagConstraint*&gt;(INITIAL_CONSTRAINTS_SIZE, true);
  
<span class="line-modified">!   EMIT_CONSTRAINT_START</span>
<span class="line-modified">! </span>
<span class="line-modified">!   ALL_FLAGS(EMIT_CONSTRAINT_DEVELOPER_FLAG,</span>
<span class="line-modified">!             EMIT_CONSTRAINT_PD_DEVELOPER_FLAG,</span>
<span class="line-modified">!             EMIT_CONSTRAINT_PRODUCT_FLAG,</span>
<span class="line-modified">!             EMIT_CONSTRAINT_PD_PRODUCT_FLAG,</span>
<span class="line-modified">!             EMIT_CONSTRAINT_DIAGNOSTIC_FLAG,</span>
<span class="line-modified">!             EMIT_CONSTRAINT_PD_DIAGNOSTIC_FLAG,</span>
<span class="line-modified">!             EMIT_CONSTRAINT_EXPERIMENTAL_FLAG,</span>
<span class="line-modified">!             EMIT_CONSTRAINT_NOTPRODUCT_FLAG,</span>
<span class="line-modified">!             EMIT_CONSTRAINT_MANAGEABLE_FLAG,</span>
<span class="line-modified">!             EMIT_CONSTRAINT_PRODUCT_RW_FLAG,</span>
<span class="line-modified">!             EMIT_CONSTRAINT_LP64_PRODUCT_FLAG,</span>
<span class="line-modified">!             IGNORE_RANGE,</span>
<span class="line-modified">!             EMIT_CONSTRAINT_CHECK)</span>
<span class="line-modified">! </span>
<span class="line-modified">!   EMIT_CONSTRAINT_END</span>
  }
  
<span class="line-modified">! JVMFlagConstraint* JVMFlagConstraintList::find(const JVMFlag* flag) {</span>
    JVMFlagConstraint* found = NULL;
    for (int i=0; i&lt;length(); i++) {
      JVMFlagConstraint* constraint = at(i);
<span class="line-modified">!     if (constraint-&gt;flag() == flag) {</span>
        found = constraint;
        break;
      }
    }
    return found;
  }
  
<span class="line-modified">! // Find constraints and return only if found constraint&#39;s type is equal or lower than current validating type.</span>
<span class="line-modified">! JVMFlagConstraint* JVMFlagConstraintList::find_if_needs_check(const JVMFlag* flag) {</span>
    JVMFlagConstraint* found = NULL;
<span class="line-modified">!   JVMFlagConstraint* constraint = find(flag);</span>
<span class="line-modified">!   if (constraint != NULL &amp;&amp; (constraint-&gt;type() &lt;= _validating_type)) {</span>
      found = constraint;
    }
    return found;
  }
  
</pre>
<center><a href="jvmFlag.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jvmFlagConstraintList.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>