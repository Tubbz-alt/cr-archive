<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/runtime/stubRoutines.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="stubCodeGenerator.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="stubRoutines.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/runtime/stubRoutines.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -22,10 +22,11 @@</span>
   *
   */
  
  #include &quot;precompiled.hpp&quot;
  #include &quot;asm/codeBuffer.hpp&quot;
<span class="udiff-line-added">+ #include &quot;asm/macroAssembler.inline.hpp&quot;</span>
  #include &quot;memory/resourceArea.hpp&quot;
  #include &quot;oops/access.inline.hpp&quot;
  #include &quot;oops/oop.inline.hpp&quot;
  #include &quot;runtime/interfaceSupport.inline.hpp&quot;
  #include &quot;runtime/timerTrace.hpp&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -36,10 +37,14 @@</span>
  #include &quot;utilities/vmError.hpp&quot;
  #ifdef COMPILER2
  #include &quot;opto/runtime.hpp&quot;
  #endif
  
<span class="udiff-line-added">+ UnsafeCopyMemory* UnsafeCopyMemory::_table                      = NULL;</span>
<span class="udiff-line-added">+ int UnsafeCopyMemory::_table_length                             = 0;</span>
<span class="udiff-line-added">+ int UnsafeCopyMemory::_table_max_length                         = 0;</span>
<span class="udiff-line-added">+ address UnsafeCopyMemory::_common_exit_stub_pc                  = NULL;</span>
  
  // Implementation of StubRoutines - for a description
  // of how to extend it, see the header file.
  
  // Class Variables
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -106,16 +111,18 @@</span>
  address StubRoutines::_arrayof_oop_disjoint_arraycopy    = CAST_FROM_FN_PTR(address, StubRoutines::arrayof_oop_copy);
  address StubRoutines::_arrayof_oop_disjoint_arraycopy_uninit  = CAST_FROM_FN_PTR(address, StubRoutines::arrayof_oop_copy_uninit);
  
  address StubRoutines::_zero_aligned_words = CAST_FROM_FN_PTR(address, Copy::zero_to_words);
  
<span class="udiff-line-added">+ address StubRoutines::_data_cache_writeback              = NULL;</span>
<span class="udiff-line-added">+ address StubRoutines::_data_cache_writeback_sync         = NULL;</span>
<span class="udiff-line-added">+ </span>
  address StubRoutines::_checkcast_arraycopy               = NULL;
  address StubRoutines::_checkcast_arraycopy_uninit        = NULL;
  address StubRoutines::_unsafe_arraycopy                  = NULL;
  address StubRoutines::_generic_arraycopy                 = NULL;
  
<span class="udiff-line-removed">- </span>
  address StubRoutines::_jbyte_fill;
  address StubRoutines::_jshort_fill;
  address StubRoutines::_jint_fill;
  address StubRoutines::_arrayof_jbyte_fill;
  address StubRoutines::_arrayof_jshort_fill;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -123,10 +130,12 @@</span>
  
  address StubRoutines::_aescrypt_encryptBlock               = NULL;
  address StubRoutines::_aescrypt_decryptBlock               = NULL;
  address StubRoutines::_cipherBlockChaining_encryptAESCrypt = NULL;
  address StubRoutines::_cipherBlockChaining_decryptAESCrypt = NULL;
<span class="udiff-line-added">+ address StubRoutines::_electronicCodeBook_encryptAESCrypt  = NULL;</span>
<span class="udiff-line-added">+ address StubRoutines::_electronicCodeBook_decryptAESCrypt  = NULL;</span>
  address StubRoutines::_counterMode_AESCrypt                = NULL;
  address StubRoutines::_ghash_processBlocks                 = NULL;
  address StubRoutines::_base64_encodeBlock                  = NULL;
  
  address StubRoutines::_sha1_implCompress     = NULL;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -146,10 +155,12 @@</span>
  address StubRoutines::_multiplyToLen = NULL;
  address StubRoutines::_squareToLen = NULL;
  address StubRoutines::_mulAdd = NULL;
  address StubRoutines::_montgomeryMultiply = NULL;
  address StubRoutines::_montgomerySquare = NULL;
<span class="udiff-line-added">+ address StubRoutines::_bigIntegerRightShiftWorker = NULL;</span>
<span class="udiff-line-added">+ address StubRoutines::_bigIntegerLeftShiftWorker = NULL;</span>
  
  address StubRoutines::_vectorizedMismatch = NULL;
  
  address StubRoutines::_dexp = NULL;
  address StubRoutines::_dlog = NULL;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -175,10 +186,35 @@</span>
  // The first one generates stubs needed during universe init (e.g., _handle_must_compile_first_entry).
  // The second phase includes all other stubs (which may depend on universe being initialized.)
  
  extern void StubGenerator_generate(CodeBuffer* code, bool all); // only interface to generators
  
<span class="udiff-line-added">+ void UnsafeCopyMemory::create_table(int max_size) {</span>
<span class="udiff-line-added">+   UnsafeCopyMemory::_table = new UnsafeCopyMemory[max_size];</span>
<span class="udiff-line-added">+   UnsafeCopyMemory::_table_max_length = max_size;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ bool UnsafeCopyMemory::contains_pc(address pc) {</span>
<span class="udiff-line-added">+   for (int i = 0; i &lt; UnsafeCopyMemory::_table_length; i++) {</span>
<span class="udiff-line-added">+     UnsafeCopyMemory* entry = &amp;UnsafeCopyMemory::_table[i];</span>
<span class="udiff-line-added">+     if (pc &gt;= entry-&gt;start_pc() &amp;&amp; pc &lt; entry-&gt;end_pc()) {</span>
<span class="udiff-line-added">+       return true;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+   return false;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ address UnsafeCopyMemory::page_error_continue_pc(address pc) {</span>
<span class="udiff-line-added">+   for (int i = 0; i &lt; UnsafeCopyMemory::_table_length; i++) {</span>
<span class="udiff-line-added">+     UnsafeCopyMemory* entry = &amp;UnsafeCopyMemory::_table[i];</span>
<span class="udiff-line-added">+     if (pc &gt;= entry-&gt;start_pc() &amp;&amp; pc &lt; entry-&gt;end_pc()) {</span>
<span class="udiff-line-added">+       return entry-&gt;error_exit_pc();</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+   return NULL;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  void StubRoutines::initialize1() {
    if (_code1 == NULL) {
      ResourceMark rm;
      TraceTime timer(&quot;StubRoutines generation 1&quot;, TRACETIME_LOG(Info, startuptime));
      _code1 = BufferBlob::create(&quot;StubRoutines (1)&quot;, code_size1);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -567,5 +603,27 @@</span>
    }
  
  #undef RETURN_STUB
  #undef RETURN_STUB_PARM
  }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ UnsafeCopyMemoryMark::UnsafeCopyMemoryMark(StubCodeGenerator* cgen, bool add_entry, bool continue_at_scope_end, address error_exit_pc) {</span>
<span class="udiff-line-added">+   _cgen = cgen;</span>
<span class="udiff-line-added">+   _ucm_entry = NULL;</span>
<span class="udiff-line-added">+   if (add_entry) {</span>
<span class="udiff-line-added">+     address err_exit_pc = NULL;</span>
<span class="udiff-line-added">+     if (!continue_at_scope_end) {</span>
<span class="udiff-line-added">+       err_exit_pc = error_exit_pc != NULL ? error_exit_pc : UnsafeCopyMemory::common_exit_stub_pc();</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     assert(err_exit_pc != NULL || continue_at_scope_end, &quot;error exit not set&quot;);</span>
<span class="udiff-line-added">+     _ucm_entry = UnsafeCopyMemory::add_to_table(_cgen-&gt;assembler()-&gt;pc(), NULL, err_exit_pc);</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ UnsafeCopyMemoryMark::~UnsafeCopyMemoryMark() {</span>
<span class="udiff-line-added">+   if (_ucm_entry != NULL) {</span>
<span class="udiff-line-added">+     _ucm_entry-&gt;set_end_pc(_cgen-&gt;assembler()-&gt;pc());</span>
<span class="udiff-line-added">+     if (_ucm_entry-&gt;error_exit_pc() == NULL) {</span>
<span class="udiff-line-added">+       _ucm_entry-&gt;set_error_exit_pc(_cgen-&gt;assembler()-&gt;pc());</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ }</span>
</pre>
<center><a href="stubCodeGenerator.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="stubRoutines.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>