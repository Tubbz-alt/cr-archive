<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/runtime/handshake.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="handshake.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="init.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/runtime/handshake.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -24,26 +24,36 @@</span>
  
  #ifndef SHARE_RUNTIME_HANDSHAKE_HPP
  #define SHARE_RUNTIME_HANDSHAKE_HPP
  
  #include &quot;memory/allocation.hpp&quot;
<span class="udiff-line-added">+ #include &quot;memory/iterator.hpp&quot;</span>
  #include &quot;runtime/flags/flagSetting.hpp&quot;
  #include &quot;runtime/semaphore.hpp&quot;
  
<span class="udiff-line-removed">- class ThreadClosure;</span>
  class JavaThread;
  
<span class="udiff-line-modified-removed">- // A handshake operation is a callback that is executed for each JavaThread</span>
<span class="udiff-line-modified-added">+ // A handshake closure is a callback that is executed for each JavaThread</span>
  // while that thread is in a safepoint safe state. The callback is executed
  // either by the thread itself or by the VM thread while keeping the thread
  // in a blocked state. A handshake can be performed with a single
  // JavaThread as well.
<span class="udiff-line-added">+ class HandshakeClosure : public ThreadClosure {</span>
<span class="udiff-line-added">+   const char* const _name;</span>
<span class="udiff-line-added">+  public:</span>
<span class="udiff-line-added">+   HandshakeClosure(const char* name) : _name(name) {}</span>
<span class="udiff-line-added">+   const char* name() const {</span>
<span class="udiff-line-added">+     return _name;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+   virtual void do_thread(Thread* thread) = 0;</span>
<span class="udiff-line-added">+ };</span>
<span class="udiff-line-added">+ </span>
  class Handshake : public AllStatic {
   public:
    // Execution of handshake operation
<span class="udiff-line-modified-removed">-   static void execute(ThreadClosure* thread_cl);</span>
<span class="udiff-line-modified-removed">-   static bool execute(ThreadClosure* thread_cl, JavaThread* target);</span>
<span class="udiff-line-modified-added">+   static void execute(HandshakeClosure* hs_cl);</span>
<span class="udiff-line-modified-added">+   static bool execute(HandshakeClosure* hs_cl, JavaThread* target);</span>
  };
  
  class HandshakeOperation;
  
  // The HandshakeState keep tracks of an ongoing handshake for one JavaThread.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -76,9 +86,15 @@</span>
        FlagSetting fs(_thread_in_process_handshake, true);
        process_self_inner(thread);
      }
    }
  
<span class="udiff-line-modified-removed">-   void process_by_vmthread(JavaThread* target);</span>
<span class="udiff-line-modified-added">+   bool try_process_by_vmThread(JavaThread* target);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #ifdef ASSERT</span>
<span class="udiff-line-added">+   bool _vmthread_processing_handshake;</span>
<span class="udiff-line-added">+   bool is_vmthread_processing_handshake() const { return _vmthread_processing_handshake; }</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
  };
  
  #endif // SHARE_RUNTIME_HANDSHAKE_HPP
</pre>
<center><a href="handshake.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="init.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>