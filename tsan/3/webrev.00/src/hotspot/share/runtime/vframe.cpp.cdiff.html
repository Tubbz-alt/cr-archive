<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/runtime/vframe.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="unhandledOops.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="vframe.inline.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/runtime/vframe.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 133,11 ***</span>
      oop obj = monitor-&gt;owner();
      if (obj == NULL) continue; // skip unowned monitor
      //
      // Skip the monitor that the thread is blocked to enter or waiting on
      //
<span class="line-modified">!     if (!found_first_monitor &amp;&amp; (oopDesc::equals(obj, pending_obj) || oopDesc::equals(obj, waiting_obj))) {</span>
        continue;
      }
      found_first_monitor = true;
      result-&gt;append(monitor);
    }
<span class="line-new-header">--- 133,11 ---</span>
      oop obj = monitor-&gt;owner();
      if (obj == NULL) continue; // skip unowned monitor
      //
      // Skip the monitor that the thread is blocked to enter or waiting on
      //
<span class="line-modified">!     if (!found_first_monitor &amp;&amp; (obj == pending_obj || obj == waiting_obj)) {</span>
        continue;
      }
      found_first_monitor = true;
      result-&gt;append(monitor);
    }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 209,11 ***</span>
      for (int index = (mons-&gt;length()-1); index &gt;= 0; index--) {
        MonitorInfo* monitor = mons-&gt;at(index);
        if (monitor-&gt;eliminated() &amp;&amp; is_compiled_frame()) { // Eliminated in compiled code
          if (monitor-&gt;owner_is_scalar_replaced()) {
            Klass* k = java_lang_Class::as_Klass(monitor-&gt;owner_klass());
<span class="line-removed">-           // format below for lockbits matches this one.</span>
            st-&gt;print(&quot;\t- eliminated &lt;owner is scalar replaced&gt; (a %s)&quot;, k-&gt;external_name());
          } else {
            Handle obj(THREAD, monitor-&gt;owner());
            if (obj() != NULL) {
              print_locked_object_class_name(st, obj, &quot;eliminated&quot;);
<span class="line-new-header">--- 209,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 222,30 ***</span>
          continue;
        }
        if (monitor-&gt;owner() != NULL) {
          // the monitor is associated with an object, i.e., it is locked
  
<span class="line-removed">-         markOop mark = NULL;</span>
          const char *lock_state = &quot;locked&quot;; // assume we have the monitor locked
          if (!found_first_monitor &amp;&amp; frame_count == 0) {
            // If this is the first frame and we haven&#39;t found an owned
            // monitor before, then we need to see if we have completed
            // the lock or if we are blocked trying to acquire it. Only
            // an inflated monitor that is first on the monitor list in
            // the first frame can block us on a monitor enter.
<span class="line-modified">!           mark = monitor-&gt;owner()-&gt;mark();</span>
<span class="line-modified">!           if (mark-&gt;has_monitor() &amp;&amp;</span>
                ( // we have marked ourself as pending on this monitor
<span class="line-modified">!                 mark-&gt;monitor() == thread()-&gt;current_pending_monitor() ||</span>
                  // we are not the owner of this monitor
<span class="line-modified">!                 !mark-&gt;monitor()-&gt;is_entered(thread())</span>
                )) {
              lock_state = &quot;waiting to lock&quot;;
<span class="line-removed">-           } else {</span>
<span class="line-removed">-             // We own the monitor which is not as interesting so</span>
<span class="line-removed">-             // disable the extra printing below.</span>
<span class="line-removed">-             mark = NULL;</span>
            }
          }
          print_locked_object_class_name(st, Handle(THREAD, monitor-&gt;owner()), lock_state);
  
          found_first_monitor = true;
<span class="line-new-header">--- 221,25 ---</span>
          continue;
        }
        if (monitor-&gt;owner() != NULL) {
          // the monitor is associated with an object, i.e., it is locked
  
          const char *lock_state = &quot;locked&quot;; // assume we have the monitor locked
          if (!found_first_monitor &amp;&amp; frame_count == 0) {
            // If this is the first frame and we haven&#39;t found an owned
            // monitor before, then we need to see if we have completed
            // the lock or if we are blocked trying to acquire it. Only
            // an inflated monitor that is first on the monitor list in
            // the first frame can block us on a monitor enter.
<span class="line-modified">!           markWord mark = monitor-&gt;owner()-&gt;mark();</span>
<span class="line-modified">!           if (mark.has_monitor() &amp;&amp;</span>
                ( // we have marked ourself as pending on this monitor
<span class="line-modified">!                 mark.monitor() == thread()-&gt;current_pending_monitor() ||</span>
                  // we are not the owner of this monitor
<span class="line-modified">!                 !mark.monitor()-&gt;is_entered(thread())</span>
                )) {
              lock_state = &quot;waiting to lock&quot;;
            }
          }
          print_locked_object_class_name(st, Handle(THREAD, monitor-&gt;owner()), lock_state);
  
          found_first_monitor = true;
</pre>
<center><a href="unhandledOops.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="vframe.inline.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>