<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/opto/c2compiler.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="c2_globals.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="callGenerator.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/opto/c2compiler.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 85 
 86 void C2Compiler::initialize() {
 87   // The first compiler thread that gets here will initialize the
 88   // small amount of global state (and runtime stubs) that C2 needs.
 89 
 90   // There is a race possible once at startup and then we&#39;re fine
 91 
 92   // Note that this is being called from a compiler thread not the
 93   // main startup thread.
 94   if (should_perform_init()) {
 95     bool successful = C2Compiler::init_c2_runtime();
 96     int new_state = (successful) ? initialized : failed;
 97     set_state(new_state);
 98   }
 99 }
100 
101 void C2Compiler::compile_method(ciEnv* env, ciMethod* target, int entry_bci, DirectiveSet* directive) {
102   assert(is_initialized(), &quot;Compiler thread must be initialized&quot;);
103 
104   bool subsume_loads = SubsumeLoads;
<span class="line-modified">105   bool do_escape_analysis = DoEscapeAnalysis &amp;&amp; !env-&gt;should_retain_local_variables();</span>

106   bool eliminate_boxing = EliminateAutoBox;
107 
108   while (!env-&gt;failing()) {
109     // Attempt to compile while subsuming loads into machine instructions.
110     Compile C(env, this, target, entry_bci, subsume_loads, do_escape_analysis, eliminate_boxing, directive);
111 
112     // Check result and retry if appropriate.
113     if (C.failure_reason() != NULL) {
114       if (C.failure_reason_is(retry_class_loading_during_parsing())) {
115         env-&gt;report_failure(C.failure_reason());
116         continue;  // retry
117       }
118       if (C.failure_reason_is(retry_no_subsuming_loads())) {
119         assert(subsume_loads, &quot;must make progress&quot;);
120         subsume_loads = false;
121         env-&gt;report_failure(C.failure_reason());
122         continue;  // retry
123       }
124       if (C.failure_reason_is(retry_no_escape_analysis())) {
125         assert(do_escape_analysis, &quot;must make progress&quot;);
</pre>
<hr />
<pre>
436     if (!Matcher::match_rule_supported(Op_LowerCase)) return false;
437     break;
438   case vmIntrinsics::_isUpperCase:
439     if (!Matcher::match_rule_supported(Op_UpperCase)) return false;
440     break;
441   case vmIntrinsics::_isWhitespace:
442     if (!Matcher::match_rule_supported(Op_Whitespace)) return false;
443     break;
444   case vmIntrinsics::_maxF:
445     if (!Matcher::match_rule_supported(Op_MaxF)) return false;
446     break;
447   case vmIntrinsics::_minF:
448     if (!Matcher::match_rule_supported(Op_MinF)) return false;
449     break;
450   case vmIntrinsics::_maxD:
451     if (!Matcher::match_rule_supported(Op_MaxD)) return false;
452     break;
453   case vmIntrinsics::_minD:
454     if (!Matcher::match_rule_supported(Op_MinD)) return false;
455     break;














456   case vmIntrinsics::_hashCode:
457   case vmIntrinsics::_identityHashCode:
458   case vmIntrinsics::_getClass:
459   case vmIntrinsics::_dsin:
460   case vmIntrinsics::_dcos:
461   case vmIntrinsics::_dtan:
462   case vmIntrinsics::_dabs:



463   case vmIntrinsics::_datan2:
464   case vmIntrinsics::_dsqrt:
465   case vmIntrinsics::_dexp:
466   case vmIntrinsics::_dlog:
467   case vmIntrinsics::_dlog10:
468   case vmIntrinsics::_dpow:
469   case vmIntrinsics::_min:
470   case vmIntrinsics::_max:
471   case vmIntrinsics::_arraycopy:
472   case vmIntrinsics::_indexOfL:
473   case vmIntrinsics::_indexOfU:
474   case vmIntrinsics::_indexOfUL:
475   case vmIntrinsics::_indexOfIL:
476   case vmIntrinsics::_indexOfIU:
477   case vmIntrinsics::_indexOfIUL:
478   case vmIntrinsics::_indexOfU_char:
479   case vmIntrinsics::_toBytesStringU:
480   case vmIntrinsics::_getCharsStringU:
481   case vmIntrinsics::_getCharStringU:
482   case vmIntrinsics::_putCharStringU:
</pre>
<hr />
<pre>
547   case vmIntrinsics::_putBooleanOpaque:
548   case vmIntrinsics::_putByteOpaque:
549   case vmIntrinsics::_putShortOpaque:
550   case vmIntrinsics::_putCharOpaque:
551   case vmIntrinsics::_putIntOpaque:
552   case vmIntrinsics::_putLongOpaque:
553   case vmIntrinsics::_putFloatOpaque:
554   case vmIntrinsics::_putDoubleOpaque:
555   case vmIntrinsics::_getShortUnaligned:
556   case vmIntrinsics::_getCharUnaligned:
557   case vmIntrinsics::_getIntUnaligned:
558   case vmIntrinsics::_getLongUnaligned:
559   case vmIntrinsics::_putShortUnaligned:
560   case vmIntrinsics::_putCharUnaligned:
561   case vmIntrinsics::_putIntUnaligned:
562   case vmIntrinsics::_putLongUnaligned:
563   case vmIntrinsics::_loadFence:
564   case vmIntrinsics::_storeFence:
565   case vmIntrinsics::_fullFence:
566   case vmIntrinsics::_currentThread:
<span class="line-removed">567   case vmIntrinsics::_isInterrupted:</span>
568 #ifdef JFR_HAVE_INTRINSICS
569   case vmIntrinsics::_counterTime:
570   case vmIntrinsics::_getClassId:
571   case vmIntrinsics::_getEventWriter:
572 #endif
573   case vmIntrinsics::_currentTimeMillis:
574   case vmIntrinsics::_nanoTime:
575   case vmIntrinsics::_allocateInstance:
576   case vmIntrinsics::_allocateUninitializedArray:
577   case vmIntrinsics::_newArray:
578   case vmIntrinsics::_getLength:
579   case vmIntrinsics::_copyOf:
580   case vmIntrinsics::_copyOfRange:
581   case vmIntrinsics::_clone:
582   case vmIntrinsics::_isAssignableFrom:
583   case vmIntrinsics::_isInstance:
584   case vmIntrinsics::_getModifiers:
585   case vmIntrinsics::_isInterface:
586   case vmIntrinsics::_isArray:
587   case vmIntrinsics::_isPrimitive:
588   case vmIntrinsics::_getSuperclass:
589   case vmIntrinsics::_getClassAccessFlags:
590   case vmIntrinsics::_floatToRawIntBits:
591   case vmIntrinsics::_floatToIntBits:
592   case vmIntrinsics::_intBitsToFloat:
593   case vmIntrinsics::_doubleToRawLongBits:
594   case vmIntrinsics::_doubleToLongBits:
595   case vmIntrinsics::_longBitsToDouble:
596   case vmIntrinsics::_Reference_get:
597   case vmIntrinsics::_Class_cast:
598   case vmIntrinsics::_aescrypt_encryptBlock:
599   case vmIntrinsics::_aescrypt_decryptBlock:
600   case vmIntrinsics::_cipherBlockChaining_encryptAESCrypt:
601   case vmIntrinsics::_cipherBlockChaining_decryptAESCrypt:


602   case vmIntrinsics::_counterMode_AESCrypt:
603   case vmIntrinsics::_sha_implCompress:
604   case vmIntrinsics::_sha2_implCompress:
605   case vmIntrinsics::_sha5_implCompress:
606   case vmIntrinsics::_digestBase_implCompressMB:
607   case vmIntrinsics::_multiplyToLen:
608   case vmIntrinsics::_squareToLen:
609   case vmIntrinsics::_mulAdd:
610   case vmIntrinsics::_montgomeryMultiply:
611   case vmIntrinsics::_montgomerySquare:


612   case vmIntrinsics::_vectorizedMismatch:
613   case vmIntrinsics::_ghash_processBlocks:
614   case vmIntrinsics::_base64_encodeBlock:
615   case vmIntrinsics::_updateCRC32:
616   case vmIntrinsics::_updateBytesCRC32:
617   case vmIntrinsics::_updateByteBufferCRC32:
618   case vmIntrinsics::_updateBytesCRC32C:
619   case vmIntrinsics::_updateDirectByteBufferCRC32C:
620   case vmIntrinsics::_updateBytesAdler32:
621   case vmIntrinsics::_updateByteBufferAdler32:
622   case vmIntrinsics::_profileBoolean:
623   case vmIntrinsics::_isCompileConstant:
624   case vmIntrinsics::_Preconditions_checkIndex:
625     break;
626   default:
627     return false;
628   }
629   return true;
630 }
631 
</pre>
</td>
<td>
<hr />
<pre>
 85 
 86 void C2Compiler::initialize() {
 87   // The first compiler thread that gets here will initialize the
 88   // small amount of global state (and runtime stubs) that C2 needs.
 89 
 90   // There is a race possible once at startup and then we&#39;re fine
 91 
 92   // Note that this is being called from a compiler thread not the
 93   // main startup thread.
 94   if (should_perform_init()) {
 95     bool successful = C2Compiler::init_c2_runtime();
 96     int new_state = (successful) ? initialized : failed;
 97     set_state(new_state);
 98   }
 99 }
100 
101 void C2Compiler::compile_method(ciEnv* env, ciMethod* target, int entry_bci, DirectiveSet* directive) {
102   assert(is_initialized(), &quot;Compiler thread must be initialized&quot;);
103 
104   bool subsume_loads = SubsumeLoads;
<span class="line-modified">105   bool do_escape_analysis = DoEscapeAnalysis &amp;&amp; !env-&gt;should_retain_local_variables()</span>
<span class="line-added">106                                              &amp;&amp; !env-&gt;jvmti_can_get_owned_monitor_info();</span>
107   bool eliminate_boxing = EliminateAutoBox;
108 
109   while (!env-&gt;failing()) {
110     // Attempt to compile while subsuming loads into machine instructions.
111     Compile C(env, this, target, entry_bci, subsume_loads, do_escape_analysis, eliminate_boxing, directive);
112 
113     // Check result and retry if appropriate.
114     if (C.failure_reason() != NULL) {
115       if (C.failure_reason_is(retry_class_loading_during_parsing())) {
116         env-&gt;report_failure(C.failure_reason());
117         continue;  // retry
118       }
119       if (C.failure_reason_is(retry_no_subsuming_loads())) {
120         assert(subsume_loads, &quot;must make progress&quot;);
121         subsume_loads = false;
122         env-&gt;report_failure(C.failure_reason());
123         continue;  // retry
124       }
125       if (C.failure_reason_is(retry_no_escape_analysis())) {
126         assert(do_escape_analysis, &quot;must make progress&quot;);
</pre>
<hr />
<pre>
437     if (!Matcher::match_rule_supported(Op_LowerCase)) return false;
438     break;
439   case vmIntrinsics::_isUpperCase:
440     if (!Matcher::match_rule_supported(Op_UpperCase)) return false;
441     break;
442   case vmIntrinsics::_isWhitespace:
443     if (!Matcher::match_rule_supported(Op_Whitespace)) return false;
444     break;
445   case vmIntrinsics::_maxF:
446     if (!Matcher::match_rule_supported(Op_MaxF)) return false;
447     break;
448   case vmIntrinsics::_minF:
449     if (!Matcher::match_rule_supported(Op_MinF)) return false;
450     break;
451   case vmIntrinsics::_maxD:
452     if (!Matcher::match_rule_supported(Op_MaxD)) return false;
453     break;
454   case vmIntrinsics::_minD:
455     if (!Matcher::match_rule_supported(Op_MinD)) return false;
456     break;
<span class="line-added">457   case vmIntrinsics::_writeback0:</span>
<span class="line-added">458     if (!Matcher::match_rule_supported(Op_CacheWB)) return false;</span>
<span class="line-added">459     break;</span>
<span class="line-added">460   case vmIntrinsics::_writebackPreSync0:</span>
<span class="line-added">461     if (!Matcher::match_rule_supported(Op_CacheWBPreSync)) return false;</span>
<span class="line-added">462     break;</span>
<span class="line-added">463   case vmIntrinsics::_writebackPostSync0:</span>
<span class="line-added">464     if (!Matcher::match_rule_supported(Op_CacheWBPostSync)) return false;</span>
<span class="line-added">465     break;</span>
<span class="line-added">466   case vmIntrinsics::_rint:</span>
<span class="line-added">467   case vmIntrinsics::_ceil:</span>
<span class="line-added">468   case vmIntrinsics::_floor:</span>
<span class="line-added">469     if (!Matcher::match_rule_supported(Op_RoundDoubleMode)) return false;</span>
<span class="line-added">470     break;</span>
471   case vmIntrinsics::_hashCode:
472   case vmIntrinsics::_identityHashCode:
473   case vmIntrinsics::_getClass:
474   case vmIntrinsics::_dsin:
475   case vmIntrinsics::_dcos:
476   case vmIntrinsics::_dtan:
477   case vmIntrinsics::_dabs:
<span class="line-added">478   case vmIntrinsics::_fabs:</span>
<span class="line-added">479   case vmIntrinsics::_iabs:</span>
<span class="line-added">480   case vmIntrinsics::_labs:</span>
481   case vmIntrinsics::_datan2:
482   case vmIntrinsics::_dsqrt:
483   case vmIntrinsics::_dexp:
484   case vmIntrinsics::_dlog:
485   case vmIntrinsics::_dlog10:
486   case vmIntrinsics::_dpow:
487   case vmIntrinsics::_min:
488   case vmIntrinsics::_max:
489   case vmIntrinsics::_arraycopy:
490   case vmIntrinsics::_indexOfL:
491   case vmIntrinsics::_indexOfU:
492   case vmIntrinsics::_indexOfUL:
493   case vmIntrinsics::_indexOfIL:
494   case vmIntrinsics::_indexOfIU:
495   case vmIntrinsics::_indexOfIUL:
496   case vmIntrinsics::_indexOfU_char:
497   case vmIntrinsics::_toBytesStringU:
498   case vmIntrinsics::_getCharsStringU:
499   case vmIntrinsics::_getCharStringU:
500   case vmIntrinsics::_putCharStringU:
</pre>
<hr />
<pre>
565   case vmIntrinsics::_putBooleanOpaque:
566   case vmIntrinsics::_putByteOpaque:
567   case vmIntrinsics::_putShortOpaque:
568   case vmIntrinsics::_putCharOpaque:
569   case vmIntrinsics::_putIntOpaque:
570   case vmIntrinsics::_putLongOpaque:
571   case vmIntrinsics::_putFloatOpaque:
572   case vmIntrinsics::_putDoubleOpaque:
573   case vmIntrinsics::_getShortUnaligned:
574   case vmIntrinsics::_getCharUnaligned:
575   case vmIntrinsics::_getIntUnaligned:
576   case vmIntrinsics::_getLongUnaligned:
577   case vmIntrinsics::_putShortUnaligned:
578   case vmIntrinsics::_putCharUnaligned:
579   case vmIntrinsics::_putIntUnaligned:
580   case vmIntrinsics::_putLongUnaligned:
581   case vmIntrinsics::_loadFence:
582   case vmIntrinsics::_storeFence:
583   case vmIntrinsics::_fullFence:
584   case vmIntrinsics::_currentThread:

585 #ifdef JFR_HAVE_INTRINSICS
586   case vmIntrinsics::_counterTime:
587   case vmIntrinsics::_getClassId:
588   case vmIntrinsics::_getEventWriter:
589 #endif
590   case vmIntrinsics::_currentTimeMillis:
591   case vmIntrinsics::_nanoTime:
592   case vmIntrinsics::_allocateInstance:
593   case vmIntrinsics::_allocateUninitializedArray:
594   case vmIntrinsics::_newArray:
595   case vmIntrinsics::_getLength:
596   case vmIntrinsics::_copyOf:
597   case vmIntrinsics::_copyOfRange:
598   case vmIntrinsics::_clone:
599   case vmIntrinsics::_isAssignableFrom:
600   case vmIntrinsics::_isInstance:
601   case vmIntrinsics::_getModifiers:
602   case vmIntrinsics::_isInterface:
603   case vmIntrinsics::_isArray:
604   case vmIntrinsics::_isPrimitive:
605   case vmIntrinsics::_getSuperclass:
606   case vmIntrinsics::_getClassAccessFlags:
607   case vmIntrinsics::_floatToRawIntBits:
608   case vmIntrinsics::_floatToIntBits:
609   case vmIntrinsics::_intBitsToFloat:
610   case vmIntrinsics::_doubleToRawLongBits:
611   case vmIntrinsics::_doubleToLongBits:
612   case vmIntrinsics::_longBitsToDouble:
613   case vmIntrinsics::_Reference_get:
614   case vmIntrinsics::_Class_cast:
615   case vmIntrinsics::_aescrypt_encryptBlock:
616   case vmIntrinsics::_aescrypt_decryptBlock:
617   case vmIntrinsics::_cipherBlockChaining_encryptAESCrypt:
618   case vmIntrinsics::_cipherBlockChaining_decryptAESCrypt:
<span class="line-added">619   case vmIntrinsics::_electronicCodeBook_encryptAESCrypt:</span>
<span class="line-added">620   case vmIntrinsics::_electronicCodeBook_decryptAESCrypt:</span>
621   case vmIntrinsics::_counterMode_AESCrypt:
622   case vmIntrinsics::_sha_implCompress:
623   case vmIntrinsics::_sha2_implCompress:
624   case vmIntrinsics::_sha5_implCompress:
625   case vmIntrinsics::_digestBase_implCompressMB:
626   case vmIntrinsics::_multiplyToLen:
627   case vmIntrinsics::_squareToLen:
628   case vmIntrinsics::_mulAdd:
629   case vmIntrinsics::_montgomeryMultiply:
630   case vmIntrinsics::_montgomerySquare:
<span class="line-added">631   case vmIntrinsics::_bigIntegerRightShiftWorker:</span>
<span class="line-added">632   case vmIntrinsics::_bigIntegerLeftShiftWorker:</span>
633   case vmIntrinsics::_vectorizedMismatch:
634   case vmIntrinsics::_ghash_processBlocks:
635   case vmIntrinsics::_base64_encodeBlock:
636   case vmIntrinsics::_updateCRC32:
637   case vmIntrinsics::_updateBytesCRC32:
638   case vmIntrinsics::_updateByteBufferCRC32:
639   case vmIntrinsics::_updateBytesCRC32C:
640   case vmIntrinsics::_updateDirectByteBufferCRC32C:
641   case vmIntrinsics::_updateBytesAdler32:
642   case vmIntrinsics::_updateByteBufferAdler32:
643   case vmIntrinsics::_profileBoolean:
644   case vmIntrinsics::_isCompileConstant:
645   case vmIntrinsics::_Preconditions_checkIndex:
646     break;
647   default:
648     return false;
649   }
650   return true;
651 }
652 
</pre>
</td>
</tr>
</table>
<center><a href="c2_globals.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="callGenerator.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>