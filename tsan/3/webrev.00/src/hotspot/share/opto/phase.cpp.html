<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/hotspot/share/opto/phase.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 1997, 2013, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #include &quot;precompiled.hpp&quot;
 26 #include &quot;code/nmethod.hpp&quot;
 27 #include &quot;compiler/compileBroker.hpp&quot;
 28 #include &quot;opto/compile.hpp&quot;
 29 #include &quot;opto/matcher.hpp&quot;
 30 #include &quot;opto/node.hpp&quot;
 31 #include &quot;opto/phase.hpp&quot;
 32 
 33 int Phase::_total_bytes_compiled = 0;
 34 
 35 elapsedTimer Phase::_t_totalCompilation;
 36 elapsedTimer Phase::_t_methodCompilation;
 37 elapsedTimer Phase::_t_stubCompilation;
 38 
 39 // The counters to use for LogCompilation
 40 elapsedTimer Phase::timers[max_phase_timers];
 41 
 42 //------------------------------Phase------------------------------------------
 43 Phase::Phase( PhaseNumber pnum ) : _pnum(pnum), C( pnum == Compiler ? NULL : Compile::current()) {
 44   // Poll for requests from shutdown mechanism to quiesce compiler (4448539, 4448544).
 45   // This is an effective place to poll, since the compiler is full of phases.
 46   // In particular, every inlining site uses a recursively created Parse phase.
 47   CompileBroker::maybe_block();
 48 }
 49 
 50 void Phase::print_timers() {
 51   tty-&gt;print_cr (&quot;    C2 Compile Time:      %7.3f s&quot;, Phase::_t_totalCompilation.seconds());
 52   tty-&gt;print_cr (&quot;       Parse:               %7.3f s&quot;, timers[_t_parser].seconds());
 53 
 54   {
 55     tty-&gt;print_cr (&quot;       Optimize:            %7.3f s&quot;, timers[_t_optimizer].seconds());
 56     if (DoEscapeAnalysis) {
 57       // EA is part of Optimizer.
 58       tty-&gt;print_cr (&quot;         Escape Analysis:     %7.3f s&quot;, timers[_t_escapeAnalysis].seconds());
 59       tty-&gt;print_cr (&quot;           Conn Graph:          %7.3f s&quot;, timers[_t_connectionGraph].seconds());
 60       tty-&gt;print_cr (&quot;           Macro Eliminate:     %7.3f s&quot;, timers[_t_macroEliminate].seconds());
 61     }
 62     tty-&gt;print_cr (&quot;         GVN 1:               %7.3f s&quot;, timers[_t_iterGVN].seconds());
 63 
 64     {
 65        tty-&gt;print_cr (&quot;         Incremental Inline:  %7.3f s&quot;, timers[_t_incrInline].seconds());
 66        tty-&gt;print_cr (&quot;           IdealLoop:           %7.3f s&quot;, timers[_t_incrInline_ideal].seconds());
 67        tty-&gt;print_cr (&quot;           IGVN:                %7.3f s&quot;, timers[_t_incrInline_igvn].seconds());
 68        tty-&gt;print_cr (&quot;           Inline:              %7.3f s&quot;, timers[_t_incrInline_inline].seconds());
 69        tty-&gt;print_cr (&quot;           Prune Useless:       %7.3f s&quot;, timers[_t_incrInline_pru].seconds());
 70 
 71        double other = timers[_t_incrInline].seconds() -
 72         (timers[_t_incrInline_ideal].seconds() +
 73          timers[_t_incrInline_igvn].seconds() +
 74          timers[_t_incrInline_inline].seconds() +
 75          timers[_t_incrInline_pru].seconds());
 76        if (other &gt; 0) {
 77          tty-&gt;print_cr(&quot;           Other:               %7.3f s&quot;, other);
 78        }
 79     }
 80     tty-&gt;print_cr (&quot;         Renumber Live:       %7.3f s&quot;, timers[_t_renumberLive].seconds());
 81     tty-&gt;print_cr (&quot;         IdealLoop:           %7.3f s&quot;, timers[_t_idealLoop].seconds());
 82     tty-&gt;print_cr (&quot;         IdealLoop Verify:    %7.3f s&quot;, timers[_t_idealLoopVerify].seconds());
 83     tty-&gt;print_cr (&quot;         Cond Const Prop:     %7.3f s&quot;, timers[_t_ccp].seconds());
 84     tty-&gt;print_cr (&quot;         GVN 2:               %7.3f s&quot;, timers[_t_iterGVN2].seconds());
 85     tty-&gt;print_cr (&quot;         Macro Expand:        %7.3f s&quot;, timers[_t_macroExpand].seconds());
 86     tty-&gt;print_cr (&quot;         Barrier Expand:      %7.3f s&quot;, timers[_t_barrierExpand].seconds());
 87     tty-&gt;print_cr (&quot;         Graph Reshape:       %7.3f s&quot;, timers[_t_graphReshaping].seconds());
 88 
 89     double other = timers[_t_optimizer].seconds() -
 90       (timers[_t_escapeAnalysis].seconds() +
 91        timers[_t_iterGVN].seconds() +
 92        timers[_t_incrInline].seconds() +
 93        timers[_t_renumberLive].seconds() +
 94        timers[_t_idealLoop].seconds() +
 95        timers[_t_idealLoopVerify].seconds() +
 96        timers[_t_ccp].seconds() +
 97        timers[_t_iterGVN2].seconds() +
 98        timers[_t_macroExpand].seconds() +
 99        timers[_t_barrierExpand].seconds() +
100        timers[_t_graphReshaping].seconds());
101     if (other &gt; 0) {
102       tty-&gt;print_cr(&quot;         Other:               %7.3f s&quot;, other);
103     }
104   }
105 
106   tty-&gt;print_cr (&quot;       Matcher:                  %7.3f s&quot;, timers[_t_matcher].seconds());
107   if (Matcher::supports_generic_vector_operands) {
108     tty-&gt;print_cr (&quot;         Post Selection Cleanup: %7.3f s&quot;, timers[_t_postselect_cleanup].seconds());
109   }
110   tty-&gt;print_cr (&quot;       Scheduler:                %7.3f s&quot;, timers[_t_scheduler].seconds());
111 
112   {
113     tty-&gt;print_cr (&quot;       Regalloc:            %7.3f s&quot;, timers[_t_registerAllocation].seconds());
114     tty-&gt;print_cr (&quot;         Ctor Chaitin:        %7.3f s&quot;, timers[_t_ctorChaitin].seconds());
115     tty-&gt;print_cr (&quot;         Build IFG (virt):    %7.3f s&quot;, timers[_t_buildIFGvirtual].seconds());
116     tty-&gt;print_cr (&quot;         Build IFG (phys):    %7.3f s&quot;, timers[_t_buildIFGphysical].seconds());
117     tty-&gt;print_cr (&quot;         Compute Liveness:    %7.3f s&quot;, timers[_t_computeLive].seconds());
118     tty-&gt;print_cr (&quot;         Regalloc Split:      %7.3f s&quot;, timers[_t_regAllocSplit].seconds());
119     tty-&gt;print_cr (&quot;         Postalloc Copy Rem:  %7.3f s&quot;, timers[_t_postAllocCopyRemoval].seconds());
120     tty-&gt;print_cr (&quot;         Merge multidefs:     %7.3f s&quot;, timers[_t_mergeMultidefs].seconds());
121     tty-&gt;print_cr (&quot;         Fixup Spills:        %7.3f s&quot;, timers[_t_fixupSpills].seconds());
122     tty-&gt;print_cr (&quot;         Compact:             %7.3f s&quot;, timers[_t_chaitinCompact].seconds());
123     tty-&gt;print_cr (&quot;         Coalesce 1:          %7.3f s&quot;, timers[_t_chaitinCoalesce1].seconds());
124     tty-&gt;print_cr (&quot;         Coalesce 2:          %7.3f s&quot;, timers[_t_chaitinCoalesce2].seconds());
125     tty-&gt;print_cr (&quot;         Coalesce 3:          %7.3f s&quot;, timers[_t_chaitinCoalesce3].seconds());
126     tty-&gt;print_cr (&quot;         Cache LRG:           %7.3f s&quot;, timers[_t_chaitinCacheLRG].seconds());
127     tty-&gt;print_cr (&quot;         Simplify:            %7.3f s&quot;, timers[_t_chaitinSimplify].seconds());
128     tty-&gt;print_cr (&quot;         Select:              %7.3f s&quot;, timers[_t_chaitinSelect].seconds());
129 
130     double other = timers[_t_registerAllocation].seconds() -
131       (timers[_t_ctorChaitin].seconds() +
132        timers[_t_buildIFGvirtual].seconds() +
133        timers[_t_buildIFGphysical].seconds() +
134        timers[_t_computeLive].seconds() +
135        timers[_t_regAllocSplit].seconds() +
136        timers[_t_postAllocCopyRemoval].seconds() +
137        timers[_t_mergeMultidefs].seconds() +
138        timers[_t_fixupSpills].seconds() +
139        timers[_t_chaitinCompact].seconds() +
140        timers[_t_chaitinCoalesce1].seconds() +
141        timers[_t_chaitinCoalesce2].seconds() +
142        timers[_t_chaitinCoalesce3].seconds() +
143        timers[_t_chaitinCacheLRG].seconds() +
144        timers[_t_chaitinSimplify].seconds() +
145        timers[_t_chaitinSelect].seconds());
146 
147     if (other &gt; 0) {
148       tty-&gt;print_cr(&quot;         Other:               %7.3f s&quot;, other);
149     }
150   }
151   tty-&gt;print_cr (&quot;       Block Ordering:      %7.3f s&quot;, timers[_t_blockOrdering].seconds());
152   tty-&gt;print_cr (&quot;       Peephole:            %7.3f s&quot;, timers[_t_peephole].seconds());
153   if (Matcher::require_postalloc_expand) {
154     tty-&gt;print_cr (&quot;       Postalloc Expand:    %7.3f s&quot;, timers[_t_postalloc_expand].seconds());
155   }
156   tty-&gt;print_cr (&quot;       Code Emission:         %7.3f s&quot;, timers[_t_output].seconds());
157   tty-&gt;print_cr (&quot;         Insn Scheduling:     %7.3f s&quot;, timers[_t_instrSched].seconds());
158   tty-&gt;print_cr (&quot;         Build OOP maps:      %7.3f s&quot;, timers[_t_buildOopMaps].seconds());
159   tty-&gt;print_cr (&quot;       Code Installation:   %7.3f s&quot;, timers[_t_registerMethod].seconds());
160 
161   if( timers[_t_temporaryTimer1].seconds() &gt; 0 ) {
162     tty-&gt;cr();
163     tty-&gt;print_cr (&quot;       Temp Timer 1:        %7.3f s&quot;, timers[_t_temporaryTimer1].seconds());
164   }
165   if( timers[_t_temporaryTimer2].seconds() &gt; 0 ) {
166     tty-&gt;cr();
167     tty-&gt;print_cr (&quot;       Temp Timer 2:        %7.3f s&quot;, timers[_t_temporaryTimer2].seconds());
168   }
169 
170    double other = Phase::_t_totalCompilation.seconds() -
171       (timers[_t_parser].seconds() +
172        timers[_t_optimizer].seconds() +
173        timers[_t_matcher].seconds() +
174        timers[_t_scheduler].seconds() +
175        timers[_t_registerAllocation].seconds() +
176        timers[_t_blockOrdering].seconds() +
177        timers[_t_peephole].seconds() +
178        timers[_t_postalloc_expand].seconds() +
179        timers[_t_output].seconds() +
180        timers[_t_registerMethod].seconds() +
181        timers[_t_temporaryTimer1].seconds() +
182        timers[_t_temporaryTimer2].seconds());
183     if (other &gt; 0) {
184       tty-&gt;print_cr(&quot;       Other:               %7.3f s&quot;, other);
185     }
186 
187 }
    </pre>
  </body>
</html>