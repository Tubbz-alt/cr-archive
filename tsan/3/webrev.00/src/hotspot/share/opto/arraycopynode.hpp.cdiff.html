<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/opto/arraycopynode.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="arraycopynode.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="block.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/opto/arraycopynode.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 35,12 ***</span>
  
    // What kind of arraycopy variant is this?
    enum {
      None,            // not set yet
      ArrayCopy,       // System.arraycopy()
<span class="line-modified">!     CloneBasic,      // A clone that can be copied by 64 bit chunks</span>
<span class="line-modified">!     CloneOop,        // An oop array clone</span>
      CopyOf,          // Arrays.copyOf()
      CopyOfRange      // Arrays.copyOfRange()
    } _kind;
  
  #ifndef PRODUCT
<span class="line-new-header">--- 35,14 ---</span>
  
    // What kind of arraycopy variant is this?
    enum {
      None,            // not set yet
      ArrayCopy,       // System.arraycopy()
<span class="line-modified">!     CloneInst,       // A clone of instances</span>
<span class="line-modified">!     CloneArray,      // A clone of arrays that don&#39;t require a barrier</span>
<span class="line-added">+                      // - depends on GC - some need to treat oop arrays separately</span>
<span class="line-added">+     CloneOopArray,   // An oop array clone that requires GC barriers</span>
      CopyOf,          // Arrays.copyOf()
      CopyOfRange      // Arrays.copyOfRange()
    } _kind;
  
  #ifndef PRODUCT
</pre>
<hr />
<pre>
<span class="line-old-header">*** 86,11 ***</span>
  
    ArrayCopyNode(Compile* C, bool alloc_tightly_coupled, bool has_negative_length_guard);
  
    intptr_t get_length_if_constant(PhaseGVN *phase) const;
    int get_count(PhaseGVN *phase) const;
<span class="line-modified">!   static const TypePtr* get_address_type(PhaseGVN *phase, Node* n);</span>
  
    Node* try_clone_instance(PhaseGVN *phase, bool can_reshape, int count);
    bool prepare_array_copy(PhaseGVN *phase, bool can_reshape,
                            Node*&amp; adr_src, Node*&amp; base_src, Node*&amp; adr_dest, Node*&amp; base_dest,
                            BasicType&amp; copy_type, const Type*&amp; value_type, bool&amp; disjoint_bases);
<span class="line-new-header">--- 88,11 ---</span>
  
    ArrayCopyNode(Compile* C, bool alloc_tightly_coupled, bool has_negative_length_guard);
  
    intptr_t get_length_if_constant(PhaseGVN *phase) const;
    int get_count(PhaseGVN *phase) const;
<span class="line-modified">!   static const TypePtr* get_address_type(PhaseGVN* phase, const TypePtr* atp, Node* n);</span>
  
    Node* try_clone_instance(PhaseGVN *phase, bool can_reshape, int count);
    bool prepare_array_copy(PhaseGVN *phase, bool can_reshape,
                            Node*&amp; adr_src, Node*&amp; base_src, Node*&amp; adr_dest, Node*&amp; base_dest,
                            BasicType&amp; copy_type, const Type*&amp; value_type, bool&amp; disjoint_bases);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 144,20 ***</span>
  
    void connect_outputs(GraphKit* kit);
  
    bool is_arraycopy()             const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == ArrayCopy; }
    bool is_arraycopy_validated()   const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == ArrayCopy &amp;&amp; _arguments_validated; }
<span class="line-modified">!   bool is_clonebasic()            const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == CloneBasic; }</span>
<span class="line-modified">!   bool is_cloneoop()              const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == CloneOop; }</span>
    bool is_copyof()                const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == CopyOf; }
    bool is_copyof_validated()      const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == CopyOf &amp;&amp; _arguments_validated; }
    bool is_copyofrange()           const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == CopyOfRange; }
    bool is_copyofrange_validated() const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == CopyOfRange &amp;&amp; _arguments_validated; }
  
    void set_arraycopy(bool validated)   { assert(_kind == None, &quot;shouldn&#39;t bet set yet&quot;); _kind = ArrayCopy; _arguments_validated = validated; }
<span class="line-modified">!   void set_clonebasic()                { assert(_kind == None, &quot;shouldn&#39;t bet set yet&quot;); _kind = CloneBasic; }</span>
<span class="line-modified">!   void set_cloneoop()                  { assert(_kind == None, &quot;shouldn&#39;t bet set yet&quot;); _kind = CloneOop; }</span>
    void set_copyof(bool validated)      { assert(_kind == None, &quot;shouldn&#39;t bet set yet&quot;); _kind = CopyOf; _arguments_validated = validated; }
    void set_copyofrange(bool validated) { assert(_kind == None, &quot;shouldn&#39;t bet set yet&quot;); _kind = CopyOfRange; _arguments_validated = validated; }
  
    virtual int Opcode() const;
    virtual uint size_of() const; // Size is bigger
<span class="line-new-header">--- 146,26 ---</span>
  
    void connect_outputs(GraphKit* kit);
  
    bool is_arraycopy()             const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == ArrayCopy; }
    bool is_arraycopy_validated()   const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == ArrayCopy &amp;&amp; _arguments_validated; }
<span class="line-modified">!   bool is_clone_inst()            const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == CloneInst; }</span>
<span class="line-modified">!   // is_clone_array - true for all arrays when using GCs that has no barriers</span>
<span class="line-added">+   bool is_clone_array()           const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == CloneArray; }</span>
<span class="line-added">+   // is_clone_oop_array is used when oop arrays need GC barriers</span>
<span class="line-added">+   bool is_clone_oop_array()       const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == CloneOopArray; }</span>
<span class="line-added">+   // is_clonebasic - is true for any type of clone that doesn&#39;t need a barrier.</span>
<span class="line-added">+   bool is_clonebasic()            const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == CloneInst || _kind == CloneArray; }</span>
    bool is_copyof()                const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == CopyOf; }
    bool is_copyof_validated()      const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == CopyOf &amp;&amp; _arguments_validated; }
    bool is_copyofrange()           const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == CopyOfRange; }
    bool is_copyofrange_validated() const  { assert(_kind != None, &quot;should bet set&quot;); return _kind == CopyOfRange &amp;&amp; _arguments_validated; }
  
    void set_arraycopy(bool validated)   { assert(_kind == None, &quot;shouldn&#39;t bet set yet&quot;); _kind = ArrayCopy; _arguments_validated = validated; }
<span class="line-modified">!   void set_clone_inst()                { assert(_kind == None, &quot;shouldn&#39;t bet set yet&quot;); _kind = CloneInst; }</span>
<span class="line-modified">!   void set_clone_array()               { assert(_kind == None, &quot;shouldn&#39;t bet set yet&quot;); _kind = CloneArray; }</span>
<span class="line-added">+   void set_clone_oop_array()           { assert(_kind == None, &quot;shouldn&#39;t bet set yet&quot;); _kind = CloneOopArray; }</span>
    void set_copyof(bool validated)      { assert(_kind == None, &quot;shouldn&#39;t bet set yet&quot;); _kind = CopyOf; _arguments_validated = validated; }
    void set_copyofrange(bool validated) { assert(_kind == None, &quot;shouldn&#39;t bet set yet&quot;); _kind = CopyOfRange; _arguments_validated = validated; }
  
    virtual int Opcode() const;
    virtual uint size_of() const; // Size is bigger
</pre>
<center><a href="arraycopynode.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="block.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>