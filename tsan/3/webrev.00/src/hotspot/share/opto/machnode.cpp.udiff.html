<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/opto/machnode.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="loopopts.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="machnode.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/opto/machnode.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -22,10 +22,12 @@</span>
   *
   */
  
  #include &quot;precompiled.hpp&quot;
  #include &quot;gc/shared/collectedHeap.hpp&quot;
<span class="udiff-line-added">+ #include &quot;memory/universe.hpp&quot;</span>
<span class="udiff-line-added">+ #include &quot;oops/compressedOops.hpp&quot;</span>
  #include &quot;opto/machnode.hpp&quot;
  #include &quot;opto/regalloc.hpp&quot;
  #include &quot;utilities/vmError.hpp&quot;
  
  //=============================================================================
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -91,11 +93,11 @@</span>
    return 5;
  }
  
  //------------------------------cmp--------------------------------------------
  // Print any per-operand special info
<span class="udiff-line-modified-removed">- uint MachOper::cmp( const MachOper &amp;oper ) const {</span>
<span class="udiff-line-modified-added">+ bool MachOper::cmp( const MachOper &amp;oper ) const {</span>
    ShouldNotCallThis();
    return opcode() == oper.opcode();
  }
  
  //------------------------------hash-------------------------------------------
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -104,11 +106,11 @@</span>
    return _block_num;
  }
  
  //------------------------------cmp--------------------------------------------
  // Print any per-operand special info
<span class="udiff-line-modified-removed">- uint labelOper::cmp( const MachOper &amp;oper ) const {</span>
<span class="udiff-line-modified-added">+ bool labelOper::cmp( const MachOper &amp;oper ) const {</span>
    return (opcode() == oper.opcode()) &amp;&amp; (_label == oper.label());
  }
  
  //------------------------------hash-------------------------------------------
  // Print any per-operand special info
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -116,11 +118,11 @@</span>
    return (uint)_method;
  }
  
  //------------------------------cmp--------------------------------------------
  // Print any per-operand special info
<span class="udiff-line-modified-removed">- uint methodOper::cmp( const MachOper &amp;oper ) const {</span>
<span class="udiff-line-modified-added">+ bool methodOper::cmp( const MachOper &amp;oper ) const {</span>
    return (opcode() == oper.opcode()) &amp;&amp; (_method == oper.method());
  }
  
  
  //=============================================================================
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -165,19 +167,19 @@</span>
      sum += _opnds[i]-&gt;hash();
    return sum+Node::hash();
  }
  
  //-----------------------------cmp---------------------------------------------
<span class="udiff-line-modified-removed">- uint MachNode::cmp( const Node &amp;node ) const {</span>
<span class="udiff-line-modified-added">+ bool MachNode::cmp( const Node &amp;node ) const {</span>
    MachNode&amp; n = *((Node&amp;)node).as_Mach();
    uint no = num_opnds();
<span class="udiff-line-modified-removed">-   if( no != n.num_opnds() ) return 0;</span>
<span class="udiff-line-modified-removed">-   if( rule() != n.rule() ) return 0;</span>
<span class="udiff-line-modified-added">+   if( no != n.num_opnds() ) return false;</span>
<span class="udiff-line-modified-added">+   if( rule() != n.rule() ) return false;</span>
    for( uint i=0; i&lt;no; i++ )    // All operands must match
      if( !_opnds[i]-&gt;cmp( *n._opnds[i] ) )
<span class="udiff-line-modified-removed">-       return 0;                 // mis-matched operands</span>
<span class="udiff-line-modified-removed">-   return 1;                     // match</span>
<span class="udiff-line-modified-added">+       return false;             // mis-matched operands</span>
<span class="udiff-line-modified-added">+   return true;                  // match</span>
  }
  
  // Return an equivalent instruction using memory for cisc_operand position
  MachNode *MachNode::cisc_version(int offset) {
    ShouldNotCallThis();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -344,23 +346,23 @@</span>
      // NULL base, any offset means any pointer whatever
      if (offset == Type::OffsetBot) {
        return TypePtr::BOTTOM;
      }
      // %%% make offset be intptr_t
<span class="udiff-line-modified-removed">-     assert(!Universe::heap()-&gt;is_in_reserved(cast_to_oop(offset)), &quot;must be a raw ptr&quot;);</span>
<span class="udiff-line-modified-added">+     assert(!Universe::heap()-&gt;is_in(cast_to_oop(offset)), &quot;must be a raw ptr&quot;);</span>
      return TypeRawPtr::BOTTOM;
    }
  
    // base of -1 with no particular offset means all of memory
    if (base == NodeSentinel)  return TypePtr::BOTTOM;
  
    const Type* t = base-&gt;bottom_type();
<span class="udiff-line-modified-removed">-   if (t-&gt;isa_narrowoop() &amp;&amp; Universe::narrow_oop_shift() == 0) {</span>
<span class="udiff-line-modified-added">+   if (t-&gt;isa_narrowoop() &amp;&amp; CompressedOops::shift() == 0) {</span>
      // 32-bit unscaled narrow oop can be the base of any address expression
      t = t-&gt;make_ptr();
    }
<span class="udiff-line-modified-removed">-   if (t-&gt;isa_narrowklass() &amp;&amp; Universe::narrow_klass_shift() == 0) {</span>
<span class="udiff-line-modified-added">+   if (t-&gt;isa_narrowklass() &amp;&amp; CompressedKlassPointers::shift() == 0) {</span>
      // 32-bit unscaled narrow oop can be the base of any address expression
      t = t-&gt;make_ptr();
    }
    if (t-&gt;isa_intptr_t() &amp;&amp; offset != 0 &amp;&amp; offset != Type::OffsetBot) {
      // We cannot assert that the offset does not look oop-ish here.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -383,14 +385,14 @@</span>
    return tp-&gt;add_offset(offset);
  }
  
  
  //-----------------------------operand_index---------------------------------
<span class="udiff-line-modified-removed">- int MachNode::operand_index( uint operand ) const {</span>
<span class="udiff-line-modified-removed">-   if( operand &lt; 1 )  return -1;</span>
<span class="udiff-line-modified-added">+ int MachNode::operand_index(uint operand) const {</span>
<span class="udiff-line-modified-added">+   if (operand &lt; 1)  return -1;</span>
    assert(operand &lt; num_opnds(), &quot;oob&quot;);
<span class="udiff-line-modified-removed">-   if( _opnds[operand]-&gt;num_edges() == 0 )  return -1;</span>
<span class="udiff-line-modified-added">+   if (_opnds[operand]-&gt;num_edges() == 0)  return -1;</span>
  
    uint skipped   = oper_input_base(); // Sum of leaves skipped so far
    for (uint opcnt = 1; opcnt &lt; operand; opcnt++) {
      uint num_edges = _opnds[opcnt]-&gt;num_edges(); // leaves for operand
      skipped += num_edges;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -408,10 +410,24 @@</span>
    }
    if (_opnds[opcnt] != oper) return -1;
    return skipped;
  }
  
<span class="udiff-line-added">+ int MachNode::operand_index(Node* def) const {</span>
<span class="udiff-line-added">+   uint skipped = oper_input_base(); // Sum of leaves skipped so far</span>
<span class="udiff-line-added">+   for (uint opcnt = 1; opcnt &lt; num_opnds(); opcnt++) {</span>
<span class="udiff-line-added">+     uint num_edges = _opnds[opcnt]-&gt;num_edges(); // leaves for operand</span>
<span class="udiff-line-added">+     for (uint i = 0; i &lt; num_edges; i++) {</span>
<span class="udiff-line-added">+       if (in(skipped + i) == def) {</span>
<span class="udiff-line-added">+         return opcnt;</span>
<span class="udiff-line-added">+       }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     skipped += num_edges;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+   return -1;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  //------------------------------peephole---------------------------------------
  // Apply peephole rule(s) to this instruction
  MachNode *MachNode::peephole(Block *block, int block_index, PhaseRegAlloc *ra_, int &amp;deleted) {
    return NULL;
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -649,11 +665,11 @@</span>
  }
  
  
  //=============================================================================
  
<span class="udiff-line-modified-removed">- uint MachCallNode::cmp( const Node &amp;n ) const</span>
<span class="udiff-line-modified-added">+ bool MachCallNode::cmp( const Node &amp;n ) const</span>
  { return _tf == ((MachCallNode&amp;)n)._tf; }
  const Type *MachCallNode::bottom_type() const { return tf()-&gt;range(); }
  const Type* MachCallNode::Value(PhaseGVN* phase) const { return tf()-&gt;range(); }
  
  #ifndef PRODUCT
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -705,11 +721,11 @@</span>
    return *Compile::current()-&gt;matcher()-&gt;idealreg2debugmask[in(idx)-&gt;ideal_reg()];
  }
  
  //=============================================================================
  uint MachCallJavaNode::size_of() const { return sizeof(*this); }
<span class="udiff-line-modified-removed">- uint MachCallJavaNode::cmp( const Node &amp;n ) const {</span>
<span class="udiff-line-modified-added">+ bool MachCallJavaNode::cmp( const Node &amp;n ) const {</span>
    MachCallJavaNode &amp;call = (MachCallJavaNode&amp;)n;
    return MachCallNode::cmp(call) &amp;&amp; _method-&gt;equals(call._method) &amp;&amp;
           _override_symbolic_info == call._override_symbolic_info;
  }
  #ifndef PRODUCT
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -743,11 +759,11 @@</span>
    return *debugmask[in(idx)-&gt;ideal_reg()];
  }
  
  //=============================================================================
  uint MachCallStaticJavaNode::size_of() const { return sizeof(*this); }
<span class="udiff-line-modified-removed">- uint MachCallStaticJavaNode::cmp( const Node &amp;n ) const {</span>
<span class="udiff-line-modified-added">+ bool MachCallStaticJavaNode::cmp( const Node &amp;n ) const {</span>
    MachCallStaticJavaNode &amp;call = (MachCallStaticJavaNode&amp;)n;
    return MachCallJavaNode::cmp(call) &amp;&amp; _name == call._name;
  }
  
  //----------------------------uncommon_trap_request----------------------------
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -789,11 +805,11 @@</span>
    MachCallJavaNode::dump_spec(st);
  }
  #endif
  //=============================================================================
  uint MachCallRuntimeNode::size_of() const { return sizeof(*this); }
<span class="udiff-line-modified-removed">- uint MachCallRuntimeNode::cmp( const Node &amp;n ) const {</span>
<span class="udiff-line-modified-added">+ bool MachCallRuntimeNode::cmp( const Node &amp;n ) const {</span>
    MachCallRuntimeNode &amp;call = (MachCallRuntimeNode&amp;)n;
    return MachCallNode::cmp(call) &amp;&amp; !strcmp(_name,call._name);
  }
  #ifndef PRODUCT
  void MachCallRuntimeNode::dump_spec(outputStream *st) const {
</pre>
<center><a href="loopopts.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="machnode.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>