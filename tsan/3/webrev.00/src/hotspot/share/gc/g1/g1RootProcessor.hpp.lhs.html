<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/hotspot/share/gc/g1/g1RootProcessor.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
    <script type="text/javascript" src="../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #ifndef SHARE_GC_G1_G1ROOTPROCESSOR_HPP
 26 #define SHARE_GC_G1_G1ROOTPROCESSOR_HPP
 27 
<a name="1" id="anc1"></a><span class="line-removed"> 28 #include &quot;gc/shared/oopStorageParState.hpp&quot;</span>
 29 #include &quot;gc/shared/strongRootsScope.hpp&quot;
 30 #include &quot;memory/allocation.hpp&quot;
 31 #include &quot;runtime/mutex.hpp&quot;
 32 
 33 class CLDClosure;
 34 class CodeBlobClosure;
 35 class G1CollectedHeap;
 36 class G1EvacuationRootClosures;
 37 class G1GCPhaseTimes;
 38 class G1ParScanThreadState;
 39 class G1RootClosures;
 40 class Monitor;
 41 class OopClosure;
 42 class SubTasksDone;
 43 
 44 // Scoped object to assist in applying oop, CLD and code blob closures to
 45 // root locations. Handles claiming of different root scanning tasks
 46 // and takes care of global state for root scanning via a StrongRootsScope.
 47 // In the parallel case there is a shared G1RootProcessor object where all
 48 // worker thread call the process_roots methods.
 49 class G1RootProcessor : public StackObj {
 50   G1CollectedHeap* _g1h;
 51   SubTasksDone _process_strong_tasks;
 52   StrongRootsScope _srs;
<a name="2" id="anc2"></a><span class="line-removed"> 53   OopStorage::ParState&lt;false, false&gt; _par_state_string;</span>
<span class="line-removed"> 54 </span>
<span class="line-removed"> 55   // Used to implement the Thread work barrier.</span>
<span class="line-removed"> 56   Monitor _lock;</span>
<span class="line-removed"> 57   volatile jint _n_workers_discovered_strong_classes;</span>
 58 
 59   enum G1H_process_roots_tasks {
 60     G1RP_PS_Universe_oops_do,
 61     G1RP_PS_JNIHandles_oops_do,
 62     G1RP_PS_ObjectSynchronizer_oops_do,
 63     G1RP_PS_Management_oops_do,
 64     G1RP_PS_SystemDictionary_oops_do,
 65     G1RP_PS_ClassLoaderDataGraph_oops_do,
 66     G1RP_PS_jvmti_oops_do,
 67     G1RP_PS_CodeCache_oops_do,
<a name="3" id="anc3"></a><span class="line-modified"> 68     G1RP_PS_aot_oops_do,</span>
<span class="line-removed"> 69     G1RP_PS_filter_satb_buffers,</span>
 70     G1RP_PS_refProcessor_oops_do,
 71     // Leave this one last.
 72     G1RP_PS_NumElements
 73   };
 74 
<a name="4" id="anc4"></a><span class="line-removed"> 75   void worker_has_discovered_all_strong_classes();</span>
<span class="line-removed"> 76   void wait_until_all_strong_classes_discovered();</span>
<span class="line-removed"> 77 </span>
 78   void process_java_roots(G1RootClosures* closures,
 79                           G1GCPhaseTimes* phase_times,
<a name="5" id="anc5"></a><span class="line-modified"> 80                           uint worker_i);</span>
 81 
 82   void process_vm_roots(G1RootClosures* closures,
 83                         G1GCPhaseTimes* phase_times,
<a name="6" id="anc6"></a><span class="line-modified"> 84                         uint worker_i);</span>
 85 
 86   void process_code_cache_roots(CodeBlobClosure* code_closure,
 87                                 G1GCPhaseTimes* phase_times,
<a name="7" id="anc7"></a><span class="line-modified"> 88                                 uint worker_i);</span>
 89 
 90 public:
 91   G1RootProcessor(G1CollectedHeap* g1h, uint n_workers);
 92 
 93   // Apply correct closures from pss to the strongly and weakly reachable roots in the system
 94   // in a single pass.
 95   // Record and report timing measurements for sub phases using worker_id.
 96   void evacuate_roots(G1ParScanThreadState* pss, uint worker_id);
 97 
 98   // Apply oops, clds and blobs to all strongly reachable roots in the system
 99   void process_strong_roots(OopClosure* oops,
100                             CLDClosure* clds,
101                             CodeBlobClosure* blobs);
102 
103   // Apply oops, clds and blobs to strongly and weakly reachable roots in the system
104   void process_all_roots(OopClosure* oops,
105                          CLDClosure* clds,
106                          CodeBlobClosure* blobs);
107 
108   // Number of worker threads used by the root processor.
109   uint n_workers() const;
110 };
111 
112 #endif // SHARE_GC_G1_G1ROOTPROCESSOR_HPP
<a name="8" id="anc8"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="8" type="hidden" />
</body>
</html>