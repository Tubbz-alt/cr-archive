<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/gc/g1/g1CodeCacheRemSet.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="g1CodeBlobClosure.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="g1CollectedHeap.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/g1/g1CodeCacheRemSet.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 30,10 ***</span>
<span class="line-new-header">--- 30,11 ---</span>
  #include &quot;gc/g1/heapRegion.hpp&quot;
  #include &quot;memory/heap.hpp&quot;
  #include &quot;memory/iterator.hpp&quot;
  #include &quot;oops/access.inline.hpp&quot;
  #include &quot;oops/oop.inline.hpp&quot;
<span class="line-added">+ #include &quot;runtime/atomic.hpp&quot;</span>
  #include &quot;utilities/hashtable.inline.hpp&quot;
  #include &quot;utilities/stack.inline.hpp&quot;
  
  G1CodeRootSetTable* volatile G1CodeRootSetTable::_purge_list = NULL;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 156,23 ***</span>
  G1CodeRootSet::~G1CodeRootSet() {
    delete _table;
  }
  
  G1CodeRootSetTable* G1CodeRootSet::load_acquire_table() {
<span class="line-modified">!   return OrderAccess::load_acquire(&amp;_table);</span>
  }
  
  void G1CodeRootSet::allocate_small_table() {
    G1CodeRootSetTable* temp = new G1CodeRootSetTable(SmallSize);
  
<span class="line-modified">!   OrderAccess::release_store(&amp;_table, temp);</span>
  }
  
  void G1CodeRootSetTable::purge_list_append(G1CodeRootSetTable* table) {
    for (;;) {
      table-&gt;_purge_next = _purge_list;
<span class="line-modified">!     G1CodeRootSetTable* old = Atomic::cmpxchg(table, &amp;_purge_list, table-&gt;_purge_next);</span>
      if (old == table-&gt;_purge_next) {
        break;
      }
    }
  }
<span class="line-new-header">--- 157,23 ---</span>
  G1CodeRootSet::~G1CodeRootSet() {
    delete _table;
  }
  
  G1CodeRootSetTable* G1CodeRootSet::load_acquire_table() {
<span class="line-modified">!   return Atomic::load_acquire(&amp;_table);</span>
  }
  
  void G1CodeRootSet::allocate_small_table() {
    G1CodeRootSetTable* temp = new G1CodeRootSetTable(SmallSize);
  
<span class="line-modified">!   Atomic::release_store(&amp;_table, temp);</span>
  }
  
  void G1CodeRootSetTable::purge_list_append(G1CodeRootSetTable* table) {
    for (;;) {
      table-&gt;_purge_next = _purge_list;
<span class="line-modified">!     G1CodeRootSetTable* old = Atomic::cmpxchg(&amp;_purge_list, table-&gt;_purge_next, table);</span>
      if (old == table-&gt;_purge_next) {
        break;
      }
    }
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 192,11 ***</span>
  
    _table-&gt;copy_to(temp);
  
    G1CodeRootSetTable::purge_list_append(_table);
  
<span class="line-modified">!   OrderAccess::release_store(&amp;_table, temp);</span>
  }
  
  void G1CodeRootSet::purge() {
    G1CodeRootSetTable::purge();
  }
<span class="line-new-header">--- 193,11 ---</span>
  
    _table-&gt;copy_to(temp);
  
    G1CodeRootSetTable::purge_list_append(_table);
  
<span class="line-modified">!   Atomic::release_store(&amp;_table, temp);</span>
  }
  
  void G1CodeRootSet::purge() {
    G1CodeRootSetTable::purge();
  }
</pre>
<center><a href="g1CodeBlobClosure.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="g1CollectedHeap.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>