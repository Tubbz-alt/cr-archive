<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/hotspot/share/gc/g1/g1RootProcessor.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #ifndef SHARE_GC_G1_G1ROOTPROCESSOR_HPP
 26 #define SHARE_GC_G1_G1ROOTPROCESSOR_HPP
 27 
 28 #include &quot;gc/shared/strongRootsScope.hpp&quot;
 29 #include &quot;memory/allocation.hpp&quot;
 30 #include &quot;runtime/mutex.hpp&quot;
 31 
 32 class CLDClosure;
 33 class CodeBlobClosure;
 34 class G1CollectedHeap;
 35 class G1EvacuationRootClosures;
 36 class G1GCPhaseTimes;
 37 class G1ParScanThreadState;
 38 class G1RootClosures;
 39 class Monitor;
 40 class OopClosure;
 41 class SubTasksDone;
 42 
 43 // Scoped object to assist in applying oop, CLD and code blob closures to
 44 // root locations. Handles claiming of different root scanning tasks
 45 // and takes care of global state for root scanning via a StrongRootsScope.
 46 // In the parallel case there is a shared G1RootProcessor object where all
 47 // worker thread call the process_roots methods.
 48 class G1RootProcessor : public StackObj {
 49   G1CollectedHeap* _g1h;
 50   SubTasksDone _process_strong_tasks;
 51   StrongRootsScope _srs;
 52 
 53   enum G1H_process_roots_tasks {
 54     G1RP_PS_Universe_oops_do,
 55     G1RP_PS_JNIHandles_oops_do,
 56     G1RP_PS_ObjectSynchronizer_oops_do,
 57     G1RP_PS_Management_oops_do,
 58     G1RP_PS_SystemDictionary_oops_do,
 59     G1RP_PS_ClassLoaderDataGraph_oops_do,
 60     G1RP_PS_jvmti_oops_do,
 61     G1RP_PS_CodeCache_oops_do,
 62     AOT_ONLY(G1RP_PS_aot_oops_do COMMA)
 63     G1RP_PS_refProcessor_oops_do,
 64     // Leave this one last.
 65     G1RP_PS_NumElements
 66   };
 67 
 68   void process_java_roots(G1RootClosures* closures,
 69                           G1GCPhaseTimes* phase_times,
 70                           uint worker_id);
 71 
 72   void process_vm_roots(G1RootClosures* closures,
 73                         G1GCPhaseTimes* phase_times,
 74                         uint worker_id);
 75 
 76   void process_code_cache_roots(CodeBlobClosure* code_closure,
 77                                 G1GCPhaseTimes* phase_times,
 78                                 uint worker_id);
 79 
 80 public:
 81   G1RootProcessor(G1CollectedHeap* g1h, uint n_workers);
 82 
 83   // Apply correct closures from pss to the strongly and weakly reachable roots in the system
 84   // in a single pass.
 85   // Record and report timing measurements for sub phases using worker_id.
 86   void evacuate_roots(G1ParScanThreadState* pss, uint worker_id);
 87 
 88   // Apply oops, clds and blobs to all strongly reachable roots in the system
 89   void process_strong_roots(OopClosure* oops,
 90                             CLDClosure* clds,
 91                             CodeBlobClosure* blobs);
 92 
 93   // Apply oops, clds and blobs to strongly and weakly reachable roots in the system
 94   void process_all_roots(OopClosure* oops,
 95                          CLDClosure* clds,
 96                          CodeBlobClosure* blobs);
 97 
 98   // Number of worker threads used by the root processor.
 99   uint n_workers() const;
100 };
101 
102 #endif // SHARE_GC_G1_G1ROOTPROCESSOR_HPP
    </pre>
  </body>
</html>