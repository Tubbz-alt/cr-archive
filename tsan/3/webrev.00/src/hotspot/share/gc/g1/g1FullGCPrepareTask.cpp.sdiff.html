<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/g1/g1FullGCPrepareTask.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="g1FullGCOopClosures.inline.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="g1FullGCReferenceProcessorExecutor.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/g1/g1FullGCPrepareTask.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 97     _g1h(G1CollectedHeap::heap()),
 98     _bitmap(bitmap),
 99     _cp(cp),
100     _humongous_regions_removed(0) { }
101 
102 void G1FullGCPrepareTask::G1CalculatePointersClosure::free_humongous_region(HeapRegion* hr) {
103   FreeRegionList dummy_free_list(&quot;Dummy Free List for G1MarkSweep&quot;);
104 
105   hr-&gt;set_containing_set(NULL);
106   _humongous_regions_removed++;
107 
108   _g1h-&gt;free_humongous_region(hr, &amp;dummy_free_list);
109   prepare_for_compaction(hr);
110   dummy_free_list.remove_all();
111 }
112 
113 void G1FullGCPrepareTask::G1CalculatePointersClosure::reset_region_metadata(HeapRegion* hr) {
114   hr-&gt;rem_set()-&gt;clear();
115   hr-&gt;clear_cardtable();
116 
<span class="line-modified">117   if (_g1h-&gt;g1_hot_card_cache()-&gt;use_cache()) {</span>
<span class="line-modified">118     _g1h-&gt;g1_hot_card_cache()-&gt;reset_card_counts(hr);</span>

119   }
120 }
121 
122 G1FullGCPrepareTask::G1PrepareCompactLiveClosure::G1PrepareCompactLiveClosure(G1FullGCCompactionPoint* cp) :
123     _cp(cp) { }
124 
125 size_t G1FullGCPrepareTask::G1PrepareCompactLiveClosure::apply(oop object) {
126   size_t size = object-&gt;size();
127   _cp-&gt;forward(object, size);
128   return size;
129 }
130 
131 size_t G1FullGCPrepareTask::G1RePrepareClosure::apply(oop obj) {
132   // We only re-prepare objects forwarded within the current region, so
133   // skip objects that are already forwarded to another region.
134   oop forwarded_to = obj-&gt;forwardee();
135   if (forwarded_to != NULL &amp;&amp; !_current-&gt;is_in(forwarded_to)) {
136     return obj-&gt;size();
137   }
138 
</pre>
</td>
<td>
<hr />
<pre>
 97     _g1h(G1CollectedHeap::heap()),
 98     _bitmap(bitmap),
 99     _cp(cp),
100     _humongous_regions_removed(0) { }
101 
102 void G1FullGCPrepareTask::G1CalculatePointersClosure::free_humongous_region(HeapRegion* hr) {
103   FreeRegionList dummy_free_list(&quot;Dummy Free List for G1MarkSweep&quot;);
104 
105   hr-&gt;set_containing_set(NULL);
106   _humongous_regions_removed++;
107 
108   _g1h-&gt;free_humongous_region(hr, &amp;dummy_free_list);
109   prepare_for_compaction(hr);
110   dummy_free_list.remove_all();
111 }
112 
113 void G1FullGCPrepareTask::G1CalculatePointersClosure::reset_region_metadata(HeapRegion* hr) {
114   hr-&gt;rem_set()-&gt;clear();
115   hr-&gt;clear_cardtable();
116 
<span class="line-modified">117   G1HotCardCache* hcc = _g1h-&gt;hot_card_cache();</span>
<span class="line-modified">118   if (hcc-&gt;use_cache()) {</span>
<span class="line-added">119     hcc-&gt;reset_card_counts(hr);</span>
120   }
121 }
122 
123 G1FullGCPrepareTask::G1PrepareCompactLiveClosure::G1PrepareCompactLiveClosure(G1FullGCCompactionPoint* cp) :
124     _cp(cp) { }
125 
126 size_t G1FullGCPrepareTask::G1PrepareCompactLiveClosure::apply(oop object) {
127   size_t size = object-&gt;size();
128   _cp-&gt;forward(object, size);
129   return size;
130 }
131 
132 size_t G1FullGCPrepareTask::G1RePrepareClosure::apply(oop obj) {
133   // We only re-prepare objects forwarded within the current region, so
134   // skip objects that are already forwarded to another region.
135   oop forwarded_to = obj-&gt;forwardee();
136   if (forwarded_to != NULL &amp;&amp; !_current-&gt;is_in(forwarded_to)) {
137     return obj-&gt;size();
138   }
139 
</pre>
</td>
</tr>
</table>
<center><a href="g1FullGCOopClosures.inline.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="g1FullGCReferenceProcessorExecutor.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>