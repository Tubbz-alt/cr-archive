<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/gc/g1/g1FullCollector.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="g1FreeIdSet.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="g1FullGCAdjustTask.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/g1/g1FullCollector.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2017, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -23,11 +23,10 @@</span>
   */
  
  #include &quot;precompiled.hpp&quot;
  #include &quot;code/codeCache.hpp&quot;
  #include &quot;gc/g1/g1CollectedHeap.hpp&quot;
<span class="udiff-line-removed">- #include &quot;gc/g1/g1CollectorPolicy.hpp&quot;</span>
  #include &quot;gc/g1/g1FullCollector.hpp&quot;
  #include &quot;gc/g1/g1FullGCAdjustTask.hpp&quot;
  #include &quot;gc/g1/g1FullGCCompactTask.hpp&quot;
  #include &quot;gc/g1/g1FullGCMarker.inline.hpp&quot;
  #include &quot;gc/g1/g1FullGCMarkTask.hpp&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -38,10 +37,11 @@</span>
  #include &quot;gc/g1/g1Policy.hpp&quot;
  #include &quot;gc/g1/g1StringDedup.hpp&quot;
  #include &quot;gc/shared/gcTraceTime.inline.hpp&quot;
  #include &quot;gc/shared/preservedMarks.hpp&quot;
  #include &quot;gc/shared/referenceProcessor.hpp&quot;
<span class="udiff-line-added">+ #include &quot;gc/shared/verifyOption.hpp&quot;</span>
  #include &quot;gc/shared/weakProcessor.inline.hpp&quot;
  #include &quot;gc/shared/workerPolicy.hpp&quot;
  #include &quot;logging/log.hpp&quot;
  #include &quot;runtime/biasedLocking.hpp&quot;
  #include &quot;runtime/handles.inline.hpp&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -181,11 +181,10 @@</span>
    // When the pointers have been adjusted and moved, we can
    // update the derived pointer table.
    update_derived_pointers();
  
    BiasedLocking::restore_marks();
<span class="udiff-line-removed">-   JvmtiExport::gc_epilogue();</span>
  
    _heap-&gt;prepare_heap_for_mutators();
  
    _heap-&gt;policy()-&gt;record_full_collection_end();
    _heap-&gt;gc_epilogue(true);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -197,17 +196,21 @@</span>
  
  void G1FullCollector::phase1_mark_live_objects() {
    // Recursively traverse all live objects and mark them.
    GCTraceTime(Info, gc, phases) info(&quot;Phase 1: Mark live objects&quot;, scope()-&gt;timer());
  
<span class="udiff-line-modified-removed">-   // Do the actual marking.</span>
<span class="udiff-line-modified-removed">-   G1FullGCMarkTask marking_task(this);</span>
<span class="udiff-line-modified-removed">-   run_task(&amp;marking_task);</span>
<span class="udiff-line-modified-added">+   {</span>
<span class="udiff-line-modified-added">+     // Do the actual marking.</span>
<span class="udiff-line-modified-added">+     G1FullGCMarkTask marking_task(this);</span>
<span class="udiff-line-added">+     run_task(&amp;marking_task);</span>
<span class="udiff-line-added">+   }</span>
  
<span class="udiff-line-modified-removed">-   // Process references discovered during marking.</span>
<span class="udiff-line-modified-removed">-   G1FullGCReferenceProcessingExecutor reference_processing(this);</span>
<span class="udiff-line-modified-removed">-   reference_processing.execute(scope()-&gt;timer(), scope()-&gt;tracer());</span>
<span class="udiff-line-modified-added">+   {</span>
<span class="udiff-line-modified-added">+     // Process references discovered during marking.</span>
<span class="udiff-line-modified-added">+     G1FullGCReferenceProcessingExecutor reference_processing(this);</span>
<span class="udiff-line-added">+     reference_processing.execute(scope()-&gt;timer(), scope()-&gt;tracer());</span>
<span class="udiff-line-added">+   }</span>
  
    // Weak oops cleanup.
    {
      GCTraceTime(Debug, gc, phases) debug(&quot;Phase 1: Weak Processing&quot;, scope()-&gt;timer());
      WeakProcessor::weak_oops_do(_heap-&gt;workers(), &amp;_is_alive, &amp;do_nothing_cl, 1);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -258,12 +261,11 @@</span>
      task.serial_compaction();
    }
  }
  
  void G1FullCollector::restore_marks() {
<span class="udiff-line-modified-removed">-   SharedRestorePreservedMarksTaskExecutor task_executor(_heap-&gt;workers());</span>
<span class="udiff-line-removed">-   _preserved_marks_set.restore(&amp;task_executor);</span>
<span class="udiff-line-modified-added">+   _preserved_marks_set.restore(_heap-&gt;workers());</span>
    _preserved_marks_set.reclaim();
  }
  
  void G1FullCollector::run_task(AbstractGangTask* task) {
    _heap-&gt;workers()-&gt;run_task(task, _num_workers);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -281,15 +283,15 @@</span>
  #endif
    _heap-&gt;prepare_for_verify();
    // Note: we can verify only the heap here. When an object is
    // marked, the previous value of the mark word (including
    // identity hash values, ages, etc) is preserved, and the mark
<span class="udiff-line-modified-removed">-   // word is set to markOop::marked_value - effectively removing</span>
<span class="udiff-line-modified-added">+   // word is set to markWord::marked_value - effectively removing</span>
    // any hash values from the mark word. These hash values are
    // used when verifying the dictionaries and so removing them
    // from the mark word can make verification of the dictionaries
    // fail. At the end of the GC, the original mark word values
    // (including hash values) are restored to the appropriate
    // objects.
<span class="udiff-line-modified-removed">-   GCTraceTime(Info, gc, verify)(&quot;Verifying During GC (full)&quot;);</span>
<span class="udiff-line-modified-added">+   GCTraceTime(Info, gc, verify) tm(&quot;Verifying During GC (full)&quot;);</span>
    _heap-&gt;verify(VerifyOption_G1UseFullMarking);
  }
</pre>
<center><a href="g1FreeIdSet.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="g1FullGCAdjustTask.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>