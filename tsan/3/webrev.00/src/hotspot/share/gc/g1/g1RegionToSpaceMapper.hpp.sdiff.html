<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/g1/g1RegionToSpaceMapper.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="g1RegionToSpaceMapper.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="g1RemSet.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/g1/g1RegionToSpaceMapper.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 36   // Fired after commit of the memory, i.e. the memory this listener is registered
 37   // for can be accessed.
 38   // Zero_filled indicates that the memory can be considered as filled with zero bytes
 39   // when called.
 40   virtual void on_commit(uint start_idx, size_t num_regions, bool zero_filled) = 0;
 41 };
 42 
 43 // Maps region based commit/uncommit requests to the underlying page sized virtual
 44 // space.
 45 class G1RegionToSpaceMapper : public CHeapObj&lt;mtGC&gt; {
 46  private:
 47   G1MappingChangedListener* _listener;
 48  protected:
 49   // Backing storage.
 50   G1PageBasedVirtualSpace _storage;
 51 
 52   size_t _region_granularity;
 53   // Mapping management
 54   CHeapBitMap _commit_map;
 55 


 56   G1RegionToSpaceMapper(ReservedSpace rs, size_t used_size, size_t page_size, size_t region_granularity, size_t commit_factor, MemoryType type);
 57 
 58   void fire_on_commit(uint start_idx, size_t num_regions, bool zero_filled);
 59  public:
 60   MemRegion reserved() { return _storage.reserved(); }
 61 
 62   size_t reserved_size() { return _storage.reserved_size(); }
 63   size_t committed_size() { return _storage.committed_size(); }
 64 
 65   void set_mapping_changed_listener(G1MappingChangedListener* listener) { _listener = listener; }
 66 
 67   virtual ~G1RegionToSpaceMapper() {}
 68 
 69   bool is_committed(uintptr_t idx) const {
 70     return _commit_map.at(idx);
 71   }
 72 
 73   void commit_and_set_special();
 74   virtual void commit_regions(uint start_idx, size_t num_regions = 1, WorkGang* pretouch_workers = NULL) = 0;
 75   virtual void uncommit_regions(uint start_idx, size_t num_regions = 1) = 0;
</pre>
<hr />
<pre>
 84   // table entry corresponds to in the heap.
 85   static G1RegionToSpaceMapper* create_mapper(ReservedSpace rs,
 86                                               size_t actual_size,
 87                                               size_t page_size,
 88                                               size_t region_granularity,
 89                                               size_t byte_translation_factor,
 90                                               MemoryType type);
 91 
 92   static G1RegionToSpaceMapper* create_heap_mapper(ReservedSpace rs,
 93                                                    size_t actual_size,
 94                                                    size_t page_size,
 95                                                    size_t region_granularity,
 96                                                    size_t byte_translation_factor,
 97                                                    MemoryType type);
 98 };
 99 
100 // G1RegionToSpaceMapper implementation where
101 // part of space is mapped to dram and part to nv-dimm
102 class G1RegionToHeteroSpaceMapper : public G1RegionToSpaceMapper {
103 private:
<span class="line-removed">104   size_t _pages_per_region;</span>
105   ReservedSpace _rs;
106   G1RegionToSpaceMapper* _dram_mapper;
107   uint _num_committed_dram;
108   uint _num_committed_nvdimm;
<span class="line-removed">109   uint _start_index_of_nvdimm;</span>
110   uint _start_index_of_dram;
111   size_t _page_size;
112   size_t _commit_factor;
113   MemoryType _type;
114 
115 public:
116   G1RegionToHeteroSpaceMapper(ReservedSpace rs, size_t used_size, size_t page_size, size_t region_granularity, size_t commit_factor, MemoryType type);
117   bool initialize();
118   uint num_committed_dram() const;
119   uint num_committed_nvdimm() const;
120 
121   virtual void commit_regions(uint start_idx, size_t num_regions = 1, WorkGang* pretouch_workers = NULL);
122   virtual void uncommit_regions(uint start_idx, size_t num_regions = 1);
123 };
124 #endif // SHARE_GC_G1_G1REGIONTOSPACEMAPPER_HPP
</pre>
</td>
<td>
<hr />
<pre>
 36   // Fired after commit of the memory, i.e. the memory this listener is registered
 37   // for can be accessed.
 38   // Zero_filled indicates that the memory can be considered as filled with zero bytes
 39   // when called.
 40   virtual void on_commit(uint start_idx, size_t num_regions, bool zero_filled) = 0;
 41 };
 42 
 43 // Maps region based commit/uncommit requests to the underlying page sized virtual
 44 // space.
 45 class G1RegionToSpaceMapper : public CHeapObj&lt;mtGC&gt; {
 46  private:
 47   G1MappingChangedListener* _listener;
 48  protected:
 49   // Backing storage.
 50   G1PageBasedVirtualSpace _storage;
 51 
 52   size_t _region_granularity;
 53   // Mapping management
 54   CHeapBitMap _commit_map;
 55 
<span class="line-added"> 56   MemoryType _memory_type;</span>
<span class="line-added"> 57 </span>
 58   G1RegionToSpaceMapper(ReservedSpace rs, size_t used_size, size_t page_size, size_t region_granularity, size_t commit_factor, MemoryType type);
 59 
 60   void fire_on_commit(uint start_idx, size_t num_regions, bool zero_filled);
 61  public:
 62   MemRegion reserved() { return _storage.reserved(); }
 63 
 64   size_t reserved_size() { return _storage.reserved_size(); }
 65   size_t committed_size() { return _storage.committed_size(); }
 66 
 67   void set_mapping_changed_listener(G1MappingChangedListener* listener) { _listener = listener; }
 68 
 69   virtual ~G1RegionToSpaceMapper() {}
 70 
 71   bool is_committed(uintptr_t idx) const {
 72     return _commit_map.at(idx);
 73   }
 74 
 75   void commit_and_set_special();
 76   virtual void commit_regions(uint start_idx, size_t num_regions = 1, WorkGang* pretouch_workers = NULL) = 0;
 77   virtual void uncommit_regions(uint start_idx, size_t num_regions = 1) = 0;
</pre>
<hr />
<pre>
 86   // table entry corresponds to in the heap.
 87   static G1RegionToSpaceMapper* create_mapper(ReservedSpace rs,
 88                                               size_t actual_size,
 89                                               size_t page_size,
 90                                               size_t region_granularity,
 91                                               size_t byte_translation_factor,
 92                                               MemoryType type);
 93 
 94   static G1RegionToSpaceMapper* create_heap_mapper(ReservedSpace rs,
 95                                                    size_t actual_size,
 96                                                    size_t page_size,
 97                                                    size_t region_granularity,
 98                                                    size_t byte_translation_factor,
 99                                                    MemoryType type);
100 };
101 
102 // G1RegionToSpaceMapper implementation where
103 // part of space is mapped to dram and part to nv-dimm
104 class G1RegionToHeteroSpaceMapper : public G1RegionToSpaceMapper {
105 private:

106   ReservedSpace _rs;
107   G1RegionToSpaceMapper* _dram_mapper;
108   uint _num_committed_dram;
109   uint _num_committed_nvdimm;

110   uint _start_index_of_dram;
111   size_t _page_size;
112   size_t _commit_factor;
113   MemoryType _type;
114 
115 public:
116   G1RegionToHeteroSpaceMapper(ReservedSpace rs, size_t used_size, size_t page_size, size_t region_granularity, size_t commit_factor, MemoryType type);
117   bool initialize();
118   uint num_committed_dram() const;
119   uint num_committed_nvdimm() const;
120 
121   virtual void commit_regions(uint start_idx, size_t num_regions = 1, WorkGang* pretouch_workers = NULL);
122   virtual void uncommit_regions(uint start_idx, size_t num_regions = 1);
123 };
124 #endif // SHARE_GC_G1_G1REGIONTOSPACEMAPPER_HPP
</pre>
</td>
</tr>
</table>
<center><a href="g1RegionToSpaceMapper.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="g1RemSet.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>