<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/g1/g1RootProcessor.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="g1RootProcessor.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="g1SATBMarkQueueSet.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/g1/g1RootProcessor.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #ifndef SHARE_GC_G1_G1ROOTPROCESSOR_HPP
 26 #define SHARE_GC_G1_G1ROOTPROCESSOR_HPP
 27 
<span class="line-removed"> 28 #include &quot;gc/shared/oopStorageParState.hpp&quot;</span>
 29 #include &quot;gc/shared/strongRootsScope.hpp&quot;
 30 #include &quot;memory/allocation.hpp&quot;
 31 #include &quot;runtime/mutex.hpp&quot;
 32 
 33 class CLDClosure;
 34 class CodeBlobClosure;
 35 class G1CollectedHeap;
 36 class G1EvacuationRootClosures;
 37 class G1GCPhaseTimes;
 38 class G1ParScanThreadState;
 39 class G1RootClosures;
 40 class Monitor;
 41 class OopClosure;
 42 class SubTasksDone;
 43 
 44 // Scoped object to assist in applying oop, CLD and code blob closures to
 45 // root locations. Handles claiming of different root scanning tasks
 46 // and takes care of global state for root scanning via a StrongRootsScope.
 47 // In the parallel case there is a shared G1RootProcessor object where all
 48 // worker thread call the process_roots methods.
 49 class G1RootProcessor : public StackObj {
 50   G1CollectedHeap* _g1h;
 51   SubTasksDone _process_strong_tasks;
 52   StrongRootsScope _srs;
<span class="line-removed"> 53   OopStorage::ParState&lt;false, false&gt; _par_state_string;</span>
<span class="line-removed"> 54 </span>
<span class="line-removed"> 55   // Used to implement the Thread work barrier.</span>
<span class="line-removed"> 56   Monitor _lock;</span>
<span class="line-removed"> 57   volatile jint _n_workers_discovered_strong_classes;</span>
 58 
 59   enum G1H_process_roots_tasks {
 60     G1RP_PS_Universe_oops_do,
 61     G1RP_PS_JNIHandles_oops_do,
 62     G1RP_PS_ObjectSynchronizer_oops_do,
 63     G1RP_PS_Management_oops_do,
 64     G1RP_PS_SystemDictionary_oops_do,
 65     G1RP_PS_ClassLoaderDataGraph_oops_do,
 66     G1RP_PS_jvmti_oops_do,
 67     G1RP_PS_CodeCache_oops_do,
<span class="line-modified"> 68     G1RP_PS_aot_oops_do,</span>
<span class="line-removed"> 69     G1RP_PS_filter_satb_buffers,</span>
 70     G1RP_PS_refProcessor_oops_do,
 71     // Leave this one last.
 72     G1RP_PS_NumElements
 73   };
 74 
<span class="line-removed"> 75   void worker_has_discovered_all_strong_classes();</span>
<span class="line-removed"> 76   void wait_until_all_strong_classes_discovered();</span>
<span class="line-removed"> 77 </span>
 78   void process_java_roots(G1RootClosures* closures,
 79                           G1GCPhaseTimes* phase_times,
<span class="line-modified"> 80                           uint worker_i);</span>
 81 
 82   void process_vm_roots(G1RootClosures* closures,
 83                         G1GCPhaseTimes* phase_times,
<span class="line-modified"> 84                         uint worker_i);</span>
 85 
 86   void process_code_cache_roots(CodeBlobClosure* code_closure,
 87                                 G1GCPhaseTimes* phase_times,
<span class="line-modified"> 88                                 uint worker_i);</span>
 89 
 90 public:
 91   G1RootProcessor(G1CollectedHeap* g1h, uint n_workers);
 92 
 93   // Apply correct closures from pss to the strongly and weakly reachable roots in the system
 94   // in a single pass.
 95   // Record and report timing measurements for sub phases using worker_id.
 96   void evacuate_roots(G1ParScanThreadState* pss, uint worker_id);
 97 
 98   // Apply oops, clds and blobs to all strongly reachable roots in the system
 99   void process_strong_roots(OopClosure* oops,
100                             CLDClosure* clds,
101                             CodeBlobClosure* blobs);
102 
103   // Apply oops, clds and blobs to strongly and weakly reachable roots in the system
104   void process_all_roots(OopClosure* oops,
105                          CLDClosure* clds,
106                          CodeBlobClosure* blobs);
107 
108   // Number of worker threads used by the root processor.
</pre>
</td>
<td>
<hr />
<pre>
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #ifndef SHARE_GC_G1_G1ROOTPROCESSOR_HPP
 26 #define SHARE_GC_G1_G1ROOTPROCESSOR_HPP
 27 

 28 #include &quot;gc/shared/strongRootsScope.hpp&quot;
 29 #include &quot;memory/allocation.hpp&quot;
 30 #include &quot;runtime/mutex.hpp&quot;
 31 
 32 class CLDClosure;
 33 class CodeBlobClosure;
 34 class G1CollectedHeap;
 35 class G1EvacuationRootClosures;
 36 class G1GCPhaseTimes;
 37 class G1ParScanThreadState;
 38 class G1RootClosures;
 39 class Monitor;
 40 class OopClosure;
 41 class SubTasksDone;
 42 
 43 // Scoped object to assist in applying oop, CLD and code blob closures to
 44 // root locations. Handles claiming of different root scanning tasks
 45 // and takes care of global state for root scanning via a StrongRootsScope.
 46 // In the parallel case there is a shared G1RootProcessor object where all
 47 // worker thread call the process_roots methods.
 48 class G1RootProcessor : public StackObj {
 49   G1CollectedHeap* _g1h;
 50   SubTasksDone _process_strong_tasks;
 51   StrongRootsScope _srs;





 52 
 53   enum G1H_process_roots_tasks {
 54     G1RP_PS_Universe_oops_do,
 55     G1RP_PS_JNIHandles_oops_do,
 56     G1RP_PS_ObjectSynchronizer_oops_do,
 57     G1RP_PS_Management_oops_do,
 58     G1RP_PS_SystemDictionary_oops_do,
 59     G1RP_PS_ClassLoaderDataGraph_oops_do,
 60     G1RP_PS_jvmti_oops_do,
 61     G1RP_PS_CodeCache_oops_do,
<span class="line-modified"> 62     AOT_ONLY(G1RP_PS_aot_oops_do COMMA)</span>

 63     G1RP_PS_refProcessor_oops_do,
 64     // Leave this one last.
 65     G1RP_PS_NumElements
 66   };
 67 



 68   void process_java_roots(G1RootClosures* closures,
 69                           G1GCPhaseTimes* phase_times,
<span class="line-modified"> 70                           uint worker_id);</span>
 71 
 72   void process_vm_roots(G1RootClosures* closures,
 73                         G1GCPhaseTimes* phase_times,
<span class="line-modified"> 74                         uint worker_id);</span>
 75 
 76   void process_code_cache_roots(CodeBlobClosure* code_closure,
 77                                 G1GCPhaseTimes* phase_times,
<span class="line-modified"> 78                                 uint worker_id);</span>
 79 
 80 public:
 81   G1RootProcessor(G1CollectedHeap* g1h, uint n_workers);
 82 
 83   // Apply correct closures from pss to the strongly and weakly reachable roots in the system
 84   // in a single pass.
 85   // Record and report timing measurements for sub phases using worker_id.
 86   void evacuate_roots(G1ParScanThreadState* pss, uint worker_id);
 87 
 88   // Apply oops, clds and blobs to all strongly reachable roots in the system
 89   void process_strong_roots(OopClosure* oops,
 90                             CLDClosure* clds,
 91                             CodeBlobClosure* blobs);
 92 
 93   // Apply oops, clds and blobs to strongly and weakly reachable roots in the system
 94   void process_all_roots(OopClosure* oops,
 95                          CLDClosure* clds,
 96                          CodeBlobClosure* blobs);
 97 
 98   // Number of worker threads used by the root processor.
</pre>
</td>
</tr>
</table>
<center><a href="g1RootProcessor.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="g1SATBMarkQueueSet.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>