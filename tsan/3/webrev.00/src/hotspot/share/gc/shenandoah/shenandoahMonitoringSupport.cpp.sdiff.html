<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/shenandoah/shenandoahMonitoringSupport.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahMetrics.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahMonitoringSupport.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/shenandoahMonitoringSupport.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2018, Red Hat, Inc. All rights reserved.</span>

  3  *
  4  * This code is free software; you can redistribute it and/or modify it
  5  * under the terms of the GNU General Public License version 2 only, as
  6  * published by the Free Software Foundation.
  7  *
  8  * This code is distributed in the hope that it will be useful, but WITHOUT
  9  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 10  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 11  * version 2 for more details (a copy is included in the LICENSE file that
 12  * accompanied this code).
 13  *
 14  * You should have received a copy of the GNU General Public License version
 15  * 2 along with this work; if not, write to the Free Software Foundation,
 16  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 17  *
 18  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 19  * or visit www.oracle.com if you need additional information or have any
 20  * questions.
 21  *
 22  */
</pre>
<hr />
<pre>
 29 #include &quot;gc/shenandoah/shenandoahHeap.hpp&quot;
 30 #include &quot;gc/shenandoah/shenandoahHeapRegionCounters.hpp&quot;
 31 #include &quot;memory/metaspaceCounters.hpp&quot;
 32 #include &quot;services/memoryService.hpp&quot;
 33 
 34 class ShenandoahYoungGenerationCounters : public GenerationCounters {
 35 public:
 36   ShenandoahYoungGenerationCounters() :
 37           GenerationCounters(&quot;Young&quot;, 0, 0, 0, (size_t)0, (size_t)0) {};
 38 
 39   virtual void update_all() {
 40     // no update
 41   }
 42 };
 43 
 44 class ShenandoahGenerationCounters : public GenerationCounters {
 45 private:
 46   ShenandoahHeap* _heap;
 47 public:
 48   ShenandoahGenerationCounters(ShenandoahHeap* heap) :
<span class="line-modified"> 49           GenerationCounters(&quot;Heap&quot;, 1, 1, heap-&gt;initial_capacity(), heap-&gt;max_capacity(), heap-&gt;committed()),</span>
 50           _heap(heap)
 51   {};
 52 
 53   virtual void update_all() {
<span class="line-modified"> 54     _current_size-&gt;set_value(_heap-&gt;committed());</span>
 55   }
 56 };
 57 
 58 ShenandoahMonitoringSupport::ShenandoahMonitoringSupport(ShenandoahHeap* heap) :
 59         _partial_counters(NULL),
 60         _full_counters(NULL)
 61 {
 62   // Collection counters do not fit Shenandoah very well.
 63   // We record partial cycles as &quot;young&quot;, and full cycles (including full STW GC) as &quot;old&quot;.
 64   _partial_counters  = new CollectorCounters(&quot;Shenandoah partial&quot;, 0);
 65   _full_counters     = new CollectorCounters(&quot;Shenandoah full&quot;,    1);
 66 
 67   // We report young gen as unused.
 68   _young_counters = new ShenandoahYoungGenerationCounters();
 69   _heap_counters  = new ShenandoahGenerationCounters(heap);
 70   _space_counters = new HSpaceCounters(_heap_counters-&gt;name_space(), &quot;Heap&quot;, 0, heap-&gt;max_capacity(), heap-&gt;initial_capacity());
 71 
 72   _heap_region_counters = new ShenandoahHeapRegionCounters();
 73 }
 74 
</pre>
<hr />
<pre>
 77 }
 78 
 79 CollectorCounters* ShenandoahMonitoringSupport::full_stw_collection_counters() {
 80   return _full_counters;
 81 }
 82 
 83 CollectorCounters* ShenandoahMonitoringSupport::concurrent_collection_counters() {
 84   return _full_counters;
 85 }
 86 
 87 CollectorCounters* ShenandoahMonitoringSupport::partial_collection_counters() {
 88   return _partial_counters;
 89 }
 90 
 91 void ShenandoahMonitoringSupport::update_counters() {
 92   MemoryService::track_memory_usage();
 93 
 94   if (UsePerfData) {
 95     ShenandoahHeap* heap = ShenandoahHeap::heap();
 96     size_t used = heap-&gt;used();
<span class="line-modified"> 97     size_t capacity = heap-&gt;capacity();</span>
 98     _heap_counters-&gt;update_all();
 99     _space_counters-&gt;update_all(capacity, used);
100     _heap_region_counters-&gt;update();
101 
102     MetaspaceCounters::update_performance_counters();
103     CompressedClassSpaceCounters::update_performance_counters();
104   }
105 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2019, Red Hat, Inc. All rights reserved.</span>
<span class="line-added">  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.</span>
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
</pre>
<hr />
<pre>
 30 #include &quot;gc/shenandoah/shenandoahHeap.hpp&quot;
 31 #include &quot;gc/shenandoah/shenandoahHeapRegionCounters.hpp&quot;
 32 #include &quot;memory/metaspaceCounters.hpp&quot;
 33 #include &quot;services/memoryService.hpp&quot;
 34 
 35 class ShenandoahYoungGenerationCounters : public GenerationCounters {
 36 public:
 37   ShenandoahYoungGenerationCounters() :
 38           GenerationCounters(&quot;Young&quot;, 0, 0, 0, (size_t)0, (size_t)0) {};
 39 
 40   virtual void update_all() {
 41     // no update
 42   }
 43 };
 44 
 45 class ShenandoahGenerationCounters : public GenerationCounters {
 46 private:
 47   ShenandoahHeap* _heap;
 48 public:
 49   ShenandoahGenerationCounters(ShenandoahHeap* heap) :
<span class="line-modified"> 50           GenerationCounters(&quot;Heap&quot;, 1, 1, heap-&gt;initial_capacity(), heap-&gt;max_capacity(), heap-&gt;capacity()),</span>
 51           _heap(heap)
 52   {};
 53 
 54   virtual void update_all() {
<span class="line-modified"> 55     _current_size-&gt;set_value(_heap-&gt;capacity());</span>
 56   }
 57 };
 58 
 59 ShenandoahMonitoringSupport::ShenandoahMonitoringSupport(ShenandoahHeap* heap) :
 60         _partial_counters(NULL),
 61         _full_counters(NULL)
 62 {
 63   // Collection counters do not fit Shenandoah very well.
 64   // We record partial cycles as &quot;young&quot;, and full cycles (including full STW GC) as &quot;old&quot;.
 65   _partial_counters  = new CollectorCounters(&quot;Shenandoah partial&quot;, 0);
 66   _full_counters     = new CollectorCounters(&quot;Shenandoah full&quot;,    1);
 67 
 68   // We report young gen as unused.
 69   _young_counters = new ShenandoahYoungGenerationCounters();
 70   _heap_counters  = new ShenandoahGenerationCounters(heap);
 71   _space_counters = new HSpaceCounters(_heap_counters-&gt;name_space(), &quot;Heap&quot;, 0, heap-&gt;max_capacity(), heap-&gt;initial_capacity());
 72 
 73   _heap_region_counters = new ShenandoahHeapRegionCounters();
 74 }
 75 
</pre>
<hr />
<pre>
 78 }
 79 
 80 CollectorCounters* ShenandoahMonitoringSupport::full_stw_collection_counters() {
 81   return _full_counters;
 82 }
 83 
 84 CollectorCounters* ShenandoahMonitoringSupport::concurrent_collection_counters() {
 85   return _full_counters;
 86 }
 87 
 88 CollectorCounters* ShenandoahMonitoringSupport::partial_collection_counters() {
 89   return _partial_counters;
 90 }
 91 
 92 void ShenandoahMonitoringSupport::update_counters() {
 93   MemoryService::track_memory_usage();
 94 
 95   if (UsePerfData) {
 96     ShenandoahHeap* heap = ShenandoahHeap::heap();
 97     size_t used = heap-&gt;used();
<span class="line-modified"> 98     size_t capacity = heap-&gt;max_capacity();</span>
 99     _heap_counters-&gt;update_all();
100     _space_counters-&gt;update_all(capacity, used);
101     _heap_region_counters-&gt;update();
102 
103     MetaspaceCounters::update_performance_counters();
104     CompressedClassSpaceCounters::update_performance_counters();
105   }
106 }
</pre>
</td>
</tr>
</table>
<center><a href="shenandoahMetrics.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahMonitoringSupport.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>