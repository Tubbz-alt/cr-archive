<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/hotspot/share/gc/shenandoah/shenandoahHeapRegionSet.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
    <script type="text/javascript" src="../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre> 1 /*
<a name="1" id="anc1"></a><span class="line-modified"> 2  * Copyright (c) 2013, 2018, Red Hat, Inc. All rights reserved.</span>

 3  *
 4  * This code is free software; you can redistribute it and/or modify it
 5  * under the terms of the GNU General Public License version 2 only, as
 6  * published by the Free Software Foundation.
 7  *
 8  * This code is distributed in the hope that it will be useful, but WITHOUT
 9  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
10  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
11  * version 2 for more details (a copy is included in the LICENSE file that
12  * accompanied this code).
13  *
14  * You should have received a copy of the GNU General Public License version
15  * 2 along with this work; if not, write to the Free Software Foundation,
16  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
17  *
18  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
19  * or visit www.oracle.com if you need additional information or have any
20  * questions.
21  *
22  */
23 
24 #ifndef SHARE_GC_SHENANDOAH_SHENANDOAHHEAPREGIONSET_HPP
25 #define SHARE_GC_SHENANDOAH_SHENANDOAHHEAPREGIONSET_HPP
26 
27 #include &quot;memory/allocation.hpp&quot;
28 #include &quot;gc/shenandoah/shenandoahHeap.hpp&quot;
29 #include &quot;gc/shenandoah/shenandoahHeapRegion.hpp&quot;
<a name="2" id="anc2"></a>
30 
31 class ShenandoahHeapRegionSet;
32 
33 class ShenandoahHeapRegionSetIterator : public StackObj {
34 private:
35   const ShenandoahHeapRegionSet* _set;
36   ShenandoahHeap* const _heap;
37 
38   DEFINE_PAD_MINUS_SIZE(0, DEFAULT_CACHE_LINE_SIZE, sizeof(volatile jint));
39   volatile jint _current_index;
40   DEFINE_PAD_MINUS_SIZE(1, DEFAULT_CACHE_LINE_SIZE, 0);
41 
42   // No implicit copying: iterators should be passed by reference to capture the state
<a name="3" id="anc3"></a><span class="line-modified">43   ShenandoahHeapRegionSetIterator(const ShenandoahHeapRegionSetIterator&amp; that);</span>
<span class="line-removed">44   ShenandoahHeapRegionSetIterator&amp; operator=(const ShenandoahHeapRegionSetIterator&amp; o);</span>
45 
46 public:
47   ShenandoahHeapRegionSetIterator(const ShenandoahHeapRegionSet* const set);
48 
49   // Reset existing iterator to new set
50   void reset(const ShenandoahHeapRegionSet* const set);
51 
52   // MT version
53   ShenandoahHeapRegion* claim_next();
54 
55   // Single-thread version
56   ShenandoahHeapRegion* next();
57 };
58 
59 class ShenandoahHeapRegionSet : public CHeapObj&lt;mtGC&gt; {
60   friend class ShenandoahHeap;
61 private:
62   ShenandoahHeap* const _heap;
63   size_t const          _map_size;
64   size_t const          _region_size_bytes_shift;
65   jbyte* const          _set_map;
66   // Bias set map&#39;s base address for fast test if an oop is in set
67   jbyte* const          _biased_set_map;
68   size_t                _region_count;
69 
70 public:
71   ShenandoahHeapRegionSet();
72   ~ShenandoahHeapRegionSet();
73 
74   // Add region to set
75   void add_region(ShenandoahHeapRegion* r);
76   bool add_region_check_for_duplicates(ShenandoahHeapRegion* r);
77 
78   // Remove region from set
79   void remove_region(ShenandoahHeapRegion* r);
80 
81   size_t count()  const { return _region_count; }
82   bool is_empty() const { return _region_count == 0; }
83 
84   inline bool is_in(ShenandoahHeapRegion* r) const;
85   inline bool is_in(size_t region_number)    const;
<a name="4" id="anc4"></a><span class="line-modified">86   inline bool is_in(HeapWord* p)             const;</span>
87 
88   void print_on(outputStream* out) const;
89 
90   void clear();
91 
92 private:
93   jbyte* biased_map_address() const {
94     return _biased_set_map;
95   }
96 };
97 
98 #endif // SHARE_GC_SHENANDOAH_SHENANDOAHHEAPREGIONSET_HPP
<a name="5" id="anc5"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="5" type="hidden" />
</body>
</html>