<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/gc/shenandoah/shenandoahVerifier.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahVerifier.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahWorkGroup.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/shenandoahVerifier.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2017, 2018, Red Hat, Inc. All rights reserved.</span>
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
   *
<span class="line-new-header">--- 1,8 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2017, 2020, Red Hat, Inc. All rights reserved.</span>
<span class="line-added">+  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.</span>
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
   *
</pre>
<hr />
<pre>
<span class="line-old-header">*** 23,10 ***</span>
<span class="line-new-header">--- 24,11 ---</span>
  
  #ifndef SHARE_GC_SHENANDOAH_SHENANDOAHVERIFIER_HPP
  #define SHARE_GC_SHENANDOAH_SHENANDOAHVERIFIER_HPP
  
  #include &quot;gc/shared/markBitMap.hpp&quot;
<span class="line-added">+ #include &quot;gc/shenandoah/shenandoahRootVerifier.hpp&quot;</span>
  #include &quot;memory/allocation.hpp&quot;
  #include &quot;oops/oopsHierarchy.hpp&quot;
  #include &quot;utilities/stack.hpp&quot;
  
  class ShenandoahHeap;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 71,22 ***</span>
  
      // Objects should be marked in &quot;next&quot; bitmap.
      _verify_marked_incomplete,
  
      // Objects should be marked in &quot;complete&quot; bitmap.
<span class="line-modified">!     _verify_marked_complete,</span>
    } VerifyMarked;
  
    typedef enum {
      // Disable forwarded objects verification.
      _verify_forwarded_disable,
  
      // Objects should not have forwardees.
      _verify_forwarded_none,
  
      // Objects may have forwardees.
<span class="line-modified">!     _verify_forwarded_allow,</span>
    } VerifyForwarded;
  
    typedef enum {
      // Disable collection set verification.
      _verify_cset_disable,
<span class="line-new-header">--- 73,22 ---</span>
  
      // Objects should be marked in &quot;next&quot; bitmap.
      _verify_marked_incomplete,
  
      // Objects should be marked in &quot;complete&quot; bitmap.
<span class="line-modified">!     _verify_marked_complete</span>
    } VerifyMarked;
  
    typedef enum {
      // Disable forwarded objects verification.
      _verify_forwarded_disable,
  
      // Objects should not have forwardees.
      _verify_forwarded_none,
  
      // Objects may have forwardees.
<span class="line-modified">!     _verify_forwarded_allow</span>
    } VerifyForwarded;
  
    typedef enum {
      // Disable collection set verification.
      _verify_cset_disable,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 95,11 ***</span>
      _verify_cset_none,
  
      // May have references to cset, all should be forwarded.
      // Note: Allowing non-forwarded references to cset is equivalent
      // to _verify_cset_disable.
<span class="line-modified">!     _verify_cset_forwarded,</span>
    } VerifyCollectionSet;
  
    typedef enum {
      // Disable liveness verification
      _verify_liveness_disable,
<span class="line-new-header">--- 97,11 ---</span>
      _verify_cset_none,
  
      // May have references to cset, all should be forwarded.
      // Note: Allowing non-forwarded references to cset is equivalent
      // to _verify_cset_disable.
<span class="line-modified">!     _verify_cset_forwarded</span>
    } VerifyCollectionSet;
  
    typedef enum {
      // Disable liveness verification
      _verify_liveness_disable,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 107,11 ***</span>
      // All objects should belong to live regions
      _verify_liveness_conservative,
  
      // All objects should belong to live regions,
      // and liveness data should be accurate
<span class="line-modified">!     _verify_liveness_complete,</span>
    } VerifyLiveness;
  
    typedef enum {
      // Disable region verification
      _verify_regions_disable,
<span class="line-new-header">--- 109,11 ---</span>
      // All objects should belong to live regions
      _verify_liveness_conservative,
  
      // All objects should belong to live regions,
      // and liveness data should be accurate
<span class="line-modified">!     _verify_liveness_complete</span>
    } VerifyLiveness;
  
    typedef enum {
      // Disable region verification
      _verify_regions_disable,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 121,11 ***</span>
  
      // No collection set regions allowed
      _verify_regions_nocset,
  
      // No trash and no cset regions allowed
<span class="line-modified">!     _verify_regions_notrash_nocset,</span>
    } VerifyRegions;
  
    typedef enum {
      // Disable gc-state verification
      _verify_gcstate_disable,
<span class="line-new-header">--- 123,11 ---</span>
  
      // No collection set regions allowed
      _verify_regions_nocset,
  
      // No trash and no cset regions allowed
<span class="line-modified">!     _verify_regions_notrash_nocset</span>
    } VerifyRegions;
  
    typedef enum {
      // Disable gc-state verification
      _verify_gcstate_disable,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 133,55 ***</span>
      // Nothing is in progress, no forwarded objects
      _verify_gcstate_stable,
  
      // Nothing is in progress, some objects are forwarded
      _verify_gcstate_forwarded,
    } VerifyGCState;
  
    struct VerifyOptions {
      VerifyForwarded     _verify_forwarded;
      VerifyMarked        _verify_marked;
      VerifyCollectionSet _verify_cset;
      VerifyLiveness      _verify_liveness;
      VerifyRegions       _verify_regions;
      VerifyGCState       _verify_gcstate;
  
      VerifyOptions(VerifyForwarded verify_forwarded,
                    VerifyMarked verify_marked,
                    VerifyCollectionSet verify_collection_set,
                    VerifyLiveness verify_liveness,
                    VerifyRegions verify_regions,
<span class="line-modified">!                   VerifyGCState verify_gcstate) :</span>
              _verify_forwarded(verify_forwarded), _verify_marked(verify_marked),
              _verify_cset(verify_collection_set),
              _verify_liveness(verify_liveness), _verify_regions(verify_regions),
<span class="line-modified">!             _verify_gcstate(verify_gcstate) {}</span>
    };
  
  private:
    void verify_at_safepoint(const char *label,
                             VerifyForwarded forwarded,
                             VerifyMarked marked,
                             VerifyCollectionSet cset,
                             VerifyLiveness liveness,
                             VerifyRegions regions,
<span class="line-modified">!                            VerifyGCState gcstate);</span>
  
  public:
    ShenandoahVerifier(ShenandoahHeap* heap, MarkBitMap* verification_bitmap) :
            _heap(heap), _verification_bit_map(verification_bitmap) {};
  
    void verify_before_concmark();
    void verify_after_concmark();
    void verify_before_evacuation();
    void verify_after_evacuation();
    void verify_before_updaterefs();
    void verify_after_updaterefs();
    void verify_before_fullgc();
    void verify_after_fullgc();
    void verify_before_traversal();
    void verify_after_traversal();
    void verify_after_degenerated();
    void verify_generic(VerifyOption option);
  };
  
  #endif // SHARE_GC_SHENANDOAH_SHENANDOAHVERIFIER_HPP
<span class="line-new-header">--- 135,76 ---</span>
      // Nothing is in progress, no forwarded objects
      _verify_gcstate_stable,
  
      // Nothing is in progress, some objects are forwarded
      _verify_gcstate_forwarded,
<span class="line-added">+ </span>
<span class="line-added">+     // Evacuation is in progress, some objects are forwarded</span>
<span class="line-added">+     _verify_gcstate_evacuation</span>
    } VerifyGCState;
  
<span class="line-added">+   typedef enum {</span>
<span class="line-added">+     _verify_all_weak_roots,</span>
<span class="line-added">+     _verify_serial_weak_roots,</span>
<span class="line-added">+     _verify_concurrent_weak_roots</span>
<span class="line-added">+   } VerifyWeakRoots;</span>
<span class="line-added">+ </span>
    struct VerifyOptions {
      VerifyForwarded     _verify_forwarded;
      VerifyMarked        _verify_marked;
      VerifyCollectionSet _verify_cset;
      VerifyLiveness      _verify_liveness;
      VerifyRegions       _verify_regions;
      VerifyGCState       _verify_gcstate;
<span class="line-added">+     VerifyWeakRoots     _verify_weak_roots;</span>
  
      VerifyOptions(VerifyForwarded verify_forwarded,
                    VerifyMarked verify_marked,
                    VerifyCollectionSet verify_collection_set,
                    VerifyLiveness verify_liveness,
                    VerifyRegions verify_regions,
<span class="line-modified">!                   VerifyGCState verify_gcstate,</span>
<span class="line-added">+                   VerifyWeakRoots verify_weak_roots = _verify_all_weak_roots) :</span>
              _verify_forwarded(verify_forwarded), _verify_marked(verify_marked),
              _verify_cset(verify_collection_set),
              _verify_liveness(verify_liveness), _verify_regions(verify_regions),
<span class="line-modified">!             _verify_gcstate(verify_gcstate),</span>
<span class="line-added">+             _verify_weak_roots(verify_weak_roots) {}</span>
    };
  
  private:
    void verify_at_safepoint(const char *label,
                             VerifyForwarded forwarded,
                             VerifyMarked marked,
                             VerifyCollectionSet cset,
                             VerifyLiveness liveness,
                             VerifyRegions regions,
<span class="line-modified">!                            VerifyGCState gcstate,</span>
<span class="line-added">+                            VerifyWeakRoots weakRoots);</span>
  
  public:
    ShenandoahVerifier(ShenandoahHeap* heap, MarkBitMap* verification_bitmap) :
            _heap(heap), _verification_bit_map(verification_bitmap) {};
  
    void verify_before_concmark();
    void verify_after_concmark();
    void verify_before_evacuation();
<span class="line-added">+   void verify_during_evacuation();</span>
    void verify_after_evacuation();
    void verify_before_updaterefs();
    void verify_after_updaterefs();
    void verify_before_fullgc();
    void verify_after_fullgc();
    void verify_before_traversal();
    void verify_after_traversal();
    void verify_after_degenerated();
    void verify_generic(VerifyOption option);
<span class="line-added">+ </span>
<span class="line-added">+   // Roots should only contain to-space oops</span>
<span class="line-added">+   void verify_roots_in_to_space();</span>
<span class="line-added">+   void verify_roots_in_to_space_except(ShenandoahRootVerifier::RootTypes types);</span>
<span class="line-added">+ </span>
<span class="line-added">+   void verify_roots_no_forwarded();</span>
<span class="line-added">+   void verify_roots_no_forwarded_except(ShenandoahRootVerifier::RootTypes types);</span>
  };
  
  #endif // SHARE_GC_SHENANDOAH_SHENANDOAHVERIFIER_HPP
</pre>
<center><a href="shenandoahVerifier.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahWorkGroup.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>