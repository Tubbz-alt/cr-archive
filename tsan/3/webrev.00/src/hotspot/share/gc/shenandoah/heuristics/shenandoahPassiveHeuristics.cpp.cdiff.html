<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/gc/shenandoah/heuristics/shenandoahPassiveHeuristics.cpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahCompactHeuristics.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="shenandoahPassiveHeuristics.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/heuristics/shenandoahPassiveHeuristics.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2018, Red Hat, Inc. All rights reserved.</span>
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
   *
<span class="line-new-header">--- 1,8 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2018, 2019, Red Hat, Inc. All rights reserved.</span>
<span class="line-added">+  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.</span>
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
   *
</pre>
<hr />
<pre>
<span class="line-old-header">*** 27,39 ***</span>
  #include &quot;gc/shenandoah/shenandoahCollectionSet.hpp&quot;
  #include &quot;gc/shenandoah/shenandoahHeapRegion.hpp&quot;
  #include &quot;logging/log.hpp&quot;
  #include &quot;logging/logTag.hpp&quot;
  
<span class="line-modified">! ShenandoahPassiveHeuristics::ShenandoahPassiveHeuristics() : ShenandoahHeuristics() {</span>
<span class="line-removed">-   // Do not allow concurrent cycles.</span>
<span class="line-removed">-   FLAG_SET_DEFAULT(ExplicitGCInvokesConcurrent, false);</span>
<span class="line-removed">-   FLAG_SET_DEFAULT(ShenandoahImplicitGCInvokesConcurrent, false);</span>
<span class="line-removed">- </span>
<span class="line-removed">-   // Passive runs with max speed, reacts on allocation failure.</span>
<span class="line-removed">-   FLAG_SET_DEFAULT(ShenandoahPacing, false);</span>
<span class="line-removed">- </span>
<span class="line-removed">-   // No need for evacuation reserve with Full GC, only for Degenerated GC.</span>
<span class="line-removed">-   if (!ShenandoahDegeneratedGC) {</span>
<span class="line-removed">-     SHENANDOAH_ERGO_OVERRIDE_DEFAULT(ShenandoahEvacReserve, 0);</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- </span>
<span class="line-removed">-   // Disable known barriers by default.</span>
<span class="line-removed">-   SHENANDOAH_ERGO_DISABLE_FLAG(ShenandoahSATBBarrier);</span>
<span class="line-removed">-   SHENANDOAH_ERGO_DISABLE_FLAG(ShenandoahKeepAliveBarrier);</span>
<span class="line-removed">-   SHENANDOAH_ERGO_DISABLE_FLAG(ShenandoahWriteBarrier);</span>
<span class="line-removed">-   SHENANDOAH_ERGO_DISABLE_FLAG(ShenandoahReadBarrier);</span>
<span class="line-removed">-   SHENANDOAH_ERGO_DISABLE_FLAG(ShenandoahStoreValEnqueueBarrier);</span>
<span class="line-removed">-   SHENANDOAH_ERGO_DISABLE_FLAG(ShenandoahStoreValReadBarrier);</span>
<span class="line-removed">-   SHENANDOAH_ERGO_DISABLE_FLAG(ShenandoahCASBarrier);</span>
<span class="line-removed">-   SHENANDOAH_ERGO_DISABLE_FLAG(ShenandoahAcmpBarrier);</span>
<span class="line-removed">-   SHENANDOAH_ERGO_DISABLE_FLAG(ShenandoahCloneBarrier);</span>
<span class="line-removed">- </span>
<span class="line-removed">-   // Final configuration checks</span>
<span class="line-removed">-   // No barriers are required to run.</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- bool ShenandoahPassiveHeuristics::should_start_normal_gc() const {</span>
    // Never do concurrent GCs.
    return false;
  }
  
  bool ShenandoahPassiveHeuristics::should_process_references() {
<span class="line-new-header">--- 28,11 ---</span>
  #include &quot;gc/shenandoah/shenandoahCollectionSet.hpp&quot;
  #include &quot;gc/shenandoah/shenandoahHeapRegion.hpp&quot;
  #include &quot;logging/log.hpp&quot;
  #include &quot;logging/logTag.hpp&quot;
  
<span class="line-modified">! bool ShenandoahPassiveHeuristics::should_start_gc() const {</span>
    // Never do concurrent GCs.
    return false;
  }
  
  bool ShenandoahPassiveHeuristics::should_process_references() {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 82,16 ***</span>
                                                                          size_t actual_free) {
    assert(ShenandoahDegeneratedGC, &quot;This path is only taken for Degenerated GC&quot;);
  
    // Do not select too large CSet that would overflow the available free space.
    // Take at least the entire evacuation reserve, and be free to overflow to free space.
<span class="line-modified">!   size_t capacity  = ShenandoahHeap::heap()-&gt;capacity();</span>
<span class="line-modified">!   size_t available = MAX2(ShenandoahEvacReserve * capacity / 100, actual_free);</span>
    size_t max_cset  = (size_t)(available / ShenandoahEvacWaste);
  
<span class="line-modified">!   log_info(gc, ergo)(&quot;CSet Selection. Actual Free: &quot; SIZE_FORMAT &quot;M, Max CSet: &quot; SIZE_FORMAT &quot;M&quot;,</span>
<span class="line-modified">!                      actual_free / M, max_cset / M);</span>
  
    size_t threshold = ShenandoahHeapRegion::region_size_bytes() * ShenandoahGarbageThreshold / 100;
  
    size_t live_cset = 0;
    for (size_t idx = 0; idx &lt; size; idx++) {
<span class="line-new-header">--- 55,17 ---</span>
                                                                          size_t actual_free) {
    assert(ShenandoahDegeneratedGC, &quot;This path is only taken for Degenerated GC&quot;);
  
    // Do not select too large CSet that would overflow the available free space.
    // Take at least the entire evacuation reserve, and be free to overflow to free space.
<span class="line-modified">!   size_t capacity  = ShenandoahHeap::heap()-&gt;max_capacity();</span>
<span class="line-modified">!   size_t available = MAX2(capacity / 100 * ShenandoahEvacReserve, actual_free);</span>
    size_t max_cset  = (size_t)(available / ShenandoahEvacWaste);
  
<span class="line-modified">!   log_info(gc, ergo)(&quot;CSet Selection. Actual Free: &quot; SIZE_FORMAT &quot;%s, Max CSet: &quot; SIZE_FORMAT &quot;%s&quot;,</span>
<span class="line-modified">!                      byte_size_in_proper_unit(actual_free), proper_unit_for_byte_size(actual_free),</span>
<span class="line-added">+                      byte_size_in_proper_unit(max_cset),    proper_unit_for_byte_size(max_cset));</span>
  
    size_t threshold = ShenandoahHeapRegion::region_size_bytes() * ShenandoahGarbageThreshold / 100;
  
    size_t live_cset = 0;
    for (size_t idx = 0; idx &lt; size; idx++) {
</pre>
<center><a href="shenandoahCompactHeuristics.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="shenandoahPassiveHeuristics.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>