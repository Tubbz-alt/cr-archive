<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/gc/shenandoah/shenandoahHeapRegion.inline.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahHeapRegion.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahHeapRegionCounters.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/shenandoahHeapRegion.inline.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,8 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2015, 2018, Red Hat, Inc. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2015, 2019, Red Hat, Inc. All rights reserved.</span>
<span class="udiff-line-added">+  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.</span>
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
   *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -30,18 +31,22 @@</span>
  #include &quot;runtime/atomic.hpp&quot;
  
  HeapWord* ShenandoahHeapRegion::allocate(size_t size, ShenandoahAllocRequest::Type type) {
    _heap-&gt;assert_heaplock_or_safepoint();
  
<span class="udiff-line-added">+   assert(is_object_aligned(size), &quot;alloc size breaks alignment: &quot; SIZE_FORMAT, size);</span>
<span class="udiff-line-added">+ </span>
    HeapWord* obj = top();
    if (pointer_delta(end(), obj) &gt;= size) {
      make_regular_allocation();
      adjust_alloc_metadata(type, size);
  
      HeapWord* new_top = obj + size;
      set_top(new_top);
<span class="udiff-line-modified-removed">-     assert(is_aligned(obj) &amp;&amp; is_aligned(new_top), &quot;checking alignment&quot;);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+     assert(is_object_aligned(new_top), &quot;new top breaks alignment: &quot; PTR_FORMAT, p2i(new_top));</span>
<span class="udiff-line-added">+     assert(is_object_aligned(obj),     &quot;obj is not aligned: &quot;       PTR_FORMAT, p2i(obj));</span>
  
      return obj;
    } else {
      return NULL;
    }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -97,11 +102,11 @@</span>
      _heap-&gt;pacer()-&gt;report_mark(s);
    }
  }
  
  inline void ShenandoahHeapRegion::internal_increase_live_data(size_t s) {
<span class="udiff-line-modified-removed">-   size_t new_live_data = Atomic::add(s, &amp;_live_data);</span>
<span class="udiff-line-modified-added">+   size_t new_live_data = Atomic::add(&amp;_live_data, s);</span>
  #ifdef ASSERT
    size_t live_bytes = new_live_data * HeapWordSize;
    size_t used_bytes = used();
    assert(live_bytes &lt;= used_bytes,
           &quot;can&#39;t have more live data than used: &quot; SIZE_FORMAT &quot;, &quot; SIZE_FORMAT, live_bytes, used_bytes);
</pre>
<center><a href="shenandoahHeapRegion.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahHeapRegionCounters.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>