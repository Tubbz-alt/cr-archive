<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/gc/serial/markSweep.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="genMarkSweep.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="markSweep.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/serial/markSweep.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -27,10 +27,11 @@</span>
  #include &quot;gc/serial/markSweep.inline.hpp&quot;
  #include &quot;gc/shared/collectedHeap.inline.hpp&quot;
  #include &quot;gc/shared/gcTimer.hpp&quot;
  #include &quot;gc/shared/gcTrace.hpp&quot;
  #include &quot;memory/iterator.inline.hpp&quot;
<span class="udiff-line-added">+ #include &quot;memory/universe.hpp&quot;</span>
  #include &quot;oops/access.inline.hpp&quot;
  #include &quot;oops/compressedOops.inline.hpp&quot;
  #include &quot;oops/instanceClassLoaderKlass.inline.hpp&quot;
  #include &quot;oops/instanceKlass.inline.hpp&quot;
  #include &quot;oops/instanceMirrorKlass.inline.hpp&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -46,11 +47,11 @@</span>
  
  Stack&lt;oop, mtGC&gt;              MarkSweep::_marking_stack;
  Stack&lt;ObjArrayTask, mtGC&gt;     MarkSweep::_objarray_stack;
  
  Stack&lt;oop, mtGC&gt;              MarkSweep::_preserved_oop_stack;
<span class="udiff-line-modified-removed">- Stack&lt;markOop, mtGC&gt;          MarkSweep::_preserved_mark_stack;</span>
<span class="udiff-line-modified-added">+ Stack&lt;markWord, mtGC&gt;         MarkSweep::_preserved_mark_stack;</span>
  size_t                  MarkSweep::_preserved_count = 0;
  size_t                  MarkSweep::_preserved_count_max = 0;
  PreservedMark*          MarkSweep::_preserved_marks = NULL;
  ReferenceProcessor*     MarkSweep::_ref_processor   = NULL;
  STWGCTimer*             MarkSweep::_gc_timer        = NULL;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -124,16 +125,16 @@</span>
  MarkSweep::FollowStackClosure MarkSweep::follow_stack_closure;
  
  void MarkSweep::FollowStackClosure::do_void() { follow_stack(); }
  
  template &lt;class T&gt; inline void MarkSweep::follow_root(T* p) {
<span class="udiff-line-modified-removed">-   assert(!Universe::heap()-&gt;is_in_reserved(p),</span>
<span class="udiff-line-modified-added">+   assert(!Universe::heap()-&gt;is_in(p),</span>
           &quot;roots shouldn&#39;t be things within the heap&quot;);
    T heap_oop = RawAccess&lt;&gt;::oop_load(p);
    if (!CompressedOops::is_null(heap_oop)) {
      oop obj = CompressedOops::decode_not_null(heap_oop);
<span class="udiff-line-modified-removed">-     if (!obj-&gt;mark_raw()-&gt;is_marked()) {</span>
<span class="udiff-line-modified-added">+     if (!obj-&gt;mark_raw().is_marked()) {</span>
        mark_object(obj);
        follow_object(obj);
      }
    }
    follow_stack();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -149,13 +150,13 @@</span>
  void PreservedMark::restore() {
    _obj-&gt;set_mark_raw(_mark);
  }
  
  // We preserve the mark which should be replaced at the end and the location
<span class="udiff-line-modified-removed">- // that it will go.  Note that the object that this markOop belongs to isn&#39;t</span>
<span class="udiff-line-modified-added">+ // that it will go.  Note that the object that this markWord belongs to isn&#39;t</span>
  // currently at that address but it will be after phase4
<span class="udiff-line-modified-removed">- void MarkSweep::preserve_mark(oop obj, markOop mark) {</span>
<span class="udiff-line-modified-added">+ void MarkSweep::preserve_mark(oop obj, markWord mark) {</span>
    // We try to store preserved marks in the to space of the new generation since
    // this is storage which should be available.  Most of the time this should be
    // sufficient space for the marks we need to preserve but if it isn&#39;t we fall
    // back to using Stacks to keep track of the overflow.
    if (_preserved_count &lt; _preserved_count_max) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -201,11 +202,11 @@</span>
    }
  
    // deal with the overflow
    while (!_preserved_oop_stack.is_empty()) {
      oop obj       = _preserved_oop_stack.pop();
<span class="udiff-line-modified-removed">-     markOop mark  = _preserved_mark_stack.pop();</span>
<span class="udiff-line-modified-added">+     markWord mark = _preserved_mark_stack.pop();</span>
      obj-&gt;set_mark_raw(mark);
    }
  }
  
  MarkSweep::IsAliveClosure   MarkSweep::is_alive;
</pre>
<center><a href="genMarkSweep.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="markSweep.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>