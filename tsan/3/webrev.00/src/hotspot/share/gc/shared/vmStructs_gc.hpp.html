<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/hotspot/share/gc/shared/vmStructs_gc.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #ifndef SHARE_GC_SHARED_VMSTRUCTS_GC_HPP
 26 #define SHARE_GC_SHARED_VMSTRUCTS_GC_HPP
 27 
 28 #include &quot;gc/shared/ageTable.hpp&quot;
 29 #include &quot;gc/shared/cardGeneration.hpp&quot;
 30 #include &quot;gc/shared/cardTable.hpp&quot;
 31 #include &quot;gc/shared/cardTableRS.hpp&quot;
 32 #include &quot;gc/shared/collectedHeap.hpp&quot;
 33 #include &quot;gc/shared/genCollectedHeap.hpp&quot;
 34 #include &quot;gc/shared/generation.hpp&quot;
 35 #include &quot;gc/shared/generationSpec.hpp&quot;
 36 #include &quot;gc/shared/oopStorage.hpp&quot;
 37 #include &quot;gc/shared/space.hpp&quot;
 38 #if INCLUDE_EPSILONGC
 39 #include &quot;gc/epsilon/vmStructs_epsilon.hpp&quot;
 40 #endif
 41 #if INCLUDE_G1GC
 42 #include &quot;gc/g1/vmStructs_g1.hpp&quot;
 43 #endif
 44 #if INCLUDE_PARALLELGC
 45 #include &quot;gc/parallel/vmStructs_parallelgc.hpp&quot;
 46 #endif
 47 #if INCLUDE_SERIALGC
 48 #include &quot;gc/serial/defNewGeneration.hpp&quot;
 49 #include &quot;gc/serial/vmStructs_serial.hpp&quot;
 50 #endif
 51 #if INCLUDE_SHENANDOAHGC
 52 #include &quot;gc/shenandoah/vmStructs_shenandoah.hpp&quot;
 53 #endif
 54 #if INCLUDE_ZGC
 55 #include &quot;gc/z/vmStructs_z.hpp&quot;
 56 #endif
 57 
 58 #define VM_STRUCTS_GC(nonstatic_field,                                                                                               \
 59                       volatile_nonstatic_field,                                                                                      \
 60                       static_field,                                                                                                  \
 61                       unchecked_nonstatic_field)                                                                                     \
 62   EPSILONGC_ONLY(VM_STRUCTS_EPSILONGC(nonstatic_field,                                                                               \
 63                                       volatile_nonstatic_field,                                                                      \
 64                                       static_field))                                                                                 \
 65   G1GC_ONLY(VM_STRUCTS_G1GC(nonstatic_field,                                                                                         \
 66                             volatile_nonstatic_field,                                                                                \
 67                             static_field))                                                                                           \
 68   PARALLELGC_ONLY(VM_STRUCTS_PARALLELGC(nonstatic_field,                                                                             \
 69                                         volatile_nonstatic_field,                                                                    \
 70                                         static_field))                                                                               \
 71   SERIALGC_ONLY(VM_STRUCTS_SERIALGC(nonstatic_field,                                                                                 \
 72                                     volatile_nonstatic_field,                                                                        \
 73                                     static_field))                                                                                   \
 74   SHENANDOAHGC_ONLY(VM_STRUCTS_SHENANDOAH(nonstatic_field,                                                                           \
 75                                volatile_nonstatic_field,                                                                             \
 76                                static_field))                                                                                        \
 77   ZGC_ONLY(VM_STRUCTS_ZGC(nonstatic_field,                                                                                           \
 78                           volatile_nonstatic_field,                                                                                  \
 79                           static_field))                                                                                             \
 80                                                                                                                                      \
 81   /**********************************************************************************/                                               \
 82   /* Generation and Space hierarchies                                               */                                               \
 83   /**********************************************************************************/                                               \
 84                                                                                                                                      \
 85   unchecked_nonstatic_field(AgeTable,          sizes,                                         sizeof(AgeTable::sizes))               \
 86                                                                                                                                      \
 87   nonstatic_field(BarrierSet,                  _fake_rtti,                                    BarrierSet::FakeRtti)                  \
 88                                                                                                                                      \
 89   nonstatic_field(BarrierSet::FakeRtti,        _concrete_tag,                                 BarrierSet::Name)                      \
 90                                                                                                                                      \
 91   nonstatic_field(BlockOffsetTable,            _bottom,                                       HeapWord*)                             \
 92   nonstatic_field(BlockOffsetTable,            _end,                                          HeapWord*)                             \
 93                                                                                                                                      \
 94   nonstatic_field(BlockOffsetSharedArray,      _reserved,                                     MemRegion)                             \
 95   nonstatic_field(BlockOffsetSharedArray,      _end,                                          HeapWord*)                             \
 96   nonstatic_field(BlockOffsetSharedArray,      _vs,                                           VirtualSpace)                          \
 97   nonstatic_field(BlockOffsetSharedArray,      _offset_array,                                 u_char*)                               \
 98                                                                                                                                      \
 99   nonstatic_field(BlockOffsetArray,            _array,                                        BlockOffsetSharedArray*)               \
100   nonstatic_field(BlockOffsetArray,            _sp,                                           Space*)                                \
101   nonstatic_field(BlockOffsetArrayContigSpace, _next_offset_threshold,                        HeapWord*)                             \
102   nonstatic_field(BlockOffsetArrayContigSpace, _next_offset_index,                            size_t)                                \
103                                                                                                                                      \
104   nonstatic_field(CardGeneration,              _rs,                                           CardTableRS*)                          \
105   nonstatic_field(CardGeneration,              _bts,                                          BlockOffsetSharedArray*)               \
106   nonstatic_field(CardGeneration,              _shrink_factor,                                size_t)                                \
107   nonstatic_field(CardGeneration,              _capacity_at_prologue,                         size_t)                                \
108   nonstatic_field(CardGeneration,              _used_at_prologue,                             size_t)                                \
109                                                                                                                                      \
110   nonstatic_field(CardTable,                   _whole_heap,                                   const MemRegion)                       \
111   nonstatic_field(CardTable,                   _guard_index,                                  const size_t)                          \
112   nonstatic_field(CardTable,                   _last_valid_index,                             const size_t)                          \
113   nonstatic_field(CardTable,                   _page_size,                                    const size_t)                          \
114   nonstatic_field(CardTable,                   _byte_map_size,                                const size_t)                          \
115   nonstatic_field(CardTable,                   _byte_map,                                     CardTable::CardValue*)                                \
116   nonstatic_field(CardTable,                   _cur_covered_regions,                          int)                                   \
117   nonstatic_field(CardTable,                   _covered,                                      MemRegion*)                            \
118   nonstatic_field(CardTable,                   _committed,                                    MemRegion*)                            \
119   nonstatic_field(CardTable,                   _guard_region,                                 MemRegion)                             \
120   nonstatic_field(CardTable,                   _byte_map_base,                                CardTable::CardValue*)                                \
121   nonstatic_field(CardTableBarrierSet,         _defer_initial_card_mark,                      bool)                                  \
122   nonstatic_field(CardTableBarrierSet,         _card_table,                                   CardTable*)                            \
123                                                                                                                                      \
124   nonstatic_field(CollectedHeap,               _reserved,                                     MemRegion)                             \
125   nonstatic_field(CollectedHeap,               _is_gc_active,                                 bool)                                  \
126   nonstatic_field(CollectedHeap,               _total_collections,                            unsigned int)                          \
127                                                                                                                                      \
128   nonstatic_field(CompactibleSpace,            _compaction_top,                               HeapWord*)                             \
129   nonstatic_field(CompactibleSpace,            _first_dead,                                   HeapWord*)                             \
130   nonstatic_field(CompactibleSpace,            _end_of_live,                                  HeapWord*)                             \
131                                                                                                                                      \
132   nonstatic_field(ContiguousSpace,             _top,                                          HeapWord*)                             \
133   nonstatic_field(ContiguousSpace,             _concurrent_iteration_safe_limit,              HeapWord*)                             \
134   nonstatic_field(ContiguousSpace,             _saved_mark_word,                              HeapWord*)                             \
135                                                                                                                                      \
136   nonstatic_field(Generation,                  _reserved,                                     MemRegion)                             \
137   nonstatic_field(Generation,                  _virtual_space,                                VirtualSpace)                          \
138   nonstatic_field(Generation,                  _stat_record,                                  Generation::StatRecord)                \
139                                                                                                                                      \
140   nonstatic_field(Generation::StatRecord,      invocations,                                   int)                                   \
141   nonstatic_field(Generation::StatRecord,      accumulated_time,                              elapsedTimer)                          \
142                                                                                                                                      \
143   nonstatic_field(GenerationSpec,              _name,                                         Generation::Name)                      \
144   nonstatic_field(GenerationSpec,              _init_size,                                    size_t)                                \
145   nonstatic_field(GenerationSpec,              _max_size,                                     size_t)                                \
146                                                                                                                                      \
147   nonstatic_field(GenCollectedHeap,            _young_gen,                                    Generation*)                           \
148   nonstatic_field(GenCollectedHeap,            _old_gen,                                      Generation*)                           \
149   nonstatic_field(GenCollectedHeap,            _young_gen_spec,                               GenerationSpec*)                       \
150   nonstatic_field(GenCollectedHeap,            _old_gen_spec,                                 GenerationSpec*)                       \
151                                                                                                                                      \
152   nonstatic_field(MemRegion,                   _start,                                        HeapWord*)                             \
153   nonstatic_field(MemRegion,                   _word_size,                                    size_t)                                \
154                                                                                                                                      \
155   nonstatic_field(OffsetTableContigSpace,      _offsets,                                      BlockOffsetArray)                      \
156                                                                                                                                      \
157   nonstatic_field(Space,                       _bottom,                                       HeapWord*)                             \
158   nonstatic_field(Space,                       _end,                                          HeapWord*)
159 
160 #define VM_TYPES_GC(declare_type,                                         \
161                     declare_toplevel_type,                                \
162                     declare_integer_type)                                 \
163   EPSILONGC_ONLY(VM_TYPES_EPSILONGC(declare_type,                         \
164                                     declare_toplevel_type,                \
165                                     declare_integer_type))                \
166   G1GC_ONLY(VM_TYPES_G1GC(declare_type,                                   \
167                           declare_toplevel_type,                          \
168                           declare_integer_type))                          \
169   PARALLELGC_ONLY(VM_TYPES_PARALLELGC(declare_type,                       \
170                                       declare_toplevel_type,              \
171                                       declare_integer_type))              \
172   SERIALGC_ONLY(VM_TYPES_SERIALGC(declare_type,                           \
173                                   declare_toplevel_type,                  \
174                                   declare_integer_type))                  \
175   SHENANDOAHGC_ONLY(VM_TYPES_SHENANDOAH(declare_type,                     \
176                              declare_toplevel_type,                       \
177                              declare_integer_type))                       \
178   ZGC_ONLY(VM_TYPES_ZGC(declare_type,                                     \
179                         declare_toplevel_type,                            \
180                         declare_integer_type))                            \
181                                                                           \
182   /******************************************/                            \
183   /* Generation and space hierarchies       */                            \
184   /* (needed for run-time type information) */                            \
185   /******************************************/                            \
186                                                                           \
187   declare_toplevel_type(CollectedHeap)                                    \
188            declare_type(GenCollectedHeap,             CollectedHeap)      \
189   declare_toplevel_type(Generation)                                       \
190            declare_type(CardGeneration,               Generation)         \
191   declare_toplevel_type(Space)                                            \
192            declare_type(CompactibleSpace,             Space)              \
193            declare_type(ContiguousSpace,              CompactibleSpace)   \
194            declare_type(OffsetTableContigSpace,       ContiguousSpace)    \
195   declare_toplevel_type(BarrierSet)                                       \
196            declare_type(ModRefBarrierSet,             BarrierSet)         \
197            declare_type(CardTableBarrierSet,          ModRefBarrierSet)   \
198   declare_toplevel_type(CardTable)                                        \
199            declare_type(CardTableRS, CardTable)                           \
200   declare_toplevel_type(BarrierSet::Name)                                 \
201   declare_toplevel_type(BlockOffsetSharedArray)                           \
202   declare_toplevel_type(BlockOffsetTable)                                 \
203            declare_type(BlockOffsetArray,             BlockOffsetTable)   \
204            declare_type(BlockOffsetArrayContigSpace,  BlockOffsetArray)   \
205                                                                           \
206   /* Miscellaneous other GC types */                                      \
207                                                                           \
208   declare_toplevel_type(AgeTable)                                         \
209   declare_toplevel_type(CardTable::CardValue)                             \
210   declare_toplevel_type(Generation::StatRecord)                           \
211   declare_toplevel_type(GenerationSpec)                                   \
212   declare_toplevel_type(HeapWord)                                         \
213   declare_toplevel_type(MemRegion)                                        \
214   declare_toplevel_type(ThreadLocalAllocBuffer)                           \
215   declare_toplevel_type(VirtualSpace)                                     \
216                                                                           \
217   /* Pointers to Garbage Collection types */                              \
218                                                                           \
219   declare_toplevel_type(BarrierSet*)                                      \
220   declare_toplevel_type(BlockOffsetSharedArray*)                          \
221   declare_toplevel_type(CardTable*)                                       \
222   declare_toplevel_type(CardTable*const)                                  \
223   declare_toplevel_type(CardTableRS*)                                     \
224   declare_toplevel_type(CardTableBarrierSet*)                             \
225   declare_toplevel_type(CardTableBarrierSet**)                            \
226   declare_toplevel_type(CollectedHeap*)                                   \
227   declare_toplevel_type(ContiguousSpace*)                                 \
228   declare_toplevel_type(DefNewGeneration*)                                \
229   declare_toplevel_type(GenCollectedHeap*)                                \
230   declare_toplevel_type(Generation*)                                      \
231   declare_toplevel_type(GenerationSpec**)                                 \
232   declare_toplevel_type(HeapWord*)                                        \
233   declare_toplevel_type(HeapWord* volatile)                               \
234   declare_toplevel_type(MemRegion*)                                       \
235   declare_toplevel_type(OffsetTableContigSpace*)                          \
236   declare_toplevel_type(Space*)                                           \
237   declare_toplevel_type(ThreadLocalAllocBuffer*)                          \
238                                                                           \
239   declare_toplevel_type(BarrierSet::FakeRtti)
240 
241 #define VM_INT_CONSTANTS_GC(declare_constant,                               \
242                             declare_constant_with_value)                    \
243   EPSILONGC_ONLY(VM_INT_CONSTANTS_EPSILONGC(declare_constant,               \
244                                             declare_constant_with_value))   \
245   G1GC_ONLY(VM_INT_CONSTANTS_G1GC(declare_constant,                         \
246                                   declare_constant_with_value))             \
247   PARALLELGC_ONLY(VM_INT_CONSTANTS_PARALLELGC(declare_constant,             \
248                                               declare_constant_with_value)) \
249   SERIALGC_ONLY(VM_INT_CONSTANTS_SERIALGC(declare_constant,                 \
250                                           declare_constant_with_value))     \
251   SHENANDOAHGC_ONLY(VM_INT_CONSTANTS_SHENANDOAH(declare_constant,           \
252                                      declare_constant_with_value))          \
253   ZGC_ONLY(VM_INT_CONSTANTS_ZGC(declare_constant,                           \
254                                 declare_constant_with_value))               \
255                                                                             \
256   /********************************************/                            \
257   /* Generation and Space Hierarchy Constants */                            \
258   /********************************************/                            \
259                                                                             \
260   declare_constant(AgeTable::table_size)                                    \
261                                                                             \
262   declare_constant(BarrierSet::ModRef)                                      \
263   declare_constant(BarrierSet::CardTableBarrierSet)                         \
264                                                                             \
265   declare_constant(BOTConstants::LogN)                                      \
266   declare_constant(BOTConstants::LogN_words)                                \
267   declare_constant(BOTConstants::N_bytes)                                   \
268   declare_constant(BOTConstants::N_words)                                   \
269   declare_constant(BOTConstants::LogBase)                                   \
270   declare_constant(BOTConstants::Base)                                      \
271   declare_constant(BOTConstants::N_powers)                                  \
272                                                                             \
273   declare_constant(CardTable::clean_card)                                   \
274   declare_constant(CardTable::last_card)                                    \
275   declare_constant(CardTable::dirty_card)                                   \
276   declare_constant(CardTable::Precise)                                      \
277   declare_constant(CardTable::ObjHeadPreciseArray)                          \
278   declare_constant(CardTable::card_shift)                                   \
279   declare_constant(CardTable::card_size)                                    \
280   declare_constant(CardTable::card_size_in_words)                           \
281                                                                             \
282   declare_constant(CardTableRS::youngergen_card)                            \
283                                                                             \
284   declare_constant(CollectedHeap::Serial)                                   \
285   declare_constant(CollectedHeap::Parallel)                                 \
286   declare_constant(CollectedHeap::G1)                                       \
287                                                                             \
288   /* constants from Generation::Name enum */                                \
289                                                                             \
290   declare_constant(Generation::DefNew)                                      \
291   declare_constant(Generation::MarkSweepCompact)                            \
292   declare_constant(Generation::Other)                                       \
293                                                                             \
294   declare_constant(Generation::LogOfGenGrain)                               \
295   declare_constant(Generation::GenGrain)                                    \
296 
297 #define VM_LONG_CONSTANTS_GC(declare_constant)                              \
298   ZGC_ONLY(VM_LONG_CONSTANTS_ZGC(declare_constant))
299 
300 #endif // SHARE_GC_SHARED_VMSTRUCTS_GC_HPP
    </pre>
  </body>
</html>