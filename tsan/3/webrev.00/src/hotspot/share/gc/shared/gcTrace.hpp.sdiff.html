<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/shared/gcTrace.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="gcTrace.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="gcTraceSend.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shared/gcTrace.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #ifndef SHARE_GC_SHARED_GCTRACE_HPP
 26 #define SHARE_GC_SHARED_GCTRACE_HPP
 27 
 28 #include &quot;gc/shared/copyFailedInfo.hpp&quot;
 29 #include &quot;gc/shared/gcCause.hpp&quot;
 30 #include &quot;gc/shared/gcId.hpp&quot;
 31 #include &quot;gc/shared/gcName.hpp&quot;
 32 #include &quot;gc/shared/gcWhen.hpp&quot;
 33 #include &quot;memory/metaspace.hpp&quot;
 34 #include &quot;memory/referenceType.hpp&quot;
 35 #include &quot;utilities/macros.hpp&quot;
 36 #include &quot;utilities/ticks.hpp&quot;
<span class="line-removed"> 37 #if INCLUDE_G1GC</span>
<span class="line-removed"> 38 #include &quot;gc/g1/g1YCTypes.hpp&quot;</span>
<span class="line-removed"> 39 #endif</span>
 40 
<span class="line-removed"> 41 class G1EvacuationInfo;</span>
 42 class GCHeapSummary;
 43 class MetaspaceChunkFreeListSummary;
 44 class MetaspaceSummary;
 45 class PSHeapSummary;
<span class="line-removed"> 46 class G1HeapSummary;</span>
<span class="line-removed"> 47 class G1EvacSummary;</span>
 48 class ReferenceProcessorStats;
 49 class TimePartitions;
 50 class BoolObjectClosure;
 51 
 52 class SharedGCInfo {
 53  private:
 54   GCName _name;
 55   GCCause::Cause _cause;
 56   Ticks     _start_timestamp;
 57   Ticks     _end_timestamp;
 58   Tickspan  _sum_of_pauses;
 59   Tickspan  _longest_pause;
 60 
 61  public:
 62   SharedGCInfo(GCName name) :
 63     _name(name),
 64     _cause(GCCause::_last_gc_cause),
 65     _start_timestamp(),
 66     _end_timestamp(),
 67     _sum_of_pauses(),
</pre>
<hr />
<pre>
 80   void set_cause(GCCause::Cause cause) { _cause = cause; }
 81   GCCause::Cause cause() const { return _cause; }
 82 
 83   void set_sum_of_pauses(const Tickspan&amp; duration) { _sum_of_pauses = duration; }
 84   const Tickspan sum_of_pauses() const { return _sum_of_pauses; }
 85 
 86   void set_longest_pause(const Tickspan&amp; duration) { _longest_pause = duration; }
 87   const Tickspan longest_pause() const { return _longest_pause; }
 88 };
 89 
 90 class ParallelOldGCInfo {
 91   void* _dense_prefix;
 92  public:
 93   ParallelOldGCInfo() : _dense_prefix(NULL) {}
 94   void report_dense_prefix(void* addr) {
 95     _dense_prefix = addr;
 96   }
 97   void* dense_prefix() const { return _dense_prefix; }
 98 };
 99 
<span class="line-removed">100 #if INCLUDE_G1GC</span>
<span class="line-removed">101 </span>
<span class="line-removed">102 class G1YoungGCInfo {</span>
<span class="line-removed">103   G1YCType _type;</span>
<span class="line-removed">104  public:</span>
<span class="line-removed">105   G1YoungGCInfo() : _type(G1YCTypeEndSentinel) {}</span>
<span class="line-removed">106   void set_type(G1YCType type) {</span>
<span class="line-removed">107     _type = type;</span>
<span class="line-removed">108   }</span>
<span class="line-removed">109   G1YCType type() const { return _type; }</span>
<span class="line-removed">110 };</span>
<span class="line-removed">111 </span>
<span class="line-removed">112 #endif // INCLUDE_G1GC</span>
<span class="line-removed">113 </span>
114 class GCTracer : public ResourceObj {
115  protected:
116   SharedGCInfo _shared_gc_info;
117 
118  public:
119   void report_gc_start(GCCause::Cause cause, const Ticks&amp; timestamp);
120   void report_gc_end(const Ticks&amp; timestamp, TimePartitions* time_partitions);
121   void report_gc_heap_summary(GCWhen::Type when, const GCHeapSummary&amp; heap_summary) const;
122   void report_metaspace_summary(GCWhen::Type when, const MetaspaceSummary&amp; metaspace_summary) const;
123   void report_gc_reference_stats(const ReferenceProcessorStats&amp; rp) const;
124   void report_object_count_after_gc(BoolObjectClosure* object_filter) NOT_SERVICES_RETURN;
125 
126  protected:
127   GCTracer(GCName name) : _shared_gc_info(name) {}
128   virtual void report_gc_start_impl(GCCause::Cause cause, const Ticks&amp; timestamp);
129   virtual void report_gc_end_impl(const Ticks&amp; timestamp, TimePartitions* time_partitions);
130 
131  private:
132   void send_garbage_collection_event() const;
133   void send_gc_heap_summary_event(GCWhen::Type when, const GCHeapSummary&amp; heap_summary) const;
</pre>
<hr />
<pre>
210 
211  private:
212   void send_parallel_old_event() const;
213 };
214 
215 class SerialOldTracer : public OldGCTracer {
216  public:
217   SerialOldTracer() : OldGCTracer(SerialOld) {}
218 };
219 
220 class ParallelScavengeTracer : public YoungGCTracer {
221  public:
222   ParallelScavengeTracer() : YoungGCTracer(ParallelScavenge) {}
223 };
224 
225 class DefNewTracer : public YoungGCTracer {
226  public:
227   DefNewTracer() : YoungGCTracer(DefNew) {}
228 };
229 
<span class="line-removed">230 class ParNewTracer : public YoungGCTracer {</span>
<span class="line-removed">231  public:</span>
<span class="line-removed">232   ParNewTracer() : YoungGCTracer(ParNew) {}</span>
<span class="line-removed">233 };</span>
<span class="line-removed">234 </span>
<span class="line-removed">235 #if INCLUDE_G1GC</span>
<span class="line-removed">236 class G1MMUTracer : public AllStatic {</span>
<span class="line-removed">237   static void send_g1_mmu_event(double time_slice_ms, double gc_time_ms, double max_time_ms);</span>
<span class="line-removed">238 </span>
<span class="line-removed">239  public:</span>
<span class="line-removed">240   static void report_mmu(double time_slice_sec, double gc_time_sec, double max_time_sec);</span>
<span class="line-removed">241 };</span>
<span class="line-removed">242 </span>
<span class="line-removed">243 class G1NewTracer : public YoungGCTracer {</span>
<span class="line-removed">244   G1YoungGCInfo _g1_young_gc_info;</span>
<span class="line-removed">245 </span>
<span class="line-removed">246  public:</span>
<span class="line-removed">247   G1NewTracer() : YoungGCTracer(G1New) {}</span>
<span class="line-removed">248 </span>
<span class="line-removed">249   void report_yc_type(G1YCType type);</span>
<span class="line-removed">250   void report_gc_end_impl(const Ticks&amp; timestamp, TimePartitions* time_partitions);</span>
<span class="line-removed">251   void report_evacuation_info(G1EvacuationInfo* info);</span>
<span class="line-removed">252   void report_evacuation_failed(EvacuationFailedInfo&amp; ef_info);</span>
<span class="line-removed">253 </span>
<span class="line-removed">254   void report_evacuation_statistics(const G1EvacSummary&amp; young_summary, const G1EvacSummary&amp; old_summary) const;</span>
<span class="line-removed">255 </span>
<span class="line-removed">256   void report_basic_ihop_statistics(size_t threshold,</span>
<span class="line-removed">257                                     size_t target_occupancy,</span>
<span class="line-removed">258                                     size_t current_occupancy,</span>
<span class="line-removed">259                                     size_t last_allocation_size,</span>
<span class="line-removed">260                                     double last_allocation_duration,</span>
<span class="line-removed">261                                     double last_marking_length);</span>
<span class="line-removed">262   void report_adaptive_ihop_statistics(size_t threshold,</span>
<span class="line-removed">263                                        size_t internal_target_occupancy,</span>
<span class="line-removed">264                                        size_t current_occupancy,</span>
<span class="line-removed">265                                        size_t additional_buffer_size,</span>
<span class="line-removed">266                                        double predicted_allocation_rate,</span>
<span class="line-removed">267                                        double predicted_marking_length,</span>
<span class="line-removed">268                                        bool prediction_active);</span>
<span class="line-removed">269  private:</span>
<span class="line-removed">270   void send_g1_young_gc_event();</span>
<span class="line-removed">271   void send_evacuation_info_event(G1EvacuationInfo* info);</span>
<span class="line-removed">272   void send_evacuation_failed_event(const EvacuationFailedInfo&amp; ef_info) const;</span>
<span class="line-removed">273 </span>
<span class="line-removed">274   void send_young_evacuation_statistics(const G1EvacSummary&amp; summary) const;</span>
<span class="line-removed">275   void send_old_evacuation_statistics(const G1EvacSummary&amp; summary) const;</span>
<span class="line-removed">276 </span>
<span class="line-removed">277   void send_basic_ihop_statistics(size_t threshold,</span>
<span class="line-removed">278                                   size_t target_occupancy,</span>
<span class="line-removed">279                                   size_t current_occupancy,</span>
<span class="line-removed">280                                   size_t last_allocation_size,</span>
<span class="line-removed">281                                   double last_allocation_duration,</span>
<span class="line-removed">282                                   double last_marking_length);</span>
<span class="line-removed">283   void send_adaptive_ihop_statistics(size_t threshold,</span>
<span class="line-removed">284                                      size_t internal_target_occupancy,</span>
<span class="line-removed">285                                      size_t current_occupancy,</span>
<span class="line-removed">286                                      size_t additional_buffer_size,</span>
<span class="line-removed">287                                      double predicted_allocation_rate,</span>
<span class="line-removed">288                                      double predicted_marking_length,</span>
<span class="line-removed">289                                      bool prediction_active);</span>
<span class="line-removed">290 };</span>
<span class="line-removed">291 </span>
<span class="line-removed">292 class G1FullGCTracer : public OldGCTracer {</span>
<span class="line-removed">293  public:</span>
<span class="line-removed">294   G1FullGCTracer() : OldGCTracer(G1Full) {}</span>
<span class="line-removed">295 };</span>
<span class="line-removed">296 </span>
<span class="line-removed">297 #endif // INCLUDE_G1GC</span>
<span class="line-removed">298 </span>
<span class="line-removed">299 class CMSTracer : public OldGCTracer {</span>
<span class="line-removed">300  public:</span>
<span class="line-removed">301   CMSTracer() : OldGCTracer(ConcurrentMarkSweep) {}</span>
<span class="line-removed">302 };</span>
<span class="line-removed">303 </span>
<span class="line-removed">304 class G1OldTracer : public OldGCTracer {</span>
<span class="line-removed">305  protected:</span>
<span class="line-removed">306   void report_gc_start_impl(GCCause::Cause cause, const Ticks&amp; timestamp);</span>
<span class="line-removed">307  public:</span>
<span class="line-removed">308   G1OldTracer() : OldGCTracer(G1Old) {}</span>
<span class="line-removed">309   void set_gc_cause(GCCause::Cause cause);</span>
<span class="line-removed">310 };</span>
<span class="line-removed">311 </span>
312 #endif // SHARE_GC_SHARED_GCTRACE_HPP
</pre>
</td>
<td>
<hr />
<pre>
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #ifndef SHARE_GC_SHARED_GCTRACE_HPP
 26 #define SHARE_GC_SHARED_GCTRACE_HPP
 27 
 28 #include &quot;gc/shared/copyFailedInfo.hpp&quot;
 29 #include &quot;gc/shared/gcCause.hpp&quot;
 30 #include &quot;gc/shared/gcId.hpp&quot;
 31 #include &quot;gc/shared/gcName.hpp&quot;
 32 #include &quot;gc/shared/gcWhen.hpp&quot;
 33 #include &quot;memory/metaspace.hpp&quot;
 34 #include &quot;memory/referenceType.hpp&quot;
 35 #include &quot;utilities/macros.hpp&quot;
 36 #include &quot;utilities/ticks.hpp&quot;



 37 

 38 class GCHeapSummary;
 39 class MetaspaceChunkFreeListSummary;
 40 class MetaspaceSummary;
 41 class PSHeapSummary;


 42 class ReferenceProcessorStats;
 43 class TimePartitions;
 44 class BoolObjectClosure;
 45 
 46 class SharedGCInfo {
 47  private:
 48   GCName _name;
 49   GCCause::Cause _cause;
 50   Ticks     _start_timestamp;
 51   Ticks     _end_timestamp;
 52   Tickspan  _sum_of_pauses;
 53   Tickspan  _longest_pause;
 54 
 55  public:
 56   SharedGCInfo(GCName name) :
 57     _name(name),
 58     _cause(GCCause::_last_gc_cause),
 59     _start_timestamp(),
 60     _end_timestamp(),
 61     _sum_of_pauses(),
</pre>
<hr />
<pre>
 74   void set_cause(GCCause::Cause cause) { _cause = cause; }
 75   GCCause::Cause cause() const { return _cause; }
 76 
 77   void set_sum_of_pauses(const Tickspan&amp; duration) { _sum_of_pauses = duration; }
 78   const Tickspan sum_of_pauses() const { return _sum_of_pauses; }
 79 
 80   void set_longest_pause(const Tickspan&amp; duration) { _longest_pause = duration; }
 81   const Tickspan longest_pause() const { return _longest_pause; }
 82 };
 83 
 84 class ParallelOldGCInfo {
 85   void* _dense_prefix;
 86  public:
 87   ParallelOldGCInfo() : _dense_prefix(NULL) {}
 88   void report_dense_prefix(void* addr) {
 89     _dense_prefix = addr;
 90   }
 91   void* dense_prefix() const { return _dense_prefix; }
 92 };
 93 














 94 class GCTracer : public ResourceObj {
 95  protected:
 96   SharedGCInfo _shared_gc_info;
 97 
 98  public:
 99   void report_gc_start(GCCause::Cause cause, const Ticks&amp; timestamp);
100   void report_gc_end(const Ticks&amp; timestamp, TimePartitions* time_partitions);
101   void report_gc_heap_summary(GCWhen::Type when, const GCHeapSummary&amp; heap_summary) const;
102   void report_metaspace_summary(GCWhen::Type when, const MetaspaceSummary&amp; metaspace_summary) const;
103   void report_gc_reference_stats(const ReferenceProcessorStats&amp; rp) const;
104   void report_object_count_after_gc(BoolObjectClosure* object_filter) NOT_SERVICES_RETURN;
105 
106  protected:
107   GCTracer(GCName name) : _shared_gc_info(name) {}
108   virtual void report_gc_start_impl(GCCause::Cause cause, const Ticks&amp; timestamp);
109   virtual void report_gc_end_impl(const Ticks&amp; timestamp, TimePartitions* time_partitions);
110 
111  private:
112   void send_garbage_collection_event() const;
113   void send_gc_heap_summary_event(GCWhen::Type when, const GCHeapSummary&amp; heap_summary) const;
</pre>
<hr />
<pre>
190 
191  private:
192   void send_parallel_old_event() const;
193 };
194 
195 class SerialOldTracer : public OldGCTracer {
196  public:
197   SerialOldTracer() : OldGCTracer(SerialOld) {}
198 };
199 
200 class ParallelScavengeTracer : public YoungGCTracer {
201  public:
202   ParallelScavengeTracer() : YoungGCTracer(ParallelScavenge) {}
203 };
204 
205 class DefNewTracer : public YoungGCTracer {
206  public:
207   DefNewTracer() : YoungGCTracer(DefNew) {}
208 };
209 


















































































210 #endif // SHARE_GC_SHARED_GCTRACE_HPP
</pre>
</td>
</tr>
</table>
<center><a href="gcTrace.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="gcTraceSend.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>