<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/gc/shared/space.inline.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="space.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="spaceDecorator.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shared/space.inline.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 28,11 ***</span>
  #include &quot;gc/shared/blockOffsetTable.inline.hpp&quot;
  #include &quot;gc/shared/collectedHeap.hpp&quot;
  #include &quot;gc/shared/generation.hpp&quot;
  #include &quot;gc/shared/space.hpp&quot;
  #include &quot;gc/shared/spaceDecorator.hpp&quot;
<span class="line-removed">- #include &quot;memory/universe.hpp&quot;</span>
  #include &quot;oops/oopsHierarchy.hpp&quot;
  #include &quot;oops/oop.inline.hpp&quot;
  #include &quot;runtime/prefetch.inline.hpp&quot;
  #include &quot;runtime/safepoint.hpp&quot;
  #if INCLUDE_SERIALGC
<span class="line-new-header">--- 28,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 116,11 ***</span>
      size_t dead_length = pointer_delta(dead_end, dead_start);
      if (_allowed_deadspace_words &gt;= dead_length) {
        _allowed_deadspace_words -= dead_length;
        CollectedHeap::fill_with_object(dead_start, dead_length);
        oop obj = oop(dead_start);
<span class="line-modified">!       obj-&gt;set_mark_raw(obj-&gt;mark_raw()-&gt;set_marked());</span>
  
        assert(dead_length == (size_t)obj-&gt;size(), &quot;bad filler object size&quot;);
        log_develop_trace(gc, compaction)(&quot;Inserting object to dead space: &quot; PTR_FORMAT &quot;, &quot; PTR_FORMAT &quot;, &quot; SIZE_FORMAT &quot;b&quot;,
            p2i(dead_start), p2i(dead_end), dead_length * HeapWordSize);
  
<span class="line-new-header">--- 115,11 ---</span>
      size_t dead_length = pointer_delta(dead_end, dead_start);
      if (_allowed_deadspace_words &gt;= dead_length) {
        _allowed_deadspace_words -= dead_length;
        CollectedHeap::fill_with_object(dead_start, dead_length);
        oop obj = oop(dead_start);
<span class="line-modified">!       obj-&gt;set_mark_raw(obj-&gt;mark_raw().set_marked());</span>
  
        assert(dead_length == (size_t)obj-&gt;size(), &quot;bad filler object size&quot;);
        log_develop_trace(gc, compaction)(&quot;Inserting object to dead space: &quot; PTR_FORMAT &quot;, &quot; PTR_FORMAT &quot;, &quot; SIZE_FORMAT &quot;b&quot;,
            p2i(dead_start), p2i(dead_end), dead_length * HeapWordSize);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 163,12 ***</span>
    HeapWord* cur_obj = space-&gt;bottom();
    HeapWord* scan_limit = space-&gt;scan_limit();
  
    while (cur_obj &lt; scan_limit) {
      assert(!space-&gt;scanned_block_is_obj(cur_obj) ||
<span class="line-modified">!            oop(cur_obj)-&gt;mark_raw()-&gt;is_marked() || oop(cur_obj)-&gt;mark_raw()-&gt;is_unlocked() ||</span>
<span class="line-modified">!            oop(cur_obj)-&gt;mark_raw()-&gt;has_bias_pattern(),</span>
             &quot;these are the only valid states during a mark sweep&quot;);
      if (space-&gt;scanned_block_is_obj(cur_obj) &amp;&amp; oop(cur_obj)-&gt;is_gc_marked()) {
        // prefetch beyond cur_obj
        Prefetch::write(cur_obj, interval);
        size_t size = space-&gt;scanned_block_size(cur_obj);
<span class="line-new-header">--- 162,12 ---</span>
    HeapWord* cur_obj = space-&gt;bottom();
    HeapWord* scan_limit = space-&gt;scan_limit();
  
    while (cur_obj &lt; scan_limit) {
      assert(!space-&gt;scanned_block_is_obj(cur_obj) ||
<span class="line-modified">!            oop(cur_obj)-&gt;mark_raw().is_marked() || oop(cur_obj)-&gt;mark_raw().is_unlocked() ||</span>
<span class="line-modified">!            oop(cur_obj)-&gt;mark_raw().has_bias_pattern(),</span>
             &quot;these are the only valid states during a mark sweep&quot;);
      if (space-&gt;scanned_block_is_obj(cur_obj) &amp;&amp; oop(cur_obj)-&gt;is_gc_marked()) {
        // prefetch beyond cur_obj
        Prefetch::write(cur_obj, interval);
        size_t size = space-&gt;scanned_block_size(cur_obj);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 331,11 ***</span>
        // prefetch beyond q
        Prefetch::read(cur_obj, scan_interval);
  
        // size and destination
        size_t size = space-&gt;obj_size(cur_obj);
<span class="line-modified">!       HeapWord* compaction_top = (HeapWord*)oop(cur_obj)-&gt;forwardee();</span>
  
        // prefetch beyond compaction_top
        Prefetch::write(compaction_top, copy_interval);
  
        // copy object and reinit its mark
<span class="line-new-header">--- 330,11 ---</span>
        // prefetch beyond q
        Prefetch::read(cur_obj, scan_interval);
  
        // size and destination
        size_t size = space-&gt;obj_size(cur_obj);
<span class="line-modified">!       HeapWord* compaction_top = cast_from_oop&lt;HeapWord*&gt;(oop(cur_obj)-&gt;forwardee());</span>
  
        // prefetch beyond compaction_top
        Prefetch::write(compaction_top, copy_interval);
  
        // copy object and reinit its mark
</pre>
<hr />
<pre>
<span class="line-old-header">*** 376,16 ***</span>
    } while (t &lt; top());
  
    set_saved_mark_word(p);
  }
  
<span class="line-removed">- template &lt;typename OopClosureType&gt;</span>
<span class="line-removed">- void ContiguousSpace::par_oop_iterate(MemRegion mr, OopClosureType* blk) {</span>
<span class="line-removed">-   HeapWord* obj_addr = mr.start();</span>
<span class="line-removed">-   HeapWord* limit = mr.end();</span>
<span class="line-removed">-   while (obj_addr &lt; limit) {</span>
<span class="line-removed">-     assert(oopDesc::is_oop(oop(obj_addr)), &quot;Should be an oop&quot;);</span>
<span class="line-removed">-     obj_addr += oop(obj_addr)-&gt;oop_iterate_size(blk);</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
  #endif // SHARE_GC_SHARED_SPACE_INLINE_HPP
<span class="line-new-header">--- 375,6 ---</span>
</pre>
<center><a href="space.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="spaceDecorator.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>