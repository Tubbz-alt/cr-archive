<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/gc/z/zList.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="zInitialize.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="zList.inline.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/z/zList.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2015, 2017, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -23,11 +23,11 @@</span>
  
  #ifndef SHARE_GC_Z_ZLIST_HPP
  #define SHARE_GC_Z_ZLIST_HPP
  
  #include &quot;memory/allocation.hpp&quot;
<span class="udiff-line-modified-removed">- #include &quot;utilities/debug.hpp&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;utilities/globalDefinitions.hpp&quot;</span>
  
  template &lt;typename T&gt; class ZList;
  
  // Element in a doubly linked list
  template &lt;typename T&gt;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -36,187 +36,68 @@</span>
  
  private:
    ZListNode* _next;
    ZListNode* _prev;
  
<span class="udiff-line-modified-removed">-   ZListNode(ZListNode* next, ZListNode* prev) :</span>
<span class="udiff-line-removed">-       _next(next),</span>
<span class="udiff-line-removed">-       _prev(prev) {}</span>
<span class="udiff-line-modified-added">+   ZListNode(ZListNode* next, ZListNode* prev);</span>
  
<span class="udiff-line-modified-removed">-   void set_unused() {</span>
<span class="udiff-line-removed">-     _next = NULL;</span>
<span class="udiff-line-removed">-     _prev = NULL;</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-modified-added">+   void set_unused();</span>
  
  public:
<span class="udiff-line-modified-removed">-   ZListNode() {</span>
<span class="udiff-line-modified-removed">-     set_unused();</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-modified-added">+   ZListNode();</span>
<span class="udiff-line-modified-added">+   ~ZListNode();</span>
  
<span class="udiff-line-modified-removed">-   ~ZListNode() {</span>
<span class="udiff-line-removed">-     set_unused();</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   bool is_unused() const {</span>
<span class="udiff-line-removed">-     return _next == NULL &amp;&amp; _prev == NULL;</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-modified-added">+   bool is_unused() const;</span>
  };
  
  // Doubly linked list
  template &lt;typename T&gt;
  class ZList {
  private:
    ZListNode&lt;T&gt; _head;
    size_t       _size;
  
<span class="udiff-line-modified-removed">-   // Passing by value and assignment is not allowed</span>
<span class="udiff-line-removed">-   ZList(const ZList&lt;T&gt;&amp; list);</span>
<span class="udiff-line-removed">-   ZList&lt;T&gt;&amp; operator=(const ZList&lt;T&gt;&amp; list);</span>
<span class="udiff-line-modified-added">+   NONCOPYABLE(ZList);</span>
  
<span class="udiff-line-modified-removed">-   void verify() const {</span>
<span class="udiff-line-removed">-     assert(_head._next-&gt;_prev == &amp;_head, &quot;List corrupt&quot;);</span>
<span class="udiff-line-removed">-     assert(_head._prev-&gt;_next == &amp;_head, &quot;List corrupt&quot;);</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-modified-added">+   void verify() const;</span>
  
<span class="udiff-line-modified-removed">-   void insert(ZListNode&lt;T&gt;* before, ZListNode&lt;T&gt;* node) {</span>
<span class="udiff-line-removed">-     verify();</span>
<span class="udiff-line-modified-added">+   void insert(ZListNode&lt;T&gt;* before, ZListNode&lt;T&gt;* node);</span>
  
<span class="udiff-line-modified-removed">-     assert(node-&gt;is_unused(), &quot;Already in a list&quot;);</span>
<span class="udiff-line-modified-removed">-     node-&gt;_prev = before;</span>
<span class="udiff-line-removed">-     node-&gt;_next = before-&gt;_next;</span>
<span class="udiff-line-removed">-     before-&gt;_next = node;</span>
<span class="udiff-line-removed">-     node-&gt;_next-&gt;_prev = node;</span>
<span class="udiff-line-modified-added">+   ZListNode&lt;T&gt;* cast_to_inner(T* elem) const;</span>
<span class="udiff-line-modified-added">+   T* cast_to_outer(ZListNode&lt;T&gt;* node) const;</span>
  
<span class="udiff-line-modified-removed">-     _size++;</span>
<span class="udiff-line-modified-removed">-   }</span>
<span class="udiff-line-modified-added">+ public:</span>
<span class="udiff-line-modified-added">+   ZList();</span>
  
<span class="udiff-line-modified-removed">-   ZListNode&lt;T&gt;* cast_to_inner(T* elem) const {</span>
<span class="udiff-line-modified-removed">-     return &amp;elem-&gt;_node;</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-modified-added">+   size_t size() const;</span>
<span class="udiff-line-modified-added">+   bool is_empty() const;</span>
  
<span class="udiff-line-modified-removed">-   T* cast_to_outer(ZListNode&lt;T&gt;* node) const {</span>
<span class="udiff-line-modified-removed">-     return (T*)((uintptr_t)node - offset_of(T, _node));</span>
<span class="udiff-line-modified-removed">-   }</span>
<span class="udiff-line-modified-added">+   T* first() const;</span>
<span class="udiff-line-modified-added">+   T* last() const;</span>
<span class="udiff-line-modified-added">+   T* next(T* elem) const;</span>
<span class="udiff-line-added">+   T* prev(T* elem) const;</span>
  
<span class="udiff-line-modified-removed">- public:</span>
<span class="udiff-line-modified-removed">-   ZList() :</span>
<span class="udiff-line-modified-removed">-       _head(&amp;_head, &amp;_head),</span>
<span class="udiff-line-modified-removed">-       _size(0) {</span>
<span class="udiff-line-modified-removed">-     verify();</span>
<span class="udiff-line-modified-removed">-   }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-   size_t size() const {</span>
<span class="udiff-line-modified-removed">-     verify();</span>
<span class="udiff-line-modified-removed">-     return _size;</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   bool is_empty() const {</span>
<span class="udiff-line-removed">-     return _size == 0;</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   T* first() const {</span>
<span class="udiff-line-removed">-     return is_empty() ? NULL : cast_to_outer(_head._next);</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   T* last() const {</span>
<span class="udiff-line-removed">-     return is_empty() ? NULL : cast_to_outer(_head._prev);</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   T* next(T* elem) const {</span>
<span class="udiff-line-removed">-     verify();</span>
<span class="udiff-line-removed">-     ZListNode&lt;T&gt;* next = cast_to_inner(elem)-&gt;_next;</span>
<span class="udiff-line-removed">-     return (next == &amp;_head) ? NULL : cast_to_outer(next);</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   T* prev(T* elem) const {</span>
<span class="udiff-line-removed">-     verify();</span>
<span class="udiff-line-removed">-     ZListNode&lt;T&gt;* prev = cast_to_inner(elem)-&gt;_prev;</span>
<span class="udiff-line-removed">-     return (prev == &amp;_head) ? NULL : cast_to_outer(prev);</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   void insert_first(T* elem) {</span>
<span class="udiff-line-removed">-     insert(&amp;_head, cast_to_inner(elem));</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   void insert_last(T* elem) {</span>
<span class="udiff-line-removed">-     insert(_head._prev, cast_to_inner(elem));</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   void insert_before(T* before, T* elem) {</span>
<span class="udiff-line-removed">-     insert(cast_to_inner(before)-&gt;_prev, cast_to_inner(elem));</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   void insert_after(T* after, T* elem) {</span>
<span class="udiff-line-removed">-     insert(cast_to_inner(after), cast_to_inner(elem));</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   void remove(T* elem) {</span>
<span class="udiff-line-removed">-     verify();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     ZListNode&lt;T&gt;* const node = cast_to_inner(elem);</span>
<span class="udiff-line-removed">-     assert(!node-&gt;is_unused(), &quot;Not in a list&quot;);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     ZListNode&lt;T&gt;* const next = node-&gt;_next;</span>
<span class="udiff-line-removed">-     ZListNode&lt;T&gt;* const prev = node-&gt;_prev;</span>
<span class="udiff-line-removed">-     assert(next-&gt;_prev == node, &quot;List corrupt&quot;);</span>
<span class="udiff-line-removed">-     assert(prev-&gt;_next == node, &quot;List corrupt&quot;);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     prev-&gt;_next = next;</span>
<span class="udiff-line-removed">-     next-&gt;_prev = prev;</span>
<span class="udiff-line-removed">-     node-&gt;set_unused();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     _size--;</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   T* remove_first() {</span>
<span class="udiff-line-removed">-     T* elem = first();</span>
<span class="udiff-line-removed">-     if (elem != NULL) {</span>
<span class="udiff-line-removed">-       remove(elem);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     return elem;</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   T* remove_last() {</span>
<span class="udiff-line-removed">-     T* elem = last();</span>
<span class="udiff-line-removed">-     if (elem != NULL) {</span>
<span class="udiff-line-removed">-       remove(elem);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     return elem;</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   void transfer(ZList&lt;T&gt;* list) {</span>
<span class="udiff-line-removed">-     verify();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if (!list-&gt;is_empty()) {</span>
<span class="udiff-line-removed">-       list-&gt;_head._next-&gt;_prev = _head._prev;</span>
<span class="udiff-line-removed">-       list-&gt;_head._prev-&gt;_next = _head._prev-&gt;_next;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-       _head._prev-&gt;_next = list-&gt;_head._next;</span>
<span class="udiff-line-removed">-       _head._prev = list-&gt;_head._prev;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-       list-&gt;_head._next = &amp;list-&gt;_head;</span>
<span class="udiff-line-removed">-       list-&gt;_head._prev = &amp;list-&gt;_head;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-       _size += list-&gt;_size;</span>
<span class="udiff-line-removed">-       list-&gt;_size = 0;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-       list-&gt;verify();</span>
<span class="udiff-line-removed">-       verify();</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-modified-added">+   void insert_first(T* elem);</span>
<span class="udiff-line-modified-added">+   void insert_last(T* elem);</span>
<span class="udiff-line-modified-added">+   void insert_before(T* before, T* elem);</span>
<span class="udiff-line-modified-added">+   void insert_after(T* after, T* elem);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   void remove(T* elem);</span>
<span class="udiff-line-modified-added">+   T* remove_first();</span>
<span class="udiff-line-modified-added">+   T* remove_last();</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   void transfer(ZList&lt;T&gt;* list);</span>
  };
  
  template &lt;typename T, bool forward&gt;
  class ZListIteratorImpl : public StackObj {
  private:
<span class="udiff-line-modified-removed">-   ZList&lt;T&gt;* const _list;</span>
<span class="udiff-line-modified-removed">-   T*              _next;</span>
<span class="udiff-line-modified-added">+   const ZList&lt;T&gt;* const _list;</span>
<span class="udiff-line-modified-added">+   T*                    _next;</span>
  
  public:
<span class="udiff-line-modified-removed">-   ZListIteratorImpl(ZList&lt;T&gt;* list);</span>
<span class="udiff-line-modified-added">+   ZListIteratorImpl(const ZList&lt;T&gt;* list);</span>
  
    bool next(T** elem);
  };
  
  // Iterator types
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -224,17 +105,15 @@</span>
  #define ZLIST_REVERSE        false
  
  template &lt;typename T&gt;
  class ZListIterator : public ZListIteratorImpl&lt;T, ZLIST_FORWARD&gt; {
  public:
<span class="udiff-line-modified-removed">-   ZListIterator(ZList&lt;T&gt;* list) :</span>
<span class="udiff-line-removed">-       ZListIteratorImpl&lt;T, ZLIST_FORWARD&gt;(list) {}</span>
<span class="udiff-line-modified-added">+   ZListIterator(const ZList&lt;T&gt;* list);</span>
  };
  
  template &lt;typename T&gt;
  class ZListReverseIterator : public ZListIteratorImpl&lt;T, ZLIST_REVERSE&gt; {
  public:
<span class="udiff-line-modified-removed">-   ZListReverseIterator(ZList&lt;T&gt;* list) :</span>
<span class="udiff-line-removed">-       ZListIteratorImpl&lt;T, ZLIST_REVERSE&gt;(list) {}</span>
<span class="udiff-line-modified-added">+   ZListReverseIterator(const ZList&lt;T&gt;* list);</span>
  };
  
  #endif // SHARE_GC_Z_ZLIST_HPP
</pre>
<center><a href="zInitialize.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="zList.inline.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>