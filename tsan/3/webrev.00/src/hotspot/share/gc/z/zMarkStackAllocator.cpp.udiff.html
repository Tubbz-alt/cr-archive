<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/gc/z/zMarkStackAllocator.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="zMarkStack.inline.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="zMarkStackAllocator.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/z/zMarkStackAllocator.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -68,11 +68,11 @@</span>
      if (new_top &gt; end) {
        // Not enough space left
        return 0;
      }
  
<span class="udiff-line-modified-removed">-     const uintptr_t prev_top = Atomic::cmpxchg(new_top, &amp;_top, top);</span>
<span class="udiff-line-modified-added">+     const uintptr_t prev_top = Atomic::cmpxchg(&amp;_top, top, new_top);</span>
      if (prev_top == top) {
        // Success
        return top;
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -108,12 +108,12 @@</span>
    // Expand
    os::commit_memory_or_exit((char*)_end, expand_size, false /* executable */, &quot;Mark stack space&quot;);
  
    // Increment top before end to make sure another
    // thread can&#39;t steal out newly expanded space.
<span class="udiff-line-modified-removed">-   addr = Atomic::add(size, &amp;_top) - size;</span>
<span class="udiff-line-modified-removed">-   Atomic::add(expand_size, &amp;_end);</span>
<span class="udiff-line-modified-added">+   addr = Atomic::fetch_and_add(&amp;_top, size);</span>
<span class="udiff-line-modified-added">+   Atomic::add(&amp;_end, expand_size);</span>
  
    return addr;
  }
  
  uintptr_t ZMarkStackSpace::alloc(size_t size) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -164,11 +164,11 @@</span>
    return magazine;
  }
  
  ZMarkStackMagazine* ZMarkStackAllocator::alloc_magazine() {
    // Try allocating from the free list first
<span class="udiff-line-modified-removed">-   ZMarkStackMagazine* const magazine = _freelist.pop_atomic();</span>
<span class="udiff-line-modified-added">+   ZMarkStackMagazine* const magazine = _freelist.pop();</span>
    if (magazine != NULL) {
      return magazine;
    }
  
    // Allocate new magazine
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -179,7 +179,7 @@</span>
  
    return create_magazine_from_space(addr, ZMarkStackMagazineSize);
  }
  
  void ZMarkStackAllocator::free_magazine(ZMarkStackMagazine* magazine) {
<span class="udiff-line-modified-removed">-   _freelist.push_atomic(magazine);</span>
<span class="udiff-line-modified-added">+   _freelist.push(magazine);</span>
  }
</pre>
<center><a href="zMarkStack.inline.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="zMarkStackAllocator.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>