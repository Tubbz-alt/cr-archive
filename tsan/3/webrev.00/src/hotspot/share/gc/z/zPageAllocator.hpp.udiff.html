<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/gc/z/zPageAllocator.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="zPageAllocator.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="zPageCache.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/z/zPageAllocator.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2015, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -27,86 +27,105 @@</span>
  #include &quot;gc/z/zAllocationFlags.hpp&quot;
  #include &quot;gc/z/zList.hpp&quot;
  #include &quot;gc/z/zLock.hpp&quot;
  #include &quot;gc/z/zPageCache.hpp&quot;
  #include &quot;gc/z/zPhysicalMemory.hpp&quot;
<span class="udiff-line-modified-removed">- #include &quot;gc/z/zPreMappedMemory.hpp&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;gc/z/zSafeDelete.hpp&quot;</span>
  #include &quot;gc/z/zVirtualMemory.hpp&quot;
  #include &quot;memory/allocation.hpp&quot;
  
  class ZPageAllocRequest;
<span class="udiff-line-added">+ class ZWorkers;</span>
  
  class ZPageAllocator {
    friend class VMStructs;
  
  private:
<span class="udiff-line-modified-removed">-   ZLock                    _lock;</span>
<span class="udiff-line-modified-removed">-   ZVirtualMemoryManager    _virtual;</span>
<span class="udiff-line-modified-removed">-   ZPhysicalMemoryManager   _physical;</span>
<span class="udiff-line-modified-removed">-   ZPageCache               _cache;</span>
<span class="udiff-line-modified-removed">-   const size_t             _max_reserve;</span>
<span class="udiff-line-modified-removed">-   ZPreMappedMemory         _pre_mapped;</span>
<span class="udiff-line-modified-removed">-   size_t                   _used_high;</span>
<span class="udiff-line-modified-removed">-   size_t                   _used_low;</span>
<span class="udiff-line-modified-removed">-   size_t                   _used;</span>
<span class="udiff-line-modified-removed">-   size_t                   _allocated;</span>
<span class="udiff-line-modified-removed">-   ssize_t                  _reclaimed;</span>
<span class="udiff-line-modified-removed">-   ZList&lt;ZPageAllocRequest&gt; _queue;</span>
<span class="udiff-line-modified-removed">-   ZList&lt;ZPage&gt;             _detached;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-   static ZPage* const      gc_marker;</span>
<span class="udiff-line-modified-added">+   ZLock                      _lock;</span>
<span class="udiff-line-modified-added">+   ZVirtualMemoryManager      _virtual;</span>
<span class="udiff-line-modified-added">+   ZPhysicalMemoryManager     _physical;</span>
<span class="udiff-line-modified-added">+   ZPageCache                 _cache;</span>
<span class="udiff-line-modified-added">+   const size_t               _min_capacity;</span>
<span class="udiff-line-modified-added">+   const size_t               _max_capacity;</span>
<span class="udiff-line-modified-added">+   const size_t               _max_reserve;</span>
<span class="udiff-line-modified-added">+   size_t                     _current_max_capacity;</span>
<span class="udiff-line-modified-added">+   size_t                     _capacity;</span>
<span class="udiff-line-modified-added">+   size_t                     _used_high;</span>
<span class="udiff-line-modified-added">+   size_t                     _used_low;</span>
<span class="udiff-line-modified-added">+   size_t                     _used;</span>
<span class="udiff-line-modified-added">+   size_t                     _allocated;</span>
<span class="udiff-line-modified-added">+   ssize_t                    _reclaimed;</span>
<span class="udiff-line-modified-added">+   ZList&lt;ZPageAllocRequest&gt;   _queue;</span>
<span class="udiff-line-added">+   ZList&lt;ZPageAllocRequest&gt;   _satisfied;</span>
<span class="udiff-line-added">+   mutable ZSafeDelete&lt;ZPage&gt; _safe_delete;</span>
<span class="udiff-line-added">+   bool                       _uncommit;</span>
<span class="udiff-line-added">+   bool                       _initialized;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   static ZPage* const gc_marker;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   void prime_cache(ZWorkers* workers, size_t size);</span>
  
    void increase_used(size_t size, bool relocation);
    void decrease_used(size_t size, bool reclaimed);
  
<span class="udiff-line-removed">-   size_t max_available(bool no_reserve) const;</span>
<span class="udiff-line-removed">-   size_t try_ensure_unused(size_t size, bool no_reserve);</span>
<span class="udiff-line-removed">-   size_t try_ensure_unused_for_pre_mapped(size_t size);</span>
<span class="udiff-line-removed">- </span>
    ZPage* create_page(uint8_t type, size_t size);
<span class="udiff-line-modified-removed">-   void map_page(ZPage* page);</span>
<span class="udiff-line-modified-removed">-   void detach_page(ZPage* page);</span>
<span class="udiff-line-modified-removed">-   void flush_pre_mapped();</span>
<span class="udiff-line-modified-removed">-   void flush_cache(size_t size);</span>
<span class="udiff-line-modified-added">+   void destroy_page(ZPage* page);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   size_t max_available(bool no_reserve) const;</span>
<span class="udiff-line-modified-added">+   bool ensure_available(size_t size, bool no_reserve);</span>
<span class="udiff-line-added">+   void ensure_uncached_available(size_t size);</span>
  
    void check_out_of_memory_during_initialization();
  
<span class="udiff-line-modified-removed">-   ZPage* alloc_page_common_inner(uint8_t type, size_t size, ZAllocationFlags flags);</span>
<span class="udiff-line-modified-added">+   ZPage* alloc_page_common_inner(uint8_t type, size_t size, bool no_reserve);</span>
    ZPage* alloc_page_common(uint8_t type, size_t size, ZAllocationFlags flags);
    ZPage* alloc_page_blocking(uint8_t type, size_t size, ZAllocationFlags flags);
    ZPage* alloc_page_nonblocking(uint8_t type, size_t size, ZAllocationFlags flags);
  
<span class="udiff-line-modified-removed">-   void satisfy_alloc_queue();</span>
<span class="udiff-line-modified-added">+   size_t flush_cache(ZPageCacheFlushClosure* cl);</span>
<span class="udiff-line-added">+   void flush_cache_for_allocation(size_t requested);</span>
  
<span class="udiff-line-modified-removed">-   void detach_memory(const ZVirtualMemory&amp; vmem, ZPhysicalMemory&amp; pmem);</span>
<span class="udiff-line-modified-added">+   void satisfy_alloc_queue();</span>
  
  public:
<span class="udiff-line-modified-removed">-   ZPageAllocator(size_t min_capacity, size_t max_capacity, size_t max_reserve);</span>
<span class="udiff-line-modified-added">+   ZPageAllocator(ZWorkers* workers,</span>
<span class="udiff-line-added">+                  size_t min_capacity,</span>
<span class="udiff-line-added">+                  size_t initial_capacity,</span>
<span class="udiff-line-added">+                  size_t max_capacity,</span>
<span class="udiff-line-added">+                  size_t max_reserve);</span>
  
    bool is_initialized() const;
  
<span class="udiff-line-added">+   size_t min_capacity() const;</span>
    size_t max_capacity() const;
<span class="udiff-line-modified-removed">-   size_t current_max_capacity() const;</span>
<span class="udiff-line-modified-added">+   size_t soft_max_capacity() const;</span>
    size_t capacity() const;
    size_t max_reserve() const;
    size_t used_high() const;
    size_t used_low() const;
    size_t used() const;
<span class="udiff-line-added">+   size_t unused() const;</span>
    size_t allocated() const;
    size_t reclaimed() const;
  
    void reset_statistics();
  
    ZPage* alloc_page(uint8_t type, size_t size, ZAllocationFlags flags);
<span class="udiff-line-removed">-   void flip_page(ZPage* page);</span>
    void free_page(ZPage* page, bool reclaimed);
<span class="udiff-line-removed">-   void destroy_page(ZPage* page);</span>
  
<span class="udiff-line-modified-removed">-   void flush_detached_pages(ZList&lt;ZPage&gt;* list);</span>
<span class="udiff-line-modified-added">+   uint64_t uncommit(uint64_t delay);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   void enable_deferred_delete() const;</span>
<span class="udiff-line-added">+   void disable_deferred_delete() const;</span>
  
<span class="udiff-line-modified-removed">-   void flip_pre_mapped();</span>
<span class="udiff-line-modified-added">+   void map_page(const ZPage* page) const;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   void debug_map_page(const ZPage* page) const;</span>
<span class="udiff-line-added">+   void debug_unmap_page(const ZPage* page) const;</span>
  
    bool is_alloc_stalled() const;
    void check_out_of_memory();
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   void pages_do(ZPageClosure* cl) const;</span>
  };
  
  #endif // SHARE_GC_Z_ZPAGEALLOCATOR_HPP
</pre>
<center><a href="zPageAllocator.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="zPageCache.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>