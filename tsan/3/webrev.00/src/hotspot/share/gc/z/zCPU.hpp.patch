diff a/src/hotspot/share/gc/z/zCPU.hpp b/src/hotspot/share/gc/z/zCPU.hpp
--- a/src/hotspot/share/gc/z/zCPU.hpp
+++ b/src/hotspot/share/gc/z/zCPU.hpp
@@ -1,7 +1,7 @@
 /*
- * Copyright (c) 2015, 2017, Oracle and/or its affiliates. All rights reserved.
+ * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.
  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  *
  * This code is free software; you can redistribute it and/or modify it
  * under the terms of the GNU General Public License version 2 only, as
  * published by the Free Software Foundation.
@@ -24,22 +24,25 @@
 #ifndef SHARE_GC_Z_ZCPU_HPP
 #define SHARE_GC_Z_ZCPU_HPP
 
 #include "memory/allocation.hpp"
 #include "memory/padded.hpp"
+#include "utilities/globalDefinitions.hpp"
 
 class Thread;
 
 class ZCPU : public AllStatic {
 private:
   struct ZCPUAffinity {
     Thread* _thread;
   };
 
   static PaddedEnd<ZCPUAffinity>* _affinity;
-  static __thread Thread*         _self;
-  static __thread uint32_t        _cpu;
+  static THREAD_LOCAL Thread*     _self;
+  static THREAD_LOCAL uint32_t    _cpu;
+
+  static uint32_t id_slow();
 
 public:
   static void initialize();
 
   static uint32_t count();
