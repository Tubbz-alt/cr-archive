<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/gc/z/zRelocationSetSelector.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="zRelocationSetSelector.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="zResurrection.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/z/zRelocationSetSelector.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2017, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -28,57 +28,90 @@</span>
  #include &quot;memory/allocation.hpp&quot;
  
  class ZPage;
  class ZRelocationSet;
  
<span class="udiff-line-added">+ class ZRelocationSetSelectorGroupStats {</span>
<span class="udiff-line-added">+   friend class ZRelocationSetSelectorGroup;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ private:</span>
<span class="udiff-line-added">+   size_t _npages;</span>
<span class="udiff-line-added">+   size_t _total;</span>
<span class="udiff-line-added">+   size_t _live;</span>
<span class="udiff-line-added">+   size_t _garbage;</span>
<span class="udiff-line-added">+   size_t _empty;</span>
<span class="udiff-line-added">+   size_t _compacting_from;</span>
<span class="udiff-line-added">+   size_t _compacting_to;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ public:</span>
<span class="udiff-line-added">+   ZRelocationSetSelectorGroupStats();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   size_t npages() const;</span>
<span class="udiff-line-added">+   size_t total() const;</span>
<span class="udiff-line-added">+   size_t live() const;</span>
<span class="udiff-line-added">+   size_t garbage() const;</span>
<span class="udiff-line-added">+   size_t empty() const;</span>
<span class="udiff-line-added">+   size_t compacting_from() const;</span>
<span class="udiff-line-added">+   size_t compacting_to() const;</span>
<span class="udiff-line-added">+ };</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ class ZRelocationSetSelectorStats {</span>
<span class="udiff-line-added">+   friend class ZRelocationSetSelector;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ private:</span>
<span class="udiff-line-added">+   ZRelocationSetSelectorGroupStats _small;</span>
<span class="udiff-line-added">+   ZRelocationSetSelectorGroupStats _medium;</span>
<span class="udiff-line-added">+   ZRelocationSetSelectorGroupStats _large;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ public:</span>
<span class="udiff-line-added">+   const ZRelocationSetSelectorGroupStats&amp; small() const;</span>
<span class="udiff-line-added">+   const ZRelocationSetSelectorGroupStats&amp; medium() const;</span>
<span class="udiff-line-added">+   const ZRelocationSetSelectorGroupStats&amp; large() const;</span>
<span class="udiff-line-added">+ };</span>
<span class="udiff-line-added">+ </span>
  class ZRelocationSetSelectorGroup {
  private:
<span class="udiff-line-modified-removed">-   const char* const    _name;</span>
<span class="udiff-line-modified-removed">-   const size_t         _page_size;</span>
<span class="udiff-line-modified-removed">-   const size_t         _object_size_limit;</span>
<span class="udiff-line-modified-removed">-   const size_t         _fragmentation_limit;</span>
<span class="udiff-line-modified-added">+   const char* const                _name;</span>
<span class="udiff-line-modified-added">+   const size_t                     _page_size;</span>
<span class="udiff-line-modified-added">+   const size_t                     _object_size_limit;</span>
<span class="udiff-line-modified-added">+   const size_t                     _fragmentation_limit;</span>
  
<span class="udiff-line-modified-removed">-   ZArray&lt;const ZPage*&gt; _registered_pages;</span>
<span class="udiff-line-modified-removed">-   const ZPage**        _sorted_pages;</span>
<span class="udiff-line-modified-removed">-   size_t               _nselected;</span>
<span class="udiff-line-modified-removed">-   size_t               _relocating;</span>
<span class="udiff-line-removed">-   size_t               _fragmentation;</span>
<span class="udiff-line-modified-added">+   ZArray&lt;ZPage*&gt;                   _registered_pages;</span>
<span class="udiff-line-modified-added">+   ZPage**                          _sorted_pages;</span>
<span class="udiff-line-modified-added">+   size_t                           _nselected;</span>
<span class="udiff-line-modified-added">+   ZRelocationSetSelectorGroupStats _stats;</span>
  
    void semi_sort();
  
  public:
    ZRelocationSetSelectorGroup(const char* name,
                                size_t page_size,
                                size_t object_size_limit);
    ~ZRelocationSetSelectorGroup();
  
<span class="udiff-line-modified-removed">-   void register_live_page(const ZPage* page, size_t garbage);</span>
<span class="udiff-line-modified-added">+   void register_live_page(ZPage* page);</span>
<span class="udiff-line-added">+   void register_garbage_page(ZPage* page);</span>
    void select();
  
<span class="udiff-line-modified-removed">-   const ZPage* const* selected() const;</span>
<span class="udiff-line-modified-added">+   ZPage* const* selected() const;</span>
    size_t nselected() const;
<span class="udiff-line-modified-removed">-   size_t relocating() const;</span>
<span class="udiff-line-modified-removed">-   size_t fragmentation() const;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   const ZRelocationSetSelectorGroupStats&amp; stats() const;</span>
  };
  
  class ZRelocationSetSelector : public StackObj {
  private:
    ZRelocationSetSelectorGroup _small;
    ZRelocationSetSelectorGroup _medium;
<span class="udiff-line-modified-removed">-   size_t                      _live;</span>
<span class="udiff-line-removed">-   size_t                      _garbage;</span>
<span class="udiff-line-removed">-   size_t                      _fragmentation;</span>
<span class="udiff-line-modified-added">+   ZRelocationSetSelectorGroup _large;</span>
  
  public:
    ZRelocationSetSelector();
  
<span class="udiff-line-modified-removed">-   void register_live_page(const ZPage* page);</span>
<span class="udiff-line-modified-removed">-   void register_garbage_page(const ZPage* page);</span>
<span class="udiff-line-modified-added">+   void register_live_page(ZPage* page);</span>
<span class="udiff-line-modified-added">+   void register_garbage_page(ZPage* page);</span>
    void select(ZRelocationSet* relocation_set);
  
<span class="udiff-line-modified-removed">-   size_t live() const;</span>
<span class="udiff-line-removed">-   size_t garbage() const;</span>
<span class="udiff-line-removed">-   size_t relocating() const;</span>
<span class="udiff-line-removed">-   size_t fragmentation() const;</span>
<span class="udiff-line-modified-added">+   ZRelocationSetSelectorStats stats() const;</span>
  };
  
  #endif // SHARE_GC_Z_ZRELOCATIONSETSELECTOR_HPP
</pre>
<center><a href="zRelocationSetSelector.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="zResurrection.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>