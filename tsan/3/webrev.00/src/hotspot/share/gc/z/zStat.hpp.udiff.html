<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/gc/z/zStat.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="zStat.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="zThread.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/z/zStat.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2015, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2015, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -23,18 +23,22 @@</span>
  
  #ifndef SHARE_GC_Z_ZSTAT_HPP
  #define SHARE_GC_Z_ZSTAT_HPP
  
  #include &quot;gc/shared/concurrentGCThread.hpp&quot;
<span class="udiff-line-added">+ #include &quot;gc/shared/gcCause.hpp&quot;</span>
  #include &quot;gc/shared/gcTimer.hpp&quot;
  #include &quot;gc/z/zMetronome.hpp&quot;
  #include &quot;logging/logHandle.hpp&quot;
  #include &quot;memory/allocation.hpp&quot;
<span class="udiff-line-added">+ #include &quot;utilities/globalDefinitions.hpp&quot;</span>
  #include &quot;utilities/numberSeq.hpp&quot;
  #include &quot;utilities/ticks.hpp&quot;
  
  class ZPage;
<span class="udiff-line-added">+ class ZRelocationSetSelectorGroupStats;</span>
<span class="udiff-line-added">+ class ZRelocationSetSelectorStats;</span>
  class ZStatSampler;
  class ZStatSamplerHistory;
  struct ZStatCounterData;
  struct ZStatSamplerData;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -267,33 +271,57 @@</span>
  };
  
  //
  // Stat timer
  //
<span class="udiff-line-added">+ class ZStatTimerDisable : public StackObj {</span>
<span class="udiff-line-added">+ private:</span>
<span class="udiff-line-added">+   static THREAD_LOCAL uint32_t _active;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ public:</span>
<span class="udiff-line-added">+   ZStatTimerDisable() {</span>
<span class="udiff-line-added">+     _active++;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   ~ZStatTimerDisable() {</span>
<span class="udiff-line-added">+     _active--;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   static bool is_active() {</span>
<span class="udiff-line-added">+     return _active &gt; 0;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ };</span>
<span class="udiff-line-added">+ </span>
  class ZStatTimer : public StackObj {
  private:
<span class="udiff-line-added">+   const bool        _enabled;</span>
    const ZStatPhase&amp; _phase;
    const Ticks       _start;
  
  public:
    ZStatTimer(const ZStatPhase&amp; phase) :
<span class="udiff-line-added">+       _enabled(!ZStatTimerDisable::is_active()),</span>
        _phase(phase),
        _start(Ticks::now()) {
<span class="udiff-line-modified-removed">-     _phase.register_start(_start);</span>
<span class="udiff-line-modified-added">+     if (_enabled) {</span>
<span class="udiff-line-added">+       _phase.register_start(_start);</span>
<span class="udiff-line-added">+     }</span>
    }
  
    ~ZStatTimer() {
<span class="udiff-line-modified-removed">-     const Ticks end = Ticks::now();</span>
<span class="udiff-line-modified-removed">-     _phase.register_end(_start, end);</span>
<span class="udiff-line-modified-added">+     if (_enabled) {</span>
<span class="udiff-line-modified-added">+       const Ticks end = Ticks::now();</span>
<span class="udiff-line-added">+       _phase.register_end(_start, end);</span>
<span class="udiff-line-added">+     }</span>
    }
  };
  
  //
  // Stat sample/increment
  //
<span class="udiff-line-modified-removed">- void ZStatSample(const ZStatSampler&amp; sampler, uint64_t value, bool trace = ZStatisticsForceTrace);</span>
<span class="udiff-line-modified-removed">- void ZStatInc(const ZStatCounter&amp; counter, uint64_t increment = 1, bool trace = ZStatisticsForceTrace);</span>
<span class="udiff-line-modified-added">+ void ZStatSample(const ZStatSampler&amp; sampler, uint64_t value);</span>
<span class="udiff-line-modified-added">+ void ZStatInc(const ZStatCounter&amp; counter, uint64_t increment = 1);</span>
  void ZStatInc(const ZStatUnsampledCounter&amp; counter, uint64_t increment = 1);
  
  //
  // Stat allocation rate
  //
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -338,21 +366,25 @@</span>
  //
  // Stat cycle
  //
  class ZStatCycle : public AllStatic {
  private:
<span class="udiff-line-modified-removed">-   static uint64_t  _ncycles;</span>
<span class="udiff-line-modified-added">+   static uint64_t  _nwarmup_cycles;</span>
    static Ticks     _start_of_last;
    static Ticks     _end_of_last;
    static NumberSeq _normalized_duration;
  
  public:
    static void at_start();
<span class="udiff-line-modified-removed">-   static void at_end(double boost_factor);</span>
<span class="udiff-line-modified-added">+   static void at_end(GCCause::Cause cause, double boost_factor);</span>
  
<span class="udiff-line-modified-removed">-   static uint64_t ncycles();</span>
<span class="udiff-line-modified-added">+   static bool is_warm();</span>
<span class="udiff-line-added">+   static uint64_t nwarmup_cycles();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   static bool is_normalized_duration_trustable();</span>
    static const AbsSeq&amp; normalized_duration();
<span class="udiff-line-added">+ </span>
    static double time_since_last();
  };
  
  //
  // Stat load
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -386,15 +418,17 @@</span>
  //
  // Stat relocation
  //
  class ZStatRelocation : public AllStatic {
  private:
<span class="udiff-line-modified-removed">-   static size_t _relocating;</span>
<span class="udiff-line-modified-removed">-   static bool   _success;</span>
<span class="udiff-line-modified-added">+   static ZRelocationSetSelectorStats _stats;</span>
<span class="udiff-line-modified-added">+   static bool                        _success;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   static void print(const char* name, const ZRelocationSetSelectorGroupStats&amp; group);</span>
  
  public:
<span class="udiff-line-modified-removed">-   static void set_at_select_relocation_set(size_t relocating);</span>
<span class="udiff-line-modified-added">+   static void set_at_select_relocation_set(const ZRelocationSetSelectorStats&amp; stats);</span>
    static void set_at_relocate_end(bool success);
  
    static void print();
  };
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -441,15 +475,17 @@</span>
  // Stat heap
  //
  class ZStatHeap : public AllStatic {
  private:
    static struct ZAtInitialize {
<span class="udiff-line-added">+     size_t min_capacity;</span>
      size_t max_capacity;
      size_t max_reserve;
    } _at_initialize;
  
    static struct ZAtMarkStart {
<span class="udiff-line-added">+     size_t soft_max_capacity;</span>
      size_t capacity;
      size_t reserve;
      size_t used;
      size_t free;
    } _at_mark_start;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -490,24 +526,27 @@</span>
      size_t free;
      size_t free_high;
      size_t free_low;
    } _at_relocate_end;
  
<span class="udiff-line-added">+   static size_t capacity_high();</span>
<span class="udiff-line-added">+   static size_t capacity_low();</span>
    static size_t available(size_t used);
    static size_t reserve(size_t used);
    static size_t free(size_t used);
  
  public:
<span class="udiff-line-modified-removed">-   static void set_at_initialize(size_t max_capacity,</span>
<span class="udiff-line-modified-added">+   static void set_at_initialize(size_t min_capacity,</span>
<span class="udiff-line-added">+                                 size_t max_capacity,</span>
                                  size_t max_reserve);
<span class="udiff-line-modified-removed">-   static void set_at_mark_start(size_t capacity,</span>
<span class="udiff-line-modified-added">+   static void set_at_mark_start(size_t soft_max_capacity,</span>
<span class="udiff-line-added">+                                 size_t capacity,</span>
                                  size_t used);
    static void set_at_mark_end(size_t capacity,
                                size_t allocated,
                                size_t used);
<span class="udiff-line-modified-removed">-   static void set_at_select_relocation_set(size_t live,</span>
<span class="udiff-line-removed">-                                            size_t garbage,</span>
<span class="udiff-line-modified-added">+   static void set_at_select_relocation_set(const ZRelocationSetSelectorStats&amp; stats,</span>
                                             size_t reclaimed);
    static void set_at_relocate_start(size_t capacity,
                                      size_t allocated,
                                      size_t used);
    static void set_at_relocate_end(size_t capacity,
</pre>
<center><a href="zStat.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="zThread.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>