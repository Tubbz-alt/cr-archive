<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/parallel/psVMOperations.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="psScavenge.inline.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="psVirtualspace.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/parallel/psVMOperations.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
32 // The following methods are used by the parallel scavenge collector
33 VM_ParallelGCFailedAllocation::VM_ParallelGCFailedAllocation(size_t word_size,
34                                                              uint gc_count) :
35     VM_CollectForAllocation(word_size, gc_count, GCCause::_allocation_failure) {
36   assert(word_size != 0, &quot;An allocation should always be requested with this operation.&quot;);
37 }
38 
39 void VM_ParallelGCFailedAllocation::doit() {
40   SvcGCMarker sgcm(SvcGCMarker::MINOR);
41 
42   ParallelScavengeHeap* heap = ParallelScavengeHeap::heap();
43 
44   GCCauseSetter gccs(heap, _gc_cause);
45   _result = heap-&gt;failed_mem_allocate(_word_size);
46 
47   if (_result == NULL &amp;&amp; GCLocker::is_active_and_needs_gc()) {
48     set_gc_locked();
49   }
50 }
51 





52 // Only used for System.gc() calls
53 VM_ParallelGCSystemGC::VM_ParallelGCSystemGC(uint gc_count,
54                                              uint full_gc_count,
55                                              GCCause::Cause gc_cause) :
<span class="line-modified">56   VM_GC_Operation(gc_count, gc_cause, full_gc_count, true /* full */)</span>
57 {
58 }
59 
60 void VM_ParallelGCSystemGC::doit() {
61   SvcGCMarker sgcm(SvcGCMarker::FULL);
62 
63   ParallelScavengeHeap* heap = ParallelScavengeHeap::heap();
64 
65   GCCauseSetter gccs(heap, _gc_cause);
<span class="line-modified">66   if (_gc_cause == GCCause::_gc_locker || _gc_cause == GCCause::_wb_young_gc</span>
<span class="line-removed">67       DEBUG_ONLY(|| _gc_cause == GCCause::_scavenge_alot)) {</span>
68     // If (and only if) the scavenge fails, this will invoke a full gc.
69     heap-&gt;invoke_scavenge();
70   } else {
71     heap-&gt;do_full_collection(false);
72   }
73 }
</pre>
</td>
<td>
<hr />
<pre>
32 // The following methods are used by the parallel scavenge collector
33 VM_ParallelGCFailedAllocation::VM_ParallelGCFailedAllocation(size_t word_size,
34                                                              uint gc_count) :
35     VM_CollectForAllocation(word_size, gc_count, GCCause::_allocation_failure) {
36   assert(word_size != 0, &quot;An allocation should always be requested with this operation.&quot;);
37 }
38 
39 void VM_ParallelGCFailedAllocation::doit() {
40   SvcGCMarker sgcm(SvcGCMarker::MINOR);
41 
42   ParallelScavengeHeap* heap = ParallelScavengeHeap::heap();
43 
44   GCCauseSetter gccs(heap, _gc_cause);
45   _result = heap-&gt;failed_mem_allocate(_word_size);
46 
47   if (_result == NULL &amp;&amp; GCLocker::is_active_and_needs_gc()) {
48     set_gc_locked();
49   }
50 }
51 
<span class="line-added">52 static bool is_cause_full(GCCause::Cause cause) {</span>
<span class="line-added">53   return (cause != GCCause::_gc_locker) &amp;&amp; (cause != GCCause::_wb_young_gc)</span>
<span class="line-added">54          DEBUG_ONLY(&amp;&amp; (cause != GCCause::_scavenge_alot));</span>
<span class="line-added">55 }</span>
<span class="line-added">56 </span>
57 // Only used for System.gc() calls
58 VM_ParallelGCSystemGC::VM_ParallelGCSystemGC(uint gc_count,
59                                              uint full_gc_count,
60                                              GCCause::Cause gc_cause) :
<span class="line-modified">61   VM_GC_Operation(gc_count, gc_cause, full_gc_count, is_cause_full(gc_cause))</span>
62 {
63 }
64 
65 void VM_ParallelGCSystemGC::doit() {
66   SvcGCMarker sgcm(SvcGCMarker::FULL);
67 
68   ParallelScavengeHeap* heap = ParallelScavengeHeap::heap();
69 
70   GCCauseSetter gccs(heap, _gc_cause);
<span class="line-modified">71   if (!_full) {</span>

72     // If (and only if) the scavenge fails, this will invoke a full gc.
73     heap-&gt;invoke_scavenge();
74   } else {
75     heap-&gt;do_full_collection(false);
76   }
77 }
</pre>
</td>
</tr>
</table>
<center><a href="psScavenge.inline.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="psVirtualspace.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>