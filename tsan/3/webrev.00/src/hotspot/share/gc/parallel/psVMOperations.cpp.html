<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/hotspot/share/gc/parallel/psVMOperations.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
 1 /*
 2  * Copyright (c) 2007, 2018, Oracle and/or its affiliates. All rights reserved.
 3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 4  *
 5  * This code is free software; you can redistribute it and/or modify it
 6  * under the terms of the GNU General Public License version 2 only, as
 7  * published by the Free Software Foundation.
 8  *
 9  * This code is distributed in the hope that it will be useful, but WITHOUT
10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
12  * version 2 for more details (a copy is included in the LICENSE file that
13  * accompanied this code).
14  *
15  * You should have received a copy of the GNU General Public License version
16  * 2 along with this work; if not, write to the Free Software Foundation,
17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
18  *
19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
20  * or visit www.oracle.com if you need additional information or have any
21  * questions.
22  *
23  */
24 
25 #include &quot;precompiled.hpp&quot;
26 #include &quot;gc/parallel/parallelScavengeHeap.inline.hpp&quot;
27 #include &quot;gc/parallel/psScavenge.hpp&quot;
28 #include &quot;gc/parallel/psVMOperations.hpp&quot;
29 #include &quot;gc/shared/gcLocker.hpp&quot;
30 #include &quot;utilities/dtrace.hpp&quot;
31 
32 // The following methods are used by the parallel scavenge collector
33 VM_ParallelGCFailedAllocation::VM_ParallelGCFailedAllocation(size_t word_size,
34                                                              uint gc_count) :
35     VM_CollectForAllocation(word_size, gc_count, GCCause::_allocation_failure) {
36   assert(word_size != 0, &quot;An allocation should always be requested with this operation.&quot;);
37 }
38 
39 void VM_ParallelGCFailedAllocation::doit() {
40   SvcGCMarker sgcm(SvcGCMarker::MINOR);
41 
42   ParallelScavengeHeap* heap = ParallelScavengeHeap::heap();
43 
44   GCCauseSetter gccs(heap, _gc_cause);
45   _result = heap-&gt;failed_mem_allocate(_word_size);
46 
47   if (_result == NULL &amp;&amp; GCLocker::is_active_and_needs_gc()) {
48     set_gc_locked();
49   }
50 }
51 
52 static bool is_cause_full(GCCause::Cause cause) {
53   return (cause != GCCause::_gc_locker) &amp;&amp; (cause != GCCause::_wb_young_gc)
54          DEBUG_ONLY(&amp;&amp; (cause != GCCause::_scavenge_alot));
55 }
56 
57 // Only used for System.gc() calls
58 VM_ParallelGCSystemGC::VM_ParallelGCSystemGC(uint gc_count,
59                                              uint full_gc_count,
60                                              GCCause::Cause gc_cause) :
61   VM_GC_Operation(gc_count, gc_cause, full_gc_count, is_cause_full(gc_cause))
62 {
63 }
64 
65 void VM_ParallelGCSystemGC::doit() {
66   SvcGCMarker sgcm(SvcGCMarker::FULL);
67 
68   ParallelScavengeHeap* heap = ParallelScavengeHeap::heap();
69 
70   GCCauseSetter gccs(heap, _gc_cause);
71   if (!_full) {
72     // If (and only if) the scavenge fails, this will invoke a full gc.
73     heap-&gt;invoke_scavenge();
74   } else {
75     heap-&gt;do_full_collection(false);
76   }
77 }
    </pre>
  </body>
</html>