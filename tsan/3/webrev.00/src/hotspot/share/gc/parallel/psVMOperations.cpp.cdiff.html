<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/gc/parallel/psVMOperations.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="psScavenge.inline.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="psVirtualspace.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/parallel/psVMOperations.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 47,26 ***</span>
    if (_result == NULL &amp;&amp; GCLocker::is_active_and_needs_gc()) {
      set_gc_locked();
    }
  }
  
  // Only used for System.gc() calls
  VM_ParallelGCSystemGC::VM_ParallelGCSystemGC(uint gc_count,
                                               uint full_gc_count,
                                               GCCause::Cause gc_cause) :
<span class="line-modified">!   VM_GC_Operation(gc_count, gc_cause, full_gc_count, true /* full */)</span>
  {
  }
  
  void VM_ParallelGCSystemGC::doit() {
    SvcGCMarker sgcm(SvcGCMarker::FULL);
  
    ParallelScavengeHeap* heap = ParallelScavengeHeap::heap();
  
    GCCauseSetter gccs(heap, _gc_cause);
<span class="line-modified">!   if (_gc_cause == GCCause::_gc_locker || _gc_cause == GCCause::_wb_young_gc</span>
<span class="line-removed">-       DEBUG_ONLY(|| _gc_cause == GCCause::_scavenge_alot)) {</span>
      // If (and only if) the scavenge fails, this will invoke a full gc.
      heap-&gt;invoke_scavenge();
    } else {
      heap-&gt;do_full_collection(false);
    }
<span class="line-new-header">--- 47,30 ---</span>
    if (_result == NULL &amp;&amp; GCLocker::is_active_and_needs_gc()) {
      set_gc_locked();
    }
  }
  
<span class="line-added">+ static bool is_cause_full(GCCause::Cause cause) {</span>
<span class="line-added">+   return (cause != GCCause::_gc_locker) &amp;&amp; (cause != GCCause::_wb_young_gc)</span>
<span class="line-added">+          DEBUG_ONLY(&amp;&amp; (cause != GCCause::_scavenge_alot));</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  // Only used for System.gc() calls
  VM_ParallelGCSystemGC::VM_ParallelGCSystemGC(uint gc_count,
                                               uint full_gc_count,
                                               GCCause::Cause gc_cause) :
<span class="line-modified">!   VM_GC_Operation(gc_count, gc_cause, full_gc_count, is_cause_full(gc_cause))</span>
  {
  }
  
  void VM_ParallelGCSystemGC::doit() {
    SvcGCMarker sgcm(SvcGCMarker::FULL);
  
    ParallelScavengeHeap* heap = ParallelScavengeHeap::heap();
  
    GCCauseSetter gccs(heap, _gc_cause);
<span class="line-modified">!   if (!_full) {</span>
      // If (and only if) the scavenge fails, this will invoke a full gc.
      heap-&gt;invoke_scavenge();
    } else {
      heap-&gt;do_full_collection(false);
    }
</pre>
<center><a href="psScavenge.inline.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="psVirtualspace.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>