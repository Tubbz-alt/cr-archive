<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/hotspot/share/include/jmm.h</title>
    <link rel="stylesheet" href="../../../../style.css" />
    <script type="text/javascript" src="../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2003, 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #ifndef _JAVA_JMM_H_
 27 #define _JAVA_JMM_H_
 28 
 29 /*
 30  * This is a private interface used by JDK for JVM monitoring
 31  * and management.
 32  *
 33  * Bump the version number when either of the following happens:
 34  *
 35  * 1. There is a change in functions in JmmInterface.
 36  *
 37  * 2. There is a change in the contract between VM and Java classes.
 38  */
 39 
 40 #include &quot;jni.h&quot;
 41 
 42 #ifdef __cplusplus
 43 extern &quot;C&quot; {
 44 #endif
 45 
 46 enum {
 47   JMM_VERSION_1   = 0x20010000,
 48   JMM_VERSION_1_0 = 0x20010000,
 49   JMM_VERSION_1_1 = 0x20010100, // JDK 6
 50   JMM_VERSION_1_2 = 0x20010200, // JDK 7
 51   JMM_VERSION_1_2_1 = 0x20010201, // JDK 7 GA
 52   JMM_VERSION_1_2_2 = 0x20010202,
<a name="2" id="anc2"></a><span class="line-modified"> 53   JMM_VERSION_2  = 0x20020000,  // JDK 10</span>
<span class="line-modified"> 54   JMM_VERSION     = 0x20020000</span>

 55 };
 56 
 57 typedef struct {
 58   unsigned int isLowMemoryDetectionSupported : 1;
 59   unsigned int isCompilationTimeMonitoringSupported : 1;
 60   unsigned int isThreadContentionMonitoringSupported : 1;
 61   unsigned int isCurrentThreadCpuTimeSupported : 1;
 62   unsigned int isOtherThreadCpuTimeSupported : 1;
 63   unsigned int isObjectMonitorUsageSupported : 1;
 64   unsigned int isSynchronizerUsageSupported : 1;
 65   unsigned int isThreadAllocatedMemorySupported : 1;
 66   unsigned int isRemoteDiagnosticCommandsSupported : 1;
 67   unsigned int : 22;
 68 } jmmOptionalSupport;
 69 
 70 typedef enum {
 71   JMM_CLASS_LOADED_COUNT             = 1,    /* Total number of loaded classes */
 72   JMM_CLASS_UNLOADED_COUNT           = 2,    /* Total number of unloaded classes */
 73   JMM_THREAD_TOTAL_COUNT             = 3,    /* Total number of threads that have been started */
 74   JMM_THREAD_LIVE_COUNT              = 4,    /* Current number of live threads */
 75   JMM_THREAD_PEAK_COUNT              = 5,    /* Peak number of live threads */
 76   JMM_THREAD_DAEMON_COUNT            = 6,    /* Current number of daemon threads */
 77   JMM_JVM_INIT_DONE_TIME_MS          = 7,    /* Time when the JVM finished initialization */
 78   JMM_COMPILE_TOTAL_TIME_MS          = 8,    /* Total accumulated time spent in compilation */
 79   JMM_GC_TIME_MS                     = 9,    /* Total accumulated time spent in collection */
 80   JMM_GC_COUNT                       = 10,   /* Total number of collections */
 81   JMM_JVM_UPTIME_MS                  = 11,   /* The JVM uptime in milliseconds */
 82 
 83   JMM_INTERNAL_ATTRIBUTE_INDEX       = 100,
 84   JMM_CLASS_LOADED_BYTES             = 101,  /* Number of bytes loaded instance classes */
 85   JMM_CLASS_UNLOADED_BYTES           = 102,  /* Number of bytes unloaded instance classes */
 86   JMM_TOTAL_CLASSLOAD_TIME_MS        = 103,  /* Accumulated VM class loader time (TraceClassLoadingTime) */
 87   JMM_VM_GLOBAL_COUNT                = 104,  /* Number of VM internal flags */
 88   JMM_SAFEPOINT_COUNT                = 105,  /* Total number of safepoints */
 89   JMM_TOTAL_SAFEPOINTSYNC_TIME_MS    = 106,  /* Accumulated time spent getting to safepoints */
 90   JMM_TOTAL_STOPPED_TIME_MS          = 107,  /* Accumulated time spent at safepoints */
 91   JMM_TOTAL_APP_TIME_MS              = 108,  /* Accumulated time spent in Java application */
 92   JMM_VM_THREAD_COUNT                = 109,  /* Current number of VM internal threads */
 93   JMM_CLASS_INIT_TOTAL_COUNT         = 110,  /* Number of classes for which initializers were run */
 94   JMM_CLASS_INIT_TOTAL_TIME_MS       = 111,  /* Accumulated time spent in class initializers */
 95   JMM_METHOD_DATA_SIZE_BYTES         = 112,  /* Size of method data in memory */
 96   JMM_CLASS_VERIFY_TOTAL_TIME_MS     = 113,  /* Accumulated time spent in class verifier */
 97   JMM_SHARED_CLASS_LOADED_COUNT      = 114,  /* Number of shared classes loaded */
 98   JMM_SHARED_CLASS_UNLOADED_COUNT    = 115,  /* Number of shared classes unloaded */
 99   JMM_SHARED_CLASS_LOADED_BYTES      = 116,  /* Number of bytes loaded shared classes */
100   JMM_SHARED_CLASS_UNLOADED_BYTES    = 117,  /* Number of bytes unloaded shared classes */
101 
102   JMM_OS_ATTRIBUTE_INDEX             = 200,
103   JMM_OS_PROCESS_ID                  = 201,  /* Process id of the JVM */
104   JMM_OS_MEM_TOTAL_PHYSICAL_BYTES    = 202,  /* Physical memory size */
105 
106   JMM_GC_EXT_ATTRIBUTE_INFO_SIZE     = 401   /* the size of the GC specific attributes for a given GC memory manager */
107 } jmmLongAttribute;
108 
109 typedef enum {
110   JMM_VERBOSE_GC                     = 21,
111   JMM_VERBOSE_CLASS                  = 22,
112   JMM_THREAD_CONTENTION_MONITORING   = 23,
113   JMM_THREAD_CPU_TIME                = 24,
114   JMM_THREAD_ALLOCATED_MEMORY        = 25
115 } jmmBoolAttribute;
116 
117 
118 enum {
119   JMM_THREAD_STATE_FLAG_SUSPENDED = 0x00100000,
120   JMM_THREAD_STATE_FLAG_NATIVE    = 0x00400000
121 };
122 
123 #define JMM_THREAD_STATE_FLAG_MASK  0xFFF00000
124 
125 typedef enum {
126   JMM_STAT_PEAK_THREAD_COUNT         = 801,
127   JMM_STAT_THREAD_CONTENTION_COUNT   = 802,
128   JMM_STAT_THREAD_CONTENTION_TIME    = 803,
129   JMM_STAT_THREAD_CONTENTION_STAT    = 804,
130   JMM_STAT_PEAK_POOL_USAGE           = 805,
131   JMM_STAT_GC_STAT                   = 806
132 } jmmStatisticType;
133 
134 typedef enum {
135   JMM_USAGE_THRESHOLD_HIGH            = 901,
136   JMM_USAGE_THRESHOLD_LOW             = 902,
137   JMM_COLLECTION_USAGE_THRESHOLD_HIGH = 903,
138   JMM_COLLECTION_USAGE_THRESHOLD_LOW  = 904
139 } jmmThresholdType;
140 
141 /* Should match what is allowed in globals.hpp */
142 typedef enum {
143   JMM_VMGLOBAL_TYPE_UNKNOWN  = 0,
144   JMM_VMGLOBAL_TYPE_JBOOLEAN = 1,
145   JMM_VMGLOBAL_TYPE_JSTRING  = 2,
146   JMM_VMGLOBAL_TYPE_JLONG    = 3,
147   JMM_VMGLOBAL_TYPE_JDOUBLE  = 4
148 } jmmVMGlobalType;
149 
150 typedef enum {
151   JMM_VMGLOBAL_ORIGIN_DEFAULT      = 1,   /* Default value */
152   JMM_VMGLOBAL_ORIGIN_COMMAND_LINE = 2,   /* Set at command line (or JNI invocation) */
153   JMM_VMGLOBAL_ORIGIN_MANAGEMENT   = 3,   /* Set via management interface */
154   JMM_VMGLOBAL_ORIGIN_ENVIRON_VAR  = 4,   /* Set via environment variables */
155   JMM_VMGLOBAL_ORIGIN_CONFIG_FILE  = 5,   /* Set via config file (such as .hotspotrc) */
156   JMM_VMGLOBAL_ORIGIN_ERGONOMIC    = 6,   /* Set via ergonomic */
157   JMM_VMGLOBAL_ORIGIN_ATTACH_ON_DEMAND = 7,   /* Set via attach */
158   JMM_VMGLOBAL_ORIGIN_OTHER        = 99   /* Set via some other mechanism */
159 } jmmVMGlobalOrigin;
160 
161 typedef struct {
162   jstring           name;
163   jvalue            value;
164   jmmVMGlobalType   type;           /* Data type */
165   jmmVMGlobalOrigin origin;         /* Default or non-default value */
166   unsigned int      writeable : 1;  /* dynamically writeable */
167   unsigned int      external  : 1;  /* external supported interface */
168   unsigned int      reserved  : 30;
169   void *reserved1;
170   void *reserved2;
171 } jmmVMGlobal;
172 
173 typedef struct {
174   const char*  name;
175   char         type;
176   const char*  description;
177 } jmmExtAttributeInfo;
178 
179 /* Caller has to set the following fields before calling GetLastGCStat
180  *   o usage_before_gc               - array of MemoryUsage objects
181  *   o usage_after_gc                - array of MemoryUsage objects
182  *   o gc_ext_attribute_values_size - size of gc_ext_atttribute_values array
183  *   o gc_ext_attribtue_values      - array of jvalues
184  */
185 typedef struct {
186   jlong        gc_index;                       /* Index of the collections */
187   jlong        start_time;                     /* Start time of the GC */
188   jlong        end_time;                       /* End time of the GC */
189   jobjectArray usage_before_gc;                /* Memory usage array before GC */
190   jobjectArray usage_after_gc;                 /* Memory usage array after GC */
191   jint         gc_ext_attribute_values_size;   /* set by the caller of GetGCStat */
192   jvalue*      gc_ext_attribute_values;        /* Array of jvalue for GC extension attributes */
193   jint         num_gc_ext_attributes;          /* number of GC extension attribute values s are filled */
194                                                /* -1 indicates gc_ext_attribute_values is not big enough */
195 } jmmGCStat;
196 
197 typedef struct {
198   const char* name;                /* Name of the diagnostic command */
199   const char* description;         /* Short description */
200   const char* impact;              /* Impact on the JVM */
201   const char* permission_class;    /* Class name of the required permission if any */
202   const char* permission_name;     /* Permission name of the required permission if any */
203   const char* permission_action;   /* Action name of the required permission if any*/
204   int         num_arguments;       /* Number of supported options or arguments */
205   jboolean    enabled;             /* True if the diagnostic command can be invoked, false otherwise*/
206 } dcmdInfo;
207 
208 typedef struct {
209   const char* name;                /* Option/Argument name*/
210   const char* description;         /* Short description */
211   const char* type;                /* Type: STRING, BOOLEAN, etc. */
212   const char* default_string;      /* Default value in a parsable string */
213   jboolean    mandatory;           /* True if the option/argument is mandatory */
214   jboolean    option;              /* True if it is an option, false if it is an argument */
215                                    /* (see diagnosticFramework.hpp for option/argument definitions) */
216   jboolean    multiple;            /* True is the option can be specified several time */
217   int         position;            /* Expected position for this argument (this field is */
218                                    /* meaningless for options) */
219 } dcmdArgInfo;
220 
221 typedef struct jmmInterface_1_ {
222   void*        reserved1;
223   void*        reserved2;
224 
225   jint         (JNICALL *GetVersion)             (JNIEnv *env);
226 
227   jint         (JNICALL *GetOptionalSupport)     (JNIEnv *env,
228                                                   jmmOptionalSupport* support_ptr);
229 
230   jint         (JNICALL *GetThreadInfo)          (JNIEnv *env,
231                                                   jlongArray ids,
232                                                   jint maxDepth,
233                                                   jobjectArray infoArray);
234 
235   jobjectArray (JNICALL *GetMemoryPools)         (JNIEnv* env, jobject mgr);
236 
237   jobjectArray (JNICALL *GetMemoryManagers)      (JNIEnv* env, jobject pool);
238 
239   jobject      (JNICALL *GetMemoryPoolUsage)     (JNIEnv* env, jobject pool);
240   jobject      (JNICALL *GetPeakMemoryPoolUsage) (JNIEnv* env, jobject pool);
241 
<a name="3" id="anc3"></a>


242   void         (JNICALL *GetThreadAllocatedMemory)
243                                                  (JNIEnv *env,
244                                                   jlongArray ids,
245                                                   jlongArray sizeArray);
246 
247   jobject      (JNICALL *GetMemoryUsage)         (JNIEnv* env, jboolean heap);
248 
249   jlong        (JNICALL *GetLongAttribute)       (JNIEnv *env, jobject obj, jmmLongAttribute att);
250   jboolean     (JNICALL *GetBoolAttribute)       (JNIEnv *env, jmmBoolAttribute att);
251   jboolean     (JNICALL *SetBoolAttribute)       (JNIEnv *env, jmmBoolAttribute att, jboolean flag);
252 
253   jint         (JNICALL *GetLongAttributes)      (JNIEnv *env,
254                                                   jobject obj,
255                                                   jmmLongAttribute* atts,
256                                                   jint count,
257                                                   jlong* result);
258 
259   jobjectArray (JNICALL *FindCircularBlockedThreads) (JNIEnv *env);
260 
261   // Not used in JDK 6 or JDK 7
262   jlong        (JNICALL *GetThreadCpuTime)       (JNIEnv *env, jlong thread_id);
263 
264   jobjectArray (JNICALL *GetVMGlobalNames)       (JNIEnv *env);
265   jint         (JNICALL *GetVMGlobals)           (JNIEnv *env,
266                                                   jobjectArray names,
267                                                   jmmVMGlobal *globals,
268                                                   jint count);
269 
270   jint         (JNICALL *GetInternalThreadTimes) (JNIEnv *env,
271                                                   jobjectArray names,
272                                                   jlongArray times);
273 
274   jboolean     (JNICALL *ResetStatistic)         (JNIEnv *env,
275                                                   jvalue obj,
276                                                   jmmStatisticType type);
277 
278   void         (JNICALL *SetPoolSensor)          (JNIEnv *env,
279                                                   jobject pool,
280                                                   jmmThresholdType type,
281                                                   jobject sensor);
282 
283   jlong        (JNICALL *SetPoolThreshold)       (JNIEnv *env,
284                                                   jobject pool,
285                                                   jmmThresholdType type,
286                                                   jlong threshold);
287   jobject      (JNICALL *GetPoolCollectionUsage) (JNIEnv* env, jobject pool);
288 
289   jint         (JNICALL *GetGCExtAttributeInfo)  (JNIEnv *env,
290                                                   jobject mgr,
291                                                   jmmExtAttributeInfo *ext_info,
292                                                   jint count);
293   void         (JNICALL *GetLastGCStat)          (JNIEnv *env,
294                                                   jobject mgr,
295                                                   jmmGCStat *gc_stat);
296 
297   jlong        (JNICALL *GetThreadCpuTimeWithKind)
298                                                  (JNIEnv *env,
299                                                   jlong thread_id,
300                                                   jboolean user_sys_cpu_time);
301   void         (JNICALL *GetThreadCpuTimesWithKind)
302                                                  (JNIEnv *env,
303                                                   jlongArray ids,
304                                                   jlongArray timeArray,
305                                                   jboolean user_sys_cpu_time);
306 
307   jint         (JNICALL *DumpHeap0)              (JNIEnv *env,
308                                                   jstring outputfile,
309                                                   jboolean live);
310   jobjectArray (JNICALL *FindDeadlocks)          (JNIEnv *env,
311                                                   jboolean object_monitors_only);
312   void         (JNICALL *SetVMGlobal)            (JNIEnv *env,
313                                                   jstring flag_name,
314                                                   jvalue  new_value);
315   void*        reserved6;
316   jobjectArray (JNICALL *DumpThreads)            (JNIEnv *env,
317                                                   jlongArray ids,
318                                                   jboolean lockedMonitors,
319                                                   jboolean lockedSynchronizers,
320                                                   jint maxDepth);
321   void         (JNICALL *SetGCNotificationEnabled) (JNIEnv *env,
322                                                     jobject mgr,
323                                                     jboolean enabled);
324   jobjectArray (JNICALL *GetDiagnosticCommands)  (JNIEnv *env);
325   void         (JNICALL *GetDiagnosticCommandInfo)
326                                                  (JNIEnv *env,
327                                                   jobjectArray cmds,
328                                                   dcmdInfo *infoArray);
329   void         (JNICALL *GetDiagnosticCommandArgumentsInfo)
330                                                  (JNIEnv *env,
331                                                   jstring commandName,
332                                                   dcmdArgInfo *infoArray);
333   jstring      (JNICALL *ExecuteDiagnosticCommand)
334                                                  (JNIEnv *env,
335                                                   jstring command);
336   void         (JNICALL *SetDiagnosticFrameworkNotificationEnabled)
337                                                  (JNIEnv *env,
338                                                   jboolean enabled);
339 } JmmInterface;
340 
341 #ifdef __cplusplus
342 } /* extern &quot;C&quot; */
343 #endif /* __cplusplus */
344 
345 #endif /* !_JAVA_JMM_H_ */
<a name="4" id="anc4"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="4" type="hidden" />
</body>
</html>