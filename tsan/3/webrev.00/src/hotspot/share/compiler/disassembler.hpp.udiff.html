<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/compiler/disassembler.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="disassembler.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="methodLiveness.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/compiler/disassembler.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -23,20 +23,25 @@</span>
   */
  
  #ifndef SHARE_COMPILER_DISASSEMBLER_HPP
  #define SHARE_COMPILER_DISASSEMBLER_HPP
  
<span class="udiff-line-added">+ #include &quot;utilities/globalDefinitions.hpp&quot;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #include &quot;asm/assembler.hpp&quot;</span>
  #include &quot;asm/codeBuffer.hpp&quot;
<span class="udiff-line-added">+ #include &quot;compiler/abstractDisassembler.hpp&quot;</span>
  #include &quot;runtime/globals.hpp&quot;
  #include &quot;utilities/macros.hpp&quot;
  
  class decode_env;
  
  // The disassembler prints out assembly code annotated
  // with Java specific information.
  
<span class="udiff-line-modified-removed">- class Disassembler {</span>
<span class="udiff-line-modified-added">+ // Disassembler inherits from AbstractDisassembler</span>
<span class="udiff-line-added">+ class Disassembler : public AbstractDisassembler {</span>
    friend class decode_env;
   private:
    // this is the type of the dll entry point:
    typedef void* (*decode_func_virtual)(uintptr_t start_va, uintptr_t end_va,
                                 unsigned char* buffer, uintptr_t length,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -55,30 +60,62 @@</span>
                                 const char* options);
    // points to the library.
    static void*    _library;
    // bailout
    static bool     _tried_to_load_library;
<span class="udiff-line-added">+   static bool     _library_usable;</span>
    // points to the decode function.
    static decode_func_virtual _decode_instructions_virtual;
    static decode_func _decode_instructions;
<span class="udiff-line-modified-removed">-   // tries to load library and return whether it succedded.</span>
<span class="udiff-line-modified-removed">-   static bool load_library();</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   // tries to load library and return whether it succeeded.</span>
<span class="udiff-line-added">+   // Allow (diagnostic) output redirection.</span>
<span class="udiff-line-added">+   // No output at all if stream is NULL. Can be overridden</span>
<span class="udiff-line-added">+   // with -Verbose flag, in which case output goes to tty.</span>
<span class="udiff-line-added">+   static bool load_library(outputStream* st = NULL);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   // Check if the two addresses are on the same page.</span>
<span class="udiff-line-added">+   static bool is_same_page(address a1, address a2) {</span>
<span class="udiff-line-added">+     return (((uintptr_t)a1 ^ (uintptr_t)a2) &amp; (~0x0fffUL)) == 0L;</span>
<span class="udiff-line-added">+   }</span>
  
    // Machine dependent stuff
  #include CPU_HEADER(disassembler)
  
   public:
<span class="udiff-line-modified-removed">-   static bool can_decode() {</span>
<span class="udiff-line-modified-removed">-     ttyLocker tl;</span>
<span class="udiff-line-modified-removed">-     return (_decode_instructions_virtual != NULL) ||</span>
<span class="udiff-line-modified-removed">-            (_decode_instructions != NULL) ||</span>
<span class="udiff-line-modified-removed">-            load_library();</span>
<span class="udiff-line-modified-added">+   // We can always decode code blobs.</span>
<span class="udiff-line-modified-added">+   // Either we have a disassembler library available (successfully loaded)</span>
<span class="udiff-line-modified-added">+   // or we will resort to the abstract disassembler. This method informs</span>
<span class="udiff-line-modified-added">+   // about which decoding format is used.</span>
<span class="udiff-line-modified-added">+   // We can also enforce using the abstract disassembler.</span>
<span class="udiff-line-added">+   static bool is_abstract() {</span>
<span class="udiff-line-added">+     if (!_tried_to_load_library /* &amp;&amp; !UseAbstractDisassembler */) {</span>
<span class="udiff-line-added">+       load_library();</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     return ! _library_usable /* || UseAbstractDisassembler */;  // Not available until DecodeErrorFile is supported.</span>
    }
<span class="udiff-line-modified-removed">-   static void decode(CodeBlob *cb,               outputStream* st = NULL);</span>
<span class="udiff-line-modified-removed">-   static void decode(nmethod* nm,                outputStream* st = NULL);</span>
<span class="udiff-line-modified-removed">-   static void decode(address begin, address end, outputStream* st = NULL,</span>
<span class="udiff-line-modified-removed">-                      CodeStrings c = CodeStrings(), ptrdiff_t offset = 0);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   // Check out if we are doing a live disassembly or a post-mortem</span>
<span class="udiff-line-modified-added">+   // disassembly where the binary data was loaded from a hs_err file.</span>
<span class="udiff-line-modified-added">+   static bool is_decode_error_file() {</span>
<span class="udiff-line-added">+ // Activate once post-mortem disassembly (from hs-err file) is available.</span>
<span class="udiff-line-added">+ #if 0</span>
<span class="udiff-line-added">+     return DecodeErrorFile &amp;&amp; (strlen(DecodeErrorFile) != 0);</span>
<span class="udiff-line-added">+ #else</span>
<span class="udiff-line-added">+     return false;</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   // Directly disassemble code buffer.</span>
<span class="udiff-line-added">+   static void decode(CodeBuffer* cb, address start, address end, outputStream* st = NULL);</span>
<span class="udiff-line-added">+   // Directly disassemble code blob.</span>
<span class="udiff-line-added">+   static void decode(CodeBlob *cb,               outputStream* st = NULL, CodeStrings c = CodeStrings());</span>
<span class="udiff-line-added">+   // Directly disassemble nmethod.</span>
<span class="udiff-line-added">+   static void decode(nmethod* nm,                outputStream* st = NULL, CodeStrings c = CodeStrings());</span>
<span class="udiff-line-added">+   // Disassemble an arbitrary memory range.</span>
<span class="udiff-line-added">+   static void decode(address start, address end, outputStream* st = NULL, CodeStrings c = CodeStrings() /* , ptrdiff_t offset */);</span>
<span class="udiff-line-added">+ </span>
    static void _hook(const char* file, int line, class MacroAssembler* masm);
  
    // This functions makes it easy to generate comments in the generated
    // interpreter code, by riding on the customary __ macro in the interpreter generator.
    // See templateTable_x86.cpp for an example.
</pre>
<center><a href="disassembler.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="methodLiveness.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>