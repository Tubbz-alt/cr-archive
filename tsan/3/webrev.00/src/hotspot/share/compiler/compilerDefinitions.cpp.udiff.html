<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/compiler/compilerDefinitions.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="compileTask.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="compilerDefinitions.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/compiler/compilerDefinitions.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -35,28 +35,44 @@</span>
    &quot;c1&quot;,
    &quot;c2&quot;,
    &quot;jvmci&quot;
  };
  
<span class="udiff-line-added">+ #ifdef TIERED</span>
<span class="udiff-line-added">+ bool CompilationModeFlag::_quick_only = false;</span>
<span class="udiff-line-added">+ bool CompilationModeFlag::_high_only = false;</span>
<span class="udiff-line-added">+ bool CompilationModeFlag::_high_only_quick_internal = false;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ bool CompilationModeFlag::initialize() {</span>
<span class="udiff-line-added">+   if (CompilationMode != NULL) {</span>
<span class="udiff-line-added">+     if (strcmp(CompilationMode, &quot;default&quot;) == 0) {</span>
<span class="udiff-line-added">+       // Do nothing, just support the &quot;default&quot; keyword.</span>
<span class="udiff-line-added">+     } else if (strcmp(CompilationMode, &quot;quick-only&quot;) == 0) {</span>
<span class="udiff-line-added">+       _quick_only = true;</span>
<span class="udiff-line-added">+     } else if (strcmp(CompilationMode, &quot;high-only&quot;) == 0) {</span>
<span class="udiff-line-added">+       _high_only = true;</span>
<span class="udiff-line-added">+     } else if (strcmp(CompilationMode, &quot;high-only-quick-internal&quot;) == 0) {</span>
<span class="udiff-line-added">+       _high_only_quick_internal = true;</span>
<span class="udiff-line-added">+     } else {</span>
<span class="udiff-line-added">+       jio_fprintf(defaultStream::error_stream(), &quot;Unsupported compilation mode &#39;%s&#39;, supported modes are: quick-only, high-only, high-only-quick-internal\n&quot;, CompilationMode);</span>
<span class="udiff-line-added">+       return false;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+   return true;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
  #if defined(COMPILER2)
  CompLevel  CompLevel_highest_tier      = CompLevel_full_optimization;  // pure C2 and tiered or JVMCI and tiered
  #elif defined(COMPILER1)
  CompLevel  CompLevel_highest_tier      = CompLevel_simple;             // pure C1 or JVMCI
  #else
  CompLevel  CompLevel_highest_tier      = CompLevel_none;
  #endif
  
<span class="udiff-line-removed">- #if defined(TIERED)</span>
<span class="udiff-line-removed">- CompLevel  CompLevel_initial_compile   = CompLevel_full_profile;        // tiered</span>
<span class="udiff-line-removed">- #elif defined(COMPILER1) || INCLUDE_JVMCI</span>
<span class="udiff-line-removed">- CompLevel  CompLevel_initial_compile   = CompLevel_simple;              // pure C1 or JVMCI</span>
<span class="udiff-line-removed">- #elif defined(COMPILER2)</span>
<span class="udiff-line-removed">- CompLevel  CompLevel_initial_compile   = CompLevel_full_optimization;   // pure C2</span>
<span class="udiff-line-removed">- #else</span>
<span class="udiff-line-removed">- CompLevel  CompLevel_initial_compile   = CompLevel_none;</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">- </span>
  #if defined(COMPILER2)
  CompMode  Compilation_mode             = CompMode_server;
  #elif defined(COMPILER1)
  CompMode  Compilation_mode             = CompMode_client;
  #else
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -114,57 +130,56 @@</span>
  
  #ifdef TIERED
  void set_client_compilation_mode() {
    Compilation_mode = CompMode_client;
    CompLevel_highest_tier = CompLevel_simple;
<span class="udiff-line-modified-removed">-   CompLevel_initial_compile = CompLevel_simple;</span>
<span class="udiff-line-modified-removed">-   FLAG_SET_ERGO(bool, TieredCompilation, false);</span>
<span class="udiff-line-removed">-   FLAG_SET_ERGO(bool, ProfileInterpreter, false);</span>
<span class="udiff-line-modified-added">+   FLAG_SET_ERGO(TieredCompilation, false);</span>
<span class="udiff-line-modified-added">+   FLAG_SET_ERGO(ProfileInterpreter, false);</span>
  #if INCLUDE_JVMCI
<span class="udiff-line-modified-removed">-   FLAG_SET_ERGO(bool, EnableJVMCI, false);</span>
<span class="udiff-line-modified-removed">-   FLAG_SET_ERGO(bool, UseJVMCICompiler, false);</span>
<span class="udiff-line-modified-added">+   FLAG_SET_ERGO(EnableJVMCI, false);</span>
<span class="udiff-line-modified-added">+   FLAG_SET_ERGO(UseJVMCICompiler, false);</span>
  #endif
  #if INCLUDE_AOT
<span class="udiff-line-modified-removed">-   FLAG_SET_ERGO(bool, UseAOT, false);</span>
<span class="udiff-line-modified-added">+   FLAG_SET_ERGO(UseAOT, false);</span>
  #endif
    if (FLAG_IS_DEFAULT(NeverActAsServerClassMachine)) {
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(bool, NeverActAsServerClassMachine, true);</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(NeverActAsServerClassMachine, true);</span>
    }
    if (FLAG_IS_DEFAULT(InitialCodeCacheSize)) {
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(uintx, InitialCodeCacheSize, 160*K);</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(InitialCodeCacheSize, 160*K);</span>
    }
    if (FLAG_IS_DEFAULT(ReservedCodeCacheSize)) {
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(uintx, ReservedCodeCacheSize, 32*M);</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(ReservedCodeCacheSize, 32*M);</span>
    }
    if (FLAG_IS_DEFAULT(NonProfiledCodeHeapSize)) {
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(uintx, NonProfiledCodeHeapSize, 27*M);</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(NonProfiledCodeHeapSize, 27*M);</span>
    }
    if (FLAG_IS_DEFAULT(ProfiledCodeHeapSize)) {
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(uintx, ProfiledCodeHeapSize, 0);</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(ProfiledCodeHeapSize, 0);</span>
    }
    if (FLAG_IS_DEFAULT(NonNMethodCodeHeapSize)) {
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(uintx, NonNMethodCodeHeapSize, 5*M);</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(NonNMethodCodeHeapSize, 5*M);</span>
    }
    if (FLAG_IS_DEFAULT(CodeCacheExpansionSize)) {
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(uintx, CodeCacheExpansionSize, 32*K);</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(CodeCacheExpansionSize, 32*K);</span>
    }
    if (FLAG_IS_DEFAULT(MetaspaceSize)) {
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(size_t, MetaspaceSize, MIN2(12*M, MaxMetaspaceSize));</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(MetaspaceSize, MIN2(12*M, MaxMetaspaceSize));</span>
    }
    if (FLAG_IS_DEFAULT(MaxRAM)) {
      // Do not use FLAG_SET_ERGO to update MaxRAM, as this will impact
      // heap setting done based on available phys_mem (see Arguments::set_heap_size).
      FLAG_SET_DEFAULT(MaxRAM, 1ULL*G);
    }
    if (FLAG_IS_DEFAULT(CompileThreshold)) {
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(intx, CompileThreshold, 1500);</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(CompileThreshold, 1500);</span>
    }
    if (FLAG_IS_DEFAULT(OnStackReplacePercentage)) {
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(intx, OnStackReplacePercentage, 933);</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(OnStackReplacePercentage, 933);</span>
    }
    if (FLAG_IS_DEFAULT(CICompilerCount)) {
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(intx, CICompilerCount, 1);</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(CICompilerCount, 1);</span>
    }
  }
  
  bool compilation_mode_selected() {
    return !FLAG_IS_DEFAULT(TieredCompilation) ||
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -175,111 +190,163 @@</span>
  }
  
  void select_compilation_mode_ergonomically() {
  #if defined(_WINDOWS) &amp;&amp; !defined(_LP64)
    if (FLAG_IS_DEFAULT(NeverActAsServerClassMachine)) {
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(bool, NeverActAsServerClassMachine, true);</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(NeverActAsServerClassMachine, true);</span>
    }
  #endif
    if (NeverActAsServerClassMachine) {
      set_client_compilation_mode();
    }
  }
  
<span class="udiff-line-removed">- #endif // TIERED</span>
  
  void CompilerConfig::set_tiered_flags() {
<span class="udiff-line-removed">-   // With tiered, set default policy to SimpleThresholdPolicy, which is 2.</span>
<span class="udiff-line-removed">-   if (FLAG_IS_DEFAULT(CompilationPolicyChoice)) {</span>
<span class="udiff-line-removed">-     FLAG_SET_DEFAULT(CompilationPolicyChoice, 2);</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">-   if (CompilationPolicyChoice &lt; 2) {</span>
<span class="udiff-line-removed">-     vm_exit_during_initialization(</span>
<span class="udiff-line-removed">-       &quot;Incompatible compilation policy selected&quot;, NULL);</span>
<span class="udiff-line-removed">-   }</span>
    // Increase the code cache size - tiered compiles a lot more.
    if (FLAG_IS_DEFAULT(ReservedCodeCacheSize)) {
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(uintx, ReservedCodeCacheSize,</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(ReservedCodeCacheSize,</span>
                    MIN2(CODE_CACHE_DEFAULT_LIMIT, (size_t)ReservedCodeCacheSize * 5));
    }
    // Enable SegmentedCodeCache if TieredCompilation is enabled, ReservedCodeCacheSize &gt;= 240M
    // and the code cache contains at least 8 pages (segmentation disables advantage of huge pages).
    if (FLAG_IS_DEFAULT(SegmentedCodeCache) &amp;&amp; ReservedCodeCacheSize &gt;= 240*M &amp;&amp;
        8 * CodeCache::page_size() &lt;= ReservedCodeCacheSize) {
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(bool, SegmentedCodeCache, true);</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(SegmentedCodeCache, true);</span>
    }
    if (!UseInterpreter) { // -Xcomp
      Tier3InvokeNotifyFreqLog = 0;
      Tier4InvocationThreshold = 0;
    }
  
    if (CompileThresholdScaling &lt; 0) {
      vm_exit_during_initialization(&quot;Negative value specified for CompileThresholdScaling&quot;, NULL);
    }
  
<span class="udiff-line-added">+   if (CompilationModeFlag::disable_intermediate()) {</span>
<span class="udiff-line-added">+     if (FLAG_IS_DEFAULT(Tier0ProfilingStartPercentage)) {</span>
<span class="udiff-line-added">+       FLAG_SET_DEFAULT(Tier0ProfilingStartPercentage, 33);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
    // Scale tiered compilation thresholds.
    // CompileThresholdScaling == 0.0 is equivalent to -Xint and leaves compilation thresholds unchanged.
    if (!FLAG_IS_DEFAULT(CompileThresholdScaling) &amp;&amp; CompileThresholdScaling &gt; 0.0) {
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(intx, Tier0InvokeNotifyFreqLog, scaled_freq_log(Tier0InvokeNotifyFreqLog));</span>
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(intx, Tier0BackedgeNotifyFreqLog, scaled_freq_log(Tier0BackedgeNotifyFreqLog));</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(Tier0InvokeNotifyFreqLog, scaled_freq_log(Tier0InvokeNotifyFreqLog));</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(Tier0BackedgeNotifyFreqLog, scaled_freq_log(Tier0BackedgeNotifyFreqLog));</span>
  
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(intx, Tier3InvocationThreshold, scaled_compile_threshold(Tier3InvocationThreshold));</span>
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(intx, Tier3MinInvocationThreshold, scaled_compile_threshold(Tier3MinInvocationThreshold));</span>
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(intx, Tier3CompileThreshold, scaled_compile_threshold(Tier3CompileThreshold));</span>
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(intx, Tier3BackEdgeThreshold, scaled_compile_threshold(Tier3BackEdgeThreshold));</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(Tier3InvocationThreshold, scaled_compile_threshold(Tier3InvocationThreshold));</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(Tier3MinInvocationThreshold, scaled_compile_threshold(Tier3MinInvocationThreshold));</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(Tier3CompileThreshold, scaled_compile_threshold(Tier3CompileThreshold));</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(Tier3BackEdgeThreshold, scaled_compile_threshold(Tier3BackEdgeThreshold));</span>
  
      // Tier2{Invocation,MinInvocation,Compile,Backedge}Threshold should be scaled here
      // once these thresholds become supported.
  
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(intx, Tier2InvokeNotifyFreqLog, scaled_freq_log(Tier2InvokeNotifyFreqLog));</span>
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(intx, Tier2BackedgeNotifyFreqLog, scaled_freq_log(Tier2BackedgeNotifyFreqLog));</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(Tier2InvokeNotifyFreqLog, scaled_freq_log(Tier2InvokeNotifyFreqLog));</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(Tier2BackedgeNotifyFreqLog, scaled_freq_log(Tier2BackedgeNotifyFreqLog));</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     FLAG_SET_ERGO(Tier3InvokeNotifyFreqLog, scaled_freq_log(Tier3InvokeNotifyFreqLog));</span>
<span class="udiff-line-added">+     FLAG_SET_ERGO(Tier3BackedgeNotifyFreqLog, scaled_freq_log(Tier3BackedgeNotifyFreqLog));</span>
  
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(intx, Tier3InvokeNotifyFreqLog, scaled_freq_log(Tier3InvokeNotifyFreqLog));</span>
<span class="udiff-line-removed">-     FLAG_SET_ERGO(intx, Tier3BackedgeNotifyFreqLog, scaled_freq_log(Tier3BackedgeNotifyFreqLog));</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(Tier23InlineeNotifyFreqLog, scaled_freq_log(Tier23InlineeNotifyFreqLog));</span>
  
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(intx, Tier23InlineeNotifyFreqLog, scaled_freq_log(Tier23InlineeNotifyFreqLog));</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(Tier4InvocationThreshold, scaled_compile_threshold(Tier4InvocationThreshold));</span>
<span class="udiff-line-added">+     FLAG_SET_ERGO(Tier4MinInvocationThreshold, scaled_compile_threshold(Tier4MinInvocationThreshold));</span>
<span class="udiff-line-added">+     FLAG_SET_ERGO(Tier4CompileThreshold, scaled_compile_threshold(Tier4CompileThreshold));</span>
<span class="udiff-line-added">+     FLAG_SET_ERGO(Tier4BackEdgeThreshold, scaled_compile_threshold(Tier4BackEdgeThreshold));</span>
  
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(intx, Tier4InvocationThreshold, scaled_compile_threshold(Tier4InvocationThreshold));</span>
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(intx, Tier4MinInvocationThreshold, scaled_compile_threshold(Tier4MinInvocationThreshold));</span>
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(intx, Tier4CompileThreshold, scaled_compile_threshold(Tier4CompileThreshold));</span>
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(intx, Tier4BackEdgeThreshold, scaled_compile_threshold(Tier4BackEdgeThreshold));</span>
<span class="udiff-line-modified-added">+     if (CompilationModeFlag::disable_intermediate()) {</span>
<span class="udiff-line-modified-added">+       FLAG_SET_ERGO(Tier40InvocationThreshold, scaled_compile_threshold(Tier40InvocationThreshold));</span>
<span class="udiff-line-modified-added">+       FLAG_SET_ERGO(Tier40MinInvocationThreshold, scaled_compile_threshold(Tier40MinInvocationThreshold));</span>
<span class="udiff-line-modified-added">+       FLAG_SET_ERGO(Tier40CompileThreshold, scaled_compile_threshold(Tier40CompileThreshold));</span>
<span class="udiff-line-added">+       FLAG_SET_ERGO(Tier40BackEdgeThreshold, scaled_compile_threshold(Tier40BackEdgeThreshold));</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #if INCLUDE_AOT</span>
<span class="udiff-line-added">+     if (UseAOT) {</span>
<span class="udiff-line-added">+       FLAG_SET_ERGO(Tier3AOTInvocationThreshold, scaled_compile_threshold(Tier3AOTInvocationThreshold));</span>
<span class="udiff-line-added">+       FLAG_SET_ERGO(Tier3AOTMinInvocationThreshold, scaled_compile_threshold(Tier3AOTMinInvocationThreshold));</span>
<span class="udiff-line-added">+       FLAG_SET_ERGO(Tier3AOTCompileThreshold, scaled_compile_threshold(Tier3AOTCompileThreshold));</span>
<span class="udiff-line-added">+       FLAG_SET_ERGO(Tier3AOTBackEdgeThreshold, scaled_compile_threshold(Tier3AOTBackEdgeThreshold));</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+       if (CompilationModeFlag::disable_intermediate()) {</span>
<span class="udiff-line-added">+         FLAG_SET_ERGO(Tier0AOTInvocationThreshold, scaled_compile_threshold(Tier0AOTInvocationThreshold));</span>
<span class="udiff-line-added">+         FLAG_SET_ERGO(Tier0AOTMinInvocationThreshold, scaled_compile_threshold(Tier0AOTMinInvocationThreshold));</span>
<span class="udiff-line-added">+         FLAG_SET_ERGO(Tier0AOTCompileThreshold, scaled_compile_threshold(Tier0AOTCompileThreshold));</span>
<span class="udiff-line-added">+         FLAG_SET_ERGO(Tier0AOTBackEdgeThreshold, scaled_compile_threshold(Tier0AOTBackEdgeThreshold));</span>
<span class="udiff-line-added">+       }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ #endif // INCLUDE_AOT</span>
    }
  }
  
<span class="udiff-line-added">+ #endif // TIERED</span>
<span class="udiff-line-added">+ </span>
  #if INCLUDE_JVMCI
  void set_jvmci_specific_flags() {
    if (UseJVMCICompiler) {
      Compilation_mode = CompMode_server;
  
      if (FLAG_IS_DEFAULT(TypeProfileWidth)) {
        FLAG_SET_DEFAULT(TypeProfileWidth, 8);
      }
<span class="udiff-line-removed">-     if (FLAG_IS_DEFAULT(OnStackReplacePercentage)) {</span>
<span class="udiff-line-removed">-       FLAG_SET_DEFAULT(OnStackReplacePercentage, 933);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     // JVMCI needs values not less than defaults</span>
<span class="udiff-line-removed">-     if (FLAG_IS_DEFAULT(ReservedCodeCacheSize)) {</span>
<span class="udiff-line-removed">-       FLAG_SET_DEFAULT(ReservedCodeCacheSize, MAX2(64*M, ReservedCodeCacheSize));</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     if (FLAG_IS_DEFAULT(InitialCodeCacheSize)) {</span>
<span class="udiff-line-removed">-       FLAG_SET_DEFAULT(InitialCodeCacheSize, MAX2(16*M, InitialCodeCacheSize));</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     if (FLAG_IS_DEFAULT(MetaspaceSize)) {</span>
<span class="udiff-line-removed">-       FLAG_SET_DEFAULT(MetaspaceSize, MIN2(MAX2(12*M, MetaspaceSize), MaxMetaspaceSize));</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     if (FLAG_IS_DEFAULT(NewSizeThreadIncrease)) {</span>
<span class="udiff-line-removed">-       FLAG_SET_DEFAULT(NewSizeThreadIncrease, MAX2(4*K, NewSizeThreadIncrease));</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     if (TieredStopAtLevel != CompLevel_full_optimization) {</span>
<span class="udiff-line-removed">-       // Currently JVMCI compiler can only work at the full optimization level</span>
<span class="udiff-line-removed">-       warning(&quot;forcing TieredStopAtLevel to full optimization because JVMCI is enabled&quot;);</span>
<span class="udiff-line-removed">-       FLAG_SET_ERGO(intx, TieredStopAtLevel, CompLevel_full_optimization);</span>
<span class="udiff-line-removed">-     }</span>
      if (FLAG_IS_DEFAULT(TypeProfileLevel)) {
        FLAG_SET_DEFAULT(TypeProfileLevel, 0);
      }
<span class="udiff-line-modified-removed">-   }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+     if (UseJVMCINativeLibrary) {</span>
<span class="udiff-line-added">+       // SVM compiled code requires more stack space</span>
<span class="udiff-line-added">+       if (FLAG_IS_DEFAULT(CompilerThreadStackSize)) {</span>
<span class="udiff-line-added">+         // Duplicate logic in the implementations of os::create_thread</span>
<span class="udiff-line-added">+         // so that we can then double the computed stack size. Once</span>
<span class="udiff-line-added">+         // the stack size requirements of SVM are better understood,</span>
<span class="udiff-line-added">+         // this logic can be pushed down into os::create_thread.</span>
<span class="udiff-line-added">+         int stack_size = CompilerThreadStackSize;</span>
<span class="udiff-line-added">+         if (stack_size == 0) {</span>
<span class="udiff-line-added">+           stack_size = VMThreadStackSize;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (stack_size != 0) {</span>
<span class="udiff-line-added">+           FLAG_SET_DEFAULT(CompilerThreadStackSize, stack_size * 2);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+       }</span>
<span class="udiff-line-added">+     } else {</span>
<span class="udiff-line-added">+ #ifdef TIERED</span>
<span class="udiff-line-added">+       if (!TieredCompilation) {</span>
<span class="udiff-line-added">+          warning(&quot;Disabling tiered compilation with non-native JVMCI compiler is not recommended. &quot;</span>
<span class="udiff-line-added">+                  &quot;Turning on tiered compilation and disabling intermediate compilation levels instead. &quot;);</span>
<span class="udiff-line-added">+          FLAG_SET_ERGO(TieredCompilation, true);</span>
<span class="udiff-line-added">+          if (CompilationModeFlag::normal()) {</span>
<span class="udiff-line-added">+            CompilationModeFlag::set_high_only_quick_internal(true);</span>
<span class="udiff-line-added">+          }</span>
<span class="udiff-line-added">+          if (CICompilerCount &lt; 2 &amp;&amp; CompilationModeFlag::quick_internal()) {</span>
<span class="udiff-line-added">+             warning(&quot;Increasing number of compiler threads for JVMCI compiler.&quot;);</span>
<span class="udiff-line-added">+             FLAG_SET_ERGO(CICompilerCount, 2);</span>
<span class="udiff-line-added">+          }</span>
<span class="udiff-line-added">+       }</span>
<span class="udiff-line-added">+ #else // TIERED</span>
<span class="udiff-line-added">+       // Adjust the on stack replacement percentage to avoid early</span>
<span class="udiff-line-added">+       // OSR compilations while JVMCI itself is warming up</span>
<span class="udiff-line-added">+       if (FLAG_IS_DEFAULT(OnStackReplacePercentage)) {</span>
<span class="udiff-line-added">+         FLAG_SET_DEFAULT(OnStackReplacePercentage, 933);</span>
<span class="udiff-line-added">+       }</span>
<span class="udiff-line-added">+ #endif // !TIERED</span>
<span class="udiff-line-added">+       // JVMCI needs values not less than defaults</span>
<span class="udiff-line-added">+       if (FLAG_IS_DEFAULT(ReservedCodeCacheSize)) {</span>
<span class="udiff-line-added">+         FLAG_SET_DEFAULT(ReservedCodeCacheSize, MAX2(64*M, ReservedCodeCacheSize));</span>
<span class="udiff-line-added">+       }</span>
<span class="udiff-line-added">+       if (FLAG_IS_DEFAULT(InitialCodeCacheSize)) {</span>
<span class="udiff-line-added">+         FLAG_SET_DEFAULT(InitialCodeCacheSize, MAX2(16*M, InitialCodeCacheSize));</span>
<span class="udiff-line-added">+       }</span>
<span class="udiff-line-added">+       if (FLAG_IS_DEFAULT(MetaspaceSize)) {</span>
<span class="udiff-line-added">+         FLAG_SET_DEFAULT(MetaspaceSize, MIN2(MAX2(12*M, MetaspaceSize), MaxMetaspaceSize));</span>
<span class="udiff-line-added">+       }</span>
<span class="udiff-line-added">+       if (FLAG_IS_DEFAULT(NewSizeThreadIncrease)) {</span>
<span class="udiff-line-added">+         FLAG_SET_DEFAULT(NewSizeThreadIncrease, MAX2(4*K, NewSizeThreadIncrease));</span>
<span class="udiff-line-added">+       }</span>
<span class="udiff-line-added">+     } // !UseJVMCINativeLibrary</span>
<span class="udiff-line-added">+   } // UseJVMCICompiler</span>
  }
  #endif // INCLUDE_JVMCI
  
  bool CompilerConfig::check_args_consistency(bool status) {
    // Check lower bounds of the code cache
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -316,19 +383,19 @@</span>
  
    if (BackgroundCompilation &amp;&amp; ReplayCompiles) {
      if (!FLAG_IS_DEFAULT(BackgroundCompilation)) {
        warning(&quot;BackgroundCompilation disabled due to ReplayCompiles option.&quot;);
      }
<span class="udiff-line-modified-removed">-     FLAG_SET_CMDLINE(bool, BackgroundCompilation, false);</span>
<span class="udiff-line-modified-added">+     FLAG_SET_CMDLINE(BackgroundCompilation, false);</span>
    }
  
  #ifdef COMPILER2
    if (PostLoopMultiversioning &amp;&amp; !RangeCheckElimination) {
      if (!FLAG_IS_DEFAULT(PostLoopMultiversioning)) {
        warning(&quot;PostLoopMultiversioning disabled because RangeCheckElimination is disabled.&quot;);
      }
<span class="udiff-line-modified-removed">-     FLAG_SET_CMDLINE(bool, PostLoopMultiversioning, false);</span>
<span class="udiff-line-modified-added">+     FLAG_SET_CMDLINE(PostLoopMultiversioning, false);</span>
    }
    if (UseCountedLoopSafepoints &amp;&amp; LoopStripMiningIter == 0) {
      if (!FLAG_IS_DEFAULT(UseCountedLoopSafepoints) || !FLAG_IS_DEFAULT(LoopStripMiningIter)) {
        warning(&quot;When counted loop safepoints are enabled, LoopStripMiningIter must be at least 1 (a safepoint every 1 iteration): setting it to 1&quot;);
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -344,31 +411,31 @@</span>
    if (Arguments::is_interpreter_only()) {
      if (UseCompiler) {
        if (!FLAG_IS_DEFAULT(UseCompiler)) {
          warning(&quot;UseCompiler disabled due to -Xint.&quot;);
        }
<span class="udiff-line-modified-removed">-       FLAG_SET_CMDLINE(bool, UseCompiler, false);</span>
<span class="udiff-line-modified-added">+       FLAG_SET_CMDLINE(UseCompiler, false);</span>
      }
      if (ProfileInterpreter) {
        if (!FLAG_IS_DEFAULT(ProfileInterpreter)) {
          warning(&quot;ProfileInterpreter disabled due to -Xint.&quot;);
        }
<span class="udiff-line-modified-removed">-       FLAG_SET_CMDLINE(bool, ProfileInterpreter, false);</span>
<span class="udiff-line-modified-added">+       FLAG_SET_CMDLINE(ProfileInterpreter, false);</span>
      }
      if (TieredCompilation) {
        if (!FLAG_IS_DEFAULT(TieredCompilation)) {
          warning(&quot;TieredCompilation disabled due to -Xint.&quot;);
        }
<span class="udiff-line-modified-removed">-       FLAG_SET_CMDLINE(bool, TieredCompilation, false);</span>
<span class="udiff-line-modified-added">+       FLAG_SET_CMDLINE(TieredCompilation, false);</span>
      }
  #if INCLUDE_JVMCI
      if (EnableJVMCI) {
        if (!FLAG_IS_DEFAULT(EnableJVMCI) || !FLAG_IS_DEFAULT(UseJVMCICompiler)) {
          warning(&quot;JVMCI Compiler disabled due to -Xint.&quot;);
        }
<span class="udiff-line-modified-removed">-       FLAG_SET_CMDLINE(bool, EnableJVMCI, false);</span>
<span class="udiff-line-modified-removed">-       FLAG_SET_CMDLINE(bool, UseJVMCICompiler, false);</span>
<span class="udiff-line-modified-added">+       FLAG_SET_CMDLINE(EnableJVMCI, false);</span>
<span class="udiff-line-modified-added">+       FLAG_SET_CMDLINE(UseJVMCICompiler, false);</span>
      }
  #endif
    } else {
  #if INCLUDE_JVMCI
      status = status &amp;&amp; JVMCIGlobals::check_jvmci_flags_are_consistent();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -390,31 +457,25 @@</span>
  
  #if INCLUDE_JVMCI
    // Check that JVMCI compiler supports selested GC.
    // Should be done after GCConfig::initialize() was called.
    JVMCIGlobals::check_jvmci_supported_gc();
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   // Do JVMCI specific settings</span>
    set_jvmci_specific_flags();
  #endif
  
<span class="udiff-line-added">+ #ifdef TIERED</span>
    if (TieredCompilation) {
      set_tiered_flags();
<span class="udiff-line-modified-removed">-   } else {</span>
<span class="udiff-line-removed">-     int max_compilation_policy_choice = 1;</span>
<span class="udiff-line-removed">- #ifdef COMPILER2</span>
<span class="udiff-line-removed">-     if (is_server_compilation_mode_vm()) {</span>
<span class="udiff-line-removed">-       max_compilation_policy_choice = 2;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+   } else</span>
  #endif
<span class="udiff-line-modified-removed">-     // Check if the policy is valid.</span>
<span class="udiff-line-removed">-     if (CompilationPolicyChoice &gt;= max_compilation_policy_choice) {</span>
<span class="udiff-line-removed">-       vm_exit_during_initialization(</span>
<span class="udiff-line-removed">-         &quot;Incompatible compilation policy selected&quot;, NULL);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+   {</span>
      // Scale CompileThreshold
      // CompileThresholdScaling == 0.0 is equivalent to -Xint and leaves CompileThreshold unchanged.
      if (!FLAG_IS_DEFAULT(CompileThresholdScaling) &amp;&amp; CompileThresholdScaling &gt; 0.0) {
<span class="udiff-line-modified-removed">-       FLAG_SET_ERGO(intx, CompileThreshold, scaled_compile_threshold(CompileThreshold));</span>
<span class="udiff-line-modified-added">+       FLAG_SET_ERGO(CompileThreshold, scaled_compile_threshold(CompileThreshold));</span>
      }
    }
  
    if (UseOnStackReplacement &amp;&amp; !UseLoopCounter) {
      warning(&quot;On-stack-replacement requires loop counters; enabling loop counters&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -431,11 +492,11 @@</span>
  #ifndef PRODUCT
    if (!IncrementalInline) {
      AlwaysIncrementalInline = false;
    }
    if (PrintIdealGraphLevel &gt; 0) {
<span class="udiff-line-modified-removed">-     FLAG_SET_ERGO(bool, PrintIdealGraph, true);</span>
<span class="udiff-line-modified-added">+     FLAG_SET_ERGO(PrintIdealGraph, true);</span>
    }
  #endif
    if (!UseTypeSpeculation &amp;&amp; FLAG_IS_DEFAULT(TypeProfileLevel)) {
      // nothing to use the profiling, turn if off
      FLAG_SET_DEFAULT(TypeProfileLevel, 0);
</pre>
<center><a href="compileTask.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="compilerDefinitions.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>