<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/compiler/compileTask.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="compileBroker.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="compileTask.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/compiler/compileTask.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 1998, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 1998, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -195,17 +195,17 @@</span>
  bool CompileTask::is_unloaded() const {
    return _method_holder != NULL &amp;&amp; JNIHandles::is_weak_global_handle(_method_holder) &amp;&amp; JNIHandles::is_global_weak_cleared(_method_holder);
  }
  
  // RedefineClasses support
<span class="udiff-line-modified-removed">- void CompileTask::metadata_do(void f(Metadata*)) {</span>
<span class="udiff-line-modified-added">+ void CompileTask::metadata_do(MetadataClosure* f) {</span>
    if (is_unloaded()) {
      return;
    }
<span class="udiff-line-modified-removed">-   f(method());</span>
<span class="udiff-line-modified-added">+   f-&gt;do_metadata(method());</span>
    if (hot_method() != NULL &amp;&amp; hot_method() != method()) {
<span class="udiff-line-modified-removed">-     f(hot_method());</span>
<span class="udiff-line-modified-added">+     f-&gt;do_metadata(hot_method());</span>
    }
  }
  
  // ------------------------------------------------------------------
  // CompileTask::print_line_on_error
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -338,11 +338,11 @@</span>
    // &lt;task id=&#39;9&#39; method=&#39;M&#39; osr_bci=&#39;X&#39; level=&#39;1&#39; blocking=&#39;1&#39; stamp=&#39;1.234&#39;&gt;
    log-&gt;print(&quot; compile_id=&#39;%d&#39;&quot;, _compile_id);
    if (_osr_bci != CompileBroker::standard_entry_bci) {
      log-&gt;print(&quot; compile_kind=&#39;osr&#39;&quot;);  // same as nmethod::compile_kind
    } // else compile_kind=&#39;c2c&#39;
<span class="udiff-line-modified-removed">-   if (!method.is_null())  log-&gt;method(method);</span>
<span class="udiff-line-modified-added">+   if (!method.is_null())  log-&gt;method(method());</span>
    if (_osr_bci != CompileBroker::standard_entry_bci) {
      log-&gt;print(&quot; osr_bci=&#39;%d&#39;&quot;, _osr_bci);
    }
    if (_comp_level != CompLevel_highest_tier) {
      log-&gt;print(&quot; level=&#39;%d&#39;&quot;, _comp_level);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -354,25 +354,20 @@</span>
  }
  
  // ------------------------------------------------------------------
  // CompileTask::log_task_queued
  void CompileTask::log_task_queued() {
<span class="udiff-line-removed">-   Thread* thread = Thread::current();</span>
    ttyLocker ttyl;
<span class="udiff-line-modified-removed">-   ResourceMark rm(thread);</span>
<span class="udiff-line-modified-added">+   ResourceMark rm;</span>
  
    xtty-&gt;begin_elem(&quot;task_queued&quot;);
    log_task(xtty);
    assert(_compile_reason &gt; CompileTask::Reason_None &amp;&amp; _compile_reason &lt; CompileTask::Reason_Count, &quot;Valid values&quot;);
    xtty-&gt;print(&quot; comment=&#39;%s&#39;&quot;, reason_name(_compile_reason));
  
<span class="udiff-line-modified-removed">-   if (_hot_method != NULL) {</span>
<span class="udiff-line-modified-removed">-     methodHandle hot(thread, _hot_method);</span>
<span class="udiff-line-removed">-     methodHandle method(thread, _method);</span>
<span class="udiff-line-removed">-     if (hot() != method()) {</span>
<span class="udiff-line-removed">-       xtty-&gt;method(hot);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+   if (_hot_method != NULL &amp;&amp; _hot_method != _method) {</span>
<span class="udiff-line-modified-added">+     xtty-&gt;method(_hot_method);</span>
    }
    if (_hot_count != 0) {
      xtty-&gt;print(&quot; hot_count=&#39;%d&#39;&quot;, _hot_count);
    }
    xtty-&gt;end_elem();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -394,10 +389,11 @@</span>
    Thread* thread = Thread::current();
    methodHandle method(thread, this-&gt;method());
    ResourceMark rm(thread);
  
    if (!_is_success) {
<span class="udiff-line-added">+     assert(_failure_reason != NULL, &quot;missing&quot;);</span>
      const char* reason = _failure_reason != NULL ? _failure_reason : &quot;unknown&quot;;
      log-&gt;elem(&quot;failure reason=&#39;%s&#39;&quot;, reason);
    }
  
    // &lt;task_done ... stamp=&#39;1.234&#39;&gt;  &lt;/task&gt;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -413,13 +409,11 @@</span>
    }
    log-&gt;stamp();
    log-&gt;end_elem();
    log-&gt;clear_identities();   // next task will have different CI
    log-&gt;tail(&quot;task&quot;);
<span class="udiff-line-modified-removed">-   if (log-&gt;unflushed_count() &gt; 2000) {</span>
<span class="udiff-line-removed">-     log-&gt;flush();</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-modified-added">+   log-&gt;flush();</span>
    log-&gt;mark_file_end();
  }
  
  // ------------------------------------------------------------------
  // CompileTask::check_break_at_flags
</pre>
<center><a href="compileBroker.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="compileTask.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>