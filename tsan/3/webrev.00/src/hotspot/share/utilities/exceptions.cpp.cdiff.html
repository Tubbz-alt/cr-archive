<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/utilities/exceptions.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="events.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="exceptions.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/utilities/exceptions.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 27,10 ***</span>
<span class="line-new-header">--- 27,11 ---</span>
  #include &quot;classfile/vmSymbols.hpp&quot;
  #include &quot;compiler/compileBroker.hpp&quot;
  #include &quot;logging/log.hpp&quot;
  #include &quot;logging/logStream.hpp&quot;
  #include &quot;memory/resourceArea.hpp&quot;
<span class="line-added">+ #include &quot;memory/universe.hpp&quot;</span>
  #include &quot;oops/oop.inline.hpp&quot;
  #include &quot;runtime/handles.inline.hpp&quot;
  #include &quot;runtime/init.hpp&quot;
  #include &quot;runtime/java.hpp&quot;
  #include &quot;runtime/javaCalls.hpp&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 226,11 ***</span>
      InstanceKlass* k = SystemDictionary::StackOverflowError_klass();
      oop e = k-&gt;allocate_instance(CHECK);
      exception = Handle(THREAD, e);  // fill_in_stack trace does gc
      assert(k-&gt;is_initialized(), &quot;need to increase java_thread_min_stack_allowed calculation&quot;);
      if (StackTraceInThrowable) {
<span class="line-modified">!       java_lang_Throwable::fill_in_stack_trace(exception, method());</span>
      }
      // Increment counter for hs_err file reporting
      Atomic::inc(&amp;Exceptions::_stack_overflow_errors);
    } else {
      // if prior exception, throw that one instead
<span class="line-new-header">--- 227,11 ---</span>
      InstanceKlass* k = SystemDictionary::StackOverflowError_klass();
      oop e = k-&gt;allocate_instance(CHECK);
      exception = Handle(THREAD, e);  // fill_in_stack trace does gc
      assert(k-&gt;is_initialized(), &quot;need to increase java_thread_min_stack_allowed calculation&quot;);
      if (StackTraceInThrowable) {
<span class="line-modified">!       java_lang_Throwable::fill_in_stack_trace(exception, method);</span>
      }
      // Increment counter for hs_err file reporting
      Atomic::inc(&amp;Exceptions::_stack_overflow_errors);
    } else {
      // if prior exception, throw that one instead
</pre>
<hr />
<pre>
<span class="line-old-header">*** 432,13 ***</span>
  volatile int Exceptions::_out_of_memory_error_java_heap_errors = 0;
  volatile int Exceptions::_out_of_memory_error_metaspace_errors = 0;
  volatile int Exceptions::_out_of_memory_error_class_metaspace_errors = 0;
  
  void Exceptions::count_out_of_memory_exceptions(Handle exception) {
<span class="line-modified">!   if (oopDesc::equals(exception(), Universe::out_of_memory_error_metaspace())) {</span>
       Atomic::inc(&amp;_out_of_memory_error_metaspace_errors);
<span class="line-modified">!   } else if (oopDesc::equals(exception(), Universe::out_of_memory_error_class_metaspace())) {</span>
       Atomic::inc(&amp;_out_of_memory_error_class_metaspace_errors);
    } else {
       // everything else reported as java heap OOM
       Atomic::inc(&amp;_out_of_memory_error_java_heap_errors);
    }
<span class="line-new-header">--- 433,13 ---</span>
  volatile int Exceptions::_out_of_memory_error_java_heap_errors = 0;
  volatile int Exceptions::_out_of_memory_error_metaspace_errors = 0;
  volatile int Exceptions::_out_of_memory_error_class_metaspace_errors = 0;
  
  void Exceptions::count_out_of_memory_exceptions(Handle exception) {
<span class="line-modified">!   if (exception() == Universe::out_of_memory_error_metaspace()) {</span>
       Atomic::inc(&amp;_out_of_memory_error_metaspace_errors);
<span class="line-modified">!   } else if (exception() == Universe::out_of_memory_error_class_metaspace()) {</span>
       Atomic::inc(&amp;_out_of_memory_error_class_metaspace_errors);
    } else {
       // everything else reported as java heap OOM
       Atomic::inc(&amp;_out_of_memory_error_java_heap_errors);
    }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 523,19 ***</span>
    }
    debug_check_abort(exception()-&gt;klass()-&gt;external_name(), message);
  }
  
  // for logging exceptions
<span class="line-modified">! void Exceptions::log_exception(Handle exception, stringStream tempst) {</span>
    ResourceMark rm;
<span class="line-modified">!   Symbol* message = java_lang_Throwable::detail_message(exception());</span>
<span class="line-modified">!   if (message != NULL) {</span>
      log_info(exceptions)(&quot;Exception &lt;%s: %s&gt;\n thrown in %s&quot;,
                           exception-&gt;print_value_string(),
<span class="line-modified">!                          message-&gt;as_C_string(),</span>
<span class="line-modified">!                          tempst.as_string());</span>
    } else {
      log_info(exceptions)(&quot;Exception &lt;%s&gt;\n thrown in %s&quot;,
                           exception-&gt;print_value_string(),
<span class="line-modified">!                          tempst.as_string());</span>
    }
  }
<span class="line-new-header">--- 524,19 ---</span>
    }
    debug_check_abort(exception()-&gt;klass()-&gt;external_name(), message);
  }
  
  // for logging exceptions
<span class="line-modified">! void Exceptions::log_exception(Handle exception, const char* message) {</span>
    ResourceMark rm;
<span class="line-modified">!   Symbol* detail_message = java_lang_Throwable::detail_message(exception());</span>
<span class="line-modified">!   if (detail_message != NULL) {</span>
      log_info(exceptions)(&quot;Exception &lt;%s: %s&gt;\n thrown in %s&quot;,
                           exception-&gt;print_value_string(),
<span class="line-modified">!                          detail_message-&gt;as_C_string(),</span>
<span class="line-modified">!                          message);</span>
    } else {
      log_info(exceptions)(&quot;Exception &lt;%s&gt;\n thrown in %s&quot;,
                           exception-&gt;print_value_string(),
<span class="line-modified">!                          message);</span>
    }
  }
</pre>
<center><a href="events.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="exceptions.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>