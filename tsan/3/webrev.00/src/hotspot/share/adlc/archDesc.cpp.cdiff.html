<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/adlc/archDesc.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="adlparse.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="dfa.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/adlc/archDesc.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 243,16 ***</span>
      check_optype(op-&gt;_matrule);
  
      // Construct chain rules
      build_chain_rule(op);
  
<span class="line-modified">!     MatchRule &amp;mrule = *op-&gt;_matrule;</span>
<span class="line-modified">!     Predicate *pred  =  op-&gt;_predicate;</span>
  
      // Grab the machine type of the operand
      const char  *rootOp    = op-&gt;_ident;
<span class="line-modified">!     mrule._machType  = rootOp;</span>
  
      // Check for special cases
      if (strcmp(rootOp,&quot;Universe&quot;)==0) continue;
      if (strcmp(rootOp,&quot;label&quot;)==0) continue;
      // !!!!! !!!!!
<span class="line-new-header">--- 243,16 ---</span>
      check_optype(op-&gt;_matrule);
  
      // Construct chain rules
      build_chain_rule(op);
  
<span class="line-modified">!     MatchRule *mrule = op-&gt;_matrule;</span>
<span class="line-modified">!     Predicate *pred  = op-&gt;_predicate;</span>
  
      // Grab the machine type of the operand
      const char  *rootOp    = op-&gt;_ident;
<span class="line-modified">!     mrule-&gt;_machType  = rootOp;</span>
  
      // Check for special cases
      if (strcmp(rootOp,&quot;Universe&quot;)==0) continue;
      if (strcmp(rootOp,&quot;label&quot;)==0) continue;
      // !!!!! !!!!!
</pre>
<hr />
<pre>
<span class="line-old-header">*** 269,14 ***</span>
        ((AttributeForm*)_globalNames[AttributeForm::_op_cost])-&gt;_attrdef;
      const char *cost        =  costStr? costStr : defaultCost;
  
      // Find result type for match.
      const char *result      = op-&gt;reduce_result();
<span class="line-removed">-     bool        has_root    = false;</span>
  
<span class="line-modified">!     // Construct a MatchList for this entry</span>
<span class="line-modified">!     buildMatchList(op-&gt;_matrule, result, rootOp, pred, cost);</span>
    }
  }
  
  // Build MatchList structures for instructions
  void ArchDesc::inspectInstructions() {
<span class="line-new-header">--- 269,17 ---</span>
        ((AttributeForm*)_globalNames[AttributeForm::_op_cost])-&gt;_attrdef;
      const char *cost        =  costStr? costStr : defaultCost;
  
      // Find result type for match.
      const char *result      = op-&gt;reduce_result();
  
<span class="line-modified">!     // Construct a MatchList for this entry.</span>
<span class="line-modified">!     // Iterate over the list to enumerate all match cases for operands with multiple match rules.</span>
<span class="line-added">+     for (; mrule != NULL; mrule = mrule-&gt;_next) {</span>
<span class="line-added">+       mrule-&gt;_machType = rootOp;</span>
<span class="line-added">+       buildMatchList(mrule, result, rootOp, pred, cost);</span>
<span class="line-added">+     }</span>
    }
  }
  
  // Build MatchList structures for instructions
  void ArchDesc::inspectInstructions() {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 803,10 ***</span>
<span class="line-new-header">--- 806,12 ---</span>
  
    if (strcmp(reg_class_name,&quot;Universe&quot;)==0) {
      return &quot;RegMask::Empty&quot;;
    } else if (strcmp(reg_class_name,&quot;stack_slots&quot;)==0) {
      return &quot;(Compile::current()-&gt;FIRST_STACK_mask())&quot;;
<span class="line-added">+   } else if (strcmp(reg_class_name, &quot;dynamic&quot;)==0) {</span>
<span class="line-added">+     return &quot;*_opnds[0]-&gt;in_RegMask(0)&quot;;</span>
    } else {
      char       *rc_name = toUpper(reg_class_name);
      const char *mask    = &quot;_mask&quot;;
      int         length  = (int)strlen(rc_name) + (int)strlen(mask) + 5;
      char       *regMask = new char[length];
</pre>
<hr />
<pre>
<span class="line-old-header">*** 865,11 ***</span>
                 inForm._ident);
      abort();
    }
  
    // Instructions producing &#39;Universe&#39; use RegMask::Empty
<span class="line-modified">!   if( strcmp(result,&quot;Universe&quot;)==0 ) {</span>
      return &quot;RegMask::Empty&quot;;
    }
  
    // Lookup this result operand and get its register class
    Form *form = (Form*)_globalNames[result];
<span class="line-new-header">--- 870,11 ---</span>
                 inForm._ident);
      abort();
    }
  
    // Instructions producing &#39;Universe&#39; use RegMask::Empty
<span class="line-modified">!   if (strcmp(result,&quot;Universe&quot;) == 0) {</span>
      return &quot;RegMask::Empty&quot;;
    }
  
    // Lookup this result operand and get its register class
    Form *form = (Form*)_globalNames[result];
</pre>
<center><a href="adlparse.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="dfa.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>