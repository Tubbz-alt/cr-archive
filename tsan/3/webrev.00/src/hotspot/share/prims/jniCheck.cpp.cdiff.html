<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/prims/jniCheck.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="jni.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="jniCheck.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/prims/jniCheck.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 26,10 ***</span>
<span class="line-new-header">--- 26,12 ---</span>
  #include &quot;jni.h&quot;
  #include &quot;jvm.h&quot;
  #include &quot;classfile/javaClasses.inline.hpp&quot;
  #include &quot;classfile/systemDictionary.hpp&quot;
  #include &quot;classfile/vmSymbols.hpp&quot;
<span class="line-added">+ #include &quot;logging/log.hpp&quot;</span>
<span class="line-added">+ #include &quot;logging/logTag.hpp&quot;</span>
  #include &quot;memory/allocation.inline.hpp&quot;
  #include &quot;memory/guardedMemory.hpp&quot;
  #include &quot;oops/instanceKlass.hpp&quot;
  #include &quot;oops/oop.inline.hpp&quot;
  #include &quot;oops/symbol.hpp&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 264,11 ***</span>
    Klass* k_oop = jniCheck::validate_class(thr, cls, false);
  
    /* check for proper subclass hierarchy */
    JNIid* id = jfieldIDWorkaround::from_static_jfieldID(fid);
    Klass* f_oop = id-&gt;holder();
<span class="line-modified">!   if (!InstanceKlass::cast(k_oop)-&gt;is_subtype_of(f_oop))</span>
      ReportJNIFatalError(thr, fatal_wrong_static_field);
  
    /* check for proper field type */
    if (!id-&gt;find_local_field(&amp;fd))
      ReportJNIFatalError(thr, fatal_static_field_not_found);
<span class="line-new-header">--- 266,11 ---</span>
    Klass* k_oop = jniCheck::validate_class(thr, cls, false);
  
    /* check for proper subclass hierarchy */
    JNIid* id = jfieldIDWorkaround::from_static_jfieldID(fid);
    Klass* f_oop = id-&gt;holder();
<span class="line-modified">!   if (!k_oop-&gt;is_subtype_of(f_oop))</span>
      ReportJNIFatalError(thr, fatal_wrong_static_field);
  
    /* check for proper field type */
    if (!id-&gt;find_local_field(&amp;fd))
      ReportJNIFatalError(thr, fatal_static_field_not_found);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 446,20 ***</span>
  
  
  Method* jniCheck::validate_jmethod_id(JavaThread* thr, jmethodID method_id) {
    ASSERT_OOPS_ALLOWED;
    // do the fast jmethodID check first
<span class="line-modified">!   Method* moop = Method::checked_resolve_jmethod_id(method_id);</span>
<span class="line-modified">!   if (moop == NULL) {</span>
      ReportJNIFatalError(thr, fatal_wrong_class_or_method);
    }
<span class="line-modified">!   // jmethodIDs are supposed to be weak handles in the class loader data,</span>
    // but that can be expensive so check it last
    else if (!Method::is_method_id(method_id)) {
      ReportJNIFatalError(thr, fatal_non_weak_method);
    }
<span class="line-modified">!   return moop;</span>
  }
  
  
  oop jniCheck::validate_object(JavaThread* thr, jobject obj) {
    if (obj == NULL) return NULL;
<span class="line-new-header">--- 448,20 ---</span>
  
  
  Method* jniCheck::validate_jmethod_id(JavaThread* thr, jmethodID method_id) {
    ASSERT_OOPS_ALLOWED;
    // do the fast jmethodID check first
<span class="line-modified">!   Method* m = Method::checked_resolve_jmethod_id(method_id);</span>
<span class="line-modified">!   if (m == NULL) {</span>
      ReportJNIFatalError(thr, fatal_wrong_class_or_method);
    }
<span class="line-modified">!   // jmethodIDs are handles in the class loader data,</span>
    // but that can be expensive so check it last
    else if (!Method::is_method_id(method_id)) {
      ReportJNIFatalError(thr, fatal_non_weak_method);
    }
<span class="line-modified">!   return m;</span>
  }
  
  
  oop jniCheck::validate_object(JavaThread* thr, jobject obj) {
    if (obj == NULL) return NULL;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 511,27 ***</span>
  void jniCheck::validate_throwable_klass(JavaThread* thr, Klass* klass) {
    ASSERT_OOPS_ALLOWED;
    assert(klass != NULL, &quot;klass argument must have a value&quot;);
  
    if (!klass-&gt;is_instance_klass() ||
<span class="line-modified">!       !InstanceKlass::cast(klass)-&gt;is_subclass_of(SystemDictionary::Throwable_klass())) {</span>
      ReportJNIFatalError(thr, fatal_class_not_a_throwable_class);
    }
  }
  
<span class="line-modified">! void jniCheck::validate_call_object(JavaThread* thr, jobject obj, jmethodID method_id) {</span>
<span class="line-removed">-   /* validate the object being passed */</span>
    ASSERT_OOPS_ALLOWED;
<span class="line-modified">!   jniCheck::validate_jmethod_id(thr, method_id);</span>
<span class="line-modified">!   jniCheck::validate_object(thr, obj);</span>
<span class="line-modified">! }</span>
  
<span class="line-modified">! void jniCheck::validate_call_class(JavaThread* thr, jclass clazz, jmethodID method_id) {</span>
<span class="line-modified">!   /* validate the class being passed */</span>
<span class="line-modified">!   ASSERT_OOPS_ALLOWED;</span>
<span class="line-modified">!   jniCheck::validate_jmethod_id(thr, method_id);</span>
<span class="line-modified">!   jniCheck::validate_class(thr, clazz, false);</span>
  }
  
  
  /*
   * IMPLEMENTATION OF FUNCTIONS IN CHECKED TABLE
<span class="line-new-header">--- 513,38 ---</span>
  void jniCheck::validate_throwable_klass(JavaThread* thr, Klass* klass) {
    ASSERT_OOPS_ALLOWED;
    assert(klass != NULL, &quot;klass argument must have a value&quot;);
  
    if (!klass-&gt;is_instance_klass() ||
<span class="line-modified">!       !klass-&gt;is_subclass_of(SystemDictionary::Throwable_klass())) {</span>
      ReportJNIFatalError(thr, fatal_class_not_a_throwable_class);
    }
  }
  
<span class="line-modified">! void jniCheck::validate_call(JavaThread* thr, jclass clazz, jmethodID method_id, jobject obj) {</span>
    ASSERT_OOPS_ALLOWED;
<span class="line-modified">!   Method* m = jniCheck::validate_jmethod_id(thr, method_id);</span>
<span class="line-modified">!   InstanceKlass* holder = m-&gt;method_holder();</span>
<span class="line-modified">! </span>
<span class="line-added">+   if (clazz != NULL) {</span>
<span class="line-added">+     Klass* k = jniCheck::validate_class(thr, clazz, false);</span>
<span class="line-added">+     // Check that method is in the class, must be InstanceKlass</span>
<span class="line-added">+     if (!InstanceKlass::cast(k)-&gt;is_subtype_of(holder)) {</span>
<span class="line-added">+       ReportJNIFatalError(thr, fatal_wrong_class_or_method);</span>
<span class="line-added">+     }</span>
<span class="line-added">+   }</span>
  
<span class="line-modified">!   if (obj != NULL) {</span>
<span class="line-modified">!     oop recv = jniCheck::validate_object(thr, obj);</span>
<span class="line-modified">!     assert(recv != NULL, &quot;validate_object checks that&quot;);</span>
<span class="line-modified">!     Klass* rk = recv-&gt;klass();</span>
<span class="line-modified">! </span>
<span class="line-added">+     // Check that the object is a subtype of method holder too.</span>
<span class="line-added">+     if (!rk-&gt;is_subtype_of(holder)) {</span>
<span class="line-added">+       ReportJNIFatalError(thr, fatal_wrong_class_or_method);</span>
<span class="line-added">+     }</span>
<span class="line-added">+   }</span>
  }
  
  
  /*
   * IMPLEMENTATION OF FUNCTIONS IN CHECKED TABLE
</pre>
<hr />
<pre>
<span class="line-old-header">*** 593,12 ***</span>
                                  jclass cls,
                                  jmethodID methodID,
                                  jboolean isStatic))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_class(thr, cls, false);</span>
<span class="line-removed">-       jniCheck::validate_jmethod_id(thr, methodID);</span>
      )
      jobject result = UNCHECKED()-&gt;ToReflectedMethod(env, cls, methodID,
                                                      isStatic);
      functionExit(thr);
      return result;
<span class="line-new-header">--- 606,11 ---</span>
                                  jclass cls,
                                  jmethodID methodID,
                                  jboolean isStatic))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call(thr, cls, methodID);</span>
      )
      jobject result = UNCHECKED()-&gt;ToReflectedMethod(env, cls, methodID,
                                                      isStatic);
      functionExit(thr);
      return result;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 850,12 ***</span>
                          jmethodID methodID,
                          ...))
      functionEnter(thr);
      va_list args;
      IN_VM(
<span class="line-modified">!       jniCheck::validate_class(thr, clazz, false);</span>
<span class="line-removed">-       jniCheck::validate_jmethod_id(thr, methodID);</span>
      )
      va_start(args, methodID);
      jobject result = UNCHECKED()-&gt;NewObjectV(env,clazz,methodID,args);
      va_end(args);
      functionExit(thr);
<span class="line-new-header">--- 862,11 ---</span>
                          jmethodID methodID,
                          ...))
      functionEnter(thr);
      va_list args;
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call(thr, clazz, methodID);</span>
      )
      va_start(args, methodID);
      jobject result = UNCHECKED()-&gt;NewObjectV(env,clazz,methodID,args);
      va_end(args);
      functionExit(thr);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 867,12 ***</span>
                           jclass clazz,
                           jmethodID methodID,
                           va_list args))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_class(thr, clazz, false);</span>
<span class="line-removed">-       jniCheck::validate_jmethod_id(thr, methodID);</span>
      )
      jobject result = UNCHECKED()-&gt;NewObjectV(env,clazz,methodID,args);
      functionExit(thr);
      return result;
  JNI_END
<span class="line-new-header">--- 878,11 ---</span>
                           jclass clazz,
                           jmethodID methodID,
                           va_list args))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call(thr, clazz, methodID);</span>
      )
      jobject result = UNCHECKED()-&gt;NewObjectV(env,clazz,methodID,args);
      functionExit(thr);
      return result;
  JNI_END
</pre>
<hr />
<pre>
<span class="line-old-header">*** 882,12 ***</span>
                           jclass clazz,
                           jmethodID methodID,
                           const jvalue *args))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_class(thr, clazz, false);</span>
<span class="line-removed">-       jniCheck::validate_jmethod_id(thr, methodID);</span>
      )
      jobject result = UNCHECKED()-&gt;NewObjectA(env,clazz,methodID,args);
      functionExit(thr);
      return result;
  JNI_END
<span class="line-new-header">--- 892,11 ---</span>
                           jclass clazz,
                           jmethodID methodID,
                           const jvalue *args))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call(thr, clazz, methodID);</span>
      )
      jobject result = UNCHECKED()-&gt;NewObjectA(env,clazz,methodID,args);
      functionExit(thr);
      return result;
  JNI_END
</pre>
<hr />
<pre>
<span class="line-old-header">*** 939,11 ***</span>
                                     jmethodID methodID, \
                                     ...)) \
      functionEnter(thr); \
      va_list args; \
      IN_VM( \
<span class="line-modified">!       jniCheck::validate_call_object(thr, obj, methodID); \</span>
      ) \
      va_start(args,methodID); \
      ResultType result =UNCHECKED()-&gt;Call##Result##MethodV(env, obj, methodID, \
                                                            args); \
      va_end(args); \
<span class="line-new-header">--- 948,11 ---</span>
                                     jmethodID methodID, \
                                     ...)) \
      functionEnter(thr); \
      va_list args; \
      IN_VM( \
<span class="line-modified">!       jniCheck::validate_call(thr, NULL, methodID, obj); \</span>
      ) \
      va_start(args,methodID); \
      ResultType result =UNCHECKED()-&gt;Call##Result##MethodV(env, obj, methodID, \
                                                            args); \
      va_end(args); \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 957,11 ***</span>
                                      jobject obj, \
                                      jmethodID methodID, \
                                      va_list args)) \
      functionEnter(thr); \
      IN_VM(\
<span class="line-modified">!       jniCheck::validate_call_object(thr, obj, methodID); \</span>
      ) \
      ResultType result = UNCHECKED()-&gt;Call##Result##MethodV(env, obj, methodID,\
                                                             args); \
      thr-&gt;set_pending_jni_exception_check(&quot;Call&quot;#Result&quot;MethodV&quot;); \
      functionExit(thr); \
<span class="line-new-header">--- 966,11 ---</span>
                                      jobject obj, \
                                      jmethodID methodID, \
                                      va_list args)) \
      functionEnter(thr); \
      IN_VM(\
<span class="line-modified">!       jniCheck::validate_call(thr, NULL, methodID, obj); \</span>
      ) \
      ResultType result = UNCHECKED()-&gt;Call##Result##MethodV(env, obj, methodID,\
                                                             args); \
      thr-&gt;set_pending_jni_exception_check(&quot;Call&quot;#Result&quot;MethodV&quot;); \
      functionExit(thr); \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 973,11 ***</span>
                                      jobject obj, \
                                      jmethodID methodID, \
                                      const jvalue * args)) \
      functionEnter(thr); \
      IN_VM( \
<span class="line-modified">!       jniCheck::validate_call_object(thr, obj, methodID); \</span>
      ) \
      ResultType result = UNCHECKED()-&gt;Call##Result##MethodA(env, obj, methodID,\
                                                             args); \
      thr-&gt;set_pending_jni_exception_check(&quot;Call&quot;#Result&quot;MethodA&quot;); \
      functionExit(thr); \
<span class="line-new-header">--- 982,11 ---</span>
                                      jobject obj, \
                                      jmethodID methodID, \
                                      const jvalue * args)) \
      functionEnter(thr); \
      IN_VM( \
<span class="line-modified">!       jniCheck::validate_call(thr, NULL, methodID, obj); \</span>
      ) \
      ResultType result = UNCHECKED()-&gt;Call##Result##MethodA(env, obj, methodID,\
                                                             args); \
      thr-&gt;set_pending_jni_exception_check(&quot;Call&quot;#Result&quot;MethodA&quot;); \
      functionExit(thr); \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1000,11 ***</span>
                               jmethodID methodID, \
                               ...))
      functionEnter(thr);
      va_list args;
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call_object(thr, obj, methodID);</span>
      )
      va_start(args,methodID);
      UNCHECKED()-&gt;CallVoidMethodV(env,obj,methodID,args);
      va_end(args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallVoidMethod&quot;);
<span class="line-new-header">--- 1009,11 ---</span>
                               jmethodID methodID, \
                               ...))
      functionEnter(thr);
      va_list args;
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call(thr, NULL, methodID, obj);</span>
      )
      va_start(args,methodID);
      UNCHECKED()-&gt;CallVoidMethodV(env,obj,methodID,args);
      va_end(args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallVoidMethod&quot;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1016,11 ***</span>
                                jobject obj,
                                jmethodID methodID,
                                va_list args))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call_object(thr, obj, methodID);</span>
      )
      UNCHECKED()-&gt;CallVoidMethodV(env,obj,methodID,args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallVoidMethodV&quot;);
      functionExit(thr);
  JNI_END
<span class="line-new-header">--- 1025,11 ---</span>
                                jobject obj,
                                jmethodID methodID,
                                va_list args))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call(thr, NULL, methodID, obj);</span>
      )
      UNCHECKED()-&gt;CallVoidMethodV(env,obj,methodID,args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallVoidMethodV&quot;);
      functionExit(thr);
  JNI_END
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1030,11 ***</span>
                                jobject obj,
                                jmethodID methodID,
                                const jvalue * args))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call_object(thr, obj, methodID);</span>
      )
      UNCHECKED()-&gt;CallVoidMethodA(env,obj,methodID,args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallVoidMethodA&quot;);
      functionExit(thr);
  JNI_END
<span class="line-new-header">--- 1039,11 ---</span>
                                jobject obj,
                                jmethodID methodID,
                                const jvalue * args))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call(thr, NULL, methodID, obj);</span>
      )
      UNCHECKED()-&gt;CallVoidMethodA(env,obj,methodID,args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallVoidMethodA&quot;);
      functionExit(thr);
  JNI_END
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1047,12 ***</span>
                                               jmethodID methodID, \
                                               ...)) \
      functionEnter(thr); \
      va_list args; \
      IN_VM( \
<span class="line-modified">!       jniCheck::validate_call_object(thr, obj, methodID); \</span>
<span class="line-removed">-       jniCheck::validate_call_class(thr, clazz, methodID); \</span>
      ) \
      va_start(args,methodID); \
      ResultType result = UNCHECKED()-&gt;CallNonvirtual##Result##MethodV(env, \
                                                                       obj, \
                                                                       clazz, \
<span class="line-new-header">--- 1056,11 ---</span>
                                               jmethodID methodID, \
                                               ...)) \
      functionEnter(thr); \
      va_list args; \
      IN_VM( \
<span class="line-modified">!       jniCheck::validate_call(thr, clazz, methodID, obj); \</span>
      ) \
      va_start(args,methodID); \
      ResultType result = UNCHECKED()-&gt;CallNonvirtual##Result##MethodV(env, \
                                                                       obj, \
                                                                       clazz, \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1070,12 ***</span>
                                                jclass clazz, \
                                                jmethodID methodID, \
                                                va_list args)) \
      functionEnter(thr); \
      IN_VM( \
<span class="line-modified">!       jniCheck::validate_call_object(thr, obj, methodID); \</span>
<span class="line-removed">-       jniCheck::validate_call_class(thr, clazz, methodID); \</span>
      ) \
      ResultType result = UNCHECKED()-&gt;CallNonvirtual##Result##MethodV(env, \
                                                                       obj, \
                                                                       clazz, \
                                                                       methodID,\
<span class="line-new-header">--- 1078,11 ---</span>
                                                jclass clazz, \
                                                jmethodID methodID, \
                                                va_list args)) \
      functionEnter(thr); \
      IN_VM( \
<span class="line-modified">!       jniCheck::validate_call(thr, clazz, methodID, obj); \</span>
      ) \
      ResultType result = UNCHECKED()-&gt;CallNonvirtual##Result##MethodV(env, \
                                                                       obj, \
                                                                       clazz, \
                                                                       methodID,\
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1091,12 ***</span>
                                                jclass clazz, \
                                                jmethodID methodID, \
                                                const jvalue * args)) \
      functionEnter(thr); \
      IN_VM( \
<span class="line-modified">!       jniCheck::validate_call_object(thr, obj, methodID); \</span>
<span class="line-removed">-       jniCheck::validate_call_class(thr, clazz, methodID); \</span>
      ) \
      ResultType result = UNCHECKED()-&gt;CallNonvirtual##Result##MethodA(env, \
                                                                       obj, \
                                                                       clazz, \
                                                                       methodID,\
<span class="line-new-header">--- 1098,11 ---</span>
                                                jclass clazz, \
                                                jmethodID methodID, \
                                                const jvalue * args)) \
      functionEnter(thr); \
      IN_VM( \
<span class="line-modified">!       jniCheck::validate_call(thr, clazz, methodID, obj); \</span>
      ) \
      ResultType result = UNCHECKED()-&gt;CallNonvirtual##Result##MethodA(env, \
                                                                       obj, \
                                                                       clazz, \
                                                                       methodID,\
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1123,12 ***</span>
                                         jmethodID methodID,
                                         ...))
      functionEnter(thr);
      va_list args;
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call_object(thr, obj, methodID);</span>
<span class="line-removed">-       jniCheck::validate_call_class(thr, clazz, methodID);</span>
      )
      va_start(args,methodID);
      UNCHECKED()-&gt;CallNonvirtualVoidMethodV(env,obj,clazz,methodID,args);
      va_end(args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallNonvirtualVoidMethod&quot;);
<span class="line-new-header">--- 1129,11 ---</span>
                                         jmethodID methodID,
                                         ...))
      functionEnter(thr);
      va_list args;
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call(thr, clazz, methodID, obj);</span>
      )
      va_start(args,methodID);
      UNCHECKED()-&gt;CallNonvirtualVoidMethodV(env,obj,clazz,methodID,args);
      va_end(args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallNonvirtualVoidMethod&quot;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1141,12 ***</span>
                                          jclass clazz,
                                          jmethodID methodID,
                                          va_list args))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call_object(thr, obj, methodID);</span>
<span class="line-removed">-       jniCheck::validate_call_class(thr, clazz, methodID);</span>
      )
      UNCHECKED()-&gt;CallNonvirtualVoidMethodV(env,obj,clazz,methodID,args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallNonvirtualVoidMethodV&quot;);
      functionExit(thr);
  JNI_END
<span class="line-new-header">--- 1146,11 ---</span>
                                          jclass clazz,
                                          jmethodID methodID,
                                          va_list args))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call(thr, clazz, methodID, obj);</span>
      )
      UNCHECKED()-&gt;CallNonvirtualVoidMethodV(env,obj,clazz,methodID,args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallNonvirtualVoidMethodV&quot;);
      functionExit(thr);
  JNI_END
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1157,12 ***</span>
                                          jclass clazz,
                                          jmethodID methodID,
                                          const jvalue * args))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call_object(thr, obj, methodID);</span>
<span class="line-removed">-       jniCheck::validate_call_class(thr, clazz, methodID);</span>
      )
      UNCHECKED()-&gt;CallNonvirtualVoidMethodA(env,obj,clazz,methodID,args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallNonvirtualVoidMethodA&quot;);
      functionExit(thr);
  JNI_END
<span class="line-new-header">--- 1161,11 ---</span>
                                          jclass clazz,
                                          jmethodID methodID,
                                          const jvalue * args))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call(thr, clazz, methodID, obj);</span>
      )
      UNCHECKED()-&gt;CallNonvirtualVoidMethodA(env,obj,clazz,methodID,args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallNonvirtualVoidMethodA&quot;);
      functionExit(thr);
  JNI_END
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1251,12 ***</span>
                                           jmethodID methodID, \
                                           ...)) \
      functionEnter(thr); \
      va_list args; \
      IN_VM( \
<span class="line-modified">!       jniCheck::validate_jmethod_id(thr, methodID); \</span>
<span class="line-removed">-       jniCheck::validate_class(thr, clazz, false); \</span>
      ) \
      va_start(args,methodID); \
      ReturnType result = UNCHECKED()-&gt;CallStatic##Result##MethodV(env, \
                                                                   clazz, \
                                                                   methodID, \
<span class="line-new-header">--- 1254,11 ---</span>
                                           jmethodID methodID, \
                                           ...)) \
      functionEnter(thr); \
      va_list args; \
      IN_VM( \
<span class="line-modified">!       jniCheck::validate_call(thr, clazz, methodID); \</span>
      ) \
      va_start(args,methodID); \
      ReturnType result = UNCHECKED()-&gt;CallStatic##Result##MethodV(env, \
                                                                   clazz, \
                                                                   methodID, \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1272,12 ***</span>
                                            jclass clazz, \
                                            jmethodID methodID,\
                                            va_list args)) \
      functionEnter(thr); \
      IN_VM( \
<span class="line-modified">!       jniCheck::validate_jmethod_id(thr, methodID); \</span>
<span class="line-removed">-       jniCheck::validate_class(thr, clazz, false); \</span>
      ) \
      ReturnType result = UNCHECKED()-&gt;CallStatic##Result##MethodV(env, \
                                                                   clazz, \
                                                                   methodID, \
                                                                   args); \
<span class="line-new-header">--- 1274,11 ---</span>
                                            jclass clazz, \
                                            jmethodID methodID,\
                                            va_list args)) \
      functionEnter(thr); \
      IN_VM( \
<span class="line-modified">!       jniCheck::validate_call(thr, clazz, methodID); \</span>
      ) \
      ReturnType result = UNCHECKED()-&gt;CallStatic##Result##MethodV(env, \
                                                                   clazz, \
                                                                   methodID, \
                                                                   args); \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1291,12 ***</span>
                                            jclass clazz, \
                                            jmethodID methodID, \
                                            const jvalue *args)) \
      functionEnter(thr); \
      IN_VM( \
<span class="line-modified">!       jniCheck::validate_jmethod_id(thr, methodID); \</span>
<span class="line-removed">-       jniCheck::validate_class(thr, clazz, false); \</span>
      ) \
      ReturnType result = UNCHECKED()-&gt;CallStatic##Result##MethodA(env, \
                                                                   clazz, \
                                                                   methodID, \
                                                                   args); \
<span class="line-new-header">--- 1292,11 ---</span>
                                            jclass clazz, \
                                            jmethodID methodID, \
                                            const jvalue *args)) \
      functionEnter(thr); \
      IN_VM( \
<span class="line-modified">!       jniCheck::validate_call(thr, clazz, methodID); \</span>
      ) \
      ReturnType result = UNCHECKED()-&gt;CallStatic##Result##MethodA(env, \
                                                                   clazz, \
                                                                   methodID, \
                                                                   args); \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1321,12 ***</span>
                                     jmethodID methodID,
                                     ...))
      functionEnter(thr);
      va_list args;
      IN_VM(
<span class="line-modified">!       jniCheck::validate_jmethod_id(thr, methodID);</span>
<span class="line-removed">-       jniCheck::validate_class(thr, cls, false);</span>
      )
      va_start(args,methodID);
      UNCHECKED()-&gt;CallStaticVoidMethodV(env,cls,methodID,args);
      va_end(args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallStaticVoidMethod&quot;);
<span class="line-new-header">--- 1321,11 ---</span>
                                     jmethodID methodID,
                                     ...))
      functionEnter(thr);
      va_list args;
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call(thr, cls, methodID);</span>
      )
      va_start(args,methodID);
      UNCHECKED()-&gt;CallStaticVoidMethodV(env,cls,methodID,args);
      va_end(args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallStaticVoidMethod&quot;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1338,12 ***</span>
                                      jclass cls,
                                      jmethodID methodID,
                                      va_list args))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_jmethod_id(thr, methodID);</span>
<span class="line-removed">-       jniCheck::validate_class(thr, cls, false);</span>
      )
      UNCHECKED()-&gt;CallStaticVoidMethodV(env,cls,methodID,args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallStaticVoidMethodV&quot;);
      functionExit(thr);
  JNI_END
<span class="line-new-header">--- 1337,11 ---</span>
                                      jclass cls,
                                      jmethodID methodID,
                                      va_list args))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call(thr, cls, methodID);</span>
      )
      UNCHECKED()-&gt;CallStaticVoidMethodV(env,cls,methodID,args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallStaticVoidMethodV&quot;);
      functionExit(thr);
  JNI_END
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1353,12 ***</span>
                                      jclass cls,
                                      jmethodID methodID,
                                      const jvalue * args))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_jmethod_id(thr, methodID);</span>
<span class="line-removed">-       jniCheck::validate_class(thr, cls, false);</span>
      )
      UNCHECKED()-&gt;CallStaticVoidMethodA(env,cls,methodID,args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallStaticVoidMethodA&quot;);
      functionExit(thr);
  JNI_END
<span class="line-new-header">--- 1351,11 ---</span>
                                      jclass cls,
                                      jmethodID methodID,
                                      const jvalue * args))
      functionEnter(thr);
      IN_VM(
<span class="line-modified">!       jniCheck::validate_call(thr, cls, methodID);</span>
      )
      UNCHECKED()-&gt;CallStaticVoidMethodA(env,cls,methodID,args);
      thr-&gt;set_pending_jni_exception_check(&quot;CallStaticVoidMethodA&quot;);
      functionExit(thr);
  JNI_END
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1925,10 ***</span>
<span class="line-new-header">--- 1922,16 ---</span>
  
  JNI_ENTRY_CHECKED(void,
    checked_jni_DeleteWeakGlobalRef(JNIEnv *env,
                                    jweak ref))
      functionEnterExceptionAllowed(thr);
<span class="line-added">+     IN_VM(</span>
<span class="line-added">+       if (ref &amp;&amp; !JNIHandles::is_weak_global_handle(ref)) {</span>
<span class="line-added">+         ReportJNIFatalError(thr,</span>
<span class="line-added">+              &quot;Invalid weak global JNI handle passed to DeleteWeakGlobalRef&quot;);</span>
<span class="line-added">+       }</span>
<span class="line-added">+     )</span>
      UNCHECKED()-&gt;DeleteWeakGlobalRef(env, ref);
      functionExit(thr);
  JNI_END
  
  JNI_ENTRY_CHECKED(jboolean,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2300,12 ***</span>
               sizeof(*unchecked_jni_NativeInterface) - sizeof(char *));)
    assert(*lastPtr != 0,
           &quot;Mismatched JNINativeInterface tables, check for new entries&quot;);
  
    // with -verbose:jni this message will print
<span class="line-modified">!   if (PrintJNIResolving) {</span>
<span class="line-removed">-     tty-&gt;print_cr(&quot;Checked JNI functions are being used to &quot; \</span>
<span class="line-removed">-                   &quot;validate JNI usage&quot;);</span>
<span class="line-removed">-   }</span>
  
    return &amp;checked_jni_NativeInterface;
  }
<span class="line-new-header">--- 2303,9 ---</span>
               sizeof(*unchecked_jni_NativeInterface) - sizeof(char *));)
    assert(*lastPtr != 0,
           &quot;Mismatched JNINativeInterface tables, check for new entries&quot;);
  
    // with -verbose:jni this message will print
<span class="line-modified">!   log_debug(jni, resolve)(&quot;Checked JNI functions are being used to validate JNI usage&quot;);</span>
  
    return &amp;checked_jni_NativeInterface;
  }
</pre>
<center><a href="jni.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="jniCheck.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>