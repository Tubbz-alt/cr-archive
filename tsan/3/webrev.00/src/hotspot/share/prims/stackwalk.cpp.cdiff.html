<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/prims/stackwalk.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="resolvedMethodTable.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="unsafe.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/prims/stackwalk.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 27,10 ***</span>
<span class="line-new-header">--- 27,11 ---</span>
  #include &quot;classfile/javaClasses.inline.hpp&quot;
  #include &quot;classfile/vmSymbols.hpp&quot;
  #include &quot;logging/log.hpp&quot;
  #include &quot;logging/logStream.hpp&quot;
  #include &quot;memory/oopFactory.hpp&quot;
<span class="line-added">+ #include &quot;memory/universe.hpp&quot;</span>
  #include &quot;oops/oop.inline.hpp&quot;
  #include &quot;oops/objArrayOop.inline.hpp&quot;
  #include &quot;prims/stackwalk.hpp&quot;
  #include &quot;runtime/globals.hpp&quot;
  #include &quot;runtime/handles.inline.hpp&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 47,11 ***</span>
  }
  
  bool BaseFrameStream::check_magic(objArrayHandle frames_array) {
    oop   m1 = frames_array-&gt;obj_at(magic_pos);
    jlong m2 = _anchor;
<span class="line-modified">!   if (oopDesc::equals(m1, _thread-&gt;threadObj()) &amp;&amp; m2 == address_value())  return true;</span>
    return false;
  }
  
  bool BaseFrameStream::cleanup_magic_on_exit(objArrayHandle frames_array) {
    bool ok = check_magic(frames_array);
<span class="line-new-header">--- 48,11 ---</span>
  }
  
  bool BaseFrameStream::check_magic(objArrayHandle frames_array) {
    oop   m1 = frames_array-&gt;obj_at(magic_pos);
    jlong m2 = _anchor;
<span class="line-modified">!   if (m1 == _thread-&gt;threadObj() &amp;&amp; m2 == address_value())  return true;</span>
    return false;
  }
  
  bool BaseFrameStream::cleanup_magic_on_exit(objArrayHandle frames_array) {
    bool ok = check_magic(frames_array);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 78,11 ***</span>
  BaseFrameStream* BaseFrameStream::from_current(JavaThread* thread, jlong magic,
                                                 objArrayHandle frames_array)
  {
    assert(thread != NULL &amp;&amp; thread-&gt;is_Java_thread(), &quot;&quot;);
    oop m1 = frames_array-&gt;obj_at(magic_pos);
<span class="line-modified">!   if (!oopDesc::equals(m1, thread-&gt;threadObj())) return NULL;</span>
    if (magic == 0L)                    return NULL;
    BaseFrameStream* stream = (BaseFrameStream*) (intptr_t) magic;
    if (!stream-&gt;is_valid_in(thread, frames_array))   return NULL;
    return stream;
  }
<span class="line-new-header">--- 79,11 ---</span>
  BaseFrameStream* BaseFrameStream::from_current(JavaThread* thread, jlong magic,
                                                 objArrayHandle frames_array)
  {
    assert(thread != NULL &amp;&amp; thread-&gt;is_Java_thread(), &quot;&quot;);
    oop m1 = frames_array-&gt;obj_at(magic_pos);
<span class="line-modified">!   if (m1 != thread-&gt;threadObj()) return NULL;</span>
    if (magic == 0L)                    return NULL;
    BaseFrameStream* stream = (BaseFrameStream*) (intptr_t) magic;
    if (!stream-&gt;is_valid_in(thread, frames_array))   return NULL;
    return stream;
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 149,15 ***</span>
  
      if (!need_method_info(mode) &amp;&amp; get_caller_class(mode) &amp;&amp;
            index == start_index &amp;&amp; method-&gt;caller_sensitive()) {
        ResourceMark rm(THREAD);
        THROW_MSG_0(vmSymbols::java_lang_UnsupportedOperationException(),
<span class="line-modified">!         err_msg(&quot;StackWalker::getCallerClass called from @CallerSensitive %s method&quot;,</span>
<span class="line-modified">!                 method-&gt;name_and_sig_as_C_string()));</span>
      }
      // fill in StackFrameInfo and initialize MemberName
<span class="line-modified">!     stream.fill_frame(index, frames_array, method, CHECK_0);</span>
      if (++frames_decoded &gt;= max_nframes)  break;
    }
    return frames_decoded;
  }
  
<span class="line-new-header">--- 150,15 ---</span>
  
      if (!need_method_info(mode) &amp;&amp; get_caller_class(mode) &amp;&amp;
            index == start_index &amp;&amp; method-&gt;caller_sensitive()) {
        ResourceMark rm(THREAD);
        THROW_MSG_0(vmSymbols::java_lang_UnsupportedOperationException(),
<span class="line-modified">!         err_msg(&quot;StackWalker::getCallerClass called from @CallerSensitive &#39;%s&#39; method&quot;,</span>
<span class="line-modified">!                 method-&gt;external_name()));</span>
      }
      // fill in StackFrameInfo and initialize MemberName
<span class="line-modified">!     stream.fill_frame(index, frames_array, methodHandle(THREAD, method), CHECK_0);</span>
      if (++frames_decoded &gt;= max_nframes)  break;
    }
    return frames_decoded;
  }
  
</pre>
<center><a href="resolvedMethodTable.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="unsafe.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>