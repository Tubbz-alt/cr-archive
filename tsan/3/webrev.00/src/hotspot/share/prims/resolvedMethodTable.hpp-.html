<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/hotspot/share/prims/resolvedMethodTable.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #ifndef SHARE_PRIMS_RESOLVEDMETHODTABLE_HPP
 26 #define SHARE_PRIMS_RESOLVEDMETHODTABLE_HPP
 27 
 28 #include &quot;oops/symbol.hpp&quot;
 29 #include &quot;oops/weakHandle.hpp&quot;
 30 #include &quot;utilities/hashtable.hpp&quot;
 31 
 32 // Hashtable to record Method* used in ResolvedMethods, via. ResolvedMethod oops.
 33 // This is needed for redefinition to replace Method* with redefined versions.
 34 
 35 // Entry in a ResolvedMethodTable, mapping a ClassLoaderWeakHandle for a single oop of
 36 // java_lang_invoke_ResolvedMethodName which holds JVM Method* in vmtarget.
 37 
 38 class ResolvedMethodEntry : public HashtableEntry&lt;ClassLoaderWeakHandle, mtClass&gt; {
 39  public:
 40   ResolvedMethodEntry* next() const {
 41     return (ResolvedMethodEntry*)HashtableEntry&lt;ClassLoaderWeakHandle, mtClass&gt;::next();
 42   }
 43 
 44   ResolvedMethodEntry** next_addr() {
 45     return (ResolvedMethodEntry**)HashtableEntry&lt;ClassLoaderWeakHandle, mtClass&gt;::next_addr();
 46   }
 47 
 48   oop object();
 49   oop object_no_keepalive();
 50 
 51   void print_on(outputStream* st) const;
 52 };
 53 
 54 class ResolvedMethodTable : public Hashtable&lt;ClassLoaderWeakHandle, mtClass&gt; {
 55   enum Constants {
 56     _table_size  = 1007
 57   };
 58 
 59   static int _total_oops_removed;
 60 
 61   static bool _dead_entries;
 62 
 63   static ResolvedMethodTable* _the_table;
 64 private:
 65   ResolvedMethodEntry* bucket(int i) {
 66     return (ResolvedMethodEntry*) Hashtable&lt;ClassLoaderWeakHandle, mtClass&gt;::bucket(i);
 67   }
 68 
 69   ResolvedMethodEntry** bucket_addr(int i) {
 70     return (ResolvedMethodEntry**) Hashtable&lt;ClassLoaderWeakHandle, mtClass&gt;::bucket_addr(i);
 71   }
 72 
 73   unsigned int compute_hash(Method* method);
 74 
 75   // need not be locked; no state change
 76   oop lookup(int index, unsigned int hash, Method* method);
 77   oop lookup(Method* method);
 78 
 79   // must be done under ResolvedMethodTable_lock
 80   oop basic_add(Method* method, Handle rmethod_name);
 81 
 82 public:
 83   ResolvedMethodTable();
 84 
 85   static void create_table() {
 86     assert(_the_table == NULL, &quot;One symbol table allowed.&quot;);
 87     _the_table = new ResolvedMethodTable();
 88   }
 89 
 90   // Called from java_lang_invoke_ResolvedMethodName
 91   static oop find_method(Method* method);
 92   static oop add_method(const methodHandle&amp; method, Handle rmethod_name);
 93 
 94   static bool has_work() { return _dead_entries; }
 95   static void trigger_cleanup();
 96 
 97   static int removed_entries_count() { return _total_oops_removed; };
 98 
 99 #if INCLUDE_JVMTI
100   // It is called at safepoint only for RedefineClasses
101   static void adjust_method_entries(bool * trace_name_printed);
102 #endif // INCLUDE_JVMTI
103 
104   // Cleanup cleared entries
105   static void unlink();
106 
107 #ifndef PRODUCT
108   void print();
109 #endif
110   void verify();
111 };
112 
113 #endif // SHARE_PRIMS_RESOLVEDMETHODTABLE_HPP
    </pre>
  </body>
</html>