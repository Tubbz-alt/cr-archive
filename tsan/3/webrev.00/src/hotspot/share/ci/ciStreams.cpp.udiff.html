<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/ci/ciStreams.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="ciSignature.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="ciSymbol.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/ci/ciStreams.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -184,11 +184,11 @@</span>
  //
  // If this bytecode is a new, newarray, multianewarray, instanceof,
  // or checkcast, get the referenced klass.
  ciKlass* ciBytecodeStream::get_klass(bool&amp; will_link) {
    VM_ENTRY_MARK;
<span class="udiff-line-modified-removed">-   constantPoolHandle cpool(_method-&gt;get_Method()-&gt;constants());</span>
<span class="udiff-line-modified-added">+   constantPoolHandle cpool(THREAD, _method-&gt;get_Method()-&gt;constants());</span>
    return CURRENT_ENV-&gt;get_klass_by_index(cpool, get_klass_index(), will_link, _holder);
  }
  
  // ------------------------------------------------------------------
  // ciBytecodeStream::get_constant_raw_index
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -215,11 +215,11 @@</span>
  int ciBytecodeStream::get_constant_pool_index() const {
    // work-alike for Bytecode_loadconstant::pool_index()
    int index = get_constant_raw_index();
    if (has_cache_index()) {
      VM_ENTRY_MARK;
<span class="udiff-line-modified-removed">-     constantPoolHandle cpool(_method-&gt;get_Method()-&gt;constants());</span>
<span class="udiff-line-modified-added">+     constantPoolHandle cpool(THREAD, _method-&gt;get_Method()-&gt;constants());</span>
      return cpool-&gt;object_to_cp_index(index);
    }
    return index;
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -234,11 +234,11 @@</span>
    if (has_cache_index()) {
      cache_index = pool_index;
      pool_index = -1;
    }
    VM_ENTRY_MARK;
<span class="udiff-line-modified-removed">-   constantPoolHandle cpool(_method-&gt;get_Method()-&gt;constants());</span>
<span class="udiff-line-modified-added">+   constantPoolHandle cpool(THREAD, _method-&gt;get_Method()-&gt;constants());</span>
    return CURRENT_ENV-&gt;get_constant_by_index(cpool, pool_index, cache_index, _holder);
  }
  
  // ------------------------------------------------------------------
  // ciBytecodeStream::get_constant_pool_tag
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -287,11 +287,11 @@</span>
  //
  // There is no &quot;will_link&quot; result passed back.  The user is responsible
  // for checking linkability when retrieving the associated field.
  ciInstanceKlass* ciBytecodeStream::get_declared_field_holder() {
    VM_ENTRY_MARK;
<span class="udiff-line-modified-removed">-   constantPoolHandle cpool(_method-&gt;get_Method()-&gt;constants());</span>
<span class="udiff-line-modified-added">+   constantPoolHandle cpool(THREAD, _method-&gt;get_Method()-&gt;constants());</span>
    int holder_index = get_field_holder_index();
    bool ignore;
    return CURRENT_ENV-&gt;get_klass_by_index(cpool, holder_index, ignore, _holder)
        -&gt;as_instance_klass();
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -429,22 +429,22 @@</span>
  //
  // Returns true if there is an appendix argument stored in the
  // constant pool cache at the current bci.
  bool ciBytecodeStream::has_appendix() {
    VM_ENTRY_MARK;
<span class="udiff-line-modified-removed">-   constantPoolHandle cpool(_method-&gt;get_Method()-&gt;constants());</span>
<span class="udiff-line-modified-added">+   constantPoolHandle cpool(THREAD, _method-&gt;get_Method()-&gt;constants());</span>
    return ConstantPool::has_appendix_at_if_loaded(cpool, get_method_index());
  }
  
  // ------------------------------------------------------------------
  // ciBytecodeStream::get_appendix
  //
  // Return the appendix argument stored in the constant pool cache at
  // the current bci.
  ciObject* ciBytecodeStream::get_appendix() {
    VM_ENTRY_MARK;
<span class="udiff-line-modified-removed">-   constantPoolHandle cpool(_method-&gt;get_Method()-&gt;constants());</span>
<span class="udiff-line-modified-added">+   constantPoolHandle cpool(THREAD, _method-&gt;get_Method()-&gt;constants());</span>
    oop appendix_oop = ConstantPool::appendix_at_if_loaded(cpool, get_method_index());
    return CURRENT_ENV-&gt;get_object(appendix_oop);
  }
  
  // ------------------------------------------------------------------
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -452,11 +452,11 @@</span>
  //
  // Returns true if the method stored in the constant
  // pool cache at the current bci has a local signature.
  bool ciBytecodeStream::has_local_signature() {
    GUARDED_VM_ENTRY(
<span class="udiff-line-modified-removed">-     constantPoolHandle cpool(_method-&gt;get_Method()-&gt;constants());</span>
<span class="udiff-line-modified-added">+     constantPoolHandle cpool(Thread::current(), _method-&gt;get_Method()-&gt;constants());</span>
      return ConstantPool::has_local_signature_at_if_loaded(cpool, get_method_index());
    )
  }
  
  // ------------------------------------------------------------------
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -470,11 +470,11 @@</span>
  //
  // There is no &quot;will_link&quot; result passed back.  The user is responsible
  // for checking linkability when retrieving the associated method.
  ciKlass* ciBytecodeStream::get_declared_method_holder() {
    VM_ENTRY_MARK;
<span class="udiff-line-modified-removed">-   constantPoolHandle cpool(_method-&gt;get_Method()-&gt;constants());</span>
<span class="udiff-line-modified-added">+   constantPoolHandle cpool(THREAD, _method-&gt;get_Method()-&gt;constants());</span>
    bool ignore;
    // report as MethodHandle for invokedynamic, which is syntactically classless
    if (cur_bc() == Bytecodes::_invokedynamic)
      return CURRENT_ENV-&gt;get_klass_by_name(_holder, ciSymbol::java_lang_invoke_MethodHandle(), false);
    return CURRENT_ENV-&gt;get_klass_by_index(cpool, get_method_holder_index(), ignore, _holder);
</pre>
<center><a href="ciSignature.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="ciSymbol.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>