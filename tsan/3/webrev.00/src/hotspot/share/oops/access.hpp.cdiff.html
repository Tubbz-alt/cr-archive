<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/oops/access.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../memory/virtualspace.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="access.inline.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/oops/access.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 56,11 ***</span>
  // * atomic_xchg: Atomically swap a new value at an address if previous value matched the compared value.
  // * atomic_xchg_at: Atomically swap a new value at an internal pointer address if previous value matched the compared value.
  // * arraycopy: Copy data from one heap array to another heap array. The ArrayAccess class has convenience functions for this.
  // * clone: Clone the contents of an object to a newly allocated object.
  // * resolve: Resolve a stable to-space invariant oop that is guaranteed not to relocate its payload until a subsequent thread transition.
<span class="line-removed">- // * equals: Object equality, e.g. when different copies of the same objects are in use (from-space vs. to-space)</span>
  //
  // == IMPLEMENTATION ==
  // Each access goes through the following steps in a template pipeline.
  // There are essentially 5 steps for each access:
  // * Step 1:   Set default decorators and decay types. This step gets rid of CV qualifiers
<span class="line-new-header">--- 56,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 164,19 ***</span>
      verify_primitive_decorators&lt;store_mo_decorators&gt;();
      AccessInternal::store_at&lt;decorators&gt;(base, offset, value);
    }
  
    template &lt;typename T&gt;
<span class="line-modified">!   static inline T atomic_cmpxchg_at(T new_value, oop base, ptrdiff_t offset, T compare_value) {</span>
      verify_primitive_decorators&lt;atomic_cmpxchg_mo_decorators&gt;();
<span class="line-modified">!     return AccessInternal::atomic_cmpxchg_at&lt;decorators&gt;(new_value, base, offset, compare_value);</span>
    }
  
    template &lt;typename T&gt;
<span class="line-modified">!   static inline T atomic_xchg_at(T new_value, oop base, ptrdiff_t offset) {</span>
      verify_primitive_decorators&lt;atomic_xchg_mo_decorators&gt;();
<span class="line-modified">!     return AccessInternal::atomic_xchg_at&lt;decorators&gt;(new_value, base, offset);</span>
    }
  
    // Oop heap accesses
    static inline AccessInternal::OopLoadAtProxy&lt;decorators&gt; oop_load_at(oop base, ptrdiff_t offset) {
      verify_heap_oop_decorators&lt;load_mo_decorators&gt;();
<span class="line-new-header">--- 163,19 ---</span>
      verify_primitive_decorators&lt;store_mo_decorators&gt;();
      AccessInternal::store_at&lt;decorators&gt;(base, offset, value);
    }
  
    template &lt;typename T&gt;
<span class="line-modified">!   static inline T atomic_cmpxchg_at(oop base, ptrdiff_t offset, T compare_value, T new_value) {</span>
      verify_primitive_decorators&lt;atomic_cmpxchg_mo_decorators&gt;();
<span class="line-modified">!     return AccessInternal::atomic_cmpxchg_at&lt;decorators&gt;(base, offset, compare_value, new_value);</span>
    }
  
    template &lt;typename T&gt;
<span class="line-modified">!   static inline T atomic_xchg_at(oop base, ptrdiff_t offset, T new_value) {</span>
      verify_primitive_decorators&lt;atomic_xchg_mo_decorators&gt;();
<span class="line-modified">!     return AccessInternal::atomic_xchg_at&lt;decorators&gt;(base, offset, new_value);</span>
    }
  
    // Oop heap accesses
    static inline AccessInternal::OopLoadAtProxy&lt;decorators&gt; oop_load_at(oop base, ptrdiff_t offset) {
      verify_heap_oop_decorators&lt;load_mo_decorators&gt;();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 190,24 ***</span>
      OopType oop_value = value;
      AccessInternal::store_at&lt;decorators | INTERNAL_VALUE_IS_OOP&gt;(base, offset, oop_value);
    }
  
    template &lt;typename T&gt;
<span class="line-modified">!   static inline T oop_atomic_cmpxchg_at(T new_value, oop base, ptrdiff_t offset, T compare_value) {</span>
      verify_heap_oop_decorators&lt;atomic_cmpxchg_mo_decorators&gt;();
      typedef typename AccessInternal::OopOrNarrowOop&lt;T&gt;::type OopType;
      OopType new_oop_value = new_value;
      OopType compare_oop_value = compare_value;
<span class="line-modified">!     return AccessInternal::atomic_cmpxchg_at&lt;decorators | INTERNAL_VALUE_IS_OOP&gt;(new_oop_value, base, offset, compare_oop_value);</span>
    }
  
    template &lt;typename T&gt;
<span class="line-modified">!   static inline T oop_atomic_xchg_at(T new_value, oop base, ptrdiff_t offset) {</span>
      verify_heap_oop_decorators&lt;atomic_xchg_mo_decorators&gt;();
      typedef typename AccessInternal::OopOrNarrowOop&lt;T&gt;::type OopType;
      OopType new_oop_value = new_value;
<span class="line-modified">!     return AccessInternal::atomic_xchg_at&lt;decorators | INTERNAL_VALUE_IS_OOP&gt;(new_oop_value, base, offset);</span>
    }
  
    // Clone an object from src to dst
    static inline void clone(oop src, oop dst, size_t size) {
      verify_decorators&lt;IN_HEAP&gt;();
<span class="line-new-header">--- 189,24 ---</span>
      OopType oop_value = value;
      AccessInternal::store_at&lt;decorators | INTERNAL_VALUE_IS_OOP&gt;(base, offset, oop_value);
    }
  
    template &lt;typename T&gt;
<span class="line-modified">!   static inline T oop_atomic_cmpxchg_at(oop base, ptrdiff_t offset, T compare_value, T new_value) {</span>
      verify_heap_oop_decorators&lt;atomic_cmpxchg_mo_decorators&gt;();
      typedef typename AccessInternal::OopOrNarrowOop&lt;T&gt;::type OopType;
      OopType new_oop_value = new_value;
      OopType compare_oop_value = compare_value;
<span class="line-modified">!     return AccessInternal::atomic_cmpxchg_at&lt;decorators | INTERNAL_VALUE_IS_OOP&gt;(base, offset, compare_oop_value, new_oop_value);</span>
    }
  
    template &lt;typename T&gt;
<span class="line-modified">!   static inline T oop_atomic_xchg_at(oop base, ptrdiff_t offset, T new_value) {</span>
      verify_heap_oop_decorators&lt;atomic_xchg_mo_decorators&gt;();
      typedef typename AccessInternal::OopOrNarrowOop&lt;T&gt;::type OopType;
      OopType new_oop_value = new_value;
<span class="line-modified">!     return AccessInternal::atomic_xchg_at&lt;decorators | INTERNAL_VALUE_IS_OOP&gt;(base, offset, new_oop_value);</span>
    }
  
    // Clone an object from src to dst
    static inline void clone(oop src, oop dst, size_t size) {
      verify_decorators&lt;IN_HEAP&gt;();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 226,19 ***</span>
      verify_primitive_decorators&lt;store_mo_decorators&gt;();
      AccessInternal::store&lt;decorators&gt;(addr, value);
    }
  
    template &lt;typename P, typename T&gt;
<span class="line-modified">!   static inline T atomic_cmpxchg(T new_value, P* addr, T compare_value) {</span>
      verify_primitive_decorators&lt;atomic_cmpxchg_mo_decorators&gt;();
<span class="line-modified">!     return AccessInternal::atomic_cmpxchg&lt;decorators&gt;(new_value, addr, compare_value);</span>
    }
  
    template &lt;typename P, typename T&gt;
<span class="line-modified">!   static inline T atomic_xchg(T new_value, P* addr) {</span>
      verify_primitive_decorators&lt;atomic_xchg_mo_decorators&gt;();
<span class="line-modified">!     return AccessInternal::atomic_xchg&lt;decorators&gt;(new_value, addr);</span>
    }
  
    // Oop accesses
    template &lt;typename P&gt;
    static inline AccessInternal::OopLoadProxy&lt;P, decorators&gt; oop_load(P* addr) {
<span class="line-new-header">--- 225,19 ---</span>
      verify_primitive_decorators&lt;store_mo_decorators&gt;();
      AccessInternal::store&lt;decorators&gt;(addr, value);
    }
  
    template &lt;typename P, typename T&gt;
<span class="line-modified">!   static inline T atomic_cmpxchg(P* addr, T compare_value, T new_value) {</span>
      verify_primitive_decorators&lt;atomic_cmpxchg_mo_decorators&gt;();
<span class="line-modified">!     return AccessInternal::atomic_cmpxchg&lt;decorators&gt;(addr, compare_value, new_value);</span>
    }
  
    template &lt;typename P, typename T&gt;
<span class="line-modified">!   static inline T atomic_xchg(P* addr, T new_value) {</span>
      verify_primitive_decorators&lt;atomic_xchg_mo_decorators&gt;();
<span class="line-modified">!     return AccessInternal::atomic_xchg&lt;decorators&gt;(addr, new_value);</span>
    }
  
    // Oop accesses
    template &lt;typename P&gt;
    static inline AccessInternal::OopLoadProxy&lt;P, decorators&gt; oop_load(P* addr) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 253,35 ***</span>
      OopType oop_value = value;
      AccessInternal::store&lt;decorators | INTERNAL_VALUE_IS_OOP&gt;(addr, oop_value);
    }
  
    template &lt;typename P, typename T&gt;
<span class="line-modified">!   static inline T oop_atomic_cmpxchg(T new_value, P* addr, T compare_value) {</span>
      verify_oop_decorators&lt;atomic_cmpxchg_mo_decorators&gt;();
      typedef typename AccessInternal::OopOrNarrowOop&lt;T&gt;::type OopType;
      OopType new_oop_value = new_value;
      OopType compare_oop_value = compare_value;
<span class="line-modified">!     return AccessInternal::atomic_cmpxchg&lt;decorators | INTERNAL_VALUE_IS_OOP&gt;(new_oop_value, addr, compare_oop_value);</span>
    }
  
    template &lt;typename P, typename T&gt;
<span class="line-modified">!   static inline T oop_atomic_xchg(T new_value, P* addr) {</span>
      verify_oop_decorators&lt;atomic_xchg_mo_decorators&gt;();
      typedef typename AccessInternal::OopOrNarrowOop&lt;T&gt;::type OopType;
      OopType new_oop_value = new_value;
<span class="line-modified">!     return AccessInternal::atomic_xchg&lt;decorators | INTERNAL_VALUE_IS_OOP&gt;(new_oop_value, addr);</span>
    }
  
    static oop resolve(oop obj) {
      verify_decorators&lt;DECORATORS_NONE&gt;();
      return AccessInternal::resolve&lt;decorators&gt;(obj);
    }
<span class="line-removed">- </span>
<span class="line-removed">-   static bool equals(oop o1, oop o2) {</span>
<span class="line-removed">-     verify_decorators&lt;AS_RAW&gt;();</span>
<span class="line-removed">-     return AccessInternal::equals&lt;decorators&gt;(o1, o2);</span>
<span class="line-removed">-   }</span>
  };
  
  // Helper for performing raw accesses (knows only of memory ordering
  // atomicity decorators as well as compressed oops)
  template &lt;DecoratorSet decorators = DECORATORS_NONE&gt;
<span class="line-new-header">--- 252,30 ---</span>
      OopType oop_value = value;
      AccessInternal::store&lt;decorators | INTERNAL_VALUE_IS_OOP&gt;(addr, oop_value);
    }
  
    template &lt;typename P, typename T&gt;
<span class="line-modified">!   static inline T oop_atomic_cmpxchg(P* addr, T compare_value, T new_value) {</span>
      verify_oop_decorators&lt;atomic_cmpxchg_mo_decorators&gt;();
      typedef typename AccessInternal::OopOrNarrowOop&lt;T&gt;::type OopType;
      OopType new_oop_value = new_value;
      OopType compare_oop_value = compare_value;
<span class="line-modified">!     return AccessInternal::atomic_cmpxchg&lt;decorators | INTERNAL_VALUE_IS_OOP&gt;(addr, compare_oop_value, new_oop_value);</span>
    }
  
    template &lt;typename P, typename T&gt;
<span class="line-modified">!   static inline T oop_atomic_xchg(P* addr, T new_value) {</span>
      verify_oop_decorators&lt;atomic_xchg_mo_decorators&gt;();
      typedef typename AccessInternal::OopOrNarrowOop&lt;T&gt;::type OopType;
      OopType new_oop_value = new_value;
<span class="line-modified">!     return AccessInternal::atomic_xchg&lt;decorators | INTERNAL_VALUE_IS_OOP&gt;(addr, new_oop_value);</span>
    }
  
    static oop resolve(oop obj) {
      verify_decorators&lt;DECORATORS_NONE&gt;();
      return AccessInternal::resolve&lt;decorators&gt;(obj);
    }
  };
  
  // Helper for performing raw accesses (knows only of memory ordering
  // atomicity decorators as well as compressed oops)
  template &lt;DecoratorSet decorators = DECORATORS_NONE&gt;
</pre>
<center><a href="../memory/virtualspace.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="access.inline.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>