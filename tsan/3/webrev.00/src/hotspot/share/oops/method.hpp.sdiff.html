<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/oops/method.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="method.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="method.inline.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/oops/method.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  *
</pre>
<hr />
<pre>
  47 
  48 // A Method represents a Java method.
  49 //
  50 // Note that most applications load thousands of methods, so keeping the size of this
  51 // class small has a big impact on footprint.
  52 //
  53 // Note that native_function and signature_handler have to be at fixed offsets
  54 // (required by the interpreter)
  55 //
  56 //  Method embedded field layout (after declared fields):
  57 //   [EMBEDDED native_function       (present only if native) ]
  58 //   [EMBEDDED signature_handler     (present only if native) ]
  59 
  60 class CheckedExceptionElement;
  61 class LocalVariableTableElement;
  62 class AdapterHandlerEntry;
  63 class MethodData;
  64 class MethodCounters;
  65 class ConstMethod;
  66 class InlineTableSizes;
<span class="line-removed">  67 class KlassSizeStats;</span>
  68 class CompiledMethod;
  69 class InterpreterOopMap;
  70 
  71 class Method : public Metadata {
  72  friend class VMStructs;
  73  friend class JVMCIVMStructs;
  74  private:
  75   // If you add a new field that points to any metaspace object, you
  76   // must add this field to Method::metaspace_pointers_do().
  77   ConstMethod*      _constMethod;                // Method read-only data.
  78   MethodData*       _method_data;
  79   MethodCounters*   _method_counters;
  80   AccessFlags       _access_flags;               // Access flags
  81   int               _vtable_index;               // vtable index of this method (see VtableIndexFlag)
  82                                                  // note: can have vtables with &gt;2**16 elements (because of inheritance)
  83   u2                _intrinsic_id;               // vmSymbols::intrinsic_id (0 == _none)
  84 
  85   // Flags
  86   enum Flags {
  87     _caller_sensitive      = 1 &lt;&lt; 0,
</pre>
<hr />
<pre>
 163   // generics support
 164   Symbol* generic_signature() const              { int idx = generic_signature_index(); return ((idx != 0) ? constants()-&gt;symbol_at(idx) : (Symbol*)NULL); }
 165   int generic_signature_index() const            { return constMethod()-&gt;generic_signature_index(); }
 166   void set_generic_signature_index(int index)    { constMethod()-&gt;set_generic_signature_index(index); }
 167 
 168   // annotations support
 169   AnnotationArray* annotations() const           {
 170     return constMethod()-&gt;method_annotations();
 171   }
 172   AnnotationArray* parameter_annotations() const {
 173     return constMethod()-&gt;parameter_annotations();
 174   }
 175   AnnotationArray* annotation_default() const    {
 176     return constMethod()-&gt;default_annotations();
 177   }
 178   AnnotationArray* type_annotations() const      {
 179     return constMethod()-&gt;type_annotations();
 180   }
 181 
 182   // Helper routine: get klass name + &quot;.&quot; + method name + signature as
<span class="line-modified"> 183   // C string, for the purpose of providing more useful NoSuchMethodErrors</span>
<span class="line-modified"> 184   // and fatal error handling. The string is allocated in resource</span>
 185   // area if a buffer is not provided by the caller.
 186   char* name_and_sig_as_C_string() const;
 187   char* name_and_sig_as_C_string(char* buf, int size) const;
 188 
 189   // Static routine in the situations we don&#39;t have a Method*
 190   static char* name_and_sig_as_C_string(Klass* klass, Symbol* method_name, Symbol* signature);
 191   static char* name_and_sig_as_C_string(Klass* klass, Symbol* method_name, Symbol* signature, char* buf, int size);
 192 












 193   Bytecodes::Code java_code_at(int bci) const {
 194     return Bytecodes::java_code_at(this, bcp_from(bci));
 195   }
 196   Bytecodes::Code code_at(int bci) const {
 197     return Bytecodes::code_at(this, bcp_from(bci));
 198   }
 199 
 200   // JVMTI breakpoints
 201 #if !INCLUDE_JVMTI
 202   Bytecodes::Code orig_bytecode_at(int bci) const {
 203     ShouldNotReachHere();
 204     return Bytecodes::_shouldnotreachhere;
 205   }
 206   void set_orig_bytecode_at(int bci, Bytecodes::Code code) {
 207     ShouldNotReachHere();
 208   };
 209   u2   number_of_breakpoints() const {return 0;}
 210 #else // !INCLUDE_JVMTI
 211   Bytecodes::Code orig_bytecode_at(int bci) const;
 212   void set_orig_bytecode_at(int bci, Bytecodes::Code code);
</pre>
<hr />
<pre>
 279 
 280 #if COMPILER2_OR_JVMCI
 281   // Count of times method was exited via exception while interpreting
 282   void interpreter_throwout_increment(TRAPS) {
 283     MethodCounters* mcs = get_method_counters(CHECK);
 284     if (mcs != NULL) {
 285       mcs-&gt;interpreter_throwout_increment();
 286     }
 287   }
 288 #endif
 289 
 290   int  interpreter_throwout_count() const        {
 291     MethodCounters* mcs = method_counters();
 292     if (mcs == NULL) {
 293       return 0;
 294     } else {
 295       return mcs-&gt;interpreter_throwout_count();
 296     }
 297   }
 298 
<span class="line-modified"> 299   // size of parameters</span>



 300   int  size_of_parameters() const                { return constMethod()-&gt;size_of_parameters(); }
 301   void set_size_of_parameters(int size)          { constMethod()-&gt;set_size_of_parameters(size); }
 302 
 303   bool has_stackmap_table() const {
 304     return constMethod()-&gt;has_stackmap_table();
 305   }
 306 
 307   Array&lt;u1&gt;* stackmap_data() const {
 308     return constMethod()-&gt;stackmap_data();
 309   }
 310 
 311   void set_stackmap_data(Array&lt;u1&gt;* sd) {
 312     constMethod()-&gt;set_stackmap_data(sd);
 313   }
 314 
 315   // exception handler table
 316   bool has_exception_handler() const
 317                              { return constMethod()-&gt;has_exception_handler(); }
 318   int exception_table_length() const
 319                              { return constMethod()-&gt;exception_table_length(); }
 320   ExceptionTableElement* exception_table_start() const
 321                              { return constMethod()-&gt;exception_table_start(); }
 322 
 323   // Finds the first entry point bci of an exception handler for an
 324   // exception of klass ex_klass thrown at throw_bci. A value of NULL
 325   // for ex_klass indicates that the exception klass is not known; in
 326   // this case it matches any constraint class. Returns -1 if the
 327   // exception cannot be handled in this method. The handler
 328   // constraint classes are loaded if necessary. Note that this may
 329   // throw an exception if loading of the constraint classes causes
 330   // an IllegalAccessError (bugid 4307310) or an OutOfMemoryError.
 331   // If an exception is thrown, returns the bci of the
 332   // exception handler which caused the exception to be thrown, which
 333   // is needed for proper retries. See, for example,
 334   // InterpreterRuntime::exception_handler_for_exception.
 335   static int fast_exception_handler_bci_for(const methodHandle&amp; mh, Klass* ex_klass, int throw_bci, TRAPS);
 336 






 337   // method data access
 338   MethodData* method_data() const              {
 339     return _method_data;
 340   }
 341 
 342   void set_method_data(MethodData* data);
 343 
 344   MethodCounters* method_counters() const {
 345     return _method_counters;
 346   }
 347 
 348   void clear_method_counters() {
 349     _method_counters = NULL;
 350   }
 351 
 352   bool init_method_counters(MethodCounters* counters);
 353 
 354 #ifdef TIERED
 355   // We are reusing interpreter_invocation_count as a holder for the previous event count!
 356   // We can do that since interpreter_invocation_count is not used in tiered.
</pre>
<hr />
<pre>
 434     return (mcs == NULL) ? 0 : mcs-&gt;increment_interpreter_invocation_count();
 435   }
 436 #endif
 437 
 438 #ifndef PRODUCT
 439   int  compiled_invocation_count() const         { return _compiled_invocation_count;  }
 440   void set_compiled_invocation_count(int count)  { _compiled_invocation_count = count; }
 441 #else
 442   // for PrintMethodData in a product build
 443   int  compiled_invocation_count() const         { return 0;  }
 444 #endif // not PRODUCT
 445 
 446   // Clear (non-shared space) pointers which could not be relevant
 447   // if this (shared) method were mapped into another JVM.
 448   void remove_unshareable_info();
 449 
 450   // nmethod/verified compiler entry
 451   address verified_code_entry();
 452   bool check_code() const;      // Not inline to avoid circular ref
 453   CompiledMethod* volatile code() const;
<span class="line-modified"> 454   void clear_code(bool acquire_lock = true);    // Clear out any compiled code</span>










 455   static void set_code(const methodHandle&amp; mh, CompiledMethod* code);
 456   void set_adapter_entry(AdapterHandlerEntry* adapter) {
 457     constMethod()-&gt;set_adapter_entry(adapter);
 458   }



 459   void update_adapter_trampoline(AdapterHandlerEntry* adapter) {
 460     constMethod()-&gt;update_adapter_trampoline(adapter);
 461   }



 462 
 463   address get_i2c_entry();
 464   address get_c2i_entry();
 465   address get_c2i_unverified_entry();

 466   AdapterHandlerEntry* adapter() const {
 467     return constMethod()-&gt;adapter();
 468   }
 469   // setup entry points
 470   void link_method(const methodHandle&amp; method, TRAPS);
 471   // clear entry points. Used by sharing code during dump time
 472   void unlink_method() NOT_CDS_RETURN;
 473 
 474   virtual void metaspace_pointers_do(MetaspaceClosure* iter);
 475   virtual MetaspaceObj::Type type() const { return MethodType; }
 476 
 477   // vtable index
 478   enum VtableIndexFlag {
 479     // Valid vtable indexes are non-negative (&gt;= 0).
 480     // These few negative values are used as sentinels.
 481     itable_index_max        = -10, // first itable index, growing downward
 482     pending_itable_index    = -9,  // itable index will be assigned
 483     invalid_vtable_index    = -4,  // distinct from any valid vtable index
 484     garbage_vtable_index    = -3,  // not yet linked; no vtable layout yet
 485     nonvirtual_vtable_index = -2   // there is no need for vtable dispatch
 486     // 6330203 Note:  Do not use -1, which was overloaded with many meanings.
 487   };
 488   DEBUG_ONLY(bool valid_vtable_index() const     { return _vtable_index &gt;= nonvirtual_vtable_index; })
 489   bool has_vtable_index() const                  { return _vtable_index &gt;= 0; }
 490   int  vtable_index() const                      { return _vtable_index; }
 491   void set_vtable_index(int index);
 492   DEBUG_ONLY(bool valid_itable_index() const     { return _vtable_index &lt;= pending_itable_index; })
 493   bool has_itable_index() const                  { return _vtable_index &lt;= itable_index_max; }
 494   int  itable_index() const                      { assert(valid_itable_index(), &quot;&quot;);
 495                                                    return itable_index_max - _vtable_index; }
 496   void set_itable_index(int index);
 497 
 498   // interpreter entry
 499   address interpreter_entry() const              { return _i2i_entry; }
 500   // Only used when first initialize so we can set _i2i_entry and _from_interpreted_entry
 501   void set_interpreter_entry(address entry) {
<span class="line-modified"> 502     assert(!is_shared(), &quot;shared method&#39;s interpreter entry should not be changed at run time&quot;);</span>

 503     if (_i2i_entry != entry) {
 504       _i2i_entry = entry;
 505     }
 506     if (_from_interpreted_entry != entry) {
 507       _from_interpreted_entry = entry;
 508     }
 509   }
 510 
 511   // native function (used for native methods only)
 512   enum {
 513     native_bind_event_is_interesting = true
 514   };
 515   address native_function() const                { return *(native_function_addr()); }
<span class="line-removed"> 516   address critical_native_function();</span>
 517 
 518   // Must specify a real function (not NULL).
 519   // Use clear_native_function() to unregister.
 520   void set_native_function(address function, bool post_event_flag);
 521   bool has_native_function() const;
 522   void clear_native_function();
 523 
 524   // signature handler (used for native methods only)
 525   address signature_handler() const              { return *(signature_handler_addr()); }
 526   void set_signature_handler(address handler);
 527 
 528   // Interpreter oopmap support
 529   void mask_for(int bci, InterpreterOopMap* mask);
 530 
 531   // operations on invocation counter
 532   void print_invocation_count();
 533 
 534   // byte codes
 535   void    set_code(address code)      { return constMethod()-&gt;set_code(code); }
 536   address code_base() const           { return constMethod()-&gt;code_base(); }
</pre>
<hr />
<pre>
 554                          { return constMethod()-&gt;checked_exceptions_length(); }
 555   CheckedExceptionElement* checked_exceptions_start() const
 556                           { return constMethod()-&gt;checked_exceptions_start(); }
 557 
 558   // localvariable table
 559   bool has_localvariable_table() const
 560                           { return constMethod()-&gt;has_localvariable_table(); }
 561   int localvariable_table_length() const
 562                         { return constMethod()-&gt;localvariable_table_length(); }
 563   LocalVariableTableElement* localvariable_table_start() const
 564                          { return constMethod()-&gt;localvariable_table_start(); }
 565 
 566   bool has_linenumber_table() const
 567                               { return constMethod()-&gt;has_linenumber_table(); }
 568   u_char* compressed_linenumber_table() const
 569                        { return constMethod()-&gt;compressed_linenumber_table(); }
 570 
 571   // method holder (the Klass* holding this method)
 572   InstanceKlass* method_holder() const         { return constants()-&gt;pool_holder(); }
 573 
<span class="line-removed"> 574   void compute_size_of_parameters(Thread *thread); // word size of parameters (receiver if any + arguments)</span>
 575   Symbol* klass_name() const;                    // returns the name of the method holder
<span class="line-modified"> 576   BasicType result_type() const;                 // type of the method result</span>
<span class="line-modified"> 577   bool is_returning_oop() const                  { BasicType r = result_type(); return (r == T_OBJECT || r == T_ARRAY); }</span>
 578   bool is_returning_fp() const                   { BasicType r = result_type(); return (r == T_FLOAT || r == T_DOUBLE); }
 579 
 580   // Checked exceptions thrown by this method (resolved to mirrors)
 581   objArrayHandle resolved_checked_exceptions(TRAPS) { return resolved_checked_exceptions_impl(this, THREAD); }
 582 
 583   // Access flags
 584   bool is_public() const                         { return access_flags().is_public();      }
 585   bool is_private() const                        { return access_flags().is_private();     }
 586   bool is_protected() const                      { return access_flags().is_protected();   }
 587   bool is_package_private() const                { return !is_public() &amp;&amp; !is_private() &amp;&amp; !is_protected(); }
 588   bool is_static() const                         { return access_flags().is_static();      }
 589   bool is_final() const                          { return access_flags().is_final();       }
 590   bool is_synchronized() const                   { return access_flags().is_synchronized();}
 591   bool is_native() const                         { return access_flags().is_native();      }
 592   bool is_abstract() const                       { return access_flags().is_abstract();    }
 593   bool is_strict() const                         { return access_flags().is_strict();      }
 594   bool is_synthetic() const                      { return access_flags().is_synthetic();   }
 595 
 596   // returns true if contains only return operation
 597   bool is_empty_method() const;
 598 
 599   // returns true if this is a vanilla constructor
 600   bool is_vanilla_constructor() const;
 601 
 602   // checks method and its method holder
 603   bool is_final_method() const;
 604   bool is_final_method(AccessFlags class_access_flags) const;
 605   // interface method declared with &#39;default&#39; - excludes private interface methods
 606   bool is_default_method() const;
 607 
 608   // true if method needs no dynamic dispatch (final and/or no vtable entry)
 609   bool can_be_statically_bound() const;

 610   bool can_be_statically_bound(AccessFlags class_access_flags) const;
 611 
 612   // returns true if the method has any backward branches.
 613   bool has_loops() {
 614     return access_flags().loops_flag_init() ? access_flags().has_loops() : compute_has_loops_flag();
 615   };
 616 
 617   bool compute_has_loops_flag();
 618 
 619   bool has_jsrs() {
 620     return access_flags().has_jsrs();
 621   };
 622   void set_has_jsrs() {
 623     _access_flags.set_has_jsrs();
 624   }
 625 
 626   // returns true if the method has any monitors.
 627   bool has_monitors() const                      { return is_synchronized() || access_flags().has_monitor_bytecodes(); }
 628   bool has_monitor_bytecodes() const             { return access_flags().has_monitor_bytecodes(); }
 629 
</pre>
<hr />
<pre>
 652 
 653   // returns true if the method is static OR if the classfile version &lt; 51
 654   bool has_valid_initializer_flags() const;
 655 
 656   // returns true if the method name is &lt;clinit&gt; and the method has
 657   // valid static initializer flags.
 658   bool is_static_initializer() const;
 659 
 660   // returns true if the method name is &lt;init&gt;
 661   bool is_object_initializer() const;
 662 
 663   // compiled code support
 664   // NOTE: code() is inherently racy as deopt can be clearing code
 665   // simultaneously. Use with caution.
 666   bool has_compiled_code() const;
 667 
 668 #ifdef TIERED
 669   bool has_aot_code() const                      { return aot_code() != NULL; }
 670 #endif
 671 


 672   // sizing
 673   static int header_size()                       {
 674     return align_up((int)sizeof(Method), wordSize) / wordSize;
 675   }
 676   static int size(bool is_native);
 677   int size() const                               { return method_size(); }
<span class="line-removed"> 678 #if INCLUDE_SERVICES</span>
<span class="line-removed"> 679   void collect_statistics(KlassSizeStats *sz) const;</span>
<span class="line-removed"> 680 #endif</span>
 681   void log_touched(TRAPS);
 682   static void print_touched_methods(outputStream* out);
 683 
 684   // interpreter support
 685   static ByteSize const_offset()                 { return byte_offset_of(Method, _constMethod       ); }
 686   static ByteSize access_flags_offset()          { return byte_offset_of(Method, _access_flags      ); }
 687   static ByteSize from_compiled_offset()         { return byte_offset_of(Method, _from_compiled_entry); }
 688   static ByteSize code_offset()                  { return byte_offset_of(Method, _code); }
 689   static ByteSize method_data_offset()           {
 690     return byte_offset_of(Method, _method_data);
 691   }
 692   static ByteSize method_counters_offset()       {
 693     return byte_offset_of(Method, _method_counters);
 694   }
 695 #ifndef PRODUCT
 696   static ByteSize compiled_invocation_counter_offset() { return byte_offset_of(Method, _compiled_invocation_count); }
 697 #endif // not PRODUCT
 698   static ByteSize native_function_offset()       { return in_ByteSize(sizeof(Method));                 }
 699   static ByteSize from_interpreted_offset()      { return byte_offset_of(Method, _from_interpreted_entry ); }
 700   static ByteSize interpreter_entry_offset()     { return byte_offset_of(Method, _i2i_entry ); }
</pre>
<hr />
<pre>
 801   // to provide a valid jmethodID; the only sanity checks are in asserts;
 802   // result guaranteed not to be NULL.
 803   inline static Method* resolve_jmethod_id(jmethodID mid) {
 804     assert(mid != NULL, &quot;JNI method id should not be null&quot;);
 805     return *((Method**)mid);
 806   }
 807 
 808   // Use checked_resolve_jmethod_id() in situations where the caller
 809   // should provide a valid jmethodID, but might not. NULL is returned
 810   // when the jmethodID does not refer to a valid method.
 811   static Method* checked_resolve_jmethod_id(jmethodID mid);
 812 
 813   static void change_method_associated_with_jmethod_id(jmethodID old_jmid_ptr, Method* new_method);
 814   static bool is_method_id(jmethodID mid);
 815 
 816   // Clear methods
 817   static void clear_jmethod_ids(ClassLoaderData* loader_data);
 818   static void print_jmethod_ids(const ClassLoaderData* loader_data, outputStream* out) PRODUCT_RETURN;
 819 
 820   // Get this method&#39;s jmethodID -- allocate if it doesn&#39;t exist
<span class="line-modified"> 821   jmethodID jmethod_id()                            { return method_holder()-&gt;get_jmethod_id(this); }</span>
 822 
 823   // Lookup the jmethodID for this method.  Return NULL if not found.
 824   // NOTE that this function can be called from a signal handler
 825   // (see AsyncGetCallTrace support for Forte Analyzer) and this
 826   // needs to be async-safe. No allocation should be done and
 827   // so handles are not used to avoid deadlock.
 828   jmethodID find_jmethod_id_or_null()               { return method_holder()-&gt;jmethod_id_or_null(this); }
 829 
 830   // Support for inlining of intrinsic methods
 831   vmIntrinsics::ID intrinsic_id() const          { return (vmIntrinsics::ID) _intrinsic_id;           }
 832   void     set_intrinsic_id(vmIntrinsics::ID id) {                           _intrinsic_id = (u2) id; }
 833 
 834   // Helper routines for intrinsic_id() and vmIntrinsics::method().
 835   void init_intrinsic_id();     // updates from _none if a match
 836   static vmSymbols::SID klass_id_for_intrinsics(const Klass* holder);
 837 
 838   bool caller_sensitive() {
 839     return (_flags &amp; _caller_sensitive) != 0;
 840   }
 841   void set_caller_sensitive(bool x) {
</pre>
<hr />
<pre>
 896   bool has_osr_nmethod(int level, bool match_level) {
 897    return method_holder()-&gt;lookup_osr_nmethod(this, InvocationEntryBci, level, match_level) != NULL;
 898   }
 899 
 900   int mark_osr_nmethods() {
 901     return method_holder()-&gt;mark_osr_nmethods(this);
 902   }
 903 
 904   nmethod* lookup_osr_nmethod_for(int bci, int level, bool match_level) {
 905     return method_holder()-&gt;lookup_osr_nmethod(this, bci, level, match_level);
 906   }
 907 
 908   // Find if klass for method is loaded
 909   bool is_klass_loaded_by_klass_index(int klass_index) const;
 910   bool is_klass_loaded(int refinfo_index, bool must_be_resolved = false) const;
 911 
 912   // Indicates whether compilation failed earlier for this method, or
 913   // whether it is not compilable for another reason like having a
 914   // breakpoint set in it.
 915   bool  is_not_compilable(int comp_level = CompLevel_any) const;
<span class="line-modified"> 916   void set_not_compilable(int comp_level = CompLevel_all, bool report = true, const char* reason = NULL);</span>
<span class="line-modified"> 917   void set_not_compilable_quietly(int comp_level = CompLevel_all) {</span>
<span class="line-modified"> 918     set_not_compilable(comp_level, false);</span>
 919   }
 920   bool  is_not_osr_compilable(int comp_level = CompLevel_any) const;
<span class="line-modified"> 921   void set_not_osr_compilable(int comp_level = CompLevel_all, bool report = true, const char* reason = NULL);</span>
<span class="line-modified"> 922   void set_not_osr_compilable_quietly(int comp_level = CompLevel_all) {</span>
<span class="line-modified"> 923     set_not_osr_compilable(comp_level, false);</span>
 924   }
 925   bool is_always_compilable() const;
 926 
 927  private:
 928   void print_made_not_compilable(int comp_level, bool is_osr, bool report, const char* reason);
 929 
 930  public:
 931   MethodCounters* get_method_counters(TRAPS) {
 932     if (_method_counters == NULL) {
 933       build_method_counters(this, CHECK_AND_CLEAR_NULL);
 934     }
 935     return _method_counters;
 936   }
 937 
 938   bool   is_not_c1_compilable() const         { return access_flags().is_not_c1_compilable();  }
 939   void  set_not_c1_compilable()               {       _access_flags.set_not_c1_compilable();   }
 940   void clear_not_c1_compilable()              {       _access_flags.clear_not_c1_compilable(); }
 941   bool   is_not_c2_compilable() const         { return access_flags().is_not_c2_compilable();  }
 942   void  set_not_c2_compilable()               {       _access_flags.set_not_c2_compilable();   }
 943   void clear_not_c2_compilable()              {       _access_flags.clear_not_c2_compilable(); }
</pre>
<hr />
<pre>
 951 
 952   // Background compilation support
 953   bool queued_for_compilation() const  { return access_flags().queued_for_compilation(); }
 954   void set_queued_for_compilation()    { _access_flags.set_queued_for_compilation();     }
 955   void clear_queued_for_compilation()  { _access_flags.clear_queued_for_compilation();   }
 956 
 957   // Resolve all classes in signature, return &#39;true&#39; if successful
 958   static bool load_signature_classes(const methodHandle&amp; m, TRAPS);
 959 
 960   // Return if true if not all classes references in signature, including return type, has been loaded
 961   static bool has_unloaded_classes_in_signature(const methodHandle&amp; m, TRAPS);
 962 
 963   // Printing
 964   void print_short_name(outputStream* st = tty); // prints as klassname::methodname; Exposed so field engineers can debug VM
 965 #if INCLUDE_JVMTI
 966   void print_name(outputStream* st = tty); // prints as &quot;virtual void foo(int)&quot;; exposed for TraceRedefineClasses
 967 #else
 968   void print_name(outputStream* st = tty)        PRODUCT_RETURN; // prints as &quot;virtual void foo(int)&quot;
 969 #endif
 970 


 971   // Helper routine used for method sorting
<span class="line-modified"> 972   static void sort_methods(Array&lt;Method*&gt;* methods, bool set_idnums = true);</span>
 973 
 974   // Deallocation function for redefine classes or if an error occurs
 975   void deallocate_contents(ClassLoaderData* loader_data);
 976 


 977   Method* get_new_method() const {
 978     InstanceKlass* holder = method_holder();
 979     Method* new_method = holder-&gt;method_with_idnum(orig_method_idnum());
 980 
 981     assert(new_method != NULL, &quot;method_with_idnum() should not be NULL&quot;);
 982     assert(this != new_method, &quot;sanity check&quot;);
 983     return new_method;
 984   }
 985 
 986   // Printing
 987 #ifndef PRODUCT
 988   void print_on(outputStream* st) const;
 989 #endif
 990   void print_value_on(outputStream* st) const;
 991   void print_linkage_flags(outputStream* st) PRODUCT_RETURN;
 992 
 993   const char* internal_name() const { return &quot;{method}&quot;; }
 994 
 995   // Check for valid method pointer
 996   static bool has_method_vptr(const void* ptr);
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1997, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  *
</pre>
<hr />
<pre>
  47 
  48 // A Method represents a Java method.
  49 //
  50 // Note that most applications load thousands of methods, so keeping the size of this
  51 // class small has a big impact on footprint.
  52 //
  53 // Note that native_function and signature_handler have to be at fixed offsets
  54 // (required by the interpreter)
  55 //
  56 //  Method embedded field layout (after declared fields):
  57 //   [EMBEDDED native_function       (present only if native) ]
  58 //   [EMBEDDED signature_handler     (present only if native) ]
  59 
  60 class CheckedExceptionElement;
  61 class LocalVariableTableElement;
  62 class AdapterHandlerEntry;
  63 class MethodData;
  64 class MethodCounters;
  65 class ConstMethod;
  66 class InlineTableSizes;

  67 class CompiledMethod;
  68 class InterpreterOopMap;
  69 
  70 class Method : public Metadata {
  71  friend class VMStructs;
  72  friend class JVMCIVMStructs;
  73  private:
  74   // If you add a new field that points to any metaspace object, you
  75   // must add this field to Method::metaspace_pointers_do().
  76   ConstMethod*      _constMethod;                // Method read-only data.
  77   MethodData*       _method_data;
  78   MethodCounters*   _method_counters;
  79   AccessFlags       _access_flags;               // Access flags
  80   int               _vtable_index;               // vtable index of this method (see VtableIndexFlag)
  81                                                  // note: can have vtables with &gt;2**16 elements (because of inheritance)
  82   u2                _intrinsic_id;               // vmSymbols::intrinsic_id (0 == _none)
  83 
  84   // Flags
  85   enum Flags {
  86     _caller_sensitive      = 1 &lt;&lt; 0,
</pre>
<hr />
<pre>
 162   // generics support
 163   Symbol* generic_signature() const              { int idx = generic_signature_index(); return ((idx != 0) ? constants()-&gt;symbol_at(idx) : (Symbol*)NULL); }
 164   int generic_signature_index() const            { return constMethod()-&gt;generic_signature_index(); }
 165   void set_generic_signature_index(int index)    { constMethod()-&gt;set_generic_signature_index(index); }
 166 
 167   // annotations support
 168   AnnotationArray* annotations() const           {
 169     return constMethod()-&gt;method_annotations();
 170   }
 171   AnnotationArray* parameter_annotations() const {
 172     return constMethod()-&gt;parameter_annotations();
 173   }
 174   AnnotationArray* annotation_default() const    {
 175     return constMethod()-&gt;default_annotations();
 176   }
 177   AnnotationArray* type_annotations() const      {
 178     return constMethod()-&gt;type_annotations();
 179   }
 180 
 181   // Helper routine: get klass name + &quot;.&quot; + method name + signature as
<span class="line-modified"> 182   // C string, for the purpose of providing more useful</span>
<span class="line-modified"> 183   // fatal error handling. The string is allocated in resource</span>
 184   // area if a buffer is not provided by the caller.
 185   char* name_and_sig_as_C_string() const;
 186   char* name_and_sig_as_C_string(char* buf, int size) const;
 187 
 188   // Static routine in the situations we don&#39;t have a Method*
 189   static char* name_and_sig_as_C_string(Klass* klass, Symbol* method_name, Symbol* signature);
 190   static char* name_and_sig_as_C_string(Klass* klass, Symbol* method_name, Symbol* signature, char* buf, int size);
 191 
<span class="line-added"> 192   // Get return type + klass name + &quot;.&quot; + method name + ( parameters types )</span>
<span class="line-added"> 193   // as a C string or print it to an outputStream.</span>
<span class="line-added"> 194   // This is to be used to assemble strings passed to Java, so that</span>
<span class="line-added"> 195   // the text more resembles Java code. Used in exception messages.</span>
<span class="line-added"> 196   // Memory is allocated in the resource area; the caller needs</span>
<span class="line-added"> 197   // a ResourceMark.</span>
<span class="line-added"> 198   const char* external_name() const;</span>
<span class="line-added"> 199   void  print_external_name(outputStream *os) const;</span>
<span class="line-added"> 200 </span>
<span class="line-added"> 201   static const char* external_name(                  Klass* klass, Symbol* method_name, Symbol* signature);</span>
<span class="line-added"> 202   static void  print_external_name(outputStream *os, Klass* klass, Symbol* method_name, Symbol* signature);</span>
<span class="line-added"> 203 </span>
 204   Bytecodes::Code java_code_at(int bci) const {
 205     return Bytecodes::java_code_at(this, bcp_from(bci));
 206   }
 207   Bytecodes::Code code_at(int bci) const {
 208     return Bytecodes::code_at(this, bcp_from(bci));
 209   }
 210 
 211   // JVMTI breakpoints
 212 #if !INCLUDE_JVMTI
 213   Bytecodes::Code orig_bytecode_at(int bci) const {
 214     ShouldNotReachHere();
 215     return Bytecodes::_shouldnotreachhere;
 216   }
 217   void set_orig_bytecode_at(int bci, Bytecodes::Code code) {
 218     ShouldNotReachHere();
 219   };
 220   u2   number_of_breakpoints() const {return 0;}
 221 #else // !INCLUDE_JVMTI
 222   Bytecodes::Code orig_bytecode_at(int bci) const;
 223   void set_orig_bytecode_at(int bci, Bytecodes::Code code);
</pre>
<hr />
<pre>
 290 
 291 #if COMPILER2_OR_JVMCI
 292   // Count of times method was exited via exception while interpreting
 293   void interpreter_throwout_increment(TRAPS) {
 294     MethodCounters* mcs = get_method_counters(CHECK);
 295     if (mcs != NULL) {
 296       mcs-&gt;interpreter_throwout_increment();
 297     }
 298   }
 299 #endif
 300 
 301   int  interpreter_throwout_count() const        {
 302     MethodCounters* mcs = method_counters();
 303     if (mcs == NULL) {
 304       return 0;
 305     } else {
 306       return mcs-&gt;interpreter_throwout_count();
 307     }
 308   }
 309 
<span class="line-modified"> 310   // Derive stuff from the signature at load time.</span>
<span class="line-added"> 311   void compute_from_signature(Symbol* sig);</span>
<span class="line-added"> 312 </span>
<span class="line-added"> 313   // size of parameters (receiver if any + arguments)</span>
 314   int  size_of_parameters() const                { return constMethod()-&gt;size_of_parameters(); }
 315   void set_size_of_parameters(int size)          { constMethod()-&gt;set_size_of_parameters(size); }
 316 
 317   bool has_stackmap_table() const {
 318     return constMethod()-&gt;has_stackmap_table();
 319   }
 320 
 321   Array&lt;u1&gt;* stackmap_data() const {
 322     return constMethod()-&gt;stackmap_data();
 323   }
 324 
 325   void set_stackmap_data(Array&lt;u1&gt;* sd) {
 326     constMethod()-&gt;set_stackmap_data(sd);
 327   }
 328 
 329   // exception handler table
 330   bool has_exception_handler() const
 331                              { return constMethod()-&gt;has_exception_handler(); }
 332   int exception_table_length() const
 333                              { return constMethod()-&gt;exception_table_length(); }
 334   ExceptionTableElement* exception_table_start() const
 335                              { return constMethod()-&gt;exception_table_start(); }
 336 
 337   // Finds the first entry point bci of an exception handler for an
 338   // exception of klass ex_klass thrown at throw_bci. A value of NULL
 339   // for ex_klass indicates that the exception klass is not known; in
 340   // this case it matches any constraint class. Returns -1 if the
 341   // exception cannot be handled in this method. The handler
 342   // constraint classes are loaded if necessary. Note that this may
 343   // throw an exception if loading of the constraint classes causes
 344   // an IllegalAccessError (bugid 4307310) or an OutOfMemoryError.
 345   // If an exception is thrown, returns the bci of the
 346   // exception handler which caused the exception to be thrown, which
 347   // is needed for proper retries. See, for example,
 348   // InterpreterRuntime::exception_handler_for_exception.
 349   static int fast_exception_handler_bci_for(const methodHandle&amp; mh, Klass* ex_klass, int throw_bci, TRAPS);
 350 
<span class="line-added"> 351   static bool register_native(Klass* k,</span>
<span class="line-added"> 352                               Symbol* name,</span>
<span class="line-added"> 353                               Symbol* signature,</span>
<span class="line-added"> 354                               address entry,</span>
<span class="line-added"> 355                               TRAPS);</span>
<span class="line-added"> 356 </span>
 357   // method data access
 358   MethodData* method_data() const              {
 359     return _method_data;
 360   }
 361 
 362   void set_method_data(MethodData* data);
 363 
 364   MethodCounters* method_counters() const {
 365     return _method_counters;
 366   }
 367 
 368   void clear_method_counters() {
 369     _method_counters = NULL;
 370   }
 371 
 372   bool init_method_counters(MethodCounters* counters);
 373 
 374 #ifdef TIERED
 375   // We are reusing interpreter_invocation_count as a holder for the previous event count!
 376   // We can do that since interpreter_invocation_count is not used in tiered.
</pre>
<hr />
<pre>
 454     return (mcs == NULL) ? 0 : mcs-&gt;increment_interpreter_invocation_count();
 455   }
 456 #endif
 457 
 458 #ifndef PRODUCT
 459   int  compiled_invocation_count() const         { return _compiled_invocation_count;  }
 460   void set_compiled_invocation_count(int count)  { _compiled_invocation_count = count; }
 461 #else
 462   // for PrintMethodData in a product build
 463   int  compiled_invocation_count() const         { return 0;  }
 464 #endif // not PRODUCT
 465 
 466   // Clear (non-shared space) pointers which could not be relevant
 467   // if this (shared) method were mapped into another JVM.
 468   void remove_unshareable_info();
 469 
 470   // nmethod/verified compiler entry
 471   address verified_code_entry();
 472   bool check_code() const;      // Not inline to avoid circular ref
 473   CompiledMethod* volatile code() const;
<span class="line-modified"> 474 </span>
<span class="line-added"> 475   // Locks CompiledMethod_lock if not held.</span>
<span class="line-added"> 476   void unlink_code(CompiledMethod *compare);</span>
<span class="line-added"> 477   // Locks CompiledMethod_lock if not held.</span>
<span class="line-added"> 478   void unlink_code();</span>
<span class="line-added"> 479 </span>
<span class="line-added"> 480 private:</span>
<span class="line-added"> 481   // Either called with CompiledMethod_lock held or from constructor.</span>
<span class="line-added"> 482   void clear_code();</span>
<span class="line-added"> 483 </span>
<span class="line-added"> 484 public:</span>
 485   static void set_code(const methodHandle&amp; mh, CompiledMethod* code);
 486   void set_adapter_entry(AdapterHandlerEntry* adapter) {
 487     constMethod()-&gt;set_adapter_entry(adapter);
 488   }
<span class="line-added"> 489   void set_adapter_trampoline(AdapterHandlerEntry** trampoline) {</span>
<span class="line-added"> 490     constMethod()-&gt;set_adapter_trampoline(trampoline);</span>
<span class="line-added"> 491   }</span>
 492   void update_adapter_trampoline(AdapterHandlerEntry* adapter) {
 493     constMethod()-&gt;update_adapter_trampoline(adapter);
 494   }
<span class="line-added"> 495   void set_from_compiled_entry(address entry) {</span>
<span class="line-added"> 496     _from_compiled_entry =  entry;</span>
<span class="line-added"> 497   }</span>
 498 
 499   address get_i2c_entry();
 500   address get_c2i_entry();
 501   address get_c2i_unverified_entry();
<span class="line-added"> 502   address get_c2i_no_clinit_check_entry();</span>
 503   AdapterHandlerEntry* adapter() const {
 504     return constMethod()-&gt;adapter();
 505   }
 506   // setup entry points
 507   void link_method(const methodHandle&amp; method, TRAPS);
 508   // clear entry points. Used by sharing code during dump time
 509   void unlink_method() NOT_CDS_RETURN;
 510 
 511   virtual void metaspace_pointers_do(MetaspaceClosure* iter);
 512   virtual MetaspaceObj::Type type() const { return MethodType; }
 513 
 514   // vtable index
 515   enum VtableIndexFlag {
 516     // Valid vtable indexes are non-negative (&gt;= 0).
 517     // These few negative values are used as sentinels.
 518     itable_index_max        = -10, // first itable index, growing downward
 519     pending_itable_index    = -9,  // itable index will be assigned
 520     invalid_vtable_index    = -4,  // distinct from any valid vtable index
 521     garbage_vtable_index    = -3,  // not yet linked; no vtable layout yet
 522     nonvirtual_vtable_index = -2   // there is no need for vtable dispatch
 523     // 6330203 Note:  Do not use -1, which was overloaded with many meanings.
 524   };
 525   DEBUG_ONLY(bool valid_vtable_index() const     { return _vtable_index &gt;= nonvirtual_vtable_index; })
 526   bool has_vtable_index() const                  { return _vtable_index &gt;= 0; }
 527   int  vtable_index() const                      { return _vtable_index; }
 528   void set_vtable_index(int index);
 529   DEBUG_ONLY(bool valid_itable_index() const     { return _vtable_index &lt;= pending_itable_index; })
 530   bool has_itable_index() const                  { return _vtable_index &lt;= itable_index_max; }
 531   int  itable_index() const                      { assert(valid_itable_index(), &quot;&quot;);
 532                                                    return itable_index_max - _vtable_index; }
 533   void set_itable_index(int index);
 534 
 535   // interpreter entry
 536   address interpreter_entry() const              { return _i2i_entry; }
 537   // Only used when first initialize so we can set _i2i_entry and _from_interpreted_entry
 538   void set_interpreter_entry(address entry) {
<span class="line-modified"> 539     assert(!is_shared(),</span>
<span class="line-added"> 540            &quot;shared method&#39;s interpreter entry should not be changed at run time&quot;);</span>
 541     if (_i2i_entry != entry) {
 542       _i2i_entry = entry;
 543     }
 544     if (_from_interpreted_entry != entry) {
 545       _from_interpreted_entry = entry;
 546     }
 547   }
 548 
 549   // native function (used for native methods only)
 550   enum {
 551     native_bind_event_is_interesting = true
 552   };
 553   address native_function() const                { return *(native_function_addr()); }

 554 
 555   // Must specify a real function (not NULL).
 556   // Use clear_native_function() to unregister.
 557   void set_native_function(address function, bool post_event_flag);
 558   bool has_native_function() const;
 559   void clear_native_function();
 560 
 561   // signature handler (used for native methods only)
 562   address signature_handler() const              { return *(signature_handler_addr()); }
 563   void set_signature_handler(address handler);
 564 
 565   // Interpreter oopmap support
 566   void mask_for(int bci, InterpreterOopMap* mask);
 567 
 568   // operations on invocation counter
 569   void print_invocation_count();
 570 
 571   // byte codes
 572   void    set_code(address code)      { return constMethod()-&gt;set_code(code); }
 573   address code_base() const           { return constMethod()-&gt;code_base(); }
</pre>
<hr />
<pre>
 591                          { return constMethod()-&gt;checked_exceptions_length(); }
 592   CheckedExceptionElement* checked_exceptions_start() const
 593                           { return constMethod()-&gt;checked_exceptions_start(); }
 594 
 595   // localvariable table
 596   bool has_localvariable_table() const
 597                           { return constMethod()-&gt;has_localvariable_table(); }
 598   int localvariable_table_length() const
 599                         { return constMethod()-&gt;localvariable_table_length(); }
 600   LocalVariableTableElement* localvariable_table_start() const
 601                          { return constMethod()-&gt;localvariable_table_start(); }
 602 
 603   bool has_linenumber_table() const
 604                               { return constMethod()-&gt;has_linenumber_table(); }
 605   u_char* compressed_linenumber_table() const
 606                        { return constMethod()-&gt;compressed_linenumber_table(); }
 607 
 608   // method holder (the Klass* holding this method)
 609   InstanceKlass* method_holder() const         { return constants()-&gt;pool_holder(); }
 610 

 611   Symbol* klass_name() const;                    // returns the name of the method holder
<span class="line-modified"> 612   BasicType result_type() const                  { return constMethod()-&gt;result_type(); }</span>
<span class="line-modified"> 613   bool is_returning_oop() const                  { BasicType r = result_type(); return is_reference_type(r); }</span>
 614   bool is_returning_fp() const                   { BasicType r = result_type(); return (r == T_FLOAT || r == T_DOUBLE); }
 615 
 616   // Checked exceptions thrown by this method (resolved to mirrors)
 617   objArrayHandle resolved_checked_exceptions(TRAPS) { return resolved_checked_exceptions_impl(this, THREAD); }
 618 
 619   // Access flags
 620   bool is_public() const                         { return access_flags().is_public();      }
 621   bool is_private() const                        { return access_flags().is_private();     }
 622   bool is_protected() const                      { return access_flags().is_protected();   }
 623   bool is_package_private() const                { return !is_public() &amp;&amp; !is_private() &amp;&amp; !is_protected(); }
 624   bool is_static() const                         { return access_flags().is_static();      }
 625   bool is_final() const                          { return access_flags().is_final();       }
 626   bool is_synchronized() const                   { return access_flags().is_synchronized();}
 627   bool is_native() const                         { return access_flags().is_native();      }
 628   bool is_abstract() const                       { return access_flags().is_abstract();    }
 629   bool is_strict() const                         { return access_flags().is_strict();      }
 630   bool is_synthetic() const                      { return access_flags().is_synthetic();   }
 631 
 632   // returns true if contains only return operation
 633   bool is_empty_method() const;
 634 
 635   // returns true if this is a vanilla constructor
 636   bool is_vanilla_constructor() const;
 637 
 638   // checks method and its method holder
 639   bool is_final_method() const;
 640   bool is_final_method(AccessFlags class_access_flags) const;
 641   // interface method declared with &#39;default&#39; - excludes private interface methods
 642   bool is_default_method() const;
 643 
 644   // true if method needs no dynamic dispatch (final and/or no vtable entry)
 645   bool can_be_statically_bound() const;
<span class="line-added"> 646   bool can_be_statically_bound(InstanceKlass* context) const;</span>
 647   bool can_be_statically_bound(AccessFlags class_access_flags) const;
 648 
 649   // returns true if the method has any backward branches.
 650   bool has_loops() {
 651     return access_flags().loops_flag_init() ? access_flags().has_loops() : compute_has_loops_flag();
 652   };
 653 
 654   bool compute_has_loops_flag();
 655 
 656   bool has_jsrs() {
 657     return access_flags().has_jsrs();
 658   };
 659   void set_has_jsrs() {
 660     _access_flags.set_has_jsrs();
 661   }
 662 
 663   // returns true if the method has any monitors.
 664   bool has_monitors() const                      { return is_synchronized() || access_flags().has_monitor_bytecodes(); }
 665   bool has_monitor_bytecodes() const             { return access_flags().has_monitor_bytecodes(); }
 666 
</pre>
<hr />
<pre>
 689 
 690   // returns true if the method is static OR if the classfile version &lt; 51
 691   bool has_valid_initializer_flags() const;
 692 
 693   // returns true if the method name is &lt;clinit&gt; and the method has
 694   // valid static initializer flags.
 695   bool is_static_initializer() const;
 696 
 697   // returns true if the method name is &lt;init&gt;
 698   bool is_object_initializer() const;
 699 
 700   // compiled code support
 701   // NOTE: code() is inherently racy as deopt can be clearing code
 702   // simultaneously. Use with caution.
 703   bool has_compiled_code() const;
 704 
 705 #ifdef TIERED
 706   bool has_aot_code() const                      { return aot_code() != NULL; }
 707 #endif
 708 
<span class="line-added"> 709   bool needs_clinit_barrier() const;</span>
<span class="line-added"> 710 </span>
 711   // sizing
 712   static int header_size()                       {
 713     return align_up((int)sizeof(Method), wordSize) / wordSize;
 714   }
 715   static int size(bool is_native);
 716   int size() const                               { return method_size(); }



 717   void log_touched(TRAPS);
 718   static void print_touched_methods(outputStream* out);
 719 
 720   // interpreter support
 721   static ByteSize const_offset()                 { return byte_offset_of(Method, _constMethod       ); }
 722   static ByteSize access_flags_offset()          { return byte_offset_of(Method, _access_flags      ); }
 723   static ByteSize from_compiled_offset()         { return byte_offset_of(Method, _from_compiled_entry); }
 724   static ByteSize code_offset()                  { return byte_offset_of(Method, _code); }
 725   static ByteSize method_data_offset()           {
 726     return byte_offset_of(Method, _method_data);
 727   }
 728   static ByteSize method_counters_offset()       {
 729     return byte_offset_of(Method, _method_counters);
 730   }
 731 #ifndef PRODUCT
 732   static ByteSize compiled_invocation_counter_offset() { return byte_offset_of(Method, _compiled_invocation_count); }
 733 #endif // not PRODUCT
 734   static ByteSize native_function_offset()       { return in_ByteSize(sizeof(Method));                 }
 735   static ByteSize from_interpreted_offset()      { return byte_offset_of(Method, _from_interpreted_entry ); }
 736   static ByteSize interpreter_entry_offset()     { return byte_offset_of(Method, _i2i_entry ); }
</pre>
<hr />
<pre>
 837   // to provide a valid jmethodID; the only sanity checks are in asserts;
 838   // result guaranteed not to be NULL.
 839   inline static Method* resolve_jmethod_id(jmethodID mid) {
 840     assert(mid != NULL, &quot;JNI method id should not be null&quot;);
 841     return *((Method**)mid);
 842   }
 843 
 844   // Use checked_resolve_jmethod_id() in situations where the caller
 845   // should provide a valid jmethodID, but might not. NULL is returned
 846   // when the jmethodID does not refer to a valid method.
 847   static Method* checked_resolve_jmethod_id(jmethodID mid);
 848 
 849   static void change_method_associated_with_jmethod_id(jmethodID old_jmid_ptr, Method* new_method);
 850   static bool is_method_id(jmethodID mid);
 851 
 852   // Clear methods
 853   static void clear_jmethod_ids(ClassLoaderData* loader_data);
 854   static void print_jmethod_ids(const ClassLoaderData* loader_data, outputStream* out) PRODUCT_RETURN;
 855 
 856   // Get this method&#39;s jmethodID -- allocate if it doesn&#39;t exist
<span class="line-modified"> 857   jmethodID jmethod_id();</span>
 858 
 859   // Lookup the jmethodID for this method.  Return NULL if not found.
 860   // NOTE that this function can be called from a signal handler
 861   // (see AsyncGetCallTrace support for Forte Analyzer) and this
 862   // needs to be async-safe. No allocation should be done and
 863   // so handles are not used to avoid deadlock.
 864   jmethodID find_jmethod_id_or_null()               { return method_holder()-&gt;jmethod_id_or_null(this); }
 865 
 866   // Support for inlining of intrinsic methods
 867   vmIntrinsics::ID intrinsic_id() const          { return (vmIntrinsics::ID) _intrinsic_id;           }
 868   void     set_intrinsic_id(vmIntrinsics::ID id) {                           _intrinsic_id = (u2) id; }
 869 
 870   // Helper routines for intrinsic_id() and vmIntrinsics::method().
 871   void init_intrinsic_id();     // updates from _none if a match
 872   static vmSymbols::SID klass_id_for_intrinsics(const Klass* holder);
 873 
 874   bool caller_sensitive() {
 875     return (_flags &amp; _caller_sensitive) != 0;
 876   }
 877   void set_caller_sensitive(bool x) {
</pre>
<hr />
<pre>
 932   bool has_osr_nmethod(int level, bool match_level) {
 933    return method_holder()-&gt;lookup_osr_nmethod(this, InvocationEntryBci, level, match_level) != NULL;
 934   }
 935 
 936   int mark_osr_nmethods() {
 937     return method_holder()-&gt;mark_osr_nmethods(this);
 938   }
 939 
 940   nmethod* lookup_osr_nmethod_for(int bci, int level, bool match_level) {
 941     return method_holder()-&gt;lookup_osr_nmethod(this, bci, level, match_level);
 942   }
 943 
 944   // Find if klass for method is loaded
 945   bool is_klass_loaded_by_klass_index(int klass_index) const;
 946   bool is_klass_loaded(int refinfo_index, bool must_be_resolved = false) const;
 947 
 948   // Indicates whether compilation failed earlier for this method, or
 949   // whether it is not compilable for another reason like having a
 950   // breakpoint set in it.
 951   bool  is_not_compilable(int comp_level = CompLevel_any) const;
<span class="line-modified"> 952   void set_not_compilable(const char* reason, int comp_level = CompLevel_all, bool report = true);</span>
<span class="line-modified"> 953   void set_not_compilable_quietly(const char* reason, int comp_level = CompLevel_all) {</span>
<span class="line-modified"> 954     set_not_compilable(reason, comp_level, false);</span>
 955   }
 956   bool  is_not_osr_compilable(int comp_level = CompLevel_any) const;
<span class="line-modified"> 957   void set_not_osr_compilable(const char* reason, int comp_level = CompLevel_all, bool report = true);</span>
<span class="line-modified"> 958   void set_not_osr_compilable_quietly(const char* reason, int comp_level = CompLevel_all) {</span>
<span class="line-modified"> 959     set_not_osr_compilable(reason, comp_level, false);</span>
 960   }
 961   bool is_always_compilable() const;
 962 
 963  private:
 964   void print_made_not_compilable(int comp_level, bool is_osr, bool report, const char* reason);
 965 
 966  public:
 967   MethodCounters* get_method_counters(TRAPS) {
 968     if (_method_counters == NULL) {
 969       build_method_counters(this, CHECK_AND_CLEAR_NULL);
 970     }
 971     return _method_counters;
 972   }
 973 
 974   bool   is_not_c1_compilable() const         { return access_flags().is_not_c1_compilable();  }
 975   void  set_not_c1_compilable()               {       _access_flags.set_not_c1_compilable();   }
 976   void clear_not_c1_compilable()              {       _access_flags.clear_not_c1_compilable(); }
 977   bool   is_not_c2_compilable() const         { return access_flags().is_not_c2_compilable();  }
 978   void  set_not_c2_compilable()               {       _access_flags.set_not_c2_compilable();   }
 979   void clear_not_c2_compilable()              {       _access_flags.clear_not_c2_compilable(); }
</pre>
<hr />
<pre>
 987 
 988   // Background compilation support
 989   bool queued_for_compilation() const  { return access_flags().queued_for_compilation(); }
 990   void set_queued_for_compilation()    { _access_flags.set_queued_for_compilation();     }
 991   void clear_queued_for_compilation()  { _access_flags.clear_queued_for_compilation();   }
 992 
 993   // Resolve all classes in signature, return &#39;true&#39; if successful
 994   static bool load_signature_classes(const methodHandle&amp; m, TRAPS);
 995 
 996   // Return if true if not all classes references in signature, including return type, has been loaded
 997   static bool has_unloaded_classes_in_signature(const methodHandle&amp; m, TRAPS);
 998 
 999   // Printing
1000   void print_short_name(outputStream* st = tty); // prints as klassname::methodname; Exposed so field engineers can debug VM
1001 #if INCLUDE_JVMTI
1002   void print_name(outputStream* st = tty); // prints as &quot;virtual void foo(int)&quot;; exposed for TraceRedefineClasses
1003 #else
1004   void print_name(outputStream* st = tty)        PRODUCT_RETURN; // prints as &quot;virtual void foo(int)&quot;
1005 #endif
1006 
<span class="line-added">1007   typedef int (*method_comparator_func)(Method* a, Method* b);</span>
<span class="line-added">1008 </span>
1009   // Helper routine used for method sorting
<span class="line-modified">1010   static void sort_methods(Array&lt;Method*&gt;* methods, bool set_idnums = true, method_comparator_func func = NULL);</span>
1011 
1012   // Deallocation function for redefine classes or if an error occurs
1013   void deallocate_contents(ClassLoaderData* loader_data);
1014 
<span class="line-added">1015   void release_C_heap_structures();</span>
<span class="line-added">1016 </span>
1017   Method* get_new_method() const {
1018     InstanceKlass* holder = method_holder();
1019     Method* new_method = holder-&gt;method_with_idnum(orig_method_idnum());
1020 
1021     assert(new_method != NULL, &quot;method_with_idnum() should not be NULL&quot;);
1022     assert(this != new_method, &quot;sanity check&quot;);
1023     return new_method;
1024   }
1025 
1026   // Printing
1027 #ifndef PRODUCT
1028   void print_on(outputStream* st) const;
1029 #endif
1030   void print_value_on(outputStream* st) const;
1031   void print_linkage_flags(outputStream* st) PRODUCT_RETURN;
1032 
1033   const char* internal_name() const { return &quot;{method}&quot;; }
1034 
1035   // Check for valid method pointer
1036   static bool has_method_vptr(const void* ptr);
</pre>
</td>
</tr>
</table>
<center><a href="method.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="method.inline.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>