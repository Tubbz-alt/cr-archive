<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/hotspot/share/oops/annotations.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2012, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #ifndef SHARE_OOPS_ANNOTATIONS_HPP
 26 #define SHARE_OOPS_ANNOTATIONS_HPP
 27 
 28 #include &quot;oops/array.hpp&quot;
 29 #include &quot;oops/metadata.hpp&quot;
 30 #include &quot;utilities/exceptions.hpp&quot;
 31 #include &quot;utilities/globalDefinitions.hpp&quot;
 32 
 33 
 34 class ClassLoaderData;
 35 class outputStream;
 36 
 37 typedef Array&lt;u1&gt; AnnotationArray;
 38 
 39 // Class to hold the various types of annotations. The only metadata that points
 40 // to this is InstanceKlass, or another Annotations instance if this is a
 41 // a type_annotation instance.
 42 
 43 class Annotations: public MetaspaceObj {
 44  friend class JVMCIVMStructs;
 45 
 46   // If you add a new field that points to any metaspace object, you
 47   // must add this field to Annotations::metaspace_pointers_do().
 48 
 49   // Annotations for this class, or null if none.
 50   AnnotationArray*             _class_annotations;
 51   // Annotation objects (byte arrays) for fields, or null if no annotations.
 52   // Indices correspond to entries (not indices) in fields array.
 53   Array&lt;AnnotationArray*&gt;*     _fields_annotations;
 54   // Type annotations for this class, or null if none.
 55   AnnotationArray*             _class_type_annotations;
 56   Array&lt;AnnotationArray*&gt;*     _fields_type_annotations;
 57 
 58  public:
 59   // Allocate instance of this class
 60   static Annotations* allocate(ClassLoaderData* loader_data, TRAPS);
 61 
 62   static void free_contents(ClassLoaderData* loader_data, Array&lt;AnnotationArray*&gt;* p);
 63   void deallocate_contents(ClassLoaderData* loader_data);
 64   DEBUG_ONLY(bool on_stack() { return false; })  // for template
 65 
 66   // Sizing (in words)
 67   static int size()    { return sizeof(Annotations) / wordSize; }
 68 
 69   // Annotations should be stored in the read-only region of CDS archive.
 70   static bool is_read_only_by_default() { return true; }
 71 
 72   // Constructor to initialize to null
 73   Annotations() : _class_annotations(NULL),
 74                   _fields_annotations(NULL),
 75                   _class_type_annotations(NULL),
 76                   _fields_type_annotations(NULL) {}
 77 
 78   AnnotationArray* class_annotations() const                       { return _class_annotations; }
 79   Array&lt;AnnotationArray*&gt;* fields_annotations() const              { return _fields_annotations; }
 80   AnnotationArray* class_type_annotations() const                  { return _class_type_annotations; }
 81   Array&lt;AnnotationArray*&gt;* fields_type_annotations() const         { return _fields_type_annotations; }
 82 
 83   void set_class_annotations(AnnotationArray* md)                     { _class_annotations = md; }
 84   void set_fields_annotations(Array&lt;AnnotationArray*&gt;* md)            { _fields_annotations = md; }
 85   void set_class_type_annotations(AnnotationArray* cta)               { _class_type_annotations = cta; }
 86   void set_fields_type_annotations(Array&lt;AnnotationArray*&gt;* fta)      { _fields_type_annotations = fta; }
 87 
 88   // Turn metadata annotations into a Java heap object (oop)
 89   static typeArrayOop make_java_array(AnnotationArray* annotations, TRAPS);
 90 
 91   bool is_klass() const { return false; }
 92   void metaspace_pointers_do(MetaspaceClosure* it);
 93   MetaspaceObj::Type type() const { return AnnotationsType; }
 94 
 95  private:
 96   static julong count_bytes(Array&lt;AnnotationArray*&gt;* p);
 97  public:
 98   const char* internal_name() const { return &quot;{annotations}&quot;; }
 99 #ifndef PRODUCT
100   void print_on(outputStream* st) const;
101 #endif
102   void print_value_on(outputStream* st) const;
103 };
104 #endif // SHARE_OOPS_ANNOTATIONS_HPP
    </pre>
  </body>
</html>