<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/oops/array.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="annotations.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="arrayKlass.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/oops/array.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 25,12 ***</span>
  #ifndef SHARE_OOPS_ARRAY_HPP
  #define SHARE_OOPS_ARRAY_HPP
  
  #include &quot;memory/allocation.hpp&quot;
  #include &quot;memory/metaspace.hpp&quot;
<span class="line-modified">! #include &quot;runtime/orderAccess.hpp&quot;</span>
  #include &quot;utilities/align.hpp&quot;
  
  // Array for metadata allocation
  
  template &lt;typename T&gt;
  class Array: public MetaspaceObj {
<span class="line-new-header">--- 25,13 ---</span>
  #ifndef SHARE_OOPS_ARRAY_HPP
  #define SHARE_OOPS_ARRAY_HPP
  
  #include &quot;memory/allocation.hpp&quot;
  #include &quot;memory/metaspace.hpp&quot;
<span class="line-modified">! #include &quot;runtime/atomic.hpp&quot;</span>
  #include &quot;utilities/align.hpp&quot;
<span class="line-added">+ #include &quot;utilities/globalDefinitions.hpp&quot;</span>
  
  // Array for metadata allocation
  
  template &lt;typename T&gt;
  class Array: public MetaspaceObj {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 47,13 ***</span>
    void initialize(int length) {
      _length = length;
    }
  
   private:
<span class="line-modified">!   // Turn off copy constructor and assignment operator.</span>
<span class="line-removed">-   Array(const Array&lt;T&gt;&amp;);</span>
<span class="line-removed">-   void operator=(const Array&lt;T&gt;&amp;);</span>
  
    void* operator new(size_t size, ClassLoaderData* loader_data, int length, TRAPS) throw() {
      size_t word_size = Array::size(length);
      return (void*) Metaspace::allocate(loader_data, word_size,
                                         MetaspaceObj::array_type(sizeof(T)), THREAD);
<span class="line-new-header">--- 48,11 ---</span>
    void initialize(int length) {
      _length = length;
    }
  
   private:
<span class="line-modified">!   NONCOPYABLE(Array);</span>
  
    void* operator new(size_t size, ClassLoaderData* loader_data, int length, TRAPS) throw() {
      size_t word_size = Array::size(length);
      return (void*) Metaspace::allocate(loader_data, word_size,
                                         MetaspaceObj::array_type(sizeof(T)), THREAD);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 120,12 ***</span>
    T    at(int i) const                 { assert(i &gt;= 0 &amp;&amp; i&lt; _length, &quot;oob: 0 &lt;= %d &lt; %d&quot;, i, _length); return _data[i]; }
    void at_put(const int i, const T&amp; x) { assert(i &gt;= 0 &amp;&amp; i&lt; _length, &quot;oob: 0 &lt;= %d &lt; %d&quot;, i, _length); _data[i] = x; }
    T*   adr_at(const int i)             { assert(i &gt;= 0 &amp;&amp; i&lt; _length, &quot;oob: 0 &lt;= %d &lt; %d&quot;, i, _length); return &amp;_data[i]; }
    int  find(const T&amp; x)                { return index_of(x); }
  
<span class="line-modified">!   T at_acquire(const int i)            { return OrderAccess::load_acquire(adr_at(i)); }</span>
<span class="line-modified">!   void release_at_put(int i, T x)      { OrderAccess::release_store(adr_at(i), x); }</span>
  
    static int size(int length) {
      size_t bytes = align_up(byte_sizeof(length), BytesPerWord);
      size_t words = bytes / BytesPerWord;
  
<span class="line-new-header">--- 119,12 ---</span>
    T    at(int i) const                 { assert(i &gt;= 0 &amp;&amp; i&lt; _length, &quot;oob: 0 &lt;= %d &lt; %d&quot;, i, _length); return _data[i]; }
    void at_put(const int i, const T&amp; x) { assert(i &gt;= 0 &amp;&amp; i&lt; _length, &quot;oob: 0 &lt;= %d &lt; %d&quot;, i, _length); _data[i] = x; }
    T*   adr_at(const int i)             { assert(i &gt;= 0 &amp;&amp; i&lt; _length, &quot;oob: 0 &lt;= %d &lt; %d&quot;, i, _length); return &amp;_data[i]; }
    int  find(const T&amp; x)                { return index_of(x); }
  
<span class="line-modified">!   T at_acquire(const int i)            { return Atomic::load_acquire(adr_at(i)); }</span>
<span class="line-modified">!   void release_at_put(int i, T x)      { Atomic::release_store(adr_at(i), x); }</span>
  
    static int size(int length) {
      size_t bytes = align_up(byte_sizeof(length), BytesPerWord);
      size_t words = bytes / BytesPerWord;
  
</pre>
<center><a href="annotations.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="arrayKlass.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>