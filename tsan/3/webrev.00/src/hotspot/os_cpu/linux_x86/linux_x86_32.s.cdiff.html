<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/os_cpu/linux_x86/linux_x86_32.s</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="atomic_linux_x86.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="orderAccess_linux_x86.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/os_cpu/linux_x86/linux_x86_32.s</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,6 ***</span>
<span class="line-modified">! # </span>
  # Copyright (c) 2004, 2017, Oracle and/or its affiliates. All rights reserved.
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
<span class="line-new-header">--- 1,6 ---</span>
<span class="line-modified">! #</span>
  # Copyright (c) 2004, 2017, Oracle and/or its affiliates. All rights reserved.
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
</pre>
<hr />
<pre>
<span class="line-old-header">*** 17,19 ***</span>
  # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  #
  # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  # or visit www.oracle.com if you need additional information or have any
  # questions.
<span class="line-modified">! # </span>
  
<span class="line-removed">- 	</span>
          # NOTE WELL!  The _Copy functions are called directly
  	# from server-compiler-generated code via CallLeafNoFP,
  	# which means that they *must* either not use floating
  	# point or use it in the same manner as does the server
  	# compiler.
<span class="line-modified">! 	</span>
          .globl _Copy_conjoint_bytes
          .globl _Copy_arrayof_conjoint_bytes
          .globl _Copy_conjoint_jshorts_atomic
  	.globl _Copy_arrayof_conjoint_jshorts
          .globl _Copy_conjoint_jints_atomic
<span class="line-new-header">--- 17,19 ---</span>
  # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  #
  # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  # or visit www.oracle.com if you need additional information or have any
  # questions.
<span class="line-modified">! #</span>
<span class="line-added">+ </span>
  
          # NOTE WELL!  The _Copy functions are called directly
  	# from server-compiler-generated code via CallLeafNoFP,
  	# which means that they *must* either not use floating
  	# point or use it in the same manner as does the server
  	# compiler.
<span class="line-modified">! </span>
          .globl _Copy_conjoint_bytes
          .globl _Copy_arrayof_conjoint_bytes
          .globl _Copy_conjoint_jshorts_atomic
  	.globl _Copy_arrayof_conjoint_jshorts
          .globl _Copy_conjoint_jints_atomic
</pre>
<hr />
<pre>
<span class="line-old-header">*** 172,11 ***</span>
          movl     8+ 8(%esp),%edi      # to
          cmpl     %esi,%edi
          leal     -1(%esi,%ecx),%eax   # from + count - 1
          jbe      acb_CopyRight
          cmpl     %eax,%edi
<span class="line-modified">!         jbe      acb_CopyLeft </span>
          # copy from low to high
  acb_CopyRight:
          cmpl     $3,%ecx
          jbe      5f
  1:      movl     %ecx,%eax
<span class="line-new-header">--- 172,11 ---</span>
          movl     8+ 8(%esp),%edi      # to
          cmpl     %esi,%edi
          leal     -1(%esi,%ecx),%eax   # from + count - 1
          jbe      acb_CopyRight
          cmpl     %eax,%edi
<span class="line-modified">!         jbe      acb_CopyLeft</span>
          # copy from low to high
  acb_CopyRight:
          cmpl     $3,%ecx
          jbe      5f
  1:      movl     %ecx,%eax
</pre>
<hr />
<pre>
<span class="line-old-header">*** 260,11 ***</span>
          movl     8+ 8(%esp),%edi      # to
          cmpl     %esi,%edi
          leal     -2(%esi,%ecx,2),%eax # from + count*2 - 2
          jbe      cs_CopyRight
          cmpl     %eax,%edi
<span class="line-modified">!         jbe      cs_CopyLeft </span>
          # copy from low to high
  cs_CopyRight:
          # align source address at dword address boundary
          movl     %esi,%eax            # original from
          andl     $3,%eax              # either 0 or 2
<span class="line-new-header">--- 260,11 ---</span>
          movl     8+ 8(%esp),%edi      # to
          cmpl     %esi,%edi
          leal     -2(%esi,%ecx,2),%eax # from + count*2 - 2
          jbe      cs_CopyRight
          cmpl     %eax,%edi
<span class="line-modified">!         jbe      cs_CopyLeft</span>
          # copy from low to high
  cs_CopyRight:
          # align source address at dword address boundary
          movl     %esi,%eax            # original from
          andl     $3,%eax              # either 0 or 2
</pre>
<hr />
<pre>
<span class="line-old-header">*** 281,11 ***</span>
          jz       4f                   # no dwords to move
          cmpl     $32,%ecx
          jbe      2f                   # &lt;= 32 dwords
          # copy aligned dwords
          rep;     smovl
<span class="line-modified">!         jmp      4f </span>
          # copy aligned dwords
  2:      subl     %esi,%edi
          .p2align 4,,15
  3:      movl     (%esi),%edx
          movl     %edx,(%edi,%esi,1)
<span class="line-new-header">--- 281,11 ---</span>
          jz       4f                   # no dwords to move
          cmpl     $32,%ecx
          jbe      2f                   # &lt;= 32 dwords
          # copy aligned dwords
          rep;     smovl
<span class="line-modified">!         jmp      4f</span>
          # copy aligned dwords
  2:      subl     %esi,%edi
          .p2align 4,,15
  3:      movl     (%esi),%edx
          movl     %edx,(%edi,%esi,1)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 347,23 ***</span>
          movl     8+ 8(%esp),%edi      # to
          cmpl     %esi,%edi
          leal     -2(%esi,%ecx,2),%eax # from + count*2 - 2
          jbe      acs_CopyRight
          cmpl     %eax,%edi
<span class="line-modified">!         jbe      acs_CopyLeft </span>
  acs_CopyRight:
          movl     %ecx,%eax            # word count
          sarl     %ecx                 # dword count
          jz       4f                   # no dwords to move
          cmpl     $32,%ecx
          jbe      2f                   # &lt;= 32 dwords
          # copy aligned dwords
          rep;     smovl
<span class="line-modified">!         jmp      4f </span>
          # copy aligned dwords
          .space 5
<span class="line-modified">! 2:      subl     %esi,%edi </span>
          .p2align 4,,15
  3:      movl     (%esi),%edx
          movl     %edx,(%edi,%esi,1)
          addl     $4,%esi
          subl     $1,%ecx
<span class="line-new-header">--- 347,23 ---</span>
          movl     8+ 8(%esp),%edi      # to
          cmpl     %esi,%edi
          leal     -2(%esi,%ecx,2),%eax # from + count*2 - 2
          jbe      acs_CopyRight
          cmpl     %eax,%edi
<span class="line-modified">!         jbe      acs_CopyLeft</span>
  acs_CopyRight:
          movl     %ecx,%eax            # word count
          sarl     %ecx                 # dword count
          jz       4f                   # no dwords to move
          cmpl     $32,%ecx
          jbe      2f                   # &lt;= 32 dwords
          # copy aligned dwords
          rep;     smovl
<span class="line-modified">!         jmp      4f</span>
          # copy aligned dwords
          .space 5
<span class="line-modified">! 2:      subl     %esi,%edi</span>
          .p2align 4,,15
  3:      movl     (%esi),%edx
          movl     %edx,(%edi,%esi,1)
          addl     $4,%esi
          subl     $1,%ecx
</pre>
<hr />
<pre>
<span class="line-old-header">*** 426,11 ***</span>
          movl     8+ 8(%esp),%edi      # to
          cmpl     %esi,%edi
          leal     -4(%esi,%ecx,4),%eax # from + count*4 - 4
          jbe      ci_CopyRight
          cmpl     %eax,%edi
<span class="line-modified">!         jbe      ci_CopyLeft </span>
  ci_CopyRight:
          cmpl     $32,%ecx
          jbe      2f                   # &lt;= 32 dwords
          rep;     smovl
          popl     %edi
<span class="line-new-header">--- 426,11 ---</span>
          movl     8+ 8(%esp),%edi      # to
          cmpl     %esi,%edi
          leal     -4(%esi,%ecx,4),%eax # from + count*4 - 4
          jbe      ci_CopyRight
          cmpl     %eax,%edi
<span class="line-modified">!         jbe      ci_CopyLeft</span>
  ci_CopyRight:
          cmpl     $32,%ecx
          jbe      2f                   # &lt;= 32 dwords
          rep;     smovl
          popl     %edi
</pre>
<hr />
<pre>
<span class="line-old-header">*** 469,11 ***</span>
          rep;     smovl
          cld
          popl     %edi
          popl     %esi
          ret
<span class="line-modified">! 	</span>
          # Support for void Copy::conjoint_jlongs_atomic(jlong* from,
          #                                               jlong* to,
          #                                               size_t count)
          #
          # 32-bit
<span class="line-new-header">--- 469,11 ---</span>
          rep;     smovl
          cld
          popl     %edi
          popl     %esi
          ret
<span class="line-modified">! </span>
          # Support for void Copy::conjoint_jlongs_atomic(jlong* from,
          #                                               jlong* to,
          #                                               size_t count)
          #
          # 32-bit
</pre>
<hr />
<pre>
<span class="line-old-header">*** 535,19 ***</span>
          movl     %ecx,%eax
          sarl     %ecx
          je       5f
          cmpl     $33,%ecx
          jae      3f
<span class="line-modified">! 1:      subl     %esi,%edi </span>
          .p2align 4,,15
  2:      movl     (%esi),%edx
          movl     %edx,(%edi,%esi,1)
          addl     $4,%esi
          subl     $1,%ecx
          jnz      2b
          addl     %esi,%edi
<span class="line-modified">!         jmp      5f </span>
  3:      smovl # align to 8 bytes, we know we are 4 byte aligned to start
          subl     $1,%ecx
  4:      .p2align 4,,15
          movq     0(%esi),%mm0
          addl     $64,%edi
<span class="line-new-header">--- 535,19 ---</span>
          movl     %ecx,%eax
          sarl     %ecx
          je       5f
          cmpl     $33,%ecx
          jae      3f
<span class="line-modified">! 1:      subl     %esi,%edi</span>
          .p2align 4,,15
  2:      movl     (%esi),%edx
          movl     %edx,(%edi,%esi,1)
          addl     $4,%esi
          subl     $1,%ecx
          jnz      2b
          addl     %esi,%edi
<span class="line-modified">!         jmp      5f</span>
  3:      smovl # align to 8 bytes, we know we are 4 byte aligned to start
          subl     $1,%ecx
  4:      .p2align 4,,15
          movq     0(%esi),%mm0
          addl     $64,%edi
</pre>
<hr />
<pre>
<span class="line-old-header">*** 610,13 ***</span>
          popl     %edi
          popl     %esi
          ret
  
  
<span class="line-modified">!         # Support for jlong Atomic::cmpxchg(jlong exchange_value,</span>
<span class="line-modified">!         #                                   volatile jlong* dest,</span>
<span class="line-modified">!         #                                   jlong compare_value)</span>
          #
          .p2align 4,,15
  	.type    _Atomic_cmpxchg_long,@function
  _Atomic_cmpxchg_long:
                                     #  8(%esp) : return PC
<span class="line-new-header">--- 610,13 ---</span>
          popl     %edi
          popl     %esi
          ret
  
  
<span class="line-modified">!         # Support for jlong Atomic::cmpxchg(volatile jlong* dest,</span>
<span class="line-modified">!         #                                   jlong compare_value,</span>
<span class="line-modified">!         #                                   jlong exchange_value)</span>
          #
          .p2align 4,,15
  	.type    _Atomic_cmpxchg_long,@function
  _Atomic_cmpxchg_long:
                                     #  8(%esp) : return PC
</pre>
<hr />
<pre>
<span class="line-old-header">*** 641,6 ***</span>
          movl     4(%esp), %eax   # src
          fildll    (%eax)
          movl     8(%esp), %eax   # dest
          fistpll   (%eax)
          ret
<span class="line-removed">- </span>
<span class="line-new-header">--- 641,5 ---</span>
</pre>
<center><a href="atomic_linux_x86.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="orderAccess_linux_x86.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>