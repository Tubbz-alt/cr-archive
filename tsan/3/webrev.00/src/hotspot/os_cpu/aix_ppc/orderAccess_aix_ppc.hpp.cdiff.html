<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/os_cpu/aix_ppc/orderAccess_aix_ppc.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="atomic_aix_ppc.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="os_aix_ppc.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/os_cpu/aix_ppc/orderAccess_aix_ppc.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,8 ***</span>
  /*
   * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.
<span class="line-modified">!  * Copyright (c) 2012, 2014 SAP SE. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,8 ---</span>
  /*
   * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.
<span class="line-modified">!  * Copyright (c) 2012, 2019 SAP SE. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 62,30 ***</span>
  
  #define inlasm_sync()     __asm__ __volatile__ (&quot;sync&quot;   : : : &quot;memory&quot;);
  #define inlasm_lwsync()   __asm__ __volatile__ (&quot;lwsync&quot; : : : &quot;memory&quot;);
  #define inlasm_eieio()    __asm__ __volatile__ (&quot;eieio&quot;  : : : &quot;memory&quot;);
  #define inlasm_isync()    __asm__ __volatile__ (&quot;isync&quot;  : : : &quot;memory&quot;);
<span class="line-removed">- // Use twi-isync for load_acquire (faster than lwsync).</span>
<span class="line-removed">- // ATTENTION: seems like xlC 10.1 has problems with this inline assembler macro (VerifyMethodHandles found &quot;bad vminfo in AMH.conv&quot;):</span>
<span class="line-removed">- // #define inlasm_acquire_reg(X) __asm__ __volatile__ (&quot;twi 0,%0,0\n isync\n&quot; : : &quot;r&quot; (X) : &quot;memory&quot;);</span>
<span class="line-removed">- #define inlasm_acquire_reg(X) inlasm_lwsync();</span>
  
  inline void OrderAccess::loadload()   { inlasm_lwsync(); }
  inline void OrderAccess::storestore() { inlasm_lwsync(); }
  inline void OrderAccess::loadstore()  { inlasm_lwsync(); }
  inline void OrderAccess::storeload()  { inlasm_sync();   }
  
  inline void OrderAccess::acquire()    { inlasm_lwsync(); }
  inline void OrderAccess::release()    { inlasm_lwsync(); }
  inline void OrderAccess::fence()      { inlasm_sync();   }
<span class="line-modified">! </span>
<span class="line-modified">! template&lt;size_t byte_size&gt;</span>
<span class="line-removed">- struct OrderAccess::PlatformOrderedLoad&lt;byte_size, X_ACQUIRE&gt;</span>
<span class="line-removed">- {</span>
<span class="line-removed">-   template &lt;typename T&gt;</span>
<span class="line-removed">-   T operator()(const volatile T* p) const { T t = Atomic::load(p); inlasm_acquire_reg(t); return t; }</span>
<span class="line-removed">- };</span>
  
  #undef inlasm_sync
  #undef inlasm_lwsync
  #undef inlasm_eieio
  #undef inlasm_isync
<span class="line-new-header">--- 62,21 ---</span>
  
  #define inlasm_sync()     __asm__ __volatile__ (&quot;sync&quot;   : : : &quot;memory&quot;);
  #define inlasm_lwsync()   __asm__ __volatile__ (&quot;lwsync&quot; : : : &quot;memory&quot;);
  #define inlasm_eieio()    __asm__ __volatile__ (&quot;eieio&quot;  : : : &quot;memory&quot;);
  #define inlasm_isync()    __asm__ __volatile__ (&quot;isync&quot;  : : : &quot;memory&quot;);
  
  inline void OrderAccess::loadload()   { inlasm_lwsync(); }
  inline void OrderAccess::storestore() { inlasm_lwsync(); }
  inline void OrderAccess::loadstore()  { inlasm_lwsync(); }
  inline void OrderAccess::storeload()  { inlasm_sync();   }
  
  inline void OrderAccess::acquire()    { inlasm_lwsync(); }
  inline void OrderAccess::release()    { inlasm_lwsync(); }
  inline void OrderAccess::fence()      { inlasm_sync();   }
<span class="line-modified">! inline void OrderAccess::cross_modify_fence()</span>
<span class="line-modified">!                                       { inlasm_isync();  }</span>
  
  #undef inlasm_sync
  #undef inlasm_lwsync
  #undef inlasm_eieio
  #undef inlasm_isync
</pre>
<center><a href="atomic_aix_ppc.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="os_aix_ppc.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>