<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.management.agent/share/classes/sun/management/jmxremote/ConnectorBootstrap.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../jdk/internal/agent/AgentConfigurationError.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../conf/management.properties.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.management.agent/share/classes/sun/management/jmxremote/ConnectorBootstrap.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2017, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 114,10 ***</span>
<span class="line-new-header">--- 114,12 ---</span>
                  &quot;com.sun.management.jmxremote.port&quot;;
          public static final String HOST =
                  &quot;com.sun.management.jmxremote.host&quot;;
          public static final String RMI_PORT =
                  &quot;com.sun.management.jmxremote.rmi.port&quot;;
<span class="line-added">+         public static final String LOCAL_PORT =</span>
<span class="line-added">+                 &quot;com.sun.management.jmxremote.local.port&quot;;</span>
          public static final String CONFIG_FILE_NAME =
                  &quot;com.sun.management.config.file&quot;;
          public static final String USE_LOCAL_ONLY =
                  &quot;com.sun.management.jmxremote.local.only&quot;;
          public static final String USE_SSL =
</pre>
<hr />
<pre>
<span class="line-old-header">*** 538,17 ***</span>
          if (lh == null || !lh.isLoopbackAddress()) {
              localhost = &quot;127.0.0.1&quot;;
          }
  
          MBeanServer mbs = ManagementFactory.getPlatformMBeanServer();
          try {
<span class="line-modified">!             JMXServiceURL url = new JMXServiceURL(&quot;rmi&quot;, localhost, 0);</span>
<span class="line-modified">!             // Do we accept connections from local interfaces only?</span>
<span class="line-removed">-             Properties props = Agent.getManagementProperties();</span>
<span class="line-removed">-             if (props ==  null) {</span>
                  props = new Properties();
              }
              String useLocalOnlyStr = props.getProperty(
                      PropertyNames.USE_LOCAL_ONLY, DefaultValues.USE_LOCAL_ONLY);
              boolean useLocalOnly = Boolean.valueOf(useLocalOnlyStr).booleanValue();
              if (useLocalOnly) {
                  env.put(RMIConnectorServer.RMI_SERVER_SOCKET_FACTORY_ATTRIBUTE,
<span class="line-new-header">--- 540,39 ---</span>
          if (lh == null || !lh.isLoopbackAddress()) {
              localhost = &quot;127.0.0.1&quot;;
          }
  
          MBeanServer mbs = ManagementFactory.getPlatformMBeanServer();
<span class="line-added">+ </span>
<span class="line-added">+         Properties props = null;</span>
          try {
<span class="line-modified">!             props = Agent.getManagementProperties();</span>
<span class="line-modified">!             if (props == null) {</span>
                  props = new Properties();
              }
<span class="line-added">+         } catch (Exception e) {</span>
<span class="line-added">+             throw new AgentConfigurationError(AGENT_EXCEPTION, e, e.toString());</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         // User can specify a port to be used to start local connector server.</span>
<span class="line-added">+         // Random one will be allocated if port is not specified.</span>
<span class="line-added">+         int localPort = 0;</span>
<span class="line-added">+         String localPortStr = props.getProperty(PropertyNames.LOCAL_PORT);</span>
<span class="line-added">+         try {</span>
<span class="line-added">+             if (localPortStr != null) {</span>
<span class="line-added">+                 localPort = Integer.parseInt(localPortStr);</span>
<span class="line-added">+             }</span>
<span class="line-added">+         } catch (NumberFormatException x) {</span>
<span class="line-added">+             throw new AgentConfigurationError(INVALID_JMXREMOTE_LOCAL_PORT, x, localPortStr);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (localPort &lt; 0) {</span>
<span class="line-added">+             throw new AgentConfigurationError(INVALID_JMXREMOTE_LOCAL_PORT, localPortStr);</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         try {</span>
<span class="line-added">+             JMXServiceURL url = new JMXServiceURL(&quot;rmi&quot;, localhost, localPort);</span>
<span class="line-added">+             // Do we accept connections from local interfaces only?</span>
              String useLocalOnlyStr = props.getProperty(
                      PropertyNames.USE_LOCAL_ONLY, DefaultValues.USE_LOCAL_ONLY);
              boolean useLocalOnly = Boolean.valueOf(useLocalOnlyStr).booleanValue();
              if (useLocalOnly) {
                  env.put(RMIConnectorServer.RMI_SERVER_SOCKET_FACTORY_ATTRIBUTE,
</pre>
<center><a href="../../../jdk/internal/agent/AgentConfigurationError.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../conf/management.properties.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>