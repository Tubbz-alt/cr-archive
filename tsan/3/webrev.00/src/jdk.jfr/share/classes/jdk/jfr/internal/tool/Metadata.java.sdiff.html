<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jfr/share/classes/jdk/jfr/internal/tool/Metadata.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="EventPrintWriter.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PrettyWriter.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jfr/share/classes/jdk/jfr/internal/tool/Metadata.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.jfr.internal.tool;
 27 
 28 import java.io.IOException;
 29 import java.io.PrintWriter;
 30 import java.nio.file.Path;
 31 import java.util.Collections;
 32 import java.util.Comparator;
 33 import java.util.Deque;
 34 import java.util.List;
 35 
 36 import jdk.jfr.consumer.RecordingFile;
 37 import jdk.jfr.internal.Type;
<span class="line-modified"> 38 import jdk.jfr.internal.consumer.RecordingInternals;</span>
 39 
 40 final class Metadata extends Command {
 41 


 42     private static class TypeComparator implements Comparator&lt;Type&gt; {
 43 
 44         @Override
 45         public int compare(Type t1, Type t2) {
 46             int g1 = groupValue(t1);
 47             int g2 = groupValue(t2);
 48             if (g1 == g2) {
 49                 String n1 = t1.getName();
 50                 String n2 = t2.getName();
 51                 String package1 = n1.substring(0, n1.lastIndexOf(&#39;.&#39;) + 1);
 52                 String package2 = n2.substring(0, n2.lastIndexOf(&#39;.&#39;) + 1);
 53 
 54                 if (package1.equals(package2)) {
 55                     return n1.compareTo(n2);
 56                 } else {
 57                     // Ensure that jdk.* are printed first
 58                     // This makes it easier to find user defined events at the end.
 59                     if (Type.SUPER_TYPE_EVENT.equals(t1.getSuperType()) &amp;&amp; !package1.equals(package2)) {
 60                         if (package1.equals(&quot;jdk.jfr&quot;)) {
 61                             return -1;
</pre>
<hr />
<pre>
 72         }
 73 
 74         int groupValue(Type t) {
 75             String superType = t.getSuperType();
 76             if (superType == null) {
 77                 return 1;
 78             }
 79             if (Type.SUPER_TYPE_ANNOTATION.equals(superType)) {
 80                 return 3;
 81             }
 82             if (Type.SUPER_TYPE_SETTING.equals(superType)) {
 83                 return 4;
 84             }
 85             if (Type.SUPER_TYPE_EVENT.equals(superType)) {
 86                 return 5;
 87             }
 88             return 2; // reserved for enums in the future
 89         }
 90     }
 91 

 92     @Override
 93     public String getName() {
 94         return &quot;metadata&quot;;
 95     }
 96 
 97     @Override
 98     public List&lt;String&gt; getOptionSyntax() {
 99         return Collections.singletonList(&quot;&lt;file&gt;&quot;);
100     }
101 
102     @Override
103     public String getDescription() {
104         return &quot;Display event metadata, such as labels, descriptions and field layout&quot;;
105     }
106 
107     @Override
108     public void execute(Deque&lt;String&gt; options) throws UserSyntaxException, UserDataException {
109         Path file = getJFRInputFile(options);
110 
111         boolean showIds = false;
112         int optionCount = options.size();
113         while (optionCount &gt; 0) {
114             if (acceptOption(options, &quot;--ids&quot;)) {
115                 showIds = true;
116             }
117             if (optionCount == options.size()) {
118                 // No progress made
119                 throw new UserSyntaxException(&quot;unknown option &quot; + options.peek());
120             }
121             optionCount = options.size();
122         }
123 
124         try (PrintWriter pw = new PrintWriter(System.out)) {
125             PrettyWriter prettyWriter = new PrettyWriter(pw);
126             prettyWriter.setShowIds(showIds);
127             try (RecordingFile rf = new RecordingFile(file)) {
<span class="line-modified">128                 List&lt;Type&gt; types = RecordingInternals.INSTANCE.readTypes(rf);</span>
129                 Collections.sort(types, new TypeComparator());
130                 for (Type type : types) {
131                     prettyWriter.printType(type);
132                 }
133                 prettyWriter.flush(true);
134             } catch (IOException ioe) {
135                 couldNotReadError(file, ioe);
136             }
137         }
138     }
139 }
</pre>
</td>
<td>
<hr />
<pre>
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.jfr.internal.tool;
 27 
 28 import java.io.IOException;
 29 import java.io.PrintWriter;
 30 import java.nio.file.Path;
 31 import java.util.Collections;
 32 import java.util.Comparator;
 33 import java.util.Deque;
 34 import java.util.List;
 35 
 36 import jdk.jfr.consumer.RecordingFile;
 37 import jdk.jfr.internal.Type;
<span class="line-modified"> 38 import jdk.jfr.internal.consumer.JdkJfrConsumer;</span>
 39 
 40 final class Metadata extends Command {
 41 
<span class="line-added"> 42     private final static JdkJfrConsumer PRIVATE_ACCESS = JdkJfrConsumer.instance();</span>
<span class="line-added"> 43 </span>
 44     private static class TypeComparator implements Comparator&lt;Type&gt; {
 45 
 46         @Override
 47         public int compare(Type t1, Type t2) {
 48             int g1 = groupValue(t1);
 49             int g2 = groupValue(t2);
 50             if (g1 == g2) {
 51                 String n1 = t1.getName();
 52                 String n2 = t2.getName();
 53                 String package1 = n1.substring(0, n1.lastIndexOf(&#39;.&#39;) + 1);
 54                 String package2 = n2.substring(0, n2.lastIndexOf(&#39;.&#39;) + 1);
 55 
 56                 if (package1.equals(package2)) {
 57                     return n1.compareTo(n2);
 58                 } else {
 59                     // Ensure that jdk.* are printed first
 60                     // This makes it easier to find user defined events at the end.
 61                     if (Type.SUPER_TYPE_EVENT.equals(t1.getSuperType()) &amp;&amp; !package1.equals(package2)) {
 62                         if (package1.equals(&quot;jdk.jfr&quot;)) {
 63                             return -1;
</pre>
<hr />
<pre>
 74         }
 75 
 76         int groupValue(Type t) {
 77             String superType = t.getSuperType();
 78             if (superType == null) {
 79                 return 1;
 80             }
 81             if (Type.SUPER_TYPE_ANNOTATION.equals(superType)) {
 82                 return 3;
 83             }
 84             if (Type.SUPER_TYPE_SETTING.equals(superType)) {
 85                 return 4;
 86             }
 87             if (Type.SUPER_TYPE_EVENT.equals(superType)) {
 88                 return 5;
 89             }
 90             return 2; // reserved for enums in the future
 91         }
 92     }
 93 
<span class="line-added"> 94 </span>
 95     @Override
 96     public String getName() {
 97         return &quot;metadata&quot;;
 98     }
 99 
100     @Override
101     public List&lt;String&gt; getOptionSyntax() {
102         return Collections.singletonList(&quot;&lt;file&gt;&quot;);
103     }
104 
105     @Override
106     public String getDescription() {
107         return &quot;Display event metadata, such as labels, descriptions and field layout&quot;;
108     }
109 
110     @Override
111     public void execute(Deque&lt;String&gt; options) throws UserSyntaxException, UserDataException {
112         Path file = getJFRInputFile(options);
113 
114         boolean showIds = false;
115         int optionCount = options.size();
116         while (optionCount &gt; 0) {
117             if (acceptOption(options, &quot;--ids&quot;)) {
118                 showIds = true;
119             }
120             if (optionCount == options.size()) {
121                 // No progress made
122                 throw new UserSyntaxException(&quot;unknown option &quot; + options.peek());
123             }
124             optionCount = options.size();
125         }
126 
127         try (PrintWriter pw = new PrintWriter(System.out)) {
128             PrettyWriter prettyWriter = new PrettyWriter(pw);
129             prettyWriter.setShowIds(showIds);
130             try (RecordingFile rf = new RecordingFile(file)) {
<span class="line-modified">131                 List&lt;Type&gt; types = PRIVATE_ACCESS.readTypes(rf);</span>
132                 Collections.sort(types, new TypeComparator());
133                 for (Type type : types) {
134                     prettyWriter.printType(type);
135                 }
136                 prettyWriter.flush(true);
137             } catch (IOException ioe) {
138                 couldNotReadError(file, ioe);
139             }
140         }
141     }
142 }
</pre>
</td>
</tr>
</table>
<center><a href="EventPrintWriter.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PrettyWriter.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>