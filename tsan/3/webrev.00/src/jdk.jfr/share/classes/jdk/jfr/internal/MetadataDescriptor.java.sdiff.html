<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jfr/share/classes/jdk/jfr/internal/MetadataDescriptor.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="LogTag.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="MetadataReader.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jfr/share/classes/jdk/jfr/internal/MetadataDescriptor.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.jfr.internal;
 27 
<span class="line-removed"> 28 import java.io.DataInput;</span>
 29 import java.io.DataOutput;
 30 import java.io.IOException;
 31 import java.util.ArrayList;
 32 import java.util.Collection;
 33 import java.util.List;
 34 import java.util.Locale;
 35 import java.util.TimeZone;
 36 
 37 import jdk.jfr.EventType;

 38 
 39 /**
 40  * Metadata about a chunk
 41  */
 42 public final class MetadataDescriptor {
 43 
 44     static final class Attribute {
 45         final String name;
 46         final String value;
 47 
 48         private Attribute(String name, String value) {
 49             this.name = name;
 50             this.value = value;
 51         }
 52     }
 53 
 54     static final class Element {
 55         final String name;
 56         final List&lt;Element&gt; elements = new ArrayList&lt;&gt;();
 57         final List&lt;Attribute&gt; attributes = new ArrayList&lt;&gt;();
</pre>
<hr />
<pre>
197     static final String ATTRIBUTE_ID = &quot;id&quot;;
198     static final String ATTRIBUTE_SIMPLE_TYPE = &quot;simpleType&quot;;
199     static final String ATTRIBUTE_GMT_OFFSET = &quot;gmtOffset&quot;;
200     static final String ATTRIBUTE_LOCALE = &quot;locale&quot;;
201     static final String ELEMENT_TYPE = &quot;class&quot;;
202     static final String ELEMENT_SETTING = &quot;setting&quot;;
203     static final String ELEMENT_ANNOTATION = &quot;annotation&quot;;
204     static final String ELEMENT_FIELD = &quot;field&quot;;
205     static final String ATTRIBUTE_SUPER_TYPE = &quot;superType&quot;;
206     static final String ATTRIBUTE_TYPE_ID = &quot;class&quot;;
207     static final String ATTRIBUTE_DIMENSION = &quot;dimension&quot;;
208     static final String ATTRIBUTE_NAME = &quot;name&quot;;
209     static final String ATTRIBUTE_CONSTANT_POOL = &quot;constantPool&quot;;
210     static final String ATTRIBUTE_DEFAULT_VALUE = &quot;defaultValue&quot;;
211 
212     final List&lt;EventType&gt; eventTypes = new ArrayList&lt;&gt;();
213     final Collection&lt;Type&gt; types = new ArrayList&lt;&gt;();
214     long gmtOffset;
215     String locale;
216     Element root;

217 
218     // package private
219     MetadataDescriptor() {
220     }
221 
222     private static void prettyPrintXML(Appendable sb, String indent, Element e) throws IOException {
223         sb.append(indent + &quot;&lt;&quot; + e.name);
224         for (Attribute a : e.attributes) {
225             sb.append(&quot; &quot;).append(a.name).append(&quot;=\&quot;&quot;).append(a.value).append(&quot;\&quot;&quot;);
226         }
227         if (e.elements.size() == 0) {
228             sb.append(&quot;/&quot;);
229         }
230         sb.append(&quot;&gt;\n&quot;);
231         for (Element child : e.elements) {
232             prettyPrintXML(sb, indent + &quot;  &quot;, child);
233         }
234         if (e.elements.size() != 0) {
235             sb.append(indent).append(&quot;&lt;/&quot;).append(e.name).append(&quot;&gt;\n&quot;);
236         }
237     }
238 
239     public Collection&lt;Type&gt; getTypes() {
240         return types;
241     }
242 
243     public List&lt;EventType&gt; getEventTypes() {
244         return eventTypes;
245     }
246 
247     public int getGMTOffset() {
248         return (int) gmtOffset;
249     }
250 
251     public String getLocale() {
252         return locale;
253     }
254 
<span class="line-modified">255     public static MetadataDescriptor read(DataInput input) throws IOException {</span>
256         MetadataReader r = new MetadataReader(input);
257         return r.getDescriptor();
258     }
259 
260     static void write(List&lt;Type&gt; types, DataOutput output) throws IOException {
261         MetadataDescriptor m = new MetadataDescriptor();
262         m.locale = Locale.getDefault().toString();
263         m.gmtOffset = TimeZone.getDefault().getRawOffset();
264         m.types.addAll(types);
265         MetadataWriter w = new MetadataWriter(m);
266         w.writeBinary(output);
267     }
268 
269     @Override
270     public String toString() {
271         return root.toString();
272     }
273 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.jfr.internal;
 27 

 28 import java.io.DataOutput;
 29 import java.io.IOException;
 30 import java.util.ArrayList;
 31 import java.util.Collection;
 32 import java.util.List;
 33 import java.util.Locale;
 34 import java.util.TimeZone;
 35 
 36 import jdk.jfr.EventType;
<span class="line-added"> 37 import jdk.jfr.internal.consumer.RecordingInput;</span>
 38 
 39 /**
 40  * Metadata about a chunk
 41  */
 42 public final class MetadataDescriptor {
 43 
 44     static final class Attribute {
 45         final String name;
 46         final String value;
 47 
 48         private Attribute(String name, String value) {
 49             this.name = name;
 50             this.value = value;
 51         }
 52     }
 53 
 54     static final class Element {
 55         final String name;
 56         final List&lt;Element&gt; elements = new ArrayList&lt;&gt;();
 57         final List&lt;Attribute&gt; attributes = new ArrayList&lt;&gt;();
</pre>
<hr />
<pre>
197     static final String ATTRIBUTE_ID = &quot;id&quot;;
198     static final String ATTRIBUTE_SIMPLE_TYPE = &quot;simpleType&quot;;
199     static final String ATTRIBUTE_GMT_OFFSET = &quot;gmtOffset&quot;;
200     static final String ATTRIBUTE_LOCALE = &quot;locale&quot;;
201     static final String ELEMENT_TYPE = &quot;class&quot;;
202     static final String ELEMENT_SETTING = &quot;setting&quot;;
203     static final String ELEMENT_ANNOTATION = &quot;annotation&quot;;
204     static final String ELEMENT_FIELD = &quot;field&quot;;
205     static final String ATTRIBUTE_SUPER_TYPE = &quot;superType&quot;;
206     static final String ATTRIBUTE_TYPE_ID = &quot;class&quot;;
207     static final String ATTRIBUTE_DIMENSION = &quot;dimension&quot;;
208     static final String ATTRIBUTE_NAME = &quot;name&quot;;
209     static final String ATTRIBUTE_CONSTANT_POOL = &quot;constantPool&quot;;
210     static final String ATTRIBUTE_DEFAULT_VALUE = &quot;defaultValue&quot;;
211 
212     final List&lt;EventType&gt; eventTypes = new ArrayList&lt;&gt;();
213     final Collection&lt;Type&gt; types = new ArrayList&lt;&gt;();
214     long gmtOffset;
215     String locale;
216     Element root;
<span class="line-added">217     public long metadataId;</span>
218 
219     // package private
220     MetadataDescriptor() {
221     }
222 
223     private static void prettyPrintXML(Appendable sb, String indent, Element e) throws IOException {
224         sb.append(indent + &quot;&lt;&quot; + e.name);
225         for (Attribute a : e.attributes) {
226             sb.append(&quot; &quot;).append(a.name).append(&quot;=\&quot;&quot;).append(a.value).append(&quot;\&quot;&quot;);
227         }
228         if (e.elements.size() == 0) {
229             sb.append(&quot;/&quot;);
230         }
231         sb.append(&quot;&gt;\n&quot;);
232         for (Element child : e.elements) {
233             prettyPrintXML(sb, indent + &quot;  &quot;, child);
234         }
235         if (e.elements.size() != 0) {
236             sb.append(indent).append(&quot;&lt;/&quot;).append(e.name).append(&quot;&gt;\n&quot;);
237         }
238     }
239 
240     public Collection&lt;Type&gt; getTypes() {
241         return types;
242     }
243 
244     public List&lt;EventType&gt; getEventTypes() {
245         return eventTypes;
246     }
247 
248     public int getGMTOffset() {
249         return (int) gmtOffset;
250     }
251 
252     public String getLocale() {
253         return locale;
254     }
255 
<span class="line-modified">256     public static MetadataDescriptor read(RecordingInput input) throws IOException {</span>
257         MetadataReader r = new MetadataReader(input);
258         return r.getDescriptor();
259     }
260 
261     static void write(List&lt;Type&gt; types, DataOutput output) throws IOException {
262         MetadataDescriptor m = new MetadataDescriptor();
263         m.locale = Locale.getDefault().toString();
264         m.gmtOffset = TimeZone.getDefault().getRawOffset();
265         m.types.addAll(types);
266         MetadataWriter w = new MetadataWriter(m);
267         w.writeBinary(output);
268     }
269 
270     @Override
271     public String toString() {
272         return root.toString();
273     }
274 }
</pre>
</td>
</tr>
</table>
<center><a href="LogTag.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="MetadataReader.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>