<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.jfr/share/classes/jdk/jfr/internal/dcmd/DCmdDump.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DCmdConfigure.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DCmdStart.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jfr/share/classes/jdk/jfr/internal/dcmd/DCmdDump.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -24,10 +24,12 @@</span>
   */
  package jdk.jfr.internal.dcmd;
  
  import java.io.IOException;
  import java.nio.file.InvalidPathException;
<span class="udiff-line-added">+ import java.nio.file.Path;</span>
<span class="udiff-line-added">+ import java.nio.file.Paths;</span>
  import java.time.Duration;
  import java.time.Instant;
  import java.time.LocalDate;
  import java.time.LocalDateTime;
  import java.time.LocalTime;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -124,30 +126,41 @@</span>
          Recording recording = null;
          if (name != null) {
              recording = findRecording(name);
          }
          PlatformRecorder recorder = PrivateAccess.getInstance().getPlatformRecorder();
<span class="udiff-line-modified-removed">-         synchronized (recorder) {</span>
<span class="udiff-line-modified-removed">-             dump(recorder, recording, name, filename, maxSize, pathToGcRoots, beginTime, endTime);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-added">+             synchronized (recorder) {</span>
<span class="udiff-line-added">+                 dump(recorder, recording, name, filename, maxSize, pathToGcRoots, beginTime, endTime);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         } catch (IOException | InvalidPathException e) {</span>
<span class="udiff-line-added">+             throw new DCmdException(&quot;Dump failed. Could not copy recording data. %s&quot;, e.getMessage());</span>
          }
          return getResult();
      }
  
<span class="udiff-line-modified-removed">-     public void dump(PlatformRecorder recorder, Recording recording, String name, String filename, Long maxSize, Boolean pathToGcRoots, Instant beginTime, Instant endTime) throws DCmdException {</span>
<span class="udiff-line-modified-added">+     public void dump(PlatformRecorder recorder, Recording recording, String name, String filename, Long maxSize, Boolean pathToGcRoots, Instant beginTime, Instant endTime) throws DCmdException, IOException {</span>
          try (PlatformRecording r = newSnapShot(recorder, recording, pathToGcRoots)) {
              r.filter(beginTime, endTime, maxSize);
              if (r.getChunks().isEmpty()) {
                  throw new DCmdException(&quot;Dump failed. No data found in the specified interval.&quot;);
              }
<span class="udiff-line-modified-removed">-             SafePath dumpFile = resolvePath(recording, filename);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-             // Needed for JVM</span>
<span class="udiff-line-modified-removed">-             Utils.touch(dumpFile.toPath());</span>
<span class="udiff-line-modified-removed">-             r.dumpStopped(new WriteableUserPath(dumpFile.toPath()));</span>
<span class="udiff-line-modified-removed">-             reportOperationComplete(&quot;Dumped&quot;, name, dumpFile);</span>
<span class="udiff-line-modified-removed">-         } catch (IOException | InvalidPathException e) {</span>
<span class="udiff-line-modified-removed">-             throw new DCmdException(&quot;Dump failed. Could not copy recording data. %s&quot;, e.getMessage());</span>
<span class="udiff-line-modified-added">+             // If a filename exist, use it</span>
<span class="udiff-line-modified-added">+             // if a filename doesn&#39;t exist, use destination set earlier</span>
<span class="udiff-line-modified-added">+             // if destination doesn&#39;t exist, generate a filename</span>
<span class="udiff-line-modified-added">+             WriteableUserPath wup = null;</span>
<span class="udiff-line-modified-added">+             if (recording != null) {</span>
<span class="udiff-line-modified-added">+                 PlatformRecording pRecording = PrivateAccess.getInstance().getPlatformRecording(recording);</span>
<span class="udiff-line-modified-added">+                 wup = pRecording.getDestination();</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-added">+             if (filename != null || (filename == null &amp;&amp; wup == null) ) {</span>
<span class="udiff-line-added">+                 SafePath safe = resolvePath(recording, filename);</span>
<span class="udiff-line-added">+                 wup = new WriteableUserPath(safe.toPath());</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+             r.dumpStopped(wup);</span>
<span class="udiff-line-added">+             reportOperationComplete(&quot;Dumped&quot;, name, new SafePath(wup.getRealPathText()));</span>
          }
      }
  
      private Instant parseTime(String time, String parameter) throws DCmdException {
          if (time == null) {
</pre>
<center><a href="DCmdConfigure.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="DCmdStart.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>