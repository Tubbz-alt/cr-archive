<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.charsets/share/classes/sun/nio/cs/ext/ExtendedCharsets.java.template</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../jdk.attach/windows/classes/sun/tools/attach/VirtualMachineImpl.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../jdk.compiler/share/classes/com/sun/source/doctree/package-info.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.charsets/share/classes/sun/nio/cs/ext/ExtendedCharsets.java.template</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.</span>
   *
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   *
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
</pre>
<hr />
<pre>
<span class="line-old-header">*** 27,15 ***</span>
  
  // -- This file was mechanically generated: Do not edit! -- //
  
  package sun.nio.cs.ext;
  
<span class="line-removed">- import java.lang.ref.SoftReference;</span>
  import java.nio.charset.Charset;
  import java.nio.charset.spi.CharsetProvider;
<span class="line-removed">- import java.security.AccessController;</span>
<span class="line-removed">- import java.security.PrivilegedAction;</span>
  
  /**
   * Provider for extended charsets.
   */
  
<span class="line-new-header">--- 27,12 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 51,192 ***</span>
  
          instance = this;
  
      }
  
<span class="line-removed">-     private boolean initialized = false;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     // If the sun.nio.cs.map property is defined on the command line we won&#39;t</span>
<span class="line-removed">-     // see it in the system-properties table until after the charset subsystem</span>
<span class="line-removed">-     // has been initialized.  We therefore delay the effect of this property</span>
<span class="line-removed">-     // until after the JRE has completely booted.</span>
<span class="line-removed">-     //</span>
<span class="line-removed">-     // At the moment following values for this property are supported, property</span>
<span class="line-removed">-     // value string is case insensitive.</span>
<span class="line-removed">-     //</span>
<span class="line-removed">-     // (1)&quot;Windows-31J/Shift_JIS&quot;</span>
<span class="line-removed">-     // In 1.4.1 we added a correct implementation of the Shift_JIS charset</span>
<span class="line-removed">-     // but in previous releases this charset name had been treated as an alias</span>
<span class="line-removed">-     // for Windows-31J, aka MS932. Users who have existing code that depends</span>
<span class="line-removed">-     // upon this alias can restore the previous behavior by defining this</span>
<span class="line-removed">-     // property to have this value.</span>
<span class="line-removed">-     //</span>
<span class="line-removed">-     // (2)&quot;x-windows-50221/ISO-2022-JP&quot;</span>
<span class="line-removed">-     //    &quot;x-windows-50220/ISO-2022-JP&quot;</span>
<span class="line-removed">-     //    &quot;x-windows-iso2022jp/ISO-2022-JP&quot;</span>
<span class="line-removed">-     // The charset ISO-2022-JP is a &quot;standard based&quot; implementation by default,</span>
<span class="line-removed">-     // which supports ASCII, JIS_X_0201 and JIS_X_0208 mappings based encoding</span>
<span class="line-removed">-     // and decoding only.</span>
<span class="line-removed">-     // There are three Microsoft iso-2022-jp variants, namely x-windows-50220,</span>
<span class="line-removed">-     // x-windows-50221 and x-windows-iso2022jp which behaves &quot;slightly&quot; differently</span>
<span class="line-removed">-     // compared to the &quot;standard based&quot; implementation. See ISO2022_JP.java for</span>
<span class="line-removed">-     // detailed description. Users who prefer the behavior of MS iso-2022-jp</span>
<span class="line-removed">-     // variants should use these names explicitly instead of using &quot;ISO-2022-JP&quot;</span>
<span class="line-removed">-     // and its aliases. However for those who need the ISO-2022-JP charset behaves</span>
<span class="line-removed">-     // exactly the same as MS variants do, above properties can be defined to</span>
<span class="line-removed">-     // switch.</span>
<span class="line-removed">-     //</span>
<span class="line-removed">-     // If we need to define other charset-alias mappings in the future then</span>
<span class="line-removed">-     // this property could be further extended, the general idea being that its</span>
<span class="line-removed">-     // value should be of the form</span>
<span class="line-removed">-     //</span>
<span class="line-removed">-     //     new-charset-1/old-charset-1,new-charset-2/old-charset-2,...</span>
<span class="line-removed">-     //</span>
<span class="line-removed">-     // where each charset named to the left of a slash is intended to replace</span>
<span class="line-removed">-     // (most) uses of the charset named to the right of the slash.</span>
<span class="line-removed">-     //</span>
<span class="line-removed">-     protected void init() {</span>
<span class="line-removed">-         if (initialized)</span>
<span class="line-removed">-             return;</span>
<span class="line-removed">-         if (!jdk.internal.misc.VM.isBooted())</span>
<span class="line-removed">-             return;</span>
<span class="line-removed">- </span>
<span class="line-removed">-         String map = getProperty(&quot;sun.nio.cs.map&quot;);</span>
<span class="line-removed">-         boolean sjisIsMS932 = false;</span>
<span class="line-removed">-         boolean iso2022jpIsMS50221 = false;</span>
<span class="line-removed">-         boolean iso2022jpIsMS50220 = false;</span>
<span class="line-removed">-         boolean iso2022jpIsMSISO2022JP = false;</span>
<span class="line-removed">-         if (map != null) {</span>
<span class="line-removed">-             String[] maps = map.split(&quot;,&quot;);</span>
<span class="line-removed">-             for (int i = 0; i &lt; maps.length; i++) {</span>
<span class="line-removed">-                 if (maps[i].equalsIgnoreCase(&quot;Windows-31J/Shift_JIS&quot;)) {</span>
<span class="line-removed">-                     sjisIsMS932 = true;</span>
<span class="line-removed">-                 } else if (maps[i].equalsIgnoreCase(&quot;x-windows-50221/ISO-2022-JP&quot;)) {</span>
<span class="line-removed">-                     iso2022jpIsMS50221 = true;</span>
<span class="line-removed">-                 } else if (maps[i].equalsIgnoreCase(&quot;x-windows-50220/ISO-2022-JP&quot;)) {</span>
<span class="line-removed">-                     iso2022jpIsMS50220 = true;</span>
<span class="line-removed">-                 } else if (maps[i].equalsIgnoreCase(&quot;x-windows-iso2022jp/ISO-2022-JP&quot;)) {</span>
<span class="line-removed">-                     iso2022jpIsMSISO2022JP = true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-         if (sjisIsMS932 &amp;&amp; hasCharset(&quot;Shift_JIS&quot;)) {</span>
<span class="line-removed">-             deleteCharset(&quot;Shift_JIS&quot;,</span>
<span class="line-removed">-                           new String[] {</span>
<span class="line-removed">-                               // IANA aliases</span>
<span class="line-removed">-                               &quot;sjis&quot;, // historical</span>
<span class="line-removed">-                               &quot;shift_jis&quot;,</span>
<span class="line-removed">-                               &quot;shift-jis&quot;,</span>
<span class="line-removed">-                               &quot;ms_kanji&quot;,</span>
<span class="line-removed">-                               &quot;x-sjis&quot;,</span>
<span class="line-removed">-                               &quot;csShiftJIS&quot;</span>
<span class="line-removed">-                           });</span>
<span class="line-removed">-             deleteCharset(&quot;windows-31j&quot;,</span>
<span class="line-removed">-                           new String[] {</span>
<span class="line-removed">-                               &quot;MS932&quot;, // JDK historical</span>
<span class="line-removed">-                               &quot;windows-932&quot;,</span>
<span class="line-removed">-                               &quot;csWindows31J&quot;</span>
<span class="line-removed">-                           });</span>
<span class="line-removed">-             charset(&quot;Shift_JIS&quot;, &quot;SJIS&quot;,</span>
<span class="line-removed">-                     new String[] {</span>
<span class="line-removed">-                         // IANA aliases</span>
<span class="line-removed">-                         &quot;sjis&quot;          // JDK historical</span>
<span class="line-removed">-                     });</span>
<span class="line-removed">-             charset(&quot;windows-31j&quot;, &quot;MS932&quot;,</span>
<span class="line-removed">-                     new String[] {</span>
<span class="line-removed">-                         &quot;MS932&quot;,        // JDK historical</span>
<span class="line-removed">-                         &quot;windows-932&quot;,</span>
<span class="line-removed">-                         &quot;csWindows31J&quot;,</span>
<span class="line-removed">-                         &quot;shift-jis&quot;,</span>
<span class="line-removed">-                         &quot;ms_kanji&quot;,</span>
<span class="line-removed">-                         &quot;x-sjis&quot;,</span>
<span class="line-removed">-                         &quot;csShiftJIS&quot;,</span>
<span class="line-removed">-                         // This alias takes precedence over the actual</span>
<span class="line-removed">-                         // Shift_JIS charset itself since aliases are always</span>
<span class="line-removed">-                         // resolved first, before looking up canonical names.</span>
<span class="line-removed">-                         &quot;shift_jis&quot;</span>
<span class="line-removed">-                     });</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-         if (iso2022jpIsMS50221 ||</span>
<span class="line-removed">-             iso2022jpIsMS50220 ||</span>
<span class="line-removed">-             iso2022jpIsMSISO2022JP) {</span>
<span class="line-removed">-             deleteCharset(&quot;ISO-2022-JP&quot;,</span>
<span class="line-removed">-                           new String[] {</span>
<span class="line-removed">-                               &quot;iso2022jp&quot;,</span>
<span class="line-removed">-                                 &quot;jis&quot;,</span>
<span class="line-removed">-                                 &quot;csISO2022JP&quot;,</span>
<span class="line-removed">-                                 &quot;jis_encoding&quot;,</span>
<span class="line-removed">-                                 &quot;csjisencoding&quot;</span>
<span class="line-removed">-                           });</span>
<span class="line-removed">-             if (iso2022jpIsMS50221) {</span>
<span class="line-removed">-                 deleteCharset(&quot;x-windows-50221&quot;,</span>
<span class="line-removed">-                               new String[] {</span>
<span class="line-removed">-                                   &quot;cp50221&quot;,</span>
<span class="line-removed">-                                   &quot;ms50221&quot;</span>
<span class="line-removed">-                               });</span>
<span class="line-removed">-                 charset(&quot;x-windows-50221&quot;, &quot;MS50221&quot;,</span>
<span class="line-removed">-                         new String[] {</span>
<span class="line-removed">-                             &quot;cp50221&quot;,</span>
<span class="line-removed">-                             &quot;ms50221&quot;,</span>
<span class="line-removed">-                             &quot;iso-2022-jp&quot;,</span>
<span class="line-removed">-                             &quot;iso2022jp&quot;,</span>
<span class="line-removed">-                             &quot;jis&quot;,</span>
<span class="line-removed">-                             &quot;csISO2022JP&quot;,</span>
<span class="line-removed">-                             &quot;jis_encoding&quot;,</span>
<span class="line-removed">-                             &quot;csjisencoding&quot;</span>
<span class="line-removed">-                         });</span>
<span class="line-removed">-             } else if (iso2022jpIsMS50220) {</span>
<span class="line-removed">-                 deleteCharset(&quot;x-windows-50220&quot;,</span>
<span class="line-removed">-                               new String[] {</span>
<span class="line-removed">-                                   &quot;cp50220&quot;,</span>
<span class="line-removed">-                                   &quot;ms50220&quot;</span>
<span class="line-removed">-                               });</span>
<span class="line-removed">-                 charset(&quot;x-windows-50220&quot;, &quot;MS50220&quot;,</span>
<span class="line-removed">-                         new String[] {</span>
<span class="line-removed">-                             &quot;cp50220&quot;,</span>
<span class="line-removed">-                             &quot;ms50220&quot;,</span>
<span class="line-removed">-                             &quot;iso-2022-jp&quot;,</span>
<span class="line-removed">-                             &quot;iso2022jp&quot;,</span>
<span class="line-removed">-                             &quot;jis&quot;,</span>
<span class="line-removed">-                             &quot;csISO2022JP&quot;,</span>
<span class="line-removed">-                             &quot;jis_encoding&quot;,</span>
<span class="line-removed">-                             &quot;csjisencoding&quot;</span>
<span class="line-removed">-                         });</span>
<span class="line-removed">-             } else {</span>
<span class="line-removed">-                 deleteCharset(&quot;x-windows-iso2022jp&quot;,</span>
<span class="line-removed">-                               new String[] {</span>
<span class="line-removed">-                                   &quot;windows-iso2022jp&quot;</span>
<span class="line-removed">-                               });</span>
<span class="line-removed">-                 charset(&quot;x-windows-iso2022jp&quot;, &quot;MSISO2022JP&quot;,</span>
<span class="line-removed">-                         new String[] {</span>
<span class="line-removed">-                             &quot;windows-iso2022jp&quot;,</span>
<span class="line-removed">-                             &quot;iso-2022-jp&quot;,</span>
<span class="line-removed">-                             &quot;iso2022jp&quot;,</span>
<span class="line-removed">-                             &quot;jis&quot;,</span>
<span class="line-removed">-                             &quot;csISO2022JP&quot;,</span>
<span class="line-removed">-                             &quot;jis_encoding&quot;,</span>
<span class="line-removed">-                             &quot;csjisencoding&quot;</span>
<span class="line-removed">-                         });</span>
<span class="line-removed">- </span>
<span class="line-removed">- </span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-         initialized = true;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     private static String getProperty(String key) {</span>
<span class="line-removed">-         // this method may be called during initialization of</span>
<span class="line-removed">-         // system class loader and thus not using lambda</span>
<span class="line-removed">-         return AccessController.doPrivileged(</span>
<span class="line-removed">-             new PrivilegedAction&lt;String&gt;() {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public String run() {</span>
<span class="line-removed">-                     return System.getProperty(key);</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             });</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
      public static String[] aliasesFor(String charsetName) {
          if (instance == null)
              return null;
          return instance.aliases(charsetName);
      }
<span class="line-new-header">--- 48,10 ---</span>
</pre>
<center><a href="../../../../../../../jdk.attach/windows/classes/sun/tools/attach/VirtualMachineImpl.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../jdk.compiler/share/classes/com/sun/source/doctree/package-info.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>