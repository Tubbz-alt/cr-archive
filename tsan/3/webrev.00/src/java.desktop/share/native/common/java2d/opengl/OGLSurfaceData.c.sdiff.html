<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/native/common/java2d/opengl/OGLSurfaceData.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="OGLRenderQueue.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="OGLSurfaceData.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/common/java2d/opengl/OGLSurfaceData.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2003, 2012, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #ifndef HEADLESS
 27 
 28 #include &lt;stdlib.h&gt;
 29 
 30 #include &quot;sun_java2d_opengl_OGLSurfaceData.h&quot;
 31 
 32 #include &quot;jlong.h&quot;
 33 #include &quot;jni_util.h&quot;
 34 #include &quot;OGLSurfaceData.h&quot;
 35 
 36 /**
 37  * The following methods are implemented in the windowing system (i.e. GLX
 38  * and WGL) source files.
 39  */
<span class="line-removed"> 40 extern jlong OGLSD_GetNativeConfigInfo(OGLSDOps *oglsdo);</span>
 41 extern jboolean OGLSD_InitOGLWindow(JNIEnv *env, OGLSDOps *oglsdo);
 42 extern void OGLSD_DestroyOGLSurface(JNIEnv *env, OGLSDOps *oglsdo);
 43 
 44 void OGLSD_SetNativeDimensions(JNIEnv *env, OGLSDOps *oglsdo, jint w, jint h);
 45 
 46 /**
 47  * This table contains the &quot;pixel formats&quot; for all system memory surfaces
 48  * that OpenGL is capable of handling, indexed by the &quot;PF_&quot; constants defined
 49  * in OGLSurfaceData.java.  These pixel formats contain information that is
 50  * passed to OpenGL when copying from a system memory (&quot;Sw&quot;) surface to
 51  * an OpenGL &quot;Surface&quot; (via glDrawPixels()) or &quot;Texture&quot; (via glTexImage2D()).
 52  */
 53 OGLPixelFormat PixelFormats[] = {
 54     { GL_BGRA, GL_UNSIGNED_INT_8_8_8_8_REV,
 55       4, 1, 0,                                     }, /* 0 - IntArgb      */
 56     { GL_BGRA, GL_UNSIGNED_INT_8_8_8_8_REV,
 57       4, 1, 1,                                     }, /* 1 - IntArgbPre   */
 58     { GL_BGRA, GL_UNSIGNED_INT_8_8_8_8_REV,
 59       4, 0, 1,                                     }, /* 2 - IntRgb       */
 60     { GL_RGBA, GL_UNSIGNED_INT_8_8_8_8,
</pre>
<hr />
<pre>
576         if (oglsdo-&gt;fbobjectID != 0) {
577             j2d_glDeleteFramebuffersEXT(1, &amp;oglsdo-&gt;fbobjectID);
578             oglsdo-&gt;fbobjectID = 0;
579         }
580     } else {
581         // dispose windowing system resources (pbuffer, pixmap, etc)
582         OGLSD_DestroyOGLSurface(env, oglsdo);
583     }
584 }
585 
586 /**
587  * This is the implementation of the general DisposeFunc defined in
588  * SurfaceData.h and used by the Disposer mechanism.  It first flushes all
589  * native OpenGL resources and then frees any memory allocated within the
590  * native OGLSDOps structure.
591  */
592 void
593 OGLSD_Dispose(JNIEnv *env, SurfaceDataOps *ops)
594 {
595     OGLSDOps *oglsdo = (OGLSDOps *)ops;
<span class="line-modified">596     jlong pConfigInfo = OGLSD_GetNativeConfigInfo(oglsdo);</span>
597 
598     JNU_CallStaticMethodByName(env, NULL, &quot;sun/java2d/opengl/OGLSurfaceData&quot;,
<span class="line-modified">599                                &quot;dispose&quot;, &quot;(JJ)V&quot;,</span>
<span class="line-modified">600                                ptr_to_jlong(ops), pConfigInfo);</span>



601 }
602 
603 /**
604  * This is the implementation of the general surface LockFunc defined in
605  * SurfaceData.h.
606  */
607 jint
608 OGLSD_Lock(JNIEnv *env,
609            SurfaceDataOps *ops,
610            SurfaceDataRasInfo *pRasInfo,
611            jint lockflags)
612 {
613     JNU_ThrowInternalError(env, &quot;OGLSD_Lock not implemented!&quot;);
614     return SD_FAILURE;
615 }
616 
617 /**
618  * This is the implementation of the general GetRasInfoFunc defined in
619  * SurfaceData.h.
620  */
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #ifndef HEADLESS
 27 
 28 #include &lt;stdlib.h&gt;
 29 
 30 #include &quot;sun_java2d_opengl_OGLSurfaceData.h&quot;
 31 
 32 #include &quot;jlong.h&quot;
 33 #include &quot;jni_util.h&quot;
 34 #include &quot;OGLSurfaceData.h&quot;
 35 
 36 /**
 37  * The following methods are implemented in the windowing system (i.e. GLX
 38  * and WGL) source files.
 39  */

 40 extern jboolean OGLSD_InitOGLWindow(JNIEnv *env, OGLSDOps *oglsdo);
 41 extern void OGLSD_DestroyOGLSurface(JNIEnv *env, OGLSDOps *oglsdo);
 42 
 43 void OGLSD_SetNativeDimensions(JNIEnv *env, OGLSDOps *oglsdo, jint w, jint h);
 44 
 45 /**
 46  * This table contains the &quot;pixel formats&quot; for all system memory surfaces
 47  * that OpenGL is capable of handling, indexed by the &quot;PF_&quot; constants defined
 48  * in OGLSurfaceData.java.  These pixel formats contain information that is
 49  * passed to OpenGL when copying from a system memory (&quot;Sw&quot;) surface to
 50  * an OpenGL &quot;Surface&quot; (via glDrawPixels()) or &quot;Texture&quot; (via glTexImage2D()).
 51  */
 52 OGLPixelFormat PixelFormats[] = {
 53     { GL_BGRA, GL_UNSIGNED_INT_8_8_8_8_REV,
 54       4, 1, 0,                                     }, /* 0 - IntArgb      */
 55     { GL_BGRA, GL_UNSIGNED_INT_8_8_8_8_REV,
 56       4, 1, 1,                                     }, /* 1 - IntArgbPre   */
 57     { GL_BGRA, GL_UNSIGNED_INT_8_8_8_8_REV,
 58       4, 0, 1,                                     }, /* 2 - IntRgb       */
 59     { GL_RGBA, GL_UNSIGNED_INT_8_8_8_8,
</pre>
<hr />
<pre>
575         if (oglsdo-&gt;fbobjectID != 0) {
576             j2d_glDeleteFramebuffersEXT(1, &amp;oglsdo-&gt;fbobjectID);
577             oglsdo-&gt;fbobjectID = 0;
578         }
579     } else {
580         // dispose windowing system resources (pbuffer, pixmap, etc)
581         OGLSD_DestroyOGLSurface(env, oglsdo);
582     }
583 }
584 
585 /**
586  * This is the implementation of the general DisposeFunc defined in
587  * SurfaceData.h and used by the Disposer mechanism.  It first flushes all
588  * native OpenGL resources and then frees any memory allocated within the
589  * native OGLSDOps structure.
590  */
591 void
592 OGLSD_Dispose(JNIEnv *env, SurfaceDataOps *ops)
593 {
594     OGLSDOps *oglsdo = (OGLSDOps *)ops;
<span class="line-modified">595     jobject graphicsConfig = oglsdo-&gt;graphicsConfig;</span>
596 
597     JNU_CallStaticMethodByName(env, NULL, &quot;sun/java2d/opengl/OGLSurfaceData&quot;,
<span class="line-modified">598                                &quot;dispose&quot;,</span>
<span class="line-modified">599                                &quot;(JLsun/java2d/opengl/OGLGraphicsConfig;)V&quot;,</span>
<span class="line-added">600                                ptr_to_jlong(ops), graphicsConfig);</span>
<span class="line-added">601     (*env)-&gt;DeleteGlobalRef(env, graphicsConfig);</span>
<span class="line-added">602     oglsdo-&gt;graphicsConfig = NULL;</span>
603 }
604 
605 /**
606  * This is the implementation of the general surface LockFunc defined in
607  * SurfaceData.h.
608  */
609 jint
610 OGLSD_Lock(JNIEnv *env,
611            SurfaceDataOps *ops,
612            SurfaceDataRasInfo *pRasInfo,
613            jint lockflags)
614 {
615     JNU_ThrowInternalError(env, &quot;OGLSD_Lock not implemented!&quot;);
616     return SD_FAILURE;
617 }
618 
619 /**
620  * This is the implementation of the general GetRasInfoFunc defined in
621  * SurfaceData.h.
622  */
</pre>
</td>
</tr>
</table>
<center><a href="OGLRenderQueue.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="OGLSurfaceData.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>