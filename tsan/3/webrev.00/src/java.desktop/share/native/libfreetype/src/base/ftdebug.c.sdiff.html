<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/native/libfreetype/src/base/ftdebug.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ftdbgmem.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ftfntfmt.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/base/ftdebug.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
<span class="line-modified">  1 /***************************************************************************/</span>
<span class="line-modified">  2 /*                                                                         */</span>
<span class="line-modified">  3 /*  ftdebug.c                                                              */</span>
<span class="line-modified">  4 /*                                                                         */</span>
<span class="line-modified">  5 /*    Debugging and logging component (body).                              */</span>
<span class="line-modified">  6 /*                                                                         */</span>
<span class="line-modified">  7 /*  Copyright 1996-2018 by                                                 */</span>
<span class="line-modified">  8 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="line-modified">  9 /*                                                                         */</span>
<span class="line-modified"> 10 /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified"> 11 /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified"> 12 /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified"> 13 /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified"> 14 /*  understand and accept it fully.                                        */</span>
<span class="line-modified"> 15 /*                                                                         */</span>
<span class="line-modified"> 16 /***************************************************************************/</span>
<span class="line-modified"> 17 </span>
<span class="line-modified"> 18 </span>
<span class="line-modified"> 19   /*************************************************************************/</span>
<span class="line-modified"> 20   /*                                                                       */</span>
<span class="line-modified"> 21   /* This component contains various macros and functions used to ease the */</span>
<span class="line-modified"> 22   /* debugging of the FreeType engine.  Its main purpose is in assertion   */</span>
<span class="line-modified"> 23   /* checking, tracing, and error detection.                               */</span>
<span class="line-modified"> 24   /*                                                                       */</span>
<span class="line-modified"> 25   /* There are now three debugging modes:                                  */</span>
<span class="line-modified"> 26   /*                                                                       */</span>
<span class="line-modified"> 27   /* - trace mode                                                          */</span>
<span class="line-modified"> 28   /*                                                                       */</span>
<span class="line-modified"> 29   /*   Error and trace messages are sent to the log file (which can be the */</span>
<span class="line-modified"> 30   /*   standard error output).                                             */</span>
<span class="line-modified"> 31   /*                                                                       */</span>
<span class="line-modified"> 32   /* - error mode                                                          */</span>
<span class="line-modified"> 33   /*                                                                       */</span>
<span class="line-modified"> 34   /*   Only error messages are generated.                                  */</span>
<span class="line-modified"> 35   /*                                                                       */</span>
<span class="line-modified"> 36   /* - release mode:                                                       */</span>
<span class="line-modified"> 37   /*                                                                       */</span>
<span class="line-modified"> 38   /*   No error message is sent or generated.  The code is free from any   */</span>
<span class="line-modified"> 39   /*   debugging parts.                                                    */</span>
<span class="line-modified"> 40   /*                                                                       */</span>
<span class="line-modified"> 41   /*************************************************************************/</span>
 42 
 43 
 44 #include &lt;ft2build.h&gt;
 45 #include FT_FREETYPE_H
 46 #include FT_INTERNAL_DEBUG_H
 47 
 48 
 49 #ifdef FT_DEBUG_LEVEL_ERROR
 50 
 51   /* documentation is in ftdebug.h */
 52 
 53   FT_BASE_DEF( void )
 54   FT_Message( const char*  fmt,
 55               ... )
 56   {
 57     va_list  ap;
 58 
 59 
 60     va_start( ap, fmt );
 61     vfprintf( stderr, fmt, ap );
</pre>
<hr />
<pre>
 70             ... )
 71   {
 72     va_list  ap;
 73 
 74 
 75     va_start( ap, fmt );
 76     vfprintf( stderr, fmt, ap );
 77     va_end( ap );
 78 
 79     exit( EXIT_FAILURE );
 80   }
 81 
 82 
 83   /* documentation is in ftdebug.h */
 84 
 85   FT_BASE_DEF( int )
 86   FT_Throw( FT_Error     error,
 87             int          line,
 88             const char*  file )
 89   {









 90     FT_UNUSED( error );
 91     FT_UNUSED( line );
 92     FT_UNUSED( file );

 93 
 94     return 0;
 95   }
 96 
 97 #endif /* FT_DEBUG_LEVEL_ERROR */
 98 
 99 
100 
101 #ifdef FT_DEBUG_LEVEL_TRACE
102 
<span class="line-modified">103   /* array of trace levels, initialized to 0 */</span>
<span class="line-modified">104   int  ft_trace_levels[trace_count];</span>

105 






106 
107   /* define array of trace toggle names */
108 #define FT_TRACE_DEF( x )  #x ,
109 
110   static const char*  ft_trace_toggles[trace_count + 1] =
111   {
112 #include FT_INTERNAL_TRACE_H
113     NULL
114   };
115 
116 #undef FT_TRACE_DEF
117 
118 
119   /* documentation is in ftdebug.h */
120 
121   FT_BASE_DEF( FT_Int )
122   FT_Trace_Get_Count( void )
123   {
124     return trace_count;
125   }
126 
127 
128   /* documentation is in ftdebug.h */
129 
130   FT_BASE_DEF( const char * )
131   FT_Trace_Get_Name( FT_Int  idx )
132   {
133     int  max = FT_Trace_Get_Count();
134 
135 
136     if ( idx &lt; max )
137       return ft_trace_toggles[idx];
138     else
139       return NULL;
140   }
141 
142 
<span class="line-modified">143   /*************************************************************************/</span>
<span class="line-modified">144   /*                                                                       */</span>
<span class="line-modified">145   /* Initialize the tracing sub-system.  This is done by retrieving the    */</span>
<span class="line-modified">146   /* value of the `FT2_DEBUG&#39; environment variable.  It must be a list of  */</span>
<span class="line-modified">147   /* toggles, separated by spaces, `;&#39;, or `,&#39;.  Example:                  */</span>
<span class="line-modified">148   /*                                                                       */</span>
<span class="line-modified">149   /*    export FT2_DEBUG=&quot;any:3 memory:7 stream:5&quot;                         */</span>
<span class="line-modified">150   /*                                                                       */</span>
<span class="line-modified">151   /* This requests that all levels be set to 3, except the trace level for */</span>
<span class="line-modified">152   /* the memory and stream components which are set to 7 and 5,            */</span>
<span class="line-modified">153   /* respectively.                                                         */</span>
<span class="line-modified">154   /*                                                                       */</span>
<span class="line-modified">155   /* See the file `include/freetype/internal/fttrace.h&#39; for details of     */</span>
<span class="line-modified">156   /* the available toggle names.                                           */</span>
<span class="line-modified">157   /*                                                                       */</span>
<span class="line-modified">158   /* The level must be between 0 and 7; 0 means quiet (except for serious  */</span>
<span class="line-modified">159   /* runtime errors), and 7 means _very_ verbose.                          */</span>
<span class="line-modified">160   /*                                                                       */</span>


















161   FT_BASE_DEF( void )
162   ft_debug_init( void )
163   {
164     const char*  ft2_debug = ft_getenv( &quot;FT2_DEBUG&quot; );
165 
166 
167     if ( ft2_debug )
168     {
169       const char*  p = ft2_debug;
170       const char*  q;
171 
172 
173       for ( ; *p; p++ )
174       {
175         /* skip leading whitespace and separators */
176         if ( *p == &#39; &#39; || *p == &#39;\t&#39; || *p == &#39;,&#39; || *p == &#39;;&#39; || *p == &#39;=&#39; )
177           continue;
178 
179         /* read toggle name, followed by &#39;:&#39; */
180         q = p;
</pre>
<hr />
<pre>
206               found = n;
207               break;
208             }
209           }
210 
211           /* read level */
212           p++;
213           if ( *p )
214           {
215             level = *p - &#39;0&#39;;
216             if ( level &lt; 0 || level &gt; 7 )
217               level = -1;
218           }
219 
220           if ( found &gt;= 0 &amp;&amp; level &gt;= 0 )
221           {
222             if ( found == trace_any )
223             {
224               /* special case for `any&#39; */
225               for ( n = 0; n &lt; trace_count; n++ )
<span class="line-modified">226                 ft_trace_levels[n] = level;</span>
227             }
228             else
<span class="line-modified">229               ft_trace_levels[found] = level;</span>
230           }
231         }
232       }
233     }


234   }
235 
236 
237 #else  /* !FT_DEBUG_LEVEL_TRACE */
238 
239 
240   FT_BASE_DEF( void )
241   ft_debug_init( void )
242   {
243     /* nothing */
244   }
245 
246 
247   FT_BASE_DEF( FT_Int )
248   FT_Trace_Get_Count( void )
249   {
250     return 0;
251   }
252 
253 
254   FT_BASE_DEF( const char * )
255   FT_Trace_Get_Name( FT_Int  idx )
256   {
257     FT_UNUSED( idx );
258 
259     return NULL;
260   }
261 
262 
















263 #endif /* !FT_DEBUG_LEVEL_TRACE */
264 
265 
266 /* END */
</pre>
</td>
<td>
<hr />
<pre>
<span class="line-modified">  1 /****************************************************************************</span>
<span class="line-modified">  2  *</span>
<span class="line-modified">  3  * ftdebug.c</span>
<span class="line-modified">  4  *</span>
<span class="line-modified">  5  *   Debugging and logging component (body).</span>
<span class="line-modified">  6  *</span>
<span class="line-modified">  7  * Copyright (C) 1996-2019 by</span>
<span class="line-modified">  8  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">  9  *</span>
<span class="line-modified"> 10  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified"> 11  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified"> 12  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified"> 13  * this file you indicate that you have read the license and</span>
<span class="line-modified"> 14  * understand and accept it fully.</span>
<span class="line-modified"> 15  *</span>
<span class="line-modified"> 16  */</span>
<span class="line-modified"> 17 </span>
<span class="line-modified"> 18 </span>
<span class="line-modified"> 19   /**************************************************************************</span>
<span class="line-modified"> 20    *</span>
<span class="line-modified"> 21    * This component contains various macros and functions used to ease the</span>
<span class="line-modified"> 22    * debugging of the FreeType engine.  Its main purpose is in assertion</span>
<span class="line-modified"> 23    * checking, tracing, and error detection.</span>
<span class="line-modified"> 24    *</span>
<span class="line-modified"> 25    * There are now three debugging modes:</span>
<span class="line-modified"> 26    *</span>
<span class="line-modified"> 27    * - trace mode</span>
<span class="line-modified"> 28    *</span>
<span class="line-modified"> 29    *   Error and trace messages are sent to the log file (which can be the</span>
<span class="line-modified"> 30    *   standard error output).</span>
<span class="line-modified"> 31    *</span>
<span class="line-modified"> 32    * - error mode</span>
<span class="line-modified"> 33    *</span>
<span class="line-modified"> 34    *   Only error messages are generated.</span>
<span class="line-modified"> 35    *</span>
<span class="line-modified"> 36    * - release mode:</span>
<span class="line-modified"> 37    *</span>
<span class="line-modified"> 38    *   No error message is sent or generated.  The code is free from any</span>
<span class="line-modified"> 39    *   debugging parts.</span>
<span class="line-modified"> 40    *</span>
<span class="line-modified"> 41    */</span>
 42 
 43 
 44 #include &lt;ft2build.h&gt;
 45 #include FT_FREETYPE_H
 46 #include FT_INTERNAL_DEBUG_H
 47 
 48 
 49 #ifdef FT_DEBUG_LEVEL_ERROR
 50 
 51   /* documentation is in ftdebug.h */
 52 
 53   FT_BASE_DEF( void )
 54   FT_Message( const char*  fmt,
 55               ... )
 56   {
 57     va_list  ap;
 58 
 59 
 60     va_start( ap, fmt );
 61     vfprintf( stderr, fmt, ap );
</pre>
<hr />
<pre>
 70             ... )
 71   {
 72     va_list  ap;
 73 
 74 
 75     va_start( ap, fmt );
 76     vfprintf( stderr, fmt, ap );
 77     va_end( ap );
 78 
 79     exit( EXIT_FAILURE );
 80   }
 81 
 82 
 83   /* documentation is in ftdebug.h */
 84 
 85   FT_BASE_DEF( int )
 86   FT_Throw( FT_Error     error,
 87             int          line,
 88             const char*  file )
 89   {
<span class="line-added"> 90 #if 0</span>
<span class="line-added"> 91     /* activating the code in this block makes FreeType very chatty */</span>
<span class="line-added"> 92     fprintf( stderr,</span>
<span class="line-added"> 93              &quot;%s:%d: error 0x%02x: %s\n&quot;,</span>
<span class="line-added"> 94              file,</span>
<span class="line-added"> 95              line,</span>
<span class="line-added"> 96              error,</span>
<span class="line-added"> 97              FT_Error_String( error ) );</span>
<span class="line-added"> 98 #else</span>
 99     FT_UNUSED( error );
100     FT_UNUSED( line );
101     FT_UNUSED( file );
<span class="line-added">102 #endif</span>
103 
104     return 0;
105   }
106 
107 #endif /* FT_DEBUG_LEVEL_ERROR */
108 
109 
110 
111 #ifdef FT_DEBUG_LEVEL_TRACE
112 
<span class="line-modified">113   /* array of trace levels, initialized to 0; */</span>
<span class="line-modified">114   /* this gets adjusted at run-time           */</span>
<span class="line-added">115   static int  ft_trace_levels_enabled[trace_count];</span>
116 
<span class="line-added">117   /* array of trace levels, always initialized to 0 */</span>
<span class="line-added">118   static int  ft_trace_levels_disabled[trace_count];</span>
<span class="line-added">119 </span>
<span class="line-added">120   /* a pointer to either `ft_trace_levels_enabled&#39; */</span>
<span class="line-added">121   /* or `ft_trace_levels_disabled&#39;                 */</span>
<span class="line-added">122   int*  ft_trace_levels;</span>
123 
124   /* define array of trace toggle names */
125 #define FT_TRACE_DEF( x )  #x ,
126 
127   static const char*  ft_trace_toggles[trace_count + 1] =
128   {
129 #include FT_INTERNAL_TRACE_H
130     NULL
131   };
132 
133 #undef FT_TRACE_DEF
134 
135 
136   /* documentation is in ftdebug.h */
137 
138   FT_BASE_DEF( FT_Int )
139   FT_Trace_Get_Count( void )
140   {
141     return trace_count;
142   }
143 
144 
145   /* documentation is in ftdebug.h */
146 
147   FT_BASE_DEF( const char * )
148   FT_Trace_Get_Name( FT_Int  idx )
149   {
150     int  max = FT_Trace_Get_Count();
151 
152 
153     if ( idx &lt; max )
154       return ft_trace_toggles[idx];
155     else
156       return NULL;
157   }
158 
159 
<span class="line-modified">160   /* documentation is in ftdebug.h */</span>
<span class="line-modified">161 </span>
<span class="line-modified">162   FT_BASE_DEF( void )</span>
<span class="line-modified">163   FT_Trace_Disable( void )</span>
<span class="line-modified">164   {</span>
<span class="line-modified">165     ft_trace_levels = ft_trace_levels_disabled;</span>
<span class="line-modified">166   }</span>
<span class="line-modified">167 </span>
<span class="line-modified">168 </span>
<span class="line-modified">169   /* documentation is in ftdebug.h */</span>
<span class="line-modified">170 </span>
<span class="line-modified">171   FT_BASE_DEF( void )</span>
<span class="line-modified">172   FT_Trace_Enable( void )</span>
<span class="line-modified">173   {</span>
<span class="line-modified">174     ft_trace_levels = ft_trace_levels_enabled;</span>
<span class="line-modified">175   }</span>
<span class="line-modified">176 </span>
<span class="line-modified">177 </span>
<span class="line-added">178   /**************************************************************************</span>
<span class="line-added">179    *</span>
<span class="line-added">180    * Initialize the tracing sub-system.  This is done by retrieving the</span>
<span class="line-added">181    * value of the `FT2_DEBUG&#39; environment variable.  It must be a list of</span>
<span class="line-added">182    * toggles, separated by spaces, `;&#39;, or `,&#39;.  Example:</span>
<span class="line-added">183    *</span>
<span class="line-added">184    *   export FT2_DEBUG=&quot;any:3 memory:7 stream:5&quot;</span>
<span class="line-added">185    *</span>
<span class="line-added">186    * This requests that all levels be set to 3, except the trace level for</span>
<span class="line-added">187    * the memory and stream components which are set to 7 and 5,</span>
<span class="line-added">188    * respectively.</span>
<span class="line-added">189    *</span>
<span class="line-added">190    * See the file `include/freetype/internal/fttrace.h&#39; for details of</span>
<span class="line-added">191    * the available toggle names.</span>
<span class="line-added">192    *</span>
<span class="line-added">193    * The level must be between 0 and 7; 0 means quiet (except for serious</span>
<span class="line-added">194    * runtime errors), and 7 means _very_ verbose.</span>
<span class="line-added">195    */</span>
196   FT_BASE_DEF( void )
197   ft_debug_init( void )
198   {
199     const char*  ft2_debug = ft_getenv( &quot;FT2_DEBUG&quot; );
200 
201 
202     if ( ft2_debug )
203     {
204       const char*  p = ft2_debug;
205       const char*  q;
206 
207 
208       for ( ; *p; p++ )
209       {
210         /* skip leading whitespace and separators */
211         if ( *p == &#39; &#39; || *p == &#39;\t&#39; || *p == &#39;,&#39; || *p == &#39;;&#39; || *p == &#39;=&#39; )
212           continue;
213 
214         /* read toggle name, followed by &#39;:&#39; */
215         q = p;
</pre>
<hr />
<pre>
241               found = n;
242               break;
243             }
244           }
245 
246           /* read level */
247           p++;
248           if ( *p )
249           {
250             level = *p - &#39;0&#39;;
251             if ( level &lt; 0 || level &gt; 7 )
252               level = -1;
253           }
254 
255           if ( found &gt;= 0 &amp;&amp; level &gt;= 0 )
256           {
257             if ( found == trace_any )
258             {
259               /* special case for `any&#39; */
260               for ( n = 0; n &lt; trace_count; n++ )
<span class="line-modified">261                 ft_trace_levels_enabled[n] = level;</span>
262             }
263             else
<span class="line-modified">264               ft_trace_levels_enabled[found] = level;</span>
265           }
266         }
267       }
268     }
<span class="line-added">269 </span>
<span class="line-added">270     ft_trace_levels = ft_trace_levels_enabled;</span>
271   }
272 
273 
274 #else  /* !FT_DEBUG_LEVEL_TRACE */
275 
276 
277   FT_BASE_DEF( void )
278   ft_debug_init( void )
279   {
280     /* nothing */
281   }
282 
283 
284   FT_BASE_DEF( FT_Int )
285   FT_Trace_Get_Count( void )
286   {
287     return 0;
288   }
289 
290 
291   FT_BASE_DEF( const char * )
292   FT_Trace_Get_Name( FT_Int  idx )
293   {
294     FT_UNUSED( idx );
295 
296     return NULL;
297   }
298 
299 
<span class="line-added">300   FT_BASE_DEF( void )</span>
<span class="line-added">301   FT_Trace_Disable( void )</span>
<span class="line-added">302   {</span>
<span class="line-added">303     /* nothing */</span>
<span class="line-added">304   }</span>
<span class="line-added">305 </span>
<span class="line-added">306 </span>
<span class="line-added">307   /* documentation is in ftdebug.h */</span>
<span class="line-added">308 </span>
<span class="line-added">309   FT_BASE_DEF( void )</span>
<span class="line-added">310   FT_Trace_Enable( void )</span>
<span class="line-added">311   {</span>
<span class="line-added">312     /* nothing */</span>
<span class="line-added">313   }</span>
<span class="line-added">314 </span>
<span class="line-added">315 </span>
316 #endif /* !FT_DEBUG_LEVEL_TRACE */
317 
318 
319 /* END */
</pre>
</td>
</tr>
</table>
<center><a href="ftdbgmem.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ftfntfmt.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>