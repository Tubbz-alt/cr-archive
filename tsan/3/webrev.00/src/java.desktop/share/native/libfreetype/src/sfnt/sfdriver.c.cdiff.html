<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/native/libfreetype/src/sfnt/sfdriver.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="pngshim.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="sfdriver.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/sfnt/sfdriver.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,21 ***</span>
<span class="line-modified">! /***************************************************************************/</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  sfdriver.c                                                             */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*    High-level SFNT driver interface (body).                             */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  Copyright 1996-2018 by                                                 */</span>
<span class="line-modified">! /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified">! /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified">! /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified">! /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified">! /*  understand and accept it fully.                                        */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /***************************************************************************/</span>
  
  
  #include &lt;ft2build.h&gt;
  #include FT_INTERNAL_DEBUG_H
  #include FT_INTERNAL_SFNT_H
<span class="line-new-header">--- 1,21 ---</span>
<span class="line-modified">! /****************************************************************************</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * sfdriver.c</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  *   High-level SFNT driver interface (body).</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * Copyright (C) 1996-2019 by</span>
<span class="line-modified">!  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified">!  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified">!  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified">!  * this file you indicate that you have read the license and</span>
<span class="line-modified">!  * understand and accept it fully.</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  */</span>
  
  
  #include &lt;ft2build.h&gt;
  #include FT_INTERNAL_DEBUG_H
  #include FT_INTERNAL_SFNT_H
</pre>
<hr />
<pre>
<span class="line-old-header">*** 23,18 ***</span>
  #include FT_TRUETYPE_IDS_H
  
  #include &quot;sfdriver.h&quot;
  #include &quot;ttload.h&quot;
  #include &quot;sfobjs.h&quot;
<span class="line-removed">- #include &quot;sfntpic.h&quot;</span>
  
  #include &quot;sferrors.h&quot;
  
  #ifdef TT_CONFIG_OPTION_EMBEDDED_BITMAPS
  #include &quot;ttsbit.h&quot;
  #endif
  
  #ifdef TT_CONFIG_OPTION_POSTSCRIPT_NAMES
  #include &quot;ttpost.h&quot;
  #endif
  
  #ifdef TT_CONFIG_OPTION_BDF
<span class="line-new-header">--- 23,22 ---</span>
  #include FT_TRUETYPE_IDS_H
  
  #include &quot;sfdriver.h&quot;
  #include &quot;ttload.h&quot;
  #include &quot;sfobjs.h&quot;
  
  #include &quot;sferrors.h&quot;
  
  #ifdef TT_CONFIG_OPTION_EMBEDDED_BITMAPS
  #include &quot;ttsbit.h&quot;
  #endif
  
<span class="line-added">+ #ifdef TT_CONFIG_OPTION_COLOR_LAYERS</span>
<span class="line-added">+ #include &quot;ttcolr.h&quot;</span>
<span class="line-added">+ #include &quot;ttcpal.h&quot;</span>
<span class="line-added">+ #endif</span>
<span class="line-added">+ </span>
  #ifdef TT_CONFIG_OPTION_POSTSCRIPT_NAMES
  #include &quot;ttpost.h&quot;
  #endif
  
  #ifdef TT_CONFIG_OPTION_BDF
</pre>
<hr />
<pre>
<span class="line-old-header">*** 55,22 ***</span>
  #include FT_MULTIPLE_MASTERS_H
  #include FT_SERVICE_MULTIPLE_MASTERS_H
  #endif
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="line-modified">!   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="line-modified">!   /* messages during execution.                                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
  #undef  FT_COMPONENT
<span class="line-modified">! #define FT_COMPONENT  trace_sfdriver</span>
  
  
    /*
<span class="line-modified">!    *  SFNT TABLE SERVICE</span>
     *
     */
  
    static void*
    get_sfnt_table( TT_Face      face,
<span class="line-new-header">--- 59,22 ---</span>
  #include FT_MULTIPLE_MASTERS_H
  #include FT_SERVICE_MULTIPLE_MASTERS_H
  #endif
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="line-modified">!    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="line-modified">!    * messages during execution.</span>
<span class="line-modified">!    */</span>
  #undef  FT_COMPONENT
<span class="line-modified">! #define FT_COMPONENT  sfdriver</span>
  
  
    /*
<span class="line-modified">!    * SFNT TABLE SERVICE</span>
     *
     */
  
    static void*
    get_sfnt_table( TT_Face      face,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 153,11 ***</span>
  
  
  #ifdef TT_CONFIG_OPTION_POSTSCRIPT_NAMES
  
    /*
<span class="line-modified">!    *  GLYPH DICT SERVICE</span>
     *
     */
  
    static FT_Error
    sfnt_get_glyph_name( FT_Face     face,
<span class="line-new-header">--- 157,11 ---</span>
  
  
  #ifdef TT_CONFIG_OPTION_POSTSCRIPT_NAMES
  
    /*
<span class="line-modified">!    * GLYPH DICT SERVICE</span>
     *
     */
  
    static FT_Error
    sfnt_get_glyph_name( FT_Face     face,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 176,12 ***</span>
      return error;
    }
  
  
    static FT_UInt
<span class="line-modified">!   sfnt_get_name_index( FT_Face     face,</span>
<span class="line-modified">!                        FT_String*  glyph_name )</span>
    {
      TT_Face  ttface = (TT_Face)face;
  
      FT_UInt  i, max_gid = FT_UINT_MAX;
  
<span class="line-new-header">--- 180,12 ---</span>
      return error;
    }
  
  
    static FT_UInt
<span class="line-modified">!   sfnt_get_name_index( FT_Face           face,</span>
<span class="line-modified">!                        const FT_String*  glyph_name )</span>
    {
      TT_Face  ttface = (TT_Face)face;
  
      FT_UInt  i, max_gid = FT_UINT_MAX;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 220,11 ***</span>
  
  #endif /* TT_CONFIG_OPTION_POSTSCRIPT_NAMES */
  
  
    /*
<span class="line-modified">!    *  POSTSCRIPT NAME SERVICE</span>
     *
     */
  
    /* an array representing allowed ASCII characters in a PS string */
    static const unsigned char sfnt_ps_map[16] =
<span class="line-new-header">--- 224,11 ---</span>
  
  #endif /* TT_CONFIG_OPTION_POSTSCRIPT_NAMES */
  
  
    /*
<span class="line-modified">!    * POSTSCRIPT NAME SERVICE</span>
     *
     */
  
    /* an array representing allowed ASCII characters in a PS string */
    static const unsigned char sfnt_ps_map[16] =
</pre>
<hr />
<pre>
<span class="line-old-header">*** 369,51 ***</span>
<span class="line-new-header">--- 373,65 ---</span>
  
        switch ( len &amp; 15 )
        {
        case 15:
          k4 ^= (FT_UInt32)tail[14] &lt;&lt; 16;
<span class="line-added">+         /* fall through */</span>
        case 14:
          k4 ^= (FT_UInt32)tail[13] &lt;&lt; 8;
<span class="line-added">+         /* fall through */</span>
        case 13:
          k4 ^= (FT_UInt32)tail[12];
          k4 *= c4;
          k4  = ROTL32( k4, 18 );
          k4 *= c1;
          h4 ^= k4;
<span class="line-added">+         /* fall through */</span>
  
        case 12:
          k3 ^= (FT_UInt32)tail[11] &lt;&lt; 24;
<span class="line-added">+         /* fall through */</span>
        case 11:
          k3 ^= (FT_UInt32)tail[10] &lt;&lt; 16;
<span class="line-added">+         /* fall through */</span>
        case 10:
          k3 ^= (FT_UInt32)tail[9] &lt;&lt; 8;
<span class="line-added">+         /* fall through */</span>
        case 9:
          k3 ^= (FT_UInt32)tail[8];
          k3 *= c3;
          k3  = ROTL32( k3, 17 );
          k3 *= c4;
          h3 ^= k3;
<span class="line-added">+         /* fall through */</span>
  
        case 8:
          k2 ^= (FT_UInt32)tail[7] &lt;&lt; 24;
<span class="line-added">+         /* fall through */</span>
        case 7:
          k2 ^= (FT_UInt32)tail[6] &lt;&lt; 16;
<span class="line-added">+         /* fall through */</span>
        case 6:
          k2 ^= (FT_UInt32)tail[5] &lt;&lt; 8;
<span class="line-added">+         /* fall through */</span>
        case 5:
          k2 ^= (FT_UInt32)tail[4];
          k2 *= c2;
          k2  = ROTL32( k2, 16 );
          k2 *= c3;
          h2 ^= k2;
<span class="line-added">+         /* fall through */</span>
  
        case 4:
          k1 ^= (FT_UInt32)tail[3] &lt;&lt; 24;
<span class="line-added">+         /* fall through */</span>
        case 3:
          k1 ^= (FT_UInt32)tail[2] &lt;&lt; 16;
<span class="line-added">+         /* fall through */</span>
        case 2:
          k1 ^= (FT_UInt32)tail[1] &lt;&lt; 8;
<span class="line-added">+         /* fall through */</span>
        case 1:
          k1 ^= (FT_UInt32)tail[0];
          k1 *= c1;
          k1  = ROTL32( k1, 15 );
          k1 *= c2;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 458,18 ***</span>
  
  
    typedef int (*char_type_func)( int  c );
  
  
<span class="line-modified">!   /* handling of PID/EID 3/0 and 3/1 is the same */</span>
  #define IS_WIN( n )  ( (n)-&gt;platformID == 3                             &amp;&amp; \
<span class="line-modified">!                        ( (n)-&gt;encodingID == 1 || (n)-&gt;encodingID == 0 ) &amp;&amp; \</span>
<span class="line-removed">-                        (n)-&gt;languageID == 0x409                         )</span>
  
  #define IS_APPLE( n )  ( (n)-&gt;platformID == 1 &amp;&amp; \
<span class="line-modified">!                          (n)-&gt;encodingID == 0 &amp;&amp; \</span>
<span class="line-removed">-                          (n)-&gt;languageID == 0 )</span>
  
    static char*
    get_win_string( FT_Memory       memory,
                    FT_Stream       stream,
                    TT_Name         entry,
<span class="line-new-header">--- 476,16 ---</span>
  
  
    typedef int (*char_type_func)( int  c );
  
  
<span class="line-modified">!   /* Handling of PID/EID 3/0 and 3/1 is the same. */</span>
  #define IS_WIN( n )  ( (n)-&gt;platformID == 3                             &amp;&amp; \
<span class="line-modified">!                        ( (n)-&gt;encodingID == 1 || (n)-&gt;encodingID == 0 ) )</span>
  
  #define IS_APPLE( n )  ( (n)-&gt;platformID == 1 &amp;&amp; \
<span class="line-modified">!                          (n)-&gt;encodingID == 0 )</span>
  
    static char*
    get_win_string( FT_Memory       memory,
                    FT_Stream       stream,
                    TT_Name         entry,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 489,46 ***</span>
      if ( FT_ALLOC( result, entry-&gt;stringLength / 2 + 1 ) )
        return NULL;
  
      if ( FT_STREAM_SEEK( entry-&gt;stringOffset ) ||
           FT_FRAME_ENTER( entry-&gt;stringLength ) )
<span class="line-modified">!     {</span>
<span class="line-removed">-       FT_FREE( result );</span>
<span class="line-removed">-       entry-&gt;stringLength = 0;</span>
<span class="line-removed">-       entry-&gt;stringOffset = 0;</span>
<span class="line-removed">-       FT_FREE( entry-&gt;string );</span>
<span class="line-removed">- </span>
<span class="line-removed">-       return NULL;</span>
<span class="line-removed">-     }</span>
  
      r = (FT_String*)result;
      p = (FT_Char*)stream-&gt;cursor;
  
      for ( len = entry-&gt;stringLength / 2; len &gt; 0; len--, p += 2 )
      {
<span class="line-modified">!       if ( p[0] == 0 )</span>
        {
<span class="line-modified">!         if ( char_type( p[1] ) )</span>
<span class="line-modified">!           *r++ = p[1];</span>
<span class="line-modified">!         else</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           if ( report_invalid_characters )</span>
<span class="line-removed">-           {</span>
<span class="line-removed">-             FT_TRACE0(( &quot;get_win_string:&quot;</span>
<span class="line-removed">-                         &quot; Character `%c&#39; (0x%X) invalid in PS name string\n&quot;,</span>
<span class="line-removed">-                         p[1], p[1] ));</span>
<span class="line-removed">-             /* it&#39;s not the job of FreeType to correct PS names... */</span>
<span class="line-removed">-             *r++ = p[1];</span>
<span class="line-removed">-           }</span>
<span class="line-removed">-         }</span>
        }
      }
<span class="line-modified">!     *r = &#39;\0&#39;;</span>
  
      FT_FRAME_EXIT();
  
<span class="line-modified">!     return result;</span>
    }
  
  
    static char*
    get_apple_string( FT_Memory       memory,
<span class="line-new-header">--- 505,44 ---</span>
      if ( FT_ALLOC( result, entry-&gt;stringLength / 2 + 1 ) )
        return NULL;
  
      if ( FT_STREAM_SEEK( entry-&gt;stringOffset ) ||
           FT_FRAME_ENTER( entry-&gt;stringLength ) )
<span class="line-modified">!       goto get_win_string_error;</span>
  
      r = (FT_String*)result;
      p = (FT_Char*)stream-&gt;cursor;
  
      for ( len = entry-&gt;stringLength / 2; len &gt; 0; len--, p += 2 )
      {
<span class="line-modified">!       if ( p[0] == 0 &amp;&amp; char_type( p[1] ) )</span>
<span class="line-added">+         *r++ = p[1];</span>
<span class="line-added">+       else</span>
        {
<span class="line-modified">!         if ( report_invalid_characters )</span>
<span class="line-modified">!           FT_TRACE0(( &quot;get_win_string:&quot;</span>
<span class="line-modified">!                       &quot; Character 0x%X invalid in PS name string\n&quot;,</span>
<span class="line-modified">!                       ((unsigned)p[0])*256 + (unsigned)p[1] ));</span>
<span class="line-modified">!         break;</span>
        }
      }
<span class="line-modified">!     if ( !len )</span>
<span class="line-added">+       *r = &#39;\0&#39;;</span>
  
      FT_FRAME_EXIT();
  
<span class="line-modified">!     if ( !len )</span>
<span class="line-added">+       return result;</span>
<span class="line-added">+ </span>
<span class="line-added">+   get_win_string_error:</span>
<span class="line-added">+     FT_FREE( result );</span>
<span class="line-added">+ </span>
<span class="line-added">+     entry-&gt;stringLength = 0;</span>
<span class="line-added">+     entry-&gt;stringOffset = 0;</span>
<span class="line-added">+     FT_FREE( entry-&gt;string );</span>
<span class="line-added">+ </span>
<span class="line-added">+     return NULL;</span>
    }
  
  
    static char*
    get_apple_string( FT_Memory       memory,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 550,18 ***</span>
      if ( FT_ALLOC( result, entry-&gt;stringLength + 1 ) )
        return NULL;
  
      if ( FT_STREAM_SEEK( entry-&gt;stringOffset ) ||
           FT_FRAME_ENTER( entry-&gt;stringLength ) )
<span class="line-modified">!     {</span>
<span class="line-removed">-       FT_FREE( result );</span>
<span class="line-removed">-       entry-&gt;stringOffset = 0;</span>
<span class="line-removed">-       entry-&gt;stringLength = 0;</span>
<span class="line-removed">-       FT_FREE( entry-&gt;string );</span>
<span class="line-removed">- </span>
<span class="line-removed">-       return NULL;</span>
<span class="line-removed">-     }</span>
  
      r = (FT_String*)result;
      p = (FT_Char*)stream-&gt;cursor;
  
      for ( len = entry-&gt;stringLength; len &gt; 0; len--, p++ )
<span class="line-new-header">--- 564,11 ---</span>
      if ( FT_ALLOC( result, entry-&gt;stringLength + 1 ) )
        return NULL;
  
      if ( FT_STREAM_SEEK( entry-&gt;stringOffset ) ||
           FT_FRAME_ENTER( entry-&gt;stringLength ) )
<span class="line-modified">!       goto get_apple_string_error;</span>
  
      r = (FT_String*)result;
      p = (FT_Char*)stream-&gt;cursor;
  
      for ( len = entry-&gt;stringLength; len &gt; 0; len--, p++ )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 569,24 ***</span>
        if ( char_type( *p ) )
          *r++ = *p;
        else
        {
          if ( report_invalid_characters )
<span class="line-removed">-         {</span>
            FT_TRACE0(( &quot;get_apple_string:&quot;
                        &quot; Character `%c&#39; (0x%X) invalid in PS name string\n&quot;,
                        *p, *p ));
<span class="line-modified">!           /* it&#39;s not the job of FreeType to correct PS names... */</span>
<span class="line-removed">-           *r++ = *p;</span>
<span class="line-removed">-         }</span>
        }
      }
<span class="line-modified">!     *r = &#39;\0&#39;;</span>
  
      FT_FRAME_EXIT();
  
<span class="line-modified">!     return result;</span>
    }
  
  
    static FT_Bool
    sfnt_get_name_id( TT_Face    face,
<span class="line-new-header">--- 576,32 ---</span>
        if ( char_type( *p ) )
          *r++ = *p;
        else
        {
          if ( report_invalid_characters )
            FT_TRACE0(( &quot;get_apple_string:&quot;
                        &quot; Character `%c&#39; (0x%X) invalid in PS name string\n&quot;,
                        *p, *p ));
<span class="line-modified">!         break;</span>
        }
      }
<span class="line-modified">!     if ( !len )</span>
<span class="line-added">+       *r = &#39;\0&#39;;</span>
  
      FT_FRAME_EXIT();
  
<span class="line-modified">!     if ( !len )</span>
<span class="line-added">+       return result;</span>
<span class="line-added">+ </span>
<span class="line-added">+   get_apple_string_error:</span>
<span class="line-added">+     FT_FREE( result );</span>
<span class="line-added">+ </span>
<span class="line-added">+     entry-&gt;stringOffset = 0;</span>
<span class="line-added">+     entry-&gt;stringLength = 0;</span>
<span class="line-added">+     FT_FREE( entry-&gt;string );</span>
<span class="line-added">+ </span>
<span class="line-added">+     return NULL;</span>
    }
  
  
    static FT_Bool
    sfnt_get_name_id( TT_Face    face,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 605,14 ***</span>
        TT_Name  name = face-&gt;name_table.names + n;
  
  
        if ( name-&gt;nameID == id &amp;&amp; name-&gt;stringLength &gt; 0 )
        {
<span class="line-modified">!         if ( IS_WIN( name ) )</span>
            *win = n;
  
<span class="line-modified">!         if ( IS_APPLE( name ) )</span>
            *apple = n;
        }
      }
  
      return ( *win &gt;= 0 ) || ( *apple &gt;= 0 );
<span class="line-new-header">--- 620,14 ---</span>
        TT_Name  name = face-&gt;name_table.names + n;
  
  
        if ( name-&gt;nameID == id &amp;&amp; name-&gt;stringLength &gt; 0 )
        {
<span class="line-modified">!         if ( IS_WIN( name ) &amp;&amp; ( name-&gt;languageID == 0x409 || *win == -1 ) )</span>
            *win = n;
  
<span class="line-modified">!         if ( IS_APPLE( name ) &amp;&amp; ( name-&gt;languageID == 0 || *apple == -1 ) )</span>
            *apple = n;
        }
      }
  
      return ( *win &gt;= 0 ) || ( *apple &gt;= 0 );
</pre>
<hr />
<pre>
<span class="line-old-header">*** 641,13 ***</span>
    /* the maximum length of PostScript font names */
  #define MAX_PS_NAME_LEN  127
  
  
    /*
<span class="line-modified">!    *  Find the shortest decimal representation of a 16.16 fixed point</span>
<span class="line-modified">!    *  number.  The function fills `buf&#39; with the result, returning a pointer</span>
<span class="line-modified">!    *  to the position after the representation&#39;s last byte.</span>
     */
  
    static char*
    fixed2float( FT_Int  fixed,
                 char*   buf )
<span class="line-new-header">--- 656,13 ---</span>
    /* the maximum length of PostScript font names */
  #define MAX_PS_NAME_LEN  127
  
  
    /*
<span class="line-modified">!    * Find the shortest decimal representation of a 16.16 fixed point</span>
<span class="line-modified">!    * number.  The function fills `buf&#39; with the result, returning a pointer</span>
<span class="line-modified">!    * to the position after the representation&#39;s last byte.</span>
     */
  
    static char*
    fixed2float( FT_Int  fixed,
                 char*   buf )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 671,11 ***</span>
      }
  
      if ( fixed &lt; 0 )
      {
        *p++ = &#39;-&#39;;
<span class="line-modified">!       fixed = -fixed;</span>
      }
  
      int_part  = ( fixed &gt;&gt; 16 ) &amp; 0xFFFF;
      frac_part = fixed &amp; 0xFFFF;
  
<span class="line-new-header">--- 686,11 ---</span>
      }
  
      if ( fixed &lt; 0 )
      {
        *p++ = &#39;-&#39;;
<span class="line-modified">!       fixed = NEG_INT( fixed );</span>
      }
  
      int_part  = ( fixed &gt;&gt; 16 ) &amp; 0xFFFF;
      frac_part = fixed &amp; 0xFFFF;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 826,17 ***</span>
          result = get_win_string( face-&gt;root.memory,
                                   face-&gt;name_table.stream,
                                   face-&gt;name_table.names + win,
                                   sfnt_is_alphanumeric,
                                   0 );
<span class="line-modified">!       else</span>
          result = get_apple_string( face-&gt;root.memory,
                                     face-&gt;name_table.stream,
                                     face-&gt;name_table.names + apple,
                                     sfnt_is_alphanumeric,
                                     0 );
  
        len = ft_strlen( result );
  
        /* sanitize if necessary; we reserve space for 36 bytes (a 128bit  */
        /* checksum as a hex number, preceded by `-&#39; and followed by three */
        /* ASCII dots, to be used if the constructed PS name would be too  */
<span class="line-new-header">--- 841,24 ---</span>
          result = get_win_string( face-&gt;root.memory,
                                   face-&gt;name_table.stream,
                                   face-&gt;name_table.names + win,
                                   sfnt_is_alphanumeric,
                                   0 );
<span class="line-modified">!       if ( !result &amp;&amp; apple != -1 )</span>
          result = get_apple_string( face-&gt;root.memory,
                                     face-&gt;name_table.stream,
                                     face-&gt;name_table.names + apple,
                                     sfnt_is_alphanumeric,
                                     0 );
  
<span class="line-added">+       if ( !result )</span>
<span class="line-added">+       {</span>
<span class="line-added">+         FT_TRACE0(( &quot;sfnt_get_var_ps_name:&quot;</span>
<span class="line-added">+                     &quot; No valid PS name prefix for font instances found\n&quot; ));</span>
<span class="line-added">+         return NULL;</span>
<span class="line-added">+       }</span>
<span class="line-added">+ </span>
        len = ft_strlen( result );
  
        /* sanitize if necessary; we reserve space for 36 bytes (a 128bit  */
        /* checksum as a hex number, preceded by `-&#39; and followed by three */
        /* ASCII dots, to be used if the constructed PS name would be too  */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1050,11 ***</span>
        result = get_win_string( face-&gt;root.memory,
                                 face-&gt;name_table.stream,
                                 face-&gt;name_table.names + win,
                                 sfnt_is_postscript,
                                 1 );
<span class="line-modified">!     else</span>
        result = get_apple_string( face-&gt;root.memory,
                                   face-&gt;name_table.stream,
                                   face-&gt;name_table.names + apple,
                                   sfnt_is_postscript,
                                   1 );
<span class="line-new-header">--- 1072,11 ---</span>
        result = get_win_string( face-&gt;root.memory,
                                 face-&gt;name_table.stream,
                                 face-&gt;name_table.names + win,
                                 sfnt_is_postscript,
                                 1 );
<span class="line-modified">!     if ( !result &amp;&amp; apple != -1 )</span>
        result = get_apple_string( face-&gt;root.memory,
                                   face-&gt;name_table.stream,
                                   face-&gt;name_table.names + apple,
                                   sfnt_is_postscript,
                                   1 );
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1071,11 ***</span>
      (FT_PsName_GetFunc)sfnt_get_ps_name       /* get_ps_font_name */
    )
  
  
    /*
<span class="line-modified">!    *  TT CMAP INFO</span>
     */
    FT_DEFINE_SERVICE_TTCMAPSREC(
      tt_service_get_cmap_info,
  
      (TT_CMap_Info_GetFunc)tt_get_cmap_info    /* get_cmap_info */
<span class="line-new-header">--- 1093,11 ---</span>
      (FT_PsName_GetFunc)sfnt_get_ps_name       /* get_ps_font_name */
    )
  
  
    /*
<span class="line-modified">!    * TT CMAP INFO</span>
     */
    FT_DEFINE_SERVICE_TTCMAPSREC(
      tt_service_get_cmap_info,
  
      (TT_CMap_Info_GetFunc)tt_get_cmap_info    /* get_cmap_info */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1130,76 ***</span>
  
  #endif /* TT_CONFIG_OPTION_BDF */
  
  
    /*
<span class="line-modified">!    *  SERVICE LIST</span>
     */
  
  #if defined TT_CONFIG_OPTION_POSTSCRIPT_NAMES &amp;&amp; defined TT_CONFIG_OPTION_BDF
    FT_DEFINE_SERVICEDESCREC5(
      sfnt_services,
  
<span class="line-modified">!     FT_SERVICE_ID_SFNT_TABLE,           &amp;SFNT_SERVICE_SFNT_TABLE_GET,</span>
<span class="line-modified">!     FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;SFNT_SERVICE_PS_NAME_GET,</span>
<span class="line-modified">!     FT_SERVICE_ID_GLYPH_DICT,           &amp;SFNT_SERVICE_GLYPH_DICT_GET,</span>
<span class="line-modified">!     FT_SERVICE_ID_BDF,                  &amp;SFNT_SERVICE_BDF_GET,</span>
<span class="line-modified">!     FT_SERVICE_ID_TT_CMAP,              &amp;TT_SERVICE_CMAP_INFO_GET )</span>
  #elif defined TT_CONFIG_OPTION_POSTSCRIPT_NAMES
    FT_DEFINE_SERVICEDESCREC4(
      sfnt_services,
  
<span class="line-modified">!     FT_SERVICE_ID_SFNT_TABLE,           &amp;SFNT_SERVICE_SFNT_TABLE_GET,</span>
<span class="line-modified">!     FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;SFNT_SERVICE_PS_NAME_GET,</span>
<span class="line-modified">!     FT_SERVICE_ID_GLYPH_DICT,           &amp;SFNT_SERVICE_GLYPH_DICT_GET,</span>
<span class="line-modified">!     FT_SERVICE_ID_TT_CMAP,              &amp;TT_SERVICE_CMAP_INFO_GET )</span>
  #elif defined TT_CONFIG_OPTION_BDF
    FT_DEFINE_SERVICEDESCREC4(
      sfnt_services,
  
<span class="line-modified">!     FT_SERVICE_ID_SFNT_TABLE,           &amp;SFNT_SERVICE_SFNT_TABLE_GET,</span>
<span class="line-modified">!     FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;SFNT_SERVICE_PS_NAME_GET,</span>
<span class="line-modified">!     FT_SERVICE_ID_BDF,                  &amp;SFNT_SERVICE_BDF_GET,</span>
<span class="line-modified">!     FT_SERVICE_ID_TT_CMAP,              &amp;TT_SERVICE_CMAP_INFO_GET )</span>
  #else
    FT_DEFINE_SERVICEDESCREC3(
      sfnt_services,
  
<span class="line-modified">!     FT_SERVICE_ID_SFNT_TABLE,           &amp;SFNT_SERVICE_SFNT_TABLE_GET,</span>
<span class="line-modified">!     FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;SFNT_SERVICE_PS_NAME_GET,</span>
<span class="line-modified">!     FT_SERVICE_ID_TT_CMAP,              &amp;TT_SERVICE_CMAP_INFO_GET )</span>
  #endif
  
  
    FT_CALLBACK_DEF( FT_Module_Interface )
    sfnt_get_interface( FT_Module    module,
                        const char*  module_interface )
    {
<span class="line-removed">-     /* SFNT_SERVICES_GET dereferences `library&#39; in PIC mode */</span>
<span class="line-removed">- #ifdef FT_CONFIG_OPTION_PIC</span>
<span class="line-removed">-     FT_Library  library;</span>
<span class="line-removed">- </span>
<span class="line-removed">- </span>
<span class="line-removed">-     if ( !module )</span>
<span class="line-removed">-       return NULL;</span>
<span class="line-removed">-     library = module-&gt;library;</span>
<span class="line-removed">-     if ( !library )</span>
<span class="line-removed">-       return NULL;</span>
<span class="line-removed">- #else</span>
      FT_UNUSED( module );
<span class="line-removed">- #endif</span>
  
<span class="line-modified">!     return ft_service_list_lookup( SFNT_SERVICES_GET, module_interface );</span>
    }
  
  
  #ifdef TT_CONFIG_OPTION_EMBEDDED_BITMAPS
  #define PUT_EMBEDDED_BITMAPS( a )  a
  #else
  #define PUT_EMBEDDED_BITMAPS( a )  NULL
  #endif
  
  #ifdef TT_CONFIG_OPTION_POSTSCRIPT_NAMES
  #define PUT_PS_NAMES( a )  a
  #else
  #define PUT_PS_NAMES( a )  NULL
  #endif
<span class="line-new-header">--- 1152,70 ---</span>
  
  #endif /* TT_CONFIG_OPTION_BDF */
  
  
    /*
<span class="line-modified">!    * SERVICE LIST</span>
     */
  
  #if defined TT_CONFIG_OPTION_POSTSCRIPT_NAMES &amp;&amp; defined TT_CONFIG_OPTION_BDF
    FT_DEFINE_SERVICEDESCREC5(
      sfnt_services,
  
<span class="line-modified">!     FT_SERVICE_ID_SFNT_TABLE,           &amp;sfnt_service_sfnt_table,</span>
<span class="line-modified">!     FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;sfnt_service_ps_name,</span>
<span class="line-modified">!     FT_SERVICE_ID_GLYPH_DICT,           &amp;sfnt_service_glyph_dict,</span>
<span class="line-modified">!     FT_SERVICE_ID_BDF,                  &amp;sfnt_service_bdf,</span>
<span class="line-modified">!     FT_SERVICE_ID_TT_CMAP,              &amp;tt_service_get_cmap_info )</span>
  #elif defined TT_CONFIG_OPTION_POSTSCRIPT_NAMES
    FT_DEFINE_SERVICEDESCREC4(
      sfnt_services,
  
<span class="line-modified">!     FT_SERVICE_ID_SFNT_TABLE,           &amp;sfnt_service_sfnt_table,</span>
<span class="line-modified">!     FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;sfnt_service_ps_name,</span>
<span class="line-modified">!     FT_SERVICE_ID_GLYPH_DICT,           &amp;sfnt_service_glyph_dict,</span>
<span class="line-modified">!     FT_SERVICE_ID_TT_CMAP,              &amp;tt_service_get_cmap_info )</span>
  #elif defined TT_CONFIG_OPTION_BDF
    FT_DEFINE_SERVICEDESCREC4(
      sfnt_services,
  
<span class="line-modified">!     FT_SERVICE_ID_SFNT_TABLE,           &amp;sfnt_service_sfnt_table,</span>
<span class="line-modified">!     FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;sfnt_service_ps_name,</span>
<span class="line-modified">!     FT_SERVICE_ID_BDF,                  &amp;sfnt_service_bdf,</span>
<span class="line-modified">!     FT_SERVICE_ID_TT_CMAP,              &amp;tt_service_get_cmap_info )</span>
  #else
    FT_DEFINE_SERVICEDESCREC3(
      sfnt_services,
  
<span class="line-modified">!     FT_SERVICE_ID_SFNT_TABLE,           &amp;sfnt_service_sfnt_table,</span>
<span class="line-modified">!     FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;sfnt_service_ps_name,</span>
<span class="line-modified">!     FT_SERVICE_ID_TT_CMAP,              &amp;tt_service_get_cmap_info )</span>
  #endif
  
  
    FT_CALLBACK_DEF( FT_Module_Interface )
    sfnt_get_interface( FT_Module    module,
                        const char*  module_interface )
    {
      FT_UNUSED( module );
  
<span class="line-modified">!     return ft_service_list_lookup( sfnt_services, module_interface );</span>
    }
  
  
  #ifdef TT_CONFIG_OPTION_EMBEDDED_BITMAPS
  #define PUT_EMBEDDED_BITMAPS( a )  a
  #else
  #define PUT_EMBEDDED_BITMAPS( a )  NULL
  #endif
  
<span class="line-added">+ #ifdef TT_CONFIG_OPTION_COLOR_LAYERS</span>
<span class="line-added">+ #define PUT_COLOR_LAYERS( a )  a</span>
<span class="line-added">+ #else</span>
<span class="line-added">+ #define PUT_COLOR_LAYERS( a )  NULL</span>
<span class="line-added">+ #endif</span>
<span class="line-added">+ </span>
  #ifdef TT_CONFIG_OPTION_POSTSCRIPT_NAMES
  #define PUT_PS_NAMES( a )  a
  #else
  #define PUT_PS_NAMES( a )  NULL
  #endif
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1254,13 ***</span>
                              /* TT_Load_Table_Func      load_eblc       */
      PUT_EMBEDDED_BITMAPS( tt_face_free_sbit ),
                              /* TT_Free_Table_Func      free_eblc       */
  
      PUT_EMBEDDED_BITMAPS( tt_face_set_sbit_strike     ),
<span class="line-modified">!                             /* TT_Set_SBit_Strike_Func set_sbit_strike */</span>
      PUT_EMBEDDED_BITMAPS( tt_face_load_strike_metrics ),
<span class="line-modified">!                     /* TT_Load_Strike_Metrics_Func load_strike_metrics */</span>
  
      tt_face_get_metrics,    /* TT_Get_Metrics_Func     get_metrics     */
  
      tt_face_get_name,       /* TT_Get_Name_Func        get_name        */
      sfnt_get_name_id        /* TT_Get_Name_ID_Func     get_name_id     */
<span class="line-new-header">--- 1270,28 ---</span>
                              /* TT_Load_Table_Func      load_eblc       */
      PUT_EMBEDDED_BITMAPS( tt_face_free_sbit ),
                              /* TT_Free_Table_Func      free_eblc       */
  
      PUT_EMBEDDED_BITMAPS( tt_face_set_sbit_strike     ),
<span class="line-modified">!                    /* TT_Set_SBit_Strike_Func      set_sbit_strike     */</span>
      PUT_EMBEDDED_BITMAPS( tt_face_load_strike_metrics ),
<span class="line-modified">!                    /* TT_Load_Strike_Metrics_Func  load_strike_metrics */</span>
<span class="line-added">+ </span>
<span class="line-added">+     PUT_COLOR_LAYERS( tt_face_load_cpal ),</span>
<span class="line-added">+                             /* TT_Load_Table_Func      load_cpal       */</span>
<span class="line-added">+     PUT_COLOR_LAYERS( tt_face_load_colr ),</span>
<span class="line-added">+                             /* TT_Load_Table_Func      load_colr       */</span>
<span class="line-added">+     PUT_COLOR_LAYERS( tt_face_free_cpal ),</span>
<span class="line-added">+                             /* TT_Free_Table_Func      free_cpal       */</span>
<span class="line-added">+     PUT_COLOR_LAYERS( tt_face_free_colr ),</span>
<span class="line-added">+                             /* TT_Free_Table_Func      free_colr       */</span>
<span class="line-added">+     PUT_COLOR_LAYERS( tt_face_palette_set ),</span>
<span class="line-added">+                             /* TT_Set_Palette_Func     set_palette     */</span>
<span class="line-added">+     PUT_COLOR_LAYERS( tt_face_get_colr_layer ),</span>
<span class="line-added">+                             /* TT_Get_Colr_Layer_Func  get_colr_layer  */</span>
<span class="line-added">+     PUT_COLOR_LAYERS( tt_face_colr_blend_layer ),</span>
<span class="line-added">+                             /* TT_Blend_Colr_Func      colr_blend      */</span>
  
      tt_face_get_metrics,    /* TT_Get_Metrics_Func     get_metrics     */
  
      tt_face_get_name,       /* TT_Get_Name_Func        get_name        */
      sfnt_get_name_id        /* TT_Get_Name_ID_Func     get_name_id     */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1275,11 ***</span>
  
      &quot;sfnt&quot;,     /* driver name                            */
      0x10000L,   /* driver version 1.0                     */
      0x20000L,   /* driver requires FreeType 2.0 or higher */
  
<span class="line-modified">!     (const void*)&amp;SFNT_INTERFACE_GET,  /* module specific interface */</span>
  
      (FT_Module_Constructor)NULL,               /* module_init   */
      (FT_Module_Destructor) NULL,               /* module_done   */
      (FT_Module_Requester)  sfnt_get_interface  /* get_interface */
    )
<span class="line-new-header">--- 1306,11 ---</span>
  
      &quot;sfnt&quot;,     /* driver name                            */
      0x10000L,   /* driver version 1.0                     */
      0x20000L,   /* driver requires FreeType 2.0 or higher */
  
<span class="line-modified">!     (const void*)&amp;sfnt_interface,  /* module specific interface */</span>
  
      (FT_Module_Constructor)NULL,               /* module_init   */
      (FT_Module_Destructor) NULL,               /* module_done   */
      (FT_Module_Requester)  sfnt_get_interface  /* get_interface */
    )
</pre>
<center><a href="pngshim.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="sfdriver.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>