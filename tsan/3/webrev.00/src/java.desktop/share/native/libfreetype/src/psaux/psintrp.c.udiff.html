<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/share/native/libfreetype/src/psaux/psintrp.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="pshints.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="psintrp.h.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/psaux/psintrp.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,41 +1,41 @@</span>
<span class="udiff-line-modified-removed">- /***************************************************************************/</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  psintrp.c                                                              */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*    Adobe&#39;s CFF Interpreter (body).                                      */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  Copyright 2007-2014 Adobe Systems Incorporated.                        */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  This software, and all works of authorship, whether in source or       */</span>
<span class="udiff-line-modified-removed">- /*  object code form as indicated by the copyright notice(s) included      */</span>
<span class="udiff-line-modified-removed">- /*  herein (collectively, the &quot;Work&quot;) is made available, and may only be   */</span>
<span class="udiff-line-modified-removed">- /*  used, modified, and distributed under the FreeType Project License,    */</span>
<span class="udiff-line-modified-removed">- /*  LICENSE.TXT.  Additionally, subject to the terms and conditions of the */</span>
<span class="udiff-line-modified-removed">- /*  FreeType Project License, each contributor to the Work hereby grants   */</span>
<span class="udiff-line-modified-removed">- /*  to any individual or legal entity exercising permissions granted by    */</span>
<span class="udiff-line-modified-removed">- /*  the FreeType Project License and this section (hereafter, &quot;You&quot; or     */</span>
<span class="udiff-line-modified-removed">- /*  &quot;Your&quot;) a perpetual, worldwide, non-exclusive, no-charge,              */</span>
<span class="udiff-line-modified-removed">- /*  royalty-free, irrevocable (except as stated in this section) patent    */</span>
<span class="udiff-line-modified-removed">- /*  license to make, have made, use, offer to sell, sell, import, and      */</span>
<span class="udiff-line-modified-removed">- /*  otherwise transfer the Work, where such license applies only to those  */</span>
<span class="udiff-line-modified-removed">- /*  patent claims licensable by such contributor that are necessarily      */</span>
<span class="udiff-line-modified-removed">- /*  infringed by their contribution(s) alone or by combination of their    */</span>
<span class="udiff-line-modified-removed">- /*  contribution(s) with the Work to which such contribution(s) was        */</span>
<span class="udiff-line-modified-removed">- /*  submitted.  If You institute patent litigation against any entity      */</span>
<span class="udiff-line-modified-removed">- /*  (including a cross-claim or counterclaim in a lawsuit) alleging that   */</span>
<span class="udiff-line-modified-removed">- /*  the Work or a contribution incorporated within the Work constitutes    */</span>
<span class="udiff-line-modified-removed">- /*  direct or contributory patent infringement, then any patent licenses   */</span>
<span class="udiff-line-modified-removed">- /*  granted to You under this License for that Work shall terminate as of  */</span>
<span class="udiff-line-modified-removed">- /*  the date such litigation is filed.                                     */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  By using, modifying, or distributing the Work you indicate that you    */</span>
<span class="udiff-line-modified-removed">- /*  have read and understood the terms and conditions of the               */</span>
<span class="udiff-line-modified-removed">- /*  FreeType Project License as well as those provided in this section,    */</span>
<span class="udiff-line-modified-removed">- /*  and you accept them fully.                                             */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /***************************************************************************/</span>
<span class="udiff-line-modified-added">+ /****************************************************************************</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * psintrp.c</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  *   Adobe&#39;s CFF Interpreter (body).</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * Copyright 2007-2014 Adobe Systems Incorporated.</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * This software, and all works of authorship, whether in source or</span>
<span class="udiff-line-modified-added">+  * object code form as indicated by the copyright notice(s) included</span>
<span class="udiff-line-modified-added">+  * herein (collectively, the &quot;Work&quot;) is made available, and may only be</span>
<span class="udiff-line-modified-added">+  * used, modified, and distributed under the FreeType Project License,</span>
<span class="udiff-line-modified-added">+  * LICENSE.TXT.  Additionally, subject to the terms and conditions of the</span>
<span class="udiff-line-modified-added">+  * FreeType Project License, each contributor to the Work hereby grants</span>
<span class="udiff-line-modified-added">+  * to any individual or legal entity exercising permissions granted by</span>
<span class="udiff-line-modified-added">+  * the FreeType Project License and this section (hereafter, &quot;You&quot; or</span>
<span class="udiff-line-modified-added">+  * &quot;Your&quot;) a perpetual, worldwide, non-exclusive, no-charge,</span>
<span class="udiff-line-modified-added">+  * royalty-free, irrevocable (except as stated in this section) patent</span>
<span class="udiff-line-modified-added">+  * license to make, have made, use, offer to sell, sell, import, and</span>
<span class="udiff-line-modified-added">+  * otherwise transfer the Work, where such license applies only to those</span>
<span class="udiff-line-modified-added">+  * patent claims licensable by such contributor that are necessarily</span>
<span class="udiff-line-modified-added">+  * infringed by their contribution(s) alone or by combination of their</span>
<span class="udiff-line-modified-added">+  * contribution(s) with the Work to which such contribution(s) was</span>
<span class="udiff-line-modified-added">+  * submitted.  If You institute patent litigation against any entity</span>
<span class="udiff-line-modified-added">+  * (including a cross-claim or counterclaim in a lawsuit) alleging that</span>
<span class="udiff-line-modified-added">+  * the Work or a contribution incorporated within the Work constitutes</span>
<span class="udiff-line-modified-added">+  * direct or contributory patent infringement, then any patent licenses</span>
<span class="udiff-line-modified-added">+  * granted to You under this License for that Work shall terminate as of</span>
<span class="udiff-line-modified-added">+  * the date such litigation is filed.</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * By using, modifying, or distributing the Work you indicate that you</span>
<span class="udiff-line-modified-added">+  * have read and understood the terms and conditions of the</span>
<span class="udiff-line-modified-added">+  * FreeType Project License as well as those provided in this section,</span>
<span class="udiff-line-modified-added">+  * and you accept them fully.</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  */</span>
  
  
  #include &quot;psft.h&quot;
  #include FT_INTERNAL_DEBUG_H
  #include FT_SERVICE_CFF_TABLE_LOAD_H
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -50,18 +50,18 @@</span>
  
  #include &quot;psobjs.h&quot;   /* for cff_random */
  #include &quot;t1decode.h&quot; /* for t1 seac    */
  
  
<span class="udiff-line-modified-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="udiff-line-modified-removed">-   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="udiff-line-modified-removed">-   /* messages during execution.                                            */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-added">+   /**************************************************************************</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="udiff-line-modified-added">+    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="udiff-line-modified-added">+    * messages during execution.</span>
<span class="udiff-line-modified-added">+    */</span>
  #undef  FT_COMPONENT
<span class="udiff-line-modified-removed">- #define FT_COMPONENT  trace_cf2interp</span>
<span class="udiff-line-modified-added">+ #define FT_COMPONENT  cf2interp</span>
  
  
    FT_LOCAL_DEF( void )
    cf2_hintmask_init( CF2_HintMask  hintmask,
                       FT_Error*     error )
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -285,11 +285,11 @@</span>
                 FT_Bool*        haveWidth,
                 CF2_Fixed       hintOffset )
    {
      CF2_UInt  i;
      CF2_UInt  count       = cf2_stack_count( opStack );
<span class="udiff-line-modified-removed">-     FT_Bool   hasWidthArg = (FT_Bool)( count &amp; 1 );</span>
<span class="udiff-line-modified-added">+     FT_Bool   hasWidthArg = FT_BOOL( count &amp; 1 );</span>
  
      /* variable accumulates delta values from operand stack */
      CF2_Fixed  position = hintOffset;
  
      if ( font-&gt;isT1 &amp;&amp; !font-&gt;decoder-&gt;flex_state &amp;&amp; !*haveWidth )
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -362,11 +362,11 @@</span>
      if ( isHFlex )
        vals[9 + 2] = *curY;
  
      if ( doConditionalLastRead )
      {
<span class="udiff-line-modified-removed">-       FT_Bool    lastIsX = (FT_Bool)(</span>
<span class="udiff-line-modified-added">+       FT_Bool    lastIsX = FT_BOOL(</span>
                               cf2_fixedAbs( SUB_INT32( vals[10], *curX ) ) &gt;
                               cf2_fixedAbs( SUB_INT32( vals[11], *curY ) ) );
        CF2_Fixed  lastVal = cf2_stack_getReal( opStack, idx );
  
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -610,18 +610,18 @@</span>
      /* Note: Caller owns and must finalize the first charstring.      */
      /*       Our copy of it does not change that requirement.         */
      cf2_arrstack_setCount( &amp;subrStack, CF2_MAX_SUBR + 1 );
  
      charstring  = (CF2_Buffer)cf2_arrstack_getBuffer( &amp;subrStack );
<span class="udiff-line-removed">-     *charstring = *buf;    /* structure copy */</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     charstringIndex = 0;       /* entry is valid now */</span>
  
      /* catch errors so far */
      if ( *error )
        goto exit;
  
<span class="udiff-line-added">+     *charstring     = *buf;    /* structure copy     */</span>
<span class="udiff-line-added">+     charstringIndex = 0;       /* entry is valid now */</span>
<span class="udiff-line-added">+ </span>
      /* main interpreter loop */
      while ( 1 )
      {
        if ( font-&gt;isT1 )
          FT_ASSERT( known_othersubr_result_cnt == 0 ||
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -661,10 +661,11 @@</span>
                  op1 &gt;= 32 /* Numbers */ ) )
          {
            /* Skip outline commands first time round.       */
            /* `endchar&#39; will trigger initial hintmap build  */
            /* and rewind the charstring.                    */
<span class="udiff-line-added">+           FT_TRACE4(( &quot; &lt;outline command skipped&gt;\n&quot; ));</span>
            cf2_stack_clear( opStack );
            continue;
          }
  
          if ( result_cnt &gt; 0               &amp;&amp;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -773,11 +774,12 @@</span>
          }
          continue;     /* do not clear the stack */
  
        case cf2_cmdHSTEMHM:
        case cf2_cmdHSTEM:
<span class="udiff-line-modified-removed">-         FT_TRACE4(( op1 == cf2_cmdHSTEMHM ? &quot; hstemhm\n&quot; : &quot; hstem\n&quot; ));</span>
<span class="udiff-line-modified-added">+         FT_TRACE4(( &quot;%s\n&quot;, op1 == cf2_cmdHSTEMHM ? &quot; hstemhm&quot;</span>
<span class="udiff-line-added">+                                                   : &quot; hstem&quot; ));</span>
  
          if ( !font-&gt;isT1 )
          {
            /* never add hints after the mask is computed */
            /* except if in Type 1 mode (no hintmask op)  */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -803,11 +805,12 @@</span>
  
          break;
  
        case cf2_cmdVSTEMHM:
        case cf2_cmdVSTEM:
<span class="udiff-line-modified-removed">-         FT_TRACE4(( op1 == cf2_cmdVSTEMHM ? &quot; vstemhm\n&quot; : &quot; vstem\n&quot; ));</span>
<span class="udiff-line-modified-added">+         FT_TRACE4(( &quot;%s\n&quot;, op1 == cf2_cmdVSTEMHM ? &quot; vstemhm&quot;</span>
<span class="udiff-line-added">+                                                   : &quot; vstem&quot; ));</span>
  
          if ( !font-&gt;isT1 )
          {
            /* never add hints after the mask is computed */
            /* except if in Type 1 mode (no hintmask op)  */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -886,11 +889,11 @@</span>
            CF2_UInt  count = cf2_stack_count( opStack );
  
            FT_Bool  isX = FT_BOOL( op1 == cf2_cmdHLINETO );
  
  
<span class="udiff-line-modified-removed">-           FT_TRACE4(( isX ? &quot; hlineto\n&quot; : &quot; vlineto\n&quot; ));</span>
<span class="udiff-line-modified-added">+           FT_TRACE4(( &quot;%s\n&quot;, isX ? &quot; hlineto&quot; : &quot; vlineto&quot; ));</span>
  
            for ( idx = 0; idx &lt; count; idx++ )
            {
              CF2_Fixed  v = cf2_stack_getReal( opStack, idx );
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -914,12 +917,12 @@</span>
          {
            CF2_UInt  count = cf2_stack_count( opStack );
            CF2_UInt  idx   = 0;
  
  
<span class="udiff-line-modified-removed">-           FT_TRACE4(( op1 == cf2_cmdRCURVELINE ? &quot; rcurveline\n&quot;</span>
<span class="udiff-line-modified-removed">-                                                : &quot; rrcurveto\n&quot; ));</span>
<span class="udiff-line-modified-added">+           FT_TRACE4(( &quot;%s\n&quot;, op1 == cf2_cmdRCURVELINE ? &quot; rcurveline&quot;</span>
<span class="udiff-line-modified-added">+                                                        : &quot; rrcurveto&quot; ));</span>
  
            while ( idx + 6 &lt;= count )
            {
              CF2_Fixed  x1, y1, x2, y2, x3, y3;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -955,14 +958,14 @@</span>
        case cf2_cmdCLOSEPATH:
          if ( !font-&gt;isT1 )
            FT_TRACE4(( &quot; unknown op (%d)\n&quot;, op1 ));
          else
          {
<span class="udiff-line-modified-removed">-           FT_TRACE4(( &quot; closepath&quot; ));</span>
<span class="udiff-line-modified-added">+           FT_TRACE4(( &quot; closepath\n&quot; ));</span>
  
            /* if there is no path, `closepath&#39; is a no-op */
<span class="udiff-line-modified-removed">-           ps_builder_close_contour( &amp;decoder-&gt;builder );</span>
<span class="udiff-line-modified-added">+           cf2_glyphpath_closeOpenPath( &amp;glyphPath );</span>
  
            haveWidth = TRUE;
          }
          break;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -970,12 +973,12 @@</span>
        case cf2_cmdCALLSUBR:
          {
            CF2_Int  subrNum;
  
  
<span class="udiff-line-modified-removed">-           FT_TRACE4(( op1 == cf2_cmdCALLGSUBR ? &quot; callgsubr&quot;</span>
<span class="udiff-line-modified-removed">-                                               : &quot; callsubr&quot; ));</span>
<span class="udiff-line-modified-added">+           FT_TRACE4(( &quot;%s&quot;, op1 == cf2_cmdCALLGSUBR ? &quot; callgsubr&quot;</span>
<span class="udiff-line-modified-added">+                                                     : &quot; callsubr&quot; ));</span>
  
            if ( ( !font-&gt;isT1 &amp;&amp; charstringIndex &gt; CF2_MAX_SUBR )       ||
                 (  font-&gt;isT1 &amp;&amp; charstringIndex &gt; T1_MAX_SUBRS_CALLS ) )
            {
              /* max subr plus one for charstring */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1210,12 +1213,12 @@</span>
                        CF2_F16Dot16  v0, v1, v2;
  
                        FT_Bool  isV = FT_BOOL( op2 == cf2_escVSTEM3 );
  
  
<span class="udiff-line-modified-removed">-                       FT_TRACE4(( isV ? &quot; vstem3\n&quot;</span>
<span class="udiff-line-modified-removed">-                                       : &quot; hstem3\n&quot; ));</span>
<span class="udiff-line-modified-added">+                       FT_TRACE4(( &quot;%s\n&quot;, isV ? &quot; vstem3&quot;</span>
<span class="udiff-line-modified-added">+                                               : &quot; hstem3&quot; ));</span>
  
                        FT_ASSERT( cf2_stack_count( opStack ) == 6 );
  
                        v0 = cf2_stack_getReal( opStack, 0 );
                        v1 = cf2_stack_getReal( opStack, 2 );
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1642,20 +1645,21 @@</span>
                      FT_TRACE4(( &quot; callothersubr\n&quot; ));
  
                      subr_no = cf2_stack_popInt( opStack );
                      arg_cnt = cf2_stack_popInt( opStack );
  
<span class="udiff-line-modified-removed">-                     /*******************************************************/</span>
<span class="udiff-line-modified-removed">-                     /*                                                     */</span>
<span class="udiff-line-modified-removed">-                     /* remove all operands to callothersubr from the stack */</span>
<span class="udiff-line-modified-removed">-                     /*                                                     */</span>
<span class="udiff-line-modified-removed">-                     /* for handled othersubrs, where we know the number of */</span>
<span class="udiff-line-modified-removed">-                     /* arguments, we increase the stack by the value of    */</span>
<span class="udiff-line-modified-removed">-                     /* known_othersubr_result_cnt                          */</span>
<span class="udiff-line-modified-removed">-                     /*                                                     */</span>
<span class="udiff-line-modified-removed">-                     /* for unhandled othersubrs the following pops adjust  */</span>
<span class="udiff-line-modified-removed">-                     /* the stack pointer as necessary                      */</span>
<span class="udiff-line-modified-added">+                     /********************************************************</span>
<span class="udiff-line-modified-added">+                      *</span>
<span class="udiff-line-modified-added">+                      * remove all operands to callothersubr from the stack</span>
<span class="udiff-line-modified-added">+                      *</span>
<span class="udiff-line-modified-added">+                      * for handled othersubrs, where we know the number of</span>
<span class="udiff-line-modified-added">+                      * arguments, we increase the stack by the value of</span>
<span class="udiff-line-modified-added">+                      * known_othersubr_result_cnt</span>
<span class="udiff-line-modified-added">+                      *</span>
<span class="udiff-line-modified-added">+                      * for unhandled othersubrs the following pops adjust</span>
<span class="udiff-line-modified-added">+                      * the stack pointer as necessary</span>
<span class="udiff-line-added">+                      */</span>
  
                      count = cf2_stack_count( opStack );
                      FT_ASSERT( (CF2_UInt)arg_cnt &lt;= count );
  
                      opIdx += count - (CF2_UInt)arg_cnt;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2414,11 +2418,11 @@</span>
          {
            CF2_Fixed    lsb_x;
            PS_Builder*  builder;
  
  
<span class="udiff-line-modified-removed">-           FT_TRACE4(( &quot; hsbw&quot; ));</span>
<span class="udiff-line-modified-added">+           FT_TRACE4(( &quot; hsbw\n&quot; ));</span>
  
            builder = &amp;decoder-&gt;builder;
  
            builder-&gt;advance-&gt;x = cf2_stack_popFixed( opStack );
            builder-&gt;advance-&gt;y = 0;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2560,11 +2564,11 @@</span>
  
        case cf2_cmdCNTRMASK:
        case cf2_cmdHINTMASK:
          /* the final \n in the tracing message gets added in      */
          /* `cf2_hintmask_read&#39; (which also traces the mask bytes) */
<span class="udiff-line-modified-removed">-         FT_TRACE4(( op1 == cf2_cmdCNTRMASK ? &quot; cntrmask&quot; : &quot; hintmask&quot; ));</span>
<span class="udiff-line-modified-added">+         FT_TRACE4(( &quot;%s&quot;, op1 == cf2_cmdCNTRMASK ? &quot; cntrmask&quot; : &quot; hintmask&quot; ));</span>
  
          /* never add hints after the mask is computed */
          if ( cf2_stack_count( opStack ) &gt; 1    &amp;&amp;
               cf2_hintmask_isValid( &amp;hintMask ) )
          {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2826,11 +2830,11 @@</span>
            /* second bit                                       */
            /* (and sorting the stack indexing to suit)         */
            count = count1 &amp; ~2U;
            idx  += count1 - count;
  
<span class="udiff-line-modified-removed">-           FT_TRACE4(( alternate ? &quot; hvcurveto\n&quot; : &quot; vhcurveto\n&quot; ));</span>
<span class="udiff-line-modified-added">+           FT_TRACE4(( &quot;%s\n&quot;, alternate ? &quot; hvcurveto&quot; : &quot; vhcurveto&quot; ));</span>
  
            while ( idx &lt; count )
            {
              CF2_Fixed x1, x2, x3, y1, y2, y3;
  
</pre>
<center><a href="pshints.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="psintrp.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>