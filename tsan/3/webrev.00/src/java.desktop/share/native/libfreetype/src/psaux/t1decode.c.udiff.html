<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/share/native/libfreetype/src/psaux/t1decode.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="t1cmap.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="t1decode.h.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/psaux/t1decode.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,21 +1,21 @@</span>
<span class="udiff-line-modified-removed">- /***************************************************************************/</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  t1decode.c                                                             */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*    PostScript Type 1 decoding routines (body).                          */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  Copyright 2000-2018 by                                                 */</span>
<span class="udiff-line-modified-removed">- /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="udiff-line-modified-removed">- /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="udiff-line-modified-removed">- /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="udiff-line-modified-removed">- /*  this file you indicate that you have read the license and              */</span>
<span class="udiff-line-modified-removed">- /*  understand and accept it fully.                                        */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /***************************************************************************/</span>
<span class="udiff-line-modified-added">+ /****************************************************************************</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * t1decode.c</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  *   PostScript Type 1 decoding routines (body).</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * Copyright (C) 2000-2019 by</span>
<span class="udiff-line-modified-added">+  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * This file is part of the FreeType project, and may only be used,</span>
<span class="udiff-line-modified-added">+  * modified, and distributed under the terms of the FreeType project</span>
<span class="udiff-line-modified-added">+  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="udiff-line-modified-added">+  * this file you indicate that you have read the license and</span>
<span class="udiff-line-modified-added">+  * understand and accept it fully.</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  */</span>
  
  
  #include &lt;ft2build.h&gt;
  #include FT_INTERNAL_CALC_H
  #include FT_INTERNAL_DEBUG_H
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -29,18 +29,18 @@</span>
  #include &quot;psauxerr.h&quot;
  
  /* ensure proper sign extension */
  #define Fix2Int( f )  ( (FT_Int)(FT_Short)( (f) &gt;&gt; 16 ) )
  
<span class="udiff-line-modified-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="udiff-line-modified-removed">-   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="udiff-line-modified-removed">-   /* messages during execution.                                            */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-added">+   /**************************************************************************</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="udiff-line-modified-added">+    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="udiff-line-modified-added">+    * messages during execution.</span>
<span class="udiff-line-modified-added">+    */</span>
  #undef  FT_COMPONENT
<span class="udiff-line-modified-removed">- #define FT_COMPONENT  trace_t1decode</span>
<span class="udiff-line-modified-added">+ #define FT_COMPONENT  t1decode</span>
  
  
    typedef enum  T1_Operator_
    {
      op_none = 0,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -107,28 +107,30 @@</span>
      2, /* setcurrentpoint */
      2  /* opcode 15 (undocumented and obsolete) */
    };
  
  
<span class="udiff-line-modified-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Function&gt;                                                            */</span>
<span class="udiff-line-modified-removed">-   /*    t1_lookup_glyph_by_stdcharcode_ps                                  */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Description&gt;                                                         */</span>
<span class="udiff-line-modified-removed">-   /*    Looks up a given glyph by its StandardEncoding charcode.  Used to  */</span>
<span class="udiff-line-modified-removed">-   /*    implement the SEAC Type 1 operator in the Adobe engine             */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Input&gt;                                                               */</span>
<span class="udiff-line-modified-removed">-   /*    face     :: The current face object.                               */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*    charcode :: The character code to look for.                        */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Return&gt;                                                              */</span>
<span class="udiff-line-modified-removed">-   /*    A glyph index in the font face.  Returns -1 if the corresponding   */</span>
<span class="udiff-line-modified-removed">-   /*    glyph wasn&#39;t found.                                                */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-added">+   /**************************************************************************</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Function:</span>
<span class="udiff-line-modified-added">+    *   t1_lookup_glyph_by_stdcharcode_ps</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Description:</span>
<span class="udiff-line-modified-added">+    *   Looks up a given glyph by its StandardEncoding charcode.  Used to</span>
<span class="udiff-line-modified-added">+    *   implement the SEAC Type 1 operator in the Adobe engine</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Input:</span>
<span class="udiff-line-modified-added">+    *   face ::</span>
<span class="udiff-line-modified-added">+    *     The current face object.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    *   charcode ::</span>
<span class="udiff-line-modified-added">+    *     The character code to look for.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Return:</span>
<span class="udiff-line-modified-added">+    *   A glyph index in the font face.  Returns -1 if the corresponding</span>
<span class="udiff-line-added">+    *   glyph wasn&#39;t found.</span>
<span class="udiff-line-added">+    */</span>
    FT_LOCAL_DEF( FT_Int )
    t1_lookup_glyph_by_stdcharcode_ps( PS_Decoder*  decoder,
                                       FT_Int       charcode )
    {
      FT_UInt             n;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -157,28 +159,31 @@</span>
      return -1;
    }
  
  
  #ifdef T1_CONFIG_OPTION_OLD_ENGINE
<span class="udiff-line-modified-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Function&gt;                                                            */</span>
<span class="udiff-line-modified-removed">-   /*    t1_lookup_glyph_by_stdcharcode                                     */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Description&gt;                                                         */</span>
<span class="udiff-line-modified-removed">-   /*    Looks up a given glyph by its StandardEncoding charcode.  Used to  */</span>
<span class="udiff-line-modified-removed">-   /*    implement the SEAC Type 1 operator.                                */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Input&gt;                                                               */</span>
<span class="udiff-line-modified-removed">-   /*    face     :: The current face object.                               */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*    charcode :: The character code to look for.                        */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Return&gt;                                                              */</span>
<span class="udiff-line-modified-removed">-   /*    A glyph index in the font face.  Returns -1 if the corresponding   */</span>
<span class="udiff-line-modified-removed">-   /*    glyph wasn&#39;t found.                                                */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   /**************************************************************************</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Function:</span>
<span class="udiff-line-modified-added">+    *   t1_lookup_glyph_by_stdcharcode</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Description:</span>
<span class="udiff-line-modified-added">+    *   Looks up a given glyph by its StandardEncoding charcode.  Used to</span>
<span class="udiff-line-modified-added">+    *   implement the SEAC Type 1 operator.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Input:</span>
<span class="udiff-line-modified-added">+    *   face ::</span>
<span class="udiff-line-modified-added">+    *     The current face object.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    *   charcode ::</span>
<span class="udiff-line-modified-added">+    *     The character code to look for.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Return:</span>
<span class="udiff-line-added">+    *   A glyph index in the font face.  Returns -1 if the corresponding</span>
<span class="udiff-line-added">+    *   glyph wasn&#39;t found.</span>
<span class="udiff-line-added">+    */</span>
    static FT_Int
    t1_lookup_glyph_by_stdcharcode( T1_Decoder  decoder,
                                    FT_Int      charcode )
    {
      FT_UInt             n;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -215,34 +220,40 @@</span>
    {
      return decoder-&gt;parse_callback( decoder, glyph );
    }
  
  
<span class="udiff-line-modified-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Function&gt;                                                            */</span>
<span class="udiff-line-modified-removed">-   /*    t1operator_seac                                                    */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Description&gt;                                                         */</span>
<span class="udiff-line-modified-removed">-   /*    Implements the `seac&#39; Type 1 operator for a Type 1 decoder.        */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Input&gt;                                                               */</span>
<span class="udiff-line-modified-removed">-   /*    decoder :: The current CID decoder.                                */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*    asb     :: The accent&#39;s side bearing.                              */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*    adx     :: The horizontal offset of the accent.                    */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*    ady     :: The vertical offset of the accent.                      */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*    bchar   :: The base character&#39;s StandardEncoding charcode.         */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*    achar   :: The accent character&#39;s StandardEncoding charcode.       */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Return&gt;                                                              */</span>
<span class="udiff-line-modified-removed">-   /*    FreeType error code.  0 means success.                             */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-added">+   /**************************************************************************</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Function:</span>
<span class="udiff-line-modified-added">+    *   t1operator_seac</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Description:</span>
<span class="udiff-line-modified-added">+    *   Implements the `seac&#39; Type 1 operator for a Type 1 decoder.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Input:</span>
<span class="udiff-line-modified-added">+    *   decoder ::</span>
<span class="udiff-line-modified-added">+    *     The current CID decoder.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    *   asb ::</span>
<span class="udiff-line-modified-added">+    *     The accent&#39;s side bearing.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    *   adx ::</span>
<span class="udiff-line-modified-added">+    *     The horizontal offset of the accent.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    *   ady ::</span>
<span class="udiff-line-modified-added">+    *     The vertical offset of the accent.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    *   bchar ::</span>
<span class="udiff-line-modified-added">+    *     The base character&#39;s StandardEncoding charcode.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-added">+    *   achar ::</span>
<span class="udiff-line-added">+    *     The accent character&#39;s StandardEncoding charcode.</span>
<span class="udiff-line-added">+    *</span>
<span class="udiff-line-added">+    * @Return:</span>
<span class="udiff-line-added">+    *   FreeType error code.  0 means success.</span>
<span class="udiff-line-added">+    */</span>
    static FT_Error
    t1operator_seac( T1_Decoder  decoder,
                     FT_Pos      asb,
                     FT_Pos      adx,
                     FT_Pos      ady,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -397,28 +408,31 @@</span>
    Exit:
      return error;
    }
  
  
<span class="udiff-line-modified-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Function&gt;                                                            */</span>
<span class="udiff-line-modified-removed">-   /*    t1_decoder_parse_charstrings                                       */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Description&gt;                                                         */</span>
<span class="udiff-line-modified-removed">-   /*    Parses a given Type 1 charstrings program.                         */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Input&gt;                                                               */</span>
<span class="udiff-line-modified-removed">-   /*    decoder         :: The current Type 1 decoder.                     */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*    charstring_base :: The base address of the charstring stream.      */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*    charstring_len  :: The length in bytes of the charstring stream.   */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Return&gt;                                                              */</span>
<span class="udiff-line-modified-removed">-   /*    FreeType error code.  0 means success.                             */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-added">+   /**************************************************************************</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Function:</span>
<span class="udiff-line-modified-added">+    *   t1_decoder_parse_charstrings</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Description:</span>
<span class="udiff-line-modified-added">+    *   Parses a given Type 1 charstrings program.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Input:</span>
<span class="udiff-line-modified-added">+    *   decoder ::</span>
<span class="udiff-line-modified-added">+    *     The current Type 1 decoder.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    *   charstring_base ::</span>
<span class="udiff-line-modified-added">+    *     The base address of the charstring stream.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    *   charstring_len ::</span>
<span class="udiff-line-modified-added">+    *     The length in bytes of the charstring stream.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-added">+    * @Return:</span>
<span class="udiff-line-added">+    *   FreeType error code.  0 means success.</span>
<span class="udiff-line-added">+    */</span>
    FT_LOCAL_DEF( FT_Error )
    t1_decoder_parse_charstrings( T1_Decoder  decoder,
                                  FT_Byte*    charstring_base,
                                  FT_UInt     charstring_len )
    {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -464,13 +478,10 @@</span>
                 ( decoder-&gt;buildchar == NULL )  );
  
      if ( decoder-&gt;buildchar &amp;&amp; decoder-&gt;len_buildchar &gt; 0 )
        FT_ARRAY_ZERO( decoder-&gt;buildchar, decoder-&gt;len_buildchar );
  
<span class="udiff-line-removed">-     FT_TRACE4(( &quot;\n&quot;</span>
<span class="udiff-line-removed">-                 &quot;Start charstring\n&quot; ));</span>
<span class="udiff-line-removed">- </span>
      zone-&gt;base           = charstring_base;
      limit = zone-&gt;limit  = charstring_base + charstring_len;
      ip    = zone-&gt;cursor = zone-&gt;base;
  
      error = FT_Err_Ok;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -501,15 +512,15 @@</span>
          FT_TRACE5(( &quot; (%d)&quot;, decoder-&gt;top - decoder-&gt;stack ));
          bol = FALSE;
        }
  #endif
  
<span class="udiff-line-modified-removed">-       /*********************************************************************/</span>
<span class="udiff-line-modified-removed">-       /*                                                                   */</span>
<span class="udiff-line-modified-removed">-       /* Decode operator or operand                                        */</span>
<span class="udiff-line-modified-removed">-       /*                                                                   */</span>
<span class="udiff-line-modified-removed">-       /*                                                                   */</span>
<span class="udiff-line-modified-added">+       /**********************************************************************</span>
<span class="udiff-line-modified-added">+        *</span>
<span class="udiff-line-modified-added">+        * Decode operator or operand</span>
<span class="udiff-line-modified-added">+        *</span>
<span class="udiff-line-modified-added">+        */</span>
  
        /* first of all, decompress operator or value */
        switch ( *ip++ )
        {
        case 1:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -708,15 +719,15 @@</span>
                     &quot; no `div&#39; after large integer\n&quot; ));
  
          large_int = FALSE;
        }
  
<span class="udiff-line-modified-removed">-       /*********************************************************************/</span>
<span class="udiff-line-modified-removed">-       /*                                                                   */</span>
<span class="udiff-line-modified-removed">-       /*  Push value on stack, or process operator                         */</span>
<span class="udiff-line-modified-removed">-       /*                                                                   */</span>
<span class="udiff-line-modified-removed">-       /*                                                                   */</span>
<span class="udiff-line-modified-added">+       /**********************************************************************</span>
<span class="udiff-line-modified-added">+        *</span>
<span class="udiff-line-modified-added">+        * Push value on stack, or process operator</span>
<span class="udiff-line-modified-added">+        *</span>
<span class="udiff-line-modified-added">+        */</span>
        if ( op == op_none )
        {
          if ( top - decoder-&gt;stack &gt;= T1_MAX_CHARSTRINGS_OPERANDS )
          {
            FT_ERROR(( &quot;t1_decoder_parse_charstrings: stack overflow\n&quot; ));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -750,20 +761,21 @@</span>
          top -= 2;
  
          subr_no = Fix2Int( top[1] );
          arg_cnt = Fix2Int( top[0] );
  
<span class="udiff-line-modified-removed">-         /***********************************************************/</span>
<span class="udiff-line-modified-removed">-         /*                                                         */</span>
<span class="udiff-line-modified-removed">-         /* remove all operands to callothersubr from the stack     */</span>
<span class="udiff-line-modified-removed">-         /*                                                         */</span>
<span class="udiff-line-modified-removed">-         /* for handled othersubrs, where we know the number of     */</span>
<span class="udiff-line-modified-removed">-         /* arguments, we increase the stack by the value of        */</span>
<span class="udiff-line-modified-removed">-         /* known_othersubr_result_cnt                              */</span>
<span class="udiff-line-modified-removed">-         /*                                                         */</span>
<span class="udiff-line-modified-removed">-         /* for unhandled othersubrs the following pops adjust the  */</span>
<span class="udiff-line-modified-removed">-         /* stack pointer as necessary                              */</span>
<span class="udiff-line-modified-added">+         /************************************************************</span>
<span class="udiff-line-modified-added">+          *</span>
<span class="udiff-line-modified-added">+          * remove all operands to callothersubr from the stack</span>
<span class="udiff-line-modified-added">+          *</span>
<span class="udiff-line-modified-added">+          * for handled othersubrs, where we know the number of</span>
<span class="udiff-line-modified-added">+          * arguments, we increase the stack by the value of</span>
<span class="udiff-line-modified-added">+          * known_othersubr_result_cnt</span>
<span class="udiff-line-modified-added">+          *</span>
<span class="udiff-line-modified-added">+          * for unhandled othersubrs the following pops adjust the</span>
<span class="udiff-line-modified-added">+          * stack pointer as necessary</span>
<span class="udiff-line-added">+          */</span>
  
          if ( arg_cnt &gt; top - decoder-&gt;stack )
            goto Stack_Underflow;
  
          top -= arg_cnt;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1221,11 +1233,14 @@</span>
  
            /* the `metrics_only&#39; indicates that we only want to compute */
            /* the glyph&#39;s metrics (lsb + advance width), not load the   */
            /* rest of it; so exit immediately                           */
            if ( builder-&gt;metrics_only )
<span class="udiff-line-added">+           {</span>
<span class="udiff-line-added">+             FT_TRACE4(( &quot;\n&quot; ));</span>
              return FT_Err_Ok;
<span class="udiff-line-added">+           }</span>
  
            break;
  
          case op_seac:
            return t1operator_seac( decoder,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1253,11 +1268,14 @@</span>
  
            /* the `metrics_only&#39; indicates that we only want to compute */
            /* the glyph&#39;s metrics (lsb + advance width), not load the   */
            /* rest of it; so exit immediately                           */
            if ( builder-&gt;metrics_only )
<span class="udiff-line-added">+           {</span>
<span class="udiff-line-added">+             FT_TRACE4(( &quot;\n&quot; ));</span>
              return FT_Err_Ok;
<span class="udiff-line-added">+           }</span>
  
            break;
  
          case op_closepath:
            FT_TRACE4(( &quot; closepath&quot; ));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1636,30 +1654,35 @@</span>
  
    Stack_Underflow:
      return FT_THROW( Stack_Underflow );
    }
  
<span class="udiff-line-modified-removed">- #else /* T1_CONFIG_OPTION_OLD_ENGINE */</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Function&gt;                                                            */</span>
<span class="udiff-line-modified-removed">-   /*    t1_decoder_parse_metrics                                           */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Description&gt;                                                         */</span>
<span class="udiff-line-modified-removed">-   /*    Parses a given Type 1 charstrings program to extract width         */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Input&gt;                                                               */</span>
<span class="udiff-line-modified-removed">-   /*    decoder         :: The current Type 1 decoder.                     */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*    charstring_base :: The base address of the charstring stream.      */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*    charstring_len  :: The length in bytes of the charstring stream.   */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Return&gt;                                                              */</span>
<span class="udiff-line-modified-removed">-   /*    FreeType error code.  0 means success.                             */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ #else /* !T1_CONFIG_OPTION_OLD_ENGINE */</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   /**************************************************************************</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Function:</span>
<span class="udiff-line-modified-added">+    *   t1_decoder_parse_metrics</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Description:</span>
<span class="udiff-line-modified-added">+    *   Parses a given Type 1 charstrings program to extract width</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Input:</span>
<span class="udiff-line-modified-added">+    *   decoder ::</span>
<span class="udiff-line-modified-added">+    *     The current Type 1 decoder.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    *   charstring_base ::</span>
<span class="udiff-line-modified-added">+    *     The base address of the charstring stream.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    *   charstring_len ::</span>
<span class="udiff-line-added">+    *     The length in bytes of the charstring stream.</span>
<span class="udiff-line-added">+    *</span>
<span class="udiff-line-added">+    * @Return:</span>
<span class="udiff-line-added">+    *   FreeType error code.  0 means success.</span>
<span class="udiff-line-added">+    */</span>
    FT_LOCAL_DEF( FT_Error )
    t1_decoder_parse_metrics( T1_Decoder  decoder,
                              FT_Byte*    charstring_base,
                              FT_UInt     charstring_len )
    {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1678,13 +1701,10 @@</span>
      decoder-&gt;zone = decoder-&gt;zones;
      zone          = decoder-&gt;zones;
  
      builder-&gt;parse_state = T1_Parse_Start;
  
<span class="udiff-line-removed">-     FT_TRACE4(( &quot;\n&quot;</span>
<span class="udiff-line-removed">-                 &quot;Start charstring: get width\n&quot; ));</span>
<span class="udiff-line-removed">- </span>
      zone-&gt;base           = charstring_base;
      limit = zone-&gt;limit  = charstring_base + charstring_len;
      ip    = zone-&gt;cursor = zone-&gt;base;
  
      /* now, execute loop */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1701,15 +1721,15 @@</span>
          FT_TRACE5(( &quot; (%d)&quot;, decoder-&gt;top - decoder-&gt;stack ));
          bol = FALSE;
        }
  #endif
  
<span class="udiff-line-modified-removed">-       /*********************************************************************/</span>
<span class="udiff-line-modified-removed">-       /*                                                                   */</span>
<span class="udiff-line-modified-removed">-       /* Decode operator or operand                                        */</span>
<span class="udiff-line-modified-removed">-       /*                                                                   */</span>
<span class="udiff-line-modified-removed">-       /*                                                                   */</span>
<span class="udiff-line-modified-added">+       /**********************************************************************</span>
<span class="udiff-line-modified-added">+        *</span>
<span class="udiff-line-modified-added">+        * Decode operator or operand</span>
<span class="udiff-line-modified-added">+        *</span>
<span class="udiff-line-modified-added">+        */</span>
  
        /* first of all, decompress operator or value */
        switch ( *ip++ )
        {
        case 1:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1815,15 +1835,15 @@</span>
                       &quot; invalid byte (%d)\n&quot;, ip[-1] ));
            goto Syntax_Error;
          }
        }
  
<span class="udiff-line-modified-removed">-       /*********************************************************************/</span>
<span class="udiff-line-modified-removed">-       /*                                                                   */</span>
<span class="udiff-line-modified-removed">-       /*  Push value on stack, or process operator                         */</span>
<span class="udiff-line-modified-removed">-       /*                                                                   */</span>
<span class="udiff-line-modified-removed">-       /*                                                                   */</span>
<span class="udiff-line-modified-added">+       /**********************************************************************</span>
<span class="udiff-line-modified-added">+        *</span>
<span class="udiff-line-modified-added">+        * Push value on stack, or process operator</span>
<span class="udiff-line-modified-added">+        *</span>
<span class="udiff-line-modified-added">+        */</span>
        if ( op == op_none )
        {
          if ( top - decoder-&gt;stack &gt;= T1_MAX_CHARSTRINGS_OPERANDS )
          {
            FT_ERROR(( &quot;t1_decoder_parse_metrics: stack overflow\n&quot; ));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1873,10 +1893,11 @@</span>
            builder-&gt;advance.y = 0;
  
            /* we only want to compute the glyph&#39;s metrics */
            /* (lsb + advance width), not load the rest of */
            /* it; so exit immediately                     */
<span class="udiff-line-added">+           FT_TRACE4(( &quot;\n&quot; ));</span>
            return FT_Err_Ok;
  
          case op_sbw:
            FT_TRACE4(( &quot; sbw&quot; ));
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1891,10 +1912,11 @@</span>
            builder-&gt;advance.y = top[3];
  
            /* we only want to compute the glyph&#39;s metrics */
            /* (lsb + advance width), not load the rest of */
            /* it; so exit immediately                     */
<span class="udiff-line-added">+           FT_TRACE4(( &quot;\n&quot; ));</span>
            return FT_Err_Ok;
  
          default:
            FT_ERROR(( &quot;t1_decoder_parse_metrics:&quot;
                       &quot; unhandled opcode %d\n&quot;, op ));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1915,11 +1937,12 @@</span>
      return FT_THROW( Syntax_Error );
  
    Stack_Underflow:
      return FT_THROW( Stack_Underflow );
    }
<span class="udiff-line-modified-removed">- #endif /* T1_CONFIG_OPTION_OLD_ENGINE */</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+ #endif /* !T1_CONFIG_OPTION_OLD_ENGINE */</span>
  
  
    /* initialize T1 decoder */
    FT_LOCAL_DEF( FT_Error )
    t1_decoder_init( T1_Decoder           decoder,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1932,11 +1955,11 @@</span>
                     FT_Render_Mode       hint_mode,
                     T1_Decoder_Callback  parse_callback )
    {
      FT_ZERO( decoder );
  
<span class="udiff-line-modified-removed">-     /* retrieve PSNames interface from list of current modules */</span>
<span class="udiff-line-modified-added">+     /* retrieve `psnames&#39; interface from list of current modules */</span>
      {
        FT_Service_PsCMaps  psnames;
  
  
        FT_FACE_FIND_GLOBAL_SERVICE( face, psnames, POSTSCRIPT_CMAPS );
</pre>
<center><a href="t1cmap.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="t1decode.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>