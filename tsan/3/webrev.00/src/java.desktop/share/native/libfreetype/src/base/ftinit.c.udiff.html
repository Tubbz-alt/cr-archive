<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/share/native/libfreetype/src/base/ftinit.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="fthash.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ftlcdfil.c.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/base/ftinit.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,63 +1,59 @@</span>
<span class="udiff-line-modified-removed">- /***************************************************************************/</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  ftinit.c                                                               */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*    FreeType initialization layer (body).                                */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  Copyright 1996-2018 by                                                 */</span>
<span class="udiff-line-modified-removed">- /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="udiff-line-modified-removed">- /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="udiff-line-modified-removed">- /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="udiff-line-modified-removed">- /*  this file you indicate that you have read the license and              */</span>
<span class="udiff-line-modified-removed">- /*  understand and accept it fully.                                        */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /***************************************************************************/</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*  The purpose of this file is to implement the following two           */</span>
<span class="udiff-line-modified-removed">-   /*  functions:                                                           */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*  FT_Add_Default_Modules():                                            */</span>
<span class="udiff-line-modified-removed">-   /*     This function is used to add the set of default modules to a      */</span>
<span class="udiff-line-modified-removed">-   /*     fresh new library object.  The set is taken from the header file  */</span>
<span class="udiff-line-modified-removed">-   /*     `freetype/config/ftmodule.h&#39;.  See the document `FreeType 2.0     */</span>
<span class="udiff-line-modified-removed">-   /*     Build System&#39; for more information.                               */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*  FT_Init_FreeType():                                                  */</span>
<span class="udiff-line-modified-removed">-   /*     This function creates a system object for the current platform,   */</span>
<span class="udiff-line-modified-removed">-   /*     builds a library out of it, then calls FT_Default_Drivers().      */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*  Note that even if FT_Init_FreeType() uses the implementation of the  */</span>
<span class="udiff-line-modified-removed">-   /*  system object defined at build time, client applications are still   */</span>
<span class="udiff-line-modified-removed">-   /*  able to provide their own `ftsystem.c&#39;.                              */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-added">+ /****************************************************************************</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * ftinit.c</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  *   FreeType initialization layer (body).</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * Copyright (C) 1996-2019 by</span>
<span class="udiff-line-modified-added">+  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * This file is part of the FreeType project, and may only be used,</span>
<span class="udiff-line-modified-added">+  * modified, and distributed under the terms of the FreeType project</span>
<span class="udiff-line-modified-added">+  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="udiff-line-modified-added">+  * this file you indicate that you have read the license and</span>
<span class="udiff-line-modified-added">+  * understand and accept it fully.</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  */</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   /**************************************************************************</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * The purpose of this file is to implement the following two</span>
<span class="udiff-line-modified-added">+    * functions:</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * FT_Add_Default_Modules():</span>
<span class="udiff-line-modified-added">+    *   This function is used to add the set of default modules to a</span>
<span class="udiff-line-modified-added">+    *   fresh new library object.  The set is taken from the header file</span>
<span class="udiff-line-modified-added">+    *   `freetype/config/ftmodule.h&#39;.  See the document `FreeType 2.0</span>
<span class="udiff-line-modified-added">+    *   Build System&#39; for more information.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * FT_Init_FreeType():</span>
<span class="udiff-line-modified-added">+    *   This function creates a system object for the current platform,</span>
<span class="udiff-line-modified-added">+    *   builds a library out of it, then calls FT_Default_Drivers().</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * Note that even if FT_Init_FreeType() uses the implementation of the</span>
<span class="udiff-line-modified-added">+    * system object defined at build time, client applications are still</span>
<span class="udiff-line-modified-added">+    * able to provide their own `ftsystem.c&#39;.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    */</span>
  
  
  #include &lt;ft2build.h&gt;
  #include FT_CONFIG_CONFIG_H
  #include FT_INTERNAL_OBJECTS_H
  #include FT_INTERNAL_DEBUG_H
  #include FT_MODULE_H
<span class="udiff-line-removed">- #include &quot;basepic.h&quot;</span>
  
  
<span class="udiff-line-modified-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="udiff-line-modified-removed">-   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="udiff-line-modified-removed">-   /* messages during execution.                                            */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-added">+   /**************************************************************************</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="udiff-line-modified-added">+    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="udiff-line-modified-added">+    * messages during execution.</span>
<span class="udiff-line-modified-added">+    */</span>
  #undef  FT_COMPONENT
<span class="udiff-line-modified-removed">- #define FT_COMPONENT  trace_init</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- #ifndef FT_CONFIG_OPTION_PIC</span>
<span class="udiff-line-modified-added">+ #define FT_COMPONENT  init</span>
  
  
  #undef  FT_USE_MODULE
  #ifdef __cplusplus
  #define FT_USE_MODULE( type, x )  extern &quot;C&quot; const type  x;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -76,143 +72,23 @@</span>
  #include FT_CONFIG_MODULES_H
      0
    };
  
  
<span class="udiff-line-removed">- #else /* FT_CONFIG_OPTION_PIC */</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- #ifdef __cplusplus</span>
<span class="udiff-line-removed">- #define FT_EXTERNC  extern &quot;C&quot;</span>
<span class="udiff-line-removed">- #else</span>
<span class="udiff-line-removed">- #define FT_EXTERNC  extern</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   /* declare the module&#39;s class creation/destruction functions */</span>
<span class="udiff-line-removed">- #undef  FT_USE_MODULE</span>
<span class="udiff-line-removed">- #define FT_USE_MODULE( type, x )                            \</span>
<span class="udiff-line-removed">-   FT_EXTERNC FT_Error                                       \</span>
<span class="udiff-line-removed">-   FT_Create_Class_ ## x( FT_Library         library,        \</span>
<span class="udiff-line-removed">-                          FT_Module_Class*  *output_class ); \</span>
<span class="udiff-line-removed">-   FT_EXTERNC void                                           \</span>
<span class="udiff-line-removed">-   FT_Destroy_Class_ ## x( FT_Library        library,        \</span>
<span class="udiff-line-removed">-                           FT_Module_Class*  clazz );</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- #include FT_CONFIG_MODULES_H</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   /* count all module classes */</span>
<span class="udiff-line-removed">- #undef  FT_USE_MODULE</span>
<span class="udiff-line-removed">- #define FT_USE_MODULE( type, x )  MODULE_CLASS_ ## x,</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   enum</span>
<span class="udiff-line-removed">-   {</span>
<span class="udiff-line-removed">- #include FT_CONFIG_MODULES_H</span>
<span class="udiff-line-removed">-     FT_NUM_MODULE_CLASSES</span>
<span class="udiff-line-removed">-   };</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   /* destroy all module classes */</span>
<span class="udiff-line-removed">- #undef  FT_USE_MODULE</span>
<span class="udiff-line-removed">- #define FT_USE_MODULE( type, x )                   \</span>
<span class="udiff-line-removed">-   if ( classes[i] )                                \</span>
<span class="udiff-line-removed">-   {                                                \</span>
<span class="udiff-line-removed">-     FT_Destroy_Class_ ## x( library, classes[i] ); \</span>
<span class="udiff-line-removed">-   }                                                \</span>
<span class="udiff-line-removed">-   i++;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   FT_BASE_DEF( void )</span>
<span class="udiff-line-removed">-   ft_destroy_default_module_classes( FT_Library  library )</span>
<span class="udiff-line-removed">-   {</span>
<span class="udiff-line-removed">-     FT_Module_Class*  *classes;</span>
<span class="udiff-line-removed">-     FT_Memory          memory;</span>
<span class="udiff-line-removed">-     FT_UInt            i;</span>
<span class="udiff-line-removed">-     BasePIC*           pic_container = (BasePIC*)library-&gt;pic_container.base;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if ( !pic_container-&gt;default_module_classes )</span>
<span class="udiff-line-removed">-       return;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     memory  = library-&gt;memory;</span>
<span class="udiff-line-removed">-     classes = pic_container-&gt;default_module_classes;</span>
<span class="udiff-line-removed">-     i       = 0;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- #include FT_CONFIG_MODULES_H</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     FT_FREE( classes );</span>
<span class="udiff-line-removed">-     pic_container-&gt;default_module_classes = NULL;</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   /* initialize all module classes and the pointer table */</span>
<span class="udiff-line-removed">- #undef  FT_USE_MODULE</span>
<span class="udiff-line-removed">- #define FT_USE_MODULE( type, x )                     \</span>
<span class="udiff-line-removed">-   error = FT_Create_Class_ ## x( library, &amp;clazz );  \</span>
<span class="udiff-line-removed">-   if ( error )                                       \</span>
<span class="udiff-line-removed">-     goto Exit;                                       \</span>
<span class="udiff-line-removed">-   classes[i++] = clazz;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   FT_BASE_DEF( FT_Error )</span>
<span class="udiff-line-removed">-   ft_create_default_module_classes( FT_Library  library )</span>
<span class="udiff-line-removed">-   {</span>
<span class="udiff-line-removed">-     FT_Error           error;</span>
<span class="udiff-line-removed">-     FT_Memory          memory;</span>
<span class="udiff-line-removed">-     FT_Module_Class*  *classes = NULL;</span>
<span class="udiff-line-removed">-     FT_Module_Class*   clazz;</span>
<span class="udiff-line-removed">-     FT_UInt            i;</span>
<span class="udiff-line-removed">-     BasePIC*           pic_container = (BasePIC*)library-&gt;pic_container.base;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     memory = library-&gt;memory;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     pic_container-&gt;default_module_classes = NULL;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if ( FT_ALLOC( classes, sizeof ( FT_Module_Class* ) *</span>
<span class="udiff-line-removed">-                               ( FT_NUM_MODULE_CLASSES + 1 ) ) )</span>
<span class="udiff-line-removed">-       return error;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     /* initialize all pointers to 0, especially the last one */</span>
<span class="udiff-line-removed">-     for ( i = 0; i &lt; FT_NUM_MODULE_CLASSES; i++ )</span>
<span class="udiff-line-removed">-       classes[i] = NULL;</span>
<span class="udiff-line-removed">-     classes[FT_NUM_MODULE_CLASSES] = NULL;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     i = 0;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- #include FT_CONFIG_MODULES_H</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   Exit:</span>
<span class="udiff-line-removed">-     if ( error )</span>
<span class="udiff-line-removed">-       ft_destroy_default_module_classes( library );</span>
<span class="udiff-line-removed">-     else</span>
<span class="udiff-line-removed">-       pic_container-&gt;default_module_classes = classes;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     return error;</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- #endif /* FT_CONFIG_OPTION_PIC */</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- </span>
    /* documentation is in ftmodapi.h */
  
    FT_EXPORT_DEF( void )
    FT_Add_Default_Modules( FT_Library  library )
    {
      FT_Error                       error;
      const FT_Module_Class* const*  cur;
  
  
<span class="udiff-line-removed">-     /* FT_DEFAULT_MODULES_GET dereferences `library&#39; in PIC mode */</span>
<span class="udiff-line-removed">- #ifdef FT_CONFIG_OPTION_PIC</span>
<span class="udiff-line-removed">-     if ( !library )</span>
<span class="udiff-line-removed">-       return;</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">- </span>
      /* GCC 4.6 warns the type difference:
       *   FT_Module_Class** != const FT_Module_Class* const*
       */
<span class="udiff-line-modified-removed">-     cur = (const FT_Module_Class* const*)FT_DEFAULT_MODULES_GET;</span>
<span class="udiff-line-modified-added">+     cur = (const FT_Module_Class* const*)ft_default_modules;</span>
  
      /* test for valid `library&#39; delayed to FT_Add_Module() */
      while ( *cur )
      {
        error = FT_Add_Module( library, *cur );
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -298,10 +174,13 @@</span>
        /* we completely ignore errors */
        ft_property_string_set( library,
                                module_name,
                                property_name,
                                property_value );
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+       if ( !*p )</span>
<span class="udiff-line-added">+         break;</span>
      }
    }
  
  #else
  
</pre>
<center><a href="fthash.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ftlcdfil.c.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>