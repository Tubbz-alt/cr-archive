<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/native/libfreetype/src/truetype/ttdriver.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../smooth/ftsmooth.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ttdriver.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/truetype/ttdriver.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
<span class="line-modified">  1 /***************************************************************************/</span>
<span class="line-modified">  2 /*                                                                         */</span>
<span class="line-modified">  3 /*  ttdriver.c                                                             */</span>
<span class="line-modified">  4 /*                                                                         */</span>
<span class="line-modified">  5 /*    TrueType font driver implementation (body).                          */</span>
<span class="line-modified">  6 /*                                                                         */</span>
<span class="line-modified">  7 /*  Copyright 1996-2018 by                                                 */</span>
<span class="line-modified">  8 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="line-modified">  9 /*                                                                         */</span>
<span class="line-modified"> 10 /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified"> 11 /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified"> 12 /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified"> 13 /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified"> 14 /*  understand and accept it fully.                                        */</span>
<span class="line-modified"> 15 /*                                                                         */</span>
<span class="line-modified"> 16 /***************************************************************************/</span>
 17 
 18 
 19 #include &lt;ft2build.h&gt;
 20 #include FT_INTERNAL_DEBUG_H
 21 #include FT_INTERNAL_STREAM_H
 22 #include FT_INTERNAL_SFNT_H
 23 #include FT_SERVICE_FONT_FORMAT_H
 24 
 25 #ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT
 26 #include FT_MULTIPLE_MASTERS_H
 27 #include FT_SERVICE_MULTIPLE_MASTERS_H
 28 #include FT_SERVICE_METRICS_VARIATIONS_H
 29 #endif
 30 
 31 #include FT_SERVICE_TRUETYPE_ENGINE_H
 32 #include FT_SERVICE_TRUETYPE_GLYF_H
 33 #include FT_SERVICE_PROPERTIES_H
 34 #include FT_DRIVER_H
 35 
 36 #include &quot;ttdriver.h&quot;
 37 #include &quot;ttgload.h&quot;
 38 #include &quot;ttpload.h&quot;
 39 
 40 #ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT
 41 #include &quot;ttgxvar.h&quot;
 42 #endif
 43 
 44 #include &quot;tterrors.h&quot;
 45 
<span class="line-removed"> 46 #include &quot;ttpic.h&quot;</span>
 47 
<span class="line-modified"> 48   /*************************************************************************/</span>
<span class="line-modified"> 49   /*                                                                       */</span>
<span class="line-modified"> 50   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="line-modified"> 51   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="line-modified"> 52   /* messages during execution.                                            */</span>
<span class="line-modified"> 53   /*                                                                       */</span>
 54 #undef  FT_COMPONENT
<span class="line-modified"> 55 #define FT_COMPONENT  trace_ttdriver</span>
 56 
 57 
 58   /*
<span class="line-modified"> 59    *  PROPERTY SERVICE</span>
 60    *
 61    */
 62   static FT_Error
 63   tt_property_set( FT_Module    module,         /* TT_Driver */
 64                    const char*  property_name,
 65                    const void*  value,
 66                    FT_Bool      value_is_string )
 67   {
 68     FT_Error   error  = FT_Err_Ok;
 69     TT_Driver  driver = (TT_Driver)module;
 70 
 71 #ifndef FT_CONFIG_OPTION_ENVIRONMENT_PROPERTIES
 72     FT_UNUSED( value_is_string );
 73 #endif
 74 
 75 
 76     if ( !ft_strcmp( property_name, &quot;interpreter-version&quot; ) )
 77     {
 78       FT_UInt  interpreter_version;
 79 
</pre>
<hr />
<pre>
147     tt_service_properties,
148 
149     (FT_Properties_SetFunc)tt_property_set,     /* set_property */
150     (FT_Properties_GetFunc)tt_property_get      /* get_property */
151   )
152 
153 
154   /*************************************************************************/
155   /*************************************************************************/
156   /*************************************************************************/
157   /****                                                                 ****/
158   /****                                                                 ****/
159   /****                          F A C E S                              ****/
160   /****                                                                 ****/
161   /****                                                                 ****/
162   /*************************************************************************/
163   /*************************************************************************/
164   /*************************************************************************/
165 
166 
<span class="line-modified">167   /*************************************************************************/</span>
<span class="line-modified">168   /*                                                                       */</span>
<span class="line-modified">169   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">170   /*    tt_get_kerning                                                     */</span>
<span class="line-modified">171   /*                                                                       */</span>
<span class="line-modified">172   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">173   /*    A driver method used to return the kerning vector between two      */</span>
<span class="line-modified">174   /*    glyphs of the same face.                                           */</span>
<span class="line-modified">175   /*                                                                       */</span>
<span class="line-modified">176   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">177   /*    face        :: A handle to the source face object.                 */</span>
<span class="line-modified">178   /*                                                                       */</span>
<span class="line-modified">179   /*    left_glyph  :: The index of the left glyph in the kern pair.       */</span>
<span class="line-modified">180   /*                                                                       */</span>
<span class="line-modified">181   /*    right_glyph :: The index of the right glyph in the kern pair.      */</span>
<span class="line-modified">182   /*                                                                       */</span>
<span class="line-modified">183   /* &lt;Output&gt;                                                              */</span>
<span class="line-modified">184   /*    kerning     :: The kerning vector.  This is in font units for      */</span>
<span class="line-modified">185   /*                   scalable formats, and in pixels for fixed-sizes     */</span>
<span class="line-modified">186   /*                   formats.                                            */</span>
<span class="line-modified">187   /*                                                                       */</span>
<span class="line-modified">188   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">189   /*    FreeType error code.  0 means success.                             */</span>
<span class="line-modified">190   /*                                                                       */</span>
<span class="line-modified">191   /* &lt;Note&gt;                                                                */</span>
<span class="line-modified">192   /*    Only horizontal layouts (left-to-right &amp; right-to-left) are        */</span>
<span class="line-modified">193   /*    supported by this function.  Other layouts, or more sophisticated  */</span>
<span class="line-modified">194   /*    kernings, are out of scope of this method (the basic driver        */</span>
<span class="line-modified">195   /*    interface is meant to be simple).                                  */</span>
<span class="line-modified">196   /*                                                                       */</span>
<span class="line-modified">197   /*    They can be implemented by format-specific interfaces.             */</span>
<span class="line-modified">198   /*                                                                       */</span>




199   static FT_Error
200   tt_get_kerning( FT_Face     ttface,          /* TT_Face */
201                   FT_UInt     left_glyph,
202                   FT_UInt     right_glyph,
203                   FT_Vector*  kerning )
204   {
205     TT_Face       face = (TT_Face)ttface;
206     SFNT_Service  sfnt = (SFNT_Service)face-&gt;sfnt;
207 
208 
209     kerning-&gt;x = 0;
210     kerning-&gt;y = 0;
211 
212     if ( sfnt )
213       kerning-&gt;x = sfnt-&gt;get_kerning( face, left_glyph, right_glyph );
214 
215     return 0;
216   }
217 
218 
</pre>
<hr />
<pre>
367                      ? req-&gt;horiResolution
368                      : req-&gt;vertResolution;
369 
370 
371         /* if we don&#39;t have a resolution value, assume 72dpi */
372         if ( req-&gt;type == FT_SIZE_REQUEST_TYPE_SCALES ||
373              !resolution                              )
374           resolution = 72;
375 
376         ttsize-&gt;point_size = FT_MulDiv( ttsize-&gt;ttmetrics.ppem,
377                                         64 * 72,
378                                         resolution );
379       }
380 #endif
381     }
382 
383     return error;
384   }
385 
386 
<span class="line-modified">387   /*************************************************************************/</span>
<span class="line-modified">388   /*                                                                       */</span>
<span class="line-modified">389   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">390   /*    tt_glyph_load                                                      */</span>
<span class="line-modified">391   /*                                                                       */</span>
<span class="line-modified">392   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">393   /*    A driver method used to load a glyph within a given glyph slot.    */</span>
<span class="line-modified">394   /*                                                                       */</span>
<span class="line-modified">395   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">396   /*    slot        :: A handle to the target slot object where the glyph  */</span>
<span class="line-modified">397   /*                   will be loaded.                                     */</span>
<span class="line-modified">398   /*                                                                       */</span>
<span class="line-modified">399   /*    size        :: A handle to the source face size at which the glyph */</span>
<span class="line-modified">400   /*                   must be scaled, loaded, etc.                        */</span>
<span class="line-modified">401   /*                                                                       */</span>
<span class="line-modified">402   /*    glyph_index :: The index of the glyph in the font file.            */</span>
<span class="line-modified">403   /*                                                                       */</span>
<span class="line-modified">404   /*    load_flags  :: A flag indicating what to load for this glyph.  The */</span>
<span class="line-modified">405   /*                   FT_LOAD_XXX constants can be used to control the    */</span>
<span class="line-modified">406   /*                   glyph loading process (e.g., whether the outline    */</span>
<span class="line-modified">407   /*                   should be scaled, whether to load bitmaps or not,   */</span>
<span class="line-modified">408   /*                   whether to hint the outline, etc).                  */</span>
<span class="line-modified">409   /*                                                                       */</span>
<span class="line-modified">410   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">411   /*    FreeType error code.  0 means success.                             */</span>
<span class="line-modified">412   /*                                                                       */</span>




413   static FT_Error
414   tt_glyph_load( FT_GlyphSlot  ttslot,      /* TT_GlyphSlot */
415                  FT_Size       ttsize,      /* TT_Size      */
416                  FT_UInt       glyph_index,
417                  FT_Int32      load_flags )
418   {
419     TT_GlyphSlot  slot = (TT_GlyphSlot)ttslot;
420     TT_Size       size = (TT_Size)ttsize;
421     FT_Face       face = ttslot-&gt;face;
422     FT_Error      error;
423 
424 
425     if ( !slot )
426       return FT_THROW( Invalid_Slot_Handle );
427 
428     if ( !size )
429       return FT_THROW( Invalid_Size_Handle );
430 
431     if ( !face )
432       return FT_THROW( Invalid_Face_Handle );
</pre>
<hr />
<pre>
447       if ( FT_IS_TRICKY( face ) )
448         load_flags &amp;= ~FT_LOAD_NO_HINTING;
449 
450       if ( load_flags &amp; FT_LOAD_NO_AUTOHINT )
451         load_flags |= FT_LOAD_NO_HINTING;
452     }
453 
454     if ( load_flags &amp; ( FT_LOAD_NO_RECURSE | FT_LOAD_NO_SCALE ) )
455     {
456       load_flags |= FT_LOAD_NO_BITMAP | FT_LOAD_NO_SCALE;
457 
458       if ( !FT_IS_TRICKY( face ) )
459         load_flags |= FT_LOAD_NO_HINTING;
460     }
461 
462     /* use hinted metrics only if we load a glyph with hinting */
463     size-&gt;metrics = ( load_flags &amp; FT_LOAD_NO_HINTING )
464                       ? &amp;ttsize-&gt;metrics
465                       : &amp;size-&gt;hinted_metrics;
466 
<span class="line-modified">467     /* now load the glyph outline if necessary */</span>
468     error = TT_Load_Glyph( size, slot, glyph_index, load_flags );
469 
470     /* force drop-out mode to 2 - irrelevant now */
471     /* slot-&gt;outline.dropout_mode = 2; */
472 
473     return error;
474   }
475 
476 
477   /*************************************************************************/
478   /*************************************************************************/
479   /*************************************************************************/
480   /****                                                                 ****/
481   /****                                                                 ****/
482   /****                D R I V E R  I N T E R F A C E                   ****/
483   /****                                                                 ****/
484   /****                                                                 ****/
485   /*************************************************************************/
486   /*************************************************************************/
487   /*************************************************************************/
488 
489 #ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT
490 
491   FT_DEFINE_SERVICE_MULTIMASTERSREC(
492     tt_service_gx_multi_masters,
493 
<span class="line-modified">494     (FT_Get_MM_Func)        NULL,                   /* get_mm         */</span>
<span class="line-modified">495     (FT_Set_MM_Design_Func) NULL,                   /* set_mm_design  */</span>
<span class="line-modified">496     (FT_Set_MM_Blend_Func)  TT_Set_MM_Blend,        /* set_mm_blend   */</span>
<span class="line-modified">497     (FT_Get_MM_Blend_Func)  TT_Get_MM_Blend,        /* get_mm_blend   */</span>
<span class="line-modified">498     (FT_Get_MM_Var_Func)    TT_Get_MM_Var,          /* get_mm_var     */</span>
<span class="line-modified">499     (FT_Set_Var_Design_Func)TT_Set_Var_Design,      /* set_var_design */</span>
<span class="line-modified">500     (FT_Get_Var_Design_Func)TT_Get_Var_Design,      /* get_var_design */</span>
<span class="line-modified">501     (FT_Set_Instance_Func)  TT_Set_Named_Instance,  /* set_instance   */</span>
<span class="line-modified">502 </span>
<span class="line-modified">503     (FT_Get_Var_Blend_Func) tt_get_var_blend,       /* get_var_blend  */</span>
<span class="line-modified">504     (FT_Done_Blend_Func)    tt_done_blend           /* done_blend     */</span>


505   )
506 
507   FT_DEFINE_SERVICE_METRICSVARIATIONSREC(
508     tt_service_metrics_variations,
509 
510     (FT_HAdvance_Adjust_Func)tt_hadvance_adjust,     /* hadvance_adjust */
511     (FT_LSB_Adjust_Func)     NULL,                   /* lsb_adjust      */
512     (FT_RSB_Adjust_Func)     NULL,                   /* rsb_adjust      */
513 
514     (FT_VAdvance_Adjust_Func)tt_vadvance_adjust,     /* vadvance_adjust */
515     (FT_TSB_Adjust_Func)     NULL,                   /* tsb_adjust      */
516     (FT_BSB_Adjust_Func)     NULL,                   /* bsb_adjust      */
517     (FT_VOrg_Adjust_Func)    NULL,                   /* vorg_adjust     */
518 
519     (FT_Metrics_Adjust_Func) tt_apply_mvar           /* metrics_adjust  */
520   )
521 
522 #endif /* TT_CONFIG_OPTION_GX_VAR_SUPPORT */
523 
524 
</pre>
<hr />
<pre>
531 #else /* !TT_USE_BYTECODE_INTERPRETER */
532 
533     FT_TRUETYPE_ENGINE_TYPE_NONE
534 
535 #endif /* TT_USE_BYTECODE_INTERPRETER */
536   };
537 
538 
539   FT_DEFINE_SERVICE_TTGLYFREC(
540     tt_service_truetype_glyf,
541 
542     (TT_Glyf_GetLocationFunc)tt_face_get_location      /* get_location */
543   )
544 
545 
546 #ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT
547   FT_DEFINE_SERVICEDESCREC6(
548     tt_services,
549 
550     FT_SERVICE_ID_FONT_FORMAT,        FT_FONT_FORMAT_TRUETYPE,
<span class="line-modified">551     FT_SERVICE_ID_MULTI_MASTERS,      &amp;TT_SERVICE_GX_MULTI_MASTERS_GET,</span>
<span class="line-modified">552     FT_SERVICE_ID_METRICS_VARIATIONS, &amp;TT_SERVICE_METRICS_VARIATIONS_GET,</span>
553     FT_SERVICE_ID_TRUETYPE_ENGINE,    &amp;tt_service_truetype_engine,
<span class="line-modified">554     FT_SERVICE_ID_TT_GLYF,            &amp;TT_SERVICE_TRUETYPE_GLYF_GET,</span>
<span class="line-modified">555     FT_SERVICE_ID_PROPERTIES,         &amp;TT_SERVICE_PROPERTIES_GET )</span>
556 #else
557   FT_DEFINE_SERVICEDESCREC4(
558     tt_services,
559 
560     FT_SERVICE_ID_FONT_FORMAT,     FT_FONT_FORMAT_TRUETYPE,
561     FT_SERVICE_ID_TRUETYPE_ENGINE, &amp;tt_service_truetype_engine,
<span class="line-modified">562     FT_SERVICE_ID_TT_GLYF,         &amp;TT_SERVICE_TRUETYPE_GLYF_GET,</span>
<span class="line-modified">563     FT_SERVICE_ID_PROPERTIES,      &amp;TT_SERVICE_PROPERTIES_GET )</span>
564 #endif
565 
566 
567   FT_CALLBACK_DEF( FT_Module_Interface )
568   tt_get_interface( FT_Module    driver,    /* TT_Driver */
569                     const char*  tt_interface )
570   {
571     FT_Library           library;
572     FT_Module_Interface  result;
573     FT_Module            sfntd;
574     SFNT_Service         sfnt;
575 
576 
<span class="line-modified">577     /* TT_SERVICES_GET dereferences `library&#39; in PIC mode */</span>
<span class="line-removed">578 #ifdef FT_CONFIG_OPTION_PIC</span>
<span class="line-removed">579     if ( !driver )</span>
<span class="line-removed">580       return NULL;</span>
<span class="line-removed">581     library = driver-&gt;library;</span>
<span class="line-removed">582     if ( !library )</span>
<span class="line-removed">583       return NULL;</span>
<span class="line-removed">584 #endif</span>
<span class="line-removed">585 </span>
<span class="line-removed">586     result = ft_service_list_lookup( TT_SERVICES_GET, tt_interface );</span>
587     if ( result )
588       return result;
589 
<span class="line-removed">590 #ifndef FT_CONFIG_OPTION_PIC</span>
591     if ( !driver )
592       return NULL;
593     library = driver-&gt;library;
594     if ( !library )
595       return NULL;
<span class="line-removed">596 #endif</span>
597 
598     /* only return the default interface from the SFNT module */
599     sfntd = FT_Get_Module( library, &quot;sfnt&quot; );
600     if ( sfntd )
601     {
602       sfnt = (SFNT_Service)( sfntd-&gt;clazz-&gt;module_interface );
603       if ( sfnt )
604         return sfnt-&gt;get_interface( driver, tt_interface );
605     }
606 
607     return 0;
608   }
609 
610 
611   /* The FT_DriverInterface structure is defined in ftdriver.h. */
612 
613 #ifdef TT_USE_BYTECODE_INTERPRETER
614 #define TT_HINTER_FLAG  FT_MODULE_DRIVER_HAS_HINTER
615 #else
616 #define TT_HINTER_FLAG  0
</pre>
</td>
<td>
<hr />
<pre>
<span class="line-modified">  1 /****************************************************************************</span>
<span class="line-modified">  2  *</span>
<span class="line-modified">  3  * ttdriver.c</span>
<span class="line-modified">  4  *</span>
<span class="line-modified">  5  *   TrueType font driver implementation (body).</span>
<span class="line-modified">  6  *</span>
<span class="line-modified">  7  * Copyright (C) 1996-2019 by</span>
<span class="line-modified">  8  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">  9  *</span>
<span class="line-modified"> 10  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified"> 11  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified"> 12  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified"> 13  * this file you indicate that you have read the license and</span>
<span class="line-modified"> 14  * understand and accept it fully.</span>
<span class="line-modified"> 15  *</span>
<span class="line-modified"> 16  */</span>
 17 
 18 
 19 #include &lt;ft2build.h&gt;
 20 #include FT_INTERNAL_DEBUG_H
 21 #include FT_INTERNAL_STREAM_H
 22 #include FT_INTERNAL_SFNT_H
 23 #include FT_SERVICE_FONT_FORMAT_H
 24 
 25 #ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT
 26 #include FT_MULTIPLE_MASTERS_H
 27 #include FT_SERVICE_MULTIPLE_MASTERS_H
 28 #include FT_SERVICE_METRICS_VARIATIONS_H
 29 #endif
 30 
 31 #include FT_SERVICE_TRUETYPE_ENGINE_H
 32 #include FT_SERVICE_TRUETYPE_GLYF_H
 33 #include FT_SERVICE_PROPERTIES_H
 34 #include FT_DRIVER_H
 35 
 36 #include &quot;ttdriver.h&quot;
 37 #include &quot;ttgload.h&quot;
 38 #include &quot;ttpload.h&quot;
 39 
 40 #ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT
 41 #include &quot;ttgxvar.h&quot;
 42 #endif
 43 
 44 #include &quot;tterrors.h&quot;
 45 

 46 
<span class="line-modified"> 47   /**************************************************************************</span>
<span class="line-modified"> 48    *</span>
<span class="line-modified"> 49    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="line-modified"> 50    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="line-modified"> 51    * messages during execution.</span>
<span class="line-modified"> 52    */</span>
 53 #undef  FT_COMPONENT
<span class="line-modified"> 54 #define FT_COMPONENT  ttdriver</span>
 55 
 56 
 57   /*
<span class="line-modified"> 58    * PROPERTY SERVICE</span>
 59    *
 60    */
 61   static FT_Error
 62   tt_property_set( FT_Module    module,         /* TT_Driver */
 63                    const char*  property_name,
 64                    const void*  value,
 65                    FT_Bool      value_is_string )
 66   {
 67     FT_Error   error  = FT_Err_Ok;
 68     TT_Driver  driver = (TT_Driver)module;
 69 
 70 #ifndef FT_CONFIG_OPTION_ENVIRONMENT_PROPERTIES
 71     FT_UNUSED( value_is_string );
 72 #endif
 73 
 74 
 75     if ( !ft_strcmp( property_name, &quot;interpreter-version&quot; ) )
 76     {
 77       FT_UInt  interpreter_version;
 78 
</pre>
<hr />
<pre>
146     tt_service_properties,
147 
148     (FT_Properties_SetFunc)tt_property_set,     /* set_property */
149     (FT_Properties_GetFunc)tt_property_get      /* get_property */
150   )
151 
152 
153   /*************************************************************************/
154   /*************************************************************************/
155   /*************************************************************************/
156   /****                                                                 ****/
157   /****                                                                 ****/
158   /****                          F A C E S                              ****/
159   /****                                                                 ****/
160   /****                                                                 ****/
161   /*************************************************************************/
162   /*************************************************************************/
163   /*************************************************************************/
164 
165 
<span class="line-modified">166   /**************************************************************************</span>
<span class="line-modified">167    *</span>
<span class="line-modified">168    * @Function:</span>
<span class="line-modified">169    *   tt_get_kerning</span>
<span class="line-modified">170    *</span>
<span class="line-modified">171    * @Description:</span>
<span class="line-modified">172    *   A driver method used to return the kerning vector between two</span>
<span class="line-modified">173    *   glyphs of the same face.</span>
<span class="line-modified">174    *</span>
<span class="line-modified">175    * @Input:</span>
<span class="line-modified">176    *   face ::</span>
<span class="line-modified">177    *     A handle to the source face object.</span>
<span class="line-modified">178    *</span>
<span class="line-modified">179    *   left_glyph ::</span>
<span class="line-modified">180    *     The index of the left glyph in the kern pair.</span>
<span class="line-modified">181    *</span>
<span class="line-modified">182    *   right_glyph ::</span>
<span class="line-modified">183    *     The index of the right glyph in the kern pair.</span>
<span class="line-modified">184    *</span>
<span class="line-modified">185    * @Output:</span>
<span class="line-modified">186    *   kerning ::</span>
<span class="line-modified">187    *     The kerning vector.  This is in font units for</span>
<span class="line-modified">188    *     scalable formats, and in pixels for fixed-sizes</span>
<span class="line-modified">189    *     formats.</span>
<span class="line-modified">190    *</span>
<span class="line-modified">191    * @Return:</span>
<span class="line-modified">192    *   FreeType error code.  0 means success.</span>
<span class="line-modified">193    *</span>
<span class="line-modified">194    * @Note:</span>
<span class="line-modified">195    *   Only horizontal layouts (left-to-right &amp; right-to-left) are</span>
<span class="line-modified">196    *   supported by this function.  Other layouts, or more sophisticated</span>
<span class="line-modified">197    *   kernings, are out of scope of this method (the basic driver</span>
<span class="line-added">198    *   interface is meant to be simple).</span>
<span class="line-added">199    *</span>
<span class="line-added">200    *   They can be implemented by format-specific interfaces.</span>
<span class="line-added">201    */</span>
202   static FT_Error
203   tt_get_kerning( FT_Face     ttface,          /* TT_Face */
204                   FT_UInt     left_glyph,
205                   FT_UInt     right_glyph,
206                   FT_Vector*  kerning )
207   {
208     TT_Face       face = (TT_Face)ttface;
209     SFNT_Service  sfnt = (SFNT_Service)face-&gt;sfnt;
210 
211 
212     kerning-&gt;x = 0;
213     kerning-&gt;y = 0;
214 
215     if ( sfnt )
216       kerning-&gt;x = sfnt-&gt;get_kerning( face, left_glyph, right_glyph );
217 
218     return 0;
219   }
220 
221 
</pre>
<hr />
<pre>
370                      ? req-&gt;horiResolution
371                      : req-&gt;vertResolution;
372 
373 
374         /* if we don&#39;t have a resolution value, assume 72dpi */
375         if ( req-&gt;type == FT_SIZE_REQUEST_TYPE_SCALES ||
376              !resolution                              )
377           resolution = 72;
378 
379         ttsize-&gt;point_size = FT_MulDiv( ttsize-&gt;ttmetrics.ppem,
380                                         64 * 72,
381                                         resolution );
382       }
383 #endif
384     }
385 
386     return error;
387   }
388 
389 
<span class="line-modified">390   /**************************************************************************</span>
<span class="line-modified">391    *</span>
<span class="line-modified">392    * @Function:</span>
<span class="line-modified">393    *   tt_glyph_load</span>
<span class="line-modified">394    *</span>
<span class="line-modified">395    * @Description:</span>
<span class="line-modified">396    *   A driver method used to load a glyph within a given glyph slot.</span>
<span class="line-modified">397    *</span>
<span class="line-modified">398    * @Input:</span>
<span class="line-modified">399    *   slot ::</span>
<span class="line-modified">400    *     A handle to the target slot object where the glyph</span>
<span class="line-modified">401    *     will be loaded.</span>
<span class="line-modified">402    *</span>
<span class="line-modified">403    *   size ::</span>
<span class="line-modified">404    *     A handle to the source face size at which the glyph</span>
<span class="line-modified">405    *     must be scaled, loaded, etc.</span>
<span class="line-modified">406    *</span>
<span class="line-modified">407    *   glyph_index ::</span>
<span class="line-modified">408    *     The index of the glyph in the font file.</span>
<span class="line-modified">409    *</span>
<span class="line-modified">410    *   load_flags ::</span>
<span class="line-modified">411    *     A flag indicating what to load for this glyph.  The</span>
<span class="line-modified">412    *     FT_LOAD_XXX constants can be used to control the</span>
<span class="line-modified">413    *     glyph loading process (e.g., whether the outline</span>
<span class="line-modified">414    *     should be scaled, whether to load bitmaps or not,</span>
<span class="line-modified">415    *     whether to hint the outline, etc).</span>
<span class="line-added">416    *</span>
<span class="line-added">417    * @Return:</span>
<span class="line-added">418    *   FreeType error code.  0 means success.</span>
<span class="line-added">419    */</span>
420   static FT_Error
421   tt_glyph_load( FT_GlyphSlot  ttslot,      /* TT_GlyphSlot */
422                  FT_Size       ttsize,      /* TT_Size      */
423                  FT_UInt       glyph_index,
424                  FT_Int32      load_flags )
425   {
426     TT_GlyphSlot  slot = (TT_GlyphSlot)ttslot;
427     TT_Size       size = (TT_Size)ttsize;
428     FT_Face       face = ttslot-&gt;face;
429     FT_Error      error;
430 
431 
432     if ( !slot )
433       return FT_THROW( Invalid_Slot_Handle );
434 
435     if ( !size )
436       return FT_THROW( Invalid_Size_Handle );
437 
438     if ( !face )
439       return FT_THROW( Invalid_Face_Handle );
</pre>
<hr />
<pre>
454       if ( FT_IS_TRICKY( face ) )
455         load_flags &amp;= ~FT_LOAD_NO_HINTING;
456 
457       if ( load_flags &amp; FT_LOAD_NO_AUTOHINT )
458         load_flags |= FT_LOAD_NO_HINTING;
459     }
460 
461     if ( load_flags &amp; ( FT_LOAD_NO_RECURSE | FT_LOAD_NO_SCALE ) )
462     {
463       load_flags |= FT_LOAD_NO_BITMAP | FT_LOAD_NO_SCALE;
464 
465       if ( !FT_IS_TRICKY( face ) )
466         load_flags |= FT_LOAD_NO_HINTING;
467     }
468 
469     /* use hinted metrics only if we load a glyph with hinting */
470     size-&gt;metrics = ( load_flags &amp; FT_LOAD_NO_HINTING )
471                       ? &amp;ttsize-&gt;metrics
472                       : &amp;size-&gt;hinted_metrics;
473 
<span class="line-modified">474     /* now fill in the glyph slot with outline/bitmap/layered */</span>
475     error = TT_Load_Glyph( size, slot, glyph_index, load_flags );
476 
477     /* force drop-out mode to 2 - irrelevant now */
478     /* slot-&gt;outline.dropout_mode = 2; */
479 
480     return error;
481   }
482 
483 
484   /*************************************************************************/
485   /*************************************************************************/
486   /*************************************************************************/
487   /****                                                                 ****/
488   /****                                                                 ****/
489   /****                D R I V E R  I N T E R F A C E                   ****/
490   /****                                                                 ****/
491   /****                                                                 ****/
492   /*************************************************************************/
493   /*************************************************************************/
494   /*************************************************************************/
495 
496 #ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT
497 
498   FT_DEFINE_SERVICE_MULTIMASTERSREC(
499     tt_service_gx_multi_masters,
500 
<span class="line-modified">501     (FT_Get_MM_Func)             NULL,                  /* get_mm              */</span>
<span class="line-modified">502     (FT_Set_MM_Design_Func)      NULL,                  /* set_mm_design       */</span>
<span class="line-modified">503     (FT_Set_MM_Blend_Func)       TT_Set_MM_Blend,       /* set_mm_blend        */</span>
<span class="line-modified">504     (FT_Get_MM_Blend_Func)       TT_Get_MM_Blend,       /* get_mm_blend        */</span>
<span class="line-modified">505     (FT_Get_MM_Var_Func)         TT_Get_MM_Var,         /* get_mm_var          */</span>
<span class="line-modified">506     (FT_Set_Var_Design_Func)     TT_Set_Var_Design,     /* set_var_design      */</span>
<span class="line-modified">507     (FT_Get_Var_Design_Func)     TT_Get_Var_Design,     /* get_var_design      */</span>
<span class="line-modified">508     (FT_Set_Instance_Func)       TT_Set_Named_Instance, /* set_instance        */</span>
<span class="line-modified">509     (FT_Set_MM_WeightVector_Func)NULL,                  /* set_mm_weightvector */</span>
<span class="line-modified">510     (FT_Get_MM_WeightVector_Func)NULL,                  /* get_mm_weightvector */</span>
<span class="line-modified">511 </span>
<span class="line-added">512     (FT_Get_Var_Blend_Func)      tt_get_var_blend,      /* get_var_blend       */</span>
<span class="line-added">513     (FT_Done_Blend_Func)         tt_done_blend          /* done_blend          */</span>
514   )
515 
516   FT_DEFINE_SERVICE_METRICSVARIATIONSREC(
517     tt_service_metrics_variations,
518 
519     (FT_HAdvance_Adjust_Func)tt_hadvance_adjust,     /* hadvance_adjust */
520     (FT_LSB_Adjust_Func)     NULL,                   /* lsb_adjust      */
521     (FT_RSB_Adjust_Func)     NULL,                   /* rsb_adjust      */
522 
523     (FT_VAdvance_Adjust_Func)tt_vadvance_adjust,     /* vadvance_adjust */
524     (FT_TSB_Adjust_Func)     NULL,                   /* tsb_adjust      */
525     (FT_BSB_Adjust_Func)     NULL,                   /* bsb_adjust      */
526     (FT_VOrg_Adjust_Func)    NULL,                   /* vorg_adjust     */
527 
528     (FT_Metrics_Adjust_Func) tt_apply_mvar           /* metrics_adjust  */
529   )
530 
531 #endif /* TT_CONFIG_OPTION_GX_VAR_SUPPORT */
532 
533 
</pre>
<hr />
<pre>
540 #else /* !TT_USE_BYTECODE_INTERPRETER */
541 
542     FT_TRUETYPE_ENGINE_TYPE_NONE
543 
544 #endif /* TT_USE_BYTECODE_INTERPRETER */
545   };
546 
547 
548   FT_DEFINE_SERVICE_TTGLYFREC(
549     tt_service_truetype_glyf,
550 
551     (TT_Glyf_GetLocationFunc)tt_face_get_location      /* get_location */
552   )
553 
554 
555 #ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT
556   FT_DEFINE_SERVICEDESCREC6(
557     tt_services,
558 
559     FT_SERVICE_ID_FONT_FORMAT,        FT_FONT_FORMAT_TRUETYPE,
<span class="line-modified">560     FT_SERVICE_ID_MULTI_MASTERS,      &amp;tt_service_gx_multi_masters,</span>
<span class="line-modified">561     FT_SERVICE_ID_METRICS_VARIATIONS, &amp;tt_service_metrics_variations,</span>
562     FT_SERVICE_ID_TRUETYPE_ENGINE,    &amp;tt_service_truetype_engine,
<span class="line-modified">563     FT_SERVICE_ID_TT_GLYF,            &amp;tt_service_truetype_glyf,</span>
<span class="line-modified">564     FT_SERVICE_ID_PROPERTIES,         &amp;tt_service_properties )</span>
565 #else
566   FT_DEFINE_SERVICEDESCREC4(
567     tt_services,
568 
569     FT_SERVICE_ID_FONT_FORMAT,     FT_FONT_FORMAT_TRUETYPE,
570     FT_SERVICE_ID_TRUETYPE_ENGINE, &amp;tt_service_truetype_engine,
<span class="line-modified">571     FT_SERVICE_ID_TT_GLYF,         &amp;tt_service_truetype_glyf,</span>
<span class="line-modified">572     FT_SERVICE_ID_PROPERTIES,      &amp;tt_service_properties )</span>
573 #endif
574 
575 
576   FT_CALLBACK_DEF( FT_Module_Interface )
577   tt_get_interface( FT_Module    driver,    /* TT_Driver */
578                     const char*  tt_interface )
579   {
580     FT_Library           library;
581     FT_Module_Interface  result;
582     FT_Module            sfntd;
583     SFNT_Service         sfnt;
584 
585 
<span class="line-modified">586     result = ft_service_list_lookup( tt_services, tt_interface );</span>









587     if ( result )
588       return result;
589 

590     if ( !driver )
591       return NULL;
592     library = driver-&gt;library;
593     if ( !library )
594       return NULL;

595 
596     /* only return the default interface from the SFNT module */
597     sfntd = FT_Get_Module( library, &quot;sfnt&quot; );
598     if ( sfntd )
599     {
600       sfnt = (SFNT_Service)( sfntd-&gt;clazz-&gt;module_interface );
601       if ( sfnt )
602         return sfnt-&gt;get_interface( driver, tt_interface );
603     }
604 
605     return 0;
606   }
607 
608 
609   /* The FT_DriverInterface structure is defined in ftdriver.h. */
610 
611 #ifdef TT_USE_BYTECODE_INTERPRETER
612 #define TT_HINTER_FLAG  FT_MODULE_DRIVER_HAS_HINTER
613 #else
614 #define TT_HINTER_FLAG  0
</pre>
</td>
</tr>
</table>
<center><a href="../smooth/ftsmooth.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ttdriver.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>