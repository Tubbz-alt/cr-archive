<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/share/native/libfreetype/src/smooth/ftsmooth.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ftsmerrs.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ftsmooth.h.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/smooth/ftsmooth.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,38 +1,57 @@</span>
<span class="udiff-line-modified-removed">- /***************************************************************************/</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  ftsmooth.c                                                             */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*    Anti-aliasing renderer interface (body).                             */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  Copyright 2000-2018 by                                                 */</span>
<span class="udiff-line-modified-removed">- /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="udiff-line-modified-removed">- /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="udiff-line-modified-removed">- /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="udiff-line-modified-removed">- /*  this file you indicate that you have read the license and              */</span>
<span class="udiff-line-modified-removed">- /*  understand and accept it fully.                                        */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /***************************************************************************/</span>
<span class="udiff-line-modified-added">+ /****************************************************************************</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * ftsmooth.c</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  *   Anti-aliasing renderer interface (body).</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * Copyright (C) 2000-2019 by</span>
<span class="udiff-line-modified-added">+  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * This file is part of the FreeType project, and may only be used,</span>
<span class="udiff-line-modified-added">+  * modified, and distributed under the terms of the FreeType project</span>
<span class="udiff-line-modified-added">+  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="udiff-line-modified-added">+  * this file you indicate that you have read the license and</span>
<span class="udiff-line-modified-added">+  * understand and accept it fully.</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  */</span>
  
  
  #include &lt;ft2build.h&gt;
  #include FT_INTERNAL_DEBUG_H
  #include FT_INTERNAL_OBJECTS_H
  #include FT_OUTLINE_H
  #include &quot;ftsmooth.h&quot;
  #include &quot;ftgrays.h&quot;
<span class="udiff-line-removed">- #include &quot;ftspic.h&quot;</span>
  
  #include &quot;ftsmerrs.h&quot;
  
  
    /* initialize renderer -- init its raster */
    static FT_Error
    ft_smooth_init( FT_Renderer  render )
    {
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #ifndef FT_CONFIG_OPTION_SUBPIXEL_RENDERING</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     FT_Vector*  sub = render-&gt;root.library-&gt;lcd_geometry;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     /* set up default subpixel geometry for striped RGB panels. */</span>
<span class="udiff-line-added">+     sub[0].x = -21;</span>
<span class="udiff-line-added">+     sub[0].y = 0;</span>
<span class="udiff-line-added">+     sub[1].x = 0;</span>
<span class="udiff-line-added">+     sub[1].y = 0;</span>
<span class="udiff-line-added">+     sub[2].x = 21;</span>
<span class="udiff-line-added">+     sub[2].y = 0;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #elif 0   /* or else, once ClearType patents expire */</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     FT_Library_SetLcdFilter( render-&gt;root.library, FT_LCD_FILTER_DEFAULT );</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
      render-&gt;clazz-&gt;raster_class-&gt;raster_reset( render-&gt;raster, NULL, 0 );
  
      return 0;
    }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -128,11 +147,15 @@</span>
      {
        FT_FREE( bitmap-&gt;buffer );
        slot-&gt;internal-&gt;flags &amp;= ~FT_GLYPH_OWN_BITMAP;
      }
  
<span class="udiff-line-modified-removed">-     ft_glyphslot_preset_bitmap( slot, mode, origin );</span>
<span class="udiff-line-modified-added">+     if ( ft_glyphslot_preset_bitmap( slot, mode, origin ) )</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+       error = FT_THROW( Raster_Overflow );</span>
<span class="udiff-line-added">+       goto Exit;</span>
<span class="udiff-line-added">+     }</span>
  
      /* allocate new one */
      if ( FT_ALLOC_MULT( bitmap-&gt;buffer, bitmap-&gt;rows, bitmap-&gt;pitch ) )
        goto Exit;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -218,11 +241,11 @@</span>
          lcd_weights     = slot-&gt;library-&gt;lcd_weights;
          lcd_filter_func = slot-&gt;library-&gt;lcd_filter_func;
        }
  
        if ( lcd_filter_func )
<span class="udiff-line-modified-removed">-         lcd_filter_func( bitmap, mode, lcd_weights );</span>
<span class="udiff-line-modified-added">+         lcd_filter_func( bitmap, lcd_weights );</span>
      }
  
  #else /* !FT_CONFIG_OPTION_SUBPIXEL_RENDERING */
  
      if ( hmul )  /* lcd */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -233,37 +256,44 @@</span>
  
        unsigned int  height = bitmap-&gt;rows;
        unsigned int  width  = bitmap-&gt;width;
        int           pitch  = bitmap-&gt;pitch;
  
<span class="udiff-line-added">+       FT_Vector*  sub = slot-&gt;library-&gt;lcd_geometry;</span>
  
<span class="udiff-line-removed">-       /* Render 3 separate monochrome bitmaps, shifting the outline  */</span>
<span class="udiff-line-removed">-       /* by 1/3 pixel.                                               */</span>
<span class="udiff-line-removed">-       width /= 3;</span>
  
<span class="udiff-line-modified-removed">-       bitmap-&gt;buffer += width;</span>
<span class="udiff-line-modified-added">+       /* Render 3 separate monochrome bitmaps, shifting the outline.  */</span>
<span class="udiff-line-added">+       width /= 3;</span>
  
<span class="udiff-line-added">+       FT_Outline_Translate( outline,</span>
<span class="udiff-line-added">+                             -sub[0].x,</span>
<span class="udiff-line-added">+                             -sub[0].y );</span>
        error = render-&gt;raster_render( render-&gt;raster, &amp;params );
        if ( error )
          goto Exit;
  
<span class="udiff-line-removed">-       FT_Outline_Translate( outline, -21, 0 );</span>
<span class="udiff-line-removed">-       x_shift        -= 21;</span>
        bitmap-&gt;buffer += width;
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-added">+       FT_Outline_Translate( outline,</span>
<span class="udiff-line-added">+                             sub[0].x - sub[1].x,</span>
<span class="udiff-line-added">+                             sub[0].y - sub[1].y );</span>
        error = render-&gt;raster_render( render-&gt;raster, &amp;params );
<span class="udiff-line-added">+       bitmap-&gt;buffer -= width;</span>
        if ( error )
          goto Exit;
  
<span class="udiff-line-modified-removed">-       FT_Outline_Translate( outline,  42, 0 );</span>
<span class="udiff-line-modified-removed">-       x_shift        += 42;</span>
<span class="udiff-line-modified-removed">-       bitmap-&gt;buffer -= 2 * width;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-added">+       bitmap-&gt;buffer += 2 * width;</span>
<span class="udiff-line-modified-added">+       FT_Outline_Translate( outline,</span>
<span class="udiff-line-modified-added">+                             sub[1].x - sub[2].x,</span>
<span class="udiff-line-modified-added">+                             sub[1].y - sub[2].y );</span>
        error = render-&gt;raster_render( render-&gt;raster, &amp;params );
<span class="udiff-line-added">+       bitmap-&gt;buffer -= 2 * width;</span>
        if ( error )
          goto Exit;
  
<span class="udiff-line-added">+       x_shift -= sub[2].x;</span>
<span class="udiff-line-added">+       y_shift -= sub[2].y;</span>
<span class="udiff-line-added">+ </span>
        /* XXX: Rearrange the bytes according to FT_PIXEL_MODE_LCD.    */
        /* XXX: It is more efficient to render every third byte above. */
  
        if ( FT_ALLOC( temp, (FT_ULong)pitch ) )
          goto Exit;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -284,38 +314,47 @@</span>
      }
      else if ( vmul )  /* lcd_v */
      {
        int  pitch  = bitmap-&gt;pitch;
  
<span class="udiff-line-added">+       FT_Vector*  sub = slot-&gt;library-&gt;lcd_geometry;</span>
<span class="udiff-line-added">+ </span>
  
<span class="udiff-line-modified-removed">-       /* Render 3 separate monochrome bitmaps, shifting the outline  */</span>
<span class="udiff-line-modified-removed">-       /* by 1/3 pixel. Triple the pitch to render on each third row. */</span>
<span class="udiff-line-modified-added">+       /* Render 3 separate monochrome bitmaps, shifting the outline. */</span>
<span class="udiff-line-modified-added">+       /* Notice that the subpixel geometry vectors are rotated.      */</span>
<span class="udiff-line-added">+       /* Triple the pitch to render on each third row.               */</span>
        bitmap-&gt;pitch *= 3;
        bitmap-&gt;rows  /= 3;
  
<span class="udiff-line-modified-removed">-       bitmap-&gt;buffer += pitch;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-added">+       FT_Outline_Translate( outline,</span>
<span class="udiff-line-modified-added">+                             -sub[0].y,</span>
<span class="udiff-line-added">+                             sub[0].x );</span>
        error = render-&gt;raster_render( render-&gt;raster, &amp;params );
        if ( error )
          goto Exit;
  
<span class="udiff-line-removed">-       FT_Outline_Translate( outline, 0,  21 );</span>
<span class="udiff-line-removed">-       y_shift        += 21;</span>
        bitmap-&gt;buffer += pitch;
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-added">+       FT_Outline_Translate( outline,</span>
<span class="udiff-line-added">+                             sub[0].y - sub[1].y,</span>
<span class="udiff-line-added">+                             sub[1].x - sub[0].x );</span>
        error = render-&gt;raster_render( render-&gt;raster, &amp;params );
<span class="udiff-line-added">+       bitmap-&gt;buffer -= pitch;</span>
        if ( error )
          goto Exit;
  
<span class="udiff-line-modified-removed">-       FT_Outline_Translate( outline, 0, -42 );</span>
<span class="udiff-line-modified-removed">-       y_shift        -= 42;</span>
<span class="udiff-line-modified-removed">-       bitmap-&gt;buffer -= 2 * pitch;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-added">+       bitmap-&gt;buffer += 2 * pitch;</span>
<span class="udiff-line-modified-added">+       FT_Outline_Translate( outline,</span>
<span class="udiff-line-modified-added">+                             sub[1].y - sub[2].y,</span>
<span class="udiff-line-modified-added">+                             sub[2].x - sub[1].x );</span>
        error = render-&gt;raster_render( render-&gt;raster, &amp;params );
<span class="udiff-line-added">+       bitmap-&gt;buffer -= 2 * pitch;</span>
        if ( error )
          goto Exit;
  
<span class="udiff-line-added">+       x_shift -= sub[2].y;</span>
<span class="udiff-line-added">+       y_shift += sub[2].x;</span>
<span class="udiff-line-added">+ </span>
        bitmap-&gt;pitch /= 3;
        bitmap-&gt;rows  *= 3;
      }
      else  /* grayscale */
        error = render-&gt;raster_render( render-&gt;raster, &amp;params );
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -401,11 +440,11 @@</span>
      (FT_Renderer_RenderFunc)   ft_smooth_render,     /* render_glyph    */
      (FT_Renderer_TransformFunc)ft_smooth_transform,  /* transform_glyph */
      (FT_Renderer_GetCBoxFunc)  ft_smooth_get_cbox,   /* get_glyph_cbox  */
      (FT_Renderer_SetModeFunc)  ft_smooth_set_mode,   /* set_mode        */
  
<span class="udiff-line-modified-removed">-     (FT_Raster_Funcs*)&amp;FT_GRAYS_RASTER_GET           /* raster_class    */</span>
<span class="udiff-line-modified-added">+     (FT_Raster_Funcs*)&amp;ft_grays_raster               /* raster_class    */</span>
    )
  
  
    FT_DEFINE_RENDERER(
      ft_smooth_lcd_renderer_class,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -428,11 +467,11 @@</span>
      (FT_Renderer_RenderFunc)   ft_smooth_render_lcd,  /* render_glyph    */
      (FT_Renderer_TransformFunc)ft_smooth_transform,   /* transform_glyph */
      (FT_Renderer_GetCBoxFunc)  ft_smooth_get_cbox,    /* get_glyph_cbox  */
      (FT_Renderer_SetModeFunc)  ft_smooth_set_mode,    /* set_mode        */
  
<span class="udiff-line-modified-removed">-     (FT_Raster_Funcs*)&amp;FT_GRAYS_RASTER_GET            /* raster_class    */</span>
<span class="udiff-line-modified-added">+     (FT_Raster_Funcs*)&amp;ft_grays_raster                /* raster_class    */</span>
    )
  
  
    FT_DEFINE_RENDERER(
      ft_smooth_lcdv_renderer_class,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -455,10 +494,10 @@</span>
      (FT_Renderer_RenderFunc)   ft_smooth_render_lcd_v,  /* render_glyph    */
      (FT_Renderer_TransformFunc)ft_smooth_transform,     /* transform_glyph */
      (FT_Renderer_GetCBoxFunc)  ft_smooth_get_cbox,      /* get_glyph_cbox  */
      (FT_Renderer_SetModeFunc)  ft_smooth_set_mode,      /* set_mode        */
  
<span class="udiff-line-modified-removed">-     (FT_Raster_Funcs*)&amp;FT_GRAYS_RASTER_GET              /* raster_class    */</span>
<span class="udiff-line-modified-added">+     (FT_Raster_Funcs*)&amp;ft_grays_raster                  /* raster_class    */</span>
    )
  
  
  /* END */
</pre>
<center><a href="ftsmerrs.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ftsmooth.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>