<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/native/libfreetype/src/sfnt/ttcmap.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="sfobjs.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ttcmap.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/sfnt/ttcmap.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,21 ***</span>
<span class="line-modified">! /***************************************************************************/</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  ttcmap.c                                                               */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*    TrueType character mapping table (cmap) support (body).              */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  Copyright 2002-2018 by                                                 */</span>
<span class="line-modified">! /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified">! /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified">! /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified">! /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified">! /*  understand and accept it fully.                                        */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /***************************************************************************/</span>
  
  
  #include &lt;ft2build.h&gt;
  #include FT_INTERNAL_DEBUG_H
  
<span class="line-new-header">--- 1,21 ---</span>
<span class="line-modified">! /****************************************************************************</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * ttcmap.c</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  *   TrueType character mapping table (cmap) support (body).</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * Copyright (C) 2002-2019 by</span>
<span class="line-modified">!  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified">!  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified">!  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified">!  * this file you indicate that you have read the license and</span>
<span class="line-modified">!  * understand and accept it fully.</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  */</span>
  
  
  #include &lt;ft2build.h&gt;
  #include FT_INTERNAL_DEBUG_H
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 25,21 ***</span>
  #include FT_INTERNAL_STREAM_H
  #include FT_SERVICE_POSTSCRIPT_CMAPS_H
  #include &quot;ttload.h&quot;
  #include &quot;ttcmap.h&quot;
  #include &quot;ttpost.h&quot;
<span class="line-removed">- #include &quot;sfntpic.h&quot;</span>
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="line-modified">!   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="line-modified">!   /* messages during execution.                                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
  #undef  FT_COMPONENT
<span class="line-modified">! #define FT_COMPONENT  trace_ttcmap</span>
  
  
  #define TT_PEEK_SHORT   FT_PEEK_SHORT
  #define TT_PEEK_USHORT  FT_PEEK_USHORT
  #define TT_PEEK_UINT24  FT_PEEK_UOFF3
<span class="line-new-header">--- 25,20 ---</span>
  #include FT_INTERNAL_STREAM_H
  #include FT_SERVICE_POSTSCRIPT_CMAPS_H
  #include &quot;ttload.h&quot;
  #include &quot;ttcmap.h&quot;
  #include &quot;ttpost.h&quot;
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="line-modified">!    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="line-modified">!    * messages during execution.</span>
<span class="line-modified">!    */</span>
  #undef  FT_COMPONENT
<span class="line-modified">! #define FT_COMPONENT  ttcmap</span>
  
  
  #define TT_PEEK_SHORT   FT_PEEK_SHORT
  #define TT_PEEK_USHORT  FT_PEEK_USHORT
  #define TT_PEEK_UINT24  FT_PEEK_UOFF3
</pre>
<hr />
<pre>
<span class="line-old-header">*** 75,23 ***</span>
    /*****                           FORMAT 0                            *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* TABLE OVERVIEW                                                        */</span>
<span class="line-modified">!   /* --------------                                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   NAME        OFFSET         TYPE          DESCRIPTION                */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   format      0              USHORT        must be 0                  */</span>
<span class="line-modified">!   /*   length      2              USHORT        table length in bytes      */</span>
<span class="line-modified">!   /*   language    4              USHORT        Mac language code          */</span>
<span class="line-modified">!   /*   glyph_ids   6              BYTE[256]     array of glyph indices     */</span>
<span class="line-modified">!   /*               262                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_0
  
    FT_CALLBACK_DEF( FT_Error )
    tt_cmap0_validate( FT_Byte*      table,
<span class="line-new-header">--- 74,23 ---</span>
    /*****                           FORMAT 0                            *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * TABLE OVERVIEW</span>
<span class="line-modified">!    * --------------</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   NAME        OFFSET         TYPE          DESCRIPTION</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   format      0              USHORT        must be 0</span>
<span class="line-modified">!    *   length      2              USHORT        table length in bytes</span>
<span class="line-modified">!    *   language    4              USHORT        Mac language code</span>
<span class="line-modified">!    *   glyph_ids   6              BYTE[256]     array of glyph indices</span>
<span class="line-modified">!    *               262</span>
<span class="line-modified">!    */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_0
  
    FT_CALLBACK_DEF( FT_Error )
    tt_cmap0_validate( FT_Byte*      table,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 236,61 ***</span>
    /***** arguments.                                                    *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* TABLE OVERVIEW                                                        */</span>
<span class="line-modified">!   /* --------------                                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   NAME        OFFSET         TYPE            DESCRIPTION              */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   format      0              USHORT          must be 2                */</span>
<span class="line-modified">!   /*   length      2              USHORT          table length in bytes    */</span>
<span class="line-modified">!   /*   language    4              USHORT          Mac language code        */</span>
<span class="line-modified">!   /*   keys        6              USHORT[256]     sub-header keys          */</span>
<span class="line-modified">!   /*   subs        518            SUBHEAD[NSUBS]  sub-headers array        */</span>
<span class="line-modified">!   /*   glyph_ids   518+NSUB*8     USHORT[]        glyph ID array           */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* The `keys&#39; table is used to map charcode high bytes to sub-headers.   */</span>
<span class="line-modified">!   /* The value of `NSUBS&#39; is the number of sub-headers defined in the      */</span>
<span class="line-modified">!   /* table and is computed by finding the maximum of the `keys&#39; table.     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Note that for any `n&#39;, `keys[n]&#39; is a byte offset within the `subs&#39;   */</span>
<span class="line-modified">!   /* table, i.e., it is the corresponding sub-header index multiplied      */</span>
<span class="line-modified">!   /* by 8.                                                                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Each sub-header has the following format.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   NAME        OFFSET      TYPE            DESCRIPTION                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   first       0           USHORT          first valid low-byte        */</span>
<span class="line-modified">!   /*   count       2           USHORT          number of valid low-bytes   */</span>
<span class="line-modified">!   /*   delta       4           SHORT           see below                   */</span>
<span class="line-modified">!   /*   offset      6           USHORT          see below                   */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* A sub-header defines, for each high byte, the range of valid          */</span>
<span class="line-modified">!   /* low bytes within the charmap.  Note that the range defined by `first&#39; */</span>
<span class="line-modified">!   /* and `count&#39; must be completely included in the interval [0..255]      */</span>
<span class="line-modified">!   /* according to the specification.                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* If a character code is contained within a given sub-header, then      */</span>
<span class="line-modified">!   /* mapping it to a glyph index is done as follows.                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* * The value of `offset&#39; is read.  This is a _byte_ distance from the  */</span>
<span class="line-modified">!   /*   location of the `offset&#39; field itself into a slice of the           */</span>
<span class="line-modified">!   /*   `glyph_ids&#39; table.  Let&#39;s call it `slice&#39; (it is a USHORT[], too).  */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* * The value `slice[char.lo - first]&#39; is read.  If it is 0, there is   */</span>
<span class="line-modified">!   /*   no glyph for the charcode.  Otherwise, the value of `delta&#39; is      */</span>
<span class="line-modified">!   /*   added to it (modulo 65536) to form a new glyph index.               */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* It is up to the validation routine to check that all offsets fall     */</span>
<span class="line-modified">!   /* within the glyph IDs table (and not within the `subs&#39; table itself or */</span>
<span class="line-modified">!   /* outside of the CMap).                                                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_2
  
    FT_CALLBACK_DEF( FT_Error )
    tt_cmap2_validate( FT_Byte*      table,
<span class="line-new-header">--- 235,61 ---</span>
    /***** arguments.                                                    *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * TABLE OVERVIEW</span>
<span class="line-modified">!    * --------------</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   NAME        OFFSET         TYPE            DESCRIPTION</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   format      0              USHORT          must be 2</span>
<span class="line-modified">!    *   length      2              USHORT          table length in bytes</span>
<span class="line-modified">!    *   language    4              USHORT          Mac language code</span>
<span class="line-modified">!    *   keys        6              USHORT[256]     sub-header keys</span>
<span class="line-modified">!    *   subs        518            SUBHEAD[NSUBS]  sub-headers array</span>
<span class="line-modified">!    *   glyph_ids   518+NSUB*8     USHORT[]        glyph ID array</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * The `keys&#39; table is used to map charcode high bytes to sub-headers.</span>
<span class="line-modified">!    * The value of `NSUBS&#39; is the number of sub-headers defined in the</span>
<span class="line-modified">!    * table and is computed by finding the maximum of the `keys&#39; table.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Note that for any `n&#39;, `keys[n]&#39; is a byte offset within the `subs&#39;</span>
<span class="line-modified">!    * table, i.e., it is the corresponding sub-header index multiplied</span>
<span class="line-modified">!    * by 8.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Each sub-header has the following format.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   NAME        OFFSET      TYPE            DESCRIPTION</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   first       0           USHORT          first valid low-byte</span>
<span class="line-modified">!    *   count       2           USHORT          number of valid low-bytes</span>
<span class="line-modified">!    *   delta       4           SHORT           see below</span>
<span class="line-modified">!    *   offset      6           USHORT          see below</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * A sub-header defines, for each high byte, the range of valid</span>
<span class="line-modified">!    * low bytes within the charmap.  Note that the range defined by `first&#39;</span>
<span class="line-modified">!    * and `count&#39; must be completely included in the interval [0..255]</span>
<span class="line-modified">!    * according to the specification.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * If a character code is contained within a given sub-header, then</span>
<span class="line-modified">!    * mapping it to a glyph index is done as follows.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * - The value of `offset&#39; is read.  This is a _byte_ distance from the</span>
<span class="line-modified">!    *   location of the `offset&#39; field itself into a slice of the</span>
<span class="line-modified">!    *   `glyph_ids&#39; table.  Let&#39;s call it `slice&#39; (it is a USHORT[], too).</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * - The value `slice[char.lo - first]&#39; is read.  If it is 0, there is</span>
<span class="line-modified">!    *   no glyph for the charcode.  Otherwise, the value of `delta&#39; is</span>
<span class="line-modified">!    *   added to it (modulo 65536) to form a new glyph index.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * It is up to the validation routine to check that all offsets fall</span>
<span class="line-modified">!    * within the glyph IDs table (and not within the `subs&#39; table itself or</span>
<span class="line-modified">!    * outside of the CMap).</span>
<span class="line-modified">!    */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_2
  
    FT_CALLBACK_DEF( FT_Error )
    tt_cmap2_validate( FT_Byte*      table,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 624,72 ***</span>
    /*****                           FORMAT 4                            *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* TABLE OVERVIEW                                                        */</span>
<span class="line-modified">!   /* --------------                                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   NAME          OFFSET         TYPE              DESCRIPTION          */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   format        0              USHORT            must be 4            */</span>
<span class="line-modified">!   /*   length        2              USHORT            table length         */</span>
<span class="line-modified">!   /*                                                  in bytes             */</span>
<span class="line-modified">!   /*   language      4              USHORT            Mac language code    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   segCountX2    6              USHORT            2*NUM_SEGS           */</span>
<span class="line-modified">!   /*   searchRange   8              USHORT            2*(1 &lt;&lt; LOG_SEGS)    */</span>
<span class="line-modified">!   /*   entrySelector 10             USHORT            LOG_SEGS             */</span>
<span class="line-modified">!   /*   rangeShift    12             USHORT            segCountX2 -         */</span>
<span class="line-modified">!   /*                                                    searchRange        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   endCount      14             USHORT[NUM_SEGS]  end charcode for     */</span>
<span class="line-modified">!   /*                                                  each segment; last   */</span>
<span class="line-modified">!   /*                                                  is 0xFFFF            */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   pad           14+NUM_SEGS*2  USHORT            padding              */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   startCount    16+NUM_SEGS*2  USHORT[NUM_SEGS]  first charcode for   */</span>
<span class="line-modified">!   /*                                                  each segment         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   idDelta       16+NUM_SEGS*4  SHORT[NUM_SEGS]   delta for each       */</span>
<span class="line-modified">!   /*                                                  segment              */</span>
<span class="line-modified">!   /*   idOffset      16+NUM_SEGS*6  SHORT[NUM_SEGS]   range offset for     */</span>
<span class="line-modified">!   /*                                                  each segment; can be */</span>
<span class="line-modified">!   /*                                                  zero                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   glyphIds      16+NUM_SEGS*8  USHORT[]          array of glyph ID    */</span>
<span class="line-modified">!   /*                                                  ranges               */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Character codes are modelled by a series of ordered (increasing)      */</span>
<span class="line-modified">!   /* intervals called segments.  Each segment has start and end codes,     */</span>
<span class="line-modified">!   /* provided by the `startCount&#39; and `endCount&#39; arrays.  Segments must    */</span>
<span class="line-modified">!   /* not overlap, and the last segment should always contain the value     */</span>
<span class="line-modified">!   /* 0xFFFF for `endCount&#39;.                                                */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* The fields `searchRange&#39;, `entrySelector&#39; and `rangeShift&#39; are better */</span>
<span class="line-modified">!   /* ignored (they are traces of over-engineering in the TrueType          */</span>
<span class="line-modified">!   /* specification).                                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Each segment also has a signed `delta&#39;, as well as an optional offset */</span>
<span class="line-modified">!   /* within the `glyphIds&#39; table.                                          */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* If a segment&#39;s idOffset is 0, the glyph index corresponding to any    */</span>
<span class="line-modified">!   /* charcode within the segment is obtained by adding the value of        */</span>
<span class="line-modified">!   /* `idDelta&#39; directly to the charcode, modulo 65536.                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Otherwise, a glyph index is taken from the glyph IDs sub-array for    */</span>
<span class="line-modified">!   /* the segment, and the value of `idDelta&#39; is added to it.               */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Finally, note that a lot of fonts contain an invalid last segment,    */</span>
<span class="line-modified">!   /* where `start&#39; and `end&#39; are correctly set to 0xFFFF but both `delta&#39;  */</span>
<span class="line-modified">!   /* and `offset&#39; are incorrect (e.g., `opens___.ttf&#39; which comes with     */</span>
<span class="line-modified">!   /* OpenOffice.org).  We need special code to deal with them correctly.   */</span>
<span class="line-modified">!   /*                                                                       */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_4
  
    typedef struct  TT_CMap4Rec_
    {
<span class="line-new-header">--- 623,72 ---</span>
    /*****                           FORMAT 4                            *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * TABLE OVERVIEW</span>
<span class="line-modified">!    * --------------</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   NAME          OFFSET         TYPE              DESCRIPTION</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   format        0              USHORT            must be 4</span>
<span class="line-modified">!    *   length        2              USHORT            table length</span>
<span class="line-modified">!    *                                                  in bytes</span>
<span class="line-modified">!    *   language      4              USHORT            Mac language code</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   segCountX2    6              USHORT            2*NUM_SEGS</span>
<span class="line-modified">!    *   searchRange   8              USHORT            2*(1 &lt;&lt; LOG_SEGS)</span>
<span class="line-modified">!    *   entrySelector 10             USHORT            LOG_SEGS</span>
<span class="line-modified">!    *   rangeShift    12             USHORT            segCountX2 -</span>
<span class="line-modified">!    *                                                    searchRange</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   endCount      14             USHORT[NUM_SEGS]  end charcode for</span>
<span class="line-modified">!    *                                                  each segment; last</span>
<span class="line-modified">!    *                                                  is 0xFFFF</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   pad           14+NUM_SEGS*2  USHORT            padding</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   startCount    16+NUM_SEGS*2  USHORT[NUM_SEGS]  first charcode for</span>
<span class="line-modified">!    *                                                  each segment</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   idDelta       16+NUM_SEGS*4  SHORT[NUM_SEGS]   delta for each</span>
<span class="line-modified">!    *                                                  segment</span>
<span class="line-modified">!    *   idOffset      16+NUM_SEGS*6  SHORT[NUM_SEGS]   range offset for</span>
<span class="line-modified">!    *                                                  each segment; can be</span>
<span class="line-modified">!    *                                                  zero</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   glyphIds      16+NUM_SEGS*8  USHORT[]          array of glyph ID</span>
<span class="line-modified">!    *                                                  ranges</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Character codes are modelled by a series of ordered (increasing)</span>
<span class="line-modified">!    * intervals called segments.  Each segment has start and end codes,</span>
<span class="line-modified">!    * provided by the `startCount&#39; and `endCount&#39; arrays.  Segments must</span>
<span class="line-modified">!    * not overlap, and the last segment should always contain the value</span>
<span class="line-modified">!    * 0xFFFF for `endCount&#39;.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * The fields `searchRange&#39;, `entrySelector&#39; and `rangeShift&#39; are better</span>
<span class="line-modified">!    * ignored (they are traces of over-engineering in the TrueType</span>
<span class="line-modified">!    * specification).</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Each segment also has a signed `delta&#39;, as well as an optional offset</span>
<span class="line-modified">!    * within the `glyphIds&#39; table.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * If a segment&#39;s idOffset is 0, the glyph index corresponding to any</span>
<span class="line-modified">!    * charcode within the segment is obtained by adding the value of</span>
<span class="line-modified">!    * `idDelta&#39; directly to the charcode, modulo 65536.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Otherwise, a glyph index is taken from the glyph IDs sub-array for</span>
<span class="line-modified">!    * the segment, and the value of `idDelta&#39; is added to it.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Finally, note that a lot of fonts contain an invalid last segment,</span>
<span class="line-modified">!    * where `start&#39; and `end&#39; are correctly set to 0xFFFF but both `delta&#39;</span>
<span class="line-modified">!    * and `offset&#39; are incorrect (e.g., `opens___.ttf&#39; which comes with</span>
<span class="line-modified">!    * OpenOffice.org).  We need special code to deal with them correctly.</span>
<span class="line-modified">!    */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_4
  
    typedef struct  TT_CMap4Rec_
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1571,27 ***</span>
    /*****                          FORMAT 6                             *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* TABLE OVERVIEW                                                        */</span>
<span class="line-modified">!   /* --------------                                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   NAME        OFFSET          TYPE             DESCRIPTION            */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   format       0              USHORT           must be 6              */</span>
<span class="line-modified">!   /*   length       2              USHORT           table length in bytes  */</span>
<span class="line-modified">!   /*   language     4              USHORT           Mac language code      */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   first        6              USHORT           first segment code     */</span>
<span class="line-modified">!   /*   count        8              USHORT           segment size in chars  */</span>
<span class="line-modified">!   /*   glyphIds     10             USHORT[count]    glyph IDs              */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* A very simplified segment mapping.                                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_6
  
    FT_CALLBACK_DEF( FT_Error )
    tt_cmap6_validate( FT_Byte*      table,
<span class="line-new-header">--- 1570,27 ---</span>
    /*****                          FORMAT 6                             *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * TABLE OVERVIEW</span>
<span class="line-modified">!    * --------------</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   NAME        OFFSET          TYPE             DESCRIPTION</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   format       0              USHORT           must be 6</span>
<span class="line-modified">!    *   length       2              USHORT           table length in bytes</span>
<span class="line-modified">!    *   language     4              USHORT           Mac language code</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   first        6              USHORT           first segment code</span>
<span class="line-modified">!    *   count        8              USHORT           segment size in chars</span>
<span class="line-modified">!    *   glyphIds     10             USHORT[count]    glyph IDs</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * A very simplified segment mapping.</span>
<span class="line-modified">!    */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_6
  
    FT_CALLBACK_DEF( FT_Error )
    tt_cmap6_validate( FT_Byte*      table,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1766,30 ***</span>
    /*****   `is32[char_hi] != 0&#39; and `is32[char_lo] != 0&#39;.              *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* TABLE OVERVIEW                                                        */</span>
<span class="line-modified">!   /* --------------                                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   NAME        OFFSET         TYPE        DESCRIPTION                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   format      0              USHORT      must be 8                    */</span>
<span class="line-modified">!   /*   reserved    2              USHORT      reserved                     */</span>
<span class="line-modified">!   /*   length      4              ULONG       length in bytes              */</span>
<span class="line-modified">!   /*   language    8              ULONG       Mac language code            */</span>
<span class="line-modified">!   /*   is32        12             BYTE[8192]  32-bitness bitmap            */</span>
<span class="line-modified">!   /*   count       8204           ULONG       number of groups             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* This header is followed by `count&#39; groups of the following format:    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   start       0              ULONG       first charcode               */</span>
<span class="line-modified">!   /*   end         4              ULONG       last charcode                */</span>
<span class="line-modified">!   /*   startId     8              ULONG       start glyph ID for the group */</span>
<span class="line-modified">!   /*                                                                       */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_8
  
    FT_CALLBACK_DEF( FT_Error )
    tt_cmap8_validate( FT_Byte*      table,
<span class="line-new-header">--- 1765,30 ---</span>
    /*****   `is32[char_hi] != 0&#39; and `is32[char_lo] != 0&#39;.              *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * TABLE OVERVIEW</span>
<span class="line-modified">!    * --------------</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   NAME        OFFSET         TYPE        DESCRIPTION</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   format      0              USHORT      must be 8</span>
<span class="line-modified">!    *   reserved    2              USHORT      reserved</span>
<span class="line-modified">!    *   length      4              ULONG       length in bytes</span>
<span class="line-modified">!    *   language    8              ULONG       Mac language code</span>
<span class="line-modified">!    *   is32        12             BYTE[8192]  32-bitness bitmap</span>
<span class="line-modified">!    *   count       8204           ULONG       number of groups</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * This header is followed by `count&#39; groups of the following format:</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   start       0              ULONG       first charcode</span>
<span class="line-modified">!    *   end         4              ULONG       last charcode</span>
<span class="line-modified">!    *   startId     8              ULONG       start glyph ID for the group</span>
<span class="line-modified">!    */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_8
  
    FT_CALLBACK_DEF( FT_Error )
    tt_cmap8_validate( FT_Byte*      table,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2035,26 ***</span>
    /*****                          FORMAT 10                            *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* TABLE OVERVIEW                                                        */</span>
<span class="line-modified">!   /* --------------                                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   NAME      OFFSET  TYPE               DESCRIPTION                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   format     0      USHORT             must be 10                     */</span>
<span class="line-modified">!   /*   reserved   2      USHORT             reserved                       */</span>
<span class="line-modified">!   /*   length     4      ULONG              length in bytes                */</span>
<span class="line-modified">!   /*   language   8      ULONG              Mac language code              */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   start     12      ULONG              first char in range            */</span>
<span class="line-modified">!   /*   count     16      ULONG              number of chars in range       */</span>
<span class="line-modified">!   /*   glyphIds  20      USHORT[count]      glyph indices covered          */</span>
<span class="line-modified">!   /*                                                                       */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_10
  
    FT_CALLBACK_DEF( FT_Error )
    tt_cmap10_validate( FT_Byte*      table,
<span class="line-new-header">--- 2034,26 ---</span>
    /*****                          FORMAT 10                            *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * TABLE OVERVIEW</span>
<span class="line-modified">!    * --------------</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   NAME      OFFSET  TYPE               DESCRIPTION</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   format     0      USHORT             must be 10</span>
<span class="line-modified">!    *   reserved   2      USHORT             reserved</span>
<span class="line-modified">!    *   length     4      ULONG              length in bytes</span>
<span class="line-modified">!    *   language   8      ULONG              Mac language code</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   start     12      ULONG              first char in range</span>
<span class="line-modified">!    *   count     16      ULONG              number of chars in range</span>
<span class="line-modified">!    *   glyphIds  20      USHORT[count]      glyph indices covered</span>
<span class="line-modified">!    */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_10
  
    FT_CALLBACK_DEF( FT_Error )
    tt_cmap10_validate( FT_Byte*      table,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2207,30 ***</span>
    /*****                          FORMAT 12                            *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* TABLE OVERVIEW                                                        */</span>
<span class="line-modified">!   /* --------------                                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   NAME        OFFSET     TYPE       DESCRIPTION                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   format      0          USHORT     must be 12                        */</span>
<span class="line-modified">!   /*   reserved    2          USHORT     reserved                          */</span>
<span class="line-modified">!   /*   length      4          ULONG      length in bytes                   */</span>
<span class="line-modified">!   /*   language    8          ULONG      Mac language code                 */</span>
<span class="line-modified">!   /*   count       12         ULONG      number of groups                  */</span>
<span class="line-modified">!   /*               16                                                      */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* This header is followed by `count&#39; groups of the following format:    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   start       0          ULONG      first charcode                    */</span>
<span class="line-modified">!   /*   end         4          ULONG      last charcode                     */</span>
<span class="line-modified">!   /*   startId     8          ULONG      start glyph ID for the group      */</span>
<span class="line-modified">!   /*                                                                       */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_12
  
    typedef struct  TT_CMap12Rec_
    {
<span class="line-new-header">--- 2206,30 ---</span>
    /*****                          FORMAT 12                            *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * TABLE OVERVIEW</span>
<span class="line-modified">!    * --------------</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   NAME        OFFSET     TYPE       DESCRIPTION</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   format      0          USHORT     must be 12</span>
<span class="line-modified">!    *   reserved    2          USHORT     reserved</span>
<span class="line-modified">!    *   length      4          ULONG      length in bytes</span>
<span class="line-modified">!    *   language    8          ULONG      Mac language code</span>
<span class="line-modified">!    *   count       12         ULONG      number of groups</span>
<span class="line-modified">!    *               16</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * This header is followed by `count&#39; groups of the following format:</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   start       0          ULONG      first charcode</span>
<span class="line-modified">!    *   end         4          ULONG      last charcode</span>
<span class="line-modified">!    *   startId     8          ULONG      start glyph ID for the group</span>
<span class="line-modified">!    */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_12
  
    typedef struct  TT_CMap12Rec_
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2367,14 ***</span>
          }
  
          /* if `gindex&#39; is invalid, the remaining values */
          /* in this group are invalid, too               */
          if ( gindex &gt;= (FT_UInt)face-&gt;num_glyphs )
<span class="line-removed">-         {</span>
<span class="line-removed">-           gindex = 0;</span>
            continue;
<span class="line-removed">-         }</span>
  
          cmap-&gt;cur_charcode = char_code;
          cmap-&gt;cur_gindex   = gindex;
          cmap-&gt;cur_group    = n;
  
<span class="line-new-header">--- 2366,11 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2563,30 ***</span>
    /*****                          FORMAT 13                            *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* TABLE OVERVIEW                                                        */</span>
<span class="line-modified">!   /* --------------                                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   NAME        OFFSET     TYPE       DESCRIPTION                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   format      0          USHORT     must be 13                        */</span>
<span class="line-modified">!   /*   reserved    2          USHORT     reserved                          */</span>
<span class="line-modified">!   /*   length      4          ULONG      length in bytes                   */</span>
<span class="line-modified">!   /*   language    8          ULONG      Mac language code                 */</span>
<span class="line-modified">!   /*   count       12         ULONG      number of groups                  */</span>
<span class="line-modified">!   /*               16                                                      */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* This header is followed by `count&#39; groups of the following format:    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   start       0          ULONG      first charcode                    */</span>
<span class="line-modified">!   /*   end         4          ULONG      last charcode                     */</span>
<span class="line-modified">!   /*   glyphId     8          ULONG      glyph ID for the whole group      */</span>
<span class="line-modified">!   /*                                                                       */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_13
  
    typedef struct  TT_CMap13Rec_
    {
<span class="line-new-header">--- 2559,30 ---</span>
    /*****                          FORMAT 13                            *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * TABLE OVERVIEW</span>
<span class="line-modified">!    * --------------</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   NAME        OFFSET     TYPE       DESCRIPTION</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   format      0          USHORT     must be 13</span>
<span class="line-modified">!    *   reserved    2          USHORT     reserved</span>
<span class="line-modified">!    *   length      4          ULONG      length in bytes</span>
<span class="line-modified">!    *   language    8          ULONG      Mac language code</span>
<span class="line-modified">!    *   count       12         ULONG      number of groups</span>
<span class="line-modified">!    *               16</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * This header is followed by `count&#39; groups of the following format:</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   start       0          ULONG      first charcode</span>
<span class="line-modified">!    *   end         4          ULONG      last charcode</span>
<span class="line-modified">!    *   glyphId     8          ULONG      glyph ID for the whole group</span>
<span class="line-modified">!    */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_13
  
    typedef struct  TT_CMap13Rec_
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2889,62 ***</span>
    /*****                           FORMAT 14                           *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* TABLE OVERVIEW                                                        */</span>
<span class="line-modified">!   /* --------------                                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   NAME         OFFSET  TYPE    DESCRIPTION                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   format         0     USHORT  must be 14                             */</span>
<span class="line-modified">!   /*   length         2     ULONG   table length in bytes                  */</span>
<span class="line-modified">!   /*   numSelector    6     ULONG   number of variation sel. records       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Followed by numSelector records, each of which looks like             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   varSelector    0     UINT24  Unicode codepoint of sel.              */</span>
<span class="line-modified">!   /*   defaultOff     3     ULONG   offset to a default UVS table          */</span>
<span class="line-modified">!   /*                                describing any variants to be found in */</span>
<span class="line-modified">!   /*                                the normal Unicode subtable.           */</span>
<span class="line-modified">!   /*   nonDefOff      7     ULONG   offset to a non-default UVS table      */</span>
<span class="line-modified">!   /*                                describing any variants not in the     */</span>
<span class="line-modified">!   /*                                standard cmap, with GIDs here          */</span>
<span class="line-modified">!   /* (either offset may be 0 NULL)                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Selectors are sorted by code point.                                   */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* A default Unicode Variation Selector (UVS) subtable is just a list of */</span>
<span class="line-modified">!   /* ranges of code points which are to be found in the standard cmap.  No */</span>
<span class="line-modified">!   /* glyph IDs (GIDs) here.                                                */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   numRanges      0     ULONG   number of ranges following             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* A range looks like                                                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   uniStart       0     UINT24  code point of the first character in   */</span>
<span class="line-modified">!   /*                                this range                             */</span>
<span class="line-modified">!   /*   additionalCnt  3     UBYTE   count of additional characters in this */</span>
<span class="line-modified">!   /*                                range (zero means a range of a single  */</span>
<span class="line-modified">!   /*                                character)                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Ranges are sorted by `uniStart&#39;.                                      */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* A non-default Unicode Variation Selector (UVS) subtable is a list of  */</span>
<span class="line-modified">!   /* mappings from codepoint to GID.                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   numMappings    0     ULONG   number of mappings                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* A range looks like                                                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   uniStart       0     UINT24  code point of the first character in   */</span>
<span class="line-modified">!   /*                                this range                             */</span>
<span class="line-modified">!   /*   GID            3     USHORT  and its GID                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Ranges are sorted by `uniStart&#39;.                                      */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_14
  
    typedef struct  TT_CMap14Rec_
    {
<span class="line-new-header">--- 2885,63 ---</span>
    /*****                           FORMAT 14                           *****/
    /*****                                                               *****/
    /*************************************************************************/
    /*************************************************************************/
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * TABLE OVERVIEW</span>
<span class="line-modified">!    * --------------</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   NAME         OFFSET  TYPE    DESCRIPTION</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   format         0     USHORT  must be 14</span>
<span class="line-modified">!    *   length         2     ULONG   table length in bytes</span>
<span class="line-modified">!    *   numSelector    6     ULONG   number of variation sel. records</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Followed by numSelector records, each of which looks like</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   varSelector    0     UINT24  Unicode codepoint of sel.</span>
<span class="line-modified">!    *   defaultOff     3     ULONG   offset to a default UVS table</span>
<span class="line-modified">!    *                                describing any variants to be found in</span>
<span class="line-modified">!    *                                the normal Unicode subtable.</span>
<span class="line-modified">!    *   nonDefOff      7     ULONG   offset to a non-default UVS table</span>
<span class="line-modified">!    *                                describing any variants not in the</span>
<span class="line-modified">!    *                                standard cmap, with GIDs here</span>
<span class="line-modified">!    * (either offset may be 0 NULL)</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Selectors are sorted by code point.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * A default Unicode Variation Selector (UVS) subtable is just a list of</span>
<span class="line-modified">!    * ranges of code points which are to be found in the standard cmap.  No</span>
<span class="line-modified">!    * glyph IDs (GIDs) here.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   numRanges      0     ULONG   number of ranges following</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * A range looks like</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   uniStart       0     UINT24  code point of the first character in</span>
<span class="line-modified">!    *                                this range</span>
<span class="line-modified">!    *   additionalCnt  3     UBYTE   count of additional characters in this</span>
<span class="line-modified">!    *                                range (zero means a range of a single</span>
<span class="line-modified">!    *                                character)</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Ranges are sorted by `uniStart&#39;.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * A non-default Unicode Variation Selector (UVS) subtable is a list of</span>
<span class="line-modified">!    * mappings from codepoint to GID.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   numMappings    0     ULONG   number of mappings</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * A range looks like</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   uniStart       0     UINT24  code point of the first character in</span>
<span class="line-modified">!    *                                this range</span>
<span class="line-modified">!    *   GID            3     USHORT  and its GID</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Ranges are sorted by `uniStart&#39;.</span>
<span class="line-added">+    */</span>
  
  #ifdef TT_CONFIG_CMAP_FORMAT_14
  
    typedef struct  TT_CMap14Rec_
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3659,11 ***</span>
  
    FT_CALLBACK_DEF( const char * )
    tt_get_glyph_name( TT_Face  face,
                       FT_UInt  idx )
    {
<span class="line-modified">!     FT_String*  PSname;</span>
  
  
      tt_face_get_ps_name( face, idx, &amp;PSname );
  
      return PSname;
<span class="line-new-header">--- 3656,11 ---</span>
  
    FT_CALLBACK_DEF( const char * )
    tt_get_glyph_name( TT_Face  face,
                       FT_UInt  idx )
    {
<span class="line-modified">!     FT_String*  PSname = NULL;</span>
  
  
      tt_face_get_ps_name( face, idx, &amp;PSname );
  
      return PSname;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3679,10 ***</span>
<span class="line-new-header">--- 3676,13 ---</span>
      FT_Service_PsCMaps  psnames = (FT_Service_PsCMaps)face-&gt;psnames;
  
      FT_UNUSED( pointer );
  
  
<span class="line-added">+     if ( !psnames-&gt;unicodes_init )</span>
<span class="line-added">+       return FT_THROW( Unimplemented_Feature );</span>
<span class="line-added">+ </span>
      return psnames-&gt;unicodes_init( memory,
                                     unicodes,
                                     face-&gt;root.num_glyphs,
                                     (PS_GetGlyphNameFunc)&amp;tt_get_glyph_name,
                                     (PS_FreeGlyphNameFunc)NULL,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3747,74 ***</span>
      (TT_CMap_Info_GetFunc)NULL   /* get_cmap_info */
    )
  
  #endif /* FT_CONFIG_OPTION_POSTSCRIPT_NAMES */
  
<span class="line-removed">- #ifndef FT_CONFIG_OPTION_PIC</span>
  
    static const TT_CMap_Class  tt_cmap_classes[] =
    {
  #define TTCMAPCITEM( a )  &amp;a,
  #include &quot;ttcmapc.h&quot;
      NULL,
    };
  
<span class="line-removed">- #else /*FT_CONFIG_OPTION_PIC*/</span>
<span class="line-removed">- </span>
<span class="line-removed">-   void</span>
<span class="line-removed">-   FT_Destroy_Class_tt_cmap_classes( FT_Library      library,</span>
<span class="line-removed">-                                     TT_CMap_Class*  clazz )</span>
<span class="line-removed">-   {</span>
<span class="line-removed">-     FT_Memory  memory = library-&gt;memory;</span>
<span class="line-removed">- </span>
<span class="line-removed">- </span>
<span class="line-removed">-     if ( clazz )</span>
<span class="line-removed">-       FT_FREE( clazz );</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- </span>
<span class="line-removed">- </span>
<span class="line-removed">-   FT_Error</span>
<span class="line-removed">-   FT_Create_Class_tt_cmap_classes( FT_Library       library,</span>
<span class="line-removed">-                                    TT_CMap_Class**  output_class )</span>
<span class="line-removed">-   {</span>
<span class="line-removed">-     TT_CMap_Class*     clazz  = NULL;</span>
<span class="line-removed">-     TT_CMap_ClassRec*  recs;</span>
<span class="line-removed">-     FT_Error           error;</span>
<span class="line-removed">-     FT_Memory          memory = library-&gt;memory;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     int  i = 0;</span>
<span class="line-removed">- </span>
<span class="line-removed">- </span>
<span class="line-removed">- #define TTCMAPCITEM( a ) i++;</span>
<span class="line-removed">- #include &quot;ttcmapc.h&quot;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /* allocate enough space for both the pointers */</span>
<span class="line-removed">-     /* plus terminator and the class instances     */</span>
<span class="line-removed">-     if ( FT_ALLOC( clazz, sizeof ( *clazz ) * ( i + 1 ) +</span>
<span class="line-removed">-                           sizeof ( TT_CMap_ClassRec ) * i ) )</span>
<span class="line-removed">-       return error;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /* the location of the class instances follows the array of pointers */</span>
<span class="line-removed">-     recs = (TT_CMap_ClassRec*)( (char*)clazz +</span>
<span class="line-removed">-                                 sizeof ( *clazz ) * ( i + 1 ) );</span>
<span class="line-removed">-     i    = 0;</span>
<span class="line-removed">- </span>
<span class="line-removed">- #undef TTCMAPCITEM</span>
<span class="line-removed">- #define  TTCMAPCITEM( a )             \</span>
<span class="line-removed">-     FT_Init_Class_ ## a( &amp;recs[i] );  \</span>
<span class="line-removed">-     clazz[i] = &amp;recs[i];              \</span>
<span class="line-removed">-     i++;</span>
<span class="line-removed">- #include &quot;ttcmapc.h&quot;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     clazz[i] = NULL;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     *output_class = clazz;</span>
<span class="line-removed">-     return FT_Err_Ok;</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- </span>
<span class="line-removed">- #endif /*FT_CONFIG_OPTION_PIC*/</span>
<span class="line-removed">- </span>
  
    /* parse the `cmap&#39; table and build the corresponding TT_CMap objects */
    /* in the current face                                                */
    /*                                                                    */
    FT_LOCAL_DEF( FT_Error )
<span class="line-new-header">--- 3747,18 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3857,11 ***</span>
  
        if ( offset &amp;&amp; offset &lt;= face-&gt;cmap_size - 2 )
        {
          FT_Byte* volatile              cmap   = table + offset;
          volatile FT_UInt               format = TT_PEEK_USHORT( cmap );
<span class="line-modified">!         const TT_CMap_Class* volatile  pclazz = TT_CMAP_CLASSES_GET;</span>
          TT_CMap_Class volatile         clazz;
  
  
          for ( ; *pclazz; pclazz++ )
          {
<span class="line-new-header">--- 3801,11 ---</span>
  
        if ( offset &amp;&amp; offset &lt;= face-&gt;cmap_size - 2 )
        {
          FT_Byte* volatile              cmap   = table + offset;
          volatile FT_UInt               format = TT_PEEK_USHORT( cmap );
<span class="line-modified">!         const TT_CMap_Class* volatile  pclazz = tt_cmap_classes;</span>
          TT_CMap_Class volatile         clazz;
  
  
          for ( ; *pclazz; pclazz++ )
          {
</pre>
<center><a href="sfobjs.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ttcmap.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>