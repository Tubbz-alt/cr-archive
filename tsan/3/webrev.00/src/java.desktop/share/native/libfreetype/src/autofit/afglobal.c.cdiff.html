<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/native/libfreetype/src/autofit/afglobal.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="aferrors.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="afglobal.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/autofit/afglobal.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,46 ***</span>
<span class="line-modified">! /***************************************************************************/</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  afglobal.c                                                             */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*    Auto-fitter routines to compute global hinting values (body).        */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  Copyright 2003-2018 by                                                 */</span>
<span class="line-modified">! /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified">! /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified">! /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified">! /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified">! /*  understand and accept it fully.                                        */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /***************************************************************************/</span>
  
  
  #include &quot;afglobal.h&quot;
  #include &quot;afranges.h&quot;
  #include &quot;afshaper.h&quot;
  #include FT_INTERNAL_DEBUG_H
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="line-modified">!   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="line-modified">!   /* messages during execution.                                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
  #undef  FT_COMPONENT
<span class="line-modified">! #define FT_COMPONENT  trace_afglobal</span>
  
  
    /* get writing system specific header files */
  #undef  WRITING_SYSTEM
  #define WRITING_SYSTEM( ws, WS )  /* empty */
  #include &quot;afwrtsys.h&quot;
  
  #include &quot;aferrors.h&quot;
<span class="line-removed">- #include &quot;afpic.h&quot;</span>
  
  
  #undef  SCRIPT
  #define SCRIPT( s, S, d, h, H, ss )         \
            AF_DEFINE_SCRIPT_CLASS(           \
<span class="line-new-header">--- 1,45 ---</span>
<span class="line-modified">! /****************************************************************************</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * afglobal.c</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  *   Auto-fitter routines to compute global hinting values (body).</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * Copyright (C) 2003-2019 by</span>
<span class="line-modified">!  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified">!  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified">!  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified">!  * this file you indicate that you have read the license and</span>
<span class="line-modified">!  * understand and accept it fully.</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  */</span>
  
  
  #include &quot;afglobal.h&quot;
  #include &quot;afranges.h&quot;
  #include &quot;afshaper.h&quot;
  #include FT_INTERNAL_DEBUG_H
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="line-modified">!    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="line-modified">!    * messages during execution.</span>
<span class="line-modified">!    */</span>
  #undef  FT_COMPONENT
<span class="line-modified">! #define FT_COMPONENT  afglobal</span>
  
  
    /* get writing system specific header files */
  #undef  WRITING_SYSTEM
  #define WRITING_SYSTEM( ws, WS )  /* empty */
  #include &quot;afwrtsys.h&quot;
  
  #include &quot;aferrors.h&quot;
  
  
  #undef  SCRIPT
  #define SCRIPT( s, S, d, h, H, ss )         \
            AF_DEFINE_SCRIPT_CLASS(           \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 65,12 ***</span>
              c )
  
  #include &quot;afstyles.h&quot;
  
  
<span class="line-removed">- #ifndef FT_CONFIG_OPTION_PIC</span>
<span class="line-removed">- </span>
  #undef  WRITING_SYSTEM
  #define WRITING_SYSTEM( ws, WS )               \
            &amp;af_ ## ws ## _writing_system_class,
  
    FT_LOCAL_ARRAY_DEF( AF_WritingSystemClass )
<span class="line-new-header">--- 64,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 108,12 ***</span>
  #include &quot;afstyles.h&quot;
  
      NULL  /* do not remove */
    };
  
<span class="line-removed">- #endif /* !FT_CONFIG_OPTION_PIC */</span>
<span class="line-removed">- </span>
  
  #ifdef FT_DEBUG_LEVEL_TRACE
  
  #undef  STYLE
  #define STYLE( s, S, d, ws, sc, ss, c )  #s,
<span class="line-new-header">--- 105,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 157,25 ***</span>
        error = FT_Err_Ok;
        goto Exit;
      }
  
      /* scan each style in a Unicode charmap */
<span class="line-modified">!     for ( ss = 0; AF_STYLE_CLASSES_GET[ss]; ss++ )</span>
      {
        AF_StyleClass       style_class =
<span class="line-modified">!                             AF_STYLE_CLASSES_GET[ss];</span>
        AF_ScriptClass      script_class =
<span class="line-modified">!                             AF_SCRIPT_CLASSES_GET[style_class-&gt;script];</span>
        AF_Script_UniRange  range;
  
  
        if ( !script_class-&gt;script_uni_ranges )
          continue;
  
        /*
<span class="line-modified">!        *  Scan all Unicode points in the range and set the corresponding</span>
<span class="line-modified">!        *  glyph style index.</span>
         */
        if ( style_class-&gt;coverage == AF_COVERAGE_DEFAULT )
        {
          if ( (FT_UInt)style_class-&gt;script ==
               globals-&gt;module-&gt;default_script )
<span class="line-new-header">--- 152,25 ---</span>
        error = FT_Err_Ok;
        goto Exit;
      }
  
      /* scan each style in a Unicode charmap */
<span class="line-modified">!     for ( ss = 0; af_style_classes[ss]; ss++ )</span>
      {
        AF_StyleClass       style_class =
<span class="line-modified">!                             af_style_classes[ss];</span>
        AF_ScriptClass      script_class =
<span class="line-modified">!                             af_script_classes[style_class-&gt;script];</span>
        AF_Script_UniRange  range;
  
  
        if ( !script_class-&gt;script_uni_ranges )
          continue;
  
        /*
<span class="line-modified">!        * Scan all Unicode points in the range and set the corresponding</span>
<span class="line-modified">!        * glyph style index.</span>
         */
        if ( style_class-&gt;coverage == AF_COVERAGE_DEFAULT )
        {
          if ( (FT_UInt)style_class-&gt;script ==
               globals-&gt;module-&gt;default_script )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 244,21 ***</span>
          af_shaper_get_coverage( globals, style_class, gstyles, 0 );
        }
      }
  
      /* handle the remaining default OpenType features ... */
<span class="line-modified">!     for ( ss = 0; AF_STYLE_CLASSES_GET[ss]; ss++ )</span>
      {
<span class="line-modified">!       AF_StyleClass  style_class = AF_STYLE_CLASSES_GET[ss];</span>
  
  
        if ( style_class-&gt;coverage == AF_COVERAGE_DEFAULT )
          af_shaper_get_coverage( globals, style_class, gstyles, 0 );
      }
  
      /* ... and finally the default OpenType features of the default script */
<span class="line-modified">!     af_shaper_get_coverage( globals, AF_STYLE_CLASSES_GET[dflt], gstyles, 1 );</span>
  
      /* mark ASCII digits */
      for ( i = 0x30; i &lt;= 0x39; i++ )
      {
        FT_UInt  gindex = FT_Get_Char_Index( face, i );
<span class="line-new-header">--- 239,21 ---</span>
          af_shaper_get_coverage( globals, style_class, gstyles, 0 );
        }
      }
  
      /* handle the remaining default OpenType features ... */
<span class="line-modified">!     for ( ss = 0; af_style_classes[ss]; ss++ )</span>
      {
<span class="line-modified">!       AF_StyleClass  style_class = af_style_classes[ss];</span>
  
  
        if ( style_class-&gt;coverage == AF_COVERAGE_DEFAULT )
          af_shaper_get_coverage( globals, style_class, gstyles, 0 );
      }
  
      /* ... and finally the default OpenType features of the default script */
<span class="line-modified">!     af_shaper_get_coverage( globals, af_style_classes[dflt], gstyles, 1 );</span>
  
      /* mark ASCII digits */
      for ( i = 0x30; i &lt;= 0x39; i++ )
      {
        FT_UInt  gindex = FT_Get_Char_Index( face, i );
</pre>
<hr />
<pre>
<span class="line-old-header">*** 268,12 ***</span>
          gstyles[gindex] |= AF_DIGIT;
      }
  
    Exit:
      /*
<span class="line-modified">!      *  By default, all uncovered glyphs are set to the fallback style.</span>
<span class="line-modified">!      *  XXX: Shouldn&#39;t we disable hinting or do something similar?</span>
       */
      if ( globals-&gt;module-&gt;fallback_style != AF_STYLE_UNASSIGNED )
      {
        FT_Long  nn;
  
<span class="line-new-header">--- 263,12 ---</span>
          gstyles[gindex] |= AF_DIGIT;
      }
  
    Exit:
      /*
<span class="line-modified">!      * By default, all uncovered glyphs are set to the fallback style.</span>
<span class="line-modified">!      * XXX: Shouldn&#39;t we disable hinting or do something similar?</span>
       */
      if ( globals-&gt;module-&gt;fallback_style != AF_STYLE_UNASSIGNED )
      {
        FT_Long  nn;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 293,13 ***</span>
      FT_TRACE4(( &quot;\n&quot;
                  &quot;style coverage\n&quot;
                  &quot;==============\n&quot;
                  &quot;\n&quot; ));
  
<span class="line-modified">!     for ( ss = 0; AF_STYLE_CLASSES_GET[ss]; ss++ )</span>
      {
<span class="line-modified">!       AF_StyleClass  style_class = AF_STYLE_CLASSES_GET[ss];</span>
        FT_UInt        count       = 0;
        FT_Long        idx;
  
  
        FT_TRACE4(( &quot;%s:\n&quot;, af_style_names[style_class-&gt;style] ));
<span class="line-new-header">--- 288,13 ---</span>
      FT_TRACE4(( &quot;\n&quot;
                  &quot;style coverage\n&quot;
                  &quot;==============\n&quot;
                  &quot;\n&quot; ));
  
<span class="line-modified">!     for ( ss = 0; af_style_classes[ss]; ss++ )</span>
      {
<span class="line-modified">!       AF_StyleClass  style_class = af_style_classes[ss];</span>
        FT_UInt        count       = 0;
        FT_Long        idx;
  
  
        FT_TRACE4(( &quot;%s:\n&quot;, af_style_names[style_class-&gt;style] ));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 395,13 ***</span>
        for ( nn = 0; nn &lt; AF_STYLE_MAX; nn++ )
        {
          if ( globals-&gt;metrics[nn] )
          {
            AF_StyleClass          style_class =
<span class="line-modified">!             AF_STYLE_CLASSES_GET[nn];</span>
            AF_WritingSystemClass  writing_system_class =
<span class="line-modified">!             AF_WRITING_SYSTEM_CLASSES_GET[style_class-&gt;writing_system];</span>
  
  
            if ( writing_system_class-&gt;style_metrics_done )
              writing_system_class-&gt;style_metrics_done( globals-&gt;metrics[nn] );
  
<span class="line-new-header">--- 390,13 ---</span>
        for ( nn = 0; nn &lt; AF_STYLE_MAX; nn++ )
        {
          if ( globals-&gt;metrics[nn] )
          {
            AF_StyleClass          style_class =
<span class="line-modified">!             af_style_classes[nn];</span>
            AF_WritingSystemClass  writing_system_class =
<span class="line-modified">!             af_writing_system_classes[style_class-&gt;writing_system];</span>
  
  
            if ( writing_system_class-&gt;style_metrics_done )
              writing_system_class-&gt;style_metrics_done( globals-&gt;metrics[nn] );
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 446,12 ***</span>
      /* otherwise look into `glyph_styles&#39; array           */
      if ( style == AF_STYLE_NONE_DFLT || style + 1 &gt;= AF_STYLE_MAX )
        style = (AF_Style)( globals-&gt;glyph_styles[gindex] &amp;
                            AF_STYLE_UNASSIGNED           );
  
<span class="line-modified">!     style_class          = AF_STYLE_CLASSES_GET[style];</span>
<span class="line-modified">!     writing_system_class = AF_WRITING_SYSTEM_CLASSES_GET</span>
                               [style_class-&gt;writing_system];
  
      metrics = globals-&gt;metrics[style];
      if ( !metrics )
      {
<span class="line-new-header">--- 441,13 ---</span>
      /* otherwise look into `glyph_styles&#39; array           */
      if ( style == AF_STYLE_NONE_DFLT || style + 1 &gt;= AF_STYLE_MAX )
        style = (AF_Style)( globals-&gt;glyph_styles[gindex] &amp;
                            AF_STYLE_UNASSIGNED           );
  
<span class="line-modified">!   Again:</span>
<span class="line-modified">!     style_class          = af_style_classes[style];</span>
<span class="line-added">+     writing_system_class = af_writing_system_classes</span>
                               [style_class-&gt;writing_system];
  
      metrics = globals-&gt;metrics[style];
      if ( !metrics )
      {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 473,10 ***</span>
<span class="line-new-header">--- 469,20 ---</span>
          {
            if ( writing_system_class-&gt;style_metrics_done )
              writing_system_class-&gt;style_metrics_done( metrics );
  
            FT_FREE( metrics );
<span class="line-added">+ </span>
<span class="line-added">+           /* internal error code -1 indicates   */</span>
<span class="line-added">+           /* that no blue zones have been found */</span>
<span class="line-added">+           if ( error == -1 )</span>
<span class="line-added">+           {</span>
<span class="line-added">+             style = (AF_Style)( globals-&gt;glyph_styles[gindex] &amp;</span>
<span class="line-added">+                                 AF_STYLE_UNASSIGNED           );</span>
<span class="line-added">+             goto Again;</span>
<span class="line-added">+           }</span>
<span class="line-added">+ </span>
            goto Exit;
          }
        }
  
        globals-&gt;metrics[style] = metrics;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 492,12 ***</span>
    FT_LOCAL_DEF( FT_Bool )
    af_face_globals_is_digit( AF_FaceGlobals  globals,
                              FT_UInt         gindex )
    {
      if ( gindex &lt; (FT_ULong)globals-&gt;glyph_count )
<span class="line-modified">!       return (FT_Bool)( globals-&gt;glyph_styles[gindex] &amp; AF_DIGIT );</span>
  
<span class="line-modified">!     return (FT_Bool)0;</span>
    }
  
  
  /* END */
<span class="line-new-header">--- 498,12 ---</span>
    FT_LOCAL_DEF( FT_Bool )
    af_face_globals_is_digit( AF_FaceGlobals  globals,
                              FT_UInt         gindex )
    {
      if ( gindex &lt; (FT_ULong)globals-&gt;glyph_count )
<span class="line-modified">!       return FT_BOOL( globals-&gt;glyph_styles[gindex] &amp; AF_DIGIT );</span>
  
<span class="line-modified">!     return FT_BOOL( 0 );</span>
    }
  
  
  /* END */
</pre>
<center><a href="aferrors.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="afglobal.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>