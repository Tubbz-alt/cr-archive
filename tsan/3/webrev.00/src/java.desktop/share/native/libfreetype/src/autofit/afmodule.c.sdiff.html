<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/native/libfreetype/src/autofit/afmodule.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="afloader.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="afmodule.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/autofit/afmodule.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
<span class="line-modified">  1 /***************************************************************************/</span>
<span class="line-modified">  2 /*                                                                         */</span>
<span class="line-modified">  3 /*  afmodule.c                                                             */</span>
<span class="line-modified">  4 /*                                                                         */</span>
<span class="line-modified">  5 /*    Auto-fitter module implementation (body).                            */</span>
<span class="line-modified">  6 /*                                                                         */</span>
<span class="line-modified">  7 /*  Copyright 2003-2018 by                                                 */</span>
<span class="line-modified">  8 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="line-modified">  9 /*                                                                         */</span>
<span class="line-modified"> 10 /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified"> 11 /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified"> 12 /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified"> 13 /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified"> 14 /*  understand and accept it fully.                                        */</span>
<span class="line-modified"> 15 /*                                                                         */</span>
<span class="line-modified"> 16 /***************************************************************************/</span>
 17 
 18 
 19 #include &quot;afglobal.h&quot;
 20 #include &quot;afmodule.h&quot;
 21 #include &quot;afloader.h&quot;
 22 #include &quot;aferrors.h&quot;
<span class="line-removed"> 23 #include &quot;afpic.h&quot;</span>
 24 
 25 #ifdef FT_DEBUG_AUTOFIT
 26 
 27 #ifndef FT_MAKE_OPTION_SINGLE_OBJECT
 28 
 29 #ifdef __cplusplus
 30   extern &quot;C&quot; {
 31 #endif
 32   extern void
 33   af_glyph_hints_dump_segments( AF_GlyphHints  hints,
 34                                 FT_Bool        to_stdout );
 35   extern void
 36   af_glyph_hints_dump_points( AF_GlyphHints  hints,
 37                               FT_Bool        to_stdout );
 38   extern void
 39   af_glyph_hints_dump_edges( AF_GlyphHints  hints,
 40                              FT_Bool        to_stdout );
 41 #ifdef __cplusplus
 42   }
 43 #endif
 44 
 45 #endif
 46 
 47   int  _af_debug_disable_horz_hints;
 48   int  _af_debug_disable_vert_hints;
 49   int  _af_debug_disable_blue_hints;
 50 
 51   /* we use a global object instead of a local one for debugging */
 52   AF_GlyphHintsRec  _af_debug_hints_rec[1];
 53 
 54   void*  _af_debug_hints = _af_debug_hints_rec;
 55 #endif
 56 
 57 #include FT_INTERNAL_OBJECTS_H
 58 #include FT_INTERNAL_DEBUG_H
 59 #include FT_DRIVER_H
 60 #include FT_SERVICE_PROPERTIES_H
 61 
 62 
<span class="line-modified"> 63   /*************************************************************************/</span>
<span class="line-modified"> 64   /*                                                                       */</span>
<span class="line-modified"> 65   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="line-modified"> 66   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="line-modified"> 67   /* messages during execution.                                            */</span>
<span class="line-modified"> 68   /*                                                                       */</span>
 69 #undef  FT_COMPONENT
<span class="line-modified"> 70 #define FT_COMPONENT  trace_afmodule</span>
 71 
 72 
 73   static FT_Error
 74   af_property_get_face_globals( FT_Face          face,
 75                                 AF_FaceGlobals*  aglobals,
 76                                 AF_Module        module )
 77   {
 78     FT_Error        error = FT_Err_Ok;
 79     AF_FaceGlobals  globals;
 80 
 81 
 82     if ( !face )
 83       return FT_THROW( Invalid_Face_Handle );
 84 
 85     globals = (AF_FaceGlobals)face-&gt;autohint.data;
 86     if ( !globals )
 87     {
 88       /* trigger computation of the global style data */
 89       /* in case it hasn&#39;t been done yet              */
 90       error = af_face_globals_new( face, &amp;globals, module );
 91       if ( !error )
 92       {
 93         face-&gt;autohint.data =
 94           (FT_Pointer)globals;
 95         face-&gt;autohint.finalizer =
 96           (FT_Generic_Finalizer)af_face_globals_free;
 97       }
 98     }
 99 
100     if ( !error )
101       *aglobals = globals;
102 
103     return error;
104   }
105 
106 
<span class="line-removed">107 #ifdef FT_CONFIG_OPTION_PIC</span>
<span class="line-removed">108 </span>
<span class="line-removed">109 #undef  AF_SCRIPT_CLASSES_GET</span>
<span class="line-removed">110 #define AF_SCRIPT_CLASSES_GET  \</span>
<span class="line-removed">111           ( GET_PIC( ft_module-&gt;library )-&gt;af_script_classes )</span>
<span class="line-removed">112 </span>
<span class="line-removed">113 #undef  AF_STYLE_CLASSES_GET</span>
<span class="line-removed">114 #define AF_STYLE_CLASSES_GET  \</span>
<span class="line-removed">115           ( GET_PIC( ft_module-&gt;library )-&gt;af_style_classes )</span>
<span class="line-removed">116 </span>
<span class="line-removed">117 #endif</span>
<span class="line-removed">118 </span>
<span class="line-removed">119 </span>
120   static FT_Error
121   af_property_set( FT_Module    ft_module,
122                    const char*  property_name,
123                    const void*  value,
124                    FT_Bool      value_is_string )
125   {
126     FT_Error   error  = FT_Err_Ok;
127     AF_Module  module = (AF_Module)ft_module;
128 
129 #ifndef FT_CONFIG_OPTION_ENVIRONMENT_PROPERTIES
130     FT_UNUSED( value_is_string );
131 #endif
132 
133 
134     if ( !ft_strcmp( property_name, &quot;fallback-script&quot; ) )
135     {
136       FT_UInt*  fallback_script;
137       FT_UInt   ss;
138 
139 
140 #ifdef FT_CONFIG_OPTION_ENVIRONMENT_PROPERTIES
141       if ( value_is_string )
142         return FT_THROW( Invalid_Argument );
143 #endif
144 
145       fallback_script = (FT_UInt*)value;
146 
147       /* We translate the fallback script to a fallback style that uses */
148       /* `fallback-script&#39; as its script and `AF_COVERAGE_NONE&#39; as its  */
149       /* coverage value.                                                */
<span class="line-modified">150       for ( ss = 0; AF_STYLE_CLASSES_GET[ss]; ss++ )</span>
151       {
<span class="line-modified">152         AF_StyleClass  style_class = AF_STYLE_CLASSES_GET[ss];</span>
153 
154 
155         if ( (FT_UInt)style_class-&gt;script == *fallback_script &amp;&amp;
156              style_class-&gt;coverage == AF_COVERAGE_DEFAULT     )
157         {
158           module-&gt;fallback_style = ss;
159           break;
160         }
161       }
162 
<span class="line-modified">163       if ( !AF_STYLE_CLASSES_GET[ss] )</span>
164       {
165         FT_TRACE0(( &quot;af_property_set: Invalid value %d for property `%s&#39;\n&quot;,
166                     fallback_script, property_name ));
167         return FT_THROW( Invalid_Argument );
168       }
169 
170       return error;
171     }
172     else if ( !ft_strcmp( property_name, &quot;default-script&quot; ) )
173     {
174       FT_UInt*  default_script;
175 
176 
177 #ifdef FT_CONFIG_OPTION_ENVIRONMENT_PROPERTIES
178       if ( value_is_string )
179         return FT_THROW( Invalid_Argument );
180 #endif
181 
182       default_script = (FT_UInt*)value;
183 
</pre>
<hr />
<pre>
340     FT_Bool    warping        = module-&gt;warping;
341 #endif
342 
343 
344     if ( !ft_strcmp( property_name, &quot;glyph-to-script-map&quot; ) )
345     {
346       FT_Prop_GlyphToScriptMap*  prop = (FT_Prop_GlyphToScriptMap*)value;
347       AF_FaceGlobals             globals;
348 
349 
350       error = af_property_get_face_globals( prop-&gt;face, &amp;globals, module );
351       if ( !error )
352         prop-&gt;map = globals-&gt;glyph_styles;
353 
354       return error;
355     }
356     else if ( !ft_strcmp( property_name, &quot;fallback-script&quot; ) )
357     {
358       FT_UInt*  val = (FT_UInt*)value;
359 
<span class="line-modified">360       AF_StyleClass  style_class = AF_STYLE_CLASSES_GET[fallback_style];</span>
361 
362 
363       *val = style_class-&gt;script;
364 
365       return error;
366     }
367     else if ( !ft_strcmp( property_name, &quot;default-script&quot; ) )
368     {
369       FT_UInt*  val = (FT_UInt*)value;
370 
371 
372       *val = default_script;
373 
374       return error;
375     }
376     else if ( !ft_strcmp( property_name, &quot;increase-x-height&quot; ) )
377     {
378       FT_Prop_IncreaseXHeight*  prop = (FT_Prop_IncreaseXHeight*)value;
379       AF_FaceGlobals            globals;
380 
</pre>
<hr />
<pre>
423 
424       return error;
425     }
426 
427     FT_TRACE0(( &quot;af_property_get: missing property `%s&#39;\n&quot;,
428                 property_name ));
429     return FT_THROW( Missing_Property );
430   }
431 
432 
433   FT_DEFINE_SERVICE_PROPERTIESREC(
434     af_service_properties,
435 
436     (FT_Properties_SetFunc)af_property_set,        /* set_property */
437     (FT_Properties_GetFunc)af_property_get )       /* get_property */
438 
439 
440   FT_DEFINE_SERVICEDESCREC1(
441     af_services,
442 
<span class="line-modified">443     FT_SERVICE_ID_PROPERTIES, &amp;AF_SERVICE_PROPERTIES_GET )</span>
444 
445 
446   FT_CALLBACK_DEF( FT_Module_Interface )
447   af_get_interface( FT_Module    module,
448                     const char*  module_interface )
449   {
<span class="line-removed">450     /* AF_SERVICES_GET dereferences `library&#39; in PIC mode */</span>
<span class="line-removed">451 #ifdef FT_CONFIG_OPTION_PIC</span>
<span class="line-removed">452     FT_Library  library;</span>
<span class="line-removed">453 </span>
<span class="line-removed">454 </span>
<span class="line-removed">455     if ( !module )</span>
<span class="line-removed">456       return NULL;</span>
<span class="line-removed">457     library = module-&gt;library;</span>
<span class="line-removed">458     if ( !library )</span>
<span class="line-removed">459       return NULL;</span>
<span class="line-removed">460 #else</span>
461     FT_UNUSED( module );
<span class="line-removed">462 #endif</span>
463 
<span class="line-modified">464     return ft_service_list_lookup( AF_SERVICES_GET, module_interface );</span>
465   }
466 
467 
468   FT_CALLBACK_DEF( FT_Error )
469   af_autofitter_init( FT_Module  ft_module )      /* AF_Module */
470   {
471     AF_Module  module = (AF_Module)ft_module;
472 
473 
474     module-&gt;fallback_style    = AF_STYLE_FALLBACK;
475     module-&gt;default_script    = AF_SCRIPT_DEFAULT;
476 #ifdef AF_CONFIG_OPTION_USE_WARPER
477     module-&gt;warping           = 0;
478 #endif
479     module-&gt;no_stem_darkening = TRUE;
480 
481     module-&gt;darken_params[0]  = CFF_CONFIG_OPTION_DARKENING_PARAMETER_X1;
482     module-&gt;darken_params[1]  = CFF_CONFIG_OPTION_DARKENING_PARAMETER_Y1;
483     module-&gt;darken_params[2]  = CFF_CONFIG_OPTION_DARKENING_PARAMETER_X2;
484     module-&gt;darken_params[3]  = CFF_CONFIG_OPTION_DARKENING_PARAMETER_Y2;
</pre>
<hr />
<pre>
516 #ifdef FT_DEBUG_AUTOFIT
517 
518     /* in debug mode, we use a global object that survives this routine */
519 
520     AF_GlyphHints  hints = _af_debug_hints_rec;
521     AF_LoaderRec   loader[1];
522 
523     FT_UNUSED( size );
524 
525 
526     if ( hints-&gt;memory )
527       af_glyph_hints_done( hints );
528 
529     af_glyph_hints_init( hints, memory );
530     af_loader_init( loader, hints );
531 
532     error = af_loader_load_glyph( loader, module, slot-&gt;face,
533                                   glyph_index, load_flags );
534 
535 #ifdef FT_DEBUG_LEVEL_TRACE
<span class="line-modified">536     if ( ft_trace_levels[FT_COMPONENT] )</span>
537     {
538 #endif
539       af_glyph_hints_dump_points( hints, 0 );
540       af_glyph_hints_dump_segments( hints, 0 );
541       af_glyph_hints_dump_edges( hints, 0 );
542 #ifdef FT_DEBUG_LEVEL_TRACE
543     }
544 #endif
545 
546     af_loader_done( loader );
547 
548     return error;
549 
550 #else /* !FT_DEBUG_AUTOFIT */
551 
552     AF_GlyphHintsRec  hints[1];
553     AF_LoaderRec      loader[1];
554 
555     FT_UNUSED( size );
556 
</pre>
<hr />
<pre>
572 
573   FT_DEFINE_AUTOHINTER_INTERFACE(
574     af_autofitter_interface,
575 
576     NULL,                                                    /* reset_face */
577     NULL,                                              /* get_global_hints */
578     NULL,                                             /* done_global_hints */
579     (FT_AutoHinter_GlyphLoadFunc)af_autofitter_load_glyph )  /* load_glyph */
580 
581 
582   FT_DEFINE_MODULE(
583     autofit_module_class,
584 
585     FT_MODULE_HINTER,
586     sizeof ( AF_ModuleRec ),
587 
588     &quot;autofitter&quot;,
589     0x10000L,   /* version 1.0 of the autofitter  */
590     0x20000L,   /* requires FreeType 2.0 or above */
591 
<span class="line-modified">592     (const void*)&amp;AF_INTERFACE_GET,</span>
593 
594     (FT_Module_Constructor)af_autofitter_init,  /* module_init   */
595     (FT_Module_Destructor) af_autofitter_done,  /* module_done   */
596     (FT_Module_Requester)  af_get_interface     /* get_interface */
597   )
598 
599 
600 /* END */
</pre>
</td>
<td>
<hr />
<pre>
<span class="line-modified">  1 /****************************************************************************</span>
<span class="line-modified">  2  *</span>
<span class="line-modified">  3  * afmodule.c</span>
<span class="line-modified">  4  *</span>
<span class="line-modified">  5  *   Auto-fitter module implementation (body).</span>
<span class="line-modified">  6  *</span>
<span class="line-modified">  7  * Copyright (C) 2003-2019 by</span>
<span class="line-modified">  8  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">  9  *</span>
<span class="line-modified"> 10  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified"> 11  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified"> 12  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified"> 13  * this file you indicate that you have read the license and</span>
<span class="line-modified"> 14  * understand and accept it fully.</span>
<span class="line-modified"> 15  *</span>
<span class="line-modified"> 16  */</span>
 17 
 18 
 19 #include &quot;afglobal.h&quot;
 20 #include &quot;afmodule.h&quot;
 21 #include &quot;afloader.h&quot;
 22 #include &quot;aferrors.h&quot;

 23 
 24 #ifdef FT_DEBUG_AUTOFIT
 25 
 26 #ifndef FT_MAKE_OPTION_SINGLE_OBJECT
 27 
 28 #ifdef __cplusplus
 29   extern &quot;C&quot; {
 30 #endif
 31   extern void
 32   af_glyph_hints_dump_segments( AF_GlyphHints  hints,
 33                                 FT_Bool        to_stdout );
 34   extern void
 35   af_glyph_hints_dump_points( AF_GlyphHints  hints,
 36                               FT_Bool        to_stdout );
 37   extern void
 38   af_glyph_hints_dump_edges( AF_GlyphHints  hints,
 39                              FT_Bool        to_stdout );
 40 #ifdef __cplusplus
 41   }
 42 #endif
 43 
 44 #endif
 45 
 46   int  _af_debug_disable_horz_hints;
 47   int  _af_debug_disable_vert_hints;
 48   int  _af_debug_disable_blue_hints;
 49 
 50   /* we use a global object instead of a local one for debugging */
 51   AF_GlyphHintsRec  _af_debug_hints_rec[1];
 52 
 53   void*  _af_debug_hints = _af_debug_hints_rec;
 54 #endif
 55 
 56 #include FT_INTERNAL_OBJECTS_H
 57 #include FT_INTERNAL_DEBUG_H
 58 #include FT_DRIVER_H
 59 #include FT_SERVICE_PROPERTIES_H
 60 
 61 
<span class="line-modified"> 62   /**************************************************************************</span>
<span class="line-modified"> 63    *</span>
<span class="line-modified"> 64    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="line-modified"> 65    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="line-modified"> 66    * messages during execution.</span>
<span class="line-modified"> 67    */</span>
 68 #undef  FT_COMPONENT
<span class="line-modified"> 69 #define FT_COMPONENT  afmodule</span>
 70 
 71 
 72   static FT_Error
 73   af_property_get_face_globals( FT_Face          face,
 74                                 AF_FaceGlobals*  aglobals,
 75                                 AF_Module        module )
 76   {
 77     FT_Error        error = FT_Err_Ok;
 78     AF_FaceGlobals  globals;
 79 
 80 
 81     if ( !face )
 82       return FT_THROW( Invalid_Face_Handle );
 83 
 84     globals = (AF_FaceGlobals)face-&gt;autohint.data;
 85     if ( !globals )
 86     {
 87       /* trigger computation of the global style data */
 88       /* in case it hasn&#39;t been done yet              */
 89       error = af_face_globals_new( face, &amp;globals, module );
 90       if ( !error )
 91       {
 92         face-&gt;autohint.data =
 93           (FT_Pointer)globals;
 94         face-&gt;autohint.finalizer =
 95           (FT_Generic_Finalizer)af_face_globals_free;
 96       }
 97     }
 98 
 99     if ( !error )
100       *aglobals = globals;
101 
102     return error;
103   }
104 
105 













106   static FT_Error
107   af_property_set( FT_Module    ft_module,
108                    const char*  property_name,
109                    const void*  value,
110                    FT_Bool      value_is_string )
111   {
112     FT_Error   error  = FT_Err_Ok;
113     AF_Module  module = (AF_Module)ft_module;
114 
115 #ifndef FT_CONFIG_OPTION_ENVIRONMENT_PROPERTIES
116     FT_UNUSED( value_is_string );
117 #endif
118 
119 
120     if ( !ft_strcmp( property_name, &quot;fallback-script&quot; ) )
121     {
122       FT_UInt*  fallback_script;
123       FT_UInt   ss;
124 
125 
126 #ifdef FT_CONFIG_OPTION_ENVIRONMENT_PROPERTIES
127       if ( value_is_string )
128         return FT_THROW( Invalid_Argument );
129 #endif
130 
131       fallback_script = (FT_UInt*)value;
132 
133       /* We translate the fallback script to a fallback style that uses */
134       /* `fallback-script&#39; as its script and `AF_COVERAGE_NONE&#39; as its  */
135       /* coverage value.                                                */
<span class="line-modified">136       for ( ss = 0; af_style_classes[ss]; ss++ )</span>
137       {
<span class="line-modified">138         AF_StyleClass  style_class = af_style_classes[ss];</span>
139 
140 
141         if ( (FT_UInt)style_class-&gt;script == *fallback_script &amp;&amp;
142              style_class-&gt;coverage == AF_COVERAGE_DEFAULT     )
143         {
144           module-&gt;fallback_style = ss;
145           break;
146         }
147       }
148 
<span class="line-modified">149       if ( !af_style_classes[ss] )</span>
150       {
151         FT_TRACE0(( &quot;af_property_set: Invalid value %d for property `%s&#39;\n&quot;,
152                     fallback_script, property_name ));
153         return FT_THROW( Invalid_Argument );
154       }
155 
156       return error;
157     }
158     else if ( !ft_strcmp( property_name, &quot;default-script&quot; ) )
159     {
160       FT_UInt*  default_script;
161 
162 
163 #ifdef FT_CONFIG_OPTION_ENVIRONMENT_PROPERTIES
164       if ( value_is_string )
165         return FT_THROW( Invalid_Argument );
166 #endif
167 
168       default_script = (FT_UInt*)value;
169 
</pre>
<hr />
<pre>
326     FT_Bool    warping        = module-&gt;warping;
327 #endif
328 
329 
330     if ( !ft_strcmp( property_name, &quot;glyph-to-script-map&quot; ) )
331     {
332       FT_Prop_GlyphToScriptMap*  prop = (FT_Prop_GlyphToScriptMap*)value;
333       AF_FaceGlobals             globals;
334 
335 
336       error = af_property_get_face_globals( prop-&gt;face, &amp;globals, module );
337       if ( !error )
338         prop-&gt;map = globals-&gt;glyph_styles;
339 
340       return error;
341     }
342     else if ( !ft_strcmp( property_name, &quot;fallback-script&quot; ) )
343     {
344       FT_UInt*  val = (FT_UInt*)value;
345 
<span class="line-modified">346       AF_StyleClass  style_class = af_style_classes[fallback_style];</span>
347 
348 
349       *val = style_class-&gt;script;
350 
351       return error;
352     }
353     else if ( !ft_strcmp( property_name, &quot;default-script&quot; ) )
354     {
355       FT_UInt*  val = (FT_UInt*)value;
356 
357 
358       *val = default_script;
359 
360       return error;
361     }
362     else if ( !ft_strcmp( property_name, &quot;increase-x-height&quot; ) )
363     {
364       FT_Prop_IncreaseXHeight*  prop = (FT_Prop_IncreaseXHeight*)value;
365       AF_FaceGlobals            globals;
366 
</pre>
<hr />
<pre>
409 
410       return error;
411     }
412 
413     FT_TRACE0(( &quot;af_property_get: missing property `%s&#39;\n&quot;,
414                 property_name ));
415     return FT_THROW( Missing_Property );
416   }
417 
418 
419   FT_DEFINE_SERVICE_PROPERTIESREC(
420     af_service_properties,
421 
422     (FT_Properties_SetFunc)af_property_set,        /* set_property */
423     (FT_Properties_GetFunc)af_property_get )       /* get_property */
424 
425 
426   FT_DEFINE_SERVICEDESCREC1(
427     af_services,
428 
<span class="line-modified">429     FT_SERVICE_ID_PROPERTIES, &amp;af_service_properties )</span>
430 
431 
432   FT_CALLBACK_DEF( FT_Module_Interface )
433   af_get_interface( FT_Module    module,
434                     const char*  module_interface )
435   {











436     FT_UNUSED( module );

437 
<span class="line-modified">438     return ft_service_list_lookup( af_services, module_interface );</span>
439   }
440 
441 
442   FT_CALLBACK_DEF( FT_Error )
443   af_autofitter_init( FT_Module  ft_module )      /* AF_Module */
444   {
445     AF_Module  module = (AF_Module)ft_module;
446 
447 
448     module-&gt;fallback_style    = AF_STYLE_FALLBACK;
449     module-&gt;default_script    = AF_SCRIPT_DEFAULT;
450 #ifdef AF_CONFIG_OPTION_USE_WARPER
451     module-&gt;warping           = 0;
452 #endif
453     module-&gt;no_stem_darkening = TRUE;
454 
455     module-&gt;darken_params[0]  = CFF_CONFIG_OPTION_DARKENING_PARAMETER_X1;
456     module-&gt;darken_params[1]  = CFF_CONFIG_OPTION_DARKENING_PARAMETER_Y1;
457     module-&gt;darken_params[2]  = CFF_CONFIG_OPTION_DARKENING_PARAMETER_X2;
458     module-&gt;darken_params[3]  = CFF_CONFIG_OPTION_DARKENING_PARAMETER_Y2;
</pre>
<hr />
<pre>
490 #ifdef FT_DEBUG_AUTOFIT
491 
492     /* in debug mode, we use a global object that survives this routine */
493 
494     AF_GlyphHints  hints = _af_debug_hints_rec;
495     AF_LoaderRec   loader[1];
496 
497     FT_UNUSED( size );
498 
499 
500     if ( hints-&gt;memory )
501       af_glyph_hints_done( hints );
502 
503     af_glyph_hints_init( hints, memory );
504     af_loader_init( loader, hints );
505 
506     error = af_loader_load_glyph( loader, module, slot-&gt;face,
507                                   glyph_index, load_flags );
508 
509 #ifdef FT_DEBUG_LEVEL_TRACE
<span class="line-modified">510     if ( ft_trace_levels[FT_TRACE_COMP( FT_COMPONENT )] )</span>
511     {
512 #endif
513       af_glyph_hints_dump_points( hints, 0 );
514       af_glyph_hints_dump_segments( hints, 0 );
515       af_glyph_hints_dump_edges( hints, 0 );
516 #ifdef FT_DEBUG_LEVEL_TRACE
517     }
518 #endif
519 
520     af_loader_done( loader );
521 
522     return error;
523 
524 #else /* !FT_DEBUG_AUTOFIT */
525 
526     AF_GlyphHintsRec  hints[1];
527     AF_LoaderRec      loader[1];
528 
529     FT_UNUSED( size );
530 
</pre>
<hr />
<pre>
546 
547   FT_DEFINE_AUTOHINTER_INTERFACE(
548     af_autofitter_interface,
549 
550     NULL,                                                    /* reset_face */
551     NULL,                                              /* get_global_hints */
552     NULL,                                             /* done_global_hints */
553     (FT_AutoHinter_GlyphLoadFunc)af_autofitter_load_glyph )  /* load_glyph */
554 
555 
556   FT_DEFINE_MODULE(
557     autofit_module_class,
558 
559     FT_MODULE_HINTER,
560     sizeof ( AF_ModuleRec ),
561 
562     &quot;autofitter&quot;,
563     0x10000L,   /* version 1.0 of the autofitter  */
564     0x20000L,   /* requires FreeType 2.0 or above */
565 
<span class="line-modified">566     (const void*)&amp;af_autofitter_interface,</span>
567 
568     (FT_Module_Constructor)af_autofitter_init,  /* module_init   */
569     (FT_Module_Destructor) af_autofitter_done,  /* module_done   */
570     (FT_Module_Requester)  af_get_interface     /* get_interface */
571   )
572 
573 
574 /* END */
</pre>
</td>
</tr>
</table>
<center><a href="afloader.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="afmodule.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>