<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/native/libfreetype/src/cff/cffobjs.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="cffload.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="cffobjs.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/cff/cffobjs.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,21 ***</span>
<span class="line-modified">! /***************************************************************************/</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  cffobjs.c                                                              */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*    OpenType objects manager (body).                                     */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  Copyright 1996-2018 by                                                 */</span>
<span class="line-modified">! /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified">! /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified">! /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified">! /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified">! /*  understand and accept it fully.                                        */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /***************************************************************************/</span>
  
  
  #include &lt;ft2build.h&gt;
  
  #include FT_INTERNAL_DEBUG_H
<span class="line-new-header">--- 1,21 ---</span>
<span class="line-modified">! /****************************************************************************</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * cffobjs.c</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  *   OpenType objects manager (body).</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * Copyright (C) 1996-2019 by</span>
<span class="line-modified">!  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified">!  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified">!  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified">!  * this file you indicate that you have read the license and</span>
<span class="line-modified">!  * understand and accept it fully.</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  */</span>
  
  
  #include &lt;ft2build.h&gt;
  
  #include FT_INTERNAL_DEBUG_H
</pre>
<hr />
<pre>
<span class="line-old-header">*** 35,33 ***</span>
  
  #include FT_INTERNAL_CFF_OBJECTS_TYPES_H
  #include &quot;cffobjs.h&quot;
  #include &quot;cffload.h&quot;
  #include &quot;cffcmap.h&quot;
<span class="line-removed">- #include &quot;cffpic.h&quot;</span>
  
  #include &quot;cfferrs.h&quot;
  
  #include FT_INTERNAL_POSTSCRIPT_AUX_H
  #include FT_SERVICE_CFF_TABLE_LOAD_H
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="line-modified">!   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="line-modified">!   /* messages during execution.                                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
  #undef  FT_COMPONENT
<span class="line-modified">! #define FT_COMPONENT  trace_cffobjs</span>
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*                            SIZE FUNCTIONS                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*************************************************************************/</span>
  
  
    static PSH_Globals_Funcs
    cff_size_get_globals_funcs( CFF_Size  size )
    {
<span class="line-new-header">--- 35,32 ---</span>
  
  #include FT_INTERNAL_CFF_OBJECTS_TYPES_H
  #include &quot;cffobjs.h&quot;
  #include &quot;cffload.h&quot;
  #include &quot;cffcmap.h&quot;
  
  #include &quot;cfferrs.h&quot;
  
  #include FT_INTERNAL_POSTSCRIPT_AUX_H
  #include FT_SERVICE_CFF_TABLE_LOAD_H
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="line-modified">!    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="line-modified">!    * messages during execution.</span>
<span class="line-modified">!    */</span>
  #undef  FT_COMPONENT
<span class="line-modified">! #define FT_COMPONENT  cffobjs</span>
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *                           SIZE FUNCTIONS</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    */</span>
  
  
    static PSH_Globals_Funcs
    cff_size_get_globals_funcs( CFF_Size  size )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 339,15 ***</span>
  
      return FT_Err_Ok;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*                            SLOT  FUNCTIONS                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*************************************************************************/</span>
  
    FT_LOCAL_DEF( void )
    cff_slot_done( FT_GlyphSlot  slot )
    {
      slot-&gt;internal-&gt;glyph_hints = NULL;
<span class="line-new-header">--- 338,15 ---</span>
  
      return FT_Err_Ok;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *                           SLOT  FUNCTIONS</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    */</span>
  
    FT_LOCAL_DEF( void )
    cff_slot_done( FT_GlyphSlot  slot )
    {
      slot-&gt;internal-&gt;glyph_hints = NULL;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 381,15 ***</span>
  
      return FT_Err_Ok;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*                           FACE  FUNCTIONS                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*************************************************************************/</span>
  
    static FT_String*
    cff_strcpy( FT_Memory         memory,
                const FT_String*  source )
    {
<span class="line-new-header">--- 380,15 ---</span>
  
      return FT_Err_Ok;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *                          FACE  FUNCTIONS</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    */</span>
  
    static FT_String*
    cff_strcpy( FT_Memory         memory,
                const FT_String*  source )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 643,18 ***</span>
  
        cffface-&gt;num_glyphs = (FT_Long)cff-&gt;num_glyphs;
  
        dict = &amp;cff-&gt;top_font.font_dict;
  
<span class="line-modified">!       /* we need the `PSNames&#39; module for CFF and CEF formats */</span>
        /* which aren&#39;t CID-keyed                               */
        if ( dict-&gt;cid_registry == 0xFFFFU &amp;&amp; !psnames )
        {
          FT_ERROR(( &quot;cff_face_init:&quot;
                     &quot; cannot open CFF &amp; CEF fonts\n&quot;
                     &quot;              &quot;
<span class="line-modified">!                    &quot; without the `PSNames&#39; module\n&quot; ));</span>
          error = FT_THROW( Missing_Module );
          goto Exit;
        }
  
  #ifdef FT_DEBUG_LEVEL_TRACE
<span class="line-new-header">--- 642,18 ---</span>
  
        cffface-&gt;num_glyphs = (FT_Long)cff-&gt;num_glyphs;
  
        dict = &amp;cff-&gt;top_font.font_dict;
  
<span class="line-modified">!       /* we need the `psnames&#39; module for CFF and CEF formats */</span>
        /* which aren&#39;t CID-keyed                               */
        if ( dict-&gt;cid_registry == 0xFFFFU &amp;&amp; !psnames )
        {
          FT_ERROR(( &quot;cff_face_init:&quot;
                     &quot; cannot open CFF &amp; CEF fonts\n&quot;
                     &quot;              &quot;
<span class="line-modified">!                    &quot; without the `psnames&#39; module\n&quot; ));</span>
          error = FT_THROW( Missing_Module );
          goto Exit;
        }
  
  #ifdef FT_DEBUG_LEVEL_TRACE
</pre>
<hr />
<pre>
<span class="line-old-header">*** 961,16 ***</span>
  
          if ( style_name )
            cffface-&gt;style_name = style_name;
          else
            /* assume &quot;Regular&quot; style if we don&#39;t know better */
<span class="line-modified">!           cffface-&gt;style_name = cff_strcpy( memory, (char *)&quot;Regular&quot; );</span>
  
<span class="line-modified">!         /*******************************************************************/</span>
<span class="line-modified">!         /*                                                                 */</span>
<span class="line-modified">!         /* Compute face flags.                                             */</span>
<span class="line-modified">!         /*                                                                 */</span>
          flags = FT_FACE_FLAG_SCALABLE   | /* scalable outlines */
                  FT_FACE_FLAG_HORIZONTAL | /* horizontal data   */
                  FT_FACE_FLAG_HINTER;      /* has native hinter */
  
          if ( sfnt_format )
<span class="line-new-header">--- 960,16 ---</span>
  
          if ( style_name )
            cffface-&gt;style_name = style_name;
          else
            /* assume &quot;Regular&quot; style if we don&#39;t know better */
<span class="line-modified">!           cffface-&gt;style_name = cff_strcpy( memory, &quot;Regular&quot; );</span>
  
<span class="line-modified">!         /********************************************************************</span>
<span class="line-modified">!          *</span>
<span class="line-modified">!          * Compute face flags.</span>
<span class="line-modified">!          */</span>
          flags = FT_FACE_FLAG_SCALABLE   | /* scalable outlines */
                  FT_FACE_FLAG_HORIZONTAL | /* horizontal data   */
                  FT_FACE_FLAG_HINTER;      /* has native hinter */
  
          if ( sfnt_format )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 987,14 ***</span>
            flags |= FT_FACE_FLAG_KERNING;
  #endif
  
          cffface-&gt;face_flags |= flags;
  
<span class="line-modified">!         /*******************************************************************/</span>
<span class="line-modified">!         /*                                                                 */</span>
<span class="line-modified">!         /* Compute style flags.                                            */</span>
<span class="line-modified">!         /*                                                                 */</span>
          flags = 0;
  
          if ( dict-&gt;italic_angle )
            flags |= FT_STYLE_FLAG_ITALIC;
  
<span class="line-new-header">--- 986,14 ---</span>
            flags |= FT_FACE_FLAG_KERNING;
  #endif
  
          cffface-&gt;face_flags |= flags;
  
<span class="line-modified">!         /********************************************************************</span>
<span class="line-modified">!          *</span>
<span class="line-modified">!          * Compute style flags.</span>
<span class="line-modified">!          */</span>
          flags = 0;
  
          if ( dict-&gt;italic_angle )
            flags |= FT_STYLE_FLAG_ITALIC;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1026,14 ***</span>
  #endif
  
        if ( dict-&gt;cid_registry != 0xFFFFU &amp;&amp; pure_cff )
          cffface-&gt;face_flags |= FT_FACE_FLAG_CID_KEYED;
  
<span class="line-modified">!       /*******************************************************************/</span>
<span class="line-modified">!       /*                                                                 */</span>
<span class="line-modified">!       /* Compute char maps.                                              */</span>
<span class="line-modified">!       /*                                                                 */</span>
  
        /* Try to synthesize a Unicode charmap if there is none available */
        /* already.  If an OpenType font contains a Unicode &quot;cmap&quot;, we    */
        /* will use it, whatever be in the CFF part of the file.          */
        {
<span class="line-new-header">--- 1025,14 ---</span>
  #endif
  
        if ( dict-&gt;cid_registry != 0xFFFFU &amp;&amp; pure_cff )
          cffface-&gt;face_flags |= FT_FACE_FLAG_CID_KEYED;
  
<span class="line-modified">!       /********************************************************************</span>
<span class="line-modified">!        *</span>
<span class="line-modified">!        * Compute char maps.</span>
<span class="line-modified">!        */</span>
  
        /* Try to synthesize a Unicode charmap if there is none available */
        /* already.  If an OpenType font contains a Unicode &quot;cmap&quot;, we    */
        /* will use it, whatever be in the CFF part of the file.          */
        {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1068,14 ***</span>
          cmaprec.encoding_id = TT_MS_ID_UNICODE_CS;
          cmaprec.encoding    = FT_ENCODING_UNICODE;
  
          nn = (FT_UInt)cffface-&gt;num_charmaps;
  
<span class="line-modified">!         error = FT_CMap_New( &amp;CFF_CMAP_UNICODE_CLASS_REC_GET, NULL,</span>
                               &amp;cmaprec, NULL );
          if ( error                                      &amp;&amp;
<span class="line-modified">!              FT_ERR_NEQ( error, No_Unicode_Glyph_Name ) )</span>
            goto Exit;
          error = FT_Err_Ok;
  
          /* if no Unicode charmap was previously selected, select this one */
          if ( !cffface-&gt;charmap &amp;&amp; nn != (FT_UInt)cffface-&gt;num_charmaps )
<span class="line-new-header">--- 1067,15 ---</span>
          cmaprec.encoding_id = TT_MS_ID_UNICODE_CS;
          cmaprec.encoding    = FT_ENCODING_UNICODE;
  
          nn = (FT_UInt)cffface-&gt;num_charmaps;
  
<span class="line-modified">!         error = FT_CMap_New( &amp;cff_cmap_unicode_class_rec, NULL,</span>
                               &amp;cmaprec, NULL );
          if ( error                                      &amp;&amp;
<span class="line-modified">!              FT_ERR_NEQ( error, No_Unicode_Glyph_Name ) &amp;&amp;</span>
<span class="line-added">+              FT_ERR_NEQ( error, Unimplemented_Feature ) )</span>
            goto Exit;
          error = FT_Err_Ok;
  
          /* if no Unicode charmap was previously selected, select this one */
          if ( !cffface-&gt;charmap &amp;&amp; nn != (FT_UInt)cffface-&gt;num_charmaps )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1092,23 ***</span>
  
            if ( encoding-&gt;offset == 0 )
            {
              cmaprec.encoding_id = TT_ADOBE_ID_STANDARD;
              cmaprec.encoding    = FT_ENCODING_ADOBE_STANDARD;
<span class="line-modified">!             clazz               = &amp;CFF_CMAP_ENCODING_CLASS_REC_GET;</span>
            }
            else if ( encoding-&gt;offset == 1 )
            {
              cmaprec.encoding_id = TT_ADOBE_ID_EXPERT;
              cmaprec.encoding    = FT_ENCODING_ADOBE_EXPERT;
<span class="line-modified">!             clazz               = &amp;CFF_CMAP_ENCODING_CLASS_REC_GET;</span>
            }
            else
            {
              cmaprec.encoding_id = TT_ADOBE_ID_CUSTOM;
              cmaprec.encoding    = FT_ENCODING_ADOBE_CUSTOM;
<span class="line-modified">!             clazz               = &amp;CFF_CMAP_ENCODING_CLASS_REC_GET;</span>
            }
  
            error = FT_CMap_New( clazz, NULL, &amp;cmaprec, NULL );
          }
        }
<span class="line-new-header">--- 1092,23 ---</span>
  
            if ( encoding-&gt;offset == 0 )
            {
              cmaprec.encoding_id = TT_ADOBE_ID_STANDARD;
              cmaprec.encoding    = FT_ENCODING_ADOBE_STANDARD;
<span class="line-modified">!             clazz               = &amp;cff_cmap_encoding_class_rec;</span>
            }
            else if ( encoding-&gt;offset == 1 )
            {
              cmaprec.encoding_id = TT_ADOBE_ID_EXPERT;
              cmaprec.encoding    = FT_ENCODING_ADOBE_EXPERT;
<span class="line-modified">!             clazz               = &amp;cff_cmap_encoding_class_rec;</span>
            }
            else
            {
              cmaprec.encoding_id = TT_ADOBE_ID_CUSTOM;
              cmaprec.encoding    = FT_ENCODING_ADOBE_CUSTOM;
<span class="line-modified">!             clazz               = &amp;cff_cmap_encoding_class_rec;</span>
            }
  
            error = FT_CMap_New( clazz, NULL, &amp;cmaprec, NULL );
          }
        }
</pre>
<center><a href="cffload.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="cffobjs.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>