<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/share/native/libfreetype/src/base/ftglyph.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ftgloadr.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="fthash.c.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/base/ftglyph.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,53 +1,52 @@</span>
<span class="udiff-line-modified-removed">- /***************************************************************************/</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  ftglyph.c                                                              */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*    FreeType convenience functions to handle glyphs (body).              */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  Copyright 1996-2018 by                                                 */</span>
<span class="udiff-line-modified-removed">- /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="udiff-line-modified-removed">- /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="udiff-line-modified-removed">- /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="udiff-line-modified-removed">- /*  this file you indicate that you have read the license and              */</span>
<span class="udiff-line-modified-removed">- /*  understand and accept it fully.                                        */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /***************************************************************************/</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*  This file contains the definition of several convenience functions   */</span>
<span class="udiff-line-modified-removed">-   /*  that can be used by client applications to easily retrieve glyph     */</span>
<span class="udiff-line-modified-removed">-   /*  bitmaps and outlines from a given face.                              */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*  These functions should be optional if you are writing a font server  */</span>
<span class="udiff-line-modified-removed">-   /*  or text layout engine on top of FreeType.  However, they are pretty  */</span>
<span class="udiff-line-modified-removed">-   /*  handy for many other simple uses of the library.                     */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-added">+ /****************************************************************************</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * ftglyph.c</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  *   FreeType convenience functions to handle glyphs (body).</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * Copyright (C) 1996-2019 by</span>
<span class="udiff-line-modified-added">+  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * This file is part of the FreeType project, and may only be used,</span>
<span class="udiff-line-modified-added">+  * modified, and distributed under the terms of the FreeType project</span>
<span class="udiff-line-modified-added">+  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="udiff-line-modified-added">+  * this file you indicate that you have read the license and</span>
<span class="udiff-line-modified-added">+  * understand and accept it fully.</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  */</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   /**************************************************************************</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * This file contains the definition of several convenience functions</span>
<span class="udiff-line-modified-added">+    * that can be used by client applications to easily retrieve glyph</span>
<span class="udiff-line-modified-added">+    * bitmaps and outlines from a given face.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * These functions should be optional if you are writing a font server</span>
<span class="udiff-line-modified-added">+    * or text layout engine on top of FreeType.  However, they are pretty</span>
<span class="udiff-line-modified-added">+    * handy for many other simple uses of the library.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    */</span>
  
  
  #include &lt;ft2build.h&gt;
  #include FT_INTERNAL_DEBUG_H
  
  #include FT_GLYPH_H
  #include FT_OUTLINE_H
  #include FT_BITMAP_H
  #include FT_INTERNAL_OBJECTS_H
  
<span class="udiff-line-removed">- #include &quot;basepic.h&quot;</span>
  
<span class="udiff-line-modified-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="udiff-line-modified-removed">-   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="udiff-line-modified-removed">-   /* messages during execution.                                            */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-added">+   /**************************************************************************</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="udiff-line-modified-added">+    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="udiff-line-modified-added">+    * messages during execution.</span>
<span class="udiff-line-modified-added">+    */</span>
  #undef  FT_COMPONENT
<span class="udiff-line-modified-removed">- #define FT_COMPONENT  trace_glyph</span>
<span class="udiff-line-modified-added">+ #define FT_COMPONENT  glyph</span>
  
  
    /*************************************************************************/
    /*************************************************************************/
    /****                                                                 ****/
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -75,11 +74,11 @@</span>
      glyph-&gt;top  = slot-&gt;bitmap_top;
  
      /* do lazy copying whenever possible */
      if ( slot-&gt;internal-&gt;flags &amp; FT_GLYPH_OWN_BITMAP )
      {
<span class="udiff-line-modified-removed">-       glyph-&gt;bitmap = slot-&gt;bitmap;</span>
<span class="udiff-line-modified-added">+       glyph-&gt;bitmap          = slot-&gt;bitmap;</span>
        slot-&gt;internal-&gt;flags &amp;= ~FT_GLYPH_OWN_BITMAP;
      }
      else
      {
        FT_Bitmap_Init( &amp;glyph-&gt;bitmap );
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -357,55 +356,64 @@</span>
    }
  
  
    /* documentation is in ftglyph.h */
  
<span class="udiff-line-modified-removed">-   FT_EXPORT_DEF( FT_Error )</span>
<span class="udiff-line-modified-removed">-   FT_Get_Glyph( FT_GlyphSlot  slot,</span>
<span class="udiff-line-modified-removed">-                 FT_Glyph     *aglyph )</span>
<span class="udiff-line-modified-added">+   FT_EXPORT( FT_Error )</span>
<span class="udiff-line-modified-added">+   FT_New_Glyph( FT_Library       library,</span>
<span class="udiff-line-modified-added">+                 FT_Glyph_Format  format,</span>
<span class="udiff-line-added">+                 FT_Glyph        *aglyph )</span>
    {
<span class="udiff-line-removed">-     FT_Library  library;</span>
<span class="udiff-line-removed">-     FT_Error    error;</span>
<span class="udiff-line-removed">-     FT_Glyph    glyph;</span>
<span class="udiff-line-removed">- </span>
      const FT_Glyph_Class*  clazz = NULL;
  
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-removed">-     if ( !slot )</span>
<span class="udiff-line-removed">-       return FT_THROW( Invalid_Slot_Handle );</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     library = slot-&gt;library;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if ( !aglyph )</span>
<span class="udiff-line-modified-added">+     if ( !library || !aglyph )</span>
        return FT_THROW( Invalid_Argument );
  
      /* if it is a bitmap, that&#39;s easy :-) */
<span class="udiff-line-modified-removed">-     if ( slot-&gt;format == FT_GLYPH_FORMAT_BITMAP )</span>
<span class="udiff-line-modified-removed">-       clazz = FT_BITMAP_GLYPH_CLASS_GET;</span>
<span class="udiff-line-modified-added">+     if ( format == FT_GLYPH_FORMAT_BITMAP )</span>
<span class="udiff-line-modified-added">+       clazz = &amp;ft_bitmap_glyph_class;</span>
  
      /* if it is an outline */
<span class="udiff-line-modified-removed">-     else if ( slot-&gt;format == FT_GLYPH_FORMAT_OUTLINE )</span>
<span class="udiff-line-modified-removed">-       clazz = FT_OUTLINE_GLYPH_CLASS_GET;</span>
<span class="udiff-line-modified-added">+     else if ( format == FT_GLYPH_FORMAT_OUTLINE )</span>
<span class="udiff-line-modified-added">+       clazz = &amp;ft_outline_glyph_class;</span>
  
      else
      {
        /* try to find a renderer that supports the glyph image format */
<span class="udiff-line-modified-removed">-       FT_Renderer  render = FT_Lookup_Renderer( library, slot-&gt;format, 0 );</span>
<span class="udiff-line-modified-added">+       FT_Renderer  render = FT_Lookup_Renderer( library, format, 0 );</span>
  
  
        if ( render )
          clazz = &amp;render-&gt;glyph_class;
      }
  
      if ( !clazz )
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       error = FT_THROW( Invalid_Glyph_Format );</span>
<span class="udiff-line-modified-removed">-       goto Exit;</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+       return FT_THROW( Invalid_Glyph_Format );</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     /* create FT_Glyph object */</span>
<span class="udiff-line-modified-added">+     return ft_new_glyph( library, clazz, aglyph );</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   /* documentation is in ftglyph.h */</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   FT_EXPORT_DEF( FT_Error )</span>
<span class="udiff-line-added">+   FT_Get_Glyph( FT_GlyphSlot  slot,</span>
<span class="udiff-line-added">+                 FT_Glyph     *aglyph )</span>
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+     FT_Error  error;</span>
<span class="udiff-line-added">+     FT_Glyph  glyph;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if ( !slot )</span>
<span class="udiff-line-added">+       return FT_THROW( Invalid_Slot_Handle );</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if ( !aglyph )</span>
<span class="udiff-line-added">+       return FT_THROW( Invalid_Argument );</span>
  
      /* create FT_Glyph object */
<span class="udiff-line-modified-removed">-     error = ft_new_glyph( library, clazz, &amp;glyph );</span>
<span class="udiff-line-modified-added">+     error = FT_New_Glyph( slot-&gt;library, slot-&gt;format, &amp;glyph );</span>
      if ( error )
        goto Exit;
  
      /* copy advance while converting 26.6 to 16.16 format */
      if ( slot-&gt;advance.x &gt;=  0x8000L * 64 ||
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -425,11 +433,11 @@</span>
  
      glyph-&gt;advance.x = slot-&gt;advance.x * 1024;
      glyph-&gt;advance.y = slot-&gt;advance.y * 1024;
  
      /* now import the image from the glyph slot */
<span class="udiff-line-modified-removed">-     error = clazz-&gt;glyph_init( glyph, slot );</span>
<span class="udiff-line-modified-added">+     error = glyph-&gt;clazz-&gt;glyph_init( glyph, slot );</span>
  
    Exit2:
      /* if an error occurred, destroy the glyph */
      if ( error )
        FT_Done_Glyph( glyph );
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -503,12 +511,12 @@</span>
      if ( bbox_mode == FT_GLYPH_BBOX_GRIDFIT ||
           bbox_mode == FT_GLYPH_BBOX_PIXELS  )
      {
        acbox-&gt;xMin = FT_PIX_FLOOR( acbox-&gt;xMin );
        acbox-&gt;yMin = FT_PIX_FLOOR( acbox-&gt;yMin );
<span class="udiff-line-modified-removed">-       acbox-&gt;xMax = FT_PIX_CEIL( acbox-&gt;xMax );</span>
<span class="udiff-line-modified-removed">-       acbox-&gt;yMax = FT_PIX_CEIL( acbox-&gt;yMax );</span>
<span class="udiff-line-modified-added">+       acbox-&gt;xMax = FT_PIX_CEIL_LONG( acbox-&gt;xMax );</span>
<span class="udiff-line-modified-added">+       acbox-&gt;yMax = FT_PIX_CEIL_LONG( acbox-&gt;yMax );</span>
      }
  
      /* convert to integer pixels if needed */
      if ( bbox_mode == FT_GLYPH_BBOX_TRUNCATE ||
           bbox_mode == FT_GLYPH_BBOX_PIXELS   )
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -534,11 +542,10 @@</span>
      FT_Error                  error = FT_Err_Ok;
      FT_Glyph                  b, glyph;
      FT_BitmapGlyph            bitmap = NULL;
      const FT_Glyph_Class*     clazz;
  
<span class="udiff-line-removed">-     /* FT_BITMAP_GLYPH_CLASS_GET dereferences `library&#39; in PIC mode */</span>
      FT_Library                library;
  
  
      /* check argument */
      if ( !the_glyph )
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -551,11 +558,11 @@</span>
      library = glyph-&gt;library;
      if ( !library || !clazz )
        goto Bad;
  
      /* when called with a bitmap glyph, do nothing and return successfully */
<span class="udiff-line-modified-removed">-     if ( clazz == FT_BITMAP_GLYPH_CLASS_GET )</span>
<span class="udiff-line-modified-added">+     if ( clazz == &amp;ft_bitmap_glyph_class )</span>
        goto Exit;
  
      if ( !clazz-&gt;glyph_prepare )
        goto Bad;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -567,11 +574,11 @@</span>
      dummy.internal = &amp;dummy_internal;
      dummy.library  = library;
      dummy.format   = clazz-&gt;glyph_format;
  
      /* create result bitmap glyph */
<span class="udiff-line-modified-removed">-     error = ft_new_glyph( library, FT_BITMAP_GLYPH_CLASS_GET, &amp;b );</span>
<span class="udiff-line-modified-added">+     error = ft_new_glyph( library, &amp;ft_bitmap_glyph_class, &amp;b );</span>
      if ( error )
        goto Exit;
      bitmap = (FT_BitmapGlyph)b;
  
  #if 1
</pre>
<center><a href="ftgloadr.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="fthash.c.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>