<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/java.desktop/share/native/libfreetype/src/raster/rastpic.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
  <body>
    <pre>
 1 /***************************************************************************/
 2 /*                                                                         */
 3 /*  rastpic.c                                                              */
 4 /*                                                                         */
 5 /*    The FreeType position independent code services for raster module.   */
 6 /*                                                                         */
 7 /*  Copyright 2009-2018 by                                                 */
 8 /*  Oran Agra and Mickey Gabel.                                            */
 9 /*                                                                         */
10 /*  This file is part of the FreeType project, and may only be used,       */
11 /*  modified, and distributed under the terms of the FreeType project      */
12 /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */
13 /*  this file you indicate that you have read the license and              */
14 /*  understand and accept it fully.                                        */
15 /*                                                                         */
16 /***************************************************************************/
17 
18 
19 #include &lt;ft2build.h&gt;
20 #include FT_FREETYPE_H
21 #include FT_INTERNAL_OBJECTS_H
22 #include &quot;rastpic.h&quot;
23 #include &quot;rasterrs.h&quot;
24 
25 
26 #ifdef FT_CONFIG_OPTION_PIC
27 
28   /* forward declaration of PIC init functions from ftraster.c */
29   void
30   FT_Init_Class_ft_standard_raster( FT_Raster_Funcs*  funcs );
31 
32 
33   void
34   ft_raster1_renderer_class_pic_free( FT_Library  library )
35   {
36     FT_PIC_Container*  pic_container = &amp;library-&gt;pic_container;
37     FT_Memory          memory        = library-&gt;memory;
38 
39 
40     if ( pic_container-&gt;raster )
41     {
42       RasterPIC*  container = (RasterPIC*)pic_container-&gt;raster;
43 
44 
45       if ( --container-&gt;ref_count )
46         return;
47       FT_FREE( container );
48       pic_container-&gt;raster = NULL;
49     }
50   }
51 
52 
53   FT_Error
54   ft_raster1_renderer_class_pic_init( FT_Library  library )
55   {
56     FT_PIC_Container*  pic_container = &amp;library-&gt;pic_container;
57     FT_Error           error         = FT_Err_Ok;
58     RasterPIC*         container     = NULL;
59     FT_Memory          memory        = library-&gt;memory;
60 
61 
62     /* XXX: since this function also served the no longer available  */
63     /*      raster5 renderer it uses reference counting, which could */
64     /*      be removed now                                           */
65     if ( pic_container-&gt;raster )
66     {
67       ((RasterPIC*)pic_container-&gt;raster)-&gt;ref_count++;
68       return error;
69     }
70 
71     /* allocate pointer, clear and set global container pointer */
72     if ( FT_ALLOC( container, sizeof ( *container ) ) )
73       return error;
74     FT_MEM_SET( container, 0, sizeof ( *container ) );
75     pic_container-&gt;raster = container;
76 
77     container-&gt;ref_count = 1;
78 
79     /* initialize pointer table -                       */
80     /* this is how the module usually expects this data */
81     FT_Init_Class_ft_standard_raster( &amp;container-&gt;ft_standard_raster );
82 
83     return error;
84   }
85 
86 #endif /* FT_CONFIG_OPTION_PIC */
87 
88 
89 /* END */
    </pre>
  </body>
</html>