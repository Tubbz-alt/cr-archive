<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/native/libfreetype/src/psaux/afmparse.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../cid/cidtoken.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="afmparse.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/psaux/afmparse.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
<span class="line-modified">  1 /***************************************************************************/</span>
<span class="line-modified">  2 /*                                                                         */</span>
<span class="line-modified">  3 /*  afmparse.c                                                             */</span>
<span class="line-modified">  4 /*                                                                         */</span>
<span class="line-modified">  5 /*    AFM parser (body).                                                   */</span>
<span class="line-modified">  6 /*                                                                         */</span>
<span class="line-modified">  7 /*  Copyright 2006-2018 by                                                 */</span>
<span class="line-modified">  8 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="line-modified">  9 /*                                                                         */</span>
<span class="line-modified"> 10 /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified"> 11 /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified"> 12 /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified"> 13 /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified"> 14 /*  understand and accept it fully.                                        */</span>
<span class="line-modified"> 15 /*                                                                         */</span>
<span class="line-modified"> 16 /***************************************************************************/</span>
 17 
 18 #include &lt;ft2build.h&gt;
 19 #include FT_FREETYPE_H
 20 #include FT_INTERNAL_DEBUG_H
 21 #include FT_INTERNAL_POSTSCRIPT_AUX_H
 22 
 23 #ifndef T1_CONFIG_OPTION_NO_AFM
 24 
 25 #include &quot;afmparse.h&quot;
 26 #include &quot;psconv.h&quot;
 27 
 28 #include &quot;psauxerr.h&quot;
 29 
 30 
<span class="line-modified"> 31 /***************************************************************************/</span>
<span class="line-modified"> 32 /*                                                                         */</span>
<span class="line-modified"> 33 /*    AFM_Stream                                                           */</span>
<span class="line-modified"> 34 /*                                                                         */</span>
<span class="line-modified"> 35 /* The use of AFM_Stream is largely inspired by parseAFM.[ch] from t1lib.  */</span>
<span class="line-modified"> 36 /*                                                                         */</span>
<span class="line-modified"> 37 /*                                                                         */</span>
 38 
 39   enum
 40   {
 41     AFM_STREAM_STATUS_NORMAL,
 42     AFM_STREAM_STATUS_EOC,
 43     AFM_STREAM_STATUS_EOL,
 44     AFM_STREAM_STATUS_EOF
 45   };
 46 
 47 
 48   typedef struct  AFM_StreamRec_
 49   {
 50     FT_Byte*  cursor;
 51     FT_Byte*  base;
 52     FT_Byte*  limit;
 53 
 54     FT_Int    status;
 55 
 56   } AFM_StreamRec;
 57 
</pre>
<hr />
<pre>
176     {
177       int  ch = AFM_GETC();
178 
179 
180       if ( AFM_IS_NEWLINE( ch ) )
181       {
182         stream-&gt;status = AFM_STREAM_STATUS_EOL;
183         break;
184       }
185       else if ( AFM_IS_EOF( ch ) )
186       {
187         stream-&gt;status = AFM_STREAM_STATUS_EOF;
188         break;
189       }
190     }
191 
192     return str;
193   }
194 
195 
<span class="line-modified">196   /*************************************************************************/</span>
<span class="line-modified">197   /*                                                                       */</span>
<span class="line-modified">198   /*    AFM_Parser                                                         */</span>
<span class="line-modified">199   /*                                                                       */</span>
<span class="line-modified">200   /*                                                                       */</span>
201 
202   /* all keys defined in Ch. 7-10 of 5004.AFM_Spec.pdf */
203   typedef enum  AFM_Token_
204   {
205     AFM_TOKEN_ASCENDER,
206     AFM_TOKEN_AXISLABEL,
207     AFM_TOKEN_AXISTYPE,
208     AFM_TOKEN_B,
209     AFM_TOKEN_BLENDAXISTYPES,
210     AFM_TOKEN_BLENDDESIGNMAP,
211     AFM_TOKEN_BLENDDESIGNPOSITIONS,
212     AFM_TOKEN_C,
213     AFM_TOKEN_CC,
214     AFM_TOKEN_CH,
215     AFM_TOKEN_CAPHEIGHT,
216     AFM_TOKEN_CHARWIDTH,
217     AFM_TOKEN_CHARACTERSET,
218     AFM_TOKEN_CHARACTERS,
219     AFM_TOKEN_DESCENDER,
220     AFM_TOKEN_ENCODINGSCHEME,
</pre>
<hr />
<pre>
936 
937       case AFM_TOKEN_STARTCHARMETRICS:
938         {
939           FT_Int  n = 0;
940 
941 
942           if ( afm_parser_read_int( parser, &amp;n ) )
943             goto Fail;
944 
945           error = afm_parser_skip_section( parser, n,
946                                            AFM_TOKEN_ENDCHARMETRICS );
947           if ( error )
948             return error;
949         }
950         break;
951 
952       case AFM_TOKEN_STARTKERNDATA:
953         error = afm_parse_kern_data( parser );
954         if ( error )
955           goto Fail;
<span class="line-modified">956         /* fall through since we only support kern data */</span>

957 
958       case AFM_TOKEN_ENDFONTMETRICS:
959         return FT_Err_Ok;
960 
961       default:
962         break;
963       }
964     }
965 
966   Fail:
967     FT_FREE( fi-&gt;TrackKerns );
968     fi-&gt;NumTrackKern = 0;
969 
970     FT_FREE( fi-&gt;KernPairs );
971     fi-&gt;NumKernPair = 0;
972 
973     fi-&gt;IsCIDFont = 0;
974 
975     return error;
976   }
</pre>
</td>
<td>
<hr />
<pre>
<span class="line-modified">  1 /****************************************************************************</span>
<span class="line-modified">  2  *</span>
<span class="line-modified">  3  * afmparse.c</span>
<span class="line-modified">  4  *</span>
<span class="line-modified">  5  *   AFM parser (body).</span>
<span class="line-modified">  6  *</span>
<span class="line-modified">  7  * Copyright (C) 2006-2019 by</span>
<span class="line-modified">  8  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">  9  *</span>
<span class="line-modified"> 10  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified"> 11  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified"> 12  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified"> 13  * this file you indicate that you have read the license and</span>
<span class="line-modified"> 14  * understand and accept it fully.</span>
<span class="line-modified"> 15  *</span>
<span class="line-modified"> 16  */</span>
 17 
 18 #include &lt;ft2build.h&gt;
 19 #include FT_FREETYPE_H
 20 #include FT_INTERNAL_DEBUG_H
 21 #include FT_INTERNAL_POSTSCRIPT_AUX_H
 22 
 23 #ifndef T1_CONFIG_OPTION_NO_AFM
 24 
 25 #include &quot;afmparse.h&quot;
 26 #include &quot;psconv.h&quot;
 27 
 28 #include &quot;psauxerr.h&quot;
 29 
 30 
<span class="line-modified"> 31   /**************************************************************************</span>
<span class="line-modified"> 32    *</span>
<span class="line-modified"> 33    * AFM_Stream</span>
<span class="line-modified"> 34    *</span>
<span class="line-modified"> 35    * The use of AFM_Stream is largely inspired by parseAFM.[ch] from t1lib.</span>
<span class="line-modified"> 36    *</span>
<span class="line-modified"> 37    */</span>
 38 
 39   enum
 40   {
 41     AFM_STREAM_STATUS_NORMAL,
 42     AFM_STREAM_STATUS_EOC,
 43     AFM_STREAM_STATUS_EOL,
 44     AFM_STREAM_STATUS_EOF
 45   };
 46 
 47 
 48   typedef struct  AFM_StreamRec_
 49   {
 50     FT_Byte*  cursor;
 51     FT_Byte*  base;
 52     FT_Byte*  limit;
 53 
 54     FT_Int    status;
 55 
 56   } AFM_StreamRec;
 57 
</pre>
<hr />
<pre>
176     {
177       int  ch = AFM_GETC();
178 
179 
180       if ( AFM_IS_NEWLINE( ch ) )
181       {
182         stream-&gt;status = AFM_STREAM_STATUS_EOL;
183         break;
184       }
185       else if ( AFM_IS_EOF( ch ) )
186       {
187         stream-&gt;status = AFM_STREAM_STATUS_EOF;
188         break;
189       }
190     }
191 
192     return str;
193   }
194 
195 
<span class="line-modified">196   /**************************************************************************</span>
<span class="line-modified">197    *</span>
<span class="line-modified">198    * AFM_Parser</span>
<span class="line-modified">199    *</span>
<span class="line-modified">200    */</span>
201 
202   /* all keys defined in Ch. 7-10 of 5004.AFM_Spec.pdf */
203   typedef enum  AFM_Token_
204   {
205     AFM_TOKEN_ASCENDER,
206     AFM_TOKEN_AXISLABEL,
207     AFM_TOKEN_AXISTYPE,
208     AFM_TOKEN_B,
209     AFM_TOKEN_BLENDAXISTYPES,
210     AFM_TOKEN_BLENDDESIGNMAP,
211     AFM_TOKEN_BLENDDESIGNPOSITIONS,
212     AFM_TOKEN_C,
213     AFM_TOKEN_CC,
214     AFM_TOKEN_CH,
215     AFM_TOKEN_CAPHEIGHT,
216     AFM_TOKEN_CHARWIDTH,
217     AFM_TOKEN_CHARACTERSET,
218     AFM_TOKEN_CHARACTERS,
219     AFM_TOKEN_DESCENDER,
220     AFM_TOKEN_ENCODINGSCHEME,
</pre>
<hr />
<pre>
936 
937       case AFM_TOKEN_STARTCHARMETRICS:
938         {
939           FT_Int  n = 0;
940 
941 
942           if ( afm_parser_read_int( parser, &amp;n ) )
943             goto Fail;
944 
945           error = afm_parser_skip_section( parser, n,
946                                            AFM_TOKEN_ENDCHARMETRICS );
947           if ( error )
948             return error;
949         }
950         break;
951 
952       case AFM_TOKEN_STARTKERNDATA:
953         error = afm_parse_kern_data( parser );
954         if ( error )
955           goto Fail;
<span class="line-modified">956         /* we only support kern data, so ... */</span>
<span class="line-added">957         /* fall through                      */</span>
958 
959       case AFM_TOKEN_ENDFONTMETRICS:
960         return FT_Err_Ok;
961 
962       default:
963         break;
964       }
965     }
966 
967   Fail:
968     FT_FREE( fi-&gt;TrackKerns );
969     fi-&gt;NumTrackKern = 0;
970 
971     FT_FREE( fi-&gt;KernPairs );
972     fi-&gt;NumKernPair = 0;
973 
974     fi-&gt;IsCIDFont = 0;
975 
976     return error;
977   }
</pre>
</td>
</tr>
</table>
<center><a href="../cid/cidtoken.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="afmparse.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>