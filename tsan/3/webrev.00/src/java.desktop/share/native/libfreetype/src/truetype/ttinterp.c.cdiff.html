<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/native/libfreetype/src/truetype/ttinterp.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ttgxvar.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ttinterp.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/truetype/ttinterp.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,21 ***</span>
<span class="line-modified">! /***************************************************************************/</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  ttinterp.c                                                             */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*    TrueType bytecode interpreter (body).                                */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  Copyright 1996-2018 by                                                 */</span>
<span class="line-modified">! /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified">! /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified">! /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified">! /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified">! /*  understand and accept it fully.                                        */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /***************************************************************************/</span>
  
  
  /* Greg Hitchcock from Microsoft has helped a lot in resolving unclear */
  /* issues; many thanks!                                                */
  
<span class="line-new-header">--- 1,21 ---</span>
<span class="line-modified">! /****************************************************************************</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * ttinterp.c</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  *   TrueType bytecode interpreter (body).</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * Copyright (C) 1996-2019 by</span>
<span class="line-modified">!  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified">!  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified">!  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified">!  * this file you indicate that you have read the license and</span>
<span class="line-modified">!  * understand and accept it fully.</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  */</span>
  
  
  /* Greg Hitchcock from Microsoft has helped a lot in resolving unclear */
  /* issues; many thanks!                                                */
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 37,18 ***</span>
  
  
  #ifdef TT_USE_BYTECODE_INTERPRETER
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="line-modified">!   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="line-modified">!   /* messages during execution.                                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
  #undef  FT_COMPONENT
<span class="line-modified">! #define FT_COMPONENT  trace_ttinterp</span>
  
  
  #define NO_SUBPIXEL_HINTING                                                  \
            ( ((TT_Driver)FT_FACE_DRIVER( exc-&gt;face ))-&gt;interpreter_version == \
              TT_INTERPRETER_VERSION_35 )
<span class="line-new-header">--- 37,18 ---</span>
  
  
  #ifdef TT_USE_BYTECODE_INTERPRETER
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="line-modified">!    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="line-modified">!    * messages during execution.</span>
<span class="line-modified">!    */</span>
  #undef  FT_COMPONENT
<span class="line-modified">! #define FT_COMPONENT  ttinterp</span>
  
  
  #define NO_SUBPIXEL_HINTING                                                  \
            ( ((TT_Driver)FT_FACE_DRIVER( exc-&gt;face ))-&gt;interpreter_version == \
              TT_INTERPRETER_VERSION_35 )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 80,14 ***</span>
  
  #define FAST_DUALPROJ( v )                          \
            exc-&gt;func_dualproj( exc, (v)-&gt;x, (v)-&gt;y )
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Two simple bounds-checking macros.                                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
  #define BOUNDS( x, n )   ( (FT_UInt)(x)  &gt;= (FT_UInt)(n)  )
  #define BOUNDSL( x, n )  ( (FT_ULong)(x) &gt;= (FT_ULong)(n) )
  
  
  #undef  SUCCESS
<span class="line-new-header">--- 80,14 ---</span>
  
  #define FAST_DUALPROJ( v )                          \
            exc-&gt;func_dualproj( exc, (v)-&gt;x, (v)-&gt;y )
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Two simple bounds-checking macros.</span>
<span class="line-modified">!    */</span>
  #define BOUNDS( x, n )   ( (FT_UInt)(x)  &gt;= (FT_UInt)(n)  )
  #define BOUNDSL( x, n )  ( (FT_ULong)(x) &gt;= (FT_ULong)(n) )
  
  
  #undef  SUCCESS
</pre>
<hr />
<pre>
<span class="line-old-header">*** 95,34 ***</span>
  
  #undef  FAILURE
  #define FAILURE  1
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*                        CODERANGE FUNCTIONS                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">! </span>
<span class="line-modified">! </span>
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    TT_Goto_CodeRange                                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Switches to a new code range (updates the code related elements in */</span>
<span class="line-modified">!   /*    `exec&#39;, and `IP&#39;).                                                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    range :: The new execution code range.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    IP    :: The new IP in the new code range.                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;InOut&gt;                                                               */</span>
<span class="line-modified">!   /*    exec  :: The target execution context.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
    FT_LOCAL_DEF( void )
    TT_Goto_CodeRange( TT_ExecContext  exec,
                       FT_Int          range,
                       FT_Long         IP )
    {
<span class="line-new-header">--- 95,37 ---</span>
  
  #undef  FAILURE
  #define FAILURE  1
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *                       CODERANGE FUNCTIONS</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    */</span>
<span class="line-modified">! </span>
<span class="line-modified">! </span>
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   TT_Goto_CodeRange</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Switches to a new code range (updates the code related elements in</span>
<span class="line-modified">!    *   `exec&#39;, and `IP&#39;).</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   range ::</span>
<span class="line-modified">!    *     The new execution code range.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   IP ::</span>
<span class="line-modified">!    *     The new IP in the new code range.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @InOut:</span>
<span class="line-added">+    *   exec ::</span>
<span class="line-added">+    *     The target execution context.</span>
<span class="line-added">+    */</span>
    FT_LOCAL_DEF( void )
    TT_Goto_CodeRange( TT_ExecContext  exec,
                       FT_Int          range,
                       FT_Long         IP )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 146,28 ***</span>
      exec-&gt;IP       = IP;
      exec-&gt;curRange = range;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    TT_Set_CodeRange                                                   */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Sets a code range.                                                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    range  :: The code range index.                                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    base   :: The new code base.                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    length :: The range size in bytes.                                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;InOut&gt;                                                               */</span>
<span class="line-modified">!   /*    exec   :: The target execution context.                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
    FT_LOCAL_DEF( void )
    TT_Set_CodeRange( TT_ExecContext  exec,
                      FT_Int          range,
                      void*           base,
                      FT_Long         length )
<span class="line-new-header">--- 149,32 ---</span>
      exec-&gt;IP       = IP;
      exec-&gt;curRange = range;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   TT_Set_CodeRange</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Sets a code range.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   range ::</span>
<span class="line-modified">!    *     The code range index.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   base ::</span>
<span class="line-modified">!    *     The new code base.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   length ::</span>
<span class="line-modified">!    *     The range size in bytes.</span>
<span class="line-modified">!    *</span>
<span class="line-added">+    * @InOut:</span>
<span class="line-added">+    *   exec ::</span>
<span class="line-added">+    *     The target execution context.</span>
<span class="line-added">+    */</span>
    FT_LOCAL_DEF( void )
    TT_Set_CodeRange( TT_ExecContext  exec,
                      FT_Int          range,
                      void*           base,
                      FT_Long         length )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 177,24 ***</span>
      exec-&gt;codeRangeTable[range - 1].base = (FT_Byte*)base;
      exec-&gt;codeRangeTable[range - 1].size = length;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    TT_Clear_CodeRange                                                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Clears a code range.                                               */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    range :: The code range index.                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;InOut&gt;                                                               */</span>
<span class="line-modified">!   /*    exec  :: The target execution context.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
    FT_LOCAL_DEF( void )
    TT_Clear_CodeRange( TT_ExecContext  exec,
                        FT_Int          range )
    {
      FT_ASSERT( range &gt;= 1 &amp;&amp; range &lt;= 3 );
<span class="line-new-header">--- 184,26 ---</span>
      exec-&gt;codeRangeTable[range - 1].base = (FT_Byte*)base;
      exec-&gt;codeRangeTable[range - 1].size = length;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   TT_Clear_CodeRange</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Clears a code range.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   range ::</span>
<span class="line-modified">!    *     The code range index.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @InOut:</span>
<span class="line-modified">!    *   exec ::</span>
<span class="line-added">+    *     The target execution context.</span>
<span class="line-added">+    */</span>
    FT_LOCAL_DEF( void )
    TT_Clear_CodeRange( TT_ExecContext  exec,
                        FT_Int          range )
    {
      FT_ASSERT( range &gt;= 1 &amp;&amp; range &lt;= 3 );
</pre>
<hr />
<pre>
<span class="line-old-header">*** 202,33 ***</span>
      exec-&gt;codeRangeTable[range - 1].base = NULL;
      exec-&gt;codeRangeTable[range - 1].size = 0;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*                   EXECUTION CONTEXT ROUTINES                          */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">! </span>
<span class="line-modified">! </span>
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    TT_Done_Context                                                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Destroys a given context.                                          */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    exec   :: A handle to the target execution context.                */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    memory :: A handle to the parent memory object.                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Note&gt;                                                                */</span>
<span class="line-modified">!   /*    Only the glyph loader and debugger should call this function.      */</span>
<span class="line-modified">!   /*                                                                       */</span>
    FT_LOCAL_DEF( void )
    TT_Done_Context( TT_ExecContext  exec )
    {
      FT_Memory  memory = exec-&gt;memory;
  
<span class="line-new-header">--- 211,35 ---</span>
      exec-&gt;codeRangeTable[range - 1].base = NULL;
      exec-&gt;codeRangeTable[range - 1].size = 0;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *                  EXECUTION CONTEXT ROUTINES</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    */</span>
<span class="line-modified">! </span>
<span class="line-modified">! </span>
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   TT_Done_Context</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Destroys a given context.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   exec ::</span>
<span class="line-modified">!    *     A handle to the target execution context.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   memory ::</span>
<span class="line-modified">!    *     A handle to the parent memory object.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Note:</span>
<span class="line-added">+    *   Only the glyph loader and debugger should call this function.</span>
<span class="line-added">+    */</span>
    FT_LOCAL_DEF( void )
    TT_Done_Context( TT_ExecContext  exec )
    {
      FT_Memory  memory = exec-&gt;memory;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 255,27 ***</span>
  
      FT_FREE( exec );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Init_Context                                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Initializes a context object.                                      */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    memory :: A handle to the parent memory object.                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;InOut&gt;                                                               */</span>
<span class="line-modified">!   /*    exec   :: A handle to the target execution context.                */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    FreeType error code.  0 means success.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_Error
    Init_Context( TT_ExecContext  exec,
                  FT_Memory       memory )
    {
      FT_Error  error;
<span class="line-new-header">--- 266,29 ---</span>
  
      FT_FREE( exec );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Init_Context</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Initializes a context object.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   memory ::</span>
<span class="line-modified">!    *     A handle to the parent memory object.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @InOut:</span>
<span class="line-modified">!    *   exec ::</span>
<span class="line-modified">!    *     A handle to the target execution context.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-added">+    *   FreeType error code.  0 means success.</span>
<span class="line-added">+    */</span>
    static FT_Error
    Init_Context( TT_ExecContext  exec,
                  FT_Memory       memory )
    {
      FT_Error  error;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 311,34 ***</span>
  
      return error;
   }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Update_Max                                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Checks the size of a buffer and reallocates it if necessary.       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    memory     :: A handle to the parent memory object.                */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    multiplier :: The size in bytes of each element in the buffer.     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    new_max    :: The new capacity (size) of the buffer.               */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;InOut&gt;                                                               */</span>
<span class="line-modified">!   /*    size       :: The address of the buffer&#39;s current size expressed   */</span>
<span class="line-modified">!   /*                  in elements.                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    buff       :: The address of the buffer base pointer.              */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    FreeType error code.  0 means success.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
    FT_LOCAL_DEF( FT_Error )
    Update_Max( FT_Memory  memory,
                FT_ULong*  size,
                FT_ULong   multiplier,
                void*      _pbuff,
<span class="line-new-header">--- 324,39 ---</span>
  
      return error;
   }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Update_Max</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Checks the size of a buffer and reallocates it if necessary.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   memory ::</span>
<span class="line-modified">!    *     A handle to the parent memory object.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   multiplier ::</span>
<span class="line-modified">!    *     The size in bytes of each element in the buffer.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   new_max ::</span>
<span class="line-modified">!    *     The new capacity (size) of the buffer.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @InOut:</span>
<span class="line-modified">!    *   size ::</span>
<span class="line-modified">!    *     The address of the buffer&#39;s current size expressed</span>
<span class="line-modified">!    *     in elements.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   buff ::</span>
<span class="line-added">+    *     The address of the buffer base pointer.</span>
<span class="line-added">+    *</span>
<span class="line-added">+    * @Return:</span>
<span class="line-added">+    *   FreeType error code.  0 means success.</span>
<span class="line-added">+    */</span>
    FT_LOCAL_DEF( FT_Error )
    Update_Max( FT_Memory  memory,
                FT_ULong*  size,
                FT_ULong   multiplier,
                void*      _pbuff,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 357,32 ***</span>
  
      return FT_Err_Ok;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    TT_Load_Context                                                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Prepare an execution context for glyph hinting.                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    face :: A handle to the source face object.                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    size :: A handle to the source size object.                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;InOut&gt;                                                               */</span>
<span class="line-modified">!   /*    exec :: A handle to the target execution context.                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    FreeType error code.  0 means success.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Note&gt;                                                                */</span>
<span class="line-modified">!   /*    Only the glyph loader and debugger should call this function.      */</span>
<span class="line-modified">!   /*                                                                       */</span>
    FT_LOCAL_DEF( FT_Error )
    TT_Load_Context( TT_ExecContext  exec,
                     TT_Face         face,
                     TT_Size         size )
    {
<span class="line-new-header">--- 375,35 ---</span>
  
      return FT_Err_Ok;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   TT_Load_Context</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Prepare an execution context for glyph hinting.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   face ::</span>
<span class="line-modified">!    *     A handle to the source face object.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   size ::</span>
<span class="line-modified">!    *     A handle to the source size object.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @InOut:</span>
<span class="line-modified">!    *   exec ::</span>
<span class="line-modified">!    *     A handle to the target execution context.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-modified">!    *   FreeType error code.  0 means success.</span>
<span class="line-modified">!    *</span>
<span class="line-added">+    * @Note:</span>
<span class="line-added">+    *   Only the glyph loader and debugger should call this function.</span>
<span class="line-added">+    */</span>
    FT_LOCAL_DEF( FT_Error )
    TT_Load_Context( TT_ExecContext  exec,
                     TT_Face         face,
                     TT_Size         size )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 465,27 ***</span>
  
      return FT_Err_Ok;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    TT_Save_Context                                                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Saves the code ranges in a `size&#39; object.                          */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    exec :: A handle to the source execution context.                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;InOut&gt;                                                               */</span>
<span class="line-modified">!   /*    size :: A handle to the target size object.                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Note&gt;                                                                */</span>
<span class="line-modified">!   /*    Only the glyph loader and debugger should call this function.      */</span>
<span class="line-modified">!   /*                                                                       */</span>
    FT_LOCAL_DEF( void )
    TT_Save_Context( TT_ExecContext  exec,
                     TT_Size         size )
    {
      FT_Int  i;
<span class="line-new-header">--- 486,29 ---</span>
  
      return FT_Err_Ok;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   TT_Save_Context</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Saves the code ranges in a `size&#39; object.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   exec ::</span>
<span class="line-modified">!    *     A handle to the source execution context.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @InOut:</span>
<span class="line-modified">!    *   size ::</span>
<span class="line-modified">!    *     A handle to the target size object.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Note:</span>
<span class="line-added">+    *   Only the glyph loader and debugger should call this function.</span>
<span class="line-added">+    */</span>
    FT_LOCAL_DEF( void )
    TT_Save_Context( TT_ExecContext  exec,
                     TT_Size         size )
    {
      FT_Int  i;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 503,31 ***</span>
      for ( i = 0; i &lt; TT_MAX_CODE_RANGES; i++ )
        size-&gt;codeRangeTable[i] = exec-&gt;codeRangeTable[i];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    TT_Run_Context                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Executes one or more instructions in the execution context.        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    debug :: A Boolean flag.  If set, the function sets some internal  */</span>
<span class="line-modified">!   /*             variables and returns immediately, otherwise TT_RunIns()  */</span>
<span class="line-modified">!   /*             is called.                                                */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*             This is commented out currently.                          */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-removed">-   /* &lt;Input&gt;                                                               */</span>
<span class="line-removed">-   /*    exec  :: A handle to the target execution context.                 */</span>
<span class="line-removed">-   /*                                                                       */</span>
<span class="line-removed">-   /* &lt;Return&gt;                                                              */</span>
<span class="line-removed">-   /*    TrueType error code.  0 means success.                             */</span>
<span class="line-removed">-   /*                                                                       */</span>
    FT_LOCAL_DEF( FT_Error )
    TT_Run_Context( TT_ExecContext  exec )
    {
      TT_Goto_CodeRange( exec, tt_coderange_glyph, 0 );
  
<span class="line-new-header">--- 526,25 ---</span>
      for ( i = 0; i &lt; TT_MAX_CODE_RANGES; i++ )
        size-&gt;codeRangeTable[i] = exec-&gt;codeRangeTable[i];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   TT_Run_Context</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Executes one or more instructions in the execution context.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   exec ::</span>
<span class="line-modified">!    *     A handle to the target execution context.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-modified">!    *   TrueType error code.  0 means success.</span>
<span class="line-modified">!    */</span>
    FT_LOCAL_DEF( FT_Error )
    TT_Run_Context( TT_ExecContext  exec )
    {
      TT_Goto_CodeRange( exec, tt_coderange_glyph, 0 );
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 607,26 ***</span>
    Fail:
      return NULL;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Before an opcode is executed, the interpreter verifies that there are */</span>
<span class="line-modified">!   /* enough arguments on the stack, with the help of the `Pop_Push_Count&#39;  */</span>
<span class="line-modified">!   /* table.                                                                */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* For each opcode, the first column gives the number of arguments that  */</span>
<span class="line-modified">!   /* are popped from the stack; the second one gives the number of those   */</span>
<span class="line-modified">!   /* that are pushed in result.                                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Opcodes which have a varying number of parameters in the data stream  */</span>
<span class="line-modified">!   /* (NPUSHB, NPUSHW) are handled specially; they have a negative value in */</span>
<span class="line-modified">!   /* the `opcode_length&#39; table, and the value in `Pop_Push_Count&#39; is set   */</span>
<span class="line-modified">!   /* to zero.                                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*************************************************************************/</span>
  
  
  #undef  PACK
  #define PACK( x, y )  ( ( x &lt;&lt; 4 ) | y )
  
<span class="line-new-header">--- 624,26 ---</span>
    Fail:
      return NULL;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Before an opcode is executed, the interpreter verifies that there are</span>
<span class="line-modified">!    * enough arguments on the stack, with the help of the `Pop_Push_Count&#39;</span>
<span class="line-modified">!    * table.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * For each opcode, the first column gives the number of arguments that</span>
<span class="line-modified">!    * are popped from the stack; the second one gives the number of those</span>
<span class="line-modified">!    * that are pushed in result.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Opcodes which have a varying number of parameters in the data stream</span>
<span class="line-modified">!    * (NPUSHB, NPUSHW) are handled specially; they have a negative value in</span>
<span class="line-modified">!    * the `opcode_length&#39; table, and the value in `Pop_Push_Count&#39; is set</span>
<span class="line-modified">!    * to zero.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    */</span>
  
  
  #undef  PACK
  #define PACK( x, y )  ( ( x &lt;&lt; 4 ) | y )
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 635,27 ***</span>
    const FT_Byte  Pop_Push_Count[256] =
    {
      /* opcodes are gathered in groups of 16 */
      /* please keep the spaces as they are   */
  
<span class="line-modified">!     /*  SVTCA  y  */  PACK( 0, 0 ),</span>
<span class="line-modified">!     /*  SVTCA  x  */  PACK( 0, 0 ),</span>
<span class="line-modified">!     /*  SPvTCA y  */  PACK( 0, 0 ),</span>
<span class="line-modified">!     /*  SPvTCA x  */  PACK( 0, 0 ),</span>
<span class="line-modified">!     /*  SFvTCA y  */  PACK( 0, 0 ),</span>
<span class="line-modified">!     /*  SFvTCA x  */  PACK( 0, 0 ),</span>
<span class="line-modified">!     /*  SPvTL //  */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  SPvTL +   */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  SFvTL //  */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  SFvTL +   */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  SPvFS     */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  SFvFS     */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  GPv       */  PACK( 0, 2 ),</span>
<span class="line-modified">!     /*  GFv       */  PACK( 0, 2 ),</span>
<span class="line-modified">!     /*  SFvTPv    */  PACK( 0, 0 ),</span>
      /*  ISECT     */  PACK( 5, 0 ),
  
      /*  SRP0      */  PACK( 1, 0 ),
      /*  SRP1      */  PACK( 1, 0 ),
      /*  SRP2      */  PACK( 1, 0 ),
      /*  SZP0      */  PACK( 1, 0 ),
      /*  SZP1      */  PACK( 1, 0 ),
<span class="line-new-header">--- 652,29 ---</span>
    const FT_Byte  Pop_Push_Count[256] =
    {
      /* opcodes are gathered in groups of 16 */
      /* please keep the spaces as they are   */
  
<span class="line-modified">!     /* 0x00 */</span>
<span class="line-modified">!     /*  SVTCA[0]  */  PACK( 0, 0 ),</span>
<span class="line-modified">!     /*  SVTCA[1]  */  PACK( 0, 0 ),</span>
<span class="line-modified">!     /*  SPVTCA[0] */  PACK( 0, 0 ),</span>
<span class="line-modified">!     /*  SPVTCA[1] */  PACK( 0, 0 ),</span>
<span class="line-modified">!     /*  SFVTCA[0] */  PACK( 0, 0 ),</span>
<span class="line-modified">!     /*  SFVTCA[1] */  PACK( 0, 0 ),</span>
<span class="line-modified">!     /*  SPVTL[0]  */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  SPVTL[1]  */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  SFVTL[0]  */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  SFVTL[1]  */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  SPVFS     */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  SFVFS     */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  GPV       */  PACK( 0, 2 ),</span>
<span class="line-modified">!     /*  GFV       */  PACK( 0, 2 ),</span>
<span class="line-added">+     /*  SFVTPV    */  PACK( 0, 0 ),</span>
      /*  ISECT     */  PACK( 5, 0 ),
  
<span class="line-added">+     /* 0x10 */</span>
      /*  SRP0      */  PACK( 1, 0 ),
      /*  SRP1      */  PACK( 1, 0 ),
      /*  SRP2      */  PACK( 1, 0 ),
      /*  SZP0      */  PACK( 1, 0 ),
      /*  SZP1      */  PACK( 1, 0 ),
</pre>
<hr />
<pre>
<span class="line-old-header">*** 665,31 ***</span>
      /*  RTG       */  PACK( 0, 0 ),
      /*  RTHG      */  PACK( 0, 0 ),
      /*  SMD       */  PACK( 1, 0 ),
      /*  ELSE      */  PACK( 0, 0 ),
      /*  JMPR      */  PACK( 1, 0 ),
<span class="line-modified">!     /*  SCvTCi    */  PACK( 1, 0 ),</span>
<span class="line-modified">!     /*  SSwCi     */  PACK( 1, 0 ),</span>
      /*  SSW       */  PACK( 1, 0 ),
  
      /*  DUP       */  PACK( 1, 2 ),
      /*  POP       */  PACK( 1, 0 ),
      /*  CLEAR     */  PACK( 0, 0 ),
      /*  SWAP      */  PACK( 2, 2 ),
      /*  DEPTH     */  PACK( 0, 1 ),
      /*  CINDEX    */  PACK( 1, 1 ),
      /*  MINDEX    */  PACK( 1, 0 ),
<span class="line-modified">!     /*  AlignPTS  */  PACK( 2, 0 ),</span>
      /*  INS_$28   */  PACK( 0, 0 ),
      /*  UTP       */  PACK( 1, 0 ),
      /*  LOOPCALL  */  PACK( 2, 0 ),
      /*  CALL      */  PACK( 1, 0 ),
      /*  FDEF      */  PACK( 1, 0 ),
      /*  ENDF      */  PACK( 0, 0 ),
      /*  MDAP[0]   */  PACK( 1, 0 ),
      /*  MDAP[1]   */  PACK( 1, 0 ),
  
      /*  IUP[0]    */  PACK( 0, 0 ),
      /*  IUP[1]    */  PACK( 0, 0 ),
      /*  SHP[0]    */  PACK( 0, 0 ), /* loops */
      /*  SHP[1]    */  PACK( 0, 0 ), /* loops */
      /*  SHC[0]    */  PACK( 1, 0 ),
<span class="line-new-header">--- 684,33 ---</span>
      /*  RTG       */  PACK( 0, 0 ),
      /*  RTHG      */  PACK( 0, 0 ),
      /*  SMD       */  PACK( 1, 0 ),
      /*  ELSE      */  PACK( 0, 0 ),
      /*  JMPR      */  PACK( 1, 0 ),
<span class="line-modified">!     /*  SCVTCI    */  PACK( 1, 0 ),</span>
<span class="line-modified">!     /*  SSWCI     */  PACK( 1, 0 ),</span>
      /*  SSW       */  PACK( 1, 0 ),
  
<span class="line-added">+     /* 0x20 */</span>
      /*  DUP       */  PACK( 1, 2 ),
      /*  POP       */  PACK( 1, 0 ),
      /*  CLEAR     */  PACK( 0, 0 ),
      /*  SWAP      */  PACK( 2, 2 ),
      /*  DEPTH     */  PACK( 0, 1 ),
      /*  CINDEX    */  PACK( 1, 1 ),
      /*  MINDEX    */  PACK( 1, 0 ),
<span class="line-modified">!     /*  ALIGNPTS  */  PACK( 2, 0 ),</span>
      /*  INS_$28   */  PACK( 0, 0 ),
      /*  UTP       */  PACK( 1, 0 ),
      /*  LOOPCALL  */  PACK( 2, 0 ),
      /*  CALL      */  PACK( 1, 0 ),
      /*  FDEF      */  PACK( 1, 0 ),
      /*  ENDF      */  PACK( 0, 0 ),
      /*  MDAP[0]   */  PACK( 1, 0 ),
      /*  MDAP[1]   */  PACK( 1, 0 ),
  
<span class="line-added">+     /* 0x30 */</span>
      /*  IUP[0]    */  PACK( 0, 0 ),
      /*  IUP[1]    */  PACK( 0, 0 ),
      /*  SHP[0]    */  PACK( 0, 0 ), /* loops */
      /*  SHP[1]    */  PACK( 0, 0 ), /* loops */
      /*  SHC[0]    */  PACK( 1, 0 ),
</pre>
<hr />
<pre>
<span class="line-old-header">*** 698,32 ***</span>
      /*  SHZ[1]    */  PACK( 1, 0 ),
      /*  SHPIX     */  PACK( 1, 0 ), /* loops */
      /*  IP        */  PACK( 0, 0 ), /* loops */
      /*  MSIRP[0]  */  PACK( 2, 0 ),
      /*  MSIRP[1]  */  PACK( 2, 0 ),
<span class="line-modified">!     /*  AlignRP   */  PACK( 0, 0 ), /* loops */</span>
      /*  RTDG      */  PACK( 0, 0 ),
      /*  MIAP[0]   */  PACK( 2, 0 ),
      /*  MIAP[1]   */  PACK( 2, 0 ),
  
<span class="line-modified">!     /*  NPushB    */  PACK( 0, 0 ),</span>
<span class="line-modified">!     /*  NPushW    */  PACK( 0, 0 ),</span>
      /*  WS        */  PACK( 2, 0 ),
      /*  RS        */  PACK( 1, 1 ),
<span class="line-modified">!     /*  WCvtP     */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  RCvt      */  PACK( 1, 1 ),</span>
      /*  GC[0]     */  PACK( 1, 1 ),
      /*  GC[1]     */  PACK( 1, 1 ),
      /*  SCFS      */  PACK( 2, 0 ),
      /*  MD[0]     */  PACK( 2, 1 ),
      /*  MD[1]     */  PACK( 2, 1 ),
      /*  MPPEM     */  PACK( 0, 1 ),
      /*  MPS       */  PACK( 0, 1 ),
<span class="line-modified">!     /*  FlipON    */  PACK( 0, 0 ),</span>
<span class="line-modified">!     /*  FlipOFF   */  PACK( 0, 0 ),</span>
      /*  DEBUG     */  PACK( 1, 0 ),
  
      /*  LT        */  PACK( 2, 1 ),
      /*  LTEQ      */  PACK( 2, 1 ),
      /*  GT        */  PACK( 2, 1 ),
      /*  GTEQ      */  PACK( 2, 1 ),
      /*  EQ        */  PACK( 2, 1 ),
<span class="line-new-header">--- 719,34 ---</span>
      /*  SHZ[1]    */  PACK( 1, 0 ),
      /*  SHPIX     */  PACK( 1, 0 ), /* loops */
      /*  IP        */  PACK( 0, 0 ), /* loops */
      /*  MSIRP[0]  */  PACK( 2, 0 ),
      /*  MSIRP[1]  */  PACK( 2, 0 ),
<span class="line-modified">!     /*  ALIGNRP   */  PACK( 0, 0 ), /* loops */</span>
      /*  RTDG      */  PACK( 0, 0 ),
      /*  MIAP[0]   */  PACK( 2, 0 ),
      /*  MIAP[1]   */  PACK( 2, 0 ),
  
<span class="line-modified">!     /* 0x40 */</span>
<span class="line-modified">!     /*  NPUSHB    */  PACK( 0, 0 ),</span>
<span class="line-added">+     /*  NPUSHW    */  PACK( 0, 0 ),</span>
      /*  WS        */  PACK( 2, 0 ),
      /*  RS        */  PACK( 1, 1 ),
<span class="line-modified">!     /*  WCVTP     */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  RCVT      */  PACK( 1, 1 ),</span>
      /*  GC[0]     */  PACK( 1, 1 ),
      /*  GC[1]     */  PACK( 1, 1 ),
      /*  SCFS      */  PACK( 2, 0 ),
      /*  MD[0]     */  PACK( 2, 1 ),
      /*  MD[1]     */  PACK( 2, 1 ),
      /*  MPPEM     */  PACK( 0, 1 ),
      /*  MPS       */  PACK( 0, 1 ),
<span class="line-modified">!     /*  FLIPON    */  PACK( 0, 0 ),</span>
<span class="line-modified">!     /*  FLIPOFF   */  PACK( 0, 0 ),</span>
      /*  DEBUG     */  PACK( 1, 0 ),
  
<span class="line-added">+     /* 0x50 */</span>
      /*  LT        */  PACK( 2, 1 ),
      /*  LTEQ      */  PACK( 2, 1 ),
      /*  GT        */  PACK( 2, 1 ),
      /*  GTEQ      */  PACK( 2, 1 ),
      /*  EQ        */  PACK( 2, 1 ),
</pre>
<hr />
<pre>
<span class="line-old-header">*** 733,14 ***</span>
      /*  IF        */  PACK( 1, 0 ),
      /*  EIF       */  PACK( 0, 0 ),
      /*  AND       */  PACK( 2, 1 ),
      /*  OR        */  PACK( 2, 1 ),
      /*  NOT       */  PACK( 1, 1 ),
<span class="line-modified">!     /*  DeltaP1   */  PACK( 1, 0 ),</span>
      /*  SDB       */  PACK( 1, 0 ),
      /*  SDS       */  PACK( 1, 0 ),
  
      /*  ADD       */  PACK( 2, 1 ),
      /*  SUB       */  PACK( 2, 1 ),
      /*  DIV       */  PACK( 2, 1 ),
      /*  MUL       */  PACK( 2, 1 ),
      /*  ABS       */  PACK( 1, 1 ),
<span class="line-new-header">--- 756,15 ---</span>
      /*  IF        */  PACK( 1, 0 ),
      /*  EIF       */  PACK( 0, 0 ),
      /*  AND       */  PACK( 2, 1 ),
      /*  OR        */  PACK( 2, 1 ),
      /*  NOT       */  PACK( 1, 1 ),
<span class="line-modified">!     /*  DELTAP1   */  PACK( 1, 0 ),</span>
      /*  SDB       */  PACK( 1, 0 ),
      /*  SDS       */  PACK( 1, 0 ),
  
<span class="line-added">+     /* 0x60 */</span>
      /*  ADD       */  PACK( 2, 1 ),
      /*  SUB       */  PACK( 2, 1 ),
      /*  DIV       */  PACK( 2, 1 ),
      /*  MUL       */  PACK( 2, 1 ),
      /*  ABS       */  PACK( 1, 1 ),
</pre>
<hr />
<pre>
<span class="line-old-header">*** 754,44 ***</span>
      /*  NROUND[0] */  PACK( 1, 1 ),
      /*  NROUND[1] */  PACK( 1, 1 ),
      /*  NROUND[2] */  PACK( 1, 1 ),
      /*  NROUND[3] */  PACK( 1, 1 ),
  
<span class="line-modified">!     /*  WCvtF     */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  DeltaP2   */  PACK( 1, 0 ),</span>
<span class="line-modified">!     /*  DeltaP3   */  PACK( 1, 0 ),</span>
<span class="line-modified">!     /*  DeltaCn[0] */ PACK( 1, 0 ),</span>
<span class="line-modified">!     /*  DeltaCn[1] */ PACK( 1, 0 ),</span>
<span class="line-modified">!     /*  DeltaCn[2] */ PACK( 1, 0 ),</span>
      /*  SROUND    */  PACK( 1, 0 ),
<span class="line-modified">!     /*  S45Round  */  PACK( 1, 0 ),</span>
      /*  JROT      */  PACK( 2, 0 ),
      /*  JROF      */  PACK( 2, 0 ),
      /*  ROFF      */  PACK( 0, 0 ),
      /*  INS_$7B   */  PACK( 0, 0 ),
      /*  RUTG      */  PACK( 0, 0 ),
      /*  RDTG      */  PACK( 0, 0 ),
      /*  SANGW     */  PACK( 1, 0 ),
      /*  AA        */  PACK( 1, 0 ),
  
<span class="line-modified">!     /*  FlipPT    */  PACK( 0, 0 ), /* loops */</span>
<span class="line-modified">!     /*  FlipRgON  */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  FlipRgOFF */  PACK( 2, 0 ),</span>
      /*  INS_$83   */  PACK( 0, 0 ),
      /*  INS_$84   */  PACK( 0, 0 ),
<span class="line-modified">!     /*  ScanCTRL  */  PACK( 1, 0 ),</span>
<span class="line-modified">!     /*  SDPvTL[0] */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  SDPvTL[1] */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  GetINFO   */  PACK( 1, 1 ),</span>
      /*  IDEF      */  PACK( 1, 0 ),
      /*  ROLL      */  PACK( 3, 3 ),
      /*  MAX       */  PACK( 2, 1 ),
      /*  MIN       */  PACK( 2, 1 ),
<span class="line-modified">!     /*  ScanTYPE  */  PACK( 1, 0 ),</span>
<span class="line-modified">!     /*  InstCTRL  */  PACK( 2, 0 ),</span>
      /*  INS_$8F   */  PACK( 0, 0 ),
  
      /*  INS_$90  */   PACK( 0, 0 ),
      /*  GETVAR   */   PACK( 0, 0 ), /* will be handled specially */
      /*  GETDATA  */   PACK( 0, 1 ),
      /*  INS_$93  */   PACK( 0, 0 ),
      /*  INS_$94  */   PACK( 0, 0 ),
<span class="line-new-header">--- 778,47 ---</span>
      /*  NROUND[0] */  PACK( 1, 1 ),
      /*  NROUND[1] */  PACK( 1, 1 ),
      /*  NROUND[2] */  PACK( 1, 1 ),
      /*  NROUND[3] */  PACK( 1, 1 ),
  
<span class="line-modified">!     /* 0x70 */</span>
<span class="line-modified">!     /*  WCVTF     */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  DELTAP2   */  PACK( 1, 0 ),</span>
<span class="line-modified">!     /*  DELTAP3   */  PACK( 1, 0 ),</span>
<span class="line-modified">!     /*  DELTAC1   */  PACK( 1, 0 ),</span>
<span class="line-modified">!     /*  DELTAC2   */  PACK( 1, 0 ),</span>
<span class="line-added">+     /*  DELTAC3   */  PACK( 1, 0 ),</span>
      /*  SROUND    */  PACK( 1, 0 ),
<span class="line-modified">!     /*  S45ROUND  */  PACK( 1, 0 ),</span>
      /*  JROT      */  PACK( 2, 0 ),
      /*  JROF      */  PACK( 2, 0 ),
      /*  ROFF      */  PACK( 0, 0 ),
      /*  INS_$7B   */  PACK( 0, 0 ),
      /*  RUTG      */  PACK( 0, 0 ),
      /*  RDTG      */  PACK( 0, 0 ),
      /*  SANGW     */  PACK( 1, 0 ),
      /*  AA        */  PACK( 1, 0 ),
  
<span class="line-modified">!     /* 0x80 */</span>
<span class="line-modified">!     /*  FLIPPT    */  PACK( 0, 0 ), /* loops */</span>
<span class="line-modified">!     /*  FLIPRGON  */  PACK( 2, 0 ),</span>
<span class="line-added">+     /*  FLIPRGOFF */  PACK( 2, 0 ),</span>
      /*  INS_$83   */  PACK( 0, 0 ),
      /*  INS_$84   */  PACK( 0, 0 ),
<span class="line-modified">!     /*  SCANCTRL  */  PACK( 1, 0 ),</span>
<span class="line-modified">!     /*  SDPVTL[0] */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  SDPVTL[1] */  PACK( 2, 0 ),</span>
<span class="line-modified">!     /*  GETINFO   */  PACK( 1, 1 ),</span>
      /*  IDEF      */  PACK( 1, 0 ),
      /*  ROLL      */  PACK( 3, 3 ),
      /*  MAX       */  PACK( 2, 1 ),
      /*  MIN       */  PACK( 2, 1 ),
<span class="line-modified">!     /*  SCANTYPE  */  PACK( 1, 0 ),</span>
<span class="line-modified">!     /*  INSTCTRL  */  PACK( 2, 0 ),</span>
      /*  INS_$8F   */  PACK( 0, 0 ),
  
<span class="line-added">+     /* 0x90 */</span>
      /*  INS_$90  */   PACK( 0, 0 ),
      /*  GETVAR   */   PACK( 0, 0 ), /* will be handled specially */
      /*  GETDATA  */   PACK( 0, 1 ),
      /*  INS_$93  */   PACK( 0, 0 ),
      /*  INS_$94  */   PACK( 0, 0 ),
</pre>
<hr />
<pre>
<span class="line-old-header">*** 805,10 ***</span>
<span class="line-new-header">--- 832,11 ---</span>
      /*  INS_$9C  */   PACK( 0, 0 ),
      /*  INS_$9D  */   PACK( 0, 0 ),
      /*  INS_$9E  */   PACK( 0, 0 ),
      /*  INS_$9F  */   PACK( 0, 0 ),
  
<span class="line-added">+     /* 0xA0 */</span>
      /*  INS_$A0  */   PACK( 0, 0 ),
      /*  INS_$A1  */   PACK( 0, 0 ),
      /*  INS_$A2  */   PACK( 0, 0 ),
      /*  INS_$A3  */   PACK( 0, 0 ),
      /*  INS_$A4  */   PACK( 0, 0 ),
</pre>
<hr />
<pre>
<span class="line-old-header">*** 822,27 ***</span>
      /*  INS_$AC  */   PACK( 0, 0 ),
      /*  INS_$AD  */   PACK( 0, 0 ),
      /*  INS_$AE  */   PACK( 0, 0 ),
      /*  INS_$AF  */   PACK( 0, 0 ),
  
<span class="line-modified">!     /*  PushB[0]  */  PACK( 0, 1 ),</span>
<span class="line-modified">!     /*  PushB[1]  */  PACK( 0, 2 ),</span>
<span class="line-modified">!     /*  PushB[2]  */  PACK( 0, 3 ),</span>
<span class="line-modified">!     /*  PushB[3]  */  PACK( 0, 4 ),</span>
<span class="line-modified">!     /*  PushB[4]  */  PACK( 0, 5 ),</span>
<span class="line-modified">!     /*  PushB[5]  */  PACK( 0, 6 ),</span>
<span class="line-modified">!     /*  PushB[6]  */  PACK( 0, 7 ),</span>
<span class="line-modified">!     /*  PushB[7]  */  PACK( 0, 8 ),</span>
<span class="line-modified">!     /*  PushW[0]  */  PACK( 0, 1 ),</span>
<span class="line-modified">!     /*  PushW[1]  */  PACK( 0, 2 ),</span>
<span class="line-modified">!     /*  PushW[2]  */  PACK( 0, 3 ),</span>
<span class="line-modified">!     /*  PushW[3]  */  PACK( 0, 4 ),</span>
<span class="line-modified">!     /*  PushW[4]  */  PACK( 0, 5 ),</span>
<span class="line-modified">!     /*  PushW[5]  */  PACK( 0, 6 ),</span>
<span class="line-modified">!     /*  PushW[6]  */  PACK( 0, 7 ),</span>
<span class="line-modified">!     /*  PushW[7]  */  PACK( 0, 8 ),</span>
<span class="line-modified">! </span>
      /*  MDRP[00]  */  PACK( 1, 0 ),
      /*  MDRP[01]  */  PACK( 1, 0 ),
      /*  MDRP[02]  */  PACK( 1, 0 ),
      /*  MDRP[03]  */  PACK( 1, 0 ),
      /*  MDRP[04]  */  PACK( 1, 0 ),
<span class="line-new-header">--- 850,29 ---</span>
      /*  INS_$AC  */   PACK( 0, 0 ),
      /*  INS_$AD  */   PACK( 0, 0 ),
      /*  INS_$AE  */   PACK( 0, 0 ),
      /*  INS_$AF  */   PACK( 0, 0 ),
  
<span class="line-modified">!     /* 0xB0 */</span>
<span class="line-modified">!     /*  PUSHB[0]  */  PACK( 0, 1 ),</span>
<span class="line-modified">!     /*  PUSHB[1]  */  PACK( 0, 2 ),</span>
<span class="line-modified">!     /*  PUSHB[2]  */  PACK( 0, 3 ),</span>
<span class="line-modified">!     /*  PUSHB[3]  */  PACK( 0, 4 ),</span>
<span class="line-modified">!     /*  PUSHB[4]  */  PACK( 0, 5 ),</span>
<span class="line-modified">!     /*  PUSHB[5]  */  PACK( 0, 6 ),</span>
<span class="line-modified">!     /*  PUSHB[6]  */  PACK( 0, 7 ),</span>
<span class="line-modified">!     /*  PUSHB[7]  */  PACK( 0, 8 ),</span>
<span class="line-modified">!     /*  PUSHW[0]  */  PACK( 0, 1 ),</span>
<span class="line-modified">!     /*  PUSHW[1]  */  PACK( 0, 2 ),</span>
<span class="line-modified">!     /*  PUSHW[2]  */  PACK( 0, 3 ),</span>
<span class="line-modified">!     /*  PUSHW[3]  */  PACK( 0, 4 ),</span>
<span class="line-modified">!     /*  PUSHW[4]  */  PACK( 0, 5 ),</span>
<span class="line-modified">!     /*  PUSHW[5]  */  PACK( 0, 6 ),</span>
<span class="line-modified">!     /*  PUSHW[6]  */  PACK( 0, 7 ),</span>
<span class="line-modified">!     /*  PUSHW[7]  */  PACK( 0, 8 ),</span>
<span class="line-added">+ </span>
<span class="line-added">+     /* 0xC0 */</span>
      /*  MDRP[00]  */  PACK( 1, 0 ),
      /*  MDRP[01]  */  PACK( 1, 0 ),
      /*  MDRP[02]  */  PACK( 1, 0 ),
      /*  MDRP[03]  */  PACK( 1, 0 ),
      /*  MDRP[04]  */  PACK( 1, 0 ),
</pre>
<hr />
<pre>
<span class="line-old-header">*** 856,10 ***</span>
<span class="line-new-header">--- 886,11 ---</span>
      /*  MDRP[12]  */  PACK( 1, 0 ),
      /*  MDRP[13]  */  PACK( 1, 0 ),
      /*  MDRP[14]  */  PACK( 1, 0 ),
      /*  MDRP[15]  */  PACK( 1, 0 ),
  
<span class="line-added">+     /* 0xD0 */</span>
      /*  MDRP[16]  */  PACK( 1, 0 ),
      /*  MDRP[17]  */  PACK( 1, 0 ),
      /*  MDRP[18]  */  PACK( 1, 0 ),
      /*  MDRP[19]  */  PACK( 1, 0 ),
      /*  MDRP[20]  */  PACK( 1, 0 ),
</pre>
<hr />
<pre>
<span class="line-old-header">*** 873,10 ***</span>
<span class="line-new-header">--- 904,11 ---</span>
      /*  MDRP[28]  */  PACK( 1, 0 ),
      /*  MDRP[29]  */  PACK( 1, 0 ),
      /*  MDRP[30]  */  PACK( 1, 0 ),
      /*  MDRP[31]  */  PACK( 1, 0 ),
  
<span class="line-added">+     /* 0xE0 */</span>
      /*  MIRP[00]  */  PACK( 2, 0 ),
      /*  MIRP[01]  */  PACK( 2, 0 ),
      /*  MIRP[02]  */  PACK( 2, 0 ),
      /*  MIRP[03]  */  PACK( 2, 0 ),
      /*  MIRP[04]  */  PACK( 2, 0 ),
</pre>
<hr />
<pre>
<span class="line-old-header">*** 890,10 ***</span>
<span class="line-new-header">--- 922,11 ---</span>
      /*  MIRP[12]  */  PACK( 2, 0 ),
      /*  MIRP[13]  */  PACK( 2, 0 ),
      /*  MIRP[14]  */  PACK( 2, 0 ),
      /*  MIRP[15]  */  PACK( 2, 0 ),
  
<span class="line-added">+     /* 0xF0 */</span>
      /*  MIRP[16]  */  PACK( 2, 0 ),
      /*  MIRP[17]  */  PACK( 2, 0 ),
      /*  MIRP[18]  */  PACK( 2, 0 ),
      /*  MIRP[19]  */  PACK( 2, 0 ),
      /*  MIRP[20]  */  PACK( 2, 0 ),
</pre>
<hr />
<pre>
<span class="line-old-header">*** 918,27 ***</span>
    /* code                                                               */
  
    static
    const char*  const opcode_name[256] =
    {
<span class="line-modified">!     &quot;7 SVTCA y&quot;,</span>
<span class="line-modified">!     &quot;7 SVTCA x&quot;,</span>
<span class="line-modified">!     &quot;8 SPvTCA y&quot;,</span>
<span class="line-modified">!     &quot;8 SPvTCA x&quot;,</span>
<span class="line-modified">!     &quot;8 SFvTCA y&quot;,</span>
<span class="line-modified">!     &quot;8 SFvTCA x&quot;,</span>
<span class="line-modified">!     &quot;8 SPvTL ||&quot;,</span>
<span class="line-modified">!     &quot;7 SPvTL +&quot;,</span>
<span class="line-modified">!     &quot;8 SFvTL ||&quot;,</span>
<span class="line-modified">!     &quot;7 SFvTL +&quot;,</span>
<span class="line-modified">!     &quot;5 SPvFS&quot;,</span>
<span class="line-modified">!     &quot;5 SFvFS&quot;,</span>
<span class="line-modified">!     &quot;3 GPv&quot;,</span>
<span class="line-modified">!     &quot;3 GFv&quot;,</span>
<span class="line-modified">!     &quot;6 SFvTPv&quot;,</span>
      &quot;5 ISECT&quot;,
  
      &quot;4 SRP0&quot;,
      &quot;4 SRP1&quot;,
      &quot;4 SRP2&quot;,
      &quot;4 SZP0&quot;,
      &quot;4 SZP1&quot;,
<span class="line-new-header">--- 951,29 ---</span>
    /* code                                                               */
  
    static
    const char*  const opcode_name[256] =
    {
<span class="line-modified">!     /* 0x00 */</span>
<span class="line-modified">!     &quot;8 SVTCA[y]&quot;,</span>
<span class="line-modified">!     &quot;8 SVTCA[x]&quot;,</span>
<span class="line-modified">!     &quot;9 SPVTCA[y]&quot;,</span>
<span class="line-modified">!     &quot;9 SPVTCA[x]&quot;,</span>
<span class="line-modified">!     &quot;9 SFVTCA[y]&quot;,</span>
<span class="line-modified">!     &quot;9 SFVTCA[x]&quot;,</span>
<span class="line-modified">!     &quot;9 SPVTL[||]&quot;,</span>
<span class="line-modified">!     &quot;8 SPVTL[+]&quot;,</span>
<span class="line-modified">!     &quot;9 SFVTL[||]&quot;,</span>
<span class="line-modified">!     &quot;8 SFVTL[+]&quot;,</span>
<span class="line-modified">!     &quot;5 SPVFS&quot;,</span>
<span class="line-modified">!     &quot;5 SFVFS&quot;,</span>
<span class="line-modified">!     &quot;3 GPV&quot;,</span>
<span class="line-modified">!     &quot;3 GFV&quot;,</span>
<span class="line-added">+     &quot;6 SFVTPV&quot;,</span>
      &quot;5 ISECT&quot;,
  
<span class="line-added">+     /* 0x10 */</span>
      &quot;4 SRP0&quot;,
      &quot;4 SRP1&quot;,
      &quot;4 SRP2&quot;,
      &quot;4 SZP0&quot;,
      &quot;4 SZP1&quot;,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 948,65 ***</span>
      &quot;3 RTG&quot;,
      &quot;4 RTHG&quot;,
      &quot;3 SMD&quot;,
      &quot;4 ELSE&quot;,
      &quot;4 JMPR&quot;,
<span class="line-modified">!     &quot;6 SCvTCi&quot;,</span>
<span class="line-modified">!     &quot;5 SSwCi&quot;,</span>
      &quot;3 SSW&quot;,
  
      &quot;3 DUP&quot;,
      &quot;3 POP&quot;,
      &quot;5 CLEAR&quot;,
      &quot;4 SWAP&quot;,
      &quot;5 DEPTH&quot;,
      &quot;6 CINDEX&quot;,
      &quot;6 MINDEX&quot;,
<span class="line-modified">!     &quot;8 AlignPTS&quot;,</span>
      &quot;7 INS_$28&quot;,
      &quot;3 UTP&quot;,
      &quot;8 LOOPCALL&quot;,
      &quot;4 CALL&quot;,
      &quot;4 FDEF&quot;,
      &quot;4 ENDF&quot;,
<span class="line-modified">!     &quot;7 MDAP[0]&quot;,</span>
<span class="line-modified">!     &quot;7 MDAP[1]&quot;,</span>
<span class="line-modified">! </span>
<span class="line-modified">!     &quot;6 IUP[0]&quot;,</span>
<span class="line-modified">!     &quot;6 IUP[1]&quot;,</span>
<span class="line-modified">!     &quot;6 SHP[0]&quot;,</span>
<span class="line-modified">!     &quot;6 SHP[1]&quot;,</span>
<span class="line-modified">!     &quot;6 SHC[0]&quot;,</span>
<span class="line-modified">!     &quot;6 SHC[1]&quot;,</span>
<span class="line-modified">!     &quot;6 SHZ[0]&quot;,</span>
<span class="line-modified">!     &quot;6 SHZ[1]&quot;,</span>
      &quot;5 SHPIX&quot;,
      &quot;2 IP&quot;,
<span class="line-modified">!     &quot;8 MSIRP[0]&quot;,</span>
<span class="line-modified">!     &quot;8 MSIRP[1]&quot;,</span>
<span class="line-modified">!     &quot;7 AlignRP&quot;,</span>
      &quot;4 RTDG&quot;,
<span class="line-modified">!     &quot;7 MIAP[0]&quot;,</span>
<span class="line-modified">!     &quot;7 MIAP[1]&quot;,</span>
  
<span class="line-modified">!     &quot;6 NPushB&quot;,</span>
<span class="line-modified">!     &quot;6 NPushW&quot;,</span>
      &quot;2 WS&quot;,
      &quot;2 RS&quot;,
<span class="line-modified">!     &quot;5 WCvtP&quot;,</span>
<span class="line-modified">!     &quot;4 RCvt&quot;,</span>
<span class="line-modified">!     &quot;5 GC[0]&quot;,</span>
<span class="line-modified">!     &quot;5 GC[1]&quot;,</span>
      &quot;4 SCFS&quot;,
<span class="line-modified">!     &quot;5 MD[0]&quot;,</span>
<span class="line-modified">!     &quot;5 MD[1]&quot;,</span>
      &quot;5 MPPEM&quot;,
      &quot;3 MPS&quot;,
<span class="line-modified">!     &quot;6 FlipON&quot;,</span>
<span class="line-modified">!     &quot;7 FlipOFF&quot;,</span>
      &quot;5 DEBUG&quot;,
  
      &quot;2 LT&quot;,
      &quot;4 LTEQ&quot;,
      &quot;2 GT&quot;,
      &quot;4 GTEQ&quot;,
      &quot;2 EQ&quot;,
<span class="line-new-header">--- 983,69 ---</span>
      &quot;3 RTG&quot;,
      &quot;4 RTHG&quot;,
      &quot;3 SMD&quot;,
      &quot;4 ELSE&quot;,
      &quot;4 JMPR&quot;,
<span class="line-modified">!     &quot;6 SCVTCI&quot;,</span>
<span class="line-modified">!     &quot;5 SSWCI&quot;,</span>
      &quot;3 SSW&quot;,
  
<span class="line-added">+     /* 0x20 */</span>
      &quot;3 DUP&quot;,
      &quot;3 POP&quot;,
      &quot;5 CLEAR&quot;,
      &quot;4 SWAP&quot;,
      &quot;5 DEPTH&quot;,
      &quot;6 CINDEX&quot;,
      &quot;6 MINDEX&quot;,
<span class="line-modified">!     &quot;8 ALIGNPTS&quot;,</span>
      &quot;7 INS_$28&quot;,
      &quot;3 UTP&quot;,
      &quot;8 LOOPCALL&quot;,
      &quot;4 CALL&quot;,
      &quot;4 FDEF&quot;,
      &quot;4 ENDF&quot;,
<span class="line-modified">!     &quot;6 MDAP[]&quot;,</span>
<span class="line-modified">!     &quot;9 MDAP[rnd]&quot;,</span>
<span class="line-modified">! </span>
<span class="line-modified">!     /* 0x30 */</span>
<span class="line-modified">!     &quot;6 IUP[y]&quot;,</span>
<span class="line-modified">!     &quot;6 IUP[x]&quot;,</span>
<span class="line-modified">!     &quot;8 SHP[rp2]&quot;,</span>
<span class="line-modified">!     &quot;8 SHP[rp1]&quot;,</span>
<span class="line-modified">!     &quot;8 SHC[rp2]&quot;,</span>
<span class="line-modified">!     &quot;8 SHC[rp1]&quot;,</span>
<span class="line-modified">!     &quot;8 SHZ[rp2]&quot;,</span>
<span class="line-added">+     &quot;8 SHZ[rp1]&quot;,</span>
      &quot;5 SHPIX&quot;,
      &quot;2 IP&quot;,
<span class="line-modified">!     &quot;7 MSIRP[]&quot;,</span>
<span class="line-modified">!     &quot;A MSIRP[rp0]&quot;,</span>
<span class="line-modified">!     &quot;7 ALIGNRP&quot;,</span>
      &quot;4 RTDG&quot;,
<span class="line-modified">!     &quot;6 MIAP[]&quot;,</span>
<span class="line-modified">!     &quot;9 MIAP[rnd]&quot;,</span>
  
<span class="line-modified">!     /* 0x40 */</span>
<span class="line-modified">!     &quot;6 NPUSHB&quot;,</span>
<span class="line-added">+     &quot;6 NPUSHW&quot;,</span>
      &quot;2 WS&quot;,
      &quot;2 RS&quot;,
<span class="line-modified">!     &quot;5 WCVTP&quot;,</span>
<span class="line-modified">!     &quot;4 RCVT&quot;,</span>
<span class="line-modified">!     &quot;8 GC[curr]&quot;,</span>
<span class="line-modified">!     &quot;8 GC[orig]&quot;,</span>
      &quot;4 SCFS&quot;,
<span class="line-modified">!     &quot;8 MD[curr]&quot;,</span>
<span class="line-modified">!     &quot;8 MD[orig]&quot;,</span>
      &quot;5 MPPEM&quot;,
      &quot;3 MPS&quot;,
<span class="line-modified">!     &quot;6 FLIPON&quot;,</span>
<span class="line-modified">!     &quot;7 FLIPOFF&quot;,</span>
      &quot;5 DEBUG&quot;,
  
<span class="line-added">+     /* 0x50 */</span>
      &quot;2 LT&quot;,
      &quot;4 LTEQ&quot;,
      &quot;2 GT&quot;,
      &quot;4 GTEQ&quot;,
      &quot;2 EQ&quot;,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1016,68 ***</span>
      &quot;2 IF&quot;,
      &quot;3 EIF&quot;,
      &quot;3 AND&quot;,
      &quot;2 OR&quot;,
      &quot;3 NOT&quot;,
<span class="line-modified">!     &quot;7 DeltaP1&quot;,</span>
      &quot;3 SDB&quot;,
      &quot;3 SDS&quot;,
  
      &quot;3 ADD&quot;,
      &quot;3 SUB&quot;,
      &quot;3 DIV&quot;,
      &quot;3 MUL&quot;,
      &quot;3 ABS&quot;,
      &quot;3 NEG&quot;,
      &quot;5 FLOOR&quot;,
      &quot;7 CEILING&quot;,
<span class="line-modified">!     &quot;8 ROUND[0]&quot;,</span>
<span class="line-modified">!     &quot;8 ROUND[1]&quot;,</span>
<span class="line-modified">!     &quot;8 ROUND[2]&quot;,</span>
<span class="line-modified">!     &quot;8 ROUND[3]&quot;,</span>
<span class="line-modified">!     &quot;9 NROUND[0]&quot;,</span>
<span class="line-modified">!     &quot;9 NROUND[1]&quot;,</span>
<span class="line-modified">!     &quot;9 NROUND[2]&quot;,</span>
<span class="line-modified">!     &quot;9 NROUND[3]&quot;,</span>
<span class="line-modified">! </span>
<span class="line-modified">!     &quot;5 WCvtF&quot;,</span>
<span class="line-modified">!     &quot;7 DeltaP2&quot;,</span>
<span class="line-modified">!     &quot;7 DeltaP3&quot;,</span>
<span class="line-modified">!     &quot;A DeltaCn[0]&quot;,</span>
<span class="line-modified">!     &quot;A DeltaCn[1]&quot;,</span>
<span class="line-modified">!     &quot;A DeltaCn[2]&quot;,</span>
      &quot;6 SROUND&quot;,
<span class="line-modified">!     &quot;8 S45Round&quot;,</span>
      &quot;4 JROT&quot;,
      &quot;4 JROF&quot;,
      &quot;4 ROFF&quot;,
      &quot;7 INS_$7B&quot;,
      &quot;4 RUTG&quot;,
      &quot;4 RDTG&quot;,
      &quot;5 SANGW&quot;,
      &quot;2 AA&quot;,
  
<span class="line-modified">!     &quot;6 FlipPT&quot;,</span>
<span class="line-modified">!     &quot;8 FlipRgON&quot;,</span>
<span class="line-modified">!     &quot;9 FlipRgOFF&quot;,</span>
      &quot;7 INS_$83&quot;,
      &quot;7 INS_$84&quot;,
<span class="line-modified">!     &quot;8 ScanCTRL&quot;,</span>
<span class="line-modified">!     &quot;9 SDPvTL[0]&quot;,</span>
<span class="line-modified">!     &quot;9 SDPvTL[1]&quot;,</span>
<span class="line-modified">!     &quot;7 GetINFO&quot;,</span>
      &quot;4 IDEF&quot;,
      &quot;4 ROLL&quot;,
      &quot;3 MAX&quot;,
      &quot;3 MIN&quot;,
<span class="line-modified">!     &quot;8 ScanTYPE&quot;,</span>
<span class="line-modified">!     &quot;8 InstCTRL&quot;,</span>
      &quot;7 INS_$8F&quot;,
  
      &quot;7 INS_$90&quot;,
  #ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT
<span class="line-modified">!     &quot;6 GETVAR&quot;,</span>
      &quot;7 GETDATA&quot;,
  #else
      &quot;7 INS_$91&quot;,
      &quot;7 INS_$92&quot;,
  #endif
<span class="line-new-header">--- 1055,72 ---</span>
      &quot;2 IF&quot;,
      &quot;3 EIF&quot;,
      &quot;3 AND&quot;,
      &quot;2 OR&quot;,
      &quot;3 NOT&quot;,
<span class="line-modified">!     &quot;7 DELTAP1&quot;,</span>
      &quot;3 SDB&quot;,
      &quot;3 SDS&quot;,
  
<span class="line-added">+     /* 0x60 */</span>
      &quot;3 ADD&quot;,
      &quot;3 SUB&quot;,
      &quot;3 DIV&quot;,
      &quot;3 MUL&quot;,
      &quot;3 ABS&quot;,
      &quot;3 NEG&quot;,
      &quot;5 FLOOR&quot;,
      &quot;7 CEILING&quot;,
<span class="line-modified">!     &quot;8 ROUND[G]&quot;,</span>
<span class="line-modified">!     &quot;8 ROUND[B]&quot;,</span>
<span class="line-modified">!     &quot;8 ROUND[W]&quot;,</span>
<span class="line-modified">!     &quot;7 ROUND[]&quot;,</span>
<span class="line-modified">!     &quot;9 NROUND[G]&quot;,</span>
<span class="line-modified">!     &quot;9 NROUND[B]&quot;,</span>
<span class="line-modified">!     &quot;9 NROUND[W]&quot;,</span>
<span class="line-modified">!     &quot;8 NROUND[]&quot;,</span>
<span class="line-modified">! </span>
<span class="line-modified">!     /* 0x70 */</span>
<span class="line-modified">!     &quot;5 WCVTF&quot;,</span>
<span class="line-modified">!     &quot;7 DELTAP2&quot;,</span>
<span class="line-modified">!     &quot;7 DELTAP3&quot;,</span>
<span class="line-modified">!     &quot;7 DELTAC1&quot;,</span>
<span class="line-modified">!     &quot;7 DELTAC2&quot;,</span>
<span class="line-added">+     &quot;7 DELTAC3&quot;,</span>
      &quot;6 SROUND&quot;,
<span class="line-modified">!     &quot;8 S45ROUND&quot;,</span>
      &quot;4 JROT&quot;,
      &quot;4 JROF&quot;,
      &quot;4 ROFF&quot;,
      &quot;7 INS_$7B&quot;,
      &quot;4 RUTG&quot;,
      &quot;4 RDTG&quot;,
      &quot;5 SANGW&quot;,
      &quot;2 AA&quot;,
  
<span class="line-modified">!     /* 0x80 */</span>
<span class="line-modified">!     &quot;6 FLIPPT&quot;,</span>
<span class="line-modified">!     &quot;8 FLIPRGON&quot;,</span>
<span class="line-added">+     &quot;9 FLIPRGOFF&quot;,</span>
      &quot;7 INS_$83&quot;,
      &quot;7 INS_$84&quot;,
<span class="line-modified">!     &quot;8 SCANCTRL&quot;,</span>
<span class="line-modified">!     &quot;A SDPVTL[||]&quot;,</span>
<span class="line-modified">!     &quot;9 SDPVTL[+]&quot;,</span>
<span class="line-modified">!     &quot;7 GETINFO&quot;,</span>
      &quot;4 IDEF&quot;,
      &quot;4 ROLL&quot;,
      &quot;3 MAX&quot;,
      &quot;3 MIN&quot;,
<span class="line-modified">!     &quot;8 SCANTYPE&quot;,</span>
<span class="line-modified">!     &quot;8 INSTCTRL&quot;,</span>
      &quot;7 INS_$8F&quot;,
  
<span class="line-added">+     /* 0x90 */</span>
      &quot;7 INS_$90&quot;,
  #ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT
<span class="line-modified">!     &quot;C GETVARIATION&quot;,</span>
      &quot;7 GETDATA&quot;,
  #else
      &quot;7 INS_$91&quot;,
      &quot;7 INS_$92&quot;,
  #endif
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1093,10 ***</span>
<span class="line-new-header">--- 1136,11 ---</span>
      &quot;7 INS_$9C&quot;,
      &quot;7 INS_$9D&quot;,
      &quot;7 INS_$9E&quot;,
      &quot;7 INS_$9F&quot;,
  
<span class="line-added">+     /* 0xA0 */</span>
      &quot;7 INS_$A0&quot;,
      &quot;7 INS_$A1&quot;,
      &quot;7 INS_$A2&quot;,
      &quot;7 INS_$A3&quot;,
      &quot;7 INS_$A4&quot;,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1110,94 ***</span>
      &quot;7 INS_$AC&quot;,
      &quot;7 INS_$AD&quot;,
      &quot;7 INS_$AE&quot;,
      &quot;7 INS_$AF&quot;,
  
<span class="line-modified">!     &quot;8 PushB[0]&quot;,</span>
<span class="line-modified">!     &quot;8 PushB[1]&quot;,</span>
<span class="line-modified">!     &quot;8 PushB[2]&quot;,</span>
<span class="line-modified">!     &quot;8 PushB[3]&quot;,</span>
<span class="line-modified">!     &quot;8 PushB[4]&quot;,</span>
<span class="line-modified">!     &quot;8 PushB[5]&quot;,</span>
<span class="line-modified">!     &quot;8 PushB[6]&quot;,</span>
<span class="line-modified">!     &quot;8 PushB[7]&quot;,</span>
<span class="line-modified">!     &quot;8 PushW[0]&quot;,</span>
<span class="line-modified">!     &quot;8 PushW[1]&quot;,</span>
<span class="line-modified">!     &quot;8 PushW[2]&quot;,</span>
<span class="line-modified">!     &quot;8 PushW[3]&quot;,</span>
<span class="line-modified">!     &quot;8 PushW[4]&quot;,</span>
<span class="line-modified">!     &quot;8 PushW[5]&quot;,</span>
<span class="line-modified">!     &quot;8 PushW[6]&quot;,</span>
<span class="line-modified">!     &quot;8 PushW[7]&quot;,</span>
<span class="line-modified">! </span>
<span class="line-modified">!     &quot;8 MDRP[00]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[01]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[02]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[03]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[04]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[05]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[06]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[07]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[08]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[09]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[10]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[11]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[12]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[13]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[14]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[15]&quot;,</span>
<span class="line-modified">! </span>
<span class="line-modified">!     &quot;8 MDRP[16]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[17]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[18]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[19]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[20]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[21]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[22]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[23]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[24]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[25]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[26]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[27]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[28]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[29]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[30]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[31]&quot;,</span>
<span class="line-modified">! </span>
<span class="line-modified">!     &quot;8 MIRP[00]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[01]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[02]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[03]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[04]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[05]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[06]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[07]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[08]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[09]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[10]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[11]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[12]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[13]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[14]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[15]&quot;,</span>
<span class="line-modified">! </span>
<span class="line-modified">!     &quot;8 MIRP[16]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[17]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[18]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[19]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[20]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[21]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[22]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[23]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[24]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[25]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[26]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[27]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[28]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[29]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[30]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[31]&quot;</span>
    };
  
  #endif /* FT_DEBUG_LEVEL_TRACE */
  
  
<span class="line-new-header">--- 1154,99 ---</span>
      &quot;7 INS_$AC&quot;,
      &quot;7 INS_$AD&quot;,
      &quot;7 INS_$AE&quot;,
      &quot;7 INS_$AF&quot;,
  
<span class="line-modified">!     /* 0xB0 */</span>
<span class="line-modified">!     &quot;8 PUSHB[0]&quot;,</span>
<span class="line-modified">!     &quot;8 PUSHB[1]&quot;,</span>
<span class="line-modified">!     &quot;8 PUSHB[2]&quot;,</span>
<span class="line-modified">!     &quot;8 PUSHB[3]&quot;,</span>
<span class="line-modified">!     &quot;8 PUSHB[4]&quot;,</span>
<span class="line-modified">!     &quot;8 PUSHB[5]&quot;,</span>
<span class="line-modified">!     &quot;8 PUSHB[6]&quot;,</span>
<span class="line-modified">!     &quot;8 PUSHB[7]&quot;,</span>
<span class="line-modified">!     &quot;8 PUSHW[0]&quot;,</span>
<span class="line-modified">!     &quot;8 PUSHW[1]&quot;,</span>
<span class="line-modified">!     &quot;8 PUSHW[2]&quot;,</span>
<span class="line-modified">!     &quot;8 PUSHW[3]&quot;,</span>
<span class="line-modified">!     &quot;8 PUSHW[4]&quot;,</span>
<span class="line-modified">!     &quot;8 PUSHW[5]&quot;,</span>
<span class="line-modified">!     &quot;8 PUSHW[6]&quot;,</span>
<span class="line-modified">!     &quot;8 PUSHW[7]&quot;,</span>
<span class="line-modified">! </span>
<span class="line-modified">!     /* 0xC0 */</span>
<span class="line-modified">!     &quot;7 MDRP[G]&quot;,</span>
<span class="line-modified">!     &quot;7 MDRP[B]&quot;,</span>
<span class="line-modified">!     &quot;7 MDRP[W]&quot;,</span>
<span class="line-modified">!     &quot;6 MDRP[]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[rG]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[rB]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[rW]&quot;,</span>
<span class="line-modified">!     &quot;7 MDRP[r]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[mG]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[mB]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[mW]&quot;,</span>
<span class="line-modified">!     &quot;7 MDRP[m]&quot;,</span>
<span class="line-modified">!     &quot;9 MDRP[mrG]&quot;,</span>
<span class="line-modified">!     &quot;9 MDRP[mrB]&quot;,</span>
<span class="line-modified">!     &quot;9 MDRP[mrW]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[mr]&quot;,</span>
<span class="line-modified">! </span>
<span class="line-modified">!     /* 0xD0 */</span>
<span class="line-modified">!     &quot;8 MDRP[pG]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[pB]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[pW]&quot;,</span>
<span class="line-modified">!     &quot;7 MDRP[p]&quot;,</span>
<span class="line-modified">!     &quot;9 MDRP[prG]&quot;,</span>
<span class="line-modified">!     &quot;9 MDRP[prB]&quot;,</span>
<span class="line-modified">!     &quot;9 MDRP[prW]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[pr]&quot;,</span>
<span class="line-modified">!     &quot;9 MDRP[pmG]&quot;,</span>
<span class="line-modified">!     &quot;9 MDRP[pmB]&quot;,</span>
<span class="line-modified">!     &quot;9 MDRP[pmW]&quot;,</span>
<span class="line-modified">!     &quot;8 MDRP[pm]&quot;,</span>
<span class="line-modified">!     &quot;A MDRP[pmrG]&quot;,</span>
<span class="line-modified">!     &quot;A MDRP[pmrB]&quot;,</span>
<span class="line-modified">!     &quot;A MDRP[pmrW]&quot;,</span>
<span class="line-modified">!     &quot;9 MDRP[pmr]&quot;,</span>
<span class="line-modified">! </span>
<span class="line-modified">!     /* 0xE0 */</span>
<span class="line-modified">!     &quot;7 MIRP[G]&quot;,</span>
<span class="line-modified">!     &quot;7 MIRP[B]&quot;,</span>
<span class="line-modified">!     &quot;7 MIRP[W]&quot;,</span>
<span class="line-modified">!     &quot;6 MIRP[]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[rG]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[rB]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[rW]&quot;,</span>
<span class="line-modified">!     &quot;7 MIRP[r]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[mG]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[mB]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[mW]&quot;,</span>
<span class="line-modified">!     &quot;7 MIRP[m]&quot;,</span>
<span class="line-modified">!     &quot;9 MIRP[mrG]&quot;,</span>
<span class="line-modified">!     &quot;9 MIRP[mrB]&quot;,</span>
<span class="line-modified">!     &quot;9 MIRP[mrW]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[mr]&quot;,</span>
<span class="line-modified">! </span>
<span class="line-modified">!     /* 0xF0 */</span>
<span class="line-modified">!     &quot;8 MIRP[pG]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[pB]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[pW]&quot;,</span>
<span class="line-modified">!     &quot;7 MIRP[p]&quot;,</span>
<span class="line-modified">!     &quot;9 MIRP[prG]&quot;,</span>
<span class="line-modified">!     &quot;9 MIRP[prB]&quot;,</span>
<span class="line-modified">!     &quot;9 MIRP[prW]&quot;,</span>
<span class="line-modified">!     &quot;8 MIRP[pr]&quot;,</span>
<span class="line-modified">!     &quot;9 MIRP[pmG]&quot;,</span>
<span class="line-modified">!     &quot;9 MIRP[pmB]&quot;,</span>
<span class="line-modified">!     &quot;9 MIRP[pmW]&quot;,</span>
<span class="line-added">+     &quot;8 MIRP[pm]&quot;,</span>
<span class="line-added">+     &quot;A MIRP[pmrG]&quot;,</span>
<span class="line-added">+     &quot;A MIRP[pmrB]&quot;,</span>
<span class="line-added">+     &quot;A MIRP[pmrW]&quot;,</span>
<span class="line-added">+     &quot;9 MIRP[pmr]&quot;</span>
    };
  
  #endif /* FT_DEBUG_LEVEL_TRACE */
  
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1446,22 ***</span>
    }
  
  #endif /* TT_DotFix14 */
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Current_Ratio                                                      */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Returns the current aspect ratio scaling factor depending on the   */</span>
<span class="line-modified">!   /*    projection vector&#39;s state and device resolutions.                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    The aspect ratio in 16.16 format, always &lt;= 1.0 .                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_Long
    Current_Ratio( TT_ExecContext  exc )
    {
      if ( !exc-&gt;tt_metrics.ratio )
      {
<span class="line-new-header">--- 1495,22 ---</span>
    }
  
  #endif /* TT_DotFix14 */
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Current_Ratio</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Returns the current aspect ratio scaling factor depending on the</span>
<span class="line-modified">!    *   projection vector&#39;s state and device resolutions.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-modified">!    *   The aspect ratio in 16.16 format, always &lt;= 1.0 .</span>
<span class="line-modified">!    */</span>
    static FT_Long
    Current_Ratio( TT_ExecContext  exc )
    {
      if ( !exc-&gt;tt_metrics.ratio )
      {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1499,15 ***</span>
    {
      return FT_MulFix( exc-&gt;tt_metrics.ppem, Current_Ratio( exc ) );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Functions related to the control value table (CVT).                   */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*************************************************************************/</span>
  
  
    FT_CALLBACK_DEF( FT_F26Dot6 )
    Read_CVT( TT_ExecContext  exc,
              FT_ULong        idx )
<span class="line-new-header">--- 1548,15 ---</span>
    {
      return FT_MulFix( exc-&gt;tt_metrics.ppem, Current_Ratio( exc ) );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Functions related to the control value table (CVT).</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    */</span>
  
  
    FT_CALLBACK_DEF( FT_F26Dot6 )
    Read_CVT( TT_ExecContext  exc,
              FT_ULong        idx )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1545,64 ***</span>
    FT_CALLBACK_DEF( void )
    Move_CVT( TT_ExecContext  exc,
              FT_ULong        idx,
              FT_F26Dot6      value )
    {
<span class="line-modified">!     exc-&gt;cvt[idx] += value;</span>
    }
  
  
    FT_CALLBACK_DEF( void )
    Move_CVT_Stretched( TT_ExecContext  exc,
                        FT_ULong        idx,
                        FT_F26Dot6      value )
    {
<span class="line-modified">!     exc-&gt;cvt[idx] += FT_DivFix( value, Current_Ratio( exc ) );</span>
<span class="line-modified">!   }</span>
<span class="line-modified">! </span>
<span class="line-modified">! </span>
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    GetShortIns                                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Returns a short integer taken from the instruction stream at       */</span>
<span class="line-modified">!   /*    address IP.                                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    Short read at code[IP].                                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Note&gt;                                                                */</span>
<span class="line-modified">!   /*    This one could become a macro.                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_Short
    GetShortIns( TT_ExecContext  exc )
    {
      /* Reading a byte stream so there is no endianness (DaveP) */
      exc-&gt;IP += 2;
      return (FT_Short)( ( exc-&gt;code[exc-&gt;IP - 2] &lt;&lt; 8 ) +
                           exc-&gt;code[exc-&gt;IP - 1]      );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Ins_Goto_CodeRange                                                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Goes to a certain code range in the instruction stream.            */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    aRange :: The index of the code range.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    aIP    :: The new IP address in the code range.                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    SUCCESS or FAILURE.                                                */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_Bool
    Ins_Goto_CodeRange( TT_ExecContext  exc,
                        FT_Int          aRange,
                        FT_Long         aIP )
    {
<span class="line-new-header">--- 1594,67 ---</span>
    FT_CALLBACK_DEF( void )
    Move_CVT( TT_ExecContext  exc,
              FT_ULong        idx,
              FT_F26Dot6      value )
    {
<span class="line-modified">!     exc-&gt;cvt[idx] = ADD_LONG( exc-&gt;cvt[idx], value );</span>
    }
  
  
    FT_CALLBACK_DEF( void )
    Move_CVT_Stretched( TT_ExecContext  exc,
                        FT_ULong        idx,
                        FT_F26Dot6      value )
    {
<span class="line-modified">!     exc-&gt;cvt[idx] = ADD_LONG( exc-&gt;cvt[idx],</span>
<span class="line-modified">!                               FT_DivFix( value, Current_Ratio( exc ) ) );</span>
<span class="line-modified">!   }</span>
<span class="line-modified">! </span>
<span class="line-modified">! </span>
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   GetShortIns</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Returns a short integer taken from the instruction stream at</span>
<span class="line-modified">!    *   address IP.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-modified">!    *   Short read at code[IP].</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Note:</span>
<span class="line-modified">!    *   This one could become a macro.</span>
<span class="line-added">+    */</span>
    static FT_Short
    GetShortIns( TT_ExecContext  exc )
    {
      /* Reading a byte stream so there is no endianness (DaveP) */
      exc-&gt;IP += 2;
      return (FT_Short)( ( exc-&gt;code[exc-&gt;IP - 2] &lt;&lt; 8 ) +
                           exc-&gt;code[exc-&gt;IP - 1]      );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Ins_Goto_CodeRange</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Goes to a certain code range in the instruction stream.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   aRange ::</span>
<span class="line-modified">!    *     The index of the code range.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   aIP ::</span>
<span class="line-modified">!    *     The new IP address in the code range.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-added">+    *   SUCCESS or FAILURE.</span>
<span class="line-added">+    */</span>
    static FT_Bool
    Ins_Goto_CodeRange( TT_ExecContext  exc,
                        FT_Int          aRange,
                        FT_Long         aIP )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1640,31 ***</span>
  
      return SUCCESS;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Direct_Move                                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Moves a point by a given distance along the freedom vector.  The   */</span>
<span class="line-modified">!   /*    point will be `touched&#39;.                                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    point    :: The index of the point to move.                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    distance :: The distance to apply.                                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;InOut&gt;                                                               */</span>
<span class="line-modified">!   /*    zone     :: The affected glyph zone.                               */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Note&gt;                                                                */</span>
<span class="line-modified">!   /*    See `ttinterp.h&#39; for details on backward compatibility mode.       */</span>
<span class="line-modified">!   /*    `Touches&#39; the point.                                               */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Direct_Move( TT_ExecContext  exc,
                 TT_GlyphZone    zone,
                 FT_UShort       point,
                 FT_F26Dot6      distance )
<span class="line-new-header">--- 1692,60 ---</span>
  
      return SUCCESS;
    }
  
  
<span class="line-modified">!   /*</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Apple&#39;s TrueType specification at</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   https://developer.apple.com/fonts/TrueType-Reference-Manual/RM02/Chap2.html#order</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * gives the following order of operations in instructions that move</span>
<span class="line-modified">!    * points.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   - check single width cut-in (MIRP, MDRP)</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   - check control value cut-in (MIRP, MIAP)</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   - apply engine compensation (MIRP, MDRP)</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   - round distance (MIRP, MDRP) or value (MIAP, MDAP)</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   - check minimum distance (MIRP,MDRP)</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   - move point (MIRP, MDRP, MIAP, MSIRP, MDAP)</span>
<span class="line-modified">!    *</span>
<span class="line-added">+    * For rounding instructions, engine compensation happens before rounding.</span>
<span class="line-added">+    *</span>
<span class="line-added">+    */</span>
<span class="line-added">+ </span>
<span class="line-added">+ </span>
<span class="line-added">+   /**************************************************************************</span>
<span class="line-added">+    *</span>
<span class="line-added">+    * @Function:</span>
<span class="line-added">+    *   Direct_Move</span>
<span class="line-added">+    *</span>
<span class="line-added">+    * @Description:</span>
<span class="line-added">+    *   Moves a point by a given distance along the freedom vector.  The</span>
<span class="line-added">+    *   point will be `touched&#39;.</span>
<span class="line-added">+    *</span>
<span class="line-added">+    * @Input:</span>
<span class="line-added">+    *   point ::</span>
<span class="line-added">+    *     The index of the point to move.</span>
<span class="line-added">+    *</span>
<span class="line-added">+    *   distance ::</span>
<span class="line-added">+    *     The distance to apply.</span>
<span class="line-added">+    *</span>
<span class="line-added">+    * @InOut:</span>
<span class="line-added">+    *   zone ::</span>
<span class="line-added">+    *     The affected glyph zone.</span>
<span class="line-added">+    *</span>
<span class="line-added">+    * @Note:</span>
<span class="line-added">+    *   See `ttinterp.h&#39; for details on backward compatibility mode.</span>
<span class="line-added">+    *   `Touches&#39; the point.</span>
<span class="line-added">+    */</span>
    static void
    Direct_Move( TT_ExecContext  exc,
                 TT_GlyphZone    zone,
                 FT_UShort       point,
                 FT_F26Dot6      distance )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1726,27 ***</span>
        zone-&gt;tags[point] |= FT_CURVE_TAG_TOUCH_Y;
      }
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Direct_Move_Orig                                                   */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Moves the *original* position of a point by a given distance along */</span>
<span class="line-modified">!   /*    the freedom vector.  Obviously, the point will not be `touched&#39;.   */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    point    :: The index of the point to move.                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    distance :: The distance to apply.                                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;InOut&gt;                                                               */</span>
<span class="line-modified">!   /*    zone     :: The affected glyph zone.                               */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Direct_Move_Orig( TT_ExecContext  exc,
                      TT_GlyphZone    zone,
                      FT_UShort       point,
                      FT_F26Dot6      distance )
<span class="line-new-header">--- 1807,30 ---</span>
        zone-&gt;tags[point] |= FT_CURVE_TAG_TOUCH_Y;
      }
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Direct_Move_Orig</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Moves the *original* position of a point by a given distance along</span>
<span class="line-modified">!    *   the freedom vector.  Obviously, the point will not be `touched&#39;.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   point ::</span>
<span class="line-modified">!    *     The index of the point to move.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   distance ::</span>
<span class="line-modified">!    *     The distance to apply.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @InOut:</span>
<span class="line-added">+    *   zone ::</span>
<span class="line-added">+    *     The affected glyph zone.</span>
<span class="line-added">+    */</span>
    static void
    Direct_Move_Orig( TT_ExecContext  exc,
                      TT_GlyphZone    zone,
                      FT_UShort       point,
                      FT_F26Dot6      distance )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1770,19 ***</span>
                                                  v,
                                                  exc-&gt;F_dot_P ) );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Special versions of Direct_Move()                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   The following versions are used whenever both vectors are both      */</span>
<span class="line-modified">!   /*   along one of the coordinate unit vectors, i.e. in 90% of the cases. */</span>
<span class="line-modified">!   /*   See `ttinterp.h&#39; for details on backward compatibility mode.        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*************************************************************************/</span>
  
  
    static void
    Direct_Move_X( TT_ExecContext  exc,
                   TT_GlyphZone    zone,
<span class="line-new-header">--- 1854,19 ---</span>
                                                  v,
                                                  exc-&gt;F_dot_P ) );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Special versions of Direct_Move()</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   The following versions are used whenever both vectors are both</span>
<span class="line-modified">!    *   along one of the coordinate unit vectors, i.e. in 90% of the cases.</span>
<span class="line-modified">!    *   See `ttinterp.h&#39; for details on backward compatibility mode.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    */</span>
  
  
    static void
    Direct_Move_X( TT_ExecContext  exc,
                   TT_GlyphZone    zone,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1825,18 ***</span>
  
      zone-&gt;tags[point] |= FT_CURVE_TAG_TOUCH_Y;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Special versions of Direct_Move_Orig()                                */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   The following versions are used whenever both vectors are both      */</span>
<span class="line-modified">!   /*   along one of the coordinate unit vectors, i.e. in 90% of the cases. */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*************************************************************************/</span>
  
  
    static void
    Direct_Move_Orig_X( TT_ExecContext  exc,
                        TT_GlyphZone    zone,
<span class="line-new-header">--- 1909,18 ---</span>
  
      zone-&gt;tags[point] |= FT_CURVE_TAG_TOUCH_Y;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Special versions of Direct_Move_Orig()</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   The following versions are used whenever both vectors are both</span>
<span class="line-modified">!    *   along one of the coordinate unit vectors, i.e. in 90% of the cases.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    */</span>
  
  
    static void
    Direct_Move_Orig_X( TT_ExecContext  exc,
                        TT_GlyphZone    zone,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1858,33 ***</span>
      FT_UNUSED( exc );
  
      zone-&gt;org[point].y = ADD_LONG( zone-&gt;org[point].y, distance );
    }
  
<span class="line-modified">! </span>
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Round_None                                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Does not round, but adds engine compensation.                      */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    distance     :: The distance (not) to round.                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    compensation :: The engine compensation.                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    The compensated distance.                                          */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Note&gt;                                                                */</span>
<span class="line-removed">-   /*    The TrueType specification says very few about the relationship    */</span>
<span class="line-removed">-   /*    between rounding and engine compensation.  However, it seems from  */</span>
<span class="line-removed">-   /*    the description of super round that we should add the compensation */</span>
<span class="line-removed">-   /*    before rounding.                                                   */</span>
<span class="line-removed">-   /*                                                                       */</span>
    static FT_F26Dot6
    Round_None( TT_ExecContext  exc,
                FT_F26Dot6      distance,
                FT_F26Dot6      compensation )
    {
<span class="line-new-header">--- 1942,28 ---</span>
      FT_UNUSED( exc );
  
      zone-&gt;org[point].y = ADD_LONG( zone-&gt;org[point].y, distance );
    }
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Round_None</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Does not round, but adds engine compensation.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   distance ::</span>
<span class="line-modified">!    *     The distance (not) to round.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   compensation ::</span>
<span class="line-modified">!    *     The engine compensation.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-modified">!    *   The compensated distance.</span>
<span class="line-modified">!    */</span>
    static FT_F26Dot6
    Round_None( TT_ExecContext  exc,
                FT_F26Dot6      distance,
                FT_F26Dot6      compensation )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1907,26 ***</span>
      }
      return val;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Round_To_Grid                                                      */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Rounds value to grid after adding engine compensation.             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    distance     :: The distance to round.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    compensation :: The engine compensation.                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    Rounded distance.                                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_F26Dot6
    Round_To_Grid( TT_ExecContext  exc,
                   FT_F26Dot6      distance,
                   FT_F26Dot6      compensation )
    {
<span class="line-new-header">--- 1986,28 ---</span>
      }
      return val;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Round_To_Grid</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Rounds value to grid after adding engine compensation.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   distance ::</span>
<span class="line-modified">!    *     The distance to round.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   compensation ::</span>
<span class="line-modified">!    *     The engine compensation.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-added">+    *   Rounded distance.</span>
<span class="line-added">+    */</span>
    static FT_F26Dot6
    Round_To_Grid( TT_ExecContext  exc,
                   FT_F26Dot6      distance,
                   FT_F26Dot6      compensation )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1951,26 ***</span>
  
      return val;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Round_To_Half_Grid                                                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Rounds value to half grid after adding engine compensation.        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    distance     :: The distance to round.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    compensation :: The engine compensation.                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    Rounded distance.                                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_F26Dot6
    Round_To_Half_Grid( TT_ExecContext  exc,
                        FT_F26Dot6      distance,
                        FT_F26Dot6      compensation )
    {
<span class="line-new-header">--- 2032,28 ---</span>
  
      return val;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Round_To_Half_Grid</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Rounds value to half grid after adding engine compensation.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   distance ::</span>
<span class="line-modified">!    *     The distance to round.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   compensation ::</span>
<span class="line-modified">!    *     The engine compensation.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-added">+    *   Rounded distance.</span>
<span class="line-added">+    */</span>
    static FT_F26Dot6
    Round_To_Half_Grid( TT_ExecContext  exc,
                        FT_F26Dot6      distance,
                        FT_F26Dot6      compensation )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1997,26 ***</span>
  
      return val;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Round_Down_To_Grid                                                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Rounds value down to grid after adding engine compensation.        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    distance     :: The distance to round.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    compensation :: The engine compensation.                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    Rounded distance.                                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_F26Dot6
    Round_Down_To_Grid( TT_ExecContext  exc,
                        FT_F26Dot6      distance,
                        FT_F26Dot6      compensation )
    {
<span class="line-new-header">--- 2080,28 ---</span>
  
      return val;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Round_Down_To_Grid</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Rounds value down to grid after adding engine compensation.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   distance ::</span>
<span class="line-modified">!    *     The distance to round.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   compensation ::</span>
<span class="line-modified">!    *     The engine compensation.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-added">+    *   Rounded distance.</span>
<span class="line-added">+    */</span>
    static FT_F26Dot6
    Round_Down_To_Grid( TT_ExecContext  exc,
                        FT_F26Dot6      distance,
                        FT_F26Dot6      compensation )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2040,26 ***</span>
  
      return val;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Round_Up_To_Grid                                                   */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Rounds value up to grid after adding engine compensation.          */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    distance     :: The distance to round.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    compensation :: The engine compensation.                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    Rounded distance.                                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_F26Dot6
    Round_Up_To_Grid( TT_ExecContext  exc,
                      FT_F26Dot6      distance,
                      FT_F26Dot6      compensation )
    {
<span class="line-new-header">--- 2125,28 ---</span>
  
      return val;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Round_Up_To_Grid</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Rounds value up to grid after adding engine compensation.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   distance ::</span>
<span class="line-modified">!    *     The distance to round.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   compensation ::</span>
<span class="line-modified">!    *     The engine compensation.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-added">+    *   Rounded distance.</span>
<span class="line-added">+    */</span>
    static FT_F26Dot6
    Round_Up_To_Grid( TT_ExecContext  exc,
                      FT_F26Dot6      distance,
                      FT_F26Dot6      compensation )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2084,26 ***</span>
  
      return val;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Round_To_Double_Grid                                               */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Rounds value to double grid after adding engine compensation.      */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    distance     :: The distance to round.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    compensation :: The engine compensation.                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    Rounded distance.                                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_F26Dot6
    Round_To_Double_Grid( TT_ExecContext  exc,
                          FT_F26Dot6      distance,
                          FT_F26Dot6      compensation )
    {
<span class="line-new-header">--- 2171,28 ---</span>
  
      return val;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Round_To_Double_Grid</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Rounds value to double grid after adding engine compensation.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   distance ::</span>
<span class="line-modified">!    *     The distance to round.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   compensation ::</span>
<span class="line-modified">!    *     The engine compensation.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-added">+    *   Rounded distance.</span>
<span class="line-added">+    */</span>
    static FT_F26Dot6
    Round_To_Double_Grid( TT_ExecContext  exc,
                          FT_F26Dot6      distance,
                          FT_F26Dot6      compensation )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2128,32 ***</span>
  
      return val;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Round_Super                                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Super-rounds value to grid after adding engine compensation.       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    distance     :: The distance to round.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    compensation :: The engine compensation.                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    Rounded distance.                                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Note&gt;                                                                */</span>
<span class="line-modified">!   /*    The TrueType specification says very little about the relationship */</span>
<span class="line-modified">!   /*    between rounding and engine compensation.  However, it seems from  */</span>
<span class="line-modified">!   /*    the description of super round that we should add the compensation */</span>
<span class="line-modified">!   /*    before rounding.                                                   */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_F26Dot6
    Round_Super( TT_ExecContext  exc,
                 FT_F26Dot6      distance,
                 FT_F26Dot6      compensation )
    {
<span class="line-new-header">--- 2217,34 ---</span>
  
      return val;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Round_Super</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Super-rounds value to grid after adding engine compensation.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   distance ::</span>
<span class="line-modified">!    *     The distance to round.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   compensation ::</span>
<span class="line-modified">!    *     The engine compensation.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-modified">!    *   Rounded distance.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Note:</span>
<span class="line-modified">!    *   The TrueType specification says very little about the relationship</span>
<span class="line-modified">!    *   between rounding and engine compensation.  However, it seems from</span>
<span class="line-modified">!    *   the description of super round that we should add the compensation</span>
<span class="line-added">+    *   before rounding.</span>
<span class="line-added">+    */</span>
    static FT_F26Dot6
    Round_Super( TT_ExecContext  exc,
                 FT_F26Dot6      distance,
                 FT_F26Dot6      compensation )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2181,30 ***</span>
  
      return val;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Round_Super_45                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Super-rounds value to grid after adding engine compensation.       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    distance     :: The distance to round.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    compensation :: The engine compensation.                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    Rounded distance.                                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Note&gt;                                                                */</span>
<span class="line-modified">!   /*    There is a separate function for Round_Super_45() as we may need   */</span>
<span class="line-modified">!   /*    greater precision.                                                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_F26Dot6
    Round_Super_45( TT_ExecContext  exc,
                    FT_F26Dot6      distance,
                    FT_F26Dot6      compensation )
    {
<span class="line-new-header">--- 2272,32 ---</span>
  
      return val;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Round_Super_45</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Super-rounds value to grid after adding engine compensation.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   distance ::</span>
<span class="line-modified">!    *     The distance to round.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   compensation ::</span>
<span class="line-modified">!    *     The engine compensation.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-modified">!    *   Rounded distance.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Note:</span>
<span class="line-modified">!    *   There is a separate function for Round_Super_45() as we may need</span>
<span class="line-added">+    *   greater precision.</span>
<span class="line-added">+    */</span>
    static FT_F26Dot6
    Round_Super_45( TT_ExecContext  exc,
                    FT_F26Dot6      distance,
                    FT_F26Dot6      compensation )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2232,21 ***</span>
  
      return val;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Compute_Round                                                      */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Sets the rounding mode.                                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    round_mode :: The rounding mode to be used.                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Compute_Round( TT_ExecContext  exc,
                   FT_Byte         round_mode )
    {
      switch ( round_mode )
<span class="line-new-header">--- 2325,22 ---</span>
  
      return val;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Compute_Round</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Sets the rounding mode.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   round_mode ::</span>
<span class="line-modified">!    *     The rounding mode to be used.</span>
<span class="line-added">+    */</span>
    static void
    Compute_Round( TT_ExecContext  exc,
                   FT_Byte         round_mode )
    {
      switch ( round_mode )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2284,23 ***</span>
        break;
      }
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    SetSuperRound                                                      */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Sets Super Round parameters.                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    GridPeriod :: The grid period.                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    selector   :: The SROUND opcode.                                   */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    SetSuperRound( TT_ExecContext  exc,
                   FT_F2Dot14      GridPeriod,
                   FT_Long         selector )
    {
<span class="line-new-header">--- 2378,25 ---</span>
        break;
      }
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   SetSuperRound</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Sets Super Round parameters.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   GridPeriod ::</span>
<span class="line-modified">!    *     The grid period.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   selector ::</span>
<span class="line-added">+    *     The SROUND opcode.</span>
<span class="line-added">+    */</span>
    static void
    SetSuperRound( TT_ExecContext  exc,
                   FT_F2Dot14      GridPeriod,
                   FT_Long         selector )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2353,26 ***</span>
      exc-&gt;phase     &gt;&gt;= 8;
      exc-&gt;threshold &gt;&gt;= 8;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Project                                                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Computes the projection of vector given by (v2-v1) along the       */</span>
<span class="line-modified">!   /*    current projection vector.                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    v1 :: First input vector.                                          */</span>
<span class="line-modified">!   /*    v2 :: Second input vector.                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    The distance in F26dot6 format.                                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_F26Dot6
    Project( TT_ExecContext  exc,
             FT_Pos          dx,
             FT_Pos          dy )
    {
<span class="line-new-header">--- 2449,28 ---</span>
      exc-&gt;phase     &gt;&gt;= 8;
      exc-&gt;threshold &gt;&gt;= 8;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Project</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Computes the projection of vector given by (v2-v1) along the</span>
<span class="line-modified">!    *   current projection vector.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   v1 ::</span>
<span class="line-modified">!    *     First input vector.</span>
<span class="line-modified">!    *   v2 ::</span>
<span class="line-modified">!    *     Second input vector.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-added">+    *   The distance in F26dot6 format.</span>
<span class="line-added">+    */</span>
    static FT_F26Dot6
    Project( TT_ExecContext  exc,
             FT_Pos          dx,
             FT_Pos          dy )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2380,26 ***</span>
                          exc-&gt;GS.projVector.x,
                          exc-&gt;GS.projVector.y );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Dual_Project                                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Computes the projection of the vector given by (v2-v1) along the   */</span>
<span class="line-modified">!   /*    current dual vector.                                               */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    v1 :: First input vector.                                          */</span>
<span class="line-modified">!   /*    v2 :: Second input vector.                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    The distance in F26dot6 format.                                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_F26Dot6
    Dual_Project( TT_ExecContext  exc,
                  FT_Pos          dx,
                  FT_Pos          dy )
    {
<span class="line-new-header">--- 2478,28 ---</span>
                          exc-&gt;GS.projVector.x,
                          exc-&gt;GS.projVector.y );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Dual_Project</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Computes the projection of the vector given by (v2-v1) along the</span>
<span class="line-modified">!    *   current dual vector.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   v1 ::</span>
<span class="line-modified">!    *     First input vector.</span>
<span class="line-modified">!    *   v2 ::</span>
<span class="line-modified">!    *     Second input vector.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-added">+    *   The distance in F26dot6 format.</span>
<span class="line-added">+    */</span>
    static FT_F26Dot6
    Dual_Project( TT_ExecContext  exc,
                  FT_Pos          dx,
                  FT_Pos          dy )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2407,26 ***</span>
                          exc-&gt;GS.dualVector.x,
                          exc-&gt;GS.dualVector.y );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Project_x                                                          */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Computes the projection of the vector given by (v2-v1) along the   */</span>
<span class="line-modified">!   /*    horizontal axis.                                                   */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    v1 :: First input vector.                                          */</span>
<span class="line-modified">!   /*    v2 :: Second input vector.                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    The distance in F26dot6 format.                                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_F26Dot6
    Project_x( TT_ExecContext  exc,
               FT_Pos          dx,
               FT_Pos          dy )
    {
<span class="line-new-header">--- 2507,28 ---</span>
                          exc-&gt;GS.dualVector.x,
                          exc-&gt;GS.dualVector.y );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Project_x</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Computes the projection of the vector given by (v2-v1) along the</span>
<span class="line-modified">!    *   horizontal axis.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   v1 ::</span>
<span class="line-modified">!    *     First input vector.</span>
<span class="line-modified">!    *   v2 ::</span>
<span class="line-modified">!    *     Second input vector.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-added">+    *   The distance in F26dot6 format.</span>
<span class="line-added">+    */</span>
    static FT_F26Dot6
    Project_x( TT_ExecContext  exc,
               FT_Pos          dx,
               FT_Pos          dy )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2435,26 ***</span>
  
      return dx;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Project_y                                                          */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Computes the projection of the vector given by (v2-v1) along the   */</span>
<span class="line-modified">!   /*    vertical axis.                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    v1 :: First input vector.                                          */</span>
<span class="line-modified">!   /*    v2 :: Second input vector.                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    The distance in F26dot6 format.                                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_F26Dot6
    Project_y( TT_ExecContext  exc,
               FT_Pos          dx,
               FT_Pos          dy )
    {
<span class="line-new-header">--- 2537,28 ---</span>
  
      return dx;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Project_y</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Computes the projection of the vector given by (v2-v1) along the</span>
<span class="line-modified">!    *   vertical axis.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   v1 ::</span>
<span class="line-modified">!    *     First input vector.</span>
<span class="line-modified">!    *   v2 ::</span>
<span class="line-modified">!    *     Second input vector.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-added">+    *   The distance in F26dot6 format.</span>
<span class="line-added">+    */</span>
    static FT_F26Dot6
    Project_y( TT_ExecContext  exc,
               FT_Pos          dx,
               FT_Pos          dy )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2463,19 ***</span>
  
      return dy;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Compute_Funcs                                                      */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Computes the projection and movement function pointers according   */</span>
<span class="line-modified">!   /*    to the current graphics state.                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Compute_Funcs( TT_ExecContext  exc )
    {
      if ( exc-&gt;GS.freeVector.x == 0x4000 )
        exc-&gt;F_dot_P = exc-&gt;GS.projVector.x;
<span class="line-new-header">--- 2567,19 ---</span>
  
      return dy;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Compute_Funcs</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Computes the projection and movement function pointers according</span>
<span class="line-modified">!    *   to the current graphics state.</span>
<span class="line-modified">!    */</span>
    static void
    Compute_Funcs( TT_ExecContext  exc )
    {
      if ( exc-&gt;GS.freeVector.x == 0x4000 )
        exc-&gt;F_dot_P = exc-&gt;GS.projVector.x;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2526,32 ***</span>
      /* Disable cached aspect ratio */
      exc-&gt;tt_metrics.ratio = 0;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    Normalize                                                          */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Norms a vector.                                                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    Vx :: The horizontal input vector coordinate.                      */</span>
<span class="line-modified">!   /*    Vy :: The vertical input vector coordinate.                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Output&gt;                                                              */</span>
<span class="line-modified">!   /*    R  :: The normed unit vector.                                      */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    Returns FAILURE if a vector parameter is zero.                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Note&gt;                                                                */</span>
<span class="line-modified">!   /*    In case Vx and Vy are both zero, `Normalize&#39; returns SUCCESS, and  */</span>
<span class="line-modified">!   /*    R is undefined.                                                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_Bool
    Normalize( FT_F26Dot6      Vx,
               FT_F26Dot6      Vy,
               FT_UnitVector*  R )
    {
<span class="line-new-header">--- 2630,35 ---</span>
      /* Disable cached aspect ratio */
      exc-&gt;tt_metrics.ratio = 0;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   Normalize</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Norms a vector.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   Vx ::</span>
<span class="line-modified">!    *     The horizontal input vector coordinate.</span>
<span class="line-modified">!    *   Vy ::</span>
<span class="line-modified">!    *     The vertical input vector coordinate.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Output:</span>
<span class="line-modified">!    *   R ::</span>
<span class="line-modified">!    *     The normed unit vector.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-modified">!    *   Returns FAILURE if a vector parameter is zero.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Note:</span>
<span class="line-added">+    *   In case Vx and Vy are both zero, `Normalize&#39; returns SUCCESS, and</span>
<span class="line-added">+    *   R is undefined.</span>
<span class="line-added">+    */</span>
    static FT_Bool
    Normalize( FT_F26Dot6      Vx,
               FT_F26Dot6      Vy,
               FT_UnitVector*  R )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2575,45 ***</span>
  
      return SUCCESS;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Here we start with the implementation of the various opcodes.         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*************************************************************************/</span>
  
  
  #define ARRAY_BOUND_ERROR                         \
      do                                            \
      {                                             \
        exc-&gt;error = FT_THROW( Invalid_Reference ); \
        return;                                     \
      } while (0)
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* MPPEM[]:      Measure Pixel Per EM                                    */</span>
<span class="line-modified">!   /* Opcode range: 0x4B                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt; Euint16                                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_MPPEM( TT_ExecContext  exc,
               FT_Long*        args )
    {
      args[0] = exc-&gt;func_cur_ppem( exc );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* MPS[]:        Measure Point Size                                      */</span>
<span class="line-modified">!   /* Opcode range: 0x4C                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt; Euint16                                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_MPS( TT_ExecContext  exc,
             FT_Long*        args )
    {
      if ( NO_SUBPIXEL_HINTING )
<span class="line-new-header">--- 2682,45 ---</span>
  
      return SUCCESS;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Here we start with the implementation of the various opcodes.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    */</span>
  
  
  #define ARRAY_BOUND_ERROR                         \
      do                                            \
      {                                             \
        exc-&gt;error = FT_THROW( Invalid_Reference ); \
        return;                                     \
      } while (0)
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * MPPEM[]:      Measure Pixel Per EM</span>
<span class="line-modified">!    * Opcode range: 0x4B</span>
<span class="line-modified">!    * Stack:        --&gt; Euint16</span>
<span class="line-modified">!    */</span>
    static void
    Ins_MPPEM( TT_ExecContext  exc,
               FT_Long*        args )
    {
      args[0] = exc-&gt;func_cur_ppem( exc );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * MPS[]:        Measure Point Size</span>
<span class="line-modified">!    * Opcode range: 0x4C</span>
<span class="line-modified">!    * Stack:        --&gt; Euint16</span>
<span class="line-modified">!    */</span>
    static void
    Ins_MPS( TT_ExecContext  exc,
             FT_Long*        args )
    {
      if ( NO_SUBPIXEL_HINTING )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2631,55 ***</span>
        args[0] = exc-&gt;pointSize;
      }
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* DUP[]:        DUPlicate the stack&#39;s top element                       */</span>
<span class="line-modified">!   /* Opcode range: 0x20                                                    */</span>
<span class="line-modified">!   /* Stack:        StkElt --&gt; StkElt StkElt                                */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_DUP( FT_Long*  args )
    {
      args[1] = args[0];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* POP[]:        POP the stack&#39;s top element                             */</span>
<span class="line-modified">!   /* Opcode range: 0x21                                                    */</span>
<span class="line-modified">!   /* Stack:        StkElt --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_POP( void )
    {
      /* nothing to do */
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* CLEAR[]:      CLEAR the entire stack                                  */</span>
<span class="line-modified">!   /* Opcode range: 0x22                                                    */</span>
<span class="line-modified">!   /* Stack:        StkElt... --&gt;                                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_CLEAR( TT_ExecContext  exc )
    {
      exc-&gt;new_top = 0;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SWAP[]:       SWAP the stack&#39;s top two elements                       */</span>
<span class="line-modified">!   /* Opcode range: 0x23                                                    */</span>
<span class="line-modified">!   /* Stack:        2 * StkElt --&gt; 2 * StkElt                               */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SWAP( FT_Long*  args )
    {
      FT_Long  L;
  
<span class="line-new-header">--- 2738,55 ---</span>
        args[0] = exc-&gt;pointSize;
      }
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * DUP[]:        DUPlicate the stack&#39;s top element</span>
<span class="line-modified">!    * Opcode range: 0x20</span>
<span class="line-modified">!    * Stack:        StkElt --&gt; StkElt StkElt</span>
<span class="line-modified">!    */</span>
    static void
    Ins_DUP( FT_Long*  args )
    {
      args[1] = args[0];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * POP[]:        POP the stack&#39;s top element</span>
<span class="line-modified">!    * Opcode range: 0x21</span>
<span class="line-modified">!    * Stack:        StkElt --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_POP( void )
    {
      /* nothing to do */
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * CLEAR[]:      CLEAR the entire stack</span>
<span class="line-modified">!    * Opcode range: 0x22</span>
<span class="line-modified">!    * Stack:        StkElt... --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_CLEAR( TT_ExecContext  exc )
    {
      exc-&gt;new_top = 0;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SWAP[]:       SWAP the stack&#39;s top two elements</span>
<span class="line-modified">!    * Opcode range: 0x23</span>
<span class="line-modified">!    * Stack:        2 * StkElt --&gt; 2 * StkElt</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SWAP( FT_Long*  args )
    {
      FT_Long  L;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2688,201 ***</span>
      args[0] = args[1];
      args[1] = L;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* DEPTH[]:      return the stack DEPTH                                  */</span>
<span class="line-modified">!   /* Opcode range: 0x24                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt; uint32                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_DEPTH( TT_ExecContext  exc,
               FT_Long*        args )
    {
      args[0] = exc-&gt;top;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* LT[]:         Less Than                                               */</span>
<span class="line-modified">!   /* Opcode range: 0x50                                                    */</span>
<span class="line-modified">!   /* Stack:        int32? int32? --&gt; bool                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_LT( FT_Long*  args )
    {
      args[0] = ( args[0] &lt; args[1] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* LTEQ[]:       Less Than or EQual                                      */</span>
<span class="line-modified">!   /* Opcode range: 0x51                                                    */</span>
<span class="line-modified">!   /* Stack:        int32? int32? --&gt; bool                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_LTEQ( FT_Long*  args )
    {
      args[0] = ( args[0] &lt;= args[1] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* GT[]:         Greater Than                                            */</span>
<span class="line-modified">!   /* Opcode range: 0x52                                                    */</span>
<span class="line-modified">!   /* Stack:        int32? int32? --&gt; bool                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_GT( FT_Long*  args )
    {
      args[0] = ( args[0] &gt; args[1] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* GTEQ[]:       Greater Than or EQual                                   */</span>
<span class="line-modified">!   /* Opcode range: 0x53                                                    */</span>
<span class="line-modified">!   /* Stack:        int32? int32? --&gt; bool                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_GTEQ( FT_Long*  args )
    {
      args[0] = ( args[0] &gt;= args[1] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* EQ[]:         EQual                                                   */</span>
<span class="line-modified">!   /* Opcode range: 0x54                                                    */</span>
<span class="line-modified">!   /* Stack:        StkElt StkElt --&gt; bool                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_EQ( FT_Long*  args )
    {
      args[0] = ( args[0] == args[1] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* NEQ[]:        Not EQual                                               */</span>
<span class="line-modified">!   /* Opcode range: 0x55                                                    */</span>
<span class="line-modified">!   /* Stack:        StkElt StkElt --&gt; bool                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_NEQ( FT_Long*  args )
    {
      args[0] = ( args[0] != args[1] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* ODD[]:        Is ODD                                                  */</span>
<span class="line-modified">!   /* Opcode range: 0x56                                                    */</span>
<span class="line-modified">!   /* Stack:        f26.6 --&gt; bool                                          */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_ODD( TT_ExecContext  exc,
             FT_Long*        args )
    {
      args[0] = ( ( exc-&gt;func_round( exc, args[0], 0 ) &amp; 127 ) == 64 );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* EVEN[]:       Is EVEN                                                 */</span>
<span class="line-modified">!   /* Opcode range: 0x57                                                    */</span>
<span class="line-modified">!   /* Stack:        f26.6 --&gt; bool                                          */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_EVEN( TT_ExecContext  exc,
              FT_Long*        args )
    {
      args[0] = ( ( exc-&gt;func_round( exc, args[0], 0 ) &amp; 127 ) == 0 );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* AND[]:        logical AND                                             */</span>
<span class="line-modified">!   /* Opcode range: 0x5A                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 uint32 --&gt; uint32                                */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_AND( FT_Long*  args )
    {
      args[0] = ( args[0] &amp;&amp; args[1] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* OR[]:         logical OR                                              */</span>
<span class="line-modified">!   /* Opcode range: 0x5B                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 uint32 --&gt; uint32                                */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_OR( FT_Long*  args )
    {
      args[0] = ( args[0] || args[1] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* NOT[]:        logical NOT                                             */</span>
<span class="line-modified">!   /* Opcode range: 0x5C                                                    */</span>
<span class="line-modified">!   /* Stack:        StkElt --&gt; uint32                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_NOT( FT_Long*  args )
    {
      args[0] = !args[0];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* ADD[]:        ADD                                                     */</span>
<span class="line-modified">!   /* Opcode range: 0x60                                                    */</span>
<span class="line-modified">!   /* Stack:        f26.6 f26.6 --&gt; f26.6                                   */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_ADD( FT_Long*  args )
    {
      args[0] = ADD_LONG( args[0], args[1] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SUB[]:        SUBtract                                                */</span>
<span class="line-modified">!   /* Opcode range: 0x61                                                    */</span>
<span class="line-modified">!   /* Stack:        f26.6 f26.6 --&gt; f26.6                                   */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SUB( FT_Long*  args )
    {
      args[0] = SUB_LONG( args[0], args[1] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* DIV[]:        DIVide                                                  */</span>
<span class="line-modified">!   /* Opcode range: 0x62                                                    */</span>
<span class="line-modified">!   /* Stack:        f26.6 f26.6 --&gt; f26.6                                   */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_DIV( TT_ExecContext  exc,
             FT_Long*        args )
    {
      if ( args[1] == 0 )
<span class="line-new-header">--- 2795,201 ---</span>
      args[0] = args[1];
      args[1] = L;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * DEPTH[]:      return the stack DEPTH</span>
<span class="line-modified">!    * Opcode range: 0x24</span>
<span class="line-modified">!    * Stack:        --&gt; uint32</span>
<span class="line-modified">!    */</span>
    static void
    Ins_DEPTH( TT_ExecContext  exc,
               FT_Long*        args )
    {
      args[0] = exc-&gt;top;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * LT[]:         Less Than</span>
<span class="line-modified">!    * Opcode range: 0x50</span>
<span class="line-modified">!    * Stack:        int32? int32? --&gt; bool</span>
<span class="line-modified">!    */</span>
    static void
    Ins_LT( FT_Long*  args )
    {
      args[0] = ( args[0] &lt; args[1] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * LTEQ[]:       Less Than or EQual</span>
<span class="line-modified">!    * Opcode range: 0x51</span>
<span class="line-modified">!    * Stack:        int32? int32? --&gt; bool</span>
<span class="line-modified">!    */</span>
    static void
    Ins_LTEQ( FT_Long*  args )
    {
      args[0] = ( args[0] &lt;= args[1] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * GT[]:         Greater Than</span>
<span class="line-modified">!    * Opcode range: 0x52</span>
<span class="line-modified">!    * Stack:        int32? int32? --&gt; bool</span>
<span class="line-modified">!    */</span>
    static void
    Ins_GT( FT_Long*  args )
    {
      args[0] = ( args[0] &gt; args[1] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * GTEQ[]:       Greater Than or EQual</span>
<span class="line-modified">!    * Opcode range: 0x53</span>
<span class="line-modified">!    * Stack:        int32? int32? --&gt; bool</span>
<span class="line-modified">!    */</span>
    static void
    Ins_GTEQ( FT_Long*  args )
    {
      args[0] = ( args[0] &gt;= args[1] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * EQ[]:         EQual</span>
<span class="line-modified">!    * Opcode range: 0x54</span>
<span class="line-modified">!    * Stack:        StkElt StkElt --&gt; bool</span>
<span class="line-modified">!    */</span>
    static void
    Ins_EQ( FT_Long*  args )
    {
      args[0] = ( args[0] == args[1] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * NEQ[]:        Not EQual</span>
<span class="line-modified">!    * Opcode range: 0x55</span>
<span class="line-modified">!    * Stack:        StkElt StkElt --&gt; bool</span>
<span class="line-modified">!    */</span>
    static void
    Ins_NEQ( FT_Long*  args )
    {
      args[0] = ( args[0] != args[1] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * ODD[]:        Is ODD</span>
<span class="line-modified">!    * Opcode range: 0x56</span>
<span class="line-modified">!    * Stack:        f26.6 --&gt; bool</span>
<span class="line-modified">!    */</span>
    static void
    Ins_ODD( TT_ExecContext  exc,
             FT_Long*        args )
    {
      args[0] = ( ( exc-&gt;func_round( exc, args[0], 0 ) &amp; 127 ) == 64 );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * EVEN[]:       Is EVEN</span>
<span class="line-modified">!    * Opcode range: 0x57</span>
<span class="line-modified">!    * Stack:        f26.6 --&gt; bool</span>
<span class="line-modified">!    */</span>
    static void
    Ins_EVEN( TT_ExecContext  exc,
              FT_Long*        args )
    {
      args[0] = ( ( exc-&gt;func_round( exc, args[0], 0 ) &amp; 127 ) == 0 );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * AND[]:        logical AND</span>
<span class="line-modified">!    * Opcode range: 0x5A</span>
<span class="line-modified">!    * Stack:        uint32 uint32 --&gt; uint32</span>
<span class="line-modified">!    */</span>
    static void
    Ins_AND( FT_Long*  args )
    {
      args[0] = ( args[0] &amp;&amp; args[1] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * OR[]:         logical OR</span>
<span class="line-modified">!    * Opcode range: 0x5B</span>
<span class="line-modified">!    * Stack:        uint32 uint32 --&gt; uint32</span>
<span class="line-modified">!    */</span>
    static void
    Ins_OR( FT_Long*  args )
    {
      args[0] = ( args[0] || args[1] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * NOT[]:        logical NOT</span>
<span class="line-modified">!    * Opcode range: 0x5C</span>
<span class="line-modified">!    * Stack:        StkElt --&gt; uint32</span>
<span class="line-modified">!    */</span>
    static void
    Ins_NOT( FT_Long*  args )
    {
      args[0] = !args[0];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * ADD[]:        ADD</span>
<span class="line-modified">!    * Opcode range: 0x60</span>
<span class="line-modified">!    * Stack:        f26.6 f26.6 --&gt; f26.6</span>
<span class="line-modified">!    */</span>
    static void
    Ins_ADD( FT_Long*  args )
    {
      args[0] = ADD_LONG( args[0], args[1] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SUB[]:        SUBtract</span>
<span class="line-modified">!    * Opcode range: 0x61</span>
<span class="line-modified">!    * Stack:        f26.6 f26.6 --&gt; f26.6</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SUB( FT_Long*  args )
    {
      args[0] = SUB_LONG( args[0], args[1] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * DIV[]:        DIVide</span>
<span class="line-modified">!    * Opcode range: 0x62</span>
<span class="line-modified">!    * Stack:        f26.6 f26.6 --&gt; f26.6</span>
<span class="line-modified">!    */</span>
    static void
    Ins_DIV( TT_ExecContext  exc,
             FT_Long*        args )
    {
      if ( args[1] == 0 )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2890,82 ***</span>
      else
        args[0] = FT_MulDiv_No_Round( args[0], 64L, args[1] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* MUL[]:        MULtiply                                                */</span>
<span class="line-modified">!   /* Opcode range: 0x63                                                    */</span>
<span class="line-modified">!   /* Stack:        f26.6 f26.6 --&gt; f26.6                                   */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_MUL( FT_Long*  args )
    {
      args[0] = FT_MulDiv( args[0], args[1], 64L );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* ABS[]:        ABSolute value                                          */</span>
<span class="line-modified">!   /* Opcode range: 0x64                                                    */</span>
<span class="line-modified">!   /* Stack:        f26.6 --&gt; f26.6                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_ABS( FT_Long*  args )
    {
      if ( args[0] &lt; 0 )
        args[0] = NEG_LONG( args[0] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* NEG[]:        NEGate                                                  */</span>
<span class="line-modified">!   /* Opcode range: 0x65                                                    */</span>
<span class="line-modified">!   /* Stack:        f26.6 --&gt; f26.6                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_NEG( FT_Long*  args )
    {
      args[0] = NEG_LONG( args[0] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* FLOOR[]:      FLOOR                                                   */</span>
<span class="line-modified">!   /* Opcode range: 0x66                                                    */</span>
<span class="line-modified">!   /* Stack:        f26.6 --&gt; f26.6                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_FLOOR( FT_Long*  args )
    {
      args[0] = FT_PIX_FLOOR( args[0] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* CEILING[]:    CEILING                                                 */</span>
<span class="line-modified">!   /* Opcode range: 0x67                                                    */</span>
<span class="line-modified">!   /* Stack:        f26.6 --&gt; f26.6                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_CEILING( FT_Long*  args )
    {
      args[0] = FT_PIX_CEIL_LONG( args[0] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* RS[]:         Read Store                                              */</span>
<span class="line-modified">!   /* Opcode range: 0x43                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt; uint32                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_RS( TT_ExecContext  exc,
            FT_Long*        args )
    {
      FT_ULong  I = (FT_ULong)args[0];
<span class="line-new-header">--- 2997,82 ---</span>
      else
        args[0] = FT_MulDiv_No_Round( args[0], 64L, args[1] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * MUL[]:        MULtiply</span>
<span class="line-modified">!    * Opcode range: 0x63</span>
<span class="line-modified">!    * Stack:        f26.6 f26.6 --&gt; f26.6</span>
<span class="line-modified">!    */</span>
    static void
    Ins_MUL( FT_Long*  args )
    {
      args[0] = FT_MulDiv( args[0], args[1], 64L );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * ABS[]:        ABSolute value</span>
<span class="line-modified">!    * Opcode range: 0x64</span>
<span class="line-modified">!    * Stack:        f26.6 --&gt; f26.6</span>
<span class="line-modified">!    */</span>
    static void
    Ins_ABS( FT_Long*  args )
    {
      if ( args[0] &lt; 0 )
        args[0] = NEG_LONG( args[0] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * NEG[]:        NEGate</span>
<span class="line-modified">!    * Opcode range: 0x65</span>
<span class="line-modified">!    * Stack:        f26.6 --&gt; f26.6</span>
<span class="line-modified">!    */</span>
    static void
    Ins_NEG( FT_Long*  args )
    {
      args[0] = NEG_LONG( args[0] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * FLOOR[]:      FLOOR</span>
<span class="line-modified">!    * Opcode range: 0x66</span>
<span class="line-modified">!    * Stack:        f26.6 --&gt; f26.6</span>
<span class="line-modified">!    */</span>
    static void
    Ins_FLOOR( FT_Long*  args )
    {
      args[0] = FT_PIX_FLOOR( args[0] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * CEILING[]:    CEILING</span>
<span class="line-modified">!    * Opcode range: 0x67</span>
<span class="line-modified">!    * Stack:        f26.6 --&gt; f26.6</span>
<span class="line-modified">!    */</span>
    static void
    Ins_CEILING( FT_Long*  args )
    {
      args[0] = FT_PIX_CEIL_LONG( args[0] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * RS[]:         Read Store</span>
<span class="line-modified">!    * Opcode range: 0x43</span>
<span class="line-modified">!    * Stack:        uint32 --&gt; uint32</span>
<span class="line-modified">!    */</span>
    static void
    Ins_RS( TT_ExecContext  exc,
            FT_Long*        args )
    {
      FT_ULong  I = (FT_ULong)args[0];
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3002,16 ***</span>
          args[0] = exc-&gt;storage[I];
      }
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* WS[]:         Write Store                                             */</span>
<span class="line-modified">!   /* Opcode range: 0x42                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 uint32 --&gt;                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_WS( TT_ExecContext  exc,
            FT_Long*        args )
    {
      FT_ULong  I = (FT_ULong)args[0];
<span class="line-new-header">--- 3109,16 ---</span>
          args[0] = exc-&gt;storage[I];
      }
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * WS[]:         Write Store</span>
<span class="line-modified">!    * Opcode range: 0x42</span>
<span class="line-modified">!    * Stack:        uint32 uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_WS( TT_ExecContext  exc,
            FT_Long*        args )
    {
      FT_ULong  I = (FT_ULong)args[0];
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3025,16 ***</span>
      else
        exc-&gt;storage[I] = args[1];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* WCVTP[]:      Write CVT in Pixel units                                */</span>
<span class="line-modified">!   /* Opcode range: 0x44                                                    */</span>
<span class="line-modified">!   /* Stack:        f26.6 uint32 --&gt;                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_WCVTP( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_ULong  I = (FT_ULong)args[0];
<span class="line-new-header">--- 3132,16 ---</span>
      else
        exc-&gt;storage[I] = args[1];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * WCVTP[]:      Write CVT in Pixel units</span>
<span class="line-modified">!    * Opcode range: 0x44</span>
<span class="line-modified">!    * Stack:        f26.6 uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_WCVTP( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_ULong  I = (FT_ULong)args[0];
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3048,16 ***</span>
      else
        exc-&gt;func_write_cvt( exc, I, args[1] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* WCVTF[]:      Write CVT in Funits                                     */</span>
<span class="line-modified">!   /* Opcode range: 0x70                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 uint32 --&gt;                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_WCVTF( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_ULong  I = (FT_ULong)args[0];
<span class="line-new-header">--- 3155,16 ---</span>
      else
        exc-&gt;func_write_cvt( exc, I, args[1] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * WCVTF[]:      Write CVT in Funits</span>
<span class="line-modified">!    * Opcode range: 0x70</span>
<span class="line-modified">!    * Stack:        uint32 uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_WCVTF( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_ULong  I = (FT_ULong)args[0];
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3071,16 ***</span>
      else
        exc-&gt;cvt[I] = FT_MulFix( args[1], exc-&gt;tt_metrics.scale );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* RCVT[]:       Read CVT                                                */</span>
<span class="line-modified">!   /* Opcode range: 0x45                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt; f26.6                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_RCVT( TT_ExecContext  exc,
              FT_Long*        args )
    {
      FT_ULong  I = (FT_ULong)args[0];
<span class="line-new-header">--- 3178,16 ---</span>
      else
        exc-&gt;cvt[I] = FT_MulFix( args[1], exc-&gt;tt_metrics.scale );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * RCVT[]:       Read CVT</span>
<span class="line-modified">!    * Opcode range: 0x45</span>
<span class="line-modified">!    * Stack:        uint32 --&gt; f26.6</span>
<span class="line-modified">!    */</span>
    static void
    Ins_RCVT( TT_ExecContext  exc,
              FT_Long*        args )
    {
      FT_ULong  I = (FT_ULong)args[0];
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3096,44 ***</span>
      else
        args[0] = exc-&gt;func_read_cvt( exc, I );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* AA[]:         Adjust Angle                                            */</span>
<span class="line-modified">!   /* Opcode range: 0x7F                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_AA( void )
    {
      /* intentionally no longer supported */
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* DEBUG[]:      DEBUG.  Unsupported.                                    */</span>
<span class="line-modified">!   /* Opcode range: 0x4F                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Note: The original instruction pops a value from the stack.           */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_DEBUG( TT_ExecContext  exc )
    {
      exc-&gt;error = FT_THROW( Debug_OpCode );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* ROUND[ab]:    ROUND value                                             */</span>
<span class="line-modified">!   /* Opcode range: 0x68-0x6B                                               */</span>
<span class="line-modified">!   /* Stack:        f26.6 --&gt; f26.6                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_ROUND( TT_ExecContext  exc,
               FT_Long*        args )
    {
      args[0] = exc-&gt;func_round(
<span class="line-new-header">--- 3203,44 ---</span>
      else
        args[0] = exc-&gt;func_read_cvt( exc, I );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * AA[]:         Adjust Angle</span>
<span class="line-modified">!    * Opcode range: 0x7F</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_AA( void )
    {
      /* intentionally no longer supported */
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * DEBUG[]:      DEBUG.  Unsupported.</span>
<span class="line-modified">!    * Opcode range: 0x4F</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Note: The original instruction pops a value from the stack.</span>
<span class="line-modified">!    */</span>
    static void
    Ins_DEBUG( TT_ExecContext  exc )
    {
      exc-&gt;error = FT_THROW( Debug_OpCode );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * ROUND[ab]:    ROUND value</span>
<span class="line-modified">!    * Opcode range: 0x68-0x6B</span>
<span class="line-modified">!    * Stack:        f26.6 --&gt; f26.6</span>
<span class="line-modified">!    */</span>
    static void
    Ins_ROUND( TT_ExecContext  exc,
               FT_Long*        args )
    {
      args[0] = exc-&gt;func_round(
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3141,16 ***</span>
                  args[0],
                  exc-&gt;tt_metrics.compensations[exc-&gt;opcode - 0x68] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* NROUND[ab]:   No ROUNDing of value                                    */</span>
<span class="line-modified">!   /* Opcode range: 0x6C-0x6F                                               */</span>
<span class="line-modified">!   /* Stack:        f26.6 --&gt; f26.6                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_NROUND( TT_ExecContext  exc,
                FT_Long*        args )
    {
      args[0] = Round_None(
<span class="line-new-header">--- 3248,16 ---</span>
                  args[0],
                  exc-&gt;tt_metrics.compensations[exc-&gt;opcode - 0x68] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * NROUND[ab]:   No ROUNDing of value</span>
<span class="line-modified">!    * Opcode range: 0x6C-0x6F</span>
<span class="line-modified">!    * Stack:        f26.6 --&gt; f26.6</span>
<span class="line-modified">!    */</span>
    static void
    Ins_NROUND( TT_ExecContext  exc,
                FT_Long*        args )
    {
      args[0] = Round_None(
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3158,44 ***</span>
                  args[0],
                  exc-&gt;tt_metrics.compensations[exc-&gt;opcode - 0x6C] );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* MAX[]:        MAXimum                                                 */</span>
<span class="line-modified">!   /* Opcode range: 0x8B                                                    */</span>
<span class="line-modified">!   /* Stack:        int32? int32? --&gt; int32                                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_MAX( FT_Long*  args )
    {
      if ( args[1] &gt; args[0] )
        args[0] = args[1];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* MIN[]:        MINimum                                                 */</span>
<span class="line-modified">!   /* Opcode range: 0x8C                                                    */</span>
<span class="line-modified">!   /* Stack:        int32? int32? --&gt; int32                                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_MIN( FT_Long*  args )
    {
      if ( args[1] &lt; args[0] )
        args[0] = args[1];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* MINDEX[]:     Move INDEXed element                                    */</span>
<span class="line-modified">!   /* Opcode range: 0x26                                                    */</span>
<span class="line-modified">!   /* Stack:        int32? --&gt; StkElt                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_MINDEX( TT_ExecContext  exc,
                FT_Long*        args )
    {
      FT_Long  L, K;
<span class="line-new-header">--- 3265,44 ---</span>
                  args[0],
                  exc-&gt;tt_metrics.compensations[exc-&gt;opcode - 0x6C] );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * MAX[]:        MAXimum</span>
<span class="line-modified">!    * Opcode range: 0x8B</span>
<span class="line-modified">!    * Stack:        int32? int32? --&gt; int32</span>
<span class="line-modified">!    */</span>
    static void
    Ins_MAX( FT_Long*  args )
    {
      if ( args[1] &gt; args[0] )
        args[0] = args[1];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * MIN[]:        MINimum</span>
<span class="line-modified">!    * Opcode range: 0x8C</span>
<span class="line-modified">!    * Stack:        int32? int32? --&gt; int32</span>
<span class="line-modified">!    */</span>
    static void
    Ins_MIN( FT_Long*  args )
    {
      if ( args[1] &lt; args[0] )
        args[0] = args[1];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * MINDEX[]:     Move INDEXed element</span>
<span class="line-modified">!    * Opcode range: 0x26</span>
<span class="line-modified">!    * Stack:        int32? --&gt; StkElt</span>
<span class="line-modified">!    */</span>
    static void
    Ins_MINDEX( TT_ExecContext  exc,
                FT_Long*        args )
    {
      FT_Long  L, K;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3219,16 ***</span>
        exc-&gt;stack[exc-&gt;args - 1] = K;
      }
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* CINDEX[]:     Copy INDEXed element                                    */</span>
<span class="line-modified">!   /* Opcode range: 0x25                                                    */</span>
<span class="line-modified">!   /* Stack:        int32 --&gt; StkElt                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_CINDEX( TT_ExecContext  exc,
                FT_Long*        args )
    {
      FT_Long  L;
<span class="line-new-header">--- 3326,16 ---</span>
        exc-&gt;stack[exc-&gt;args - 1] = K;
      }
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * CINDEX[]:     Copy INDEXed element</span>
<span class="line-modified">!    * Opcode range: 0x25</span>
<span class="line-modified">!    * Stack:        int32 --&gt; StkElt</span>
<span class="line-modified">!    */</span>
    static void
    Ins_CINDEX( TT_ExecContext  exc,
                FT_Long*        args )
    {
      FT_Long  L;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3245,16 ***</span>
      else
        args[0] = exc-&gt;stack[exc-&gt;args - L];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* ROLL[]:       ROLL top three elements                                 */</span>
<span class="line-modified">!   /* Opcode range: 0x8A                                                    */</span>
<span class="line-modified">!   /* Stack:        3 * StkElt --&gt; 3 * StkElt                               */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_ROLL( FT_Long*  args )
    {
      FT_Long  A, B, C;
  
<span class="line-new-header">--- 3352,16 ---</span>
      else
        args[0] = exc-&gt;stack[exc-&gt;args - L];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * ROLL[]:       ROLL top three elements</span>
<span class="line-modified">!    * Opcode range: 0x8A</span>
<span class="line-modified">!    * Stack:        3 * StkElt --&gt; 3 * StkElt</span>
<span class="line-modified">!    */</span>
    static void
    Ins_ROLL( FT_Long*  args )
    {
      FT_Long  A, B, C;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3267,23 ***</span>
      args[1] = A;
      args[0] = B;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* MANAGING THE FLOW OF CONTROL                                          */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*************************************************************************/</span>
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SLOOP[]:      Set LOOP variable                                       */</span>
<span class="line-modified">!   /* Opcode range: 0x17                                                    */</span>
<span class="line-modified">!   /* Stack:        int32? --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SLOOP( TT_ExecContext  exc,
               FT_Long*        args )
    {
      if ( args[0] &lt; 0 )
<span class="line-new-header">--- 3374,23 ---</span>
      args[1] = A;
      args[0] = B;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * MANAGING THE FLOW OF CONTROL</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    */</span>
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SLOOP[]:      Set LOOP variable</span>
<span class="line-modified">!    * Opcode range: 0x17</span>
<span class="line-modified">!    * Stack:        int32? --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SLOOP( TT_ExecContext  exc,
               FT_Long*        args )
    {
      if ( args[0] &lt; 0 )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3321,16 ***</span>
      exc-&gt;error = FT_THROW( Code_Overflow );
      return FAILURE;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* IF[]:         IF test                                                 */</span>
<span class="line-modified">!   /* Opcode range: 0x58                                                    */</span>
<span class="line-modified">!   /* Stack:        StkElt --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_IF( TT_ExecContext  exc,
            FT_Long*        args )
    {
      FT_Int   nIfs;
<span class="line-new-header">--- 3428,16 ---</span>
      exc-&gt;error = FT_THROW( Code_Overflow );
      return FAILURE;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * IF[]:         IF test</span>
<span class="line-modified">!    * Opcode range: 0x58</span>
<span class="line-modified">!    * Stack:        StkElt --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_IF( TT_ExecContext  exc,
            FT_Long*        args )
    {
      FT_Int   nIfs;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3365,16 ***</span>
        }
      } while ( Out == 0 );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* ELSE[]:       ELSE                                                    */</span>
<span class="line-modified">!   /* Opcode range: 0x1B                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt;                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_ELSE( TT_ExecContext  exc )
    {
      FT_Int  nIfs;
  
<span class="line-new-header">--- 3472,16 ---</span>
        }
      } while ( Out == 0 );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * ELSE[]:       ELSE</span>
<span class="line-modified">!    * Opcode range: 0x1B</span>
<span class="line-modified">!    * Stack:        --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_ELSE( TT_ExecContext  exc )
    {
      FT_Int  nIfs;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3398,29 ***</span>
        }
      } while ( nIfs != 0 );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* EIF[]:        End IF                                                  */</span>
<span class="line-modified">!   /* Opcode range: 0x59                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt;                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_EIF( void )
    {
      /* nothing to do */
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* JMPR[]:       JuMP Relative                                           */</span>
<span class="line-modified">!   /* Opcode range: 0x1C                                                    */</span>
<span class="line-modified">!   /* Stack:        int32 --&gt;                                               */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_JMPR( TT_ExecContext  exc,
              FT_Long*        args )
    {
      if ( args[0] == 0 &amp;&amp; exc-&gt;args == 0 )
<span class="line-new-header">--- 3505,29 ---</span>
        }
      } while ( nIfs != 0 );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * EIF[]:        End IF</span>
<span class="line-modified">!    * Opcode range: 0x59</span>
<span class="line-modified">!    * Stack:        --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_EIF( void )
    {
      /* nothing to do */
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * JMPR[]:       JuMP Relative</span>
<span class="line-modified">!    * Opcode range: 0x1C</span>
<span class="line-modified">!    * Stack:        int32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_JMPR( TT_ExecContext  exc,
              FT_Long*        args )
    {
      if ( args[0] == 0 &amp;&amp; exc-&gt;args == 0 )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3446,53 ***</span>
          exc-&gt;error = FT_THROW( Execution_Too_Long );
      }
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* JROT[]:       Jump Relative On True                                   */</span>
<span class="line-modified">!   /* Opcode range: 0x78                                                    */</span>
<span class="line-modified">!   /* Stack:        StkElt int32 --&gt;                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_JROT( TT_ExecContext  exc,
              FT_Long*        args )
    {
      if ( args[1] != 0 )
        Ins_JMPR( exc, args );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* JROF[]:       Jump Relative On False                                  */</span>
<span class="line-modified">!   /* Opcode range: 0x79                                                    */</span>
<span class="line-modified">!   /* Stack:        StkElt int32 --&gt;                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_JROF( TT_ExecContext  exc,
              FT_Long*        args )
    {
      if ( args[1] == 0 )
        Ins_JMPR( exc, args );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* DEFINING AND USING FUNCTIONS AND INSTRUCTIONS                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*************************************************************************/</span>
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* FDEF[]:       Function DEFinition                                     */</span>
<span class="line-modified">!   /* Opcode range: 0x2C                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_FDEF( TT_ExecContext  exc,
              FT_Long*        args )
    {
      FT_ULong       n;
<span class="line-new-header">--- 3553,53 ---</span>
          exc-&gt;error = FT_THROW( Execution_Too_Long );
      }
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * JROT[]:       Jump Relative On True</span>
<span class="line-modified">!    * Opcode range: 0x78</span>
<span class="line-modified">!    * Stack:        StkElt int32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_JROT( TT_ExecContext  exc,
              FT_Long*        args )
    {
      if ( args[1] != 0 )
        Ins_JMPR( exc, args );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * JROF[]:       Jump Relative On False</span>
<span class="line-modified">!    * Opcode range: 0x79</span>
<span class="line-modified">!    * Stack:        StkElt int32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_JROF( TT_ExecContext  exc,
              FT_Long*        args )
    {
      if ( args[1] == 0 )
        Ins_JMPR( exc, args );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * DEFINING AND USING FUNCTIONS AND INSTRUCTIONS</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    */</span>
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * FDEF[]:       Function DEFinition</span>
<span class="line-modified">!    * Opcode range: 0x2C</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_FDEF( TT_ExecContext  exc,
              FT_Long*        args )
    {
      FT_ULong       n;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3786,16 ***</span>
        }
      }
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* ENDF[]:       END Function definition                                 */</span>
<span class="line-modified">!   /* Opcode range: 0x2D                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt;                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_ENDF( TT_ExecContext  exc )
    {
      TT_CallRec*  pRec;
  
<span class="line-new-header">--- 3893,16 ---</span>
        }
      }
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * ENDF[]:       END Function definition</span>
<span class="line-modified">!    * Opcode range: 0x2D</span>
<span class="line-modified">!    * Stack:        --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_ENDF( TT_ExecContext  exc )
    {
      TT_CallRec*  pRec;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3835,16 ***</span>
      /*       valid address, and it is why we do not test */
      /*       the result of Ins_Goto_CodeRange() here!    */
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* CALL[]:       CALL function                                           */</span>
<span class="line-modified">!   /* Opcode range: 0x2B                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32? --&gt;                                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_CALL( TT_ExecContext  exc,
              FT_Long*        args )
    {
      FT_ULong       F;
<span class="line-new-header">--- 3942,16 ---</span>
      /*       valid address, and it is why we do not test */
      /*       the result of Ins_Goto_CodeRange() here!    */
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * CALL[]:       CALL function</span>
<span class="line-modified">!    * Opcode range: 0x2B</span>
<span class="line-modified">!    * Stack:        uint32? --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_CALL( TT_ExecContext  exc,
              FT_Long*        args )
    {
      FT_ULong       F;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3924,16 ***</span>
    Fail:
      exc-&gt;error = FT_THROW( Invalid_Reference );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* LOOPCALL[]:   LOOP and CALL function                                  */</span>
<span class="line-modified">!   /* Opcode range: 0x2A                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32? Eint16? --&gt;                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_LOOPCALL( TT_ExecContext  exc,
                  FT_Long*        args )
    {
      FT_ULong       F;
<span class="line-new-header">--- 4031,16 ---</span>
    Fail:
      exc-&gt;error = FT_THROW( Invalid_Reference );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * LOOPCALL[]:   LOOP and CALL function</span>
<span class="line-modified">!    * Opcode range: 0x2A</span>
<span class="line-modified">!    * Stack:        uint32? Eint16? --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_LOOPCALL( TT_ExecContext  exc,
                  FT_Long*        args )
    {
      FT_ULong       F;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4017,16 ***</span>
    Fail:
      exc-&gt;error = FT_THROW( Invalid_Reference );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* IDEF[]:       Instruction DEFinition                                  */</span>
<span class="line-modified">!   /* Opcode range: 0x89                                                    */</span>
<span class="line-modified">!   /* Stack:        Eint8 --&gt;                                               */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_IDEF( TT_ExecContext  exc,
              FT_Long*        args )
    {
      TT_DefRecord*  def;
<span class="line-new-header">--- 4124,16 ---</span>
    Fail:
      exc-&gt;error = FT_THROW( Invalid_Reference );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * IDEF[]:       Instruction DEFinition</span>
<span class="line-modified">!    * Opcode range: 0x89</span>
<span class="line-modified">!    * Stack:        Eint8 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_IDEF( TT_ExecContext  exc,
              FT_Long*        args )
    {
      TT_DefRecord*  def;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4092,23 ***</span>
        }
      }
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* PUSHING DATA ONTO THE INTERPRETER STACK                               */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*************************************************************************/</span>
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* NPUSHB[]:     PUSH N Bytes                                            */</span>
<span class="line-modified">!   /* Opcode range: 0x40                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt; uint32...                                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_NPUSHB( TT_ExecContext  exc,
                FT_Long*        args )
    {
      FT_UShort  L, K;
<span class="line-new-header">--- 4199,23 ---</span>
        }
      }
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * PUSHING DATA ONTO THE INTERPRETER STACK</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    */</span>
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * NPUSHB[]:     PUSH N Bytes</span>
<span class="line-modified">!    * Opcode range: 0x40</span>
<span class="line-modified">!    * Stack:        --&gt; uint32...</span>
<span class="line-modified">!    */</span>
    static void
    Ins_NPUSHB( TT_ExecContext  exc,
                FT_Long*        args )
    {
      FT_UShort  L, K;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4127,16 ***</span>
  
      exc-&gt;new_top += L;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* NPUSHW[]:     PUSH N Words                                            */</span>
<span class="line-modified">!   /* Opcode range: 0x41                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt; int32...                                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_NPUSHW( TT_ExecContext  exc,
                FT_Long*        args )
    {
      FT_UShort  L, K;
<span class="line-new-header">--- 4234,16 ---</span>
  
      exc-&gt;new_top += L;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * NPUSHW[]:     PUSH N Words</span>
<span class="line-modified">!    * Opcode range: 0x41</span>
<span class="line-modified">!    * Stack:        --&gt; int32...</span>
<span class="line-modified">!    */</span>
    static void
    Ins_NPUSHW( TT_ExecContext  exc,
                FT_Long*        args )
    {
      FT_UShort  L, K;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4158,16 ***</span>
      exc-&gt;step_ins = FALSE;
      exc-&gt;new_top += L;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* PUSHB[abc]:   PUSH Bytes                                              */</span>
<span class="line-modified">!   /* Opcode range: 0xB0-0xB7                                               */</span>
<span class="line-modified">!   /* Stack:        --&gt; uint32...                                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_PUSHB( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_UShort  L, K;
<span class="line-new-header">--- 4265,16 ---</span>
      exc-&gt;step_ins = FALSE;
      exc-&gt;new_top += L;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * PUSHB[abc]:   PUSH Bytes</span>
<span class="line-modified">!    * Opcode range: 0xB0-0xB7</span>
<span class="line-modified">!    * Stack:        --&gt; uint32...</span>
<span class="line-modified">!    */</span>
    static void
    Ins_PUSHB( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_UShort  L, K;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4184,16 ***</span>
      for ( K = 1; K &lt;= L; K++ )
        args[K - 1] = exc-&gt;code[exc-&gt;IP + K];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* PUSHW[abc]:   PUSH Words                                              */</span>
<span class="line-modified">!   /* Opcode range: 0xB8-0xBF                                               */</span>
<span class="line-modified">!   /* Stack:        --&gt; int32...                                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_PUSHW( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_UShort  L, K;
<span class="line-new-header">--- 4291,16 ---</span>
      for ( K = 1; K &lt;= L; K++ )
        args[K - 1] = exc-&gt;code[exc-&gt;IP + K];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * PUSHW[abc]:   PUSH Words</span>
<span class="line-modified">!    * Opcode range: 0xB8-0xBF</span>
<span class="line-modified">!    * Stack:        --&gt; int32...</span>
<span class="line-modified">!    */</span>
    static void
    Ins_PUSHW( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_UShort  L, K;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4214,15 ***</span>
  
      exc-&gt;step_ins = FALSE;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* MANAGING THE GRAPHICS STATE                                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*************************************************************************/</span>
  
  
    static FT_Bool
    Ins_SxVTL( TT_ExecContext  exc,
               FT_UShort       aIdx1,
<span class="line-new-header">--- 4321,15 ---</span>
  
      exc-&gt;step_ins = FALSE;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * MANAGING THE GRAPHICS STATE</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    */</span>
  
  
    static FT_Bool
    Ins_SxVTL( TT_ExecContext  exc,
               FT_UShort       aIdx1,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4272,24 ***</span>
  
      return SUCCESS;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SVTCA[a]:     Set (F and P) Vectors to Coordinate Axis                */</span>
<span class="line-modified">!   /* Opcode range: 0x00-0x01                                               */</span>
<span class="line-modified">!   /* Stack:        --&gt;                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SPvTCA[a]:    Set PVector to Coordinate Axis                          */</span>
<span class="line-modified">!   /* Opcode range: 0x02-0x03                                               */</span>
<span class="line-modified">!   /* Stack:        --&gt;                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SFvTCA[a]:    Set FVector to Coordinate Axis                          */</span>
<span class="line-modified">!   /* Opcode range: 0x04-0x05                                               */</span>
<span class="line-modified">!   /* Stack:        --&gt;                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SxyTCA( TT_ExecContext  exc )
    {
      FT_Short  AA, BB;
  
<span class="line-new-header">--- 4379,24 ---</span>
  
      return SUCCESS;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SVTCA[a]:     Set (F and P) Vectors to Coordinate Axis</span>
<span class="line-modified">!    * Opcode range: 0x00-0x01</span>
<span class="line-modified">!    * Stack:        --&gt;</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SPvTCA[a]:    Set PVector to Coordinate Axis</span>
<span class="line-modified">!    * Opcode range: 0x02-0x03</span>
<span class="line-modified">!    * Stack:        --&gt;</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SFvTCA[a]:    Set FVector to Coordinate Axis</span>
<span class="line-modified">!    * Opcode range: 0x04-0x05</span>
<span class="line-modified">!    * Stack:        --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SxyTCA( TT_ExecContext  exc )
    {
      FT_Short  AA, BB;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4316,16 ***</span>
  
      Compute_Funcs( exc );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SPvTL[a]:     Set PVector To Line                                     */</span>
<span class="line-modified">!   /* Opcode range: 0x06-0x07                                               */</span>
<span class="line-modified">!   /* Stack:        uint32 uint32 --&gt;                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SPVTL( TT_ExecContext  exc,
               FT_Long*        args )
    {
      if ( Ins_SxVTL( exc,
<span class="line-new-header">--- 4423,16 ---</span>
  
      Compute_Funcs( exc );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SPvTL[a]:     Set PVector To Line</span>
<span class="line-modified">!    * Opcode range: 0x06-0x07</span>
<span class="line-modified">!    * Stack:        uint32 uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SPVTL( TT_ExecContext  exc,
               FT_Long*        args )
    {
      if ( Ins_SxVTL( exc,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4337,16 ***</span>
        Compute_Funcs( exc );
      }
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SFvTL[a]:     Set FVector To Line                                     */</span>
<span class="line-modified">!   /* Opcode range: 0x08-0x09                                               */</span>
<span class="line-modified">!   /* Stack:        uint32 uint32 --&gt;                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SFVTL( TT_ExecContext  exc,
               FT_Long*        args )
    {
      if ( Ins_SxVTL( exc,
<span class="line-new-header">--- 4444,16 ---</span>
        Compute_Funcs( exc );
      }
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SFvTL[a]:     Set FVector To Line</span>
<span class="line-modified">!    * Opcode range: 0x08-0x09</span>
<span class="line-modified">!    * Stack:        uint32 uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SFVTL( TT_ExecContext  exc,
               FT_Long*        args )
    {
      if ( Ins_SxVTL( exc,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4357,30 ***</span>
        Compute_Funcs( exc );
      }
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SFvTPv[]:     Set FVector To PVector                                  */</span>
<span class="line-modified">!   /* Opcode range: 0x0E                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt;                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SFVTPV( TT_ExecContext  exc )
    {
      exc-&gt;GS.freeVector = exc-&gt;GS.projVector;
      Compute_Funcs( exc );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SPvFS[]:      Set PVector From Stack                                  */</span>
<span class="line-modified">!   /* Opcode range: 0x0A                                                    */</span>
<span class="line-modified">!   /* Stack:        f2.14 f2.14 --&gt;                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SPVFS( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_Short  S;
<span class="line-new-header">--- 4464,30 ---</span>
        Compute_Funcs( exc );
      }
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SFvTPv[]:     Set FVector To PVector</span>
<span class="line-modified">!    * Opcode range: 0x0E</span>
<span class="line-modified">!    * Stack:        --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SFVTPV( TT_ExecContext  exc )
    {
      exc-&gt;GS.freeVector = exc-&gt;GS.projVector;
      Compute_Funcs( exc );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SPvFS[]:      Set PVector From Stack</span>
<span class="line-modified">!    * Opcode range: 0x0A</span>
<span class="line-modified">!    * Stack:        f2.14 f2.14 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SPVFS( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_Short  S;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4398,16 ***</span>
      exc-&gt;GS.dualVector = exc-&gt;GS.projVector;
      Compute_Funcs( exc );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SFvFS[]:      Set FVector From Stack                                  */</span>
<span class="line-modified">!   /* Opcode range: 0x0B                                                    */</span>
<span class="line-modified">!   /* Stack:        f2.14 f2.14 --&gt;                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SFVFS( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_Short  S;
<span class="line-new-header">--- 4505,16 ---</span>
      exc-&gt;GS.dualVector = exc-&gt;GS.projVector;
      Compute_Funcs( exc );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SFvFS[]:      Set FVector From Stack</span>
<span class="line-modified">!    * Opcode range: 0x0B</span>
<span class="line-modified">!    * Stack:        f2.14 f2.14 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SFVFS( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_Short  S;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4423,198 ***</span>
      Normalize( X, Y, &amp;exc-&gt;GS.freeVector );
      Compute_Funcs( exc );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* GPv[]:        Get Projection Vector                                   */</span>
<span class="line-modified">!   /* Opcode range: 0x0C                                                    */</span>
<span class="line-modified">!   /* Stack:        ef2.14 --&gt; ef2.14                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_GPV( TT_ExecContext  exc,
             FT_Long*        args )
    {
      args[0] = exc-&gt;GS.projVector.x;
      args[1] = exc-&gt;GS.projVector.y;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* GFv[]:        Get Freedom Vector                                      */</span>
<span class="line-modified">!   /* Opcode range: 0x0D                                                    */</span>
<span class="line-modified">!   /* Stack:        ef2.14 --&gt; ef2.14                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_GFV( TT_ExecContext  exc,
             FT_Long*        args )
    {
      args[0] = exc-&gt;GS.freeVector.x;
      args[1] = exc-&gt;GS.freeVector.y;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SRP0[]:       Set Reference Point 0                                   */</span>
<span class="line-modified">!   /* Opcode range: 0x10                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SRP0( TT_ExecContext  exc,
              FT_Long*        args )
    {
      exc-&gt;GS.rp0 = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SRP1[]:       Set Reference Point 1                                   */</span>
<span class="line-modified">!   /* Opcode range: 0x11                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SRP1( TT_ExecContext  exc,
              FT_Long*        args )
    {
      exc-&gt;GS.rp1 = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SRP2[]:       Set Reference Point 2                                   */</span>
<span class="line-modified">!   /* Opcode range: 0x12                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SRP2( TT_ExecContext  exc,
              FT_Long*        args )
    {
      exc-&gt;GS.rp2 = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SMD[]:        Set Minimum Distance                                    */</span>
<span class="line-modified">!   /* Opcode range: 0x1A                                                    */</span>
<span class="line-modified">!   /* Stack:        f26.6 --&gt;                                               */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SMD( TT_ExecContext  exc,
             FT_Long*        args )
    {
      exc-&gt;GS.minimum_distance = args[0];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SCVTCI[]:     Set Control Value Table Cut In                          */</span>
<span class="line-modified">!   /* Opcode range: 0x1D                                                    */</span>
<span class="line-modified">!   /* Stack:        f26.6 --&gt;                                               */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SCVTCI( TT_ExecContext  exc,
                FT_Long*        args )
    {
      exc-&gt;GS.control_value_cutin = (FT_F26Dot6)args[0];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SSWCI[]:      Set Single Width Cut In                                 */</span>
<span class="line-modified">!   /* Opcode range: 0x1E                                                    */</span>
<span class="line-modified">!   /* Stack:        f26.6 --&gt;                                               */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SSWCI( TT_ExecContext  exc,
               FT_Long*        args )
    {
      exc-&gt;GS.single_width_cutin = (FT_F26Dot6)args[0];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SSW[]:        Set Single Width                                        */</span>
<span class="line-modified">!   /* Opcode range: 0x1F                                                    */</span>
<span class="line-modified">!   /* Stack:        int32? --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SSW( TT_ExecContext  exc,
             FT_Long*        args )
    {
      exc-&gt;GS.single_width_value = FT_MulFix( args[0],
                                              exc-&gt;tt_metrics.scale );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* FLIPON[]:     Set auto-FLIP to ON                                     */</span>
<span class="line-modified">!   /* Opcode range: 0x4D                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt;                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_FLIPON( TT_ExecContext  exc )
    {
      exc-&gt;GS.auto_flip = TRUE;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* FLIPOFF[]:    Set auto-FLIP to OFF                                    */</span>
<span class="line-modified">!   /* Opcode range: 0x4E                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt;                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_FLIPOFF( TT_ExecContext  exc )
    {
      exc-&gt;GS.auto_flip = FALSE;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SANGW[]:      Set ANGle Weight                                        */</span>
<span class="line-modified">!   /* Opcode range: 0x7E                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SANGW( void )
    {
      /* instruction not supported anymore */
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SDB[]:        Set Delta Base                                          */</span>
<span class="line-modified">!   /* Opcode range: 0x5E                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SDB( TT_ExecContext  exc,
             FT_Long*        args )
    {
      exc-&gt;GS.delta_base = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SDS[]:        Set Delta Shift                                         */</span>
<span class="line-modified">!   /* Opcode range: 0x5F                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SDS( TT_ExecContext  exc,
             FT_Long*        args )
    {
      if ( (FT_ULong)args[0] &gt; 6UL )
<span class="line-new-header">--- 4530,198 ---</span>
      Normalize( X, Y, &amp;exc-&gt;GS.freeVector );
      Compute_Funcs( exc );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * GPv[]:        Get Projection Vector</span>
<span class="line-modified">!    * Opcode range: 0x0C</span>
<span class="line-modified">!    * Stack:        ef2.14 --&gt; ef2.14</span>
<span class="line-modified">!    */</span>
    static void
    Ins_GPV( TT_ExecContext  exc,
             FT_Long*        args )
    {
      args[0] = exc-&gt;GS.projVector.x;
      args[1] = exc-&gt;GS.projVector.y;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * GFv[]:        Get Freedom Vector</span>
<span class="line-modified">!    * Opcode range: 0x0D</span>
<span class="line-modified">!    * Stack:        ef2.14 --&gt; ef2.14</span>
<span class="line-modified">!    */</span>
    static void
    Ins_GFV( TT_ExecContext  exc,
             FT_Long*        args )
    {
      args[0] = exc-&gt;GS.freeVector.x;
      args[1] = exc-&gt;GS.freeVector.y;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SRP0[]:       Set Reference Point 0</span>
<span class="line-modified">!    * Opcode range: 0x10</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SRP0( TT_ExecContext  exc,
              FT_Long*        args )
    {
      exc-&gt;GS.rp0 = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SRP1[]:       Set Reference Point 1</span>
<span class="line-modified">!    * Opcode range: 0x11</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SRP1( TT_ExecContext  exc,
              FT_Long*        args )
    {
      exc-&gt;GS.rp1 = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SRP2[]:       Set Reference Point 2</span>
<span class="line-modified">!    * Opcode range: 0x12</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SRP2( TT_ExecContext  exc,
              FT_Long*        args )
    {
      exc-&gt;GS.rp2 = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SMD[]:        Set Minimum Distance</span>
<span class="line-modified">!    * Opcode range: 0x1A</span>
<span class="line-modified">!    * Stack:        f26.6 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SMD( TT_ExecContext  exc,
             FT_Long*        args )
    {
      exc-&gt;GS.minimum_distance = args[0];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SCVTCI[]:     Set Control Value Table Cut In</span>
<span class="line-modified">!    * Opcode range: 0x1D</span>
<span class="line-modified">!    * Stack:        f26.6 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SCVTCI( TT_ExecContext  exc,
                FT_Long*        args )
    {
      exc-&gt;GS.control_value_cutin = (FT_F26Dot6)args[0];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SSWCI[]:      Set Single Width Cut In</span>
<span class="line-modified">!    * Opcode range: 0x1E</span>
<span class="line-modified">!    * Stack:        f26.6 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SSWCI( TT_ExecContext  exc,
               FT_Long*        args )
    {
      exc-&gt;GS.single_width_cutin = (FT_F26Dot6)args[0];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SSW[]:        Set Single Width</span>
<span class="line-modified">!    * Opcode range: 0x1F</span>
<span class="line-modified">!    * Stack:        int32? --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SSW( TT_ExecContext  exc,
             FT_Long*        args )
    {
      exc-&gt;GS.single_width_value = FT_MulFix( args[0],
                                              exc-&gt;tt_metrics.scale );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * FLIPON[]:     Set auto-FLIP to ON</span>
<span class="line-modified">!    * Opcode range: 0x4D</span>
<span class="line-modified">!    * Stack:        --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_FLIPON( TT_ExecContext  exc )
    {
      exc-&gt;GS.auto_flip = TRUE;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * FLIPOFF[]:    Set auto-FLIP to OFF</span>
<span class="line-modified">!    * Opcode range: 0x4E</span>
<span class="line-modified">!    * Stack:        --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_FLIPOFF( TT_ExecContext  exc )
    {
      exc-&gt;GS.auto_flip = FALSE;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SANGW[]:      Set ANGle Weight</span>
<span class="line-modified">!    * Opcode range: 0x7E</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SANGW( void )
    {
      /* instruction not supported anymore */
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SDB[]:        Set Delta Base</span>
<span class="line-modified">!    * Opcode range: 0x5E</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SDB( TT_ExecContext  exc,
             FT_Long*        args )
    {
      exc-&gt;GS.delta_base = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SDS[]:        Set Delta Shift</span>
<span class="line-modified">!    * Opcode range: 0x5F</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SDS( TT_ExecContext  exc,
             FT_Long*        args )
    {
      if ( (FT_ULong)args[0] &gt; 6UL )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4622,98 ***</span>
      else
        exc-&gt;GS.delta_shift = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* RTHG[]:       Round To Half Grid                                      */</span>
<span class="line-modified">!   /* Opcode range: 0x19                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt;                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_RTHG( TT_ExecContext  exc )
    {
      exc-&gt;GS.round_state = TT_Round_To_Half_Grid;
      exc-&gt;func_round     = (TT_Round_Func)Round_To_Half_Grid;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* RTG[]:        Round To Grid                                           */</span>
<span class="line-modified">!   /* Opcode range: 0x18                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt;                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_RTG( TT_ExecContext  exc )
    {
      exc-&gt;GS.round_state = TT_Round_To_Grid;
      exc-&gt;func_round     = (TT_Round_Func)Round_To_Grid;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /* RTDG[]:       Round To Double Grid                                    */</span>
<span class="line-modified">!   /* Opcode range: 0x3D                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt;                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_RTDG( TT_ExecContext  exc )
    {
      exc-&gt;GS.round_state = TT_Round_To_Double_Grid;
      exc-&gt;func_round     = (TT_Round_Func)Round_To_Double_Grid;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /* RUTG[]:       Round Up To Grid                                        */</span>
<span class="line-modified">!   /* Opcode range: 0x7C                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt;                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_RUTG( TT_ExecContext  exc )
    {
      exc-&gt;GS.round_state = TT_Round_Up_To_Grid;
      exc-&gt;func_round     = (TT_Round_Func)Round_Up_To_Grid;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* RDTG[]:       Round Down To Grid                                      */</span>
<span class="line-modified">!   /* Opcode range: 0x7D                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt;                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_RDTG( TT_ExecContext  exc )
    {
      exc-&gt;GS.round_state = TT_Round_Down_To_Grid;
      exc-&gt;func_round     = (TT_Round_Func)Round_Down_To_Grid;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* ROFF[]:       Round OFF                                               */</span>
<span class="line-modified">!   /* Opcode range: 0x7A                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt;                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_ROFF( TT_ExecContext  exc )
    {
      exc-&gt;GS.round_state = TT_Round_Off;
      exc-&gt;func_round     = (TT_Round_Func)Round_None;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SROUND[]:     Super ROUND                                             */</span>
<span class="line-modified">!   /* Opcode range: 0x76                                                    */</span>
<span class="line-modified">!   /* Stack:        Eint8 --&gt;                                               */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SROUND( TT_ExecContext  exc,
                FT_Long*        args )
    {
      SetSuperRound( exc, 0x4000, args[0] );
<span class="line-new-header">--- 4729,98 ---</span>
      else
        exc-&gt;GS.delta_shift = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * RTHG[]:       Round To Half Grid</span>
<span class="line-modified">!    * Opcode range: 0x19</span>
<span class="line-modified">!    * Stack:        --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_RTHG( TT_ExecContext  exc )
    {
      exc-&gt;GS.round_state = TT_Round_To_Half_Grid;
      exc-&gt;func_round     = (TT_Round_Func)Round_To_Half_Grid;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * RTG[]:        Round To Grid</span>
<span class="line-modified">!    * Opcode range: 0x18</span>
<span class="line-modified">!    * Stack:        --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_RTG( TT_ExecContext  exc )
    {
      exc-&gt;GS.round_state = TT_Round_To_Grid;
      exc-&gt;func_round     = (TT_Round_Func)Round_To_Grid;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    * RTDG[]:       Round To Double Grid</span>
<span class="line-modified">!    * Opcode range: 0x3D</span>
<span class="line-modified">!    * Stack:        --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_RTDG( TT_ExecContext  exc )
    {
      exc-&gt;GS.round_state = TT_Round_To_Double_Grid;
      exc-&gt;func_round     = (TT_Round_Func)Round_To_Double_Grid;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    * RUTG[]:       Round Up To Grid</span>
<span class="line-modified">!    * Opcode range: 0x7C</span>
<span class="line-modified">!    * Stack:        --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_RUTG( TT_ExecContext  exc )
    {
      exc-&gt;GS.round_state = TT_Round_Up_To_Grid;
      exc-&gt;func_round     = (TT_Round_Func)Round_Up_To_Grid;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * RDTG[]:       Round Down To Grid</span>
<span class="line-modified">!    * Opcode range: 0x7D</span>
<span class="line-modified">!    * Stack:        --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_RDTG( TT_ExecContext  exc )
    {
      exc-&gt;GS.round_state = TT_Round_Down_To_Grid;
      exc-&gt;func_round     = (TT_Round_Func)Round_Down_To_Grid;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * ROFF[]:       Round OFF</span>
<span class="line-modified">!    * Opcode range: 0x7A</span>
<span class="line-modified">!    * Stack:        --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_ROFF( TT_ExecContext  exc )
    {
      exc-&gt;GS.round_state = TT_Round_Off;
      exc-&gt;func_round     = (TT_Round_Func)Round_None;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SROUND[]:     Super ROUND</span>
<span class="line-modified">!    * Opcode range: 0x76</span>
<span class="line-modified">!    * Stack:        Eint8 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SROUND( TT_ExecContext  exc,
                FT_Long*        args )
    {
      SetSuperRound( exc, 0x4000, args[0] );
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4721,16 ***</span>
      exc-&gt;GS.round_state = TT_Round_Super;
      exc-&gt;func_round     = (TT_Round_Func)Round_Super;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* S45ROUND[]:   Super ROUND 45 degrees                                  */</span>
<span class="line-modified">!   /* Opcode range: 0x77                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_S45ROUND( TT_ExecContext  exc,
                  FT_Long*        args )
    {
      SetSuperRound( exc, 0x2D41, args[0] );
<span class="line-new-header">--- 4828,16 ---</span>
      exc-&gt;GS.round_state = TT_Round_Super;
      exc-&gt;func_round     = (TT_Round_Func)Round_Super;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * S45ROUND[]:   Super ROUND 45 degrees</span>
<span class="line-modified">!    * Opcode range: 0x77</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_S45ROUND( TT_ExecContext  exc,
                  FT_Long*        args )
    {
      SetSuperRound( exc, 0x2D41, args[0] );
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4738,19 ***</span>
      exc-&gt;GS.round_state = TT_Round_Super_45;
      exc-&gt;func_round     = (TT_Round_Func)Round_Super_45;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* GC[a]:        Get Coordinate projected onto                           */</span>
<span class="line-modified">!   /* Opcode range: 0x46-0x47                                               */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt; f26.6                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* XXX: UNDOCUMENTED: Measures from the original glyph must be taken     */</span>
<span class="line-modified">!   /*      along the dual projection vector!                                */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_GC( TT_ExecContext  exc,
            FT_Long*        args )
    {
      FT_ULong    L;
<span class="line-new-header">--- 4845,19 ---</span>
      exc-&gt;GS.round_state = TT_Round_Super_45;
      exc-&gt;func_round     = (TT_Round_Func)Round_Super_45;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * GC[a]:        Get Coordinate projected onto</span>
<span class="line-modified">!    * Opcode range: 0x46-0x47</span>
<span class="line-modified">!    * Stack:        uint32 --&gt; f26.6</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * XXX: UNDOCUMENTED: Measures from the original glyph must be taken</span>
<span class="line-modified">!    *      along the dual projection vector!</span>
<span class="line-modified">!    */</span>
    static void
    Ins_GC( TT_ExecContext  exc,
            FT_Long*        args )
    {
      FT_ULong    L;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4775,20 ***</span>
  
      args[0] = R;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SCFS[]:       Set Coordinate From Stack                               */</span>
<span class="line-modified">!   /* Opcode range: 0x48                                                    */</span>
<span class="line-modified">!   /* Stack:        f26.6 uint32 --&gt;                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* Formula:                                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*   OA := OA + ( value - OA.p )/( f.p ) * f                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SCFS( TT_ExecContext  exc,
              FT_Long*        args )
    {
      FT_Long    K;
<span class="line-new-header">--- 4882,20 ---</span>
  
      args[0] = R;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SCFS[]:       Set Coordinate From Stack</span>
<span class="line-modified">!    * Opcode range: 0x48</span>
<span class="line-modified">!    * Stack:        f26.6 uint32 --&gt;</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Formula:</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   OA := OA + ( value - OA.p )/( f.p ) * f</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SCFS( TT_ExecContext  exc,
              FT_Long*        args )
    {
      FT_Long    K;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4813,25 ***</span>
      if ( exc-&gt;GS.gep2 == 0 )
        exc-&gt;zp2.org[L] = exc-&gt;zp2.cur[L];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* MD[a]:        Measure Distance                                        */</span>
<span class="line-modified">!   /* Opcode range: 0x49-0x4A                                               */</span>
<span class="line-modified">!   /* Stack:        uint32 uint32 --&gt; f26.6                                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* XXX: UNDOCUMENTED: Measure taken in the original glyph must be along  */</span>
<span class="line-modified">!   /*                    the dual projection vector.                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* XXX: UNDOCUMENTED: Flag attributes are inverted!                      */</span>
<span class="line-modified">!   /*                      0 =&gt; measure distance in original outline        */</span>
<span class="line-modified">!   /*                      1 =&gt; measure distance in grid-fitted outline     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* XXX: UNDOCUMENTED: `zp0 - zp1&#39;, and not `zp2 - zp1!                   */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_MD( TT_ExecContext  exc,
            FT_Long*        args )
    {
      FT_UShort   K, L;
<span class="line-new-header">--- 4920,25 ---</span>
      if ( exc-&gt;GS.gep2 == 0 )
        exc-&gt;zp2.org[L] = exc-&gt;zp2.cur[L];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * MD[a]:        Measure Distance</span>
<span class="line-modified">!    * Opcode range: 0x49-0x4A</span>
<span class="line-modified">!    * Stack:        uint32 uint32 --&gt; f26.6</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * XXX: UNDOCUMENTED: Measure taken in the original glyph must be along</span>
<span class="line-modified">!    *                    the dual projection vector.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * XXX: UNDOCUMENTED: Flag attributes are inverted!</span>
<span class="line-modified">!    *                      0 =&gt; measure distance in original outline</span>
<span class="line-modified">!    *                      1 =&gt; measure distance in grid-fitted outline</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * XXX: UNDOCUMENTED: `zp0 - zp1&#39;, and not `zp2 - zp1!</span>
<span class="line-modified">!    */</span>
    static void
    Ins_MD( TT_ExecContext  exc,
            FT_Long*        args )
    {
      FT_UShort   K, L;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4900,16 ***</span>
  
      args[0] = D;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SDPvTL[a]:    Set Dual PVector to Line                                */</span>
<span class="line-modified">!   /* Opcode range: 0x86-0x87                                               */</span>
<span class="line-modified">!   /* Stack:        uint32 uint32 --&gt;                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SDPVTL( TT_ExecContext  exc,
                FT_Long*        args )
    {
      FT_Long    A, B, C;
<span class="line-new-header">--- 5007,16 ---</span>
  
      args[0] = D;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SDPvTL[a]:    Set Dual PVector to Line</span>
<span class="line-modified">!    * Opcode range: 0x86-0x87</span>
<span class="line-modified">!    * Stack:        uint32 uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SDPVTL( TT_ExecContext  exc,
                FT_Long*        args )
    {
      FT_Long    A, B, C;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4983,16 ***</span>
      Normalize( A, B, &amp;exc-&gt;GS.projVector );
      Compute_Funcs( exc );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SZP0[]:       Set Zone Pointer 0                                      */</span>
<span class="line-modified">!   /* Opcode range: 0x13                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SZP0( TT_ExecContext  exc,
              FT_Long*        args )
    {
      switch ( (FT_Int)args[0] )
<span class="line-new-header">--- 5090,16 ---</span>
      Normalize( A, B, &amp;exc-&gt;GS.projVector );
      Compute_Funcs( exc );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SZP0[]:       Set Zone Pointer 0</span>
<span class="line-modified">!    * Opcode range: 0x13</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SZP0( TT_ExecContext  exc,
              FT_Long*        args )
    {
      switch ( (FT_Int)args[0] )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 5013,16 ***</span>
  
      exc-&gt;GS.gep0 = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SZP1[]:       Set Zone Pointer 1                                      */</span>
<span class="line-modified">!   /* Opcode range: 0x14                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SZP1( TT_ExecContext  exc,
              FT_Long*        args )
    {
      switch ( (FT_Int)args[0] )
<span class="line-new-header">--- 5120,16 ---</span>
  
      exc-&gt;GS.gep0 = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SZP1[]:       Set Zone Pointer 1</span>
<span class="line-modified">!    * Opcode range: 0x14</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SZP1( TT_ExecContext  exc,
              FT_Long*        args )
    {
      switch ( (FT_Int)args[0] )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 5043,16 ***</span>
  
      exc-&gt;GS.gep1 = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SZP2[]:       Set Zone Pointer 2                                      */</span>
<span class="line-modified">!   /* Opcode range: 0x15                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SZP2( TT_ExecContext  exc,
              FT_Long*        args )
    {
      switch ( (FT_Int)args[0] )
<span class="line-new-header">--- 5150,16 ---</span>
  
      exc-&gt;GS.gep1 = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SZP2[]:       Set Zone Pointer 2</span>
<span class="line-modified">!    * Opcode range: 0x15</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SZP2( TT_ExecContext  exc,
              FT_Long*        args )
    {
      switch ( (FT_Int)args[0] )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 5073,16 ***</span>
  
      exc-&gt;GS.gep2 = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SZPS[]:       Set Zone PointerS                                       */</span>
<span class="line-modified">!   /* Opcode range: 0x16                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SZPS( TT_ExecContext  exc,
              FT_Long*        args )
    {
      switch ( (FT_Int)args[0] )
<span class="line-new-header">--- 5180,16 ---</span>
  
      exc-&gt;GS.gep2 = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SZPS[]:       Set Zone PointerS</span>
<span class="line-modified">!    * Opcode range: 0x16</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SZPS( TT_ExecContext  exc,
              FT_Long*        args )
    {
      switch ( (FT_Int)args[0] )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 5108,16 ***</span>
      exc-&gt;GS.gep1 = (FT_UShort)args[0];
      exc-&gt;GS.gep2 = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* INSTCTRL[]:   INSTruction ConTRoL                                     */</span>
<span class="line-modified">!   /* Opcode range: 0x8E                                                    */</span>
<span class="line-modified">!   /* Stack:        int32 int32 --&gt;                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_INSTCTRL( TT_ExecContext  exc,
                  FT_Long*        args )
    {
      FT_ULong  K, L, Kf;
<span class="line-new-header">--- 5215,16 ---</span>
      exc-&gt;GS.gep1 = (FT_UShort)args[0];
      exc-&gt;GS.gep2 = (FT_UShort)args[0];
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * INSTCTRL[]:   INSTruction ConTRoL</span>
<span class="line-modified">!    * Opcode range: 0x8E</span>
<span class="line-modified">!    * Stack:        int32 int32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_INSTCTRL( TT_ExecContext  exc,
                  FT_Long*        args )
    {
      FT_ULong  K, L, Kf;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 5170,16 ***</span>
  #endif
      }
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SCANCTRL[]:   SCAN ConTRoL                                            */</span>
<span class="line-modified">!   /* Opcode range: 0x85                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32? --&gt;                                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SCANCTRL( TT_ExecContext  exc,
                  FT_Long*        args )
    {
      FT_Int  A;
<span class="line-new-header">--- 5277,16 ---</span>
  #endif
      }
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SCANCTRL[]:   SCAN ConTRoL</span>
<span class="line-modified">!    * Opcode range: 0x85</span>
<span class="line-modified">!    * Stack:        uint32? --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SCANCTRL( TT_ExecContext  exc,
                  FT_Long*        args )
    {
      FT_Int  A;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 5217,38 ***</span>
      if ( ( args[0] &amp; 0x2000 ) != 0 &amp;&amp; exc-&gt;tt_metrics.stretched )
        exc-&gt;GS.scan_control = FALSE;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SCANTYPE[]:   SCAN TYPE                                               */</span>
<span class="line-modified">!   /* Opcode range: 0x8D                                                    */</span>
<span class="line-modified">!   /* Stack:        uint16 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SCANTYPE( TT_ExecContext  exc,
                  FT_Long*        args )
    {
      if ( args[0] &gt;= 0 )
        exc-&gt;GS.scan_type = (FT_Int)args[0] &amp; 0xFFFF;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* MANAGING OUTLINES                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*************************************************************************/</span>
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* FLIPPT[]:     FLIP PoinT                                              */</span>
<span class="line-modified">!   /* Opcode range: 0x80                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32... --&gt;                                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_FLIPPT( TT_ExecContext  exc )
    {
      FT_UShort  point;
  
<span class="line-new-header">--- 5324,38 ---</span>
      if ( ( args[0] &amp; 0x2000 ) != 0 &amp;&amp; exc-&gt;tt_metrics.stretched )
        exc-&gt;GS.scan_control = FALSE;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SCANTYPE[]:   SCAN TYPE</span>
<span class="line-modified">!    * Opcode range: 0x8D</span>
<span class="line-modified">!    * Stack:        uint16 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SCANTYPE( TT_ExecContext  exc,
                  FT_Long*        args )
    {
      if ( args[0] &gt;= 0 )
        exc-&gt;GS.scan_type = (FT_Int)args[0] &amp; 0xFFFF;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * MANAGING OUTLINES</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    */</span>
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * FLIPPT[]:     FLIP PoinT</span>
<span class="line-modified">!    * Opcode range: 0x80</span>
<span class="line-modified">!    * Stack:        uint32... --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_FLIPPT( TT_ExecContext  exc )
    {
      FT_UShort  point;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 5293,16 ***</span>
      exc-&gt;GS.loop = 1;
      exc-&gt;new_top = exc-&gt;args;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* FLIPRGON[]:   FLIP RanGe ON                                           */</span>
<span class="line-modified">!   /* Opcode range: 0x81                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 uint32 --&gt;                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_FLIPRGON( TT_ExecContext  exc,
                  FT_Long*        args )
    {
      FT_UShort  I, K, L;
<span class="line-new-header">--- 5400,16 ---</span>
      exc-&gt;GS.loop = 1;
      exc-&gt;new_top = exc-&gt;args;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * FLIPRGON[]:   FLIP RanGe ON</span>
<span class="line-modified">!    * Opcode range: 0x81</span>
<span class="line-modified">!    * Stack:        uint32 uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_FLIPRGON( TT_ExecContext  exc,
                  FT_Long*        args )
    {
      FT_UShort  I, K, L;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 5331,16 ***</span>
      for ( I = L; I &lt;= K; I++ )
        exc-&gt;pts.tags[I] |= FT_CURVE_TAG_ON;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* FLIPRGOFF:    FLIP RanGe OFF                                          */</span>
<span class="line-modified">!   /* Opcode range: 0x82                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 uint32 --&gt;                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_FLIPRGOFF( TT_ExecContext  exc,
                   FT_Long*        args )
    {
      FT_UShort  I, K, L;
<span class="line-new-header">--- 5438,16 ---</span>
      for ( I = L; I &lt;= K; I++ )
        exc-&gt;pts.tags[I] |= FT_CURVE_TAG_ON;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * FLIPRGOFF:    FLIP RanGe OFF</span>
<span class="line-modified">!    * Opcode range: 0x82</span>
<span class="line-modified">!    * Stack:        uint32 uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_FLIPRGOFF( TT_ExecContext  exc,
                   FT_Long*        args )
    {
      FT_UShort  I, K, L;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 5448,16 ***</span>
          exc-&gt;zp2.tags[point] |= FT_CURVE_TAG_TOUCH_Y;
      }
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SHP[a]:       SHift Point by the last point                           */</span>
<span class="line-modified">!   /* Opcode range: 0x32-0x33                                               */</span>
<span class="line-modified">!   /* Stack:        uint32... --&gt;                                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SHP( TT_ExecContext  exc )
    {
      TT_GlyphZoneRec  zp;
      FT_UShort        refp;
<span class="line-new-header">--- 5555,16 ---</span>
          exc-&gt;zp2.tags[point] |= FT_CURVE_TAG_TOUCH_Y;
      }
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SHP[a]:       SHift Point by the last point</span>
<span class="line-modified">!    * Opcode range: 0x32-0x33</span>
<span class="line-modified">!    * Stack:        uint32... --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SHP( TT_ExecContext  exc )
    {
      TT_GlyphZoneRec  zp;
      FT_UShort        refp;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 5505,20 ***</span>
      exc-&gt;GS.loop = 1;
      exc-&gt;new_top = exc-&gt;args;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SHC[a]:       SHift Contour                                           */</span>
<span class="line-modified">!   /* Opcode range: 0x34-35                                                 */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* UNDOCUMENTED: According to Greg Hitchcock, there is one (virtual)     */</span>
<span class="line-modified">!   /*               contour in the twilight zone, namely contour number     */</span>
<span class="line-modified">!   /*               zero which includes all points of it.                   */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SHC( TT_ExecContext  exc,
             FT_Long*        args )
    {
      TT_GlyphZoneRec  zp;
<span class="line-new-header">--- 5612,20 ---</span>
      exc-&gt;GS.loop = 1;
      exc-&gt;new_top = exc-&gt;args;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SHC[a]:       SHift Contour</span>
<span class="line-modified">!    * Opcode range: 0x34-35</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * UNDOCUMENTED: According to Greg Hitchcock, there is one (virtual)</span>
<span class="line-modified">!    *               contour in the twilight zone, namely contour number</span>
<span class="line-modified">!    *               zero which includes all points of it.</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SHC( TT_ExecContext  exc,
             FT_Long*        args )
    {
      TT_GlyphZoneRec  zp;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 5561,16 ***</span>
          Move_Zp2_Point( exc, i, dx, dy, TRUE );
      }
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SHZ[a]:       SHift Zone                                              */</span>
<span class="line-modified">!   /* Opcode range: 0x36-37                                                 */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SHZ( TT_ExecContext  exc,
             FT_Long*        args )
    {
      TT_GlyphZoneRec  zp;
<span class="line-new-header">--- 5668,16 ---</span>
          Move_Zp2_Point( exc, i, dx, dy, TRUE );
      }
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SHZ[a]:       SHift Zone</span>
<span class="line-modified">!    * Opcode range: 0x36-37</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SHZ( TT_ExecContext  exc,
             FT_Long*        args )
    {
      TT_GlyphZoneRec  zp;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 5609,16 ***</span>
          Move_Zp2_Point( exc, i, dx, dy, FALSE );
      }
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* SHPIX[]:      SHift points by a PIXel amount                          */</span>
<span class="line-modified">!   /* Opcode range: 0x38                                                    */</span>
<span class="line-modified">!   /* Stack:        f26.6 uint32... --&gt;                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_SHPIX( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_F26Dot6  dx, dy;
<span class="line-new-header">--- 5716,16 ---</span>
          Move_Zp2_Point( exc, i, dx, dy, FALSE );
      }
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * SHPIX[]:      SHift points by a PIXel amount</span>
<span class="line-modified">!    * Opcode range: 0x38</span>
<span class="line-modified">!    * Stack:        f26.6 uint32... --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_SHPIX( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_F26Dot6  dx, dy;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 5769,16 ***</span>
      exc-&gt;GS.loop = 1;
      exc-&gt;new_top = exc-&gt;args;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* MSIRP[a]:     Move Stack Indirect Relative Position                   */</span>
<span class="line-modified">!   /* Opcode range: 0x3A-0x3B                                               */</span>
<span class="line-modified">!   /* Stack:        f26.6 uint32 --&gt;                                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_MSIRP( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_UShort   point = 0;
<span class="line-new-header">--- 5876,16 ---</span>
      exc-&gt;GS.loop = 1;
      exc-&gt;new_top = exc-&gt;args;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * MSIRP[a]:     Move Stack Indirect Relative Position</span>
<span class="line-modified">!    * Opcode range: 0x3A-0x3B</span>
<span class="line-modified">!    * Stack:        f26.6 uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_MSIRP( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_UShort   point = 0;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 5844,16 ***</span>
      if ( ( exc-&gt;opcode &amp; 1 ) != 0 )
        exc-&gt;GS.rp0 = point;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* MDAP[a]:      Move Direct Absolute Point                              */</span>
<span class="line-modified">!   /* Opcode range: 0x2E-0x2F                                               */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_MDAP( TT_ExecContext  exc,
              FT_Long*        args )
    {
      FT_UShort   point;
<span class="line-new-header">--- 5951,16 ---</span>
      if ( ( exc-&gt;opcode &amp; 1 ) != 0 )
        exc-&gt;GS.rp0 = point;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * MDAP[a]:      Move Direct Absolute Point</span>
<span class="line-modified">!    * Opcode range: 0x2E-0x2F</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_MDAP( TT_ExecContext  exc,
              FT_Long*        args )
    {
      FT_UShort   point;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 5898,16 ***</span>
      exc-&gt;GS.rp0 = point;
      exc-&gt;GS.rp1 = point;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* MIAP[a]:      Move Indirect Absolute Point                            */</span>
<span class="line-modified">!   /* Opcode range: 0x3E-0x3F                                               */</span>
<span class="line-modified">!   /* Stack:        uint32 uint32 --&gt;                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_MIAP( TT_ExecContext  exc,
              FT_Long*        args )
    {
      FT_ULong    cvtEntry;
<span class="line-new-header">--- 6005,16 ---</span>
      exc-&gt;GS.rp0 = point;
      exc-&gt;GS.rp1 = point;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * MIAP[a]:      Move Indirect Absolute Point</span>
<span class="line-modified">!    * Opcode range: 0x3E-0x3F</span>
<span class="line-modified">!    * Stack:        uint32 uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_MIAP( TT_ExecContext  exc,
              FT_Long*        args )
    {
      FT_ULong    cvtEntry;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 6018,16 ***</span>
      exc-&gt;GS.rp0 = point;
      exc-&gt;GS.rp1 = point;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* MDRP[abcde]:  Move Direct Relative Point                              */</span>
<span class="line-modified">!   /* Opcode range: 0xC0-0xDF                                               */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_MDRP( TT_ExecContext  exc,
              FT_Long*        args )
    {
      FT_UShort   point = 0;
<span class="line-new-header">--- 6125,16 ---</span>
      exc-&gt;GS.rp0 = point;
      exc-&gt;GS.rp1 = point;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * MDRP[abcde]:  Move Direct Relative Point</span>
<span class="line-modified">!    * Opcode range: 0xC0-0xDF</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_MDRP( TT_ExecContext  exc,
              FT_Long*        args )
    {
      FT_UShort   point = 0;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 6162,16 ***</span>
      if ( ( exc-&gt;opcode &amp; 16 ) != 0 )
        exc-&gt;GS.rp0 = point;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* MIRP[abcde]:  Move Indirect Relative Point                            */</span>
<span class="line-modified">!   /* Opcode range: 0xE0-0xFF                                               */</span>
<span class="line-modified">!   /* Stack:        int32? uint32 --&gt;                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_MIRP( TT_ExecContext  exc,
              FT_Long*        args )
    {
      FT_UShort   point;
<span class="line-new-header">--- 6269,16 ---</span>
      if ( ( exc-&gt;opcode &amp; 16 ) != 0 )
        exc-&gt;GS.rp0 = point;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * MIRP[abcde]:  Move Indirect Relative Point</span>
<span class="line-modified">!    * Opcode range: 0xE0-0xFF</span>
<span class="line-modified">!    * Stack:        int32? uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_MIRP( TT_ExecContext  exc,
              FT_Long*        args )
    {
      FT_UShort   point;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 6187,10 ***</span>
<span class="line-new-header">--- 6294,12 ---</span>
      FT_Int      B1           = 0; /* pacify compiler */
      FT_Int      B2           = 0;
      FT_Bool     reverse_move = FALSE;
  #endif /* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY */
  
<span class="line-added">+     FT_F26Dot6  delta;</span>
<span class="line-added">+ </span>
  
      minimum_distance    = exc-&gt;GS.minimum_distance;
      control_value_cutin = exc-&gt;GS.control_value_cutin;
      point               = (FT_UShort)args[0];
      cvtEntry            = (FT_ULong)( ADD_LONG( args[1], 1 ) );
</pre>
<hr />
<pre>
<span class="line-old-header">*** 6219,12 ***</span>
      else
        cvt_dist = exc-&gt;func_read_cvt( exc, cvtEntry - 1 );
  
      /* single width test */
  
<span class="line-modified">!     if ( FT_ABS( cvt_dist - exc-&gt;GS.single_width_value ) &lt;</span>
<span class="line-modified">!          exc-&gt;GS.single_width_cutin )</span>
      {
        if ( cvt_dist &gt;= 0 )
          cvt_dist =  exc-&gt;GS.single_width_value;
        else
          cvt_dist = -exc-&gt;GS.single_width_value;
<span class="line-new-header">--- 6328,15 ---</span>
      else
        cvt_dist = exc-&gt;func_read_cvt( exc, cvtEntry - 1 );
  
      /* single width test */
  
<span class="line-modified">!     delta = SUB_LONG( cvt_dist, exc-&gt;GS.single_width_value );</span>
<span class="line-modified">!     if ( delta &lt; 0 )</span>
<span class="line-added">+       delta = NEG_LONG( delta );</span>
<span class="line-added">+ </span>
<span class="line-added">+     if ( delta &lt; exc-&gt;GS.single_width_cutin )</span>
      {
        if ( cvt_dist &gt;= 0 )
          cvt_dist =  exc-&gt;GS.single_width_value;
        else
          cvt_dist = -exc-&gt;GS.single_width_value;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 6249,11 ***</span>
      /* auto-flip test */
  
      if ( exc-&gt;GS.auto_flip )
      {
        if ( ( org_dist ^ cvt_dist ) &lt; 0 )
<span class="line-modified">!         cvt_dist = -cvt_dist;</span>
      }
  
  #ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY
      if ( SUBPIXEL_HINTING_INFINALITY                               &amp;&amp;
           exc-&gt;ignore_x_mode                                        &amp;&amp;
<span class="line-new-header">--- 6361,11 ---</span>
      /* auto-flip test */
  
      if ( exc-&gt;GS.auto_flip )
      {
        if ( ( org_dist ^ cvt_dist ) &lt; 0 )
<span class="line-modified">!         cvt_dist = NEG_LONG( cvt_dist );</span>
      }
  
  #ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY
      if ( SUBPIXEL_HINTING_INFINALITY                               &amp;&amp;
           exc-&gt;ignore_x_mode                                        &amp;&amp;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 6274,13 ***</span>
        /* XXX: UNDOCUMENTED!  Only perform cut-in test when both points */
        /*      refer to the same zone.                                  */
  
        if ( exc-&gt;GS.gep0 == exc-&gt;GS.gep1 )
        {
<span class="line-removed">-         FT_F26Dot6  delta;</span>
<span class="line-removed">- </span>
<span class="line-removed">- </span>
          /* XXX: According to Greg Hitchcock, the following wording is */
          /*      the right one:                                        */
          /*                                                            */
          /*        When the absolute difference between the value in   */
          /*        the table [CVT] and the measurement directly from   */
<span class="line-new-header">--- 6386,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 6311,13 ***</span>
        /* do cvt cut-in always in MIRP for sph */
        if ( SUBPIXEL_HINTING_INFINALITY  &amp;&amp;
             exc-&gt;ignore_x_mode           &amp;&amp;
             exc-&gt;GS.gep0 == exc-&gt;GS.gep1 )
        {
<span class="line-removed">-         FT_F26Dot6  delta;</span>
<span class="line-removed">- </span>
<span class="line-removed">- </span>
          delta = SUB_LONG( cvt_dist, org_dist );
          if ( delta &lt; 0 )
            delta = NEG_LONG( delta );
  
          if ( delta &gt; control_value_cutin )
<span class="line-new-header">--- 6420,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 6410,16 ***</span>
  
      exc-&gt;GS.rp2 = point;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* ALIGNRP[]:    ALIGN Relative Point                                    */</span>
<span class="line-modified">!   /* Opcode range: 0x3C                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 uint32... --&gt;                                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_ALIGNRP( TT_ExecContext  exc )
    {
      FT_UShort   point;
      FT_F26Dot6  distance;
<span class="line-new-header">--- 6516,16 ---</span>
  
      exc-&gt;GS.rp2 = point;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * ALIGNRP[]:    ALIGN Relative Point</span>
<span class="line-modified">!    * Opcode range: 0x3C</span>
<span class="line-modified">!    * Stack:        uint32 uint32... --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_ALIGNRP( TT_ExecContext  exc )
    {
      FT_UShort   point;
      FT_F26Dot6  distance;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 6473,16 ***</span>
      exc-&gt;GS.loop = 1;
      exc-&gt;new_top = exc-&gt;args;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* ISECT[]:      moves point to InterSECTion                             */</span>
<span class="line-modified">!   /* Opcode range: 0x0F                                                    */</span>
<span class="line-modified">!   /* Stack:        5 * uint32 --&gt;                                          */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_ISECT( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_UShort   point,
<span class="line-new-header">--- 6579,16 ---</span>
      exc-&gt;GS.loop = 1;
      exc-&gt;new_top = exc-&gt;args;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * ISECT[]:      moves point to InterSECTion</span>
<span class="line-modified">!    * Opcode range: 0x0F</span>
<span class="line-modified">!    * Stack:        5 * uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_ISECT( TT_ExecContext  exc,
               FT_Long*        args )
    {
      FT_UShort   point,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 6569,16 ***</span>
  
      exc-&gt;zp2.tags[point] |= FT_CURVE_TAG_TOUCH_BOTH;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* ALIGNPTS[]:   ALIGN PoinTS                                            */</span>
<span class="line-modified">!   /* Opcode range: 0x27                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 uint32 --&gt;                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_ALIGNPTS( TT_ExecContext  exc,
                  FT_Long*        args )
    {
      FT_UShort   p1, p2;
<span class="line-new-header">--- 6675,16 ---</span>
  
      exc-&gt;zp2.tags[point] |= FT_CURVE_TAG_TOUCH_BOTH;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * ALIGNPTS[]:   ALIGN PoinTS</span>
<span class="line-modified">!    * Opcode range: 0x27</span>
<span class="line-modified">!    * Stack:        uint32 uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_ALIGNPTS( TT_ExecContext  exc,
                  FT_Long*        args )
    {
      FT_UShort   p1, p2;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 6601,16 ***</span>
      exc-&gt;func_move( exc, &amp;exc-&gt;zp1, p1, distance );
      exc-&gt;func_move( exc, &amp;exc-&gt;zp0, p2, NEG_LONG( distance ) );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* IP[]:         Interpolate Point                                       */</span>
<span class="line-modified">!   /* Opcode range: 0x39                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32... --&gt;                                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
  
    /* SOMETIMES, DUMBER CODE IS BETTER CODE */
  
    static void
    Ins_IP( TT_ExecContext  exc )
<span class="line-new-header">--- 6707,16 ---</span>
      exc-&gt;func_move( exc, &amp;exc-&gt;zp1, p1, distance );
      exc-&gt;func_move( exc, &amp;exc-&gt;zp0, p2, NEG_LONG( distance ) );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * IP[]:         Interpolate Point</span>
<span class="line-modified">!    * Opcode range: 0x39</span>
<span class="line-modified">!    * Stack:        uint32... --&gt;</span>
<span class="line-modified">!    */</span>
  
    /* SOMETIMES, DUMBER CODE IS BETTER CODE */
  
    static void
    Ins_IP( TT_ExecContext  exc )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 6761,16 ***</span>
      exc-&gt;GS.loop = 1;
      exc-&gt;new_top = exc-&gt;args;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* UTP[a]:       UnTouch Point                                           */</span>
<span class="line-modified">!   /* Opcode range: 0x29                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt;                                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_UTP( TT_ExecContext  exc,
             FT_Long*        args )
    {
      FT_UShort  point;
<span class="line-new-header">--- 6867,16 ---</span>
      exc-&gt;GS.loop = 1;
      exc-&gt;new_top = exc-&gt;args;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * UTP[a]:       UnTouch Point</span>
<span class="line-modified">!    * Opcode range: 0x29</span>
<span class="line-modified">!    * Stack:        uint32 --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_UTP( TT_ExecContext  exc,
             FT_Long*        args )
    {
      FT_UShort  point;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 6930,16 ***</span>
        }
      }
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* IUP[a]:       Interpolate Untouched Points                            */</span>
<span class="line-modified">!   /* Opcode range: 0x30-0x31                                               */</span>
<span class="line-modified">!   /* Stack:        --&gt;                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_IUP( TT_ExecContext  exc )
    {
      IUP_WorkerRec  V;
      FT_Byte        mask;
<span class="line-new-header">--- 7036,16 ---</span>
        }
      }
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * IUP[a]:       Interpolate Untouched Points</span>
<span class="line-modified">!    * Opcode range: 0x30-0x31</span>
<span class="line-modified">!    * Stack:        --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_IUP( TT_ExecContext  exc )
    {
      IUP_WorkerRec  V;
      FT_Byte        mask;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 7058,16 ***</span>
        contour++;
      } while ( contour &lt; exc-&gt;pts.n_contours );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* DELTAPn[]:    DELTA exceptions P1, P2, P3                             */</span>
<span class="line-modified">!   /* Opcode range: 0x5D,0x71,0x72                                          */</span>
<span class="line-modified">!   /* Stack:        uint32 (2 * uint32)... --&gt;                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_DELTAP( TT_ExecContext  exc,
                FT_Long*        args )
    {
      FT_ULong   nump, k;
<span class="line-new-header">--- 7164,16 ---</span>
        contour++;
      } while ( contour &lt; exc-&gt;pts.n_contours );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * DELTAPn[]:    DELTA exceptions P1, P2, P3</span>
<span class="line-modified">!    * Opcode range: 0x5D,0x71,0x72</span>
<span class="line-modified">!    * Stack:        uint32 (2 * uint32)... --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_DELTAP( TT_ExecContext  exc,
                FT_Long*        args )
    {
      FT_ULong   nump, k;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 7140,16 ***</span>
  #ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY
  
            if ( SUBPIXEL_HINTING_INFINALITY )
            {
              /*
<span class="line-modified">!              *  Allow delta move if</span>
               *
<span class="line-modified">!              *  - not using ignore_x_mode rendering,</span>
<span class="line-modified">!              *  - glyph is specifically set to allow it, or</span>
<span class="line-modified">!              *  - glyph is composite and freedom vector is not in subpixel</span>
<span class="line-modified">!              *    direction.</span>
               */
              if ( !exc-&gt;ignore_x_mode                                   ||
                   ( exc-&gt;sph_tweak_flags &amp; SPH_TWEAK_ALWAYS_DO_DELTAP ) ||
                   ( exc-&gt;is_composite &amp;&amp; exc-&gt;GS.freeVector.y != 0 )    )
                exc-&gt;func_move( exc, &amp;exc-&gt;zp0, A, B );
<span class="line-new-header">--- 7246,16 ---</span>
  #ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY
  
            if ( SUBPIXEL_HINTING_INFINALITY )
            {
              /*
<span class="line-modified">!              * Allow delta move if</span>
               *
<span class="line-modified">!              * - not using ignore_x_mode rendering,</span>
<span class="line-modified">!              * - glyph is specifically set to allow it, or</span>
<span class="line-modified">!              * - glyph is composite and freedom vector is not in subpixel</span>
<span class="line-modified">!              *   direction.</span>
               */
              if ( !exc-&gt;ignore_x_mode                                   ||
                   ( exc-&gt;sph_tweak_flags &amp; SPH_TWEAK_ALWAYS_DO_DELTAP ) ||
                   ( exc-&gt;is_composite &amp;&amp; exc-&gt;GS.freeVector.y != 0 )    )
                exc-&gt;func_move( exc, &amp;exc-&gt;zp0, A, B );
</pre>
<hr />
<pre>
<span class="line-old-header">*** 7225,16 ***</span>
    Fail:
      exc-&gt;new_top = exc-&gt;args;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* DELTACn[]:    DELTA exceptions C1, C2, C3                             */</span>
<span class="line-modified">!   /* Opcode range: 0x73,0x74,0x75                                          */</span>
<span class="line-modified">!   /* Stack:        uint32 (2 * uint32)... --&gt;                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_DELTAC( TT_ExecContext  exc,
                FT_Long*        args )
    {
      FT_ULong  nump, k;
<span class="line-new-header">--- 7331,16 ---</span>
    Fail:
      exc-&gt;new_top = exc-&gt;args;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * DELTACn[]:    DELTA exceptions C1, C2, C3</span>
<span class="line-modified">!    * Opcode range: 0x73,0x74,0x75</span>
<span class="line-modified">!    * Stack:        uint32 (2 * uint32)... --&gt;</span>
<span class="line-modified">!    */</span>
    static void
    Ins_DELTAC( TT_ExecContext  exc,
                FT_Long*        args )
    {
      FT_ULong  nump, k;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 7303,31 ***</span>
    Fail:
      exc-&gt;new_top = exc-&gt;args;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* MISC. INSTRUCTIONS                                                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*************************************************************************/</span>
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* GETINFO[]:    GET INFOrmation                                         */</span>
<span class="line-modified">!   /* Opcode range: 0x88                                                    */</span>
<span class="line-modified">!   /* Stack:        uint32 --&gt; uint32                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* XXX: UNDOCUMENTED: Selector bits higher than 9 are currently (May     */</span>
<span class="line-modified">!   /*      2015) not documented in the OpenType specification.              */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*      Selector bit 11 is incorrectly described as bit 8, while the     */</span>
<span class="line-modified">!   /*      real meaning of bit 8 (vertical LCD subpixels) stays             */</span>
<span class="line-modified">!   /*      undocumented.  The same mistake can be found in Greg Hitchcock&#39;s */</span>
<span class="line-modified">!   /*      whitepaper.                                                      */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_GETINFO( TT_ExecContext  exc,
                 FT_Long*        args )
    {
      FT_Long    K;
<span class="line-new-header">--- 7409,31 ---</span>
    Fail:
      exc-&gt;new_top = exc-&gt;args;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * MISC. INSTRUCTIONS</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    */</span>
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * GETINFO[]:    GET INFOrmation</span>
<span class="line-modified">!    * Opcode range: 0x88</span>
<span class="line-modified">!    * Stack:        uint32 --&gt; uint32</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * XXX: UNDOCUMENTED: Selector bits higher than 9 are currently (May</span>
<span class="line-modified">!    *      2015) not documented in the OpenType specification.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *      Selector bit 11 is incorrectly described as bit 8, while the</span>
<span class="line-modified">!    *      real meaning of bit 8 (vertical LCD subpixels) stays</span>
<span class="line-modified">!    *      undocumented.  The same mistake can be found in Greg Hitchcock&#39;s</span>
<span class="line-modified">!    *      whitepaper.</span>
<span class="line-modified">!    */</span>
    static void
    Ins_GETINFO( TT_ExecContext  exc,
                 FT_Long*        args )
    {
      FT_Long    K;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 7335,15 ***</span>
  
  
      K = 0;
  
  #ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY
<span class="line-modified">!     /********************************/</span>
<span class="line-modified">!     /* RASTERIZER VERSION           */</span>
<span class="line-modified">!     /* Selector Bit:  0             */</span>
<span class="line-modified">!     /* Return Bit(s): 0-7           */</span>
<span class="line-modified">!     /*                              */</span>
      if ( SUBPIXEL_HINTING_INFINALITY &amp;&amp;
           ( args[0] &amp; 1 ) != 0        &amp;&amp;
           exc-&gt;subpixel_hinting       )
      {
        if ( exc-&gt;ignore_x_mode )
<span class="line-new-header">--- 7441,15 ---</span>
  
  
      K = 0;
  
  #ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY
<span class="line-modified">!     /*********************************</span>
<span class="line-modified">!      * RASTERIZER VERSION</span>
<span class="line-modified">!      * Selector Bit:  0</span>
<span class="line-modified">!      * Return Bit(s): 0-7</span>
<span class="line-modified">!      */</span>
      if ( SUBPIXEL_HINTING_INFINALITY &amp;&amp;
           ( args[0] &amp; 1 ) != 0        &amp;&amp;
           exc-&gt;subpixel_hinting       )
      {
        if ( exc-&gt;ignore_x_mode )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 7360,97 ***</span>
      else
  #endif /* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY */
        if ( ( args[0] &amp; 1 ) != 0 )
          K = driver-&gt;interpreter_version;
  
<span class="line-modified">!     /********************************/</span>
<span class="line-modified">!     /* GLYPH ROTATED                */</span>
<span class="line-modified">!     /* Selector Bit:  1             */</span>
<span class="line-modified">!     /* Return Bit(s): 8             */</span>
<span class="line-modified">!     /*                              */</span>
      if ( ( args[0] &amp; 2 ) != 0 &amp;&amp; exc-&gt;tt_metrics.rotated )
        K |= 1 &lt;&lt; 8;
  
<span class="line-modified">!     /********************************/</span>
<span class="line-modified">!     /* GLYPH STRETCHED              */</span>
<span class="line-modified">!     /* Selector Bit:  2             */</span>
<span class="line-modified">!     /* Return Bit(s): 9             */</span>
<span class="line-modified">!     /*                              */</span>
      if ( ( args[0] &amp; 4 ) != 0 &amp;&amp; exc-&gt;tt_metrics.stretched )
        K |= 1 &lt;&lt; 9;
  
  #ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT
<span class="line-modified">!     /********************************/</span>
<span class="line-modified">!     /* VARIATION GLYPH              */</span>
<span class="line-modified">!     /* Selector Bit:  3             */</span>
<span class="line-modified">!     /* Return Bit(s): 10            */</span>
<span class="line-modified">!     /*                              */</span>
<span class="line-modified">!     /* XXX: UNDOCUMENTED!           */</span>
      if ( (args[0] &amp; 8 ) != 0 &amp;&amp; exc-&gt;face-&gt;blend )
        K |= 1 &lt;&lt; 10;
  #endif
  
<span class="line-modified">!     /********************************/</span>
<span class="line-modified">!     /* BI-LEVEL HINTING AND         */</span>
<span class="line-modified">!     /* GRAYSCALE RENDERING          */</span>
<span class="line-modified">!     /* Selector Bit:  5             */</span>
<span class="line-modified">!     /* Return Bit(s): 12            */</span>
<span class="line-modified">!     /*                              */</span>
      if ( ( args[0] &amp; 32 ) != 0 &amp;&amp; exc-&gt;grayscale )
        K |= 1 &lt;&lt; 12;
  
  #ifdef TT_SUPPORT_SUBPIXEL_HINTING_MINIMAL
      /* Toggle the following flags only outside of monochrome mode.      */
      /* Otherwise, instructions may behave weirdly and rendering results */
      /* may differ between v35 and v40 mode, e.g., in `Times New Roman   */
      /* Bold Italic&#39;. */
      if ( SUBPIXEL_HINTING_MINIMAL &amp;&amp; exc-&gt;subpixel_hinting_lean )
      {
<span class="line-modified">!       /********************************/</span>
<span class="line-modified">!       /* HINTING FOR SUBPIXEL         */</span>
<span class="line-modified">!       /* Selector Bit:  6             */</span>
<span class="line-modified">!       /* Return Bit(s): 13            */</span>
<span class="line-modified">!       /*                              */</span>
<span class="line-modified">!       /* v40 does subpixel hinting by default. */</span>
        if ( ( args[0] &amp; 64 ) != 0 )
          K |= 1 &lt;&lt; 13;
  
<span class="line-modified">!       /********************************/</span>
<span class="line-modified">!       /* VERTICAL LCD SUBPIXELS?      */</span>
<span class="line-modified">!       /* Selector Bit:  8             */</span>
<span class="line-modified">!       /* Return Bit(s): 15            */</span>
<span class="line-modified">!       /*                              */</span>
        if ( ( args[0] &amp; 256 ) != 0 &amp;&amp; exc-&gt;vertical_lcd_lean )
          K |= 1 &lt;&lt; 15;
  
<span class="line-modified">!       /********************************/</span>
<span class="line-modified">!       /* SUBPIXEL POSITIONED?         */</span>
<span class="line-modified">!       /* Selector Bit:  10            */</span>
<span class="line-modified">!       /* Return Bit(s): 17            */</span>
<span class="line-modified">!       /*                              */</span>
<span class="line-modified">!       /* XXX: FreeType supports it, dependent on what client does? */</span>
        if ( ( args[0] &amp; 1024 ) != 0 )
          K |= 1 &lt;&lt; 17;
  
<span class="line-modified">!       /********************************/</span>
<span class="line-modified">!       /* SYMMETRICAL SMOOTHING        */</span>
<span class="line-modified">!       /* Selector Bit:  11            */</span>
<span class="line-modified">!       /* Return Bit(s): 18            */</span>
<span class="line-modified">!       /*                              */</span>
<span class="line-modified">!       /* The only smoothing method FreeType supports unless someone sets */</span>
<span class="line-modified">!       /* FT_LOAD_TARGET_MONO.                                            */</span>
        if ( ( args[0] &amp; 2048 ) != 0 &amp;&amp; exc-&gt;subpixel_hinting_lean )
          K |= 1 &lt;&lt; 18;
  
<span class="line-modified">!       /********************************/</span>
<span class="line-modified">!       /* CLEARTYPE HINTING AND        */</span>
<span class="line-modified">!       /* GRAYSCALE RENDERING          */</span>
<span class="line-modified">!       /* Selector Bit:  12            */</span>
<span class="line-modified">!       /* Return Bit(s): 19            */</span>
<span class="line-modified">!       /*                              */</span>
<span class="line-modified">!       /* Grayscale rendering is what FreeType does anyway unless someone */</span>
<span class="line-modified">!       /* sets FT_LOAD_TARGET_MONO or FT_LOAD_TARGET_LCD(_V)              */</span>
        if ( ( args[0] &amp; 4096 ) != 0 &amp;&amp; exc-&gt;grayscale_cleartype )
          K |= 1 &lt;&lt; 19;
      }
  #endif
  
<span class="line-new-header">--- 7466,102 ---</span>
      else
  #endif /* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY */
        if ( ( args[0] &amp; 1 ) != 0 )
          K = driver-&gt;interpreter_version;
  
<span class="line-modified">!     /*********************************</span>
<span class="line-modified">!      * GLYPH ROTATED</span>
<span class="line-modified">!      * Selector Bit:  1</span>
<span class="line-modified">!      * Return Bit(s): 8</span>
<span class="line-modified">!      */</span>
      if ( ( args[0] &amp; 2 ) != 0 &amp;&amp; exc-&gt;tt_metrics.rotated )
        K |= 1 &lt;&lt; 8;
  
<span class="line-modified">!     /*********************************</span>
<span class="line-modified">!      * GLYPH STRETCHED</span>
<span class="line-modified">!      * Selector Bit:  2</span>
<span class="line-modified">!      * Return Bit(s): 9</span>
<span class="line-modified">!      */</span>
      if ( ( args[0] &amp; 4 ) != 0 &amp;&amp; exc-&gt;tt_metrics.stretched )
        K |= 1 &lt;&lt; 9;
  
  #ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT
<span class="line-modified">!     /*********************************</span>
<span class="line-modified">!      * VARIATION GLYPH</span>
<span class="line-modified">!      * Selector Bit:  3</span>
<span class="line-modified">!      * Return Bit(s): 10</span>
<span class="line-modified">!      *</span>
<span class="line-modified">!      * XXX: UNDOCUMENTED!</span>
<span class="line-added">+      */</span>
      if ( (args[0] &amp; 8 ) != 0 &amp;&amp; exc-&gt;face-&gt;blend )
        K |= 1 &lt;&lt; 10;
  #endif
  
<span class="line-modified">!     /*********************************</span>
<span class="line-modified">!      * BI-LEVEL HINTING AND</span>
<span class="line-modified">!      * GRAYSCALE RENDERING</span>
<span class="line-modified">!      * Selector Bit:  5</span>
<span class="line-modified">!      * Return Bit(s): 12</span>
<span class="line-modified">!      */</span>
      if ( ( args[0] &amp; 32 ) != 0 &amp;&amp; exc-&gt;grayscale )
        K |= 1 &lt;&lt; 12;
  
  #ifdef TT_SUPPORT_SUBPIXEL_HINTING_MINIMAL
      /* Toggle the following flags only outside of monochrome mode.      */
      /* Otherwise, instructions may behave weirdly and rendering results */
      /* may differ between v35 and v40 mode, e.g., in `Times New Roman   */
      /* Bold Italic&#39;. */
      if ( SUBPIXEL_HINTING_MINIMAL &amp;&amp; exc-&gt;subpixel_hinting_lean )
      {
<span class="line-modified">!       /*********************************</span>
<span class="line-modified">!        * HINTING FOR SUBPIXEL</span>
<span class="line-modified">!        * Selector Bit:  6</span>
<span class="line-modified">!        * Return Bit(s): 13</span>
<span class="line-modified">!        *</span>
<span class="line-modified">!        * v40 does subpixel hinting by default.</span>
<span class="line-added">+        */</span>
        if ( ( args[0] &amp; 64 ) != 0 )
          K |= 1 &lt;&lt; 13;
  
<span class="line-modified">!       /*********************************</span>
<span class="line-modified">!        * VERTICAL LCD SUBPIXELS?</span>
<span class="line-modified">!        * Selector Bit:  8</span>
<span class="line-modified">!        * Return Bit(s): 15</span>
<span class="line-modified">!        */</span>
        if ( ( args[0] &amp; 256 ) != 0 &amp;&amp; exc-&gt;vertical_lcd_lean )
          K |= 1 &lt;&lt; 15;
  
<span class="line-modified">!       /*********************************</span>
<span class="line-modified">!        * SUBPIXEL POSITIONED?</span>
<span class="line-modified">!        * Selector Bit:  10</span>
<span class="line-modified">!        * Return Bit(s): 17</span>
<span class="line-modified">!        *</span>
<span class="line-modified">!        * XXX: FreeType supports it, dependent on what client does?</span>
<span class="line-added">+        */</span>
        if ( ( args[0] &amp; 1024 ) != 0 )
          K |= 1 &lt;&lt; 17;
  
<span class="line-modified">!       /*********************************</span>
<span class="line-modified">!        * SYMMETRICAL SMOOTHING</span>
<span class="line-modified">!        * Selector Bit:  11</span>
<span class="line-modified">!        * Return Bit(s): 18</span>
<span class="line-modified">!        *</span>
<span class="line-modified">!        * The only smoothing method FreeType supports unless someone sets</span>
<span class="line-modified">!        * FT_LOAD_TARGET_MONO.</span>
<span class="line-added">+        */</span>
        if ( ( args[0] &amp; 2048 ) != 0 &amp;&amp; exc-&gt;subpixel_hinting_lean )
          K |= 1 &lt;&lt; 18;
  
<span class="line-modified">!       /*********************************</span>
<span class="line-modified">!        * CLEARTYPE HINTING AND</span>
<span class="line-modified">!        * GRAYSCALE RENDERING</span>
<span class="line-modified">!        * Selector Bit:  12</span>
<span class="line-modified">!        * Return Bit(s): 19</span>
<span class="line-modified">!        *</span>
<span class="line-modified">!        * Grayscale rendering is what FreeType does anyway unless someone</span>
<span class="line-modified">!        * sets FT_LOAD_TARGET_MONO or FT_LOAD_TARGET_LCD(_V)</span>
<span class="line-added">+        */</span>
        if ( ( args[0] &amp; 4096 ) != 0 &amp;&amp; exc-&gt;grayscale_cleartype )
          K |= 1 &lt;&lt; 19;
      }
  #endif
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 7460,71 ***</span>
           exc-&gt;rasterizer_version &gt;= TT_INTERPRETER_VERSION_35 )
      {
  
        if ( exc-&gt;rasterizer_version &gt;= 37 )
        {
<span class="line-modified">!         /********************************/</span>
<span class="line-modified">!         /* HINTING FOR SUBPIXEL         */</span>
<span class="line-modified">!         /* Selector Bit:  6             */</span>
<span class="line-modified">!         /* Return Bit(s): 13            */</span>
<span class="line-modified">!         /*                              */</span>
          if ( ( args[0] &amp; 64 ) != 0 &amp;&amp; exc-&gt;subpixel_hinting )
            K |= 1 &lt;&lt; 13;
  
<span class="line-modified">!         /********************************/</span>
<span class="line-modified">!         /* COMPATIBLE WIDTHS ENABLED    */</span>
<span class="line-modified">!         /* Selector Bit:  7             */</span>
<span class="line-modified">!         /* Return Bit(s): 14            */</span>
<span class="line-modified">!         /*                              */</span>
<span class="line-modified">!         /* Functionality still needs to be added */</span>
          if ( ( args[0] &amp; 128 ) != 0 &amp;&amp; exc-&gt;compatible_widths )
            K |= 1 &lt;&lt; 14;
  
<span class="line-modified">!         /********************************/</span>
<span class="line-modified">!         /* VERTICAL LCD SUBPIXELS?      */</span>
<span class="line-modified">!         /* Selector Bit:  8             */</span>
<span class="line-modified">!         /* Return Bit(s): 15            */</span>
<span class="line-modified">!         /*                              */</span>
<span class="line-modified">!         /* Functionality still needs to be added */</span>
          if ( ( args[0] &amp; 256 ) != 0 &amp;&amp; exc-&gt;vertical_lcd )
            K |= 1 &lt;&lt; 15;
  
<span class="line-modified">!         /********************************/</span>
<span class="line-modified">!         /* HINTING FOR BGR?             */</span>
<span class="line-modified">!         /* Selector Bit:  9             */</span>
<span class="line-modified">!         /* Return Bit(s): 16            */</span>
<span class="line-modified">!         /*                              */</span>
<span class="line-modified">!         /* Functionality still needs to be added */</span>
          if ( ( args[0] &amp; 512 ) != 0 &amp;&amp; exc-&gt;bgr )
            K |= 1 &lt;&lt; 16;
  
          if ( exc-&gt;rasterizer_version &gt;= 38 )
          {
<span class="line-modified">!           /********************************/</span>
<span class="line-modified">!           /* SUBPIXEL POSITIONED?         */</span>
<span class="line-modified">!           /* Selector Bit:  10            */</span>
<span class="line-modified">!           /* Return Bit(s): 17            */</span>
<span class="line-modified">!           /*                              */</span>
<span class="line-modified">!           /* Functionality still needs to be added */</span>
            if ( ( args[0] &amp; 1024 ) != 0 &amp;&amp; exc-&gt;subpixel_positioned )
              K |= 1 &lt;&lt; 17;
  
<span class="line-modified">!           /********************************/</span>
<span class="line-modified">!           /* SYMMETRICAL SMOOTHING        */</span>
<span class="line-modified">!           /* Selector Bit:  11            */</span>
<span class="line-modified">!           /* Return Bit(s): 18            */</span>
<span class="line-modified">!           /*                              */</span>
<span class="line-modified">!           /* Functionality still needs to be added */</span>
            if ( ( args[0] &amp; 2048 ) != 0 &amp;&amp; exc-&gt;symmetrical_smoothing )
              K |= 1 &lt;&lt; 18;
  
<span class="line-modified">!           /********************************/</span>
<span class="line-modified">!           /* GRAY CLEARTYPE               */</span>
<span class="line-modified">!           /* Selector Bit:  12            */</span>
<span class="line-modified">!           /* Return Bit(s): 19            */</span>
<span class="line-modified">!           /*                              */</span>
<span class="line-modified">!           /* Functionality still needs to be added */</span>
            if ( ( args[0] &amp; 4096 ) != 0 &amp;&amp; exc-&gt;gray_cleartype )
              K |= 1 &lt;&lt; 19;
          }
        }
      }
<span class="line-new-header">--- 7571,77 ---</span>
           exc-&gt;rasterizer_version &gt;= TT_INTERPRETER_VERSION_35 )
      {
  
        if ( exc-&gt;rasterizer_version &gt;= 37 )
        {
<span class="line-modified">!         /*********************************</span>
<span class="line-modified">!          * HINTING FOR SUBPIXEL</span>
<span class="line-modified">!          * Selector Bit:  6</span>
<span class="line-modified">!          * Return Bit(s): 13</span>
<span class="line-modified">!          */</span>
          if ( ( args[0] &amp; 64 ) != 0 &amp;&amp; exc-&gt;subpixel_hinting )
            K |= 1 &lt;&lt; 13;
  
<span class="line-modified">!         /*********************************</span>
<span class="line-modified">!          * COMPATIBLE WIDTHS ENABLED</span>
<span class="line-modified">!          * Selector Bit:  7</span>
<span class="line-modified">!          * Return Bit(s): 14</span>
<span class="line-modified">!          *</span>
<span class="line-modified">!          * Functionality still needs to be added</span>
<span class="line-added">+          */</span>
          if ( ( args[0] &amp; 128 ) != 0 &amp;&amp; exc-&gt;compatible_widths )
            K |= 1 &lt;&lt; 14;
  
<span class="line-modified">!         /*********************************</span>
<span class="line-modified">!          * VERTICAL LCD SUBPIXELS?</span>
<span class="line-modified">!          * Selector Bit:  8</span>
<span class="line-modified">!          * Return Bit(s): 15</span>
<span class="line-modified">!          *</span>
<span class="line-modified">!          * Functionality still needs to be added</span>
<span class="line-added">+          */</span>
          if ( ( args[0] &amp; 256 ) != 0 &amp;&amp; exc-&gt;vertical_lcd )
            K |= 1 &lt;&lt; 15;
  
<span class="line-modified">!         /*********************************</span>
<span class="line-modified">!          * HINTING FOR BGR?</span>
<span class="line-modified">!          * Selector Bit:  9</span>
<span class="line-modified">!          * Return Bit(s): 16</span>
<span class="line-modified">!          *</span>
<span class="line-modified">!          * Functionality still needs to be added</span>
<span class="line-added">+          */</span>
          if ( ( args[0] &amp; 512 ) != 0 &amp;&amp; exc-&gt;bgr )
            K |= 1 &lt;&lt; 16;
  
          if ( exc-&gt;rasterizer_version &gt;= 38 )
          {
<span class="line-modified">!           /*********************************</span>
<span class="line-modified">!            * SUBPIXEL POSITIONED?</span>
<span class="line-modified">!            * Selector Bit:  10</span>
<span class="line-modified">!            * Return Bit(s): 17</span>
<span class="line-modified">!            *</span>
<span class="line-modified">!            * Functionality still needs to be added</span>
<span class="line-added">+            */</span>
            if ( ( args[0] &amp; 1024 ) != 0 &amp;&amp; exc-&gt;subpixel_positioned )
              K |= 1 &lt;&lt; 17;
  
<span class="line-modified">!           /*********************************</span>
<span class="line-modified">!            * SYMMETRICAL SMOOTHING</span>
<span class="line-modified">!            * Selector Bit:  11</span>
<span class="line-modified">!            * Return Bit(s): 18</span>
<span class="line-modified">!            *</span>
<span class="line-modified">!            * Functionality still needs to be added</span>
<span class="line-added">+            */</span>
            if ( ( args[0] &amp; 2048 ) != 0 &amp;&amp; exc-&gt;symmetrical_smoothing )
              K |= 1 &lt;&lt; 18;
  
<span class="line-modified">!           /*********************************</span>
<span class="line-modified">!            * GRAY CLEARTYPE</span>
<span class="line-modified">!            * Selector Bit:  12</span>
<span class="line-modified">!            * Return Bit(s): 19</span>
<span class="line-modified">!            *</span>
<span class="line-modified">!            * Functionality still needs to be added</span>
<span class="line-added">+            */</span>
            if ( ( args[0] &amp; 4096 ) != 0 &amp;&amp; exc-&gt;gray_cleartype )
              K |= 1 &lt;&lt; 19;
          }
        }
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 7535,20 ***</span>
    }
  
  
  #ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* GETVARIATION[]: get normalized variation (blend) coordinates          */</span>
<span class="line-modified">!   /* Opcode range: 0x91                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt; f2.14...                                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* XXX: UNDOCUMENTED!  There is no official documentation from Apple for */</span>
<span class="line-modified">!   /*      this bytecode instruction.  Active only if a font has GX         */</span>
<span class="line-modified">!   /*      variation axes.                                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_GETVARIATION( TT_ExecContext  exc,
                      FT_Long*        args )
    {
      FT_UInt    num_axes = exc-&gt;face-&gt;blend-&gt;num_axis;
<span class="line-new-header">--- 7652,20 ---</span>
    }
  
  
  #ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * GETVARIATION[]: get normalized variation (blend) coordinates</span>
<span class="line-modified">!    * Opcode range: 0x91</span>
<span class="line-modified">!    * Stack:        --&gt; f2.14...</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * XXX: UNDOCUMENTED!  There is no official documentation from Apple for</span>
<span class="line-modified">!    *      this bytecode instruction.  Active only if a font has GX</span>
<span class="line-modified">!    *      variation axes.</span>
<span class="line-modified">!    */</span>
    static void
    Ins_GETVARIATION( TT_ExecContext  exc,
                      FT_Long*        args )
    {
      FT_UInt    num_axes = exc-&gt;face-&gt;blend-&gt;num_axis;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 7574,19 ***</span>
          args[i] = 0;
      }
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* GETDATA[]:    no idea what this is good for                           */</span>
<span class="line-modified">!   /* Opcode range: 0x92                                                    */</span>
<span class="line-modified">!   /* Stack:        --&gt; 17                                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* XXX: UNDOCUMENTED!  There is no documentation from Apple for this     */</span>
<span class="line-modified">!   /*      very weird bytecode instruction.                                 */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static void
    Ins_GETDATA( FT_Long*  args )
    {
      args[0] = 17;
    }
<span class="line-new-header">--- 7691,19 ---</span>
          args[i] = 0;
      }
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * GETDATA[]:    no idea what this is good for</span>
<span class="line-modified">!    * Opcode range: 0x92</span>
<span class="line-modified">!    * Stack:        --&gt; 17</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * XXX: UNDOCUMENTED!  There is no documentation from Apple for this</span>
<span class="line-modified">!    *      very weird bytecode instruction.</span>
<span class="line-modified">!    */</span>
    static void
    Ins_GETDATA( FT_Long*  args )
    {
      args[0] = 17;
    }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 7630,38 ***</span>
  
      exc-&gt;error = FT_THROW( Invalid_Opcode );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* RUN                                                                   */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*  This function executes a run of opcodes.  It will exit in the        */</span>
<span class="line-modified">!   /*  following cases:                                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*  - Errors (in which case it returns FALSE).                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*  - Reaching the end of the main code range (returns TRUE).            */</span>
<span class="line-modified">!   /*    Reaching the end of a code range within a function call is an      */</span>
<span class="line-modified">!   /*    error.                                                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*  - After executing one single opcode, if the flag `Instruction_Trap&#39;  */</span>
<span class="line-modified">!   /*    is set to TRUE (returns TRUE).                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*  On exit with TRUE, test IP &lt; CodeSize to know whether it comes from  */</span>
<span class="line-modified">!   /*  an instruction trap or a normal termination.                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*  Note: The documented DEBUG opcode pops a value from the stack.  This */</span>
<span class="line-modified">!   /*        behaviour is unsupported; here a DEBUG opcode is always an     */</span>
<span class="line-modified">!   /*        error.                                                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* THIS IS THE INTERPRETER&#39;S MAIN LOOP.                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*************************************************************************/</span>
  
  
    /* documentation is in ttinterp.h */
  
    FT_EXPORT_DEF( FT_Error )
<span class="line-new-header">--- 7747,38 ---</span>
  
      exc-&gt;error = FT_THROW( Invalid_Opcode );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * RUN</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * This function executes a run of opcodes.  It will exit in the</span>
<span class="line-modified">!    * following cases:</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * - Errors (in which case it returns FALSE).</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * - Reaching the end of the main code range (returns TRUE).</span>
<span class="line-modified">!    *   Reaching the end of a code range within a function call is an</span>
<span class="line-modified">!    *   error.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * - After executing one single opcode, if the flag `Instruction_Trap&#39;</span>
<span class="line-modified">!    *   is set to TRUE (returns TRUE).</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * On exit with TRUE, test IP &lt; CodeSize to know whether it comes from</span>
<span class="line-modified">!    * an instruction trap or a normal termination.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * Note: The documented DEBUG opcode pops a value from the stack.  This</span>
<span class="line-modified">!    *       behaviour is unsupported; here a DEBUG opcode is always an</span>
<span class="line-modified">!    *       error.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * THIS IS THE INTERPRETER&#39;S MAIN LOOP.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    */</span>
  
  
    /* documentation is in ttinterp.h */
  
    FT_EXPORT_DEF( FT_Error )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 7689,20 ***</span>
      exc-&gt;iup_called = FALSE;
  #endif /* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY */
  
  #ifdef TT_SUPPORT_SUBPIXEL_HINTING_MINIMAL
      /*
<span class="line-modified">!      *  Toggle backward compatibility according to what font wants, except</span>
<span class="line-modified">!      *  when</span>
       *
<span class="line-modified">!      *  1) we have a `tricky&#39; font that heavily relies on the interpreter to</span>
<span class="line-modified">!      *     render glyphs correctly, for example DFKai-SB, or</span>
<span class="line-modified">!      *  2) FT_RENDER_MODE_MONO (i.e, monochome rendering) is requested.</span>
       *
<span class="line-modified">!      *  In those cases, backward compatibility needs to be turned off to get</span>
<span class="line-modified">!      *  correct rendering.  The rendering is then completely up to the</span>
<span class="line-modified">!      *  font&#39;s programming.</span>
       *
       */
      if ( SUBPIXEL_HINTING_MINIMAL          &amp;&amp;
           exc-&gt;subpixel_hinting_lean        &amp;&amp;
           !FT_IS_TRICKY( &amp;exc-&gt;face-&gt;root ) )
<span class="line-new-header">--- 7806,20 ---</span>
      exc-&gt;iup_called = FALSE;
  #endif /* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY */
  
  #ifdef TT_SUPPORT_SUBPIXEL_HINTING_MINIMAL
      /*
<span class="line-modified">!      * Toggle backward compatibility according to what font wants, except</span>
<span class="line-modified">!      * when</span>
       *
<span class="line-modified">!      * 1) we have a `tricky&#39; font that heavily relies on the interpreter to</span>
<span class="line-modified">!      *    render glyphs correctly, for example DFKai-SB, or</span>
<span class="line-modified">!      * 2) FT_RENDER_MODE_MONO (i.e, monochome rendering) is requested.</span>
       *
<span class="line-modified">!      * In those cases, backward compatibility needs to be turned off to get</span>
<span class="line-modified">!      * correct rendering.  The rendering is then completely up to the</span>
<span class="line-modified">!      * font&#39;s programming.</span>
       *
       */
      if ( SUBPIXEL_HINTING_MINIMAL          &amp;&amp;
           exc-&gt;subpixel_hinting_lean        &amp;&amp;
           !FT_IS_TRICKY( &amp;exc-&gt;face-&gt;root ) )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 7799,11 ***</span>
  
          /* if tracing level is 7, show current code position */
          /* and the first few stack elements also             */
          FT_TRACE6(( &quot;  &quot; ));
          FT_TRACE7(( &quot;%06d &quot;, exc-&gt;IP ));
<span class="line-modified">!         FT_TRACE6(( opcode_name[exc-&gt;opcode] + 2 ));</span>
          FT_TRACE7(( &quot;%*s&quot;, *opcode_name[exc-&gt;opcode] == &#39;A&#39;
                                ? 2
                                : 12 - ( *opcode_name[exc-&gt;opcode] - &#39;0&#39; ),
                                &quot;#&quot; ));
          for ( n = 1; n &lt;= cnt; n++ )
<span class="line-new-header">--- 7916,11 ---</span>
  
          /* if tracing level is 7, show current code position */
          /* and the first few stack elements also             */
          FT_TRACE6(( &quot;  &quot; ));
          FT_TRACE7(( &quot;%06d &quot;, exc-&gt;IP ));
<span class="line-modified">!         FT_TRACE6(( &quot;%s&quot;, opcode_name[exc-&gt;opcode] + 2 ));</span>
          FT_TRACE7(( &quot;%*s&quot;, *opcode_name[exc-&gt;opcode] == &#39;A&#39;
                                ? 2
                                : 12 - ( *opcode_name[exc-&gt;opcode] - &#39;0&#39; ),
                                &quot;#&quot; ));
          for ( n = 1; n &lt;= cnt; n++ )
</pre>
<center><a href="ttgxvar.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ttinterp.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>