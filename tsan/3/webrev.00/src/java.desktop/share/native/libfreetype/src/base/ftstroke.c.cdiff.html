<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/native/libfreetype/src/base/ftstroke.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ftstream.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ftsynth.c.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/base/ftstroke.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,40 ***</span>
<span class="line-modified">! /***************************************************************************/</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  ftstroke.c                                                             */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*    FreeType path stroker (body).                                        */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  Copyright 2002-2018 by                                                 */</span>
<span class="line-modified">! /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified">! /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified">! /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified">! /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified">! /*  understand and accept it fully.                                        */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /***************************************************************************/</span>
  
  
  #include &lt;ft2build.h&gt;
  #include FT_STROKER_H
  #include FT_TRIGONOMETRY_H
  #include FT_OUTLINE_H
  #include FT_INTERNAL_MEMORY_H
  #include FT_INTERNAL_DEBUG_H
  #include FT_INTERNAL_OBJECTS_H
  
<span class="line-removed">- #include &quot;basepic.h&quot;</span>
  
<span class="line-modified">! </span>
<span class="line-modified">!   /* declare an extern to access `ft_outline_glyph_class&#39; globally     */</span>
<span class="line-removed">-   /* allocated  in `ftglyph.c&#39;, and use the FT_OUTLINE_GLYPH_CLASS_GET */</span>
<span class="line-removed">-   /* macro to access it when FT_CONFIG_OPTION_PIC is defined           */</span>
<span class="line-removed">- #ifndef FT_CONFIG_OPTION_PIC</span>
    FT_CALLBACK_TABLE const FT_Glyph_Class  ft_outline_glyph_class;
<span class="line-removed">- #endif</span>
  
  
    /* documentation is in ftstroke.h */
  
    FT_EXPORT_DEF( FT_StrokerBorder )
<span class="line-new-header">--- 1,35 ---</span>
<span class="line-modified">! /****************************************************************************</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * ftstroke.c</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  *   FreeType path stroker (body).</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * Copyright (C) 2002-2019 by</span>
<span class="line-modified">!  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified">!  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified">!  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified">!  * this file you indicate that you have read the license and</span>
<span class="line-modified">!  * understand and accept it fully.</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  */</span>
  
  
  #include &lt;ft2build.h&gt;
  #include FT_STROKER_H
  #include FT_TRIGONOMETRY_H
  #include FT_OUTLINE_H
  #include FT_INTERNAL_MEMORY_H
  #include FT_INTERNAL_DEBUG_H
  #include FT_INTERNAL_OBJECTS_H
  
  
<span class="line-modified">!   /* declare an extern to access `ft_outline_glyph_class&#39; globally */</span>
<span class="line-modified">!   /* allocated  in `ftglyph.c&#39;                                     */</span>
    FT_CALLBACK_TABLE const FT_Glyph_Class  ft_outline_glyph_class;
  
  
    /* documentation is in ftstroke.h */
  
    FT_EXPORT_DEF( FT_StrokerBorder )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 89,20 ***</span>
    {
      FT_Pos  a, b;
  
  
      base[4].x = base[2].x;
<span class="line-modified">!     b = base[1].x;</span>
<span class="line-modified">!     a = base[3].x = ( base[2].x + b ) / 2;</span>
<span class="line-modified">!     b = base[1].x = ( base[0].x + b ) / 2;</span>
<span class="line-modified">!     base[2].x = ( a + b ) / 2;</span>
  
      base[4].y = base[2].y;
<span class="line-modified">!     b = base[1].y;</span>
<span class="line-modified">!     a = base[3].y = ( base[2].y + b ) / 2;</span>
<span class="line-modified">!     b = base[1].y = ( base[0].y + b ) / 2;</span>
<span class="line-modified">!     base[2].y = ( a + b ) / 2;</span>
    }
  
  
    static FT_Bool
    ft_conic_is_small_enough( FT_Vector*  base,
<span class="line-new-header">--- 84,22 ---</span>
    {
      FT_Pos  a, b;
  
  
      base[4].x = base[2].x;
<span class="line-modified">!     a = base[0].x + base[1].x;</span>
<span class="line-modified">!     b = base[1].x + base[2].x;</span>
<span class="line-modified">!     base[3].x = b &gt;&gt; 1;</span>
<span class="line-modified">!     base[2].x = ( a + b ) &gt;&gt; 2;</span>
<span class="line-added">+     base[1].x = a &gt;&gt; 1;</span>
  
      base[4].y = base[2].y;
<span class="line-modified">!     a = base[0].y + base[1].y;</span>
<span class="line-modified">!     b = base[1].y + base[2].y;</span>
<span class="line-modified">!     base[3].y = b &gt;&gt; 1;</span>
<span class="line-modified">!     base[2].y = ( a + b ) &gt;&gt; 2;</span>
<span class="line-added">+     base[1].y = a &gt;&gt; 1;</span>
    }
  
  
    static FT_Bool
    ft_conic_is_small_enough( FT_Vector*  base,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 156,32 ***</span>
  
  
    static void
    ft_cubic_split( FT_Vector*  base )
    {
<span class="line-modified">!     FT_Pos  a, b, c, d;</span>
  
  
      base[6].x = base[3].x;
<span class="line-modified">!     c = base[1].x;</span>
<span class="line-modified">!     d = base[2].x;</span>
<span class="line-modified">!     base[1].x = a = ( base[0].x + c ) / 2;</span>
<span class="line-modified">!     base[5].x = b = ( base[3].x + d ) / 2;</span>
<span class="line-modified">!     c = ( c + d ) / 2;</span>
<span class="line-modified">!     base[2].x = a = ( a + c ) / 2;</span>
<span class="line-modified">!     base[4].x = b = ( b + c ) / 2;</span>
<span class="line-modified">!     base[3].x = ( a + b ) / 2;</span>
  
      base[6].y = base[3].y;
<span class="line-modified">!     c = base[1].y;</span>
<span class="line-modified">!     d = base[2].y;</span>
<span class="line-modified">!     base[1].y = a = ( base[0].y + c ) / 2;</span>
<span class="line-modified">!     base[5].y = b = ( base[3].y + d ) / 2;</span>
<span class="line-modified">!     c = ( c + d ) / 2;</span>
<span class="line-modified">!     base[2].y = a = ( a + c ) / 2;</span>
<span class="line-modified">!     base[4].y = b = ( b + c ) / 2;</span>
<span class="line-modified">!     base[3].y = ( a + b ) / 2;</span>
    }
  
  
    /* Return the average of `angle1&#39; and `angle2&#39;.            */
    /* This gives correct result even if `angle1&#39; and `angle2&#39; */
<span class="line-new-header">--- 153,36 ---</span>
  
  
    static void
    ft_cubic_split( FT_Vector*  base )
    {
<span class="line-modified">!     FT_Pos  a, b, c;</span>
  
  
      base[6].x = base[3].x;
<span class="line-modified">!     a = base[0].x + base[1].x;</span>
<span class="line-modified">!     b = base[1].x + base[2].x;</span>
<span class="line-modified">!     c = base[2].x + base[3].x;</span>
<span class="line-modified">!     base[5].x = c &gt;&gt; 1;</span>
<span class="line-modified">!     c += b;</span>
<span class="line-modified">!     base[4].x = c &gt;&gt; 2;</span>
<span class="line-modified">!     base[1].x = a &gt;&gt; 1;</span>
<span class="line-modified">!     a += b;</span>
<span class="line-added">+     base[2].x = a &gt;&gt; 2;</span>
<span class="line-added">+     base[3].x = ( a + c ) &gt;&gt; 3;</span>
  
      base[6].y = base[3].y;
<span class="line-modified">!     a = base[0].y + base[1].y;</span>
<span class="line-modified">!     b = base[1].y + base[2].y;</span>
<span class="line-modified">!     c = base[2].y + base[3].y;</span>
<span class="line-modified">!     base[5].y = c &gt;&gt; 1;</span>
<span class="line-modified">!     c += b;</span>
<span class="line-modified">!     base[4].y = c &gt;&gt; 2;</span>
<span class="line-modified">!     base[1].y = a &gt;&gt; 1;</span>
<span class="line-modified">!     a += b;</span>
<span class="line-added">+     base[2].y = a &gt;&gt; 2;</span>
<span class="line-added">+     base[3].y = ( a + c ) &gt;&gt; 3;</span>
    }
  
  
    /* Return the average of `angle1&#39; and `angle2&#39;.            */
    /* This gives correct result even if `angle1&#39; and `angle2&#39; */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 370,10 ***</span>
<span class="line-new-header">--- 371,11 ---</span>
      {
        /* copy the last point to the start of this sub-path, since */
        /* it contains the `adjusted&#39; starting coordinates          */
        border-&gt;num_points    = --count;
        border-&gt;points[start] = border-&gt;points[count];
<span class="line-added">+       border-&gt;tags[start]   = border-&gt;tags[count];</span>
  
        if ( reverse )
        {
          /* reverse the points */
          {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 434,12 ***</span>
        /* move last point */
        border-&gt;points[border-&gt;num_points - 1] = *to;
      }
      else
      {
<span class="line-modified">!       /* don&#39;t add zero-length lineto */</span>
<span class="line-modified">!       if ( border-&gt;num_points &gt; 0                                          &amp;&amp;</span>
             FT_IS_SMALL( border-&gt;points[border-&gt;num_points - 1].x - to-&gt;x ) &amp;&amp;
             FT_IS_SMALL( border-&gt;points[border-&gt;num_points - 1].y - to-&gt;y ) )
          return error;
  
        /* add one point */
<span class="line-new-header">--- 436,12 ---</span>
        /* move last point */
        border-&gt;points[border-&gt;num_points - 1] = *to;
      }
      else
      {
<span class="line-modified">!       /* don&#39;t add zero-length lineto, but always add moveto */</span>
<span class="line-modified">!       if ( border-&gt;num_points &gt; (FT_UInt)border-&gt;start                     &amp;&amp;</span>
             FT_IS_SMALL( border-&gt;points[border-&gt;num_points - 1].x - to-&gt;x ) &amp;&amp;
             FT_IS_SMALL( border-&gt;points[border-&gt;num_points - 1].y - to-&gt;y ) )
          return error;
  
        /* add one point */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2085,12 ***</span>
  
  
    /* documentation is in ftstroke.h */
  
    /*
<span class="line-modified">!    *  The following is very similar to FT_Outline_Decompose, except</span>
<span class="line-modified">!    *  that we do support opened paths, and do not scale the outline.</span>
     */
    FT_EXPORT_DEF( FT_Error )
    FT_Stroker_ParseOutline( FT_Stroker   stroker,
                             FT_Outline*  outline,
                             FT_Bool      opened )
<span class="line-new-header">--- 2087,12 ---</span>
  
  
    /* documentation is in ftstroke.h */
  
    /*
<span class="line-modified">!    * The following is very similar to FT_Outline_Decompose, except</span>
<span class="line-modified">!    * that we do support opened paths, and do not scale the outline.</span>
     */
    FT_EXPORT_DEF( FT_Error )
    FT_Stroker_ParseOutline( FT_Stroker   stroker,
                             FT_Outline*  outline,
                             FT_Bool      opened )
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2304,21 ***</span>
                     FT_Bool      destroy )
    {
      FT_Error  error = FT_ERR( Invalid_Argument );
      FT_Glyph  glyph = NULL;
  
<span class="line-removed">-     /* for FT_OUTLINE_GLYPH_CLASS_GET (in PIC mode) */</span>
<span class="line-removed">-     FT_Library  library = stroker-&gt;library;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     FT_UNUSED( library );</span>
<span class="line-removed">- </span>
  
      if ( !pglyph )
        goto Exit;
  
      glyph = *pglyph;
<span class="line-modified">!     if ( !glyph || glyph-&gt;clazz != FT_OUTLINE_GLYPH_CLASS_GET )</span>
        goto Exit;
  
      {
        FT_Glyph  copy;
  
<span class="line-new-header">--- 2306,16 ---</span>
                     FT_Bool      destroy )
    {
      FT_Error  error = FT_ERR( Invalid_Argument );
      FT_Glyph  glyph = NULL;
  
  
      if ( !pglyph )
        goto Exit;
  
      glyph = *pglyph;
<span class="line-modified">!     if ( !glyph || glyph-&gt;clazz != &amp;ft_outline_glyph_class )</span>
        goto Exit;
  
      {
        FT_Glyph  copy;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2384,21 ***</span>
                           FT_Bool      destroy )
    {
      FT_Error  error = FT_ERR( Invalid_Argument );
      FT_Glyph  glyph = NULL;
  
<span class="line-removed">-     /* for FT_OUTLINE_GLYPH_CLASS_GET (in PIC mode) */</span>
<span class="line-removed">-     FT_Library  library = stroker-&gt;library;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     FT_UNUSED( library );</span>
<span class="line-removed">- </span>
  
      if ( !pglyph )
        goto Exit;
  
      glyph = *pglyph;
<span class="line-modified">!     if ( !glyph || glyph-&gt;clazz != FT_OUTLINE_GLYPH_CLASS_GET )</span>
        goto Exit;
  
      {
        FT_Glyph  copy;
  
<span class="line-new-header">--- 2381,16 ---</span>
                           FT_Bool      destroy )
    {
      FT_Error  error = FT_ERR( Invalid_Argument );
      FT_Glyph  glyph = NULL;
  
  
      if ( !pglyph )
        goto Exit;
  
      glyph = *pglyph;
<span class="line-modified">!     if ( !glyph || glyph-&gt;clazz != &amp;ft_outline_glyph_class )</span>
        goto Exit;
  
      {
        FT_Glyph  copy;
  
</pre>
<center><a href="ftstream.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ftsynth.c.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>