<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/native/libfreetype/src/type1/t1driver.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="t1afm.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="t1driver.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/type1/t1driver.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
<span class="line-modified">  1 /***************************************************************************/</span>
<span class="line-modified">  2 /*                                                                         */</span>
<span class="line-modified">  3 /*  t1driver.c                                                             */</span>
<span class="line-modified">  4 /*                                                                         */</span>
<span class="line-modified">  5 /*    Type 1 driver interface (body).                                      */</span>
<span class="line-modified">  6 /*                                                                         */</span>
<span class="line-modified">  7 /*  Copyright 1996-2018 by                                                 */</span>
<span class="line-modified">  8 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="line-modified">  9 /*                                                                         */</span>
<span class="line-modified"> 10 /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified"> 11 /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified"> 12 /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified"> 13 /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified"> 14 /*  understand and accept it fully.                                        */</span>
<span class="line-modified"> 15 /*                                                                         */</span>
<span class="line-modified"> 16 /***************************************************************************/</span>
 17 
 18 
 19 #include &lt;ft2build.h&gt;
 20 #include &quot;t1driver.h&quot;
 21 #include &quot;t1gload.h&quot;
 22 #include &quot;t1load.h&quot;
 23 
 24 #include &quot;t1errors.h&quot;
 25 
 26 #ifndef T1_CONFIG_OPTION_NO_AFM
 27 #include &quot;t1afm.h&quot;
 28 #endif
 29 
 30 #include FT_INTERNAL_DEBUG_H
 31 #include FT_INTERNAL_STREAM_H
 32 #include FT_INTERNAL_HASH_H
 33 #include FT_INTERNAL_POSTSCRIPT_PROPS_H
 34 #include FT_DRIVER_H
 35 
 36 #include FT_SERVICE_MULTIPLE_MASTERS_H
 37 #include FT_SERVICE_GLYPH_DICT_H
 38 #include FT_SERVICE_FONT_FORMAT_H
 39 #include FT_SERVICE_POSTSCRIPT_NAME_H
 40 #include FT_SERVICE_POSTSCRIPT_CMAPS_H
 41 #include FT_SERVICE_POSTSCRIPT_INFO_H
 42 #include FT_SERVICE_PROPERTIES_H
 43 #include FT_SERVICE_KERNING_H
 44 
 45 
<span class="line-modified"> 46   /*************************************************************************/</span>
<span class="line-modified"> 47   /*                                                                       */</span>
<span class="line-modified"> 48   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="line-modified"> 49   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="line-modified"> 50   /* messages during execution.                                            */</span>
<span class="line-modified"> 51   /*                                                                       */</span>
 52 #undef  FT_COMPONENT
<span class="line-modified"> 53 #define FT_COMPONENT  trace_t1driver</span>
 54 
<span class="line-modified"> 55  /*</span>
<span class="line-modified"> 56   *  GLYPH DICT SERVICE</span>
<span class="line-modified"> 57   *</span>
<span class="line-modified"> 58   */</span>
 59 
 60   static FT_Error
 61   t1_get_glyph_name( T1_Face     face,
 62                      FT_UInt     glyph_index,
 63                      FT_Pointer  buffer,
 64                      FT_UInt     buffer_max )
 65   {
 66     FT_STRCPYN( buffer, face-&gt;type1.glyph_names[glyph_index], buffer_max );
 67 
 68     return FT_Err_Ok;
 69   }
 70 
 71 
 72   static FT_UInt
<span class="line-modified"> 73   t1_get_name_index( T1_Face     face,</span>
<span class="line-modified"> 74                      FT_String*  glyph_name )</span>
 75   {
 76     FT_Int  i;
 77 
 78 
 79     for ( i = 0; i &lt; face-&gt;type1.num_glyphs; i++ )
 80     {
 81       FT_String*  gname = face-&gt;type1.glyph_names[i];
 82 
 83 
 84       if ( !ft_strcmp( glyph_name, gname ) )
 85         return (FT_UInt)i;
 86     }
 87 
 88     return 0;
 89   }
 90 
 91 
 92   static const FT_Service_GlyphDictRec  t1_service_glyph_dict =
 93   {
 94     (FT_GlyphDict_GetNameFunc)  t1_get_glyph_name,    /* get_name   */
 95     (FT_GlyphDict_NameIndexFunc)t1_get_name_index     /* name_index */
 96   };
 97 
 98 
 99   /*
<span class="line-modified">100    *  POSTSCRIPT NAME SERVICE</span>
101    *
102    */
103 
104   static const char*
105   t1_get_ps_name( T1_Face  face )
106   {
107     return (const char*) face-&gt;type1.font_name;
108   }
109 
110 
111   static const FT_Service_PsFontNameRec  t1_service_ps_name =
112   {
113     (FT_PsName_GetFunc)t1_get_ps_name     /* get_ps_font_name */
114   };
115 
116 
117   /*
<span class="line-modified">118    *  MULTIPLE MASTERS SERVICE</span>
119    *
120    */
121 
122 #ifndef T1_CONFIG_OPTION_NO_MM_SUPPORT
123   static const FT_Service_MultiMastersRec  t1_service_multi_masters =
124   {
<span class="line-modified">125     (FT_Get_MM_Func)        T1_Get_Multi_Master,   /* get_mm         */</span>
<span class="line-modified">126     (FT_Set_MM_Design_Func) T1_Set_MM_Design,      /* set_mm_design  */</span>
<span class="line-modified">127     (FT_Set_MM_Blend_Func)  T1_Set_MM_Blend,       /* set_mm_blend   */</span>
<span class="line-modified">128     (FT_Get_MM_Blend_Func)  T1_Get_MM_Blend,       /* get_mm_blend   */</span>
<span class="line-modified">129     (FT_Get_MM_Var_Func)    T1_Get_MM_Var,         /* get_mm_var     */</span>
<span class="line-modified">130     (FT_Set_Var_Design_Func)T1_Set_Var_Design,     /* set_var_design */</span>
<span class="line-modified">131     (FT_Get_Var_Design_Func)T1_Get_Var_Design,     /* get_var_design */</span>
<span class="line-modified">132     (FT_Set_Instance_Func)  T1_Reset_MM_Blend,     /* set_instance   */</span>
<span class="line-modified">133 </span>
<span class="line-modified">134     (FT_Get_Var_Blend_Func) NULL,                  /* get_var_blend  */</span>
<span class="line-modified">135     (FT_Done_Blend_Func)    T1_Done_Blend          /* done_blend     */</span>


136   };
137 #endif
138 
139 
140   /*
<span class="line-modified">141    *  POSTSCRIPT INFO SERVICE</span>
142    *
143    */
144 
145   static FT_Error
146   t1_ps_get_font_info( FT_Face          face,
147                        PS_FontInfoRec*  afont_info )
148   {
149     *afont_info = ((T1_Face)face)-&gt;type1.font_info;
150 
151     return FT_Err_Ok;
152   }
153 
154 
155   static FT_Error
156   t1_ps_get_font_extra( FT_Face           face,
157                         PS_FontExtraRec*  afont_extra )
158   {
159     *afont_extra = ((T1_Face)face)-&gt;type1.font_extra;
160 
161     return FT_Err_Ok;
</pre>
<hr />
<pre>
253             break;
254           case 2:
255             val = type1-&gt;font_bbox.xMax;
256             break;
257           case 3:
258             val = type1-&gt;font_bbox.yMax;
259             break;
260           }
261           *((FT_Fixed *)value) = val;
262         }
263       }
264       break;
265 
266     case PS_DICT_PAINT_TYPE:
267       retval = sizeof ( type1-&gt;paint_type );
268       if ( value &amp;&amp; value_len &gt;= retval )
269         *((FT_Byte *)value) = type1-&gt;paint_type;
270       break;
271 
272     case PS_DICT_FONT_NAME:
<span class="line-modified">273       retval = ft_strlen( type1-&gt;font_name ) + 1;</span>
<span class="line-modified">274       if ( value &amp;&amp; value_len &gt;= retval )</span>
<span class="line-modified">275         ft_memcpy( value, (void *)( type1-&gt;font_name ), retval );</span>



276       break;
277 
278     case PS_DICT_UNIQUE_ID:
279       retval = sizeof ( type1-&gt;private_dict.unique_id );
280       if ( value &amp;&amp; value_len &gt;= retval )
281         *((FT_Int *)value) = type1-&gt;private_dict.unique_id;
282       break;
283 
284     case PS_DICT_NUM_CHAR_STRINGS:
285       retval = sizeof ( type1-&gt;num_glyphs );
286       if ( value &amp;&amp; value_len &gt;= retval )
287         *((FT_Int *)value) = type1-&gt;num_glyphs;
288       break;
289 
290     case PS_DICT_CHAR_STRING_KEY:
291       if ( idx &lt; (FT_UInt)type1-&gt;num_glyphs )
292       {
293         retval = ft_strlen( type1-&gt;glyph_names[idx] ) + 1;
294         if ( value &amp;&amp; value_len &gt;= retval )
295         {
</pre>
<hr />
<pre>
345 
346         if ( type1-&gt;subrs_hash )
347         {
348           /* convert subr index to array index */
349           size_t*  val = ft_hash_num_lookup( (FT_Int)idx,
350                                              type1-&gt;subrs_hash );
351 
352 
353           if ( val )
354           {
355             idx = *val;
356             ok  = 1;
357           }
358         }
359         else
360         {
361           if ( idx &lt; (FT_UInt)type1-&gt;num_subrs )
362             ok = 1;
363         }
364 
<span class="line-modified">365         if ( ok )</span>
366         {
367           retval = type1-&gt;subrs_len[idx] + 1;
368           if ( value &amp;&amp; value_len &gt;= retval )
369           {
370             ft_memcpy( value, (void *)( type1-&gt;subrs[idx] ), retval - 1 );
371             ((FT_Char *)value)[retval - 1] = (FT_Char)&#39;\0&#39;;
372           }
373         }
374       }
375       break;
376 
377     case PS_DICT_STD_HW:
378       retval = sizeof ( type1-&gt;private_dict.standard_width[0] );
379       if ( value &amp;&amp; value_len &gt;= retval )
380         *((FT_UShort *)value) = type1-&gt;private_dict.standard_width[0];
381       break;
382 
383     case PS_DICT_STD_VW:
384       retval = sizeof ( type1-&gt;private_dict.standard_height[0] );
385       if ( value &amp;&amp; value_len &gt;= retval )
</pre>
<hr />
<pre>
542 
543     case PS_DICT_UNDERLINE_POSITION:
544       retval = sizeof ( type1-&gt;font_info.underline_position );
545       if ( value &amp;&amp; value_len &gt;= retval )
546         *((FT_Short *)value) = type1-&gt;font_info.underline_position;
547       break;
548 
549     case PS_DICT_UNDERLINE_THICKNESS:
550       retval = sizeof ( type1-&gt;font_info.underline_thickness );
551       if ( value &amp;&amp; value_len &gt;= retval )
552         *((FT_UShort *)value) = type1-&gt;font_info.underline_thickness;
553       break;
554 
555     case PS_DICT_FS_TYPE:
556       retval = sizeof ( type1-&gt;font_extra.fs_type );
557       if ( value &amp;&amp; value_len &gt;= retval )
558         *((FT_UShort *)value) = type1-&gt;font_extra.fs_type;
559       break;
560 
561     case PS_DICT_VERSION:
<span class="line-modified">562       retval = ft_strlen( type1-&gt;font_info.version ) + 1;</span>
<span class="line-modified">563       if ( value &amp;&amp; value_len &gt;= retval )</span>
<span class="line-modified">564         ft_memcpy( value, (void *)( type1-&gt;font_info.version ), retval );</span>



565       break;
566 
567     case PS_DICT_NOTICE:
<span class="line-modified">568       retval = ft_strlen( type1-&gt;font_info.notice ) + 1;</span>
<span class="line-modified">569       if ( value &amp;&amp; value_len &gt;= retval )</span>
<span class="line-modified">570         ft_memcpy( value, (void *)( type1-&gt;font_info.notice ), retval );</span>



571       break;
572 
573     case PS_DICT_FULL_NAME:
<span class="line-modified">574       retval = ft_strlen( type1-&gt;font_info.full_name ) + 1;</span>
<span class="line-modified">575       if ( value &amp;&amp; value_len &gt;= retval )</span>
<span class="line-modified">576         ft_memcpy( value, (void *)( type1-&gt;font_info.full_name ), retval );</span>



577       break;
578 
579     case PS_DICT_FAMILY_NAME:
<span class="line-modified">580       retval = ft_strlen( type1-&gt;font_info.family_name ) + 1;</span>
<span class="line-modified">581       if ( value &amp;&amp; value_len &gt;= retval )</span>
<span class="line-modified">582         ft_memcpy( value, (void *)( type1-&gt;font_info.family_name ), retval );</span>




583       break;
584 
585     case PS_DICT_WEIGHT:
<span class="line-modified">586       retval = ft_strlen( type1-&gt;font_info.weight ) + 1;</span>
<span class="line-modified">587       if ( value &amp;&amp; value_len &gt;= retval )</span>
<span class="line-modified">588         ft_memcpy( value, (void *)( type1-&gt;font_info.weight ), retval );</span>



589       break;
590 
591     case PS_DICT_ITALIC_ANGLE:
592       retval = sizeof ( type1-&gt;font_info.italic_angle );
593       if ( value &amp;&amp; value_len &gt;= retval )
594         *((FT_Long *)value) = type1-&gt;font_info.italic_angle;
595       break;
596     }
597 
598     return retval == 0 ? -1 : (FT_Long)retval;
599   }
600 
601 
602   static const FT_Service_PsInfoRec  t1_service_ps_info =
603   {
604     (PS_GetFontInfoFunc)   t1_ps_get_font_info,    /* ps_get_font_info    */
605     (PS_GetFontExtraFunc)  t1_ps_get_font_extra,   /* ps_get_font_extra   */
606     (PS_HasGlyphNamesFunc) t1_ps_has_glyph_names,  /* ps_has_glyph_names  */
607     (PS_GetFontPrivateFunc)t1_ps_get_font_private, /* ps_get_font_private */
608     (PS_GetFontValueFunc)  t1_ps_get_font_value,   /* ps_get_font_value   */
609   };
610 
611 
612 #ifndef T1_CONFIG_OPTION_NO_AFM
613   static const FT_Service_KerningRec  t1_service_kerning =
614   {
615     T1_Get_Track_Kerning,       /* get_track */
616   };
617 #endif
618 
619 
620   /*
<span class="line-modified">621    *  PROPERTY SERVICE</span>
622    *
623    */
624 
625   FT_DEFINE_SERVICE_PROPERTIESREC(
626     t1_service_properties,
627 
628     (FT_Properties_SetFunc)ps_property_set,      /* set_property */
629     (FT_Properties_GetFunc)ps_property_get )     /* get_property */
630 
631 
632   /*
<span class="line-modified">633    *  SERVICE LIST</span>
634    *
635    */
636 
637   static const FT_ServiceDescRec  t1_services[] =
638   {
639     { FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;t1_service_ps_name },
640     { FT_SERVICE_ID_GLYPH_DICT,           &amp;t1_service_glyph_dict },
641     { FT_SERVICE_ID_FONT_FORMAT,          FT_FONT_FORMAT_TYPE_1 },
642     { FT_SERVICE_ID_POSTSCRIPT_INFO,      &amp;t1_service_ps_info },
643     { FT_SERVICE_ID_PROPERTIES,           &amp;t1_service_properties },
644 
645 #ifndef T1_CONFIG_OPTION_NO_AFM
646     { FT_SERVICE_ID_KERNING,              &amp;t1_service_kerning },
647 #endif
648 
649 #ifndef T1_CONFIG_OPTION_NO_MM_SUPPORT
650     { FT_SERVICE_ID_MULTI_MASTERS,        &amp;t1_service_multi_masters },
651 #endif
652     { NULL, NULL }
653   };
654 
655 
656   FT_CALLBACK_DEF( FT_Module_Interface )
657   Get_Interface( FT_Module         module,
658                  const FT_String*  t1_interface )
659   {
660     FT_UNUSED( module );
661 
662     return ft_service_list_lookup( t1_services, t1_interface );
663   }
664 
665 
666 #ifndef T1_CONFIG_OPTION_NO_AFM
667 
<span class="line-modified">668   /*************************************************************************/</span>
<span class="line-modified">669   /*                                                                       */</span>
<span class="line-modified">670   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">671   /*    Get_Kerning                                                        */</span>
<span class="line-modified">672   /*                                                                       */</span>
<span class="line-modified">673   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">674   /*    A driver method used to return the kerning vector between two      */</span>
<span class="line-modified">675   /*    glyphs of the same face.                                           */</span>
<span class="line-modified">676   /*                                                                       */</span>
<span class="line-modified">677   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">678   /*    face        :: A handle to the source face object.                 */</span>
<span class="line-modified">679   /*                                                                       */</span>
<span class="line-modified">680   /*    left_glyph  :: The index of the left glyph in the kern pair.       */</span>
<span class="line-modified">681   /*                                                                       */</span>
<span class="line-modified">682   /*    right_glyph :: The index of the right glyph in the kern pair.      */</span>
<span class="line-modified">683   /*                                                                       */</span>
<span class="line-modified">684   /* &lt;Output&gt;                                                              */</span>
<span class="line-modified">685   /*    kerning     :: The kerning vector.  This is in font units for      */</span>
<span class="line-modified">686   /*                   scalable formats, and in pixels for fixed-sizes     */</span>
<span class="line-modified">687   /*                   formats.                                            */</span>
<span class="line-modified">688   /*                                                                       */</span>
<span class="line-modified">689   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">690   /*    FreeType error code.  0 means success.                             */</span>
<span class="line-modified">691   /*                                                                       */</span>
<span class="line-modified">692   /* &lt;Note&gt;                                                                */</span>
<span class="line-modified">693   /*    Only horizontal layouts (left-to-right &amp; right-to-left) are        */</span>
<span class="line-modified">694   /*    supported by this function.  Other layouts, or more sophisticated  */</span>
<span class="line-modified">695   /*    kernings are out of scope of this method (the basic driver         */</span>
<span class="line-modified">696   /*    interface is meant to be simple).                                  */</span>
<span class="line-modified">697   /*                                                                       */</span>
<span class="line-modified">698   /*    They can be implemented by format-specific interfaces.             */</span>
<span class="line-modified">699   /*                                                                       */</span>




700   static FT_Error
701   Get_Kerning( FT_Face     t1face,        /* T1_Face */
702                FT_UInt     left_glyph,
703                FT_UInt     right_glyph,
704                FT_Vector*  kerning )
705   {
706     T1_Face  face = (T1_Face)t1face;
707 
708 
709     kerning-&gt;x = 0;
710     kerning-&gt;y = 0;
711 
712     if ( face-&gt;afm_data )
713       T1_Get_Kerning( (AFM_FontInfo)face-&gt;afm_data,
714                       left_glyph,
715                       right_glyph,
716                       kerning );
717 
718     return FT_Err_Ok;
719   }
</pre>
</td>
<td>
<hr />
<pre>
<span class="line-modified">  1 /****************************************************************************</span>
<span class="line-modified">  2  *</span>
<span class="line-modified">  3  * t1driver.c</span>
<span class="line-modified">  4  *</span>
<span class="line-modified">  5  *   Type 1 driver interface (body).</span>
<span class="line-modified">  6  *</span>
<span class="line-modified">  7  * Copyright (C) 1996-2019 by</span>
<span class="line-modified">  8  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">  9  *</span>
<span class="line-modified"> 10  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified"> 11  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified"> 12  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified"> 13  * this file you indicate that you have read the license and</span>
<span class="line-modified"> 14  * understand and accept it fully.</span>
<span class="line-modified"> 15  *</span>
<span class="line-modified"> 16  */</span>
 17 
 18 
 19 #include &lt;ft2build.h&gt;
 20 #include &quot;t1driver.h&quot;
 21 #include &quot;t1gload.h&quot;
 22 #include &quot;t1load.h&quot;
 23 
 24 #include &quot;t1errors.h&quot;
 25 
 26 #ifndef T1_CONFIG_OPTION_NO_AFM
 27 #include &quot;t1afm.h&quot;
 28 #endif
 29 
 30 #include FT_INTERNAL_DEBUG_H
 31 #include FT_INTERNAL_STREAM_H
 32 #include FT_INTERNAL_HASH_H
 33 #include FT_INTERNAL_POSTSCRIPT_PROPS_H
 34 #include FT_DRIVER_H
 35 
 36 #include FT_SERVICE_MULTIPLE_MASTERS_H
 37 #include FT_SERVICE_GLYPH_DICT_H
 38 #include FT_SERVICE_FONT_FORMAT_H
 39 #include FT_SERVICE_POSTSCRIPT_NAME_H
 40 #include FT_SERVICE_POSTSCRIPT_CMAPS_H
 41 #include FT_SERVICE_POSTSCRIPT_INFO_H
 42 #include FT_SERVICE_PROPERTIES_H
 43 #include FT_SERVICE_KERNING_H
 44 
 45 
<span class="line-modified"> 46   /**************************************************************************</span>
<span class="line-modified"> 47    *</span>
<span class="line-modified"> 48    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="line-modified"> 49    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="line-modified"> 50    * messages during execution.</span>
<span class="line-modified"> 51    */</span>
 52 #undef  FT_COMPONENT
<span class="line-modified"> 53 #define FT_COMPONENT  t1driver</span>
 54 
<span class="line-modified"> 55   /*</span>
<span class="line-modified"> 56    * GLYPH DICT SERVICE</span>
<span class="line-modified"> 57    *</span>
<span class="line-modified"> 58    */</span>
 59 
 60   static FT_Error
 61   t1_get_glyph_name( T1_Face     face,
 62                      FT_UInt     glyph_index,
 63                      FT_Pointer  buffer,
 64                      FT_UInt     buffer_max )
 65   {
 66     FT_STRCPYN( buffer, face-&gt;type1.glyph_names[glyph_index], buffer_max );
 67 
 68     return FT_Err_Ok;
 69   }
 70 
 71 
 72   static FT_UInt
<span class="line-modified"> 73   t1_get_name_index( T1_Face           face,</span>
<span class="line-modified"> 74                      const FT_String*  glyph_name )</span>
 75   {
 76     FT_Int  i;
 77 
 78 
 79     for ( i = 0; i &lt; face-&gt;type1.num_glyphs; i++ )
 80     {
 81       FT_String*  gname = face-&gt;type1.glyph_names[i];
 82 
 83 
 84       if ( !ft_strcmp( glyph_name, gname ) )
 85         return (FT_UInt)i;
 86     }
 87 
 88     return 0;
 89   }
 90 
 91 
 92   static const FT_Service_GlyphDictRec  t1_service_glyph_dict =
 93   {
 94     (FT_GlyphDict_GetNameFunc)  t1_get_glyph_name,    /* get_name   */
 95     (FT_GlyphDict_NameIndexFunc)t1_get_name_index     /* name_index */
 96   };
 97 
 98 
 99   /*
<span class="line-modified">100    * POSTSCRIPT NAME SERVICE</span>
101    *
102    */
103 
104   static const char*
105   t1_get_ps_name( T1_Face  face )
106   {
107     return (const char*) face-&gt;type1.font_name;
108   }
109 
110 
111   static const FT_Service_PsFontNameRec  t1_service_ps_name =
112   {
113     (FT_PsName_GetFunc)t1_get_ps_name     /* get_ps_font_name */
114   };
115 
116 
117   /*
<span class="line-modified">118    * MULTIPLE MASTERS SERVICE</span>
119    *
120    */
121 
122 #ifndef T1_CONFIG_OPTION_NO_MM_SUPPORT
123   static const FT_Service_MultiMastersRec  t1_service_multi_masters =
124   {
<span class="line-modified">125     (FT_Get_MM_Func)             T1_Get_Multi_Master,    /* get_mm              */</span>
<span class="line-modified">126     (FT_Set_MM_Design_Func)      T1_Set_MM_Design,       /* set_mm_design       */</span>
<span class="line-modified">127     (FT_Set_MM_Blend_Func)       T1_Set_MM_Blend,        /* set_mm_blend        */</span>
<span class="line-modified">128     (FT_Get_MM_Blend_Func)       T1_Get_MM_Blend,        /* get_mm_blend        */</span>
<span class="line-modified">129     (FT_Get_MM_Var_Func)         T1_Get_MM_Var,          /* get_mm_var          */</span>
<span class="line-modified">130     (FT_Set_Var_Design_Func)     T1_Set_Var_Design,      /* set_var_design      */</span>
<span class="line-modified">131     (FT_Get_Var_Design_Func)     T1_Get_Var_Design,      /* get_var_design      */</span>
<span class="line-modified">132     (FT_Set_Instance_Func)       T1_Reset_MM_Blend,      /* set_instance        */</span>
<span class="line-modified">133     (FT_Set_MM_WeightVector_Func)T1_Set_MM_WeightVector, /* set_mm_weightvector */</span>
<span class="line-modified">134     (FT_Get_MM_WeightVector_Func)T1_Get_MM_WeightVector, /* get_mm_weightvector */</span>
<span class="line-modified">135 </span>
<span class="line-added">136     (FT_Get_Var_Blend_Func)      NULL,                   /* get_var_blend       */</span>
<span class="line-added">137     (FT_Done_Blend_Func)         T1_Done_Blend           /* done_blend          */</span>
138   };
139 #endif
140 
141 
142   /*
<span class="line-modified">143    * POSTSCRIPT INFO SERVICE</span>
144    *
145    */
146 
147   static FT_Error
148   t1_ps_get_font_info( FT_Face          face,
149                        PS_FontInfoRec*  afont_info )
150   {
151     *afont_info = ((T1_Face)face)-&gt;type1.font_info;
152 
153     return FT_Err_Ok;
154   }
155 
156 
157   static FT_Error
158   t1_ps_get_font_extra( FT_Face           face,
159                         PS_FontExtraRec*  afont_extra )
160   {
161     *afont_extra = ((T1_Face)face)-&gt;type1.font_extra;
162 
163     return FT_Err_Ok;
</pre>
<hr />
<pre>
255             break;
256           case 2:
257             val = type1-&gt;font_bbox.xMax;
258             break;
259           case 3:
260             val = type1-&gt;font_bbox.yMax;
261             break;
262           }
263           *((FT_Fixed *)value) = val;
264         }
265       }
266       break;
267 
268     case PS_DICT_PAINT_TYPE:
269       retval = sizeof ( type1-&gt;paint_type );
270       if ( value &amp;&amp; value_len &gt;= retval )
271         *((FT_Byte *)value) = type1-&gt;paint_type;
272       break;
273 
274     case PS_DICT_FONT_NAME:
<span class="line-modified">275       if ( type1-&gt;font_name )</span>
<span class="line-modified">276       {</span>
<span class="line-modified">277         retval = ft_strlen( type1-&gt;font_name ) + 1;</span>
<span class="line-added">278         if ( value &amp;&amp; value_len &gt;= retval )</span>
<span class="line-added">279           ft_memcpy( value, (void *)( type1-&gt;font_name ), retval );</span>
<span class="line-added">280       }</span>
281       break;
282 
283     case PS_DICT_UNIQUE_ID:
284       retval = sizeof ( type1-&gt;private_dict.unique_id );
285       if ( value &amp;&amp; value_len &gt;= retval )
286         *((FT_Int *)value) = type1-&gt;private_dict.unique_id;
287       break;
288 
289     case PS_DICT_NUM_CHAR_STRINGS:
290       retval = sizeof ( type1-&gt;num_glyphs );
291       if ( value &amp;&amp; value_len &gt;= retval )
292         *((FT_Int *)value) = type1-&gt;num_glyphs;
293       break;
294 
295     case PS_DICT_CHAR_STRING_KEY:
296       if ( idx &lt; (FT_UInt)type1-&gt;num_glyphs )
297       {
298         retval = ft_strlen( type1-&gt;glyph_names[idx] ) + 1;
299         if ( value &amp;&amp; value_len &gt;= retval )
300         {
</pre>
<hr />
<pre>
350 
351         if ( type1-&gt;subrs_hash )
352         {
353           /* convert subr index to array index */
354           size_t*  val = ft_hash_num_lookup( (FT_Int)idx,
355                                              type1-&gt;subrs_hash );
356 
357 
358           if ( val )
359           {
360             idx = *val;
361             ok  = 1;
362           }
363         }
364         else
365         {
366           if ( idx &lt; (FT_UInt)type1-&gt;num_subrs )
367             ok = 1;
368         }
369 
<span class="line-modified">370         if ( ok &amp;&amp; type1-&gt;subrs )</span>
371         {
372           retval = type1-&gt;subrs_len[idx] + 1;
373           if ( value &amp;&amp; value_len &gt;= retval )
374           {
375             ft_memcpy( value, (void *)( type1-&gt;subrs[idx] ), retval - 1 );
376             ((FT_Char *)value)[retval - 1] = (FT_Char)&#39;\0&#39;;
377           }
378         }
379       }
380       break;
381 
382     case PS_DICT_STD_HW:
383       retval = sizeof ( type1-&gt;private_dict.standard_width[0] );
384       if ( value &amp;&amp; value_len &gt;= retval )
385         *((FT_UShort *)value) = type1-&gt;private_dict.standard_width[0];
386       break;
387 
388     case PS_DICT_STD_VW:
389       retval = sizeof ( type1-&gt;private_dict.standard_height[0] );
390       if ( value &amp;&amp; value_len &gt;= retval )
</pre>
<hr />
<pre>
547 
548     case PS_DICT_UNDERLINE_POSITION:
549       retval = sizeof ( type1-&gt;font_info.underline_position );
550       if ( value &amp;&amp; value_len &gt;= retval )
551         *((FT_Short *)value) = type1-&gt;font_info.underline_position;
552       break;
553 
554     case PS_DICT_UNDERLINE_THICKNESS:
555       retval = sizeof ( type1-&gt;font_info.underline_thickness );
556       if ( value &amp;&amp; value_len &gt;= retval )
557         *((FT_UShort *)value) = type1-&gt;font_info.underline_thickness;
558       break;
559 
560     case PS_DICT_FS_TYPE:
561       retval = sizeof ( type1-&gt;font_extra.fs_type );
562       if ( value &amp;&amp; value_len &gt;= retval )
563         *((FT_UShort *)value) = type1-&gt;font_extra.fs_type;
564       break;
565 
566     case PS_DICT_VERSION:
<span class="line-modified">567       if ( type1-&gt;font_info.version )</span>
<span class="line-modified">568       {</span>
<span class="line-modified">569         retval = ft_strlen( type1-&gt;font_info.version ) + 1;</span>
<span class="line-added">570         if ( value &amp;&amp; value_len &gt;= retval )</span>
<span class="line-added">571           ft_memcpy( value, (void *)( type1-&gt;font_info.version ), retval );</span>
<span class="line-added">572       }</span>
573       break;
574 
575     case PS_DICT_NOTICE:
<span class="line-modified">576       if ( type1-&gt;font_info.notice )</span>
<span class="line-modified">577       {</span>
<span class="line-modified">578         retval = ft_strlen( type1-&gt;font_info.notice ) + 1;</span>
<span class="line-added">579         if ( value &amp;&amp; value_len &gt;= retval )</span>
<span class="line-added">580           ft_memcpy( value, (void *)( type1-&gt;font_info.notice ), retval );</span>
<span class="line-added">581       }</span>
582       break;
583 
584     case PS_DICT_FULL_NAME:
<span class="line-modified">585       if ( type1-&gt;font_info.full_name )</span>
<span class="line-modified">586       {</span>
<span class="line-modified">587         retval = ft_strlen( type1-&gt;font_info.full_name ) + 1;</span>
<span class="line-added">588         if ( value &amp;&amp; value_len &gt;= retval )</span>
<span class="line-added">589           ft_memcpy( value, (void *)( type1-&gt;font_info.full_name ), retval );</span>
<span class="line-added">590       }</span>
591       break;
592 
593     case PS_DICT_FAMILY_NAME:
<span class="line-modified">594       if ( type1-&gt;font_info.family_name )</span>
<span class="line-modified">595       {</span>
<span class="line-modified">596         retval = ft_strlen( type1-&gt;font_info.family_name ) + 1;</span>
<span class="line-added">597         if ( value &amp;&amp; value_len &gt;= retval )</span>
<span class="line-added">598           ft_memcpy( value, (void *)( type1-&gt;font_info.family_name ),</span>
<span class="line-added">599                      retval );</span>
<span class="line-added">600       }</span>
601       break;
602 
603     case PS_DICT_WEIGHT:
<span class="line-modified">604       if ( type1-&gt;font_info.weight )</span>
<span class="line-modified">605       {</span>
<span class="line-modified">606         retval = ft_strlen( type1-&gt;font_info.weight ) + 1;</span>
<span class="line-added">607         if ( value &amp;&amp; value_len &gt;= retval )</span>
<span class="line-added">608           ft_memcpy( value, (void *)( type1-&gt;font_info.weight ), retval );</span>
<span class="line-added">609       }</span>
610       break;
611 
612     case PS_DICT_ITALIC_ANGLE:
613       retval = sizeof ( type1-&gt;font_info.italic_angle );
614       if ( value &amp;&amp; value_len &gt;= retval )
615         *((FT_Long *)value) = type1-&gt;font_info.italic_angle;
616       break;
617     }
618 
619     return retval == 0 ? -1 : (FT_Long)retval;
620   }
621 
622 
623   static const FT_Service_PsInfoRec  t1_service_ps_info =
624   {
625     (PS_GetFontInfoFunc)   t1_ps_get_font_info,    /* ps_get_font_info    */
626     (PS_GetFontExtraFunc)  t1_ps_get_font_extra,   /* ps_get_font_extra   */
627     (PS_HasGlyphNamesFunc) t1_ps_has_glyph_names,  /* ps_has_glyph_names  */
628     (PS_GetFontPrivateFunc)t1_ps_get_font_private, /* ps_get_font_private */
629     (PS_GetFontValueFunc)  t1_ps_get_font_value,   /* ps_get_font_value   */
630   };
631 
632 
633 #ifndef T1_CONFIG_OPTION_NO_AFM
634   static const FT_Service_KerningRec  t1_service_kerning =
635   {
636     T1_Get_Track_Kerning,       /* get_track */
637   };
638 #endif
639 
640 
641   /*
<span class="line-modified">642    * PROPERTY SERVICE</span>
643    *
644    */
645 
646   FT_DEFINE_SERVICE_PROPERTIESREC(
647     t1_service_properties,
648 
649     (FT_Properties_SetFunc)ps_property_set,      /* set_property */
650     (FT_Properties_GetFunc)ps_property_get )     /* get_property */
651 
652 
653   /*
<span class="line-modified">654    * SERVICE LIST</span>
655    *
656    */
657 
658   static const FT_ServiceDescRec  t1_services[] =
659   {
660     { FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;t1_service_ps_name },
661     { FT_SERVICE_ID_GLYPH_DICT,           &amp;t1_service_glyph_dict },
662     { FT_SERVICE_ID_FONT_FORMAT,          FT_FONT_FORMAT_TYPE_1 },
663     { FT_SERVICE_ID_POSTSCRIPT_INFO,      &amp;t1_service_ps_info },
664     { FT_SERVICE_ID_PROPERTIES,           &amp;t1_service_properties },
665 
666 #ifndef T1_CONFIG_OPTION_NO_AFM
667     { FT_SERVICE_ID_KERNING,              &amp;t1_service_kerning },
668 #endif
669 
670 #ifndef T1_CONFIG_OPTION_NO_MM_SUPPORT
671     { FT_SERVICE_ID_MULTI_MASTERS,        &amp;t1_service_multi_masters },
672 #endif
673     { NULL, NULL }
674   };
675 
676 
677   FT_CALLBACK_DEF( FT_Module_Interface )
678   Get_Interface( FT_Module         module,
679                  const FT_String*  t1_interface )
680   {
681     FT_UNUSED( module );
682 
683     return ft_service_list_lookup( t1_services, t1_interface );
684   }
685 
686 
687 #ifndef T1_CONFIG_OPTION_NO_AFM
688 
<span class="line-modified">689   /**************************************************************************</span>
<span class="line-modified">690    *</span>
<span class="line-modified">691    * @Function:</span>
<span class="line-modified">692    *   Get_Kerning</span>
<span class="line-modified">693    *</span>
<span class="line-modified">694    * @Description:</span>
<span class="line-modified">695    *   A driver method used to return the kerning vector between two</span>
<span class="line-modified">696    *   glyphs of the same face.</span>
<span class="line-modified">697    *</span>
<span class="line-modified">698    * @Input:</span>
<span class="line-modified">699    *   face ::</span>
<span class="line-modified">700    *     A handle to the source face object.</span>
<span class="line-modified">701    *</span>
<span class="line-modified">702    *   left_glyph ::</span>
<span class="line-modified">703    *     The index of the left glyph in the kern pair.</span>
<span class="line-modified">704    *</span>
<span class="line-modified">705    *   right_glyph ::</span>
<span class="line-modified">706    *     The index of the right glyph in the kern pair.</span>
<span class="line-modified">707    *</span>
<span class="line-modified">708    * @Output:</span>
<span class="line-modified">709    *   kerning ::</span>
<span class="line-modified">710    *     The kerning vector.  This is in font units for</span>
<span class="line-modified">711    *     scalable formats, and in pixels for fixed-sizes</span>
<span class="line-modified">712    *     formats.</span>
<span class="line-modified">713    *</span>
<span class="line-modified">714    * @Return:</span>
<span class="line-modified">715    *   FreeType error code.  0 means success.</span>
<span class="line-modified">716    *</span>
<span class="line-modified">717    * @Note:</span>
<span class="line-modified">718    *   Only horizontal layouts (left-to-right &amp; right-to-left) are</span>
<span class="line-modified">719    *   supported by this function.  Other layouts, or more sophisticated</span>
<span class="line-modified">720    *   kernings are out of scope of this method (the basic driver</span>
<span class="line-added">721    *   interface is meant to be simple).</span>
<span class="line-added">722    *</span>
<span class="line-added">723    *   They can be implemented by format-specific interfaces.</span>
<span class="line-added">724    */</span>
725   static FT_Error
726   Get_Kerning( FT_Face     t1face,        /* T1_Face */
727                FT_UInt     left_glyph,
728                FT_UInt     right_glyph,
729                FT_Vector*  kerning )
730   {
731     T1_Face  face = (T1_Face)t1face;
732 
733 
734     kerning-&gt;x = 0;
735     kerning-&gt;y = 0;
736 
737     if ( face-&gt;afm_data )
738       T1_Get_Kerning( (AFM_FontInfo)face-&gt;afm_data,
739                       left_glyph,
740                       right_glyph,
741                       kerning );
742 
743     return FT_Err_Ok;
744   }
</pre>
</td>
</tr>
</table>
<center><a href="t1afm.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="t1driver.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>