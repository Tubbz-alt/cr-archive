<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.desktop/share/native/libfreetype/src/base/ftdebug.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre><a name="1" id="anc1"></a><span class="line-modified">  1 /****************************************************************************</span>
<span class="line-modified">  2  *</span>
<span class="line-modified">  3  * ftdebug.c</span>
<span class="line-modified">  4  *</span>
<span class="line-modified">  5  *   Debugging and logging component (body).</span>
<span class="line-modified">  6  *</span>
<span class="line-modified">  7  * Copyright (C) 1996-2019 by</span>
<span class="line-modified">  8  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">  9  *</span>
<span class="line-modified"> 10  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified"> 11  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified"> 12  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified"> 13  * this file you indicate that you have read the license and</span>
<span class="line-modified"> 14  * understand and accept it fully.</span>
<span class="line-modified"> 15  *</span>
<span class="line-modified"> 16  */</span>
<span class="line-modified"> 17 </span>
<span class="line-modified"> 18 </span>
<span class="line-modified"> 19   /**************************************************************************</span>
<span class="line-modified"> 20    *</span>
<span class="line-modified"> 21    * This component contains various macros and functions used to ease the</span>
<span class="line-modified"> 22    * debugging of the FreeType engine.  Its main purpose is in assertion</span>
<span class="line-modified"> 23    * checking, tracing, and error detection.</span>
<span class="line-modified"> 24    *</span>
<span class="line-modified"> 25    * There are now three debugging modes:</span>
<span class="line-modified"> 26    *</span>
<span class="line-modified"> 27    * - trace mode</span>
<span class="line-modified"> 28    *</span>
<span class="line-modified"> 29    *   Error and trace messages are sent to the log file (which can be the</span>
<span class="line-modified"> 30    *   standard error output).</span>
<span class="line-modified"> 31    *</span>
<span class="line-modified"> 32    * - error mode</span>
<span class="line-modified"> 33    *</span>
<span class="line-modified"> 34    *   Only error messages are generated.</span>
<span class="line-modified"> 35    *</span>
<span class="line-modified"> 36    * - release mode:</span>
<span class="line-modified"> 37    *</span>
<span class="line-modified"> 38    *   No error message is sent or generated.  The code is free from any</span>
<span class="line-modified"> 39    *   debugging parts.</span>
<span class="line-modified"> 40    *</span>
<span class="line-modified"> 41    */</span>
 42 
 43 
 44 #include &lt;ft2build.h&gt;
 45 #include FT_FREETYPE_H
 46 #include FT_INTERNAL_DEBUG_H
 47 
 48 
 49 #ifdef FT_DEBUG_LEVEL_ERROR
 50 
 51   /* documentation is in ftdebug.h */
 52 
 53   FT_BASE_DEF( void )
 54   FT_Message( const char*  fmt,
 55               ... )
 56   {
 57     va_list  ap;
 58 
 59 
 60     va_start( ap, fmt );
 61     vfprintf( stderr, fmt, ap );
 62     va_end( ap );
 63   }
 64 
 65 
 66   /* documentation is in ftdebug.h */
 67 
 68   FT_BASE_DEF( void )
 69   FT_Panic( const char*  fmt,
 70             ... )
 71   {
 72     va_list  ap;
 73 
 74 
 75     va_start( ap, fmt );
 76     vfprintf( stderr, fmt, ap );
 77     va_end( ap );
 78 
 79     exit( EXIT_FAILURE );
 80   }
 81 
 82 
 83   /* documentation is in ftdebug.h */
 84 
 85   FT_BASE_DEF( int )
 86   FT_Throw( FT_Error     error,
 87             int          line,
 88             const char*  file )
 89   {
<a name="2" id="anc2"></a><span class="line-added"> 90 #if 0</span>
<span class="line-added"> 91     /* activating the code in this block makes FreeType very chatty */</span>
<span class="line-added"> 92     fprintf( stderr,</span>
<span class="line-added"> 93              &quot;%s:%d: error 0x%02x: %s\n&quot;,</span>
<span class="line-added"> 94              file,</span>
<span class="line-added"> 95              line,</span>
<span class="line-added"> 96              error,</span>
<span class="line-added"> 97              FT_Error_String( error ) );</span>
<span class="line-added"> 98 #else</span>
 99     FT_UNUSED( error );
100     FT_UNUSED( line );
101     FT_UNUSED( file );
<a name="3" id="anc3"></a><span class="line-added">102 #endif</span>
103 
104     return 0;
105   }
106 
107 #endif /* FT_DEBUG_LEVEL_ERROR */
108 
109 
110 
111 #ifdef FT_DEBUG_LEVEL_TRACE
112 
<a name="4" id="anc4"></a><span class="line-modified">113   /* array of trace levels, initialized to 0; */</span>
<span class="line-modified">114   /* this gets adjusted at run-time           */</span>
<span class="line-added">115   static int  ft_trace_levels_enabled[trace_count];</span>
116 
<a name="5" id="anc5"></a><span class="line-added">117   /* array of trace levels, always initialized to 0 */</span>
<span class="line-added">118   static int  ft_trace_levels_disabled[trace_count];</span>
<span class="line-added">119 </span>
<span class="line-added">120   /* a pointer to either `ft_trace_levels_enabled&#39; */</span>
<span class="line-added">121   /* or `ft_trace_levels_disabled&#39;                 */</span>
<span class="line-added">122   int*  ft_trace_levels;</span>
123 
124   /* define array of trace toggle names */
125 #define FT_TRACE_DEF( x )  #x ,
126 
127   static const char*  ft_trace_toggles[trace_count + 1] =
128   {
129 #include FT_INTERNAL_TRACE_H
130     NULL
131   };
132 
133 #undef FT_TRACE_DEF
134 
135 
136   /* documentation is in ftdebug.h */
137 
138   FT_BASE_DEF( FT_Int )
139   FT_Trace_Get_Count( void )
140   {
141     return trace_count;
142   }
143 
144 
145   /* documentation is in ftdebug.h */
146 
147   FT_BASE_DEF( const char * )
148   FT_Trace_Get_Name( FT_Int  idx )
149   {
150     int  max = FT_Trace_Get_Count();
151 
152 
153     if ( idx &lt; max )
154       return ft_trace_toggles[idx];
155     else
156       return NULL;
157   }
158 
159 
<a name="6" id="anc6"></a><span class="line-modified">160   /* documentation is in ftdebug.h */</span>
<span class="line-modified">161 </span>
<span class="line-modified">162   FT_BASE_DEF( void )</span>
<span class="line-modified">163   FT_Trace_Disable( void )</span>
<span class="line-modified">164   {</span>
<span class="line-modified">165     ft_trace_levels = ft_trace_levels_disabled;</span>
<span class="line-modified">166   }</span>
<span class="line-modified">167 </span>
<span class="line-modified">168 </span>
<span class="line-modified">169   /* documentation is in ftdebug.h */</span>
<span class="line-modified">170 </span>
<span class="line-modified">171   FT_BASE_DEF( void )</span>
<span class="line-modified">172   FT_Trace_Enable( void )</span>
<span class="line-modified">173   {</span>
<span class="line-modified">174     ft_trace_levels = ft_trace_levels_enabled;</span>
<span class="line-modified">175   }</span>
<span class="line-modified">176 </span>
<span class="line-modified">177 </span>
<span class="line-added">178   /**************************************************************************</span>
<span class="line-added">179    *</span>
<span class="line-added">180    * Initialize the tracing sub-system.  This is done by retrieving the</span>
<span class="line-added">181    * value of the `FT2_DEBUG&#39; environment variable.  It must be a list of</span>
<span class="line-added">182    * toggles, separated by spaces, `;&#39;, or `,&#39;.  Example:</span>
<span class="line-added">183    *</span>
<span class="line-added">184    *   export FT2_DEBUG=&quot;any:3 memory:7 stream:5&quot;</span>
<span class="line-added">185    *</span>
<span class="line-added">186    * This requests that all levels be set to 3, except the trace level for</span>
<span class="line-added">187    * the memory and stream components which are set to 7 and 5,</span>
<span class="line-added">188    * respectively.</span>
<span class="line-added">189    *</span>
<span class="line-added">190    * See the file `include/freetype/internal/fttrace.h&#39; for details of</span>
<span class="line-added">191    * the available toggle names.</span>
<span class="line-added">192    *</span>
<span class="line-added">193    * The level must be between 0 and 7; 0 means quiet (except for serious</span>
<span class="line-added">194    * runtime errors), and 7 means _very_ verbose.</span>
<span class="line-added">195    */</span>
196   FT_BASE_DEF( void )
197   ft_debug_init( void )
198   {
199     const char*  ft2_debug = ft_getenv( &quot;FT2_DEBUG&quot; );
200 
201 
202     if ( ft2_debug )
203     {
204       const char*  p = ft2_debug;
205       const char*  q;
206 
207 
208       for ( ; *p; p++ )
209       {
210         /* skip leading whitespace and separators */
211         if ( *p == &#39; &#39; || *p == &#39;\t&#39; || *p == &#39;,&#39; || *p == &#39;;&#39; || *p == &#39;=&#39; )
212           continue;
213 
214         /* read toggle name, followed by &#39;:&#39; */
215         q = p;
216         while ( *p &amp;&amp; *p != &#39;:&#39; )
217           p++;
218 
219         if ( !*p )
220           break;
221 
222         if ( *p == &#39;:&#39; &amp;&amp; p &gt; q )
223         {
224           FT_Int  n, i, len = (FT_Int)( p - q );
225           FT_Int  level = -1, found = -1;
226 
227 
228           for ( n = 0; n &lt; trace_count; n++ )
229           {
230             const char*  toggle = ft_trace_toggles[n];
231 
232 
233             for ( i = 0; i &lt; len; i++ )
234             {
235               if ( toggle[i] != q[i] )
236                 break;
237             }
238 
239             if ( i == len &amp;&amp; toggle[i] == 0 )
240             {
241               found = n;
242               break;
243             }
244           }
245 
246           /* read level */
247           p++;
248           if ( *p )
249           {
250             level = *p - &#39;0&#39;;
251             if ( level &lt; 0 || level &gt; 7 )
252               level = -1;
253           }
254 
255           if ( found &gt;= 0 &amp;&amp; level &gt;= 0 )
256           {
257             if ( found == trace_any )
258             {
259               /* special case for `any&#39; */
260               for ( n = 0; n &lt; trace_count; n++ )
<a name="7" id="anc7"></a><span class="line-modified">261                 ft_trace_levels_enabled[n] = level;</span>
262             }
263             else
<a name="8" id="anc8"></a><span class="line-modified">264               ft_trace_levels_enabled[found] = level;</span>
265           }
266         }
267       }
268     }
<a name="9" id="anc9"></a><span class="line-added">269 </span>
<span class="line-added">270     ft_trace_levels = ft_trace_levels_enabled;</span>
271   }
272 
273 
274 #else  /* !FT_DEBUG_LEVEL_TRACE */
275 
276 
277   FT_BASE_DEF( void )
278   ft_debug_init( void )
279   {
280     /* nothing */
281   }
282 
283 
284   FT_BASE_DEF( FT_Int )
285   FT_Trace_Get_Count( void )
286   {
287     return 0;
288   }
289 
290 
291   FT_BASE_DEF( const char * )
292   FT_Trace_Get_Name( FT_Int  idx )
293   {
294     FT_UNUSED( idx );
295 
296     return NULL;
297   }
298 
299 
<a name="10" id="anc10"></a><span class="line-added">300   FT_BASE_DEF( void )</span>
<span class="line-added">301   FT_Trace_Disable( void )</span>
<span class="line-added">302   {</span>
<span class="line-added">303     /* nothing */</span>
<span class="line-added">304   }</span>
<span class="line-added">305 </span>
<span class="line-added">306 </span>
<span class="line-added">307   /* documentation is in ftdebug.h */</span>
<span class="line-added">308 </span>
<span class="line-added">309   FT_BASE_DEF( void )</span>
<span class="line-added">310   FT_Trace_Enable( void )</span>
<span class="line-added">311   {</span>
<span class="line-added">312     /* nothing */</span>
<span class="line-added">313   }</span>
<span class="line-added">314 </span>
<span class="line-added">315 </span>
316 #endif /* !FT_DEBUG_LEVEL_TRACE */
317 
318 
319 /* END */
<a name="11" id="anc11"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="11" type="hidden" />
</body>
</html>