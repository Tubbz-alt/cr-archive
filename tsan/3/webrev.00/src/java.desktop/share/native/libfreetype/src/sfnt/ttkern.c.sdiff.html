<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/native/libfreetype/src/sfnt/ttkern.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ttcmapc.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ttkern.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/sfnt/ttkern.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
<span class="line-modified">  1 /***************************************************************************/</span>
<span class="line-modified">  2 /*                                                                         */</span>
<span class="line-modified">  3 /*  ttkern.c                                                               */</span>
<span class="line-modified">  4 /*                                                                         */</span>
<span class="line-modified">  5 /*    Load the basic TrueType kerning table.  This doesn&#39;t handle          */</span>
<span class="line-modified">  6 /*    kerning data within the GPOS table at the moment.                    */</span>
<span class="line-modified">  7 /*                                                                         */</span>
<span class="line-modified">  8 /*  Copyright 1996-2018 by                                                 */</span>
<span class="line-modified">  9 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="line-modified"> 10 /*                                                                         */</span>
<span class="line-modified"> 11 /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified"> 12 /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified"> 13 /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified"> 14 /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified"> 15 /*  understand and accept it fully.                                        */</span>
<span class="line-modified"> 16 /*                                                                         */</span>
<span class="line-modified"> 17 /***************************************************************************/</span>
 18 
 19 
 20 #include &lt;ft2build.h&gt;
 21 #include FT_INTERNAL_DEBUG_H
 22 #include FT_INTERNAL_STREAM_H
 23 #include FT_TRUETYPE_TAGS_H
 24 #include &quot;ttkern.h&quot;
 25 
 26 #include &quot;sferrors.h&quot;
 27 
 28 
<span class="line-modified"> 29   /*************************************************************************/</span>
<span class="line-modified"> 30   /*                                                                       */</span>
<span class="line-modified"> 31   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="line-modified"> 32   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="line-modified"> 33   /* messages during execution.                                            */</span>
<span class="line-modified"> 34   /*                                                                       */</span>
 35 #undef  FT_COMPONENT
<span class="line-modified"> 36 #define FT_COMPONENT  trace_ttkern</span>
 37 
 38 
 39 #undef  TT_KERN_INDEX
 40 #define TT_KERN_INDEX( g1, g2 )  ( ( (FT_ULong)(g1) &lt;&lt; 16 ) | (g2) )
 41 
 42 
 43   FT_LOCAL_DEF( FT_Error )
 44   tt_face_load_kern( TT_Face    face,
 45                      FT_Stream  stream )
 46   {
 47     FT_Error   error;
 48     FT_ULong   table_size;
 49     FT_Byte*   p;
 50     FT_Byte*   p_limit;
 51     FT_UInt    nn, num_tables;
 52     FT_UInt32  avail = 0, ordered = 0;
 53 
 54 
 55     /* the kern table is optional; exit silently if it is missing */
 56     error = face-&gt;goto_table( face, TTAG_kern, stream, &amp;table_size );
</pre>
<hr />
<pre>
110       format = coverage &gt;&gt; 8;
111 
112       /* we currently only support format 0 kerning tables */
113       if ( format != 0 )
114         goto NextTable;
115 
116       /* only use horizontal kerning tables */
117       if ( ( coverage &amp; 3U ) != 0x0001 ||
118            p + 8 &gt; p_next              )
119         goto NextTable;
120 
121       num_pairs = FT_NEXT_USHORT( p );
122       p        += 6;
123 
124       if ( ( p_next - p ) &lt; 6 * (int)num_pairs ) /* handle broken count */
125         num_pairs = (FT_UInt)( ( p_next - p ) / 6 );
126 
127       avail |= mask;
128 
129       /*
<span class="line-modified">130        *  Now check whether the pairs in this table are ordered.</span>
<span class="line-modified">131        *  We then can use binary search.</span>
132        */
133       if ( num_pairs &gt; 0 )
134       {
135         FT_ULong  count;
136         FT_ULong  old_pair;
137 
138 
139         old_pair = FT_NEXT_ULONG( p );
140         p       += 2;
141 
142         for ( count = num_pairs - 1; count &gt; 0; count-- )
143         {
144           FT_UInt32  cur_pair;
145 
146 
147           cur_pair = FT_NEXT_ULONG( p );
148           if ( cur_pair &lt;= old_pair )
149             break;
150 
151           p += 2;
</pre>
<hr />
<pre>
266             FT_UInt  count2;
267 
268 
269             for ( count2 = num_pairs; count2 &gt; 0; count2-- )
270             {
271               FT_ULong  key = FT_NEXT_ULONG( p );
272 
273 
274               if ( key == key0 )
275               {
276                 value = FT_PEEK_SHORT( p );
277                 goto Found;
278               }
279               p += 2;
280             }
281           }
282         }
283         break;
284 
285        /*
<span class="line-modified">286         *  We don&#39;t support format 2 because we haven&#39;t seen a single font</span>
<span class="line-modified">287         *  using it in real life...</span>
288         */
289 
290       default:
291         ;
292       }
293 
294       goto NextTable;
295 
296     Found:
297       if ( coverage &amp; 8 ) /* override or add */
298         result = value;
299       else
300         result += value;
301 
302     NextTable:
303       p = next;
304     }
305 
306     return result;
307   }
</pre>
</td>
<td>
<hr />
<pre>
<span class="line-modified">  1 /****************************************************************************</span>
<span class="line-modified">  2  *</span>
<span class="line-modified">  3  * ttkern.c</span>
<span class="line-modified">  4  *</span>
<span class="line-modified">  5  *   Load the basic TrueType kerning table.  This doesn&#39;t handle</span>
<span class="line-modified">  6  *   kerning data within the GPOS table at the moment.</span>
<span class="line-modified">  7  *</span>
<span class="line-modified">  8  * Copyright (C) 1996-2019 by</span>
<span class="line-modified">  9  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified"> 10  *</span>
<span class="line-modified"> 11  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified"> 12  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified"> 13  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified"> 14  * this file you indicate that you have read the license and</span>
<span class="line-modified"> 15  * understand and accept it fully.</span>
<span class="line-modified"> 16  *</span>
<span class="line-modified"> 17  */</span>
 18 
 19 
 20 #include &lt;ft2build.h&gt;
 21 #include FT_INTERNAL_DEBUG_H
 22 #include FT_INTERNAL_STREAM_H
 23 #include FT_TRUETYPE_TAGS_H
 24 #include &quot;ttkern.h&quot;
 25 
 26 #include &quot;sferrors.h&quot;
 27 
 28 
<span class="line-modified"> 29   /**************************************************************************</span>
<span class="line-modified"> 30    *</span>
<span class="line-modified"> 31    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="line-modified"> 32    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="line-modified"> 33    * messages during execution.</span>
<span class="line-modified"> 34    */</span>
 35 #undef  FT_COMPONENT
<span class="line-modified"> 36 #define FT_COMPONENT  ttkern</span>
 37 
 38 
 39 #undef  TT_KERN_INDEX
 40 #define TT_KERN_INDEX( g1, g2 )  ( ( (FT_ULong)(g1) &lt;&lt; 16 ) | (g2) )
 41 
 42 
 43   FT_LOCAL_DEF( FT_Error )
 44   tt_face_load_kern( TT_Face    face,
 45                      FT_Stream  stream )
 46   {
 47     FT_Error   error;
 48     FT_ULong   table_size;
 49     FT_Byte*   p;
 50     FT_Byte*   p_limit;
 51     FT_UInt    nn, num_tables;
 52     FT_UInt32  avail = 0, ordered = 0;
 53 
 54 
 55     /* the kern table is optional; exit silently if it is missing */
 56     error = face-&gt;goto_table( face, TTAG_kern, stream, &amp;table_size );
</pre>
<hr />
<pre>
110       format = coverage &gt;&gt; 8;
111 
112       /* we currently only support format 0 kerning tables */
113       if ( format != 0 )
114         goto NextTable;
115 
116       /* only use horizontal kerning tables */
117       if ( ( coverage &amp; 3U ) != 0x0001 ||
118            p + 8 &gt; p_next              )
119         goto NextTable;
120 
121       num_pairs = FT_NEXT_USHORT( p );
122       p        += 6;
123 
124       if ( ( p_next - p ) &lt; 6 * (int)num_pairs ) /* handle broken count */
125         num_pairs = (FT_UInt)( ( p_next - p ) / 6 );
126 
127       avail |= mask;
128 
129       /*
<span class="line-modified">130        * Now check whether the pairs in this table are ordered.</span>
<span class="line-modified">131        * We then can use binary search.</span>
132        */
133       if ( num_pairs &gt; 0 )
134       {
135         FT_ULong  count;
136         FT_ULong  old_pair;
137 
138 
139         old_pair = FT_NEXT_ULONG( p );
140         p       += 2;
141 
142         for ( count = num_pairs - 1; count &gt; 0; count-- )
143         {
144           FT_UInt32  cur_pair;
145 
146 
147           cur_pair = FT_NEXT_ULONG( p );
148           if ( cur_pair &lt;= old_pair )
149             break;
150 
151           p += 2;
</pre>
<hr />
<pre>
266             FT_UInt  count2;
267 
268 
269             for ( count2 = num_pairs; count2 &gt; 0; count2-- )
270             {
271               FT_ULong  key = FT_NEXT_ULONG( p );
272 
273 
274               if ( key == key0 )
275               {
276                 value = FT_PEEK_SHORT( p );
277                 goto Found;
278               }
279               p += 2;
280             }
281           }
282         }
283         break;
284 
285        /*
<span class="line-modified">286         * We don&#39;t support format 2 because we haven&#39;t seen a single font</span>
<span class="line-modified">287         * using it in real life...</span>
288         */
289 
290       default:
291         ;
292       }
293 
294       goto NextTable;
295 
296     Found:
297       if ( coverage &amp; 8 ) /* override or add */
298         result = value;
299       else
300         result += value;
301 
302     NextTable:
303       p = next;
304     }
305 
306     return result;
307   }
</pre>
</td>
</tr>
</table>
<center><a href="ttcmapc.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ttkern.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>