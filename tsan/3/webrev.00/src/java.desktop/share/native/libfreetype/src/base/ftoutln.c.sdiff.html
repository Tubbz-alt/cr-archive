<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/native/libfreetype/src/base/ftoutln.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ftobjs.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ftpatent.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/base/ftoutln.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
<span class="line-modified">   1 /***************************************************************************/</span>
<span class="line-modified">   2 /*                                                                         */</span>
<span class="line-modified">   3 /*  ftoutln.c                                                              */</span>
<span class="line-modified">   4 /*                                                                         */</span>
<span class="line-modified">   5 /*    FreeType outline management (body).                                  */</span>
<span class="line-modified">   6 /*                                                                         */</span>
<span class="line-modified">   7 /*  Copyright 1996-2018 by                                                 */</span>
<span class="line-modified">   8 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="line-modified">   9 /*                                                                         */</span>
<span class="line-modified">  10 /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified">  11 /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified">  12 /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified">  13 /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified">  14 /*  understand and accept it fully.                                        */</span>
<span class="line-modified">  15 /*                                                                         */</span>
<span class="line-modified">  16 /***************************************************************************/</span>
<span class="line-removed">  17 </span>
<span class="line-removed">  18 </span>
<span class="line-removed">  19   /*************************************************************************/</span>
<span class="line-removed">  20   /*                                                                       */</span>
<span class="line-removed">  21   /* All functions are declared in freetype.h.                             */</span>
<span class="line-removed">  22   /*                                                                       */</span>
<span class="line-removed">  23   /*************************************************************************/</span>
  24 
  25 
  26 #include &lt;ft2build.h&gt;
  27 #include FT_OUTLINE_H
  28 #include FT_INTERNAL_OBJECTS_H
  29 #include FT_INTERNAL_CALC_H
  30 #include FT_INTERNAL_DEBUG_H
  31 #include FT_TRIGONOMETRY_H
  32 
  33 
<span class="line-modified">  34   /*************************************************************************/</span>
<span class="line-modified">  35   /*                                                                       */</span>
<span class="line-modified">  36   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="line-modified">  37   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="line-modified">  38   /* messages during execution.                                            */</span>
<span class="line-modified">  39   /*                                                                       */</span>
  40 #undef  FT_COMPONENT
<span class="line-modified">  41 #define FT_COMPONENT  trace_outline</span>
  42 
  43 
  44   static
  45   const FT_Outline  null_outline = { 0, 0, NULL, NULL, NULL, 0 };
  46 
  47 
  48   /* documentation is in ftoutln.h */
  49 
  50   FT_EXPORT_DEF( FT_Error )
  51   FT_Outline_Decompose( FT_Outline*              outline,
  52                         const FT_Outline_Funcs*  func_interface,
  53                         void*                    user )
  54   {
  55 #undef  SCALED
<span class="line-modified">  56 #define SCALED( x )  ( ( (x) &lt; 0 ? -( -(x) &lt;&lt; shift )             \</span>
<span class="line-removed">  57                                  :  (  (x) &lt;&lt; shift ) ) - delta )</span>
  58 
  59     FT_Vector   v_last;
  60     FT_Vector   v_control;
  61     FT_Vector   v_start;
  62 
  63     FT_Vector*  point;
  64     FT_Vector*  limit;
  65     char*       tags;
  66 
  67     FT_Error    error;
  68 
  69     FT_Int   n;         /* index of contour in outline     */
  70     FT_UInt  first;     /* index of first point in contour */
  71     FT_Int   tag;       /* current point&#39;s state           */
  72 
  73     FT_Int   shift;
  74     FT_Pos   delta;
  75 
  76 
  77     if ( !outline )
</pre>
<hr />
<pre>
 279     Close:
 280       if ( error )
 281         goto Exit;
 282 
 283       first = (FT_UInt)last + 1;
 284     }
 285 
 286     FT_TRACE5(( &quot;FT_Outline_Decompose: Done\n&quot;, n ));
 287     return FT_Err_Ok;
 288 
 289   Invalid_Outline:
 290     error = FT_THROW( Invalid_Outline );
 291     /* fall through */
 292 
 293   Exit:
 294     FT_TRACE5(( &quot;FT_Outline_Decompose: Error 0x%x\n&quot;, error ));
 295     return error;
 296   }
 297 
 298 


 299   FT_EXPORT_DEF( FT_Error )
<span class="line-modified"> 300   FT_Outline_New_Internal( FT_Memory    memory,</span>
<span class="line-modified"> 301                            FT_UInt      numPoints,</span>
<span class="line-modified"> 302                            FT_Int       numContours,</span>
<span class="line-modified"> 303                            FT_Outline  *anoutline )</span>
 304   {
<span class="line-modified"> 305     FT_Error  error;</span>


 306 




 307 
 308     if ( !anoutline || !memory )
 309       return FT_THROW( Invalid_Argument );
 310 
 311     *anoutline = null_outline;
 312 
 313     if ( numContours &lt; 0                  ||
 314          (FT_UInt)numContours &gt; numPoints )
 315       return FT_THROW( Invalid_Argument );
 316 
 317     if ( numPoints &gt; FT_OUTLINE_POINTS_MAX )
 318       return FT_THROW( Array_Too_Large );
 319 
 320     if ( FT_NEW_ARRAY( anoutline-&gt;points,   numPoints   ) ||
 321          FT_NEW_ARRAY( anoutline-&gt;tags,     numPoints   ) ||
 322          FT_NEW_ARRAY( anoutline-&gt;contours, numContours ) )
 323       goto Fail;
 324 
 325     anoutline-&gt;n_points    = (FT_Short)numPoints;
 326     anoutline-&gt;n_contours  = (FT_Short)numContours;
 327     anoutline-&gt;flags      |= FT_OUTLINE_OWNER;
 328 
 329     return FT_Err_Ok;
 330 
 331   Fail:
 332     anoutline-&gt;flags |= FT_OUTLINE_OWNER;
<span class="line-modified"> 333     FT_Outline_Done_Internal( memory, anoutline );</span>
 334 
 335     return error;
 336   }
 337 
 338 
<span class="line-removed"> 339   /* documentation is in ftoutln.h */</span>
<span class="line-removed"> 340 </span>
<span class="line-removed"> 341   FT_EXPORT_DEF( FT_Error )</span>
<span class="line-removed"> 342   FT_Outline_New( FT_Library   library,</span>
<span class="line-removed"> 343                   FT_UInt      numPoints,</span>
<span class="line-removed"> 344                   FT_Int       numContours,</span>
<span class="line-removed"> 345                   FT_Outline  *anoutline )</span>
<span class="line-removed"> 346   {</span>
<span class="line-removed"> 347     if ( !library )</span>
<span class="line-removed"> 348       return FT_THROW( Invalid_Library_Handle );</span>
<span class="line-removed"> 349 </span>
<span class="line-removed"> 350     return FT_Outline_New_Internal( library-&gt;memory, numPoints,</span>
<span class="line-removed"> 351                                     numContours, anoutline );</span>
<span class="line-removed"> 352   }</span>
<span class="line-removed"> 353 </span>
<span class="line-removed"> 354 </span>
 355   /* documentation is in ftoutln.h */
 356 
 357   FT_EXPORT_DEF( FT_Error )
 358   FT_Outline_Check( FT_Outline*  outline )
 359   {
 360     if ( outline )
 361     {
 362       FT_Int  n_points   = outline-&gt;n_points;
 363       FT_Int  n_contours = outline-&gt;n_contours;
 364       FT_Int  end0, end;
 365       FT_Int  n;
 366 
 367 
 368       /* empty glyph? */
 369       if ( n_points == 0 &amp;&amp; n_contours == 0 )
 370         return FT_Err_Ok;
 371 
 372       /* check point and contour counts */
 373       if ( n_points &lt;= 0 || n_contours &lt;= 0 )
 374         goto Bad;
</pre>
<hr />
<pre>
 419     if ( source-&gt;n_points )
 420     {
 421       FT_ARRAY_COPY( target-&gt;points, source-&gt;points, source-&gt;n_points );
 422       FT_ARRAY_COPY( target-&gt;tags,   source-&gt;tags,   source-&gt;n_points );
 423     }
 424 
 425     if ( source-&gt;n_contours )
 426       FT_ARRAY_COPY( target-&gt;contours, source-&gt;contours, source-&gt;n_contours );
 427 
 428     /* copy all flags, except the `FT_OUTLINE_OWNER&#39; one */
 429     is_owner      = target-&gt;flags &amp; FT_OUTLINE_OWNER;
 430     target-&gt;flags = source-&gt;flags;
 431 
 432     target-&gt;flags &amp;= ~FT_OUTLINE_OWNER;
 433     target-&gt;flags |= is_owner;
 434 
 435     return FT_Err_Ok;
 436   }
 437 
 438 


 439   FT_EXPORT_DEF( FT_Error )
<span class="line-modified"> 440   FT_Outline_Done_Internal( FT_Memory    memory,</span>
<span class="line-modified"> 441                             FT_Outline*  outline )</span>
 442   {






 443     if ( !outline )
 444       return FT_THROW( Invalid_Outline );
 445 


 446     if ( !memory )
 447       return FT_THROW( Invalid_Argument );
 448 
 449     if ( outline-&gt;flags &amp; FT_OUTLINE_OWNER )
 450     {
 451       FT_FREE( outline-&gt;points   );
 452       FT_FREE( outline-&gt;tags     );
 453       FT_FREE( outline-&gt;contours );
 454     }
 455     *outline = null_outline;
 456 
 457     return FT_Err_Ok;
 458   }
 459 
 460 
<span class="line-removed"> 461   /* documentation is in ftoutln.h */</span>
<span class="line-removed"> 462 </span>
<span class="line-removed"> 463   FT_EXPORT_DEF( FT_Error )</span>
<span class="line-removed"> 464   FT_Outline_Done( FT_Library   library,</span>
<span class="line-removed"> 465                    FT_Outline*  outline )</span>
<span class="line-removed"> 466   {</span>
<span class="line-removed"> 467     /* check for valid `outline&#39; in FT_Outline_Done_Internal() */</span>
<span class="line-removed"> 468 </span>
<span class="line-removed"> 469     if ( !library )</span>
<span class="line-removed"> 470       return FT_THROW( Invalid_Library_Handle );</span>
<span class="line-removed"> 471 </span>
<span class="line-removed"> 472     return FT_Outline_Done_Internal( library-&gt;memory, outline );</span>
<span class="line-removed"> 473   }</span>
<span class="line-removed"> 474 </span>
<span class="line-removed"> 475 </span>
 476   /* documentation is in ftoutln.h */
 477 
 478   FT_EXPORT_DEF( void )
 479   FT_Outline_Get_CBox( const FT_Outline*  outline,
 480                        FT_BBox           *acbox )
 481   {
 482     FT_Pos  xMin, yMin, xMax, yMax;
 483 
 484 
 485     if ( outline &amp;&amp; acbox )
 486     {
 487       if ( outline-&gt;n_points == 0 )
 488       {
 489         xMin = 0;
 490         yMin = 0;
 491         xMax = 0;
 492         yMax = 0;
 493       }
 494       else
 495       {
</pre>
<hr />
<pre>
 602         }
 603       }
 604 
 605       first = last + 1;
 606     }
 607 
 608     outline-&gt;flags ^= FT_OUTLINE_REVERSE_FILL;
 609   }
 610 
 611 
 612   /* documentation is in ftoutln.h */
 613 
 614   FT_EXPORT_DEF( FT_Error )
 615   FT_Outline_Render( FT_Library         library,
 616                      FT_Outline*        outline,
 617                      FT_Raster_Params*  params )
 618   {
 619     FT_Error     error;
 620     FT_Renderer  renderer;
 621     FT_ListNode  node;

 622 
 623 
 624     if ( !library )
 625       return FT_THROW( Invalid_Library_Handle );
 626 
 627     if ( !outline )
 628       return FT_THROW( Invalid_Outline );
 629 
 630     if ( !params )
 631       return FT_THROW( Invalid_Argument );
 632 





 633     renderer = library-&gt;cur_renderer;
 634     node     = library-&gt;renderers.head;
 635 
 636     params-&gt;source = (void*)outline;
 637 










 638     error = FT_ERR( Cannot_Render_Glyph );
 639     while ( renderer )
 640     {
 641       error = renderer-&gt;raster_render( renderer-&gt;raster, params );
 642       if ( !error || FT_ERR_NEQ( error, Cannot_Render_Glyph ) )
 643         break;
 644 
 645       /* FT_Err_Cannot_Render_Glyph is returned if the render mode   */
 646       /* is unsupported by the current renderer for this glyph image */
 647       /* format                                                      */
 648 
 649       /* now, look for another renderer that supports the same */
 650       /* format                                                */
 651       renderer = FT_Lookup_Renderer( library, FT_GLYPH_FORMAT_OUTLINE,
 652                                      &amp;node );
 653     }
 654 
 655     return error;
 656   }
 657 
</pre>
<hr />
<pre>
 894 #endif /* 0 */
 895 
 896 
 897   /* documentation is in ftoutln.h */
 898 
 899   FT_EXPORT_DEF( FT_Error )
 900   FT_Outline_Embolden( FT_Outline*  outline,
 901                        FT_Pos       strength )
 902   {
 903     return FT_Outline_EmboldenXY( outline, strength, strength );
 904   }
 905 
 906 
 907   /* documentation is in ftoutln.h */
 908 
 909   FT_EXPORT_DEF( FT_Error )
 910   FT_Outline_EmboldenXY( FT_Outline*  outline,
 911                          FT_Pos       xstrength,
 912                          FT_Pos       ystrength )
 913   {
<span class="line-modified"> 914     FT_Vector*  points;</span>
<span class="line-modified"> 915     FT_Int      c, first, last;</span>
<span class="line-modified"> 916     FT_Int      orientation;</span>
 917 
 918 
 919     if ( !outline )
 920       return FT_THROW( Invalid_Outline );
 921 
 922     xstrength /= 2;
 923     ystrength /= 2;
 924     if ( xstrength == 0 &amp;&amp; ystrength == 0 )
 925       return FT_Err_Ok;
 926 
 927     orientation = FT_Outline_Get_Orientation( outline );
 928     if ( orientation == FT_ORIENTATION_NONE )
 929     {
 930       if ( outline-&gt;n_contours )
 931         return FT_THROW( Invalid_Argument );
 932       else
 933         return FT_Err_Ok;
 934     }
 935 
 936     points = outline-&gt;points;
</pre>
<hr />
<pre>
1027         }
1028         else
1029           i = j;
1030 
1031         in   = out;
1032         l_in = l_out;
1033       }
1034 
1035       first = last + 1;
1036     }
1037 
1038     return FT_Err_Ok;
1039   }
1040 
1041 
1042   /* documentation is in ftoutln.h */
1043 
1044   FT_EXPORT_DEF( FT_Orientation )
1045   FT_Outline_Get_Orientation( FT_Outline*  outline )
1046   {
<span class="line-modified">1047     FT_BBox     cbox;</span>
1048     FT_Int      xshift, yshift;
1049     FT_Vector*  points;
1050     FT_Vector   v_prev, v_cur;
1051     FT_Int      c, n, first;
1052     FT_Pos      area = 0;
1053 
1054 
1055     if ( !outline || outline-&gt;n_points &lt;= 0 )
1056       return FT_ORIENTATION_TRUETYPE;
1057 
1058     /* We use the nonzero winding rule to find the orientation.       */
1059     /* Since glyph outlines behave much more `regular&#39; than arbitrary */
1060     /* cubic or quadratic curves, this test deals with the polygon    */
1061     /* only that is spanned up by the control points.                 */
1062 
1063     FT_Outline_Get_CBox( outline, &amp;cbox );
1064 
1065     /* Handle collapsed outlines to avoid undefined FT_MSB. */
1066     if ( cbox.xMin == cbox.xMax || cbox.yMin == cbox.yMax )
1067       return FT_ORIENTATION_NONE;
</pre>
<hr />
<pre>
1073     yshift = FT_MSB( (FT_UInt32)( cbox.yMax - cbox.yMin ) ) - 14;
1074     yshift = FT_MAX( yshift, 0 );
1075 
1076     points = outline-&gt;points;
1077 
1078     first = 0;
1079     for ( c = 0; c &lt; outline-&gt;n_contours; c++ )
1080     {
1081       FT_Int  last = outline-&gt;contours[c];
1082 
1083 
1084       v_prev.x = points[last].x &gt;&gt; xshift;
1085       v_prev.y = points[last].y &gt;&gt; yshift;
1086 
1087       for ( n = first; n &lt;= last; n++ )
1088       {
1089         v_cur.x = points[n].x &gt;&gt; xshift;
1090         v_cur.y = points[n].y &gt;&gt; yshift;
1091 
1092         area = ADD_LONG( area,
<span class="line-modified">1093                          ( v_cur.y - v_prev.y ) * ( v_cur.x + v_prev.x ) );</span>

1094 
1095         v_prev = v_cur;
1096       }
1097 
1098       first = last + 1;
1099     }
1100 
1101     if ( area &gt; 0 )
1102       return FT_ORIENTATION_POSTSCRIPT;
1103     else if ( area &lt; 0 )
1104       return FT_ORIENTATION_TRUETYPE;
1105     else
1106       return FT_ORIENTATION_NONE;
1107   }
1108 
1109 
1110 /* END */
</pre>
</td>
<td>
<hr />
<pre>
<span class="line-modified">   1 /****************************************************************************</span>
<span class="line-modified">   2  *</span>
<span class="line-modified">   3  * ftoutln.c</span>
<span class="line-modified">   4  *</span>
<span class="line-modified">   5  *   FreeType outline management (body).</span>
<span class="line-modified">   6  *</span>
<span class="line-modified">   7  * Copyright (C) 1996-2019 by</span>
<span class="line-modified">   8  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">   9  *</span>
<span class="line-modified">  10  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified">  11  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified">  12  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified">  13  * this file you indicate that you have read the license and</span>
<span class="line-modified">  14  * understand and accept it fully.</span>
<span class="line-modified">  15  *</span>
<span class="line-modified">  16  */</span>







  17 
  18 
  19 #include &lt;ft2build.h&gt;
  20 #include FT_OUTLINE_H
  21 #include FT_INTERNAL_OBJECTS_H
  22 #include FT_INTERNAL_CALC_H
  23 #include FT_INTERNAL_DEBUG_H
  24 #include FT_TRIGONOMETRY_H
  25 
  26 
<span class="line-modified">  27   /**************************************************************************</span>
<span class="line-modified">  28    *</span>
<span class="line-modified">  29    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="line-modified">  30    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="line-modified">  31    * messages during execution.</span>
<span class="line-modified">  32    */</span>
  33 #undef  FT_COMPONENT
<span class="line-modified">  34 #define FT_COMPONENT  outline</span>
  35 
  36 
  37   static
  38   const FT_Outline  null_outline = { 0, 0, NULL, NULL, NULL, 0 };
  39 
  40 
  41   /* documentation is in ftoutln.h */
  42 
  43   FT_EXPORT_DEF( FT_Error )
  44   FT_Outline_Decompose( FT_Outline*              outline,
  45                         const FT_Outline_Funcs*  func_interface,
  46                         void*                    user )
  47   {
  48 #undef  SCALED
<span class="line-modified">  49 #define SCALED( x )  ( (x) * ( 1L &lt;&lt; shift ) - delta )</span>

  50 
  51     FT_Vector   v_last;
  52     FT_Vector   v_control;
  53     FT_Vector   v_start;
  54 
  55     FT_Vector*  point;
  56     FT_Vector*  limit;
  57     char*       tags;
  58 
  59     FT_Error    error;
  60 
  61     FT_Int   n;         /* index of contour in outline     */
  62     FT_UInt  first;     /* index of first point in contour */
  63     FT_Int   tag;       /* current point&#39;s state           */
  64 
  65     FT_Int   shift;
  66     FT_Pos   delta;
  67 
  68 
  69     if ( !outline )
</pre>
<hr />
<pre>
 271     Close:
 272       if ( error )
 273         goto Exit;
 274 
 275       first = (FT_UInt)last + 1;
 276     }
 277 
 278     FT_TRACE5(( &quot;FT_Outline_Decompose: Done\n&quot;, n ));
 279     return FT_Err_Ok;
 280 
 281   Invalid_Outline:
 282     error = FT_THROW( Invalid_Outline );
 283     /* fall through */
 284 
 285   Exit:
 286     FT_TRACE5(( &quot;FT_Outline_Decompose: Error 0x%x\n&quot;, error ));
 287     return error;
 288   }
 289 
 290 
<span class="line-added"> 291   /* documentation is in ftoutln.h */</span>
<span class="line-added"> 292 </span>
 293   FT_EXPORT_DEF( FT_Error )
<span class="line-modified"> 294   FT_Outline_New( FT_Library   library,</span>
<span class="line-modified"> 295                   FT_UInt      numPoints,</span>
<span class="line-modified"> 296                   FT_Int       numContours,</span>
<span class="line-modified"> 297                   FT_Outline  *anoutline )</span>
 298   {
<span class="line-modified"> 299     FT_Error   error;</span>
<span class="line-added"> 300     FT_Memory  memory;</span>
<span class="line-added"> 301 </span>
 302 
<span class="line-added"> 303     if ( !library )</span>
<span class="line-added"> 304       return FT_THROW( Invalid_Library_Handle );</span>
<span class="line-added"> 305 </span>
<span class="line-added"> 306     memory = library-&gt;memory;</span>
 307 
 308     if ( !anoutline || !memory )
 309       return FT_THROW( Invalid_Argument );
 310 
 311     *anoutline = null_outline;
 312 
 313     if ( numContours &lt; 0                  ||
 314          (FT_UInt)numContours &gt; numPoints )
 315       return FT_THROW( Invalid_Argument );
 316 
 317     if ( numPoints &gt; FT_OUTLINE_POINTS_MAX )
 318       return FT_THROW( Array_Too_Large );
 319 
 320     if ( FT_NEW_ARRAY( anoutline-&gt;points,   numPoints   ) ||
 321          FT_NEW_ARRAY( anoutline-&gt;tags,     numPoints   ) ||
 322          FT_NEW_ARRAY( anoutline-&gt;contours, numContours ) )
 323       goto Fail;
 324 
 325     anoutline-&gt;n_points    = (FT_Short)numPoints;
 326     anoutline-&gt;n_contours  = (FT_Short)numContours;
 327     anoutline-&gt;flags      |= FT_OUTLINE_OWNER;
 328 
 329     return FT_Err_Ok;
 330 
 331   Fail:
 332     anoutline-&gt;flags |= FT_OUTLINE_OWNER;
<span class="line-modified"> 333     FT_Outline_Done( library, anoutline );</span>
 334 
 335     return error;
 336   }
 337 
 338 
















 339   /* documentation is in ftoutln.h */
 340 
 341   FT_EXPORT_DEF( FT_Error )
 342   FT_Outline_Check( FT_Outline*  outline )
 343   {
 344     if ( outline )
 345     {
 346       FT_Int  n_points   = outline-&gt;n_points;
 347       FT_Int  n_contours = outline-&gt;n_contours;
 348       FT_Int  end0, end;
 349       FT_Int  n;
 350 
 351 
 352       /* empty glyph? */
 353       if ( n_points == 0 &amp;&amp; n_contours == 0 )
 354         return FT_Err_Ok;
 355 
 356       /* check point and contour counts */
 357       if ( n_points &lt;= 0 || n_contours &lt;= 0 )
 358         goto Bad;
</pre>
<hr />
<pre>
 403     if ( source-&gt;n_points )
 404     {
 405       FT_ARRAY_COPY( target-&gt;points, source-&gt;points, source-&gt;n_points );
 406       FT_ARRAY_COPY( target-&gt;tags,   source-&gt;tags,   source-&gt;n_points );
 407     }
 408 
 409     if ( source-&gt;n_contours )
 410       FT_ARRAY_COPY( target-&gt;contours, source-&gt;contours, source-&gt;n_contours );
 411 
 412     /* copy all flags, except the `FT_OUTLINE_OWNER&#39; one */
 413     is_owner      = target-&gt;flags &amp; FT_OUTLINE_OWNER;
 414     target-&gt;flags = source-&gt;flags;
 415 
 416     target-&gt;flags &amp;= ~FT_OUTLINE_OWNER;
 417     target-&gt;flags |= is_owner;
 418 
 419     return FT_Err_Ok;
 420   }
 421 
 422 
<span class="line-added"> 423   /* documentation is in ftoutln.h */</span>
<span class="line-added"> 424 </span>
 425   FT_EXPORT_DEF( FT_Error )
<span class="line-modified"> 426   FT_Outline_Done( FT_Library   library,</span>
<span class="line-modified"> 427                    FT_Outline*  outline )</span>
 428   {
<span class="line-added"> 429     FT_Memory  memory;</span>
<span class="line-added"> 430 </span>
<span class="line-added"> 431 </span>
<span class="line-added"> 432     if ( !library )</span>
<span class="line-added"> 433       return FT_THROW( Invalid_Library_Handle );</span>
<span class="line-added"> 434 </span>
 435     if ( !outline )
 436       return FT_THROW( Invalid_Outline );
 437 
<span class="line-added"> 438     memory = library-&gt;memory;</span>
<span class="line-added"> 439 </span>
 440     if ( !memory )
 441       return FT_THROW( Invalid_Argument );
 442 
 443     if ( outline-&gt;flags &amp; FT_OUTLINE_OWNER )
 444     {
 445       FT_FREE( outline-&gt;points   );
 446       FT_FREE( outline-&gt;tags     );
 447       FT_FREE( outline-&gt;contours );
 448     }
 449     *outline = null_outline;
 450 
 451     return FT_Err_Ok;
 452   }
 453 
 454 















 455   /* documentation is in ftoutln.h */
 456 
 457   FT_EXPORT_DEF( void )
 458   FT_Outline_Get_CBox( const FT_Outline*  outline,
 459                        FT_BBox           *acbox )
 460   {
 461     FT_Pos  xMin, yMin, xMax, yMax;
 462 
 463 
 464     if ( outline &amp;&amp; acbox )
 465     {
 466       if ( outline-&gt;n_points == 0 )
 467       {
 468         xMin = 0;
 469         yMin = 0;
 470         xMax = 0;
 471         yMax = 0;
 472       }
 473       else
 474       {
</pre>
<hr />
<pre>
 581         }
 582       }
 583 
 584       first = last + 1;
 585     }
 586 
 587     outline-&gt;flags ^= FT_OUTLINE_REVERSE_FILL;
 588   }
 589 
 590 
 591   /* documentation is in ftoutln.h */
 592 
 593   FT_EXPORT_DEF( FT_Error )
 594   FT_Outline_Render( FT_Library         library,
 595                      FT_Outline*        outline,
 596                      FT_Raster_Params*  params )
 597   {
 598     FT_Error     error;
 599     FT_Renderer  renderer;
 600     FT_ListNode  node;
<span class="line-added"> 601     FT_BBox      cbox;</span>
 602 
 603 
 604     if ( !library )
 605       return FT_THROW( Invalid_Library_Handle );
 606 
 607     if ( !outline )
 608       return FT_THROW( Invalid_Outline );
 609 
 610     if ( !params )
 611       return FT_THROW( Invalid_Argument );
 612 
<span class="line-added"> 613     FT_Outline_Get_CBox( outline, &amp;cbox );</span>
<span class="line-added"> 614     if ( cbox.xMin &lt; -0x1000000L || cbox.yMin &lt; -0x1000000L ||</span>
<span class="line-added"> 615          cbox.xMax &gt;  0x1000000L || cbox.yMax &gt;  0x1000000L )</span>
<span class="line-added"> 616       return FT_THROW( Invalid_Outline );</span>
<span class="line-added"> 617 </span>
 618     renderer = library-&gt;cur_renderer;
 619     node     = library-&gt;renderers.head;
 620 
 621     params-&gt;source = (void*)outline;
 622 
<span class="line-added"> 623     /* preset clip_box for direct mode */</span>
<span class="line-added"> 624     if ( params-&gt;flags &amp; FT_RASTER_FLAG_DIRECT    &amp;&amp;</span>
<span class="line-added"> 625          !( params-&gt;flags &amp; FT_RASTER_FLAG_CLIP ) )</span>
<span class="line-added"> 626     {</span>
<span class="line-added"> 627       params-&gt;clip_box.xMin = cbox.xMin &gt;&gt; 6;</span>
<span class="line-added"> 628       params-&gt;clip_box.yMin = cbox.yMin &gt;&gt; 6;</span>
<span class="line-added"> 629       params-&gt;clip_box.xMax = ( cbox.xMax + 63 ) &gt;&gt; 6;</span>
<span class="line-added"> 630       params-&gt;clip_box.yMax = ( cbox.yMax + 63 ) &gt;&gt; 6;</span>
<span class="line-added"> 631     }</span>
<span class="line-added"> 632 </span>
 633     error = FT_ERR( Cannot_Render_Glyph );
 634     while ( renderer )
 635     {
 636       error = renderer-&gt;raster_render( renderer-&gt;raster, params );
 637       if ( !error || FT_ERR_NEQ( error, Cannot_Render_Glyph ) )
 638         break;
 639 
 640       /* FT_Err_Cannot_Render_Glyph is returned if the render mode   */
 641       /* is unsupported by the current renderer for this glyph image */
 642       /* format                                                      */
 643 
 644       /* now, look for another renderer that supports the same */
 645       /* format                                                */
 646       renderer = FT_Lookup_Renderer( library, FT_GLYPH_FORMAT_OUTLINE,
 647                                      &amp;node );
 648     }
 649 
 650     return error;
 651   }
 652 
</pre>
<hr />
<pre>
 889 #endif /* 0 */
 890 
 891 
 892   /* documentation is in ftoutln.h */
 893 
 894   FT_EXPORT_DEF( FT_Error )
 895   FT_Outline_Embolden( FT_Outline*  outline,
 896                        FT_Pos       strength )
 897   {
 898     return FT_Outline_EmboldenXY( outline, strength, strength );
 899   }
 900 
 901 
 902   /* documentation is in ftoutln.h */
 903 
 904   FT_EXPORT_DEF( FT_Error )
 905   FT_Outline_EmboldenXY( FT_Outline*  outline,
 906                          FT_Pos       xstrength,
 907                          FT_Pos       ystrength )
 908   {
<span class="line-modified"> 909     FT_Vector*      points;</span>
<span class="line-modified"> 910     FT_Int          c, first, last;</span>
<span class="line-modified"> 911     FT_Orientation  orientation;</span>
 912 
 913 
 914     if ( !outline )
 915       return FT_THROW( Invalid_Outline );
 916 
 917     xstrength /= 2;
 918     ystrength /= 2;
 919     if ( xstrength == 0 &amp;&amp; ystrength == 0 )
 920       return FT_Err_Ok;
 921 
 922     orientation = FT_Outline_Get_Orientation( outline );
 923     if ( orientation == FT_ORIENTATION_NONE )
 924     {
 925       if ( outline-&gt;n_contours )
 926         return FT_THROW( Invalid_Argument );
 927       else
 928         return FT_Err_Ok;
 929     }
 930 
 931     points = outline-&gt;points;
</pre>
<hr />
<pre>
1022         }
1023         else
1024           i = j;
1025 
1026         in   = out;
1027         l_in = l_out;
1028       }
1029 
1030       first = last + 1;
1031     }
1032 
1033     return FT_Err_Ok;
1034   }
1035 
1036 
1037   /* documentation is in ftoutln.h */
1038 
1039   FT_EXPORT_DEF( FT_Orientation )
1040   FT_Outline_Get_Orientation( FT_Outline*  outline )
1041   {
<span class="line-modified">1042     FT_BBox     cbox = { 0, 0, 0, 0 };</span>
1043     FT_Int      xshift, yshift;
1044     FT_Vector*  points;
1045     FT_Vector   v_prev, v_cur;
1046     FT_Int      c, n, first;
1047     FT_Pos      area = 0;
1048 
1049 
1050     if ( !outline || outline-&gt;n_points &lt;= 0 )
1051       return FT_ORIENTATION_TRUETYPE;
1052 
1053     /* We use the nonzero winding rule to find the orientation.       */
1054     /* Since glyph outlines behave much more `regular&#39; than arbitrary */
1055     /* cubic or quadratic curves, this test deals with the polygon    */
1056     /* only that is spanned up by the control points.                 */
1057 
1058     FT_Outline_Get_CBox( outline, &amp;cbox );
1059 
1060     /* Handle collapsed outlines to avoid undefined FT_MSB. */
1061     if ( cbox.xMin == cbox.xMax || cbox.yMin == cbox.yMax )
1062       return FT_ORIENTATION_NONE;
</pre>
<hr />
<pre>
1068     yshift = FT_MSB( (FT_UInt32)( cbox.yMax - cbox.yMin ) ) - 14;
1069     yshift = FT_MAX( yshift, 0 );
1070 
1071     points = outline-&gt;points;
1072 
1073     first = 0;
1074     for ( c = 0; c &lt; outline-&gt;n_contours; c++ )
1075     {
1076       FT_Int  last = outline-&gt;contours[c];
1077 
1078 
1079       v_prev.x = points[last].x &gt;&gt; xshift;
1080       v_prev.y = points[last].y &gt;&gt; yshift;
1081 
1082       for ( n = first; n &lt;= last; n++ )
1083       {
1084         v_cur.x = points[n].x &gt;&gt; xshift;
1085         v_cur.y = points[n].y &gt;&gt; yshift;
1086 
1087         area = ADD_LONG( area,
<span class="line-modified">1088                          MUL_LONG( v_cur.y - v_prev.y,</span>
<span class="line-added">1089                                    v_cur.x + v_prev.x ) );</span>
1090 
1091         v_prev = v_cur;
1092       }
1093 
1094       first = last + 1;
1095     }
1096 
1097     if ( area &gt; 0 )
1098       return FT_ORIENTATION_POSTSCRIPT;
1099     else if ( area &lt; 0 )
1100       return FT_ORIENTATION_TRUETYPE;
1101     else
1102       return FT_ORIENTATION_NONE;
1103   }
1104 
1105 
1106 /* END */
</pre>
</td>
</tr>
</table>
<center><a href="ftobjs.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ftpatent.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>