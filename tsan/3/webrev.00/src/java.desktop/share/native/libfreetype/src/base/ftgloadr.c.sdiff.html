<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/native/libfreetype/src/base/ftgloadr.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ftgasp.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ftglyph.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/base/ftgloadr.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
<span class="line-modified">  1 /***************************************************************************/</span>
<span class="line-modified">  2 /*                                                                         */</span>
<span class="line-modified">  3 /*  ftgloadr.c                                                             */</span>
<span class="line-modified">  4 /*                                                                         */</span>
<span class="line-modified">  5 /*    The FreeType glyph loader (body).                                    */</span>
<span class="line-modified">  6 /*                                                                         */</span>
<span class="line-modified">  7 /*  Copyright 2002-2018 by                                                 */</span>
<span class="line-modified">  8 /*  David Turner, Robert Wilhelm, and Werner Lemberg                       */</span>
<span class="line-modified">  9 /*                                                                         */</span>
<span class="line-modified"> 10 /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified"> 11 /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified"> 12 /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified"> 13 /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified"> 14 /*  understand and accept it fully.                                        */</span>
<span class="line-modified"> 15 /*                                                                         */</span>
<span class="line-modified"> 16 /***************************************************************************/</span>
 17 
 18 
 19 #include &lt;ft2build.h&gt;
 20 #include FT_INTERNAL_DEBUG_H
 21 #include FT_INTERNAL_GLYPH_LOADER_H
 22 #include FT_INTERNAL_MEMORY_H
 23 #include FT_INTERNAL_OBJECTS_H
 24 
 25 #undef  FT_COMPONENT
<span class="line-modified"> 26 #define FT_COMPONENT  trace_gloader</span>
 27 
 28 
 29   /*************************************************************************/
 30   /*************************************************************************/
 31   /*************************************************************************/
 32   /*****                                                               *****/
 33   /*****                                                               *****/
 34   /*****                    G L Y P H   L O A D E R                    *****/
 35   /*****                                                               *****/
 36   /*****                                                               *****/
 37   /*************************************************************************/
 38   /*************************************************************************/
 39   /*************************************************************************/
 40 
<span class="line-modified"> 41   /*************************************************************************/</span>
<span class="line-modified"> 42   /*                                                                       */</span>
<span class="line-modified"> 43   /* The glyph loader is a simple object which is used to load a set of    */</span>
<span class="line-modified"> 44   /* glyphs easily.  It is critical for the correct loading of composites. */</span>
<span class="line-modified"> 45   /*                                                                       */</span>
<span class="line-modified"> 46   /* Ideally, one can see it as a stack of abstract `glyph&#39; objects.       */</span>
<span class="line-modified"> 47   /*                                                                       */</span>
<span class="line-modified"> 48   /*   loader.base     Is really the bottom of the stack.  It describes a  */</span>
<span class="line-modified"> 49   /*                   single glyph image made of the juxtaposition of     */</span>
<span class="line-modified"> 50   /*                   several glyphs (those `in the stack&#39;).              */</span>
<span class="line-modified"> 51   /*                                                                       */</span>
<span class="line-modified"> 52   /*   loader.current  Describes the top of the stack, on which a new      */</span>
<span class="line-modified"> 53   /*                   glyph can be loaded.                                */</span>
<span class="line-modified"> 54   /*                                                                       */</span>
<span class="line-modified"> 55   /*   Rewind          Clears the stack.                                   */</span>
<span class="line-modified"> 56   /*   Prepare         Set up `loader.current&#39; for addition of a new glyph */</span>
<span class="line-modified"> 57   /*                   image.                                              */</span>
<span class="line-modified"> 58   /*   Add             Add the `current&#39; glyph image to the `base&#39; one,    */</span>
<span class="line-modified"> 59   /*                   and prepare for another one.                        */</span>
<span class="line-modified"> 60   /*                                                                       */</span>
<span class="line-modified"> 61   /* The glyph loader is now a base object.  Each driver used to           */</span>
<span class="line-modified"> 62   /* re-implement it in one way or the other, which wasted code and        */</span>
<span class="line-modified"> 63   /* energy.                                                               */</span>
<span class="line-modified"> 64   /*                                                                       */</span>
<span class="line-modified"> 65   /*************************************************************************/</span>
 66 
 67 
 68   /* create a new glyph loader */
 69   FT_BASE_DEF( FT_Error )
 70   FT_GlyphLoader_New( FT_Memory        memory,
 71                       FT_GlyphLoader  *aloader )
 72   {
 73     FT_GlyphLoader  loader = NULL;
 74     FT_Error        error;
 75 
 76 
 77     if ( !FT_NEW( loader ) )
 78     {
 79       loader-&gt;memory = memory;
 80       *aloader       = loader;
 81     }
 82     return error;
 83   }
 84 
 85 
 86   /* rewind the glyph loader - reset counters to 0 */
 87   FT_BASE_DEF( void )
 88   FT_GlyphLoader_Rewind( FT_GlyphLoader  loader )
 89   {
 90     FT_GlyphLoad  base    = &amp;loader-&gt;base;
 91     FT_GlyphLoad  current = &amp;loader-&gt;current;
 92 
 93 
 94     base-&gt;outline.n_points   = 0;
 95     base-&gt;outline.n_contours = 0;
 96     base-&gt;num_subglyphs      = 0;
 97 
 98     *current = *base;
 99   }
100 
101 
<span class="line-modified">102   /* reset the glyph loader, frees all allocated tables */</span>
<span class="line-modified">103   /* and starts from zero                               */</span>
104   FT_BASE_DEF( void )
105   FT_GlyphLoader_Reset( FT_GlyphLoader  loader )
106   {
<span class="line-modified">107     FT_Memory memory = loader-&gt;memory;</span>
108 
109 
110     FT_FREE( loader-&gt;base.outline.points );
111     FT_FREE( loader-&gt;base.outline.tags );
112     FT_FREE( loader-&gt;base.outline.contours );
113     FT_FREE( loader-&gt;base.extra_points );
114     FT_FREE( loader-&gt;base.subglyphs );
115 
116     loader-&gt;base.extra_points2 = NULL;
117 
118     loader-&gt;max_points    = 0;
119     loader-&gt;max_contours  = 0;
120     loader-&gt;max_subglyphs = 0;
121 
122     FT_GlyphLoader_Rewind( loader );
123   }
124 
125 
126   /* delete a glyph loader */
127   FT_BASE_DEF( void )
128   FT_GlyphLoader_Done( FT_GlyphLoader  loader )
129   {
130     if ( loader )
131     {
<span class="line-modified">132       FT_Memory memory = loader-&gt;memory;</span>
133 
134 
135       FT_GlyphLoader_Reset( loader );
136       FT_FREE( loader );
137     }
138   }
139 
140 
141   /* re-adjust the `current&#39; outline fields */
142   static void
143   FT_GlyphLoader_Adjust_Points( FT_GlyphLoader  loader )
144   {
145     FT_Outline*  base    = &amp;loader-&gt;base.outline;
146     FT_Outline*  current = &amp;loader-&gt;current.outline;
147 
148 
149     current-&gt;points   = base-&gt;points   + base-&gt;n_points;
150     current-&gt;tags     = base-&gt;tags     + base-&gt;n_points;
151     current-&gt;contours = base-&gt;contours + base-&gt;n_contours;
152 
</pre>
<hr />
<pre>
344     n_curr_contours = current-&gt;outline.n_contours;
345     n_base_points   = base-&gt;outline.n_points;
346 
347     base-&gt;outline.n_points =
348       (short)( base-&gt;outline.n_points + current-&gt;outline.n_points );
349     base-&gt;outline.n_contours =
350       (short)( base-&gt;outline.n_contours + current-&gt;outline.n_contours );
351 
352     base-&gt;num_subglyphs += current-&gt;num_subglyphs;
353 
354     /* adjust contours count in newest outline */
355     for ( n = 0; n &lt; n_curr_contours; n++ )
356       current-&gt;outline.contours[n] =
357         (short)( current-&gt;outline.contours[n] + n_base_points );
358 
359     /* prepare for another new glyph image */
360     FT_GlyphLoader_Prepare( loader );
361   }
362 
363 
<span class="line-removed">364   FT_BASE_DEF( FT_Error )</span>
<span class="line-removed">365   FT_GlyphLoader_CopyPoints( FT_GlyphLoader  target,</span>
<span class="line-removed">366                              FT_GlyphLoader  source )</span>
<span class="line-removed">367   {</span>
<span class="line-removed">368     FT_Error  error;</span>
<span class="line-removed">369     FT_UInt   num_points   = (FT_UInt)source-&gt;base.outline.n_points;</span>
<span class="line-removed">370     FT_UInt   num_contours = (FT_UInt)source-&gt;base.outline.n_contours;</span>
<span class="line-removed">371 </span>
<span class="line-removed">372 </span>
<span class="line-removed">373     error = FT_GlyphLoader_CheckPoints( target, num_points, num_contours );</span>
<span class="line-removed">374     if ( !error )</span>
<span class="line-removed">375     {</span>
<span class="line-removed">376       FT_Outline*  out = &amp;target-&gt;base.outline;</span>
<span class="line-removed">377       FT_Outline*  in  = &amp;source-&gt;base.outline;</span>
<span class="line-removed">378 </span>
<span class="line-removed">379 </span>
<span class="line-removed">380       FT_ARRAY_COPY( out-&gt;points, in-&gt;points,</span>
<span class="line-removed">381                      num_points );</span>
<span class="line-removed">382       FT_ARRAY_COPY( out-&gt;tags, in-&gt;tags,</span>
<span class="line-removed">383                      num_points );</span>
<span class="line-removed">384       FT_ARRAY_COPY( out-&gt;contours, in-&gt;contours,</span>
<span class="line-removed">385                      num_contours );</span>
<span class="line-removed">386 </span>
<span class="line-removed">387       /* do we need to copy the extra points? */</span>
<span class="line-removed">388       if ( target-&gt;use_extra &amp;&amp; source-&gt;use_extra )</span>
<span class="line-removed">389       {</span>
<span class="line-removed">390         FT_ARRAY_COPY( target-&gt;base.extra_points, source-&gt;base.extra_points,</span>
<span class="line-removed">391                        num_points );</span>
<span class="line-removed">392         FT_ARRAY_COPY( target-&gt;base.extra_points2, source-&gt;base.extra_points2,</span>
<span class="line-removed">393                        num_points );</span>
<span class="line-removed">394       }</span>
<span class="line-removed">395 </span>
<span class="line-removed">396       out-&gt;n_points   = (short)num_points;</span>
<span class="line-removed">397       out-&gt;n_contours = (short)num_contours;</span>
<span class="line-removed">398 </span>
<span class="line-removed">399       FT_GlyphLoader_Adjust_Points( target );</span>
<span class="line-removed">400     }</span>
<span class="line-removed">401 </span>
<span class="line-removed">402     return error;</span>
<span class="line-removed">403   }</span>
<span class="line-removed">404 </span>
<span class="line-removed">405 </span>
406 /* END */
</pre>
</td>
<td>
<hr />
<pre>
<span class="line-modified">  1 /****************************************************************************</span>
<span class="line-modified">  2  *</span>
<span class="line-modified">  3  * ftgloadr.c</span>
<span class="line-modified">  4  *</span>
<span class="line-modified">  5  *   The FreeType glyph loader (body).</span>
<span class="line-modified">  6  *</span>
<span class="line-modified">  7  * Copyright (C) 2002-2019 by</span>
<span class="line-modified">  8  * David Turner, Robert Wilhelm, and Werner Lemberg</span>
<span class="line-modified">  9  *</span>
<span class="line-modified"> 10  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified"> 11  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified"> 12  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified"> 13  * this file you indicate that you have read the license and</span>
<span class="line-modified"> 14  * understand and accept it fully.</span>
<span class="line-modified"> 15  *</span>
<span class="line-modified"> 16  */</span>
 17 
 18 
 19 #include &lt;ft2build.h&gt;
 20 #include FT_INTERNAL_DEBUG_H
 21 #include FT_INTERNAL_GLYPH_LOADER_H
 22 #include FT_INTERNAL_MEMORY_H
 23 #include FT_INTERNAL_OBJECTS_H
 24 
 25 #undef  FT_COMPONENT
<span class="line-modified"> 26 #define FT_COMPONENT  gloader</span>
 27 
 28 
 29   /*************************************************************************/
 30   /*************************************************************************/
 31   /*************************************************************************/
 32   /*****                                                               *****/
 33   /*****                                                               *****/
 34   /*****                    G L Y P H   L O A D E R                    *****/
 35   /*****                                                               *****/
 36   /*****                                                               *****/
 37   /*************************************************************************/
 38   /*************************************************************************/
 39   /*************************************************************************/
 40 
<span class="line-modified"> 41   /**************************************************************************</span>
<span class="line-modified"> 42    *</span>
<span class="line-modified"> 43    * The glyph loader is a simple object which is used to load a set of</span>
<span class="line-modified"> 44    * glyphs easily.  It is critical for the correct loading of composites.</span>
<span class="line-modified"> 45    *</span>
<span class="line-modified"> 46    * Ideally, one can see it as a stack of abstract `glyph&#39; objects.</span>
<span class="line-modified"> 47    *</span>
<span class="line-modified"> 48    *   loader.base     Is really the bottom of the stack.  It describes a</span>
<span class="line-modified"> 49    *                   single glyph image made of the juxtaposition of</span>
<span class="line-modified"> 50    *                   several glyphs (those `in the stack&#39;).</span>
<span class="line-modified"> 51    *</span>
<span class="line-modified"> 52    *   loader.current  Describes the top of the stack, on which a new</span>
<span class="line-modified"> 53    *                   glyph can be loaded.</span>
<span class="line-modified"> 54    *</span>
<span class="line-modified"> 55    *   Rewind          Clears the stack.</span>
<span class="line-modified"> 56    *   Prepare         Set up `loader.current&#39; for addition of a new glyph</span>
<span class="line-modified"> 57    *                   image.</span>
<span class="line-modified"> 58    *   Add             Add the `current&#39; glyph image to the `base&#39; one,</span>
<span class="line-modified"> 59    *                   and prepare for another one.</span>
<span class="line-modified"> 60    *</span>
<span class="line-modified"> 61    * The glyph loader is now a base object.  Each driver used to</span>
<span class="line-modified"> 62    * re-implement it in one way or the other, which wasted code and</span>
<span class="line-modified"> 63    * energy.</span>
<span class="line-modified"> 64    *</span>
<span class="line-modified"> 65    */</span>
 66 
 67 
 68   /* create a new glyph loader */
 69   FT_BASE_DEF( FT_Error )
 70   FT_GlyphLoader_New( FT_Memory        memory,
 71                       FT_GlyphLoader  *aloader )
 72   {
 73     FT_GlyphLoader  loader = NULL;
 74     FT_Error        error;
 75 
 76 
 77     if ( !FT_NEW( loader ) )
 78     {
 79       loader-&gt;memory = memory;
 80       *aloader       = loader;
 81     }
 82     return error;
 83   }
 84 
 85 
 86   /* rewind the glyph loader - reset counters to 0 */
 87   FT_BASE_DEF( void )
 88   FT_GlyphLoader_Rewind( FT_GlyphLoader  loader )
 89   {
 90     FT_GlyphLoad  base    = &amp;loader-&gt;base;
 91     FT_GlyphLoad  current = &amp;loader-&gt;current;
 92 
 93 
 94     base-&gt;outline.n_points   = 0;
 95     base-&gt;outline.n_contours = 0;
 96     base-&gt;num_subglyphs      = 0;
 97 
 98     *current = *base;
 99   }
100 
101 
<span class="line-modified">102   /* reset glyph loader, free all allocated tables, */</span>
<span class="line-modified">103   /* and start from zero                            */</span>
104   FT_BASE_DEF( void )
105   FT_GlyphLoader_Reset( FT_GlyphLoader  loader )
106   {
<span class="line-modified">107     FT_Memory  memory = loader-&gt;memory;</span>
108 
109 
110     FT_FREE( loader-&gt;base.outline.points );
111     FT_FREE( loader-&gt;base.outline.tags );
112     FT_FREE( loader-&gt;base.outline.contours );
113     FT_FREE( loader-&gt;base.extra_points );
114     FT_FREE( loader-&gt;base.subglyphs );
115 
116     loader-&gt;base.extra_points2 = NULL;
117 
118     loader-&gt;max_points    = 0;
119     loader-&gt;max_contours  = 0;
120     loader-&gt;max_subglyphs = 0;
121 
122     FT_GlyphLoader_Rewind( loader );
123   }
124 
125 
126   /* delete a glyph loader */
127   FT_BASE_DEF( void )
128   FT_GlyphLoader_Done( FT_GlyphLoader  loader )
129   {
130     if ( loader )
131     {
<span class="line-modified">132       FT_Memory  memory = loader-&gt;memory;</span>
133 
134 
135       FT_GlyphLoader_Reset( loader );
136       FT_FREE( loader );
137     }
138   }
139 
140 
141   /* re-adjust the `current&#39; outline fields */
142   static void
143   FT_GlyphLoader_Adjust_Points( FT_GlyphLoader  loader )
144   {
145     FT_Outline*  base    = &amp;loader-&gt;base.outline;
146     FT_Outline*  current = &amp;loader-&gt;current.outline;
147 
148 
149     current-&gt;points   = base-&gt;points   + base-&gt;n_points;
150     current-&gt;tags     = base-&gt;tags     + base-&gt;n_points;
151     current-&gt;contours = base-&gt;contours + base-&gt;n_contours;
152 
</pre>
<hr />
<pre>
344     n_curr_contours = current-&gt;outline.n_contours;
345     n_base_points   = base-&gt;outline.n_points;
346 
347     base-&gt;outline.n_points =
348       (short)( base-&gt;outline.n_points + current-&gt;outline.n_points );
349     base-&gt;outline.n_contours =
350       (short)( base-&gt;outline.n_contours + current-&gt;outline.n_contours );
351 
352     base-&gt;num_subglyphs += current-&gt;num_subglyphs;
353 
354     /* adjust contours count in newest outline */
355     for ( n = 0; n &lt; n_curr_contours; n++ )
356       current-&gt;outline.contours[n] =
357         (short)( current-&gt;outline.contours[n] + n_base_points );
358 
359     /* prepare for another new glyph image */
360     FT_GlyphLoader_Prepare( loader );
361   }
362 
363 










































364 /* END */
</pre>
</td>
</tr>
</table>
<center><a href="ftgasp.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ftglyph.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>