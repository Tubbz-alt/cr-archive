<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.desktop/share/native/libfreetype/src/base/ftsynth.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre><a name="1" id="anc1"></a><span class="line-modified">  1 /****************************************************************************</span>
<span class="line-modified">  2  *</span>
<span class="line-modified">  3  * ftsynth.c</span>
<span class="line-modified">  4  *</span>
<span class="line-modified">  5  *   FreeType synthesizing code for emboldening and slanting (body).</span>
<span class="line-modified">  6  *</span>
<span class="line-modified">  7  * Copyright (C) 2000-2019 by</span>
<span class="line-modified">  8  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">  9  *</span>
<span class="line-modified"> 10  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified"> 11  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified"> 12  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified"> 13  * this file you indicate that you have read the license and</span>
<span class="line-modified"> 14  * understand and accept it fully.</span>
<span class="line-modified"> 15  *</span>
<span class="line-modified"> 16  */</span>
 17 
 18 
 19 #include &lt;ft2build.h&gt;
 20 #include FT_SYNTHESIS_H
 21 #include FT_INTERNAL_DEBUG_H
 22 #include FT_INTERNAL_OBJECTS_H
 23 #include FT_OUTLINE_H
 24 #include FT_BITMAP_H
 25 
 26 
<a name="2" id="anc2"></a><span class="line-modified"> 27   /**************************************************************************</span>
<span class="line-modified"> 28    *</span>
<span class="line-modified"> 29    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="line-modified"> 30    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="line-modified"> 31    * messages during execution.</span>
<span class="line-modified"> 32    */</span>
 33 #undef  FT_COMPONENT
<a name="3" id="anc3"></a><span class="line-modified"> 34 #define FT_COMPONENT  synth</span>
 35 
 36 
 37   /*************************************************************************/
 38   /*************************************************************************/
 39   /****                                                                 ****/
 40   /****   EXPERIMENTAL OBLIQUING SUPPORT                                ****/
 41   /****                                                                 ****/
 42   /*************************************************************************/
 43   /*************************************************************************/
 44 
 45   /* documentation is in ftsynth.h */
 46 
 47   FT_EXPORT_DEF( void )
 48   FT_GlyphSlot_Oblique( FT_GlyphSlot  slot )
 49   {
 50     FT_Matrix    transform;
 51     FT_Outline*  outline;
 52 
 53 
 54     if ( !slot )
 55       return;
 56 
 57     outline = &amp;slot-&gt;outline;
 58 
 59     /* only oblique outline glyphs */
 60     if ( slot-&gt;format != FT_GLYPH_FORMAT_OUTLINE )
 61       return;
 62 
 63     /* we don&#39;t touch the advance width */
 64 
 65     /* For italic, simply apply a shear transform, with an angle */
 66     /* of about 12 degrees.                                      */
 67 
 68     transform.xx = 0x10000L;
 69     transform.yx = 0x00000L;
 70 
 71     transform.xy = 0x0366AL;
 72     transform.yy = 0x10000L;
 73 
 74     FT_Outline_Transform( outline, &amp;transform );
 75   }
 76 
 77 
 78   /*************************************************************************/
 79   /*************************************************************************/
 80   /****                                                                 ****/
 81   /****   EXPERIMENTAL EMBOLDENING SUPPORT                              ****/
 82   /****                                                                 ****/
 83   /*************************************************************************/
 84   /*************************************************************************/
 85 
 86 
 87   /* documentation is in ftsynth.h */
 88 
 89   FT_EXPORT_DEF( void )
 90   FT_GlyphSlot_Embolden( FT_GlyphSlot  slot )
 91   {
 92     FT_Library  library;
 93     FT_Face     face;
 94     FT_Error    error;
 95     FT_Pos      xstr, ystr;
 96 
 97 
 98     if ( !slot )
 99       return;
100 
101     library = slot-&gt;library;
102     face    = slot-&gt;face;
103 
104     if ( slot-&gt;format != FT_GLYPH_FORMAT_OUTLINE &amp;&amp;
105          slot-&gt;format != FT_GLYPH_FORMAT_BITMAP  )
106       return;
107 
108     /* some reasonable strength */
109     xstr = FT_MulFix( face-&gt;units_per_EM,
110                       face-&gt;size-&gt;metrics.y_scale ) / 24;
111     ystr = xstr;
112 
113     if ( slot-&gt;format == FT_GLYPH_FORMAT_OUTLINE )
114       FT_Outline_EmboldenXY( &amp;slot-&gt;outline, xstr, ystr );
115 
116     else /* slot-&gt;format == FT_GLYPH_FORMAT_BITMAP */
117     {
118       /* round to full pixels */
119       xstr &amp;= ~63;
120       if ( xstr == 0 )
121         xstr = 1 &lt;&lt; 6;
122       ystr &amp;= ~63;
123 
124       /*
125        * XXX: overflow check for 16-bit system, for compatibility
126        *      with FT_GlyphSlot_Embolden() since FreeType 2.1.10.
127        *      unfortunately, this function return no informations
128        *      about the cause of error.
129        */
130       if ( ( ystr &gt;&gt; 6 ) &gt; FT_INT_MAX || ( ystr &gt;&gt; 6 ) &lt; FT_INT_MIN )
131       {
132         FT_TRACE1(( &quot;FT_GlyphSlot_Embolden:&quot; ));
133         FT_TRACE1(( &quot;too strong emboldening parameter ystr=%d\n&quot;, ystr ));
134         return;
135       }
136       error = FT_GlyphSlot_Own_Bitmap( slot );
137       if ( error )
138         return;
139 
140       error = FT_Bitmap_Embolden( library, &amp;slot-&gt;bitmap, xstr, ystr );
141       if ( error )
142         return;
143     }
144 
145     if ( slot-&gt;advance.x )
146       slot-&gt;advance.x += xstr;
147 
148     if ( slot-&gt;advance.y )
149       slot-&gt;advance.y += ystr;
150 
151     slot-&gt;metrics.width        += xstr;
152     slot-&gt;metrics.height       += ystr;
153     slot-&gt;metrics.horiAdvance  += xstr;
154     slot-&gt;metrics.vertAdvance  += ystr;
155     slot-&gt;metrics.horiBearingY += ystr;
156 
157     /* XXX: 16-bit overflow case must be excluded before here */
158     if ( slot-&gt;format == FT_GLYPH_FORMAT_BITMAP )
159       slot-&gt;bitmap_top += (FT_Int)( ystr &gt;&gt; 6 );
160   }
161 
162 
163 /* END */
<a name="4" id="anc4"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="4" type="hidden" />
</body>
</html>