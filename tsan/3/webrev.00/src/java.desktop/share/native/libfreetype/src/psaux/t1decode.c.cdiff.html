<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/native/libfreetype/src/psaux/t1decode.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="t1cmap.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="t1decode.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/psaux/t1decode.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,21 ***</span>
<span class="line-modified">! /***************************************************************************/</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  t1decode.c                                                             */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*    PostScript Type 1 decoding routines (body).                          */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  Copyright 2000-2018 by                                                 */</span>
<span class="line-modified">! /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified">! /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified">! /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified">! /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified">! /*  understand and accept it fully.                                        */</span>
<span class="line-modified">! /*                                                                         */</span>
<span class="line-modified">! /***************************************************************************/</span>
  
  
  #include &lt;ft2build.h&gt;
  #include FT_INTERNAL_CALC_H
  #include FT_INTERNAL_DEBUG_H
<span class="line-new-header">--- 1,21 ---</span>
<span class="line-modified">! /****************************************************************************</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * t1decode.c</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  *   PostScript Type 1 decoding routines (body).</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * Copyright (C) 2000-2019 by</span>
<span class="line-modified">!  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified">!  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified">!  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified">!  * this file you indicate that you have read the license and</span>
<span class="line-modified">!  * understand and accept it fully.</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  */</span>
  
  
  #include &lt;ft2build.h&gt;
  #include FT_INTERNAL_CALC_H
  #include FT_INTERNAL_DEBUG_H
</pre>
<hr />
<pre>
<span class="line-old-header">*** 29,18 ***</span>
  #include &quot;psauxerr.h&quot;
  
  /* ensure proper sign extension */
  #define Fix2Int( f )  ( (FT_Int)(FT_Short)( (f) &gt;&gt; 16 ) )
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="line-modified">!   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="line-modified">!   /* messages during execution.                                            */</span>
<span class="line-modified">!   /*                                                                       */</span>
  #undef  FT_COMPONENT
<span class="line-modified">! #define FT_COMPONENT  trace_t1decode</span>
  
  
    typedef enum  T1_Operator_
    {
      op_none = 0,
<span class="line-new-header">--- 29,18 ---</span>
  #include &quot;psauxerr.h&quot;
  
  /* ensure proper sign extension */
  #define Fix2Int( f )  ( (FT_Int)(FT_Short)( (f) &gt;&gt; 16 ) )
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="line-modified">!    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="line-modified">!    * messages during execution.</span>
<span class="line-modified">!    */</span>
  #undef  FT_COMPONENT
<span class="line-modified">! #define FT_COMPONENT  t1decode</span>
  
  
    typedef enum  T1_Operator_
    {
      op_none = 0,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 107,28 ***</span>
      2, /* setcurrentpoint */
      2  /* opcode 15 (undocumented and obsolete) */
    };
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    t1_lookup_glyph_by_stdcharcode_ps                                  */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Looks up a given glyph by its StandardEncoding charcode.  Used to  */</span>
<span class="line-modified">!   /*    implement the SEAC Type 1 operator in the Adobe engine             */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    face     :: The current face object.                               */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    charcode :: The character code to look for.                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    A glyph index in the font face.  Returns -1 if the corresponding   */</span>
<span class="line-modified">!   /*    glyph wasn&#39;t found.                                                */</span>
<span class="line-modified">!   /*                                                                       */</span>
    FT_LOCAL_DEF( FT_Int )
    t1_lookup_glyph_by_stdcharcode_ps( PS_Decoder*  decoder,
                                       FT_Int       charcode )
    {
      FT_UInt             n;
<span class="line-new-header">--- 107,30 ---</span>
      2, /* setcurrentpoint */
      2  /* opcode 15 (undocumented and obsolete) */
    };
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   t1_lookup_glyph_by_stdcharcode_ps</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Looks up a given glyph by its StandardEncoding charcode.  Used to</span>
<span class="line-modified">!    *   implement the SEAC Type 1 operator in the Adobe engine</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   face ::</span>
<span class="line-modified">!    *     The current face object.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   charcode ::</span>
<span class="line-modified">!    *     The character code to look for.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-modified">!    *   A glyph index in the font face.  Returns -1 if the corresponding</span>
<span class="line-added">+    *   glyph wasn&#39;t found.</span>
<span class="line-added">+    */</span>
    FT_LOCAL_DEF( FT_Int )
    t1_lookup_glyph_by_stdcharcode_ps( PS_Decoder*  decoder,
                                       FT_Int       charcode )
    {
      FT_UInt             n;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 157,28 ***</span>
      return -1;
    }
  
  
  #ifdef T1_CONFIG_OPTION_OLD_ENGINE
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    t1_lookup_glyph_by_stdcharcode                                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Looks up a given glyph by its StandardEncoding charcode.  Used to  */</span>
<span class="line-modified">!   /*    implement the SEAC Type 1 operator.                                */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    face     :: The current face object.                               */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    charcode :: The character code to look for.                        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    A glyph index in the font face.  Returns -1 if the corresponding   */</span>
<span class="line-modified">!   /*    glyph wasn&#39;t found.                                                */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_Int
    t1_lookup_glyph_by_stdcharcode( T1_Decoder  decoder,
                                    FT_Int      charcode )
    {
      FT_UInt             n;
<span class="line-new-header">--- 159,31 ---</span>
      return -1;
    }
  
  
  #ifdef T1_CONFIG_OPTION_OLD_ENGINE
<span class="line-modified">! </span>
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   t1_lookup_glyph_by_stdcharcode</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Looks up a given glyph by its StandardEncoding charcode.  Used to</span>
<span class="line-modified">!    *   implement the SEAC Type 1 operator.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   face ::</span>
<span class="line-modified">!    *     The current face object.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   charcode ::</span>
<span class="line-modified">!    *     The character code to look for.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Return:</span>
<span class="line-added">+    *   A glyph index in the font face.  Returns -1 if the corresponding</span>
<span class="line-added">+    *   glyph wasn&#39;t found.</span>
<span class="line-added">+    */</span>
    static FT_Int
    t1_lookup_glyph_by_stdcharcode( T1_Decoder  decoder,
                                    FT_Int      charcode )
    {
      FT_UInt             n;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 215,34 ***</span>
    {
      return decoder-&gt;parse_callback( decoder, glyph );
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    t1operator_seac                                                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Implements the `seac&#39; Type 1 operator for a Type 1 decoder.        */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    decoder :: The current CID decoder.                                */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    asb     :: The accent&#39;s side bearing.                              */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    adx     :: The horizontal offset of the accent.                    */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    ady     :: The vertical offset of the accent.                      */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    bchar   :: The base character&#39;s StandardEncoding charcode.         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    achar   :: The accent character&#39;s StandardEncoding charcode.       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    FreeType error code.  0 means success.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
    static FT_Error
    t1operator_seac( T1_Decoder  decoder,
                     FT_Pos      asb,
                     FT_Pos      adx,
                     FT_Pos      ady,
<span class="line-new-header">--- 220,40 ---</span>
    {
      return decoder-&gt;parse_callback( decoder, glyph );
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   t1operator_seac</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Implements the `seac&#39; Type 1 operator for a Type 1 decoder.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   decoder ::</span>
<span class="line-modified">!    *     The current CID decoder.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   asb ::</span>
<span class="line-modified">!    *     The accent&#39;s side bearing.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   adx ::</span>
<span class="line-modified">!    *     The horizontal offset of the accent.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   ady ::</span>
<span class="line-modified">!    *     The vertical offset of the accent.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   bchar ::</span>
<span class="line-modified">!    *     The base character&#39;s StandardEncoding charcode.</span>
<span class="line-modified">!    *</span>
<span class="line-added">+    *   achar ::</span>
<span class="line-added">+    *     The accent character&#39;s StandardEncoding charcode.</span>
<span class="line-added">+    *</span>
<span class="line-added">+    * @Return:</span>
<span class="line-added">+    *   FreeType error code.  0 means success.</span>
<span class="line-added">+    */</span>
    static FT_Error
    t1operator_seac( T1_Decoder  decoder,
                     FT_Pos      asb,
                     FT_Pos      adx,
                     FT_Pos      ady,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 397,28 ***</span>
    Exit:
      return error;
    }
  
  
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    t1_decoder_parse_charstrings                                       */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Parses a given Type 1 charstrings program.                         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    decoder         :: The current Type 1 decoder.                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    charstring_base :: The base address of the charstring stream.      */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    charstring_len  :: The length in bytes of the charstring stream.   */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    FreeType error code.  0 means success.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
    FT_LOCAL_DEF( FT_Error )
    t1_decoder_parse_charstrings( T1_Decoder  decoder,
                                  FT_Byte*    charstring_base,
                                  FT_UInt     charstring_len )
    {
<span class="line-new-header">--- 408,31 ---</span>
    Exit:
      return error;
    }
  
  
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   t1_decoder_parse_charstrings</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Parses a given Type 1 charstrings program.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   decoder ::</span>
<span class="line-modified">!    *     The current Type 1 decoder.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   charstring_base ::</span>
<span class="line-modified">!    *     The base address of the charstring stream.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   charstring_len ::</span>
<span class="line-modified">!    *     The length in bytes of the charstring stream.</span>
<span class="line-modified">!    *</span>
<span class="line-added">+    * @Return:</span>
<span class="line-added">+    *   FreeType error code.  0 means success.</span>
<span class="line-added">+    */</span>
    FT_LOCAL_DEF( FT_Error )
    t1_decoder_parse_charstrings( T1_Decoder  decoder,
                                  FT_Byte*    charstring_base,
                                  FT_UInt     charstring_len )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 464,13 ***</span>
                 ( decoder-&gt;buildchar == NULL )  );
  
      if ( decoder-&gt;buildchar &amp;&amp; decoder-&gt;len_buildchar &gt; 0 )
        FT_ARRAY_ZERO( decoder-&gt;buildchar, decoder-&gt;len_buildchar );
  
<span class="line-removed">-     FT_TRACE4(( &quot;\n&quot;</span>
<span class="line-removed">-                 &quot;Start charstring\n&quot; ));</span>
<span class="line-removed">- </span>
      zone-&gt;base           = charstring_base;
      limit = zone-&gt;limit  = charstring_base + charstring_len;
      ip    = zone-&gt;cursor = zone-&gt;base;
  
      error = FT_Err_Ok;
<span class="line-new-header">--- 478,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 501,15 ***</span>
          FT_TRACE5(( &quot; (%d)&quot;, decoder-&gt;top - decoder-&gt;stack ));
          bol = FALSE;
        }
  #endif
  
<span class="line-modified">!       /*********************************************************************/</span>
<span class="line-modified">!       /*                                                                   */</span>
<span class="line-modified">!       /* Decode operator or operand                                        */</span>
<span class="line-modified">!       /*                                                                   */</span>
<span class="line-modified">!       /*                                                                   */</span>
  
        /* first of all, decompress operator or value */
        switch ( *ip++ )
        {
        case 1:
<span class="line-new-header">--- 512,15 ---</span>
          FT_TRACE5(( &quot; (%d)&quot;, decoder-&gt;top - decoder-&gt;stack ));
          bol = FALSE;
        }
  #endif
  
<span class="line-modified">!       /**********************************************************************</span>
<span class="line-modified">!        *</span>
<span class="line-modified">!        * Decode operator or operand</span>
<span class="line-modified">!        *</span>
<span class="line-modified">!        */</span>
  
        /* first of all, decompress operator or value */
        switch ( *ip++ )
        {
        case 1:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 708,15 ***</span>
                     &quot; no `div&#39; after large integer\n&quot; ));
  
          large_int = FALSE;
        }
  
<span class="line-modified">!       /*********************************************************************/</span>
<span class="line-modified">!       /*                                                                   */</span>
<span class="line-modified">!       /*  Push value on stack, or process operator                         */</span>
<span class="line-modified">!       /*                                                                   */</span>
<span class="line-modified">!       /*                                                                   */</span>
        if ( op == op_none )
        {
          if ( top - decoder-&gt;stack &gt;= T1_MAX_CHARSTRINGS_OPERANDS )
          {
            FT_ERROR(( &quot;t1_decoder_parse_charstrings: stack overflow\n&quot; ));
<span class="line-new-header">--- 719,15 ---</span>
                     &quot; no `div&#39; after large integer\n&quot; ));
  
          large_int = FALSE;
        }
  
<span class="line-modified">!       /**********************************************************************</span>
<span class="line-modified">!        *</span>
<span class="line-modified">!        * Push value on stack, or process operator</span>
<span class="line-modified">!        *</span>
<span class="line-modified">!        */</span>
        if ( op == op_none )
        {
          if ( top - decoder-&gt;stack &gt;= T1_MAX_CHARSTRINGS_OPERANDS )
          {
            FT_ERROR(( &quot;t1_decoder_parse_charstrings: stack overflow\n&quot; ));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 750,20 ***</span>
          top -= 2;
  
          subr_no = Fix2Int( top[1] );
          arg_cnt = Fix2Int( top[0] );
  
<span class="line-modified">!         /***********************************************************/</span>
<span class="line-modified">!         /*                                                         */</span>
<span class="line-modified">!         /* remove all operands to callothersubr from the stack     */</span>
<span class="line-modified">!         /*                                                         */</span>
<span class="line-modified">!         /* for handled othersubrs, where we know the number of     */</span>
<span class="line-modified">!         /* arguments, we increase the stack by the value of        */</span>
<span class="line-modified">!         /* known_othersubr_result_cnt                              */</span>
<span class="line-modified">!         /*                                                         */</span>
<span class="line-modified">!         /* for unhandled othersubrs the following pops adjust the  */</span>
<span class="line-modified">!         /* stack pointer as necessary                              */</span>
  
          if ( arg_cnt &gt; top - decoder-&gt;stack )
            goto Stack_Underflow;
  
          top -= arg_cnt;
<span class="line-new-header">--- 761,21 ---</span>
          top -= 2;
  
          subr_no = Fix2Int( top[1] );
          arg_cnt = Fix2Int( top[0] );
  
<span class="line-modified">!         /************************************************************</span>
<span class="line-modified">!          *</span>
<span class="line-modified">!          * remove all operands to callothersubr from the stack</span>
<span class="line-modified">!          *</span>
<span class="line-modified">!          * for handled othersubrs, where we know the number of</span>
<span class="line-modified">!          * arguments, we increase the stack by the value of</span>
<span class="line-modified">!          * known_othersubr_result_cnt</span>
<span class="line-modified">!          *</span>
<span class="line-modified">!          * for unhandled othersubrs the following pops adjust the</span>
<span class="line-modified">!          * stack pointer as necessary</span>
<span class="line-added">+          */</span>
  
          if ( arg_cnt &gt; top - decoder-&gt;stack )
            goto Stack_Underflow;
  
          top -= arg_cnt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1221,11 ***</span>
<span class="line-new-header">--- 1233,14 ---</span>
  
            /* the `metrics_only&#39; indicates that we only want to compute */
            /* the glyph&#39;s metrics (lsb + advance width), not load the   */
            /* rest of it; so exit immediately                           */
            if ( builder-&gt;metrics_only )
<span class="line-added">+           {</span>
<span class="line-added">+             FT_TRACE4(( &quot;\n&quot; ));</span>
              return FT_Err_Ok;
<span class="line-added">+           }</span>
  
            break;
  
          case op_seac:
            return t1operator_seac( decoder,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1253,11 ***</span>
<span class="line-new-header">--- 1268,14 ---</span>
  
            /* the `metrics_only&#39; indicates that we only want to compute */
            /* the glyph&#39;s metrics (lsb + advance width), not load the   */
            /* rest of it; so exit immediately                           */
            if ( builder-&gt;metrics_only )
<span class="line-added">+           {</span>
<span class="line-added">+             FT_TRACE4(( &quot;\n&quot; ));</span>
              return FT_Err_Ok;
<span class="line-added">+           }</span>
  
            break;
  
          case op_closepath:
            FT_TRACE4(( &quot; closepath&quot; ));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1636,30 ***</span>
  
    Stack_Underflow:
      return FT_THROW( Stack_Underflow );
    }
  
<span class="line-modified">! #else /* T1_CONFIG_OPTION_OLD_ENGINE */</span>
<span class="line-modified">! </span>
<span class="line-modified">!   /*************************************************************************/</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">!   /*    t1_decoder_parse_metrics                                           */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">!   /*    Parses a given Type 1 charstrings program to extract width         */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">!   /*    decoder         :: The current Type 1 decoder.                     */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    charstring_base :: The base address of the charstring stream.      */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /*    charstring_len  :: The length in bytes of the charstring stream.   */</span>
<span class="line-modified">!   /*                                                                       */</span>
<span class="line-modified">!   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">!   /*    FreeType error code.  0 means success.                             */</span>
<span class="line-modified">!   /*                                                                       */</span>
    FT_LOCAL_DEF( FT_Error )
    t1_decoder_parse_metrics( T1_Decoder  decoder,
                              FT_Byte*    charstring_base,
                              FT_UInt     charstring_len )
    {
<span class="line-new-header">--- 1654,35 ---</span>
  
    Stack_Underflow:
      return FT_THROW( Stack_Underflow );
    }
  
<span class="line-modified">! </span>
<span class="line-modified">! #else /* !T1_CONFIG_OPTION_OLD_ENGINE */</span>
<span class="line-modified">! </span>
<span class="line-modified">! </span>
<span class="line-modified">!   /**************************************************************************</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Function:</span>
<span class="line-modified">!    *   t1_decoder_parse_metrics</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Description:</span>
<span class="line-modified">!    *   Parses a given Type 1 charstrings program to extract width</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    * @Input:</span>
<span class="line-modified">!    *   decoder ::</span>
<span class="line-modified">!    *     The current Type 1 decoder.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   charstring_base ::</span>
<span class="line-modified">!    *     The base address of the charstring stream.</span>
<span class="line-modified">!    *</span>
<span class="line-modified">!    *   charstring_len ::</span>
<span class="line-added">+    *     The length in bytes of the charstring stream.</span>
<span class="line-added">+    *</span>
<span class="line-added">+    * @Return:</span>
<span class="line-added">+    *   FreeType error code.  0 means success.</span>
<span class="line-added">+    */</span>
    FT_LOCAL_DEF( FT_Error )
    t1_decoder_parse_metrics( T1_Decoder  decoder,
                              FT_Byte*    charstring_base,
                              FT_UInt     charstring_len )
    {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1678,13 ***</span>
      decoder-&gt;zone = decoder-&gt;zones;
      zone          = decoder-&gt;zones;
  
      builder-&gt;parse_state = T1_Parse_Start;
  
<span class="line-removed">-     FT_TRACE4(( &quot;\n&quot;</span>
<span class="line-removed">-                 &quot;Start charstring: get width\n&quot; ));</span>
<span class="line-removed">- </span>
      zone-&gt;base           = charstring_base;
      limit = zone-&gt;limit  = charstring_base + charstring_len;
      ip    = zone-&gt;cursor = zone-&gt;base;
  
      /* now, execute loop */
<span class="line-new-header">--- 1701,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1701,15 ***</span>
          FT_TRACE5(( &quot; (%d)&quot;, decoder-&gt;top - decoder-&gt;stack ));
          bol = FALSE;
        }
  #endif
  
<span class="line-modified">!       /*********************************************************************/</span>
<span class="line-modified">!       /*                                                                   */</span>
<span class="line-modified">!       /* Decode operator or operand                                        */</span>
<span class="line-modified">!       /*                                                                   */</span>
<span class="line-modified">!       /*                                                                   */</span>
  
        /* first of all, decompress operator or value */
        switch ( *ip++ )
        {
        case 1:
<span class="line-new-header">--- 1721,15 ---</span>
          FT_TRACE5(( &quot; (%d)&quot;, decoder-&gt;top - decoder-&gt;stack ));
          bol = FALSE;
        }
  #endif
  
<span class="line-modified">!       /**********************************************************************</span>
<span class="line-modified">!        *</span>
<span class="line-modified">!        * Decode operator or operand</span>
<span class="line-modified">!        *</span>
<span class="line-modified">!        */</span>
  
        /* first of all, decompress operator or value */
        switch ( *ip++ )
        {
        case 1:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1815,15 ***</span>
                       &quot; invalid byte (%d)\n&quot;, ip[-1] ));
            goto Syntax_Error;
          }
        }
  
<span class="line-modified">!       /*********************************************************************/</span>
<span class="line-modified">!       /*                                                                   */</span>
<span class="line-modified">!       /*  Push value on stack, or process operator                         */</span>
<span class="line-modified">!       /*                                                                   */</span>
<span class="line-modified">!       /*                                                                   */</span>
        if ( op == op_none )
        {
          if ( top - decoder-&gt;stack &gt;= T1_MAX_CHARSTRINGS_OPERANDS )
          {
            FT_ERROR(( &quot;t1_decoder_parse_metrics: stack overflow\n&quot; ));
<span class="line-new-header">--- 1835,15 ---</span>
                       &quot; invalid byte (%d)\n&quot;, ip[-1] ));
            goto Syntax_Error;
          }
        }
  
<span class="line-modified">!       /**********************************************************************</span>
<span class="line-modified">!        *</span>
<span class="line-modified">!        * Push value on stack, or process operator</span>
<span class="line-modified">!        *</span>
<span class="line-modified">!        */</span>
        if ( op == op_none )
        {
          if ( top - decoder-&gt;stack &gt;= T1_MAX_CHARSTRINGS_OPERANDS )
          {
            FT_ERROR(( &quot;t1_decoder_parse_metrics: stack overflow\n&quot; ));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1873,10 ***</span>
<span class="line-new-header">--- 1893,11 ---</span>
            builder-&gt;advance.y = 0;
  
            /* we only want to compute the glyph&#39;s metrics */
            /* (lsb + advance width), not load the rest of */
            /* it; so exit immediately                     */
<span class="line-added">+           FT_TRACE4(( &quot;\n&quot; ));</span>
            return FT_Err_Ok;
  
          case op_sbw:
            FT_TRACE4(( &quot; sbw&quot; ));
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1891,10 ***</span>
<span class="line-new-header">--- 1912,11 ---</span>
            builder-&gt;advance.y = top[3];
  
            /* we only want to compute the glyph&#39;s metrics */
            /* (lsb + advance width), not load the rest of */
            /* it; so exit immediately                     */
<span class="line-added">+           FT_TRACE4(( &quot;\n&quot; ));</span>
            return FT_Err_Ok;
  
          default:
            FT_ERROR(( &quot;t1_decoder_parse_metrics:&quot;
                       &quot; unhandled opcode %d\n&quot;, op ));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1915,11 ***</span>
      return FT_THROW( Syntax_Error );
  
    Stack_Underflow:
      return FT_THROW( Stack_Underflow );
    }
<span class="line-modified">! #endif /* T1_CONFIG_OPTION_OLD_ENGINE */</span>
  
  
    /* initialize T1 decoder */
    FT_LOCAL_DEF( FT_Error )
    t1_decoder_init( T1_Decoder           decoder,
<span class="line-new-header">--- 1937,12 ---</span>
      return FT_THROW( Syntax_Error );
  
    Stack_Underflow:
      return FT_THROW( Stack_Underflow );
    }
<span class="line-modified">! </span>
<span class="line-added">+ #endif /* !T1_CONFIG_OPTION_OLD_ENGINE */</span>
  
  
    /* initialize T1 decoder */
    FT_LOCAL_DEF( FT_Error )
    t1_decoder_init( T1_Decoder           decoder,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1932,11 ***</span>
                     FT_Render_Mode       hint_mode,
                     T1_Decoder_Callback  parse_callback )
    {
      FT_ZERO( decoder );
  
<span class="line-modified">!     /* retrieve PSNames interface from list of current modules */</span>
      {
        FT_Service_PsCMaps  psnames;
  
  
        FT_FACE_FIND_GLOBAL_SERVICE( face, psnames, POSTSCRIPT_CMAPS );
<span class="line-new-header">--- 1955,11 ---</span>
                     FT_Render_Mode       hint_mode,
                     T1_Decoder_Callback  parse_callback )
    {
      FT_ZERO( decoder );
  
<span class="line-modified">!     /* retrieve `psnames&#39; interface from list of current modules */</span>
      {
        FT_Service_PsCMaps  psnames;
  
  
        FT_FACE_FIND_GLOBAL_SERVICE( face, psnames, POSTSCRIPT_CMAPS );
</pre>
<center><a href="t1cmap.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="t1decode.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>