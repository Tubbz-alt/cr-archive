<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/share/native/libfreetype/src/base/ftoutln.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ftobjs.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ftpatent.c.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/base/ftoutln.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,46 +1,39 @@</span>
<span class="udiff-line-modified-removed">- /***************************************************************************/</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  ftoutln.c                                                              */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*    FreeType outline management (body).                                  */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  Copyright 1996-2018 by                                                 */</span>
<span class="udiff-line-modified-removed">- /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="udiff-line-modified-removed">- /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="udiff-line-modified-removed">- /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="udiff-line-modified-removed">- /*  this file you indicate that you have read the license and              */</span>
<span class="udiff-line-modified-removed">- /*  understand and accept it fully.                                        */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /***************************************************************************/</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   /*************************************************************************/</span>
<span class="udiff-line-removed">-   /*                                                                       */</span>
<span class="udiff-line-removed">-   /* All functions are declared in freetype.h.                             */</span>
<span class="udiff-line-removed">-   /*                                                                       */</span>
<span class="udiff-line-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-added">+ /****************************************************************************</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * ftoutln.c</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  *   FreeType outline management (body).</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * Copyright (C) 1996-2019 by</span>
<span class="udiff-line-modified-added">+  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * This file is part of the FreeType project, and may only be used,</span>
<span class="udiff-line-modified-added">+  * modified, and distributed under the terms of the FreeType project</span>
<span class="udiff-line-modified-added">+  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="udiff-line-modified-added">+  * this file you indicate that you have read the license and</span>
<span class="udiff-line-modified-added">+  * understand and accept it fully.</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  */</span>
  
  
  #include &lt;ft2build.h&gt;
  #include FT_OUTLINE_H
  #include FT_INTERNAL_OBJECTS_H
  #include FT_INTERNAL_CALC_H
  #include FT_INTERNAL_DEBUG_H
  #include FT_TRIGONOMETRY_H
  
  
<span class="udiff-line-modified-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="udiff-line-modified-removed">-   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="udiff-line-modified-removed">-   /* messages during execution.                                            */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-added">+   /**************************************************************************</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="udiff-line-modified-added">+    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="udiff-line-modified-added">+    * messages during execution.</span>
<span class="udiff-line-modified-added">+    */</span>
  #undef  FT_COMPONENT
<span class="udiff-line-modified-removed">- #define FT_COMPONENT  trace_outline</span>
<span class="udiff-line-modified-added">+ #define FT_COMPONENT  outline</span>
  
  
    static
    const FT_Outline  null_outline = { 0, 0, NULL, NULL, NULL, 0 };
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -51,12 +44,11 @@</span>
    FT_Outline_Decompose( FT_Outline*              outline,
                          const FT_Outline_Funcs*  func_interface,
                          void*                    user )
    {
  #undef  SCALED
<span class="udiff-line-modified-removed">- #define SCALED( x )  ( ( (x) &lt; 0 ? -( -(x) &lt;&lt; shift )             \</span>
<span class="udiff-line-removed">-                                  :  (  (x) &lt;&lt; shift ) ) - delta )</span>
<span class="udiff-line-modified-added">+ #define SCALED( x )  ( (x) * ( 1L &lt;&lt; shift ) - delta )</span>
  
      FT_Vector   v_last;
      FT_Vector   v_control;
      FT_Vector   v_start;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -294,18 +286,26 @@</span>
      FT_TRACE5(( &quot;FT_Outline_Decompose: Error 0x%x\n&quot;, error ));
      return error;
    }
  
  
<span class="udiff-line-added">+   /* documentation is in ftoutln.h */</span>
<span class="udiff-line-added">+ </span>
    FT_EXPORT_DEF( FT_Error )
<span class="udiff-line-modified-removed">-   FT_Outline_New_Internal( FT_Memory    memory,</span>
<span class="udiff-line-modified-removed">-                            FT_UInt      numPoints,</span>
<span class="udiff-line-modified-removed">-                            FT_Int       numContours,</span>
<span class="udiff-line-modified-removed">-                            FT_Outline  *anoutline )</span>
<span class="udiff-line-modified-added">+   FT_Outline_New( FT_Library   library,</span>
<span class="udiff-line-modified-added">+                   FT_UInt      numPoints,</span>
<span class="udiff-line-modified-added">+                   FT_Int       numContours,</span>
<span class="udiff-line-modified-added">+                   FT_Outline  *anoutline )</span>
    {
<span class="udiff-line-modified-removed">-     FT_Error  error;</span>
<span class="udiff-line-modified-added">+     FT_Error   error;</span>
<span class="udiff-line-added">+     FT_Memory  memory;</span>
<span class="udiff-line-added">+ </span>
  
<span class="udiff-line-added">+     if ( !library )</span>
<span class="udiff-line-added">+       return FT_THROW( Invalid_Library_Handle );</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     memory = library-&gt;memory;</span>
  
      if ( !anoutline || !memory )
        return FT_THROW( Invalid_Argument );
  
      *anoutline = null_outline;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -328,32 +328,16 @@</span>
  
      return FT_Err_Ok;
  
    Fail:
      anoutline-&gt;flags |= FT_OUTLINE_OWNER;
<span class="udiff-line-modified-removed">-     FT_Outline_Done_Internal( memory, anoutline );</span>
<span class="udiff-line-modified-added">+     FT_Outline_Done( library, anoutline );</span>
  
      return error;
    }
  
  
<span class="udiff-line-removed">-   /* documentation is in ftoutln.h */</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   FT_EXPORT_DEF( FT_Error )</span>
<span class="udiff-line-removed">-   FT_Outline_New( FT_Library   library,</span>
<span class="udiff-line-removed">-                   FT_UInt      numPoints,</span>
<span class="udiff-line-removed">-                   FT_Int       numContours,</span>
<span class="udiff-line-removed">-                   FT_Outline  *anoutline )</span>
<span class="udiff-line-removed">-   {</span>
<span class="udiff-line-removed">-     if ( !library )</span>
<span class="udiff-line-removed">-       return FT_THROW( Invalid_Library_Handle );</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     return FT_Outline_New_Internal( library-&gt;memory, numPoints,</span>
<span class="udiff-line-removed">-                                     numContours, anoutline );</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- </span>
    /* documentation is in ftoutln.h */
  
    FT_EXPORT_DEF( FT_Error )
    FT_Outline_Check( FT_Outline*  outline )
    {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -434,17 +418,27 @@</span>
  
      return FT_Err_Ok;
    }
  
  
<span class="udiff-line-added">+   /* documentation is in ftoutln.h */</span>
<span class="udiff-line-added">+ </span>
    FT_EXPORT_DEF( FT_Error )
<span class="udiff-line-modified-removed">-   FT_Outline_Done_Internal( FT_Memory    memory,</span>
<span class="udiff-line-modified-removed">-                             FT_Outline*  outline )</span>
<span class="udiff-line-modified-added">+   FT_Outline_Done( FT_Library   library,</span>
<span class="udiff-line-modified-added">+                    FT_Outline*  outline )</span>
    {
<span class="udiff-line-added">+     FT_Memory  memory;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if ( !library )</span>
<span class="udiff-line-added">+       return FT_THROW( Invalid_Library_Handle );</span>
<span class="udiff-line-added">+ </span>
      if ( !outline )
        return FT_THROW( Invalid_Outline );
  
<span class="udiff-line-added">+     memory = library-&gt;memory;</span>
<span class="udiff-line-added">+ </span>
      if ( !memory )
        return FT_THROW( Invalid_Argument );
  
      if ( outline-&gt;flags &amp; FT_OUTLINE_OWNER )
      {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -456,25 +450,10 @@</span>
  
      return FT_Err_Ok;
    }
  
  
<span class="udiff-line-removed">-   /* documentation is in ftoutln.h */</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   FT_EXPORT_DEF( FT_Error )</span>
<span class="udiff-line-removed">-   FT_Outline_Done( FT_Library   library,</span>
<span class="udiff-line-removed">-                    FT_Outline*  outline )</span>
<span class="udiff-line-removed">-   {</span>
<span class="udiff-line-removed">-     /* check for valid `outline&#39; in FT_Outline_Done_Internal() */</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if ( !library )</span>
<span class="udiff-line-removed">-       return FT_THROW( Invalid_Library_Handle );</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     return FT_Outline_Done_Internal( library-&gt;memory, outline );</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- </span>
    /* documentation is in ftoutln.h */
  
    FT_EXPORT_DEF( void )
    FT_Outline_Get_CBox( const FT_Outline*  outline,
                         FT_BBox           *acbox )
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -617,10 +596,11 @@</span>
                       FT_Raster_Params*  params )
    {
      FT_Error     error;
      FT_Renderer  renderer;
      FT_ListNode  node;
<span class="udiff-line-added">+     FT_BBox      cbox;</span>
  
  
      if ( !library )
        return FT_THROW( Invalid_Library_Handle );
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -628,15 +608,30 @@</span>
        return FT_THROW( Invalid_Outline );
  
      if ( !params )
        return FT_THROW( Invalid_Argument );
  
<span class="udiff-line-added">+     FT_Outline_Get_CBox( outline, &amp;cbox );</span>
<span class="udiff-line-added">+     if ( cbox.xMin &lt; -0x1000000L || cbox.yMin &lt; -0x1000000L ||</span>
<span class="udiff-line-added">+          cbox.xMax &gt;  0x1000000L || cbox.yMax &gt;  0x1000000L )</span>
<span class="udiff-line-added">+       return FT_THROW( Invalid_Outline );</span>
<span class="udiff-line-added">+ </span>
      renderer = library-&gt;cur_renderer;
      node     = library-&gt;renderers.head;
  
      params-&gt;source = (void*)outline;
  
<span class="udiff-line-added">+     /* preset clip_box for direct mode */</span>
<span class="udiff-line-added">+     if ( params-&gt;flags &amp; FT_RASTER_FLAG_DIRECT    &amp;&amp;</span>
<span class="udiff-line-added">+          !( params-&gt;flags &amp; FT_RASTER_FLAG_CLIP ) )</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+       params-&gt;clip_box.xMin = cbox.xMin &gt;&gt; 6;</span>
<span class="udiff-line-added">+       params-&gt;clip_box.yMin = cbox.yMin &gt;&gt; 6;</span>
<span class="udiff-line-added">+       params-&gt;clip_box.xMax = ( cbox.xMax + 63 ) &gt;&gt; 6;</span>
<span class="udiff-line-added">+       params-&gt;clip_box.yMax = ( cbox.yMax + 63 ) &gt;&gt; 6;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      error = FT_ERR( Cannot_Render_Glyph );
      while ( renderer )
      {
        error = renderer-&gt;raster_render( renderer-&gt;raster, params );
        if ( !error || FT_ERR_NEQ( error, Cannot_Render_Glyph ) )
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -909,13 +904,13 @@</span>
    FT_EXPORT_DEF( FT_Error )
    FT_Outline_EmboldenXY( FT_Outline*  outline,
                           FT_Pos       xstrength,
                           FT_Pos       ystrength )
    {
<span class="udiff-line-modified-removed">-     FT_Vector*  points;</span>
<span class="udiff-line-modified-removed">-     FT_Int      c, first, last;</span>
<span class="udiff-line-modified-removed">-     FT_Int      orientation;</span>
<span class="udiff-line-modified-added">+     FT_Vector*      points;</span>
<span class="udiff-line-modified-added">+     FT_Int          c, first, last;</span>
<span class="udiff-line-modified-added">+     FT_Orientation  orientation;</span>
  
  
      if ( !outline )
        return FT_THROW( Invalid_Outline );
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1042,11 +1037,11 @@</span>
    /* documentation is in ftoutln.h */
  
    FT_EXPORT_DEF( FT_Orientation )
    FT_Outline_Get_Orientation( FT_Outline*  outline )
    {
<span class="udiff-line-modified-removed">-     FT_BBox     cbox;</span>
<span class="udiff-line-modified-added">+     FT_BBox     cbox = { 0, 0, 0, 0 };</span>
      FT_Int      xshift, yshift;
      FT_Vector*  points;
      FT_Vector   v_prev, v_cur;
      FT_Int      c, n, first;
      FT_Pos      area = 0;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1088,11 +1083,12 @@</span>
        {
          v_cur.x = points[n].x &gt;&gt; xshift;
          v_cur.y = points[n].y &gt;&gt; yshift;
  
          area = ADD_LONG( area,
<span class="udiff-line-modified-removed">-                          ( v_cur.y - v_prev.y ) * ( v_cur.x + v_prev.x ) );</span>
<span class="udiff-line-modified-added">+                          MUL_LONG( v_cur.y - v_prev.y,</span>
<span class="udiff-line-added">+                                    v_cur.x + v_prev.x ) );</span>
  
          v_prev = v_cur;
        }
  
        first = last + 1;
</pre>
<center><a href="ftobjs.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ftpatent.c.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>