<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/share/native/libfreetype/src/cff/cffdrivr.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="cffcmap.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="cffdrivr.h.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/cff/cffdrivr.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,21 +1,21 @@</span>
<span class="udiff-line-modified-removed">- /***************************************************************************/</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  cffdrivr.c                                                             */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*    OpenType font driver implementation (body).                          */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  Copyright 1996-2018 by                                                 */</span>
<span class="udiff-line-modified-removed">- /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="udiff-line-modified-removed">- /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="udiff-line-modified-removed">- /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="udiff-line-modified-removed">- /*  this file you indicate that you have read the license and              */</span>
<span class="udiff-line-modified-removed">- /*  understand and accept it fully.                                        */</span>
<span class="udiff-line-modified-removed">- /*                                                                         */</span>
<span class="udiff-line-modified-removed">- /***************************************************************************/</span>
<span class="udiff-line-modified-added">+ /****************************************************************************</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * cffdrivr.c</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  *   OpenType font driver implementation (body).</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * Copyright (C) 1996-2019 by</span>
<span class="udiff-line-modified-added">+  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * This file is part of the FreeType project, and may only be used,</span>
<span class="udiff-line-modified-added">+  * modified, and distributed under the terms of the FreeType project</span>
<span class="udiff-line-modified-added">+  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="udiff-line-modified-added">+  * this file you indicate that you have read the license and</span>
<span class="udiff-line-modified-added">+  * understand and accept it fully.</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  */</span>
  
  
  #include &lt;ft2build.h&gt;
  #include FT_FREETYPE_H
  #include FT_INTERNAL_DEBUG_H
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -40,26 +40,25 @@</span>
  #include FT_SERVICE_MULTIPLE_MASTERS_H
  #include FT_SERVICE_METRICS_VARIATIONS_H
  #endif
  
  #include &quot;cfferrs.h&quot;
<span class="udiff-line-removed">- #include &quot;cffpic.h&quot;</span>
  
  #include FT_SERVICE_FONT_FORMAT_H
  #include FT_SERVICE_GLYPH_DICT_H
  #include FT_SERVICE_PROPERTIES_H
  #include FT_DRIVER_H
  
  
<span class="udiff-line-modified-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="udiff-line-modified-removed">-   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="udiff-line-modified-removed">-   /* messages during execution.                                            */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-added">+   /**************************************************************************</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="udiff-line-modified-added">+    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="udiff-line-modified-added">+    * messages during execution.</span>
<span class="udiff-line-modified-added">+    */</span>
  #undef  FT_COMPONENT
<span class="udiff-line-modified-removed">- #define FT_COMPONENT  trace_cffdriver</span>
<span class="udiff-line-modified-added">+ #define FT_COMPONENT  cffdriver</span>
  
  
    /*************************************************************************/
    /*************************************************************************/
    /*************************************************************************/
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -71,42 +70,46 @@</span>
    /*************************************************************************/
    /*************************************************************************/
    /*************************************************************************/
  
  
<span class="udiff-line-modified-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Function&gt;                                                            */</span>
<span class="udiff-line-modified-removed">-   /*    cff_get_kerning                                                    */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Description&gt;                                                         */</span>
<span class="udiff-line-modified-removed">-   /*    A driver method used to return the kerning vector between two      */</span>
<span class="udiff-line-modified-removed">-   /*    glyphs of the same face.                                           */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Input&gt;                                                               */</span>
<span class="udiff-line-modified-removed">-   /*    face        :: A handle to the source face object.                 */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*    left_glyph  :: The index of the left glyph in the kern pair.       */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*    right_glyph :: The index of the right glyph in the kern pair.      */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Output&gt;                                                              */</span>
<span class="udiff-line-modified-removed">-   /*    kerning     :: The kerning vector.  This is in font units for      */</span>
<span class="udiff-line-modified-removed">-   /*                   scalable formats, and in pixels for fixed-sizes     */</span>
<span class="udiff-line-modified-removed">-   /*                   formats.                                            */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Return&gt;                                                              */</span>
<span class="udiff-line-modified-removed">-   /*    FreeType error code.  0 means success.                             */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Note&gt;                                                                */</span>
<span class="udiff-line-modified-removed">-   /*    Only horizontal layouts (left-to-right &amp; right-to-left) are        */</span>
<span class="udiff-line-modified-removed">-   /*    supported by this function.  Other layouts, or more sophisticated  */</span>
<span class="udiff-line-modified-removed">-   /*    kernings, are out of scope of this method (the basic driver        */</span>
<span class="udiff-line-modified-removed">-   /*    interface is meant to be simple).                                  */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*    They can be implemented by format-specific interfaces.             */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-added">+   /**************************************************************************</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Function:</span>
<span class="udiff-line-modified-added">+    *   cff_get_kerning</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Description:</span>
<span class="udiff-line-modified-added">+    *   A driver method used to return the kerning vector between two</span>
<span class="udiff-line-modified-added">+    *   glyphs of the same face.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Input:</span>
<span class="udiff-line-modified-added">+    *   face ::</span>
<span class="udiff-line-modified-added">+    *     A handle to the source face object.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    *   left_glyph ::</span>
<span class="udiff-line-modified-added">+    *     The index of the left glyph in the kern pair.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    *   right_glyph ::</span>
<span class="udiff-line-modified-added">+    *     The index of the right glyph in the kern pair.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Output:</span>
<span class="udiff-line-modified-added">+    *   kerning ::</span>
<span class="udiff-line-modified-added">+    *     The kerning vector.  This is in font units for</span>
<span class="udiff-line-modified-added">+    *     scalable formats, and in pixels for fixed-sizes</span>
<span class="udiff-line-modified-added">+    *     formats.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Return:</span>
<span class="udiff-line-modified-added">+    *   FreeType error code.  0 means success.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Note:</span>
<span class="udiff-line-modified-added">+    *   Only horizontal layouts (left-to-right &amp; right-to-left) are</span>
<span class="udiff-line-modified-added">+    *   supported by this function.  Other layouts, or more sophisticated</span>
<span class="udiff-line-modified-added">+    *   kernings, are out of scope of this method (the basic driver</span>
<span class="udiff-line-added">+    *   interface is meant to be simple).</span>
<span class="udiff-line-added">+    *</span>
<span class="udiff-line-added">+    *   They can be implemented by format-specific interfaces.</span>
<span class="udiff-line-added">+    */</span>
    FT_CALLBACK_DEF( FT_Error )
    cff_get_kerning( FT_Face     ttface,          /* TT_Face */
                     FT_UInt     left_glyph,
                     FT_UInt     right_glyph,
                     FT_Vector*  kerning )
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -123,36 +126,40 @@</span>
  
      return FT_Err_Ok;
    }
  
  
<span class="udiff-line-modified-removed">-   /*************************************************************************/</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Function&gt;                                                            */</span>
<span class="udiff-line-modified-removed">-   /*    cff_glyph_load                                                     */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Description&gt;                                                         */</span>
<span class="udiff-line-modified-removed">-   /*    A driver method used to load a glyph within a given glyph slot.    */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Input&gt;                                                               */</span>
<span class="udiff-line-modified-removed">-   /*    slot        :: A handle to the target slot object where the glyph  */</span>
<span class="udiff-line-modified-removed">-   /*                   will be loaded.                                     */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*    size        :: A handle to the source face size at which the glyph */</span>
<span class="udiff-line-modified-removed">-   /*                   must be scaled, loaded, etc.                        */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*    glyph_index :: The index of the glyph in the font file.            */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /*    load_flags  :: A flag indicating what to load for this glyph.  The */</span>
<span class="udiff-line-modified-removed">-   /*                   FT_LOAD_??? constants can be used to control the    */</span>
<span class="udiff-line-modified-removed">-   /*                   glyph loading process (e.g., whether the outline    */</span>
<span class="udiff-line-modified-removed">-   /*                   should be scaled, whether to load bitmaps or not,   */</span>
<span class="udiff-line-modified-removed">-   /*                   whether to hint the outline, etc).                  */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-removed">-   /* &lt;Return&gt;                                                              */</span>
<span class="udiff-line-modified-removed">-   /*    FreeType error code.  0 means success.                             */</span>
<span class="udiff-line-modified-removed">-   /*                                                                       */</span>
<span class="udiff-line-modified-added">+   /**************************************************************************</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Function:</span>
<span class="udiff-line-modified-added">+    *   cff_glyph_load</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Description:</span>
<span class="udiff-line-modified-added">+    *   A driver method used to load a glyph within a given glyph slot.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    * @Input:</span>
<span class="udiff-line-modified-added">+    *   slot ::</span>
<span class="udiff-line-modified-added">+    *     A handle to the target slot object where the glyph</span>
<span class="udiff-line-modified-added">+    *     will be loaded.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    *   size ::</span>
<span class="udiff-line-modified-added">+    *     A handle to the source face size at which the glyph</span>
<span class="udiff-line-modified-added">+    *     must be scaled, loaded, etc.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    *   glyph_index ::</span>
<span class="udiff-line-modified-added">+    *     The index of the glyph in the font file.</span>
<span class="udiff-line-modified-added">+    *</span>
<span class="udiff-line-modified-added">+    *   load_flags ::</span>
<span class="udiff-line-modified-added">+    *     A flag indicating what to load for this glyph.  The</span>
<span class="udiff-line-modified-added">+    *     FT_LOAD_??? constants can be used to control the</span>
<span class="udiff-line-modified-added">+    *     glyph loading process (e.g., whether the outline</span>
<span class="udiff-line-modified-added">+    *     should be scaled, whether to load bitmaps or not,</span>
<span class="udiff-line-modified-added">+    *     whether to hint the outline, etc).</span>
<span class="udiff-line-added">+    *</span>
<span class="udiff-line-added">+    * @Return:</span>
<span class="udiff-line-added">+    *   FreeType error code.  0 means success.</span>
<span class="udiff-line-added">+    */</span>
    FT_CALLBACK_DEF( FT_Error )
    cff_glyph_load( FT_GlyphSlot  cffslot,      /* CFF_GlyphSlot */
                    FT_Size       cffsize,      /* CFF_Size      */
                    FT_UInt       glyph_index,
                    FT_Int32      load_flags )
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -300,11 +307,11 @@</span>
      return error;
    }
  
  
    /*
<span class="udiff-line-modified-removed">-    *  GLYPH DICT SERVICE</span>
<span class="udiff-line-modified-added">+    * GLYPH DICT SERVICE</span>
     *
     */
  
    static FT_Error
    cff_get_glyph_name( CFF_Face    face,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -339,22 +346,22 @@</span>
        else
        {
          FT_ERROR(( &quot;cff_get_glyph_name:&quot;
                     &quot; cannot get glyph name from a CFF2 font\n&quot;
                     &quot;                   &quot;
<span class="udiff-line-modified-removed">-                    &quot; without the `PSNames&#39; module\n&quot; ));</span>
<span class="udiff-line-modified-added">+                    &quot; without the `psnames&#39; module\n&quot; ));</span>
          error = FT_THROW( Missing_Module );
          goto Exit;
        }
      }
  
      if ( !font-&gt;psnames )
      {
        FT_ERROR(( &quot;cff_get_glyph_name:&quot;
                   &quot; cannot get glyph name from CFF &amp; CEF fonts\n&quot;
                   &quot;                   &quot;
<span class="udiff-line-modified-removed">-                  &quot; without the `PSNames&#39; module\n&quot; ));</span>
<span class="udiff-line-modified-added">+                  &quot; without the `psnames&#39; module\n&quot; ));</span>
        error = FT_THROW( Missing_Module );
        goto Exit;
      }
  
      /* first, locate the sid in the charset table */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -372,12 +379,12 @@</span>
      return error;
    }
  
  
    static FT_UInt
<span class="udiff-line-modified-removed">-   cff_get_name_index( CFF_Face    face,</span>
<span class="udiff-line-modified-removed">-                       FT_String*  glyph_name )</span>
<span class="udiff-line-modified-added">+   cff_get_name_index( CFF_Face          face,</span>
<span class="udiff-line-modified-added">+                       const FT_String*  glyph_name )</span>
    {
      CFF_Font            cff;
      CFF_Charset         charset;
      FT_Service_PsCMaps  psnames;
      FT_String*          name;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -406,11 +413,11 @@</span>
        else
        {
          FT_ERROR(( &quot;cff_get_name_index:&quot;
                     &quot; cannot get glyph index from a CFF2 font\n&quot;
                     &quot;                   &quot;
<span class="udiff-line-modified-removed">-                    &quot; without the `PSNames&#39; module\n&quot; ));</span>
<span class="udiff-line-modified-added">+                    &quot; without the `psnames&#39; module\n&quot; ));</span>
          return 0;
        }
      }
  
      FT_FACE_FIND_GLOBAL_SERVICE( face, psnames, POSTSCRIPT_CMAPS );
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -444,11 +451,11 @@</span>
      (FT_GlyphDict_NameIndexFunc)cff_get_name_index       /* name_index */
    )
  
  
    /*
<span class="udiff-line-modified-removed">-    *  POSTSCRIPT INFO SERVICE</span>
<span class="udiff-line-modified-added">+    * POSTSCRIPT INFO SERVICE</span>
     *
     */
  
    static FT_Int
    cff_ps_has_glyph_names( FT_Face  face )
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -591,11 +598,11 @@</span>
      (PS_GetFontValueFunc)  NULL                     /* ps_get_font_value   */
    )
  
  
    /*
<span class="udiff-line-modified-removed">-    *  POSTSCRIPT NAME SERVICE</span>
<span class="udiff-line-modified-added">+    * POSTSCRIPT NAME SERVICE</span>
     *
     */
  
    static const char*
    cff_get_ps_name( CFF_Face  face )
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -652,12 +659,12 @@</span>
  
      FT_Face     face    = FT_CMAP_FACE( cmap );
      FT_Library  library = FT_FACE_LIBRARY( face );
  
  
<span class="udiff-line-modified-removed">-     if ( cmap-&gt;clazz != &amp;CFF_CMAP_ENCODING_CLASS_REC_GET &amp;&amp;</span>
<span class="udiff-line-modified-removed">-          cmap-&gt;clazz != &amp;CFF_CMAP_UNICODE_CLASS_REC_GET  )</span>
<span class="udiff-line-modified-added">+     if ( cmap-&gt;clazz != &amp;cff_cmap_encoding_class_rec &amp;&amp;</span>
<span class="udiff-line-modified-added">+          cmap-&gt;clazz != &amp;cff_cmap_unicode_class_rec  )</span>
      {
        FT_Module           sfnt    = FT_Get_Module( library, &quot;sfnt&quot; );
        FT_Service_TTCMaps  service =
          (FT_Service_TTCMaps)ft_module_get_service( sfnt,
                                                     FT_SERVICE_ID_TT_CMAP,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -680,11 +687,11 @@</span>
      (TT_CMap_Info_GetFunc)cff_get_cmap_info    /* get_cmap_info */
    )
  
  
    /*
<span class="udiff-line-modified-removed">-    *  CID INFO SERVICE</span>
<span class="udiff-line-modified-added">+    * CID INFO SERVICE</span>
     *
     */
    static FT_Error
    cff_get_ros( CFF_Face      face,
                 const char*  *registry,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -786,11 +793,11 @@</span>
        {
          error = FT_THROW( Invalid_Argument );
          goto Fail;
        }
  
<span class="udiff-line-modified-removed">-       if ( glyph_index &gt; cff-&gt;num_glyphs )</span>
<span class="udiff-line-modified-added">+       if ( glyph_index &gt;= cff-&gt;num_glyphs )</span>
        {
          error = FT_THROW( Invalid_Argument );
          goto Fail;
        }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -816,11 +823,11 @@</span>
        cff_get_cid_from_glyph_index             /* get_cid_from_glyph_index */
    )
  
  
    /*
<span class="udiff-line-modified-removed">-    *  PROPERTY SERVICE</span>
<span class="udiff-line-modified-added">+    * PROPERTY SERVICE</span>
     *
     */
  
    FT_DEFINE_SERVICE_PROPERTIESREC(
      cff_service_properties,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -830,11 +837,11 @@</span>
  
  
  #ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT
  
    /*
<span class="udiff-line-modified-removed">-    *  MULTIPLE MASTER SERVICE</span>
<span class="udiff-line-modified-added">+    * MULTIPLE MASTER SERVICE</span>
     *
     */
  
    static FT_Error
    cff_set_mm_blend( CFF_Face   face,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -858,10 +865,34 @@</span>
  
      return mm-&gt;get_mm_blend( FT_FACE( face ), num_coords, coords );
    }
  
  
<span class="udiff-line-added">+   static FT_Error</span>
<span class="udiff-line-added">+   cff_set_mm_weightvector( CFF_Face   face,</span>
<span class="udiff-line-added">+                            FT_UInt    len,</span>
<span class="udiff-line-added">+                            FT_Fixed*  weightvector )</span>
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+     FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face-&gt;mm;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     return mm-&gt;set_mm_weightvector( FT_FACE( face ), len, weightvector );</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   static FT_Error</span>
<span class="udiff-line-added">+   cff_get_mm_weightvector( CFF_Face   face,</span>
<span class="udiff-line-added">+                            FT_UInt*   len,</span>
<span class="udiff-line-added">+                            FT_Fixed*  weightvector )</span>
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+     FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face-&gt;mm;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     return mm-&gt;get_mm_weightvector( FT_FACE( face ), len, weightvector );</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
    static FT_Error
    cff_get_mm_var( CFF_Face     face,
                    FT_MM_Var*  *master )
    {
      FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face-&gt;mm;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -907,26 +938,28 @@</span>
  
  
    FT_DEFINE_SERVICE_MULTIMASTERSREC(
      cff_service_multi_masters,
  
<span class="udiff-line-modified-removed">-     (FT_Get_MM_Func)        NULL,                   /* get_mm         */</span>
<span class="udiff-line-modified-removed">-     (FT_Set_MM_Design_Func) NULL,                   /* set_mm_design  */</span>
<span class="udiff-line-modified-removed">-     (FT_Set_MM_Blend_Func)  cff_set_mm_blend,       /* set_mm_blend   */</span>
<span class="udiff-line-modified-removed">-     (FT_Get_MM_Blend_Func)  cff_get_mm_blend,       /* get_mm_blend   */</span>
<span class="udiff-line-modified-removed">-     (FT_Get_MM_Var_Func)    cff_get_mm_var,         /* get_mm_var     */</span>
<span class="udiff-line-modified-removed">-     (FT_Set_Var_Design_Func)cff_set_var_design,     /* set_var_design */</span>
<span class="udiff-line-modified-removed">-     (FT_Get_Var_Design_Func)cff_get_var_design,     /* get_var_design */</span>
<span class="udiff-line-modified-removed">-     (FT_Set_Instance_Func)  cff_set_instance,       /* set_instance   */</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-     (FT_Get_Var_Blend_Func) cff_get_var_blend,      /* get_var_blend  */</span>
<span class="udiff-line-modified-removed">-     (FT_Done_Blend_Func)    cff_done_blend          /* done_blend     */</span>
<span class="udiff-line-modified-added">+     (FT_Get_MM_Func)             NULL,                    /* get_mm              */</span>
<span class="udiff-line-modified-added">+     (FT_Set_MM_Design_Func)      NULL,                    /* set_mm_design       */</span>
<span class="udiff-line-modified-added">+     (FT_Set_MM_Blend_Func)       cff_set_mm_blend,        /* set_mm_blend        */</span>
<span class="udiff-line-modified-added">+     (FT_Get_MM_Blend_Func)       cff_get_mm_blend,        /* get_mm_blend        */</span>
<span class="udiff-line-modified-added">+     (FT_Get_MM_Var_Func)         cff_get_mm_var,          /* get_mm_var          */</span>
<span class="udiff-line-modified-added">+     (FT_Set_Var_Design_Func)     cff_set_var_design,      /* set_var_design      */</span>
<span class="udiff-line-modified-added">+     (FT_Get_Var_Design_Func)     cff_get_var_design,      /* get_var_design      */</span>
<span class="udiff-line-modified-added">+     (FT_Set_Instance_Func)       cff_set_instance,        /* set_instance        */</span>
<span class="udiff-line-modified-added">+     (FT_Set_MM_WeightVector_Func)cff_set_mm_weightvector, /* set_mm_weightvector */</span>
<span class="udiff-line-modified-added">+     (FT_Get_MM_WeightVector_Func)cff_get_mm_weightvector, /* get_mm_weightvector */</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+     (FT_Get_Var_Blend_Func)      cff_get_var_blend,       /* get_var_blend       */</span>
<span class="udiff-line-added">+     (FT_Done_Blend_Func)         cff_done_blend           /* done_blend          */</span>
    )
  
  
    /*
<span class="udiff-line-modified-removed">-    *  METRICS VARIATIONS SERVICE</span>
<span class="udiff-line-modified-added">+    * METRICS VARIATIONS SERVICE</span>
     *
     */
  
    static FT_Error
    cff_hadvance_adjust( CFF_Face  face,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -966,11 +999,11 @@</span>
    )
  #endif
  
  
    /*
<span class="udiff-line-modified-removed">-    *  CFFLOAD SERVICE</span>
<span class="udiff-line-modified-added">+    * CFFLOAD SERVICE</span>
     *
     */
  
    FT_DEFINE_SERVICE_CFFLOADREC(
      cff_service_cff_load,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -999,58 +1032,58 @@</span>
       defined TT_CONFIG_OPTION_GX_VAR_SUPPORT
    FT_DEFINE_SERVICEDESCREC10(
      cff_services,
  
      FT_SERVICE_ID_FONT_FORMAT,          FT_FONT_FORMAT_CFF,
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_MULTI_MASTERS,        &amp;CFF_SERVICE_MULTI_MASTERS_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_METRICS_VARIATIONS,   &amp;CFF_SERVICE_METRICS_VAR_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_POSTSCRIPT_INFO,      &amp;CFF_SERVICE_PS_INFO_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;CFF_SERVICE_PS_NAME_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_GLYPH_DICT,           &amp;CFF_SERVICE_GLYPH_DICT_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_TT_CMAP,              &amp;CFF_SERVICE_GET_CMAP_INFO_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_CID,                  &amp;CFF_SERVICE_CID_INFO_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_PROPERTIES,           &amp;CFF_SERVICE_PROPERTIES_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_CFF_LOAD,             &amp;CFF_SERVICE_CFF_LOAD_GET</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_MULTI_MASTERS,        &amp;cff_service_multi_masters,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_METRICS_VARIATIONS,   &amp;cff_service_metrics_variations,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_POSTSCRIPT_INFO,      &amp;cff_service_ps_info,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;cff_service_ps_name,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_GLYPH_DICT,           &amp;cff_service_glyph_dict,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_TT_CMAP,              &amp;cff_service_get_cmap_info,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_CID,                  &amp;cff_service_cid_info,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_PROPERTIES,           &amp;cff_service_properties,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_CFF_LOAD,             &amp;cff_service_cff_load</span>
    )
  #elif !defined FT_CONFIG_OPTION_NO_GLYPH_NAMES
    FT_DEFINE_SERVICEDESCREC8(
      cff_services,
  
      FT_SERVICE_ID_FONT_FORMAT,          FT_FONT_FORMAT_CFF,
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_POSTSCRIPT_INFO,      &amp;CFF_SERVICE_PS_INFO_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;CFF_SERVICE_PS_NAME_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_GLYPH_DICT,           &amp;CFF_SERVICE_GLYPH_DICT_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_TT_CMAP,              &amp;CFF_SERVICE_GET_CMAP_INFO_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_CID,                  &amp;CFF_SERVICE_CID_INFO_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_PROPERTIES,           &amp;CFF_SERVICE_PROPERTIES_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_CFF_LOAD,             &amp;CFF_SERVICE_CFF_LOAD_GET</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_POSTSCRIPT_INFO,      &amp;cff_service_ps_info,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;cff_service_ps_name,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_GLYPH_DICT,           &amp;cff_service_glyph_dict,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_TT_CMAP,              &amp;cff_service_get_cmap_info,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_CID,                  &amp;cff_service_cid_info,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_PROPERTIES,           &amp;cff_service_properties,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_CFF_LOAD,             &amp;cff_service_cff_load</span>
    )
  #elif defined TT_CONFIG_OPTION_GX_VAR_SUPPORT
    FT_DEFINE_SERVICEDESCREC9(
      cff_services,
  
      FT_SERVICE_ID_FONT_FORMAT,          FT_FONT_FORMAT_CFF,
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_MULTI_MASTERS,        &amp;CFF_SERVICE_MULTI_MASTERS_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_METRICS_VARIATIONS,   &amp;CFF_SERVICE_METRICS_VAR_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_POSTSCRIPT_INFO,      &amp;CFF_SERVICE_PS_INFO_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;CFF_SERVICE_PS_NAME_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_TT_CMAP,              &amp;CFF_SERVICE_GET_CMAP_INFO_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_CID,                  &amp;CFF_SERVICE_CID_INFO_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_PROPERTIES,           &amp;CFF_SERVICE_PROPERTIES_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_CFF_LOAD,             &amp;CFF_SERVICE_CFF_LOAD_GET</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_MULTI_MASTERS,        &amp;cff_service_multi_masters,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_METRICS_VARIATIONS,   &amp;cff_service_metrics_var,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_POSTSCRIPT_INFO,      &amp;cff_service_ps_info,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;cff_service_ps_name,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_TT_CMAP,              &amp;cff_service_get_cmap_info,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_CID,                  &amp;cff_service_cid_info,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_PROPERTIES,           &amp;cff_service_properties,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_CFF_LOAD,             &amp;cff_service_cff_load</span>
    )
  #else
    FT_DEFINE_SERVICEDESCREC7(
      cff_services,
  
      FT_SERVICE_ID_FONT_FORMAT,          FT_FONT_FORMAT_CFF,
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_POSTSCRIPT_INFO,      &amp;CFF_SERVICE_PS_INFO_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;CFF_SERVICE_PS_NAME_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_TT_CMAP,              &amp;CFF_SERVICE_GET_CMAP_INFO_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_CID,                  &amp;CFF_SERVICE_CID_INFO_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_PROPERTIES,           &amp;CFF_SERVICE_PROPERTIES_GET,</span>
<span class="udiff-line-modified-removed">-     FT_SERVICE_ID_CFF_LOAD,             &amp;CFF_SERVICE_CFF_LOAD_GET</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_POSTSCRIPT_INFO,      &amp;cff_service_ps_info,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_POSTSCRIPT_FONT_NAME, &amp;cff_service_ps_name,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_TT_CMAP,              &amp;cff_service_get_cmap_info,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_CID,                  &amp;cff_service_cid_info,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_PROPERTIES,           &amp;cff_service_properties,</span>
<span class="udiff-line-modified-added">+     FT_SERVICE_ID_CFF_LOAD,             &amp;cff_service_cff_load</span>
    )
  #endif
  
  
    FT_CALLBACK_DEF( FT_Module_Interface )
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1060,31 +1093,20 @@</span>
      FT_Library           library;
      FT_Module            sfnt;
      FT_Module_Interface  result;
  
  
<span class="udiff-line-modified-removed">-     /* CFF_SERVICES_GET dereferences `library&#39; in PIC mode */</span>
<span class="udiff-line-removed">- #ifdef FT_CONFIG_OPTION_PIC</span>
<span class="udiff-line-removed">-     if ( !driver )</span>
<span class="udiff-line-removed">-       return NULL;</span>
<span class="udiff-line-removed">-     library = driver-&gt;library;</span>
<span class="udiff-line-removed">-     if ( !library )</span>
<span class="udiff-line-removed">-       return NULL;</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     result = ft_service_list_lookup( CFF_SERVICES_GET, module_interface );</span>
<span class="udiff-line-modified-added">+     result = ft_service_list_lookup( cff_services, module_interface );</span>
      if ( result )
        return result;
  
<span class="udiff-line-modified-removed">-     /* `driver&#39; is not yet evaluated in non-PIC mode */</span>
<span class="udiff-line-removed">- #ifndef FT_CONFIG_OPTION_PIC</span>
<span class="udiff-line-modified-added">+     /* `driver&#39; is not yet evaluated */</span>
      if ( !driver )
        return NULL;
      library = driver-&gt;library;
      if ( !library )
        return NULL;
<span class="udiff-line-removed">- #endif</span>
  
      /* we pass our request to the `sfnt&#39; module */
      sfnt = FT_Get_Module( library, &quot;sfnt&quot; );
  
      return sfnt ? sfnt-&gt;clazz-&gt;get_interface( sfnt, module_interface ) : 0;
</pre>
<center><a href="cffcmap.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="cffdrivr.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>