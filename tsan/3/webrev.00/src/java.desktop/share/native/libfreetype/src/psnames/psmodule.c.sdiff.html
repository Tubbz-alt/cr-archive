<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/native/libfreetype/src/psnames/psmodule.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../pshinter/pshrec.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="psmodule.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/psnames/psmodule.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
<span class="line-modified">  1 /***************************************************************************/</span>
<span class="line-modified">  2 /*                                                                         */</span>
<span class="line-modified">  3 /*  psmodule.c                                                             */</span>
<span class="line-modified">  4 /*                                                                         */</span>
<span class="line-modified">  5 /*    PSNames module implementation (body).                                */</span>
<span class="line-modified">  6 /*                                                                         */</span>
<span class="line-modified">  7 /*  Copyright 1996-2018 by                                                 */</span>
<span class="line-modified">  8 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="line-modified">  9 /*                                                                         */</span>
<span class="line-modified"> 10 /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified"> 11 /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified"> 12 /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified"> 13 /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified"> 14 /*  understand and accept it fully.                                        */</span>
<span class="line-modified"> 15 /*                                                                         */</span>
<span class="line-modified"> 16 /***************************************************************************/</span>
 17 
 18 
 19 #include &lt;ft2build.h&gt;
 20 #include FT_INTERNAL_DEBUG_H
 21 #include FT_INTERNAL_OBJECTS_H
 22 #include FT_SERVICE_POSTSCRIPT_CMAPS_H
 23 
 24 #include &quot;psmodule.h&quot;
 25 
 26   /*
<span class="line-modified"> 27    *  The file `pstables.h&#39; with its arrays and its function</span>
<span class="line-modified"> 28    *  `ft_get_adobe_glyph_index&#39; is useful for other projects also (for</span>
<span class="line-modified"> 29    *  example, `pdfium&#39; is using it).  However, if used as a C++ header,</span>
<span class="line-modified"> 30    *  including it in two different source files makes it necessary to use</span>
<span class="line-modified"> 31    *  `extern const&#39; for the declaration of its arrays, otherwise the data</span>
<span class="line-modified"> 32    *  would be duplicated as mandated by the C++ standard.</span>
 33    *
<span class="line-modified"> 34    *  For this reason, we use `DEFINE_PS_TABLES&#39; to guard the function</span>
<span class="line-modified"> 35    *  definitions, and `DEFINE_PS_TABLES_DATA&#39; to provide both proper array</span>
<span class="line-modified"> 36    *  declarations and definitions.</span>
 37    */
 38 #include &quot;pstables.h&quot;
 39 #define  DEFINE_PS_TABLES
 40 #define  DEFINE_PS_TABLES_DATA
 41 #include &quot;pstables.h&quot;
 42 
 43 #include &quot;psnamerr.h&quot;
<span class="line-removed"> 44 #include &quot;pspic.h&quot;</span>
 45 
 46 
 47 #ifdef FT_CONFIG_OPTION_POSTSCRIPT_NAMES
 48 
 49 
 50 #ifdef FT_CONFIG_OPTION_ADOBE_GLYPH_LIST
 51 
 52 
 53 #define VARIANT_BIT         0x80000000UL
 54 #define BASE_GLYPH( code )  ( (FT_UInt32)( (code) &amp; ~VARIANT_BIT ) )
 55 
 56 
 57   /* Return the Unicode value corresponding to a given glyph.  Note that */
 58   /* we do deal with glyph variants by detecting a non-initial dot in    */
 59   /* the name, as in `A.swash&#39; or `e.final&#39;; in this case, the           */
 60   /* VARIANT_BIT is set in the return value.                             */
 61   /*                                                                     */
 62   static FT_UInt32
 63   ps_unicode_value( const char*  glyph_name )
 64   {
</pre>
<hr />
<pre>
376           map-&gt;glyph_index = extra_glyphs[n];
377           map++;
378         }
379       }
380 
381       /* now compress the table a bit */
382       count = (FT_UInt)( map - table-&gt;maps );
383 
384       if ( count == 0 )
385       {
386         /* No unicode chars here! */
387         FT_FREE( table-&gt;maps );
388         if ( !error )
389           error = FT_THROW( No_Unicode_Glyph_Name );
390       }
391       else
392       {
393         /* Reallocate if the number of used entries is much smaller. */
394         if ( count &lt; num_glyphs / 2 )
395         {
<span class="line-modified">396           (void)FT_RENEW_ARRAY( table-&gt;maps, num_glyphs, count );</span>


397           error = FT_Err_Ok;
398         }
399 
400         /* Sort the table in increasing order of unicode values, */
401         /* taking care of glyph variants.                        */
402         ft_qsort( table-&gt;maps, count, sizeof ( PS_UniMap ),
403                   compare_uni_maps );
404       }
405 
406       table-&gt;num_maps = count;
407     }
408 
409     return error;
410   }
411 
412 
413   static FT_UInt
414   ps_unicodes_char_index( PS_Unicodes  table,
415                           FT_UInt32    unicode )
416   {
</pre>
<hr />
<pre>
560     pscmaps_interface,
561 
562     NULL,                                               /* unicode_value         */
563     NULL,                                               /* unicodes_init         */
564     NULL,                                               /* unicodes_char_index   */
565     NULL,                                               /* unicodes_char_next    */
566 
567     (PS_Macintosh_NameFunc)    ps_get_macintosh_name,   /* macintosh_name        */
568     (PS_Adobe_Std_StringsFunc) ps_get_standard_strings, /* adobe_std_strings     */
569 
570     t1_standard_encoding,                               /* adobe_std_encoding    */
571     t1_expert_encoding                                  /* adobe_expert_encoding */
572   )
573 
574 #endif /* FT_CONFIG_OPTION_ADOBE_GLYPH_LIST */
575 
576 
577   FT_DEFINE_SERVICEDESCREC1(
578     pscmaps_services,
579 
<span class="line-modified">580     FT_SERVICE_ID_POSTSCRIPT_CMAPS, &amp;PSCMAPS_INTERFACE_GET )</span>
581 
582 
583   static FT_Pointer
584   psnames_get_service( FT_Module    module,
585                        const char*  service_id )
586   {
<span class="line-removed">587     /* PSCMAPS_SERVICES_GET dereferences `library&#39; in PIC mode */</span>
<span class="line-removed">588 #ifdef FT_CONFIG_OPTION_PIC</span>
<span class="line-removed">589     FT_Library  library;</span>
<span class="line-removed">590 </span>
<span class="line-removed">591 </span>
<span class="line-removed">592     if ( !module )</span>
<span class="line-removed">593       return NULL;</span>
<span class="line-removed">594     library = module-&gt;library;</span>
<span class="line-removed">595     if ( !library )</span>
<span class="line-removed">596       return NULL;</span>
<span class="line-removed">597 #else</span>
598     FT_UNUSED( module );
<span class="line-removed">599 #endif</span>
600 
<span class="line-modified">601     return ft_service_list_lookup( PSCMAPS_SERVICES_GET, service_id );</span>
602   }
603 
604 #endif /* FT_CONFIG_OPTION_POSTSCRIPT_NAMES */
605 
606 
607 #ifndef FT_CONFIG_OPTION_POSTSCRIPT_NAMES
608 #define PUT_PS_NAMES_SERVICE( a )  NULL
609 #else
610 #define PUT_PS_NAMES_SERVICE( a )  a
611 #endif
612 
613   FT_DEFINE_MODULE(
614     psnames_module_class,
615 
616     0,  /* this is not a font driver, nor a renderer */
617     sizeof ( FT_ModuleRec ),
618 
619     &quot;psnames&quot;,  /* driver name                         */
620     0x10000L,   /* driver version                      */
621     0x20000L,   /* driver requires FreeType 2 or above */
622 
623     PUT_PS_NAMES_SERVICE(
<span class="line-modified">624       (void*)&amp;PSCMAPS_INTERFACE_GET ),   /* module specific interface */</span>
625 
626     (FT_Module_Constructor)NULL,                                       /* module_init   */
627     (FT_Module_Destructor) NULL,                                       /* module_done   */
628     (FT_Module_Requester)  PUT_PS_NAMES_SERVICE( psnames_get_service ) /* get_interface */
629   )
630 
631 
632 /* END */
</pre>
</td>
<td>
<hr />
<pre>
<span class="line-modified">  1 /****************************************************************************</span>
<span class="line-modified">  2  *</span>
<span class="line-modified">  3  * psmodule.c</span>
<span class="line-modified">  4  *</span>
<span class="line-modified">  5  *   psnames module implementation (body).</span>
<span class="line-modified">  6  *</span>
<span class="line-modified">  7  * Copyright (C) 1996-2019 by</span>
<span class="line-modified">  8  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">  9  *</span>
<span class="line-modified"> 10  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified"> 11  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified"> 12  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified"> 13  * this file you indicate that you have read the license and</span>
<span class="line-modified"> 14  * understand and accept it fully.</span>
<span class="line-modified"> 15  *</span>
<span class="line-modified"> 16  */</span>
 17 
 18 
 19 #include &lt;ft2build.h&gt;
 20 #include FT_INTERNAL_DEBUG_H
 21 #include FT_INTERNAL_OBJECTS_H
 22 #include FT_SERVICE_POSTSCRIPT_CMAPS_H
 23 
 24 #include &quot;psmodule.h&quot;
 25 
 26   /*
<span class="line-modified"> 27    * The file `pstables.h&#39; with its arrays and its function</span>
<span class="line-modified"> 28    * `ft_get_adobe_glyph_index&#39; is useful for other projects also (for</span>
<span class="line-modified"> 29    * example, `pdfium&#39; is using it).  However, if used as a C++ header,</span>
<span class="line-modified"> 30    * including it in two different source files makes it necessary to use</span>
<span class="line-modified"> 31    * `extern const&#39; for the declaration of its arrays, otherwise the data</span>
<span class="line-modified"> 32    * would be duplicated as mandated by the C++ standard.</span>
 33    *
<span class="line-modified"> 34    * For this reason, we use `DEFINE_PS_TABLES&#39; to guard the function</span>
<span class="line-modified"> 35    * definitions, and `DEFINE_PS_TABLES_DATA&#39; to provide both proper array</span>
<span class="line-modified"> 36    * declarations and definitions.</span>
 37    */
 38 #include &quot;pstables.h&quot;
 39 #define  DEFINE_PS_TABLES
 40 #define  DEFINE_PS_TABLES_DATA
 41 #include &quot;pstables.h&quot;
 42 
 43 #include &quot;psnamerr.h&quot;

 44 
 45 
 46 #ifdef FT_CONFIG_OPTION_POSTSCRIPT_NAMES
 47 
 48 
 49 #ifdef FT_CONFIG_OPTION_ADOBE_GLYPH_LIST
 50 
 51 
 52 #define VARIANT_BIT         0x80000000UL
 53 #define BASE_GLYPH( code )  ( (FT_UInt32)( (code) &amp; ~VARIANT_BIT ) )
 54 
 55 
 56   /* Return the Unicode value corresponding to a given glyph.  Note that */
 57   /* we do deal with glyph variants by detecting a non-initial dot in    */
 58   /* the name, as in `A.swash&#39; or `e.final&#39;; in this case, the           */
 59   /* VARIANT_BIT is set in the return value.                             */
 60   /*                                                                     */
 61   static FT_UInt32
 62   ps_unicode_value( const char*  glyph_name )
 63   {
</pre>
<hr />
<pre>
375           map-&gt;glyph_index = extra_glyphs[n];
376           map++;
377         }
378       }
379 
380       /* now compress the table a bit */
381       count = (FT_UInt)( map - table-&gt;maps );
382 
383       if ( count == 0 )
384       {
385         /* No unicode chars here! */
386         FT_FREE( table-&gt;maps );
387         if ( !error )
388           error = FT_THROW( No_Unicode_Glyph_Name );
389       }
390       else
391       {
392         /* Reallocate if the number of used entries is much smaller. */
393         if ( count &lt; num_glyphs / 2 )
394         {
<span class="line-modified">395           (void)FT_RENEW_ARRAY( table-&gt;maps,</span>
<span class="line-added">396                                 num_glyphs + EXTRA_GLYPH_LIST_SIZE,</span>
<span class="line-added">397                                 count );</span>
398           error = FT_Err_Ok;
399         }
400 
401         /* Sort the table in increasing order of unicode values, */
402         /* taking care of glyph variants.                        */
403         ft_qsort( table-&gt;maps, count, sizeof ( PS_UniMap ),
404                   compare_uni_maps );
405       }
406 
407       table-&gt;num_maps = count;
408     }
409 
410     return error;
411   }
412 
413 
414   static FT_UInt
415   ps_unicodes_char_index( PS_Unicodes  table,
416                           FT_UInt32    unicode )
417   {
</pre>
<hr />
<pre>
561     pscmaps_interface,
562 
563     NULL,                                               /* unicode_value         */
564     NULL,                                               /* unicodes_init         */
565     NULL,                                               /* unicodes_char_index   */
566     NULL,                                               /* unicodes_char_next    */
567 
568     (PS_Macintosh_NameFunc)    ps_get_macintosh_name,   /* macintosh_name        */
569     (PS_Adobe_Std_StringsFunc) ps_get_standard_strings, /* adobe_std_strings     */
570 
571     t1_standard_encoding,                               /* adobe_std_encoding    */
572     t1_expert_encoding                                  /* adobe_expert_encoding */
573   )
574 
575 #endif /* FT_CONFIG_OPTION_ADOBE_GLYPH_LIST */
576 
577 
578   FT_DEFINE_SERVICEDESCREC1(
579     pscmaps_services,
580 
<span class="line-modified">581     FT_SERVICE_ID_POSTSCRIPT_CMAPS, &amp;pscmaps_interface )</span>
582 
583 
584   static FT_Pointer
585   psnames_get_service( FT_Module    module,
586                        const char*  service_id )
587   {











588     FT_UNUSED( module );

589 
<span class="line-modified">590     return ft_service_list_lookup( pscmaps_services, service_id );</span>
591   }
592 
593 #endif /* FT_CONFIG_OPTION_POSTSCRIPT_NAMES */
594 
595 
596 #ifndef FT_CONFIG_OPTION_POSTSCRIPT_NAMES
597 #define PUT_PS_NAMES_SERVICE( a )  NULL
598 #else
599 #define PUT_PS_NAMES_SERVICE( a )  a
600 #endif
601 
602   FT_DEFINE_MODULE(
603     psnames_module_class,
604 
605     0,  /* this is not a font driver, nor a renderer */
606     sizeof ( FT_ModuleRec ),
607 
608     &quot;psnames&quot;,  /* driver name                         */
609     0x10000L,   /* driver version                      */
610     0x20000L,   /* driver requires FreeType 2 or above */
611 
612     PUT_PS_NAMES_SERVICE(
<span class="line-modified">613       (void*)&amp;pscmaps_interface ),   /* module specific interface */</span>
614 
615     (FT_Module_Constructor)NULL,                                       /* module_init   */
616     (FT_Module_Destructor) NULL,                                       /* module_done   */
617     (FT_Module_Requester)  PUT_PS_NAMES_SERVICE( psnames_get_service ) /* get_interface */
618   )
619 
620 
621 /* END */
</pre>
</td>
</tr>
</table>
<center><a href="../pshinter/pshrec.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="psmodule.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>