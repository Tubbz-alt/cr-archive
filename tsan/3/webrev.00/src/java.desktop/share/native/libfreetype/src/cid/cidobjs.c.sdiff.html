<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/native/libfreetype/src/cid/cidobjs.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="cidload.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="cidobjs.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/src/cid/cidobjs.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
<span class="line-modified">  1 /***************************************************************************/</span>
<span class="line-modified">  2 /*                                                                         */</span>
<span class="line-modified">  3 /*  cidobjs.c                                                              */</span>
<span class="line-modified">  4 /*                                                                         */</span>
<span class="line-modified">  5 /*    CID objects manager (body).                                          */</span>
<span class="line-modified">  6 /*                                                                         */</span>
<span class="line-modified">  7 /*  Copyright 1996-2018 by                                                 */</span>
<span class="line-modified">  8 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="line-modified">  9 /*                                                                         */</span>
<span class="line-modified"> 10 /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified"> 11 /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified"> 12 /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified"> 13 /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified"> 14 /*  understand and accept it fully.                                        */</span>
<span class="line-modified"> 15 /*                                                                         */</span>
<span class="line-modified"> 16 /***************************************************************************/</span>
 17 
 18 
 19 #include &lt;ft2build.h&gt;
 20 #include FT_INTERNAL_DEBUG_H
 21 #include FT_INTERNAL_STREAM_H
 22 
 23 #include &quot;cidgload.h&quot;
 24 #include &quot;cidload.h&quot;
 25 
 26 #include FT_SERVICE_POSTSCRIPT_CMAPS_H
 27 #include FT_INTERNAL_POSTSCRIPT_AUX_H
 28 #include FT_INTERNAL_POSTSCRIPT_HINTS_H
 29 #include FT_DRIVER_H
 30 
 31 #include &quot;ciderrs.h&quot;
 32 
 33 
<span class="line-modified"> 34   /*************************************************************************/</span>
<span class="line-modified"> 35   /*                                                                       */</span>
<span class="line-modified"> 36   /* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */</span>
<span class="line-modified"> 37   /* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */</span>
<span class="line-modified"> 38   /* messages during execution.                                            */</span>
<span class="line-modified"> 39   /*                                                                       */</span>
 40 #undef  FT_COMPONENT
<span class="line-modified"> 41 #define FT_COMPONENT  trace_cidobjs</span>
 42 
 43 
<span class="line-modified"> 44   /*************************************************************************/</span>
<span class="line-modified"> 45   /*                                                                       */</span>
<span class="line-modified"> 46   /*                            SLOT  FUNCTIONS                            */</span>
<span class="line-modified"> 47   /*                                                                       */</span>
<span class="line-modified"> 48   /*************************************************************************/</span>
 49 
 50   FT_LOCAL_DEF( void )
 51   cid_slot_done( FT_GlyphSlot  slot )
 52   {
 53     slot-&gt;internal-&gt;glyph_hints = NULL;
 54   }
 55 
 56 
 57   FT_LOCAL_DEF( FT_Error )
 58   cid_slot_init( FT_GlyphSlot  slot )
 59   {
 60     CID_Face          face;
 61     PSHinter_Service  pshinter;
 62 
 63 
 64     face     = (CID_Face)slot-&gt;face;
 65     pshinter = (PSHinter_Service)face-&gt;pshinter;
 66 
 67     if ( pshinter )
 68     {
 69       FT_Module  module;
 70 
 71 
 72       module = FT_Get_Module( slot-&gt;face-&gt;driver-&gt;root.library,
 73                               &quot;pshinter&quot; );
 74       if ( module )
 75       {
 76         T1_Hints_Funcs  funcs;
 77 
 78 
 79         funcs = pshinter-&gt;get_t1_funcs( module );
 80         slot-&gt;internal-&gt;glyph_hints = (void*)funcs;
 81       }
 82     }
 83 
 84     return 0;
 85   }
 86 
 87 
<span class="line-modified"> 88   /*************************************************************************/</span>
<span class="line-modified"> 89   /*                                                                       */</span>
<span class="line-modified"> 90   /*                           SIZE  FUNCTIONS                             */</span>
<span class="line-modified"> 91   /*                                                                       */</span>
<span class="line-modified"> 92   /*************************************************************************/</span>
 93 
 94 
 95   static PSH_Globals_Funcs
 96   cid_size_get_globals_funcs( CID_Size  size )
 97   {
 98     CID_Face          face     = (CID_Face)size-&gt;root.face;
 99     PSHinter_Service  pshinter = (PSHinter_Service)face-&gt;pshinter;
100     FT_Module         module;
101 
102 
103     module = FT_Get_Module( size-&gt;root.face-&gt;driver-&gt;root.library,
104                             &quot;pshinter&quot; );
105     return ( module &amp;&amp; pshinter &amp;&amp; pshinter-&gt;get_globals_funcs )
106            ? pshinter-&gt;get_globals_funcs( module )
107            : 0;
108   }
109 
110 
111   FT_LOCAL_DEF( void )
112   cid_size_done( FT_Size  cidsize )         /* CID_Size */
</pre>
<hr />
<pre>
157   cid_size_request( FT_Size          size,
158                     FT_Size_Request  req )
159   {
160     PSH_Globals_Funcs  funcs;
161 
162 
163     FT_Request_Metrics( size-&gt;face, req );
164 
165     funcs = cid_size_get_globals_funcs( (CID_Size)size );
166 
167     if ( funcs )
168       funcs-&gt;set_scale( (PSH_Globals)size-&gt;internal-&gt;module_data,
169                         size-&gt;metrics.x_scale,
170                         size-&gt;metrics.y_scale,
171                         0, 0 );
172 
173     return FT_Err_Ok;
174   }
175 
176 
<span class="line-modified">177   /*************************************************************************/</span>
<span class="line-modified">178   /*                                                                       */</span>
<span class="line-modified">179   /*                           FACE  FUNCTIONS                             */</span>
<span class="line-modified">180   /*                                                                       */</span>
<span class="line-modified">181   /*************************************************************************/</span>
<span class="line-modified">182 </span>
<span class="line-modified">183   /*************************************************************************/</span>
<span class="line-modified">184   /*                                                                       */</span>
<span class="line-modified">185   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">186   /*    cid_face_done                                                      */</span>
<span class="line-modified">187   /*                                                                       */</span>
<span class="line-modified">188   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">189   /*    Finalizes a given face object.                                     */</span>
<span class="line-modified">190   /*                                                                       */</span>
<span class="line-modified">191   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">192   /*    face :: A pointer to the face object to destroy.                   */</span>
<span class="line-modified">193   /*                                                                       */</span>

194   FT_LOCAL_DEF( void )
195   cid_face_done( FT_Face  cidface )         /* CID_Face */
196   {
197     CID_Face      face = (CID_Face)cidface;
198     FT_Memory     memory;
199     CID_FaceInfo  cid;
200     PS_FontInfo   info;
201 
202 
203     if ( !face )
204       return;
205 
206     cid    = &amp;face-&gt;cid;
207     info   = &amp;cid-&gt;font_info;
208     memory = cidface-&gt;memory;
209 
210     /* release subrs */
211     if ( face-&gt;subrs )
212     {
213       FT_Int  n;
</pre>
<hr />
<pre>
235     FT_FREE( info-&gt;family_name );
236     FT_FREE( info-&gt;weight );
237 
238     /* release font dictionaries */
239     FT_FREE( cid-&gt;font_dicts );
240     cid-&gt;num_dicts = 0;
241 
242     /* release other strings */
243     FT_FREE( cid-&gt;cid_font_name );
244     FT_FREE( cid-&gt;registry );
245     FT_FREE( cid-&gt;ordering );
246 
247     cidface-&gt;family_name = NULL;
248     cidface-&gt;style_name  = NULL;
249 
250     FT_FREE( face-&gt;binary_data );
251     FT_FREE( face-&gt;cid_stream );
252   }
253 
254 
<span class="line-modified">255   /*************************************************************************/</span>
<span class="line-modified">256   /*                                                                       */</span>
<span class="line-modified">257   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">258   /*    cid_face_init                                                      */</span>
<span class="line-modified">259   /*                                                                       */</span>
<span class="line-modified">260   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">261   /*    Initializes a given CID face object.                               */</span>
<span class="line-modified">262   /*                                                                       */</span>
<span class="line-modified">263   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">264   /*    stream     :: The source font stream.                              */</span>
<span class="line-modified">265   /*                                                                       */</span>
<span class="line-modified">266   /*    face_index :: The index of the font face in the resource.          */</span>
<span class="line-modified">267   /*                                                                       */</span>
<span class="line-modified">268   /*    num_params :: Number of additional generic parameters.  Ignored.   */</span>
<span class="line-modified">269   /*                                                                       */</span>
<span class="line-modified">270   /*    params     :: Additional generic parameters.  Ignored.             */</span>
<span class="line-modified">271   /*                                                                       */</span>
<span class="line-modified">272   /* &lt;InOut&gt;                                                               */</span>
<span class="line-modified">273   /*    face       :: The newly built face object.                         */</span>
<span class="line-modified">274   /*                                                                       */</span>
<span class="line-modified">275   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">276   /*    FreeType error code.  0 means success.                             */</span>
<span class="line-modified">277   /*                                                                       */</span>





278   FT_LOCAL_DEF( FT_Error )
279   cid_face_init( FT_Stream      stream,
280                  FT_Face        cidface,        /* CID_Face */
281                  FT_Int         face_index,
282                  FT_Int         num_params,
283                  FT_Parameter*  params )
284   {
285     CID_Face          face = (CID_Face)cidface;
286     FT_Error          error;
287     PSAux_Service     psaux;
288     PSHinter_Service  pshinter;
289 
290     FT_UNUSED( num_params );
291     FT_UNUSED( params );
292     FT_UNUSED( stream );
293 
294 
295     cidface-&gt;num_faces = 1;
296 
297     psaux = (PSAux_Service)face-&gt;psaux;
</pre>
<hr />
<pre>
432 
433       if ( !cidface-&gt;units_per_EM )
434         cidface-&gt;units_per_EM = 1000;
435 
436       cidface-&gt;ascender  = (FT_Short)( cidface-&gt;bbox.yMax );
437       cidface-&gt;descender = (FT_Short)( cidface-&gt;bbox.yMin );
438 
439       cidface-&gt;height = (FT_Short)( ( cidface-&gt;units_per_EM * 12 ) / 10 );
440       if ( cidface-&gt;height &lt; cidface-&gt;ascender - cidface-&gt;descender )
441         cidface-&gt;height = (FT_Short)( cidface-&gt;ascender - cidface-&gt;descender );
442 
443       cidface-&gt;underline_position  = (FT_Short)info-&gt;underline_position;
444       cidface-&gt;underline_thickness = (FT_Short)info-&gt;underline_thickness;
445     }
446 
447   Exit:
448     return error;
449   }
450 
451 
<span class="line-modified">452   /*************************************************************************/</span>
<span class="line-modified">453   /*                                                                       */</span>
<span class="line-modified">454   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">455   /*    cid_driver_init                                                    */</span>
<span class="line-modified">456   /*                                                                       */</span>
<span class="line-modified">457   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">458   /*    Initializes a given CID driver object.                             */</span>
<span class="line-modified">459   /*                                                                       */</span>
<span class="line-modified">460   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">461   /*    driver :: A handle to the target driver object.                    */</span>
<span class="line-modified">462   /*                                                                       */</span>
<span class="line-modified">463   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified">464   /*    FreeType error code.  0 means success.                             */</span>
<span class="line-modified">465   /*                                                                       */</span>

466   FT_LOCAL_DEF( FT_Error )
467   cid_driver_init( FT_Module  module )
468   {
469     PS_Driver  driver = (PS_Driver)module;
470 
471     FT_UInt32  seed;
472 
473 
474     /* set default property values, cf. `ftt1drv.h&#39; */
475 #ifdef T1_CONFIG_OPTION_OLD_ENGINE
476     driver-&gt;hinting_engine = FT_HINTING_FREETYPE;
477 #else
478     driver-&gt;hinting_engine = FT_HINTING_ADOBE;
479 #endif
480 
481     driver-&gt;no_stem_darkening = TRUE;
482 
483     driver-&gt;darken_params[0] = CFF_CONFIG_OPTION_DARKENING_PARAMETER_X1;
484     driver-&gt;darken_params[1] = CFF_CONFIG_OPTION_DARKENING_PARAMETER_Y1;
485     driver-&gt;darken_params[2] = CFF_CONFIG_OPTION_DARKENING_PARAMETER_X2;
</pre>
<hr />
<pre>
488     driver-&gt;darken_params[5] = CFF_CONFIG_OPTION_DARKENING_PARAMETER_Y3;
489     driver-&gt;darken_params[6] = CFF_CONFIG_OPTION_DARKENING_PARAMETER_X4;
490     driver-&gt;darken_params[7] = CFF_CONFIG_OPTION_DARKENING_PARAMETER_Y4;
491 
492     /* compute random seed from some memory addresses */
493     seed = (FT_UInt32)( (FT_Offset)(char*)&amp;seed          ^
494                         (FT_Offset)(char*)&amp;module        ^
495                         (FT_Offset)(char*)module-&gt;memory );
496     seed = seed ^ ( seed &gt;&gt; 10 ) ^ ( seed &gt;&gt; 20 );
497 
498     driver-&gt;random_seed = (FT_Int32)seed;
499     if ( driver-&gt;random_seed &lt; 0 )
500       driver-&gt;random_seed = -driver-&gt;random_seed;
501     else if ( driver-&gt;random_seed == 0 )
502       driver-&gt;random_seed = 123456789;
503 
504     return FT_Err_Ok;
505   }
506 
507 
<span class="line-modified">508   /*************************************************************************/</span>
<span class="line-modified">509   /*                                                                       */</span>
<span class="line-modified">510   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified">511   /*    cid_driver_done                                                    */</span>
<span class="line-modified">512   /*                                                                       */</span>
<span class="line-modified">513   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified">514   /*    Finalizes a given CID driver.                                      */</span>
<span class="line-modified">515   /*                                                                       */</span>
<span class="line-modified">516   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified">517   /*    driver :: A handle to the target CID driver.                       */</span>
<span class="line-modified">518   /*                                                                       */</span>

519   FT_LOCAL_DEF( void )
520   cid_driver_done( FT_Module  driver )
521   {
522     FT_UNUSED( driver );
523   }
524 
525 
526 /* END */
</pre>
</td>
<td>
<hr />
<pre>
<span class="line-modified">  1 /****************************************************************************</span>
<span class="line-modified">  2  *</span>
<span class="line-modified">  3  * cidobjs.c</span>
<span class="line-modified">  4  *</span>
<span class="line-modified">  5  *   CID objects manager (body).</span>
<span class="line-modified">  6  *</span>
<span class="line-modified">  7  * Copyright (C) 1996-2019 by</span>
<span class="line-modified">  8  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">  9  *</span>
<span class="line-modified"> 10  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified"> 11  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified"> 12  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified"> 13  * this file you indicate that you have read the license and</span>
<span class="line-modified"> 14  * understand and accept it fully.</span>
<span class="line-modified"> 15  *</span>
<span class="line-modified"> 16  */</span>
 17 
 18 
 19 #include &lt;ft2build.h&gt;
 20 #include FT_INTERNAL_DEBUG_H
 21 #include FT_INTERNAL_STREAM_H
 22 
 23 #include &quot;cidgload.h&quot;
 24 #include &quot;cidload.h&quot;
 25 
 26 #include FT_SERVICE_POSTSCRIPT_CMAPS_H
 27 #include FT_INTERNAL_POSTSCRIPT_AUX_H
 28 #include FT_INTERNAL_POSTSCRIPT_HINTS_H
 29 #include FT_DRIVER_H
 30 
 31 #include &quot;ciderrs.h&quot;
 32 
 33 
<span class="line-modified"> 34   /**************************************************************************</span>
<span class="line-modified"> 35    *</span>
<span class="line-modified"> 36    * The macro FT_COMPONENT is used in trace mode.  It is an implicit</span>
<span class="line-modified"> 37    * parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log</span>
<span class="line-modified"> 38    * messages during execution.</span>
<span class="line-modified"> 39    */</span>
 40 #undef  FT_COMPONENT
<span class="line-modified"> 41 #define FT_COMPONENT  cidobjs</span>
 42 
 43 
<span class="line-modified"> 44   /**************************************************************************</span>
<span class="line-modified"> 45    *</span>
<span class="line-modified"> 46    *                           SLOT  FUNCTIONS</span>
<span class="line-modified"> 47    *</span>
<span class="line-modified"> 48    */</span>
 49 
 50   FT_LOCAL_DEF( void )
 51   cid_slot_done( FT_GlyphSlot  slot )
 52   {
 53     slot-&gt;internal-&gt;glyph_hints = NULL;
 54   }
 55 
 56 
 57   FT_LOCAL_DEF( FT_Error )
 58   cid_slot_init( FT_GlyphSlot  slot )
 59   {
 60     CID_Face          face;
 61     PSHinter_Service  pshinter;
 62 
 63 
 64     face     = (CID_Face)slot-&gt;face;
 65     pshinter = (PSHinter_Service)face-&gt;pshinter;
 66 
 67     if ( pshinter )
 68     {
 69       FT_Module  module;
 70 
 71 
 72       module = FT_Get_Module( slot-&gt;face-&gt;driver-&gt;root.library,
 73                               &quot;pshinter&quot; );
 74       if ( module )
 75       {
 76         T1_Hints_Funcs  funcs;
 77 
 78 
 79         funcs = pshinter-&gt;get_t1_funcs( module );
 80         slot-&gt;internal-&gt;glyph_hints = (void*)funcs;
 81       }
 82     }
 83 
 84     return 0;
 85   }
 86 
 87 
<span class="line-modified"> 88   /**************************************************************************</span>
<span class="line-modified"> 89    *</span>
<span class="line-modified"> 90    *                          SIZE  FUNCTIONS</span>
<span class="line-modified"> 91    *</span>
<span class="line-modified"> 92    */</span>
 93 
 94 
 95   static PSH_Globals_Funcs
 96   cid_size_get_globals_funcs( CID_Size  size )
 97   {
 98     CID_Face          face     = (CID_Face)size-&gt;root.face;
 99     PSHinter_Service  pshinter = (PSHinter_Service)face-&gt;pshinter;
100     FT_Module         module;
101 
102 
103     module = FT_Get_Module( size-&gt;root.face-&gt;driver-&gt;root.library,
104                             &quot;pshinter&quot; );
105     return ( module &amp;&amp; pshinter &amp;&amp; pshinter-&gt;get_globals_funcs )
106            ? pshinter-&gt;get_globals_funcs( module )
107            : 0;
108   }
109 
110 
111   FT_LOCAL_DEF( void )
112   cid_size_done( FT_Size  cidsize )         /* CID_Size */
</pre>
<hr />
<pre>
157   cid_size_request( FT_Size          size,
158                     FT_Size_Request  req )
159   {
160     PSH_Globals_Funcs  funcs;
161 
162 
163     FT_Request_Metrics( size-&gt;face, req );
164 
165     funcs = cid_size_get_globals_funcs( (CID_Size)size );
166 
167     if ( funcs )
168       funcs-&gt;set_scale( (PSH_Globals)size-&gt;internal-&gt;module_data,
169                         size-&gt;metrics.x_scale,
170                         size-&gt;metrics.y_scale,
171                         0, 0 );
172 
173     return FT_Err_Ok;
174   }
175 
176 
<span class="line-modified">177   /**************************************************************************</span>
<span class="line-modified">178    *</span>
<span class="line-modified">179    *                          FACE  FUNCTIONS</span>
<span class="line-modified">180    *</span>
<span class="line-modified">181    */</span>
<span class="line-modified">182 </span>
<span class="line-modified">183   /**************************************************************************</span>
<span class="line-modified">184    *</span>
<span class="line-modified">185    * @Function:</span>
<span class="line-modified">186    *   cid_face_done</span>
<span class="line-modified">187    *</span>
<span class="line-modified">188    * @Description:</span>
<span class="line-modified">189    *   Finalizes a given face object.</span>
<span class="line-modified">190    *</span>
<span class="line-modified">191    * @Input:</span>
<span class="line-modified">192    *   face ::</span>
<span class="line-modified">193    *     A pointer to the face object to destroy.</span>
<span class="line-added">194    */</span>
195   FT_LOCAL_DEF( void )
196   cid_face_done( FT_Face  cidface )         /* CID_Face */
197   {
198     CID_Face      face = (CID_Face)cidface;
199     FT_Memory     memory;
200     CID_FaceInfo  cid;
201     PS_FontInfo   info;
202 
203 
204     if ( !face )
205       return;
206 
207     cid    = &amp;face-&gt;cid;
208     info   = &amp;cid-&gt;font_info;
209     memory = cidface-&gt;memory;
210 
211     /* release subrs */
212     if ( face-&gt;subrs )
213     {
214       FT_Int  n;
</pre>
<hr />
<pre>
236     FT_FREE( info-&gt;family_name );
237     FT_FREE( info-&gt;weight );
238 
239     /* release font dictionaries */
240     FT_FREE( cid-&gt;font_dicts );
241     cid-&gt;num_dicts = 0;
242 
243     /* release other strings */
244     FT_FREE( cid-&gt;cid_font_name );
245     FT_FREE( cid-&gt;registry );
246     FT_FREE( cid-&gt;ordering );
247 
248     cidface-&gt;family_name = NULL;
249     cidface-&gt;style_name  = NULL;
250 
251     FT_FREE( face-&gt;binary_data );
252     FT_FREE( face-&gt;cid_stream );
253   }
254 
255 
<span class="line-modified">256   /**************************************************************************</span>
<span class="line-modified">257    *</span>
<span class="line-modified">258    * @Function:</span>
<span class="line-modified">259    *   cid_face_init</span>
<span class="line-modified">260    *</span>
<span class="line-modified">261    * @Description:</span>
<span class="line-modified">262    *   Initializes a given CID face object.</span>
<span class="line-modified">263    *</span>
<span class="line-modified">264    * @Input:</span>
<span class="line-modified">265    *   stream ::</span>
<span class="line-modified">266    *     The source font stream.</span>
<span class="line-modified">267    *</span>
<span class="line-modified">268    *   face_index ::</span>
<span class="line-modified">269    *     The index of the font face in the resource.</span>
<span class="line-modified">270    *</span>
<span class="line-modified">271    *   num_params ::</span>
<span class="line-modified">272    *     Number of additional generic parameters.  Ignored.</span>
<span class="line-modified">273    *</span>
<span class="line-modified">274    *   params ::</span>
<span class="line-modified">275    *     Additional generic parameters.  Ignored.</span>
<span class="line-modified">276    *</span>
<span class="line-modified">277    * @InOut:</span>
<span class="line-modified">278    *   face ::</span>
<span class="line-added">279    *     The newly built face object.</span>
<span class="line-added">280    *</span>
<span class="line-added">281    * @Return:</span>
<span class="line-added">282    *   FreeType error code.  0 means success.</span>
<span class="line-added">283    */</span>
284   FT_LOCAL_DEF( FT_Error )
285   cid_face_init( FT_Stream      stream,
286                  FT_Face        cidface,        /* CID_Face */
287                  FT_Int         face_index,
288                  FT_Int         num_params,
289                  FT_Parameter*  params )
290   {
291     CID_Face          face = (CID_Face)cidface;
292     FT_Error          error;
293     PSAux_Service     psaux;
294     PSHinter_Service  pshinter;
295 
296     FT_UNUSED( num_params );
297     FT_UNUSED( params );
298     FT_UNUSED( stream );
299 
300 
301     cidface-&gt;num_faces = 1;
302 
303     psaux = (PSAux_Service)face-&gt;psaux;
</pre>
<hr />
<pre>
438 
439       if ( !cidface-&gt;units_per_EM )
440         cidface-&gt;units_per_EM = 1000;
441 
442       cidface-&gt;ascender  = (FT_Short)( cidface-&gt;bbox.yMax );
443       cidface-&gt;descender = (FT_Short)( cidface-&gt;bbox.yMin );
444 
445       cidface-&gt;height = (FT_Short)( ( cidface-&gt;units_per_EM * 12 ) / 10 );
446       if ( cidface-&gt;height &lt; cidface-&gt;ascender - cidface-&gt;descender )
447         cidface-&gt;height = (FT_Short)( cidface-&gt;ascender - cidface-&gt;descender );
448 
449       cidface-&gt;underline_position  = (FT_Short)info-&gt;underline_position;
450       cidface-&gt;underline_thickness = (FT_Short)info-&gt;underline_thickness;
451     }
452 
453   Exit:
454     return error;
455   }
456 
457 
<span class="line-modified">458   /**************************************************************************</span>
<span class="line-modified">459    *</span>
<span class="line-modified">460    * @Function:</span>
<span class="line-modified">461    *   cid_driver_init</span>
<span class="line-modified">462    *</span>
<span class="line-modified">463    * @Description:</span>
<span class="line-modified">464    *   Initializes a given CID driver object.</span>
<span class="line-modified">465    *</span>
<span class="line-modified">466    * @Input:</span>
<span class="line-modified">467    *   driver ::</span>
<span class="line-modified">468    *     A handle to the target driver object.</span>
<span class="line-modified">469    *</span>
<span class="line-modified">470    * @Return:</span>
<span class="line-modified">471    *   FreeType error code.  0 means success.</span>
<span class="line-added">472    */</span>
473   FT_LOCAL_DEF( FT_Error )
474   cid_driver_init( FT_Module  module )
475   {
476     PS_Driver  driver = (PS_Driver)module;
477 
478     FT_UInt32  seed;
479 
480 
481     /* set default property values, cf. `ftt1drv.h&#39; */
482 #ifdef T1_CONFIG_OPTION_OLD_ENGINE
483     driver-&gt;hinting_engine = FT_HINTING_FREETYPE;
484 #else
485     driver-&gt;hinting_engine = FT_HINTING_ADOBE;
486 #endif
487 
488     driver-&gt;no_stem_darkening = TRUE;
489 
490     driver-&gt;darken_params[0] = CFF_CONFIG_OPTION_DARKENING_PARAMETER_X1;
491     driver-&gt;darken_params[1] = CFF_CONFIG_OPTION_DARKENING_PARAMETER_Y1;
492     driver-&gt;darken_params[2] = CFF_CONFIG_OPTION_DARKENING_PARAMETER_X2;
</pre>
<hr />
<pre>
495     driver-&gt;darken_params[5] = CFF_CONFIG_OPTION_DARKENING_PARAMETER_Y3;
496     driver-&gt;darken_params[6] = CFF_CONFIG_OPTION_DARKENING_PARAMETER_X4;
497     driver-&gt;darken_params[7] = CFF_CONFIG_OPTION_DARKENING_PARAMETER_Y4;
498 
499     /* compute random seed from some memory addresses */
500     seed = (FT_UInt32)( (FT_Offset)(char*)&amp;seed          ^
501                         (FT_Offset)(char*)&amp;module        ^
502                         (FT_Offset)(char*)module-&gt;memory );
503     seed = seed ^ ( seed &gt;&gt; 10 ) ^ ( seed &gt;&gt; 20 );
504 
505     driver-&gt;random_seed = (FT_Int32)seed;
506     if ( driver-&gt;random_seed &lt; 0 )
507       driver-&gt;random_seed = -driver-&gt;random_seed;
508     else if ( driver-&gt;random_seed == 0 )
509       driver-&gt;random_seed = 123456789;
510 
511     return FT_Err_Ok;
512   }
513 
514 
<span class="line-modified">515   /**************************************************************************</span>
<span class="line-modified">516    *</span>
<span class="line-modified">517    * @Function:</span>
<span class="line-modified">518    *   cid_driver_done</span>
<span class="line-modified">519    *</span>
<span class="line-modified">520    * @Description:</span>
<span class="line-modified">521    *   Finalizes a given CID driver.</span>
<span class="line-modified">522    *</span>
<span class="line-modified">523    * @Input:</span>
<span class="line-modified">524    *   driver ::</span>
<span class="line-modified">525    *     A handle to the target CID driver.</span>
<span class="line-added">526    */</span>
527   FT_LOCAL_DEF( void )
528   cid_driver_done( FT_Module  driver )
529   {
530     FT_UNUSED( driver );
531   }
532 
533 
534 /* END */
</pre>
</td>
</tr>
</table>
<center><a href="cidload.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="cidobjs.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>