<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/native/libfreetype/include/freetype/internal/ftobjs.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ftmemory.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ftpsprop.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfreetype/include/freetype/internal/ftobjs.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
<span class="line-modified">   1 /***************************************************************************/</span>
<span class="line-modified">   2 /*                                                                         */</span>
<span class="line-modified">   3 /*  ftobjs.h                                                               */</span>
<span class="line-modified">   4 /*                                                                         */</span>
<span class="line-modified">   5 /*    The FreeType private base classes (specification).                   */</span>
<span class="line-modified">   6 /*                                                                         */</span>
<span class="line-modified">   7 /*  Copyright 1996-2018 by                                                 */</span>
<span class="line-modified">   8 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */</span>
<span class="line-modified">   9 /*                                                                         */</span>
<span class="line-modified">  10 /*  This file is part of the FreeType project, and may only be used,       */</span>
<span class="line-modified">  11 /*  modified, and distributed under the terms of the FreeType project      */</span>
<span class="line-modified">  12 /*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */</span>
<span class="line-modified">  13 /*  this file you indicate that you have read the license and              */</span>
<span class="line-modified">  14 /*  understand and accept it fully.                                        */</span>
<span class="line-modified">  15 /*                                                                         */</span>
<span class="line-modified">  16 /***************************************************************************/</span>
<span class="line-modified">  17 </span>
<span class="line-modified">  18 </span>
<span class="line-modified">  19   /*************************************************************************/</span>
<span class="line-modified">  20   /*                                                                       */</span>
<span class="line-modified">  21   /*  This file contains the definition of all internal FreeType classes.  */</span>
<span class="line-modified">  22   /*                                                                       */</span>
<span class="line-modified">  23   /*************************************************************************/</span>
  24 
  25 
  26 #ifndef FTOBJS_H_
  27 #define FTOBJS_H_
  28 
  29 #include &lt;ft2build.h&gt;
  30 #include FT_RENDER_H
  31 #include FT_SIZES_H
  32 #include FT_LCD_FILTER_H
  33 #include FT_INTERNAL_MEMORY_H
  34 #include FT_INTERNAL_GLYPH_LOADER_H
  35 #include FT_INTERNAL_DRIVER_H
  36 #include FT_INTERNAL_AUTOHINT_H
  37 #include FT_INTERNAL_SERVICE_H
<span class="line-removed">  38 #include FT_INTERNAL_PIC_H</span>
  39 #include FT_INTERNAL_CALC_H
  40 
  41 #ifdef FT_CONFIG_OPTION_INCREMENTAL
  42 #include FT_INCREMENTAL_H
  43 #endif
  44 
  45 
  46 FT_BEGIN_HEADER
  47 
  48 
<span class="line-modified">  49   /*************************************************************************/</span>
<span class="line-modified">  50   /*                                                                       */</span>
<span class="line-modified">  51   /* Some generic definitions.                                             */</span>
<span class="line-modified">  52   /*                                                                       */</span>
  53 #ifndef TRUE
  54 #define TRUE  1
  55 #endif
  56 
  57 #ifndef FALSE
  58 #define FALSE  0
  59 #endif
  60 
  61 #ifndef NULL
  62 #define NULL  (void*)0
  63 #endif
  64 
  65 
<span class="line-modified">  66   /*************************************************************************/</span>
<span class="line-modified">  67   /*                                                                       */</span>
<span class="line-modified">  68   /* The min and max functions missing in C.  As usual, be careful not to  */</span>
<span class="line-modified">  69   /* write things like FT_MIN( a++, b++ ) to avoid side effects.           */</span>
<span class="line-modified">  70   /*                                                                       */</span>
  71 #define FT_MIN( a, b )  ( (a) &lt; (b) ? (a) : (b) )
  72 #define FT_MAX( a, b )  ( (a) &gt; (b) ? (a) : (b) )
  73 
  74 #define FT_ABS( a )     ( (a) &lt; 0 ? -(a) : (a) )
  75 
  76   /*
<span class="line-modified">  77    *  Approximate sqrt(x*x+y*y) using the `alpha max plus beta min&#39;</span>
<span class="line-modified">  78    *  algorithm.  We use alpha = 1, beta = 3/8, giving us results with a</span>
<span class="line-modified">  79    *  largest error less than 7% compared to the exact value.</span>
  80    */
  81 #define FT_HYPOT( x, y )                 \
  82           ( x = FT_ABS( x ),             \
  83             y = FT_ABS( y ),             \
  84             x &gt; y ? x + ( 3 * y &gt;&gt; 3 )   \
  85                   : y + ( 3 * x &gt;&gt; 3 ) )
  86 
  87   /* we use FT_TYPEOF to suppress signedness compilation warnings */
  88 #define FT_PAD_FLOOR( x, n )  ( (x) &amp; ~FT_TYPEOF( x )( (n) - 1 ) )
  89 #define FT_PAD_ROUND( x, n )  FT_PAD_FLOOR( (x) + (n) / 2, n )
  90 #define FT_PAD_CEIL( x, n )   FT_PAD_FLOOR( (x) + (n) - 1, n )
  91 
  92 #define FT_PIX_FLOOR( x )     ( (x) &amp; ~FT_TYPEOF( x )63 )
  93 #define FT_PIX_ROUND( x )     FT_PIX_FLOOR( (x) + 32 )
  94 #define FT_PIX_CEIL( x )      FT_PIX_FLOOR( (x) + 63 )
  95 
  96   /* specialized versions (for signed values)                   */
  97   /* that don&#39;t produce run-time errors due to integer overflow */
  98 #define FT_PAD_ROUND_LONG( x, n )  FT_PAD_FLOOR( ADD_LONG( (x), (n) / 2 ), \
  99                                                  n )
 100 #define FT_PAD_CEIL_LONG( x, n )   FT_PAD_FLOOR( ADD_LONG( (x), (n) - 1 ), \
 101                                                  n )
 102 #define FT_PIX_ROUND_LONG( x )     FT_PIX_FLOOR( ADD_LONG( (x), 32 ) )
 103 #define FT_PIX_CEIL_LONG( x )      FT_PIX_FLOOR( ADD_LONG( (x), 63 ) )
 104 
 105 #define FT_PAD_ROUND_INT32( x, n )  FT_PAD_FLOOR( ADD_INT32( (x), (n) / 2 ), \
 106                                                   n )
 107 #define FT_PAD_CEIL_INT32( x, n )   FT_PAD_FLOOR( ADD_INT32( (x), (n) - 1 ), \
 108                                                   n )
 109 #define FT_PIX_ROUND_INT32( x )     FT_PIX_FLOOR( ADD_INT32( (x), 32 ) )
 110 #define FT_PIX_CEIL_INT32( x )      FT_PIX_FLOOR( ADD_INT32( (x), 63 ) )
 111 
 112 
 113   /*
<span class="line-modified"> 114    *  character classification functions -- since these are used to parse</span>
<span class="line-modified"> 115    *  font files, we must not use those in &lt;ctypes.h&gt; which are</span>
<span class="line-removed"> 116    *  locale-dependent</span>
 117    */
 118 #define  ft_isdigit( x )   ( ( (unsigned)(x) - &#39;0&#39; ) &lt; 10U )
 119 
 120 #define  ft_isxdigit( x )  ( ( (unsigned)(x) - &#39;0&#39; ) &lt; 10U || \
 121                              ( (unsigned)(x) - &#39;a&#39; ) &lt; 6U  || \
 122                              ( (unsigned)(x) - &#39;A&#39; ) &lt; 6U  )
 123 
 124   /* the next two macros assume ASCII representation */
 125 #define  ft_isupper( x )  ( ( (unsigned)(x) - &#39;A&#39; ) &lt; 26U )
 126 #define  ft_islower( x )  ( ( (unsigned)(x) - &#39;a&#39; ) &lt; 26U )
 127 
 128 #define  ft_isalpha( x )  ( ft_isupper( x ) || ft_islower( x ) )
 129 #define  ft_isalnum( x )  ( ft_isdigit( x ) || ft_isalpha( x ) )
 130 
 131 
 132   /*************************************************************************/
 133   /*************************************************************************/
 134   /*************************************************************************/
 135   /****                                                                 ****/
 136   /****                                                                 ****/
</pre>
<hr />
<pre>
 170   (*FT_CMap_InitFunc)( FT_CMap     cmap,
 171                        FT_Pointer  init_data );
 172 
 173   typedef void
 174   (*FT_CMap_DoneFunc)( FT_CMap  cmap );
 175 
 176   typedef FT_UInt
 177   (*FT_CMap_CharIndexFunc)( FT_CMap    cmap,
 178                             FT_UInt32  char_code );
 179 
 180   typedef FT_UInt
 181   (*FT_CMap_CharNextFunc)( FT_CMap     cmap,
 182                            FT_UInt32  *achar_code );
 183 
 184   typedef FT_UInt
 185   (*FT_CMap_CharVarIndexFunc)( FT_CMap    cmap,
 186                                FT_CMap    unicode_cmap,
 187                                FT_UInt32  char_code,
 188                                FT_UInt32  variant_selector );
 189 
<span class="line-modified"> 190   typedef FT_Bool</span>
 191   (*FT_CMap_CharVarIsDefaultFunc)( FT_CMap    cmap,
 192                                    FT_UInt32  char_code,
 193                                    FT_UInt32  variant_selector );
 194 
 195   typedef FT_UInt32 *
 196   (*FT_CMap_VariantListFunc)( FT_CMap    cmap,
 197                               FT_Memory  mem );
 198 
 199   typedef FT_UInt32 *
 200   (*FT_CMap_CharVariantListFunc)( FT_CMap    cmap,
 201                                   FT_Memory  mem,
 202                                   FT_UInt32  char_code );
 203 
 204   typedef FT_UInt32 *
 205   (*FT_CMap_VariantCharListFunc)( FT_CMap    cmap,
 206                                   FT_Memory  mem,
 207                                   FT_UInt32  variant_selector );
 208 
 209 
 210   typedef struct  FT_CMap_ClassRec_
 211   {
 212     FT_ULong               size;
 213 
 214     FT_CMap_InitFunc       init;
 215     FT_CMap_DoneFunc       done;
 216     FT_CMap_CharIndexFunc  char_index;
 217     FT_CMap_CharNextFunc   char_next;
 218 
 219     /* Subsequent entries are special ones for format 14 -- the variant */
 220     /* selector subtable which behaves like no other                    */
 221 
 222     FT_CMap_CharVarIndexFunc      char_var_index;
 223     FT_CMap_CharVarIsDefaultFunc  char_var_default;
 224     FT_CMap_VariantListFunc       variant_list;
 225     FT_CMap_CharVariantListFunc   charvariant_list;
 226     FT_CMap_VariantCharListFunc   variantchar_list;
 227 
 228   } FT_CMap_ClassRec;
 229 
 230 
<span class="line-removed"> 231 #ifndef FT_CONFIG_OPTION_PIC</span>
<span class="line-removed"> 232 </span>
 233 #define FT_DECLARE_CMAP_CLASS( class_ )              \
 234   FT_CALLBACK_TABLE const  FT_CMap_ClassRec class_;
 235 
 236 #define FT_DEFINE_CMAP_CLASS(       \
 237           class_,                   \
 238           size_,                    \
 239           init_,                    \
 240           done_,                    \
 241           char_index_,              \
 242           char_next_,               \
 243           char_var_index_,          \
 244           char_var_default_,        \
 245           variant_list_,            \
 246           charvariant_list_,        \
 247           variantchar_list_ )       \
 248   FT_CALLBACK_TABLE_DEF             \
 249   const FT_CMap_ClassRec  class_ =  \
 250   {                                 \
 251     size_,                          \
 252     init_,                          \
 253     done_,                          \
 254     char_index_,                    \
 255     char_next_,                     \
 256     char_var_index_,                \
 257     char_var_default_,              \
 258     variant_list_,                  \
 259     charvariant_list_,              \
 260     variantchar_list_               \
 261   };
 262 
<span class="line-removed"> 263 #else /* FT_CONFIG_OPTION_PIC */</span>
<span class="line-removed"> 264 </span>
<span class="line-removed"> 265 #define FT_DECLARE_CMAP_CLASS( class_ )                  \</span>
<span class="line-removed"> 266   void                                                   \</span>
<span class="line-removed"> 267   FT_Init_Class_ ## class_( FT_Library         library,  \</span>
<span class="line-removed"> 268                             FT_CMap_ClassRec*  clazz );</span>
<span class="line-removed"> 269 </span>
<span class="line-removed"> 270 #define FT_DEFINE_CMAP_CLASS(                            \</span>
<span class="line-removed"> 271           class_,                                        \</span>
<span class="line-removed"> 272           size_,                                         \</span>
<span class="line-removed"> 273           init_,                                         \</span>
<span class="line-removed"> 274           done_,                                         \</span>
<span class="line-removed"> 275           char_index_,                                   \</span>
<span class="line-removed"> 276           char_next_,                                    \</span>
<span class="line-removed"> 277           char_var_index_,                               \</span>
<span class="line-removed"> 278           char_var_default_,                             \</span>
<span class="line-removed"> 279           variant_list_,                                 \</span>
<span class="line-removed"> 280           charvariant_list_,                             \</span>
<span class="line-removed"> 281           variantchar_list_ )                            \</span>
<span class="line-removed"> 282   void                                                   \</span>
<span class="line-removed"> 283   FT_Init_Class_ ## class_( FT_Library         library,  \</span>
<span class="line-removed"> 284                             FT_CMap_ClassRec*  clazz )   \</span>
<span class="line-removed"> 285   {                                                      \</span>
<span class="line-removed"> 286     FT_UNUSED( library );                                \</span>
<span class="line-removed"> 287                                                          \</span>
<span class="line-removed"> 288     clazz-&gt;size             = size_;                     \</span>
<span class="line-removed"> 289     clazz-&gt;init             = init_;                     \</span>
<span class="line-removed"> 290     clazz-&gt;done             = done_;                     \</span>
<span class="line-removed"> 291     clazz-&gt;char_index       = char_index_;               \</span>
<span class="line-removed"> 292     clazz-&gt;char_next        = char_next_;                \</span>
<span class="line-removed"> 293     clazz-&gt;char_var_index   = char_var_index_;           \</span>
<span class="line-removed"> 294     clazz-&gt;char_var_default = char_var_default_;         \</span>
<span class="line-removed"> 295     clazz-&gt;variant_list     = variant_list_;             \</span>
<span class="line-removed"> 296     clazz-&gt;charvariant_list = charvariant_list_;         \</span>
<span class="line-removed"> 297     clazz-&gt;variantchar_list = variantchar_list_;         \</span>
<span class="line-removed"> 298   }</span>
<span class="line-removed"> 299 </span>
<span class="line-removed"> 300 #endif /* FT_CONFIG_OPTION_PIC */</span>
<span class="line-removed"> 301 </span>
 302 
 303   /* create a new charmap and add it to charmap-&gt;face */
 304   FT_BASE( FT_Error )
 305   FT_CMap_New( FT_CMap_Class  clazz,
 306                FT_Pointer     init_data,
 307                FT_CharMap     charmap,
 308                FT_CMap       *acmap );
 309 
 310   /* destroy a charmap and remove it from face&#39;s list */
 311   FT_BASE( void )
 312   FT_CMap_Done( FT_CMap  cmap );
 313 
 314 
<span class="line-modified"> 315   /* adds LCD padding to Min and Max boundaries */</span>
 316   FT_BASE( void )
<span class="line-modified"> 317   ft_lcd_padding( FT_Pos*       Min,</span>
<span class="line-modified"> 318                   FT_Pos*       Max,</span>
<span class="line-modified"> 319                   FT_GlyphSlot  slot );</span>
 320 
 321 #ifdef FT_CONFIG_OPTION_SUBPIXEL_RENDERING
 322 
 323   typedef void  (*FT_Bitmap_LcdFilterFunc)( FT_Bitmap*      bitmap,
<span class="line-removed"> 324                                             FT_Render_Mode  render_mode,</span>
 325                                             FT_Byte*        weights );
 326 
 327 
 328   /* This is the default LCD filter, an in-place, 5-tap FIR filter. */
 329   FT_BASE( void )
 330   ft_lcd_filter_fir( FT_Bitmap*           bitmap,
<span class="line-removed"> 331                      FT_Render_Mode       mode,</span>
 332                      FT_LcdFiveTapFilter  weights );
 333 
 334 #endif /* FT_CONFIG_OPTION_SUBPIXEL_RENDERING */
 335 
<span class="line-modified"> 336   /*************************************************************************/</span>
<span class="line-modified"> 337   /*                                                                       */</span>
<span class="line-modified"> 338   /* &lt;Struct&gt;                                                              */</span>
<span class="line-modified"> 339   /*    FT_Face_InternalRec                                                */</span>
<span class="line-modified"> 340   /*                                                                       */</span>
<span class="line-modified"> 341   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified"> 342   /*    This structure contains the internal fields of each FT_Face        */</span>
<span class="line-modified"> 343   /*    object.  These fields may change between different releases of     */</span>
<span class="line-modified"> 344   /*    FreeType.                                                          */</span>
<span class="line-modified"> 345   /*                                                                       */</span>
<span class="line-modified"> 346   /* &lt;Fields&gt;                                                              */</span>
<span class="line-modified"> 347   /*    max_points ::                                                      */</span>
<span class="line-modified"> 348   /*      The maximum number of points used to store the vectorial outline */</span>
<span class="line-modified"> 349   /*      of any glyph in this face.  If this value cannot be known in     */</span>
<span class="line-modified"> 350   /*      advance, or if the face isn&#39;t scalable, this should be set to 0. */</span>
<span class="line-modified"> 351   /*      Only relevant for scalable formats.                              */</span>
<span class="line-modified"> 352   /*                                                                       */</span>
<span class="line-modified"> 353   /*    max_contours ::                                                    */</span>
<span class="line-modified"> 354   /*      The maximum number of contours used to store the vectorial       */</span>
<span class="line-modified"> 355   /*      outline of any glyph in this face.  If this value cannot be      */</span>
<span class="line-modified"> 356   /*      known in advance, or if the face isn&#39;t scalable, this should be  */</span>
<span class="line-modified"> 357   /*      set to 0.  Only relevant for scalable formats.                   */</span>
<span class="line-modified"> 358   /*                                                                       */</span>
<span class="line-modified"> 359   /*    transform_matrix ::                                                */</span>
<span class="line-modified"> 360   /*      A 2x2 matrix of 16.16 coefficients used to transform glyph       */</span>
<span class="line-modified"> 361   /*      outlines after they are loaded from the font.  Only used by the  */</span>
<span class="line-modified"> 362   /*      convenience functions.                                           */</span>
<span class="line-modified"> 363   /*                                                                       */</span>
<span class="line-modified"> 364   /*    transform_delta ::                                                 */</span>
<span class="line-modified"> 365   /*      A translation vector used to transform glyph outlines after they */</span>
<span class="line-modified"> 366   /*      are loaded from the font.  Only used by the convenience          */</span>
<span class="line-modified"> 367   /*      functions.                                                       */</span>
<span class="line-modified"> 368   /*                                                                       */</span>
<span class="line-modified"> 369   /*    transform_flags ::                                                 */</span>
<span class="line-modified"> 370   /*      Some flags used to classify the transform.  Only used by the     */</span>
<span class="line-modified"> 371   /*      convenience functions.                                           */</span>
<span class="line-modified"> 372   /*                                                                       */</span>
<span class="line-modified"> 373   /*    services ::                                                        */</span>
<span class="line-modified"> 374   /*      A cache for frequently used services.  It should be only         */</span>
<span class="line-modified"> 375   /*      accessed with the macro `FT_FACE_LOOKUP_SERVICE&#39;.                */</span>
<span class="line-modified"> 376   /*                                                                       */</span>
<span class="line-modified"> 377   /*    incremental_interface ::                                           */</span>
<span class="line-modified"> 378   /*      If non-null, the interface through which glyph data and metrics  */</span>
<span class="line-modified"> 379   /*      are loaded incrementally for faces that do not provide all of    */</span>
<span class="line-modified"> 380   /*      this data when first opened.  This field exists only if          */</span>
<span class="line-modified"> 381   /*      @FT_CONFIG_OPTION_INCREMENTAL is defined.                        */</span>
<span class="line-modified"> 382   /*                                                                       */</span>
<span class="line-modified"> 383   /*    no_stem_darkening ::                                               */</span>
<span class="line-modified"> 384   /*      Overrides the module-level default, see @stem-darkening[cff],    */</span>
<span class="line-modified"> 385   /*      for example.  FALSE and TRUE toggle stem darkening on and off,   */</span>
<span class="line-modified"> 386   /*      respectively, value~-1 means to use the module/driver default.   */</span>
<span class="line-modified"> 387   /*                                                                       */</span>
<span class="line-modified"> 388   /*    random_seed ::                                                     */</span>
<span class="line-modified"> 389   /*      If positive, override the seed value for the CFF `random&#39;        */</span>
<span class="line-modified"> 390   /*      operator.  Value~0 means to use the font&#39;s value.  Value~-1      */</span>
<span class="line-modified"> 391   /*      means to use the CFF driver&#39;s default.                           */</span>
<span class="line-modified"> 392   /*                                                                       */</span>
<span class="line-modified"> 393   /*    lcd_weights      ::                                                */</span>
<span class="line-modified"> 394   /*    lcd_filter_func  ::                                                */</span>
<span class="line-modified"> 395   /*      If subpixel rendering is activated, the LCD filtering weights    */</span>
<span class="line-modified"> 396   /*      and callback function.                                           */</span>
<span class="line-modified"> 397   /*                                                                       */</span>
<span class="line-modified"> 398   /*    refcount ::                                                        */</span>
<span class="line-modified"> 399   /*      A counter initialized to~1 at the time an @FT_Face structure is  */</span>
<span class="line-modified"> 400   /*      created.  @FT_Reference_Face increments this counter, and        */</span>
<span class="line-modified"> 401   /*      @FT_Done_Face only destroys a face if the counter is~1,          */</span>
<span class="line-removed"> 402   /*      otherwise it simply decrements it.                               */</span>
<span class="line-removed"> 403   /*                                                                       */</span>
 404   typedef struct  FT_Face_InternalRec_
 405   {
 406     FT_Matrix  transform_matrix;
 407     FT_Vector  transform_delta;
 408     FT_Int     transform_flags;
 409 
 410     FT_ServiceCacheRec  services;
 411 
 412 #ifdef FT_CONFIG_OPTION_INCREMENTAL
 413     FT_Incremental_InterfaceRec*  incremental_interface;
 414 #endif
 415 
 416     FT_Char              no_stem_darkening;
 417     FT_Int32             random_seed;
 418 
 419 #ifdef FT_CONFIG_OPTION_SUBPIXEL_RENDERING
 420     FT_LcdFiveTapFilter      lcd_weights;      /* filter weights, if any */
 421     FT_Bitmap_LcdFilterFunc  lcd_filter_func;  /* filtering callback     */
 422 #endif
 423 
 424     FT_Int  refcount;
 425 
 426   } FT_Face_InternalRec;
 427 
 428 
<span class="line-modified"> 429   /*************************************************************************/</span>
<span class="line-modified"> 430   /*                                                                       */</span>
<span class="line-modified"> 431   /* &lt;Struct&gt;                                                              */</span>
<span class="line-modified"> 432   /*    FT_Slot_InternalRec                                                */</span>
<span class="line-modified"> 433   /*                                                                       */</span>
<span class="line-modified"> 434   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified"> 435   /*    This structure contains the internal fields of each FT_GlyphSlot   */</span>
<span class="line-modified"> 436   /*    object.  These fields may change between different releases of     */</span>
<span class="line-modified"> 437   /*    FreeType.                                                          */</span>
<span class="line-modified"> 438   /*                                                                       */</span>
<span class="line-modified"> 439   /* &lt;Fields&gt;                                                              */</span>
<span class="line-modified"> 440   /*    loader            :: The glyph loader object used to load outlines */</span>
<span class="line-modified"> 441   /*                         into the glyph slot.                          */</span>
<span class="line-modified"> 442   /*                                                                       */</span>
<span class="line-modified"> 443   /*    flags             :: Possible values are zero or                   */</span>
<span class="line-modified"> 444   /*                         FT_GLYPH_OWN_BITMAP.  The latter indicates    */</span>
<span class="line-modified"> 445   /*                         that the FT_GlyphSlot structure owns the      */</span>
<span class="line-modified"> 446   /*                         bitmap buffer.                                */</span>
<span class="line-modified"> 447   /*                                                                       */</span>
<span class="line-modified"> 448   /*    glyph_transformed :: Boolean.  Set to TRUE when the loaded glyph   */</span>
<span class="line-modified"> 449   /*                         must be transformed through a specific        */</span>
<span class="line-modified"> 450   /*                         font transformation.  This is _not_ the same  */</span>
<span class="line-modified"> 451   /*                         as the face transform set through             */</span>
<span class="line-modified"> 452   /*                         FT_Set_Transform().                           */</span>
<span class="line-modified"> 453   /*                                                                       */</span>
<span class="line-modified"> 454   /*    glyph_matrix      :: The 2x2 matrix corresponding to the glyph     */</span>
<span class="line-modified"> 455   /*                         transformation, if necessary.                 */</span>
<span class="line-modified"> 456   /*                                                                       */</span>
<span class="line-modified"> 457   /*    glyph_delta       :: The 2d translation vector corresponding to    */</span>
<span class="line-modified"> 458   /*                         the glyph transformation, if necessary.       */</span>
<span class="line-modified"> 459   /*                                                                       */</span>
<span class="line-modified"> 460   /*    glyph_hints       :: Format-specific glyph hints management.       */</span>
<span class="line-modified"> 461   /*                                                                       */</span>





 462 
 463 #define FT_GLYPH_OWN_BITMAP  0x1U
 464 
 465   typedef struct  FT_Slot_InternalRec_
 466   {
 467     FT_GlyphLoader  loader;
 468     FT_UInt         flags;
 469     FT_Bool         glyph_transformed;
 470     FT_Matrix       glyph_matrix;
 471     FT_Vector       glyph_delta;
 472     void*           glyph_hints;
 473 


 474   } FT_GlyphSlot_InternalRec;
 475 
 476 
<span class="line-modified"> 477   /*************************************************************************/</span>
<span class="line-modified"> 478   /*                                                                       */</span>
<span class="line-modified"> 479   /* &lt;Struct&gt;                                                              */</span>
<span class="line-modified"> 480   /*    FT_Size_InternalRec                                                */</span>
<span class="line-modified"> 481   /*                                                                       */</span>
<span class="line-modified"> 482   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified"> 483   /*    This structure contains the internal fields of each FT_Size        */</span>
<span class="line-modified"> 484   /*    object.                                                            */</span>
<span class="line-modified"> 485   /*                                                                       */</span>
<span class="line-modified"> 486   /* &lt;Fields&gt;                                                              */</span>
<span class="line-modified"> 487   /*    module_data      :: Data specific to a driver module.              */</span>
<span class="line-modified"> 488   /*                                                                       */</span>
<span class="line-modified"> 489   /*    autohint_mode    :: The used auto-hinting mode.                    */</span>
<span class="line-modified"> 490   /*                                                                       */</span>
<span class="line-modified"> 491   /*    autohint_metrics :: Metrics used by the auto-hinter.               */</span>
<span class="line-modified"> 492   /*                                                                       */</span>
<span class="line-modified"> 493   /*************************************************************************/</span>


 494 
 495   typedef struct  FT_Size_InternalRec_
 496   {
 497     void*  module_data;
 498 
 499     FT_Render_Mode   autohint_mode;
 500     FT_Size_Metrics  autohint_metrics;
 501 
 502   } FT_Size_InternalRec;
 503 
 504 
 505   /*************************************************************************/
 506   /*************************************************************************/
 507   /*************************************************************************/
 508   /****                                                                 ****/
 509   /****                                                                 ****/
 510   /****                         M O D U L E S                           ****/
 511   /****                                                                 ****/
 512   /****                                                                 ****/
 513   /*************************************************************************/
 514   /*************************************************************************/
 515   /*************************************************************************/
 516 
 517 
<span class="line-modified"> 518   /*************************************************************************/</span>
<span class="line-modified"> 519   /*                                                                       */</span>
<span class="line-modified"> 520   /* &lt;Struct&gt;                                                              */</span>
<span class="line-modified"> 521   /*    FT_ModuleRec                                                       */</span>
<span class="line-modified"> 522   /*                                                                       */</span>
<span class="line-modified"> 523   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified"> 524   /*    A module object instance.                                          */</span>
<span class="line-modified"> 525   /*                                                                       */</span>
<span class="line-modified"> 526   /* &lt;Fields&gt;                                                              */</span>
<span class="line-modified"> 527   /*    clazz   :: A pointer to the module&#39;s class.                        */</span>
<span class="line-modified"> 528   /*                                                                       */</span>
<span class="line-modified"> 529   /*    library :: A handle to the parent library object.                  */</span>
<span class="line-modified"> 530   /*                                                                       */</span>
<span class="line-modified"> 531   /*    memory  :: A handle to the memory manager.                         */</span>
<span class="line-modified"> 532   /*                                                                       */</span>



 533   typedef struct  FT_ModuleRec_
 534   {
 535     FT_Module_Class*  clazz;
 536     FT_Library        library;
 537     FT_Memory         memory;
 538 
 539   } FT_ModuleRec;
 540 
 541 
 542   /* typecast an object to an FT_Module */
 543 #define FT_MODULE( x )  ( (FT_Module)(x) )
 544 
 545 #define FT_MODULE_CLASS( x )    FT_MODULE( x )-&gt;clazz
 546 #define FT_MODULE_LIBRARY( x )  FT_MODULE( x )-&gt;library
 547 #define FT_MODULE_MEMORY( x )   FT_MODULE( x )-&gt;memory
 548 
 549 
 550 #define FT_MODULE_IS_DRIVER( x )  ( FT_MODULE_CLASS( x )-&gt;module_flags &amp; \
 551                                     FT_MODULE_FONT_DRIVER )
 552 
</pre>
<hr />
<pre>
 555 
 556 #define FT_MODULE_IS_HINTER( x )  ( FT_MODULE_CLASS( x )-&gt;module_flags &amp; \
 557                                     FT_MODULE_HINTER )
 558 
 559 #define FT_MODULE_IS_STYLER( x )  ( FT_MODULE_CLASS( x )-&gt;module_flags &amp; \
 560                                     FT_MODULE_STYLER )
 561 
 562 #define FT_DRIVER_IS_SCALABLE( x )  ( FT_MODULE_CLASS( x )-&gt;module_flags &amp; \
 563                                       FT_MODULE_DRIVER_SCALABLE )
 564 
 565 #define FT_DRIVER_USES_OUTLINES( x )  !( FT_MODULE_CLASS( x )-&gt;module_flags &amp; \
 566                                          FT_MODULE_DRIVER_NO_OUTLINES )
 567 
 568 #define FT_DRIVER_HAS_HINTER( x )  ( FT_MODULE_CLASS( x )-&gt;module_flags &amp; \
 569                                      FT_MODULE_DRIVER_HAS_HINTER )
 570 
 571 #define FT_DRIVER_HINTS_LIGHTLY( x )  ( FT_MODULE_CLASS( x )-&gt;module_flags &amp; \
 572                                         FT_MODULE_DRIVER_HINTS_LIGHTLY )
 573 
 574 
<span class="line-modified"> 575   /*************************************************************************/</span>
<span class="line-modified"> 576   /*                                                                       */</span>
<span class="line-modified"> 577   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified"> 578   /*    FT_Get_Module_Interface                                            */</span>
<span class="line-modified"> 579   /*                                                                       */</span>
<span class="line-modified"> 580   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified"> 581   /*    Finds a module and returns its specific interface as a typeless    */</span>
<span class="line-modified"> 582   /*    pointer.                                                           */</span>
<span class="line-modified"> 583   /*                                                                       */</span>
<span class="line-modified"> 584   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified"> 585   /*    library     :: A handle to the library object.                     */</span>
<span class="line-modified"> 586   /*                                                                       */</span>
<span class="line-modified"> 587   /*    module_name :: The module&#39;s name (as an ASCII string).             */</span>
<span class="line-modified"> 588   /*                                                                       */</span>
<span class="line-modified"> 589   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified"> 590   /*    A module-specific interface if available, 0 otherwise.             */</span>
<span class="line-modified"> 591   /*                                                                       */</span>
<span class="line-modified"> 592   /* &lt;Note&gt;                                                                */</span>
<span class="line-modified"> 593   /*    You should better be familiar with FreeType internals to know      */</span>
<span class="line-modified"> 594   /*    which module to look for, and what its interface is :-)            */</span>
<span class="line-modified"> 595   /*                                                                       */</span>


 596   FT_BASE( const void* )
 597   FT_Get_Module_Interface( FT_Library   library,
 598                            const char*  mod_name );
 599 
 600   FT_BASE( FT_Pointer )
 601   ft_module_get_service( FT_Module    module,
 602                          const char*  service_id,
 603                          FT_Bool      global );
 604 
 605 #ifdef FT_CONFIG_OPTION_ENVIRONMENT_PROPERTIES
 606   FT_BASE( FT_Error )
 607   ft_property_string_set( FT_Library        library,
 608                           const FT_String*  module_name,
 609                           const FT_String*  property_name,
 610                           FT_String*        value );
 611 #endif
 612 
 613   /* */
 614 
 615 
</pre>
<hr />
<pre>
 626   /*************************************************************************/
 627 
 628   /* a few macros used to perform easy typecasts with minimal brain damage */
 629 
 630 #define FT_FACE( x )          ( (FT_Face)(x) )
 631 #define FT_SIZE( x )          ( (FT_Size)(x) )
 632 #define FT_SLOT( x )          ( (FT_GlyphSlot)(x) )
 633 
 634 #define FT_FACE_DRIVER( x )   FT_FACE( x )-&gt;driver
 635 #define FT_FACE_LIBRARY( x )  FT_FACE_DRIVER( x )-&gt;root.library
 636 #define FT_FACE_MEMORY( x )   FT_FACE( x )-&gt;memory
 637 #define FT_FACE_STREAM( x )   FT_FACE( x )-&gt;stream
 638 
 639 #define FT_SIZE_FACE( x )     FT_SIZE( x )-&gt;face
 640 #define FT_SLOT_FACE( x )     FT_SLOT( x )-&gt;face
 641 
 642 #define FT_FACE_SLOT( x )     FT_FACE( x )-&gt;glyph
 643 #define FT_FACE_SIZE( x )     FT_FACE( x )-&gt;size
 644 
 645 
<span class="line-modified"> 646   /*************************************************************************/</span>
<span class="line-modified"> 647   /*                                                                       */</span>
<span class="line-modified"> 648   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified"> 649   /*    FT_New_GlyphSlot                                                   */</span>
<span class="line-modified"> 650   /*                                                                       */</span>
<span class="line-modified"> 651   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified"> 652   /*    It is sometimes useful to have more than one glyph slot for a      */</span>
<span class="line-modified"> 653   /*    given face object.  This function is used to create additional     */</span>
<span class="line-modified"> 654   /*    slots.  All of them are automatically discarded when the face is   */</span>
<span class="line-modified"> 655   /*    destroyed.                                                         */</span>
<span class="line-modified"> 656   /*                                                                       */</span>
<span class="line-modified"> 657   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified"> 658   /*    face  :: A handle to a parent face object.                         */</span>
<span class="line-modified"> 659   /*                                                                       */</span>
<span class="line-modified"> 660   /* &lt;Output&gt;                                                              */</span>
<span class="line-modified"> 661   /*    aslot :: A handle to a new glyph slot object.                      */</span>
<span class="line-modified"> 662   /*                                                                       */</span>
<span class="line-modified"> 663   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified"> 664   /*    FreeType error code.  0 means success.                             */</span>
<span class="line-modified"> 665   /*                                                                       */</span>

 666   FT_BASE( FT_Error )
 667   FT_New_GlyphSlot( FT_Face        face,
 668                     FT_GlyphSlot  *aslot );
 669 
 670 
<span class="line-modified"> 671   /*************************************************************************/</span>
<span class="line-modified"> 672   /*                                                                       */</span>
<span class="line-modified"> 673   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified"> 674   /*    FT_Done_GlyphSlot                                                  */</span>
<span class="line-modified"> 675   /*                                                                       */</span>
<span class="line-modified"> 676   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified"> 677   /*    Destroys a given glyph slot.  Remember however that all slots are  */</span>
<span class="line-modified"> 678   /*    automatically destroyed with its parent.  Using this function is   */</span>
<span class="line-modified"> 679   /*    not always mandatory.                                              */</span>
<span class="line-modified"> 680   /*                                                                       */</span>
<span class="line-modified"> 681   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified"> 682   /*    slot :: A handle to a target glyph slot.                           */</span>
<span class="line-modified"> 683   /*                                                                       */</span>

 684   FT_BASE( void )
 685   FT_Done_GlyphSlot( FT_GlyphSlot  slot );
 686 
 687  /* */
 688 
 689 #define FT_REQUEST_WIDTH( req )                                            \
 690           ( (req)-&gt;horiResolution                                          \
 691               ? ( (req)-&gt;width * (FT_Pos)(req)-&gt;horiResolution + 36 ) / 72 \
 692               : (req)-&gt;width )
 693 
 694 #define FT_REQUEST_HEIGHT( req )                                            \
 695           ( (req)-&gt;vertResolution                                           \
 696               ? ( (req)-&gt;height * (FT_Pos)(req)-&gt;vertResolution + 36 ) / 72 \
 697               : (req)-&gt;height )
 698 
 699 
 700   /* Set the metrics according to a bitmap strike. */
 701   FT_BASE( void )
 702   FT_Select_Metrics( FT_Face   face,
 703                      FT_ULong  strike_index );
</pre>
<hr />
<pre>
 713   FT_BASE( FT_Error )
 714   FT_Match_Size( FT_Face          face,
 715                  FT_Size_Request  req,
 716                  FT_Bool          ignore_width,
 717                  FT_ULong*        size_index );
 718 
 719 
 720   /* Use the horizontal metrics to synthesize the vertical metrics. */
 721   /* If `advance&#39; is zero, it is also synthesized.                  */
 722   FT_BASE( void )
 723   ft_synthesize_vertical_metrics( FT_Glyph_Metrics*  metrics,
 724                                   FT_Pos             advance );
 725 
 726 
 727   /* Free the bitmap of a given glyphslot when needed (i.e., only when it */
 728   /* was allocated with ft_glyphslot_alloc_bitmap).                       */
 729   FT_BASE( void )
 730   ft_glyphslot_free_bitmap( FT_GlyphSlot  slot );
 731 
 732 
<span class="line-modified"> 733   /* Preset bitmap metrics of an outline glyphslot prior to rendering. */</span>
<span class="line-modified"> 734   FT_BASE( void )</span>

 735   ft_glyphslot_preset_bitmap( FT_GlyphSlot      slot,
 736                               FT_Render_Mode    mode,
 737                               const FT_Vector*  origin );
 738 
 739   /* Allocate a new bitmap buffer in a glyph slot. */
 740   FT_BASE( FT_Error )
 741   ft_glyphslot_alloc_bitmap( FT_GlyphSlot  slot,
 742                              FT_ULong      size );
 743 
 744 
 745   /* Set the bitmap buffer in a glyph slot to a given pointer.  The buffer */
 746   /* will not be freed by a later call to ft_glyphslot_free_bitmap.        */
 747   FT_BASE( void )
 748   ft_glyphslot_set_bitmap( FT_GlyphSlot  slot,
 749                            FT_Byte*      buffer );
 750 
 751 
 752   /*************************************************************************/
 753   /*************************************************************************/
 754   /*************************************************************************/
</pre>
<hr />
<pre>
 785   /*************************************************************************/
 786   /*************************************************************************/
 787   /*************************************************************************/
 788   /****                                                                 ****/
 789   /****                                                                 ****/
 790   /****                    F O N T   D R I V E R S                      ****/
 791   /****                                                                 ****/
 792   /****                                                                 ****/
 793   /*************************************************************************/
 794   /*************************************************************************/
 795   /*************************************************************************/
 796 
 797 
 798   /* typecast a module into a driver easily */
 799 #define FT_DRIVER( x )  ( (FT_Driver)(x) )
 800 
 801   /* typecast a module as a driver, and get its driver class */
 802 #define FT_DRIVER_CLASS( x )  FT_DRIVER( x )-&gt;clazz
 803 
 804 
<span class="line-modified"> 805   /*************************************************************************/</span>
<span class="line-modified"> 806   /*                                                                       */</span>
<span class="line-modified"> 807   /* &lt;Struct&gt;                                                              */</span>
<span class="line-modified"> 808   /*    FT_DriverRec                                                       */</span>
<span class="line-modified"> 809   /*                                                                       */</span>
<span class="line-modified"> 810   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified"> 811   /*    The root font driver class.  A font driver is responsible for      */</span>
<span class="line-modified"> 812   /*    managing and loading font files of a given format.                 */</span>
<span class="line-modified"> 813   /*                                                                       */</span>
<span class="line-modified"> 814   /*  &lt;Fields&gt;                                                             */</span>
<span class="line-modified"> 815   /*     root         :: Contains the fields of the root module class.     */</span>
<span class="line-modified"> 816   /*                                                                       */</span>
<span class="line-modified"> 817   /*     clazz        :: A pointer to the font driver&#39;s class.  Note that  */</span>
<span class="line-modified"> 818   /*                     this is NOT root.clazz.  `class&#39; wasn&#39;t used      */</span>
<span class="line-modified"> 819   /*                     as it is a reserved word in C++.                  */</span>
<span class="line-modified"> 820   /*                                                                       */</span>
<span class="line-modified"> 821   /*     faces_list   :: The list of faces currently opened by this        */</span>
<span class="line-modified"> 822   /*                     driver.                                           */</span>
<span class="line-modified"> 823   /*                                                                       */</span>
<span class="line-modified"> 824   /*     glyph_loader :: Unused.  Used to be glyph loader for all faces    */</span>
<span class="line-modified"> 825   /*                     managed by this driver.                           */</span>
<span class="line-modified"> 826   /*                                                                       */</span>


 827   typedef struct  FT_DriverRec_
 828   {
 829     FT_ModuleRec     root;
 830     FT_Driver_Class  clazz;
 831     FT_ListRec       faces_list;
 832     FT_GlyphLoader   glyph_loader;
 833 
 834   } FT_DriverRec;
 835 
 836 
 837   /*************************************************************************/
 838   /*************************************************************************/
 839   /*************************************************************************/
 840   /****                                                                 ****/
 841   /****                                                                 ****/
 842   /****                       L I B R A R I E S                         ****/
 843   /****                                                                 ****/
 844   /****                                                                 ****/
 845   /*************************************************************************/
 846   /*************************************************************************/
 847   /*************************************************************************/
 848 
 849 
<span class="line-modified"> 850   /* This hook is used by the TrueType debugger.  It must be set to an */</span>
<span class="line-modified"> 851   /* alternate truetype bytecode interpreter function.                 */</span>
<span class="line-modified"> 852 #define FT_DEBUG_HOOK_TRUETYPE  0</span>
<span class="line-modified"> 853 </span>
<span class="line-modified"> 854 </span>
<span class="line-modified"> 855   /*************************************************************************/</span>
<span class="line-modified"> 856   /*                                                                       */</span>
<span class="line-modified"> 857   /* &lt;Struct&gt;                                                              */</span>
<span class="line-modified"> 858   /*    FT_LibraryRec                                                      */</span>
<span class="line-modified"> 859   /*                                                                       */</span>
<span class="line-modified"> 860   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified"> 861   /*    The FreeType library class.  This is the root of all FreeType      */</span>
<span class="line-modified"> 862   /*    data.  Use FT_New_Library() to create a library object, and        */</span>
<span class="line-modified"> 863   /*    FT_Done_Library() to discard it and all child objects.             */</span>
<span class="line-modified"> 864   /*                                                                       */</span>
<span class="line-modified"> 865   /* &lt;Fields&gt;                                                              */</span>
<span class="line-modified"> 866   /*    memory           :: The library&#39;s memory object.  Manages memory   */</span>
<span class="line-modified"> 867   /*                        allocation.                                    */</span>
<span class="line-modified"> 868   /*                                                                       */</span>
<span class="line-modified"> 869   /*    version_major    :: The major version number of the library.       */</span>
<span class="line-modified"> 870   /*                                                                       */</span>
<span class="line-modified"> 871   /*    version_minor    :: The minor version number of the library.       */</span>
<span class="line-modified"> 872   /*                                                                       */</span>
<span class="line-modified"> 873   /*    version_patch    :: The current patch level of the library.        */</span>
<span class="line-modified"> 874   /*                                                                       */</span>
<span class="line-modified"> 875   /*    num_modules      :: The number of modules currently registered     */</span>
<span class="line-modified"> 876   /*                        within this library.  This is set to 0 for new */</span>
<span class="line-modified"> 877   /*                        libraries.  New modules are added through the  */</span>
<span class="line-modified"> 878   /*                        FT_Add_Module() API function.                  */</span>
<span class="line-modified"> 879   /*                                                                       */</span>
<span class="line-modified"> 880   /*    modules          :: A table used to store handles to the currently */</span>
<span class="line-modified"> 881   /*                        registered modules. Note that each font driver */</span>
<span class="line-modified"> 882   /*                        contains a list of its opened faces.           */</span>
<span class="line-modified"> 883   /*                                                                       */</span>
<span class="line-modified"> 884   /*    renderers        :: The list of renderers currently registered     */</span>
<span class="line-modified"> 885   /*                        within the library.                            */</span>
<span class="line-modified"> 886   /*                                                                       */</span>
<span class="line-modified"> 887   /*    cur_renderer     :: The current outline renderer.  This is a       */</span>
<span class="line-modified"> 888   /*                        shortcut used to avoid parsing the list on     */</span>
<span class="line-modified"> 889   /*                        each call to FT_Outline_Render().  It is a     */</span>
<span class="line-modified"> 890   /*                        handle to the current renderer for the         */</span>
<span class="line-modified"> 891   /*                        FT_GLYPH_FORMAT_OUTLINE format.                */</span>
<span class="line-modified"> 892   /*                                                                       */</span>
<span class="line-modified"> 893   /*    auto_hinter      :: The auto-hinter module interface.              */</span>
<span class="line-modified"> 894   /*                                                                       */</span>
<span class="line-modified"> 895   /*    debug_hooks      :: An array of four function pointers that allow  */</span>
<span class="line-modified"> 896   /*                        debuggers to hook into a font format&#39;s         */</span>
<span class="line-modified"> 897   /*                        interpreter.  Currently, only the TrueType     */</span>
<span class="line-modified"> 898   /*                        bytecode debugger uses this.                   */</span>
<span class="line-modified"> 899   /*                                                                       */</span>
<span class="line-modified"> 900   /*    lcd_weights      :: If subpixel rendering is activated, the LCD    */</span>
<span class="line-modified"> 901   /*                        filter weights, if any.                        */</span>
<span class="line-modified"> 902   /*                                                                       */</span>
<span class="line-modified"> 903   /*    lcd_filter_func  :: If subpixel rendering is activated, the LCD    */</span>
<span class="line-modified"> 904   /*                        filtering callback function.                   */</span>
<span class="line-modified"> 905   /*                                                                       */</span>
<span class="line-modified"> 906   /*    pic_container    :: Contains global structs and tables, instead    */</span>
<span class="line-modified"> 907   /*                        of defining them globally.                     */</span>
<span class="line-modified"> 908   /*                                                                       */</span>
<span class="line-modified"> 909   /*    refcount         :: A counter initialized to~1 at the time an      */</span>
<span class="line-modified"> 910   /*                        @FT_Library structure is created.              */</span>
<span class="line-modified"> 911   /*                        @FT_Reference_Library increments this counter, */</span>
<span class="line-modified"> 912   /*                        and @FT_Done_Library only destroys a library   */</span>
<span class="line-modified"> 913   /*                        if the counter is~1, otherwise it simply       */</span>
<span class="line-modified"> 914   /*                        decrements it.                                 */</span>
<span class="line-modified"> 915   /*                                                                       */</span>





 916   typedef struct  FT_LibraryRec_
 917   {
 918     FT_Memory          memory;           /* library&#39;s memory manager */
 919 
 920     FT_Int             version_major;
 921     FT_Int             version_minor;
 922     FT_Int             version_patch;
 923 
 924     FT_UInt            num_modules;
 925     FT_Module          modules[FT_MAX_MODULES];  /* module objects  */
 926 
 927     FT_ListRec         renderers;        /* list of renderers        */
 928     FT_Renderer        cur_renderer;     /* current outline renderer */
 929     FT_Module          auto_hinter;
 930 
 931     FT_DebugHook_Func  debug_hooks[4];
 932 
 933 #ifdef FT_CONFIG_OPTION_SUBPIXEL_RENDERING
 934     FT_LcdFiveTapFilter      lcd_weights;      /* filter weights, if any */
 935     FT_Bitmap_LcdFilterFunc  lcd_filter_func;  /* filtering callback     */
<span class="line-modified"> 936 #endif</span>
<span class="line-modified"> 937 </span>
<span class="line-removed"> 938 #ifdef FT_CONFIG_OPTION_PIC</span>
<span class="line-removed"> 939     FT_PIC_Container   pic_container;</span>
 940 #endif
 941 
 942     FT_Int             refcount;
 943 
 944   } FT_LibraryRec;
 945 
 946 
 947   FT_BASE( FT_Renderer )
 948   FT_Lookup_Renderer( FT_Library       library,
 949                       FT_Glyph_Format  format,
 950                       FT_ListNode*     node );
 951 
 952   FT_BASE( FT_Error )
 953   FT_Render_Glyph_Internal( FT_Library      library,
 954                             FT_GlyphSlot    slot,
 955                             FT_Render_Mode  render_mode );
 956 
 957   typedef const char*
 958   (*FT_Face_GetPostscriptNameFunc)( FT_Face  face );
 959 
 960   typedef FT_Error
 961   (*FT_Face_GetGlyphNameFunc)( FT_Face     face,
 962                                FT_UInt     glyph_index,
 963                                FT_Pointer  buffer,
 964                                FT_UInt     buffer_max );
 965 
 966   typedef FT_UInt
<span class="line-modified"> 967   (*FT_Face_GetGlyphNameIndexFunc)( FT_Face     face,</span>
<span class="line-modified"> 968                                     FT_String*  glyph_name );</span>
 969 
 970 
 971 #ifndef FT_CONFIG_OPTION_NO_DEFAULT_SYSTEM
 972 
<span class="line-modified"> 973   /*************************************************************************/</span>
<span class="line-modified"> 974   /*                                                                       */</span>
<span class="line-modified"> 975   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified"> 976   /*    FT_New_Memory                                                      */</span>
<span class="line-modified"> 977   /*                                                                       */</span>
<span class="line-modified"> 978   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified"> 979   /*    Creates a new memory object.                                       */</span>
<span class="line-modified"> 980   /*                                                                       */</span>
<span class="line-modified"> 981   /* &lt;Return&gt;                                                              */</span>
<span class="line-modified"> 982   /*    A pointer to the new memory object.  0 in case of error.           */</span>
<span class="line-modified"> 983   /*                                                                       */</span>
 984   FT_BASE( FT_Memory )
 985   FT_New_Memory( void );
 986 
 987 
<span class="line-modified"> 988   /*************************************************************************/</span>
<span class="line-modified"> 989   /*                                                                       */</span>
<span class="line-modified"> 990   /* &lt;Function&gt;                                                            */</span>
<span class="line-modified"> 991   /*    FT_Done_Memory                                                     */</span>
<span class="line-modified"> 992   /*                                                                       */</span>
<span class="line-modified"> 993   /* &lt;Description&gt;                                                         */</span>
<span class="line-modified"> 994   /*    Discards memory manager.                                           */</span>
<span class="line-modified"> 995   /*                                                                       */</span>
<span class="line-modified"> 996   /* &lt;Input&gt;                                                               */</span>
<span class="line-modified"> 997   /*    memory :: A handle to the memory manager.                          */</span>
<span class="line-modified"> 998   /*                                                                       */</span>

 999   FT_BASE( void )
1000   FT_Done_Memory( FT_Memory  memory );
1001 
1002 #endif /* !FT_CONFIG_OPTION_NO_DEFAULT_SYSTEM */
1003 
1004 
1005   /* Define default raster&#39;s interface.  The default raster is located in  */
1006   /* `src/base/ftraster.c&#39;.                                                */
1007   /*                                                                       */
1008   /* Client applications can register new rasters through the              */
1009   /* FT_Set_Raster() API.                                                  */
1010 
1011 #ifndef FT_NO_DEFAULT_RASTER
1012   FT_EXPORT_VAR( FT_Raster_Funcs )  ft_default_raster;
1013 #endif
1014 
1015 
<span class="line-modified">1016   /*************************************************************************/</span>
<span class="line-modified">1017   /*************************************************************************/</span>
<span class="line-modified">1018   /*************************************************************************/</span>
<span class="line-modified">1019   /****                                                                 ****/</span>
<span class="line-modified">1020   /****                                                                 ****/</span>
<span class="line-modified">1021   /****                      P I C   S U P P O R T                      ****/</span>
<span class="line-modified">1022   /****                                                                 ****/</span>
<span class="line-modified">1023   /****                                                                 ****/</span>
<span class="line-modified">1024   /*************************************************************************/</span>
<span class="line-modified">1025   /*************************************************************************/</span>
<span class="line-removed">1026   /*************************************************************************/</span>
<span class="line-removed">1027 </span>
<span class="line-removed">1028 </span>
<span class="line-removed">1029   /* PIC support macros for ftimage.h */</span>
<span class="line-removed">1030 </span>
<span class="line-removed">1031 </span>
<span class="line-removed">1032   /*************************************************************************/</span>
<span class="line-removed">1033   /*                                                                       */</span>
<span class="line-removed">1034   /* &lt;Macro&gt;                                                               */</span>
<span class="line-removed">1035   /*    FT_DEFINE_OUTLINE_FUNCS                                            */</span>
<span class="line-removed">1036   /*                                                                       */</span>
<span class="line-removed">1037   /* &lt;Description&gt;                                                         */</span>
<span class="line-removed">1038   /*    Used to initialize an instance of FT_Outline_Funcs struct.         */</span>
<span class="line-removed">1039   /*    When FT_CONFIG_OPTION_PIC is defined an init function will need    */</span>
<span class="line-removed">1040   /*    to be called with a pre-allocated structure to be filled.          */</span>
<span class="line-removed">1041   /*    When FT_CONFIG_OPTION_PIC is not defined the struct will be        */</span>
<span class="line-removed">1042   /*    allocated in the global scope (or the scope where the macro        */</span>
<span class="line-removed">1043   /*    is used).                                                          */</span>
<span class="line-removed">1044   /*                                                                       */</span>
<span class="line-removed">1045 #ifndef FT_CONFIG_OPTION_PIC</span>
<span class="line-removed">1046 </span>
1047 #define FT_DEFINE_OUTLINE_FUNCS(           \
1048           class_,                          \
1049           move_to_,                        \
1050           line_to_,                        \
1051           conic_to_,                       \
1052           cubic_to_,                       \
1053           shift_,                          \
1054           delta_ )                         \
1055   static const  FT_Outline_Funcs class_ =  \
1056   {                                        \
1057     move_to_,                              \
1058     line_to_,                              \
1059     conic_to_,                             \
1060     cubic_to_,                             \
1061     shift_,                                \
1062     delta_                                 \
1063   };
1064 
<span class="line-removed">1065 #else /* FT_CONFIG_OPTION_PIC */</span>
<span class="line-removed">1066 </span>
<span class="line-removed">1067 #define FT_DEFINE_OUTLINE_FUNCS(                     \</span>
<span class="line-removed">1068           class_,                                    \</span>
<span class="line-removed">1069           move_to_,                                  \</span>
<span class="line-removed">1070           line_to_,                                  \</span>
<span class="line-removed">1071           conic_to_,                                 \</span>
<span class="line-removed">1072           cubic_to_,                                 \</span>
<span class="line-removed">1073           shift_,                                    \</span>
<span class="line-removed">1074           delta_ )                                   \</span>
<span class="line-removed">1075   static FT_Error                                    \</span>
<span class="line-removed">1076   Init_Class_ ## class_( FT_Outline_Funcs*  clazz )  \</span>
<span class="line-removed">1077   {                                                  \</span>
<span class="line-removed">1078     clazz-&gt;move_to  = move_to_;                      \</span>
<span class="line-removed">1079     clazz-&gt;line_to  = line_to_;                      \</span>
<span class="line-removed">1080     clazz-&gt;conic_to = conic_to_;                     \</span>
<span class="line-removed">1081     clazz-&gt;cubic_to = cubic_to_;                     \</span>
<span class="line-removed">1082     clazz-&gt;shift    = shift_;                        \</span>
<span class="line-removed">1083     clazz-&gt;delta    = delta_;                        \</span>
<span class="line-removed">1084                                                      \</span>
<span class="line-removed">1085     return FT_Err_Ok;                                \</span>
<span class="line-removed">1086   }</span>
<span class="line-removed">1087 </span>
<span class="line-removed">1088 #endif /* FT_CONFIG_OPTION_PIC */</span>
<span class="line-removed">1089 </span>
<span class="line-removed">1090 </span>
<span class="line-removed">1091   /*************************************************************************/</span>
<span class="line-removed">1092   /*                                                                       */</span>
<span class="line-removed">1093   /* &lt;Macro&gt;                                                               */</span>
<span class="line-removed">1094   /*    FT_DEFINE_RASTER_FUNCS                                             */</span>
<span class="line-removed">1095   /*                                                                       */</span>
<span class="line-removed">1096   /* &lt;Description&gt;                                                         */</span>
<span class="line-removed">1097   /*    Used to initialize an instance of FT_Raster_Funcs struct.          */</span>
<span class="line-removed">1098   /*    When FT_CONFIG_OPTION_PIC is defined an init function will need    */</span>
<span class="line-removed">1099   /*    to be called with a pre-allocated structure to be filled.          */</span>
<span class="line-removed">1100   /*    When FT_CONFIG_OPTION_PIC is not defined the struct will be        */</span>
<span class="line-removed">1101   /*    allocated in the global scope (or the scope where the macro        */</span>
<span class="line-removed">1102   /*    is used).                                                          */</span>
<span class="line-removed">1103   /*                                                                       */</span>
<span class="line-removed">1104 #ifndef FT_CONFIG_OPTION_PIC</span>
1105 










1106 #define FT_DEFINE_RASTER_FUNCS(    \
1107           class_,                  \
1108           glyph_format_,           \
1109           raster_new_,             \
1110           raster_reset_,           \
1111           raster_set_mode_,        \
1112           raster_render_,          \
1113           raster_done_ )           \
1114   const FT_Raster_Funcs  class_ =  \
1115   {                                \
1116     glyph_format_,                 \
1117     raster_new_,                   \
1118     raster_reset_,                 \
1119     raster_set_mode_,              \
1120     raster_render_,                \
1121     raster_done_                   \
1122   };
1123 
<span class="line-removed">1124 #else /* FT_CONFIG_OPTION_PIC */</span>
<span class="line-removed">1125 </span>
<span class="line-removed">1126 #define FT_DEFINE_RASTER_FUNCS(                        \</span>
<span class="line-removed">1127           class_,                                      \</span>
<span class="line-removed">1128           glyph_format_,                               \</span>
<span class="line-removed">1129           raster_new_,                                 \</span>
<span class="line-removed">1130           raster_reset_,                               \</span>
<span class="line-removed">1131           raster_set_mode_,                            \</span>
<span class="line-removed">1132           raster_render_,                              \</span>
<span class="line-removed">1133           raster_done_ )                               \</span>
<span class="line-removed">1134   void                                                 \</span>
<span class="line-removed">1135   FT_Init_Class_ ## class_( FT_Raster_Funcs*  clazz )  \</span>
<span class="line-removed">1136   {                                                    \</span>
<span class="line-removed">1137     clazz-&gt;glyph_format    = glyph_format_;            \</span>
<span class="line-removed">1138     clazz-&gt;raster_new      = raster_new_;              \</span>
<span class="line-removed">1139     clazz-&gt;raster_reset    = raster_reset_;            \</span>
<span class="line-removed">1140     clazz-&gt;raster_set_mode = raster_set_mode_;         \</span>
<span class="line-removed">1141     clazz-&gt;raster_render   = raster_render_;           \</span>
<span class="line-removed">1142     clazz-&gt;raster_done     = raster_done_;             \</span>
<span class="line-removed">1143   }</span>
<span class="line-removed">1144 </span>
<span class="line-removed">1145 #endif /* FT_CONFIG_OPTION_PIC */</span>
1146 
1147 
<span class="line-modified">1148   /* PIC support macros for ftrender.h */</span>
<span class="line-modified">1149 </span>
<span class="line-modified">1150 </span>
<span class="line-modified">1151   /*************************************************************************/</span>
<span class="line-modified">1152   /*                                                                       */</span>
<span class="line-modified">1153   /* &lt;Macro&gt;                                                               */</span>
<span class="line-modified">1154   /*    FT_DEFINE_GLYPH                                                    */</span>
<span class="line-modified">1155   /*                                                                       */</span>
<span class="line-modified">1156   /* &lt;Description&gt;                                                         */</span>
<span class="line-removed">1157   /*    Used to initialize an instance of FT_Glyph_Class struct.           */</span>
<span class="line-removed">1158   /*    When FT_CONFIG_OPTION_PIC is defined an init function will need    */</span>
<span class="line-removed">1159   /*    to be called with a pre-allocated structure to be filled.          */</span>
<span class="line-removed">1160   /*    When FT_CONFIG_OPTION_PIC is not defined the struct will be        */</span>
<span class="line-removed">1161   /*    allocated in the global scope (or the scope where the macro        */</span>
<span class="line-removed">1162   /*    is used).                                                          */</span>
<span class="line-removed">1163   /*                                                                       */</span>
<span class="line-removed">1164 #ifndef FT_CONFIG_OPTION_PIC</span>
<span class="line-removed">1165 </span>
1166 #define FT_DEFINE_GLYPH(          \
1167           class_,                 \
1168           size_,                  \
1169           format_,                \
1170           init_,                  \
1171           done_,                  \
1172           copy_,                  \
1173           transform_,             \
1174           bbox_,                  \
1175           prepare_ )              \
1176   FT_CALLBACK_TABLE_DEF           \
1177   const FT_Glyph_Class  class_ =  \
1178   {                               \
1179     size_,                        \
1180     format_,                      \
1181     init_,                        \
1182     done_,                        \
1183     copy_,                        \
1184     transform_,                   \
1185     bbox_,                        \
1186     prepare_                      \
1187   };
1188 
<span class="line-removed">1189 #else /* FT_CONFIG_OPTION_PIC */</span>
<span class="line-removed">1190 </span>
<span class="line-removed">1191 #define FT_DEFINE_GLYPH(                              \</span>
<span class="line-removed">1192           class_,                                     \</span>
<span class="line-removed">1193           size_,                                      \</span>
<span class="line-removed">1194           format_,                                    \</span>
<span class="line-removed">1195           init_,                                      \</span>
<span class="line-removed">1196           done_,                                      \</span>
<span class="line-removed">1197           copy_,                                      \</span>
<span class="line-removed">1198           transform_,                                 \</span>
<span class="line-removed">1199           bbox_,                                      \</span>
<span class="line-removed">1200           prepare_ )                                  \</span>
<span class="line-removed">1201   void                                                \</span>
<span class="line-removed">1202   FT_Init_Class_ ## class_( FT_Glyph_Class*  clazz )  \</span>
<span class="line-removed">1203   {                                                   \</span>
<span class="line-removed">1204     clazz-&gt;glyph_size      = size_;                   \</span>
<span class="line-removed">1205     clazz-&gt;glyph_format    = format_;                 \</span>
<span class="line-removed">1206     clazz-&gt;glyph_init      = init_;                   \</span>
<span class="line-removed">1207     clazz-&gt;glyph_done      = done_;                   \</span>
<span class="line-removed">1208     clazz-&gt;glyph_copy      = copy_;                   \</span>
<span class="line-removed">1209     clazz-&gt;glyph_transform = transform_;              \</span>
<span class="line-removed">1210     clazz-&gt;glyph_bbox      = bbox_;                   \</span>
<span class="line-removed">1211     clazz-&gt;glyph_prepare   = prepare_;                \</span>
<span class="line-removed">1212   }</span>
<span class="line-removed">1213 </span>
<span class="line-removed">1214 #endif /* FT_CONFIG_OPTION_PIC */</span>
<span class="line-removed">1215 </span>
<span class="line-removed">1216 </span>
<span class="line-removed">1217   /*************************************************************************/</span>
<span class="line-removed">1218   /*                                                                       */</span>
<span class="line-removed">1219   /* &lt;Macro&gt;                                                               */</span>
<span class="line-removed">1220   /*    FT_DECLARE_RENDERER                                                */</span>
<span class="line-removed">1221   /*                                                                       */</span>
<span class="line-removed">1222   /* &lt;Description&gt;                                                         */</span>
<span class="line-removed">1223   /*    Used to create a forward declaration of a                          */</span>
<span class="line-removed">1224   /*    FT_Renderer_Class struct instance.                                 */</span>
<span class="line-removed">1225   /*                                                                       */</span>
<span class="line-removed">1226   /* &lt;Macro&gt;                                                               */</span>
<span class="line-removed">1227   /*    FT_DEFINE_RENDERER                                                 */</span>
<span class="line-removed">1228   /*                                                                       */</span>
<span class="line-removed">1229   /* &lt;Description&gt;                                                         */</span>
<span class="line-removed">1230   /*    Used to initialize an instance of FT_Renderer_Class struct.        */</span>
<span class="line-removed">1231   /*                                                                       */</span>
<span class="line-removed">1232   /*    When FT_CONFIG_OPTION_PIC is defined a `create&#39; function will      */</span>
<span class="line-removed">1233   /*    need to be called with a pointer where the allocated structure is  */</span>
<span class="line-removed">1234   /*    returned.  And when it is no longer needed a `destroy&#39; function    */</span>
<span class="line-removed">1235   /*    needs to be called to release that allocation.                     */</span>
<span class="line-removed">1236   /*    `ftinit.c&#39; (ft_create_default_module_classes) already contains     */</span>
<span class="line-removed">1237   /*    a mechanism to call these functions for the default modules        */</span>
<span class="line-removed">1238   /*    described in `ftmodule.h&#39;.                                         */</span>
<span class="line-removed">1239   /*                                                                       */</span>
<span class="line-removed">1240   /*    Notice that the created `create&#39; and `destroy&#39; functions call      */</span>
<span class="line-removed">1241   /*    `pic_init&#39; and `pic_free&#39; to allow you to manually allocate and    */</span>
<span class="line-removed">1242   /*    initialize any additional global data, like a module specific      */</span>
<span class="line-removed">1243   /*    interface, and put them in the global pic container defined in     */</span>
<span class="line-removed">1244   /*    `ftpic.h&#39;.  If you don&#39;t need them just implement the functions as */</span>
<span class="line-removed">1245   /*    empty to resolve the link error.  Also the `pic_init&#39; and          */</span>
<span class="line-removed">1246   /*    `pic_free&#39; functions should be declared in `pic.h&#39;, to be referred */</span>
<span class="line-removed">1247   /*    by the renderer definition calling `FT_DEFINE_RENDERER&#39; in the     */</span>
<span class="line-removed">1248   /*    following.                                                         */</span>
<span class="line-removed">1249   /*                                                                       */</span>
<span class="line-removed">1250   /*    When FT_CONFIG_OPTION_PIC is not defined the struct will be        */</span>
<span class="line-removed">1251   /*    allocated in the global scope (or the scope where the macro        */</span>
<span class="line-removed">1252   /*    is used).                                                          */</span>
<span class="line-removed">1253   /*                                                                       */</span>
<span class="line-removed">1254 #ifndef FT_CONFIG_OPTION_PIC</span>
1255 


















1256 #define FT_DECLARE_RENDERER( class_ )               \
1257   FT_EXPORT_VAR( const FT_Renderer_Class ) class_;
1258 
1259 #define FT_DEFINE_RENDERER(                  \
1260           class_,                            \
1261           flags_,                            \
1262           size_,                             \
1263           name_,                             \
1264           version_,                          \
1265           requires_,                         \
1266           interface_,                        \
1267           init_,                             \
1268           done_,                             \
1269           get_interface_,                    \
1270           glyph_format_,                     \
1271           render_glyph_,                     \
1272           transform_glyph_,                  \
1273           get_glyph_cbox_,                   \
1274           set_mode_,                         \
1275           raster_class_ )                    \
</pre>
<hr />
<pre>
1278   {                                          \
1279     FT_DEFINE_ROOT_MODULE( flags_,           \
1280                            size_,            \
1281                            name_,            \
1282                            version_,         \
1283                            requires_,        \
1284                            interface_,       \
1285                            init_,            \
1286                            done_,            \
1287                            get_interface_ )  \
1288     glyph_format_,                           \
1289                                              \
1290     render_glyph_,                           \
1291     transform_glyph_,                        \
1292     get_glyph_cbox_,                         \
1293     set_mode_,                               \
1294                                              \
1295     raster_class_                            \
1296   };
1297 
<span class="line-removed">1298 #else /* FT_CONFIG_OPTION_PIC */</span>
<span class="line-removed">1299 </span>
<span class="line-removed">1300 #define FT_DECLARE_RENDERER( class_ )  FT_DECLARE_MODULE( class_ )</span>
<span class="line-removed">1301 </span>
<span class="line-removed">1302 #define FT_DEFINE_RENDERER(                                      \</span>
<span class="line-removed">1303           class_,                                                \</span>
<span class="line-removed">1304           flags_,                                                \</span>
<span class="line-removed">1305           size_,                                                 \</span>
<span class="line-removed">1306           name_,                                                 \</span>
<span class="line-removed">1307           version_,                                              \</span>
<span class="line-removed">1308           requires_,                                             \</span>
<span class="line-removed">1309           interface_,                                            \</span>
<span class="line-removed">1310           init_,                                                 \</span>
<span class="line-removed">1311           done_,                                                 \</span>
<span class="line-removed">1312           get_interface_,                                        \</span>
<span class="line-removed">1313           glyph_format_,                                         \</span>
<span class="line-removed">1314           render_glyph_,                                         \</span>
<span class="line-removed">1315           transform_glyph_,                                      \</span>
<span class="line-removed">1316           get_glyph_cbox_,                                       \</span>
<span class="line-removed">1317           set_mode_,                                             \</span>
<span class="line-removed">1318           raster_class_ )                                        \</span>
<span class="line-removed">1319   void                                                           \</span>
<span class="line-removed">1320   FT_Destroy_Class_ ## class_( FT_Library        library,        \</span>
<span class="line-removed">1321                                FT_Module_Class*  clazz )         \</span>
<span class="line-removed">1322   {                                                              \</span>
<span class="line-removed">1323     FT_Renderer_Class*  rclazz = (FT_Renderer_Class*)clazz;      \</span>
<span class="line-removed">1324     FT_Memory           memory = library-&gt;memory;                \</span>
<span class="line-removed">1325                                                                  \</span>
<span class="line-removed">1326                                                                  \</span>
<span class="line-removed">1327     class_ ## _pic_free( library );                              \</span>
<span class="line-removed">1328     if ( rclazz )                                                \</span>
<span class="line-removed">1329       FT_FREE( rclazz );                                         \</span>
<span class="line-removed">1330   }                                                              \</span>
<span class="line-removed">1331                                                                  \</span>
<span class="line-removed">1332                                                                  \</span>
<span class="line-removed">1333   FT_Error                                                       \</span>
<span class="line-removed">1334   FT_Create_Class_ ## class_( FT_Library         library,        \</span>
<span class="line-removed">1335                               FT_Module_Class**  output_class )  \</span>
<span class="line-removed">1336   {                                                              \</span>
<span class="line-removed">1337     FT_Renderer_Class*  clazz = NULL;                            \</span>
<span class="line-removed">1338     FT_Error            error;                                   \</span>
<span class="line-removed">1339     FT_Memory           memory = library-&gt;memory;                \</span>
<span class="line-removed">1340                                                                  \</span>
<span class="line-removed">1341                                                                  \</span>
<span class="line-removed">1342     if ( FT_ALLOC( clazz, sizeof ( *clazz ) ) )                  \</span>
<span class="line-removed">1343       return error;                                              \</span>
<span class="line-removed">1344                                                                  \</span>
<span class="line-removed">1345     error = class_ ## _pic_init( library );                      \</span>
<span class="line-removed">1346     if ( error )                                                 \</span>
<span class="line-removed">1347     {                                                            \</span>
<span class="line-removed">1348       FT_FREE( clazz );                                          \</span>
<span class="line-removed">1349       return error;                                              \</span>
<span class="line-removed">1350     }                                                            \</span>
<span class="line-removed">1351                                                                  \</span>
<span class="line-removed">1352     FT_DEFINE_ROOT_MODULE( flags_,                               \</span>
<span class="line-removed">1353                            size_,                                \</span>
<span class="line-removed">1354                            name_,                                \</span>
<span class="line-removed">1355                            version_,                             \</span>
<span class="line-removed">1356                            requires_,                            \</span>
<span class="line-removed">1357                            interface_,                           \</span>
<span class="line-removed">1358                            init_,                                \</span>
<span class="line-removed">1359                            done_,                                \</span>
<span class="line-removed">1360                            get_interface_ )                      \</span>
<span class="line-removed">1361                                                                  \</span>
<span class="line-removed">1362     clazz-&gt;glyph_format    = glyph_format_;                      \</span>
<span class="line-removed">1363                                                                  \</span>
<span class="line-removed">1364     clazz-&gt;render_glyph    = render_glyph_;                      \</span>
<span class="line-removed">1365     clazz-&gt;transform_glyph = transform_glyph_;                   \</span>
<span class="line-removed">1366     clazz-&gt;get_glyph_cbox  = get_glyph_cbox_;                    \</span>
<span class="line-removed">1367     clazz-&gt;set_mode        = set_mode_;                          \</span>
<span class="line-removed">1368                                                                  \</span>
<span class="line-removed">1369     clazz-&gt;raster_class    = raster_class_;                      \</span>
<span class="line-removed">1370                                                                  \</span>
<span class="line-removed">1371     *output_class = (FT_Module_Class*)clazz;                     \</span>
<span class="line-removed">1372                                                                  \</span>
<span class="line-removed">1373     return FT_Err_Ok;                                            \</span>
<span class="line-removed">1374   }</span>
<span class="line-removed">1375 </span>
<span class="line-removed">1376 #endif /* FT_CONFIG_OPTION_PIC */</span>
<span class="line-removed">1377 </span>
<span class="line-removed">1378 </span>
<span class="line-removed">1379   /* PIC support macros for ftmodapi.h **/</span>
<span class="line-removed">1380 </span>
<span class="line-removed">1381 </span>
<span class="line-removed">1382 #ifdef FT_CONFIG_OPTION_PIC</span>
<span class="line-removed">1383 </span>
<span class="line-removed">1384   /*************************************************************************/</span>
<span class="line-removed">1385   /*                                                                       */</span>
<span class="line-removed">1386   /* &lt;FuncType&gt;                                                            */</span>
<span class="line-removed">1387   /*    FT_Module_Creator                                                  */</span>
<span class="line-removed">1388   /*                                                                       */</span>
<span class="line-removed">1389   /* &lt;Description&gt;                                                         */</span>
<span class="line-removed">1390   /*    A function used to create (allocate) a new module class object.    */</span>
<span class="line-removed">1391   /*    The object&#39;s members are initialized, but the module itself is     */</span>
<span class="line-removed">1392   /*    not.                                                               */</span>
<span class="line-removed">1393   /*                                                                       */</span>
<span class="line-removed">1394   /* &lt;Input&gt;                                                               */</span>
<span class="line-removed">1395   /*    memory       :: A handle to the memory manager.                    */</span>
<span class="line-removed">1396   /*    output_class :: Initialized with the newly allocated class.        */</span>
<span class="line-removed">1397   /*                                                                       */</span>
<span class="line-removed">1398   typedef FT_Error</span>
<span class="line-removed">1399   (*FT_Module_Creator)( FT_Memory          memory,</span>
<span class="line-removed">1400                         FT_Module_Class**  output_class );</span>
<span class="line-removed">1401 </span>
<span class="line-removed">1402   /*************************************************************************/</span>
<span class="line-removed">1403   /*                                                                       */</span>
<span class="line-removed">1404   /* &lt;FuncType&gt;                                                            */</span>
<span class="line-removed">1405   /*    FT_Module_Destroyer                                                */</span>
<span class="line-removed">1406   /*                                                                       */</span>
<span class="line-removed">1407   /* &lt;Description&gt;                                                         */</span>
<span class="line-removed">1408   /*    A function used to destroy (deallocate) a module class object.     */</span>
<span class="line-removed">1409   /*                                                                       */</span>
<span class="line-removed">1410   /* &lt;Input&gt;                                                               */</span>
<span class="line-removed">1411   /*    memory :: A handle to the memory manager.                          */</span>
<span class="line-removed">1412   /*    clazz  :: Module class to destroy.                                 */</span>
<span class="line-removed">1413   /*                                                                       */</span>
<span class="line-removed">1414   typedef void</span>
<span class="line-removed">1415   (*FT_Module_Destroyer)( FT_Memory         memory,</span>
<span class="line-removed">1416                           FT_Module_Class*  clazz );</span>
<span class="line-removed">1417 </span>
<span class="line-removed">1418 #endif</span>
<span class="line-removed">1419 </span>
<span class="line-removed">1420 </span>
<span class="line-removed">1421   /*************************************************************************/</span>
<span class="line-removed">1422   /*                                                                       */</span>
<span class="line-removed">1423   /* &lt;Macro&gt;                                                               */</span>
<span class="line-removed">1424   /*    FT_DECLARE_MODULE                                                  */</span>
<span class="line-removed">1425   /*                                                                       */</span>
<span class="line-removed">1426   /* &lt;Description&gt;                                                         */</span>
<span class="line-removed">1427   /*    Used to create a forward declaration of a                          */</span>
<span class="line-removed">1428   /*    FT_Module_Class struct instance.                                   */</span>
<span class="line-removed">1429   /*                                                                       */</span>
<span class="line-removed">1430   /* &lt;Macro&gt;                                                               */</span>
<span class="line-removed">1431   /*    FT_DEFINE_MODULE                                                   */</span>
<span class="line-removed">1432   /*                                                                       */</span>
<span class="line-removed">1433   /* &lt;Description&gt;                                                         */</span>
<span class="line-removed">1434   /*    Used to initialize an instance of an FT_Module_Class struct.       */</span>
<span class="line-removed">1435   /*                                                                       */</span>
<span class="line-removed">1436   /*    When FT_CONFIG_OPTION_PIC is defined a `create&#39; function needs     */</span>
<span class="line-removed">1437   /*    to be called with a pointer where the allocated structure is       */</span>
<span class="line-removed">1438   /*    returned.  And when it is no longer needed a `destroy&#39; function    */</span>
<span class="line-removed">1439   /*    needs to be called to release that allocation.                     */</span>
<span class="line-removed">1440   /*    `ftinit.c&#39; (ft_create_default_module_classes) already contains     */</span>
<span class="line-removed">1441   /*    a mechanism to call these functions for the default modules        */</span>
<span class="line-removed">1442   /*    described in `ftmodule.h&#39;.                                         */</span>
<span class="line-removed">1443   /*                                                                       */</span>
<span class="line-removed">1444   /*    Notice that the created `create&#39; and `destroy&#39; functions call      */</span>
<span class="line-removed">1445   /*    `pic_init&#39; and `pic_free&#39; to allow you to manually allocate and    */</span>
<span class="line-removed">1446   /*    initialize any additional global data, like a module specific      */</span>
<span class="line-removed">1447   /*    interface, and put them in the global pic container defined in     */</span>
<span class="line-removed">1448   /*    `ftpic.h&#39;.  If you don&#39;t need them just implement the functions as */</span>
<span class="line-removed">1449   /*    empty to resolve the link error.  Also the `pic_init&#39; and          */</span>
<span class="line-removed">1450   /*    `pic_free&#39; functions should be declared in `pic.h&#39;, to be referred */</span>
<span class="line-removed">1451   /*    by the module definition calling `FT_DEFINE_MODULE&#39; in the         */</span>
<span class="line-removed">1452   /*    following.                                                         */</span>
<span class="line-removed">1453   /*                                                                       */</span>
<span class="line-removed">1454   /*    When FT_CONFIG_OPTION_PIC is not defined the struct will be        */</span>
<span class="line-removed">1455   /*    allocated in the global scope (or the scope where the macro        */</span>
<span class="line-removed">1456   /*    is used).                                                          */</span>
<span class="line-removed">1457   /*                                                                       */</span>
<span class="line-removed">1458   /* &lt;Macro&gt;                                                               */</span>
<span class="line-removed">1459   /*    FT_DEFINE_ROOT_MODULE                                              */</span>
<span class="line-removed">1460   /*                                                                       */</span>
<span class="line-removed">1461   /* &lt;Description&gt;                                                         */</span>
<span class="line-removed">1462   /*    Used to initialize an instance of an FT_Module_Class struct inside */</span>
<span class="line-removed">1463   /*    another struct that contains it or in a function that initializes  */</span>
<span class="line-removed">1464   /*    that containing struct.                                            */</span>
<span class="line-removed">1465   /*                                                                       */</span>
<span class="line-removed">1466 #ifndef FT_CONFIG_OPTION_PIC</span>
1467 


























1468 #define FT_DECLARE_MODULE( class_ )  \
1469   FT_CALLBACK_TABLE                  \
1470   const FT_Module_Class  class_;
1471 
1472 #define FT_DEFINE_ROOT_MODULE(  \
1473           flags_,               \
1474           size_,                \
1475           name_,                \
1476           version_,             \
1477           requires_,            \
1478           interface_,           \
1479           init_,                \
1480           done_,                \
1481           get_interface_ )      \
1482   {                             \
1483     flags_,                     \
1484     size_,                      \
1485                                 \
1486     name_,                      \
1487     version_,                   \
</pre>
<hr />
<pre>
1506           done_,                  \
1507           get_interface_ )        \
1508   FT_CALLBACK_TABLE_DEF           \
1509   const FT_Module_Class class_ =  \
1510   {                               \
1511     flags_,                       \
1512     size_,                        \
1513                                   \
1514     name_,                        \
1515     version_,                     \
1516     requires_,                    \
1517                                   \
1518     interface_,                   \
1519                                   \
1520     init_,                        \
1521     done_,                        \
1522     get_interface_,               \
1523   };
1524 
1525 
<span class="line-removed">1526 #else /* FT_CONFIG_OPTION_PIC */</span>
<span class="line-removed">1527 </span>
<span class="line-removed">1528 #define FT_DECLARE_MODULE( class_ )                               \</span>
<span class="line-removed">1529   FT_Error                                                        \</span>
<span class="line-removed">1530   FT_Create_Class_ ## class_( FT_Library         library,         \</span>
<span class="line-removed">1531                               FT_Module_Class**  output_class );  \</span>
<span class="line-removed">1532   void                                                            \</span>
<span class="line-removed">1533   FT_Destroy_Class_ ## class_( FT_Library        library,         \</span>
<span class="line-removed">1534                                FT_Module_Class*  clazz );</span>
<span class="line-removed">1535 </span>
<span class="line-removed">1536 #define FT_DEFINE_ROOT_MODULE(                      \</span>
<span class="line-removed">1537           flags_,                                   \</span>
<span class="line-removed">1538           size_,                                    \</span>
<span class="line-removed">1539           name_,                                    \</span>
<span class="line-removed">1540           version_,                                 \</span>
<span class="line-removed">1541           requires_,                                \</span>
<span class="line-removed">1542           interface_,                               \</span>
<span class="line-removed">1543           init_,                                    \</span>
<span class="line-removed">1544           done_,                                    \</span>
<span class="line-removed">1545           get_interface_ )                          \</span>
<span class="line-removed">1546     clazz-&gt;root.module_flags     = flags_;          \</span>
<span class="line-removed">1547     clazz-&gt;root.module_size      = size_;           \</span>
<span class="line-removed">1548     clazz-&gt;root.module_name      = name_;           \</span>
<span class="line-removed">1549     clazz-&gt;root.module_version   = version_;        \</span>
<span class="line-removed">1550     clazz-&gt;root.module_requires  = requires_;       \</span>
<span class="line-removed">1551                                                     \</span>
<span class="line-removed">1552     clazz-&gt;root.module_interface = interface_;      \</span>
<span class="line-removed">1553                                                     \</span>
<span class="line-removed">1554     clazz-&gt;root.module_init      = init_;           \</span>
<span class="line-removed">1555     clazz-&gt;root.module_done      = done_;           \</span>
<span class="line-removed">1556     clazz-&gt;root.get_interface    = get_interface_;</span>
<span class="line-removed">1557 </span>
<span class="line-removed">1558 #define FT_DEFINE_MODULE(                                        \</span>
<span class="line-removed">1559           class_,                                                \</span>
<span class="line-removed">1560           flags_,                                                \</span>
<span class="line-removed">1561           size_,                                                 \</span>
<span class="line-removed">1562           name_,                                                 \</span>
<span class="line-removed">1563           version_,                                              \</span>
<span class="line-removed">1564           requires_,                                             \</span>
<span class="line-removed">1565           interface_,                                            \</span>
<span class="line-removed">1566           init_,                                                 \</span>
<span class="line-removed">1567           done_,                                                 \</span>
<span class="line-removed">1568           get_interface_ )                                       \</span>
<span class="line-removed">1569   void                                                           \</span>
<span class="line-removed">1570   FT_Destroy_Class_ ## class_( FT_Library        library,        \</span>
<span class="line-removed">1571                                FT_Module_Class*  clazz )         \</span>
<span class="line-removed">1572   {                                                              \</span>
<span class="line-removed">1573     FT_Memory memory = library-&gt;memory;                          \</span>
<span class="line-removed">1574                                                                  \</span>
<span class="line-removed">1575                                                                  \</span>
<span class="line-removed">1576     class_ ## _pic_free( library );                              \</span>
<span class="line-removed">1577     if ( clazz )                                                 \</span>
<span class="line-removed">1578       FT_FREE( clazz );                                          \</span>
<span class="line-removed">1579   }                                                              \</span>
<span class="line-removed">1580                                                                  \</span>
<span class="line-removed">1581                                                                  \</span>
<span class="line-removed">1582   FT_Error                                                       \</span>
<span class="line-removed">1583   FT_Create_Class_ ## class_( FT_Library         library,        \</span>
<span class="line-removed">1584                               FT_Module_Class**  output_class )  \</span>
<span class="line-removed">1585   {                                                              \</span>
<span class="line-removed">1586     FT_Memory         memory = library-&gt;memory;                  \</span>
<span class="line-removed">1587     FT_Module_Class*  clazz  = NULL;                             \</span>
<span class="line-removed">1588     FT_Error          error;                                     \</span>
<span class="line-removed">1589                                                                  \</span>
<span class="line-removed">1590                                                                  \</span>
<span class="line-removed">1591     if ( FT_ALLOC( clazz, sizeof ( *clazz ) ) )                  \</span>
<span class="line-removed">1592       return error;                                              \</span>
<span class="line-removed">1593     error = class_ ## _pic_init( library );                      \</span>
<span class="line-removed">1594     if ( error )                                                 \</span>
<span class="line-removed">1595     {                                                            \</span>
<span class="line-removed">1596       FT_FREE( clazz );                                          \</span>
<span class="line-removed">1597       return error;                                              \</span>
<span class="line-removed">1598     }                                                            \</span>
<span class="line-removed">1599                                                                  \</span>
<span class="line-removed">1600     clazz-&gt;module_flags     = flags_;                            \</span>
<span class="line-removed">1601     clazz-&gt;module_size      = size_;                             \</span>
<span class="line-removed">1602     clazz-&gt;module_name      = name_;                             \</span>
<span class="line-removed">1603     clazz-&gt;module_version   = version_;                          \</span>
<span class="line-removed">1604     clazz-&gt;module_requires  = requires_;                         \</span>
<span class="line-removed">1605                                                                  \</span>
<span class="line-removed">1606     clazz-&gt;module_interface = interface_;                        \</span>
<span class="line-removed">1607                                                                  \</span>
<span class="line-removed">1608     clazz-&gt;module_init      = init_;                             \</span>
<span class="line-removed">1609     clazz-&gt;module_done      = done_;                             \</span>
<span class="line-removed">1610     clazz-&gt;get_interface    = get_interface_;                    \</span>
<span class="line-removed">1611                                                                  \</span>
<span class="line-removed">1612     *output_class = clazz;                                       \</span>
<span class="line-removed">1613                                                                  \</span>
<span class="line-removed">1614     return FT_Err_Ok;                                            \</span>
<span class="line-removed">1615   }</span>
<span class="line-removed">1616 </span>
<span class="line-removed">1617 #endif /* FT_CONFIG_OPTION_PIC */</span>
<span class="line-removed">1618 </span>
<span class="line-removed">1619 </span>
1620 FT_END_HEADER
1621 
1622 #endif /* FTOBJS_H_ */
1623 
1624 
1625 /* END */
</pre>
</td>
<td>
<hr />
<pre>
<span class="line-modified">   1 /****************************************************************************</span>
<span class="line-modified">   2  *</span>
<span class="line-modified">   3  * ftobjs.h</span>
<span class="line-modified">   4  *</span>
<span class="line-modified">   5  *   The FreeType private base classes (specification).</span>
<span class="line-modified">   6  *</span>
<span class="line-modified">   7  * Copyright (C) 1996-2019 by</span>
<span class="line-modified">   8  * David Turner, Robert Wilhelm, and Werner Lemberg.</span>
<span class="line-modified">   9  *</span>
<span class="line-modified">  10  * This file is part of the FreeType project, and may only be used,</span>
<span class="line-modified">  11  * modified, and distributed under the terms of the FreeType project</span>
<span class="line-modified">  12  * license, LICENSE.TXT.  By continuing to use, modify, or distribute</span>
<span class="line-modified">  13  * this file you indicate that you have read the license and</span>
<span class="line-modified">  14  * understand and accept it fully.</span>
<span class="line-modified">  15  *</span>
<span class="line-modified">  16  */</span>
<span class="line-modified">  17 </span>
<span class="line-modified">  18 </span>
<span class="line-modified">  19   /**************************************************************************</span>
<span class="line-modified">  20    *</span>
<span class="line-modified">  21    * This file contains the definition of all internal FreeType classes.</span>
<span class="line-modified">  22    *</span>
<span class="line-modified">  23    */</span>
  24 
  25 
  26 #ifndef FTOBJS_H_
  27 #define FTOBJS_H_
  28 
  29 #include &lt;ft2build.h&gt;
  30 #include FT_RENDER_H
  31 #include FT_SIZES_H
  32 #include FT_LCD_FILTER_H
  33 #include FT_INTERNAL_MEMORY_H
  34 #include FT_INTERNAL_GLYPH_LOADER_H
  35 #include FT_INTERNAL_DRIVER_H
  36 #include FT_INTERNAL_AUTOHINT_H
  37 #include FT_INTERNAL_SERVICE_H

  38 #include FT_INTERNAL_CALC_H
  39 
  40 #ifdef FT_CONFIG_OPTION_INCREMENTAL
  41 #include FT_INCREMENTAL_H
  42 #endif
  43 
  44 
  45 FT_BEGIN_HEADER
  46 
  47 
<span class="line-modified">  48   /**************************************************************************</span>
<span class="line-modified">  49    *</span>
<span class="line-modified">  50    * Some generic definitions.</span>
<span class="line-modified">  51    */</span>
  52 #ifndef TRUE
  53 #define TRUE  1
  54 #endif
  55 
  56 #ifndef FALSE
  57 #define FALSE  0
  58 #endif
  59 
  60 #ifndef NULL
  61 #define NULL  (void*)0
  62 #endif
  63 
  64 
<span class="line-modified">  65   /**************************************************************************</span>
<span class="line-modified">  66    *</span>
<span class="line-modified">  67    * The min and max functions missing in C.  As usual, be careful not to</span>
<span class="line-modified">  68    * write things like FT_MIN( a++, b++ ) to avoid side effects.</span>
<span class="line-modified">  69    */</span>
  70 #define FT_MIN( a, b )  ( (a) &lt; (b) ? (a) : (b) )
  71 #define FT_MAX( a, b )  ( (a) &gt; (b) ? (a) : (b) )
  72 
  73 #define FT_ABS( a )     ( (a) &lt; 0 ? -(a) : (a) )
  74 
  75   /*
<span class="line-modified">  76    * Approximate sqrt(x*x+y*y) using the `alpha max plus beta min&#39; algorithm.</span>
<span class="line-modified">  77    * We use alpha = 1, beta = 3/8, giving us results with a largest error</span>
<span class="line-modified">  78    * less than 7% compared to the exact value.</span>
  79    */
  80 #define FT_HYPOT( x, y )                 \
  81           ( x = FT_ABS( x ),             \
  82             y = FT_ABS( y ),             \
  83             x &gt; y ? x + ( 3 * y &gt;&gt; 3 )   \
  84                   : y + ( 3 * x &gt;&gt; 3 ) )
  85 
  86   /* we use FT_TYPEOF to suppress signedness compilation warnings */
  87 #define FT_PAD_FLOOR( x, n )  ( (x) &amp; ~FT_TYPEOF( x )( (n) - 1 ) )
  88 #define FT_PAD_ROUND( x, n )  FT_PAD_FLOOR( (x) + (n) / 2, n )
  89 #define FT_PAD_CEIL( x, n )   FT_PAD_FLOOR( (x) + (n) - 1, n )
  90 
  91 #define FT_PIX_FLOOR( x )     ( (x) &amp; ~FT_TYPEOF( x )63 )
  92 #define FT_PIX_ROUND( x )     FT_PIX_FLOOR( (x) + 32 )
  93 #define FT_PIX_CEIL( x )      FT_PIX_FLOOR( (x) + 63 )
  94 
  95   /* specialized versions (for signed values)                   */
  96   /* that don&#39;t produce run-time errors due to integer overflow */
  97 #define FT_PAD_ROUND_LONG( x, n )  FT_PAD_FLOOR( ADD_LONG( (x), (n) / 2 ), \
  98                                                  n )
  99 #define FT_PAD_CEIL_LONG( x, n )   FT_PAD_FLOOR( ADD_LONG( (x), (n) - 1 ), \
 100                                                  n )
 101 #define FT_PIX_ROUND_LONG( x )     FT_PIX_FLOOR( ADD_LONG( (x), 32 ) )
 102 #define FT_PIX_CEIL_LONG( x )      FT_PIX_FLOOR( ADD_LONG( (x), 63 ) )
 103 
 104 #define FT_PAD_ROUND_INT32( x, n )  FT_PAD_FLOOR( ADD_INT32( (x), (n) / 2 ), \
 105                                                   n )
 106 #define FT_PAD_CEIL_INT32( x, n )   FT_PAD_FLOOR( ADD_INT32( (x), (n) - 1 ), \
 107                                                   n )
 108 #define FT_PIX_ROUND_INT32( x )     FT_PIX_FLOOR( ADD_INT32( (x), 32 ) )
 109 #define FT_PIX_CEIL_INT32( x )      FT_PIX_FLOOR( ADD_INT32( (x), 63 ) )
 110 
 111 
 112   /*
<span class="line-modified"> 113    * character classification functions -- since these are used to parse font</span>
<span class="line-modified"> 114    * files, we must not use those in &lt;ctypes.h&gt; which are locale-dependent</span>

 115    */
 116 #define  ft_isdigit( x )   ( ( (unsigned)(x) - &#39;0&#39; ) &lt; 10U )
 117 
 118 #define  ft_isxdigit( x )  ( ( (unsigned)(x) - &#39;0&#39; ) &lt; 10U || \
 119                              ( (unsigned)(x) - &#39;a&#39; ) &lt; 6U  || \
 120                              ( (unsigned)(x) - &#39;A&#39; ) &lt; 6U  )
 121 
 122   /* the next two macros assume ASCII representation */
 123 #define  ft_isupper( x )  ( ( (unsigned)(x) - &#39;A&#39; ) &lt; 26U )
 124 #define  ft_islower( x )  ( ( (unsigned)(x) - &#39;a&#39; ) &lt; 26U )
 125 
 126 #define  ft_isalpha( x )  ( ft_isupper( x ) || ft_islower( x ) )
 127 #define  ft_isalnum( x )  ( ft_isdigit( x ) || ft_isalpha( x ) )
 128 
 129 
 130   /*************************************************************************/
 131   /*************************************************************************/
 132   /*************************************************************************/
 133   /****                                                                 ****/
 134   /****                                                                 ****/
</pre>
<hr />
<pre>
 168   (*FT_CMap_InitFunc)( FT_CMap     cmap,
 169                        FT_Pointer  init_data );
 170 
 171   typedef void
 172   (*FT_CMap_DoneFunc)( FT_CMap  cmap );
 173 
 174   typedef FT_UInt
 175   (*FT_CMap_CharIndexFunc)( FT_CMap    cmap,
 176                             FT_UInt32  char_code );
 177 
 178   typedef FT_UInt
 179   (*FT_CMap_CharNextFunc)( FT_CMap     cmap,
 180                            FT_UInt32  *achar_code );
 181 
 182   typedef FT_UInt
 183   (*FT_CMap_CharVarIndexFunc)( FT_CMap    cmap,
 184                                FT_CMap    unicode_cmap,
 185                                FT_UInt32  char_code,
 186                                FT_UInt32  variant_selector );
 187 
<span class="line-modified"> 188   typedef FT_Int</span>
 189   (*FT_CMap_CharVarIsDefaultFunc)( FT_CMap    cmap,
 190                                    FT_UInt32  char_code,
 191                                    FT_UInt32  variant_selector );
 192 
 193   typedef FT_UInt32 *
 194   (*FT_CMap_VariantListFunc)( FT_CMap    cmap,
 195                               FT_Memory  mem );
 196 
 197   typedef FT_UInt32 *
 198   (*FT_CMap_CharVariantListFunc)( FT_CMap    cmap,
 199                                   FT_Memory  mem,
 200                                   FT_UInt32  char_code );
 201 
 202   typedef FT_UInt32 *
 203   (*FT_CMap_VariantCharListFunc)( FT_CMap    cmap,
 204                                   FT_Memory  mem,
 205                                   FT_UInt32  variant_selector );
 206 
 207 
 208   typedef struct  FT_CMap_ClassRec_
 209   {
 210     FT_ULong               size;
 211 
 212     FT_CMap_InitFunc       init;
 213     FT_CMap_DoneFunc       done;
 214     FT_CMap_CharIndexFunc  char_index;
 215     FT_CMap_CharNextFunc   char_next;
 216 
 217     /* Subsequent entries are special ones for format 14 -- the variant */
 218     /* selector subtable which behaves like no other                    */
 219 
 220     FT_CMap_CharVarIndexFunc      char_var_index;
 221     FT_CMap_CharVarIsDefaultFunc  char_var_default;
 222     FT_CMap_VariantListFunc       variant_list;
 223     FT_CMap_CharVariantListFunc   charvariant_list;
 224     FT_CMap_VariantCharListFunc   variantchar_list;
 225 
 226   } FT_CMap_ClassRec;
 227 
 228 


 229 #define FT_DECLARE_CMAP_CLASS( class_ )              \
 230   FT_CALLBACK_TABLE const  FT_CMap_ClassRec class_;
 231 
 232 #define FT_DEFINE_CMAP_CLASS(       \
 233           class_,                   \
 234           size_,                    \
 235           init_,                    \
 236           done_,                    \
 237           char_index_,              \
 238           char_next_,               \
 239           char_var_index_,          \
 240           char_var_default_,        \
 241           variant_list_,            \
 242           charvariant_list_,        \
 243           variantchar_list_ )       \
 244   FT_CALLBACK_TABLE_DEF             \
 245   const FT_CMap_ClassRec  class_ =  \
 246   {                                 \
 247     size_,                          \
 248     init_,                          \
 249     done_,                          \
 250     char_index_,                    \
 251     char_next_,                     \
 252     char_var_index_,                \
 253     char_var_default_,              \
 254     variant_list_,                  \
 255     charvariant_list_,              \
 256     variantchar_list_               \
 257   };
 258 







































 259 
 260   /* create a new charmap and add it to charmap-&gt;face */
 261   FT_BASE( FT_Error )
 262   FT_CMap_New( FT_CMap_Class  clazz,
 263                FT_Pointer     init_data,
 264                FT_CharMap     charmap,
 265                FT_CMap       *acmap );
 266 
 267   /* destroy a charmap and remove it from face&#39;s list */
 268   FT_BASE( void )
 269   FT_CMap_Done( FT_CMap  cmap );
 270 
 271 
<span class="line-modified"> 272   /* add LCD padding to CBox */</span>
 273   FT_BASE( void )
<span class="line-modified"> 274   ft_lcd_padding( FT_BBox*        cbox,</span>
<span class="line-modified"> 275                   FT_GlyphSlot    slot,</span>
<span class="line-modified"> 276                   FT_Render_Mode  mode );</span>
 277 
 278 #ifdef FT_CONFIG_OPTION_SUBPIXEL_RENDERING
 279 
 280   typedef void  (*FT_Bitmap_LcdFilterFunc)( FT_Bitmap*      bitmap,

 281                                             FT_Byte*        weights );
 282 
 283 
 284   /* This is the default LCD filter, an in-place, 5-tap FIR filter. */
 285   FT_BASE( void )
 286   ft_lcd_filter_fir( FT_Bitmap*           bitmap,

 287                      FT_LcdFiveTapFilter  weights );
 288 
 289 #endif /* FT_CONFIG_OPTION_SUBPIXEL_RENDERING */
 290 
<span class="line-modified"> 291   /**************************************************************************</span>
<span class="line-modified"> 292    *</span>
<span class="line-modified"> 293    * @struct:</span>
<span class="line-modified"> 294    *   FT_Face_InternalRec</span>
<span class="line-modified"> 295    *</span>
<span class="line-modified"> 296    * @description:</span>
<span class="line-modified"> 297    *   This structure contains the internal fields of each FT_Face object.</span>
<span class="line-modified"> 298    *   These fields may change between different releases of FreeType.</span>
<span class="line-modified"> 299    *</span>
<span class="line-modified"> 300    * @fields:</span>
<span class="line-modified"> 301    *   max_points ::</span>
<span class="line-modified"> 302    *     The maximum number of points used to store the vectorial outline of</span>
<span class="line-modified"> 303    *     any glyph in this face.  If this value cannot be known in advance,</span>
<span class="line-modified"> 304    *     or if the face isn&#39;t scalable, this should be set to 0.  Only</span>
<span class="line-modified"> 305    *     relevant for scalable formats.</span>
<span class="line-modified"> 306    *</span>
<span class="line-modified"> 307    *   max_contours ::</span>
<span class="line-modified"> 308    *     The maximum number of contours used to store the vectorial outline</span>
<span class="line-modified"> 309    *     of any glyph in this face.  If this value cannot be known in</span>
<span class="line-modified"> 310    *     advance, or if the face isn&#39;t scalable, this should be set to 0.</span>
<span class="line-modified"> 311    *     Only relevant for scalable formats.</span>
<span class="line-modified"> 312    *</span>
<span class="line-modified"> 313    *   transform_matrix ::</span>
<span class="line-modified"> 314    *     A 2x2 matrix of 16.16 coefficients used to transform glyph outlines</span>
<span class="line-modified"> 315    *     after they are loaded from the font.  Only used by the convenience</span>
<span class="line-modified"> 316    *     functions.</span>
<span class="line-modified"> 317    *</span>
<span class="line-modified"> 318    *   transform_delta ::</span>
<span class="line-modified"> 319    *     A translation vector used to transform glyph outlines after they are</span>
<span class="line-modified"> 320    *     loaded from the font.  Only used by the convenience functions.</span>
<span class="line-modified"> 321    *</span>
<span class="line-modified"> 322    *   transform_flags ::</span>
<span class="line-modified"> 323    *     Some flags used to classify the transform.  Only used by the</span>
<span class="line-modified"> 324    *     convenience functions.</span>
<span class="line-modified"> 325    *</span>
<span class="line-modified"> 326    *   services ::</span>
<span class="line-modified"> 327    *     A cache for frequently used services.  It should be only accessed</span>
<span class="line-modified"> 328    *     with the macro `FT_FACE_LOOKUP_SERVICE`.</span>
<span class="line-modified"> 329    *</span>
<span class="line-modified"> 330    *   incremental_interface ::</span>
<span class="line-modified"> 331    *     If non-null, the interface through which glyph data and metrics are</span>
<span class="line-modified"> 332    *     loaded incrementally for faces that do not provide all of this data</span>
<span class="line-modified"> 333    *     when first opened.  This field exists only if</span>
<span class="line-modified"> 334    *     @FT_CONFIG_OPTION_INCREMENTAL is defined.</span>
<span class="line-modified"> 335    *</span>
<span class="line-modified"> 336    *   no_stem_darkening ::</span>
<span class="line-modified"> 337    *     Overrides the module-level default, see @stem-darkening[cff], for</span>
<span class="line-modified"> 338    *     example.  FALSE and TRUE toggle stem darkening on and off,</span>
<span class="line-modified"> 339    *     respectively, value~-1 means to use the module/driver default.</span>
<span class="line-modified"> 340    *</span>
<span class="line-modified"> 341    *   random_seed ::</span>
<span class="line-modified"> 342    *     If positive, override the seed value for the CFF &#39;random&#39; operator.</span>
<span class="line-modified"> 343    *     Value~0 means to use the font&#39;s value.  Value~-1 means to use the</span>
<span class="line-modified"> 344    *     CFF driver&#39;s default.</span>
<span class="line-modified"> 345    *</span>
<span class="line-modified"> 346    *   lcd_weights ::</span>
<span class="line-modified"> 347    *   lcd_filter_func ::</span>
<span class="line-modified"> 348    *     These fields specify the LCD filtering weights and callback function</span>
<span class="line-modified"> 349    *     for ClearType-style subpixel rendering.</span>
<span class="line-modified"> 350    *</span>
<span class="line-modified"> 351    *   refcount ::</span>
<span class="line-modified"> 352    *     A counter initialized to~1 at the time an @FT_Face structure is</span>
<span class="line-modified"> 353    *     created.  @FT_Reference_Face increments this counter, and</span>
<span class="line-modified"> 354    *     @FT_Done_Face only destroys a face if the counter is~1, otherwise it</span>
<span class="line-modified"> 355    *     simply decrements it.</span>
<span class="line-modified"> 356    */</span>


 357   typedef struct  FT_Face_InternalRec_
 358   {
 359     FT_Matrix  transform_matrix;
 360     FT_Vector  transform_delta;
 361     FT_Int     transform_flags;
 362 
 363     FT_ServiceCacheRec  services;
 364 
 365 #ifdef FT_CONFIG_OPTION_INCREMENTAL
 366     FT_Incremental_InterfaceRec*  incremental_interface;
 367 #endif
 368 
 369     FT_Char              no_stem_darkening;
 370     FT_Int32             random_seed;
 371 
 372 #ifdef FT_CONFIG_OPTION_SUBPIXEL_RENDERING
 373     FT_LcdFiveTapFilter      lcd_weights;      /* filter weights, if any */
 374     FT_Bitmap_LcdFilterFunc  lcd_filter_func;  /* filtering callback     */
 375 #endif
 376 
 377     FT_Int  refcount;
 378 
 379   } FT_Face_InternalRec;
 380 
 381 
<span class="line-modified"> 382   /**************************************************************************</span>
<span class="line-modified"> 383    *</span>
<span class="line-modified"> 384    * @struct:</span>
<span class="line-modified"> 385    *   FT_Slot_InternalRec</span>
<span class="line-modified"> 386    *</span>
<span class="line-modified"> 387    * @description:</span>
<span class="line-modified"> 388    *   This structure contains the internal fields of each FT_GlyphSlot</span>
<span class="line-modified"> 389    *   object.  These fields may change between different releases of</span>
<span class="line-modified"> 390    *   FreeType.</span>
<span class="line-modified"> 391    *</span>
<span class="line-modified"> 392    * @fields:</span>
<span class="line-modified"> 393    *   loader ::</span>
<span class="line-modified"> 394    *     The glyph loader object used to load outlines into the glyph slot.</span>
<span class="line-modified"> 395    *</span>
<span class="line-modified"> 396    *   flags ::</span>
<span class="line-modified"> 397    *     Possible values are zero or FT_GLYPH_OWN_BITMAP.  The latter</span>
<span class="line-modified"> 398    *     indicates that the FT_GlyphSlot structure owns the bitmap buffer.</span>
<span class="line-modified"> 399    *</span>
<span class="line-modified"> 400    *   glyph_transformed ::</span>
<span class="line-modified"> 401    *     Boolean.  Set to TRUE when the loaded glyph must be transformed</span>
<span class="line-modified"> 402    *     through a specific font transformation.  This is _not_ the same as</span>
<span class="line-modified"> 403    *     the face transform set through FT_Set_Transform().</span>
<span class="line-modified"> 404    *</span>
<span class="line-modified"> 405    *   glyph_matrix ::</span>
<span class="line-modified"> 406    *     The 2x2 matrix corresponding to the glyph transformation, if</span>
<span class="line-modified"> 407    *     necessary.</span>
<span class="line-modified"> 408    *</span>
<span class="line-modified"> 409    *   glyph_delta ::</span>
<span class="line-modified"> 410    *     The 2d translation vector corresponding to the glyph transformation,</span>
<span class="line-modified"> 411    *     if necessary.</span>
<span class="line-modified"> 412    *</span>
<span class="line-modified"> 413    *   glyph_hints ::</span>
<span class="line-modified"> 414    *     Format-specific glyph hints management.</span>
<span class="line-added"> 415    *</span>
<span class="line-added"> 416    *   load_flags ::</span>
<span class="line-added"> 417    *     The load flags passed as an argument to @FT_Load_Glyph while</span>
<span class="line-added"> 418    *     initializing the glyph slot.</span>
<span class="line-added"> 419    */</span>
 420 
 421 #define FT_GLYPH_OWN_BITMAP  0x1U
 422 
 423   typedef struct  FT_Slot_InternalRec_
 424   {
 425     FT_GlyphLoader  loader;
 426     FT_UInt         flags;
 427     FT_Bool         glyph_transformed;
 428     FT_Matrix       glyph_matrix;
 429     FT_Vector       glyph_delta;
 430     void*           glyph_hints;
 431 
<span class="line-added"> 432     FT_Int32        load_flags;</span>
<span class="line-added"> 433 </span>
 434   } FT_GlyphSlot_InternalRec;
 435 
 436 
<span class="line-modified"> 437   /**************************************************************************</span>
<span class="line-modified"> 438    *</span>
<span class="line-modified"> 439    * @struct:</span>
<span class="line-modified"> 440    *   FT_Size_InternalRec</span>
<span class="line-modified"> 441    *</span>
<span class="line-modified"> 442    * @description:</span>
<span class="line-modified"> 443    *   This structure contains the internal fields of each FT_Size object.</span>
<span class="line-modified"> 444    *</span>
<span class="line-modified"> 445    * @fields:</span>
<span class="line-modified"> 446    *   module_data ::</span>
<span class="line-modified"> 447    *     Data specific to a driver module.</span>
<span class="line-modified"> 448    *</span>
<span class="line-modified"> 449    *   autohint_mode ::</span>
<span class="line-modified"> 450    *     The used auto-hinting mode.</span>
<span class="line-modified"> 451    *</span>
<span class="line-modified"> 452    *   autohint_metrics ::</span>
<span class="line-modified"> 453    *     Metrics used by the auto-hinter.</span>
<span class="line-added"> 454    *</span>
<span class="line-added"> 455    */</span>
 456 
 457   typedef struct  FT_Size_InternalRec_
 458   {
 459     void*  module_data;
 460 
 461     FT_Render_Mode   autohint_mode;
 462     FT_Size_Metrics  autohint_metrics;
 463 
 464   } FT_Size_InternalRec;
 465 
 466 
 467   /*************************************************************************/
 468   /*************************************************************************/
 469   /*************************************************************************/
 470   /****                                                                 ****/
 471   /****                                                                 ****/
 472   /****                         M O D U L E S                           ****/
 473   /****                                                                 ****/
 474   /****                                                                 ****/
 475   /*************************************************************************/
 476   /*************************************************************************/
 477   /*************************************************************************/
 478 
 479 
<span class="line-modified"> 480   /**************************************************************************</span>
<span class="line-modified"> 481    *</span>
<span class="line-modified"> 482    * @struct:</span>
<span class="line-modified"> 483    *   FT_ModuleRec</span>
<span class="line-modified"> 484    *</span>
<span class="line-modified"> 485    * @description:</span>
<span class="line-modified"> 486    *   A module object instance.</span>
<span class="line-modified"> 487    *</span>
<span class="line-modified"> 488    * @fields:</span>
<span class="line-modified"> 489    *   clazz ::</span>
<span class="line-modified"> 490    *     A pointer to the module&#39;s class.</span>
<span class="line-modified"> 491    *</span>
<span class="line-modified"> 492    *   library ::</span>
<span class="line-modified"> 493    *     A handle to the parent library object.</span>
<span class="line-modified"> 494    *</span>
<span class="line-added"> 495    *   memory ::</span>
<span class="line-added"> 496    *     A handle to the memory manager.</span>
<span class="line-added"> 497    */</span>
 498   typedef struct  FT_ModuleRec_
 499   {
 500     FT_Module_Class*  clazz;
 501     FT_Library        library;
 502     FT_Memory         memory;
 503 
 504   } FT_ModuleRec;
 505 
 506 
 507   /* typecast an object to an FT_Module */
 508 #define FT_MODULE( x )  ( (FT_Module)(x) )
 509 
 510 #define FT_MODULE_CLASS( x )    FT_MODULE( x )-&gt;clazz
 511 #define FT_MODULE_LIBRARY( x )  FT_MODULE( x )-&gt;library
 512 #define FT_MODULE_MEMORY( x )   FT_MODULE( x )-&gt;memory
 513 
 514 
 515 #define FT_MODULE_IS_DRIVER( x )  ( FT_MODULE_CLASS( x )-&gt;module_flags &amp; \
 516                                     FT_MODULE_FONT_DRIVER )
 517 
</pre>
<hr />
<pre>
 520 
 521 #define FT_MODULE_IS_HINTER( x )  ( FT_MODULE_CLASS( x )-&gt;module_flags &amp; \
 522                                     FT_MODULE_HINTER )
 523 
 524 #define FT_MODULE_IS_STYLER( x )  ( FT_MODULE_CLASS( x )-&gt;module_flags &amp; \
 525                                     FT_MODULE_STYLER )
 526 
 527 #define FT_DRIVER_IS_SCALABLE( x )  ( FT_MODULE_CLASS( x )-&gt;module_flags &amp; \
 528                                       FT_MODULE_DRIVER_SCALABLE )
 529 
 530 #define FT_DRIVER_USES_OUTLINES( x )  !( FT_MODULE_CLASS( x )-&gt;module_flags &amp; \
 531                                          FT_MODULE_DRIVER_NO_OUTLINES )
 532 
 533 #define FT_DRIVER_HAS_HINTER( x )  ( FT_MODULE_CLASS( x )-&gt;module_flags &amp; \
 534                                      FT_MODULE_DRIVER_HAS_HINTER )
 535 
 536 #define FT_DRIVER_HINTS_LIGHTLY( x )  ( FT_MODULE_CLASS( x )-&gt;module_flags &amp; \
 537                                         FT_MODULE_DRIVER_HINTS_LIGHTLY )
 538 
 539 
<span class="line-modified"> 540   /**************************************************************************</span>
<span class="line-modified"> 541    *</span>
<span class="line-modified"> 542    * @function:</span>
<span class="line-modified"> 543    *   FT_Get_Module_Interface</span>
<span class="line-modified"> 544    *</span>
<span class="line-modified"> 545    * @description:</span>
<span class="line-modified"> 546    *   Finds a module and returns its specific interface as a typeless</span>
<span class="line-modified"> 547    *   pointer.</span>
<span class="line-modified"> 548    *</span>
<span class="line-modified"> 549    * @input:</span>
<span class="line-modified"> 550    *   library ::</span>
<span class="line-modified"> 551    *     A handle to the library object.</span>
<span class="line-modified"> 552    *</span>
<span class="line-modified"> 553    *   module_name ::</span>
<span class="line-modified"> 554    *     The module&#39;s name (as an ASCII string).</span>
<span class="line-modified"> 555    *</span>
<span class="line-modified"> 556    * @return:</span>
<span class="line-modified"> 557    *   A module-specific interface if available, 0 otherwise.</span>
<span class="line-modified"> 558    *</span>
<span class="line-modified"> 559    * @note:</span>
<span class="line-modified"> 560    *   You should better be familiar with FreeType internals to know which</span>
<span class="line-added"> 561    *   module to look for, and what its interface is :-)</span>
<span class="line-added"> 562    */</span>
 563   FT_BASE( const void* )
 564   FT_Get_Module_Interface( FT_Library   library,
 565                            const char*  mod_name );
 566 
 567   FT_BASE( FT_Pointer )
 568   ft_module_get_service( FT_Module    module,
 569                          const char*  service_id,
 570                          FT_Bool      global );
 571 
 572 #ifdef FT_CONFIG_OPTION_ENVIRONMENT_PROPERTIES
 573   FT_BASE( FT_Error )
 574   ft_property_string_set( FT_Library        library,
 575                           const FT_String*  module_name,
 576                           const FT_String*  property_name,
 577                           FT_String*        value );
 578 #endif
 579 
 580   /* */
 581 
 582 
</pre>
<hr />
<pre>
 593   /*************************************************************************/
 594 
 595   /* a few macros used to perform easy typecasts with minimal brain damage */
 596 
 597 #define FT_FACE( x )          ( (FT_Face)(x) )
 598 #define FT_SIZE( x )          ( (FT_Size)(x) )
 599 #define FT_SLOT( x )          ( (FT_GlyphSlot)(x) )
 600 
 601 #define FT_FACE_DRIVER( x )   FT_FACE( x )-&gt;driver
 602 #define FT_FACE_LIBRARY( x )  FT_FACE_DRIVER( x )-&gt;root.library
 603 #define FT_FACE_MEMORY( x )   FT_FACE( x )-&gt;memory
 604 #define FT_FACE_STREAM( x )   FT_FACE( x )-&gt;stream
 605 
 606 #define FT_SIZE_FACE( x )     FT_SIZE( x )-&gt;face
 607 #define FT_SLOT_FACE( x )     FT_SLOT( x )-&gt;face
 608 
 609 #define FT_FACE_SLOT( x )     FT_FACE( x )-&gt;glyph
 610 #define FT_FACE_SIZE( x )     FT_FACE( x )-&gt;size
 611 
 612 
<span class="line-modified"> 613   /**************************************************************************</span>
<span class="line-modified"> 614    *</span>
<span class="line-modified"> 615    * @function:</span>
<span class="line-modified"> 616    *   FT_New_GlyphSlot</span>
<span class="line-modified"> 617    *</span>
<span class="line-modified"> 618    * @description:</span>
<span class="line-modified"> 619    *   It is sometimes useful to have more than one glyph slot for a given</span>
<span class="line-modified"> 620    *   face object.  This function is used to create additional slots.  All</span>
<span class="line-modified"> 621    *   of them are automatically discarded when the face is destroyed.</span>
<span class="line-modified"> 622    *</span>
<span class="line-modified"> 623    * @input:</span>
<span class="line-modified"> 624    *   face ::</span>
<span class="line-modified"> 625    *     A handle to a parent face object.</span>
<span class="line-modified"> 626    *</span>
<span class="line-modified"> 627    * @output:</span>
<span class="line-modified"> 628    *   aslot ::</span>
<span class="line-modified"> 629    *     A handle to a new glyph slot object.</span>
<span class="line-modified"> 630    *</span>
<span class="line-modified"> 631    * @return:</span>
<span class="line-modified"> 632    *   FreeType error code.  0 means success.</span>
<span class="line-added"> 633    */</span>
 634   FT_BASE( FT_Error )
 635   FT_New_GlyphSlot( FT_Face        face,
 636                     FT_GlyphSlot  *aslot );
 637 
 638 
<span class="line-modified"> 639   /**************************************************************************</span>
<span class="line-modified"> 640    *</span>
<span class="line-modified"> 641    * @function:</span>
<span class="line-modified"> 642    *   FT_Done_GlyphSlot</span>
<span class="line-modified"> 643    *</span>
<span class="line-modified"> 644    * @description:</span>
<span class="line-modified"> 645    *   Destroys a given glyph slot.  Remember however that all slots are</span>
<span class="line-modified"> 646    *   automatically destroyed with its parent.  Using this function is not</span>
<span class="line-modified"> 647    *   always mandatory.</span>
<span class="line-modified"> 648    *</span>
<span class="line-modified"> 649    * @input:</span>
<span class="line-modified"> 650    *   slot ::</span>
<span class="line-modified"> 651    *     A handle to a target glyph slot.</span>
<span class="line-added"> 652    */</span>
 653   FT_BASE( void )
 654   FT_Done_GlyphSlot( FT_GlyphSlot  slot );
 655 
 656  /* */
 657 
 658 #define FT_REQUEST_WIDTH( req )                                            \
 659           ( (req)-&gt;horiResolution                                          \
 660               ? ( (req)-&gt;width * (FT_Pos)(req)-&gt;horiResolution + 36 ) / 72 \
 661               : (req)-&gt;width )
 662 
 663 #define FT_REQUEST_HEIGHT( req )                                            \
 664           ( (req)-&gt;vertResolution                                           \
 665               ? ( (req)-&gt;height * (FT_Pos)(req)-&gt;vertResolution + 36 ) / 72 \
 666               : (req)-&gt;height )
 667 
 668 
 669   /* Set the metrics according to a bitmap strike. */
 670   FT_BASE( void )
 671   FT_Select_Metrics( FT_Face   face,
 672                      FT_ULong  strike_index );
</pre>
<hr />
<pre>
 682   FT_BASE( FT_Error )
 683   FT_Match_Size( FT_Face          face,
 684                  FT_Size_Request  req,
 685                  FT_Bool          ignore_width,
 686                  FT_ULong*        size_index );
 687 
 688 
 689   /* Use the horizontal metrics to synthesize the vertical metrics. */
 690   /* If `advance&#39; is zero, it is also synthesized.                  */
 691   FT_BASE( void )
 692   ft_synthesize_vertical_metrics( FT_Glyph_Metrics*  metrics,
 693                                   FT_Pos             advance );
 694 
 695 
 696   /* Free the bitmap of a given glyphslot when needed (i.e., only when it */
 697   /* was allocated with ft_glyphslot_alloc_bitmap).                       */
 698   FT_BASE( void )
 699   ft_glyphslot_free_bitmap( FT_GlyphSlot  slot );
 700 
 701 
<span class="line-modified"> 702   /* Preset bitmap metrics of an outline glyphslot prior to rendering */</span>
<span class="line-modified"> 703   /* and check whether the truncated bbox is too large for rendering. */</span>
<span class="line-added"> 704   FT_BASE( FT_Bool )</span>
 705   ft_glyphslot_preset_bitmap( FT_GlyphSlot      slot,
 706                               FT_Render_Mode    mode,
 707                               const FT_Vector*  origin );
 708 
 709   /* Allocate a new bitmap buffer in a glyph slot. */
 710   FT_BASE( FT_Error )
 711   ft_glyphslot_alloc_bitmap( FT_GlyphSlot  slot,
 712                              FT_ULong      size );
 713 
 714 
 715   /* Set the bitmap buffer in a glyph slot to a given pointer.  The buffer */
 716   /* will not be freed by a later call to ft_glyphslot_free_bitmap.        */
 717   FT_BASE( void )
 718   ft_glyphslot_set_bitmap( FT_GlyphSlot  slot,
 719                            FT_Byte*      buffer );
 720 
 721 
 722   /*************************************************************************/
 723   /*************************************************************************/
 724   /*************************************************************************/
</pre>
<hr />
<pre>
 755   /*************************************************************************/
 756   /*************************************************************************/
 757   /*************************************************************************/
 758   /****                                                                 ****/
 759   /****                                                                 ****/
 760   /****                    F O N T   D R I V E R S                      ****/
 761   /****                                                                 ****/
 762   /****                                                                 ****/
 763   /*************************************************************************/
 764   /*************************************************************************/
 765   /*************************************************************************/
 766 
 767 
 768   /* typecast a module into a driver easily */
 769 #define FT_DRIVER( x )  ( (FT_Driver)(x) )
 770 
 771   /* typecast a module as a driver, and get its driver class */
 772 #define FT_DRIVER_CLASS( x )  FT_DRIVER( x )-&gt;clazz
 773 
 774 
<span class="line-modified"> 775   /**************************************************************************</span>
<span class="line-modified"> 776    *</span>
<span class="line-modified"> 777    * @struct:</span>
<span class="line-modified"> 778    *   FT_DriverRec</span>
<span class="line-modified"> 779    *</span>
<span class="line-modified"> 780    * @description:</span>
<span class="line-modified"> 781    *   The root font driver class.  A font driver is responsible for managing</span>
<span class="line-modified"> 782    *   and loading font files of a given format.</span>
<span class="line-modified"> 783    *</span>
<span class="line-modified"> 784    * @fields:</span>
<span class="line-modified"> 785    *   root ::</span>
<span class="line-modified"> 786    *     Contains the fields of the root module class.</span>
<span class="line-modified"> 787    *</span>
<span class="line-modified"> 788    *   clazz ::</span>
<span class="line-modified"> 789    *     A pointer to the font driver&#39;s class.  Note that this is NOT</span>
<span class="line-modified"> 790    *     root.clazz.  &#39;class&#39; wasn&#39;t used as it is a reserved word in C++.</span>
<span class="line-modified"> 791    *</span>
<span class="line-modified"> 792    *   faces_list ::</span>
<span class="line-modified"> 793    *     The list of faces currently opened by this driver.</span>
<span class="line-modified"> 794    *</span>
<span class="line-modified"> 795    *   glyph_loader ::</span>
<span class="line-modified"> 796    *     Unused.  Used to be glyph loader for all faces managed by this</span>
<span class="line-added"> 797    *     driver.</span>
<span class="line-added"> 798    */</span>
 799   typedef struct  FT_DriverRec_
 800   {
 801     FT_ModuleRec     root;
 802     FT_Driver_Class  clazz;
 803     FT_ListRec       faces_list;
 804     FT_GlyphLoader   glyph_loader;
 805 
 806   } FT_DriverRec;
 807 
 808 
 809   /*************************************************************************/
 810   /*************************************************************************/
 811   /*************************************************************************/
 812   /****                                                                 ****/
 813   /****                                                                 ****/
 814   /****                       L I B R A R I E S                         ****/
 815   /****                                                                 ****/
 816   /****                                                                 ****/
 817   /*************************************************************************/
 818   /*************************************************************************/
 819   /*************************************************************************/
 820 
 821 
<span class="line-modified"> 822   /**************************************************************************</span>
<span class="line-modified"> 823    *</span>
<span class="line-modified"> 824    * @struct:</span>
<span class="line-modified"> 825    *   FT_LibraryRec</span>
<span class="line-modified"> 826    *</span>
<span class="line-modified"> 827    * @description:</span>
<span class="line-modified"> 828    *   The FreeType library class.  This is the root of all FreeType data.</span>
<span class="line-modified"> 829    *   Use FT_New_Library() to create a library object, and FT_Done_Library()</span>
<span class="line-modified"> 830    *   to discard it and all child objects.</span>
<span class="line-modified"> 831    *</span>
<span class="line-modified"> 832    * @fields:</span>
<span class="line-modified"> 833    *   memory ::</span>
<span class="line-modified"> 834    *     The library&#39;s memory object.  Manages memory allocation.</span>
<span class="line-modified"> 835    *</span>
<span class="line-modified"> 836    *   version_major ::</span>
<span class="line-modified"> 837    *     The major version number of the library.</span>
<span class="line-modified"> 838    *</span>
<span class="line-modified"> 839    *   version_minor ::</span>
<span class="line-modified"> 840    *     The minor version number of the library.</span>
<span class="line-modified"> 841    *</span>
<span class="line-modified"> 842    *   version_patch ::</span>
<span class="line-modified"> 843    *     The current patch level of the library.</span>
<span class="line-modified"> 844    *</span>
<span class="line-modified"> 845    *   num_modules ::</span>
<span class="line-modified"> 846    *     The number of modules currently registered within this library.</span>
<span class="line-modified"> 847    *     This is set to 0 for new libraries.  New modules are added through</span>
<span class="line-modified"> 848    *     the FT_Add_Module() API function.</span>
<span class="line-modified"> 849    *</span>
<span class="line-modified"> 850    *   modules ::</span>
<span class="line-modified"> 851    *     A table used to store handles to the currently registered</span>
<span class="line-modified"> 852    *     modules. Note that each font driver contains a list of its opened</span>
<span class="line-modified"> 853    *     faces.</span>
<span class="line-modified"> 854    *</span>
<span class="line-modified"> 855    *   renderers ::</span>
<span class="line-modified"> 856    *     The list of renderers currently registered within the library.</span>
<span class="line-modified"> 857    *</span>
<span class="line-modified"> 858    *   cur_renderer ::</span>
<span class="line-modified"> 859    *     The current outline renderer.  This is a shortcut used to avoid</span>
<span class="line-modified"> 860    *     parsing the list on each call to FT_Outline_Render().  It is a</span>
<span class="line-modified"> 861    *     handle to the current renderer for the FT_GLYPH_FORMAT_OUTLINE</span>
<span class="line-modified"> 862    *     format.</span>
<span class="line-modified"> 863    *</span>
<span class="line-modified"> 864    *   auto_hinter ::</span>
<span class="line-modified"> 865    *     The auto-hinter module interface.</span>
<span class="line-modified"> 866    *</span>
<span class="line-modified"> 867    *   debug_hooks ::</span>
<span class="line-modified"> 868    *     An array of four function pointers that allow debuggers to hook into</span>
<span class="line-modified"> 869    *     a font format&#39;s interpreter.  Currently, only the TrueType bytecode</span>
<span class="line-modified"> 870    *     debugger uses this.</span>
<span class="line-modified"> 871    *</span>
<span class="line-modified"> 872    *   lcd_weights ::</span>
<span class="line-modified"> 873    *     The LCD filter weights for ClearType-style subpixel rendering.</span>
<span class="line-modified"> 874    *</span>
<span class="line-modified"> 875    *   lcd_filter_func ::</span>
<span class="line-modified"> 876    *     The LCD filtering callback function for for ClearType-style subpixel</span>
<span class="line-modified"> 877    *     rendering.</span>
<span class="line-modified"> 878    *</span>
<span class="line-modified"> 879    *   lcd_geometry ::</span>
<span class="line-modified"> 880    *     This array specifies LCD subpixel geometry and controls Harmony LCD</span>
<span class="line-modified"> 881    *     rendering technique, alternative to ClearType.</span>
<span class="line-modified"> 882    *</span>
<span class="line-modified"> 883    *   pic_container ::</span>
<span class="line-modified"> 884    *     Contains global structs and tables, instead of defining them</span>
<span class="line-modified"> 885    *     globally.</span>
<span class="line-modified"> 886    *</span>
<span class="line-modified"> 887    *   refcount ::</span>
<span class="line-added"> 888    *     A counter initialized to~1 at the time an @FT_Library structure is</span>
<span class="line-added"> 889    *     created.  @FT_Reference_Library increments this counter, and</span>
<span class="line-added"> 890    *     @FT_Done_Library only destroys a library if the counter is~1,</span>
<span class="line-added"> 891    *     otherwise it simply decrements it.</span>
<span class="line-added"> 892    */</span>
 893   typedef struct  FT_LibraryRec_
 894   {
 895     FT_Memory          memory;           /* library&#39;s memory manager */
 896 
 897     FT_Int             version_major;
 898     FT_Int             version_minor;
 899     FT_Int             version_patch;
 900 
 901     FT_UInt            num_modules;
 902     FT_Module          modules[FT_MAX_MODULES];  /* module objects  */
 903 
 904     FT_ListRec         renderers;        /* list of renderers        */
 905     FT_Renderer        cur_renderer;     /* current outline renderer */
 906     FT_Module          auto_hinter;
 907 
 908     FT_DebugHook_Func  debug_hooks[4];
 909 
 910 #ifdef FT_CONFIG_OPTION_SUBPIXEL_RENDERING
 911     FT_LcdFiveTapFilter      lcd_weights;      /* filter weights, if any */
 912     FT_Bitmap_LcdFilterFunc  lcd_filter_func;  /* filtering callback     */
<span class="line-modified"> 913 #else</span>
<span class="line-modified"> 914     FT_Vector                lcd_geometry[3];  /* RGB subpixel positions */</span>


 915 #endif
 916 
 917     FT_Int             refcount;
 918 
 919   } FT_LibraryRec;
 920 
 921 
 922   FT_BASE( FT_Renderer )
 923   FT_Lookup_Renderer( FT_Library       library,
 924                       FT_Glyph_Format  format,
 925                       FT_ListNode*     node );
 926 
 927   FT_BASE( FT_Error )
 928   FT_Render_Glyph_Internal( FT_Library      library,
 929                             FT_GlyphSlot    slot,
 930                             FT_Render_Mode  render_mode );
 931 
 932   typedef const char*
 933   (*FT_Face_GetPostscriptNameFunc)( FT_Face  face );
 934 
 935   typedef FT_Error
 936   (*FT_Face_GetGlyphNameFunc)( FT_Face     face,
 937                                FT_UInt     glyph_index,
 938                                FT_Pointer  buffer,
 939                                FT_UInt     buffer_max );
 940 
 941   typedef FT_UInt
<span class="line-modified"> 942   (*FT_Face_GetGlyphNameIndexFunc)( FT_Face           face,</span>
<span class="line-modified"> 943                                     const FT_String*  glyph_name );</span>
 944 
 945 
 946 #ifndef FT_CONFIG_OPTION_NO_DEFAULT_SYSTEM
 947 
<span class="line-modified"> 948   /**************************************************************************</span>
<span class="line-modified"> 949    *</span>
<span class="line-modified"> 950    * @function:</span>
<span class="line-modified"> 951    *   FT_New_Memory</span>
<span class="line-modified"> 952    *</span>
<span class="line-modified"> 953    * @description:</span>
<span class="line-modified"> 954    *   Creates a new memory object.</span>
<span class="line-modified"> 955    *</span>
<span class="line-modified"> 956    * @return:</span>
<span class="line-modified"> 957    *   A pointer to the new memory object.  0 in case of error.</span>
<span class="line-modified"> 958    */</span>
 959   FT_BASE( FT_Memory )
 960   FT_New_Memory( void );
 961 
 962 
<span class="line-modified"> 963   /**************************************************************************</span>
<span class="line-modified"> 964    *</span>
<span class="line-modified"> 965    * @function:</span>
<span class="line-modified"> 966    *   FT_Done_Memory</span>
<span class="line-modified"> 967    *</span>
<span class="line-modified"> 968    * @description:</span>
<span class="line-modified"> 969    *   Discards memory manager.</span>
<span class="line-modified"> 970    *</span>
<span class="line-modified"> 971    * @input:</span>
<span class="line-modified"> 972    *   memory ::</span>
<span class="line-modified"> 973    *     A handle to the memory manager.</span>
<span class="line-added"> 974    */</span>
 975   FT_BASE( void )
 976   FT_Done_Memory( FT_Memory  memory );
 977 
 978 #endif /* !FT_CONFIG_OPTION_NO_DEFAULT_SYSTEM */
 979 
 980 
 981   /* Define default raster&#39;s interface.  The default raster is located in  */
 982   /* `src/base/ftraster.c&#39;.                                                */
 983   /*                                                                       */
 984   /* Client applications can register new rasters through the              */
 985   /* FT_Set_Raster() API.                                                  */
 986 
 987 #ifndef FT_NO_DEFAULT_RASTER
 988   FT_EXPORT_VAR( FT_Raster_Funcs )  ft_default_raster;
 989 #endif
 990 
 991 
<span class="line-modified"> 992   /**************************************************************************</span>
<span class="line-modified"> 993    *</span>
<span class="line-modified"> 994    * @macro:</span>
<span class="line-modified"> 995    *   FT_DEFINE_OUTLINE_FUNCS</span>
<span class="line-modified"> 996    *</span>
<span class="line-modified"> 997    * @description:</span>
<span class="line-modified"> 998    *   Used to initialize an instance of FT_Outline_Funcs struct.  The struct</span>
<span class="line-modified"> 999    *   will be allocated in the global scope (or the scope where the macro is</span>
<span class="line-modified">1000    *   used).</span>
<span class="line-modified">1001    */</span>





















1002 #define FT_DEFINE_OUTLINE_FUNCS(           \
1003           class_,                          \
1004           move_to_,                        \
1005           line_to_,                        \
1006           conic_to_,                       \
1007           cubic_to_,                       \
1008           shift_,                          \
1009           delta_ )                         \
1010   static const  FT_Outline_Funcs class_ =  \
1011   {                                        \
1012     move_to_,                              \
1013     line_to_,                              \
1014     conic_to_,                             \
1015     cubic_to_,                             \
1016     shift_,                                \
1017     delta_                                 \
1018   };
1019 








































1020 
<span class="line-added">1021   /**************************************************************************</span>
<span class="line-added">1022    *</span>
<span class="line-added">1023    * @macro:</span>
<span class="line-added">1024    *   FT_DEFINE_RASTER_FUNCS</span>
<span class="line-added">1025    *</span>
<span class="line-added">1026    * @description:</span>
<span class="line-added">1027    *   Used to initialize an instance of FT_Raster_Funcs struct.  The struct</span>
<span class="line-added">1028    *   will be allocated in the global scope (or the scope where the macro is</span>
<span class="line-added">1029    *   used).</span>
<span class="line-added">1030    */</span>
1031 #define FT_DEFINE_RASTER_FUNCS(    \
1032           class_,                  \
1033           glyph_format_,           \
1034           raster_new_,             \
1035           raster_reset_,           \
1036           raster_set_mode_,        \
1037           raster_render_,          \
1038           raster_done_ )           \
1039   const FT_Raster_Funcs  class_ =  \
1040   {                                \
1041     glyph_format_,                 \
1042     raster_new_,                   \
1043     raster_reset_,                 \
1044     raster_set_mode_,              \
1045     raster_render_,                \
1046     raster_done_                   \
1047   };
1048 






















1049 
1050 
<span class="line-modified">1051   /**************************************************************************</span>
<span class="line-modified">1052    *</span>
<span class="line-modified">1053    * @macro:</span>
<span class="line-modified">1054    *   FT_DEFINE_GLYPH</span>
<span class="line-modified">1055    *</span>
<span class="line-modified">1056    * @description:</span>
<span class="line-modified">1057    *   The struct will be allocated in the global scope (or the scope where</span>
<span class="line-modified">1058    *   the macro is used).</span>
<span class="line-modified">1059    */</span>









1060 #define FT_DEFINE_GLYPH(          \
1061           class_,                 \
1062           size_,                  \
1063           format_,                \
1064           init_,                  \
1065           done_,                  \
1066           copy_,                  \
1067           transform_,             \
1068           bbox_,                  \
1069           prepare_ )              \
1070   FT_CALLBACK_TABLE_DEF           \
1071   const FT_Glyph_Class  class_ =  \
1072   {                               \
1073     size_,                        \
1074     format_,                      \
1075     init_,                        \
1076     done_,                        \
1077     copy_,                        \
1078     transform_,                   \
1079     bbox_,                        \
1080     prepare_                      \
1081   };
1082 


































































1083 
<span class="line-added">1084   /**************************************************************************</span>
<span class="line-added">1085    *</span>
<span class="line-added">1086    * @macro:</span>
<span class="line-added">1087    *   FT_DECLARE_RENDERER</span>
<span class="line-added">1088    *</span>
<span class="line-added">1089    * @description:</span>
<span class="line-added">1090    *   Used to create a forward declaration of a FT_Renderer_Class struct</span>
<span class="line-added">1091    *   instance.</span>
<span class="line-added">1092    *</span>
<span class="line-added">1093    * @macro:</span>
<span class="line-added">1094    *   FT_DEFINE_RENDERER</span>
<span class="line-added">1095    *</span>
<span class="line-added">1096    * @description:</span>
<span class="line-added">1097    *   Used to initialize an instance of FT_Renderer_Class struct.</span>
<span class="line-added">1098    *</span>
<span class="line-added">1099    *   The struct will be allocated in the global scope (or the scope where</span>
<span class="line-added">1100    *   the macro is used).</span>
<span class="line-added">1101    */</span>
1102 #define FT_DECLARE_RENDERER( class_ )               \
1103   FT_EXPORT_VAR( const FT_Renderer_Class ) class_;
1104 
1105 #define FT_DEFINE_RENDERER(                  \
1106           class_,                            \
1107           flags_,                            \
1108           size_,                             \
1109           name_,                             \
1110           version_,                          \
1111           requires_,                         \
1112           interface_,                        \
1113           init_,                             \
1114           done_,                             \
1115           get_interface_,                    \
1116           glyph_format_,                     \
1117           render_glyph_,                     \
1118           transform_glyph_,                  \
1119           get_glyph_cbox_,                   \
1120           set_mode_,                         \
1121           raster_class_ )                    \
</pre>
<hr />
<pre>
1124   {                                          \
1125     FT_DEFINE_ROOT_MODULE( flags_,           \
1126                            size_,            \
1127                            name_,            \
1128                            version_,         \
1129                            requires_,        \
1130                            interface_,       \
1131                            init_,            \
1132                            done_,            \
1133                            get_interface_ )  \
1134     glyph_format_,                           \
1135                                              \
1136     render_glyph_,                           \
1137     transform_glyph_,                        \
1138     get_glyph_cbox_,                         \
1139     set_mode_,                               \
1140                                              \
1141     raster_class_                            \
1142   };
1143 









































































































































































1144 
<span class="line-added">1145   /**************************************************************************</span>
<span class="line-added">1146    *</span>
<span class="line-added">1147    * @macro:</span>
<span class="line-added">1148    *   FT_DECLARE_MODULE</span>
<span class="line-added">1149    *</span>
<span class="line-added">1150    * @description:</span>
<span class="line-added">1151    *   Used to create a forward declaration of a FT_Module_Class struct</span>
<span class="line-added">1152    *   instance.</span>
<span class="line-added">1153    *</span>
<span class="line-added">1154    * @macro:</span>
<span class="line-added">1155    *   FT_DEFINE_MODULE</span>
<span class="line-added">1156    *</span>
<span class="line-added">1157    * @description:</span>
<span class="line-added">1158    *   Used to initialize an instance of an FT_Module_Class struct.</span>
<span class="line-added">1159    *</span>
<span class="line-added">1160    *   The struct will be allocated in the global scope (or the scope where</span>
<span class="line-added">1161    *   the macro is used).</span>
<span class="line-added">1162    *</span>
<span class="line-added">1163    * @macro:</span>
<span class="line-added">1164    *   FT_DEFINE_ROOT_MODULE</span>
<span class="line-added">1165    *</span>
<span class="line-added">1166    * @description:</span>
<span class="line-added">1167    *   Used to initialize an instance of an FT_Module_Class struct inside</span>
<span class="line-added">1168    *   another struct that contains it or in a function that initializes that</span>
<span class="line-added">1169    *   containing struct.</span>
<span class="line-added">1170    */</span>
1171 #define FT_DECLARE_MODULE( class_ )  \
1172   FT_CALLBACK_TABLE                  \
1173   const FT_Module_Class  class_;
1174 
1175 #define FT_DEFINE_ROOT_MODULE(  \
1176           flags_,               \
1177           size_,                \
1178           name_,                \
1179           version_,             \
1180           requires_,            \
1181           interface_,           \
1182           init_,                \
1183           done_,                \
1184           get_interface_ )      \
1185   {                             \
1186     flags_,                     \
1187     size_,                      \
1188                                 \
1189     name_,                      \
1190     version_,                   \
</pre>
<hr />
<pre>
1209           done_,                  \
1210           get_interface_ )        \
1211   FT_CALLBACK_TABLE_DEF           \
1212   const FT_Module_Class class_ =  \
1213   {                               \
1214     flags_,                       \
1215     size_,                        \
1216                                   \
1217     name_,                        \
1218     version_,                     \
1219     requires_,                    \
1220                                   \
1221     interface_,                   \
1222                                   \
1223     init_,                        \
1224     done_,                        \
1225     get_interface_,               \
1226   };
1227 
1228 






























































































1229 FT_END_HEADER
1230 
1231 #endif /* FTOBJS_H_ */
1232 
1233 
1234 /* END */
</pre>
</td>
</tr>
</table>
<center><a href="ftmemory.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ftpsprop.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>