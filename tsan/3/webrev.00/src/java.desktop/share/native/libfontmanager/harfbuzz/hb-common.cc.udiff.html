<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/share/native/libfontmanager/harfbuzz/hb-common.cc</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="hb-buffer.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="hb-common.h.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfontmanager/harfbuzz/hb-common.cc</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -24,37 +24,65 @@</span>
   *
   * Red Hat Author(s): Behdad Esfahbod
   * Google Author(s): Behdad Esfahbod
   */
  
<span class="udiff-line-modified-removed">- #include &quot;hb-private.hh&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;hb.hh&quot;</span>
  
<span class="udiff-line-modified-removed">- #include &quot;hb-mutex-private.hh&quot;</span>
<span class="udiff-line-removed">- #include &quot;hb-object-private.hh&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;hb-machinery.hh&quot;</span>
  
  #include &lt;locale.h&gt;
  #ifdef HAVE_XLOCALE_H
  #include &lt;xlocale.h&gt;
  #endif
  
  
<span class="udiff-line-added">+ /**</span>
<span class="udiff-line-added">+  * SECTION:hb-common</span>
<span class="udiff-line-added">+  * @title: hb-common</span>
<span class="udiff-line-added">+  * @short_description: Common data types</span>
<span class="udiff-line-added">+  * @include: hb.h</span>
<span class="udiff-line-added">+  *</span>
<span class="udiff-line-added">+  * Common data types used across HarfBuzz are defined here.</span>
<span class="udiff-line-added">+  **/</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
  /* hb_options_t */
  
<span class="udiff-line-modified-removed">- hb_options_union_t _hb_options;</span>
<span class="udiff-line-modified-added">+ hb_atomic_int_t _hb_options;</span>
  
  void
<span class="udiff-line-modified-removed">- _hb_options_init (void)</span>
<span class="udiff-line-modified-added">+ _hb_options_init ()</span>
  {
    hb_options_union_t u;
    u.i = 0;
<span class="udiff-line-modified-removed">-   u.opts.initialized = 1;</span>
<span class="udiff-line-modified-added">+   u.opts.initialized = true;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   const char *c = getenv (&quot;HB_OPTIONS&quot;);</span>
<span class="udiff-line-added">+   if (c)</span>
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+     while (*c)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+       const char *p = strchr (c, &#39;:&#39;);</span>
<span class="udiff-line-added">+       if (!p)</span>
<span class="udiff-line-added">+         p = c + strlen (c);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #define OPTION(name, symbol) \</span>
<span class="udiff-line-added">+         if (0 == strncmp (c, name, p - c) &amp;&amp; strlen (name) == p - c) u.opts.symbol = true;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+       OPTION (&quot;uniscribe-bug-compatible&quot;, uniscribe_bug_compatible);</span>
<span class="udiff-line-added">+       OPTION (&quot;aat&quot;, aat);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #undef OPTION</span>
  
<span class="udiff-line-modified-removed">-   char *c = getenv (&quot;HB_OPTIONS&quot;);</span>
<span class="udiff-line-modified-removed">-   u.opts.uniscribe_bug_compatible = c &amp;&amp; strstr (c, &quot;uniscribe-bug-compatible&quot;);</span>
<span class="udiff-line-modified-added">+       c = *p ? p + 1 : p;</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   }</span>
  
    /* This is idempotent and threadsafe. */
<span class="udiff-line-modified-removed">-   _hb_options = u;</span>
<span class="udiff-line-modified-added">+   _hb_options.set_relaxed (u.i);</span>
  }
  
  
  /* hb_tag_t */
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -174,11 +202,11 @@</span>
  static const char canon_map[256] = {
     0,   0,   0,   0,   0,   0,   0,   0,    0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,    0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,    0,   0,   0,   0,   0,  &#39;-&#39;,  0,   0,
    &#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;,  &#39;8&#39;, &#39;9&#39;,  0,   0,   0,   0,   0,   0,
<span class="udiff-line-modified-removed">-   &#39;-&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;,  &#39;h&#39;, &#39;i&#39;, &#39;j&#39;, &#39;k&#39;, &#39;l&#39;, &#39;m&#39;, &#39;n&#39;, &#39;o&#39;,</span>
<span class="udiff-line-modified-added">+    0,  &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;,  &#39;h&#39;, &#39;i&#39;, &#39;j&#39;, &#39;k&#39;, &#39;l&#39;, &#39;m&#39;, &#39;n&#39;, &#39;o&#39;,</span>
    &#39;p&#39;, &#39;q&#39;, &#39;r&#39;, &#39;s&#39;, &#39;t&#39;, &#39;u&#39;, &#39;v&#39;, &#39;w&#39;,  &#39;x&#39;, &#39;y&#39;, &#39;z&#39;,  0,   0,   0,   0,  &#39;-&#39;,
     0,  &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;,  &#39;h&#39;, &#39;i&#39;, &#39;j&#39;, &#39;k&#39;, &#39;l&#39;, &#39;m&#39;, &#39;n&#39;, &#39;o&#39;,
    &#39;p&#39;, &#39;q&#39;, &#39;r&#39;, &#39;s&#39;, &#39;t&#39;, &#39;u&#39;, &#39;v&#39;, &#39;w&#39;,  &#39;x&#39;, &#39;y&#39;, &#39;z&#39;,  0,   0,   0,   0,   0
  };
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -217,15 +245,14 @@</span>
  struct hb_language_item_t {
  
    struct hb_language_item_t *next;
    hb_language_t lang;
  
<span class="udiff-line-modified-removed">-   inline bool operator == (const char *s) const {</span>
<span class="udiff-line-modified-removed">-     return lang_equal (lang, s);</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-modified-added">+   bool operator == (const char *s) const</span>
<span class="udiff-line-modified-added">+   { return lang_equal (lang, s); }</span>
  
<span class="udiff-line-modified-removed">-   inline hb_language_item_t &amp; operator = (const char *s) {</span>
<span class="udiff-line-modified-added">+   hb_language_item_t &amp; operator = (const char *s) {</span>
      /* If a custom allocated is used calling strdup() pairs
      badly with a call to the custom free() in fini() below.
      Therefore don&#39;t call strdup(), implement its behavior.
      */
      size_t len = strlen(s) + 1;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -238,25 +265,25 @@</span>
      }
  
      return *this;
    }
  
<span class="udiff-line-modified-removed">-   void fini (void) { free ((void *) lang); }</span>
<span class="udiff-line-modified-added">+   void fini () { free ((void *) lang); }</span>
  };
  
  
  /* Thread-safe lock-free language list */
  
<span class="udiff-line-modified-removed">- static hb_language_item_t *langs;</span>
<span class="udiff-line-modified-added">+ static hb_atomic_ptr_t &lt;hb_language_item_t&gt; langs;</span>
  
<span class="udiff-line-modified-removed">- #ifdef HB_USE_ATEXIT</span>
<span class="udiff-line-modified-added">+ #if HB_USE_ATEXIT</span>
  static void
<span class="udiff-line-modified-removed">- free_langs (void)</span>
<span class="udiff-line-modified-added">+ free_langs ()</span>
  {
  retry:
<span class="udiff-line-modified-removed">-   hb_language_item_t *first_lang = (hb_language_item_t *) hb_atomic_ptr_get (&amp;langs);</span>
<span class="udiff-line-modified-removed">-   if (!hb_atomic_ptr_cmpexch (&amp;langs, first_lang, nullptr))</span>
<span class="udiff-line-modified-added">+   hb_language_item_t *first_lang = langs;</span>
<span class="udiff-line-modified-added">+   if (unlikely (!langs.cmpexch (first_lang, nullptr)))</span>
      goto retry;
  
    while (first_lang) {
      hb_language_item_t *next = first_lang-&gt;next;
      first_lang-&gt;fini ();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -268,11 +295,11 @@</span>
  
  static hb_language_item_t *
  lang_find_or_insert (const char *key)
  {
  retry:
<span class="udiff-line-modified-removed">-   hb_language_item_t *first_lang = (hb_language_item_t *) hb_atomic_ptr_get (&amp;langs);</span>
<span class="udiff-line-modified-added">+   hb_language_item_t *first_lang = langs;</span>
  
    for (hb_language_item_t *lang = first_lang; lang; lang = lang-&gt;next)
      if (*lang == key)
        return lang;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -286,17 +313,18 @@</span>
    {
      free (lang);
      return nullptr;
    }
  
<span class="udiff-line-modified-removed">-   if (!hb_atomic_ptr_cmpexch (&amp;langs, first_lang, lang)) {</span>
<span class="udiff-line-modified-added">+   if (unlikely (!langs.cmpexch (first_lang, lang)))</span>
<span class="udiff-line-added">+   {</span>
      lang-&gt;fini ();
      free (lang);
      goto retry;
    }
  
<span class="udiff-line-modified-removed">- #ifdef HB_USE_ATEXIT</span>
<span class="udiff-line-modified-added">+ #if HB_USE_ATEXIT</span>
    if (!first_lang)
      atexit (free_langs); /* First person registers atexit() callback. */
  #endif
  
    return lang;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -304,18 +332,18 @@</span>
  
  
  /**
   * hb_language_from_string:
   * @str: (array length=len) (element-type uint8_t): a string representing
<span class="udiff-line-modified-removed">-  *       ISO 639 language code</span>
<span class="udiff-line-modified-added">+  *       a BCP 47 language tag</span>
   * @len: length of the @str, or -1 if it is %NULL-terminated.
   *
<span class="udiff-line-modified-removed">-  * Converts @str representing an ISO 639 language code to the corresponding</span>
<span class="udiff-line-modified-added">+  * Converts @str representing a BCP 47 language tag to the corresponding</span>
   * #hb_language_t.
   *
   * Return value: (transfer none):
<span class="udiff-line-modified-removed">-  * The #hb_language_t corresponding to the ISO 639 language code.</span>
<span class="udiff-line-modified-added">+  * The #hb_language_t corresponding to the BCP 47 language tag.</span>
   *
   * Since: 0.9.2
   **/
  hb_language_t
  hb_language_from_string (const char *str, int len)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -359,28 +387,36 @@</span>
  }
  
  /**
   * hb_language_get_default:
   *
<span class="udiff-line-added">+  * Get default language from current locale.</span>
   *
<span class="udiff-line-added">+  * Note that the first time this function is called, it calls</span>
<span class="udiff-line-added">+  * &quot;setlocale (LC_CTYPE, nullptr)&quot; to fetch current locale.  The underlying</span>
<span class="udiff-line-added">+  * setlocale function is, in many implementations, NOT threadsafe.  To avoid</span>
<span class="udiff-line-added">+  * problems, call this function once before multiple threads can call it.</span>
<span class="udiff-line-added">+  * This function is only used from hb_buffer_guess_segment_properties() by</span>
<span class="udiff-line-added">+  * HarfBuzz itself.</span>
   *
   * Return value: (transfer none):
   *
   * Since: 0.9.2
   **/
  hb_language_t
<span class="udiff-line-modified-removed">- hb_language_get_default (void)</span>
<span class="udiff-line-modified-added">+ hb_language_get_default ()</span>
  {
<span class="udiff-line-modified-removed">-   static hb_language_t default_language = HB_LANGUAGE_INVALID;</span>
<span class="udiff-line-modified-added">+   static hb_atomic_ptr_t &lt;hb_language_t&gt; default_language;</span>
  
<span class="udiff-line-modified-removed">-   hb_language_t language = (hb_language_t) hb_atomic_ptr_get (&amp;default_language);</span>
<span class="udiff-line-modified-removed">-   if (unlikely (language == HB_LANGUAGE_INVALID)) {</span>
<span class="udiff-line-modified-added">+   hb_language_t language = default_language;</span>
<span class="udiff-line-modified-added">+   if (unlikely (language == HB_LANGUAGE_INVALID))</span>
<span class="udiff-line-added">+   {</span>
      language = hb_language_from_string (setlocale (LC_CTYPE, nullptr), -1);
<span class="udiff-line-modified-removed">-     (void) hb_atomic_ptr_cmpexch (&amp;default_language, HB_LANGUAGE_INVALID, language);</span>
<span class="udiff-line-modified-added">+     (void) default_language.cmpexch (HB_LANGUAGE_INVALID, language);</span>
    }
  
<span class="udiff-line-modified-removed">-   return default_language;</span>
<span class="udiff-line-modified-added">+   return language;</span>
  }
  
  
  /* hb_script_t */
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -528,11 +564,10 @@</span>
      case HB_SCRIPT_PALMYRENE:
      case HB_SCRIPT_PSALTER_PAHLAVI:
  
      /* Unicode-8.0 additions */
      case HB_SCRIPT_HATRAN:
<span class="udiff-line-removed">-     case HB_SCRIPT_OLD_HUNGARIAN:</span>
  
      /* Unicode-9.0 additions */
      case HB_SCRIPT_ADLAM:
  
      /* Unicode-11.0 additions */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -542,11 +577,13 @@</span>
  
        return HB_DIRECTION_RTL;
  
  
      /* https://github.com/harfbuzz/harfbuzz/issues/1000 */
<span class="udiff-line-added">+     case HB_SCRIPT_OLD_HUNGARIAN:</span>
      case HB_SCRIPT_OLD_ITALIC:
<span class="udiff-line-added">+     case HB_SCRIPT_RUNIC:</span>
  
        return HB_DIRECTION_INVALID;
    }
  
    return HB_DIRECTION_LTR;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -585,10 +622,23 @@</span>
  }
  
  
  /* hb_version */
  
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ /**</span>
<span class="udiff-line-added">+  * SECTION:hb-version</span>
<span class="udiff-line-added">+  * @title: hb-version</span>
<span class="udiff-line-added">+  * @short_description: Information about the version of HarfBuzz in use</span>
<span class="udiff-line-added">+  * @include: hb.h</span>
<span class="udiff-line-added">+  *</span>
<span class="udiff-line-added">+  * These functions and macros allow accessing version of the HarfBuzz</span>
<span class="udiff-line-added">+  * library used at compile- as well as run-time, and to direct code</span>
<span class="udiff-line-added">+  * conditionally based on those versions, again, at compile- or run-time.</span>
<span class="udiff-line-added">+  **/</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
  /**
   * hb_version:
   * @major: (out): Library major version component.
   * @minor: (out): Library minor version component.
   * @micro: (out): Library micro version component.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -615,11 +665,11 @@</span>
   * Return value: library version string.
   *
   * Since: 0.9.2
   **/
  const char *
<span class="udiff-line-modified-removed">- hb_version_string (void)</span>
<span class="udiff-line-modified-added">+ hb_version_string ()</span>
  {
    return HB_VERSION_STRING;
  }
  
  /**
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -727,52 +777,52 @@</span>
  #define strtod_l(a, b, c) _strtod_l ((a), (b), (c))
  #endif
  
  #ifdef USE_XLOCALE
  
<span class="udiff-line-modified-removed">- static HB_LOCALE_T C_locale;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-removed">- #ifdef HB_USE_ATEXIT</span>
<span class="udiff-line-removed">- static void</span>
<span class="udiff-line-removed">- free_C_locale (void)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">- retry:</span>
<span class="udiff-line-removed">-   HB_LOCALE_T locale = (HB_LOCALE_T) hb_atomic_ptr_get (&amp;C_locale);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   if (!hb_atomic_ptr_cmpexch (&amp;C_locale, locale, nullptr))</span>
<span class="udiff-line-removed">-     goto retry;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   if (locale)</span>
<span class="udiff-line-removed">-     HB_FREE_LOCALE (locale);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-modified-added">+ #if HB_USE_ATEXIT</span>
<span class="udiff-line-modified-added">+ static void free_static_C_locale ();</span>
  #endif
  
<span class="udiff-line-modified-removed">- static HB_LOCALE_T</span>
<span class="udiff-line-modified-removed">- get_C_locale (void)</span>
<span class="udiff-line-modified-added">+ static struct hb_C_locale_lazy_loader_t : hb_lazy_loader_t&lt;hb_remove_pointer (HB_LOCALE_T),</span>
<span class="udiff-line-modified-added">+                                                           hb_C_locale_lazy_loader_t&gt;</span>
  {
<span class="udiff-line-modified-removed">- retry:</span>
<span class="udiff-line-removed">-   HB_LOCALE_T C = (HB_LOCALE_T) hb_atomic_ptr_get (&amp;C_locale);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   if (unlikely (!C))</span>
<span class="udiff-line-modified-added">+   static HB_LOCALE_T create ()</span>
    {
<span class="udiff-line-modified-removed">-     C = HB_CREATE_LOCALE (&quot;C&quot;);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if (!hb_atomic_ptr_cmpexch (&amp;C_locale, nullptr, C))</span>
<span class="udiff-line-removed">-     {</span>
<span class="udiff-line-removed">-       HB_FREE_LOCALE (C_locale);</span>
<span class="udiff-line-removed">-       goto retry;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+     HB_LOCALE_T C_locale = HB_CREATE_LOCALE (&quot;C&quot;);</span>
  
<span class="udiff-line-modified-removed">- #ifdef HB_USE_ATEXIT</span>
<span class="udiff-line-modified-removed">-     atexit (free_C_locale); /* First person registers atexit() callback. */</span>
<span class="udiff-line-modified-added">+ #if HB_USE_ATEXIT</span>
<span class="udiff-line-modified-added">+     atexit (free_static_C_locale);</span>
  #endif
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     return C_locale;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+   static void destroy (HB_LOCALE_T p)</span>
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+     HB_FREE_LOCALE (p);</span>
    }
<span class="udiff-line-added">+   static HB_LOCALE_T get_null ()</span>
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+     return nullptr;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ } static_C_locale;</span>
  
<span class="udiff-line-modified-removed">-   return C;</span>
<span class="udiff-line-modified-added">+ #if HB_USE_ATEXIT</span>
<span class="udiff-line-added">+ static</span>
<span class="udiff-line-added">+ void free_static_C_locale ()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   static_C_locale.free_instance ();</span>
  }
  #endif
  
<span class="udiff-line-added">+ static HB_LOCALE_T</span>
<span class="udiff-line-added">+ get_C_locale ()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   return static_C_locale.get_unconst ();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ #endif /* USE_XLOCALE */</span>
<span class="udiff-line-added">+ </span>
  static bool
  parse_float (const char **pp, const char *end, float *pv)
  {
    char buf[32];
    unsigned int len = MIN (ARRAY_LENGTH (buf) - 1, (unsigned int) (end - *pp));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -844,11 +894,11 @@</span>
      quote = **pp;
      (*pp)++;
    }
  
    const char *p = *pp;
<span class="udiff-line-modified-removed">-   while (*pp &lt; end &amp;&amp; ISALNUM(**pp))</span>
<span class="udiff-line-modified-added">+   while (*pp &lt; end &amp;&amp; (ISALNUM(**pp) || **pp == &#39;_&#39;))</span>
      (*pp)++;
  
    if (p == *pp || *pp - p &gt; 4)
      return false;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -873,19 +923,19 @@</span>
  {
    parse_space (pp, end);
  
    bool has_start;
  
<span class="udiff-line-modified-removed">-   feature-&gt;start = 0;</span>
<span class="udiff-line-modified-removed">-   feature-&gt;end = (unsigned int) -1;</span>
<span class="udiff-line-modified-added">+   feature-&gt;start = HB_FEATURE_GLOBAL_START;</span>
<span class="udiff-line-modified-added">+   feature-&gt;end = HB_FEATURE_GLOBAL_END;</span>
  
    if (!parse_char (pp, end, &#39;[&#39;))
      return true;
  
    has_start = parse_uint (pp, end, &amp;feature-&gt;start);
  
<span class="udiff-line-modified-removed">-   if (parse_char (pp, end, &#39;:&#39;)) {</span>
<span class="udiff-line-modified-added">+   if (parse_char (pp, end, &#39;:&#39;) || parse_char (pp, end, &#39;;&#39;)) {</span>
      parse_uint (pp, end, &amp;feature-&gt;end);
    } else {
      if (has_start)
        feature-&gt;end = feature-&gt;start + 1;
    }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1061,12 +1111,21 @@</span>
    hb_tag_to_string (variation-&gt;tag, s + len);
    len += 4;
    while (len &amp;&amp; s[len - 1] == &#39; &#39;)
      len--;
    s[len++] = &#39;=&#39;;
<span class="udiff-line-modified-removed">-   len += MAX (0, snprintf (s + len, ARRAY_LENGTH (s) - len, &quot;%g&quot;, variation-&gt;value));</span>
<span class="udiff-line-modified-added">+   len += MAX (0, snprintf (s + len, ARRAY_LENGTH (s) - len, &quot;%g&quot;, (double) variation-&gt;value));</span>
  
    assert (len &lt; ARRAY_LENGTH (s));
    len = MIN (len, size - 1);
    memcpy (buf, s, len);
    buf[len] = &#39;\0&#39;;
  }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ /* If there is no visibility control, then hb-static.cc will NOT</span>
<span class="udiff-line-added">+  * define anything.  Instead, we get it to define one set in here</span>
<span class="udiff-line-added">+  * only, so only libharfbuzz.so defines them, not other libs. */</span>
<span class="udiff-line-added">+ #ifdef HB_NO_VISIBILITY</span>
<span class="udiff-line-added">+ #undef HB_NO_VISIBILITY</span>
<span class="udiff-line-added">+ #include &quot;hb-static.cc&quot;</span>
<span class="udiff-line-added">+ #define HB_NO_VISIBILITY 1</span>
<span class="udiff-line-added">+ #endif</span>
</pre>
<center><a href="hb-buffer.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="hb-common.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>