<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/share/native/libfontmanager/harfbuzz/hb-ot-color-svg-table.hh</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="hb-ot-color-sbix-table.hh.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="hb-ot-font.cc.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfontmanager/harfbuzz/hb-ot-color-svg-table.hh</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -23,11 +23,11 @@</span>
   */
  
  #ifndef HB_OT_COLOR_SVG_TABLE_HH
  #define HB_OT_COLOR_SVG_TABLE_HH
  
<span class="udiff-line-modified-removed">- #include &quot;hb-open-type-private.hh&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;hb-open-type.hh&quot;</span>
  
  /*
   * SVG -- SVG (Scalable Vector Graphics)
   * https://docs.microsoft.com/en-us/typography/opentype/spec/svg
   */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -38,108 +38,87 @@</span>
  namespace OT {
  
  
  struct SVGDocumentIndexEntry
  {
<span class="udiff-line-modified-removed">-   friend struct SVG;</span>
<span class="udiff-line-modified-added">+   int cmp (hb_codepoint_t g) const</span>
<span class="udiff-line-added">+   { return g &lt; startGlyphID ? -1 : g &gt; endGlyphID ? 1 : 0; }</span>
  
<span class="udiff-line-modified-removed">-   inline bool sanitize (hb_sanitize_context_t *c, const void* base) const</span>
<span class="udiff-line-modified-added">+   hb_blob_t *reference_blob (hb_blob_t *svg_blob, unsigned int index_offset) const</span>
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+     return hb_blob_create_sub_blob (svg_blob,</span>
<span class="udiff-line-added">+                                     index_offset + (unsigned int) svgDoc,</span>
<span class="udiff-line-added">+                                     svgDocLength);</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   bool sanitize (hb_sanitize_context_t *c, const void *base) const</span>
    {
      TRACE_SANITIZE (this);
      return_trace (c-&gt;check_struct (this) &amp;&amp;
<span class="udiff-line-modified-removed">-                   (base+svgDoc).sanitize (c, svgDocLength));</span>
<span class="udiff-line-modified-added">+                   svgDoc.sanitize (c, base, svgDocLength));</span>
    }
  
    protected:
    HBUINT16      startGlyphID;   /* The first glyph ID in the range described by
                                   * this index entry. */
    HBUINT16      endGlyphID;     /* The last glyph ID in the range described by
                                   * this index entry. Must be &gt;= startGlyphID. */
<span class="udiff-line-modified-removed">-   LOffsetTo&lt;UnsizedArrayOf&lt;HBUINT8&gt; &gt;</span>
<span class="udiff-line-modified-added">+   LNNOffsetTo&lt;UnsizedArrayOf&lt;HBUINT8&gt; &gt;</span>
                  svgDoc;         /* Offset from the beginning of the SVG Document Index
                                   * to an SVG document. Must be non-zero. */
<span class="udiff-line-modified-removed">-   HBUINT32 svgDocLength;        /* Length of the SVG document.</span>
<span class="udiff-line-modified-added">+   HBUINT32      svgDocLength;   /* Length of the SVG document.</span>
                                   * Must be non-zero. */
    public:
    DEFINE_SIZE_STATIC (12);
  };
  
<span class="udiff-line-removed">- struct SVGDocumentIndex</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-   friend struct SVG;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   inline bool sanitize (hb_sanitize_context_t *c) const</span>
<span class="udiff-line-removed">-   {</span>
<span class="udiff-line-removed">-     TRACE_SANITIZE (this);</span>
<span class="udiff-line-removed">-     return_trace (c-&gt;check_struct (this) &amp;&amp;</span>
<span class="udiff-line-removed">-                   entries.sanitize (c, this));</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   protected:</span>
<span class="udiff-line-removed">-   ArrayOf&lt;SVGDocumentIndexEntry&gt;</span>
<span class="udiff-line-removed">-                 entries;        /* Array of SVG Document Index Entries. */</span>
<span class="udiff-line-removed">-   public:</span>
<span class="udiff-line-removed">-   DEFINE_SIZE_ARRAY (2, entries);</span>
<span class="udiff-line-removed">- };</span>
<span class="udiff-line-removed">- </span>
  struct SVG
  {
<span class="udiff-line-modified-removed">-   static const hb_tag_t tableTag = HB_OT_TAG_SVG;</span>
<span class="udiff-line-modified-added">+   static constexpr hb_tag_t tableTag = HB_OT_TAG_SVG;</span>
  
<span class="udiff-line-modified-removed">-   inline bool sanitize (hb_sanitize_context_t *c) const</span>
<span class="udiff-line-removed">-   {</span>
<span class="udiff-line-removed">-     TRACE_SANITIZE (this);</span>
<span class="udiff-line-removed">-     return_trace (likely (c-&gt;check_struct (this) &amp;&amp;</span>
<span class="udiff-line-removed">-                           (this+svgDocIndex).sanitize (c)));</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-modified-added">+   bool has_data () const { return svgDocEntries; }</span>
  
    struct accelerator_t
    {
<span class="udiff-line-modified-removed">-     inline void init (hb_face_t *face)</span>
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       OT::Sanitizer&lt;OT::SVG&gt; sanitizer;</span>
<span class="udiff-line-removed">-       svg_blob = sanitizer.sanitize (face-&gt;reference_table (HB_OT_TAG_SVG));</span>
<span class="udiff-line-removed">-       svg_len = hb_blob_get_length (svg_blob);</span>
<span class="udiff-line-removed">-       svg = svg_blob-&gt;as&lt;OT::SVG&gt; ();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+     void init (hb_face_t *face)</span>
<span class="udiff-line-modified-added">+     { table = hb_sanitize_context_t().reference_table&lt;SVG&gt; (face); }</span>
<span class="udiff-line-modified-added">+     void fini () { table.destroy (); }</span>
  
<span class="udiff-line-modified-removed">-     inline void fini (void)</span>
<span class="udiff-line-modified-added">+     hb_blob_t *reference_blob_for_glyph (hb_codepoint_t glyph_id) const</span>
      {
<span class="udiff-line-modified-removed">-       hb_blob_destroy (svg_blob);</span>
<span class="udiff-line-modified-added">+       return table-&gt;get_glyph_entry (glyph_id).reference_blob (table.get_blob (),</span>
<span class="udiff-line-added">+                                                                table-&gt;svgDocEntries);</span>
      }
  
<span class="udiff-line-modified-removed">-     inline void</span>
<span class="udiff-line-removed">-     dump (void (*callback) (const uint8_t* data, unsigned int length,</span>
<span class="udiff-line-removed">-                             unsigned int start_glyph, unsigned int end_glyph)) const</span>
<span class="udiff-line-removed">-     {</span>
<span class="udiff-line-removed">-       const SVGDocumentIndex &amp;index = svg+svg-&gt;svgDocIndex;</span>
<span class="udiff-line-removed">-       const ArrayOf&lt;SVGDocumentIndexEntry&gt; &amp;entries = index.entries;</span>
<span class="udiff-line-removed">-       for (unsigned int i = 0; i &lt; entries.len; ++i)</span>
<span class="udiff-line-removed">-       {</span>
<span class="udiff-line-removed">-         const SVGDocumentIndexEntry &amp;entry = entries[i];</span>
<span class="udiff-line-removed">-         callback ((const uint8_t*) &amp;entry.svgDoc (&amp;index), entry.svgDocLength,</span>
<span class="udiff-line-removed">-                                                   entry.startGlyphID, entry.endGlyphID);</span>
<span class="udiff-line-removed">-       }</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+     bool has_data () const { return table-&gt;has_data (); }</span>
  
      private:
<span class="udiff-line-modified-removed">-     hb_blob_t *svg_blob;</span>
<span class="udiff-line-removed">-     const SVG *svg;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     unsigned int svg_len;</span>
<span class="udiff-line-modified-added">+     hb_blob_ptr_t&lt;SVG&gt; table;</span>
    };
  
<span class="udiff-line-added">+   const SVGDocumentIndexEntry &amp;get_glyph_entry (hb_codepoint_t glyph_id) const</span>
<span class="udiff-line-added">+   { return (this+svgDocEntries).bsearch (glyph_id); }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   bool sanitize (hb_sanitize_context_t *c) const</span>
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+     TRACE_SANITIZE (this);</span>
<span class="udiff-line-added">+     return_trace (likely (c-&gt;check_struct (this) &amp;&amp;</span>
<span class="udiff-line-added">+                           (this+svgDocEntries).sanitize_shallow (c)));</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
    protected:
    HBUINT16      version;        /* Table version (starting at 0). */
<span class="udiff-line-modified-removed">-   LOffsetTo&lt;SVGDocumentIndex&gt;</span>
<span class="udiff-line-modified-removed">-                 svgDocIndex;    /* Offset (relative to the start of the SVG table) to the</span>
<span class="udiff-line-modified-added">+   LOffsetTo&lt;SortedArrayOf&lt;SVGDocumentIndexEntry&gt; &gt;</span>
<span class="udiff-line-modified-added">+                 svgDocEntries;  /* Offset (relative to the start of the SVG table) to the</span>
                                   * SVG Documents Index. Must be non-zero. */
<span class="udiff-line-added">+                                 /* Array of SVG Document Index Entries. */</span>
    HBUINT32      reserved;       /* Set to 0. */
    public:
    DEFINE_SIZE_STATIC (10);
  };
  
<span class="udiff-line-added">+ struct SVG_accelerator_t : SVG::accelerator_t {};</span>
<span class="udiff-line-added">+ </span>
  } /* namespace OT */
  
  
  #endif /* HB_OT_COLOR_SVG_TABLE_HH */
</pre>
<center><a href="hb-ot-color-sbix-table.hh.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="hb-ot-font.cc.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>