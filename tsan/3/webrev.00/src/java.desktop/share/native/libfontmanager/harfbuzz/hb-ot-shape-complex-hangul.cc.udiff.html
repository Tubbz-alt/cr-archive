<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/share/native/libfontmanager/harfbuzz/hb-ot-shape-complex-hangul.cc</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="hb-ot-shape-complex-default.cc.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="hb-ot-shape-complex-hebrew.cc.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfontmanager/harfbuzz/hb-ot-shape-complex-hangul.cc</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -22,11 +22,11 @@</span>
   * PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS.
   *
   * Google Author(s): Behdad Esfahbod
   */
  
<span class="udiff-line-modified-removed">- #include &quot;hb-ot-shape-complex-private.hh&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;hb-ot-shape-complex.hh&quot;</span>
  
  
  /* Hangul shaper */
  
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -54,26 +54,24 @@</span>
  collect_features_hangul (hb_ot_shape_planner_t *plan)
  {
    hb_ot_map_builder_t *map = &amp;plan-&gt;map;
  
    for (unsigned int i = FIRST_HANGUL_FEATURE; i &lt; HANGUL_FEATURE_COUNT; i++)
<span class="udiff-line-modified-removed">-     map-&gt;add_feature (hangul_features[i], 1, F_NONE);</span>
<span class="udiff-line-modified-added">+     map-&gt;add_feature (hangul_features[i]);</span>
  }
  
  static void
  override_features_hangul (hb_ot_shape_planner_t *plan)
  {
    /* Uniscribe does not apply &#39;calt&#39; for Hangul, and certain fonts
     * (Noto Sans CJK, Source Sans Han, etc) apply all of jamo lookups
     * in calt, which is not desirable. */
<span class="udiff-line-modified-removed">-   plan-&gt;map.add_feature (HB_TAG(&#39;c&#39;,&#39;a&#39;,&#39;l&#39;,&#39;t&#39;), 0, F_GLOBAL);</span>
<span class="udiff-line-modified-added">+   plan-&gt;map.disable_feature (HB_TAG(&#39;c&#39;,&#39;a&#39;,&#39;l&#39;,&#39;t&#39;));</span>
  }
  
  struct hangul_shape_plan_t
  {
<span class="udiff-line-removed">-   ASSERT_POD ();</span>
<span class="udiff-line-removed">- </span>
    hb_mask_t mask_array[HANGUL_FEATURE_COUNT];
  };
  
  static void *
  data_create_hangul (const hb_ot_shape_plan_t *plan)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -126,11 +124,11 @@</span>
    hb_codepoint_t glyph;
    return hb_font_get_glyph (font, unicode, 0, &amp;glyph) &amp;&amp; hb_font_get_glyph_h_advance (font, glyph) == 0;
  }
  
  static void
<span class="udiff-line-modified-removed">- preprocess_text_hangul (const hb_ot_shape_plan_t *plan,</span>
<span class="udiff-line-modified-added">+ preprocess_text_hangul (const hb_ot_shape_plan_t *plan HB_UNUSED,</span>
                          hb_buffer_t              *buffer,
                          hb_font_t                *font)
  {
    HB_BUFFER_ALLOCATE_VAR (buffer, hangul_shaping_feature);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -343,33 +341,35 @@</span>
              font-&gt;has_glyph (decomposed[1]) &amp;&amp;
              (!tindex || font-&gt;has_glyph (decomposed[2])))
          {
            unsigned int s_len = tindex ? 3 : 2;
            buffer-&gt;replace_glyphs (1, s_len, decomposed);
<span class="udiff-line-removed">-           if (unlikely (!buffer-&gt;successful))</span>
<span class="udiff-line-removed">-             return;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-           /* We decomposed S: apply jamo features to the individual glyphs</span>
<span class="udiff-line-removed">-            * that are now in buffer-&gt;out_info.</span>
<span class="udiff-line-removed">-            */</span>
<span class="udiff-line-removed">-           hb_glyph_info_t *info = buffer-&gt;out_info;</span>
  
            /* If we decomposed an LV because of a non-combining T following,
             * we want to include this T in the syllable.
             */
            if (has_glyph &amp;&amp; !tindex)
            {
              buffer-&gt;next_glyph ();
              s_len++;
            }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+           if (unlikely (!buffer-&gt;successful))</span>
<span class="udiff-line-added">+             return;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+           /* We decomposed S: apply jamo features to the individual glyphs</span>
<span class="udiff-line-added">+            * that are now in buffer-&gt;out_info.</span>
<span class="udiff-line-added">+            */</span>
<span class="udiff-line-added">+           hb_glyph_info_t *info = buffer-&gt;out_info;</span>
            end = start + s_len;
  
            unsigned int i = start;
            info[i++].hangul_shaping_feature() = LJMO;
            info[i++].hangul_shaping_feature() = VJMO;
            if (i &lt; end)
              info[i++].hangul_shaping_feature() = TJMO;
<span class="udiff-line-added">+ </span>
            if (buffer-&gt;cluster_level == HB_BUFFER_CLUSTER_LEVEL_MONOTONE_GRAPHEMES)
              buffer-&gt;merge_out_clusters (start, end);
            continue;
          }
          else if ((!tindex &amp;&amp; buffer-&gt;idx + 1 &lt; count &amp;&amp; isT (buffer-&gt;cur(+1).codepoint)))
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -422,10 +422,10 @@</span>
    nullptr, /* postprocess_glyphs */
    HB_OT_SHAPE_NORMALIZATION_MODE_NONE,
    nullptr, /* decompose */
    nullptr, /* compose */
    setup_masks_hangul,
<span class="udiff-line-modified-removed">-   nullptr, /* disable_otl */</span>
<span class="udiff-line-modified-added">+   HB_TAG_NONE, /* gpos_tag */</span>
    nullptr, /* reorder_marks */
    HB_OT_SHAPE_ZERO_WIDTH_MARKS_NONE,
    false, /* fallback_position */
  };
</pre>
<center><a href="hb-ot-shape-complex-default.cc.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="hb-ot-shape-complex-hebrew.cc.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>