<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/native/libfontmanager/harfbuzz/hb-shape.cc</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="hb-shape-plan.cc.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="hb-shaper-list.hh.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfontmanager/harfbuzz/hb-shape.cc</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  9  * software and its documentation for any purpose, provided that the
 10  * above copyright notice and the following two paragraphs appear in
 11  * all copies of this software.
 12  *
 13  * IN NO EVENT SHALL THE COPYRIGHT HOLDER BE LIABLE TO ANY PARTY FOR
 14  * DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES
 15  * ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN
 16  * IF THE COPYRIGHT HOLDER HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH
 17  * DAMAGE.
 18  *
 19  * THE COPYRIGHT HOLDER SPECIFICALLY DISCLAIMS ANY WARRANTIES, INCLUDING,
 20  * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
 21  * FITNESS FOR A PARTICULAR PURPOSE.  THE SOFTWARE PROVIDED HEREUNDER IS
 22  * ON AN &quot;AS IS&quot; BASIS, AND THE COPYRIGHT HOLDER HAS NO OBLIGATION TO
 23  * PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS.
 24  *
 25  * Red Hat Author(s): Behdad Esfahbod
 26  * Google Author(s): Behdad Esfahbod
 27  */
 28 
<span class="line-modified"> 29 #include &quot;hb-private.hh&quot;</span>






 30 
<span class="line-removed"> 31 #include &quot;hb-shaper-private.hh&quot;</span>
<span class="line-removed"> 32 #include &quot;hb-shape-plan-private.hh&quot;</span>
<span class="line-removed"> 33 #include &quot;hb-buffer-private.hh&quot;</span>
<span class="line-removed"> 34 #include &quot;hb-font-private.hh&quot;</span>
 35 
 36 /**
 37  * SECTION:hb-shape
<span class="line-modified"> 38  * @title: Shaping</span>
 39  * @short_description: Conversion of text strings into positioned glyphs
 40  * @include: hb.h
 41  *
 42  * Shaping is the central operation of HarfBuzz. Shaping operates on buffers,
 43  * which are sequences of Unicode characters that use the same font and have
<span class="line-modified"> 44  * the same text direction, script and language. After shaping the buffer</span>
 45  * contains the output glyphs and their positions.
 46  **/
 47 
<span class="line-removed"> 48 static const char **static_shaper_list;</span>
 49 
<span class="line-modified"> 50 #ifdef HB_USE_ATEXIT</span>
<span class="line-modified"> 51 static</span>
<span class="line-modified"> 52 void free_static_shaper_list (void)</span>





 53 {
<span class="line-modified"> 54 retry:</span>
<span class="line-modified"> 55   const char **shaper_list = (const char **) hb_atomic_ptr_get (&amp;static_shaper_list);</span>
<span class="line-modified"> 56   if (!hb_atomic_ptr_cmpexch (&amp;static_shaper_list, shaper_list, nullptr))</span>
<span class="line-modified"> 57     goto retry;</span>



















 58 
<span class="line-modified"> 59   free (shaper_list);</span>




 60 }
 61 #endif
 62 

 63 /**
 64  * hb_shape_list_shapers:
 65  *
 66  * Retrieves the list of shapers supported by HarfBuzz.
 67  *
 68  * Return value: (transfer none) (array zero-terminated=1): an array of
 69  *    constant strings
 70  *
 71  * Since: 0.9.2
 72  **/
 73 const char **
<span class="line-modified"> 74 hb_shape_list_shapers (void)</span>
 75 {
<span class="line-modified"> 76 retry:</span>
<span class="line-removed"> 77   const char **shaper_list = (const char **) hb_atomic_ptr_get (&amp;static_shaper_list);</span>
<span class="line-removed"> 78 </span>
<span class="line-removed"> 79   if (unlikely (!shaper_list))</span>
<span class="line-removed"> 80   {</span>
<span class="line-removed"> 81     /* Not found; allocate one. */</span>
<span class="line-removed"> 82     shaper_list = (const char **) calloc (1 + HB_SHAPERS_COUNT, sizeof (const char *));</span>
<span class="line-removed"> 83     if (unlikely (!shaper_list)) {</span>
<span class="line-removed"> 84       static const char *nil_shaper_list[] = {nullptr};</span>
<span class="line-removed"> 85       return nil_shaper_list;</span>
<span class="line-removed"> 86     }</span>
<span class="line-removed"> 87 </span>
<span class="line-removed"> 88     const hb_shaper_pair_t *shapers = _hb_shapers_get ();</span>
<span class="line-removed"> 89     unsigned int i;</span>
<span class="line-removed"> 90     for (i = 0; i &lt; HB_SHAPERS_COUNT; i++)</span>
<span class="line-removed"> 91       shaper_list[i] = shapers[i].name;</span>
<span class="line-removed"> 92     shaper_list[i] = nullptr;</span>
<span class="line-removed"> 93 </span>
<span class="line-removed"> 94     if (!hb_atomic_ptr_cmpexch (&amp;static_shaper_list, nullptr, shaper_list)) {</span>
<span class="line-removed"> 95       free (shaper_list);</span>
<span class="line-removed"> 96       goto retry;</span>
<span class="line-removed"> 97     }</span>
<span class="line-removed"> 98 </span>
<span class="line-removed"> 99 #ifdef HB_USE_ATEXIT</span>
<span class="line-removed">100     atexit (free_static_shaper_list); /* First person registers atexit() callback. */</span>
<span class="line-removed">101 #endif</span>
<span class="line-removed">102   }</span>
<span class="line-removed">103 </span>
<span class="line-removed">104   return shaper_list;</span>
105 }
106 
107 
108 /**
109  * hb_shape_full:
110  * @font: an #hb_font_t to use for shaping
111  * @buffer: an #hb_buffer_t to shape
112  * @features: (array length=num_features) (allow-none): an array of user
113  *    specified #hb_feature_t or %NULL
114  * @num_features: the length of @features array
115  * @shaper_list: (array zero-terminated=1) (allow-none): a %NULL-terminated
116  *    array of shapers to use or %NULL
117  *
118  * See hb_shape() for details. If @shaper_list is not %NULL, the specified
119  * shapers will be used in the given order, otherwise the default shapers list
120  * will be used.
121  *
122  * Return value: false if all shapers failed, true otherwise
123  *
124  * Since: 0.9.2
</pre>
</td>
<td>
<hr />
<pre>
  9  * software and its documentation for any purpose, provided that the
 10  * above copyright notice and the following two paragraphs appear in
 11  * all copies of this software.
 12  *
 13  * IN NO EVENT SHALL THE COPYRIGHT HOLDER BE LIABLE TO ANY PARTY FOR
 14  * DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES
 15  * ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN
 16  * IF THE COPYRIGHT HOLDER HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH
 17  * DAMAGE.
 18  *
 19  * THE COPYRIGHT HOLDER SPECIFICALLY DISCLAIMS ANY WARRANTIES, INCLUDING,
 20  * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
 21  * FITNESS FOR A PARTICULAR PURPOSE.  THE SOFTWARE PROVIDED HEREUNDER IS
 22  * ON AN &quot;AS IS&quot; BASIS, AND THE COPYRIGHT HOLDER HAS NO OBLIGATION TO
 23  * PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS.
 24  *
 25  * Red Hat Author(s): Behdad Esfahbod
 26  * Google Author(s): Behdad Esfahbod
 27  */
 28 
<span class="line-modified"> 29 #include &quot;hb.hh&quot;</span>
<span class="line-added"> 30 </span>
<span class="line-added"> 31 #include &quot;hb-shaper.hh&quot;</span>
<span class="line-added"> 32 #include &quot;hb-shape-plan.hh&quot;</span>
<span class="line-added"> 33 #include &quot;hb-buffer.hh&quot;</span>
<span class="line-added"> 34 #include &quot;hb-font.hh&quot;</span>
<span class="line-added"> 35 #include &quot;hb-machinery.hh&quot;</span>
 36 




 37 
 38 /**
 39  * SECTION:hb-shape
<span class="line-modified"> 40  * @title: hb-shape</span>
 41  * @short_description: Conversion of text strings into positioned glyphs
 42  * @include: hb.h
 43  *
 44  * Shaping is the central operation of HarfBuzz. Shaping operates on buffers,
 45  * which are sequences of Unicode characters that use the same font and have
<span class="line-modified"> 46  * the same text direction, script, and language. After shaping the buffer</span>
 47  * contains the output glyphs and their positions.
 48  **/
 49 

 50 
<span class="line-modified"> 51 #if HB_USE_ATEXIT</span>
<span class="line-modified"> 52 static void free_static_shaper_list ();</span>
<span class="line-modified"> 53 #endif</span>
<span class="line-added"> 54 </span>
<span class="line-added"> 55 static const char *nil_shaper_list[] = {nullptr};</span>
<span class="line-added"> 56 </span>
<span class="line-added"> 57 static struct hb_shaper_list_lazy_loader_t : hb_lazy_loader_t&lt;const char *,</span>
<span class="line-added"> 58                                                               hb_shaper_list_lazy_loader_t&gt;</span>
 59 {
<span class="line-modified"> 60   static const char ** create ()</span>
<span class="line-modified"> 61   {</span>
<span class="line-modified"> 62     const char **shaper_list = (const char **) calloc (1 + HB_SHAPERS_COUNT, sizeof (const char *));</span>
<span class="line-modified"> 63     if (unlikely (!shaper_list))</span>
<span class="line-added"> 64       return nullptr;</span>
<span class="line-added"> 65 </span>
<span class="line-added"> 66     const hb_shaper_entry_t *shapers = _hb_shapers_get ();</span>
<span class="line-added"> 67     unsigned int i;</span>
<span class="line-added"> 68     for (i = 0; i &lt; HB_SHAPERS_COUNT; i++)</span>
<span class="line-added"> 69       shaper_list[i] = shapers[i].name;</span>
<span class="line-added"> 70     shaper_list[i] = nullptr;</span>
<span class="line-added"> 71 </span>
<span class="line-added"> 72 #if HB_USE_ATEXIT</span>
<span class="line-added"> 73     atexit (free_static_shaper_list);</span>
<span class="line-added"> 74 #endif</span>
<span class="line-added"> 75 </span>
<span class="line-added"> 76     return shaper_list;</span>
<span class="line-added"> 77   }</span>
<span class="line-added"> 78   static void destroy (const char **l)</span>
<span class="line-added"> 79   { free (l); }</span>
<span class="line-added"> 80   static const char ** get_null ()</span>
<span class="line-added"> 81   { return nil_shaper_list; }</span>
<span class="line-added"> 82 } static_shaper_list;</span>
 83 
<span class="line-modified"> 84 #if HB_USE_ATEXIT</span>
<span class="line-added"> 85 static</span>
<span class="line-added"> 86 void free_static_shaper_list ()</span>
<span class="line-added"> 87 {</span>
<span class="line-added"> 88   static_shaper_list.free_instance ();</span>
 89 }
 90 #endif
 91 
<span class="line-added"> 92 </span>
 93 /**
 94  * hb_shape_list_shapers:
 95  *
 96  * Retrieves the list of shapers supported by HarfBuzz.
 97  *
 98  * Return value: (transfer none) (array zero-terminated=1): an array of
 99  *    constant strings
100  *
101  * Since: 0.9.2
102  **/
103 const char **
<span class="line-modified">104 hb_shape_list_shapers ()</span>
105 {
<span class="line-modified">106   return static_shaper_list.get_unconst ();</span>




























107 }
108 
109 
110 /**
111  * hb_shape_full:
112  * @font: an #hb_font_t to use for shaping
113  * @buffer: an #hb_buffer_t to shape
114  * @features: (array length=num_features) (allow-none): an array of user
115  *    specified #hb_feature_t or %NULL
116  * @num_features: the length of @features array
117  * @shaper_list: (array zero-terminated=1) (allow-none): a %NULL-terminated
118  *    array of shapers to use or %NULL
119  *
120  * See hb_shape() for details. If @shaper_list is not %NULL, the specified
121  * shapers will be used in the given order, otherwise the default shapers list
122  * will be used.
123  *
124  * Return value: false if all shapers failed, true otherwise
125  *
126  * Since: 0.9.2
</pre>
</td>
</tr>
</table>
<center><a href="hb-shape-plan.cc.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="hb-shaper-list.hh.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>