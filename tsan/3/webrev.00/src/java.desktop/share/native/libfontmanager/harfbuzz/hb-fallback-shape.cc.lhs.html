<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.desktop/share/native/libfontmanager/harfbuzz/hb-fallback-shape.cc</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright Â© 2011  Google, Inc.
  3  *
  4  *  This is part of HarfBuzz, a text shaping library.
  5  *
  6  * Permission is hereby granted, without written agreement and without
  7  * license or royalty fees, to use, copy, modify, and distribute this
  8  * software and its documentation for any purpose, provided that the
  9  * above copyright notice and the following two paragraphs appear in
 10  * all copies of this software.
 11  *
 12  * IN NO EVENT SHALL THE COPYRIGHT HOLDER BE LIABLE TO ANY PARTY FOR
 13  * DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES
 14  * ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN
 15  * IF THE COPYRIGHT HOLDER HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH
 16  * DAMAGE.
 17  *
 18  * THE COPYRIGHT HOLDER SPECIFICALLY DISCLAIMS ANY WARRANTIES, INCLUDING,
 19  * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
 20  * FITNESS FOR A PARTICULAR PURPOSE.  THE SOFTWARE PROVIDED HEREUNDER IS
 21  * ON AN &quot;AS IS&quot; BASIS, AND THE COPYRIGHT HOLDER HAS NO OBLIGATION TO
 22  * PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS.
 23  *
 24  * Google Author(s): Behdad Esfahbod
 25  */
 26 
<a name="1" id="anc1"></a><span class="line-modified"> 27 #define HB_SHAPER fallback</span>
<span class="line-removed"> 28 #include &quot;hb-shaper-impl-private.hh&quot;</span>
<span class="line-removed"> 29 </span>
<span class="line-removed"> 30 </span>
<span class="line-removed"> 31 HB_SHAPER_DATA_ENSURE_DEFINE(fallback, face)</span>
<span class="line-removed"> 32 HB_SHAPER_DATA_ENSURE_DEFINE(fallback, font)</span>
 33 
 34 
 35 /*
 36  * shaper face data
 37  */
 38 
<a name="2" id="anc2"></a><span class="line-modified"> 39 struct hb_fallback_shaper_face_data_t {};</span>
 40 
<a name="3" id="anc3"></a><span class="line-modified"> 41 hb_fallback_shaper_face_data_t *</span>
 42 _hb_fallback_shaper_face_data_create (hb_face_t *face HB_UNUSED)
 43 {
<a name="4" id="anc4"></a><span class="line-modified"> 44   return (hb_fallback_shaper_face_data_t *) HB_SHAPER_DATA_SUCCEEDED;</span>
 45 }
 46 
 47 void
<a name="5" id="anc5"></a><span class="line-modified"> 48 _hb_fallback_shaper_face_data_destroy (hb_fallback_shaper_face_data_t *data HB_UNUSED)</span>
 49 {
 50 }
 51 
 52 
 53 /*
 54  * shaper font data
 55  */
 56 
<a name="6" id="anc6"></a><span class="line-modified"> 57 struct hb_fallback_shaper_font_data_t {};</span>
 58 
<a name="7" id="anc7"></a><span class="line-modified"> 59 hb_fallback_shaper_font_data_t *</span>
 60 _hb_fallback_shaper_font_data_create (hb_font_t *font HB_UNUSED)
 61 {
<a name="8" id="anc8"></a><span class="line-modified"> 62   return (hb_fallback_shaper_font_data_t *) HB_SHAPER_DATA_SUCCEEDED;</span>
<span class="line-removed"> 63 }</span>
<span class="line-removed"> 64 </span>
<span class="line-removed"> 65 void</span>
<span class="line-removed"> 66 _hb_fallback_shaper_font_data_destroy (hb_fallback_shaper_font_data_t *data HB_UNUSED)</span>
<span class="line-removed"> 67 {</span>
<span class="line-removed"> 68 }</span>
<span class="line-removed"> 69 </span>
<span class="line-removed"> 70 </span>
<span class="line-removed"> 71 /*</span>
<span class="line-removed"> 72  * shaper shape_plan data</span>
<span class="line-removed"> 73  */</span>
<span class="line-removed"> 74 </span>
<span class="line-removed"> 75 struct hb_fallback_shaper_shape_plan_data_t {};</span>
<span class="line-removed"> 76 </span>
<span class="line-removed"> 77 hb_fallback_shaper_shape_plan_data_t *</span>
<span class="line-removed"> 78 _hb_fallback_shaper_shape_plan_data_create (hb_shape_plan_t    *shape_plan HB_UNUSED,</span>
<span class="line-removed"> 79                                             const hb_feature_t *user_features HB_UNUSED,</span>
<span class="line-removed"> 80                                             unsigned int        num_user_features HB_UNUSED,</span>
<span class="line-removed"> 81                                             const int          *coords HB_UNUSED,</span>
<span class="line-removed"> 82                                             unsigned int        num_coords HB_UNUSED)</span>
<span class="line-removed"> 83 {</span>
<span class="line-removed"> 84   return (hb_fallback_shaper_shape_plan_data_t *) HB_SHAPER_DATA_SUCCEEDED;</span>
 85 }
 86 
 87 void
<a name="9" id="anc9"></a><span class="line-modified"> 88 _hb_fallback_shaper_shape_plan_data_destroy (hb_fallback_shaper_shape_plan_data_t *data HB_UNUSED)</span>
 89 {
 90 }
 91 
 92 
 93 /*
 94  * shaper
 95  */
 96 
 97 hb_bool_t
 98 _hb_fallback_shape (hb_shape_plan_t    *shape_plan HB_UNUSED,
 99                     hb_font_t          *font,
100                     hb_buffer_t        *buffer,
101                     const hb_feature_t *features HB_UNUSED,
102                     unsigned int        num_features HB_UNUSED)
103 {
104   /* TODO
105    *
106    * - Apply fallback kern.
107    * - Handle Variation Selectors?
108    * - Apply normalization?
109    *
110    * This will make the fallback shaper into a dumb &quot;TrueType&quot;
111    * shaper which many people unfortunately still request.
112    */
113 
114   hb_codepoint_t space;
115   bool has_space = (bool) font-&gt;get_nominal_glyph (&#39; &#39;, &amp;space);
116 
117   buffer-&gt;clear_positions ();
118 
119   hb_direction_t direction = buffer-&gt;props.direction;
120   hb_unicode_funcs_t *unicode = buffer-&gt;unicode;
121   unsigned int count = buffer-&gt;len;
122   hb_glyph_info_t *info = buffer-&gt;info;
123   hb_glyph_position_t *pos = buffer-&gt;pos;
124   for (unsigned int i = 0; i &lt; count; i++)
125   {
126     if (has_space &amp;&amp; unicode-&gt;is_default_ignorable (info[i].codepoint)) {
127       info[i].codepoint = space;
128       pos[i].x_advance = 0;
129       pos[i].y_advance = 0;
130       continue;
131     }
132     (void) font-&gt;get_nominal_glyph (info[i].codepoint, &amp;info[i].codepoint);
133     font-&gt;get_glyph_advance_for_direction (info[i].codepoint,
134                                            direction,
135                                            &amp;pos[i].x_advance,
136                                            &amp;pos[i].y_advance);
137     font-&gt;subtract_glyph_origin_for_direction (info[i].codepoint,
138                                                direction,
139                                                &amp;pos[i].x_offset,
140                                                &amp;pos[i].y_offset);
141   }
142 
143   if (HB_DIRECTION_IS_BACKWARD (direction))
144     hb_buffer_reverse (buffer);
145 
146   buffer-&gt;safe_to_break_all ();
147 
148   return true;
149 }
<a name="10" id="anc10"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="10" type="hidden" />
</body>
</html>