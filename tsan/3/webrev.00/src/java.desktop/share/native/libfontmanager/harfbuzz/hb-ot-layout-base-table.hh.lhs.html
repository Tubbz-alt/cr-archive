<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.desktop/share/native/libfontmanager/harfbuzz/hb-ot-layout-base-table.hh</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright © 2016 Elie Roux &lt;elie.roux@telecom-bretagne.eu&gt;
  3  * Copyright © 2018  Google, Inc.
<a name="1" id="anc1"></a>
  4  *
  5  *  This is part of HarfBuzz, a text shaping library.
  6  *
  7  * Permission is hereby granted, without written agreement and without
  8  * license or royalty fees, to use, copy, modify, and distribute this
  9  * software and its documentation for any purpose, provided that the
 10  * above copyright notice and the following two paragraphs appear in
 11  * all copies of this software.
 12  *
 13  * IN NO EVENT SHALL THE COPYRIGHT HOLDER BE LIABLE TO ANY PARTY FOR
 14  * DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES
 15  * ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN
 16  * IF THE COPYRIGHT HOLDER HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH
 17  * DAMAGE.
 18  *
 19  * THE COPYRIGHT HOLDER SPECIFICALLY DISCLAIMS ANY WARRANTIES, INCLUDING,
 20  * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
 21  * FITNESS FOR A PARTICULAR PURPOSE.  THE SOFTWARE PROVIDED HEREUNDER IS
 22  * ON AN &quot;AS IS&quot; BASIS, AND THE COPYRIGHT HOLDER HAS NO OBLIGATION TO
 23  * PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS.
 24  *
 25  * Google Author(s): Behdad Esfahbod
 26  */
 27 
 28 #ifndef HB_OT_LAYOUT_BASE_TABLE_HH
 29 #define HB_OT_LAYOUT_BASE_TABLE_HH
 30 
<a name="2" id="anc2"></a><span class="line-modified"> 31 #include &quot;hb-open-type-private.hh&quot;</span>
<span class="line-modified"> 32 #include &quot;hb-ot-layout-common-private.hh&quot;</span>
 33 
<a name="3" id="anc3"></a><span class="line-modified"> 34 namespace OT {</span>

 35 
<a name="4" id="anc4"></a><span class="line-modified"> 36 #define NOT_INDEXED   ((unsigned int) -1)</span>
 37 
 38 /*
 39  * BASE -- Baseline
 40  * https://docs.microsoft.com/en-us/typography/opentype/spec/base
 41  */
 42 
 43 struct BaseCoordFormat1
 44 {
<a name="5" id="anc5"></a><span class="line-modified"> 45   inline int get_coord (void) const { return coordinate; }</span>
 46 
<a name="6" id="anc6"></a><span class="line-modified"> 47   inline bool sanitize (hb_sanitize_context_t *c) const</span>
 48   {
 49     TRACE_SANITIZE (this);
<a name="7" id="anc7"></a><span class="line-modified"> 50     return_trace (c-&gt;check_struct (this));</span>
 51   }
 52 
 53   protected:
 54   HBUINT16      format;         /* Format identifier--format = 1 */
<a name="8" id="anc8"></a><span class="line-modified"> 55   HBINT16       coordinate;     /* X or Y value, in design units */</span>
 56   public:
 57   DEFINE_SIZE_STATIC (4);
 58 };
 59 
 60 struct BaseCoordFormat2
 61 {
<a name="9" id="anc9"></a><span class="line-modified"> 62   inline int get_coord (void) const</span>
 63   {
 64     /* TODO */
 65     return coordinate;
 66   }
 67 
<a name="10" id="anc10"></a><span class="line-modified"> 68   inline bool sanitize (hb_sanitize_context_t *c) const</span>
 69   {
 70     TRACE_SANITIZE (this);
 71     return_trace (c-&gt;check_struct (this));
 72   }
 73 
 74   protected:
 75   HBUINT16      format;         /* Format identifier--format = 2 */
<a name="11" id="anc11"></a><span class="line-modified"> 76   HBINT16       coordinate;     /* X or Y value, in design units */</span>
 77   GlyphID       referenceGlyph; /* Glyph ID of control glyph */
 78   HBUINT16      coordPoint;     /* Index of contour point on the
 79                                  * reference glyph */
 80   public:
 81   DEFINE_SIZE_STATIC (8);
 82 };
 83 
 84 struct BaseCoordFormat3
 85 {
<a name="12" id="anc12"></a><span class="line-modified"> 86   inline int get_coord (void) const</span>


 87   {
<a name="13" id="anc13"></a><span class="line-modified"> 88     /* TODO */</span>
<span class="line-modified"> 89     return coordinate;</span>


 90   }
 91 
<a name="14" id="anc14"></a><span class="line-modified"> 92   inline bool sanitize (hb_sanitize_context_t *c) const</span>

 93   {
 94     TRACE_SANITIZE (this);
<a name="15" id="anc15"></a><span class="line-modified"> 95     return_trace (c-&gt;check_struct (this) &amp;&amp; deviceTable.sanitize (c, this));</span>

 96   }
 97 
 98   protected:
<a name="16" id="anc16"></a><span class="line-modified"> 99   HBUINT16              format;         /* Format identifier--format = 3 */</span>
<span class="line-modified">100   HBINT16               coordinate;     /* X or Y value, in design units */</span>
<span class="line-modified">101   OffsetTo&lt;Device&gt;      deviceTable;    /* Offset to Device table for X or</span>
<span class="line-modified">102                                          * Y value, from beginning of</span>
<span class="line-modified">103                                          * BaseCoord table (may be NULL). */</span>

104   public:
105   DEFINE_SIZE_STATIC (6);
106 };
107 
108 struct BaseCoord
109 {
<a name="17" id="anc17"></a><span class="line-modified">110   inline int get_coord (void) const</span>


111   {
112     switch (u.format) {
113     case 1: return u.format1.get_coord ();
114     case 2: return u.format2.get_coord ();
<a name="18" id="anc18"></a><span class="line-modified">115     case 3: return u.format3.get_coord ();</span>
116     default:return 0;
117     }
118   }
119 
<a name="19" id="anc19"></a><span class="line-modified">120   inline bool sanitize (hb_sanitize_context_t *c) const</span>
121   {
122     TRACE_SANITIZE (this);
<a name="20" id="anc20"></a><span class="line-modified">123     if (!u.format.sanitize (c)) return_trace (false);</span>
124     switch (u.format) {
125     case 1: return_trace (u.format1.sanitize (c));
126     case 2: return_trace (u.format2.sanitize (c));
127     case 3: return_trace (u.format3.sanitize (c));
128     default:return_trace (false);
129     }
130   }
131 
132   protected:
133   union {
134     HBUINT16            format;
135     BaseCoordFormat1    format1;
136     BaseCoordFormat2    format2;
137     BaseCoordFormat3    format3;
138   } u;
139   public:
140   DEFINE_SIZE_UNION (2, format);
141 };
142 
143 struct FeatMinMaxRecord
144 {
<a name="21" id="anc21"></a><span class="line-modified">145   inline int get_min_value (void) const</span>
<span class="line-modified">146   { return (this+minCoord).get_coord(); }</span>
<span class="line-modified">147 </span>
<span class="line-modified">148   inline int get_max_value (void) const</span>
<span class="line-modified">149   { return (this+maxCoord).get_coord(); }</span>



150 
<a name="22" id="anc22"></a><span class="line-modified">151   inline const Tag &amp;get_tag () const</span>
<span class="line-modified">152   { return tag; }</span>



153 
<a name="23" id="anc23"></a><span class="line-modified">154   inline bool sanitize (hb_sanitize_context_t *c, const void *base) const</span>
155   {
156     TRACE_SANITIZE (this);
<a name="24" id="anc24"></a><span class="line-modified">157     return_trace (c-&gt;check_struct (this) &amp;&amp;</span>
<span class="line-modified">158                   minCoord.sanitize (c, base) &amp;&amp;</span>
<span class="line-modified">159                   maxCoord.sanitize (c, base));</span>
160   }
161 
162   protected:
<a name="25" id="anc25"></a><span class="line-modified">163   Tag                   tag;            /* 4-byte feature identification tag--must</span>
<span class="line-modified">164                                          * match feature tag in FeatureList */</span>
<span class="line-modified">165   OffsetTo&lt;BaseCoord&gt;   minCoord;       /* Offset to BaseCoord table that defines</span>
<span class="line-modified">166                                          * the minimum extent value, from beginning</span>
<span class="line-modified">167                                          * of MinMax table (may be NULL) */</span>
<span class="line-modified">168   OffsetTo&lt;BaseCoord&gt;   maxCoord;       /* Offset to BaseCoord table that defines</span>
<span class="line-modified">169                                          * the maximum extent value, from beginning</span>
<span class="line-modified">170                                          * of MinMax table (may be NULL) */</span>


171   public:
172   DEFINE_SIZE_STATIC (8);
173 
174 };
175 
176 struct MinMax
177 {
<a name="26" id="anc26"></a><span class="line-modified">178   inline unsigned int get_feature_tag_index (Tag featureTableTag) const</span>
<span class="line-modified">179   {</span>
<span class="line-modified">180     /* TODO bsearch */</span>
<span class="line-modified">181     unsigned int count = featMinMaxRecords.len;</span>
<span class="line-modified">182     for (unsigned int i = 0; i &lt; count; i++)</span>








183     {
<a name="27" id="anc27"></a><span class="line-modified">184       Tag tag = featMinMaxRecords[i].get_tag();</span>
<span class="line-modified">185       int cmp = tag.cmp(featureTableTag);</span>
<span class="line-removed">186       if (cmp == 0) return i;</span>
<span class="line-removed">187       if (cmp &gt; 0)  return NOT_INDEXED;</span>
188     }
<a name="28" id="anc28"></a><span class="line-removed">189     return NOT_INDEXED;</span>
<span class="line-removed">190   }</span>
<span class="line-removed">191 </span>
<span class="line-removed">192   inline int get_min_value (unsigned int featureTableTagIndex) const</span>
<span class="line-removed">193   {</span>
<span class="line-removed">194     if (featureTableTagIndex == NOT_INDEXED)</span>
<span class="line-removed">195       return (this+minCoord).get_coord();</span>
<span class="line-removed">196     return featMinMaxRecords[featureTableTagIndex].get_min_value();</span>
<span class="line-removed">197   }</span>
<span class="line-removed">198 </span>
<span class="line-removed">199   inline int get_max_value (unsigned int featureTableTagIndex) const</span>
<span class="line-removed">200   {</span>
<span class="line-removed">201     if (featureTableTagIndex == NOT_INDEXED)</span>
<span class="line-removed">202       return (this+maxCoord).get_coord();</span>
<span class="line-removed">203     return featMinMaxRecords[featureTableTagIndex].get_max_value();</span>
204   }
205 
<a name="29" id="anc29"></a><span class="line-modified">206   inline bool sanitize (hb_sanitize_context_t *c) const</span>
207   {
208     TRACE_SANITIZE (this);
<a name="30" id="anc30"></a><span class="line-modified">209     return_trace (c-&gt;check_struct (this) &amp;&amp;</span>
<span class="line-modified">210                   minCoord.sanitize (c, this) &amp;&amp;</span>
<span class="line-modified">211                   maxCoord.sanitize (c, this) &amp;&amp;</span>
<span class="line-modified">212                   featMinMaxRecords.sanitize (c, this));</span>
213   }
214 
215   protected:
<a name="31" id="anc31"></a><span class="line-modified">216   OffsetTo&lt;BaseCoord&gt;   minCoord;       /* Offset to BaseCoord table that defines</span>
<span class="line-modified">217                                          * minimum extent value, from the beginning</span>
<span class="line-modified">218                                          * of MinMax table (may be NULL) */</span>
<span class="line-modified">219   OffsetTo&lt;BaseCoord&gt;   maxCoord;       /* Offset to BaseCoord table that defines</span>
<span class="line-modified">220                                          * maximum extent value, from the beginning</span>
<span class="line-modified">221                                          * of MinMax table (may be NULL) */</span>
<span class="line-modified">222   ArrayOf&lt;FeatMinMaxRecord&gt;</span>
<span class="line-modified">223                 featMinMaxRecords;      /* Array of FeatMinMaxRecords, in alphabetical</span>
<span class="line-modified">224                                          * order by featureTableTag */</span>



225   public:
226   DEFINE_SIZE_ARRAY (6, featMinMaxRecords);
227 };
228 
<a name="32" id="anc32"></a><span class="line-removed">229 /* TODO... */</span>
<span class="line-removed">230 struct BaseLangSysRecord</span>
<span class="line-removed">231 {</span>
<span class="line-removed">232   inline const Tag&amp; get_tag(void) const</span>
<span class="line-removed">233   { return baseLangSysTag; }</span>
<span class="line-removed">234 </span>
<span class="line-removed">235   inline unsigned int get_feature_tag_index (Tag featureTableTag) const</span>
<span class="line-removed">236   { return (this+minMax).get_feature_tag_index(featureTableTag); }</span>
<span class="line-removed">237 </span>
<span class="line-removed">238   inline int get_min_value (unsigned int featureTableTagIndex) const</span>
<span class="line-removed">239   { return (this+minMax).get_min_value(featureTableTagIndex); }</span>
<span class="line-removed">240 </span>
<span class="line-removed">241   inline int get_max_value (unsigned int featureTableTagIndex) const</span>
<span class="line-removed">242   { return (this+minMax).get_max_value(featureTableTagIndex); }</span>
<span class="line-removed">243 </span>
<span class="line-removed">244   inline bool sanitize (hb_sanitize_context_t *c, const void *base) const</span>
<span class="line-removed">245   {</span>
<span class="line-removed">246     TRACE_SANITIZE (this);</span>
<span class="line-removed">247     return_trace (c-&gt;check_struct (this) &amp;&amp;</span>
<span class="line-removed">248                   minMax.sanitize (c, base));</span>
<span class="line-removed">249   }</span>
<span class="line-removed">250 </span>
<span class="line-removed">251   protected:</span>
<span class="line-removed">252   Tag                   baseLangSysTag;</span>
<span class="line-removed">253   OffsetTo&lt;MinMax&gt;      minMax;</span>
<span class="line-removed">254   public:</span>
<span class="line-removed">255   DEFINE_SIZE_STATIC (6);</span>
<span class="line-removed">256 </span>
<span class="line-removed">257 };</span>
<span class="line-removed">258 </span>
259 struct BaseValues
260 {
<a name="33" id="anc33"></a><span class="line-modified">261   inline unsigned int get_default_base_tag_index (void) const</span>
<span class="line-removed">262   { return defaultIndex; }</span>
<span class="line-removed">263 </span>
<span class="line-removed">264   inline int get_base_coord (unsigned int baselineTagIndex) const</span>
265   {
<a name="34" id="anc34"></a><span class="line-modified">266     return (this+baseCoords[baselineTagIndex]).get_coord();</span>

267   }
268 
<a name="35" id="anc35"></a><span class="line-modified">269   inline bool sanitize (hb_sanitize_context_t *c) const</span>
270   {
271     TRACE_SANITIZE (this);
<a name="36" id="anc36"></a><span class="line-modified">272     return_trace (c-&gt;check_struct (this) &amp;&amp;</span>
<span class="line-modified">273       defaultIndex &lt;= baseCoordCount &amp;&amp;</span>
<span class="line-removed">274       baseCoords.sanitize (c, this));</span>
275   }
276 
277   protected:
<a name="37" id="anc37"></a><span class="line-modified">278   Index                         defaultIndex;</span>
<span class="line-modified">279   HBUINT16                      baseCoordCount;</span>
<span class="line-modified">280   OffsetArrayOf&lt;BaseCoord&gt;      baseCoords;</span>







281   public:
<a name="38" id="anc38"></a><span class="line-modified">282   DEFINE_SIZE_ARRAY (6, baseCoords);</span>
<span class="line-removed">283 </span>
284 };
285 
<a name="39" id="anc39"></a><span class="line-modified">286 struct BaseScript {</span>
<span class="line-modified">287 </span>
<span class="line-modified">288   inline unsigned int get_lang_tag_index (Tag baseLangSysTag) const</span>
<span class="line-removed">289   {</span>
<span class="line-removed">290     Tag tag;</span>
<span class="line-removed">291     int cmp;</span>
<span class="line-removed">292     for (unsigned int i = 0; i &lt; baseLangSysCount; i++) {</span>
<span class="line-removed">293       tag = baseLangSysRecords[i].get_tag();</span>
<span class="line-removed">294       // taking advantage of alphabetical order</span>
<span class="line-removed">295       cmp = tag.cmp(baseLangSysTag);</span>
<span class="line-removed">296       if (cmp == 0) return i;</span>
<span class="line-removed">297       if (cmp &gt; 0)  return NOT_INDEXED;</span>
<span class="line-removed">298     }</span>
<span class="line-removed">299     return NOT_INDEXED;</span>
<span class="line-removed">300   }</span>
<span class="line-removed">301 </span>
<span class="line-removed">302   inline unsigned int get_feature_tag_index (unsigned int baseLangSysIndex, Tag featureTableTag) const</span>
<span class="line-removed">303   {</span>
<span class="line-removed">304     if (baseLangSysIndex == NOT_INDEXED) {</span>
<span class="line-removed">305       if (unlikely(defaultMinMax)) return NOT_INDEXED;</span>
<span class="line-removed">306       return (this+defaultMinMax).get_feature_tag_index(featureTableTag);</span>
<span class="line-removed">307     }</span>
<span class="line-removed">308     if (unlikely(baseLangSysIndex &gt;= baseLangSysCount)) return NOT_INDEXED;</span>
<span class="line-removed">309     return baseLangSysRecords[baseLangSysIndex].get_feature_tag_index(featureTableTag);</span>
<span class="line-removed">310   }</span>
<span class="line-removed">311 </span>
<span class="line-removed">312   inline int get_min_value (unsigned int baseLangSysIndex, unsigned int featureTableTagIndex) const</span>
<span class="line-removed">313   {</span>
<span class="line-removed">314     if (baseLangSysIndex == NOT_INDEXED)</span>
<span class="line-removed">315       return (this+defaultMinMax).get_min_value(featureTableTagIndex);</span>
<span class="line-removed">316     return baseLangSysRecords[baseLangSysIndex].get_max_value(featureTableTagIndex);</span>
<span class="line-removed">317   }</span>
<span class="line-removed">318 </span>
<span class="line-removed">319   inline int get_max_value (unsigned int baseLangSysIndex, unsigned int featureTableTagIndex) const</span>
320   {
<a name="40" id="anc40"></a><span class="line-modified">321     if (baseLangSysIndex == NOT_INDEXED)</span>
<span class="line-modified">322       return (this+defaultMinMax).get_min_value(featureTableTagIndex);</span>
<span class="line-modified">323     return baseLangSysRecords[baseLangSysIndex].get_max_value(featureTableTagIndex);</span>


324   }
325 
<a name="41" id="anc41"></a><span class="line-modified">326   inline unsigned int get_default_base_tag_index (void) const</span>
<span class="line-modified">327   { return (this+baseValues).get_default_base_tag_index(); }</span>
328 
<a name="42" id="anc42"></a><span class="line-modified">329   inline int get_base_coord (unsigned int baselineTagIndex) const</span>
<span class="line-removed">330   { return (this+baseValues).get_base_coord(baselineTagIndex); }</span>
<span class="line-removed">331 </span>
<span class="line-removed">332   inline bool sanitize (hb_sanitize_context_t *c) const</span>
333   {
334     TRACE_SANITIZE (this);
<a name="43" id="anc43"></a><span class="line-modified">335     return_trace (c-&gt;check_struct (this) &amp;&amp;</span>
<span class="line-modified">336       baseValues.sanitize (c, this) &amp;&amp;</span>
<span class="line-removed">337       defaultMinMax.sanitize (c, this) &amp;&amp;</span>
<span class="line-removed">338       baseLangSysRecords.sanitize (c, this));</span>
339   }
340 
341   protected:
<a name="44" id="anc44"></a><span class="line-modified">342   OffsetTo&lt;BaseValues&gt;        baseValues;</span>
<span class="line-modified">343   OffsetTo&lt;MinMax&gt;            defaultMinMax;</span>
<span class="line-modified">344   HBUINT16                      baseLangSysCount;</span>
<span class="line-modified">345   ArrayOf&lt;BaseLangSysRecord&gt;  baseLangSysRecords;</span>
<span class="line-removed">346 </span>
347   public:
<a name="45" id="anc45"></a><span class="line-modified">348     DEFINE_SIZE_ARRAY (8, baseLangSysRecords);</span>
349 };
350 
<a name="46" id="anc46"></a>











351 
<a name="47" id="anc47"></a><span class="line-modified">352 struct BaseScriptRecord {</span>
<span class="line-modified">353 </span>
<span class="line-removed">354   inline const Tag&amp; get_tag (void) const</span>
<span class="line-removed">355   { return baseScriptTag; }</span>
<span class="line-removed">356 </span>
<span class="line-removed">357   inline unsigned int get_default_base_tag_index(void) const</span>
<span class="line-removed">358   { return (this+baseScript).get_default_base_tag_index(); }</span>
<span class="line-removed">359 </span>
<span class="line-removed">360   inline int get_base_coord(unsigned int baselineTagIndex) const</span>
<span class="line-removed">361   { return (this+baseScript).get_base_coord(baselineTagIndex); }</span>
<span class="line-removed">362 </span>
<span class="line-removed">363   inline unsigned int get_lang_tag_index (Tag baseLangSysTag) const</span>
<span class="line-removed">364   { return (this+baseScript).get_lang_tag_index(baseLangSysTag); }</span>
<span class="line-removed">365 </span>
<span class="line-removed">366   inline unsigned int get_feature_tag_index (unsigned int baseLangSysIndex, Tag featureTableTag) const</span>
<span class="line-removed">367   { return (this+baseScript).get_feature_tag_index(baseLangSysIndex, featureTableTag); }</span>
<span class="line-removed">368 </span>
<span class="line-removed">369   inline int get_max_value (unsigned int baseLangSysIndex, unsigned int featureTableTagIndex) const</span>
<span class="line-removed">370   { return (this+baseScript).get_max_value(baseLangSysIndex, featureTableTagIndex); }</span>
371 
<a name="48" id="anc48"></a><span class="line-modified">372   inline int get_min_value (unsigned int baseLangSysIndex, unsigned int featureTableTagIndex) const</span>
<span class="line-removed">373   { return (this+baseScript).get_min_value(baseLangSysIndex, featureTableTagIndex); }</span>
374 
<a name="49" id="anc49"></a><span class="line-modified">375   inline bool sanitize (hb_sanitize_context_t *c, const void *base) const</span>
376   {
377     TRACE_SANITIZE (this);
<a name="50" id="anc50"></a><span class="line-modified">378     return_trace (c-&gt;check_struct (this) &amp;&amp;</span>
<span class="line-modified">379       baseScript != Null(OffsetTo&lt;BaseScript&gt;) &amp;&amp;</span>
<span class="line-modified">380       baseScript.sanitize (c, base));</span>

381   }
382 
383   protected:
<a name="51" id="anc51"></a><span class="line-modified">384   Tag                   baseScriptTag;</span>
<span class="line-modified">385   OffsetTo&lt;BaseScript&gt;  baseScript;</span>








386 
387   public:
<a name="52" id="anc52"></a><span class="line-modified">388     DEFINE_SIZE_STATIC (6);</span>
389 };
390 
<a name="53" id="anc53"></a><span class="line-modified">391 struct BaseScriptList {</span>
<span class="line-modified">392 </span>
<span class="line-modified">393   inline unsigned int get_base_script_index (Tag baseScriptTag) const</span>
<span class="line-modified">394   {</span>
<span class="line-removed">395     for (unsigned int i = 0; i &lt; baseScriptCount; i++)</span>
<span class="line-removed">396       if (baseScriptRecords[i].get_tag() == baseScriptTag)</span>
<span class="line-removed">397         return i;</span>
<span class="line-removed">398     return NOT_INDEXED;</span>
<span class="line-removed">399   }</span>
<span class="line-removed">400 </span>
<span class="line-removed">401   inline unsigned int get_default_base_tag_index (unsigned int baseScriptIndex) const</span>
<span class="line-removed">402   {</span>
<span class="line-removed">403     if (unlikely(baseScriptIndex &gt;= baseScriptCount)) return NOT_INDEXED;</span>
<span class="line-removed">404     return baseScriptRecords[baseScriptIndex].get_default_base_tag_index();</span>
<span class="line-removed">405   }</span>
<span class="line-removed">406 </span>
<span class="line-removed">407   inline int get_base_coord(unsigned int baseScriptIndex, unsigned int baselineTagIndex) const</span>
<span class="line-removed">408   {</span>
<span class="line-removed">409     return baseScriptRecords[baseScriptIndex].get_base_coord(baselineTagIndex);</span>
<span class="line-removed">410   }</span>
<span class="line-removed">411 </span>
<span class="line-removed">412   inline unsigned int get_lang_tag_index (unsigned int baseScriptIndex, Tag baseLangSysTag) const</span>
<span class="line-removed">413   {</span>
<span class="line-removed">414     if (unlikely(baseScriptIndex &gt;= baseScriptCount)) return NOT_INDEXED;</span>
<span class="line-removed">415     return baseScriptRecords[baseScriptIndex].get_lang_tag_index(baseLangSysTag);</span>
<span class="line-removed">416   }</span>
<span class="line-removed">417 </span>
<span class="line-removed">418   inline unsigned int get_feature_tag_index (unsigned int baseScriptIndex, unsigned int baseLangSysIndex, Tag featureTableTag) const</span>
<span class="line-removed">419   {</span>
<span class="line-removed">420     if (unlikely(baseScriptIndex &gt;= baseScriptCount)) return NOT_INDEXED;</span>
<span class="line-removed">421     return baseScriptRecords[baseScriptIndex].get_feature_tag_index(baseLangSysIndex, featureTableTag);</span>
<span class="line-removed">422   }</span>
<span class="line-removed">423 </span>
<span class="line-removed">424   inline int get_max_value (unsigned int baseScriptIndex, unsigned int baseLangSysIndex, unsigned int featureTableTagIndex) const</span>
425   {
<a name="54" id="anc54"></a><span class="line-modified">426     return baseScriptRecords[baseScriptIndex].get_max_value(baseLangSysIndex, featureTableTagIndex);</span>




427   }
428 
<a name="55" id="anc55"></a><span class="line-modified">429   inline int get_min_value (unsigned int baseScriptIndex, unsigned int baseLangSysIndex, unsigned int featureTableTagIndex) const</span>
<span class="line-modified">430   {</span>
<span class="line-removed">431     return baseScriptRecords[baseScriptIndex].get_min_value(baseLangSysIndex, featureTableTagIndex);</span>
<span class="line-removed">432   }</span>
433 
<a name="56" id="anc56"></a><span class="line-modified">434   inline bool sanitize (hb_sanitize_context_t *c) const</span>
435   {
436     TRACE_SANITIZE (this);
<a name="57" id="anc57"></a><span class="line-modified">437     return_trace (c-&gt;check_struct (this) &amp;&amp;</span>
<span class="line-modified">438       baseScriptRecords.sanitize (c, this));</span>
439   }
440 
441   protected:
<a name="58" id="anc58"></a><span class="line-modified">442   HBUINT16                    baseScriptCount;</span>
<span class="line-modified">443   ArrayOf&lt;BaseScriptRecord&gt; baseScriptRecords;</span>


444 
445   public:
<a name="59" id="anc59"></a><span class="line-modified">446   DEFINE_SIZE_ARRAY (4, baseScriptRecords);</span>
<span class="line-removed">447 </span>
448 };
449 
<a name="60" id="anc60"></a><span class="line-modified">450 struct BaseTagList</span>
451 {
<a name="61" id="anc61"></a>







452 
<a name="62" id="anc62"></a><span class="line-modified">453   inline unsigned int get_tag_index(Tag baselineTag) const</span>

454   {
<a name="63" id="anc63"></a><span class="line-modified">455     for (unsigned int i = 0; i &lt; baseTagCount; i++)</span>
<span class="line-modified">456       if (baselineTags[i] == baselineTag)</span>
<span class="line-modified">457         return i;</span>
<span class="line-modified">458     return NOT_INDEXED;</span>
459   }
460 
<a name="64" id="anc64"></a><span class="line-modified">461   inline bool sanitize (hb_sanitize_context_t *c) const</span>
462   {
463     TRACE_SANITIZE (this);
<a name="65" id="anc65"></a><span class="line-modified">464     return_trace (c-&gt;check_struct (this));</span>

465   }
466 
467   protected:
<a name="66" id="anc66"></a><span class="line-modified">468   HBUINT16        baseTagCount;</span>
<span class="line-modified">469   SortedArrayOf&lt;Tag&gt;  baselineTags;</span>
470 
471   public:
<a name="67" id="anc67"></a><span class="line-modified">472   DEFINE_SIZE_ARRAY (4, baselineTags);</span>
473 };
474 
475 struct Axis
476 {
<a name="68" id="anc68"></a><span class="line-modified">477 </span>
<span class="line-modified">478   inline unsigned int get_base_tag_index(Tag baselineTag) const</span>


479   {
<a name="69" id="anc69"></a><span class="line-modified">480     if (unlikely(baseTagList == Null(OffsetTo&lt;BaseTagList&gt;))) return NOT_INDEXED;</span>
<span class="line-modified">481     return (this+baseTagList).get_tag_index(baselineTag);</span>
<span class="line-removed">482   }</span>
483 
<a name="70" id="anc70"></a><span class="line-modified">484   inline unsigned int get_default_base_tag_index_for_script_index (unsigned int baseScriptIndex) const</span>
<span class="line-removed">485   {</span>
<span class="line-removed">486     if (unlikely(baseScriptList == Null(OffsetTo&lt;BaseScriptList&gt;))) return NOT_INDEXED;</span>
<span class="line-removed">487     return (this+baseScriptList).get_default_base_tag_index(baseScriptIndex);</span>
<span class="line-removed">488   }</span>
<span class="line-removed">489 </span>
<span class="line-removed">490   inline int get_base_coord(unsigned int baseScriptIndex, unsigned int baselineTagIndex) const</span>
<span class="line-removed">491   {</span>
<span class="line-removed">492     return (this+baseScriptList).get_base_coord(baseScriptIndex, baselineTagIndex);</span>
<span class="line-removed">493   }</span>
494 
<a name="71" id="anc71"></a><span class="line-modified">495   inline unsigned int get_lang_tag_index (unsigned int baseScriptIndex, Tag baseLangSysTag) const</span>
<span class="line-removed">496   {</span>
<span class="line-removed">497     if (unlikely(baseScriptList == Null(OffsetTo&lt;BaseScriptList&gt;))) return NOT_INDEXED;</span>
<span class="line-removed">498     return (this+baseScriptList).get_lang_tag_index(baseScriptIndex, baseLangSysTag);</span>
499   }
500 
<a name="72" id="anc72"></a><span class="line-modified">501   inline unsigned int get_feature_tag_index (unsigned int baseScriptIndex, unsigned int baseLangSysIndex, Tag featureTableTag) const</span>




502   {
<a name="73" id="anc73"></a><span class="line-modified">503     if (unlikely(baseScriptList == Null(OffsetTo&lt;BaseScriptList&gt;))) return NOT_INDEXED;</span>
<span class="line-modified">504     return (this+baseScriptList).get_feature_tag_index(baseScriptIndex, baseLangSysIndex, featureTableTag);</span>
<span class="line-removed">505   }</span>
506 
<a name="74" id="anc74"></a><span class="line-modified">507   inline int get_max_value (unsigned int baseScriptIndex, unsigned int baseLangSysIndex, unsigned int featureTableTagIndex) const</span>
<span class="line-removed">508   {</span>
<span class="line-removed">509     return (this+baseScriptList).get_max_value(baseScriptIndex, baseLangSysIndex, featureTableTagIndex);</span>
<span class="line-removed">510   }</span>
511 
<a name="75" id="anc75"></a><span class="line-modified">512   inline int get_min_value (unsigned int baseScriptIndex, unsigned int baseLangSysIndex, unsigned int featureTableTagIndex) const</span>
<span class="line-removed">513   {</span>
<span class="line-removed">514     return (this+baseScriptList).get_min_value(baseScriptIndex, baseLangSysIndex, featureTableTagIndex);</span>
515   }
516 
<a name="76" id="anc76"></a><span class="line-modified">517   inline bool sanitize (hb_sanitize_context_t *c) const</span>
518   {
519     TRACE_SANITIZE (this);
<a name="77" id="anc77"></a><span class="line-modified">520     return_trace (c-&gt;check_struct (this) &amp;&amp;</span>
<span class="line-modified">521       baseTagList.sanitize (c, this) &amp;&amp;</span>
<span class="line-modified">522       baseScriptList.sanitize (c, this));</span>
523   }
524 
525   protected:
<a name="78" id="anc78"></a><span class="line-modified">526   OffsetTo&lt;BaseTagList&gt;     baseTagList;</span>
<span class="line-modified">527   OffsetTo&lt;BaseScriptList&gt;  baseScriptList;</span>








528 
529   public:
530   DEFINE_SIZE_STATIC (4);
531 };
532 
533 struct BASE
534 {
<a name="79" id="anc79"></a><span class="line-modified">535   static const hb_tag_t tableTag = HB_OT_TAG_BASE;</span>
<span class="line-removed">536 </span>
<span class="line-removed">537   inline bool has_vert_axis(void)</span>
<span class="line-removed">538   { return vertAxis != Null(OffsetTo&lt;Axis&gt;); }</span>
539 
<a name="80" id="anc80"></a><span class="line-modified">540   inline bool has_horiz_axis(void)</span>
<span class="line-modified">541   { return horizAxis != Null(OffsetTo&lt;Axis&gt;); }</span>
542 
<a name="81" id="anc81"></a><span class="line-modified">543   // horizontal axis base coords:</span>

544 
<a name="82" id="anc82"></a><span class="line-modified">545   inline unsigned int get_horiz_base_tag_index(Tag baselineTag) const</span>





546   {
<a name="83" id="anc83"></a><span class="line-modified">547     if (unlikely(horizAxis == Null(OffsetTo&lt;Axis&gt;))) return NOT_INDEXED;</span>
<span class="line-modified">548     return (this+horizAxis).get_base_tag_index(baselineTag);</span>
<span class="line-modified">549   }</span>
550 
<a name="84" id="anc84"></a><span class="line-modified">551   inline unsigned int get_horiz_default_base_tag_index_for_script_index (unsigned int baseScriptIndex) const</span>
<span class="line-modified">552   {</span>
<span class="line-modified">553     if (unlikely(horizAxis == Null(OffsetTo&lt;Axis&gt;))) return NOT_INDEXED;</span>
<span class="line-modified">554     return (this+horizAxis).get_default_base_tag_index_for_script_index(baseScriptIndex);</span>
555   }
556 
<a name="85" id="anc85"></a><span class="line-modified">557   inline int get_horiz_base_coord(unsigned int baseScriptIndex, unsigned int baselineTagIndex) const</span>







558   {
<a name="86" id="anc86"></a><span class="line-modified">559     return (this+horizAxis).get_base_coord(baseScriptIndex, baselineTagIndex);</span>
<span class="line-modified">560   }</span>
<span class="line-modified">561 </span>
<span class="line-modified">562   // vertical axis base coords:</span>
<span class="line-removed">563 </span>
<span class="line-removed">564   inline unsigned int get_vert_base_tag_index(Tag baselineTag) const</span>
<span class="line-removed">565   {</span>
<span class="line-removed">566     if (unlikely(vertAxis == Null(OffsetTo&lt;Axis&gt;))) return NOT_INDEXED;</span>
<span class="line-removed">567     return (this+vertAxis).get_base_tag_index(baselineTag);</span>
<span class="line-removed">568   }</span>
<span class="line-removed">569 </span>
<span class="line-removed">570   inline unsigned int get_vert_default_base_tag_index_for_script_index (unsigned int baseScriptIndex) const</span>
<span class="line-removed">571   {</span>
<span class="line-removed">572     if (unlikely(vertAxis == Null(OffsetTo&lt;Axis&gt;))) return NOT_INDEXED;</span>
<span class="line-removed">573     return (this+vertAxis).get_default_base_tag_index_for_script_index(baseScriptIndex);</span>
<span class="line-removed">574   }</span>
<span class="line-removed">575 </span>
<span class="line-removed">576   inline int get_vert_base_coord(unsigned int baseScriptIndex, unsigned int baselineTagIndex) const</span>
<span class="line-removed">577   {</span>
<span class="line-removed">578     return (this+vertAxis).get_base_coord(baseScriptIndex, baselineTagIndex);</span>
<span class="line-removed">579   }</span>
<span class="line-removed">580 </span>
<span class="line-removed">581   // horizontal axis min/max coords:</span>
<span class="line-removed">582 </span>
<span class="line-removed">583   inline unsigned int get_horiz_lang_tag_index (unsigned int baseScriptIndex, Tag baseLangSysTag) const</span>
<span class="line-removed">584   {</span>
<span class="line-removed">585     if (unlikely(horizAxis == Null(OffsetTo&lt;Axis&gt;))) return NOT_INDEXED;</span>
<span class="line-removed">586     return (this+horizAxis).get_lang_tag_index (baseScriptIndex, baseLangSysTag);</span>
<span class="line-removed">587   }</span>
<span class="line-removed">588 </span>
<span class="line-removed">589   inline unsigned int get_horiz_feature_tag_index (unsigned int baseScriptIndex, unsigned int baseLangSysIndex, Tag featureTableTag) const</span>
<span class="line-removed">590   {</span>
<span class="line-removed">591     if (unlikely(horizAxis == Null(OffsetTo&lt;Axis&gt;))) return NOT_INDEXED;</span>
<span class="line-removed">592     return (this+horizAxis).get_feature_tag_index (baseScriptIndex, baseLangSysIndex, featureTableTag);</span>
<span class="line-removed">593   }</span>
594 
<a name="87" id="anc87"></a><span class="line-modified">595   inline int get_horiz_max_value (unsigned int baseScriptIndex, unsigned int baseLangSysIndex, unsigned int featureTableTagIndex) const</span>
<span class="line-modified">596   {</span>
<span class="line-modified">597     return (this+horizAxis).get_max_value (baseScriptIndex, baseLangSysIndex, featureTableTagIndex);</span>
<span class="line-modified">598   }</span>
<span class="line-removed">599 </span>
<span class="line-removed">600   inline int get_horiz_min_value (unsigned int baseScriptIndex, unsigned int baseLangSysIndex, unsigned int featureTableTagIndex) const</span>
<span class="line-removed">601   {</span>
<span class="line-removed">602     return (this+horizAxis).get_min_value (baseScriptIndex, baseLangSysIndex, featureTableTagIndex);</span>
<span class="line-removed">603   }</span>
<span class="line-removed">604 </span>
<span class="line-removed">605     // vertical axis min/max coords:</span>
<span class="line-removed">606 </span>
<span class="line-removed">607   inline unsigned int get_vert_lang_tag_index (unsigned int baseScriptIndex, Tag baseLangSysTag) const</span>
<span class="line-removed">608   {</span>
<span class="line-removed">609     if (unlikely(vertAxis == Null(OffsetTo&lt;Axis&gt;))) return NOT_INDEXED;</span>
<span class="line-removed">610     return (this+vertAxis).get_lang_tag_index (baseScriptIndex, baseLangSysTag);</span>
<span class="line-removed">611   }</span>
<span class="line-removed">612 </span>
<span class="line-removed">613   inline unsigned int get_vert_feature_tag_index (unsigned int baseScriptIndex, unsigned int baseLangSysIndex, Tag featureTableTag) const</span>
<span class="line-removed">614   {</span>
<span class="line-removed">615     if (unlikely(vertAxis == Null(OffsetTo&lt;Axis&gt;))) return NOT_INDEXED;</span>
<span class="line-removed">616     return (this+vertAxis).get_feature_tag_index (baseScriptIndex, baseLangSysIndex, featureTableTag);</span>
<span class="line-removed">617   }</span>
<span class="line-removed">618 </span>
<span class="line-removed">619   inline int get_vert_max_value (unsigned int baseScriptIndex, unsigned int baseLangSysIndex, unsigned int featureTableTagIndex) const</span>
<span class="line-removed">620   {</span>
<span class="line-removed">621     return (this+vertAxis).get_max_value (baseScriptIndex, baseLangSysIndex, featureTableTagIndex);</span>
622   }
623 
<a name="88" id="anc88"></a><span class="line-modified">624   inline int get_vert_min_value (unsigned int baseScriptIndex, unsigned int baseLangSysIndex, unsigned int featureTableTagIndex) const</span>
<span class="line-removed">625   {</span>
<span class="line-removed">626     return (this+vertAxis).get_min_value (baseScriptIndex, baseLangSysIndex, featureTableTagIndex);</span>
<span class="line-removed">627   }</span>
<span class="line-removed">628 </span>
<span class="line-removed">629   inline bool sanitize (hb_sanitize_context_t *c) const</span>
630   {
631     TRACE_SANITIZE (this);
<a name="89" id="anc89"></a><span class="line-modified">632     return_trace (c-&gt;check_struct (this) &amp;&amp;</span>
<span class="line-modified">633                   likely (version.major == 1) &amp;&amp;</span>
<span class="line-modified">634                   horizAxis.sanitize (c, this) &amp;&amp;</span>
<span class="line-modified">635                   vertAxis.sanitize (c, this) &amp;&amp;</span>
<span class="line-modified">636                   (version.to_int () &lt; 0x00010001u || varStore.sanitize (c, this)));</span>
637   }
638 
639   protected:
<a name="90" id="anc90"></a><span class="line-modified">640   FixedVersion&lt;&gt;  version;</span>
<span class="line-modified">641   OffsetTo&lt;Axis&gt;  horizAxis;</span>
<span class="line-modified">642   OffsetTo&lt;Axis&gt;  vertAxis;</span>


643   LOffsetTo&lt;VariationStore&gt;
<a name="91" id="anc91"></a><span class="line-modified">644                 varStore;               /* Offset to the table of Item Variation</span>
<span class="line-modified">645                                          * Store--from beginning of BASE</span>
<span class="line-modified">646                                          * header (may be NULL).  Introduced</span>
<span class="line-modified">647                                          * in version 0x00010001. */</span>
648   public:
649   DEFINE_SIZE_MIN (8);
650 };
651 
652 
653 } /* namespace OT */
654 
655 
656 #endif /* HB_OT_LAYOUT_BASE_TABLE_HH */
<a name="92" id="anc92"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="92" type="hidden" />
</body>
</html>