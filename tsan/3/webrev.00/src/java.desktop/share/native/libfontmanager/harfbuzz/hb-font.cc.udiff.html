<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/share/native/libfontmanager/harfbuzz/hb-font.cc</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="hb-fallback-shape.cc.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="hb-font.h.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfontmanager/harfbuzz/hb-font.cc</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -24,249 +24,374 @@</span>
   *
   * Red Hat Author(s): Behdad Esfahbod
   * Google Author(s): Behdad Esfahbod
   */
  
<span class="udiff-line-modified-removed">- #include &quot;hb-private.hh&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;hb.hh&quot;</span>
  
<span class="udiff-line-modified-removed">- #include &quot;hb-font-private.hh&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;hb-font.hh&quot;</span>
<span class="udiff-line-added">+ #include &quot;hb-machinery.hh&quot;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #include &quot;hb-ot.h&quot;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ /**</span>
<span class="udiff-line-added">+  * SECTION:hb-font</span>
<span class="udiff-line-added">+  * @title: hb-font</span>
<span class="udiff-line-added">+  * @short_description: Font objects</span>
<span class="udiff-line-added">+  * @include: hb.h</span>
<span class="udiff-line-added">+  *</span>
<span class="udiff-line-added">+  * Font objects represent a font face at a certain size and other</span>
<span class="udiff-line-added">+  * parameters (pixels per EM, points per EM, variation settings.)</span>
<span class="udiff-line-added">+  * Fonts are created from font faces, and are used as input to</span>
<span class="udiff-line-added">+  * hb_shape() among other things.</span>
<span class="udiff-line-added">+  **/</span>
  
  
  /*
   * hb_font_funcs_t
   */
  
  static hb_bool_t
  hb_font_get_font_h_extents_nil (hb_font_t *font HB_UNUSED,
                                  void *font_data HB_UNUSED,
<span class="udiff-line-modified-removed">-                                 hb_font_extents_t *metrics,</span>
<span class="udiff-line-modified-added">+                                 hb_font_extents_t *extents,</span>
                                  void *user_data HB_UNUSED)
  {
<span class="udiff-line-modified-removed">-   memset (metrics, 0, sizeof (*metrics));</span>
<span class="udiff-line-modified-added">+   memset (extents, 0, sizeof (*extents));</span>
    return false;
  }
  static hb_bool_t
<span class="udiff-line-modified-removed">- hb_font_get_font_h_extents_parent (hb_font_t *font,</span>
<span class="udiff-line-modified-removed">-                                    void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-removed">-                                    hb_font_extents_t *metrics,</span>
<span class="udiff-line-modified-removed">-                                    void *user_data HB_UNUSED)</span>
<span class="udiff-line-modified-added">+ hb_font_get_font_h_extents_default (hb_font_t *font,</span>
<span class="udiff-line-modified-added">+                                     void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                     hb_font_extents_t *extents,</span>
<span class="udiff-line-modified-added">+                                     void *user_data HB_UNUSED)</span>
  {
<span class="udiff-line-modified-removed">-   hb_bool_t ret = font-&gt;parent-&gt;get_font_h_extents (metrics);</span>
<span class="udiff-line-modified-added">+   hb_bool_t ret = font-&gt;parent-&gt;get_font_h_extents (extents);</span>
    if (ret) {
<span class="udiff-line-modified-removed">-     metrics-&gt;ascender = font-&gt;parent_scale_y_distance (metrics-&gt;ascender);</span>
<span class="udiff-line-modified-removed">-     metrics-&gt;descender = font-&gt;parent_scale_y_distance (metrics-&gt;descender);</span>
<span class="udiff-line-modified-removed">-     metrics-&gt;line_gap = font-&gt;parent_scale_y_distance (metrics-&gt;line_gap);</span>
<span class="udiff-line-modified-added">+     extents-&gt;ascender = font-&gt;parent_scale_y_distance (extents-&gt;ascender);</span>
<span class="udiff-line-modified-added">+     extents-&gt;descender = font-&gt;parent_scale_y_distance (extents-&gt;descender);</span>
<span class="udiff-line-modified-added">+     extents-&gt;line_gap = font-&gt;parent_scale_y_distance (extents-&gt;line_gap);</span>
    }
    return ret;
  }
  
  static hb_bool_t
  hb_font_get_font_v_extents_nil (hb_font_t *font HB_UNUSED,
                                  void *font_data HB_UNUSED,
<span class="udiff-line-modified-removed">-                                 hb_font_extents_t *metrics,</span>
<span class="udiff-line-modified-added">+                                 hb_font_extents_t *extents,</span>
                                  void *user_data HB_UNUSED)
  {
<span class="udiff-line-modified-removed">-   memset (metrics, 0, sizeof (*metrics));</span>
<span class="udiff-line-modified-added">+   memset (extents, 0, sizeof (*extents));</span>
    return false;
  }
  static hb_bool_t
<span class="udiff-line-modified-removed">- hb_font_get_font_v_extents_parent (hb_font_t *font,</span>
<span class="udiff-line-modified-removed">-                                    void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-removed">-                                    hb_font_extents_t *metrics,</span>
<span class="udiff-line-modified-removed">-                                    void *user_data HB_UNUSED)</span>
<span class="udiff-line-modified-added">+ hb_font_get_font_v_extents_default (hb_font_t *font,</span>
<span class="udiff-line-modified-added">+                                     void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                     hb_font_extents_t *extents,</span>
<span class="udiff-line-modified-added">+                                     void *user_data HB_UNUSED)</span>
  {
<span class="udiff-line-modified-removed">-   hb_bool_t ret = font-&gt;parent-&gt;get_font_v_extents (metrics);</span>
<span class="udiff-line-modified-added">+   hb_bool_t ret = font-&gt;parent-&gt;get_font_v_extents (extents);</span>
    if (ret) {
<span class="udiff-line-modified-removed">-     metrics-&gt;ascender = font-&gt;parent_scale_x_distance (metrics-&gt;ascender);</span>
<span class="udiff-line-modified-removed">-     metrics-&gt;descender = font-&gt;parent_scale_x_distance (metrics-&gt;descender);</span>
<span class="udiff-line-modified-removed">-     metrics-&gt;line_gap = font-&gt;parent_scale_x_distance (metrics-&gt;line_gap);</span>
<span class="udiff-line-modified-added">+     extents-&gt;ascender = font-&gt;parent_scale_x_distance (extents-&gt;ascender);</span>
<span class="udiff-line-modified-added">+     extents-&gt;descender = font-&gt;parent_scale_x_distance (extents-&gt;descender);</span>
<span class="udiff-line-modified-added">+     extents-&gt;line_gap = font-&gt;parent_scale_x_distance (extents-&gt;line_gap);</span>
    }
    return ret;
  }
  
  static hb_bool_t
  hb_font_get_nominal_glyph_nil (hb_font_t *font HB_UNUSED,
                                 void *font_data HB_UNUSED,
<span class="udiff-line-modified-removed">-                                hb_codepoint_t unicode,</span>
<span class="udiff-line-modified-added">+                                hb_codepoint_t unicode HB_UNUSED,</span>
                                 hb_codepoint_t *glyph,
                                 void *user_data HB_UNUSED)
  {
    *glyph = 0;
    return false;
  }
  static hb_bool_t
<span class="udiff-line-modified-removed">- hb_font_get_nominal_glyph_parent (hb_font_t *font,</span>
<span class="udiff-line-modified-removed">-                                   void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-removed">-                                   hb_codepoint_t unicode,</span>
<span class="udiff-line-modified-removed">-                                   hb_codepoint_t *glyph,</span>
<span class="udiff-line-modified-removed">-                                   void *user_data HB_UNUSED)</span>
<span class="udiff-line-modified-added">+ hb_font_get_nominal_glyph_default (hb_font_t *font,</span>
<span class="udiff-line-modified-added">+                                    void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                    hb_codepoint_t unicode,</span>
<span class="udiff-line-modified-added">+                                    hb_codepoint_t *glyph,</span>
<span class="udiff-line-modified-added">+                                    void *user_data HB_UNUSED)</span>
  {
<span class="udiff-line-added">+   if (font-&gt;has_nominal_glyphs_func_set ())</span>
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+     return font-&gt;get_nominal_glyphs (1, &amp;unicode, 0, glyph, 0);</span>
<span class="udiff-line-added">+   }</span>
    return font-&gt;parent-&gt;get_nominal_glyph (unicode, glyph);
  }
  
<span class="udiff-line-added">+ #define hb_font_get_nominal_glyphs_nil hb_font_get_nominal_glyphs_default</span>
<span class="udiff-line-added">+ static unsigned int</span>
<span class="udiff-line-added">+ hb_font_get_nominal_glyphs_default (hb_font_t *font,</span>
<span class="udiff-line-added">+                                     void *font_data HB_UNUSED,</span>
<span class="udiff-line-added">+                                     unsigned int count,</span>
<span class="udiff-line-added">+                                     const hb_codepoint_t *first_unicode,</span>
<span class="udiff-line-added">+                                     unsigned int unicode_stride,</span>
<span class="udiff-line-added">+                                     hb_codepoint_t *first_glyph,</span>
<span class="udiff-line-added">+                                     unsigned int glyph_stride,</span>
<span class="udiff-line-added">+                                     void *user_data HB_UNUSED)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   if (font-&gt;has_nominal_glyph_func_set ())</span>
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+     for (unsigned int i = 0; i &lt; count; i++)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+       if (!font-&gt;get_nominal_glyph (*first_unicode, first_glyph))</span>
<span class="udiff-line-added">+         return i;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+       first_unicode = &amp;StructAtOffsetUnaligned&lt;hb_codepoint_t&gt; (first_unicode, unicode_stride);</span>
<span class="udiff-line-added">+       first_glyph = &amp;StructAtOffsetUnaligned&lt;hb_codepoint_t&gt; (first_glyph, glyph_stride);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     return count;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   return font-&gt;parent-&gt;get_nominal_glyphs (count,</span>
<span class="udiff-line-added">+                                            first_unicode, unicode_stride,</span>
<span class="udiff-line-added">+                                            first_glyph, glyph_stride);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  static hb_bool_t
  hb_font_get_variation_glyph_nil (hb_font_t *font HB_UNUSED,
                                   void *font_data HB_UNUSED,
<span class="udiff-line-modified-removed">-                                  hb_codepoint_t unicode,</span>
<span class="udiff-line-modified-removed">-                                  hb_codepoint_t variation_selector,</span>
<span class="udiff-line-modified-added">+                                  hb_codepoint_t unicode HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                  hb_codepoint_t variation_selector HB_UNUSED,</span>
                                   hb_codepoint_t *glyph,
                                   void *user_data HB_UNUSED)
  {
    *glyph = 0;
    return false;
  }
  static hb_bool_t
<span class="udiff-line-modified-removed">- hb_font_get_variation_glyph_parent (hb_font_t *font,</span>
<span class="udiff-line-modified-removed">-                                     void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-removed">-                                     hb_codepoint_t unicode,</span>
<span class="udiff-line-modified-removed">-                                     hb_codepoint_t variation_selector,</span>
<span class="udiff-line-modified-removed">-                                     hb_codepoint_t *glyph,</span>
<span class="udiff-line-modified-removed">-                                     void *user_data HB_UNUSED)</span>
<span class="udiff-line-modified-added">+ hb_font_get_variation_glyph_default (hb_font_t *font,</span>
<span class="udiff-line-modified-added">+                                      void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                      hb_codepoint_t unicode,</span>
<span class="udiff-line-modified-added">+                                      hb_codepoint_t variation_selector,</span>
<span class="udiff-line-modified-added">+                                      hb_codepoint_t *glyph,</span>
<span class="udiff-line-modified-added">+                                      void *user_data HB_UNUSED)</span>
  {
    return font-&gt;parent-&gt;get_variation_glyph (unicode, variation_selector, glyph);
  }
  
  
  static hb_position_t
  hb_font_get_glyph_h_advance_nil (hb_font_t *font,
                                   void *font_data HB_UNUSED,
<span class="udiff-line-modified-removed">-                                  hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-added">+                                  hb_codepoint_t glyph HB_UNUSED,</span>
                                   void *user_data HB_UNUSED)
  {
    return font-&gt;x_scale;
  }
  static hb_position_t
<span class="udiff-line-modified-removed">- hb_font_get_glyph_h_advance_parent (hb_font_t *font,</span>
<span class="udiff-line-modified-removed">-                                     void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-removed">-                                     hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-removed">-                                     void *user_data HB_UNUSED)</span>
<span class="udiff-line-modified-added">+ hb_font_get_glyph_h_advance_default (hb_font_t *font,</span>
<span class="udiff-line-modified-added">+                                      void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                      hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-added">+                                      void *user_data HB_UNUSED)</span>
  {
<span class="udiff-line-added">+   if (font-&gt;has_glyph_h_advances_func_set ())</span>
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+     hb_position_t ret;</span>
<span class="udiff-line-added">+     font-&gt;get_glyph_h_advances (1, &amp;glyph, 0, &amp;ret, 0);</span>
<span class="udiff-line-added">+     return ret;</span>
<span class="udiff-line-added">+   }</span>
    return font-&gt;parent_scale_x_distance (font-&gt;parent-&gt;get_glyph_h_advance (glyph));
  }
  
  static hb_position_t
  hb_font_get_glyph_v_advance_nil (hb_font_t *font,
                                   void *font_data HB_UNUSED,
<span class="udiff-line-modified-removed">-                                  hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-added">+                                  hb_codepoint_t glyph HB_UNUSED,</span>
                                   void *user_data HB_UNUSED)
  {
    /* TODO use font_extents.ascender+descender */
    return font-&gt;y_scale;
  }
  static hb_position_t
<span class="udiff-line-modified-removed">- hb_font_get_glyph_v_advance_parent (hb_font_t *font,</span>
<span class="udiff-line-modified-removed">-                                     void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-removed">-                                     hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-removed">-                                     void *user_data HB_UNUSED)</span>
<span class="udiff-line-modified-added">+ hb_font_get_glyph_v_advance_default (hb_font_t *font,</span>
<span class="udiff-line-modified-added">+                                      void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                      hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-added">+                                      void *user_data HB_UNUSED)</span>
  {
<span class="udiff-line-added">+   if (font-&gt;has_glyph_v_advances_func_set ())</span>
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+     hb_position_t ret;</span>
<span class="udiff-line-added">+     font-&gt;get_glyph_v_advances (1, &amp;glyph, 0, &amp;ret, 0);</span>
<span class="udiff-line-added">+     return ret;</span>
<span class="udiff-line-added">+   }</span>
    return font-&gt;parent_scale_y_distance (font-&gt;parent-&gt;get_glyph_v_advance (glyph));
  }
  
<span class="udiff-line-added">+ #define hb_font_get_glyph_h_advances_nil hb_font_get_glyph_h_advances_default</span>
<span class="udiff-line-added">+ static void</span>
<span class="udiff-line-added">+ hb_font_get_glyph_h_advances_default (hb_font_t* font,</span>
<span class="udiff-line-added">+                                       void* font_data HB_UNUSED,</span>
<span class="udiff-line-added">+                                       unsigned int count,</span>
<span class="udiff-line-added">+                                       const hb_codepoint_t *first_glyph,</span>
<span class="udiff-line-added">+                                       unsigned int glyph_stride,</span>
<span class="udiff-line-added">+                                       hb_position_t *first_advance,</span>
<span class="udiff-line-added">+                                       unsigned int advance_stride,</span>
<span class="udiff-line-added">+                                       void *user_data HB_UNUSED)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   if (font-&gt;has_glyph_h_advance_func_set ())</span>
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+     for (unsigned int i = 0; i &lt; count; i++)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+       *first_advance = font-&gt;get_glyph_h_advance (*first_glyph);</span>
<span class="udiff-line-added">+       first_glyph = &amp;StructAtOffsetUnaligned&lt;hb_codepoint_t&gt; (first_glyph, glyph_stride);</span>
<span class="udiff-line-added">+       first_advance = &amp;StructAtOffsetUnaligned&lt;hb_position_t&gt; (first_advance, advance_stride);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     return;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   font-&gt;parent-&gt;get_glyph_h_advances (count,</span>
<span class="udiff-line-added">+                                       first_glyph, glyph_stride,</span>
<span class="udiff-line-added">+                                       first_advance, advance_stride);</span>
<span class="udiff-line-added">+   for (unsigned int i = 0; i &lt; count; i++)</span>
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+     *first_advance = font-&gt;parent_scale_x_distance (*first_advance);</span>
<span class="udiff-line-added">+     first_advance = &amp;StructAtOffsetUnaligned&lt;hb_position_t&gt; (first_advance, advance_stride);</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #define hb_font_get_glyph_v_advances_nil hb_font_get_glyph_v_advances_default</span>
<span class="udiff-line-added">+ static void</span>
<span class="udiff-line-added">+ hb_font_get_glyph_v_advances_default (hb_font_t* font,</span>
<span class="udiff-line-added">+                                       void* font_data HB_UNUSED,</span>
<span class="udiff-line-added">+                                       unsigned int count,</span>
<span class="udiff-line-added">+                                       const hb_codepoint_t *first_glyph,</span>
<span class="udiff-line-added">+                                       unsigned int glyph_stride,</span>
<span class="udiff-line-added">+                                       hb_position_t *first_advance,</span>
<span class="udiff-line-added">+                                       unsigned int advance_stride,</span>
<span class="udiff-line-added">+                                       void *user_data HB_UNUSED)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   if (font-&gt;has_glyph_v_advance_func_set ())</span>
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+     for (unsigned int i = 0; i &lt; count; i++)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+       *first_advance = font-&gt;get_glyph_v_advance (*first_glyph);</span>
<span class="udiff-line-added">+       first_glyph = &amp;StructAtOffsetUnaligned&lt;hb_codepoint_t&gt; (first_glyph, glyph_stride);</span>
<span class="udiff-line-added">+       first_advance = &amp;StructAtOffsetUnaligned&lt;hb_position_t&gt; (first_advance, advance_stride);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     return;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   font-&gt;parent-&gt;get_glyph_v_advances (count,</span>
<span class="udiff-line-added">+                                       first_glyph, glyph_stride,</span>
<span class="udiff-line-added">+                                       first_advance, advance_stride);</span>
<span class="udiff-line-added">+   for (unsigned int i = 0; i &lt; count; i++)</span>
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+     *first_advance = font-&gt;parent_scale_y_distance (*first_advance);</span>
<span class="udiff-line-added">+     first_advance = &amp;StructAtOffsetUnaligned&lt;hb_position_t&gt; (first_advance, advance_stride);</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  static hb_bool_t
  hb_font_get_glyph_h_origin_nil (hb_font_t *font HB_UNUSED,
                                  void *font_data HB_UNUSED,
<span class="udiff-line-modified-removed">-                                 hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-added">+                                 hb_codepoint_t glyph HB_UNUSED,</span>
                                  hb_position_t *x,
                                  hb_position_t *y,
                                  void *user_data HB_UNUSED)
  {
    *x = *y = 0;
    return true;
  }
  static hb_bool_t
<span class="udiff-line-modified-removed">- hb_font_get_glyph_h_origin_parent (hb_font_t *font,</span>
<span class="udiff-line-modified-removed">-                                    void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-removed">-                                    hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-removed">-                                    hb_position_t *x,</span>
<span class="udiff-line-modified-removed">-                                    hb_position_t *y,</span>
<span class="udiff-line-modified-removed">-                                    void *user_data HB_UNUSED)</span>
<span class="udiff-line-modified-added">+ hb_font_get_glyph_h_origin_default (hb_font_t *font,</span>
<span class="udiff-line-modified-added">+                                     void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                     hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-added">+                                     hb_position_t *x,</span>
<span class="udiff-line-modified-added">+                                     hb_position_t *y,</span>
<span class="udiff-line-modified-added">+                                     void *user_data HB_UNUSED)</span>
  {
    hb_bool_t ret = font-&gt;parent-&gt;get_glyph_h_origin (glyph, x, y);
    if (ret)
      font-&gt;parent_scale_position (x, y);
    return ret;
  }
  
  static hb_bool_t
  hb_font_get_glyph_v_origin_nil (hb_font_t *font HB_UNUSED,
                                  void *font_data HB_UNUSED,
<span class="udiff-line-modified-removed">-                                 hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-added">+                                 hb_codepoint_t glyph HB_UNUSED,</span>
                                  hb_position_t *x,
                                  hb_position_t *y,
                                  void *user_data HB_UNUSED)
  {
    *x = *y = 0;
    return false;
  }
  static hb_bool_t
<span class="udiff-line-modified-removed">- hb_font_get_glyph_v_origin_parent (hb_font_t *font,</span>
<span class="udiff-line-modified-removed">-                                    void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-removed">-                                    hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-removed">-                                    hb_position_t *x,</span>
<span class="udiff-line-modified-removed">-                                    hb_position_t *y,</span>
<span class="udiff-line-modified-removed">-                                    void *user_data HB_UNUSED)</span>
<span class="udiff-line-modified-added">+ hb_font_get_glyph_v_origin_default (hb_font_t *font,</span>
<span class="udiff-line-modified-added">+                                     void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                     hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-added">+                                     hb_position_t *x,</span>
<span class="udiff-line-modified-added">+                                     hb_position_t *y,</span>
<span class="udiff-line-modified-added">+                                     void *user_data HB_UNUSED)</span>
  {
    hb_bool_t ret = font-&gt;parent-&gt;get_glyph_v_origin (glyph, x, y);
    if (ret)
      font-&gt;parent_scale_position (x, y);
    return ret;
  }
  
  static hb_position_t
  hb_font_get_glyph_h_kerning_nil (hb_font_t *font HB_UNUSED,
                                   void *font_data HB_UNUSED,
<span class="udiff-line-modified-removed">-                                  hb_codepoint_t left_glyph,</span>
<span class="udiff-line-modified-removed">-                                  hb_codepoint_t right_glyph,</span>
<span class="udiff-line-modified-added">+                                  hb_codepoint_t left_glyph HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                  hb_codepoint_t right_glyph HB_UNUSED,</span>
                                   void *user_data HB_UNUSED)
  {
    return 0;
  }
  static hb_position_t
<span class="udiff-line-modified-removed">- hb_font_get_glyph_h_kerning_parent (hb_font_t *font,</span>
<span class="udiff-line-modified-removed">-                                     void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-removed">-                                     hb_codepoint_t left_glyph,</span>
<span class="udiff-line-modified-removed">-                                     hb_codepoint_t right_glyph,</span>
<span class="udiff-line-modified-removed">-                                     void *user_data HB_UNUSED)</span>
<span class="udiff-line-modified-added">+ hb_font_get_glyph_h_kerning_default (hb_font_t *font,</span>
<span class="udiff-line-modified-added">+                                      void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                      hb_codepoint_t left_glyph,</span>
<span class="udiff-line-modified-added">+                                      hb_codepoint_t right_glyph,</span>
<span class="udiff-line-modified-added">+                                      void *user_data HB_UNUSED)</span>
  {
    return font-&gt;parent_scale_x_distance (font-&gt;parent-&gt;get_glyph_h_kerning (left_glyph, right_glyph));
  }
  
  static hb_position_t
  hb_font_get_glyph_v_kerning_nil (hb_font_t *font HB_UNUSED,
                                   void *font_data HB_UNUSED,
<span class="udiff-line-modified-removed">-                                  hb_codepoint_t top_glyph,</span>
<span class="udiff-line-modified-removed">-                                  hb_codepoint_t bottom_glyph,</span>
<span class="udiff-line-modified-added">+                                  hb_codepoint_t top_glyph HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                  hb_codepoint_t bottom_glyph HB_UNUSED,</span>
                                   void *user_data HB_UNUSED)
  {
    return 0;
  }
  static hb_position_t
<span class="udiff-line-modified-removed">- hb_font_get_glyph_v_kerning_parent (hb_font_t *font,</span>
<span class="udiff-line-modified-removed">-                                     void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-removed">-                                     hb_codepoint_t top_glyph,</span>
<span class="udiff-line-modified-removed">-                                     hb_codepoint_t bottom_glyph,</span>
<span class="udiff-line-modified-removed">-                                     void *user_data HB_UNUSED)</span>
<span class="udiff-line-modified-added">+ hb_font_get_glyph_v_kerning_default (hb_font_t *font,</span>
<span class="udiff-line-modified-added">+                                      void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                      hb_codepoint_t top_glyph,</span>
<span class="udiff-line-modified-added">+                                      hb_codepoint_t bottom_glyph,</span>
<span class="udiff-line-modified-added">+                                      void *user_data HB_UNUSED)</span>
  {
    return font-&gt;parent_scale_y_distance (font-&gt;parent-&gt;get_glyph_v_kerning (top_glyph, bottom_glyph));
  }
  
  static hb_bool_t
  hb_font_get_glyph_extents_nil (hb_font_t *font HB_UNUSED,
                                 void *font_data HB_UNUSED,
<span class="udiff-line-modified-removed">-                                hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-added">+                                hb_codepoint_t glyph HB_UNUSED,</span>
                                 hb_glyph_extents_t *extents,
                                 void *user_data HB_UNUSED)
  {
    memset (extents, 0, sizeof (*extents));
    return false;
  }
  static hb_bool_t
<span class="udiff-line-modified-removed">- hb_font_get_glyph_extents_parent (hb_font_t *font,</span>
<span class="udiff-line-modified-removed">-                                   void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-removed">-                                   hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-removed">-                                   hb_glyph_extents_t *extents,</span>
<span class="udiff-line-modified-removed">-                                   void *user_data HB_UNUSED)</span>
<span class="udiff-line-modified-added">+ hb_font_get_glyph_extents_default (hb_font_t *font,</span>
<span class="udiff-line-modified-added">+                                    void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                    hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-added">+                                    hb_glyph_extents_t *extents,</span>
<span class="udiff-line-modified-added">+                                    void *user_data HB_UNUSED)</span>
  {
    hb_bool_t ret = font-&gt;parent-&gt;get_glyph_extents (glyph, extents);
    if (ret) {
      font-&gt;parent_scale_position (&amp;extents-&gt;x_bearing, &amp;extents-&gt;y_bearing);
      font-&gt;parent_scale_distance (&amp;extents-&gt;width, &amp;extents-&gt;height);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -275,79 +400,79 @@</span>
  }
  
  static hb_bool_t
  hb_font_get_glyph_contour_point_nil (hb_font_t *font HB_UNUSED,
                                       void *font_data HB_UNUSED,
<span class="udiff-line-modified-removed">-                                      hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-removed">-                                      unsigned int point_index,</span>
<span class="udiff-line-modified-added">+                                      hb_codepoint_t glyph HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                      unsigned int point_index HB_UNUSED,</span>
                                       hb_position_t *x,
                                       hb_position_t *y,
                                       void *user_data HB_UNUSED)
  {
    *x = *y = 0;
    return false;
  }
  static hb_bool_t
<span class="udiff-line-modified-removed">- hb_font_get_glyph_contour_point_parent (hb_font_t *font,</span>
<span class="udiff-line-modified-removed">-                                         void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-removed">-                                         hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-removed">-                                         unsigned int point_index,</span>
<span class="udiff-line-modified-removed">-                                         hb_position_t *x,</span>
<span class="udiff-line-modified-removed">-                                         hb_position_t *y,</span>
<span class="udiff-line-modified-removed">-                                         void *user_data HB_UNUSED)</span>
<span class="udiff-line-modified-added">+ hb_font_get_glyph_contour_point_default (hb_font_t *font,</span>
<span class="udiff-line-modified-added">+                                          void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                          hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-added">+                                          unsigned int point_index,</span>
<span class="udiff-line-modified-added">+                                          hb_position_t *x,</span>
<span class="udiff-line-modified-added">+                                          hb_position_t *y,</span>
<span class="udiff-line-modified-added">+                                          void *user_data HB_UNUSED)</span>
  {
    hb_bool_t ret = font-&gt;parent-&gt;get_glyph_contour_point (glyph, point_index, x, y);
    if (ret)
      font-&gt;parent_scale_position (x, y);
    return ret;
  }
  
  static hb_bool_t
  hb_font_get_glyph_name_nil (hb_font_t *font HB_UNUSED,
                              void *font_data HB_UNUSED,
<span class="udiff-line-modified-removed">-                             hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-added">+                             hb_codepoint_t glyph HB_UNUSED,</span>
                              char *name, unsigned int size,
                              void *user_data HB_UNUSED)
  {
    if (size) *name = &#39;\0&#39;;
    return false;
  }
  static hb_bool_t
<span class="udiff-line-modified-removed">- hb_font_get_glyph_name_parent (hb_font_t *font,</span>
<span class="udiff-line-modified-removed">-                                void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-removed">-                                hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-removed">-                                char *name, unsigned int size,</span>
<span class="udiff-line-modified-removed">-                                void *user_data HB_UNUSED)</span>
<span class="udiff-line-modified-added">+ hb_font_get_glyph_name_default (hb_font_t *font,</span>
<span class="udiff-line-modified-added">+                                 void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                 hb_codepoint_t glyph,</span>
<span class="udiff-line-modified-added">+                                 char *name, unsigned int size,</span>
<span class="udiff-line-modified-added">+                                 void *user_data HB_UNUSED)</span>
  {
    return font-&gt;parent-&gt;get_glyph_name (glyph, name, size);
  }
  
  static hb_bool_t
  hb_font_get_glyph_from_name_nil (hb_font_t *font HB_UNUSED,
                                   void *font_data HB_UNUSED,
<span class="udiff-line-modified-removed">-                                  const char *name, int len, /* -1 means nul-terminated */</span>
<span class="udiff-line-modified-added">+                                  const char *name HB_UNUSED,</span>
<span class="udiff-line-added">+                                  int len HB_UNUSED, /* -1 means nul-terminated */</span>
                                   hb_codepoint_t *glyph,
                                   void *user_data HB_UNUSED)
  {
    *glyph = 0;
    return false;
  }
  static hb_bool_t
<span class="udiff-line-modified-removed">- hb_font_get_glyph_from_name_parent (hb_font_t *font,</span>
<span class="udiff-line-modified-removed">-                                     void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-removed">-                                     const char *name, int len, /* -1 means nul-terminated */</span>
<span class="udiff-line-modified-removed">-                                     hb_codepoint_t *glyph,</span>
<span class="udiff-line-modified-removed">-                                     void *user_data HB_UNUSED)</span>
<span class="udiff-line-modified-added">+ hb_font_get_glyph_from_name_default (hb_font_t *font,</span>
<span class="udiff-line-modified-added">+                                      void *font_data HB_UNUSED,</span>
<span class="udiff-line-modified-added">+                                      const char *name, int len, /* -1 means nul-terminated */</span>
<span class="udiff-line-modified-added">+                                      hb_codepoint_t *glyph,</span>
<span class="udiff-line-modified-added">+                                      void *user_data HB_UNUSED)</span>
  {
    return font-&gt;parent-&gt;get_glyph_from_name (name, len, glyph);
  }
  
<span class="udiff-line-modified-removed">- static const hb_font_funcs_t _hb_font_funcs_nil = {</span>
<span class="udiff-line-modified-added">+ DEFINE_NULL_INSTANCE (hb_font_funcs_t) =</span>
<span class="udiff-line-added">+ {</span>
    HB_OBJECT_HEADER_STATIC,
  
<span class="udiff-line-removed">-   true, /* immutable */</span>
<span class="udiff-line-removed">- </span>
    {
  #define HB_FONT_FUNC_IMPLEMENT(name) nullptr,
      HB_FONT_FUNCS_IMPLEMENT_CALLBACKS
  #undef HB_FONT_FUNC_IMPLEMENT
    },
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -362,14 +487,13 @@</span>
        HB_FONT_FUNCS_IMPLEMENT_CALLBACKS
  #undef HB_FONT_FUNC_IMPLEMENT
      }
    }
  };
<span class="udiff-line-removed">- static const hb_font_funcs_t _hb_font_funcs_parent = {</span>
<span class="udiff-line-removed">-   HB_OBJECT_HEADER_STATIC,</span>
  
<span class="udiff-line-modified-removed">-   true, /* immutable */</span>
<span class="udiff-line-modified-added">+ static const hb_font_funcs_t _hb_font_funcs_default = {</span>
<span class="udiff-line-added">+   HB_OBJECT_HEADER_STATIC,</span>
  
    {
  #define HB_FONT_FUNC_IMPLEMENT(name) nullptr,
      HB_FONT_FUNCS_IMPLEMENT_CALLBACKS
  #undef HB_FONT_FUNC_IMPLEMENT
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -379,11 +503,11 @@</span>
      HB_FONT_FUNCS_IMPLEMENT_CALLBACKS
  #undef HB_FONT_FUNC_IMPLEMENT
    },
    {
      {
<span class="udiff-line-modified-removed">- #define HB_FONT_FUNC_IMPLEMENT(name) hb_font_get_##name##_parent,</span>
<span class="udiff-line-modified-added">+ #define HB_FONT_FUNC_IMPLEMENT(name) hb_font_get_##name##_default,</span>
        HB_FONT_FUNCS_IMPLEMENT_CALLBACKS
  #undef HB_FONT_FUNC_IMPLEMENT
      }
    }
  };
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -397,18 +521,18 @@</span>
   * Return value: (transfer full):
   *
   * Since: 0.9.2
   **/
  hb_font_funcs_t *
<span class="udiff-line-modified-removed">- hb_font_funcs_create (void)</span>
<span class="udiff-line-modified-added">+ hb_font_funcs_create ()</span>
  {
    hb_font_funcs_t *ffuncs;
  
    if (!(ffuncs = hb_object_create&lt;hb_font_funcs_t&gt; ()))
      return hb_font_funcs_get_empty ();
  
<span class="udiff-line-modified-removed">-   ffuncs-&gt;get = _hb_font_funcs_parent.get;</span>
<span class="udiff-line-modified-added">+   ffuncs-&gt;get = _hb_font_funcs_default.get;</span>
  
    return ffuncs;
  }
  
  /**
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -419,13 +543,13 @@</span>
   * Return value: (transfer full):
   *
   * Since: 0.9.2
   **/
  hb_font_funcs_t *
<span class="udiff-line-modified-removed">- hb_font_funcs_get_empty (void)</span>
<span class="udiff-line-modified-added">+ hb_font_funcs_get_empty ()</span>
  {
<span class="udiff-line-modified-removed">-   return const_cast&lt;hb_font_funcs_t *&gt; (&amp;_hb_font_funcs_parent);</span>
<span class="udiff-line-modified-added">+   return const_cast&lt;hb_font_funcs_t *&gt; (&amp;_hb_font_funcs_default);</span>
  }
  
  /**
   * hb_font_funcs_reference: (skip)
   * @ffuncs: font functions.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -515,14 +639,14 @@</span>
   * Since: 0.9.2
   **/
  void
  hb_font_funcs_make_immutable (hb_font_funcs_t *ffuncs)
  {
<span class="udiff-line-modified-removed">-   if (unlikely (hb_object_is_inert (ffuncs)))</span>
<span class="udiff-line-modified-added">+   if (hb_object_is_immutable (ffuncs))</span>
      return;
  
<span class="udiff-line-modified-removed">-   ffuncs-&gt;immutable = true;</span>
<span class="udiff-line-modified-added">+   hb_object_make_immutable (ffuncs);</span>
  }
  
  /**
   * hb_font_funcs_is_immutable:
   * @ffuncs: font functions.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -534,11 +658,11 @@</span>
   * Since: 0.9.2
   **/
  hb_bool_t
  hb_font_funcs_is_immutable (hb_font_funcs_t *ffuncs)
  {
<span class="udiff-line-modified-removed">-   return ffuncs-&gt;immutable;</span>
<span class="udiff-line-modified-added">+   return hb_object_is_immutable (ffuncs);</span>
  }
  
  
  #define HB_FONT_FUNC_IMPLEMENT(name) \
                                                                           \
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -546,11 +670,11 @@</span>
  hb_font_funcs_set_##name##_func (hb_font_funcs_t             *ffuncs,    \
                                   hb_font_get_##name##_func_t  func,      \
                                   void                        *user_data, \
                                   hb_destroy_func_t            destroy)   \
  {                                                                        \
<span class="udiff-line-modified-removed">-   if (ffuncs-&gt;immutable) {                                               \</span>
<span class="udiff-line-modified-added">+   if (hb_object_is_immutable (ffuncs)) {                                 \</span>
      if (destroy)                                                         \
        destroy (user_data);                                               \
      return;                                                              \
    }                                                                      \
                                                                           \
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -560,25 +684,30 @@</span>
    if (func) {                                                            \
      ffuncs-&gt;get.f.name = func;                                           \
      ffuncs-&gt;user_data.name = user_data;                                  \
      ffuncs-&gt;destroy.name = destroy;                                      \
    } else {                                                               \
<span class="udiff-line-modified-removed">-     ffuncs-&gt;get.f.name = hb_font_get_##name##_parent;                    \</span>
<span class="udiff-line-modified-removed">-     ffuncs-&gt;user_data.name = nullptr;                                       \</span>
<span class="udiff-line-modified-removed">-     ffuncs-&gt;destroy.name = nullptr;                                         \</span>
<span class="udiff-line-modified-added">+     ffuncs-&gt;get.f.name = hb_font_get_##name##_default;                   \</span>
<span class="udiff-line-modified-added">+     ffuncs-&gt;user_data.name = nullptr;                                    \</span>
<span class="udiff-line-modified-added">+     ffuncs-&gt;destroy.name = nullptr;                                      \</span>
    }                                                                      \
  }
  
  HB_FONT_FUNCS_IMPLEMENT_CALLBACKS
  #undef HB_FONT_FUNC_IMPLEMENT
  
<span class="udiff-line-added">+ bool</span>
<span class="udiff-line-added">+ hb_font_t::has_func_set (unsigned int i)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   return this-&gt;klass-&gt;get.array[i] != _hb_font_funcs_default.get.array[i];</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  bool
  hb_font_t::has_func (unsigned int i)
  {
<span class="udiff-line-modified-removed">-   if (parent &amp;&amp; parent != hb_font_get_empty () &amp;&amp; parent-&gt;has_func (i))</span>
<span class="udiff-line-modified-removed">-     return true;</span>
<span class="udiff-line-removed">-   return this-&gt;klass-&gt;get.array[i] != _hb_font_funcs_parent.get.array[i];</span>
<span class="udiff-line-modified-added">+   return has_func_set (i) ||</span>
<span class="udiff-line-modified-added">+          (parent &amp;&amp; parent != &amp;_hb_Null_hb_font_t &amp;&amp; parent-&gt;has_func (i));</span>
  }
  
  /* Public getters */
  
  /**
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -715,10 +844,47 @@</span>
                               hb_codepoint_t glyph)
  {
    return font-&gt;get_glyph_v_advance (glyph);
  }
  
<span class="udiff-line-added">+ /**</span>
<span class="udiff-line-added">+  * hb_font_get_glyph_h_advances:</span>
<span class="udiff-line-added">+  * @font: a font.</span>
<span class="udiff-line-added">+  *</span>
<span class="udiff-line-added">+  *</span>
<span class="udiff-line-added">+  *</span>
<span class="udiff-line-added">+  * Since: 1.8.6</span>
<span class="udiff-line-added">+  **/</span>
<span class="udiff-line-added">+ void</span>
<span class="udiff-line-added">+ hb_font_get_glyph_h_advances (hb_font_t* font,</span>
<span class="udiff-line-added">+                               unsigned int count,</span>
<span class="udiff-line-added">+                               const hb_codepoint_t *first_glyph,</span>
<span class="udiff-line-added">+                               unsigned glyph_stride,</span>
<span class="udiff-line-added">+                               hb_position_t *first_advance,</span>
<span class="udiff-line-added">+                               unsigned advance_stride)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   font-&gt;get_glyph_h_advances (count, first_glyph, glyph_stride, first_advance, advance_stride);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ /**</span>
<span class="udiff-line-added">+  * hb_font_get_glyph_v_advances:</span>
<span class="udiff-line-added">+  * @font: a font.</span>
<span class="udiff-line-added">+  *</span>
<span class="udiff-line-added">+  *</span>
<span class="udiff-line-added">+  *</span>
<span class="udiff-line-added">+  * Since: 1.8.6</span>
<span class="udiff-line-added">+  **/</span>
<span class="udiff-line-added">+ void</span>
<span class="udiff-line-added">+ hb_font_get_glyph_v_advances (hb_font_t* font,</span>
<span class="udiff-line-added">+                               unsigned int count,</span>
<span class="udiff-line-added">+                               const hb_codepoint_t *first_glyph,</span>
<span class="udiff-line-added">+                               unsigned glyph_stride,</span>
<span class="udiff-line-added">+                               hb_position_t *first_advance,</span>
<span class="udiff-line-added">+                               unsigned advance_stride)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   font-&gt;get_glyph_v_advances (count, first_glyph, glyph_stride, first_advance, advance_stride);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  /**
   * hb_font_get_glyph_h_origin:
   * @font: a font.
   * @glyph:
   * @x: (out):
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -768,10 +934,11 @@</span>
   *
   *
   * Return value:
   *
   * Since: 0.9.2
<span class="udiff-line-added">+  * Deprecated: 2.0.0</span>
   **/
  hb_position_t
  hb_font_get_glyph_h_kerning (hb_font_t *font,
                               hb_codepoint_t left_glyph, hb_codepoint_t right_glyph)
  {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -787,10 +954,11 @@</span>
   *
   *
   * Return value:
   *
   * Since: 0.9.2
<span class="udiff-line-added">+  * Deprecated: 2.0.0</span>
   **/
  hb_position_t
  hb_font_get_glyph_v_kerning (hb_font_t *font,
                               hb_codepoint_t top_glyph, hb_codepoint_t bottom_glyph)
  {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -886,11 +1054,11 @@</span>
  
  /**
   * hb_font_get_extents_for_direction:
   * @font: a font.
   * @direction:
<span class="udiff-line-modified-removed">-  * @extents:</span>
<span class="udiff-line-modified-added">+  * @extents: (out):</span>
   *
   *
   *
   * Since: 1.1.3
   **/
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -919,10 +1087,30 @@</span>
                                           hb_direction_t direction,
                                           hb_position_t *x, hb_position_t *y)
  {
    return font-&gt;get_glyph_advance_for_direction (glyph, direction, x, y);
  }
<span class="udiff-line-added">+ /**</span>
<span class="udiff-line-added">+  * hb_font_get_glyph_advances_for_direction:</span>
<span class="udiff-line-added">+  * @font: a font.</span>
<span class="udiff-line-added">+  * @direction:</span>
<span class="udiff-line-added">+  *</span>
<span class="udiff-line-added">+  *</span>
<span class="udiff-line-added">+  *</span>
<span class="udiff-line-added">+  * Since: 1.8.6</span>
<span class="udiff-line-added">+  **/</span>
<span class="udiff-line-added">+ HB_EXTERN void</span>
<span class="udiff-line-added">+ hb_font_get_glyph_advances_for_direction (hb_font_t* font,</span>
<span class="udiff-line-added">+                                           hb_direction_t direction,</span>
<span class="udiff-line-added">+                                           unsigned int count,</span>
<span class="udiff-line-added">+                                           const hb_codepoint_t *first_glyph,</span>
<span class="udiff-line-added">+                                           unsigned glyph_stride,</span>
<span class="udiff-line-added">+                                           hb_position_t *first_advance,</span>
<span class="udiff-line-added">+                                           unsigned advance_stride)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   font-&gt;get_glyph_advances_for_direction (direction, count, first_glyph, glyph_stride, first_advance, advance_stride);</span>
<span class="udiff-line-added">+ }</span>
  
  /**
   * hb_font_get_glyph_origin_for_direction:
   * @font: a font.
   * @glyph:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -995,10 +1183,11 @@</span>
   * @y: (out):
   *
   *
   *
   * Since: 0.9.2
<span class="udiff-line-added">+  * Deprecated: 2.0.0</span>
   **/
  void
  hb_font_get_glyph_kerning_for_direction (hb_font_t *font,
                                           hb_codepoint_t first_glyph, hb_codepoint_t second_glyph,
                                           hb_direction_t direction,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1098,10 +1287,53 @@</span>
  
  /*
   * hb_font_t
   */
  
<span class="udiff-line-added">+ DEFINE_NULL_INSTANCE (hb_font_t) =</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   HB_OBJECT_HEADER_STATIC,</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   nullptr, /* parent */</span>
<span class="udiff-line-added">+   const_cast&lt;hb_face_t *&gt; (&amp;_hb_Null_hb_face_t),</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   1000, /* x_scale */</span>
<span class="udiff-line-added">+   1000, /* y_scale */</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   0, /* x_ppem */</span>
<span class="udiff-line-added">+   0, /* y_ppem */</span>
<span class="udiff-line-added">+   0, /* ptem */</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   0, /* num_coords */</span>
<span class="udiff-line-added">+   nullptr, /* coords */</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   const_cast&lt;hb_font_funcs_t *&gt; (&amp;_hb_Null_hb_font_funcs_t),</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   /* Zero for the rest is fine. */</span>
<span class="udiff-line-added">+ };</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ static hb_font_t *</span>
<span class="udiff-line-added">+ _hb_font_create (hb_face_t *face)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   hb_font_t *font;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   if (unlikely (!face))</span>
<span class="udiff-line-added">+     face = hb_face_get_empty ();</span>
<span class="udiff-line-added">+   if (!(font = hb_object_create&lt;hb_font_t&gt; ()))</span>
<span class="udiff-line-added">+     return hb_font_get_empty ();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   hb_face_make_immutable (face);</span>
<span class="udiff-line-added">+   font-&gt;parent = hb_font_get_empty ();</span>
<span class="udiff-line-added">+   font-&gt;face = hb_face_reference (face);</span>
<span class="udiff-line-added">+   font-&gt;klass = hb_font_funcs_get_empty ();</span>
<span class="udiff-line-added">+   font-&gt;data.init0 (font);</span>
<span class="udiff-line-added">+   font-&gt;x_scale = font-&gt;y_scale = hb_face_get_upem (face);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   return font;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  /**
   * hb_font_create: (Xconstructor)
   * @face: a face.
   *
   *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1111,23 +1343,14 @@</span>
   * Since: 0.9.2
   **/
  hb_font_t *
  hb_font_create (hb_face_t *face)
  {
<span class="udiff-line-modified-removed">-   hb_font_t *font;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   if (unlikely (!face))</span>
<span class="udiff-line-removed">-     face = hb_face_get_empty ();</span>
<span class="udiff-line-removed">-   if (!(font = hb_object_create&lt;hb_font_t&gt; ()))</span>
<span class="udiff-line-removed">-     return hb_font_get_empty ();</span>
<span class="udiff-line-modified-added">+   hb_font_t *font = _hb_font_create (face);</span>
  
<span class="udiff-line-modified-removed">-   hb_face_make_immutable (face);</span>
<span class="udiff-line-modified-removed">-   font-&gt;parent = hb_font_get_empty ();</span>
<span class="udiff-line-removed">-   font-&gt;face = hb_face_reference (face);</span>
<span class="udiff-line-removed">-   font-&gt;klass = hb_font_funcs_get_empty ();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   font-&gt;x_scale = font-&gt;y_scale = hb_face_get_upem (face);</span>
<span class="udiff-line-modified-added">+   /* Install our in-house, very lightweight, funcs. */</span>
<span class="udiff-line-modified-added">+   hb_ot_font_set_funcs (font);</span>
  
    return font;
  }
  
  /**
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1144,13 +1367,13 @@</span>
  hb_font_create_sub_font (hb_font_t *parent)
  {
    if (unlikely (!parent))
      parent = hb_font_get_empty ();
  
<span class="udiff-line-modified-removed">-   hb_font_t *font = hb_font_create (parent-&gt;face);</span>
<span class="udiff-line-modified-added">+   hb_font_t *font = _hb_font_create (parent-&gt;face);</span>
  
<span class="udiff-line-modified-removed">-   if (unlikely (hb_object_is_inert (font)))</span>
<span class="udiff-line-modified-added">+   if (unlikely (hb_object_is_immutable (font)))</span>
      return font;
  
    font-&gt;parent = hb_font_reference (parent);
  
    font-&gt;x_scale = parent-&gt;x_scale;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1183,42 +1406,13 @@</span>
   * Return value: (transfer full)
   *
   * Since: 0.9.2
   **/
  hb_font_t *
<span class="udiff-line-modified-removed">- hb_font_get_empty (void)</span>
<span class="udiff-line-modified-added">+ hb_font_get_empty ()</span>
  {
<span class="udiff-line-modified-removed">-   static const hb_font_t _hb_font_nil = {</span>
<span class="udiff-line-removed">-     HB_OBJECT_HEADER_STATIC,</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     true, /* immutable */</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     nullptr, /* parent */</span>
<span class="udiff-line-removed">-     const_cast&lt;hb_face_t *&gt; (&amp;_hb_face_nil),</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     1000, /* x_scale */</span>
<span class="udiff-line-removed">-     1000, /* y_scale */</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     0, /* x_ppem */</span>
<span class="udiff-line-removed">-     0, /* y_ppem */</span>
<span class="udiff-line-removed">-     0, /* ptem */</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     0, /* num_coords */</span>
<span class="udiff-line-removed">-     nullptr, /* coords */</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     const_cast&lt;hb_font_funcs_t *&gt; (&amp;_hb_font_funcs_nil), /* klass */</span>
<span class="udiff-line-removed">-     nullptr, /* user_data */</span>
<span class="udiff-line-removed">-     nullptr, /* destroy */</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     {</span>
<span class="udiff-line-removed">- #define HB_SHAPER_IMPLEMENT(shaper) HB_SHAPER_DATA_INVALID,</span>
<span class="udiff-line-removed">- #include &quot;hb-shaper-list.hh&quot;</span>
<span class="udiff-line-removed">- #undef HB_SHAPER_IMPLEMENT</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-   };</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   return const_cast&lt;hb_font_t *&gt; (&amp;_hb_font_nil);</span>
<span class="udiff-line-modified-added">+   return const_cast&lt;hb_font_t *&gt; (&amp;Null(hb_font_t));</span>
  }
  
  /**
   * hb_font_reference: (skip)
   * @font: a font.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1246,13 +1440,11 @@</span>
  void
  hb_font_destroy (hb_font_t *font)
  {
    if (!hb_object_destroy (font)) return;
  
<span class="udiff-line-modified-removed">- #define HB_SHAPER_IMPLEMENT(shaper) HB_SHAPER_DATA_DESTROY(shaper, font);</span>
<span class="udiff-line-removed">- #include &quot;hb-shaper-list.hh&quot;</span>
<span class="udiff-line-removed">- #undef HB_SHAPER_IMPLEMENT</span>
<span class="udiff-line-modified-added">+   font-&gt;data.fini ();</span>
  
    if (font-&gt;destroy)
      font-&gt;destroy (font-&gt;user_data);
  
    hb_font_destroy (font-&gt;parent);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1315,17 +1507,17 @@</span>
   * Since: 0.9.2
   **/
  void
  hb_font_make_immutable (hb_font_t *font)
  {
<span class="udiff-line-modified-removed">-   if (unlikely (hb_object_is_inert (font)))</span>
<span class="udiff-line-modified-added">+   if (hb_object_is_immutable (font))</span>
      return;
  
    if (font-&gt;parent)
      hb_font_make_immutable (font-&gt;parent);
  
<span class="udiff-line-modified-removed">-   font-&gt;immutable = true;</span>
<span class="udiff-line-modified-added">+   hb_object_make_immutable (font);</span>
  }
  
  /**
   * hb_font_is_immutable:
   * @font: a font.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1337,11 +1529,11 @@</span>
   * Since: 0.9.2
   **/
  hb_bool_t
  hb_font_is_immutable (hb_font_t *font)
  {
<span class="udiff-line-modified-removed">-   return font-&gt;immutable;</span>
<span class="udiff-line-modified-added">+   return hb_object_is_immutable (font);</span>
  }
  
  /**
   * hb_font_set_parent:
   * @font: a font.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1353,11 +1545,11 @@</span>
   **/
  void
  hb_font_set_parent (hb_font_t *font,
                      hb_font_t *parent)
  {
<span class="udiff-line-modified-removed">-   if (font-&gt;immutable)</span>
<span class="udiff-line-modified-added">+   if (hb_object_is_immutable (font))</span>
      return;
  
    if (!parent)
      parent = hb_font_get_empty ();
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1395,11 +1587,11 @@</span>
   **/
  void
  hb_font_set_face (hb_font_t *font,
                    hb_face_t *face)
  {
<span class="udiff-line-modified-removed">-   if (font-&gt;immutable)</span>
<span class="udiff-line-modified-added">+   if (hb_object_is_immutable (font))</span>
      return;
  
    if (unlikely (!face))
      face = hb_face_get_empty ();
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1442,11 +1634,12 @@</span>
  hb_font_set_funcs (hb_font_t         *font,
                     hb_font_funcs_t   *klass,
                     void              *font_data,
                     hb_destroy_func_t  destroy)
  {
<span class="udiff-line-modified-removed">-   if (font-&gt;immutable) {</span>
<span class="udiff-line-modified-added">+   if (hb_object_is_immutable (font))</span>
<span class="udiff-line-added">+   {</span>
      if (destroy)
        destroy (font_data);
      return;
    }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1477,11 +1670,12 @@</span>
  hb_font_set_funcs_data (hb_font_t         *font,
                          void              *font_data,
                          hb_destroy_func_t  destroy)
  {
    /* Destroy user_data? */
<span class="udiff-line-modified-removed">-   if (font-&gt;immutable) {</span>
<span class="udiff-line-modified-added">+   if (hb_object_is_immutable (font))</span>
<span class="udiff-line-added">+   {</span>
      if (destroy)
        destroy (font_data);
      return;
    }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1506,11 +1700,11 @@</span>
  void
  hb_font_set_scale (hb_font_t *font,
                     int x_scale,
                     int y_scale)
  {
<span class="udiff-line-modified-removed">-   if (font-&gt;immutable)</span>
<span class="udiff-line-modified-added">+   if (hb_object_is_immutable (font))</span>
      return;
  
    font-&gt;x_scale = x_scale;
    font-&gt;y_scale = y_scale;
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1547,11 +1741,11 @@</span>
  void
  hb_font_set_ppem (hb_font_t *font,
                    unsigned int x_ppem,
                    unsigned int y_ppem)
  {
<span class="udiff-line-modified-removed">-   if (font-&gt;immutable)</span>
<span class="udiff-line-modified-added">+   if (hb_object_is_immutable (font))</span>
      return;
  
    font-&gt;x_ppem = x_ppem;
    font-&gt;y_ppem = y_ppem;
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1576,20 +1770,22 @@</span>
  }
  
  /**
   * hb_font_set_ptem:
   * @font: a font.
<span class="udiff-line-modified-removed">-  * @ptem:</span>
<span class="udiff-line-modified-added">+  * @ptem: font size in points.</span>
<span class="udiff-line-added">+  *</span>
<span class="udiff-line-added">+  * Sets &quot;point size&quot; of the font.  Set to 0 to unset.</span>
   *
<span class="udiff-line-modified-removed">-  * Sets &quot;point size&quot; of the font.</span>
<span class="udiff-line-modified-added">+  * There are 72 points in an inch.</span>
   *
   * Since: 1.6.0
   **/
  void
  hb_font_set_ptem (hb_font_t *font, float ptem)
  {
<span class="udiff-line-modified-removed">-   if (font-&gt;immutable)</span>
<span class="udiff-line-modified-added">+   if (hb_object_is_immutable (font))</span>
      return;
  
    font-&gt;ptem = ptem;
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1632,11 +1828,11 @@</span>
  void
  hb_font_set_variations (hb_font_t *font,
                          const hb_variation_t *variations,
                          unsigned int variations_length)
  {
<span class="udiff-line-modified-removed">-   if (font-&gt;immutable)</span>
<span class="udiff-line-modified-added">+   if (hb_object_is_immutable (font))</span>
      return;
  
    if (!variations_length)
    {
      hb_font_set_var_coords_normalized (font, nullptr, 0);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1663,11 +1859,11 @@</span>
  void
  hb_font_set_var_coords_design (hb_font_t *font,
                                 const float *coords,
                                 unsigned int coords_length)
  {
<span class="udiff-line-modified-removed">-   if (font-&gt;immutable)</span>
<span class="udiff-line-modified-added">+   if (hb_object_is_immutable (font))</span>
      return;
  
    int *normalized = coords_length ? (int *) calloc (coords_length, sizeof (int)) : nullptr;
    if (unlikely (coords_length &amp;&amp; !normalized))
      return;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1684,11 +1880,11 @@</span>
  void
  hb_font_set_var_coords_normalized (hb_font_t *font,
                                     const int *coords, /* 2.14 normalized */
                                     unsigned int coords_length)
  {
<span class="udiff-line-modified-removed">-   if (font-&gt;immutable)</span>
<span class="udiff-line-modified-added">+   if (hb_object_is_immutable (font))</span>
      return;
  
    int *copy = coords_length ? (int *) calloc (coords_length, sizeof (coords[0])) : nullptr;
    if (unlikely (coords_length &amp;&amp; !copy))
      return;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1716,12 +1912,10 @@</span>
  
    return font-&gt;coords;
  }
  
  
<span class="udiff-line-removed">- #ifndef HB_DISABLE_DEPRECATED</span>
<span class="udiff-line-removed">- </span>
  /*
   * Deprecated get_glyph_func():
   */
  
  struct hb_trampoline_closure_t
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1804,13 +1998,13 @@</span>
  }
  
  /**
   * hb_font_funcs_set_glyph_func:
   * @ffuncs: font functions.
<span class="udiff-line-modified-removed">-  * @func: (closure user_data) (destroy destroy) (scope notified):</span>
<span class="udiff-line-modified-removed">-  * @user_data:</span>
<span class="udiff-line-modified-removed">-  * @destroy:</span>
<span class="udiff-line-modified-added">+  * @func: (closure user_data) (destroy destroy) (scope notified): callback function.</span>
<span class="udiff-line-modified-added">+  * @user_data: data to pass to @func.</span>
<span class="udiff-line-modified-added">+  * @destroy: function to call when @user_data is not needed anymore.</span>
   *
   * Deprecated.  Use hb_font_funcs_set_nominal_glyph_func() and
   * hb_font_funcs_set_variation_glyph_func() instead.
   *
   * Since: 0.9.2
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1840,7 +2034,5 @@</span>
    hb_font_funcs_set_variation_glyph_func (ffuncs,
                                            hb_font_get_variation_glyph_trampoline,
                                            trampoline,
                                            trampoline_destroy);
  }
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- #endif /* HB_DISABLE_DEPRECATED */</span>
</pre>
<center><a href="hb-fallback-shape.cc.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="hb-font.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>