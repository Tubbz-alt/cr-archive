<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/native/libfontmanager/harfbuzz/hb-ot-color-svg-table.hh</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="hb-ot-color-sbix-table.hh.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="hb-ot-font.cc.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfontmanager/harfbuzz/hb-ot-color-svg-table.hh</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  8  * software and its documentation for any purpose, provided that the
  9  * above copyright notice and the following two paragraphs appear in
 10  * all copies of this software.
 11  *
 12  * IN NO EVENT SHALL THE COPYRIGHT HOLDER BE LIABLE TO ANY PARTY FOR
 13  * DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES
 14  * ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN
 15  * IF THE COPYRIGHT HOLDER HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH
 16  * DAMAGE.
 17  *
 18  * THE COPYRIGHT HOLDER SPECIFICALLY DISCLAIMS ANY WARRANTIES, INCLUDING,
 19  * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
 20  * FITNESS FOR A PARTICULAR PURPOSE.  THE SOFTWARE PROVIDED HEREUNDER IS
 21  * ON AN &quot;AS IS&quot; BASIS, AND THE COPYRIGHT HOLDER HAS NO OBLIGATION TO
 22  * PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS.
 23  */
 24 
 25 #ifndef HB_OT_COLOR_SVG_TABLE_HH
 26 #define HB_OT_COLOR_SVG_TABLE_HH
 27 
<span class="line-modified"> 28 #include &quot;hb-open-type-private.hh&quot;</span>
 29 
 30 /*
 31  * SVG -- SVG (Scalable Vector Graphics)
 32  * https://docs.microsoft.com/en-us/typography/opentype/spec/svg
 33  */
 34 
 35 #define HB_OT_TAG_SVG HB_TAG(&#39;S&#39;,&#39;V&#39;,&#39;G&#39;,&#39; &#39;)
 36 
 37 
 38 namespace OT {
 39 
 40 
 41 struct SVGDocumentIndexEntry
 42 {
<span class="line-modified"> 43   friend struct SVG;</span>

 44 
<span class="line-modified"> 45   inline bool sanitize (hb_sanitize_context_t *c, const void* base) const</span>







 46   {
 47     TRACE_SANITIZE (this);
 48     return_trace (c-&gt;check_struct (this) &amp;&amp;
<span class="line-modified"> 49                   (base+svgDoc).sanitize (c, svgDocLength));</span>
 50   }
 51 
 52   protected:
 53   HBUINT16      startGlyphID;   /* The first glyph ID in the range described by
 54                                  * this index entry. */
 55   HBUINT16      endGlyphID;     /* The last glyph ID in the range described by
 56                                  * this index entry. Must be &gt;= startGlyphID. */
<span class="line-modified"> 57   LOffsetTo&lt;UnsizedArrayOf&lt;HBUINT8&gt; &gt;</span>
 58                 svgDoc;         /* Offset from the beginning of the SVG Document Index
 59                                  * to an SVG document. Must be non-zero. */
<span class="line-modified"> 60   HBUINT32 svgDocLength;        /* Length of the SVG document.</span>
 61                                  * Must be non-zero. */
 62   public:
 63   DEFINE_SIZE_STATIC (12);
 64 };
 65 
<span class="line-removed"> 66 struct SVGDocumentIndex</span>
<span class="line-removed"> 67 {</span>
<span class="line-removed"> 68   friend struct SVG;</span>
<span class="line-removed"> 69 </span>
<span class="line-removed"> 70   inline bool sanitize (hb_sanitize_context_t *c) const</span>
<span class="line-removed"> 71   {</span>
<span class="line-removed"> 72     TRACE_SANITIZE (this);</span>
<span class="line-removed"> 73     return_trace (c-&gt;check_struct (this) &amp;&amp;</span>
<span class="line-removed"> 74                   entries.sanitize (c, this));</span>
<span class="line-removed"> 75   }</span>
<span class="line-removed"> 76 </span>
<span class="line-removed"> 77   protected:</span>
<span class="line-removed"> 78   ArrayOf&lt;SVGDocumentIndexEntry&gt;</span>
<span class="line-removed"> 79                 entries;        /* Array of SVG Document Index Entries. */</span>
<span class="line-removed"> 80   public:</span>
<span class="line-removed"> 81   DEFINE_SIZE_ARRAY (2, entries);</span>
<span class="line-removed"> 82 };</span>
<span class="line-removed"> 83 </span>
 84 struct SVG
 85 {
<span class="line-modified"> 86   static const hb_tag_t tableTag = HB_OT_TAG_SVG;</span>
 87 
<span class="line-modified"> 88   inline bool sanitize (hb_sanitize_context_t *c) const</span>
<span class="line-removed"> 89   {</span>
<span class="line-removed"> 90     TRACE_SANITIZE (this);</span>
<span class="line-removed"> 91     return_trace (likely (c-&gt;check_struct (this) &amp;&amp;</span>
<span class="line-removed"> 92                           (this+svgDocIndex).sanitize (c)));</span>
<span class="line-removed"> 93   }</span>
 94 
 95   struct accelerator_t
 96   {
<span class="line-modified"> 97     inline void init (hb_face_t *face)</span>
<span class="line-modified"> 98     {</span>
<span class="line-modified"> 99       OT::Sanitizer&lt;OT::SVG&gt; sanitizer;</span>
<span class="line-removed">100       svg_blob = sanitizer.sanitize (face-&gt;reference_table (HB_OT_TAG_SVG));</span>
<span class="line-removed">101       svg_len = hb_blob_get_length (svg_blob);</span>
<span class="line-removed">102       svg = svg_blob-&gt;as&lt;OT::SVG&gt; ();</span>
<span class="line-removed">103 </span>
<span class="line-removed">104     }</span>
105 
<span class="line-modified">106     inline void fini (void)</span>
107     {
<span class="line-modified">108       hb_blob_destroy (svg_blob);</span>

109     }
110 
<span class="line-modified">111     inline void</span>
<span class="line-removed">112     dump (void (*callback) (const uint8_t* data, unsigned int length,</span>
<span class="line-removed">113                             unsigned int start_glyph, unsigned int end_glyph)) const</span>
<span class="line-removed">114     {</span>
<span class="line-removed">115       const SVGDocumentIndex &amp;index = svg+svg-&gt;svgDocIndex;</span>
<span class="line-removed">116       const ArrayOf&lt;SVGDocumentIndexEntry&gt; &amp;entries = index.entries;</span>
<span class="line-removed">117       for (unsigned int i = 0; i &lt; entries.len; ++i)</span>
<span class="line-removed">118       {</span>
<span class="line-removed">119         const SVGDocumentIndexEntry &amp;entry = entries[i];</span>
<span class="line-removed">120         callback ((const uint8_t*) &amp;entry.svgDoc (&amp;index), entry.svgDocLength,</span>
<span class="line-removed">121                                                   entry.startGlyphID, entry.endGlyphID);</span>
<span class="line-removed">122       }</span>
<span class="line-removed">123     }</span>
124 
125     private:
<span class="line-modified">126     hb_blob_t *svg_blob;</span>
<span class="line-removed">127     const SVG *svg;</span>
<span class="line-removed">128 </span>
<span class="line-removed">129     unsigned int svg_len;</span>
130   };
131 










132   protected:
133   HBUINT16      version;        /* Table version (starting at 0). */
<span class="line-modified">134   LOffsetTo&lt;SVGDocumentIndex&gt;</span>
<span class="line-modified">135                 svgDocIndex;    /* Offset (relative to the start of the SVG table) to the</span>
136                                  * SVG Documents Index. Must be non-zero. */

137   HBUINT32      reserved;       /* Set to 0. */
138   public:
139   DEFINE_SIZE_STATIC (10);
140 };
141 


142 } /* namespace OT */
143 
144 
145 #endif /* HB_OT_COLOR_SVG_TABLE_HH */
</pre>
</td>
<td>
<hr />
<pre>
  8  * software and its documentation for any purpose, provided that the
  9  * above copyright notice and the following two paragraphs appear in
 10  * all copies of this software.
 11  *
 12  * IN NO EVENT SHALL THE COPYRIGHT HOLDER BE LIABLE TO ANY PARTY FOR
 13  * DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES
 14  * ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN
 15  * IF THE COPYRIGHT HOLDER HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH
 16  * DAMAGE.
 17  *
 18  * THE COPYRIGHT HOLDER SPECIFICALLY DISCLAIMS ANY WARRANTIES, INCLUDING,
 19  * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
 20  * FITNESS FOR A PARTICULAR PURPOSE.  THE SOFTWARE PROVIDED HEREUNDER IS
 21  * ON AN &quot;AS IS&quot; BASIS, AND THE COPYRIGHT HOLDER HAS NO OBLIGATION TO
 22  * PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS.
 23  */
 24 
 25 #ifndef HB_OT_COLOR_SVG_TABLE_HH
 26 #define HB_OT_COLOR_SVG_TABLE_HH
 27 
<span class="line-modified"> 28 #include &quot;hb-open-type.hh&quot;</span>
 29 
 30 /*
 31  * SVG -- SVG (Scalable Vector Graphics)
 32  * https://docs.microsoft.com/en-us/typography/opentype/spec/svg
 33  */
 34 
 35 #define HB_OT_TAG_SVG HB_TAG(&#39;S&#39;,&#39;V&#39;,&#39;G&#39;,&#39; &#39;)
 36 
 37 
 38 namespace OT {
 39 
 40 
 41 struct SVGDocumentIndexEntry
 42 {
<span class="line-modified"> 43   int cmp (hb_codepoint_t g) const</span>
<span class="line-added"> 44   { return g &lt; startGlyphID ? -1 : g &gt; endGlyphID ? 1 : 0; }</span>
 45 
<span class="line-modified"> 46   hb_blob_t *reference_blob (hb_blob_t *svg_blob, unsigned int index_offset) const</span>
<span class="line-added"> 47   {</span>
<span class="line-added"> 48     return hb_blob_create_sub_blob (svg_blob,</span>
<span class="line-added"> 49                                     index_offset + (unsigned int) svgDoc,</span>
<span class="line-added"> 50                                     svgDocLength);</span>
<span class="line-added"> 51   }</span>
<span class="line-added"> 52 </span>
<span class="line-added"> 53   bool sanitize (hb_sanitize_context_t *c, const void *base) const</span>
 54   {
 55     TRACE_SANITIZE (this);
 56     return_trace (c-&gt;check_struct (this) &amp;&amp;
<span class="line-modified"> 57                   svgDoc.sanitize (c, base, svgDocLength));</span>
 58   }
 59 
 60   protected:
 61   HBUINT16      startGlyphID;   /* The first glyph ID in the range described by
 62                                  * this index entry. */
 63   HBUINT16      endGlyphID;     /* The last glyph ID in the range described by
 64                                  * this index entry. Must be &gt;= startGlyphID. */
<span class="line-modified"> 65   LNNOffsetTo&lt;UnsizedArrayOf&lt;HBUINT8&gt; &gt;</span>
 66                 svgDoc;         /* Offset from the beginning of the SVG Document Index
 67                                  * to an SVG document. Must be non-zero. */
<span class="line-modified"> 68   HBUINT32      svgDocLength;   /* Length of the SVG document.</span>
 69                                  * Must be non-zero. */
 70   public:
 71   DEFINE_SIZE_STATIC (12);
 72 };
 73 


















 74 struct SVG
 75 {
<span class="line-modified"> 76   static constexpr hb_tag_t tableTag = HB_OT_TAG_SVG;</span>
 77 
<span class="line-modified"> 78   bool has_data () const { return svgDocEntries; }</span>





 79 
 80   struct accelerator_t
 81   {
<span class="line-modified"> 82     void init (hb_face_t *face)</span>
<span class="line-modified"> 83     { table = hb_sanitize_context_t().reference_table&lt;SVG&gt; (face); }</span>
<span class="line-modified"> 84     void fini () { table.destroy (); }</span>





 85 
<span class="line-modified"> 86     hb_blob_t *reference_blob_for_glyph (hb_codepoint_t glyph_id) const</span>
 87     {
<span class="line-modified"> 88       return table-&gt;get_glyph_entry (glyph_id).reference_blob (table.get_blob (),</span>
<span class="line-added"> 89                                                                table-&gt;svgDocEntries);</span>
 90     }
 91 
<span class="line-modified"> 92     bool has_data () const { return table-&gt;has_data (); }</span>












 93 
 94     private:
<span class="line-modified"> 95     hb_blob_ptr_t&lt;SVG&gt; table;</span>



 96   };
 97 
<span class="line-added"> 98   const SVGDocumentIndexEntry &amp;get_glyph_entry (hb_codepoint_t glyph_id) const</span>
<span class="line-added"> 99   { return (this+svgDocEntries).bsearch (glyph_id); }</span>
<span class="line-added">100 </span>
<span class="line-added">101   bool sanitize (hb_sanitize_context_t *c) const</span>
<span class="line-added">102   {</span>
<span class="line-added">103     TRACE_SANITIZE (this);</span>
<span class="line-added">104     return_trace (likely (c-&gt;check_struct (this) &amp;&amp;</span>
<span class="line-added">105                           (this+svgDocEntries).sanitize_shallow (c)));</span>
<span class="line-added">106   }</span>
<span class="line-added">107 </span>
108   protected:
109   HBUINT16      version;        /* Table version (starting at 0). */
<span class="line-modified">110   LOffsetTo&lt;SortedArrayOf&lt;SVGDocumentIndexEntry&gt; &gt;</span>
<span class="line-modified">111                 svgDocEntries;  /* Offset (relative to the start of the SVG table) to the</span>
112                                  * SVG Documents Index. Must be non-zero. */
<span class="line-added">113                                 /* Array of SVG Document Index Entries. */</span>
114   HBUINT32      reserved;       /* Set to 0. */
115   public:
116   DEFINE_SIZE_STATIC (10);
117 };
118 
<span class="line-added">119 struct SVG_accelerator_t : SVG::accelerator_t {};</span>
<span class="line-added">120 </span>
121 } /* namespace OT */
122 
123 
124 #endif /* HB_OT_COLOR_SVG_TABLE_HH */
</pre>
</td>
</tr>
</table>
<center><a href="hb-ot-color-sbix-table.hh.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="hb-ot-font.cc.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>