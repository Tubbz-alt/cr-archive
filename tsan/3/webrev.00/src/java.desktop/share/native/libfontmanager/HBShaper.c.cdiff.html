<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/native/libfontmanager/HBShaper.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="DrawGlyphList.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="freetypeScaler.c.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfontmanager/HBShaper.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 199,13 ***</span>
  JDKFontInfo*
       createJDKFontInfo(JNIEnv *env,
                         jobject font2D,
                         jobject fontStrike,
                         jfloat ptSize,
<span class="line-removed">-                        jlong pScaler,</span>
                         jlong pNativeFont,
<span class="line-removed">-                        jlong layoutTables,</span>
                         jfloatArray matrix,
                         jboolean aat) {
  
  
      JDKFontInfo *fi = (JDKFontInfo*)malloc(sizeof(JDKFontInfo));
<span class="line-new-header">--- 199,11 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 214,11 ***</span>
      }
      fi-&gt;env = env; // this is valid only for the life of this JNI call.
      fi-&gt;font2D = font2D;
      fi-&gt;fontStrike = fontStrike;
      fi-&gt;nativeFont = pNativeFont;
<span class="line-removed">-     fi-&gt;layoutTables = (TTLayoutTableCache*)layoutTables;</span>
      fi-&gt;aat = aat;
      (*env)-&gt;GetFloatArrayRegion(env, matrix, 0, 4, fi-&gt;matrix);
      fi-&gt;ptSize = ptSize;
      fi-&gt;xPtSize = euclidianDistance(fi-&gt;matrix[0], fi-&gt;matrix[1]);
      fi-&gt;yPtSize = euclidianDistance(fi-&gt;matrix[2], fi-&gt;matrix[3]);
<span class="line-new-header">--- 212,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 239,13 ***</span>
      (JNIEnv *env, jclass cls,
       jobject font2D,
       jobject fontStrike,
       jfloat ptSize,
       jfloatArray matrix,
<span class="line-removed">-      jlong pScaler,</span>
       jlong pNativeFont,
<span class="line-modified">!      jlong layoutTables,</span>
       jboolean aat,
       jcharArray text,
       jobject gvdata,
       jint script,
       jint offset,
<span class="line-new-header">--- 236,12 ---</span>
      (JNIEnv *env, jclass cls,
       jobject font2D,
       jobject fontStrike,
       jfloat ptSize,
       jfloatArray matrix,
       jlong pNativeFont,
<span class="line-modified">!      jlong pFace,</span>
       jboolean aat,
       jcharArray text,
       jobject gvdata,
       jint script,
       jint offset,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 254,10 ***</span>
<span class="line-new-header">--- 250,11 ---</span>
       jobject startPt,
       jint flags,
       jint slot) {
  
       hb_buffer_t *buffer;
<span class="line-added">+      hb_face_t* hbface;</span>
       hb_font_t* hbfont;
       jchar  *chars;
       jsize len;
       int glyphCount;
       hb_glyph_info_t *glyphInfo;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 270,19 ***</span>
       jboolean ret;
       unsigned int buflen;
  
       JDKFontInfo *jdkFontInfo =
           createJDKFontInfo(env, font2D, fontStrike, ptSize,
<span class="line-modified">!                            pScaler, pNativeFont, layoutTables, matrix, aat);</span>
       if (!jdkFontInfo) {
          return JNI_FALSE;
       }
       jdkFontInfo-&gt;env = env; // this is valid only for the life of this JNI call.
       jdkFontInfo-&gt;font2D = font2D;
       jdkFontInfo-&gt;fontStrike = fontStrike;
  
<span class="line-modified">!      hbfont = hb_jdk_font_create(jdkFontInfo, NULL);</span>
  
       buffer = hb_buffer_create();
       hb_buffer_set_script(buffer, getHBScriptCode(script));
       hb_buffer_set_language(buffer,
                              hb_ot_tag_to_language(HB_OT_TAG_DEFAULT_LANGUAGE));
<span class="line-new-header">--- 267,20 ---</span>
       jboolean ret;
       unsigned int buflen;
  
       JDKFontInfo *jdkFontInfo =
           createJDKFontInfo(env, font2D, fontStrike, ptSize,
<span class="line-modified">!                            pNativeFont, matrix, aat);</span>
       if (!jdkFontInfo) {
          return JNI_FALSE;
       }
       jdkFontInfo-&gt;env = env; // this is valid only for the life of this JNI call.
       jdkFontInfo-&gt;font2D = font2D;
       jdkFontInfo-&gt;fontStrike = fontStrike;
  
<span class="line-modified">!      hbface = (hb_face_t*) jlong_to_ptr(pFace);</span>
<span class="line-added">+      hbfont = hb_jdk_font_create(hbface, jdkFontInfo, NULL);</span>
  
       buffer = hb_buffer_create();
       hb_buffer_set_script(buffer, getHBScriptCode(script));
       hb_buffer_set_language(buffer,
                              hb_ot_tag_to_language(HB_OT_TAG_DEFAULT_LANGUAGE));
</pre>
<center><a href="DrawGlyphList.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="freetypeScaler.c.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>