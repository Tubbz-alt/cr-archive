<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/native/libfontmanager/harfbuzz/hb-ot-var.cc</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="hb-ot-var-mvar-table.hh.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="hb-ot-var.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfontmanager/harfbuzz/hb-ot-var.cc</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 22,94 ***</span>
   * PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS.
   *
   * Google Author(s): Behdad Esfahbod
   */
  
<span class="line-modified">! #include &quot;hb-open-type-private.hh&quot;</span>
  
<span class="line-modified">! #include &quot;hb-ot-layout-private.hh&quot;</span>
  #include &quot;hb-ot-var-avar-table.hh&quot;
  #include &quot;hb-ot-var-fvar-table.hh&quot;
  #include &quot;hb-ot-var-mvar-table.hh&quot;
  #include &quot;hb-ot-var.h&quot;
  
  /*
   * fvar/avar
   */
  
<span class="line-removed">- static inline const OT::fvar&amp;</span>
<span class="line-removed">- _get_fvar (hb_face_t *face)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-   if (unlikely (!hb_ot_shaper_face_data_ensure (face))) return Null(OT::fvar);</span>
<span class="line-removed">-   hb_ot_layout_t * layout = hb_ot_layout_from_face (face);</span>
<span class="line-removed">-   return *(layout-&gt;fvar.get ());</span>
<span class="line-removed">- }</span>
<span class="line-removed">- static inline const OT::avar&amp;</span>
<span class="line-removed">- _get_avar (hb_face_t *face)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-   if (unlikely (!hb_ot_shaper_face_data_ensure (face))) return Null(OT::avar);</span>
<span class="line-removed">-   hb_ot_layout_t * layout = hb_ot_layout_from_face (face);</span>
<span class="line-removed">-   return *(layout-&gt;avar.get ());</span>
<span class="line-removed">- }</span>
  
  /**
   * hb_ot_var_has_data:
   * @face: #hb_face_t to test
   *
   * This function allows to verify the presence of OpenType variation data on the face.
<span class="line-removed">-  * Alternatively, use hb_ot_var_get_axis_count().</span>
   *
   * Return value: true if face has a `fvar&#39; table and false otherwise
   *
   * Since: 1.4.2
   **/
  hb_bool_t
  hb_ot_var_has_data (hb_face_t *face)
  {
<span class="line-modified">!   return &amp;_get_fvar (face) != &amp;Null(OT::fvar);</span>
  }
  
  /**
   * hb_ot_var_get_axis_count:
   *
   * Since: 1.4.2
   **/
  unsigned int
  hb_ot_var_get_axis_count (hb_face_t *face)
  {
<span class="line-modified">!   const OT::fvar &amp;fvar = _get_fvar (face);</span>
<span class="line-removed">-   return fvar.get_axis_count ();</span>
  }
  
  /**
   * hb_ot_var_get_axes:
   *
   * Since: 1.4.2
   **/
  unsigned int
  hb_ot_var_get_axes (hb_face_t        *face,
                      unsigned int      start_offset,
                      unsigned int     *axes_count /* IN/OUT */,
                      hb_ot_var_axis_t *axes_array /* OUT */)
  {
<span class="line-modified">!   const OT::fvar &amp;fvar = _get_fvar (face);</span>
<span class="line-removed">-   return fvar.get_axis_infos (start_offset, axes_count, axes_array);</span>
  }
  
  /**
   * hb_ot_var_find_axis:
   *
   * Since: 1.4.2
   **/
  hb_bool_t
  hb_ot_var_find_axis (hb_face_t        *face,
                       hb_tag_t          axis_tag,
                       unsigned int     *axis_index,
                       hb_ot_var_axis_t *axis_info)
  {
<span class="line-modified">!   const OT::fvar &amp;fvar = _get_fvar (face);</span>
<span class="line-modified">!   return fvar.find_axis (axis_tag, axis_index, axis_info);</span>
  }
  
  
  /**
   * hb_ot_var_normalize_variations:
<span class="line-new-header">--- 22,150 ---</span>
   * PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS.
   *
   * Google Author(s): Behdad Esfahbod
   */
  
<span class="line-modified">! #include &quot;hb-open-type.hh&quot;</span>
  
<span class="line-modified">! #include &quot;hb-ot-face.hh&quot;</span>
  #include &quot;hb-ot-var-avar-table.hh&quot;
  #include &quot;hb-ot-var-fvar-table.hh&quot;
  #include &quot;hb-ot-var-mvar-table.hh&quot;
  #include &quot;hb-ot-var.h&quot;
  
<span class="line-added">+ </span>
<span class="line-added">+ /**</span>
<span class="line-added">+  * SECTION:hb-ot-var</span>
<span class="line-added">+  * @title: hb-ot-var</span>
<span class="line-added">+  * @short_description: OpenType Font Variations</span>
<span class="line-added">+  * @include: hb-ot.h</span>
<span class="line-added">+  *</span>
<span class="line-added">+  * Functions for fetching information about OpenType Variable Fonts.</span>
<span class="line-added">+  **/</span>
<span class="line-added">+ </span>
<span class="line-added">+ </span>
  /*
   * fvar/avar
   */
  
  
  /**
   * hb_ot_var_has_data:
   * @face: #hb_face_t to test
   *
   * This function allows to verify the presence of OpenType variation data on the face.
   *
   * Return value: true if face has a `fvar&#39; table and false otherwise
   *
   * Since: 1.4.2
   **/
  hb_bool_t
  hb_ot_var_has_data (hb_face_t *face)
  {
<span class="line-modified">!   return face-&gt;table.fvar-&gt;has_data ();</span>
  }
  
  /**
   * hb_ot_var_get_axis_count:
   *
   * Since: 1.4.2
   **/
  unsigned int
  hb_ot_var_get_axis_count (hb_face_t *face)
  {
<span class="line-modified">!   return face-&gt;table.fvar-&gt;get_axis_count ();</span>
  }
  
  /**
   * hb_ot_var_get_axes:
   *
   * Since: 1.4.2
<span class="line-added">+  * Deprecated: 2.2.0</span>
   **/
  unsigned int
  hb_ot_var_get_axes (hb_face_t        *face,
                      unsigned int      start_offset,
                      unsigned int     *axes_count /* IN/OUT */,
                      hb_ot_var_axis_t *axes_array /* OUT */)
  {
<span class="line-modified">!   return face-&gt;table.fvar-&gt;get_axes_deprecated (start_offset, axes_count, axes_array);</span>
  }
  
  /**
   * hb_ot_var_find_axis:
   *
   * Since: 1.4.2
<span class="line-added">+  * Deprecated: 2.2.0</span>
   **/
  hb_bool_t
  hb_ot_var_find_axis (hb_face_t        *face,
                       hb_tag_t          axis_tag,
                       unsigned int     *axis_index,
                       hb_ot_var_axis_t *axis_info)
  {
<span class="line-modified">!   return face-&gt;table.fvar-&gt;find_axis_deprecated (axis_tag, axis_index, axis_info);</span>
<span class="line-modified">! }</span>
<span class="line-added">+ </span>
<span class="line-added">+ /**</span>
<span class="line-added">+  * hb_ot_var_get_axis_infos:</span>
<span class="line-added">+  *</span>
<span class="line-added">+  * Since: 2.2.0</span>
<span class="line-added">+  **/</span>
<span class="line-added">+ HB_EXTERN unsigned int</span>
<span class="line-added">+ hb_ot_var_get_axis_infos (hb_face_t             *face,</span>
<span class="line-added">+                           unsigned int           start_offset,</span>
<span class="line-added">+                           unsigned int          *axes_count /* IN/OUT */,</span>
<span class="line-added">+                           hb_ot_var_axis_info_t *axes_array /* OUT */)</span>
<span class="line-added">+ {</span>
<span class="line-added">+   return face-&gt;table.fvar-&gt;get_axis_infos (start_offset, axes_count, axes_array);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ /**</span>
<span class="line-added">+  * hb_ot_var_find_axis_info:</span>
<span class="line-added">+  *</span>
<span class="line-added">+  * Since: 2.2.0</span>
<span class="line-added">+  **/</span>
<span class="line-added">+ HB_EXTERN hb_bool_t</span>
<span class="line-added">+ hb_ot_var_find_axis_info (hb_face_t             *face,</span>
<span class="line-added">+                           hb_tag_t               axis_tag,</span>
<span class="line-added">+                           hb_ot_var_axis_info_t *axis_info)</span>
<span class="line-added">+ {</span>
<span class="line-added">+   return face-&gt;table.fvar-&gt;find_axis_info (axis_tag, axis_info);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ </span>
<span class="line-added">+ /*</span>
<span class="line-added">+  * Named instances.</span>
<span class="line-added">+  */</span>
<span class="line-added">+ </span>
<span class="line-added">+ unsigned int</span>
<span class="line-added">+ hb_ot_var_get_named_instance_count (hb_face_t *face)</span>
<span class="line-added">+ {</span>
<span class="line-added">+   return face-&gt;table.fvar-&gt;get_instance_count ();</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ hb_ot_name_id_t</span>
<span class="line-added">+ hb_ot_var_named_instance_get_subfamily_name_id (hb_face_t   *face,</span>
<span class="line-added">+                                                 unsigned int instance_index)</span>
<span class="line-added">+ {</span>
<span class="line-added">+   return face-&gt;table.fvar-&gt;get_instance_subfamily_name_id (instance_index);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ hb_ot_name_id_t</span>
<span class="line-added">+ hb_ot_var_named_instance_get_postscript_name_id (hb_face_t  *face,</span>
<span class="line-added">+                                                 unsigned int instance_index)</span>
<span class="line-added">+ {</span>
<span class="line-added">+   return face-&gt;table.fvar-&gt;get_instance_postscript_name_id (instance_index);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ unsigned int</span>
<span class="line-added">+ hb_ot_var_named_instance_get_design_coords (hb_face_t    *face,</span>
<span class="line-added">+                                             unsigned int  instance_index,</span>
<span class="line-added">+                                             unsigned int *coords_length, /* IN/OUT */</span>
<span class="line-added">+                                             float        *coords         /* OUT */)</span>
<span class="line-added">+ {</span>
<span class="line-added">+   return face-&gt;table.fvar-&gt;get_instance_coords (instance_index, coords_length, coords);</span>
  }
  
  
  /**
   * hb_ot_var_normalize_variations:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 124,21 ***</span>
                                  unsigned int          coords_length)
  {
    for (unsigned int i = 0; i &lt; coords_length; i++)
      coords[i] = 0;
  
<span class="line-modified">!   const OT::fvar &amp;fvar = _get_fvar (face);</span>
    for (unsigned int i = 0; i &lt; variations_length; i++)
    {
<span class="line-modified">!     unsigned int axis_index;</span>
<span class="line-modified">!     if (hb_ot_var_find_axis (face, variations[i].tag, &amp;axis_index, nullptr) &amp;&amp;</span>
<span class="line-modified">!         axis_index &lt; coords_length)</span>
<span class="line-modified">!       coords[axis_index] = fvar.normalize_axis_value (axis_index, variations[i].value);</span>
    }
  
<span class="line-modified">!   const OT::avar &amp;avar = _get_avar (face);</span>
<span class="line-removed">-   avar.map_coords (coords, coords_length);</span>
  }
  
  /**
   * hb_ot_var_normalize_coords:
   *
<span class="line-new-header">--- 180,20 ---</span>
                                  unsigned int          coords_length)
  {
    for (unsigned int i = 0; i &lt; coords_length; i++)
      coords[i] = 0;
  
<span class="line-modified">!   const OT::fvar &amp;fvar = *face-&gt;table.fvar;</span>
    for (unsigned int i = 0; i &lt; variations_length; i++)
    {
<span class="line-modified">!     hb_ot_var_axis_info_t info;</span>
<span class="line-modified">!     if (hb_ot_var_find_axis_info (face, variations[i].tag, &amp;info) &amp;&amp;</span>
<span class="line-modified">!         info.axis_index &lt; coords_length)</span>
<span class="line-modified">!       coords[info.axis_index] = fvar.normalize_axis_value (info.axis_index, variations[i].value);</span>
    }
  
<span class="line-modified">!   face-&gt;table.avar-&gt;map_coords (coords, coords_length);</span>
  }
  
  /**
   * hb_ot_var_normalize_coords:
   *
</pre>
<hr />
<pre>
<span class="line-old-header">*** 148,12 ***</span>
  hb_ot_var_normalize_coords (hb_face_t    *face,
                              unsigned int coords_length,
                              const float *design_coords, /* IN */
                              int *normalized_coords /* OUT */)
  {
<span class="line-modified">!   const OT::fvar &amp;fvar = _get_fvar (face);</span>
    for (unsigned int i = 0; i &lt; coords_length; i++)
      normalized_coords[i] = fvar.normalize_axis_value (i, design_coords[i]);
  
<span class="line-modified">!   const OT::avar &amp;avar = _get_avar (face);</span>
<span class="line-removed">-   avar.map_coords (normalized_coords, coords_length);</span>
  }
<span class="line-new-header">--- 203,11 ---</span>
  hb_ot_var_normalize_coords (hb_face_t    *face,
                              unsigned int coords_length,
                              const float *design_coords, /* IN */
                              int *normalized_coords /* OUT */)
  {
<span class="line-modified">!   const OT::fvar &amp;fvar = *face-&gt;table.fvar;</span>
    for (unsigned int i = 0; i &lt; coords_length; i++)
      normalized_coords[i] = fvar.normalize_axis_value (i, design_coords[i]);
  
<span class="line-modified">!   face-&gt;table.avar-&gt;map_coords (normalized_coords, coords_length);</span>
  }
</pre>
<center><a href="hb-ot-var-mvar-table.hh.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="hb-ot-var.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>