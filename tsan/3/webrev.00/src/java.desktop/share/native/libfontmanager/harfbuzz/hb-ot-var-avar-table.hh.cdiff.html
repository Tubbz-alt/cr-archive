<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/native/libfontmanager/harfbuzz/hb-ot-var-avar-table.hh</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="hb-ot-tag.cc.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="hb-ot-var-fvar-table.hh.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libfontmanager/harfbuzz/hb-ot-var-avar-table.hh</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 25,11 ***</span>
   */
  
  #ifndef HB_OT_VAR_AVAR_TABLE_HH
  #define HB_OT_VAR_AVAR_TABLE_HH
  
<span class="line-modified">! #include &quot;hb-open-type-private.hh&quot;</span>
  
  /*
   * avar -- Axis Variations
   * https://docs.microsoft.com/en-us/typography/opentype/spec/avar
   */
<span class="line-new-header">--- 25,11 ---</span>
   */
  
  #ifndef HB_OT_VAR_AVAR_TABLE_HH
  #define HB_OT_VAR_AVAR_TABLE_HH
  
<span class="line-modified">! #include &quot;hb-open-type.hh&quot;</span>
  
  /*
   * avar -- Axis Variations
   * https://docs.microsoft.com/en-us/typography/opentype/spec/avar
   */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 40,11 ***</span>
  namespace OT {
  
  
  struct AxisValueMap
  {
<span class="line-modified">!   inline bool sanitize (hb_sanitize_context_t *c) const</span>
    {
      TRACE_SANITIZE (this);
      return_trace (c-&gt;check_struct (this));
    }
  
<span class="line-new-header">--- 40,11 ---</span>
  namespace OT {
  
  
  struct AxisValueMap
  {
<span class="line-modified">!   bool sanitize (hb_sanitize_context_t *c) const</span>
    {
      TRACE_SANITIZE (this);
      return_trace (c-&gt;check_struct (this));
    }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 57,11 ***</span>
    DEFINE_SIZE_STATIC (4);
  };
  
  struct SegmentMaps : ArrayOf&lt;AxisValueMap&gt;
  {
<span class="line-modified">!   inline int map (int value) const</span>
    {
      /* The following special-cases are not part of OpenType, which requires
       * that at least -1, 0, and +1 must be mapped. But we include these as
       * part of a better error recovery scheme. */
  
<span class="line-new-header">--- 57,11 ---</span>
    DEFINE_SIZE_STATIC (4);
  };
  
  struct SegmentMaps : ArrayOf&lt;AxisValueMap&gt;
  {
<span class="line-modified">!   int map (int value) const</span>
    {
      /* The following special-cases are not part of OpenType, which requires
       * that at least -1, 0, and +1 must be mapped. But we include these as
       * part of a better error recovery scheme. */
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 91,26 ***</span>
      return arrayZ[i-1].toCoord +
             ((arrayZ[i].toCoord - arrayZ[i-1].toCoord) *
              (value - arrayZ[i-1].fromCoord) + denom/2) / denom;
    }
  
<span class="line-modified">!   DEFINE_SIZE_ARRAY (2, arrayZ);</span>
  };
  
  struct avar
  {
<span class="line-modified">!   static const hb_tag_t tableTag        = HB_OT_TAG_avar;</span>
  
<span class="line-modified">!   inline bool sanitize (hb_sanitize_context_t *c) const</span>
    {
      TRACE_SANITIZE (this);
      if (unlikely (!(version.sanitize (c) &amp;&amp;
                      version.major == 1 &amp;&amp;
                      c-&gt;check_struct (this))))
        return_trace (false);
  
<span class="line-modified">!     const SegmentMaps *map = axisSegmentMapsZ;</span>
      unsigned int count = axisCount;
      for (unsigned int i = 0; i &lt; count; i++)
      {
        if (unlikely (!map-&gt;sanitize (c)))
          return_trace (false);
<span class="line-new-header">--- 91,27 ---</span>
      return arrayZ[i-1].toCoord +
             ((arrayZ[i].toCoord - arrayZ[i-1].toCoord) *
              (value - arrayZ[i-1].fromCoord) + denom/2) / denom;
    }
  
<span class="line-modified">!   public:</span>
<span class="line-added">+   DEFINE_SIZE_ARRAY (2, *this);</span>
  };
  
  struct avar
  {
<span class="line-modified">!   static constexpr hb_tag_t tableTag = HB_OT_TAG_avar;</span>
  
<span class="line-modified">!   bool sanitize (hb_sanitize_context_t *c) const</span>
    {
      TRACE_SANITIZE (this);
      if (unlikely (!(version.sanitize (c) &amp;&amp;
                      version.major == 1 &amp;&amp;
                      c-&gt;check_struct (this))))
        return_trace (false);
  
<span class="line-modified">!     const SegmentMaps *map = &amp;firstAxisSegmentMaps;</span>
      unsigned int count = axisCount;
      for (unsigned int i = 0; i &lt; count; i++)
      {
        if (unlikely (!map-&gt;sanitize (c)))
          return_trace (false);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 118,15 ***</span>
      }
  
      return_trace (true);
    }
  
<span class="line-modified">!   inline void map_coords (int *coords, unsigned int coords_length) const</span>
    {
      unsigned int count = MIN&lt;unsigned int&gt; (coords_length, axisCount);
  
<span class="line-modified">!     const SegmentMaps *map = axisSegmentMapsZ;</span>
      for (unsigned int i = 0; i &lt; count; i++)
      {
        coords[i] = map-&gt;map (coords[i]);
        map = &amp;StructAfter&lt;SegmentMaps&gt; (*map);
      }
<span class="line-new-header">--- 119,15 ---</span>
      }
  
      return_trace (true);
    }
  
<span class="line-modified">!   void map_coords (int *coords, unsigned int coords_length) const</span>
    {
      unsigned int count = MIN&lt;unsigned int&gt; (coords_length, axisCount);
  
<span class="line-modified">!     const SegmentMaps *map = &amp;firstAxisSegmentMaps;</span>
      for (unsigned int i = 0; i &lt; count; i++)
      {
        coords[i] = map-&gt;map (coords[i]);
        map = &amp;StructAfter&lt;SegmentMaps&gt; (*map);
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 137,11 ***</span>
                                   * initially set to 0x00010000u */
    HBUINT16      reserved;       /* This field is permanently reserved. Set to 0. */
    HBUINT16      axisCount;      /* The number of variation axes in the font. This
                                   * must be the same number as axisCount in the
                                   * &#39;fvar&#39; table. */
<span class="line-modified">!   SegmentMaps   axisSegmentMapsZ[VAR];</span>
  
    public:
    DEFINE_SIZE_MIN (8);
  };
  
<span class="line-new-header">--- 138,11 ---</span>
                                   * initially set to 0x00010000u */
    HBUINT16      reserved;       /* This field is permanently reserved. Set to 0. */
    HBUINT16      axisCount;      /* The number of variation axes in the font. This
                                   * must be the same number as axisCount in the
                                   * &#39;fvar&#39; table. */
<span class="line-modified">!   SegmentMaps   firstAxisSegmentMaps;</span>
  
    public:
    DEFINE_SIZE_MIN (8);
  };
  
</pre>
<center><a href="hb-ot-tag.cc.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="hb-ot-var-fvar-table.hh.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>