<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/native/libawt/awt/image/BufImgSurfaceData.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../common/java2d/opengl/OGLSurfaceData.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="gif/gifdecoder.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libawt/awt/image/BufImgSurfaceData.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1999, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
334 
335     if (cData != NULL) {
336         return cData;
337     }
338 
339     cData = (ColorData*)calloc(1, sizeof(ColorData));
340 
341     if (cData != NULL) {
342         jboolean allGray
343             = (*env)-&gt;GetBooleanField(env, bisdo-&gt;icm, allGrayID);
344         int *pRgb = (int *)
345             ((*env)-&gt;GetPrimitiveArrayCritical(env, bisdo-&gt;lutarray, NULL));
346 
347         if (pRgb == NULL) {
348             free(cData);
349             return (ColorData*)NULL;
350         }
351 
352         cData-&gt;img_clr_tbl = initCubemap(pRgb, bisdo-&gt;lutsize, 32);
353         if (cData-&gt;img_clr_tbl == NULL) {

354             free(cData);
355             return (ColorData*)NULL;
356         }
357         cData-&gt;representsPrimaries = calculatePrimaryColorsApproximation(pRgb, cData-&gt;img_clr_tbl, 32);
358         if (allGray == JNI_TRUE) {
359             initInverseGrayLut(pRgb, bisdo-&gt;lutsize, cData);
360         }
361         (*env)-&gt;ReleasePrimitiveArrayCritical(env, bisdo-&gt;lutarray, pRgb,
362                                               JNI_ABORT);
363 
364         initDitherTables(cData);
365 
366         if (JNU_IsNull(env, colorData)) {
367             jlong pData = ptr_to_jlong(cData);
368             colorData = (*env)-&gt;NewObjectA(env, clsICMCD, initICMCDmID, (jvalue *)&amp;pData);
369 
370             if ((*env)-&gt;ExceptionCheck(env))
371             {
372                 free(cData);
373                 return (ColorData*)NULL;
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1999, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
334 
335     if (cData != NULL) {
336         return cData;
337     }
338 
339     cData = (ColorData*)calloc(1, sizeof(ColorData));
340 
341     if (cData != NULL) {
342         jboolean allGray
343             = (*env)-&gt;GetBooleanField(env, bisdo-&gt;icm, allGrayID);
344         int *pRgb = (int *)
345             ((*env)-&gt;GetPrimitiveArrayCritical(env, bisdo-&gt;lutarray, NULL));
346 
347         if (pRgb == NULL) {
348             free(cData);
349             return (ColorData*)NULL;
350         }
351 
352         cData-&gt;img_clr_tbl = initCubemap(pRgb, bisdo-&gt;lutsize, 32);
353         if (cData-&gt;img_clr_tbl == NULL) {
<span class="line-added">354             (*env)-&gt;ReleasePrimitiveArrayCritical(env, bisdo-&gt;lutarray, pRgb, JNI_ABORT);</span>
355             free(cData);
356             return (ColorData*)NULL;
357         }
358         cData-&gt;representsPrimaries = calculatePrimaryColorsApproximation(pRgb, cData-&gt;img_clr_tbl, 32);
359         if (allGray == JNI_TRUE) {
360             initInverseGrayLut(pRgb, bisdo-&gt;lutsize, cData);
361         }
362         (*env)-&gt;ReleasePrimitiveArrayCritical(env, bisdo-&gt;lutarray, pRgb,
363                                               JNI_ABORT);
364 
365         initDitherTables(cData);
366 
367         if (JNU_IsNull(env, colorData)) {
368             jlong pData = ptr_to_jlong(cData);
369             colorData = (*env)-&gt;NewObjectA(env, clsICMCD, initICMCDmID, (jvalue *)&amp;pData);
370 
371             if ((*env)-&gt;ExceptionCheck(env))
372             {
373                 free(cData);
374                 return (ColorData*)NULL;
</pre>
</td>
</tr>
</table>
<center><a href="../../../common/java2d/opengl/OGLSurfaceData.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="gif/gifdecoder.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>