<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/native/libawt/java2d/loops/LoopMacros.h</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="GraphicsPrimitiveMgr.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../libfontmanager/DrawGlyphList.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libawt/java2d/loops/LoopMacros.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 120 /*
 121  * This loop is the standard nested &quot;while (--width/height &gt; 0)&quot; loop
 122  * used by most of the scaled blits below.  It calculates the proper
 123  * X source variable
 124  */
 125 #define BlitLoopScaleWidthHeight(SRCTYPE, SRCPTR, SRCBASE, SRCINFO, \
 126                                  DSTTYPE, DSTPTR, DSTBASE, DSTINFO, DSTPREFIX, \
 127                                  XVAR, WIDTH, HEIGHT, \
 128                                  SXLOC, SYLOC, SXINC, SYINC, SHIFT, \
 129                                  BODY) \
 130     do { \
 131         SRCTYPE ## DataType *SRCPTR; \
 132         DSTTYPE ## DataType *DSTPTR = (DSTTYPE ## DataType *) (DSTBASE); \
 133         jint srcScan = (SRCINFO)-&gt;scanStride; \
 134         jint dstScan = (DSTINFO)-&gt;scanStride; \
 135         Init ## DSTTYPE ## StoreVarsY(DSTPREFIX, DSTINFO); \
 136         dstScan -= (WIDTH) * DSTTYPE ## PixelStride; \
 137         do { \
 138             juint w = WIDTH; \
 139             jint tmpsxloc = SXLOC; \
<span class="line-modified"> 140             SRCPTR = PtrAddBytes(SRCBASE, ((SYLOC &gt;&gt; SHIFT) * srcScan)); \</span>
 141             Init ## DSTTYPE ## StoreVarsX(DSTPREFIX, DSTINFO); \
 142             do { \
 143                 jint XVAR = (tmpsxloc &gt;&gt; SHIFT); \
 144                 BODY; \
 145                 DSTPTR = PtrAddBytes(DSTPTR, DSTTYPE ## PixelStride); \
 146                 Next ## DSTTYPE ## StoreVarsX(DSTPREFIX); \
 147                 tmpsxloc += SXINC; \
 148             } while (--w &gt; 0); \
 149             DSTPTR = PtrAddBytes(DSTPTR, dstScan); \
 150             Next ## DSTTYPE ## StoreVarsY(DSTPREFIX); \
 151             SYLOC += SYINC; \
 152         } while (--HEIGHT &gt; 0); \
 153     } while (0)
 154 
 155 /*
 156  * This loop is a standard horizontal loop iterating with a &quot;relative&quot;
 157  * X coordinate (0 &lt;= X &lt; WIDTH) used primarily by the LUT conversion
 158  * preprocessing loops below.
 159  */
 160 #define BlitLoopXRel(DSTTYPE, DSTINFO, DSTPREFIX, \
</pre>
<hr />
<pre>
2050         } while (--height &gt; 0); \
2051     } \
2052 }
2053 
2054 #define DEFINE_TRANSFORMHELPER_NN(SRC) \
2055 void NAME_TRANSFORMHELPER_NN(SRC)(SurfaceDataRasInfo *pSrcInfo, \
2056                                   jint *pRGB, jint numpix, \
2057                                   jlong xlong, jlong dxlong, \
2058                                   jlong ylong, jlong dylong) \
2059 { \
2060     Declare ## SRC ## LoadVars(SrcRead) \
2061     SRC ## DataType *pBase = pSrcInfo-&gt;rasBase; \
2062     jint scan = pSrcInfo-&gt;scanStride; \
2063     jint *pEnd = pRGB + numpix; \
2064  \
2065     xlong += IntToLong(pSrcInfo-&gt;bounds.x1); \
2066     ylong += IntToLong(pSrcInfo-&gt;bounds.y1); \
2067  \
2068     Init ## SRC ## LoadVars(SrcRead, pSrcInfo); \
2069     while (pRGB &lt; pEnd) { \
<span class="line-modified">2070         SRC ## DataType *pRow = PtrAddBytes(pBase, WholeOfLong(ylong) * scan); \</span>
2071         Copy ## SRC ## ToIntArgbPre(pRGB, 0, \
2072                                     SrcRead, pRow, WholeOfLong(xlong)); \
2073         pRGB++; \
2074         xlong += dxlong; \
2075         ylong += dylong; \
2076     } \
2077 }
2078 
2079 #define DEFINE_TRANSFORMHELPER_BL(SRC) \
2080 void NAME_TRANSFORMHELPER_BL(SRC)(SurfaceDataRasInfo *pSrcInfo, \
2081                                   jint *pRGB, jint numpix, \
2082                                   jlong xlong, jlong dxlong, \
2083                                   jlong ylong, jlong dylong) \
2084 { \
2085     Declare ## SRC ## LoadVars(SrcRead) \
2086     jint scan = pSrcInfo-&gt;scanStride; \
2087     jint cx, cy, cw, ch; \
2088     jint *pEnd = pRGB + numpix*4; \
2089  \
2090     cx = pSrcInfo-&gt;bounds.x1; \
</pre>
<hr />
<pre>
2098  \
2099     Init ## SRC ## LoadVars(SrcRead, pSrcInfo); \
2100     while (pRGB &lt; pEnd) { \
2101         jint xwhole = WholeOfLong(xlong); \
2102         jint ywhole = WholeOfLong(ylong); \
2103         jint xdelta, ydelta, isneg; \
2104         SRC ## DataType *pRow; \
2105  \
2106         xdelta = ((juint) (xwhole + 1 - cw)) &gt;&gt; 31; \
2107         isneg = xwhole &gt;&gt; 31; \
2108         xwhole -= isneg; \
2109         xdelta += isneg; \
2110  \
2111         ydelta = ((ywhole + 1 - ch) &gt;&gt; 31); \
2112         isneg = ywhole &gt;&gt; 31; \
2113         ywhole -= isneg; \
2114         ydelta -= isneg; \
2115         ydelta &amp;= scan; \
2116  \
2117         xwhole += cx; \
<span class="line-modified">2118         pRow = PtrAddBytes(pSrcInfo-&gt;rasBase, (ywhole + cy) * scan); \</span>
2119         Copy ## SRC ## ToIntArgbPre(pRGB, 0, SrcRead, pRow, xwhole); \
2120         Copy ## SRC ## ToIntArgbPre(pRGB, 1, SrcRead, pRow, xwhole+xdelta); \
2121         pRow = PtrAddBytes(pRow, ydelta); \
2122         Copy ## SRC ## ToIntArgbPre(pRGB, 2, SrcRead, pRow, xwhole); \
2123         Copy ## SRC ## ToIntArgbPre(pRGB, 3, SrcRead, pRow, xwhole+xdelta); \
2124  \
2125         pRGB += 4; \
2126         xlong += dxlong; \
2127         ylong += dylong; \
2128     } \
2129 }
2130 
2131 #define DEFINE_TRANSFORMHELPER_BC(SRC) \
2132 void NAME_TRANSFORMHELPER_BC(SRC)(SurfaceDataRasInfo *pSrcInfo, \
2133                                   jint *pRGB, jint numpix, \
2134                                   jlong xlong, jlong dxlong, \
2135                                   jlong ylong, jlong dylong) \
2136 { \
2137     Declare ## SRC ## LoadVars(SrcRead) \
2138     jint scan = pSrcInfo-&gt;scanStride; \
</pre>
<hr />
<pre>
2156         jint ydelta0, ydelta1, ydelta2; \
2157         jint isneg; \
2158         SRC ## DataType *pRow; \
2159  \
2160         xdelta0 = (-xwhole) &gt;&gt; 31; \
2161         xdelta1 = ((juint) (xwhole + 1 - cw)) &gt;&gt; 31; \
2162         xdelta2 = ((juint) (xwhole + 2 - cw)) &gt;&gt; 31; \
2163         isneg = xwhole &gt;&gt; 31; \
2164         xwhole -= isneg; \
2165         xdelta1 += isneg; \
2166         xdelta2 += xdelta1; \
2167  \
2168         ydelta0 = ((-ywhole) &gt;&gt; 31) &amp; (-scan); \
2169         ydelta1 = ((ywhole + 1 - ch) &gt;&gt; 31) &amp; scan; \
2170         ydelta2 = ((ywhole + 2 - ch) &gt;&gt; 31) &amp; scan; \
2171         isneg = ywhole &gt;&gt; 31; \
2172         ywhole -= isneg; \
2173         ydelta1 += (isneg &amp; -scan); \
2174  \
2175         xwhole += cx; \
<span class="line-modified">2176         pRow = PtrAddBytes(pSrcInfo-&gt;rasBase, (ywhole + cy) * scan); \</span>
2177         pRow = PtrAddBytes(pRow, ydelta0); \
2178         Copy ## SRC ## ToIntArgbPre(pRGB,  0, SrcRead, pRow, xwhole+xdelta0); \
2179         Copy ## SRC ## ToIntArgbPre(pRGB,  1, SrcRead, pRow, xwhole        ); \
2180         Copy ## SRC ## ToIntArgbPre(pRGB,  2, SrcRead, pRow, xwhole+xdelta1); \
2181         Copy ## SRC ## ToIntArgbPre(pRGB,  3, SrcRead, pRow, xwhole+xdelta2); \
2182         pRow = PtrAddBytes(pRow, -ydelta0); \
2183         Copy ## SRC ## ToIntArgbPre(pRGB,  4, SrcRead, pRow, xwhole+xdelta0); \
2184         Copy ## SRC ## ToIntArgbPre(pRGB,  5, SrcRead, pRow, xwhole        ); \
2185         Copy ## SRC ## ToIntArgbPre(pRGB,  6, SrcRead, pRow, xwhole+xdelta1); \
2186         Copy ## SRC ## ToIntArgbPre(pRGB,  7, SrcRead, pRow, xwhole+xdelta2); \
2187         pRow = PtrAddBytes(pRow, ydelta1); \
2188         Copy ## SRC ## ToIntArgbPre(pRGB,  8, SrcRead, pRow, xwhole+xdelta0); \
2189         Copy ## SRC ## ToIntArgbPre(pRGB,  9, SrcRead, pRow, xwhole        ); \
2190         Copy ## SRC ## ToIntArgbPre(pRGB, 10, SrcRead, pRow, xwhole+xdelta1); \
2191         Copy ## SRC ## ToIntArgbPre(pRGB, 11, SrcRead, pRow, xwhole+xdelta2); \
2192         pRow = PtrAddBytes(pRow, ydelta2); \
2193         Copy ## SRC ## ToIntArgbPre(pRGB, 12, SrcRead, pRow, xwhole+xdelta0); \
2194         Copy ## SRC ## ToIntArgbPre(pRGB, 13, SrcRead, pRow, xwhole        ); \
2195         Copy ## SRC ## ToIntArgbPre(pRGB, 14, SrcRead, pRow, xwhole+xdelta1); \
2196         Copy ## SRC ## ToIntArgbPre(pRGB, 15, SrcRead, pRow, xwhole+xdelta2); \
</pre>
</td>
<td>
<hr />
<pre>
 120 /*
 121  * This loop is the standard nested &quot;while (--width/height &gt; 0)&quot; loop
 122  * used by most of the scaled blits below.  It calculates the proper
 123  * X source variable
 124  */
 125 #define BlitLoopScaleWidthHeight(SRCTYPE, SRCPTR, SRCBASE, SRCINFO, \
 126                                  DSTTYPE, DSTPTR, DSTBASE, DSTINFO, DSTPREFIX, \
 127                                  XVAR, WIDTH, HEIGHT, \
 128                                  SXLOC, SYLOC, SXINC, SYINC, SHIFT, \
 129                                  BODY) \
 130     do { \
 131         SRCTYPE ## DataType *SRCPTR; \
 132         DSTTYPE ## DataType *DSTPTR = (DSTTYPE ## DataType *) (DSTBASE); \
 133         jint srcScan = (SRCINFO)-&gt;scanStride; \
 134         jint dstScan = (DSTINFO)-&gt;scanStride; \
 135         Init ## DSTTYPE ## StoreVarsY(DSTPREFIX, DSTINFO); \
 136         dstScan -= (WIDTH) * DSTTYPE ## PixelStride; \
 137         do { \
 138             juint w = WIDTH; \
 139             jint tmpsxloc = SXLOC; \
<span class="line-modified"> 140             SRCPTR = PtrPixelsRow(SRCBASE, (SYLOC &gt;&gt; SHIFT), srcScan); \</span>
 141             Init ## DSTTYPE ## StoreVarsX(DSTPREFIX, DSTINFO); \
 142             do { \
 143                 jint XVAR = (tmpsxloc &gt;&gt; SHIFT); \
 144                 BODY; \
 145                 DSTPTR = PtrAddBytes(DSTPTR, DSTTYPE ## PixelStride); \
 146                 Next ## DSTTYPE ## StoreVarsX(DSTPREFIX); \
 147                 tmpsxloc += SXINC; \
 148             } while (--w &gt; 0); \
 149             DSTPTR = PtrAddBytes(DSTPTR, dstScan); \
 150             Next ## DSTTYPE ## StoreVarsY(DSTPREFIX); \
 151             SYLOC += SYINC; \
 152         } while (--HEIGHT &gt; 0); \
 153     } while (0)
 154 
 155 /*
 156  * This loop is a standard horizontal loop iterating with a &quot;relative&quot;
 157  * X coordinate (0 &lt;= X &lt; WIDTH) used primarily by the LUT conversion
 158  * preprocessing loops below.
 159  */
 160 #define BlitLoopXRel(DSTTYPE, DSTINFO, DSTPREFIX, \
</pre>
<hr />
<pre>
2050         } while (--height &gt; 0); \
2051     } \
2052 }
2053 
2054 #define DEFINE_TRANSFORMHELPER_NN(SRC) \
2055 void NAME_TRANSFORMHELPER_NN(SRC)(SurfaceDataRasInfo *pSrcInfo, \
2056                                   jint *pRGB, jint numpix, \
2057                                   jlong xlong, jlong dxlong, \
2058                                   jlong ylong, jlong dylong) \
2059 { \
2060     Declare ## SRC ## LoadVars(SrcRead) \
2061     SRC ## DataType *pBase = pSrcInfo-&gt;rasBase; \
2062     jint scan = pSrcInfo-&gt;scanStride; \
2063     jint *pEnd = pRGB + numpix; \
2064  \
2065     xlong += IntToLong(pSrcInfo-&gt;bounds.x1); \
2066     ylong += IntToLong(pSrcInfo-&gt;bounds.y1); \
2067  \
2068     Init ## SRC ## LoadVars(SrcRead, pSrcInfo); \
2069     while (pRGB &lt; pEnd) { \
<span class="line-modified">2070         SRC ## DataType *pRow = PtrPixelsRow(pBase, WholeOfLong(ylong), scan); \</span>
2071         Copy ## SRC ## ToIntArgbPre(pRGB, 0, \
2072                                     SrcRead, pRow, WholeOfLong(xlong)); \
2073         pRGB++; \
2074         xlong += dxlong; \
2075         ylong += dylong; \
2076     } \
2077 }
2078 
2079 #define DEFINE_TRANSFORMHELPER_BL(SRC) \
2080 void NAME_TRANSFORMHELPER_BL(SRC)(SurfaceDataRasInfo *pSrcInfo, \
2081                                   jint *pRGB, jint numpix, \
2082                                   jlong xlong, jlong dxlong, \
2083                                   jlong ylong, jlong dylong) \
2084 { \
2085     Declare ## SRC ## LoadVars(SrcRead) \
2086     jint scan = pSrcInfo-&gt;scanStride; \
2087     jint cx, cy, cw, ch; \
2088     jint *pEnd = pRGB + numpix*4; \
2089  \
2090     cx = pSrcInfo-&gt;bounds.x1; \
</pre>
<hr />
<pre>
2098  \
2099     Init ## SRC ## LoadVars(SrcRead, pSrcInfo); \
2100     while (pRGB &lt; pEnd) { \
2101         jint xwhole = WholeOfLong(xlong); \
2102         jint ywhole = WholeOfLong(ylong); \
2103         jint xdelta, ydelta, isneg; \
2104         SRC ## DataType *pRow; \
2105  \
2106         xdelta = ((juint) (xwhole + 1 - cw)) &gt;&gt; 31; \
2107         isneg = xwhole &gt;&gt; 31; \
2108         xwhole -= isneg; \
2109         xdelta += isneg; \
2110  \
2111         ydelta = ((ywhole + 1 - ch) &gt;&gt; 31); \
2112         isneg = ywhole &gt;&gt; 31; \
2113         ywhole -= isneg; \
2114         ydelta -= isneg; \
2115         ydelta &amp;= scan; \
2116  \
2117         xwhole += cx; \
<span class="line-modified">2118         pRow = PtrPixelsRow(pSrcInfo-&gt;rasBase, ywhole + cy, scan); \</span>
2119         Copy ## SRC ## ToIntArgbPre(pRGB, 0, SrcRead, pRow, xwhole); \
2120         Copy ## SRC ## ToIntArgbPre(pRGB, 1, SrcRead, pRow, xwhole+xdelta); \
2121         pRow = PtrAddBytes(pRow, ydelta); \
2122         Copy ## SRC ## ToIntArgbPre(pRGB, 2, SrcRead, pRow, xwhole); \
2123         Copy ## SRC ## ToIntArgbPre(pRGB, 3, SrcRead, pRow, xwhole+xdelta); \
2124  \
2125         pRGB += 4; \
2126         xlong += dxlong; \
2127         ylong += dylong; \
2128     } \
2129 }
2130 
2131 #define DEFINE_TRANSFORMHELPER_BC(SRC) \
2132 void NAME_TRANSFORMHELPER_BC(SRC)(SurfaceDataRasInfo *pSrcInfo, \
2133                                   jint *pRGB, jint numpix, \
2134                                   jlong xlong, jlong dxlong, \
2135                                   jlong ylong, jlong dylong) \
2136 { \
2137     Declare ## SRC ## LoadVars(SrcRead) \
2138     jint scan = pSrcInfo-&gt;scanStride; \
</pre>
<hr />
<pre>
2156         jint ydelta0, ydelta1, ydelta2; \
2157         jint isneg; \
2158         SRC ## DataType *pRow; \
2159  \
2160         xdelta0 = (-xwhole) &gt;&gt; 31; \
2161         xdelta1 = ((juint) (xwhole + 1 - cw)) &gt;&gt; 31; \
2162         xdelta2 = ((juint) (xwhole + 2 - cw)) &gt;&gt; 31; \
2163         isneg = xwhole &gt;&gt; 31; \
2164         xwhole -= isneg; \
2165         xdelta1 += isneg; \
2166         xdelta2 += xdelta1; \
2167  \
2168         ydelta0 = ((-ywhole) &gt;&gt; 31) &amp; (-scan); \
2169         ydelta1 = ((ywhole + 1 - ch) &gt;&gt; 31) &amp; scan; \
2170         ydelta2 = ((ywhole + 2 - ch) &gt;&gt; 31) &amp; scan; \
2171         isneg = ywhole &gt;&gt; 31; \
2172         ywhole -= isneg; \
2173         ydelta1 += (isneg &amp; -scan); \
2174  \
2175         xwhole += cx; \
<span class="line-modified">2176         pRow = PtrPixelsRow(pSrcInfo-&gt;rasBase, ywhole + cy, scan); \</span>
2177         pRow = PtrAddBytes(pRow, ydelta0); \
2178         Copy ## SRC ## ToIntArgbPre(pRGB,  0, SrcRead, pRow, xwhole+xdelta0); \
2179         Copy ## SRC ## ToIntArgbPre(pRGB,  1, SrcRead, pRow, xwhole        ); \
2180         Copy ## SRC ## ToIntArgbPre(pRGB,  2, SrcRead, pRow, xwhole+xdelta1); \
2181         Copy ## SRC ## ToIntArgbPre(pRGB,  3, SrcRead, pRow, xwhole+xdelta2); \
2182         pRow = PtrAddBytes(pRow, -ydelta0); \
2183         Copy ## SRC ## ToIntArgbPre(pRGB,  4, SrcRead, pRow, xwhole+xdelta0); \
2184         Copy ## SRC ## ToIntArgbPre(pRGB,  5, SrcRead, pRow, xwhole        ); \
2185         Copy ## SRC ## ToIntArgbPre(pRGB,  6, SrcRead, pRow, xwhole+xdelta1); \
2186         Copy ## SRC ## ToIntArgbPre(pRGB,  7, SrcRead, pRow, xwhole+xdelta2); \
2187         pRow = PtrAddBytes(pRow, ydelta1); \
2188         Copy ## SRC ## ToIntArgbPre(pRGB,  8, SrcRead, pRow, xwhole+xdelta0); \
2189         Copy ## SRC ## ToIntArgbPre(pRGB,  9, SrcRead, pRow, xwhole        ); \
2190         Copy ## SRC ## ToIntArgbPre(pRGB, 10, SrcRead, pRow, xwhole+xdelta1); \
2191         Copy ## SRC ## ToIntArgbPre(pRGB, 11, SrcRead, pRow, xwhole+xdelta2); \
2192         pRow = PtrAddBytes(pRow, ydelta2); \
2193         Copy ## SRC ## ToIntArgbPre(pRGB, 12, SrcRead, pRow, xwhole+xdelta0); \
2194         Copy ## SRC ## ToIntArgbPre(pRGB, 13, SrcRead, pRow, xwhole        ); \
2195         Copy ## SRC ## ToIntArgbPre(pRGB, 14, SrcRead, pRow, xwhole+xdelta1); \
2196         Copy ## SRC ## ToIntArgbPre(pRGB, 15, SrcRead, pRow, xwhole+xdelta2); \
</pre>
</td>
</tr>
</table>
<center><a href="GraphicsPrimitiveMgr.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../libfontmanager/DrawGlyphList.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>