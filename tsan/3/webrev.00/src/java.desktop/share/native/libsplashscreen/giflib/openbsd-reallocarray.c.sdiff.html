<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/native/libsplashscreen/giflib/openbsd-reallocarray.c</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="gifalloc.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../libpng/CHANGES.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libsplashscreen/giflib/openbsd-reallocarray.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  8  * by Oracle in the LICENSE file that accompanied this code.
  9  *
 10  * This code is distributed in the hope that it will be useful, but WITHOUT
 11  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 12  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 13  * version 2 for more details (a copy is included in the LICENSE file that
 14  * accompanied this code).
 15  *
 16  * You should have received a copy of the GNU General Public License version
 17  * 2 along with this work; if not, write to the Free Software Foundation,
 18  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 19  *
 20  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 21  * or visit www.oracle.com if you need additional information or have any
 22  * questions.
 23  */
 24 
 25 /*    $OpenBSD: reallocarray.c,v 1.1 2014/05/08 21:43:49 deraadt Exp $    */
 26 /*
 27  * Copyright (c) 2008 Otto Moerbeek &lt;otto@drijf.net&gt;
<span class="line-modified"> 28  *</span>
<span class="line-removed"> 29  * Permission to use, copy, modify, and distribute this software for any</span>
<span class="line-removed"> 30  * purpose with or without fee is hereby granted, provided that the above</span>
<span class="line-removed"> 31  * copyright notice and this permission notice appear in all copies.</span>
<span class="line-removed"> 32  *</span>
<span class="line-removed"> 33  * THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES</span>
<span class="line-removed"> 34  * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF</span>
<span class="line-removed"> 35  * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR</span>
<span class="line-removed"> 36  * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES</span>
<span class="line-removed"> 37  * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN</span>
<span class="line-removed"> 38  * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF</span>
<span class="line-removed"> 39  * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.</span>
 40  */
 41 
 42 #include &lt;sys/types.h&gt;
 43 #include &lt;errno.h&gt;
 44 #include &lt;stdint.h&gt;
 45 #include &lt;stdlib.h&gt;
 46 




 47 /*
 48  * This is sqrt(SIZE_MAX+1), as s1*s2 &lt;= SIZE_MAX
 49  * if both s1 &lt; MUL_NO_OVERFLOW and s2 &lt; MUL_NO_OVERFLOW
 50  */
 51 #define MUL_NO_OVERFLOW    ((size_t)1 &lt;&lt; (sizeof(size_t) * 4))
 52 
 53 void *
<span class="line-modified"> 54 reallocarray(void *optr, size_t nmemb, size_t size)</span>
 55 {
 56     if ((nmemb &gt;= MUL_NO_OVERFLOW || size &gt;= MUL_NO_OVERFLOW) &amp;&amp;
 57         nmemb &gt; 0 &amp;&amp; SIZE_MAX / nmemb &lt; size) {
 58         errno = ENOMEM;
 59         return NULL;
 60     }
 61     /*
 62      * Head off variations in realloc behavior on different
 63      * platforms (reported by MarkR &lt;mrogers6@users.sf.net&gt;)
 64      *
 65      * The behaviour of reallocarray is implementation-defined if
 66      * nmemb or size is zero. It can return NULL or non-NULL
 67      * depending on the platform.
 68      * https://www.securecoding.cert.org/confluence/display/c/MEM04-C.Beware+of+zero-lengthallocations
 69      *
 70      * Here are some extracts from realloc man pages on different platforms.
 71      *
 72      * void realloc( void memblock, size_t size );
 73      *
 74      * Windows:
</pre>
</td>
<td>
<hr />
<pre>
  8  * by Oracle in the LICENSE file that accompanied this code.
  9  *
 10  * This code is distributed in the hope that it will be useful, but WITHOUT
 11  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 12  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 13  * version 2 for more details (a copy is included in the LICENSE file that
 14  * accompanied this code).
 15  *
 16  * You should have received a copy of the GNU General Public License version
 17  * 2 along with this work; if not, write to the Free Software Foundation,
 18  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 19  *
 20  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 21  * or visit www.oracle.com if you need additional information or have any
 22  * questions.
 23  */
 24 
 25 /*    $OpenBSD: reallocarray.c,v 1.1 2014/05/08 21:43:49 deraadt Exp $    */
 26 /*
 27  * Copyright (c) 2008 Otto Moerbeek &lt;otto@drijf.net&gt;
<span class="line-modified"> 28  * SPDX-License-Identifier: MIT</span>











 29  */
 30 
 31 #include &lt;sys/types.h&gt;
 32 #include &lt;errno.h&gt;
 33 #include &lt;stdint.h&gt;
 34 #include &lt;stdlib.h&gt;
 35 
<span class="line-added"> 36 #ifndef SIZE_MAX</span>
<span class="line-added"> 37     #define SIZE_MAX     UINTPTR_MAX</span>
<span class="line-added"> 38 #endif</span>
<span class="line-added"> 39 </span>
 40 /*
 41  * This is sqrt(SIZE_MAX+1), as s1*s2 &lt;= SIZE_MAX
 42  * if both s1 &lt; MUL_NO_OVERFLOW and s2 &lt; MUL_NO_OVERFLOW
 43  */
 44 #define MUL_NO_OVERFLOW    ((size_t)1 &lt;&lt; (sizeof(size_t) * 4))
 45 
 46 void *
<span class="line-modified"> 47 openbsd_reallocarray(void *optr, size_t nmemb, size_t size)</span>
 48 {
 49     if ((nmemb &gt;= MUL_NO_OVERFLOW || size &gt;= MUL_NO_OVERFLOW) &amp;&amp;
 50         nmemb &gt; 0 &amp;&amp; SIZE_MAX / nmemb &lt; size) {
 51         errno = ENOMEM;
 52         return NULL;
 53     }
 54     /*
 55      * Head off variations in realloc behavior on different
 56      * platforms (reported by MarkR &lt;mrogers6@users.sf.net&gt;)
 57      *
 58      * The behaviour of reallocarray is implementation-defined if
 59      * nmemb or size is zero. It can return NULL or non-NULL
 60      * depending on the platform.
 61      * https://www.securecoding.cert.org/confluence/display/c/MEM04-C.Beware+of+zero-lengthallocations
 62      *
 63      * Here are some extracts from realloc man pages on different platforms.
 64      *
 65      * void realloc( void memblock, size_t size );
 66      *
 67      * Windows:
</pre>
</td>
</tr>
</table>
<center><a href="gifalloc.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../libpng/CHANGES.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>