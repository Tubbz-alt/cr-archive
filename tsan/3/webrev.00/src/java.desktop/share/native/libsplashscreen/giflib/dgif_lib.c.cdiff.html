<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/native/libsplashscreen/giflib/dgif_lib.c</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../libfreetype/src/type1/t1tokens.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="gif_err.c.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libsplashscreen/giflib/dgif_lib.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 28,10 ***</span>
<span class="line-new-header">--- 28,12 ---</span>
  
  The functions here and in egif_lib.c are partitioned carefully so that
  if you only require one of read and write capability, only one of these
  two modules will be linked.  Preserve this property!
  
<span class="line-added">+ SPDX-License-Identifier: MIT</span>
<span class="line-added">+ </span>
  *****************************************************************************/
  
  #include &lt;stdlib.h&gt;
  #include &lt;limits.h&gt;
  #include &lt;stdint.h&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 50,14 ***</span>
  
  /* compose unsigned little endian value */
  #define UNSIGNED_LITTLE_ENDIAN(lo, hi) ((lo) | ((hi) &lt;&lt; 8))
  
  /* avoid extra function call in case we use fread (TVT) */
<span class="line-modified">! #define READ(_gif,_buf,_len)                                     \</span>
<span class="line-modified">!   (((GifFilePrivateType*)_gif-&gt;Private)-&gt;Read ?                   \</span>
<span class="line-modified">!     ((GifFilePrivateType*)_gif-&gt;Private)-&gt;Read(_gif,_buf,_len) : \</span>
<span class="line-modified">!     fread(_buf,1,_len,((GifFilePrivateType*)_gif-&gt;Private)-&gt;File))</span>
  
  static int DGifGetWord(GifFileType *GifFile, GifWord *Word);
  static int DGifSetupDecompress(GifFileType *GifFile);
  static int DGifDecompressLine(GifFileType *GifFile, GifPixelType *Line,
                                int LineLen);
<span class="line-new-header">--- 52,17 ---</span>
  
  /* compose unsigned little endian value */
  #define UNSIGNED_LITTLE_ENDIAN(lo, hi) ((lo) | ((hi) &lt;&lt; 8))
  
  /* avoid extra function call in case we use fread (TVT) */
<span class="line-modified">! static int InternalRead(GifFileType *gif, GifByteType *buf, int len) {</span>
<span class="line-modified">!     //fprintf(stderr, &quot;### Read: %d\n&quot;, len);</span>
<span class="line-modified">!     return</span>
<span class="line-modified">!     (((GifFilePrivateType*)gif-&gt;Private)-&gt;Read ?</span>
<span class="line-added">+      ((GifFilePrivateType*)gif-&gt;Private)-&gt;Read(gif,buf,len) :</span>
<span class="line-added">+      fread(buf,1,len,((GifFilePrivateType*)gif-&gt;Private)-&gt;File));</span>
<span class="line-added">+ }</span>
  
  static int DGifGetWord(GifFileType *GifFile, GifWord *Word);
  static int DGifSetupDecompress(GifFileType *GifFile);
  static int DGifDecompressLine(GifFileType *GifFile, GifPixelType *Line,
                                int LineLen);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 140,11 ***</span>
      GifFile-&gt;UserData = NULL;    /* TVT */
      /*@=mustfreeonly@*/
  
      /* Let&#39;s see if this is a GIF file: */
      /* coverity[check_return] */
<span class="line-modified">!     if (READ(GifFile, (unsigned char *)Buf, GIF_STAMP_LEN) != GIF_STAMP_LEN) {</span>
          if (Error != NULL)
              *Error = D_GIF_ERR_READ_FAILED;
          (void)fclose(f);
          free((char *)Private);
          free((char *)GifFile);
<span class="line-new-header">--- 145,11 ---</span>
      GifFile-&gt;UserData = NULL;    /* TVT */
      /*@=mustfreeonly@*/
  
      /* Let&#39;s see if this is a GIF file: */
      /* coverity[check_return] */
<span class="line-modified">!     if (InternalRead(GifFile, (unsigned char *)Buf, GIF_STAMP_LEN) != GIF_STAMP_LEN) {</span>
          if (Error != NULL)
              *Error = D_GIF_ERR_READ_FAILED;
          (void)fclose(f);
          free((char *)Private);
          free((char *)GifFile);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 217,11 ***</span>
      Private-&gt;Read = readFunc;    /* TVT */
      GifFile-&gt;UserData = userData;    /* TVT */
  
      /* Lets see if this is a GIF file: */
      /* coverity[check_return] */
<span class="line-modified">!     if (READ(GifFile, (unsigned char *)Buf, GIF_STAMP_LEN) != GIF_STAMP_LEN) {</span>
          if (Error != NULL)
              *Error = D_GIF_ERR_READ_FAILED;
          free((char *)Private);
          free((char *)GifFile);
          return NULL;
<span class="line-new-header">--- 222,11 ---</span>
      Private-&gt;Read = readFunc;    /* TVT */
      GifFile-&gt;UserData = userData;    /* TVT */
  
      /* Lets see if this is a GIF file: */
      /* coverity[check_return] */
<span class="line-modified">!     if (InternalRead(GifFile, (unsigned char *)Buf, GIF_STAMP_LEN) != GIF_STAMP_LEN) {</span>
          if (Error != NULL)
              *Error = D_GIF_ERR_READ_FAILED;
          free((char *)Private);
          free((char *)GifFile);
          return NULL;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 274,11 ***</span>
      /* Put the screen descriptor into the file: */
      if (DGifGetWord(GifFile, &amp;GifFile-&gt;SWidth) == GIF_ERROR ||
          DGifGetWord(GifFile, &amp;GifFile-&gt;SHeight) == GIF_ERROR)
          return GIF_ERROR;
  
<span class="line-modified">!     if (READ(GifFile, Buf, 3) != 3) {</span>
          GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
          GifFreeMapObject(GifFile-&gt;SColorMap);
          GifFile-&gt;SColorMap = NULL;
          return GIF_ERROR;
      }
<span class="line-new-header">--- 279,11 ---</span>
      /* Put the screen descriptor into the file: */
      if (DGifGetWord(GifFile, &amp;GifFile-&gt;SWidth) == GIF_ERROR ||
          DGifGetWord(GifFile, &amp;GifFile-&gt;SHeight) == GIF_ERROR)
          return GIF_ERROR;
  
<span class="line-modified">!     if (InternalRead(GifFile, Buf, 3) != 3) {</span>
          GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
          GifFreeMapObject(GifFile-&gt;SColorMap);
          GifFile-&gt;SColorMap = NULL;
          return GIF_ERROR;
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 298,11 ***</span>
  
          /* Get the global color map: */
          GifFile-&gt;SColorMap-&gt;SortFlag = SortFlag;
          for (i = 0; i &lt; GifFile-&gt;SColorMap-&gt;ColorCount; i++) {
              /* coverity[check_return] */
<span class="line-modified">!             if (READ(GifFile, Buf, 3) != 3) {</span>
                  GifFreeMapObject(GifFile-&gt;SColorMap);
                  GifFile-&gt;SColorMap = NULL;
                  GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
                  return GIF_ERROR;
              }
<span class="line-new-header">--- 303,11 ---</span>
  
          /* Get the global color map: */
          GifFile-&gt;SColorMap-&gt;SortFlag = SortFlag;
          for (i = 0; i &lt; GifFile-&gt;SColorMap-&gt;ColorCount; i++) {
              /* coverity[check_return] */
<span class="line-modified">!             if (InternalRead(GifFile, Buf, 3) != 3) {</span>
                  GifFreeMapObject(GifFile-&gt;SColorMap);
                  GifFile-&gt;SColorMap = NULL;
                  GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
                  return GIF_ERROR;
              }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 312,13 ***</span>
<span class="line-new-header">--- 317,29 ---</span>
          }
      } else {
          GifFile-&gt;SColorMap = NULL;
      }
  
<span class="line-added">+     /*</span>
<span class="line-added">+      * No check here for whether the background color is in range for the</span>
<span class="line-added">+      * screen color map.  Possibly there should be.</span>
<span class="line-added">+      */</span>
<span class="line-added">+ </span>
      return GIF_OK;
  }
  
<span class="line-added">+ const char *</span>
<span class="line-added">+ DGifGetGifVersion(GifFileType *GifFile)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     GifFilePrivateType *Private = (GifFilePrivateType *) GifFile-&gt;Private;</span>
<span class="line-added">+ </span>
<span class="line-added">+     if (Private-&gt;gif89)</span>
<span class="line-added">+         return GIF89_STAMP;</span>
<span class="line-added">+     else</span>
<span class="line-added">+         return GIF87_STAMP;</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  /******************************************************************************
   This routine should be called before any attempt to read an image.
  ******************************************************************************/
  int
  DGifGetRecordType(GifFileType *GifFile, GifRecordType* Type)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 331,15 ***</span>
          GifFile-&gt;Error = D_GIF_ERR_NOT_READABLE;
          return GIF_ERROR;
      }
  
      /* coverity[check_return] */
<span class="line-modified">!     if (READ(GifFile, &amp;Buf, 1) != 1) {</span>
          GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
          return GIF_ERROR;
      }
  
      switch (Buf) {
        case DESCRIPTOR_INTRODUCER:
            *Type = IMAGE_DESC_RECORD_TYPE;
            break;
        case EXTENSION_INTRODUCER:
<span class="line-new-header">--- 352,16 ---</span>
          GifFile-&gt;Error = D_GIF_ERR_NOT_READABLE;
          return GIF_ERROR;
      }
  
      /* coverity[check_return] */
<span class="line-modified">!     if (InternalRead(GifFile, &amp;Buf, 1) != 1) {</span>
          GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
          return GIF_ERROR;
      }
  
<span class="line-added">+     //fprintf(stderr, &quot;### DGifGetRecordType: %02x\n&quot;, Buf);</span>
      switch (Buf) {
        case DESCRIPTOR_INTRODUCER:
            *Type = IMAGE_DESC_RECORD_TYPE;
            break;
        case EXTENSION_INTRODUCER:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 355,21 ***</span>
      }
  
      return GIF_OK;
  }
  
<span class="line-removed">- /******************************************************************************</span>
<span class="line-removed">-  This routine should be called before any attempt to read an image.</span>
<span class="line-removed">-  Note it is assumed the Image desc. header has been read.</span>
<span class="line-removed">- ******************************************************************************/</span>
  int
<span class="line-modified">! DGifGetImageDesc(GifFileType *GifFile)</span>
  {
      unsigned int BitsPerPixel;
      GifByteType Buf[3];
      GifFilePrivateType *Private = (GifFilePrivateType *)GifFile-&gt;Private;
<span class="line-removed">-     SavedImage *sp;</span>
  
      if (!IS_READABLE(Private)) {
          /* This file was NOT open for reading: */
          GifFile-&gt;Error = D_GIF_ERR_NOT_READABLE;
          return GIF_ERROR;
<span class="line-new-header">--- 377,16 ---</span>
      }
  
      return GIF_OK;
  }
  
  int
<span class="line-modified">! DGifGetImageHeader(GifFileType *GifFile)</span>
  {
      unsigned int BitsPerPixel;
      GifByteType Buf[3];
      GifFilePrivateType *Private = (GifFilePrivateType *)GifFile-&gt;Private;
  
      if (!IS_READABLE(Private)) {
          /* This file was NOT open for reading: */
          GifFile-&gt;Error = D_GIF_ERR_NOT_READABLE;
          return GIF_ERROR;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 378,11 ***</span>
      if (DGifGetWord(GifFile, &amp;GifFile-&gt;Image.Left) == GIF_ERROR ||
          DGifGetWord(GifFile, &amp;GifFile-&gt;Image.Top) == GIF_ERROR ||
          DGifGetWord(GifFile, &amp;GifFile-&gt;Image.Width) == GIF_ERROR ||
          DGifGetWord(GifFile, &amp;GifFile-&gt;Image.Height) == GIF_ERROR)
          return GIF_ERROR;
<span class="line-modified">!     if (READ(GifFile, Buf, 1) != 1) {</span>
          GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
          GifFreeMapObject(GifFile-&gt;Image.ColorMap);
          GifFile-&gt;Image.ColorMap = NULL;
          return GIF_ERROR;
      }
<span class="line-new-header">--- 395,11 ---</span>
      if (DGifGetWord(GifFile, &amp;GifFile-&gt;Image.Left) == GIF_ERROR ||
          DGifGetWord(GifFile, &amp;GifFile-&gt;Image.Top) == GIF_ERROR ||
          DGifGetWord(GifFile, &amp;GifFile-&gt;Image.Width) == GIF_ERROR ||
          DGifGetWord(GifFile, &amp;GifFile-&gt;Image.Height) == GIF_ERROR)
          return GIF_ERROR;
<span class="line-modified">!     if (InternalRead(GifFile, Buf, 1) != 1) {</span>
          GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
          GifFreeMapObject(GifFile-&gt;Image.ColorMap);
          GifFile-&gt;Image.ColorMap = NULL;
          return GIF_ERROR;
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 405,11 ***</span>
          }
  
          /* Get the image local color map: */
          for (i = 0; i &lt; GifFile-&gt;Image.ColorMap-&gt;ColorCount; i++) {
              /* coverity[check_return] */
<span class="line-modified">!             if (READ(GifFile, Buf, 3) != 3) {</span>
                  GifFreeMapObject(GifFile-&gt;Image.ColorMap);
                  GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
                  GifFile-&gt;Image.ColorMap = NULL;
                  return GIF_ERROR;
              }
<span class="line-new-header">--- 422,11 ---</span>
          }
  
          /* Get the image local color map: */
          for (i = 0; i &lt; GifFile-&gt;Image.ColorMap-&gt;ColorCount; i++) {
              /* coverity[check_return] */
<span class="line-modified">!             if (InternalRead(GifFile, Buf, 3) != 3) {</span>
                  GifFreeMapObject(GifFile-&gt;Image.ColorMap);
                  GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
                  GifFile-&gt;Image.ColorMap = NULL;
                  return GIF_ERROR;
              }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 417,10 ***</span>
<span class="line-new-header">--- 434,37 ---</span>
              GifFile-&gt;Image.ColorMap-&gt;Colors[i].Green = Buf[1];
              GifFile-&gt;Image.ColorMap-&gt;Colors[i].Blue = Buf[2];
          }
      }
  
<span class="line-added">+     Private-&gt;PixelCount = (long)GifFile-&gt;Image.Width *</span>
<span class="line-added">+        (long)GifFile-&gt;Image.Height;</span>
<span class="line-added">+ </span>
<span class="line-added">+     /* Reset decompress algorithm parameters. */</span>
<span class="line-added">+     return DGifSetupDecompress(GifFile);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ /******************************************************************************</span>
<span class="line-added">+  This routine should be called before any attempt to read an image.</span>
<span class="line-added">+  Note it is assumed the Image desc. header has been read.</span>
<span class="line-added">+ ******************************************************************************/</span>
<span class="line-added">+ int</span>
<span class="line-added">+ DGifGetImageDesc(GifFileType *GifFile)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     GifFilePrivateType *Private = (GifFilePrivateType *)GifFile-&gt;Private;</span>
<span class="line-added">+     SavedImage *sp;</span>
<span class="line-added">+ </span>
<span class="line-added">+     if (!IS_READABLE(Private)) {</span>
<span class="line-added">+         /* This file was NOT open for reading: */</span>
<span class="line-added">+         GifFile-&gt;Error = D_GIF_ERR_NOT_READABLE;</span>
<span class="line-added">+         return GIF_ERROR;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     if (DGifGetImageHeader(GifFile) == GIF_ERROR) {</span>
<span class="line-added">+         return GIF_ERROR;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      if (GifFile-&gt;SavedImages) {
          SavedImage* new_saved_images =
              (SavedImage *)reallocarray(GifFile-&gt;SavedImages,
                              (GifFile-&gt;ImageCount + 1), sizeof(SavedImage));
          if (new_saved_images == NULL) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 451,15 ***</span>
      sp-&gt;ExtensionBlockCount = 0;
      sp-&gt;ExtensionBlocks = (ExtensionBlock *) NULL;
  
      GifFile-&gt;ImageCount++;
  
<span class="line-modified">!     Private-&gt;PixelCount = (long)GifFile-&gt;Image.Width *</span>
<span class="line-removed">-        (long)GifFile-&gt;Image.Height;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /* Reset decompress algorithm parameters. */</span>
<span class="line-removed">-     return DGifSetupDecompress(GifFile);</span>
  }
  
  /******************************************************************************
   Get one full scanned line (Line) of length LineLen from GIF file.
  ******************************************************************************/
<span class="line-new-header">--- 495,11 ---</span>
      sp-&gt;ExtensionBlockCount = 0;
      sp-&gt;ExtensionBlocks = (ExtensionBlock *) NULL;
  
      GifFile-&gt;ImageCount++;
  
<span class="line-modified">!     return GIF_OK;</span>
  }
  
  /******************************************************************************
   Get one full scanned line (Line) of length LineLen from GIF file.
  ******************************************************************************/
</pre>
<hr />
<pre>
<span class="line-old-header">*** 548,22 ***</span>
  DGifGetExtension(GifFileType *GifFile, int *ExtCode, GifByteType **Extension)
  {
      GifByteType Buf;
      GifFilePrivateType *Private = (GifFilePrivateType *)GifFile-&gt;Private;
  
      if (!IS_READABLE(Private)) {
          /* This file was NOT open for reading: */
          GifFile-&gt;Error = D_GIF_ERR_NOT_READABLE;
          return GIF_ERROR;
      }
  
      /* coverity[check_return] */
<span class="line-modified">!     if (READ(GifFile, &amp;Buf, 1) != 1) {</span>
          GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
          return GIF_ERROR;
      }
      *ExtCode = Buf;
  
      return DGifGetExtensionNext(GifFile, Extension);
  }
  
  /******************************************************************************
<span class="line-new-header">--- 588,24 ---</span>
  DGifGetExtension(GifFileType *GifFile, int *ExtCode, GifByteType **Extension)
  {
      GifByteType Buf;
      GifFilePrivateType *Private = (GifFilePrivateType *)GifFile-&gt;Private;
  
<span class="line-added">+     //fprintf(stderr, &quot;### -&gt; DGifGetExtension:\n&quot;);</span>
      if (!IS_READABLE(Private)) {
          /* This file was NOT open for reading: */
          GifFile-&gt;Error = D_GIF_ERR_NOT_READABLE;
          return GIF_ERROR;
      }
  
      /* coverity[check_return] */
<span class="line-modified">!     if (InternalRead(GifFile, &amp;Buf, 1) != 1) {</span>
          GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
          return GIF_ERROR;
      }
      *ExtCode = Buf;
<span class="line-added">+     //fprintf(stderr, &quot;### &lt;- DGifGetExtension: %02x, about to call next\n&quot;, Buf);</span>
  
      return DGifGetExtensionNext(GifFile, Extension);
  }
  
  /******************************************************************************
</pre>
<hr />
<pre>
<span class="line-old-header">*** 575,24 ***</span>
  DGifGetExtensionNext(GifFileType *GifFile, GifByteType ** Extension)
  {
      GifByteType Buf;
      GifFilePrivateType *Private = (GifFilePrivateType *)GifFile-&gt;Private;
  
<span class="line-modified">!     if (READ(GifFile, &amp;Buf, 1) != 1) {</span>
          GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
          return GIF_ERROR;
      }
      if (Buf &gt; 0) {
          *Extension = Private-&gt;Buf;    /* Use private unused buffer. */
          (*Extension)[0] = Buf;  /* Pascal strings notation (pos. 0 is len.). */
          /* coverity[tainted_data,check_return] */
<span class="line-modified">!         if (READ(GifFile, &amp;((*Extension)[1]), Buf) != Buf) {</span>
              GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
              return GIF_ERROR;
          }
      } else
          *Extension = NULL;
  
      return GIF_OK;
  }
  
  /******************************************************************************
<span class="line-new-header">--- 617,28 ---</span>
  DGifGetExtensionNext(GifFileType *GifFile, GifByteType ** Extension)
  {
      GifByteType Buf;
      GifFilePrivateType *Private = (GifFilePrivateType *)GifFile-&gt;Private;
  
<span class="line-modified">!     //fprintf(stderr, &quot;### -&gt; DGifGetExtensionNext\n&quot;);</span>
<span class="line-added">+     if (InternalRead(GifFile, &amp;Buf, 1) != 1) {</span>
          GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
          return GIF_ERROR;
      }
<span class="line-added">+     //fprintf(stderr, &quot;### DGifGetExtensionNext sees %d\n&quot;, Buf);</span>
<span class="line-added">+ </span>
      if (Buf &gt; 0) {
          *Extension = Private-&gt;Buf;    /* Use private unused buffer. */
          (*Extension)[0] = Buf;  /* Pascal strings notation (pos. 0 is len.). */
          /* coverity[tainted_data,check_return] */
<span class="line-modified">!         if (InternalRead(GifFile, &amp;((*Extension)[1]), Buf) != Buf) {</span>
              GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
              return GIF_ERROR;
          }
      } else
          *Extension = NULL;
<span class="line-added">+     //fprintf(stderr, &quot;### &lt;- DGifGetExtensionNext: %p\n&quot;, Extension);</span>
  
      return GIF_OK;
  }
  
  /******************************************************************************
</pre>
<hr />
<pre>
<span class="line-old-header">*** 705,11 ***</span>
  DGifGetWord(GifFileType *GifFile, GifWord *Word)
  {
      unsigned char c[2];
  
      /* coverity[check_return] */
<span class="line-modified">!     if (READ(GifFile, c, 2) != 2) {</span>
          GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
          return GIF_ERROR;
      }
  
      *Word = (GifWord)UNSIGNED_LITTLE_ENDIAN(c[0], c[1]);
<span class="line-new-header">--- 751,11 ---</span>
  DGifGetWord(GifFileType *GifFile, GifWord *Word)
  {
      unsigned char c[2];
  
      /* coverity[check_return] */
<span class="line-modified">!     if (InternalRead(GifFile, c, 2) != 2) {</span>
          GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
          return GIF_ERROR;
      }
  
      *Word = (GifWord)UNSIGNED_LITTLE_ENDIAN(c[0], c[1]);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 750,21 ***</span>
      GifByteType Buf;
      GifFilePrivateType *Private = (GifFilePrivateType *)GifFile-&gt;Private;
  
      /* coverity[tainted_data_argument] */
      /* coverity[check_return] */
<span class="line-modified">!     if (READ(GifFile, &amp;Buf, 1) != 1) {</span>
          GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
          return GIF_ERROR;
      }
  
      /* coverity[lower_bounds] */
      if (Buf &gt; 0) {
          *CodeBlock = Private-&gt;Buf;    /* Use private unused buffer. */
          (*CodeBlock)[0] = Buf;  /* Pascal strings notation (pos. 0 is len.). */
          /* coverity[tainted_data] */
<span class="line-modified">!         if (READ(GifFile, &amp;((*CodeBlock)[1]), Buf) != Buf) {</span>
              GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
              return GIF_ERROR;
          }
      } else {
          *CodeBlock = NULL;
<span class="line-new-header">--- 796,21 ---</span>
      GifByteType Buf;
      GifFilePrivateType *Private = (GifFilePrivateType *)GifFile-&gt;Private;
  
      /* coverity[tainted_data_argument] */
      /* coverity[check_return] */
<span class="line-modified">!     if (InternalRead(GifFile, &amp;Buf, 1) != 1) {</span>
          GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
          return GIF_ERROR;
      }
  
      /* coverity[lower_bounds] */
      if (Buf &gt; 0) {
          *CodeBlock = Private-&gt;Buf;    /* Use private unused buffer. */
          (*CodeBlock)[0] = Buf;  /* Pascal strings notation (pos. 0 is len.). */
          /* coverity[tainted_data] */
<span class="line-modified">!         if (InternalRead(GifFile, &amp;((*CodeBlock)[1]), Buf) != Buf) {</span>
              GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
              return GIF_ERROR;
          }
      } else {
          *CodeBlock = NULL;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 785,11 ***</span>
      GifByteType CodeSize;
      GifPrefixType *Prefix;
      GifFilePrivateType *Private = (GifFilePrivateType *)GifFile-&gt;Private;
  
      /* coverity[check_return] */
<span class="line-modified">!     if (READ(GifFile, &amp;CodeSize, 1) &lt; 1) {    /* Read Code size from file. */</span>
          return GIF_ERROR;    /* Failed to read Code size. */
      }
      BitsPerPixel = CodeSize;
  
      /* this can only happen on a severely malformed GIF */
<span class="line-new-header">--- 831,11 ---</span>
      GifByteType CodeSize;
      GifPrefixType *Prefix;
      GifFilePrivateType *Private = (GifFilePrivateType *)GifFile-&gt;Private;
  
      /* coverity[check_return] */
<span class="line-modified">!     if (InternalRead(GifFile, &amp;CodeSize, 1) &lt; 1) {    /* Read Code size from file. */</span>
          return GIF_ERROR;    /* Failed to read Code size. */
      }
      BitsPerPixel = CodeSize;
  
      /* this can only happen on a severely malformed GIF */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 919,11 ***</span>
  
                  /* Now lets pop all the stack into output: */
                  while (StackPtr != 0 &amp;&amp; i &lt; LineLen)
                      Line[i++] = Stack[--StackPtr];
              }
<span class="line-modified">!             if (LastCode != NO_SUCH_CODE &amp;&amp; Prefix[Private-&gt;RunningCode - 2] == NO_SUCH_CODE) {</span>
                  Prefix[Private-&gt;RunningCode - 2] = LastCode;
  
                  if (CrntCode == Private-&gt;RunningCode - 2) {
                      /* Only allowed if CrntCode is exactly the running code:
                       * In that case CrntCode = XXXCode, CrntCode or the
<span class="line-new-header">--- 965,11 ---</span>
  
                  /* Now lets pop all the stack into output: */
                  while (StackPtr != 0 &amp;&amp; i &lt; LineLen)
                      Line[i++] = Stack[--StackPtr];
              }
<span class="line-modified">!             if (LastCode != NO_SUCH_CODE &amp;&amp; Private-&gt;RunningCode - 2 &lt; (LZ_MAX_CODE+1) &amp;&amp; Prefix[Private-&gt;RunningCode - 2] == NO_SUCH_CODE) {</span>
                  Prefix[Private-&gt;RunningCode - 2] = LastCode;
  
                  if (CrntCode == Private-&gt;RunningCode - 2) {
                      /* Only allowed if CrntCode is exactly the running code:
                       * In that case CrntCode = XXXCode, CrntCode or the
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1067,11 ***</span>
  DGifBufferedInput(GifFileType *GifFile, GifByteType *Buf, GifByteType *NextByte)
  {
      if (Buf[0] == 0) {
          /* Needs to read the next buffer - this one is empty: */
          /* coverity[check_return] */
<span class="line-modified">!         if (READ(GifFile, Buf, 1) != 1) {</span>
              GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
              return GIF_ERROR;
          }
          /* There shouldn&#39;t be any empty data blocks here as the LZW spec
           * says the LZW termination code should come first.  Therefore we
<span class="line-new-header">--- 1113,11 ---</span>
  DGifBufferedInput(GifFileType *GifFile, GifByteType *Buf, GifByteType *NextByte)
  {
      if (Buf[0] == 0) {
          /* Needs to read the next buffer - this one is empty: */
          /* coverity[check_return] */
<span class="line-modified">!         if (InternalRead(GifFile, Buf, 1) != 1) {</span>
              GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
              return GIF_ERROR;
          }
          /* There shouldn&#39;t be any empty data blocks here as the LZW spec
           * says the LZW termination code should come first.  Therefore we
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1079,11 ***</span>
           */
          if (Buf[0] == 0) {
              GifFile-&gt;Error = D_GIF_ERR_IMAGE_DEFECT;
              return GIF_ERROR;
          }
<span class="line-modified">!         if (READ(GifFile, &amp;Buf[1], Buf[0]) != Buf[0]) {</span>
              GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
              return GIF_ERROR;
          }
          *NextByte = Buf[1];
          Buf[1] = 2;    /* We use now the second place as last char read! */
<span class="line-new-header">--- 1125,11 ---</span>
           */
          if (Buf[0] == 0) {
              GifFile-&gt;Error = D_GIF_ERR_IMAGE_DEFECT;
              return GIF_ERROR;
          }
<span class="line-modified">!         if (InternalRead(GifFile, &amp;Buf[1], Buf[0]) != Buf[0]) {</span>
              GifFile-&gt;Error = D_GIF_ERR_READ_FAILED;
              return GIF_ERROR;
          }
          *NextByte = Buf[1];
          Buf[1] = 2;    /* We use now the second place as last char read! */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1122,11 ***</span>
                if (DGifGetImageDesc(GifFile) == GIF_ERROR)
                    return (GIF_ERROR);
  
                sp = &amp;GifFile-&gt;SavedImages[GifFile-&gt;ImageCount - 1];
                /* Allocate memory for the image */
<span class="line-modified">!               if (sp-&gt;ImageDesc.Width &lt; 0 &amp;&amp; sp-&gt;ImageDesc.Height &lt; 0 &amp;&amp;</span>
                        sp-&gt;ImageDesc.Width &gt; (INT_MAX / sp-&gt;ImageDesc.Height)) {
                    return GIF_ERROR;
                }
                ImageSize = sp-&gt;ImageDesc.Width * sp-&gt;ImageDesc.Height;
  
<span class="line-new-header">--- 1168,11 ---</span>
                if (DGifGetImageDesc(GifFile) == GIF_ERROR)
                    return (GIF_ERROR);
  
                sp = &amp;GifFile-&gt;SavedImages[GifFile-&gt;ImageCount - 1];
                /* Allocate memory for the image */
<span class="line-modified">!               if (sp-&gt;ImageDesc.Width &lt;= 0 || sp-&gt;ImageDesc.Height &lt;= 0 ||</span>
                        sp-&gt;ImageDesc.Width &gt; (INT_MAX / sp-&gt;ImageDesc.Height)) {
                    return GIF_ERROR;
                }
                ImageSize = sp-&gt;ImageDesc.Width * sp-&gt;ImageDesc.Height;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1182,13 ***</span>
                                 &amp;GifFile-&gt;ExtensionBlocks,
                                 ExtFunction, ExtData[0], &amp;ExtData[1])
                        == GIF_ERROR)
                        return (GIF_ERROR);
                }
<span class="line-modified">!               while (ExtData != NULL) {</span>
                    if (DGifGetExtensionNext(GifFile, &amp;ExtData) == GIF_ERROR)
                        return (GIF_ERROR);
                    /* Continue the extension block */
                    if (ExtData != NULL)
                        if (GifAddExtensionBlock(&amp;GifFile-&gt;ExtensionBlockCount,
                                     &amp;GifFile-&gt;ExtensionBlocks,
                                     CONTINUE_EXT_FUNC_CODE,
<span class="line-new-header">--- 1228,15 ---</span>
                                 &amp;GifFile-&gt;ExtensionBlocks,
                                 ExtFunction, ExtData[0], &amp;ExtData[1])
                        == GIF_ERROR)
                        return (GIF_ERROR);
                }
<span class="line-modified">!               for (;;) {</span>
                    if (DGifGetExtensionNext(GifFile, &amp;ExtData) == GIF_ERROR)
                        return (GIF_ERROR);
<span class="line-added">+                   if (ExtData == NULL)</span>
<span class="line-added">+                       break;</span>
                    /* Continue the extension block */
                    if (ExtData != NULL)
                        if (GifAddExtensionBlock(&amp;GifFile-&gt;ExtensionBlockCount,
                                     &amp;GifFile-&gt;ExtensionBlocks,
                                     CONTINUE_EXT_FUNC_CODE,
</pre>
<center><a href="../../libfreetype/src/type1/t1tokens.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="gif_err.c.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>