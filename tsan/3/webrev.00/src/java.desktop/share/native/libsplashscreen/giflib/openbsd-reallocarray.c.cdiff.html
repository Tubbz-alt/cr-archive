<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/native/libsplashscreen/giflib/openbsd-reallocarray.c</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="gifalloc.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../libpng/CHANGES.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libsplashscreen/giflib/openbsd-reallocarray.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 23,37 ***</span>
   */
  
  /*    $OpenBSD: reallocarray.c,v 1.1 2014/05/08 21:43:49 deraadt Exp $    */
  /*
   * Copyright (c) 2008 Otto Moerbeek &lt;otto@drijf.net&gt;
<span class="line-modified">!  *</span>
<span class="line-removed">-  * Permission to use, copy, modify, and distribute this software for any</span>
<span class="line-removed">-  * purpose with or without fee is hereby granted, provided that the above</span>
<span class="line-removed">-  * copyright notice and this permission notice appear in all copies.</span>
<span class="line-removed">-  *</span>
<span class="line-removed">-  * THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES</span>
<span class="line-removed">-  * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF</span>
<span class="line-removed">-  * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR</span>
<span class="line-removed">-  * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES</span>
<span class="line-removed">-  * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN</span>
<span class="line-removed">-  * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF</span>
<span class="line-removed">-  * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.</span>
   */
  
  #include &lt;sys/types.h&gt;
  #include &lt;errno.h&gt;
  #include &lt;stdint.h&gt;
  #include &lt;stdlib.h&gt;
  
  /*
   * This is sqrt(SIZE_MAX+1), as s1*s2 &lt;= SIZE_MAX
   * if both s1 &lt; MUL_NO_OVERFLOW and s2 &lt; MUL_NO_OVERFLOW
   */
  #define MUL_NO_OVERFLOW    ((size_t)1 &lt;&lt; (sizeof(size_t) * 4))
  
  void *
<span class="line-modified">! reallocarray(void *optr, size_t nmemb, size_t size)</span>
  {
      if ((nmemb &gt;= MUL_NO_OVERFLOW || size &gt;= MUL_NO_OVERFLOW) &amp;&amp;
          nmemb &gt; 0 &amp;&amp; SIZE_MAX / nmemb &lt; size) {
          errno = ENOMEM;
          return NULL;
<span class="line-new-header">--- 23,30 ---</span>
   */
  
  /*    $OpenBSD: reallocarray.c,v 1.1 2014/05/08 21:43:49 deraadt Exp $    */
  /*
   * Copyright (c) 2008 Otto Moerbeek &lt;otto@drijf.net&gt;
<span class="line-modified">!  * SPDX-License-Identifier: MIT</span>
   */
  
  #include &lt;sys/types.h&gt;
  #include &lt;errno.h&gt;
  #include &lt;stdint.h&gt;
  #include &lt;stdlib.h&gt;
  
<span class="line-added">+ #ifndef SIZE_MAX</span>
<span class="line-added">+     #define SIZE_MAX     UINTPTR_MAX</span>
<span class="line-added">+ #endif</span>
<span class="line-added">+ </span>
  /*
   * This is sqrt(SIZE_MAX+1), as s1*s2 &lt;= SIZE_MAX
   * if both s1 &lt; MUL_NO_OVERFLOW and s2 &lt; MUL_NO_OVERFLOW
   */
  #define MUL_NO_OVERFLOW    ((size_t)1 &lt;&lt; (sizeof(size_t) * 4))
  
  void *
<span class="line-modified">! openbsd_reallocarray(void *optr, size_t nmemb, size_t size)</span>
  {
      if ((nmemb &gt;= MUL_NO_OVERFLOW || size &gt;= MUL_NO_OVERFLOW) &amp;&amp;
          nmemb &gt; 0 &amp;&amp; SIZE_MAX / nmemb &lt; size) {
          errno = ENOMEM;
          return NULL;
</pre>
<center><a href="gifalloc.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../libpng/CHANGES.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>