<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.desktop/share/native/libsplashscreen/libpng/png.h</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 /*
   2  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   3  *
   4  * This code is free software; you can redistribute it and/or modify it
   5  * under the terms of the GNU General Public License version 2 only, as
   6  * published by the Free Software Foundation.  Oracle designates this
   7  * particular file as subject to the &quot;Classpath&quot; exception as provided
   8  * by Oracle in the LICENSE file that accompanied this code.
   9  *
  10  * This code is distributed in the hope that it will be useful, but WITHOUT
  11  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  12  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  13  * version 2 for more details (a copy is included in the LICENSE file that
  14  * accompanied this code).
  15  *
  16  * You should have received a copy of the GNU General Public License version
  17  * 2 along with this work; if not, write to the Free Software Foundation,
  18  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  19  *
  20  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  21  * or visit www.oracle.com if you need additional information or have any
  22  * questions.
  23  */
  24 
  25 /* png.h - header file for PNG reference library
  26  *
  27  * This file is available under and governed by the GNU General Public
  28  * License version 2 only, as published by the Free Software Foundation.
  29  * However, the following notice accompanied the original version of this
  30  * file and, per its terms, should not be removed:
  31  *
<a name="1" id="anc1"></a><span class="line-modified">  32  * libpng version 1.6.35, July 15, 2018</span>
  33  *
<a name="2" id="anc2"></a>
  34  * Copyright (c) 1998-2002,2004,2006-2018 Glenn Randers-Pehrson
<a name="3" id="anc3"></a><span class="line-modified">  35  * (Version 0.96 Copyright (c) 1996, 1997 Andreas Dilger)</span>
<span class="line-modified">  36  * (Version 0.88 Copyright (c) 1995, 1996 Guy Eric Schalnat, Group 42, Inc.)</span>
  37  *
<a name="4" id="anc4"></a><span class="line-modified">  38  * This code is released under the libpng license (See LICENSE, below)</span>
  39  *
  40  * Authors and maintainers:
  41  *   libpng versions 0.71, May 1995, through 0.88, January 1996: Guy Schalnat
  42  *   libpng versions 0.89, June 1996, through 0.96, May 1997: Andreas Dilger
<a name="5" id="anc5"></a><span class="line-modified">  43  *   libpng versions 0.97, January 1998, through 1.6.35, July 15, 2018:</span>
<span class="line-modified">  44  *     Glenn Randers-Pehrson.</span>


  45  *   See also &quot;Contributing Authors&quot;, below.
  46  */
  47 
  48 /*
<a name="6" id="anc6"></a><span class="line-modified">  49  * COPYRIGHT NOTICE, DISCLAIMER, and LICENSE:</span>
























  50  *
<a name="7" id="anc7"></a><span class="line-modified">  51  * If you modify libpng you may insert additional notices immediately following</span>
<span class="line-modified">  52  * this sentence.</span>


  53  *
<a name="8" id="anc8"></a><span class="line-modified">  54  * This code is released under the libpng license.</span>

  55  *
<a name="9" id="anc9"></a><span class="line-modified">  56  * libpng versions 1.0.7, July 1, 2000 through 1.6.35, July 15, 2018 are</span>







  57  * Copyright (c) 2000-2002, 2004, 2006-2018 Glenn Randers-Pehrson, are
  58  * derived from libpng-1.0.6, and are distributed according to the same
  59  * disclaimer and license as libpng-1.0.6 with the following individuals
  60  * added to the list of Contributing Authors:
  61  *
<a name="10" id="anc10"></a><span class="line-modified">  62  *    Simon-Pierre Cadieux</span>
<span class="line-modified">  63  *    Eric S. Raymond</span>
<span class="line-modified">  64  *    Mans Rullgard</span>
<span class="line-modified">  65  *    Cosmin Truta</span>
<span class="line-modified">  66  *    Gilles Vollant</span>
<span class="line-modified">  67  *    James Yu</span>
<span class="line-modified">  68  *    Mandar Sahastrabuddhe</span>
<span class="line-modified">  69  *    Google Inc.</span>
<span class="line-modified">  70  *    Vadim Barkov</span>
  71  *
  72  * and with the following additions to the disclaimer:
  73  *
<a name="11" id="anc11"></a><span class="line-modified">  74  *    There is no warranty against interference with your enjoyment of the</span>
<span class="line-modified">  75  *    library or against infringement.  There is no warranty that our</span>
<span class="line-modified">  76  *    efforts or the library will fulfill any of your particular purposes</span>
<span class="line-modified">  77  *    or needs.  This library is provided with all faults, and the entire</span>
<span class="line-modified">  78  *    risk of satisfactory quality, performance, accuracy, and effort is with</span>
<span class="line-modified">  79  *    the user.</span>
  80  *
  81  * Some files in the &quot;contrib&quot; directory and some configure-generated
<a name="12" id="anc12"></a><span class="line-modified">  82  * files that are distributed with libpng have other copyright owners and</span>
  83  * are released under other open source licenses.
  84  *
  85  * libpng versions 0.97, January 1998, through 1.0.6, March 20, 2000, are
  86  * Copyright (c) 1998-2000 Glenn Randers-Pehrson, are derived from
  87  * libpng-0.96, and are distributed according to the same disclaimer and
<a name="13" id="anc13"></a><span class="line-modified">  88  * license as libpng-0.96, with the following individuals added to the list</span>
<span class="line-modified">  89  * of Contributing Authors:</span>
  90  *
<a name="14" id="anc14"></a><span class="line-modified">  91  *    Tom Lane</span>
<span class="line-modified">  92  *    Glenn Randers-Pehrson</span>
<span class="line-modified">  93  *    Willem van Schaik</span>
  94  *
  95  * libpng versions 0.89, June 1996, through 0.96, May 1997, are
  96  * Copyright (c) 1996-1997 Andreas Dilger, are derived from libpng-0.88,
  97  * and are distributed according to the same disclaimer and license as
  98  * libpng-0.88, with the following individuals added to the list of
  99  * Contributing Authors:
 100  *
<a name="15" id="anc15"></a><span class="line-modified"> 101  *    John Bowler</span>
<span class="line-modified"> 102  *    Kevin Bracey</span>
<span class="line-modified"> 103  *    Sam Bushell</span>
<span class="line-modified"> 104  *    Magnus Holmgren</span>
<span class="line-modified"> 105  *    Greg Roelofs</span>
<span class="line-modified"> 106  *    Tom Tanner</span>
 107  *
<a name="16" id="anc16"></a><span class="line-modified"> 108  * Some files in the &quot;scripts&quot; directory have other copyright owners</span>
 109  * but are released under this license.
 110  *
 111  * libpng versions 0.5, May 1995, through 0.88, January 1996, are
 112  * Copyright (c) 1995-1996 Guy Eric Schalnat, Group 42, Inc.
 113  *
 114  * For the purposes of this copyright and license, &quot;Contributing Authors&quot;
 115  * is defined as the following set of individuals:
 116  *
<a name="17" id="anc17"></a><span class="line-modified"> 117  *    Andreas Dilger</span>
<span class="line-modified"> 118  *    Dave Martindale</span>
<span class="line-modified"> 119  *    Guy Eric Schalnat</span>
<span class="line-modified"> 120  *    Paul Schmidt</span>
<span class="line-modified"> 121  *    Tim Wegner</span>
<span class="line-modified"> 122  *</span>
<span class="line-modified"> 123  * The PNG Reference Library is supplied &quot;AS IS&quot;.  The Contributing Authors</span>
<span class="line-modified"> 124  * and Group 42, Inc. disclaim all warranties, expressed or implied,</span>
<span class="line-modified"> 125  * including, without limitation, the warranties of merchantability and of</span>
<span class="line-modified"> 126  * fitness for any purpose.  The Contributing Authors and Group 42, Inc.</span>
<span class="line-modified"> 127  * assume no liability for direct, indirect, incidental, special, exemplary,</span>
<span class="line-modified"> 128  * or consequential damages, which may result from the use of the PNG</span>
<span class="line-modified"> 129  * Reference Library, even if advised of the possibility of such damage.</span>

 130  *
 131  * Permission is hereby granted to use, copy, modify, and distribute this
 132  * source code, or portions hereof, for any purpose, without fee, subject
 133  * to the following restrictions:
 134  *
<a name="18" id="anc18"></a><span class="line-modified"> 135  *   1. The origin of this source code must not be misrepresented.</span>
 136  *
<a name="19" id="anc19"></a><span class="line-modified"> 137  *   2. Altered versions must be plainly marked as such and must not</span>
<span class="line-modified"> 138  *      be misrepresented as being the original source.</span>
 139  *
<a name="20" id="anc20"></a><span class="line-modified"> 140  *   3. This Copyright notice may not be removed or altered from any</span>
<span class="line-modified"> 141  *      source or altered source distribution.</span>
 142  *
<a name="21" id="anc21"></a><span class="line-modified"> 143  * The Contributing Authors and Group 42, Inc. specifically permit, without</span>
<span class="line-modified"> 144  * fee, and encourage the use of this source code as a component to</span>
<span class="line-modified"> 145  * supporting the PNG file format in commercial products.  If you use this</span>
<span class="line-modified"> 146  * source code in a product, acknowledgment is not required but would be</span>
<span class="line-modified"> 147  * appreciated.</span>
 148  *
 149  * END OF COPYRIGHT NOTICE, DISCLAIMER, and LICENSE.
 150  *
<a name="22" id="anc22"></a><span class="line-modified"> 151  * TRADEMARK:</span>

 152  *
<a name="23" id="anc23"></a><span class="line-modified"> 153  * The name &quot;libpng&quot; has not been registered by the Copyright owner</span>
 154  * as a trademark in any jurisdiction.  However, because libpng has
 155  * been distributed and maintained world-wide, continually since 1995,
<a name="24" id="anc24"></a><span class="line-modified"> 156  * the Copyright owner claims &quot;common-law trademark protection&quot; in any</span>
 157  * jurisdiction where common-law trademark is recognized.
<a name="25" id="anc25"></a><span class="line-removed"> 158  *</span>
<span class="line-removed"> 159  * OSI CERTIFICATION:</span>
<span class="line-removed"> 160  *</span>
<span class="line-removed"> 161  * Libpng is OSI Certified Open Source Software.  OSI Certified Open Source is</span>
<span class="line-removed"> 162  * a certification mark of the Open Source Initiative. OSI has not addressed</span>
<span class="line-removed"> 163  * the additional disclaimers inserted at version 1.0.7.</span>
<span class="line-removed"> 164  *</span>
<span class="line-removed"> 165  * EXPORT CONTROL:</span>
<span class="line-removed"> 166  *</span>
<span class="line-removed"> 167  * The Copyright owner believes that the Export Control Classification</span>
<span class="line-removed"> 168  * Number (ECCN) for libpng is EAR99, which means not subject to export</span>
<span class="line-removed"> 169  * controls or International Traffic in Arms Regulations (ITAR) because</span>
<span class="line-removed"> 170  * it is open source, publicly available software, that does not contain</span>
<span class="line-removed"> 171  * any encryption software.  See the EAR, paragraphs 734.3(b)(3) and</span>
<span class="line-removed"> 172  * 734.7(b).</span>
 173  */
 174 
 175 /*
 176  * A &quot;png_get_copyright&quot; function is available, for convenient use in &quot;about&quot;
 177  * boxes and the like:
 178  *
 179  *    printf(&quot;%s&quot;, png_get_copyright(NULL));
 180  *
 181  * Also, the PNG logo (in PNG format, of course) is supplied in the
 182  * files &quot;pngbar.png&quot; and &quot;pngbar.jpg (88x31) and &quot;pngnow.png&quot; (98x31).
 183  */
 184 
 185 /*
 186  * The contributing authors would like to thank all those who helped
 187  * with testing, bug fixes, and patience.  This wouldn&#39;t have been
 188  * possible without all of you.
 189  *
 190  * Thanks to Frank J. T. Wojcik for helping with the documentation.
 191  */
 192 
 193 /* Note about libpng version numbers:
 194  *
 195  *    Due to various miscommunications, unforeseen code incompatibilities
 196  *    and occasional factors outside the authors&#39; control, version numbering
 197  *    on the library has not always been consistent and straightforward.
 198  *    The following table summarizes matters since version 0.89c, which was
 199  *    the first widely used release:
 200  *
 201  *    source                 png.h  png.h  shared-lib
 202  *    version                string   int  version
 203  *    -------                ------ -----  ----------
 204  *    0.89c &quot;1.0 beta 3&quot;     0.89      89  1.0.89
 205  *    0.90  &quot;1.0 beta 4&quot;     0.90      90  0.90  [should have been 2.0.90]
 206  *    0.95  &quot;1.0 beta 5&quot;     0.95      95  0.95  [should have been 2.0.95]
 207  *    0.96  &quot;1.0 beta 6&quot;     0.96      96  0.96  [should have been 2.0.96]
 208  *    0.97b &quot;1.00.97 beta 7&quot; 1.00.97   97  1.0.1 [should have been 2.0.97]
 209  *    0.97c                  0.97      97  2.0.97
 210  *    0.98                   0.98      98  2.0.98
 211  *    0.99                   0.99      98  2.0.99
 212  *    0.99a-m                0.99      99  2.0.99
 213  *    1.00                   1.00     100  2.1.0 [100 should be 10000]
 214  *    1.0.0      (from here on, the   100  2.1.0 [100 should be 10000]
 215  *    1.0.1       png.h string is   10001  2.1.0
 216  *    1.0.1a-e    identical to the  10002  from here on, the shared library
 217  *    1.0.2       source version)   10002  is 2.V where V is the source code
 218  *    1.0.2a-b                      10003  version, except as noted.
 219  *    1.0.3                         10003
 220  *    1.0.3a-d                      10004
 221  *    1.0.4                         10004
 222  *    1.0.4a-f                      10005
 223  *    1.0.5 (+ 2 patches)           10005
 224  *    1.0.5a-d                      10006
 225  *    1.0.5e-r                      10100 (not source compatible)
 226  *    1.0.5s-v                      10006 (not binary compatible)
 227  *    1.0.6 (+ 3 patches)           10006 (still binary incompatible)
 228  *    1.0.6d-f                      10007 (still binary incompatible)
 229  *    1.0.6g                        10007
 230  *    1.0.6h                        10007  10.6h (testing xy.z so-numbering)
 231  *    1.0.6i                        10007  10.6i
 232  *    1.0.6j                        10007  2.1.0.6j (incompatible with 1.0.0)
 233  *    1.0.7beta11-14        DLLNUM  10007  2.1.0.7beta11-14 (binary compatible)
 234  *    1.0.7beta15-18           1    10007  2.1.0.7beta15-18 (binary compatible)
 235  *    1.0.7rc1-2               1    10007  2.1.0.7rc1-2 (binary compatible)
 236  *    1.0.7                    1    10007  (still compatible)
 237  *    ...
<a name="26" id="anc26"></a><span class="line-modified"> 238  *    1.0.19                  10    10019  10.so.0.19[.0]</span>


 239  *    ...
<a name="27" id="anc27"></a><span class="line-modified"> 240  *    1.2.59                  13    10257  12.so.0.59[.0]</span>
 241  *    ...
<a name="28" id="anc28"></a><span class="line-modified"> 242  *    1.5.30                  15    10527  15.so.15.30[.0]</span>
 243  *    ...
<a name="29" id="anc29"></a><span class="line-modified"> 244  *    1.6.35                  16    10635  16.so.16.35[.0]</span>
<span class="line-modified"> 245  *</span>
<span class="line-modified"> 246  *    Henceforth the source version will match the shared-library major</span>
<span class="line-modified"> 247  *    and minor numbers; the shared-library major version number will be</span>
<span class="line-modified"> 248  *    used for changes in backward compatibility, as it is intended.  The</span>
<span class="line-modified"> 249  *    PNG_LIBPNG_VER macro, which is not used within libpng but is available</span>
<span class="line-modified"> 250  *    for applications, is an unsigned integer of the form xyyzz corresponding</span>
<span class="line-modified"> 251  *    to the source version x.y.z (leading zeros in y and z).  Beta versions</span>
<span class="line-modified"> 252  *    were given the previous public release number plus a letter, until</span>
<span class="line-modified"> 253  *    version 1.0.6j; from then on they were given the upcoming public</span>
<span class="line-modified"> 254  *    release number plus &quot;betaNN&quot; or &quot;rcNN&quot;.</span>
 255  *
 256  *    Binary incompatibility exists only when applications make direct access
 257  *    to the info_ptr or png_ptr members through png.h, and the compiled
 258  *    application is loaded with a different version of the library.
 259  *
 260  *    DLLNUM will change each time there are forward or backward changes
 261  *    in binary compatibility (e.g., when a new feature is added).
 262  *
 263  * See libpng.txt or libpng.3 for more information.  The PNG specification
<a name="30" id="anc30"></a><span class="line-modified"> 264  * is available as a W3C Recommendation and as an ISO Specification,</span>
<span class="line-modified"> 265  * &lt;https://www.w3.org/TR/2003/REC-PNG-20031110/</span>
<span class="line-removed"> 266  */</span>
<span class="line-removed"> 267 </span>
<span class="line-removed"> 268 /*</span>
<span class="line-removed"> 269  * Y2K compliance in libpng:</span>
<span class="line-removed"> 270  * =========================</span>
<span class="line-removed"> 271  *</span>
<span class="line-removed"> 272  *    July 15, 2018</span>
<span class="line-removed"> 273  *</span>
<span class="line-removed"> 274  *    Since the PNG Development group is an ad-hoc body, we can&#39;t make</span>
<span class="line-removed"> 275  *    an official declaration.</span>
<span class="line-removed"> 276  *</span>
<span class="line-removed"> 277  *    This is your unofficial assurance that libpng from version 0.71 and</span>
<span class="line-removed"> 278  *    upward through 1.6.35 are Y2K compliant.  It is my belief that</span>
<span class="line-removed"> 279  *    earlier versions were also Y2K compliant.</span>
<span class="line-removed"> 280  *</span>
<span class="line-removed"> 281  *    Libpng only has two year fields.  One is a 2-byte unsigned integer</span>
<span class="line-removed"> 282  *    that will hold years up to 65535.  The other, which is deprecated,</span>
<span class="line-removed"> 283  *    holds the date in text format, and will hold years up to 9999.</span>
<span class="line-removed"> 284  *</span>
<span class="line-removed"> 285  *    The integer is</span>
<span class="line-removed"> 286  *        &quot;png_uint_16 year&quot; in png_time_struct.</span>
<span class="line-removed"> 287  *</span>
<span class="line-removed"> 288  *    The string is</span>
<span class="line-removed"> 289  *        &quot;char time_buffer[29]&quot; in png_struct.  This is no longer used</span>
<span class="line-removed"> 290  *    in libpng-1.6.x and will be removed from libpng-1.7.0.</span>
<span class="line-removed"> 291  *</span>
<span class="line-removed"> 292  *    There are seven time-related functions:</span>
<span class="line-removed"> 293  *        png.c: png_convert_to_rfc_1123_buffer() in png.c</span>
<span class="line-removed"> 294  *          (formerly png_convert_to_rfc_1123() prior to libpng-1.5.x and</span>
<span class="line-removed"> 295  *          png_convert_to_rfc_1152() in error prior to libpng-0.98)</span>
<span class="line-removed"> 296  *        png_convert_from_struct_tm() in pngwrite.c, called in pngwrite.c</span>
<span class="line-removed"> 297  *        png_convert_from_time_t() in pngwrite.c</span>
<span class="line-removed"> 298  *        png_get_tIME() in pngget.c</span>
<span class="line-removed"> 299  *        png_handle_tIME() in pngrutil.c, called in pngread.c</span>
<span class="line-removed"> 300  *        png_set_tIME() in pngset.c</span>
<span class="line-removed"> 301  *        png_write_tIME() in pngwutil.c, called in pngwrite.c</span>
<span class="line-removed"> 302  *</span>
<span class="line-removed"> 303  *    All handle dates properly in a Y2K environment.  The</span>
<span class="line-removed"> 304  *    png_convert_from_time_t() function calls gmtime() to convert from system</span>
<span class="line-removed"> 305  *    clock time, which returns (year - 1900), which we properly convert to</span>
<span class="line-removed"> 306  *    the full 4-digit year.  There is a possibility that libpng applications</span>
<span class="line-removed"> 307  *    are not passing 4-digit years into the png_convert_to_rfc_1123_buffer()</span>
<span class="line-removed"> 308  *    function, or that they are incorrectly passing only a 2-digit year</span>
<span class="line-removed"> 309  *    instead of &quot;year - 1900&quot; into the png_convert_from_struct_tm() function,</span>
<span class="line-removed"> 310  *    but this is not under our control.  The libpng documentation has always</span>
<span class="line-removed"> 311  *    stated that it works with 4-digit years, and the APIs have been</span>
<span class="line-removed"> 312  *    documented as such.</span>
<span class="line-removed"> 313  *</span>
<span class="line-removed"> 314  *    The tIME chunk itself is also Y2K compliant.  It uses a 2-byte unsigned</span>
<span class="line-removed"> 315  *    integer to hold the year, and can hold years as large as 65535.</span>
<span class="line-removed"> 316  *</span>
<span class="line-removed"> 317  *    zlib, upon which libpng depends, is also Y2K compliant.  It contains</span>
<span class="line-removed"> 318  *    no date-related code.</span>
<span class="line-removed"> 319  *</span>
<span class="line-removed"> 320  *       Glenn Randers-Pehrson</span>
<span class="line-removed"> 321  *       libpng maintainer</span>
<span class="line-removed"> 322  *       PNG Development Group</span>
 323  */
 324 
 325 #ifndef PNG_H
 326 #define PNG_H
 327 
 328 /* This is not the place to learn how to use libpng. The file libpng-manual.txt
 329  * describes how to use libpng, and the file example.c summarizes it
 330  * with some code on which to build.  This file is useful for looking
 331  * at the actual function definitions and structure components.  If that
 332  * file has been stripped from your copy of libpng, you can find it at
 333  * &lt;http://www.libpng.org/pub/png/libpng-manual.txt&gt;
 334  *
 335  * If you just need to read a PNG file and don&#39;t want to read the documentation
 336  * skip to the end of this file and read the section entitled &#39;simplified API&#39;.
 337  */
 338 
 339 /* Version information for png.h - this should match the version in png.c */
<a name="31" id="anc31"></a><span class="line-modified"> 340 #define PNG_LIBPNG_VER_STRING &quot;1.6.35&quot;</span>
<span class="line-modified"> 341 #define PNG_HEADER_VERSION_STRING &quot; libpng version 1.6.35 - July 15, 2018\n&quot;</span>
 342 
 343 #define PNG_LIBPNG_VER_SONUM   16
 344 #define PNG_LIBPNG_VER_DLLNUM  16
 345 
 346 /* These should match the first 3 components of PNG_LIBPNG_VER_STRING: */
 347 #define PNG_LIBPNG_VER_MAJOR   1
 348 #define PNG_LIBPNG_VER_MINOR   6
<a name="32" id="anc32"></a><span class="line-modified"> 349 #define PNG_LIBPNG_VER_RELEASE 35</span>
 350 
<a name="33" id="anc33"></a><span class="line-modified"> 351 /* This should match the numeric part of the final component of</span>
<span class="line-modified"> 352  * PNG_LIBPNG_VER_STRING, omitting any leading zero:</span>
 353  */
<a name="34" id="anc34"></a><span class="line-modified"> 354 </span>
<span class="line-removed"> 355 #define PNG_LIBPNG_VER_BUILD  02</span>
 356 
 357 /* Release Status */
 358 #define PNG_LIBPNG_BUILD_ALPHA    1
 359 #define PNG_LIBPNG_BUILD_BETA     2
 360 #define PNG_LIBPNG_BUILD_RC       3
 361 #define PNG_LIBPNG_BUILD_STABLE   4
 362 #define PNG_LIBPNG_BUILD_RELEASE_STATUS_MASK 7
 363 
 364 /* Release-Specific Flags */
 365 #define PNG_LIBPNG_BUILD_PATCH    8 /* Can be OR&#39;ed with
 366                                        PNG_LIBPNG_BUILD_STABLE only */
 367 #define PNG_LIBPNG_BUILD_PRIVATE 16 /* Cannot be OR&#39;ed with
 368                                        PNG_LIBPNG_BUILD_SPECIAL */
 369 #define PNG_LIBPNG_BUILD_SPECIAL 32 /* Cannot be OR&#39;ed with
 370                                        PNG_LIBPNG_BUILD_PRIVATE */
 371 
<a name="35" id="anc35"></a><span class="line-modified"> 372 #define PNG_LIBPNG_BUILD_BASE_TYPE PNG_LIBPNG_BUILD_BETA</span>
 373 
<a name="36" id="anc36"></a><span class="line-modified"> 374 /* Careful here.  At one time, Guy wanted to use 082, but that would be octal.</span>
<span class="line-modified"> 375  * We must not include leading zeros.</span>
<span class="line-modified"> 376  * Versions 0.7 through 1.0.0 were in the range 0 to 100 here (only</span>
<span class="line-modified"> 377  * version 1.0.0 was mis-numbered 100 instead of 10000).  From</span>
<span class="line-modified"> 378  * version 1.0.1 it&#39;s    xxyyzz, where x=major, y=minor, z=release</span>

 379  */
<a name="37" id="anc37"></a><span class="line-modified"> 380 #define PNG_LIBPNG_VER 10635 /* 1.6.35 */</span>
 381 
 382 /* Library configuration: these options cannot be changed after
 383  * the library has been built.
 384  */
 385 #ifndef PNGLCONF_H
 386 /* If pnglibconf.h is missing, you can
 387  * copy scripts/pnglibconf.h.prebuilt to pnglibconf.h
 388  */
 389 #   include &quot;pnglibconf.h&quot;
 390 #endif
 391 
 392 #ifndef PNG_VERSION_INFO_ONLY
 393 /* Machine specific configuration. */
 394 #  include &quot;pngconf.h&quot;
 395 #endif
 396 
 397 /*
 398  * Added at libpng-1.2.8
 399  *
 400  * Ref MSDN: Private as priority over Special
 401  * VS_FF_PRIVATEBUILD File *was not* built using standard release
 402  * procedures. If this value is given, the StringFileInfo block must
 403  * contain a PrivateBuild string.
 404  *
 405  * VS_FF_SPECIALBUILD File *was* built by the original company using
 406  * standard release procedures but is a variation of the standard
 407  * file of the same version number. If this value is given, the
 408  * StringFileInfo block must contain a SpecialBuild string.
 409  */
 410 
 411 #ifdef PNG_USER_PRIVATEBUILD /* From pnglibconf.h */
 412 #  define PNG_LIBPNG_BUILD_TYPE \
 413        (PNG_LIBPNG_BUILD_BASE_TYPE | PNG_LIBPNG_BUILD_PRIVATE)
 414 #else
 415 #  ifdef PNG_LIBPNG_SPECIALBUILD
 416 #    define PNG_LIBPNG_BUILD_TYPE \
 417          (PNG_LIBPNG_BUILD_BASE_TYPE | PNG_LIBPNG_BUILD_SPECIAL)
 418 #  else
 419 #    define PNG_LIBPNG_BUILD_TYPE (PNG_LIBPNG_BUILD_BASE_TYPE)
 420 #  endif
 421 #endif
 422 
 423 #ifndef PNG_VERSION_INFO_ONLY
 424 
 425 /* Inhibit C++ name-mangling for libpng functions but not for system calls. */
 426 #ifdef __cplusplus
 427 extern &quot;C&quot; {
 428 #endif /* __cplusplus */
 429 
 430 /* Version information for C files, stored in png.c.  This had better match
 431  * the version above.
 432  */
 433 #define png_libpng_ver png_get_header_ver(NULL)
 434 
 435 /* This file is arranged in several sections:
 436  *
 437  * 1. [omitted]
 438  * 2. Any configuration options that can be specified by for the application
 439  *    code when it is built.  (Build time configuration is in pnglibconf.h)
 440  * 3. Type definitions (base types are defined in pngconf.h), structure
 441  *    definitions.
 442  * 4. Exported library functions.
 443  * 5. Simplified API.
 444  * 6. Implementation options.
 445  *
 446  * The library source code has additional files (principally pngpriv.h) that
 447  * allow configuration of the library.
 448  */
 449 
 450 /* Section 1: [omitted] */
 451 
 452 /* Section 2: run time configuration
 453  * See pnglibconf.h for build time configuration
 454  *
 455  * Run time configuration allows the application to choose between
 456  * implementations of certain arithmetic APIs.  The default is set
 457  * at build time and recorded in pnglibconf.h, but it is safe to
 458  * override these (and only these) settings.  Note that this won&#39;t
 459  * change what the library does, only application code, and the
 460  * settings can (and probably should) be made on a per-file basis
 461  * by setting the #defines before including png.h
 462  *
 463  * Use macros to read integers from PNG data or use the exported
 464  * functions?
 465  *   PNG_USE_READ_MACROS: use the macros (see below)  Note that
 466  *     the macros evaluate their argument multiple times.
 467  *   PNG_NO_USE_READ_MACROS: call the relevant library function.
 468  *
 469  * Use the alternative algorithm for compositing alpha samples that
 470  * does not use division?
 471  *   PNG_READ_COMPOSITE_NODIV_SUPPORTED: use the &#39;no division&#39;
 472  *      algorithm.
 473  *   PNG_NO_READ_COMPOSITE_NODIV: use the &#39;division&#39; algorithm.
 474  *
 475  * How to handle benign errors if PNG_ALLOW_BENIGN_ERRORS is
 476  * false?
 477  *   PNG_ALLOW_BENIGN_ERRORS: map calls to the benign error
 478  *      APIs to png_warning.
 479  * Otherwise the calls are mapped to png_error.
 480  */
 481 
 482 /* Section 3: type definitions, including structures and compile time
 483  * constants.
 484  * See pngconf.h for base types that vary by machine/system
 485  */
 486 
 487 /* This triggers a compiler error in png.c, if png.c and png.h
 488  * do not agree upon the version number.
 489  */
<a name="38" id="anc38"></a><span class="line-modified"> 490 typedef char* png_libpng_version_1_6_35;</span>
 491 
 492 /* Basic control structions.  Read libpng-manual.txt or libpng.3 for more info.
 493  *
 494  * png_struct is the cache of information used while reading or writing a single
 495  * PNG file.  One of these is always required, although the simplified API
 496  * (below) hides the creation and destruction of it.
 497  */
 498 typedef struct png_struct_def png_struct;
 499 typedef const png_struct * png_const_structp;
 500 typedef png_struct * png_structp;
 501 typedef png_struct * * png_structpp;
 502 
 503 /* png_info contains information read from or to be written to a PNG file.  One
 504  * or more of these must exist while reading or creating a PNG file.  The
 505  * information is not used by libpng during read but is used to control what
 506  * gets written when a PNG file is created.  &quot;png_get_&quot; function calls read
 507  * information during read and &quot;png_set_&quot; functions calls write information
 508  * when creating a PNG.
 509  * been moved into a separate header file that is not accessible to
 510  * applications.  Read libpng-manual.txt or libpng.3 for more info.
 511  */
 512 typedef struct png_info_def png_info;
 513 typedef png_info * png_infop;
 514 typedef const png_info * png_const_infop;
 515 typedef png_info * * png_infopp;
 516 
 517 /* Types with names ending &#39;p&#39; are pointer types.  The corresponding types with
 518  * names ending &#39;rp&#39; are identical pointer types except that the pointer is
 519  * marked &#39;restrict&#39;, which means that it is the only pointer to the object
 520  * passed to the function.  Applications should not use the &#39;restrict&#39; types;
 521  * it is always valid to pass &#39;p&#39; to a pointer with a function argument of the
 522  * corresponding &#39;rp&#39; type.  Different compilers have different rules with
 523  * regard to type matching in the presence of &#39;restrict&#39;.  For backward
 524  * compatibility libpng callbacks never have &#39;restrict&#39; in their parameters and,
 525  * consequentially, writing portable application code is extremely difficult if
 526  * an attempt is made to use &#39;restrict&#39;.
 527  */
 528 typedef png_struct * PNG_RESTRICT png_structrp;
 529 typedef const png_struct * PNG_RESTRICT png_const_structrp;
 530 typedef png_info * PNG_RESTRICT png_inforp;
 531 typedef const png_info * PNG_RESTRICT png_const_inforp;
 532 
 533 /* Three color definitions.  The order of the red, green, and blue, (and the
 534  * exact size) is not important, although the size of the fields need to
 535  * be png_byte or png_uint_16 (as defined below).
 536  */
 537 typedef struct png_color_struct
 538 {
 539    png_byte red;
 540    png_byte green;
 541    png_byte blue;
 542 } png_color;
 543 typedef png_color * png_colorp;
 544 typedef const png_color * png_const_colorp;
 545 typedef png_color * * png_colorpp;
 546 
 547 typedef struct png_color_16_struct
 548 {
 549    png_byte index;    /* used for palette files */
 550    png_uint_16 red;   /* for use in red green blue files */
 551    png_uint_16 green;
 552    png_uint_16 blue;
 553    png_uint_16 gray;  /* for use in grayscale files */
 554 } png_color_16;
 555 typedef png_color_16 * png_color_16p;
 556 typedef const png_color_16 * png_const_color_16p;
 557 typedef png_color_16 * * png_color_16pp;
 558 
 559 typedef struct png_color_8_struct
 560 {
 561    png_byte red;   /* for use in red green blue files */
 562    png_byte green;
 563    png_byte blue;
 564    png_byte gray;  /* for use in grayscale files */
 565    png_byte alpha; /* for alpha channel files */
 566 } png_color_8;
 567 typedef png_color_8 * png_color_8p;
 568 typedef const png_color_8 * png_const_color_8p;
 569 typedef png_color_8 * * png_color_8pp;
 570 
 571 /*
 572  * The following two structures are used for the in-core representation
 573  * of sPLT chunks.
 574  */
 575 typedef struct png_sPLT_entry_struct
 576 {
 577    png_uint_16 red;
 578    png_uint_16 green;
 579    png_uint_16 blue;
 580    png_uint_16 alpha;
 581    png_uint_16 frequency;
 582 } png_sPLT_entry;
 583 typedef png_sPLT_entry * png_sPLT_entryp;
 584 typedef const png_sPLT_entry * png_const_sPLT_entryp;
 585 typedef png_sPLT_entry * * png_sPLT_entrypp;
 586 
 587 /*  When the depth of the sPLT palette is 8 bits, the color and alpha samples
 588  *  occupy the LSB of their respective members, and the MSB of each member
 589  *  is zero-filled.  The frequency member always occupies the full 16 bits.
 590  */
 591 
 592 typedef struct png_sPLT_struct
 593 {
 594    png_charp name;           /* palette name */
 595    png_byte depth;           /* depth of palette samples */
 596    png_sPLT_entryp entries;  /* palette entries */
 597    png_int_32 nentries;      /* number of palette entries */
 598 } png_sPLT_t;
 599 typedef png_sPLT_t * png_sPLT_tp;
 600 typedef const png_sPLT_t * png_const_sPLT_tp;
 601 typedef png_sPLT_t * * png_sPLT_tpp;
 602 
 603 #ifdef PNG_TEXT_SUPPORTED
 604 /* png_text holds the contents of a text/ztxt/itxt chunk in a PNG file,
 605  * and whether that contents is compressed or not.  The &quot;key&quot; field
 606  * points to a regular zero-terminated C string.  The &quot;text&quot; fields can be a
 607  * regular C string, an empty string, or a NULL pointer.
 608  * However, the structure returned by png_get_text() will always contain
 609  * the &quot;text&quot; field as a regular zero-terminated C string (possibly
 610  * empty), never a NULL pointer, so it can be safely used in printf() and
 611  * other string-handling functions.  Note that the &quot;itxt_length&quot;, &quot;lang&quot;, and
 612  * &quot;lang_key&quot; members of the structure only exist when the library is built
 613  * with iTXt chunk support.  Prior to libpng-1.4.0 the library was built by
 614  * default without iTXt support. Also note that when iTXt *is* supported,
 615  * the &quot;lang&quot; and &quot;lang_key&quot; fields contain NULL pointers when the
 616  * &quot;compression&quot; field contains * PNG_TEXT_COMPRESSION_NONE or
 617  * PNG_TEXT_COMPRESSION_zTXt. Note that the &quot;compression value&quot; is not the
 618  * same as what appears in the PNG tEXt/zTXt/iTXt chunk&#39;s &quot;compression flag&quot;
 619  * which is always 0 or 1, or its &quot;compression method&quot; which is always 0.
 620  */
 621 typedef struct png_text_struct
 622 {
 623    int  compression;       /* compression value:
 624                              -1: tEXt, none
 625                               0: zTXt, deflate
 626                               1: iTXt, none
 627                               2: iTXt, deflate  */
 628    png_charp key;          /* keyword, 1-79 character description of &quot;text&quot; */
 629    png_charp text;         /* comment, may be an empty string (ie &quot;&quot;)
 630                               or a NULL pointer */
 631    size_t text_length;     /* length of the text string */
 632    size_t itxt_length;     /* length of the itxt string */
 633    png_charp lang;         /* language code, 0-79 characters
 634                               or a NULL pointer */
 635    png_charp lang_key;     /* keyword translated UTF-8 string, 0 or more
 636                               chars or a NULL pointer */
 637 } png_text;
 638 typedef png_text * png_textp;
 639 typedef const png_text * png_const_textp;
 640 typedef png_text * * png_textpp;
 641 #endif
 642 
 643 /* Supported compression types for text in PNG files (tEXt, and zTXt).
 644  * The values of the PNG_TEXT_COMPRESSION_ defines should NOT be changed. */
 645 #define PNG_TEXT_COMPRESSION_NONE_WR -3
 646 #define PNG_TEXT_COMPRESSION_zTXt_WR -2
 647 #define PNG_TEXT_COMPRESSION_NONE    -1
 648 #define PNG_TEXT_COMPRESSION_zTXt     0
 649 #define PNG_ITXT_COMPRESSION_NONE     1
 650 #define PNG_ITXT_COMPRESSION_zTXt     2
 651 #define PNG_TEXT_COMPRESSION_LAST     3  /* Not a valid value */
 652 
 653 /* png_time is a way to hold the time in an machine independent way.
 654  * Two conversions are provided, both from time_t and struct tm.  There
 655  * is no portable way to convert to either of these structures, as far
 656  * as I know.  If you know of a portable way, send it to me.  As a side
 657  * note - PNG has always been Year 2000 compliant!
 658  */
 659 typedef struct png_time_struct
 660 {
 661    png_uint_16 year; /* full year, as in, 1995 */
 662    png_byte month;   /* month of year, 1 - 12 */
 663    png_byte day;     /* day of month, 1 - 31 */
 664    png_byte hour;    /* hour of day, 0 - 23 */
 665    png_byte minute;  /* minute of hour, 0 - 59 */
 666    png_byte second;  /* second of minute, 0 - 60 (for leap seconds) */
 667 } png_time;
 668 typedef png_time * png_timep;
 669 typedef const png_time * png_const_timep;
 670 typedef png_time * * png_timepp;
 671 
 672 #if defined(PNG_STORE_UNKNOWN_CHUNKS_SUPPORTED) ||\
 673    defined(PNG_USER_CHUNKS_SUPPORTED)
 674 /* png_unknown_chunk is a structure to hold queued chunks for which there is
 675  * no specific support.  The idea is that we can use this to queue
 676  * up private chunks for output even though the library doesn&#39;t actually
 677  * know about their semantics.
 678  *
 679  * The data in the structure is set by libpng on read and used on write.
 680  */
 681 typedef struct png_unknown_chunk_t
 682 {
 683    png_byte name[5]; /* Textual chunk name with &#39;\0&#39; terminator */
 684    png_byte *data;   /* Data, should not be modified on read! */
 685    size_t size;
 686 
 687    /* On write &#39;location&#39; must be set using the flag values listed below.
 688     * Notice that on read it is set by libpng however the values stored have
 689     * more bits set than are listed below.  Always treat the value as a
 690     * bitmask.  On write set only one bit - setting multiple bits may cause the
 691     * chunk to be written in multiple places.
 692     */
 693    png_byte location; /* mode of operation at read time */
 694 }
 695 png_unknown_chunk;
 696 
 697 typedef png_unknown_chunk * png_unknown_chunkp;
 698 typedef const png_unknown_chunk * png_const_unknown_chunkp;
 699 typedef png_unknown_chunk * * png_unknown_chunkpp;
 700 #endif
 701 
 702 /* Flag values for the unknown chunk location byte. */
 703 #define PNG_HAVE_IHDR  0x01
 704 #define PNG_HAVE_PLTE  0x02
 705 #define PNG_AFTER_IDAT 0x08
 706 
 707 /* Maximum positive integer used in PNG is (2^31)-1 */
 708 #define PNG_UINT_31_MAX ((png_uint_32)0x7fffffffL)
 709 #define PNG_UINT_32_MAX ((png_uint_32)(-1))
 710 #define PNG_SIZE_MAX ((size_t)(-1))
 711 
 712 /* These are constants for fixed point values encoded in the
 713  * PNG specification manner (x100000)
 714  */
 715 #define PNG_FP_1    100000
 716 #define PNG_FP_HALF  50000
 717 #define PNG_FP_MAX  ((png_fixed_point)0x7fffffffL)
 718 #define PNG_FP_MIN  (-PNG_FP_MAX)
 719 
 720 /* These describe the color_type field in png_info. */
 721 /* color type masks */
 722 #define PNG_COLOR_MASK_PALETTE    1
 723 #define PNG_COLOR_MASK_COLOR      2
 724 #define PNG_COLOR_MASK_ALPHA      4
 725 
 726 /* color types.  Note that not all combinations are legal */
 727 #define PNG_COLOR_TYPE_GRAY 0
 728 #define PNG_COLOR_TYPE_PALETTE  (PNG_COLOR_MASK_COLOR | PNG_COLOR_MASK_PALETTE)
 729 #define PNG_COLOR_TYPE_RGB        (PNG_COLOR_MASK_COLOR)
 730 #define PNG_COLOR_TYPE_RGB_ALPHA  (PNG_COLOR_MASK_COLOR | PNG_COLOR_MASK_ALPHA)
 731 #define PNG_COLOR_TYPE_GRAY_ALPHA (PNG_COLOR_MASK_ALPHA)
 732 /* aliases */
 733 #define PNG_COLOR_TYPE_RGBA  PNG_COLOR_TYPE_RGB_ALPHA
 734 #define PNG_COLOR_TYPE_GA  PNG_COLOR_TYPE_GRAY_ALPHA
 735 
 736 /* This is for compression type. PNG 1.0-1.2 only define the single type. */
 737 #define PNG_COMPRESSION_TYPE_BASE 0 /* Deflate method 8, 32K window */
 738 #define PNG_COMPRESSION_TYPE_DEFAULT PNG_COMPRESSION_TYPE_BASE
 739 
 740 /* This is for filter type. PNG 1.0-1.2 only define the single type. */
 741 #define PNG_FILTER_TYPE_BASE      0 /* Single row per-byte filtering */
 742 #define PNG_INTRAPIXEL_DIFFERENCING 64 /* Used only in MNG datastreams */
 743 #define PNG_FILTER_TYPE_DEFAULT   PNG_FILTER_TYPE_BASE
 744 
 745 /* These are for the interlacing type.  These values should NOT be changed. */
 746 #define PNG_INTERLACE_NONE        0 /* Non-interlaced image */
 747 #define PNG_INTERLACE_ADAM7       1 /* Adam7 interlacing */
 748 #define PNG_INTERLACE_LAST        2 /* Not a valid value */
 749 
 750 /* These are for the oFFs chunk.  These values should NOT be changed. */
 751 #define PNG_OFFSET_PIXEL          0 /* Offset in pixels */
 752 #define PNG_OFFSET_MICROMETER     1 /* Offset in micrometers (1/10^6 meter) */
 753 #define PNG_OFFSET_LAST           2 /* Not a valid value */
 754 
 755 /* These are for the pCAL chunk.  These values should NOT be changed. */
 756 #define PNG_EQUATION_LINEAR       0 /* Linear transformation */
 757 #define PNG_EQUATION_BASE_E       1 /* Exponential base e transform */
 758 #define PNG_EQUATION_ARBITRARY    2 /* Arbitrary base exponential transform */
 759 #define PNG_EQUATION_HYPERBOLIC   3 /* Hyperbolic sine transformation */
 760 #define PNG_EQUATION_LAST         4 /* Not a valid value */
 761 
 762 /* These are for the sCAL chunk.  These values should NOT be changed. */
 763 #define PNG_SCALE_UNKNOWN         0 /* unknown unit (image scale) */
 764 #define PNG_SCALE_METER           1 /* meters per pixel */
 765 #define PNG_SCALE_RADIAN          2 /* radians per pixel */
 766 #define PNG_SCALE_LAST            3 /* Not a valid value */
 767 
 768 /* These are for the pHYs chunk.  These values should NOT be changed. */
 769 #define PNG_RESOLUTION_UNKNOWN    0 /* pixels/unknown unit (aspect ratio) */
 770 #define PNG_RESOLUTION_METER      1 /* pixels/meter */
 771 #define PNG_RESOLUTION_LAST       2 /* Not a valid value */
 772 
 773 /* These are for the sRGB chunk.  These values should NOT be changed. */
 774 #define PNG_sRGB_INTENT_PERCEPTUAL 0
 775 #define PNG_sRGB_INTENT_RELATIVE   1
 776 #define PNG_sRGB_INTENT_SATURATION 2
 777 #define PNG_sRGB_INTENT_ABSOLUTE   3
 778 #define PNG_sRGB_INTENT_LAST       4 /* Not a valid value */
 779 
 780 /* This is for text chunks */
 781 #define PNG_KEYWORD_MAX_LENGTH     79
 782 
 783 /* Maximum number of entries in PLTE/sPLT/tRNS arrays */
 784 #define PNG_MAX_PALETTE_LENGTH    256
 785 
 786 /* These determine if an ancillary chunk&#39;s data has been successfully read
 787  * from the PNG header, or if the application has filled in the corresponding
 788  * data in the info_struct to be written into the output file.  The values
 789  * of the PNG_INFO_&lt;chunk&gt; defines should NOT be changed.
 790  */
 791 #define PNG_INFO_gAMA 0x0001U
 792 #define PNG_INFO_sBIT 0x0002U
 793 #define PNG_INFO_cHRM 0x0004U
 794 #define PNG_INFO_PLTE 0x0008U
 795 #define PNG_INFO_tRNS 0x0010U
 796 #define PNG_INFO_bKGD 0x0020U
 797 #define PNG_INFO_hIST 0x0040U
 798 #define PNG_INFO_pHYs 0x0080U
 799 #define PNG_INFO_oFFs 0x0100U
 800 #define PNG_INFO_tIME 0x0200U
 801 #define PNG_INFO_pCAL 0x0400U
 802 #define PNG_INFO_sRGB 0x0800U  /* GR-P, 0.96a */
 803 #define PNG_INFO_iCCP 0x1000U  /* ESR, 1.0.6 */
 804 #define PNG_INFO_sPLT 0x2000U  /* ESR, 1.0.6 */
 805 #define PNG_INFO_sCAL 0x4000U  /* ESR, 1.0.6 */
 806 #define PNG_INFO_IDAT 0x8000U  /* ESR, 1.0.6 */
 807 #define PNG_INFO_eXIf 0x10000U /* GR-P, 1.6.31 */
 808 
 809 /* This is used for the transformation routines, as some of them
 810  * change these values for the row.  It also should enable using
 811  * the routines for other purposes.
 812  */
 813 typedef struct png_row_info_struct
 814 {
 815    png_uint_32 width;    /* width of row */
 816    size_t rowbytes;      /* number of bytes in row */
 817    png_byte color_type;  /* color type of row */
 818    png_byte bit_depth;   /* bit depth of row */
 819    png_byte channels;    /* number of channels (1, 2, 3, or 4) */
 820    png_byte pixel_depth; /* bits per pixel (depth * channels) */
 821 } png_row_info;
 822 
 823 typedef png_row_info * png_row_infop;
 824 typedef png_row_info * * png_row_infopp;
 825 
 826 /* These are the function types for the I/O functions and for the functions
 827  * that allow the user to override the default I/O functions with his or her
 828  * own.  The png_error_ptr type should match that of user-supplied warning
 829  * and error functions, while the png_rw_ptr type should match that of the
 830  * user read/write data functions.  Note that the &#39;write&#39; function must not
 831  * modify the buffer it is passed. The &#39;read&#39; function, on the other hand, is
 832  * expected to return the read data in the buffer.
 833  */
 834 typedef PNG_CALLBACK(void, *png_error_ptr, (png_structp, png_const_charp));
 835 typedef PNG_CALLBACK(void, *png_rw_ptr, (png_structp, png_bytep, size_t));
 836 typedef PNG_CALLBACK(void, *png_flush_ptr, (png_structp));
 837 typedef PNG_CALLBACK(void, *png_read_status_ptr, (png_structp, png_uint_32,
 838     int));
 839 typedef PNG_CALLBACK(void, *png_write_status_ptr, (png_structp, png_uint_32,
 840     int));
 841 
 842 #ifdef PNG_PROGRESSIVE_READ_SUPPORTED
 843 typedef PNG_CALLBACK(void, *png_progressive_info_ptr, (png_structp, png_infop));
 844 typedef PNG_CALLBACK(void, *png_progressive_end_ptr, (png_structp, png_infop));
 845 
 846 /* The following callback receives png_uint_32 row_number, int pass for the
 847  * png_bytep data of the row.  When transforming an interlaced image the
 848  * row number is the row number within the sub-image of the interlace pass, so
 849  * the value will increase to the height of the sub-image (not the full image)
 850  * then reset to 0 for the next pass.
 851  *
 852  * Use PNG_ROW_FROM_PASS_ROW(row, pass) and PNG_COL_FROM_PASS_COL(col, pass) to
 853  * find the output pixel (x,y) given an interlaced sub-image pixel
 854  * (row,col,pass).  (See below for these macros.)
 855  */
 856 typedef PNG_CALLBACK(void, *png_progressive_row_ptr, (png_structp, png_bytep,
 857     png_uint_32, int));
 858 #endif
 859 
 860 #if defined(PNG_READ_USER_TRANSFORM_SUPPORTED) || \
 861     defined(PNG_WRITE_USER_TRANSFORM_SUPPORTED)
 862 typedef PNG_CALLBACK(void, *png_user_transform_ptr, (png_structp, png_row_infop,
 863     png_bytep));
 864 #endif
 865 
 866 #ifdef PNG_USER_CHUNKS_SUPPORTED
 867 typedef PNG_CALLBACK(int, *png_user_chunk_ptr, (png_structp,
 868     png_unknown_chunkp));
 869 #endif
 870 #ifdef PNG_UNKNOWN_CHUNKS_SUPPORTED
 871 /* not used anywhere */
 872 /* typedef PNG_CALLBACK(void, *png_unknown_chunk_ptr, (png_structp)); */
 873 #endif
 874 
 875 #ifdef PNG_SETJMP_SUPPORTED
 876 /* This must match the function definition in &lt;setjmp.h&gt;, and the application
 877  * must include this before png.h to obtain the definition of jmp_buf.  The
 878  * function is required to be PNG_NORETURN, but this is not checked.  If the
 879  * function does return the application will crash via an abort() or similar
 880  * system level call.
 881  *
 882  * If you get a warning here while building the library you may need to make
 883  * changes to ensure that pnglibconf.h records the calling convention used by
 884  * your compiler.  This may be very difficult - try using a different compiler
 885  * to build the library!
 886  */
 887 PNG_FUNCTION(void, (PNGCAPI *png_longjmp_ptr), PNGARG((jmp_buf, int)), typedef);
 888 #endif
 889 
 890 /* Transform masks for the high-level interface */
 891 #define PNG_TRANSFORM_IDENTITY       0x0000    /* read and write */
 892 #define PNG_TRANSFORM_STRIP_16       0x0001    /* read only */
 893 #define PNG_TRANSFORM_STRIP_ALPHA    0x0002    /* read only */
 894 #define PNG_TRANSFORM_PACKING        0x0004    /* read and write */
 895 #define PNG_TRANSFORM_PACKSWAP       0x0008    /* read and write */
 896 #define PNG_TRANSFORM_EXPAND         0x0010    /* read only */
 897 #define PNG_TRANSFORM_INVERT_MONO    0x0020    /* read and write */
 898 #define PNG_TRANSFORM_SHIFT          0x0040    /* read and write */
 899 #define PNG_TRANSFORM_BGR            0x0080    /* read and write */
 900 #define PNG_TRANSFORM_SWAP_ALPHA     0x0100    /* read and write */
 901 #define PNG_TRANSFORM_SWAP_ENDIAN    0x0200    /* read and write */
 902 #define PNG_TRANSFORM_INVERT_ALPHA   0x0400    /* read and write */
 903 #define PNG_TRANSFORM_STRIP_FILLER   0x0800    /* write only */
 904 /* Added to libpng-1.2.34 */
 905 #define PNG_TRANSFORM_STRIP_FILLER_BEFORE PNG_TRANSFORM_STRIP_FILLER
 906 #define PNG_TRANSFORM_STRIP_FILLER_AFTER 0x1000 /* write only */
 907 /* Added to libpng-1.4.0 */
 908 #define PNG_TRANSFORM_GRAY_TO_RGB   0x2000      /* read only */
 909 /* Added to libpng-1.5.4 */
 910 #define PNG_TRANSFORM_EXPAND_16     0x4000      /* read only */
 911 #if INT_MAX &gt;= 0x8000 /* else this might break */
 912 #define PNG_TRANSFORM_SCALE_16      0x8000      /* read only */
 913 #endif
 914 
 915 /* Flags for MNG supported features */
 916 #define PNG_FLAG_MNG_EMPTY_PLTE     0x01
 917 #define PNG_FLAG_MNG_FILTER_64      0x04
 918 #define PNG_ALL_MNG_FEATURES        0x05
 919 
 920 /* NOTE: prior to 1.5 these functions had no &#39;API&#39; style declaration,
 921  * this allowed the zlib default functions to be used on Windows
 922  * platforms.  In 1.5 the zlib default malloc (which just calls malloc and
 923  * ignores the first argument) should be completely compatible with the
 924  * following.
 925  */
 926 typedef PNG_CALLBACK(png_voidp, *png_malloc_ptr, (png_structp,
 927     png_alloc_size_t));
 928 typedef PNG_CALLBACK(void, *png_free_ptr, (png_structp, png_voidp));
 929 
 930 /* Section 4: exported functions
 931  * Here are the function definitions most commonly used.  This is not
 932  * the place to find out how to use libpng.  See libpng-manual.txt for the
 933  * full explanation, see example.c for the summary.  This just provides
 934  * a simple one line description of the use of each function.
 935  *
 936  * The PNG_EXPORT() and PNG_EXPORTA() macros used below are defined in
 937  * pngconf.h and in the *.dfn files in the scripts directory.
 938  *
 939  *   PNG_EXPORT(ordinal, type, name, (args));
 940  *
 941  *       ordinal:    ordinal that is used while building
 942  *                   *.def files. The ordinal value is only
 943  *                   relevant when preprocessing png.h with
 944  *                   the *.dfn files for building symbol table
 945  *                   entries, and are removed by pngconf.h.
 946  *       type:       return type of the function
 947  *       name:       function name
 948  *       args:       function arguments, with types
 949  *
 950  * When we wish to append attributes to a function prototype we use
 951  * the PNG_EXPORTA() macro instead.
 952  *
 953  *   PNG_EXPORTA(ordinal, type, name, (args), attributes);
 954  *
 955  *       ordinal, type, name, and args: same as in PNG_EXPORT().
 956  *       attributes: function attributes
 957  */
 958 
 959 /* Returns the version number of the library */
 960 PNG_EXPORT(1, png_uint_32, png_access_version_number, (void));
 961 
 962 /* Tell lib we have already handled the first &lt;num_bytes&gt; magic bytes.
 963  * Handling more than 8 bytes from the beginning of the file is an error.
 964  */
 965 PNG_EXPORT(2, void, png_set_sig_bytes, (png_structrp png_ptr, int num_bytes));
 966 
 967 /* Check sig[start] through sig[start + num_to_check - 1] to see if it&#39;s a
 968  * PNG file.  Returns zero if the supplied bytes match the 8-byte PNG
 969  * signature, and non-zero otherwise.  Having num_to_check == 0 or
 970  * start &gt; 7 will always fail (ie return non-zero).
 971  */
 972 PNG_EXPORT(3, int, png_sig_cmp, (png_const_bytep sig, size_t start,
 973     size_t num_to_check));
 974 
 975 /* Simple signature checking function.  This is the same as calling
 976  * png_check_sig(sig, n) := !png_sig_cmp(sig, 0, n).
 977  */
 978 #define png_check_sig(sig, n) !png_sig_cmp((sig), 0, (n))
 979 
 980 /* Allocate and initialize png_ptr struct for reading, and any other memory. */
 981 PNG_EXPORTA(4, png_structp, png_create_read_struct,
 982     (png_const_charp user_png_ver, png_voidp error_ptr,
 983     png_error_ptr error_fn, png_error_ptr warn_fn),
 984     PNG_ALLOCATED);
 985 
 986 /* Allocate and initialize png_ptr struct for writing, and any other memory */
 987 PNG_EXPORTA(5, png_structp, png_create_write_struct,
 988     (png_const_charp user_png_ver, png_voidp error_ptr, png_error_ptr error_fn,
 989     png_error_ptr warn_fn),
 990     PNG_ALLOCATED);
 991 
 992 PNG_EXPORT(6, size_t, png_get_compression_buffer_size,
 993     (png_const_structrp png_ptr));
 994 
 995 PNG_EXPORT(7, void, png_set_compression_buffer_size, (png_structrp png_ptr,
 996     size_t size));
 997 
 998 /* Moved from pngconf.h in 1.4.0 and modified to ensure setjmp/longjmp
 999  * match up.
1000  */
1001 #ifdef PNG_SETJMP_SUPPORTED
1002 /* This function returns the jmp_buf built in to *png_ptr.  It must be
1003  * supplied with an appropriate &#39;longjmp&#39; function to use on that jmp_buf
1004  * unless the default error function is overridden in which case NULL is
1005  * acceptable.  The size of the jmp_buf is checked against the actual size
1006  * allocated by the library - the call will return NULL on a mismatch
1007  * indicating an ABI mismatch.
1008  */
1009 PNG_EXPORT(8, jmp_buf*, png_set_longjmp_fn, (png_structrp png_ptr,
1010     png_longjmp_ptr longjmp_fn, size_t jmp_buf_size));
1011 #  define png_jmpbuf(png_ptr) \
1012       (*png_set_longjmp_fn((png_ptr), longjmp, (sizeof (jmp_buf))))
1013 #else
1014 #  define png_jmpbuf(png_ptr) \
1015       (LIBPNG_WAS_COMPILED_WITH__PNG_NO_SETJMP)
1016 #endif
1017 /* This function should be used by libpng applications in place of
1018  * longjmp(png_ptr-&gt;jmpbuf, val).  If longjmp_fn() has been set, it
1019  * will use it; otherwise it will call PNG_ABORT().  This function was
1020  * added in libpng-1.5.0.
1021  */
1022 PNG_EXPORTA(9, void, png_longjmp, (png_const_structrp png_ptr, int val),
1023     PNG_NORETURN);
1024 
1025 #ifdef PNG_READ_SUPPORTED
1026 /* Reset the compression stream */
1027 PNG_EXPORTA(10, int, png_reset_zstream, (png_structrp png_ptr), PNG_DEPRECATED);
1028 #endif
1029 
1030 /* New functions added in libpng-1.0.2 (not enabled by default until 1.2.0) */
1031 #ifdef PNG_USER_MEM_SUPPORTED
1032 PNG_EXPORTA(11, png_structp, png_create_read_struct_2,
1033     (png_const_charp user_png_ver, png_voidp error_ptr, png_error_ptr error_fn,
1034     png_error_ptr warn_fn,
1035     png_voidp mem_ptr, png_malloc_ptr malloc_fn, png_free_ptr free_fn),
1036     PNG_ALLOCATED);
1037 PNG_EXPORTA(12, png_structp, png_create_write_struct_2,
1038     (png_const_charp user_png_ver, png_voidp error_ptr, png_error_ptr error_fn,
1039     png_error_ptr warn_fn,
1040     png_voidp mem_ptr, png_malloc_ptr malloc_fn, png_free_ptr free_fn),
1041     PNG_ALLOCATED);
1042 #endif
1043 
1044 /* Write the PNG file signature. */
1045 PNG_EXPORT(13, void, png_write_sig, (png_structrp png_ptr));
1046 
1047 /* Write a PNG chunk - size, type, (optional) data, CRC. */
1048 PNG_EXPORT(14, void, png_write_chunk, (png_structrp png_ptr, png_const_bytep
1049     chunk_name, png_const_bytep data, size_t length));
1050 
1051 /* Write the start of a PNG chunk - length and chunk name. */
1052 PNG_EXPORT(15, void, png_write_chunk_start, (png_structrp png_ptr,
1053     png_const_bytep chunk_name, png_uint_32 length));
1054 
1055 /* Write the data of a PNG chunk started with png_write_chunk_start(). */
1056 PNG_EXPORT(16, void, png_write_chunk_data, (png_structrp png_ptr,
1057     png_const_bytep data, size_t length));
1058 
1059 /* Finish a chunk started with png_write_chunk_start() (includes CRC). */
1060 PNG_EXPORT(17, void, png_write_chunk_end, (png_structrp png_ptr));
1061 
1062 /* Allocate and initialize the info structure */
1063 PNG_EXPORTA(18, png_infop, png_create_info_struct, (png_const_structrp png_ptr),
1064     PNG_ALLOCATED);
1065 
1066 /* DEPRECATED: this function allowed init structures to be created using the
1067  * default allocation method (typically malloc).  Use is deprecated in 1.6.0 and
1068  * the API will be removed in the future.
1069  */
1070 PNG_EXPORTA(19, void, png_info_init_3, (png_infopp info_ptr,
1071     size_t png_info_struct_size), PNG_DEPRECATED);
1072 
1073 /* Writes all the PNG information before the image. */
1074 PNG_EXPORT(20, void, png_write_info_before_PLTE,
1075     (png_structrp png_ptr, png_const_inforp info_ptr));
1076 PNG_EXPORT(21, void, png_write_info,
1077     (png_structrp png_ptr, png_const_inforp info_ptr));
1078 
1079 #ifdef PNG_SEQUENTIAL_READ_SUPPORTED
1080 /* Read the information before the actual image data. */
1081 PNG_EXPORT(22, void, png_read_info,
1082     (png_structrp png_ptr, png_inforp info_ptr));
1083 #endif
1084 
1085 #ifdef PNG_TIME_RFC1123_SUPPORTED
1086    /* Convert to a US string format: there is no localization support in this
1087     * routine.  The original implementation used a 29 character buffer in
1088     * png_struct, this will be removed in future versions.
1089     */
1090 #if PNG_LIBPNG_VER &lt; 10700
1091 /* To do: remove this from libpng17 (and from libpng17/png.c and pngstruct.h) */
1092 PNG_EXPORTA(23, png_const_charp, png_convert_to_rfc1123, (png_structrp png_ptr,
1093     png_const_timep ptime),PNG_DEPRECATED);
1094 #endif
1095 PNG_EXPORT(241, int, png_convert_to_rfc1123_buffer, (char out[29],
1096     png_const_timep ptime));
1097 #endif
1098 
1099 #ifdef PNG_CONVERT_tIME_SUPPORTED
1100 /* Convert from a struct tm to png_time */
1101 PNG_EXPORT(24, void, png_convert_from_struct_tm, (png_timep ptime,
1102     const struct tm * ttime));
1103 
1104 /* Convert from time_t to png_time.  Uses gmtime() */
1105 PNG_EXPORT(25, void, png_convert_from_time_t, (png_timep ptime, time_t ttime));
1106 #endif /* CONVERT_tIME */
1107 
1108 #ifdef PNG_READ_EXPAND_SUPPORTED
1109 /* Expand data to 24-bit RGB, or 8-bit grayscale, with alpha if available. */
1110 PNG_EXPORT(26, void, png_set_expand, (png_structrp png_ptr));
1111 PNG_EXPORT(27, void, png_set_expand_gray_1_2_4_to_8, (png_structrp png_ptr));
1112 PNG_EXPORT(28, void, png_set_palette_to_rgb, (png_structrp png_ptr));
1113 PNG_EXPORT(29, void, png_set_tRNS_to_alpha, (png_structrp png_ptr));
1114 #endif
1115 
1116 #ifdef PNG_READ_EXPAND_16_SUPPORTED
1117 /* Expand to 16-bit channels, forces conversion of palette to RGB and expansion
1118  * of a tRNS chunk if present.
1119  */
1120 PNG_EXPORT(221, void, png_set_expand_16, (png_structrp png_ptr));
1121 #endif
1122 
1123 #if defined(PNG_READ_BGR_SUPPORTED) || defined(PNG_WRITE_BGR_SUPPORTED)
1124 /* Use blue, green, red order for pixels. */
1125 PNG_EXPORT(30, void, png_set_bgr, (png_structrp png_ptr));
1126 #endif
1127 
1128 #ifdef PNG_READ_GRAY_TO_RGB_SUPPORTED
1129 /* Expand the grayscale to 24-bit RGB if necessary. */
1130 PNG_EXPORT(31, void, png_set_gray_to_rgb, (png_structrp png_ptr));
1131 #endif
1132 
1133 #ifdef PNG_READ_RGB_TO_GRAY_SUPPORTED
1134 /* Reduce RGB to grayscale. */
1135 #define PNG_ERROR_ACTION_NONE  1
1136 #define PNG_ERROR_ACTION_WARN  2
1137 #define PNG_ERROR_ACTION_ERROR 3
1138 #define PNG_RGB_TO_GRAY_DEFAULT (-1)/*for red/green coefficients*/
1139 
1140 PNG_FP_EXPORT(32, void, png_set_rgb_to_gray, (png_structrp png_ptr,
1141     int error_action, double red, double green))
1142 PNG_FIXED_EXPORT(33, void, png_set_rgb_to_gray_fixed, (png_structrp png_ptr,
1143     int error_action, png_fixed_point red, png_fixed_point green))
1144 
1145 PNG_EXPORT(34, png_byte, png_get_rgb_to_gray_status, (png_const_structrp
1146     png_ptr));
1147 #endif
1148 
1149 #ifdef PNG_BUILD_GRAYSCALE_PALETTE_SUPPORTED
1150 PNG_EXPORT(35, void, png_build_grayscale_palette, (int bit_depth,
1151     png_colorp palette));
1152 #endif
1153 
1154 #ifdef PNG_READ_ALPHA_MODE_SUPPORTED
1155 /* How the alpha channel is interpreted - this affects how the color channels
1156  * of a PNG file are returned to the calling application when an alpha channel,
1157  * or a tRNS chunk in a palette file, is present.
1158  *
1159  * This has no effect on the way pixels are written into a PNG output
1160  * datastream. The color samples in a PNG datastream are never premultiplied
1161  * with the alpha samples.
1162  *
1163  * The default is to return data according to the PNG specification: the alpha
1164  * channel is a linear measure of the contribution of the pixel to the
1165  * corresponding composited pixel, and the color channels are unassociated
1166  * (not premultiplied).  The gamma encoded color channels must be scaled
1167  * according to the contribution and to do this it is necessary to undo
1168  * the encoding, scale the color values, perform the composition and re-encode
1169  * the values.  This is the &#39;PNG&#39; mode.
1170  *
1171  * The alternative is to &#39;associate&#39; the alpha with the color information by
1172  * storing color channel values that have been scaled by the alpha.
1173  * image.  These are the &#39;STANDARD&#39;, &#39;ASSOCIATED&#39; or &#39;PREMULTIPLIED&#39; modes
1174  * (the latter being the two common names for associated alpha color channels).
1175  *
1176  * For the &#39;OPTIMIZED&#39; mode, a pixel is treated as opaque only if the alpha
1177  * value is equal to the maximum value.
1178  *
1179  * The final choice is to gamma encode the alpha channel as well.  This is
1180  * broken because, in practice, no implementation that uses this choice
1181  * correctly undoes the encoding before handling alpha composition.  Use this
1182  * choice only if other serious errors in the software or hardware you use
1183  * mandate it; the typical serious error is for dark halos to appear around
1184  * opaque areas of the composited PNG image because of arithmetic overflow.
1185  *
1186  * The API function png_set_alpha_mode specifies which of these choices to use
1187  * with an enumerated &#39;mode&#39; value and the gamma of the required output:
1188  */
1189 #define PNG_ALPHA_PNG           0 /* according to the PNG standard */
1190 #define PNG_ALPHA_STANDARD      1 /* according to Porter/Duff */
1191 #define PNG_ALPHA_ASSOCIATED    1 /* as above; this is the normal practice */
1192 #define PNG_ALPHA_PREMULTIPLIED 1 /* as above */
1193 #define PNG_ALPHA_OPTIMIZED     2 /* &#39;PNG&#39; for opaque pixels, else &#39;STANDARD&#39; */
1194 #define PNG_ALPHA_BROKEN        3 /* the alpha channel is gamma encoded */
1195 
1196 PNG_FP_EXPORT(227, void, png_set_alpha_mode, (png_structrp png_ptr, int mode,
1197     double output_gamma))
1198 PNG_FIXED_EXPORT(228, void, png_set_alpha_mode_fixed, (png_structrp png_ptr,
1199     int mode, png_fixed_point output_gamma))
1200 #endif
1201 
1202 #if defined(PNG_GAMMA_SUPPORTED) || defined(PNG_READ_ALPHA_MODE_SUPPORTED)
1203 /* The output_gamma value is a screen gamma in libpng terminology: it expresses
1204  * how to decode the output values, not how they are encoded.
1205  */
1206 #define PNG_DEFAULT_sRGB -1       /* sRGB gamma and color space */
1207 #define PNG_GAMMA_MAC_18 -2       /* Old Mac &#39;1.8&#39; gamma and color space */
1208 #define PNG_GAMMA_sRGB   220000   /* Television standards--matches sRGB gamma */
1209 #define PNG_GAMMA_LINEAR PNG_FP_1 /* Linear */
1210 #endif
1211 
1212 /* The following are examples of calls to png_set_alpha_mode to achieve the
1213  * required overall gamma correction and, where necessary, alpha
1214  * premultiplication.
1215  *
1216  * png_set_alpha_mode(pp, PNG_ALPHA_PNG, PNG_DEFAULT_sRGB);
1217  *    This is the default libpng handling of the alpha channel - it is not
1218  *    pre-multiplied into the color components.  In addition the call states
1219  *    that the output is for a sRGB system and causes all PNG files without gAMA
1220  *    chunks to be assumed to be encoded using sRGB.
1221  *
1222  * png_set_alpha_mode(pp, PNG_ALPHA_PNG, PNG_GAMMA_MAC);
1223  *    In this case the output is assumed to be something like an sRGB conformant
1224  *    display preceded by a power-law lookup table of power 1.45.  This is how
1225  *    early Mac systems behaved.
1226  *
1227  * png_set_alpha_mode(pp, PNG_ALPHA_STANDARD, PNG_GAMMA_LINEAR);
1228  *    This is the classic Jim Blinn approach and will work in academic
1229  *    environments where everything is done by the book.  It has the shortcoming
1230  *    of assuming that input PNG data with no gamma information is linear - this
1231  *    is unlikely to be correct unless the PNG files where generated locally.
1232  *    Most of the time the output precision will be so low as to show
1233  *    significant banding in dark areas of the image.
1234  *
1235  * png_set_expand_16(pp);
1236  * png_set_alpha_mode(pp, PNG_ALPHA_STANDARD, PNG_DEFAULT_sRGB);
1237  *    This is a somewhat more realistic Jim Blinn inspired approach.  PNG files
1238  *    are assumed to have the sRGB encoding if not marked with a gamma value and
1239  *    the output is always 16 bits per component.  This permits accurate scaling
1240  *    and processing of the data.  If you know that your input PNG files were
1241  *    generated locally you might need to replace PNG_DEFAULT_sRGB with the
1242  *    correct value for your system.
1243  *
1244  * png_set_alpha_mode(pp, PNG_ALPHA_OPTIMIZED, PNG_DEFAULT_sRGB);
1245  *    If you just need to composite the PNG image onto an existing background
1246  *    and if you control the code that does this you can use the optimization
1247  *    setting.  In this case you just copy completely opaque pixels to the
1248  *    output.  For pixels that are not completely transparent (you just skip
1249  *    those) you do the composition math using png_composite or png_composite_16
1250  *    below then encode the resultant 8-bit or 16-bit values to match the output
1251  *    encoding.
1252  *
1253  * Other cases
1254  *    If neither the PNG nor the standard linear encoding work for you because
1255  *    of the software or hardware you use then you have a big problem.  The PNG
1256  *    case will probably result in halos around the image.  The linear encoding
1257  *    will probably result in a washed out, too bright, image (it&#39;s actually too
1258  *    contrasty.)  Try the ALPHA_OPTIMIZED mode above - this will probably
1259  *    substantially reduce the halos.  Alternatively try:
1260  *
1261  * png_set_alpha_mode(pp, PNG_ALPHA_BROKEN, PNG_DEFAULT_sRGB);
1262  *    This option will also reduce the halos, but there will be slight dark
1263  *    halos round the opaque parts of the image where the background is light.
1264  *    In the OPTIMIZED mode the halos will be light halos where the background
1265  *    is dark.  Take your pick - the halos are unavoidable unless you can get
1266  *    your hardware/software fixed!  (The OPTIMIZED approach is slightly
1267  *    faster.)
1268  *
1269  * When the default gamma of PNG files doesn&#39;t match the output gamma.
1270  *    If you have PNG files with no gamma information png_set_alpha_mode allows
1271  *    you to provide a default gamma, but it also sets the output gamma to the
1272  *    matching value.  If you know your PNG files have a gamma that doesn&#39;t
1273  *    match the output you can take advantage of the fact that
1274  *    png_set_alpha_mode always sets the output gamma but only sets the PNG
1275  *    default if it is not already set:
1276  *
1277  * png_set_alpha_mode(pp, PNG_ALPHA_PNG, PNG_DEFAULT_sRGB);
1278  * png_set_alpha_mode(pp, PNG_ALPHA_PNG, PNG_GAMMA_MAC);
1279  *    The first call sets both the default and the output gamma values, the
1280  *    second call overrides the output gamma without changing the default.  This
1281  *    is easier than achieving the same effect with png_set_gamma.  You must use
1282  *    PNG_ALPHA_PNG for the first call - internal checking in png_set_alpha will
1283  *    fire if more than one call to png_set_alpha_mode and png_set_background is
1284  *    made in the same read operation, however multiple calls with PNG_ALPHA_PNG
1285  *    are ignored.
1286  */
1287 
1288 #ifdef PNG_READ_STRIP_ALPHA_SUPPORTED
1289 PNG_EXPORT(36, void, png_set_strip_alpha, (png_structrp png_ptr));
1290 #endif
1291 
1292 #if defined(PNG_READ_SWAP_ALPHA_SUPPORTED) || \
1293     defined(PNG_WRITE_SWAP_ALPHA_SUPPORTED)
1294 PNG_EXPORT(37, void, png_set_swap_alpha, (png_structrp png_ptr));
1295 #endif
1296 
1297 #if defined(PNG_READ_INVERT_ALPHA_SUPPORTED) || \
1298     defined(PNG_WRITE_INVERT_ALPHA_SUPPORTED)
1299 PNG_EXPORT(38, void, png_set_invert_alpha, (png_structrp png_ptr));
1300 #endif
1301 
1302 #if defined(PNG_READ_FILLER_SUPPORTED) || defined(PNG_WRITE_FILLER_SUPPORTED)
1303 /* Add a filler byte to 8-bit or 16-bit Gray or 24-bit or 48-bit RGB images. */
1304 PNG_EXPORT(39, void, png_set_filler, (png_structrp png_ptr, png_uint_32 filler,
1305     int flags));
1306 /* The values of the PNG_FILLER_ defines should NOT be changed */
1307 #  define PNG_FILLER_BEFORE 0
1308 #  define PNG_FILLER_AFTER 1
1309 /* Add an alpha byte to 8-bit or 16-bit Gray or 24-bit or 48-bit RGB images. */
1310 PNG_EXPORT(40, void, png_set_add_alpha, (png_structrp png_ptr,
1311     png_uint_32 filler, int flags));
1312 #endif /* READ_FILLER || WRITE_FILLER */
1313 
1314 #if defined(PNG_READ_SWAP_SUPPORTED) || defined(PNG_WRITE_SWAP_SUPPORTED)
1315 /* Swap bytes in 16-bit depth files. */
1316 PNG_EXPORT(41, void, png_set_swap, (png_structrp png_ptr));
1317 #endif
1318 
1319 #if defined(PNG_READ_PACK_SUPPORTED) || defined(PNG_WRITE_PACK_SUPPORTED)
1320 /* Use 1 byte per pixel in 1, 2, or 4-bit depth files. */
1321 PNG_EXPORT(42, void, png_set_packing, (png_structrp png_ptr));
1322 #endif
1323 
1324 #if defined(PNG_READ_PACKSWAP_SUPPORTED) || \
1325     defined(PNG_WRITE_PACKSWAP_SUPPORTED)
1326 /* Swap packing order of pixels in bytes. */
1327 PNG_EXPORT(43, void, png_set_packswap, (png_structrp png_ptr));
1328 #endif
1329 
1330 #if defined(PNG_READ_SHIFT_SUPPORTED) || defined(PNG_WRITE_SHIFT_SUPPORTED)
1331 /* Converts files to legal bit depths. */
1332 PNG_EXPORT(44, void, png_set_shift, (png_structrp png_ptr, png_const_color_8p
1333     true_bits));
1334 #endif
1335 
1336 #if defined(PNG_READ_INTERLACING_SUPPORTED) || \
1337     defined(PNG_WRITE_INTERLACING_SUPPORTED)
1338 /* Have the code handle the interlacing.  Returns the number of passes.
1339  * MUST be called before png_read_update_info or png_start_read_image,
1340  * otherwise it will not have the desired effect.  Note that it is still
1341  * necessary to call png_read_row or png_read_rows png_get_image_height
1342  * times for each pass.
1343 */
1344 PNG_EXPORT(45, int, png_set_interlace_handling, (png_structrp png_ptr));
1345 #endif
1346 
1347 #if defined(PNG_READ_INVERT_SUPPORTED) || defined(PNG_WRITE_INVERT_SUPPORTED)
1348 /* Invert monochrome files */
1349 PNG_EXPORT(46, void, png_set_invert_mono, (png_structrp png_ptr));
1350 #endif
1351 
1352 #ifdef PNG_READ_BACKGROUND_SUPPORTED
1353 /* Handle alpha and tRNS by replacing with a background color.  Prior to
1354  * libpng-1.5.4 this API must not be called before the PNG file header has been
1355  * read.  Doing so will result in unexpected behavior and possible warnings or
1356  * errors if the PNG file contains a bKGD chunk.
1357  */
1358 PNG_FP_EXPORT(47, void, png_set_background, (png_structrp png_ptr,
1359     png_const_color_16p background_color, int background_gamma_code,
1360     int need_expand, double background_gamma))
1361 PNG_FIXED_EXPORT(215, void, png_set_background_fixed, (png_structrp png_ptr,
1362     png_const_color_16p background_color, int background_gamma_code,
1363     int need_expand, png_fixed_point background_gamma))
1364 #endif
1365 #ifdef PNG_READ_BACKGROUND_SUPPORTED
1366 #  define PNG_BACKGROUND_GAMMA_UNKNOWN 0
1367 #  define PNG_BACKGROUND_GAMMA_SCREEN  1
1368 #  define PNG_BACKGROUND_GAMMA_FILE    2
1369 #  define PNG_BACKGROUND_GAMMA_UNIQUE  3
1370 #endif
1371 
1372 #ifdef PNG_READ_SCALE_16_TO_8_SUPPORTED
1373 /* Scale a 16-bit depth file down to 8-bit, accurately. */
1374 PNG_EXPORT(229, void, png_set_scale_16, (png_structrp png_ptr));
1375 #endif
1376 
1377 #ifdef PNG_READ_STRIP_16_TO_8_SUPPORTED
1378 #define PNG_READ_16_TO_8_SUPPORTED /* Name prior to 1.5.4 */
1379 /* Strip the second byte of information from a 16-bit depth file. */
1380 PNG_EXPORT(48, void, png_set_strip_16, (png_structrp png_ptr));
1381 #endif
1382 
1383 #ifdef PNG_READ_QUANTIZE_SUPPORTED
1384 /* Turn on quantizing, and reduce the palette to the number of colors
1385  * available.
1386  */
1387 PNG_EXPORT(49, void, png_set_quantize, (png_structrp png_ptr,
1388     png_colorp palette, int num_palette, int maximum_colors,
1389     png_const_uint_16p histogram, int full_quantize));
1390 #endif
1391 
1392 #ifdef PNG_READ_GAMMA_SUPPORTED
1393 /* The threshold on gamma processing is configurable but hard-wired into the
1394  * library.  The following is the floating point variant.
1395  */
1396 #define PNG_GAMMA_THRESHOLD (PNG_GAMMA_THRESHOLD_FIXED*.00001)
1397 
1398 /* Handle gamma correction. Screen_gamma=(display_exponent).
1399  * NOTE: this API simply sets the screen and file gamma values. It will
1400  * therefore override the value for gamma in a PNG file if it is called after
1401  * the file header has been read - use with care  - call before reading the PNG
1402  * file for best results!
1403  *
1404  * These routines accept the same gamma values as png_set_alpha_mode (described
1405  * above).  The PNG_GAMMA_ defines and PNG_DEFAULT_sRGB can be passed to either
1406  * API (floating point or fixed.)  Notice, however, that the &#39;file_gamma&#39; value
1407  * is the inverse of a &#39;screen gamma&#39; value.
1408  */
1409 PNG_FP_EXPORT(50, void, png_set_gamma, (png_structrp png_ptr,
1410     double screen_gamma, double override_file_gamma))
1411 PNG_FIXED_EXPORT(208, void, png_set_gamma_fixed, (png_structrp png_ptr,
1412     png_fixed_point screen_gamma, png_fixed_point override_file_gamma))
1413 #endif
1414 
1415 #ifdef PNG_WRITE_FLUSH_SUPPORTED
1416 /* Set how many lines between output flushes - 0 for no flushing */
1417 PNG_EXPORT(51, void, png_set_flush, (png_structrp png_ptr, int nrows));
1418 /* Flush the current PNG output buffer */
1419 PNG_EXPORT(52, void, png_write_flush, (png_structrp png_ptr));
1420 #endif
1421 
1422 /* Optional update palette with requested transformations */
1423 PNG_EXPORT(53, void, png_start_read_image, (png_structrp png_ptr));
1424 
1425 /* Optional call to update the users info structure */
1426 PNG_EXPORT(54, void, png_read_update_info, (png_structrp png_ptr,
1427     png_inforp info_ptr));
1428 
1429 #ifdef PNG_SEQUENTIAL_READ_SUPPORTED
1430 /* Read one or more rows of image data. */
1431 PNG_EXPORT(55, void, png_read_rows, (png_structrp png_ptr, png_bytepp row,
1432     png_bytepp display_row, png_uint_32 num_rows));
1433 #endif
1434 
1435 #ifdef PNG_SEQUENTIAL_READ_SUPPORTED
1436 /* Read a row of data. */
1437 PNG_EXPORT(56, void, png_read_row, (png_structrp png_ptr, png_bytep row,
1438     png_bytep display_row));
1439 #endif
1440 
1441 #ifdef PNG_SEQUENTIAL_READ_SUPPORTED
1442 /* Read the whole image into memory at once. */
1443 PNG_EXPORT(57, void, png_read_image, (png_structrp png_ptr, png_bytepp image));
1444 #endif
1445 
1446 /* Write a row of image data */
1447 PNG_EXPORT(58, void, png_write_row, (png_structrp png_ptr,
1448     png_const_bytep row));
1449 
1450 /* Write a few rows of image data: (*row) is not written; however, the type
1451  * is declared as writeable to maintain compatibility with previous versions
1452  * of libpng and to allow the &#39;display_row&#39; array from read_rows to be passed
1453  * unchanged to write_rows.
1454  */
1455 PNG_EXPORT(59, void, png_write_rows, (png_structrp png_ptr, png_bytepp row,
1456     png_uint_32 num_rows));
1457 
1458 /* Write the image data */
1459 PNG_EXPORT(60, void, png_write_image, (png_structrp png_ptr, png_bytepp image));
1460 
1461 /* Write the end of the PNG file. */
1462 PNG_EXPORT(61, void, png_write_end, (png_structrp png_ptr,
1463     png_inforp info_ptr));
1464 
1465 #ifdef PNG_SEQUENTIAL_READ_SUPPORTED
1466 /* Read the end of the PNG file. */
1467 PNG_EXPORT(62, void, png_read_end, (png_structrp png_ptr, png_inforp info_ptr));
1468 #endif
1469 
1470 /* Free any memory associated with the png_info_struct */
1471 PNG_EXPORT(63, void, png_destroy_info_struct, (png_const_structrp png_ptr,
1472     png_infopp info_ptr_ptr));
1473 
1474 /* Free any memory associated with the png_struct and the png_info_structs */
1475 PNG_EXPORT(64, void, png_destroy_read_struct, (png_structpp png_ptr_ptr,
1476     png_infopp info_ptr_ptr, png_infopp end_info_ptr_ptr));
1477 
1478 /* Free any memory associated with the png_struct and the png_info_structs */
1479 PNG_EXPORT(65, void, png_destroy_write_struct, (png_structpp png_ptr_ptr,
1480     png_infopp info_ptr_ptr));
1481 
1482 /* Set the libpng method of handling chunk CRC errors */
1483 PNG_EXPORT(66, void, png_set_crc_action, (png_structrp png_ptr, int crit_action,
1484     int ancil_action));
1485 
1486 /* Values for png_set_crc_action() say how to handle CRC errors in
1487  * ancillary and critical chunks, and whether to use the data contained
1488  * therein.  Note that it is impossible to &quot;discard&quot; data in a critical
1489  * chunk.  For versions prior to 0.90, the action was always error/quit,
1490  * whereas in version 0.90 and later, the action for CRC errors in ancillary
1491  * chunks is warn/discard.  These values should NOT be changed.
1492  *
1493  *      value                       action:critical     action:ancillary
1494  */
1495 #define PNG_CRC_DEFAULT       0  /* error/quit          warn/discard data */
1496 #define PNG_CRC_ERROR_QUIT    1  /* error/quit          error/quit        */
1497 #define PNG_CRC_WARN_DISCARD  2  /* (INVALID)           warn/discard data */
1498 #define PNG_CRC_WARN_USE      3  /* warn/use data       warn/use data     */
1499 #define PNG_CRC_QUIET_USE     4  /* quiet/use data      quiet/use data    */
1500 #define PNG_CRC_NO_CHANGE     5  /* use current value   use current value */
1501 
1502 #ifdef PNG_WRITE_SUPPORTED
1503 /* These functions give the user control over the scan-line filtering in
1504  * libpng and the compression methods used by zlib.  These functions are
1505  * mainly useful for testing, as the defaults should work with most users.
1506  * Those users who are tight on memory or want faster performance at the
1507  * expense of compression can modify them.  See the compression library
1508  * header file (zlib.h) for an explination of the compression functions.
1509  */
1510 
1511 /* Set the filtering method(s) used by libpng.  Currently, the only valid
1512  * value for &quot;method&quot; is 0.
1513  */
1514 PNG_EXPORT(67, void, png_set_filter, (png_structrp png_ptr, int method,
1515     int filters));
1516 #endif /* WRITE */
1517 
1518 /* Flags for png_set_filter() to say which filters to use.  The flags
1519  * are chosen so that they don&#39;t conflict with real filter types
1520  * below, in case they are supplied instead of the #defined constants.
1521  * These values should NOT be changed.
1522  */
1523 #define PNG_NO_FILTERS     0x00
1524 #define PNG_FILTER_NONE    0x08
1525 #define PNG_FILTER_SUB     0x10
1526 #define PNG_FILTER_UP      0x20
1527 #define PNG_FILTER_AVG     0x40
1528 #define PNG_FILTER_PAETH   0x80
1529 #define PNG_FAST_FILTERS (PNG_FILTER_NONE | PNG_FILTER_SUB | PNG_FILTER_UP)
1530 #define PNG_ALL_FILTERS (PNG_FAST_FILTERS | PNG_FILTER_AVG | PNG_FILTER_PAETH)
1531 
1532 /* Filter values (not flags) - used in pngwrite.c, pngwutil.c for now.
1533  * These defines should NOT be changed.
1534  */
1535 #define PNG_FILTER_VALUE_NONE  0
1536 #define PNG_FILTER_VALUE_SUB   1
1537 #define PNG_FILTER_VALUE_UP    2
1538 #define PNG_FILTER_VALUE_AVG   3
1539 #define PNG_FILTER_VALUE_PAETH 4
1540 #define PNG_FILTER_VALUE_LAST  5
1541 
1542 #ifdef PNG_WRITE_SUPPORTED
1543 #ifdef PNG_WRITE_WEIGHTED_FILTER_SUPPORTED /* DEPRECATED */
1544 PNG_FP_EXPORT(68, void, png_set_filter_heuristics, (png_structrp png_ptr,
1545     int heuristic_method, int num_weights, png_const_doublep filter_weights,
1546     png_const_doublep filter_costs))
1547 PNG_FIXED_EXPORT(209, void, png_set_filter_heuristics_fixed,
1548     (png_structrp png_ptr, int heuristic_method, int num_weights,
1549     png_const_fixed_point_p filter_weights,
1550     png_const_fixed_point_p filter_costs))
1551 #endif /* WRITE_WEIGHTED_FILTER */
1552 
1553 /* The following are no longer used and will be removed from libpng-1.7: */
1554 #define PNG_FILTER_HEURISTIC_DEFAULT    0  /* Currently &quot;UNWEIGHTED&quot; */
1555 #define PNG_FILTER_HEURISTIC_UNWEIGHTED 1  /* Used by libpng &lt; 0.95 */
1556 #define PNG_FILTER_HEURISTIC_WEIGHTED   2  /* Experimental feature */
1557 #define PNG_FILTER_HEURISTIC_LAST       3  /* Not a valid value */
1558 
1559 /* Set the library compression level.  Currently, valid values range from
1560  * 0 - 9, corresponding directly to the zlib compression levels 0 - 9
1561  * (0 - no compression, 9 - &quot;maximal&quot; compression).  Note that tests have
1562  * shown that zlib compression levels 3-6 usually perform as well as level 9
1563  * for PNG images, and do considerably fewer caclulations.  In the future,
1564  * these values may not correspond directly to the zlib compression levels.
1565  */
1566 #ifdef PNG_WRITE_CUSTOMIZE_COMPRESSION_SUPPORTED
1567 PNG_EXPORT(69, void, png_set_compression_level, (png_structrp png_ptr,
1568     int level));
1569 
1570 PNG_EXPORT(70, void, png_set_compression_mem_level, (png_structrp png_ptr,
1571     int mem_level));
1572 
1573 PNG_EXPORT(71, void, png_set_compression_strategy, (png_structrp png_ptr,
1574     int strategy));
1575 
1576 /* If PNG_WRITE_OPTIMIZE_CMF_SUPPORTED is defined, libpng will use a
1577  * smaller value of window_bits if it can do so safely.
1578  */
1579 PNG_EXPORT(72, void, png_set_compression_window_bits, (png_structrp png_ptr,
1580     int window_bits));
1581 
1582 PNG_EXPORT(73, void, png_set_compression_method, (png_structrp png_ptr,
1583     int method));
1584 #endif /* WRITE_CUSTOMIZE_COMPRESSION */
1585 
1586 #ifdef PNG_WRITE_CUSTOMIZE_ZTXT_COMPRESSION_SUPPORTED
1587 /* Also set zlib parameters for compressing non-IDAT chunks */
1588 PNG_EXPORT(222, void, png_set_text_compression_level, (png_structrp png_ptr,
1589     int level));
1590 
1591 PNG_EXPORT(223, void, png_set_text_compression_mem_level, (png_structrp png_ptr,
1592     int mem_level));
1593 
1594 PNG_EXPORT(224, void, png_set_text_compression_strategy, (png_structrp png_ptr,
1595     int strategy));
1596 
1597 /* If PNG_WRITE_OPTIMIZE_CMF_SUPPORTED is defined, libpng will use a
1598  * smaller value of window_bits if it can do so safely.
1599  */
1600 PNG_EXPORT(225, void, png_set_text_compression_window_bits,
1601     (png_structrp png_ptr, int window_bits));
1602 
1603 PNG_EXPORT(226, void, png_set_text_compression_method, (png_structrp png_ptr,
1604     int method));
1605 #endif /* WRITE_CUSTOMIZE_ZTXT_COMPRESSION */
1606 #endif /* WRITE */
1607 
1608 /* These next functions are called for input/output, memory, and error
1609  * handling.  They are in the file pngrio.c, pngwio.c, and pngerror.c,
1610  * and call standard C I/O routines such as fread(), fwrite(), and
1611  * fprintf().  These functions can be made to use other I/O routines
1612  * at run time for those applications that need to handle I/O in a
1613  * different manner by calling png_set_???_fn().  See libpng-manual.txt for
1614  * more information.
1615  */
1616 
1617 #ifdef PNG_STDIO_SUPPORTED
1618 /* Initialize the input/output for the PNG file to the default functions. */
1619 PNG_EXPORT(74, void, png_init_io, (png_structrp png_ptr, png_FILE_p fp));
1620 #endif
1621 
1622 /* Replace the (error and abort), and warning functions with user
1623  * supplied functions.  If no messages are to be printed you must still
1624  * write and use replacement functions. The replacement error_fn should
1625  * still do a longjmp to the last setjmp location if you are using this
1626  * method of error handling.  If error_fn or warning_fn is NULL, the
1627  * default function will be used.
1628  */
1629 
1630 PNG_EXPORT(75, void, png_set_error_fn, (png_structrp png_ptr,
1631     png_voidp error_ptr, png_error_ptr error_fn, png_error_ptr warning_fn));
1632 
1633 /* Return the user pointer associated with the error functions */
1634 PNG_EXPORT(76, png_voidp, png_get_error_ptr, (png_const_structrp png_ptr));
1635 
1636 /* Replace the default data output functions with a user supplied one(s).
1637  * If buffered output is not used, then output_flush_fn can be set to NULL.
1638  * If PNG_WRITE_FLUSH_SUPPORTED is not defined at libpng compile time
1639  * output_flush_fn will be ignored (and thus can be NULL).
1640  * It is probably a mistake to use NULL for output_flush_fn if
1641  * write_data_fn is not also NULL unless you have built libpng with
1642  * PNG_WRITE_FLUSH_SUPPORTED undefined, because in this case libpng&#39;s
1643  * default flush function, which uses the standard *FILE structure, will
1644  * be used.
1645  */
1646 PNG_EXPORT(77, void, png_set_write_fn, (png_structrp png_ptr, png_voidp io_ptr,
1647     png_rw_ptr write_data_fn, png_flush_ptr output_flush_fn));
1648 
1649 /* Replace the default data input function with a user supplied one. */
1650 PNG_EXPORT(78, void, png_set_read_fn, (png_structrp png_ptr, png_voidp io_ptr,
1651     png_rw_ptr read_data_fn));
1652 
1653 /* Return the user pointer associated with the I/O functions */
1654 PNG_EXPORT(79, png_voidp, png_get_io_ptr, (png_const_structrp png_ptr));
1655 
1656 PNG_EXPORT(80, void, png_set_read_status_fn, (png_structrp png_ptr,
1657     png_read_status_ptr read_row_fn));
1658 
1659 PNG_EXPORT(81, void, png_set_write_status_fn, (png_structrp png_ptr,
1660     png_write_status_ptr write_row_fn));
1661 
1662 #ifdef PNG_USER_MEM_SUPPORTED
1663 /* Replace the default memory allocation functions with user supplied one(s). */
1664 PNG_EXPORT(82, void, png_set_mem_fn, (png_structrp png_ptr, png_voidp mem_ptr,
1665     png_malloc_ptr malloc_fn, png_free_ptr free_fn));
1666 /* Return the user pointer associated with the memory functions */
1667 PNG_EXPORT(83, png_voidp, png_get_mem_ptr, (png_const_structrp png_ptr));
1668 #endif
1669 
1670 #ifdef PNG_READ_USER_TRANSFORM_SUPPORTED
1671 PNG_EXPORT(84, void, png_set_read_user_transform_fn, (png_structrp png_ptr,
1672     png_user_transform_ptr read_user_transform_fn));
1673 #endif
1674 
1675 #ifdef PNG_WRITE_USER_TRANSFORM_SUPPORTED
1676 PNG_EXPORT(85, void, png_set_write_user_transform_fn, (png_structrp png_ptr,
1677     png_user_transform_ptr write_user_transform_fn));
1678 #endif
1679 
1680 #ifdef PNG_USER_TRANSFORM_PTR_SUPPORTED
1681 PNG_EXPORT(86, void, png_set_user_transform_info, (png_structrp png_ptr,
1682     png_voidp user_transform_ptr, int user_transform_depth,
1683     int user_transform_channels));
1684 /* Return the user pointer associated with the user transform functions */
1685 PNG_EXPORT(87, png_voidp, png_get_user_transform_ptr,
1686     (png_const_structrp png_ptr));
1687 #endif
1688 
1689 #ifdef PNG_USER_TRANSFORM_INFO_SUPPORTED
1690 /* Return information about the row currently being processed.  Note that these
1691  * APIs do not fail but will return unexpected results if called outside a user
1692  * transform callback.  Also note that when transforming an interlaced image the
1693  * row number is the row number within the sub-image of the interlace pass, so
1694  * the value will increase to the height of the sub-image (not the full image)
1695  * then reset to 0 for the next pass.
1696  *
1697  * Use PNG_ROW_FROM_PASS_ROW(row, pass) and PNG_COL_FROM_PASS_COL(col, pass) to
1698  * find the output pixel (x,y) given an interlaced sub-image pixel
1699  * (row,col,pass).  (See below for these macros.)
1700  */
1701 PNG_EXPORT(217, png_uint_32, png_get_current_row_number, (png_const_structrp));
1702 PNG_EXPORT(218, png_byte, png_get_current_pass_number, (png_const_structrp));
1703 #endif
1704 
1705 #ifdef PNG_READ_USER_CHUNKS_SUPPORTED
1706 /* This callback is called only for *unknown* chunks.  If
1707  * PNG_HANDLE_AS_UNKNOWN_SUPPORTED is set then it is possible to set known
1708  * chunks to be treated as unknown, however in this case the callback must do
1709  * any processing required by the chunk (e.g. by calling the appropriate
1710  * png_set_ APIs.)
1711  *
1712  * There is no write support - on write, by default, all the chunks in the
1713  * &#39;unknown&#39; list are written in the specified position.
1714  *
1715  * The integer return from the callback function is interpreted thus:
1716  *
1717  * negative: An error occurred; png_chunk_error will be called.
1718  *     zero: The chunk was not handled, the chunk will be saved. A critical
1719  *           chunk will cause an error at this point unless it is to be saved.
1720  * positive: The chunk was handled, libpng will ignore/discard it.
1721  *
1722  * See &quot;INTERACTION WITH USER CHUNK CALLBACKS&quot; below for important notes about
1723  * how this behavior will change in libpng 1.7
1724  */
1725 PNG_EXPORT(88, void, png_set_read_user_chunk_fn, (png_structrp png_ptr,
1726     png_voidp user_chunk_ptr, png_user_chunk_ptr read_user_chunk_fn));
1727 #endif
1728 
1729 #ifdef PNG_USER_CHUNKS_SUPPORTED
1730 PNG_EXPORT(89, png_voidp, png_get_user_chunk_ptr, (png_const_structrp png_ptr));
1731 #endif
1732 
1733 #ifdef PNG_PROGRESSIVE_READ_SUPPORTED
1734 /* Sets the function callbacks for the push reader, and a pointer to a
1735  * user-defined structure available to the callback functions.
1736  */
1737 PNG_EXPORT(90, void, png_set_progressive_read_fn, (png_structrp png_ptr,
1738     png_voidp progressive_ptr, png_progressive_info_ptr info_fn,
1739     png_progressive_row_ptr row_fn, png_progressive_end_ptr end_fn));
1740 
1741 /* Returns the user pointer associated with the push read functions */
1742 PNG_EXPORT(91, png_voidp, png_get_progressive_ptr,
1743     (png_const_structrp png_ptr));
1744 
1745 /* Function to be called when data becomes available */
1746 PNG_EXPORT(92, void, png_process_data, (png_structrp png_ptr,
1747     png_inforp info_ptr, png_bytep buffer, size_t buffer_size));
1748 
1749 /* A function which may be called *only* within png_process_data to stop the
1750  * processing of any more data.  The function returns the number of bytes
1751  * remaining, excluding any that libpng has cached internally.  A subsequent
1752  * call to png_process_data must supply these bytes again.  If the argument
1753  * &#39;save&#39; is set to true the routine will first save all the pending data and
1754  * will always return 0.
1755  */
1756 PNG_EXPORT(219, size_t, png_process_data_pause, (png_structrp, int save));
1757 
1758 /* A function which may be called *only* outside (after) a call to
1759  * png_process_data.  It returns the number of bytes of data to skip in the
1760  * input.  Normally it will return 0, but if it returns a non-zero value the
1761  * application must skip than number of bytes of input data and pass the
1762  * following data to the next call to png_process_data.
1763  */
1764 PNG_EXPORT(220, png_uint_32, png_process_data_skip, (png_structrp));
1765 
1766 /* Function that combines rows.  &#39;new_row&#39; is a flag that should come from
1767  * the callback and be non-NULL if anything needs to be done; the library
1768  * stores its own version of the new data internally and ignores the passed
1769  * in value.
1770  */
1771 PNG_EXPORT(93, void, png_progressive_combine_row, (png_const_structrp png_ptr,
1772     png_bytep old_row, png_const_bytep new_row));
1773 #endif /* PROGRESSIVE_READ */
1774 
1775 PNG_EXPORTA(94, png_voidp, png_malloc, (png_const_structrp png_ptr,
1776     png_alloc_size_t size), PNG_ALLOCATED);
1777 /* Added at libpng version 1.4.0 */
1778 PNG_EXPORTA(95, png_voidp, png_calloc, (png_const_structrp png_ptr,
1779     png_alloc_size_t size), PNG_ALLOCATED);
1780 
1781 /* Added at libpng version 1.2.4 */
1782 PNG_EXPORTA(96, png_voidp, png_malloc_warn, (png_const_structrp png_ptr,
1783     png_alloc_size_t size), PNG_ALLOCATED);
1784 
1785 /* Frees a pointer allocated by png_malloc() */
1786 PNG_EXPORT(97, void, png_free, (png_const_structrp png_ptr, png_voidp ptr));
1787 
1788 /* Free data that was allocated internally */
1789 PNG_EXPORT(98, void, png_free_data, (png_const_structrp png_ptr,
1790     png_inforp info_ptr, png_uint_32 free_me, int num));
1791 
1792 /* Reassign responsibility for freeing existing data, whether allocated
1793  * by libpng or by the application; this works on the png_info structure passed
1794  * in, it does not change the state for other png_info structures.
1795  *
1796  * It is unlikely that this function works correctly as of 1.6.0 and using it
1797  * may result either in memory leaks or double free of allocated data.
1798  */
1799 PNG_EXPORT(99, void, png_data_freer, (png_const_structrp png_ptr,
1800     png_inforp info_ptr, int freer, png_uint_32 mask));
1801 
1802 /* Assignments for png_data_freer */
1803 #define PNG_DESTROY_WILL_FREE_DATA 1
1804 #define PNG_SET_WILL_FREE_DATA 1
1805 #define PNG_USER_WILL_FREE_DATA 2
1806 /* Flags for png_ptr-&gt;free_me and info_ptr-&gt;free_me */
1807 #define PNG_FREE_HIST 0x0008U
1808 #define PNG_FREE_ICCP 0x0010U
1809 #define PNG_FREE_SPLT 0x0020U
1810 #define PNG_FREE_ROWS 0x0040U
1811 #define PNG_FREE_PCAL 0x0080U
1812 #define PNG_FREE_SCAL 0x0100U
1813 #ifdef PNG_STORE_UNKNOWN_CHUNKS_SUPPORTED
1814 #  define PNG_FREE_UNKN 0x0200U
1815 #endif
1816 /*      PNG_FREE_LIST 0x0400U   removed in 1.6.0 because it is ignored */
1817 #define PNG_FREE_PLTE 0x1000U
1818 #define PNG_FREE_TRNS 0x2000U
1819 #define PNG_FREE_TEXT 0x4000U
1820 #define PNG_FREE_EXIF 0x8000U /* Added at libpng-1.6.31 */
1821 #define PNG_FREE_ALL  0xffffU
1822 #define PNG_FREE_MUL  0x4220U /* PNG_FREE_SPLT|PNG_FREE_TEXT|PNG_FREE_UNKN */
1823 
1824 #ifdef PNG_USER_MEM_SUPPORTED
1825 PNG_EXPORTA(100, png_voidp, png_malloc_default, (png_const_structrp png_ptr,
1826     png_alloc_size_t size), PNG_ALLOCATED PNG_DEPRECATED);
1827 PNG_EXPORTA(101, void, png_free_default, (png_const_structrp png_ptr,
1828     png_voidp ptr), PNG_DEPRECATED);
1829 #endif
1830 
1831 #ifdef PNG_ERROR_TEXT_SUPPORTED
1832 /* Fatal error in PNG image of libpng - can&#39;t continue */
1833 PNG_EXPORTA(102, void, png_error, (png_const_structrp png_ptr,
1834     png_const_charp error_message), PNG_NORETURN);
1835 
1836 /* The same, but the chunk name is prepended to the error string. */
1837 PNG_EXPORTA(103, void, png_chunk_error, (png_const_structrp png_ptr,
1838     png_const_charp error_message), PNG_NORETURN);
1839 
1840 #else
1841 /* Fatal error in PNG image of libpng - can&#39;t continue */
1842 PNG_EXPORTA(104, void, png_err, (png_const_structrp png_ptr), PNG_NORETURN);
1843 #  define png_error(s1,s2) png_err(s1)
1844 #  define png_chunk_error(s1,s2) png_err(s1)
1845 #endif
1846 
1847 #ifdef PNG_WARNINGS_SUPPORTED
1848 /* Non-fatal error in libpng.  Can continue, but may have a problem. */
1849 PNG_EXPORT(105, void, png_warning, (png_const_structrp png_ptr,
1850     png_const_charp warning_message));
1851 
1852 /* Non-fatal error in libpng, chunk name is prepended to message. */
1853 PNG_EXPORT(106, void, png_chunk_warning, (png_const_structrp png_ptr,
1854     png_const_charp warning_message));
1855 #else
1856 #  define png_warning(s1,s2) ((void)(s1))
1857 #  define png_chunk_warning(s1,s2) ((void)(s1))
1858 #endif
1859 
1860 #ifdef PNG_BENIGN_ERRORS_SUPPORTED
1861 /* Benign error in libpng.  Can continue, but may have a problem.
1862  * User can choose whether to handle as a fatal error or as a warning. */
1863 PNG_EXPORT(107, void, png_benign_error, (png_const_structrp png_ptr,
1864     png_const_charp warning_message));
1865 
1866 #ifdef PNG_READ_SUPPORTED
1867 /* Same, chunk name is prepended to message (only during read) */
1868 PNG_EXPORT(108, void, png_chunk_benign_error, (png_const_structrp png_ptr,
1869     png_const_charp warning_message));
1870 #endif
1871 
1872 PNG_EXPORT(109, void, png_set_benign_errors,
1873     (png_structrp png_ptr, int allowed));
1874 #else
1875 #  ifdef PNG_ALLOW_BENIGN_ERRORS
1876 #    define png_benign_error png_warning
1877 #    define png_chunk_benign_error png_chunk_warning
1878 #  else
1879 #    define png_benign_error png_error
1880 #    define png_chunk_benign_error png_chunk_error
1881 #  endif
1882 #endif
1883 
1884 /* The png_set_&lt;chunk&gt; functions are for storing values in the png_info_struct.
1885  * Similarly, the png_get_&lt;chunk&gt; calls are used to read values from the
1886  * png_info_struct, either storing the parameters in the passed variables, or
1887  * setting pointers into the png_info_struct where the data is stored.  The
1888  * png_get_&lt;chunk&gt; functions return a non-zero value if the data was available
1889  * in info_ptr, or return zero and do not change any of the parameters if the
1890  * data was not available.
1891  *
1892  * These functions should be used instead of directly accessing png_info
1893  * to avoid problems with future changes in the size and internal layout of
1894  * png_info_struct.
1895  */
1896 /* Returns &quot;flag&quot; if chunk data is valid in info_ptr. */
1897 PNG_EXPORT(110, png_uint_32, png_get_valid, (png_const_structrp png_ptr,
1898     png_const_inforp info_ptr, png_uint_32 flag));
1899 
1900 /* Returns number of bytes needed to hold a transformed row. */
1901 PNG_EXPORT(111, size_t, png_get_rowbytes, (png_const_structrp png_ptr,
1902     png_const_inforp info_ptr));
1903 
1904 #ifdef PNG_INFO_IMAGE_SUPPORTED
1905 /* Returns row_pointers, which is an array of pointers to scanlines that was
1906  * returned from png_read_png().
1907  */
1908 PNG_EXPORT(112, png_bytepp, png_get_rows, (png_const_structrp png_ptr,
1909     png_const_inforp info_ptr));
1910 
1911 /* Set row_pointers, which is an array of pointers to scanlines for use
1912  * by png_write_png().
1913  */
1914 PNG_EXPORT(113, void, png_set_rows, (png_const_structrp png_ptr,
1915     png_inforp info_ptr, png_bytepp row_pointers));
1916 #endif
1917 
1918 /* Returns number of color channels in image. */
1919 PNG_EXPORT(114, png_byte, png_get_channels, (png_const_structrp png_ptr,
1920     png_const_inforp info_ptr));
1921 
1922 #ifdef PNG_EASY_ACCESS_SUPPORTED
1923 /* Returns image width in pixels. */
1924 PNG_EXPORT(115, png_uint_32, png_get_image_width, (png_const_structrp png_ptr,
1925     png_const_inforp info_ptr));
1926 
1927 /* Returns image height in pixels. */
1928 PNG_EXPORT(116, png_uint_32, png_get_image_height, (png_const_structrp png_ptr,
1929     png_const_inforp info_ptr));
1930 
1931 /* Returns image bit_depth. */
1932 PNG_EXPORT(117, png_byte, png_get_bit_depth, (png_const_structrp png_ptr,
1933     png_const_inforp info_ptr));
1934 
1935 /* Returns image color_type. */
1936 PNG_EXPORT(118, png_byte, png_get_color_type, (png_const_structrp png_ptr,
1937     png_const_inforp info_ptr));
1938 
1939 /* Returns image filter_type. */
1940 PNG_EXPORT(119, png_byte, png_get_filter_type, (png_const_structrp png_ptr,
1941     png_const_inforp info_ptr));
1942 
1943 /* Returns image interlace_type. */
1944 PNG_EXPORT(120, png_byte, png_get_interlace_type, (png_const_structrp png_ptr,
1945     png_const_inforp info_ptr));
1946 
1947 /* Returns image compression_type. */
1948 PNG_EXPORT(121, png_byte, png_get_compression_type, (png_const_structrp png_ptr,
1949     png_const_inforp info_ptr));
1950 
1951 /* Returns image resolution in pixels per meter, from pHYs chunk data. */
1952 PNG_EXPORT(122, png_uint_32, png_get_pixels_per_meter,
1953     (png_const_structrp png_ptr, png_const_inforp info_ptr));
1954 PNG_EXPORT(123, png_uint_32, png_get_x_pixels_per_meter,
1955     (png_const_structrp png_ptr, png_const_inforp info_ptr));
1956 PNG_EXPORT(124, png_uint_32, png_get_y_pixels_per_meter,
1957     (png_const_structrp png_ptr, png_const_inforp info_ptr));
1958 
1959 /* Returns pixel aspect ratio, computed from pHYs chunk data.  */
1960 PNG_FP_EXPORT(125, float, png_get_pixel_aspect_ratio,
1961     (png_const_structrp png_ptr, png_const_inforp info_ptr))
1962 PNG_FIXED_EXPORT(210, png_fixed_point, png_get_pixel_aspect_ratio_fixed,
1963     (png_const_structrp png_ptr, png_const_inforp info_ptr))
1964 
1965 /* Returns image x, y offset in pixels or microns, from oFFs chunk data. */
1966 PNG_EXPORT(126, png_int_32, png_get_x_offset_pixels,
1967     (png_const_structrp png_ptr, png_const_inforp info_ptr));
1968 PNG_EXPORT(127, png_int_32, png_get_y_offset_pixels,
1969     (png_const_structrp png_ptr, png_const_inforp info_ptr));
1970 PNG_EXPORT(128, png_int_32, png_get_x_offset_microns,
1971     (png_const_structrp png_ptr, png_const_inforp info_ptr));
1972 PNG_EXPORT(129, png_int_32, png_get_y_offset_microns,
1973     (png_const_structrp png_ptr, png_const_inforp info_ptr));
1974 
1975 #endif /* EASY_ACCESS */
1976 
1977 #ifdef PNG_READ_SUPPORTED
1978 /* Returns pointer to signature string read from PNG header */
1979 PNG_EXPORT(130, png_const_bytep, png_get_signature, (png_const_structrp png_ptr,
1980     png_const_inforp info_ptr));
1981 #endif
1982 
1983 #ifdef PNG_bKGD_SUPPORTED
1984 PNG_EXPORT(131, png_uint_32, png_get_bKGD, (png_const_structrp png_ptr,
1985     png_inforp info_ptr, png_color_16p *background));
1986 #endif
1987 
1988 #ifdef PNG_bKGD_SUPPORTED
1989 PNG_EXPORT(132, void, png_set_bKGD, (png_const_structrp png_ptr,
1990     png_inforp info_ptr, png_const_color_16p background));
1991 #endif
1992 
1993 #ifdef PNG_cHRM_SUPPORTED
1994 PNG_FP_EXPORT(133, png_uint_32, png_get_cHRM, (png_const_structrp png_ptr,
1995     png_const_inforp info_ptr, double *white_x, double *white_y, double *red_x,
1996     double *red_y, double *green_x, double *green_y, double *blue_x,
1997     double *blue_y))
1998 PNG_FP_EXPORT(230, png_uint_32, png_get_cHRM_XYZ, (png_const_structrp png_ptr,
1999     png_const_inforp info_ptr, double *red_X, double *red_Y, double *red_Z,
2000     double *green_X, double *green_Y, double *green_Z, double *blue_X,
2001     double *blue_Y, double *blue_Z))
2002 PNG_FIXED_EXPORT(134, png_uint_32, png_get_cHRM_fixed,
2003     (png_const_structrp png_ptr, png_const_inforp info_ptr,
2004     png_fixed_point *int_white_x, png_fixed_point *int_white_y,
2005     png_fixed_point *int_red_x, png_fixed_point *int_red_y,
2006     png_fixed_point *int_green_x, png_fixed_point *int_green_y,
2007     png_fixed_point *int_blue_x, png_fixed_point *int_blue_y))
2008 PNG_FIXED_EXPORT(231, png_uint_32, png_get_cHRM_XYZ_fixed,
2009     (png_const_structrp png_ptr, png_const_inforp info_ptr,
2010     png_fixed_point *int_red_X, png_fixed_point *int_red_Y,
2011     png_fixed_point *int_red_Z, png_fixed_point *int_green_X,
2012     png_fixed_point *int_green_Y, png_fixed_point *int_green_Z,
2013     png_fixed_point *int_blue_X, png_fixed_point *int_blue_Y,
2014     png_fixed_point *int_blue_Z))
2015 #endif
2016 
2017 #ifdef PNG_cHRM_SUPPORTED
2018 PNG_FP_EXPORT(135, void, png_set_cHRM, (png_const_structrp png_ptr,
2019     png_inforp info_ptr,
2020     double white_x, double white_y, double red_x, double red_y, double green_x,
2021     double green_y, double blue_x, double blue_y))
2022 PNG_FP_EXPORT(232, void, png_set_cHRM_XYZ, (png_const_structrp png_ptr,
2023     png_inforp info_ptr, double red_X, double red_Y, double red_Z,
2024     double green_X, double green_Y, double green_Z, double blue_X,
2025     double blue_Y, double blue_Z))
2026 PNG_FIXED_EXPORT(136, void, png_set_cHRM_fixed, (png_const_structrp png_ptr,
2027     png_inforp info_ptr, png_fixed_point int_white_x,
2028     png_fixed_point int_white_y, png_fixed_point int_red_x,
2029     png_fixed_point int_red_y, png_fixed_point int_green_x,
2030     png_fixed_point int_green_y, png_fixed_point int_blue_x,
2031     png_fixed_point int_blue_y))
2032 PNG_FIXED_EXPORT(233, void, png_set_cHRM_XYZ_fixed, (png_const_structrp png_ptr,
2033     png_inforp info_ptr, png_fixed_point int_red_X, png_fixed_point int_red_Y,
2034     png_fixed_point int_red_Z, png_fixed_point int_green_X,
2035     png_fixed_point int_green_Y, png_fixed_point int_green_Z,
2036     png_fixed_point int_blue_X, png_fixed_point int_blue_Y,
2037     png_fixed_point int_blue_Z))
2038 #endif
2039 
2040 #ifdef PNG_eXIf_SUPPORTED
2041 PNG_EXPORT(246, png_uint_32, png_get_eXIf, (png_const_structrp png_ptr,
2042     png_inforp info_ptr, png_bytep *exif));
2043 PNG_EXPORT(247, void, png_set_eXIf, (png_const_structrp png_ptr,
<a name="39" id="anc39"></a><span class="line-modified">2044     png_inforp info_ptr, const png_bytep exif));</span>
2045 
2046 PNG_EXPORT(248, png_uint_32, png_get_eXIf_1, (png_const_structrp png_ptr,
2047     png_const_inforp info_ptr, png_uint_32 *num_exif, png_bytep *exif));
2048 PNG_EXPORT(249, void, png_set_eXIf_1, (png_const_structrp png_ptr,
<a name="40" id="anc40"></a><span class="line-modified">2049     png_inforp info_ptr, const png_uint_32 num_exif, const png_bytep exif));</span>
2050 #endif
2051 
2052 #ifdef PNG_gAMA_SUPPORTED
2053 PNG_FP_EXPORT(137, png_uint_32, png_get_gAMA, (png_const_structrp png_ptr,
2054     png_const_inforp info_ptr, double *file_gamma))
2055 PNG_FIXED_EXPORT(138, png_uint_32, png_get_gAMA_fixed,
2056     (png_const_structrp png_ptr, png_const_inforp info_ptr,
2057     png_fixed_point *int_file_gamma))
2058 #endif
2059 
2060 #ifdef PNG_gAMA_SUPPORTED
2061 PNG_FP_EXPORT(139, void, png_set_gAMA, (png_const_structrp png_ptr,
2062     png_inforp info_ptr, double file_gamma))
2063 PNG_FIXED_EXPORT(140, void, png_set_gAMA_fixed, (png_const_structrp png_ptr,
2064     png_inforp info_ptr, png_fixed_point int_file_gamma))
2065 #endif
2066 
2067 #ifdef PNG_hIST_SUPPORTED
2068 PNG_EXPORT(141, png_uint_32, png_get_hIST, (png_const_structrp png_ptr,
2069     png_inforp info_ptr, png_uint_16p *hist));
2070 PNG_EXPORT(142, void, png_set_hIST, (png_const_structrp png_ptr,
2071     png_inforp info_ptr, png_const_uint_16p hist));
2072 #endif
2073 
2074 PNG_EXPORT(143, png_uint_32, png_get_IHDR, (png_const_structrp png_ptr,
2075     png_const_inforp info_ptr, png_uint_32 *width, png_uint_32 *height,
2076     int *bit_depth, int *color_type, int *interlace_method,
2077     int *compression_method, int *filter_method));
2078 
2079 PNG_EXPORT(144, void, png_set_IHDR, (png_const_structrp png_ptr,
2080     png_inforp info_ptr, png_uint_32 width, png_uint_32 height, int bit_depth,
2081     int color_type, int interlace_method, int compression_method,
2082     int filter_method));
2083 
2084 #ifdef PNG_oFFs_SUPPORTED
2085 PNG_EXPORT(145, png_uint_32, png_get_oFFs, (png_const_structrp png_ptr,
2086    png_const_inforp info_ptr, png_int_32 *offset_x, png_int_32 *offset_y,
2087    int *unit_type));
2088 #endif
2089 
2090 #ifdef PNG_oFFs_SUPPORTED
2091 PNG_EXPORT(146, void, png_set_oFFs, (png_const_structrp png_ptr,
2092     png_inforp info_ptr, png_int_32 offset_x, png_int_32 offset_y,
2093     int unit_type));
2094 #endif
2095 
2096 #ifdef PNG_pCAL_SUPPORTED
2097 PNG_EXPORT(147, png_uint_32, png_get_pCAL, (png_const_structrp png_ptr,
2098     png_inforp info_ptr, png_charp *purpose, png_int_32 *X0,
2099     png_int_32 *X1, int *type, int *nparams, png_charp *units,
2100     png_charpp *params));
2101 #endif
2102 
2103 #ifdef PNG_pCAL_SUPPORTED
2104 PNG_EXPORT(148, void, png_set_pCAL, (png_const_structrp png_ptr,
2105     png_inforp info_ptr, png_const_charp purpose, png_int_32 X0, png_int_32 X1,
2106     int type, int nparams, png_const_charp units, png_charpp params));
2107 #endif
2108 
2109 #ifdef PNG_pHYs_SUPPORTED
2110 PNG_EXPORT(149, png_uint_32, png_get_pHYs, (png_const_structrp png_ptr,
2111     png_const_inforp info_ptr, png_uint_32 *res_x, png_uint_32 *res_y,
2112     int *unit_type));
2113 #endif
2114 
2115 #ifdef PNG_pHYs_SUPPORTED
2116 PNG_EXPORT(150, void, png_set_pHYs, (png_const_structrp png_ptr,
2117     png_inforp info_ptr, png_uint_32 res_x, png_uint_32 res_y, int unit_type));
2118 #endif
2119 
2120 PNG_EXPORT(151, png_uint_32, png_get_PLTE, (png_const_structrp png_ptr,
2121    png_inforp info_ptr, png_colorp *palette, int *num_palette));
2122 
2123 PNG_EXPORT(152, void, png_set_PLTE, (png_structrp png_ptr,
2124     png_inforp info_ptr, png_const_colorp palette, int num_palette));
2125 
2126 #ifdef PNG_sBIT_SUPPORTED
2127 PNG_EXPORT(153, png_uint_32, png_get_sBIT, (png_const_structrp png_ptr,
2128     png_inforp info_ptr, png_color_8p *sig_bit));
2129 #endif
2130 
2131 #ifdef PNG_sBIT_SUPPORTED
2132 PNG_EXPORT(154, void, png_set_sBIT, (png_const_structrp png_ptr,
2133     png_inforp info_ptr, png_const_color_8p sig_bit));
2134 #endif
2135 
2136 #ifdef PNG_sRGB_SUPPORTED
2137 PNG_EXPORT(155, png_uint_32, png_get_sRGB, (png_const_structrp png_ptr,
2138     png_const_inforp info_ptr, int *file_srgb_intent));
2139 #endif
2140 
2141 #ifdef PNG_sRGB_SUPPORTED
2142 PNG_EXPORT(156, void, png_set_sRGB, (png_const_structrp png_ptr,
2143     png_inforp info_ptr, int srgb_intent));
2144 PNG_EXPORT(157, void, png_set_sRGB_gAMA_and_cHRM, (png_const_structrp png_ptr,
2145     png_inforp info_ptr, int srgb_intent));
2146 #endif
2147 
2148 #ifdef PNG_iCCP_SUPPORTED
2149 PNG_EXPORT(158, png_uint_32, png_get_iCCP, (png_const_structrp png_ptr,
2150     png_inforp info_ptr, png_charpp name, int *compression_type,
2151     png_bytepp profile, png_uint_32 *proflen));
2152 #endif
2153 
2154 #ifdef PNG_iCCP_SUPPORTED
2155 PNG_EXPORT(159, void, png_set_iCCP, (png_const_structrp png_ptr,
2156     png_inforp info_ptr, png_const_charp name, int compression_type,
2157     png_const_bytep profile, png_uint_32 proflen));
2158 #endif
2159 
2160 #ifdef PNG_sPLT_SUPPORTED
2161 PNG_EXPORT(160, int, png_get_sPLT, (png_const_structrp png_ptr,
2162     png_inforp info_ptr, png_sPLT_tpp entries));
2163 #endif
2164 
2165 #ifdef PNG_sPLT_SUPPORTED
2166 PNG_EXPORT(161, void, png_set_sPLT, (png_const_structrp png_ptr,
2167     png_inforp info_ptr, png_const_sPLT_tp entries, int nentries));
2168 #endif
2169 
2170 #ifdef PNG_TEXT_SUPPORTED
2171 /* png_get_text also returns the number of text chunks in *num_text */
2172 PNG_EXPORT(162, int, png_get_text, (png_const_structrp png_ptr,
2173     png_inforp info_ptr, png_textp *text_ptr, int *num_text));
2174 #endif
2175 
2176 /* Note while png_set_text() will accept a structure whose text,
2177  * language, and  translated keywords are NULL pointers, the structure
2178  * returned by png_get_text will always contain regular
2179  * zero-terminated C strings.  They might be empty strings but
2180  * they will never be NULL pointers.
2181  */
2182 
2183 #ifdef PNG_TEXT_SUPPORTED
2184 PNG_EXPORT(163, void, png_set_text, (png_const_structrp png_ptr,
2185     png_inforp info_ptr, png_const_textp text_ptr, int num_text));
2186 #endif
2187 
2188 #ifdef PNG_tIME_SUPPORTED
2189 PNG_EXPORT(164, png_uint_32, png_get_tIME, (png_const_structrp png_ptr,
2190     png_inforp info_ptr, png_timep *mod_time));
2191 #endif
2192 
2193 #ifdef PNG_tIME_SUPPORTED
2194 PNG_EXPORT(165, void, png_set_tIME, (png_const_structrp png_ptr,
2195     png_inforp info_ptr, png_const_timep mod_time));
2196 #endif
2197 
2198 #ifdef PNG_tRNS_SUPPORTED
2199 PNG_EXPORT(166, png_uint_32, png_get_tRNS, (png_const_structrp png_ptr,
2200     png_inforp info_ptr, png_bytep *trans_alpha, int *num_trans,
2201     png_color_16p *trans_color));
2202 #endif
2203 
2204 #ifdef PNG_tRNS_SUPPORTED
2205 PNG_EXPORT(167, void, png_set_tRNS, (png_structrp png_ptr,
2206     png_inforp info_ptr, png_const_bytep trans_alpha, int num_trans,
2207     png_const_color_16p trans_color));
2208 #endif
2209 
2210 #ifdef PNG_sCAL_SUPPORTED
2211 PNG_FP_EXPORT(168, png_uint_32, png_get_sCAL, (png_const_structrp png_ptr,
2212     png_const_inforp info_ptr, int *unit, double *width, double *height))
2213 #if defined(PNG_FLOATING_ARITHMETIC_SUPPORTED) || \
2214    defined(PNG_FLOATING_POINT_SUPPORTED)
2215 /* NOTE: this API is currently implemented using floating point arithmetic,
2216  * consequently it can only be used on systems with floating point support.
2217  * In any case the range of values supported by png_fixed_point is small and it
2218  * is highly recommended that png_get_sCAL_s be used instead.
2219  */
2220 PNG_FIXED_EXPORT(214, png_uint_32, png_get_sCAL_fixed,
2221     (png_const_structrp png_ptr, png_const_inforp info_ptr, int *unit,
2222     png_fixed_point *width, png_fixed_point *height))
2223 #endif
2224 PNG_EXPORT(169, png_uint_32, png_get_sCAL_s,
2225     (png_const_structrp png_ptr, png_const_inforp info_ptr, int *unit,
2226     png_charpp swidth, png_charpp sheight));
2227 
2228 PNG_FP_EXPORT(170, void, png_set_sCAL, (png_const_structrp png_ptr,
2229     png_inforp info_ptr, int unit, double width, double height))
2230 PNG_FIXED_EXPORT(213, void, png_set_sCAL_fixed, (png_const_structrp png_ptr,
2231    png_inforp info_ptr, int unit, png_fixed_point width,
2232    png_fixed_point height))
2233 PNG_EXPORT(171, void, png_set_sCAL_s, (png_const_structrp png_ptr,
2234     png_inforp info_ptr, int unit,
2235     png_const_charp swidth, png_const_charp sheight));
2236 #endif /* sCAL */
2237 
2238 #ifdef PNG_SET_UNKNOWN_CHUNKS_SUPPORTED
2239 /* Provide the default handling for all unknown chunks or, optionally, for
2240  * specific unknown chunks.
2241  *
2242  * NOTE: prior to 1.6.0 the handling specified for particular chunks on read was
2243  * ignored and the default was used, the per-chunk setting only had an effect on
2244  * write.  If you wish to have chunk-specific handling on read in code that must
2245  * work on earlier versions you must use a user chunk callback to specify the
2246  * desired handling (keep or discard.)
2247  *
2248  * The &#39;keep&#39; parameter is a PNG_HANDLE_CHUNK_ value as listed below.  The
2249  * parameter is interpreted as follows:
2250  *
2251  * READ:
2252  *    PNG_HANDLE_CHUNK_AS_DEFAULT:
2253  *       Known chunks: do normal libpng processing, do not keep the chunk (but
2254  *          see the comments below about PNG_HANDLE_AS_UNKNOWN_SUPPORTED)
2255  *       Unknown chunks: for a specific chunk use the global default, when used
2256  *          as the default discard the chunk data.
2257  *    PNG_HANDLE_CHUNK_NEVER:
2258  *       Discard the chunk data.
2259  *    PNG_HANDLE_CHUNK_IF_SAFE:
2260  *       Keep the chunk data if the chunk is not critical else raise a chunk
2261  *       error.
2262  *    PNG_HANDLE_CHUNK_ALWAYS:
2263  *       Keep the chunk data.
2264  *
2265  * If the chunk data is saved it can be retrieved using png_get_unknown_chunks,
2266  * below.  Notice that specifying &quot;AS_DEFAULT&quot; as a global default is equivalent
2267  * to specifying &quot;NEVER&quot;, however when &quot;AS_DEFAULT&quot; is used for specific chunks
2268  * it simply resets the behavior to the libpng default.
2269  *
2270  * INTERACTION WITH USER CHUNK CALLBACKS:
2271  * The per-chunk handling is always used when there is a png_user_chunk_ptr
2272  * callback and the callback returns 0; the chunk is then always stored *unless*
2273  * it is critical and the per-chunk setting is other than ALWAYS.  Notice that
2274  * the global default is *not* used in this case.  (In effect the per-chunk
2275  * value is incremented to at least IF_SAFE.)
2276  *
2277  * IMPORTANT NOTE: this behavior will change in libpng 1.7 - the global and
2278  * per-chunk defaults will be honored.  If you want to preserve the current
2279  * behavior when your callback returns 0 you must set PNG_HANDLE_CHUNK_IF_SAFE
2280  * as the default - if you don&#39;t do this libpng 1.6 will issue a warning.
2281  *
2282  * If you want unhandled unknown chunks to be discarded in libpng 1.6 and
2283  * earlier simply return &#39;1&#39; (handled).
2284  *
2285  * PNG_HANDLE_AS_UNKNOWN_SUPPORTED:
2286  *    If this is *not* set known chunks will always be handled by libpng and
2287  *    will never be stored in the unknown chunk list.  Known chunks listed to
2288  *    png_set_keep_unknown_chunks will have no effect.  If it is set then known
2289  *    chunks listed with a keep other than AS_DEFAULT will *never* be processed
2290  *    by libpng, in addition critical chunks must either be processed by the
2291  *    callback or saved.
2292  *
2293  *    The IHDR and IEND chunks must not be listed.  Because this turns off the
2294  *    default handling for chunks that would otherwise be recognized the
2295  *    behavior of libpng transformations may well become incorrect!
2296  *
2297  * WRITE:
2298  *    When writing chunks the options only apply to the chunks specified by
2299  *    png_set_unknown_chunks (below), libpng will *always* write known chunks
2300  *    required by png_set_ calls and will always write the core critical chunks
2301  *    (as required for PLTE).
2302  *
2303  *    Each chunk in the png_set_unknown_chunks list is looked up in the
2304  *    png_set_keep_unknown_chunks list to find the keep setting, this is then
2305  *    interpreted as follows:
2306  *
2307  *    PNG_HANDLE_CHUNK_AS_DEFAULT:
2308  *       Write safe-to-copy chunks and write other chunks if the global
2309  *       default is set to _ALWAYS, otherwise don&#39;t write this chunk.
2310  *    PNG_HANDLE_CHUNK_NEVER:
2311  *       Do not write the chunk.
2312  *    PNG_HANDLE_CHUNK_IF_SAFE:
2313  *       Write the chunk if it is safe-to-copy, otherwise do not write it.
2314  *    PNG_HANDLE_CHUNK_ALWAYS:
2315  *       Write the chunk.
2316  *
2317  * Note that the default behavior is effectively the opposite of the read case -
2318  * in read unknown chunks are not stored by default, in write they are written
2319  * by default.  Also the behavior of PNG_HANDLE_CHUNK_IF_SAFE is very different
2320  * - on write the safe-to-copy bit is checked, on read the critical bit is
2321  * checked and on read if the chunk is critical an error will be raised.
2322  *
2323  * num_chunks:
2324  * ===========
2325  *    If num_chunks is positive, then the &quot;keep&quot; parameter specifies the manner
2326  *    for handling only those chunks appearing in the chunk_list array,
2327  *    otherwise the chunk list array is ignored.
2328  *
2329  *    If num_chunks is 0 the &quot;keep&quot; parameter specifies the default behavior for
2330  *    unknown chunks, as described above.
2331  *
2332  *    If num_chunks is negative, then the &quot;keep&quot; parameter specifies the manner
2333  *    for handling all unknown chunks plus all chunks recognized by libpng
2334  *    except for the IHDR, PLTE, tRNS, IDAT, and IEND chunks (which continue to
2335  *    be processed by libpng.
2336  */
2337 #ifdef PNG_HANDLE_AS_UNKNOWN_SUPPORTED
2338 PNG_EXPORT(172, void, png_set_keep_unknown_chunks, (png_structrp png_ptr,
2339     int keep, png_const_bytep chunk_list, int num_chunks));
2340 #endif /* HANDLE_AS_UNKNOWN */
2341 
2342 /* The &quot;keep&quot; PNG_HANDLE_CHUNK_ parameter for the specified chunk is returned;
2343  * the result is therefore true (non-zero) if special handling is required,
2344  * false for the default handling.
2345  */
2346 PNG_EXPORT(173, int, png_handle_as_unknown, (png_const_structrp png_ptr,
2347     png_const_bytep chunk_name));
2348 #endif /* SET_UNKNOWN_CHUNKS */
2349 
2350 #ifdef PNG_STORE_UNKNOWN_CHUNKS_SUPPORTED
2351 PNG_EXPORT(174, void, png_set_unknown_chunks, (png_const_structrp png_ptr,
2352     png_inforp info_ptr, png_const_unknown_chunkp unknowns,
2353     int num_unknowns));
2354    /* NOTE: prior to 1.6.0 this routine set the &#39;location&#39; field of the added
2355     * unknowns to the location currently stored in the png_struct.  This is
2356     * invariably the wrong value on write.  To fix this call the following API
2357     * for each chunk in the list with the correct location.  If you know your
2358     * code won&#39;t be compiled on earlier versions you can rely on
2359     * png_set_unknown_chunks(write-ptr, png_get_unknown_chunks(read-ptr)) doing
2360     * the correct thing.
2361     */
2362 
2363 PNG_EXPORT(175, void, png_set_unknown_chunk_location,
2364     (png_const_structrp png_ptr, png_inforp info_ptr, int chunk, int location));
2365 
2366 PNG_EXPORT(176, int, png_get_unknown_chunks, (png_const_structrp png_ptr,
2367     png_inforp info_ptr, png_unknown_chunkpp entries));
2368 #endif
2369 
2370 /* Png_free_data() will turn off the &quot;valid&quot; flag for anything it frees.
2371  * If you need to turn it off for a chunk that your application has freed,
2372  * you can use png_set_invalid(png_ptr, info_ptr, PNG_INFO_CHNK);
2373  */
2374 PNG_EXPORT(177, void, png_set_invalid, (png_const_structrp png_ptr,
2375     png_inforp info_ptr, int mask));
2376 
2377 #ifdef PNG_INFO_IMAGE_SUPPORTED
2378 /* The &quot;params&quot; pointer is currently not used and is for future expansion. */
2379 #ifdef PNG_SEQUENTIAL_READ_SUPPORTED
2380 PNG_EXPORT(178, void, png_read_png, (png_structrp png_ptr, png_inforp info_ptr,
2381     int transforms, png_voidp params));
2382 #endif
2383 #ifdef PNG_WRITE_SUPPORTED
2384 PNG_EXPORT(179, void, png_write_png, (png_structrp png_ptr, png_inforp info_ptr,
2385     int transforms, png_voidp params));
2386 #endif
2387 #endif
2388 
2389 PNG_EXPORT(180, png_const_charp, png_get_copyright,
2390     (png_const_structrp png_ptr));
2391 PNG_EXPORT(181, png_const_charp, png_get_header_ver,
2392     (png_const_structrp png_ptr));
2393 PNG_EXPORT(182, png_const_charp, png_get_header_version,
2394     (png_const_structrp png_ptr));
2395 PNG_EXPORT(183, png_const_charp, png_get_libpng_ver,
2396     (png_const_structrp png_ptr));
2397 
2398 #ifdef PNG_MNG_FEATURES_SUPPORTED
2399 PNG_EXPORT(184, png_uint_32, png_permit_mng_features, (png_structrp png_ptr,
2400     png_uint_32 mng_features_permitted));
2401 #endif
2402 
2403 /* For use in png_set_keep_unknown, added to version 1.2.6 */
2404 #define PNG_HANDLE_CHUNK_AS_DEFAULT   0
2405 #define PNG_HANDLE_CHUNK_NEVER        1
2406 #define PNG_HANDLE_CHUNK_IF_SAFE      2
2407 #define PNG_HANDLE_CHUNK_ALWAYS       3
2408 #define PNG_HANDLE_CHUNK_LAST         4
2409 
2410 /* Strip the prepended error numbers (&quot;#nnn &quot;) from error and warning
2411  * messages before passing them to the error or warning handler.
2412  */
2413 #ifdef PNG_ERROR_NUMBERS_SUPPORTED
2414 PNG_EXPORT(185, void, png_set_strip_error_numbers, (png_structrp png_ptr,
2415     png_uint_32 strip_mode));
2416 #endif
2417 
2418 /* Added in libpng-1.2.6 */
2419 #ifdef PNG_SET_USER_LIMITS_SUPPORTED
2420 PNG_EXPORT(186, void, png_set_user_limits, (png_structrp png_ptr,
2421     png_uint_32 user_width_max, png_uint_32 user_height_max));
2422 PNG_EXPORT(187, png_uint_32, png_get_user_width_max,
2423     (png_const_structrp png_ptr));
2424 PNG_EXPORT(188, png_uint_32, png_get_user_height_max,
2425     (png_const_structrp png_ptr));
2426 /* Added in libpng-1.4.0 */
2427 PNG_EXPORT(189, void, png_set_chunk_cache_max, (png_structrp png_ptr,
2428     png_uint_32 user_chunk_cache_max));
2429 PNG_EXPORT(190, png_uint_32, png_get_chunk_cache_max,
2430     (png_const_structrp png_ptr));
2431 /* Added in libpng-1.4.1 */
2432 PNG_EXPORT(191, void, png_set_chunk_malloc_max, (png_structrp png_ptr,
2433     png_alloc_size_t user_chunk_cache_max));
2434 PNG_EXPORT(192, png_alloc_size_t, png_get_chunk_malloc_max,
2435     (png_const_structrp png_ptr));
2436 #endif
2437 
2438 #if defined(PNG_INCH_CONVERSIONS_SUPPORTED)
2439 PNG_EXPORT(193, png_uint_32, png_get_pixels_per_inch,
2440     (png_const_structrp png_ptr, png_const_inforp info_ptr));
2441 
2442 PNG_EXPORT(194, png_uint_32, png_get_x_pixels_per_inch,
2443     (png_const_structrp png_ptr, png_const_inforp info_ptr));
2444 
2445 PNG_EXPORT(195, png_uint_32, png_get_y_pixels_per_inch,
2446     (png_const_structrp png_ptr, png_const_inforp info_ptr));
2447 
2448 PNG_FP_EXPORT(196, float, png_get_x_offset_inches,
2449     (png_const_structrp png_ptr, png_const_inforp info_ptr))
2450 #ifdef PNG_FIXED_POINT_SUPPORTED /* otherwise not implemented. */
2451 PNG_FIXED_EXPORT(211, png_fixed_point, png_get_x_offset_inches_fixed,
2452     (png_const_structrp png_ptr, png_const_inforp info_ptr))
2453 #endif
2454 
2455 PNG_FP_EXPORT(197, float, png_get_y_offset_inches, (png_const_structrp png_ptr,
2456     png_const_inforp info_ptr))
2457 #ifdef PNG_FIXED_POINT_SUPPORTED /* otherwise not implemented. */
2458 PNG_FIXED_EXPORT(212, png_fixed_point, png_get_y_offset_inches_fixed,
2459     (png_const_structrp png_ptr, png_const_inforp info_ptr))
2460 #endif
2461 
2462 #  ifdef PNG_pHYs_SUPPORTED
2463 PNG_EXPORT(198, png_uint_32, png_get_pHYs_dpi, (png_const_structrp png_ptr,
2464     png_const_inforp info_ptr, png_uint_32 *res_x, png_uint_32 *res_y,
2465     int *unit_type));
2466 #  endif /* pHYs */
2467 #endif  /* INCH_CONVERSIONS */
2468 
2469 /* Added in libpng-1.4.0 */
2470 #ifdef PNG_IO_STATE_SUPPORTED
2471 PNG_EXPORT(199, png_uint_32, png_get_io_state, (png_const_structrp png_ptr));
2472 
2473 /* Removed from libpng 1.6; use png_get_io_chunk_type. */
2474 PNG_REMOVED(200, png_const_bytep, png_get_io_chunk_name, (png_structrp png_ptr),
2475     PNG_DEPRECATED)
2476 
2477 PNG_EXPORT(216, png_uint_32, png_get_io_chunk_type,
2478     (png_const_structrp png_ptr));
2479 
2480 /* The flags returned by png_get_io_state() are the following: */
2481 #  define PNG_IO_NONE        0x0000   /* no I/O at this moment */
2482 #  define PNG_IO_READING     0x0001   /* currently reading */
2483 #  define PNG_IO_WRITING     0x0002   /* currently writing */
2484 #  define PNG_IO_SIGNATURE   0x0010   /* currently at the file signature */
2485 #  define PNG_IO_CHUNK_HDR   0x0020   /* currently at the chunk header */
2486 #  define PNG_IO_CHUNK_DATA  0x0040   /* currently at the chunk data */
2487 #  define PNG_IO_CHUNK_CRC   0x0080   /* currently at the chunk crc */
2488 #  define PNG_IO_MASK_OP     0x000f   /* current operation: reading/writing */
2489 #  define PNG_IO_MASK_LOC    0x00f0   /* current location: sig/hdr/data/crc */
2490 #endif /* IO_STATE */
2491 
2492 /* Interlace support.  The following macros are always defined so that if
2493  * libpng interlace handling is turned off the macros may be used to handle
2494  * interlaced images within the application.
2495  */
2496 #define PNG_INTERLACE_ADAM7_PASSES 7
2497 
2498 /* Two macros to return the first row and first column of the original,
2499  * full, image which appears in a given pass.  &#39;pass&#39; is in the range 0
2500  * to 6 and the result is in the range 0 to 7.
2501  */
2502 #define PNG_PASS_START_ROW(pass) (((1&amp;~(pass))&lt;&lt;(3-((pass)&gt;&gt;1)))&amp;7)
2503 #define PNG_PASS_START_COL(pass) (((1&amp; (pass))&lt;&lt;(3-(((pass)+1)&gt;&gt;1)))&amp;7)
2504 
2505 /* A macro to return the offset between pixels in the output row for a pair of
2506  * pixels in the input - effectively the inverse of the &#39;COL_SHIFT&#39; macro that
2507  * follows.  Note that ROW_OFFSET is the offset from one row to the next whereas
2508  * COL_OFFSET is from one column to the next, within a row.
2509  */
2510 #define PNG_PASS_ROW_OFFSET(pass) ((pass)&gt;2?(8&gt;&gt;(((pass)-1)&gt;&gt;1)):8)
2511 #define PNG_PASS_COL_OFFSET(pass) (1&lt;&lt;((7-(pass))&gt;&gt;1))
2512 
2513 /* Two macros to help evaluate the number of rows or columns in each
2514  * pass.  This is expressed as a shift - effectively log2 of the number or
2515  * rows or columns in each 8x8 tile of the original image.
2516  */
2517 #define PNG_PASS_ROW_SHIFT(pass) ((pass)&gt;2?(8-(pass))&gt;&gt;1:3)
2518 #define PNG_PASS_COL_SHIFT(pass) ((pass)&gt;1?(7-(pass))&gt;&gt;1:3)
2519 
2520 /* Hence two macros to determine the number of rows or columns in a given
2521  * pass of an image given its height or width.  In fact these macros may
2522  * return non-zero even though the sub-image is empty, because the other
2523  * dimension may be empty for a small image.
2524  */
2525 #define PNG_PASS_ROWS(height, pass) (((height)+(((1&lt;&lt;PNG_PASS_ROW_SHIFT(pass))\
2526    -1)-PNG_PASS_START_ROW(pass)))&gt;&gt;PNG_PASS_ROW_SHIFT(pass))
2527 #define PNG_PASS_COLS(width, pass) (((width)+(((1&lt;&lt;PNG_PASS_COL_SHIFT(pass))\
2528    -1)-PNG_PASS_START_COL(pass)))&gt;&gt;PNG_PASS_COL_SHIFT(pass))
2529 
2530 /* For the reader row callbacks (both progressive and sequential) it is
2531  * necessary to find the row in the output image given a row in an interlaced
2532  * image, so two more macros:
2533  */
2534 #define PNG_ROW_FROM_PASS_ROW(y_in, pass) \
2535    (((y_in)&lt;&lt;PNG_PASS_ROW_SHIFT(pass))+PNG_PASS_START_ROW(pass))
2536 #define PNG_COL_FROM_PASS_COL(x_in, pass) \
2537    (((x_in)&lt;&lt;PNG_PASS_COL_SHIFT(pass))+PNG_PASS_START_COL(pass))
2538 
2539 /* Two macros which return a boolean (0 or 1) saying whether the given row
2540  * or column is in a particular pass.  These use a common utility macro that
2541  * returns a mask for a given pass - the offset &#39;off&#39; selects the row or
2542  * column version.  The mask has the appropriate bit set for each column in
2543  * the tile.
2544  */
2545 #define PNG_PASS_MASK(pass,off) ( \
2546    ((0x110145AF&gt;&gt;(((7-(off))-(pass))&lt;&lt;2)) &amp; 0xF) | \
2547    ((0x01145AF0&gt;&gt;(((7-(off))-(pass))&lt;&lt;2)) &amp; 0xF0))
2548 
2549 #define PNG_ROW_IN_INTERLACE_PASS(y, pass) \
2550    ((PNG_PASS_MASK(pass,0) &gt;&gt; ((y)&amp;7)) &amp; 1)
2551 #define PNG_COL_IN_INTERLACE_PASS(x, pass) \
2552    ((PNG_PASS_MASK(pass,1) &gt;&gt; ((x)&amp;7)) &amp; 1)
2553 
2554 #ifdef PNG_READ_COMPOSITE_NODIV_SUPPORTED
2555 /* With these routines we avoid an integer divide, which will be slower on
2556  * most machines.  However, it does take more operations than the corresponding
2557  * divide method, so it may be slower on a few RISC systems.  There are two
2558  * shifts (by 8 or 16 bits) and an addition, versus a single integer divide.
2559  *
2560  * Note that the rounding factors are NOT supposed to be the same!  128 and
2561  * 32768 are correct for the NODIV code; 127 and 32767 are correct for the
2562  * standard method.
2563  *
2564  * [Optimized code by Greg Roelofs and Mark Adler...blame us for bugs. :-) ]
2565  */
2566 
2567  /* fg and bg should be in `gamma 1.0&#39; space; alpha is the opacity */
2568 
2569 #  define png_composite(composite, fg, alpha, bg)        \
2570    {                                                     \
2571       png_uint_16 temp = (png_uint_16)((png_uint_16)(fg) \
2572           * (png_uint_16)(alpha)                         \
2573           + (png_uint_16)(bg)*(png_uint_16)(255          \
2574           - (png_uint_16)(alpha)) + 128);                \
2575       (composite) = (png_byte)(((temp + (temp &gt;&gt; 8)) &gt;&gt; 8) &amp; 0xff); \
2576    }
2577 
2578 #  define png_composite_16(composite, fg, alpha, bg)     \
2579    {                                                     \
2580       png_uint_32 temp = (png_uint_32)((png_uint_32)(fg) \
2581           * (png_uint_32)(alpha)                         \
2582           + (png_uint_32)(bg)*(65535                     \
2583           - (png_uint_32)(alpha)) + 32768);              \
2584       (composite) = (png_uint_16)(0xffff &amp; ((temp + (temp &gt;&gt; 16)) &gt;&gt; 16)); \
2585    }
2586 
2587 #else  /* Standard method using integer division */
2588 
2589 #  define png_composite(composite, fg, alpha, bg)                      \
2590    (composite) =                                                       \
2591        (png_byte)(0xff &amp; (((png_uint_16)(fg) * (png_uint_16)(alpha) +  \
2592        (png_uint_16)(bg) * (png_uint_16)(255 - (png_uint_16)(alpha)) + \
2593        127) / 255))
2594 
2595 #  define png_composite_16(composite, fg, alpha, bg)                       \
2596    (composite) =                                                           \
2597        (png_uint_16)(0xffff &amp; (((png_uint_32)(fg) * (png_uint_32)(alpha) + \
2598        (png_uint_32)(bg)*(png_uint_32)(65535 - (png_uint_32)(alpha)) +     \
2599        32767) / 65535))
2600 #endif /* READ_COMPOSITE_NODIV */
2601 
2602 #ifdef PNG_READ_INT_FUNCTIONS_SUPPORTED
2603 PNG_EXPORT(201, png_uint_32, png_get_uint_32, (png_const_bytep buf));
2604 PNG_EXPORT(202, png_uint_16, png_get_uint_16, (png_const_bytep buf));
2605 PNG_EXPORT(203, png_int_32, png_get_int_32, (png_const_bytep buf));
2606 #endif
2607 
2608 PNG_EXPORT(204, png_uint_32, png_get_uint_31, (png_const_structrp png_ptr,
2609     png_const_bytep buf));
2610 /* No png_get_int_16 -- may be added if there&#39;s a real need for it. */
2611 
2612 /* Place a 32-bit number into a buffer in PNG byte order (big-endian). */
2613 #ifdef PNG_WRITE_INT_FUNCTIONS_SUPPORTED
2614 PNG_EXPORT(205, void, png_save_uint_32, (png_bytep buf, png_uint_32 i));
2615 #endif
2616 #ifdef PNG_SAVE_INT_32_SUPPORTED
2617 PNG_EXPORT(206, void, png_save_int_32, (png_bytep buf, png_int_32 i));
2618 #endif
2619 
2620 /* Place a 16-bit number into a buffer in PNG byte order.
2621  * The parameter is declared unsigned int, not png_uint_16,
2622  * just to avoid potential problems on pre-ANSI C compilers.
2623  */
2624 #ifdef PNG_WRITE_INT_FUNCTIONS_SUPPORTED
2625 PNG_EXPORT(207, void, png_save_uint_16, (png_bytep buf, unsigned int i));
2626 /* No png_save_int_16 -- may be added if there&#39;s a real need for it. */
2627 #endif
2628 
2629 #ifdef PNG_USE_READ_MACROS
2630 /* Inline macros to do direct reads of bytes from the input buffer.
2631  * The png_get_int_32() routine assumes we are using two&#39;s complement
2632  * format for negative values, which is almost certainly true.
2633  */
2634 #  define PNG_get_uint_32(buf) \
2635    (((png_uint_32)(*(buf)) &lt;&lt; 24) + \
2636     ((png_uint_32)(*((buf) + 1)) &lt;&lt; 16) + \
2637     ((png_uint_32)(*((buf) + 2)) &lt;&lt; 8) + \
2638     ((png_uint_32)(*((buf) + 3))))
2639 
2640    /* From libpng-1.4.0 until 1.4.4, the png_get_uint_16 macro (but not the
2641     * function) incorrectly returned a value of type png_uint_32.
2642     */
2643 #  define PNG_get_uint_16(buf) \
2644    ((png_uint_16) \
2645     (((unsigned int)(*(buf)) &lt;&lt; 8) + \
2646     ((unsigned int)(*((buf) + 1)))))
2647 
2648 #  define PNG_get_int_32(buf) \
2649    ((png_int_32)((*(buf) &amp; 0x80) \
2650     ? -((png_int_32)(((png_get_uint_32(buf)^0xffffffffU)+1U)&amp;0x7fffffffU)) \
2651     : (png_int_32)png_get_uint_32(buf)))
2652 
2653 /* If PNG_PREFIX is defined the same thing as below happens in pnglibconf.h,
2654  * but defining a macro name prefixed with PNG_PREFIX.
2655  */
2656 #  ifndef PNG_PREFIX
2657 #    define png_get_uint_32(buf) PNG_get_uint_32(buf)
2658 #    define png_get_uint_16(buf) PNG_get_uint_16(buf)
2659 #    define png_get_int_32(buf)  PNG_get_int_32(buf)
2660 #  endif
2661 #else
2662 #  ifdef PNG_PREFIX
2663    /* No macros; revert to the (redefined) function */
2664 #    define PNG_get_uint_32 (png_get_uint_32)
2665 #    define PNG_get_uint_16 (png_get_uint_16)
2666 #    define PNG_get_int_32  (png_get_int_32)
2667 #  endif
2668 #endif
2669 
2670 #ifdef PNG_CHECK_FOR_INVALID_INDEX_SUPPORTED
2671 PNG_EXPORT(242, void, png_set_check_for_invalid_index,
2672     (png_structrp png_ptr, int allowed));
2673 #  ifdef PNG_GET_PALETTE_MAX_SUPPORTED
2674 PNG_EXPORT(243, int, png_get_palette_max, (png_const_structp png_ptr,
2675     png_const_infop info_ptr));
2676 #  endif
2677 #endif /* CHECK_FOR_INVALID_INDEX */
2678 
2679 /*******************************************************************************
2680  * Section 5: SIMPLIFIED API
2681  *******************************************************************************
2682  *
2683  * Please read the documentation in libpng-manual.txt (TODO: write said
2684  * documentation) if you don&#39;t understand what follows.
2685  *
2686  * The simplified API hides the details of both libpng and the PNG file format
2687  * itself.  It allows PNG files to be read into a very limited number of
2688  * in-memory bitmap formats or to be written from the same formats.  If these
2689  * formats do not accommodate your needs then you can, and should, use the more
2690  * sophisticated APIs above - these support a wide variety of in-memory formats
2691  * and a wide variety of sophisticated transformations to those formats as well
2692  * as a wide variety of APIs to manipulate ancillary information.
2693  *
2694  * To read a PNG file using the simplified API:
2695  *
2696  * 1) Declare a &#39;png_image&#39; structure (see below) on the stack, set the
2697  *    version field to PNG_IMAGE_VERSION and the &#39;opaque&#39; pointer to NULL
2698  *    (this is REQUIRED, your program may crash if you don&#39;t do it.)
2699  * 2) Call the appropriate png_image_begin_read... function.
2700  * 3) Set the png_image &#39;format&#39; member to the required sample format.
2701  * 4) Allocate a buffer for the image and, if required, the color-map.
2702  * 5) Call png_image_finish_read to read the image and, if required, the
2703  *    color-map into your buffers.
2704  *
2705  * There are no restrictions on the format of the PNG input itself; all valid
2706  * color types, bit depths, and interlace methods are acceptable, and the
2707  * input image is transformed as necessary to the requested in-memory format
2708  * during the png_image_finish_read() step.  The only caveat is that if you
2709  * request a color-mapped image from a PNG that is full-color or makes
2710  * complex use of an alpha channel the transformation is extremely lossy and the
2711  * result may look terrible.
2712  *
2713  * To write a PNG file using the simplified API:
2714  *
2715  * 1) Declare a &#39;png_image&#39; structure on the stack and memset() it to all zero.
2716  * 2) Initialize the members of the structure that describe the image, setting
2717  *    the &#39;format&#39; member to the format of the image samples.
2718  * 3) Call the appropriate png_image_write... function with a pointer to the
2719  *    image and, if necessary, the color-map to write the PNG data.
2720  *
2721  * png_image is a structure that describes the in-memory format of an image
2722  * when it is being read or defines the in-memory format of an image that you
2723  * need to write:
2724  */
2725 #if defined(PNG_SIMPLIFIED_READ_SUPPORTED) || \
2726     defined(PNG_SIMPLIFIED_WRITE_SUPPORTED)
2727 
2728 #define PNG_IMAGE_VERSION 1
2729 
2730 typedef struct png_control *png_controlp;
2731 typedef struct
2732 {
2733    png_controlp opaque;    /* Initialize to NULL, free with png_image_free */
2734    png_uint_32  version;   /* Set to PNG_IMAGE_VERSION */
2735    png_uint_32  width;     /* Image width in pixels (columns) */
2736    png_uint_32  height;    /* Image height in pixels (rows) */
2737    png_uint_32  format;    /* Image format as defined below */
2738    png_uint_32  flags;     /* A bit mask containing informational flags */
2739    png_uint_32  colormap_entries;
2740                            /* Number of entries in the color-map */
2741 
2742    /* In the event of an error or warning the following field will be set to a
2743     * non-zero value and the &#39;message&#39; field will contain a &#39;\0&#39; terminated
2744     * string with the libpng error or warning message.  If both warnings and
2745     * an error were encountered, only the error is recorded.  If there
2746     * are multiple warnings, only the first one is recorded.
2747     *
2748     * The upper 30 bits of this value are reserved, the low two bits contain
2749     * a value as follows:
2750     */
2751 #  define PNG_IMAGE_WARNING 1
2752 #  define PNG_IMAGE_ERROR 2
2753    /*
2754     * The result is a two-bit code such that a value more than 1 indicates
2755     * a failure in the API just called:
2756     *
2757     *    0 - no warning or error
2758     *    1 - warning
2759     *    2 - error
2760     *    3 - error preceded by warning
2761     */
2762 #  define PNG_IMAGE_FAILED(png_cntrl) ((((png_cntrl).warning_or_error)&amp;0x03)&gt;1)
2763 
2764    png_uint_32  warning_or_error;
2765 
2766    char         message[64];
2767 } png_image, *png_imagep;
2768 
2769 /* The samples of the image have one to four channels whose components have
2770  * original values in the range 0 to 1.0:
2771  *
2772  * 1: A single gray or luminance channel (G).
2773  * 2: A gray/luminance channel and an alpha channel (GA).
2774  * 3: Three red, green, blue color channels (RGB).
2775  * 4: Three color channels and an alpha channel (RGBA).
2776  *
2777  * The components are encoded in one of two ways:
2778  *
2779  * a) As a small integer, value 0..255, contained in a single byte.  For the
2780  * alpha channel the original value is simply value/255.  For the color or
2781  * luminance channels the value is encoded according to the sRGB specification
2782  * and matches the 8-bit format expected by typical display devices.
2783  *
2784  * The color/gray channels are not scaled (pre-multiplied) by the alpha
2785  * channel and are suitable for passing to color management software.
2786  *
2787  * b) As a value in the range 0..65535, contained in a 2-byte integer.  All
2788  * channels can be converted to the original value by dividing by 65535; all
2789  * channels are linear.  Color channels use the RGB encoding (RGB end-points) of
2790  * the sRGB specification.  This encoding is identified by the
2791  * PNG_FORMAT_FLAG_LINEAR flag below.
2792  *
2793  * When the simplified API needs to convert between sRGB and linear colorspaces,
2794  * the actual sRGB transfer curve defined in the sRGB specification (see the
<a name="41" id="anc41"></a><span class="line-modified">2795  * article at https://en.wikipedia.org/wiki/SRGB) is used, not the gamma=1/2.2</span>
2796  * approximation used elsewhere in libpng.
2797  *
2798  * When an alpha channel is present it is expected to denote pixel coverage
2799  * of the color or luminance channels and is returned as an associated alpha
2800  * channel: the color/gray channels are scaled (pre-multiplied) by the alpha
2801  * value.
2802  *
2803  * The samples are either contained directly in the image data, between 1 and 8
2804  * bytes per pixel according to the encoding, or are held in a color-map indexed
2805  * by bytes in the image data.  In the case of a color-map the color-map entries
2806  * are individual samples, encoded as above, and the image data has one byte per
2807  * pixel to select the relevant sample from the color-map.
2808  */
2809 
2810 /* PNG_FORMAT_*
2811  *
2812  * #defines to be used in png_image::format.  Each #define identifies a
2813  * particular layout of sample data and, if present, alpha values.  There are
2814  * separate defines for each of the two component encodings.
2815  *
2816  * A format is built up using single bit flag values.  All combinations are
2817  * valid.  Formats can be built up from the flag values or you can use one of
2818  * the predefined values below.  When testing formats always use the FORMAT_FLAG
2819  * macros to test for individual features - future versions of the library may
2820  * add new flags.
2821  *
2822  * When reading or writing color-mapped images the format should be set to the
2823  * format of the entries in the color-map then png_image_{read,write}_colormap
2824  * called to read or write the color-map and set the format correctly for the
2825  * image data.  Do not set the PNG_FORMAT_FLAG_COLORMAP bit directly!
2826  *
2827  * NOTE: libpng can be built with particular features disabled. If you see
2828  * compiler errors because the definition of one of the following flags has been
2829  * compiled out it is because libpng does not have the required support.  It is
2830  * possible, however, for the libpng configuration to enable the format on just
2831  * read or just write; in that case you may see an error at run time.  You can
2832  * guard against this by checking for the definition of the appropriate
2833  * &quot;_SUPPORTED&quot; macro, one of:
2834  *
2835  *    PNG_SIMPLIFIED_{READ,WRITE}_{BGR,AFIRST}_SUPPORTED
2836  */
2837 #define PNG_FORMAT_FLAG_ALPHA    0x01U /* format with an alpha channel */
2838 #define PNG_FORMAT_FLAG_COLOR    0x02U /* color format: otherwise grayscale */
2839 #define PNG_FORMAT_FLAG_LINEAR   0x04U /* 2-byte channels else 1-byte */
2840 #define PNG_FORMAT_FLAG_COLORMAP 0x08U /* image data is color-mapped */
2841 
2842 #ifdef PNG_FORMAT_BGR_SUPPORTED
2843 #  define PNG_FORMAT_FLAG_BGR    0x10U /* BGR colors, else order is RGB */
2844 #endif
2845 
2846 #ifdef PNG_FORMAT_AFIRST_SUPPORTED
2847 #  define PNG_FORMAT_FLAG_AFIRST 0x20U /* alpha channel comes first */
2848 #endif
2849 
2850 #define PNG_FORMAT_FLAG_ASSOCIATED_ALPHA 0x40U /* alpha channel is associated */
2851 
2852 /* Commonly used formats have predefined macros.
2853  *
2854  * First the single byte (sRGB) formats:
2855  */
2856 #define PNG_FORMAT_GRAY 0
2857 #define PNG_FORMAT_GA   PNG_FORMAT_FLAG_ALPHA
2858 #define PNG_FORMAT_AG   (PNG_FORMAT_GA|PNG_FORMAT_FLAG_AFIRST)
2859 #define PNG_FORMAT_RGB  PNG_FORMAT_FLAG_COLOR
2860 #define PNG_FORMAT_BGR  (PNG_FORMAT_FLAG_COLOR|PNG_FORMAT_FLAG_BGR)
2861 #define PNG_FORMAT_RGBA (PNG_FORMAT_RGB|PNG_FORMAT_FLAG_ALPHA)
2862 #define PNG_FORMAT_ARGB (PNG_FORMAT_RGBA|PNG_FORMAT_FLAG_AFIRST)
2863 #define PNG_FORMAT_BGRA (PNG_FORMAT_BGR|PNG_FORMAT_FLAG_ALPHA)
2864 #define PNG_FORMAT_ABGR (PNG_FORMAT_BGRA|PNG_FORMAT_FLAG_AFIRST)
2865 
2866 /* Then the linear 2-byte formats.  When naming these &quot;Y&quot; is used to
2867  * indicate a luminance (gray) channel.
2868  */
2869 #define PNG_FORMAT_LINEAR_Y PNG_FORMAT_FLAG_LINEAR
2870 #define PNG_FORMAT_LINEAR_Y_ALPHA (PNG_FORMAT_FLAG_LINEAR|PNG_FORMAT_FLAG_ALPHA)
2871 #define PNG_FORMAT_LINEAR_RGB (PNG_FORMAT_FLAG_LINEAR|PNG_FORMAT_FLAG_COLOR)
2872 #define PNG_FORMAT_LINEAR_RGB_ALPHA \
2873    (PNG_FORMAT_FLAG_LINEAR|PNG_FORMAT_FLAG_COLOR|PNG_FORMAT_FLAG_ALPHA)
2874 
2875 /* With color-mapped formats the image data is one byte for each pixel, the byte
2876  * is an index into the color-map which is formatted as above.  To obtain a
2877  * color-mapped format it is sufficient just to add the PNG_FOMAT_FLAG_COLORMAP
2878  * to one of the above definitions, or you can use one of the definitions below.
2879  */
2880 #define PNG_FORMAT_RGB_COLORMAP  (PNG_FORMAT_RGB|PNG_FORMAT_FLAG_COLORMAP)
2881 #define PNG_FORMAT_BGR_COLORMAP  (PNG_FORMAT_BGR|PNG_FORMAT_FLAG_COLORMAP)
2882 #define PNG_FORMAT_RGBA_COLORMAP (PNG_FORMAT_RGBA|PNG_FORMAT_FLAG_COLORMAP)
2883 #define PNG_FORMAT_ARGB_COLORMAP (PNG_FORMAT_ARGB|PNG_FORMAT_FLAG_COLORMAP)
2884 #define PNG_FORMAT_BGRA_COLORMAP (PNG_FORMAT_BGRA|PNG_FORMAT_FLAG_COLORMAP)
2885 #define PNG_FORMAT_ABGR_COLORMAP (PNG_FORMAT_ABGR|PNG_FORMAT_FLAG_COLORMAP)
2886 
2887 /* PNG_IMAGE macros
2888  *
2889  * These are convenience macros to derive information from a png_image
2890  * structure.  The PNG_IMAGE_SAMPLE_ macros return values appropriate to the
2891  * actual image sample values - either the entries in the color-map or the
2892  * pixels in the image.  The PNG_IMAGE_PIXEL_ macros return corresponding values
2893  * for the pixels and will always return 1 for color-mapped formats.  The
2894  * remaining macros return information about the rows in the image and the
2895  * complete image.
2896  *
2897  * NOTE: All the macros that take a png_image::format parameter are compile time
2898  * constants if the format parameter is, itself, a constant.  Therefore these
2899  * macros can be used in array declarations and case labels where required.
2900  * Similarly the macros are also pre-processor constants (sizeof is not used) so
2901  * they can be used in #if tests.
2902  *
2903  * First the information about the samples.
2904  */
2905 #define PNG_IMAGE_SAMPLE_CHANNELS(fmt)\
2906    (((fmt)&amp;(PNG_FORMAT_FLAG_COLOR|PNG_FORMAT_FLAG_ALPHA))+1)
2907    /* Return the total number of channels in a given format: 1..4 */
2908 
2909 #define PNG_IMAGE_SAMPLE_COMPONENT_SIZE(fmt)\
2910    ((((fmt) &amp; PNG_FORMAT_FLAG_LINEAR) &gt;&gt; 2)+1)
2911    /* Return the size in bytes of a single component of a pixel or color-map
2912     * entry (as appropriate) in the image: 1 or 2.
2913     */
2914 
2915 #define PNG_IMAGE_SAMPLE_SIZE(fmt)\
2916    (PNG_IMAGE_SAMPLE_CHANNELS(fmt) * PNG_IMAGE_SAMPLE_COMPONENT_SIZE(fmt))
2917    /* This is the size of the sample data for one sample.  If the image is
2918     * color-mapped it is the size of one color-map entry (and image pixels are
2919     * one byte in size), otherwise it is the size of one image pixel.
2920     */
2921 
2922 #define PNG_IMAGE_MAXIMUM_COLORMAP_COMPONENTS(fmt)\
2923    (PNG_IMAGE_SAMPLE_CHANNELS(fmt) * 256)
2924    /* The maximum size of the color-map required by the format expressed in a
2925     * count of components.  This can be used to compile-time allocate a
2926     * color-map:
2927     *
2928     * png_uint_16 colormap[PNG_IMAGE_MAXIMUM_COLORMAP_COMPONENTS(linear_fmt)];
2929     *
2930     * png_byte colormap[PNG_IMAGE_MAXIMUM_COLORMAP_COMPONENTS(sRGB_fmt)];
2931     *
2932     * Alternatively use the PNG_IMAGE_COLORMAP_SIZE macro below to use the
2933     * information from one of the png_image_begin_read_ APIs and dynamically
2934     * allocate the required memory.
2935     */
2936 
2937 /* Corresponding information about the pixels */
2938 #define PNG_IMAGE_PIXEL_(test,fmt)\
2939    (((fmt)&amp;PNG_FORMAT_FLAG_COLORMAP)?1:test(fmt))
2940 
2941 #define PNG_IMAGE_PIXEL_CHANNELS(fmt)\
2942    PNG_IMAGE_PIXEL_(PNG_IMAGE_SAMPLE_CHANNELS,fmt)
2943    /* The number of separate channels (components) in a pixel; 1 for a
2944     * color-mapped image.
2945     */
2946 
2947 #define PNG_IMAGE_PIXEL_COMPONENT_SIZE(fmt)\
2948    PNG_IMAGE_PIXEL_(PNG_IMAGE_SAMPLE_COMPONENT_SIZE,fmt)
2949    /* The size, in bytes, of each component in a pixel; 1 for a color-mapped
2950     * image.
2951     */
2952 
2953 #define PNG_IMAGE_PIXEL_SIZE(fmt) PNG_IMAGE_PIXEL_(PNG_IMAGE_SAMPLE_SIZE,fmt)
2954    /* The size, in bytes, of a complete pixel; 1 for a color-mapped image. */
2955 
2956 /* Information about the whole row, or whole image */
2957 #define PNG_IMAGE_ROW_STRIDE(image)\
2958    (PNG_IMAGE_PIXEL_CHANNELS((image).format) * (image).width)
2959    /* Return the total number of components in a single row of the image; this
2960     * is the minimum &#39;row stride&#39;, the minimum count of components between each
2961     * row.  For a color-mapped image this is the minimum number of bytes in a
2962     * row.
2963     *
2964     * WARNING: this macro overflows for some images with more than one component
2965     * and very large image widths.  libpng will refuse to process an image where
2966     * this macro would overflow.
2967     */
2968 
2969 #define PNG_IMAGE_BUFFER_SIZE(image, row_stride)\
2970    (PNG_IMAGE_PIXEL_COMPONENT_SIZE((image).format)*(image).height*(row_stride))
2971    /* Return the size, in bytes, of an image buffer given a png_image and a row
2972     * stride - the number of components to leave space for in each row.
2973     *
2974     * WARNING: this macro overflows a 32-bit integer for some large PNG images,
2975     * libpng will refuse to process an image where such an overflow would occur.
2976     */
2977 
2978 #define PNG_IMAGE_SIZE(image)\
2979    PNG_IMAGE_BUFFER_SIZE(image, PNG_IMAGE_ROW_STRIDE(image))
2980    /* Return the size, in bytes, of the image in memory given just a png_image;
2981     * the row stride is the minimum stride required for the image.
2982     */
2983 
2984 #define PNG_IMAGE_COLORMAP_SIZE(image)\
2985    (PNG_IMAGE_SAMPLE_SIZE((image).format) * (image).colormap_entries)
2986    /* Return the size, in bytes, of the color-map of this image.  If the image
2987     * format is not a color-map format this will return a size sufficient for
2988     * 256 entries in the given format; check PNG_FORMAT_FLAG_COLORMAP if
2989     * you don&#39;t want to allocate a color-map in this case.
2990     */
2991 
2992 /* PNG_IMAGE_FLAG_*
2993  *
2994  * Flags containing additional information about the image are held in the
2995  * &#39;flags&#39; field of png_image.
2996  */
2997 #define PNG_IMAGE_FLAG_COLORSPACE_NOT_sRGB 0x01
<a name="42" id="anc42"></a><span class="line-modified">2998    /* This indicates the the RGB values of the in-memory bitmap do not</span>
2999     * correspond to the red, green and blue end-points defined by sRGB.
3000     */
3001 
3002 #define PNG_IMAGE_FLAG_FAST 0x02
3003    /* On write emphasise speed over compression; the resultant PNG file will be
3004     * larger but will be produced significantly faster, particular for large
3005     * images.  Do not use this option for images which will be distributed, only
3006     * used it when producing intermediate files that will be read back in
3007     * repeatedly.  For a typical 24-bit image the option will double the read
3008     * speed at the cost of increasing the image size by 25%, however for many
3009     * more compressible images the PNG file can be 10 times larger with only a
3010     * slight speed gain.
3011     */
3012 
3013 #define PNG_IMAGE_FLAG_16BIT_sRGB 0x04
3014    /* On read if the image is a 16-bit per component image and there is no gAMA
3015     * or sRGB chunk assume that the components are sRGB encoded.  Notice that
3016     * images output by the simplified API always have gamma information; setting
3017     * this flag only affects the interpretation of 16-bit images from an
3018     * external source.  It is recommended that the application expose this flag
3019     * to the user; the user can normally easily recognize the difference between
3020     * linear and sRGB encoding.  This flag has no effect on write - the data
3021     * passed to the write APIs must have the correct encoding (as defined
3022     * above.)
3023     *
3024     * If the flag is not set (the default) input 16-bit per component data is
3025     * assumed to be linear.
3026     *
3027     * NOTE: the flag can only be set after the png_image_begin_read_ call,
3028     * because that call initializes the &#39;flags&#39; field.
3029     */
3030 
3031 #ifdef PNG_SIMPLIFIED_READ_SUPPORTED
3032 /* READ APIs
3033  * ---------
3034  *
3035  * The png_image passed to the read APIs must have been initialized by setting
3036  * the png_controlp field &#39;opaque&#39; to NULL (or, safer, memset the whole thing.)
3037  */
3038 #ifdef PNG_STDIO_SUPPORTED
3039 PNG_EXPORT(234, int, png_image_begin_read_from_file, (png_imagep image,
3040    const char *file_name));
3041    /* The named file is opened for read and the image header is filled in
3042     * from the PNG header in the file.
3043     */
3044 
3045 PNG_EXPORT(235, int, png_image_begin_read_from_stdio, (png_imagep image,
3046    FILE* file));
3047    /* The PNG header is read from the stdio FILE object. */
3048 #endif /* STDIO */
3049 
3050 PNG_EXPORT(236, int, png_image_begin_read_from_memory, (png_imagep image,
3051    png_const_voidp memory, size_t size));
3052    /* The PNG header is read from the given memory buffer. */
3053 
3054 PNG_EXPORT(237, int, png_image_finish_read, (png_imagep image,
3055    png_const_colorp background, void *buffer, png_int_32 row_stride,
3056    void *colormap));
3057    /* Finish reading the image into the supplied buffer and clean up the
3058     * png_image structure.
3059     *
3060     * row_stride is the step, in byte or 2-byte units as appropriate,
3061     * between adjacent rows.  A positive stride indicates that the top-most row
3062     * is first in the buffer - the normal top-down arrangement.  A negative
3063     * stride indicates that the bottom-most row is first in the buffer.
3064     *
3065     * background need only be supplied if an alpha channel must be removed from
3066     * a png_byte format and the removal is to be done by compositing on a solid
3067     * color; otherwise it may be NULL and any composition will be done directly
3068     * onto the buffer.  The value is an sRGB color to use for the background,
3069     * for grayscale output the green channel is used.
3070     *
3071     * background must be supplied when an alpha channel must be removed from a
3072     * single byte color-mapped output format, in other words if:
3073     *
3074     * 1) The original format from png_image_begin_read_from_* had
3075     *    PNG_FORMAT_FLAG_ALPHA set.
3076     * 2) The format set by the application does not.
3077     * 3) The format set by the application has PNG_FORMAT_FLAG_COLORMAP set and
3078     *    PNG_FORMAT_FLAG_LINEAR *not* set.
3079     *
3080     * For linear output removing the alpha channel is always done by compositing
3081     * on black and background is ignored.
3082     *
3083     * colormap must be supplied when PNG_FORMAT_FLAG_COLORMAP is set.  It must
3084     * be at least the size (in bytes) returned by PNG_IMAGE_COLORMAP_SIZE.
3085     * image-&gt;colormap_entries will be updated to the actual number of entries
3086     * written to the colormap; this may be less than the original value.
3087     */
3088 
3089 PNG_EXPORT(238, void, png_image_free, (png_imagep image));
3090    /* Free any data allocated by libpng in image-&gt;opaque, setting the pointer to
3091     * NULL.  May be called at any time after the structure is initialized.
3092     */
3093 #endif /* SIMPLIFIED_READ */
3094 
3095 #ifdef PNG_SIMPLIFIED_WRITE_SUPPORTED
3096 /* WRITE APIS
3097  * ----------
3098  * For write you must initialize a png_image structure to describe the image to
3099  * be written.  To do this use memset to set the whole structure to 0 then
3100  * initialize fields describing your image.
3101  *
3102  * version: must be set to PNG_IMAGE_VERSION
3103  * opaque: must be initialized to NULL
3104  * width: image width in pixels
3105  * height: image height in rows
3106  * format: the format of the data (image and color-map) you wish to write
3107  * flags: set to 0 unless one of the defined flags applies; set
3108  *    PNG_IMAGE_FLAG_COLORSPACE_NOT_sRGB for color format images where the RGB
3109  *    values do not correspond to the colors in sRGB.
3110  * colormap_entries: set to the number of entries in the color-map (0 to 256)
3111  */
3112 #ifdef PNG_SIMPLIFIED_WRITE_STDIO_SUPPORTED
3113 PNG_EXPORT(239, int, png_image_write_to_file, (png_imagep image,
3114    const char *file, int convert_to_8bit, const void *buffer,
3115    png_int_32 row_stride, const void *colormap));
3116    /* Write the image to the named file. */
3117 
3118 PNG_EXPORT(240, int, png_image_write_to_stdio, (png_imagep image, FILE *file,
3119    int convert_to_8_bit, const void *buffer, png_int_32 row_stride,
3120    const void *colormap));
3121    /* Write the image to the given (FILE*). */
3122 #endif /* SIMPLIFIED_WRITE_STDIO */
3123 
3124 /* With all write APIs if image is in one of the linear formats with 16-bit
3125  * data then setting convert_to_8_bit will cause the output to be an 8-bit PNG
3126  * gamma encoded according to the sRGB specification, otherwise a 16-bit linear
3127  * encoded PNG file is written.
3128  *
3129  * With color-mapped data formats the colormap parameter point to a color-map
3130  * with at least image-&gt;colormap_entries encoded in the specified format.  If
3131  * the format is linear the written PNG color-map will be converted to sRGB
3132  * regardless of the convert_to_8_bit flag.
3133  *
3134  * With all APIs row_stride is handled as in the read APIs - it is the spacing
3135  * from one row to the next in component sized units (1 or 2 bytes) and if
3136  * negative indicates a bottom-up row layout in the buffer.  If row_stride is
3137  * zero, libpng will calculate it for you from the image width and number of
3138  * channels.
3139  *
3140  * Note that the write API does not support interlacing, sub-8-bit pixels or
3141  * most ancillary chunks.  If you need to write text chunks (e.g. for copyright
3142  * notices) you need to use one of the other APIs.
3143  */
3144 
3145 PNG_EXPORT(245, int, png_image_write_to_memory, (png_imagep image, void *memory,
3146    png_alloc_size_t * PNG_RESTRICT memory_bytes, int convert_to_8_bit,
3147    const void *buffer, png_int_32 row_stride, const void *colormap));
3148    /* Write the image to the given memory buffer.  The function both writes the
3149     * whole PNG data stream to *memory and updates *memory_bytes with the count
3150     * of bytes written.
3151     *
3152     * &#39;memory&#39; may be NULL.  In this case *memory_bytes is not read however on
3153     * success the number of bytes which would have been written will still be
3154     * stored in *memory_bytes.  On failure *memory_bytes will contain 0.
3155     *
3156     * If &#39;memory&#39; is not NULL it must point to memory[*memory_bytes] of
3157     * writeable memory.
3158     *
3159     * If the function returns success memory[*memory_bytes] (if &#39;memory&#39; is not
3160     * NULL) contains the written PNG data.  *memory_bytes will always be less
3161     * than or equal to the original value.
3162     *
3163     * If the function returns false and *memory_bytes was not changed an error
3164     * occurred during write.  If *memory_bytes was changed, or is not 0 if
3165     * &#39;memory&#39; was NULL, the write would have succeeded but for the memory
3166     * buffer being too small.  *memory_bytes contains the required number of
3167     * bytes and will be bigger that the original value.
3168     */
3169 
3170 #define png_image_write_get_memory_size(image, size, convert_to_8_bit, buffer,\
3171    row_stride, colormap)\
3172    png_image_write_to_memory(&amp;(image), 0, &amp;(size), convert_to_8_bit, buffer,\
3173          row_stride, colormap)
3174    /* Return the amount of memory in &#39;size&#39; required to compress this image.
3175     * The png_image structure &#39;image&#39; must be filled in as in the above
3176     * function and must not be changed before the actual write call, the buffer
3177     * and all other parameters must also be identical to that in the final
3178     * write call.  The &#39;size&#39; variable need not be initialized.
3179     *
3180     * NOTE: the macro returns true/false, if false is returned &#39;size&#39; will be
3181     * set to zero and the write failed and probably will fail if tried again.
3182     */
3183 
3184 /* You can pre-allocate the buffer by making sure it is of sufficient size
3185  * regardless of the amount of compression achieved.  The buffer size will
3186  * always be bigger than the original image and it will never be filled.  The
3187  * following macros are provided to assist in allocating the buffer.
3188  */
3189 #define PNG_IMAGE_DATA_SIZE(image) (PNG_IMAGE_SIZE(image)+(image).height)
3190    /* The number of uncompressed bytes in the PNG byte encoding of the image;
3191     * uncompressing the PNG IDAT data will give this number of bytes.
3192     *
3193     * NOTE: while PNG_IMAGE_SIZE cannot overflow for an image in memory this
3194     * macro can because of the extra bytes used in the PNG byte encoding.  You
3195     * need to avoid this macro if your image size approaches 2^30 in width or
3196     * height.  The same goes for the remainder of these macros; they all produce
3197     * bigger numbers than the actual in-memory image size.
3198     */
3199 #ifndef PNG_ZLIB_MAX_SIZE
3200 #  define PNG_ZLIB_MAX_SIZE(b) ((b)+(((b)+7U)&gt;&gt;3)+(((b)+63U)&gt;&gt;6)+11U)
3201    /* An upper bound on the number of compressed bytes given &#39;b&#39; uncompressed
3202     * bytes.  This is based on deflateBounds() in zlib; different
3203     * implementations of zlib compression may conceivably produce more data so
3204     * if your zlib implementation is not zlib itself redefine this macro
3205     * appropriately.
3206     */
3207 #endif
3208 
3209 #define PNG_IMAGE_COMPRESSED_SIZE_MAX(image)\
3210    PNG_ZLIB_MAX_SIZE((png_alloc_size_t)PNG_IMAGE_DATA_SIZE(image))
3211    /* An upper bound on the size of the data in the PNG IDAT chunks. */
3212 
3213 #define PNG_IMAGE_PNG_SIZE_MAX_(image, image_size)\
3214    ((8U/*sig*/+25U/*IHDR*/+16U/*gAMA*/+44U/*cHRM*/+12U/*IEND*/+\
3215     (((image).format&amp;PNG_FORMAT_FLAG_COLORMAP)?/*colormap: PLTE, tRNS*/\
3216     12U+3U*(image).colormap_entries/*PLTE data*/+\
3217     (((image).format&amp;PNG_FORMAT_FLAG_ALPHA)?\
3218     12U/*tRNS*/+(image).colormap_entries:0U):0U)+\
3219     12U)+(12U*((image_size)/PNG_ZBUF_SIZE))/*IDAT*/+(image_size))
3220    /* A helper for the following macro; if your compiler cannot handle the
3221     * following macro use this one with the result of
3222     * PNG_IMAGE_COMPRESSED_SIZE_MAX(image) as the second argument (most
3223     * compilers should handle this just fine.)
3224     */
3225 
3226 #define PNG_IMAGE_PNG_SIZE_MAX(image)\
3227    PNG_IMAGE_PNG_SIZE_MAX_(image, PNG_IMAGE_COMPRESSED_SIZE_MAX(image))
3228    /* An upper bound on the total length of the PNG data stream for &#39;image&#39;.
3229     * The result is of type png_alloc_size_t, on 32-bit systems this may
3230     * overflow even though PNG_IMAGE_DATA_SIZE does not overflow; the write will
3231     * run out of buffer space but return a corrected size which should work.
3232     */
3233 #endif /* SIMPLIFIED_WRITE */
3234 /*******************************************************************************
3235  *  END OF SIMPLIFIED API
3236  ******************************************************************************/
3237 #endif /* SIMPLIFIED_{READ|WRITE} */
3238 
3239 /*******************************************************************************
3240  * Section 6: IMPLEMENTATION OPTIONS
3241  *******************************************************************************
3242  *
3243  * Support for arbitrary implementation-specific optimizations.  The API allows
3244  * particular options to be turned on or off.  &#39;Option&#39; is the number of the
3245  * option and &#39;onoff&#39; is 0 (off) or non-0 (on).  The value returned is given
3246  * by the PNG_OPTION_ defines below.
3247  *
3248  * HARDWARE: normally hardware capabilities, such as the Intel SSE instructions,
3249  *           are detected at run time, however sometimes it may be impossible
3250  *           to do this in user mode, in which case it is necessary to discover
3251  *           the capabilities in an OS specific way.  Such capabilities are
3252  *           listed here when libpng has support for them and must be turned
3253  *           ON by the application if present.
3254  *
3255  * SOFTWARE: sometimes software optimizations actually result in performance
3256  *           decrease on some architectures or systems, or with some sets of
3257  *           PNG images.  &#39;Software&#39; options allow such optimizations to be
3258  *           selected at run time.
3259  */
3260 #ifdef PNG_SET_OPTION_SUPPORTED
3261 #ifdef PNG_ARM_NEON_API_SUPPORTED
3262 #  define PNG_ARM_NEON   0 /* HARDWARE: ARM Neon SIMD instructions supported */
3263 #endif
3264 #define PNG_MAXIMUM_INFLATE_WINDOW 2 /* SOFTWARE: force maximum window */
3265 #define PNG_SKIP_sRGB_CHECK_PROFILE 4 /* SOFTWARE: Check ICC profile for sRGB */
3266 #ifdef PNG_MIPS_MSA_API_SUPPORTED
3267 #  define PNG_MIPS_MSA   6 /* HARDWARE: MIPS Msa SIMD instructions supported */
3268 #endif
3269 #define PNG_IGNORE_ADLER32 8
3270 #ifdef PNG_POWERPC_VSX_API_SUPPORTED
3271 #  define PNG_POWERPC_VSX   10 /* HARDWARE: PowerPC VSX SIMD instructions supported */
3272 #endif
3273 #define PNG_OPTION_NEXT  12 /* Next option - numbers must be even */
3274 
3275 /* Return values: NOTE: there are four values and &#39;off&#39; is *not* zero */
3276 #define PNG_OPTION_UNSET   0 /* Unset - defaults to off */
3277 #define PNG_OPTION_INVALID 1 /* Option number out of range */
3278 #define PNG_OPTION_OFF     2
3279 #define PNG_OPTION_ON      3
3280 
3281 PNG_EXPORT(244, int, png_set_option, (png_structrp png_ptr, int option,
3282    int onoff));
3283 #endif /* SET_OPTION */
3284 
3285 /*******************************************************************************
3286  *  END OF HARDWARE AND SOFTWARE OPTIONS
3287  ******************************************************************************/
3288 
3289 /* Maintainer: Put new public prototypes here ^, in libpng.3, in project
3290  * defs, and in scripts/symbols.def.
3291  */
3292 
3293 /* The last ordinal number (this is the *last* one already used; the next
3294  * one to use is one more than this.)
3295  */
3296 #ifdef PNG_EXPORT_LAST_ORDINAL
3297   PNG_EXPORT_LAST_ORDINAL(249);
3298 #endif
3299 
3300 #ifdef __cplusplus
3301 }
3302 #endif
3303 
3304 #endif /* PNG_VERSION_INFO_ONLY */
3305 /* Do not put anything past this line */
3306 #endif /* PNG_H */
<a name="43" id="anc43"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="43" type="hidden" />
</body>
</html>