<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/native/libsplashscreen/libpng/png.c</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="README.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="png.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libsplashscreen/libpng/png.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 27,24 ***</span>
   * This file is available under and governed by the GNU General Public
   * License version 2 only, as published by the Free Software Foundation.
   * However, the following notice accompanied the original version of this
   * file and, per its terms, should not be removed:
   *
<span class="line-modified">!  * Last changed in libpng 1.6.35 [July 15, 2018]</span>
   * Copyright (c) 1998-2002,2004,2006-2018 Glenn Randers-Pehrson
<span class="line-modified">!  * (Version 0.96 Copyright (c) 1996, 1997 Andreas Dilger)</span>
<span class="line-modified">!  * (Version 0.88 Copyright (c) 1995, 1996 Guy Eric Schalnat, Group 42, Inc.)</span>
   *
   * This code is released under the libpng license.
   * For conditions of distribution and use, see the disclaimer
   * and license in png.h
   */
  
  #include &quot;pngpriv.h&quot;
  
  /* Generate a compiler error if there is an old png.h in the search path. */
<span class="line-modified">! typedef png_libpng_version_1_6_35 Your_png_h_is_not_version_1_6_35;</span>
  
  #ifdef __GNUC__
  /* The version tests may need to be added to, but the problem warning has
   * consistently been fixed in GCC versions which obtain wide-spread release.
   * The problem is that many versions of GCC rearrange comparison expressions in
<span class="line-new-header">--- 27,24 ---</span>
   * This file is available under and governed by the GNU General Public
   * License version 2 only, as published by the Free Software Foundation.
   * However, the following notice accompanied the original version of this
   * file and, per its terms, should not be removed:
   *
<span class="line-modified">!  * Copyright (c) 2018-2019 Cosmin Truta</span>
   * Copyright (c) 1998-2002,2004,2006-2018 Glenn Randers-Pehrson
<span class="line-modified">!  * Copyright (c) 1996-1997 Andreas Dilger</span>
<span class="line-modified">!  * Copyright (c) 1995-1996 Guy Eric Schalnat, Group 42, Inc.</span>
   *
   * This code is released under the libpng license.
   * For conditions of distribution and use, see the disclaimer
   * and license in png.h
   */
  
  #include &quot;pngpriv.h&quot;
  
  /* Generate a compiler error if there is an old png.h in the search path. */
<span class="line-modified">! typedef png_libpng_version_1_6_37 Your_png_h_is_not_version_1_6_37;</span>
  
  #ifdef __GNUC__
  /* The version tests may need to be added to, but the problem warning has
   * consistently been fixed in GCC versions which obtain wide-spread release.
   * The problem is that many versions of GCC rearrange comparison expressions in
</pre>
<hr />
<pre>
<span class="line-old-header">*** 762,11 ***</span>
   * a &quot;Creation Time&quot; or other text-based time string.
   */
  int PNGAPI
  png_convert_to_rfc1123_buffer(char out[29], png_const_timep ptime)
  {
<span class="line-modified">!    static PNG_CONST char short_months[12][4] =</span>
          {&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;,
           &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;};
  
     if (out == NULL)
        return 0;
<span class="line-new-header">--- 762,11 ---</span>
   * a &quot;Creation Time&quot; or other text-based time string.
   */
  int PNGAPI
  png_convert_to_rfc1123_buffer(char out[29], png_const_timep ptime)
  {
<span class="line-modified">!    static const char short_months[12][4] =</span>
          {&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;,
           &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;};
  
     if (out == NULL)
        return 0;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 840,24 ***</span>
  {
     PNG_UNUSED(png_ptr)  /* Silence compiler warning about unused png_ptr */
  #ifdef PNG_STRING_COPYRIGHT
     return PNG_STRING_COPYRIGHT
  #else
<span class="line-removed">- #  ifdef __STDC__</span>
     return PNG_STRING_NEWLINE \
<span class="line-modified">!       &quot;libpng version 1.6.35 - July 15, 2018&quot; PNG_STRING_NEWLINE \</span>
        &quot;Copyright (c) 1998-2002,2004,2006-2018 Glenn Randers-Pehrson&quot; \
        PNG_STRING_NEWLINE \
        &quot;Copyright (c) 1996-1997 Andreas Dilger&quot; PNG_STRING_NEWLINE \
        &quot;Copyright (c) 1995-1996 Guy Eric Schalnat, Group 42, Inc.&quot; \
        PNG_STRING_NEWLINE;
<span class="line-removed">- #  else</span>
<span class="line-removed">-    return &quot;libpng version 1.6.35 - July 15, 2018\</span>
<span class="line-removed">-       Copyright (c) 1998-2002,2004,2006-2018 Glenn Randers-Pehrson\</span>
<span class="line-removed">-       Copyright (c) 1996-1997 Andreas Dilger\</span>
<span class="line-removed">-       Copyright (c) 1995-1996 Guy Eric Schalnat, Group 42, Inc.&quot;;</span>
<span class="line-removed">- #  endif</span>
  #endif
  }
  
  /* The following return the library version as a short string in the
   * format 1.0.0 through 99.99.99zz.  To get the version of *.h files
<span class="line-new-header">--- 840,18 ---</span>
  {
     PNG_UNUSED(png_ptr)  /* Silence compiler warning about unused png_ptr */
  #ifdef PNG_STRING_COPYRIGHT
     return PNG_STRING_COPYRIGHT
  #else
     return PNG_STRING_NEWLINE \
<span class="line-modified">!       &quot;libpng version 1.6.37&quot; PNG_STRING_NEWLINE \</span>
<span class="line-added">+       &quot;Copyright (c) 2018-2019 Cosmin Truta&quot; PNG_STRING_NEWLINE \</span>
        &quot;Copyright (c) 1998-2002,2004,2006-2018 Glenn Randers-Pehrson&quot; \
        PNG_STRING_NEWLINE \
        &quot;Copyright (c) 1996-1997 Andreas Dilger&quot; PNG_STRING_NEWLINE \
        &quot;Copyright (c) 1995-1996 Guy Eric Schalnat, Group 42, Inc.&quot; \
        PNG_STRING_NEWLINE;
  #endif
  }
  
  /* The following return the library version as a short string in the
   * format 1.0.0 through 99.99.99zz.  To get the version of *.h files
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1147,11 ***</span>
  void /* PRIVATE */
  png_colorspace_set_gamma(png_const_structrp png_ptr,
      png_colorspacerp colorspace, png_fixed_point gAMA)
  {
     /* Changed in libpng-1.5.4 to limit the values to ensure overflow can&#39;t
<span class="line-modified">!     * occur.  Since the fixed point representation is asymetrical it is</span>
      * possible for 1/gamma to overflow the limit of 21474 and this means the
      * gamma value must be at least 5/100000 and hence at most 20000.0.  For
      * safety the limits here are a little narrower.  The values are 0.00016 to
      * 6250.0, which are truly ridiculous gamma values (and will produce
      * displays that are all black or all white.)
<span class="line-new-header">--- 1141,11 ---</span>
  void /* PRIVATE */
  png_colorspace_set_gamma(png_const_structrp png_ptr,
      png_colorspacerp colorspace, png_fixed_point gAMA)
  {
     /* Changed in libpng-1.5.4 to limit the values to ensure overflow can&#39;t
<span class="line-modified">!     * occur.  Since the fixed point representation is asymmetrical it is</span>
      * possible for 1/gamma to overflow the limit of 21474 and this means the
      * gamma value must be at least 5/100000 and hence at most 20000.0.  For
      * safety the limits here are a little narrower.  The values are 0.00016 to
      * 6250.0, which are truly ridiculous gamma values (and will produce
      * displays that are all black or all white.)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3160,15 ***</span>
              while (cdigits+czero &lt; precision+clead &amp;&amp; fp &gt; DBL_MIN);
  
              /* The total output count (max) is now 4+precision */
  
              /* Check for an exponent, if we don&#39;t need one we are
<span class="line-modified">!              * done and just need to terminate the string.  At</span>
<span class="line-modified">!              * this point exp_b10==(-1) is effectively a flag - it got</span>
<span class="line-modified">!              * to &#39;-1&#39; because of the decrement after outputting</span>
<span class="line-modified">!              * the decimal point above (the exponent required is</span>
<span class="line-modified">!              * *not* -1!)</span>
               */
              if (exp_b10 &gt;= (-1) &amp;&amp; exp_b10 &lt;= 2)
              {
                 /* The following only happens if we didn&#39;t output the
                  * leading zeros above for negative exponent, so this
<span class="line-new-header">--- 3154,15 ---</span>
              while (cdigits+czero &lt; precision+clead &amp;&amp; fp &gt; DBL_MIN);
  
              /* The total output count (max) is now 4+precision */
  
              /* Check for an exponent, if we don&#39;t need one we are
<span class="line-modified">!              * done and just need to terminate the string.  At this</span>
<span class="line-modified">!              * point, exp_b10==(-1) is effectively a flag: it got</span>
<span class="line-modified">!              * to &#39;-1&#39; because of the decrement, after outputting</span>
<span class="line-modified">!              * the decimal point above. (The exponent required is</span>
<span class="line-modified">!              * *not* -1.)</span>
               */
              if (exp_b10 &gt;= (-1) &amp;&amp; exp_b10 &lt;= 2)
              {
                 /* The following only happens if we didn&#39;t output the
                  * leading zeros above for negative exponent, so this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4002,22 ***</span>
   * png_error (i.e. if one of the mallocs below fails) - i.e. the *table argument
   * should be somewhere that will be cleaned.
   */
  static void
  png_build_16bit_table(png_structrp png_ptr, png_uint_16pp *ptable,
<span class="line-modified">!     PNG_CONST unsigned int shift, PNG_CONST png_fixed_point gamma_val)</span>
  {
     /* Various values derived from &#39;shift&#39;: */
<span class="line-modified">!    PNG_CONST unsigned int num = 1U &lt;&lt; (8U - shift);</span>
  #ifdef PNG_FLOATING_ARITHMETIC_SUPPORTED
     /* CSE the division and work round wacky GCC warnings (see the comments
      * in png_gamma_8bit_correct for where these come from.)
      */
<span class="line-modified">!    PNG_CONST double fmax = 1./(((png_int_32)1 &lt;&lt; (16U - shift))-1);</span>
  #endif
<span class="line-modified">!    PNG_CONST unsigned int max = (1U &lt;&lt; (16U - shift))-1U;</span>
<span class="line-modified">!    PNG_CONST unsigned int max_by_2 = 1U &lt;&lt; (15U-shift);</span>
     unsigned int i;
  
     png_uint_16pp table = *ptable =
         (png_uint_16pp)png_calloc(png_ptr, num * (sizeof (png_uint_16p)));
  
<span class="line-new-header">--- 3996,22 ---</span>
   * png_error (i.e. if one of the mallocs below fails) - i.e. the *table argument
   * should be somewhere that will be cleaned.
   */
  static void
  png_build_16bit_table(png_structrp png_ptr, png_uint_16pp *ptable,
<span class="line-modified">!     unsigned int shift, png_fixed_point gamma_val)</span>
  {
     /* Various values derived from &#39;shift&#39;: */
<span class="line-modified">!    unsigned int num = 1U &lt;&lt; (8U - shift);</span>
  #ifdef PNG_FLOATING_ARITHMETIC_SUPPORTED
     /* CSE the division and work round wacky GCC warnings (see the comments
      * in png_gamma_8bit_correct for where these come from.)
      */
<span class="line-modified">!    double fmax = 1.0 / (((png_int_32)1 &lt;&lt; (16U - shift)) - 1);</span>
  #endif
<span class="line-modified">!    unsigned int max = (1U &lt;&lt; (16U - shift)) - 1U;</span>
<span class="line-modified">!    unsigned int max_by_2 = 1U &lt;&lt; (15U - shift);</span>
     unsigned int i;
  
     png_uint_16pp table = *ptable =
         (png_uint_16pp)png_calloc(png_ptr, num * (sizeof (png_uint_16p)));
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4079,14 ***</span>
  /* NOTE: this function expects the *inverse* of the overall gamma transformation
   * required.
   */
  static void
  png_build_16to8_table(png_structrp png_ptr, png_uint_16pp *ptable,
<span class="line-modified">!     PNG_CONST unsigned int shift, PNG_CONST png_fixed_point gamma_val)</span>
  {
<span class="line-modified">!    PNG_CONST unsigned int num = 1U &lt;&lt; (8U - shift);</span>
<span class="line-modified">!    PNG_CONST unsigned int max = (1U &lt;&lt; (16U - shift))-1U;</span>
     unsigned int i;
     png_uint_32 last;
  
     png_uint_16pp table = *ptable =
         (png_uint_16pp)png_calloc(png_ptr, num * (sizeof (png_uint_16p)));
<span class="line-new-header">--- 4073,14 ---</span>
  /* NOTE: this function expects the *inverse* of the overall gamma transformation
   * required.
   */
  static void
  png_build_16to8_table(png_structrp png_ptr, png_uint_16pp *ptable,
<span class="line-modified">!     unsigned int shift, png_fixed_point gamma_val)</span>
  {
<span class="line-modified">!    unsigned int num = 1U &lt;&lt; (8U - shift);</span>
<span class="line-modified">!    unsigned int max = (1U &lt;&lt; (16U - shift))-1U;</span>
     unsigned int i;
     png_uint_32 last;
  
     png_uint_16pp table = *ptable =
         (png_uint_16pp)png_calloc(png_ptr, num * (sizeof (png_uint_16p)));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4147,11 ***</span>
   * typically much faster).  Note that libpng currently does no sBIT processing
   * (apparently contrary to the spec) so a 256-entry table is always generated.
   */
  static void
  png_build_8bit_table(png_structrp png_ptr, png_bytepp ptable,
<span class="line-modified">!     PNG_CONST png_fixed_point gamma_val)</span>
  {
     unsigned int i;
     png_bytep table = *ptable = (png_bytep)png_malloc(png_ptr, 256);
  
     if (png_gamma_significant(gamma_val) != 0)
<span class="line-new-header">--- 4141,11 ---</span>
   * typically much faster).  Note that libpng currently does no sBIT processing
   * (apparently contrary to the spec) so a 256-entry table is always generated.
   */
  static void
  png_build_8bit_table(png_structrp png_ptr, png_bytepp ptable,
<span class="line-modified">!     png_fixed_point gamma_val)</span>
  {
     unsigned int i;
     png_bytep table = *ptable = (png_bytep)png_malloc(png_ptr, 256);
  
     if (png_gamma_significant(gamma_val) != 0)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4620,12 ***</span>
      * png_safe_execute will call this API after the return.
      */
     if (image != NULL &amp;&amp; image-&gt;opaque != NULL &amp;&amp;
        image-&gt;opaque-&gt;error_buf == NULL)
     {
<span class="line-modified">!       /* Ignore errors here: */</span>
<span class="line-removed">-       (void)png_safe_execute(image, png_image_free_function, image);</span>
        image-&gt;opaque = NULL;
     }
  }
  
  int /* PRIVATE */
<span class="line-new-header">--- 4614,11 ---</span>
      * png_safe_execute will call this API after the return.
      */
     if (image != NULL &amp;&amp; image-&gt;opaque != NULL &amp;&amp;
        image-&gt;opaque-&gt;error_buf == NULL)
     {
<span class="line-modified">!       png_image_free_function(image);</span>
        image-&gt;opaque = NULL;
     }
  }
  
  int /* PRIVATE */
</pre>
<center><a href="README.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="png.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>