<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.desktop/share/native/libsplashscreen/libpng/pngpriv.h</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 /*
   2  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   3  *
   4  * This code is free software; you can redistribute it and/or modify it
   5  * under the terms of the GNU General Public License version 2 only, as
   6  * published by the Free Software Foundation.  Oracle designates this
   7  * particular file as subject to the &quot;Classpath&quot; exception as provided
   8  * by Oracle in the LICENSE file that accompanied this code.
   9  *
  10  * This code is distributed in the hope that it will be useful, but WITHOUT
  11  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  12  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  13  * version 2 for more details (a copy is included in the LICENSE file that
  14  * accompanied this code).
  15  *
  16  * You should have received a copy of the GNU General Public License version
  17  * 2 along with this work; if not, write to the Free Software Foundation,
  18  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  19  *
  20  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  21  * or visit www.oracle.com if you need additional information or have any
  22  * questions.
  23  */
  24 
  25 /* pngpriv.h - private declarations for use inside libpng
  26  *
  27  * This file is available under and governed by the GNU General Public
  28  * License version 2 only, as published by the Free Software Foundation.
  29  * However, the following notice accompanied the original version of this
  30  * file and, per its terms, should not be removed:
  31  *
<a name="1" id="anc1"></a><span class="line-modified">  32  * Copyright (c) 2018-2019 Cosmin Truta</span>
  33  * Copyright (c) 1998-2002,2004,2006-2018 Glenn Randers-Pehrson
<a name="2" id="anc2"></a><span class="line-modified">  34  * Copyright (c) 1996-1997 Andreas Dilger</span>
<span class="line-modified">  35  * Copyright (c) 1995-1996 Guy Eric Schalnat, Group 42, Inc.</span>
  36  *
  37  * This code is released under the libpng license.
  38  * For conditions of distribution and use, see the disclaimer
  39  * and license in png.h
  40  */
  41 
  42 /* The symbols declared in this file (including the functions declared
  43  * as extern) are PRIVATE.  They are not part of the libpng public
  44  * interface, and are not recommended for use by regular applications.
  45  * Some of them may become public in the future; others may stay private,
  46  * change in an incompatible way, or even disappear.
  47  * Although the libpng users are not forbidden to include this header,
  48  * they should be well aware of the issues that may arise from doing so.
  49  */
  50 
  51 #ifndef PNGPRIV_H
  52 #define PNGPRIV_H
  53 
  54 /* Feature Test Macros.  The following are defined here to ensure that correctly
  55  * implemented libraries reveal the APIs libpng needs to build and hide those
  56  * that are not needed and potentially damaging to the compilation.
  57  *
  58  * Feature Test Macros must be defined before any system header is included (see
  59  * POSIX 1003.1 2.8.2 &quot;POSIX Symbols.&quot;
  60  *
  61  * These macros only have an effect if the operating system supports either
  62  * POSIX 1003.1 or C99, or both.  On other operating systems (particularly
  63  * Windows/Visual Studio) there is no effect; the OS specific tests below are
  64  * still required (as of 2011-05-02.)
  65  */
  66 #ifndef _POSIX_SOURCE
  67 # define _POSIX_SOURCE 1 /* Just the POSIX 1003.1 and C89 APIs */
  68 #endif
  69 
  70 #ifndef PNG_VERSION_INFO_ONLY
  71 /* Standard library headers not required by png.h: */
  72 #  include &lt;stdlib.h&gt;
  73 #  include &lt;string.h&gt;
  74 #endif
  75 
  76 #define PNGLIB_BUILD /*libpng is being built, not used*/
  77 
  78 /* If HAVE_CONFIG_H is defined during the build then the build system must
  79  * provide an appropriate &quot;config.h&quot; file on the include path.  The header file
  80  * must provide definitions as required below (search for &quot;HAVE_CONFIG_H&quot;);
  81  * see configure.ac for more details of the requirements.  The macro
  82  * &quot;PNG_NO_CONFIG_H&quot; is provided for maintainers to test for dependencies on
  83  * &#39;configure&#39;; define this macro to prevent the configure build including the
  84  * configure generated config.h.  Libpng is expected to compile without *any*
  85  * special build system support on a reasonably ANSI-C compliant system.
  86  */
  87 #if defined(HAVE_CONFIG_H) &amp;&amp; !defined(PNG_NO_CONFIG_H)
  88 #  include &lt;config.h&gt;
  89 
  90    /* Pick up the definition of &#39;restrict&#39; from config.h if it was read: */
  91 #  define PNG_RESTRICT restrict
  92 #endif
  93 
  94 /* To support symbol prefixing it is necessary to know *before* including png.h
  95  * whether the fixed point (and maybe other) APIs are exported, because if they
  96  * are not internal definitions may be required.  This is handled below just
  97  * before png.h is included, but load the configuration now if it is available.
  98  */
  99 #ifndef PNGLCONF_H
 100 #  include &quot;pnglibconf.h&quot;
 101 #endif
 102 
 103 /* Local renames may change non-exported API functions from png.h */
 104 #if defined(PNG_PREFIX) &amp;&amp; !defined(PNGPREFIX_H)
 105 #  include &quot;pngprefix.h&quot;
 106 #endif
 107 
 108 #ifdef PNG_USER_CONFIG
 109 #  include &quot;pngusr.h&quot;
 110    /* These should have been defined in pngusr.h */
 111 #  ifndef PNG_USER_PRIVATEBUILD
 112 #    define PNG_USER_PRIVATEBUILD &quot;Custom libpng build&quot;
 113 #  endif
 114 #  ifndef PNG_USER_DLLFNAME_POSTFIX
 115 #    define PNG_USER_DLLFNAME_POSTFIX &quot;Cb&quot;
 116 #  endif
 117 #endif
 118 
 119 /* Compile time options.
 120  * =====================
 121  * In a multi-arch build the compiler may compile the code several times for the
 122  * same object module, producing different binaries for different architectures.
 123  * When this happens configure-time setting of the target host options cannot be
 124  * done and this interferes with the handling of the ARM NEON optimizations, and
 125  * possibly other similar optimizations.  Put additional tests here; in general
 126  * this is needed when the same option can be changed at both compile time and
 127  * run time depending on the target OS (i.e. iOS vs Android.)
 128  *
 129  * NOTE: symbol prefixing does not pass $(CFLAGS) to the preprocessor, because
 130  * this is not possible with certain compilers (Oracle SUN OS CC), as a result
 131  * it is necessary to ensure that all extern functions that *might* be used
 132  * regardless of $(CFLAGS) get declared in this file.  The test on __ARM_NEON__
 133  * below is one example of this behavior because it is controlled by the
 134  * presence or not of -mfpu=neon on the GCC command line, it is possible to do
 135  * this in $(CC), e.g. &quot;CC=gcc -mfpu=neon&quot;, but people who build libpng rarely
 136  * do this.
 137  */
 138 #ifndef PNG_ARM_NEON_OPT
 139    /* ARM NEON optimizations are being controlled by the compiler settings,
 140     * typically the target FPU.  If the FPU has been set to NEON (-mfpu=neon
 141     * with GCC) then the compiler will define __ARM_NEON__ and we can rely
 142     * unconditionally on NEON instructions not crashing, otherwise we must
 143     * disable use of NEON instructions.
 144     *
 145     * NOTE: at present these optimizations depend on &#39;ALIGNED_MEMORY&#39;, so they
 146     * can only be turned on automatically if that is supported too.  If
 147     * PNG_ARM_NEON_OPT is set in CPPFLAGS (to &gt;0) then arm/arm_init.c will fail
 148     * to compile with an appropriate #error if ALIGNED_MEMORY has been turned
 149     * off.
 150     *
 151     * Note that gcc-4.9 defines __ARM_NEON instead of the deprecated
 152     * __ARM_NEON__, so we check both variants.
 153     *
 154     * To disable ARM_NEON optimizations entirely, and skip compiling the
 155     * associated assembler code, pass --enable-arm-neon=no to configure
 156     * or put -DPNG_ARM_NEON_OPT=0 in CPPFLAGS.
 157     */
 158 #  if (defined(__ARM_NEON__) || defined(__ARM_NEON)) &amp;&amp; \
 159    defined(PNG_ALIGNED_MEMORY_SUPPORTED)
 160 #     define PNG_ARM_NEON_OPT 2
 161 #  else
 162 #     define PNG_ARM_NEON_OPT 0
 163 #  endif
 164 #endif
 165 
 166 #if PNG_ARM_NEON_OPT &gt; 0
 167    /* NEON optimizations are to be at least considered by libpng, so enable the
 168     * callbacks to do this.
 169     */
 170 #  define PNG_FILTER_OPTIMIZATIONS png_init_filter_functions_neon
 171 
 172    /* By default the &#39;intrinsics&#39; code in arm/filter_neon_intrinsics.c is used
 173     * if possible - if __ARM_NEON__ is set and the compiler version is not known
 174     * to be broken.  This is controlled by PNG_ARM_NEON_IMPLEMENTATION which can
 175     * be:
 176     *
 177     *    1  The intrinsics code (the default with __ARM_NEON__)
 178     *    2  The hand coded assembler (the default without __ARM_NEON__)
 179     *
 180     * It is possible to set PNG_ARM_NEON_IMPLEMENTATION in CPPFLAGS, however
 181     * this is *NOT* supported and may cease to work even after a minor revision
 182     * to libpng.  It *is* valid to do this for testing purposes, e.g. speed
 183     * testing or a new compiler, but the results should be communicated to the
 184     * libpng implementation list for incorporation in the next minor release.
 185     */
 186 #  ifndef PNG_ARM_NEON_IMPLEMENTATION
 187 #     if defined(__ARM_NEON__) || defined(__ARM_NEON)
 188 #        if defined(__clang__)
 189             /* At present it is unknown by the libpng developers which versions
 190              * of clang support the intrinsics, however some or perhaps all
 191              * versions do not work with the assembler so this may be
 192              * irrelevant, so just use the default (do nothing here.)
 193              */
 194 #        elif defined(__GNUC__)
 195             /* GCC 4.5.4 NEON support is known to be broken.  4.6.3 is known to
 196              * work, so if this *is* GCC, or G++, look for a version &gt;4.5
 197              */
 198 #           if __GNUC__ &lt; 4 || (__GNUC__ == 4 &amp;&amp; __GNUC_MINOR__ &lt; 6)
 199 #              define PNG_ARM_NEON_IMPLEMENTATION 2
 200 #           endif /* no GNUC support */
 201 #        endif /* __GNUC__ */
 202 #     else /* !defined __ARM_NEON__ */
 203          /* The &#39;intrinsics&#39; code simply won&#39;t compile without this -mfpu=neon:
 204           */
<a name="3" id="anc3"></a><span class="line-modified"> 205 #        if !defined(__aarch64__)</span>
<span class="line-added"> 206             /* The assembler code currently does not work on ARM64 */</span>
<span class="line-added"> 207 #          define PNG_ARM_NEON_IMPLEMENTATION 2</span>
<span class="line-added"> 208 #        endif /* __aarch64__ */</span>
 209 #     endif /* __ARM_NEON__ */
 210 #  endif /* !PNG_ARM_NEON_IMPLEMENTATION */
 211 
 212 #  ifndef PNG_ARM_NEON_IMPLEMENTATION
 213       /* Use the intrinsics code by default. */
 214 #     define PNG_ARM_NEON_IMPLEMENTATION 1
 215 #  endif
 216 #endif /* PNG_ARM_NEON_OPT &gt; 0 */
 217 
 218 #ifndef PNG_MIPS_MSA_OPT
 219 #  if defined(__mips_msa) &amp;&amp; (__mips_isa_rev &gt;= 5) &amp;&amp; defined(PNG_ALIGNED_MEMORY_SUPPORTED)
 220 #     define PNG_MIPS_MSA_OPT 2
 221 #  else
 222 #     define PNG_MIPS_MSA_OPT 0
 223 #  endif
 224 #endif
 225 
 226 #ifndef PNG_POWERPC_VSX_OPT
 227 #  if defined(__PPC64__) &amp;&amp; defined(__ALTIVEC__) &amp;&amp; defined(__VSX__)
 228 #     define PNG_POWERPC_VSX_OPT 2
 229 #  else
 230 #     define PNG_POWERPC_VSX_OPT 0
 231 #  endif
 232 #endif
 233 
 234 #ifndef PNG_INTEL_SSE_OPT
 235 #   ifdef PNG_INTEL_SSE
 236       /* Only check for SSE if the build configuration has been modified to
 237        * enable SSE optimizations.  This means that these optimizations will
 238        * be off by default.  See contrib/intel for more details.
 239        */
 240 #     if defined(__SSE4_1__) || defined(__AVX__) || defined(__SSSE3__) || \
 241        defined(__SSE2__) || defined(_M_X64) || defined(_M_AMD64) || \
 242        (defined(_M_IX86_FP) &amp;&amp; _M_IX86_FP &gt;= 2)
 243 #         define PNG_INTEL_SSE_OPT 1
 244 #      else
 245 #         define PNG_INTEL_SSE_OPT 0
 246 #      endif
 247 #   else
 248 #      define PNG_INTEL_SSE_OPT 0
 249 #   endif
 250 #endif
 251 
 252 #if PNG_INTEL_SSE_OPT &gt; 0
 253 #   ifndef PNG_INTEL_SSE_IMPLEMENTATION
 254 #      if defined(__SSE4_1__) || defined(__AVX__)
 255           /* We are not actually using AVX, but checking for AVX is the best
 256              way we can detect SSE4.1 and SSSE3 on MSVC.
 257           */
 258 #         define PNG_INTEL_SSE_IMPLEMENTATION 3
 259 #      elif defined(__SSSE3__)
 260 #         define PNG_INTEL_SSE_IMPLEMENTATION 2
 261 #      elif defined(__SSE2__) || defined(_M_X64) || defined(_M_AMD64) || \
 262        (defined(_M_IX86_FP) &amp;&amp; _M_IX86_FP &gt;= 2)
 263 #         define PNG_INTEL_SSE_IMPLEMENTATION 1
 264 #      else
 265 #         define PNG_INTEL_SSE_IMPLEMENTATION 0
 266 #      endif
 267 #   endif
 268 
 269 #   if PNG_INTEL_SSE_IMPLEMENTATION &gt; 0
 270 #      define PNG_FILTER_OPTIMIZATIONS png_init_filter_functions_sse2
 271 #   endif
 272 #else
 273 #   define PNG_INTEL_SSE_IMPLEMENTATION 0
 274 #endif
 275 
 276 #if PNG_MIPS_MSA_OPT &gt; 0
 277 #  define PNG_FILTER_OPTIMIZATIONS png_init_filter_functions_msa
 278 #  ifndef PNG_MIPS_MSA_IMPLEMENTATION
 279 #     if defined(__mips_msa)
 280 #        if defined(__clang__)
 281 #        elif defined(__GNUC__)
 282 #           if __GNUC__ &lt; 4 || (__GNUC__ == 4 &amp;&amp; __GNUC_MINOR__ &lt; 7)
 283 #              define PNG_MIPS_MSA_IMPLEMENTATION 2
 284 #           endif /* no GNUC support */
 285 #        endif /* __GNUC__ */
 286 #     else /* !defined __mips_msa */
 287 #        define PNG_MIPS_MSA_IMPLEMENTATION 2
 288 #     endif /* __mips_msa */
 289 #  endif /* !PNG_MIPS_MSA_IMPLEMENTATION */
 290 
 291 #  ifndef PNG_MIPS_MSA_IMPLEMENTATION
 292 #     define PNG_MIPS_MSA_IMPLEMENTATION 1
 293 #  endif
 294 #endif /* PNG_MIPS_MSA_OPT &gt; 0 */
 295 
 296 #if PNG_POWERPC_VSX_OPT &gt; 0
 297 #  define PNG_FILTER_OPTIMIZATIONS png_init_filter_functions_vsx
 298 #  define PNG_POWERPC_VSX_IMPLEMENTATION 1
 299 #endif
 300 
<a name="4" id="anc4"></a><span class="line-added"> 301 </span>
 302 /* Is this a build of a DLL where compilation of the object modules requires
 303  * different preprocessor settings to those required for a simple library?  If
 304  * so PNG_BUILD_DLL must be set.
 305  *
 306  * If libpng is used inside a DLL but that DLL does not export the libpng APIs
 307  * PNG_BUILD_DLL must not be set.  To avoid the code below kicking in build a
 308  * static library of libpng then link the DLL against that.
 309  */
 310 #ifndef PNG_BUILD_DLL
 311 #  ifdef DLL_EXPORT
 312       /* This is set by libtool when files are compiled for a DLL; libtool
 313        * always compiles twice, even on systems where it isn&#39;t necessary.  Set
 314        * PNG_BUILD_DLL in case it is necessary:
 315        */
 316 #     define PNG_BUILD_DLL
 317 #  else
 318 #     ifdef _WINDLL
 319          /* This is set by the Microsoft Visual Studio IDE in projects that
 320           * build a DLL.  It can&#39;t easily be removed from those projects (it
 321           * isn&#39;t visible in the Visual Studio UI) so it is a fairly reliable
 322           * indication that PNG_IMPEXP needs to be set to the DLL export
 323           * attributes.
 324           */
 325 #        define PNG_BUILD_DLL
 326 #     else
 327 #        ifdef __DLL__
 328             /* This is set by the Borland C system when compiling for a DLL
 329              * (as above.)
 330              */
 331 #           define PNG_BUILD_DLL
 332 #        else
 333             /* Add additional compiler cases here. */
 334 #        endif
 335 #     endif
 336 #  endif
 337 #endif /* Setting PNG_BUILD_DLL if required */
 338 
 339 /* See pngconf.h for more details: the builder of the library may set this on
 340  * the command line to the right thing for the specific compilation system or it
 341  * may be automagically set above (at present we know of no system where it does
 342  * need to be set on the command line.)
 343  *
 344  * PNG_IMPEXP must be set here when building the library to prevent pngconf.h
 345  * setting it to the &quot;import&quot; setting for a DLL build.
 346  */
 347 #ifndef PNG_IMPEXP
 348 #  ifdef PNG_BUILD_DLL
 349 #     define PNG_IMPEXP PNG_DLL_EXPORT
 350 #  else
 351       /* Not building a DLL, or the DLL doesn&#39;t require specific export
 352        * definitions.
 353        */
 354 #     define PNG_IMPEXP
 355 #  endif
 356 #endif
 357 
 358 /* No warnings for private or deprecated functions in the build: */
 359 #ifndef PNG_DEPRECATED
 360 #  define PNG_DEPRECATED
 361 #endif
 362 #ifndef PNG_PRIVATE
 363 #  define PNG_PRIVATE
 364 #endif
 365 
 366 /* Symbol preprocessing support.
 367  *
 368  * To enable listing global, but internal, symbols the following macros should
 369  * always be used to declare an extern data or function object in this file.
 370  */
 371 #ifndef PNG_INTERNAL_DATA
 372 #  define PNG_INTERNAL_DATA(type, name, array) PNG_LINKAGE_DATA type name array
 373 #endif
 374 
 375 #ifndef PNG_INTERNAL_FUNCTION
 376 #  define PNG_INTERNAL_FUNCTION(type, name, args, attributes)\
 377       PNG_LINKAGE_FUNCTION PNG_FUNCTION(type, name, args, PNG_EMPTY attributes)
 378 #endif
 379 
 380 #ifndef PNG_INTERNAL_CALLBACK
 381 #  define PNG_INTERNAL_CALLBACK(type, name, args, attributes)\
 382       PNG_LINKAGE_CALLBACK PNG_FUNCTION(type, (PNGCBAPI name), args,\
 383          PNG_EMPTY attributes)
 384 #endif
 385 
 386 /* If floating or fixed point APIs are disabled they may still be compiled
 387  * internally.  To handle this make sure they are declared as the appropriate
 388  * internal extern function (otherwise the symbol prefixing stuff won&#39;t work and
 389  * the functions will be used without definitions.)
 390  *
 391  * NOTE: although all the API functions are declared here they are not all
 392  * actually built!  Because the declarations are still made it is necessary to
 393  * fake out types that they depend on.
 394  */
 395 #ifndef PNG_FP_EXPORT
 396 #  ifndef PNG_FLOATING_POINT_SUPPORTED
 397 #     define PNG_FP_EXPORT(ordinal, type, name, args)\
 398          PNG_INTERNAL_FUNCTION(type, name, args, PNG_EMPTY);
 399 #     ifndef PNG_VERSION_INFO_ONLY
 400          typedef struct png_incomplete png_double;
 401          typedef png_double*           png_doublep;
 402          typedef const png_double*     png_const_doublep;
 403          typedef png_double**          png_doublepp;
 404 #     endif
 405 #  endif
 406 #endif
 407 #ifndef PNG_FIXED_EXPORT
 408 #  ifndef PNG_FIXED_POINT_SUPPORTED
 409 #     define PNG_FIXED_EXPORT(ordinal, type, name, args)\
 410          PNG_INTERNAL_FUNCTION(type, name, args, PNG_EMPTY);
 411 #  endif
 412 #endif
 413 
 414 #include &quot;png.h&quot;
 415 
 416 /* pngconf.h does not set PNG_DLL_EXPORT unless it is required, so: */
 417 #ifndef PNG_DLL_EXPORT
 418 #  define PNG_DLL_EXPORT
 419 #endif
 420 
 421 /* This is a global switch to set the compilation for an installed system
 422  * (a release build).  It can be set for testing debug builds to ensure that
 423  * they will compile when the build type is switched to RC or STABLE, the
 424  * default is just to use PNG_LIBPNG_BUILD_BASE_TYPE.  Set this in CPPFLAGS
 425  * with either:
 426  *
 427  *   -DPNG_RELEASE_BUILD Turns on the release compile path
 428  *   -DPNG_RELEASE_BUILD=0 Turns it off
 429  * or in your pngusr.h with
 430  *   #define PNG_RELEASE_BUILD=1 Turns on the release compile path
 431  *   #define PNG_RELEASE_BUILD=0 Turns it off
 432  */
 433 #ifndef PNG_RELEASE_BUILD
 434 #  define PNG_RELEASE_BUILD (PNG_LIBPNG_BUILD_BASE_TYPE &gt;= PNG_LIBPNG_BUILD_RC)
 435 #endif
 436 
 437 /* SECURITY and SAFETY:
 438  *
 439  * libpng is built with support for internal limits on image dimensions and
 440  * memory usage.  These are documented in scripts/pnglibconf.dfa of the
 441  * source and recorded in the machine generated header file pnglibconf.h.
 442  */
 443 
 444 /* If you are running on a machine where you cannot allocate more
 445  * than 64K of memory at once, uncomment this.  While libpng will not
 446  * normally need that much memory in a chunk (unless you load up a very
 447  * large file), zlib needs to know how big of a chunk it can use, and
 448  * libpng thus makes sure to check any memory allocation to verify it
 449  * will fit into memory.
 450  *
 451  * zlib provides &#39;MAXSEG_64K&#39; which, if defined, indicates the
 452  * same limit and pngconf.h (already included) sets the limit
 453  * if certain operating systems are detected.
 454  */
 455 #if defined(MAXSEG_64K) &amp;&amp; !defined(PNG_MAX_MALLOC_64K)
 456 #  define PNG_MAX_MALLOC_64K
 457 #endif
 458 
 459 #ifndef PNG_UNUSED
 460 /* Unused formal parameter warnings are silenced using the following macro
 461  * which is expected to have no bad effects on performance (optimizing
 462  * compilers will probably remove it entirely).  Note that if you replace
 463  * it with something other than whitespace, you must include the terminating
 464  * semicolon.
 465  */
 466 #  define PNG_UNUSED(param) (void)param;
 467 #endif
 468 
 469 /* Just a little check that someone hasn&#39;t tried to define something
 470  * contradictory.
 471  */
 472 #if (PNG_ZBUF_SIZE &gt; 65536L) &amp;&amp; defined(PNG_MAX_MALLOC_64K)
 473 #  undef PNG_ZBUF_SIZE
 474 #  define PNG_ZBUF_SIZE 65536L
 475 #endif
 476 
 477 /* If warnings or errors are turned off the code is disabled or redirected here.
 478  * From 1.5.4 functions have been added to allow very limited formatting of
 479  * error and warning messages - this code will also be disabled here.
 480  */
 481 #ifdef PNG_WARNINGS_SUPPORTED
 482 #  define PNG_WARNING_PARAMETERS(p) png_warning_parameters p;
 483 #else
 484 #  define png_warning_parameter(p,number,string) ((void)0)
 485 #  define png_warning_parameter_unsigned(p,number,format,value) ((void)0)
 486 #  define png_warning_parameter_signed(p,number,format,value) ((void)0)
 487 #  define png_formatted_warning(pp,p,message) ((void)(pp))
 488 #  define PNG_WARNING_PARAMETERS(p)
 489 #endif
 490 #ifndef PNG_ERROR_TEXT_SUPPORTED
 491 #  define png_fixed_error(s1,s2) png_err(s1)
 492 #endif
 493 
 494 /* Some fixed point APIs are still required even if not exported because
 495  * they get used by the corresponding floating point APIs.  This magic
 496  * deals with this:
 497  */
 498 #ifdef PNG_FIXED_POINT_SUPPORTED
 499 #  define PNGFAPI PNGAPI
 500 #else
 501 #  define PNGFAPI /* PRIVATE */
 502 #endif
 503 
 504 #ifndef PNG_VERSION_INFO_ONLY
 505 /* Other defines specific to compilers can go here.  Try to keep
 506  * them inside an appropriate ifdef/endif pair for portability.
 507  */
 508 
 509 /* C allows up-casts from (void*) to any pointer and (const void*) to any
 510  * pointer to a const object.  C++ regards this as a type error and requires an
 511  * explicit, static, cast and provides the static_cast&lt;&gt; rune to ensure that
 512  * const is not cast away.
 513  */
 514 #ifdef __cplusplus
 515 #  define png_voidcast(type, value) static_cast&lt;type&gt;(value)
 516 #  define png_constcast(type, value) const_cast&lt;type&gt;(value)
 517 #  define png_aligncast(type, value) \
 518    static_cast&lt;type&gt;(static_cast&lt;void*&gt;(value))
 519 #  define png_aligncastconst(type, value) \
 520    static_cast&lt;type&gt;(static_cast&lt;const void*&gt;(value))
 521 #else
 522 #  define png_voidcast(type, value) (value)
 523 #  ifdef _WIN64
 524 #     ifdef __GNUC__
 525          typedef unsigned long long png_ptruint;
 526 #     else
 527          typedef unsigned __int64 png_ptruint;
 528 #     endif
 529 #  else
 530       typedef unsigned long png_ptruint;
 531 #  endif
 532 #  define png_constcast(type, value) ((type)(png_ptruint)(const void*)(value))
 533 #  define png_aligncast(type, value) ((void*)(value))
 534 #  define png_aligncastconst(type, value) ((const void*)(value))
 535 #endif /* __cplusplus */
 536 
 537 #if defined(PNG_FLOATING_POINT_SUPPORTED) ||\
 538     defined(PNG_FLOATING_ARITHMETIC_SUPPORTED)
 539    /* png.c requires the following ANSI-C constants if the conversion of
 540     * floating point to ASCII is implemented therein:
 541     *
 542     *  DBL_DIG  Maximum number of decimal digits (can be set to any constant)
 543     *  DBL_MIN  Smallest normalized fp number (can be set to an arbitrary value)
 544     *  DBL_MAX  Maximum floating point number (can be set to an arbitrary value)
 545     */
 546 #  include &lt;float.h&gt;
 547 
 548 #  if (defined(__MWERKS__) &amp;&amp; defined(macintosh)) || defined(applec) || \
 549     defined(THINK_C) || defined(__SC__) || defined(TARGET_OS_MAC)
 550    /* We need to check that &lt;math.h&gt; hasn&#39;t already been included earlier
 551     * as it seems it doesn&#39;t agree with &lt;fp.h&gt;, yet we should really use
 552     * &lt;fp.h&gt; if possible.
 553     */
 554 #    if !defined(__MATH_H__) &amp;&amp; !defined(__MATH_H) &amp;&amp; !defined(__cmath__)
 555 #      include &lt;fp.h&gt;
 556 #    endif
 557 #  else
 558 #    include &lt;math.h&gt;
 559 #  endif
 560 #  if defined(_AMIGA) &amp;&amp; defined(__SASC) &amp;&amp; defined(_M68881)
 561    /* Amiga SAS/C: We must include builtin FPU functions when compiling using
 562     * MATH=68881
 563     */
 564 #    include &lt;m68881.h&gt;
 565 #  endif
 566 #endif
 567 
 568 /* This provides the non-ANSI (far) memory allocation routines. */
 569 #if defined(__TURBOC__) &amp;&amp; defined(__MSDOS__)
 570 #  include &lt;mem.h&gt;
 571 #  include &lt;alloc.h&gt;
 572 #endif
 573 
 574 #if defined(WIN32) || defined(_Windows) || defined(_WINDOWS) || \
 575     defined(_WIN32) || defined(__WIN32__)
 576 #  include &lt;windows.h&gt;  /* defines _WINDOWS_ macro */
 577 #endif
 578 #endif /* PNG_VERSION_INFO_ONLY */
 579 
 580 /* Moved here around 1.5.0beta36 from pngconf.h */
 581 /* Users may want to use these so they are not private.  Any library
 582  * functions that are passed far data must be model-independent.
 583  */
 584 
 585 /* Memory model/platform independent fns */
 586 #ifndef PNG_ABORT
 587 #  ifdef _WINDOWS_
 588 #    define PNG_ABORT() ExitProcess(0)
 589 #  else
 590 #    define PNG_ABORT() abort()
 591 #  endif
 592 #endif
 593 
 594 /* These macros may need to be architecture dependent. */
 595 #define PNG_ALIGN_NONE   0 /* do not use data alignment */
 596 #define PNG_ALIGN_ALWAYS 1 /* assume unaligned accesses are OK */
 597 #ifdef offsetof
 598 #  define PNG_ALIGN_OFFSET 2 /* use offsetof to determine alignment */
 599 #else
 600 #  define PNG_ALIGN_OFFSET -1 /* prevent the use of this */
 601 #endif
 602 #define PNG_ALIGN_SIZE   3 /* use sizeof to determine alignment */
 603 
 604 #ifndef PNG_ALIGN_TYPE
 605    /* Default to using aligned access optimizations and requiring alignment to a
 606     * multiple of the data type size.  Override in a compiler specific fashion
 607     * if necessary by inserting tests here:
 608     */
 609 #  define PNG_ALIGN_TYPE PNG_ALIGN_SIZE
 610 #endif
 611 
 612 #if PNG_ALIGN_TYPE == PNG_ALIGN_SIZE
 613    /* This is used because in some compiler implementations non-aligned
 614     * structure members are supported, so the offsetof approach below fails.
 615     * Set PNG_ALIGN_SIZE=0 for compiler combinations where unaligned access
 616     * is good for performance.  Do not do this unless you have tested the result
 617     * and understand it.
 618     */
 619 #  define png_alignof(type) (sizeof (type))
 620 #else
 621 #  if PNG_ALIGN_TYPE == PNG_ALIGN_OFFSET
 622 #     define png_alignof(type) offsetof(struct{char c; type t;}, t)
 623 #  else
 624 #     if PNG_ALIGN_TYPE == PNG_ALIGN_ALWAYS
 625 #        define png_alignof(type) (1)
 626 #     endif
 627       /* Else leave png_alignof undefined to prevent use thereof */
 628 #  endif
 629 #endif
 630 
 631 /* This implicitly assumes alignment is always to a power of 2. */
 632 #ifdef png_alignof
 633 #  define png_isaligned(ptr, type)\
 634    (((type)((const char*)ptr-(const char*)0) &amp; \
 635    (type)(png_alignof(type)-1)) == 0)
 636 #else
 637 #  define png_isaligned(ptr, type) 0
 638 #endif
 639 
 640 /* End of memory model/platform independent support */
 641 /* End of 1.5.0beta36 move from pngconf.h */
 642 
 643 /* CONSTANTS and UTILITY MACROS
 644  * These are used internally by libpng and not exposed in the API
 645  */
 646 
 647 /* Various modes of operation.  Note that after an init, mode is set to
 648  * zero automatically when the structure is created.  Three of these
 649  * are defined in png.h because they need to be visible to applications
 650  * that call png_set_unknown_chunk().
 651  */
 652 /* #define PNG_HAVE_IHDR            0x01U (defined in png.h) */
 653 /* #define PNG_HAVE_PLTE            0x02U (defined in png.h) */
 654 #define PNG_HAVE_IDAT               0x04U
 655 /* #define PNG_AFTER_IDAT           0x08U (defined in png.h) */
 656 #define PNG_HAVE_IEND               0x10U
 657                    /*               0x20U (unused) */
 658                    /*               0x40U (unused) */
 659                    /*               0x80U (unused) */
 660 #define PNG_HAVE_CHUNK_HEADER      0x100U
 661 #define PNG_WROTE_tIME             0x200U
 662 #define PNG_WROTE_INFO_BEFORE_PLTE 0x400U
 663 #define PNG_BACKGROUND_IS_GRAY     0x800U
 664 #define PNG_HAVE_PNG_SIGNATURE    0x1000U
 665 #define PNG_HAVE_CHUNK_AFTER_IDAT 0x2000U /* Have another chunk after IDAT */
 666                    /*             0x4000U (unused) */
 667 #define PNG_IS_READ_STRUCT        0x8000U /* Else is a write struct */
 668 
 669 /* Flags for the transformations the PNG library does on the image data */
 670 #define PNG_BGR                 0x0001U
 671 #define PNG_INTERLACE           0x0002U
 672 #define PNG_PACK                0x0004U
 673 #define PNG_SHIFT               0x0008U
 674 #define PNG_SWAP_BYTES          0x0010U
 675 #define PNG_INVERT_MONO         0x0020U
 676 #define PNG_QUANTIZE            0x0040U
 677 #define PNG_COMPOSE             0x0080U    /* Was PNG_BACKGROUND */
 678 #define PNG_BACKGROUND_EXPAND   0x0100U
 679 #define PNG_EXPAND_16           0x0200U    /* Added to libpng 1.5.2 */
 680 #define PNG_16_TO_8             0x0400U    /* Becomes &#39;chop&#39; in 1.5.4 */
 681 #define PNG_RGBA                0x0800U
 682 #define PNG_EXPAND              0x1000U
 683 #define PNG_GAMMA               0x2000U
 684 #define PNG_GRAY_TO_RGB         0x4000U
 685 #define PNG_FILLER              0x8000U
 686 #define PNG_PACKSWAP           0x10000U
 687 #define PNG_SWAP_ALPHA         0x20000U
 688 #define PNG_STRIP_ALPHA        0x40000U
 689 #define PNG_INVERT_ALPHA       0x80000U
 690 #define PNG_USER_TRANSFORM    0x100000U
 691 #define PNG_RGB_TO_GRAY_ERR   0x200000U
 692 #define PNG_RGB_TO_GRAY_WARN  0x400000U
 693 #define PNG_RGB_TO_GRAY       0x600000U /* two bits, RGB_TO_GRAY_ERR|WARN */
 694 #define PNG_ENCODE_ALPHA      0x800000U /* Added to libpng-1.5.4 */
 695 #define PNG_ADD_ALPHA        0x1000000U /* Added to libpng-1.2.7 */
 696 #define PNG_EXPAND_tRNS      0x2000000U /* Added to libpng-1.2.9 */
 697 #define PNG_SCALE_16_TO_8    0x4000000U /* Added to libpng-1.5.4 */
 698                        /*    0x8000000U unused */
 699                        /*   0x10000000U unused */
 700                        /*   0x20000000U unused */
 701                        /*   0x40000000U unused */
 702 /* Flags for png_create_struct */
 703 #define PNG_STRUCT_PNG   0x0001U
 704 #define PNG_STRUCT_INFO  0x0002U
 705 
 706 /* Flags for the png_ptr-&gt;flags rather than declaring a byte for each one */
 707 #define PNG_FLAG_ZLIB_CUSTOM_STRATEGY     0x0001U
 708 #define PNG_FLAG_ZSTREAM_INITIALIZED      0x0002U /* Added to libpng-1.6.0 */
 709                                   /*      0x0004U    unused */
 710 #define PNG_FLAG_ZSTREAM_ENDED            0x0008U /* Added to libpng-1.6.0 */
 711                                   /*      0x0010U    unused */
 712                                   /*      0x0020U    unused */
 713 #define PNG_FLAG_ROW_INIT                 0x0040U
 714 #define PNG_FLAG_FILLER_AFTER             0x0080U
 715 #define PNG_FLAG_CRC_ANCILLARY_USE        0x0100U
 716 #define PNG_FLAG_CRC_ANCILLARY_NOWARN     0x0200U
 717 #define PNG_FLAG_CRC_CRITICAL_USE         0x0400U
 718 #define PNG_FLAG_CRC_CRITICAL_IGNORE      0x0800U
 719 #define PNG_FLAG_ASSUME_sRGB              0x1000U /* Added to libpng-1.5.4 */
 720 #define PNG_FLAG_OPTIMIZE_ALPHA           0x2000U /* Added to libpng-1.5.4 */
 721 #define PNG_FLAG_DETECT_UNINITIALIZED     0x4000U /* Added to libpng-1.5.4 */
 722 /* #define PNG_FLAG_KEEP_UNKNOWN_CHUNKS      0x8000U */
 723 /* #define PNG_FLAG_KEEP_UNSAFE_CHUNKS      0x10000U */
 724 #define PNG_FLAG_LIBRARY_MISMATCH        0x20000U
 725 #define PNG_FLAG_STRIP_ERROR_NUMBERS     0x40000U
 726 #define PNG_FLAG_STRIP_ERROR_TEXT        0x80000U
 727 #define PNG_FLAG_BENIGN_ERRORS_WARN     0x100000U /* Added to libpng-1.4.0 */
 728 #define PNG_FLAG_APP_WARNINGS_WARN      0x200000U /* Added to libpng-1.6.0 */
 729 #define PNG_FLAG_APP_ERRORS_WARN        0x400000U /* Added to libpng-1.6.0 */
 730                                   /*    0x800000U    unused */
 731                                   /*   0x1000000U    unused */
 732                                   /*   0x2000000U    unused */
 733                                   /*   0x4000000U    unused */
 734                                   /*   0x8000000U    unused */
 735                                   /*  0x10000000U    unused */
 736                                   /*  0x20000000U    unused */
 737                                   /*  0x40000000U    unused */
 738 
 739 #define PNG_FLAG_CRC_ANCILLARY_MASK (PNG_FLAG_CRC_ANCILLARY_USE | \
 740                                      PNG_FLAG_CRC_ANCILLARY_NOWARN)
 741 
 742 #define PNG_FLAG_CRC_CRITICAL_MASK  (PNG_FLAG_CRC_CRITICAL_USE | \
 743                                      PNG_FLAG_CRC_CRITICAL_IGNORE)
 744 
 745 #define PNG_FLAG_CRC_MASK           (PNG_FLAG_CRC_ANCILLARY_MASK | \
 746                                      PNG_FLAG_CRC_CRITICAL_MASK)
 747 
 748 /* Save typing and make code easier to understand */
 749 
 750 #define PNG_COLOR_DIST(c1, c2) (abs((int)((c1).red) - (int)((c2).red)) + \
 751    abs((int)((c1).green) - (int)((c2).green)) + \
 752    abs((int)((c1).blue) - (int)((c2).blue)))
 753 
 754 /* Added to libpng-1.6.0: scale a 16-bit value in the range 0..65535 to 0..255
 755  * by dividing by 257 *with rounding*.  This macro is exact for the given range.
 756  * See the discourse in pngrtran.c png_do_scale_16_to_8.  The values in the
 757  * macro were established by experiment (modifying the added value).  The macro
 758  * has a second variant that takes a value already scaled by 255 and divides by
 759  * 65535 - this has a maximum error of .502.  Over the range 0..65535*65535 it
 760  * only gives off-by-one errors and only for 0.5% (1 in 200) of the values.
 761  */
 762 #define PNG_DIV65535(v24) (((v24) + 32895) &gt;&gt; 16)
 763 #define PNG_DIV257(v16) PNG_DIV65535((png_uint_32)(v16) * 255)
 764 
 765 /* Added to libpng-1.2.6 JB */
 766 #define PNG_ROWBYTES(pixel_bits, width) \
 767     ((pixel_bits) &gt;= 8 ? \
 768     ((size_t)(width) * (((size_t)(pixel_bits)) &gt;&gt; 3)) : \
 769     (( ((size_t)(width) * ((size_t)(pixel_bits))) + 7) &gt;&gt; 3) )
 770 
 771 /* This returns the number of trailing bits in the last byte of a row, 0 if the
 772  * last byte is completely full of pixels.  It is, in principle, (pixel_bits x
 773  * width) % 8, but that would overflow for large &#39;width&#39;.  The second macro is
 774  * the same except that it returns the number of unused bits in the last byte;
 775  * (8-TRAILBITS), but 0 when TRAILBITS is 0.
 776  *
 777  * NOTE: these macros are intended to be self-evidently correct and never
 778  * overflow on the assumption that pixel_bits is in the range 0..255.  The
 779  * arguments are evaluated only once and they can be signed (e.g. as a result of
 780  * the integral promotions).  The result of the expression always has type
 781  * (png_uint_32), however the compiler always knows it is in the range 0..7.
 782  */
 783 #define PNG_TRAILBITS(pixel_bits, width) \
 784     (((pixel_bits) * ((width) % (png_uint_32)8)) % 8)
 785 
 786 #define PNG_PADBITS(pixel_bits, width) \
 787     ((8 - PNG_TRAILBITS(pixel_bits, width)) % 8)
 788 
 789 /* PNG_OUT_OF_RANGE returns true if value is outside the range
 790  * ideal-delta..ideal+delta.  Each argument is evaluated twice.
 791  * &quot;ideal&quot; and &quot;delta&quot; should be constants, normally simple
 792  * integers, &quot;value&quot; a variable. Added to libpng-1.2.6 JB
 793  */
 794 #define PNG_OUT_OF_RANGE(value, ideal, delta) \
 795    ( (value) &lt; (ideal)-(delta) || (value) &gt; (ideal)+(delta) )
 796 
 797 /* Conversions between fixed and floating point, only defined if
 798  * required (to make sure the code doesn&#39;t accidentally use float
 799  * when it is supposedly disabled.)
 800  */
 801 #ifdef PNG_FLOATING_POINT_SUPPORTED
 802 /* The floating point conversion can&#39;t overflow, though it can and
 803  * does lose accuracy relative to the original fixed point value.
 804  * In practice this doesn&#39;t matter because png_fixed_point only
 805  * stores numbers with very low precision.  The png_ptr and s
 806  * arguments are unused by default but are there in case error
 807  * checking becomes a requirement.
 808  */
 809 #define png_float(png_ptr, fixed, s) (.00001 * (fixed))
 810 
 811 /* The fixed point conversion performs range checking and evaluates
 812  * its argument multiple times, so must be used with care.  The
 813  * range checking uses the PNG specification values for a signed
 814  * 32-bit fixed point value except that the values are deliberately
 815  * rounded-to-zero to an integral value - 21474 (21474.83 is roughly
 816  * (2^31-1) * 100000). &#39;s&#39; is a string that describes the value being
 817  * converted.
 818  *
 819  * NOTE: this macro will raise a png_error if the range check fails,
 820  * therefore it is normally only appropriate to use this on values
 821  * that come from API calls or other sources where an out of range
 822  * error indicates a programming error, not a data error!
 823  *
 824  * NOTE: by default this is off - the macro is not used - because the
 825  * function call saves a lot of code.
 826  */
 827 #ifdef PNG_FIXED_POINT_MACRO_SUPPORTED
 828 #define png_fixed(png_ptr, fp, s) ((fp) &lt;= 21474 &amp;&amp; (fp) &gt;= -21474 ?\
 829     ((png_fixed_point)(100000 * (fp))) : (png_fixed_error(png_ptr, s),0))
 830 #endif
 831 /* else the corresponding function is defined below, inside the scope of the
 832  * cplusplus test.
 833  */
 834 #endif
 835 
 836 /* Constants for known chunk types.  If you need to add a chunk, define the name
 837  * here.  For historical reasons these constants have the form png_&lt;name&gt;; i.e.
 838  * the prefix is lower case.  Please use decimal values as the parameters to
 839  * match the ISO PNG specification and to avoid relying on the C locale
 840  * interpretation of character values.
 841  *
 842  * Prior to 1.5.6 these constants were strings, as of 1.5.6 png_uint_32 values
 843  * are computed and a new macro (PNG_STRING_FROM_CHUNK) added to allow a string
 844  * to be generated if required.
 845  *
 846  * PNG_32b correctly produces a value shifted by up to 24 bits, even on
 847  * architectures where (int) is only 16 bits.
 848  */
 849 #define PNG_32b(b,s) ((png_uint_32)(b) &lt;&lt; (s))
 850 #define PNG_U32(b1,b2,b3,b4) \
 851    (PNG_32b(b1,24) | PNG_32b(b2,16) | PNG_32b(b3,8) | PNG_32b(b4,0))
 852 
 853 /* Constants for known chunk types.
 854  *
 855  * MAINTAINERS: If you need to add a chunk, define the name here.
 856  * For historical reasons these constants have the form png_&lt;name&gt;; i.e.
 857  * the prefix is lower case.  Please use decimal values as the parameters to
 858  * match the ISO PNG specification and to avoid relying on the C locale
 859  * interpretation of character values.  Please keep the list sorted.
 860  *
 861  * Notice that PNG_U32 is used to define a 32-bit value for the 4 byte chunk
 862  * type.  In fact the specification does not express chunk types this way,
 863  * however using a 32-bit value means that the chunk type can be read from the
 864  * stream using exactly the same code as used for a 32-bit unsigned value and
 865  * can be examined far more efficiently (using one arithmetic compare).
 866  *
 867  * Prior to 1.5.6 the chunk type constants were expressed as C strings.  The
 868  * libpng API still uses strings for &#39;unknown&#39; chunks and a macro,
 869  * PNG_STRING_FROM_CHUNK, allows a string to be generated if required.  Notice
 870  * that for portable code numeric values must still be used; the string &quot;IHDR&quot;
 871  * is not portable and neither is PNG_U32(&#39;I&#39;, &#39;H&#39;, &#39;D&#39;, &#39;R&#39;).
 872  *
 873  * In 1.7.0 the definitions will be made public in png.h to avoid having to
 874  * duplicate the same definitions in application code.
 875  */
 876 #define png_IDAT PNG_U32( 73,  68,  65,  84)
 877 #define png_IEND PNG_U32( 73,  69,  78,  68)
 878 #define png_IHDR PNG_U32( 73,  72,  68,  82)
 879 #define png_PLTE PNG_U32( 80,  76,  84,  69)
 880 #define png_bKGD PNG_U32( 98,  75,  71,  68)
 881 #define png_cHRM PNG_U32( 99,  72,  82,  77)
 882 #define png_eXIf PNG_U32(101,  88,  73, 102) /* registered July 2017 */
 883 #define png_fRAc PNG_U32(102,  82,  65,  99) /* registered, not defined */
 884 #define png_gAMA PNG_U32(103,  65,  77,  65)
 885 #define png_gIFg PNG_U32(103,  73,  70, 103)
 886 #define png_gIFt PNG_U32(103,  73,  70, 116) /* deprecated */
 887 #define png_gIFx PNG_U32(103,  73,  70, 120)
 888 #define png_hIST PNG_U32(104,  73,  83,  84)
 889 #define png_iCCP PNG_U32(105,  67,  67,  80)
 890 #define png_iTXt PNG_U32(105,  84,  88, 116)
 891 #define png_oFFs PNG_U32(111,  70,  70, 115)
 892 #define png_pCAL PNG_U32(112,  67,  65,  76)
 893 #define png_pHYs PNG_U32(112,  72,  89, 115)
 894 #define png_sBIT PNG_U32(115,  66,  73,  84)
 895 #define png_sCAL PNG_U32(115,  67,  65,  76)
 896 #define png_sPLT PNG_U32(115,  80,  76,  84)
 897 #define png_sRGB PNG_U32(115,  82,  71,  66)
 898 #define png_sTER PNG_U32(115,  84,  69,  82)
 899 #define png_tEXt PNG_U32(116,  69,  88, 116)
 900 #define png_tIME PNG_U32(116,  73,  77,  69)
 901 #define png_tRNS PNG_U32(116,  82,  78,  83)
 902 #define png_zTXt PNG_U32(122,  84,  88, 116)
 903 
 904 /* The following will work on (signed char*) strings, whereas the get_uint_32
 905  * macro will fail on top-bit-set values because of the sign extension.
 906  */
 907 #define PNG_CHUNK_FROM_STRING(s)\
 908    PNG_U32(0xff &amp; (s)[0], 0xff &amp; (s)[1], 0xff &amp; (s)[2], 0xff &amp; (s)[3])
 909 
 910 /* This uses (char), not (png_byte) to avoid warnings on systems where (char) is
 911  * signed and the argument is a (char[])  This macro will fail miserably on
 912  * systems where (char) is more than 8 bits.
 913  */
 914 #define PNG_STRING_FROM_CHUNK(s,c)\
 915    (void)(((char*)(s))[0]=(char)(((c)&gt;&gt;24) &amp; 0xff), \
 916    ((char*)(s))[1]=(char)(((c)&gt;&gt;16) &amp; 0xff),\
 917    ((char*)(s))[2]=(char)(((c)&gt;&gt;8) &amp; 0xff), \
 918    ((char*)(s))[3]=(char)((c &amp; 0xff)))
 919 
 920 /* Do the same but terminate with a null character. */
 921 #define PNG_CSTRING_FROM_CHUNK(s,c)\
 922    (void)(PNG_STRING_FROM_CHUNK(s,c), ((char*)(s))[4] = 0)
 923 
 924 /* Test on flag values as defined in the spec (section 5.4): */
 925 #define PNG_CHUNK_ANCILLARY(c)   (1 &amp; ((c) &gt;&gt; 29))
 926 #define PNG_CHUNK_CRITICAL(c)     (!PNG_CHUNK_ANCILLARY(c))
 927 #define PNG_CHUNK_PRIVATE(c)      (1 &amp; ((c) &gt;&gt; 21))
 928 #define PNG_CHUNK_RESERVED(c)     (1 &amp; ((c) &gt;&gt; 13))
 929 #define PNG_CHUNK_SAFE_TO_COPY(c) (1 &amp; ((c) &gt;&gt;  5))
 930 
 931 /* Gamma values (new at libpng-1.5.4): */
 932 #define PNG_GAMMA_MAC_OLD 151724  /* Assume &#39;1.8&#39; is really 2.2/1.45! */
 933 #define PNG_GAMMA_MAC_INVERSE 65909
 934 #define PNG_GAMMA_sRGB_INVERSE 45455
 935 
 936 /* Almost everything below is C specific; the #defines above can be used in
 937  * non-C code (so long as it is C-preprocessed) the rest of this stuff cannot.
 938  */
 939 #ifndef PNG_VERSION_INFO_ONLY
 940 
 941 #include &quot;pngstruct.h&quot;
 942 #include &quot;pnginfo.h&quot;
 943 
 944 /* Validate the include paths - the include path used to generate pnglibconf.h
 945  * must match that used in the build, or we must be using pnglibconf.h.prebuilt:
 946  */
 947 #if PNG_ZLIB_VERNUM != 0 &amp;&amp; PNG_ZLIB_VERNUM != ZLIB_VERNUM
 948 #  error ZLIB_VERNUM != PNG_ZLIB_VERNUM \
 949       &quot;-I (include path) error: see the notes in pngpriv.h&quot;
 950    /* This means that when pnglibconf.h was built the copy of zlib.h that it
 951     * used is not the same as the one being used here.  Because the build of
 952     * libpng makes decisions to use inflateInit2 and inflateReset2 based on the
 953     * zlib version number and because this affects handling of certain broken
 954     * PNG files the -I directives must match.
 955     *
 956     * The most likely explanation is that you passed a -I in CFLAGS. This will
 957     * not work; all the preprocessor directives and in particular all the -I
 958     * directives must be in CPPFLAGS.
 959     */
 960 #endif
 961 
 962 /* This is used for 16-bit gamma tables -- only the top level pointers are
 963  * const; this could be changed:
 964  */
 965 typedef const png_uint_16p * png_const_uint_16pp;
 966 
 967 /* Added to libpng-1.5.7: sRGB conversion tables */
 968 #if defined(PNG_SIMPLIFIED_READ_SUPPORTED) ||\
 969    defined(PNG_SIMPLIFIED_WRITE_SUPPORTED)
 970 #ifdef PNG_SIMPLIFIED_READ_SUPPORTED
 971 PNG_INTERNAL_DATA(const png_uint_16, png_sRGB_table, [256]);
 972    /* Convert from an sRGB encoded value 0..255 to a 16-bit linear value,
 973     * 0..65535.  This table gives the closest 16-bit answers (no errors).
 974     */
 975 #endif
 976 
 977 PNG_INTERNAL_DATA(const png_uint_16, png_sRGB_base, [512]);
 978 PNG_INTERNAL_DATA(const png_byte, png_sRGB_delta, [512]);
 979 
 980 #define PNG_sRGB_FROM_LINEAR(linear) \
 981   ((png_byte)(0xff &amp; ((png_sRGB_base[(linear)&gt;&gt;15] \
 982    + ((((linear) &amp; 0x7fff)*png_sRGB_delta[(linear)&gt;&gt;15])&gt;&gt;12)) &gt;&gt; 8)))
 983    /* Given a value &#39;linear&#39; in the range 0..255*65535 calculate the 8-bit sRGB
 984     * encoded value with maximum error 0.646365.  Note that the input is not a
 985     * 16-bit value; it has been multiplied by 255! */
 986 #endif /* SIMPLIFIED_READ/WRITE */
 987 
 988 
 989 /* Inhibit C++ name-mangling for libpng functions but not for system calls. */
 990 #ifdef __cplusplus
 991 extern &quot;C&quot; {
 992 #endif /* __cplusplus */
 993 
 994 /* Internal functions; these are not exported from a DLL however because they
 995  * are used within several of the C source files they have to be C extern.
 996  *
 997  * All of these functions must be declared with PNG_INTERNAL_FUNCTION.
 998  */
 999 
1000 /* Zlib support */
1001 #define PNG_UNEXPECTED_ZLIB_RETURN (-7)
1002 PNG_INTERNAL_FUNCTION(void, png_zstream_error,(png_structrp png_ptr, int ret),
1003    PNG_EMPTY);
1004    /* Used by the zlib handling functions to ensure that z_stream::msg is always
1005     * set before they return.
1006     */
1007 
1008 #ifdef PNG_WRITE_SUPPORTED
1009 PNG_INTERNAL_FUNCTION(void,png_free_buffer_list,(png_structrp png_ptr,
1010    png_compression_bufferp *list),PNG_EMPTY);
1011    /* Free the buffer list used by the compressed write code. */
1012 #endif
1013 
1014 #if defined(PNG_FLOATING_POINT_SUPPORTED) &amp;&amp; \
1015    !defined(PNG_FIXED_POINT_MACRO_SUPPORTED) &amp;&amp; \
1016    (defined(PNG_gAMA_SUPPORTED) || defined(PNG_cHRM_SUPPORTED) || \
1017    defined(PNG_sCAL_SUPPORTED) || defined(PNG_READ_BACKGROUND_SUPPORTED) || \
1018    defined(PNG_READ_RGB_TO_GRAY_SUPPORTED)) || \
1019    (defined(PNG_sCAL_SUPPORTED) &amp;&amp; \
1020    defined(PNG_FLOATING_ARITHMETIC_SUPPORTED))
1021 PNG_INTERNAL_FUNCTION(png_fixed_point,png_fixed,(png_const_structrp png_ptr,
1022    double fp, png_const_charp text),PNG_EMPTY);
1023 #endif
1024 
1025 /* Check the user version string for compatibility, returns false if the version
1026  * numbers aren&#39;t compatible.
1027  */
1028 PNG_INTERNAL_FUNCTION(int,png_user_version_check,(png_structrp png_ptr,
1029    png_const_charp user_png_ver),PNG_EMPTY);
1030 
1031 /* Internal base allocator - no messages, NULL on failure to allocate.  This
1032  * does, however, call the application provided allocator and that could call
1033  * png_error (although that would be a bug in the application implementation.)
1034  */
1035 PNG_INTERNAL_FUNCTION(png_voidp,png_malloc_base,(png_const_structrp png_ptr,
1036    png_alloc_size_t size),PNG_ALLOCATED);
1037 
1038 #if defined(PNG_TEXT_SUPPORTED) || defined(PNG_sPLT_SUPPORTED) ||\
1039    defined(PNG_STORE_UNKNOWN_CHUNKS_SUPPORTED)
1040 /* Internal array allocator, outputs no error or warning messages on failure,
1041  * just returns NULL.
1042  */
1043 PNG_INTERNAL_FUNCTION(png_voidp,png_malloc_array,(png_const_structrp png_ptr,
1044    int nelements, size_t element_size),PNG_ALLOCATED);
1045 
1046 /* The same but an existing array is extended by add_elements.  This function
1047  * also memsets the new elements to 0 and copies the old elements.  The old
1048  * array is not freed or altered.
1049  */
1050 PNG_INTERNAL_FUNCTION(png_voidp,png_realloc_array,(png_const_structrp png_ptr,
1051    png_const_voidp array, int old_elements, int add_elements,
1052    size_t element_size),PNG_ALLOCATED);
1053 #endif /* text, sPLT or unknown chunks */
1054 
1055 /* Magic to create a struct when there is no struct to call the user supplied
1056  * memory allocators.  Because error handling has not been set up the memory
1057  * handlers can&#39;t safely call png_error, but this is an obscure and undocumented
1058  * restriction so libpng has to assume that the &#39;free&#39; handler, at least, might
1059  * call png_error.
1060  */
1061 PNG_INTERNAL_FUNCTION(png_structp,png_create_png_struct,
1062    (png_const_charp user_png_ver, png_voidp error_ptr, png_error_ptr error_fn,
1063     png_error_ptr warn_fn, png_voidp mem_ptr, png_malloc_ptr malloc_fn,
1064     png_free_ptr free_fn),PNG_ALLOCATED);
1065 
1066 /* Free memory from internal libpng struct */
1067 PNG_INTERNAL_FUNCTION(void,png_destroy_png_struct,(png_structrp png_ptr),
1068    PNG_EMPTY);
1069 
1070 /* Free an allocated jmp_buf (always succeeds) */
1071 PNG_INTERNAL_FUNCTION(void,png_free_jmpbuf,(png_structrp png_ptr),PNG_EMPTY);
1072 
1073 /* Function to allocate memory for zlib.  PNGAPI is disallowed. */
1074 PNG_INTERNAL_FUNCTION(voidpf,png_zalloc,(voidpf png_ptr, uInt items, uInt size),
1075    PNG_ALLOCATED);
1076 
1077 /* Function to free memory for zlib.  PNGAPI is disallowed. */
1078 PNG_INTERNAL_FUNCTION(void,png_zfree,(voidpf png_ptr, voidpf ptr),PNG_EMPTY);
1079 
1080 /* Next four functions are used internally as callbacks.  PNGCBAPI is required
1081  * but not PNG_EXPORT.  PNGAPI added at libpng version 1.2.3, changed to
1082  * PNGCBAPI at 1.5.0
1083  */
1084 
1085 PNG_INTERNAL_FUNCTION(void PNGCBAPI,png_default_read_data,(png_structp png_ptr,
1086     png_bytep data, size_t length),PNG_EMPTY);
1087 
1088 #ifdef PNG_PROGRESSIVE_READ_SUPPORTED
1089 PNG_INTERNAL_FUNCTION(void PNGCBAPI,png_push_fill_buffer,(png_structp png_ptr,
1090     png_bytep buffer, size_t length),PNG_EMPTY);
1091 #endif
1092 
1093 PNG_INTERNAL_FUNCTION(void PNGCBAPI,png_default_write_data,(png_structp png_ptr,
1094     png_bytep data, size_t length),PNG_EMPTY);
1095 
1096 #ifdef PNG_WRITE_FLUSH_SUPPORTED
1097 #  ifdef PNG_STDIO_SUPPORTED
1098 PNG_INTERNAL_FUNCTION(void PNGCBAPI,png_default_flush,(png_structp png_ptr),
1099    PNG_EMPTY);
1100 #  endif
1101 #endif
1102 
1103 /* Reset the CRC variable */
1104 PNG_INTERNAL_FUNCTION(void,png_reset_crc,(png_structrp png_ptr),PNG_EMPTY);
1105 
1106 /* Write the &quot;data&quot; buffer to whatever output you are using */
1107 PNG_INTERNAL_FUNCTION(void,png_write_data,(png_structrp png_ptr,
1108     png_const_bytep data, size_t length),PNG_EMPTY);
1109 
1110 /* Read and check the PNG file signature */
1111 PNG_INTERNAL_FUNCTION(void,png_read_sig,(png_structrp png_ptr,
1112    png_inforp info_ptr),PNG_EMPTY);
1113 
1114 /* Read the chunk header (length + type name) */
1115 PNG_INTERNAL_FUNCTION(png_uint_32,png_read_chunk_header,(png_structrp png_ptr),
1116    PNG_EMPTY);
1117 
1118 /* Read data from whatever input you are using into the &quot;data&quot; buffer */
1119 PNG_INTERNAL_FUNCTION(void,png_read_data,(png_structrp png_ptr, png_bytep data,
1120     size_t length),PNG_EMPTY);
1121 
1122 /* Read bytes into buf, and update png_ptr-&gt;crc */
1123 PNG_INTERNAL_FUNCTION(void,png_crc_read,(png_structrp png_ptr, png_bytep buf,
1124     png_uint_32 length),PNG_EMPTY);
1125 
1126 /* Read &quot;skip&quot; bytes, read the file crc, and (optionally) verify png_ptr-&gt;crc */
1127 PNG_INTERNAL_FUNCTION(int,png_crc_finish,(png_structrp png_ptr,
1128    png_uint_32 skip),PNG_EMPTY);
1129 
1130 /* Read the CRC from the file and compare it to the libpng calculated CRC */
1131 PNG_INTERNAL_FUNCTION(int,png_crc_error,(png_structrp png_ptr),PNG_EMPTY);
1132 
1133 /* Calculate the CRC over a section of data.  Note that we are only
1134  * passing a maximum of 64K on systems that have this as a memory limit,
1135  * since this is the maximum buffer size we can specify.
1136  */
1137 PNG_INTERNAL_FUNCTION(void,png_calculate_crc,(png_structrp png_ptr,
1138    png_const_bytep ptr, size_t length),PNG_EMPTY);
1139 
1140 #ifdef PNG_WRITE_FLUSH_SUPPORTED
1141 PNG_INTERNAL_FUNCTION(void,png_flush,(png_structrp png_ptr),PNG_EMPTY);
1142 #endif
1143 
1144 /* Write various chunks */
1145 
1146 /* Write the IHDR chunk, and update the png_struct with the necessary
1147  * information.
1148  */
1149 PNG_INTERNAL_FUNCTION(void,png_write_IHDR,(png_structrp png_ptr,
1150    png_uint_32 width, png_uint_32 height, int bit_depth, int color_type,
1151    int compression_method, int filter_method, int interlace_method),PNG_EMPTY);
1152 
1153 PNG_INTERNAL_FUNCTION(void,png_write_PLTE,(png_structrp png_ptr,
1154    png_const_colorp palette, png_uint_32 num_pal),PNG_EMPTY);
1155 
1156 PNG_INTERNAL_FUNCTION(void,png_compress_IDAT,(png_structrp png_ptr,
1157    png_const_bytep row_data, png_alloc_size_t row_data_length, int flush),
1158    PNG_EMPTY);
1159 
1160 PNG_INTERNAL_FUNCTION(void,png_write_IEND,(png_structrp png_ptr),PNG_EMPTY);
1161 
1162 #ifdef PNG_WRITE_gAMA_SUPPORTED
1163 PNG_INTERNAL_FUNCTION(void,png_write_gAMA_fixed,(png_structrp png_ptr,
1164     png_fixed_point file_gamma),PNG_EMPTY);
1165 #endif
1166 
1167 #ifdef PNG_WRITE_sBIT_SUPPORTED
1168 PNG_INTERNAL_FUNCTION(void,png_write_sBIT,(png_structrp png_ptr,
1169     png_const_color_8p sbit, int color_type),PNG_EMPTY);
1170 #endif
1171 
1172 #ifdef PNG_WRITE_cHRM_SUPPORTED
1173 PNG_INTERNAL_FUNCTION(void,png_write_cHRM_fixed,(png_structrp png_ptr,
1174     const png_xy *xy), PNG_EMPTY);
1175    /* The xy value must have been previously validated */
1176 #endif
1177 
1178 #ifdef PNG_WRITE_sRGB_SUPPORTED
1179 PNG_INTERNAL_FUNCTION(void,png_write_sRGB,(png_structrp png_ptr,
1180     int intent),PNG_EMPTY);
1181 #endif
1182 
1183 #ifdef PNG_WRITE_eXIf_SUPPORTED
1184 PNG_INTERNAL_FUNCTION(void,png_write_eXIf,(png_structrp png_ptr,
1185     png_bytep exif, int num_exif),PNG_EMPTY);
1186 #endif
1187 
1188 #ifdef PNG_WRITE_iCCP_SUPPORTED
1189 PNG_INTERNAL_FUNCTION(void,png_write_iCCP,(png_structrp png_ptr,
1190    png_const_charp name, png_const_bytep profile), PNG_EMPTY);
1191    /* The profile must have been previously validated for correctness, the
1192     * length comes from the first four bytes.  Only the base, deflate,
1193     * compression is supported.
1194     */
1195 #endif
1196 
1197 #ifdef PNG_WRITE_sPLT_SUPPORTED
1198 PNG_INTERNAL_FUNCTION(void,png_write_sPLT,(png_structrp png_ptr,
1199     png_const_sPLT_tp palette),PNG_EMPTY);
1200 #endif
1201 
1202 #ifdef PNG_WRITE_tRNS_SUPPORTED
1203 PNG_INTERNAL_FUNCTION(void,png_write_tRNS,(png_structrp png_ptr,
1204     png_const_bytep trans, png_const_color_16p values, int number,
1205     int color_type),PNG_EMPTY);
1206 #endif
1207 
1208 #ifdef PNG_WRITE_bKGD_SUPPORTED
1209 PNG_INTERNAL_FUNCTION(void,png_write_bKGD,(png_structrp png_ptr,
1210     png_const_color_16p values, int color_type),PNG_EMPTY);
1211 #endif
1212 
1213 #ifdef PNG_WRITE_hIST_SUPPORTED
1214 PNG_INTERNAL_FUNCTION(void,png_write_hIST,(png_structrp png_ptr,
1215     png_const_uint_16p hist, int num_hist),PNG_EMPTY);
1216 #endif
1217 
1218 /* Chunks that have keywords */
1219 #ifdef PNG_WRITE_tEXt_SUPPORTED
1220 PNG_INTERNAL_FUNCTION(void,png_write_tEXt,(png_structrp png_ptr,
1221    png_const_charp key, png_const_charp text, size_t text_len),PNG_EMPTY);
1222 #endif
1223 
1224 #ifdef PNG_WRITE_zTXt_SUPPORTED
1225 PNG_INTERNAL_FUNCTION(void,png_write_zTXt,(png_structrp png_ptr, png_const_charp
1226     key, png_const_charp text, int compression),PNG_EMPTY);
1227 #endif
1228 
1229 #ifdef PNG_WRITE_iTXt_SUPPORTED
1230 PNG_INTERNAL_FUNCTION(void,png_write_iTXt,(png_structrp png_ptr,
1231     int compression, png_const_charp key, png_const_charp lang,
1232     png_const_charp lang_key, png_const_charp text),PNG_EMPTY);
1233 #endif
1234 
1235 #ifdef PNG_TEXT_SUPPORTED  /* Added at version 1.0.14 and 1.2.4 */
1236 PNG_INTERNAL_FUNCTION(int,png_set_text_2,(png_const_structrp png_ptr,
1237     png_inforp info_ptr, png_const_textp text_ptr, int num_text),PNG_EMPTY);
1238 #endif
1239 
1240 #ifdef PNG_WRITE_oFFs_SUPPORTED
1241 PNG_INTERNAL_FUNCTION(void,png_write_oFFs,(png_structrp png_ptr,
1242     png_int_32 x_offset, png_int_32 y_offset, int unit_type),PNG_EMPTY);
1243 #endif
1244 
1245 #ifdef PNG_WRITE_pCAL_SUPPORTED
1246 PNG_INTERNAL_FUNCTION(void,png_write_pCAL,(png_structrp png_ptr,
1247     png_charp purpose, png_int_32 X0, png_int_32 X1, int type, int nparams,
1248     png_const_charp units, png_charpp params),PNG_EMPTY);
1249 #endif
1250 
1251 #ifdef PNG_WRITE_pHYs_SUPPORTED
1252 PNG_INTERNAL_FUNCTION(void,png_write_pHYs,(png_structrp png_ptr,
1253     png_uint_32 x_pixels_per_unit, png_uint_32 y_pixels_per_unit,
1254     int unit_type),PNG_EMPTY);
1255 #endif
1256 
1257 #ifdef PNG_WRITE_tIME_SUPPORTED
1258 PNG_INTERNAL_FUNCTION(void,png_write_tIME,(png_structrp png_ptr,
1259     png_const_timep mod_time),PNG_EMPTY);
1260 #endif
1261 
1262 #ifdef PNG_WRITE_sCAL_SUPPORTED
1263 PNG_INTERNAL_FUNCTION(void,png_write_sCAL_s,(png_structrp png_ptr,
1264     int unit, png_const_charp width, png_const_charp height),PNG_EMPTY);
1265 #endif
1266 
1267 /* Called when finished processing a row of data */
1268 PNG_INTERNAL_FUNCTION(void,png_write_finish_row,(png_structrp png_ptr),
1269     PNG_EMPTY);
1270 
1271 /* Internal use only.   Called before first row of data */
1272 PNG_INTERNAL_FUNCTION(void,png_write_start_row,(png_structrp png_ptr),
1273     PNG_EMPTY);
1274 
1275 /* Combine a row of data, dealing with alpha, etc. if requested.  &#39;row&#39; is an
1276  * array of png_ptr-&gt;width pixels.  If the image is not interlaced or this
1277  * is the final pass this just does a memcpy, otherwise the &quot;display&quot; flag
1278  * is used to determine whether to copy pixels that are not in the current pass.
1279  *
1280  * Because &#39;png_do_read_interlace&#39; (below) replicates pixels this allows this
1281  * function to achieve the documented &#39;blocky&#39; appearance during interlaced read
1282  * if display is 1 and the &#39;sparkle&#39; appearance, where existing pixels in &#39;row&#39;
1283  * are not changed if they are not in the current pass, when display is 0.
1284  *
1285  * &#39;display&#39; must be 0 or 1, otherwise the memcpy will be done regardless.
1286  *
1287  * The API always reads from the png_struct row buffer and always assumes that
1288  * it is full width (png_do_read_interlace has already been called.)
1289  *
1290  * This function is only ever used to write to row buffers provided by the
1291  * caller of the relevant libpng API and the row must have already been
1292  * transformed by the read transformations.
1293  *
1294  * The PNG_USE_COMPILE_TIME_MASKS option causes generation of pre-computed
1295  * bitmasks for use within the code, otherwise runtime generated masks are used.
1296  * The default is compile time masks.
1297  */
1298 #ifndef PNG_USE_COMPILE_TIME_MASKS
1299 #  define PNG_USE_COMPILE_TIME_MASKS 1
1300 #endif
1301 PNG_INTERNAL_FUNCTION(void,png_combine_row,(png_const_structrp png_ptr,
1302     png_bytep row, int display),PNG_EMPTY);
1303 
1304 #ifdef PNG_READ_INTERLACING_SUPPORTED
1305 /* Expand an interlaced row: the &#39;row_info&#39; describes the pass data that has
1306  * been read in and must correspond to the pixels in &#39;row&#39;, the pixels are
1307  * expanded (moved apart) in &#39;row&#39; to match the final layout, when doing this
1308  * the pixels are *replicated* to the intervening space.  This is essential for
1309  * the correct operation of png_combine_row, above.
1310  */
1311 PNG_INTERNAL_FUNCTION(void,png_do_read_interlace,(png_row_infop row_info,
1312     png_bytep row, int pass, png_uint_32 transformations),PNG_EMPTY);
1313 #endif
1314 
1315 /* GRR TO DO (2.0 or whenever):  simplify other internal calling interfaces */
1316 
1317 #ifdef PNG_WRITE_INTERLACING_SUPPORTED
1318 /* Grab pixels out of a row for an interlaced pass */
1319 PNG_INTERNAL_FUNCTION(void,png_do_write_interlace,(png_row_infop row_info,
1320     png_bytep row, int pass),PNG_EMPTY);
1321 #endif
1322 
1323 /* Unfilter a row: check the filter value before calling this, there is no point
1324  * calling it for PNG_FILTER_VALUE_NONE.
1325  */
1326 PNG_INTERNAL_FUNCTION(void,png_read_filter_row,(png_structrp pp, png_row_infop
1327     row_info, png_bytep row, png_const_bytep prev_row, int filter),PNG_EMPTY);
1328 
1329 #if PNG_ARM_NEON_OPT &gt; 0
1330 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_up_neon,(png_row_infop row_info,
1331     png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1332 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_sub3_neon,(png_row_infop
1333     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1334 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_sub4_neon,(png_row_infop
1335     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1336 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_avg3_neon,(png_row_infop
1337     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1338 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_avg4_neon,(png_row_infop
1339     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1340 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_paeth3_neon,(png_row_infop
1341     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1342 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_paeth4_neon,(png_row_infop
1343     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1344 #endif
1345 
1346 #if PNG_MIPS_MSA_OPT &gt; 0
1347 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_up_msa,(png_row_infop row_info,
1348     png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1349 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_sub3_msa,(png_row_infop
1350     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1351 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_sub4_msa,(png_row_infop
1352     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1353 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_avg3_msa,(png_row_infop
1354     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1355 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_avg4_msa,(png_row_infop
1356     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1357 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_paeth3_msa,(png_row_infop
1358     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1359 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_paeth4_msa,(png_row_infop
1360     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1361 #endif
1362 
1363 #if PNG_POWERPC_VSX_OPT &gt; 0
1364 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_up_vsx,(png_row_infop row_info,
1365     png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1366 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_sub3_vsx,(png_row_infop
1367     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1368 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_sub4_vsx,(png_row_infop
1369     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1370 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_avg3_vsx,(png_row_infop
1371     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1372 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_avg4_vsx,(png_row_infop
1373     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1374 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_paeth3_vsx,(png_row_infop
1375     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1376 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_paeth4_vsx,(png_row_infop
1377     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1378 #endif
1379 
1380 #if PNG_INTEL_SSE_IMPLEMENTATION &gt; 0
1381 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_sub3_sse2,(png_row_infop
1382     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1383 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_sub4_sse2,(png_row_infop
1384     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1385 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_avg3_sse2,(png_row_infop
1386     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1387 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_avg4_sse2,(png_row_infop
1388     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1389 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_paeth3_sse2,(png_row_infop
1390     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1391 PNG_INTERNAL_FUNCTION(void,png_read_filter_row_paeth4_sse2,(png_row_infop
1392     row_info, png_bytep row, png_const_bytep prev_row),PNG_EMPTY);
1393 #endif
1394 
1395 /* Choose the best filter to use and filter the row data */
1396 PNG_INTERNAL_FUNCTION(void,png_write_find_filter,(png_structrp png_ptr,
1397     png_row_infop row_info),PNG_EMPTY);
1398 
1399 #ifdef PNG_SEQUENTIAL_READ_SUPPORTED
1400 PNG_INTERNAL_FUNCTION(void,png_read_IDAT_data,(png_structrp png_ptr,
1401    png_bytep output, png_alloc_size_t avail_out),PNG_EMPTY);
1402    /* Read &#39;avail_out&#39; bytes of data from the IDAT stream.  If the output buffer
1403     * is NULL the function checks, instead, for the end of the stream.  In this
1404     * case a benign error will be issued if the stream end is not found or if
1405     * extra data has to be consumed.
1406     */
1407 PNG_INTERNAL_FUNCTION(void,png_read_finish_IDAT,(png_structrp png_ptr),
1408    PNG_EMPTY);
1409    /* This cleans up when the IDAT LZ stream does not end when the last image
1410     * byte is read; there is still some pending input.
1411     */
1412 
1413 PNG_INTERNAL_FUNCTION(void,png_read_finish_row,(png_structrp png_ptr),
1414    PNG_EMPTY);
1415    /* Finish a row while reading, dealing with interlacing passes, etc. */
1416 #endif /* SEQUENTIAL_READ */
1417 
1418 /* Initialize the row buffers, etc. */
1419 PNG_INTERNAL_FUNCTION(void,png_read_start_row,(png_structrp png_ptr),PNG_EMPTY);
1420 
1421 #if ZLIB_VERNUM &gt;= 0x1240
1422 PNG_INTERNAL_FUNCTION(int,png_zlib_inflate,(png_structrp png_ptr, int flush),
1423       PNG_EMPTY);
1424 #  define PNG_INFLATE(pp, flush) png_zlib_inflate(pp, flush)
1425 #else /* Zlib &lt; 1.2.4 */
1426 #  define PNG_INFLATE(pp, flush) inflate(&amp;(pp)-&gt;zstream, flush)
1427 #endif /* Zlib &lt; 1.2.4 */
1428 
1429 #ifdef PNG_READ_TRANSFORMS_SUPPORTED
1430 /* Optional call to update the users info structure */
1431 PNG_INTERNAL_FUNCTION(void,png_read_transform_info,(png_structrp png_ptr,
1432     png_inforp info_ptr),PNG_EMPTY);
1433 #endif
1434 
1435 /* Shared transform functions, defined in pngtran.c */
1436 #if defined(PNG_WRITE_FILLER_SUPPORTED) || \
1437     defined(PNG_READ_STRIP_ALPHA_SUPPORTED)
1438 PNG_INTERNAL_FUNCTION(void,png_do_strip_channel,(png_row_infop row_info,
1439     png_bytep row, int at_start),PNG_EMPTY);
1440 #endif
1441 
1442 #ifdef PNG_16BIT_SUPPORTED
1443 #if defined(PNG_READ_SWAP_SUPPORTED) || defined(PNG_WRITE_SWAP_SUPPORTED)
1444 PNG_INTERNAL_FUNCTION(void,png_do_swap,(png_row_infop row_info,
1445     png_bytep row),PNG_EMPTY);
1446 #endif
1447 #endif
1448 
1449 #if defined(PNG_READ_PACKSWAP_SUPPORTED) || \
1450     defined(PNG_WRITE_PACKSWAP_SUPPORTED)
1451 PNG_INTERNAL_FUNCTION(void,png_do_packswap,(png_row_infop row_info,
1452     png_bytep row),PNG_EMPTY);
1453 #endif
1454 
1455 #if defined(PNG_READ_INVERT_SUPPORTED) || defined(PNG_WRITE_INVERT_SUPPORTED)
1456 PNG_INTERNAL_FUNCTION(void,png_do_invert,(png_row_infop row_info,
1457     png_bytep row),PNG_EMPTY);
1458 #endif
1459 
1460 #if defined(PNG_READ_BGR_SUPPORTED) || defined(PNG_WRITE_BGR_SUPPORTED)
1461 PNG_INTERNAL_FUNCTION(void,png_do_bgr,(png_row_infop row_info,
1462     png_bytep row),PNG_EMPTY);
1463 #endif
1464 
1465 /* The following decodes the appropriate chunks, and does error correction,
1466  * then calls the appropriate callback for the chunk if it is valid.
1467  */
1468 
1469 /* Decode the IHDR chunk */
1470 PNG_INTERNAL_FUNCTION(void,png_handle_IHDR,(png_structrp png_ptr,
1471     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1472 PNG_INTERNAL_FUNCTION(void,png_handle_PLTE,(png_structrp png_ptr,
1473     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1474 PNG_INTERNAL_FUNCTION(void,png_handle_IEND,(png_structrp png_ptr,
1475     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1476 
1477 #ifdef PNG_READ_bKGD_SUPPORTED
1478 PNG_INTERNAL_FUNCTION(void,png_handle_bKGD,(png_structrp png_ptr,
1479     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1480 #endif
1481 
1482 #ifdef PNG_READ_cHRM_SUPPORTED
1483 PNG_INTERNAL_FUNCTION(void,png_handle_cHRM,(png_structrp png_ptr,
1484     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1485 #endif
1486 
1487 #ifdef PNG_READ_eXIf_SUPPORTED
1488 PNG_INTERNAL_FUNCTION(void,png_handle_eXIf,(png_structrp png_ptr,
1489     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1490 #endif
1491 
1492 #ifdef PNG_READ_gAMA_SUPPORTED
1493 PNG_INTERNAL_FUNCTION(void,png_handle_gAMA,(png_structrp png_ptr,
1494     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1495 #endif
1496 
1497 #ifdef PNG_READ_hIST_SUPPORTED
1498 PNG_INTERNAL_FUNCTION(void,png_handle_hIST,(png_structrp png_ptr,
1499     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1500 #endif
1501 
1502 #ifdef PNG_READ_iCCP_SUPPORTED
1503 PNG_INTERNAL_FUNCTION(void,png_handle_iCCP,(png_structrp png_ptr,
1504     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1505 #endif /* READ_iCCP */
1506 
1507 #ifdef PNG_READ_iTXt_SUPPORTED
1508 PNG_INTERNAL_FUNCTION(void,png_handle_iTXt,(png_structrp png_ptr,
1509     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1510 #endif
1511 
1512 #ifdef PNG_READ_oFFs_SUPPORTED
1513 PNG_INTERNAL_FUNCTION(void,png_handle_oFFs,(png_structrp png_ptr,
1514     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1515 #endif
1516 
1517 #ifdef PNG_READ_pCAL_SUPPORTED
1518 PNG_INTERNAL_FUNCTION(void,png_handle_pCAL,(png_structrp png_ptr,
1519     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1520 #endif
1521 
1522 #ifdef PNG_READ_pHYs_SUPPORTED
1523 PNG_INTERNAL_FUNCTION(void,png_handle_pHYs,(png_structrp png_ptr,
1524     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1525 #endif
1526 
1527 #ifdef PNG_READ_sBIT_SUPPORTED
1528 PNG_INTERNAL_FUNCTION(void,png_handle_sBIT,(png_structrp png_ptr,
1529     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1530 #endif
1531 
1532 #ifdef PNG_READ_sCAL_SUPPORTED
1533 PNG_INTERNAL_FUNCTION(void,png_handle_sCAL,(png_structrp png_ptr,
1534     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1535 #endif
1536 
1537 #ifdef PNG_READ_sPLT_SUPPORTED
1538 PNG_INTERNAL_FUNCTION(void,png_handle_sPLT,(png_structrp png_ptr,
1539     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1540 #endif /* READ_sPLT */
1541 
1542 #ifdef PNG_READ_sRGB_SUPPORTED
1543 PNG_INTERNAL_FUNCTION(void,png_handle_sRGB,(png_structrp png_ptr,
1544     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1545 #endif
1546 
1547 #ifdef PNG_READ_tEXt_SUPPORTED
1548 PNG_INTERNAL_FUNCTION(void,png_handle_tEXt,(png_structrp png_ptr,
1549     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1550 #endif
1551 
1552 #ifdef PNG_READ_tIME_SUPPORTED
1553 PNG_INTERNAL_FUNCTION(void,png_handle_tIME,(png_structrp png_ptr,
1554     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1555 #endif
1556 
1557 #ifdef PNG_READ_tRNS_SUPPORTED
1558 PNG_INTERNAL_FUNCTION(void,png_handle_tRNS,(png_structrp png_ptr,
1559     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1560 #endif
1561 
1562 #ifdef PNG_READ_zTXt_SUPPORTED
1563 PNG_INTERNAL_FUNCTION(void,png_handle_zTXt,(png_structrp png_ptr,
1564     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1565 #endif
1566 
1567 PNG_INTERNAL_FUNCTION(void,png_check_chunk_name,(png_const_structrp png_ptr,
<a name="5" id="anc5"></a><span class="line-modified">1568     png_uint_32 chunk_name),PNG_EMPTY);</span>
1569 
1570 PNG_INTERNAL_FUNCTION(void,png_check_chunk_length,(png_const_structrp png_ptr,
<a name="6" id="anc6"></a><span class="line-modified">1571     png_uint_32 chunk_length),PNG_EMPTY);</span>
1572 
1573 PNG_INTERNAL_FUNCTION(void,png_handle_unknown,(png_structrp png_ptr,
1574     png_inforp info_ptr, png_uint_32 length, int keep),PNG_EMPTY);
1575    /* This is the function that gets called for unknown chunks.  The &#39;keep&#39;
1576     * argument is either non-zero for a known chunk that has been set to be
1577     * handled as unknown or zero for an unknown chunk.  By default the function
1578     * just skips the chunk or errors out if it is critical.
1579     */
1580 
1581 #if defined(PNG_READ_UNKNOWN_CHUNKS_SUPPORTED) ||\
1582     defined(PNG_HANDLE_AS_UNKNOWN_SUPPORTED)
1583 PNG_INTERNAL_FUNCTION(int,png_chunk_unknown_handling,
1584     (png_const_structrp png_ptr, png_uint_32 chunk_name),PNG_EMPTY);
1585    /* Exactly as the API png_handle_as_unknown() except that the argument is a
1586     * 32-bit chunk name, not a string.
1587     */
1588 #endif /* READ_UNKNOWN_CHUNKS || HANDLE_AS_UNKNOWN */
1589 
1590 /* Handle the transformations for reading and writing */
1591 #ifdef PNG_READ_TRANSFORMS_SUPPORTED
1592 PNG_INTERNAL_FUNCTION(void,png_do_read_transformations,(png_structrp png_ptr,
1593    png_row_infop row_info),PNG_EMPTY);
1594 #endif
1595 #ifdef PNG_WRITE_TRANSFORMS_SUPPORTED
1596 PNG_INTERNAL_FUNCTION(void,png_do_write_transformations,(png_structrp png_ptr,
1597    png_row_infop row_info),PNG_EMPTY);
1598 #endif
1599 
1600 #ifdef PNG_READ_TRANSFORMS_SUPPORTED
1601 PNG_INTERNAL_FUNCTION(void,png_init_read_transformations,(png_structrp png_ptr),
1602     PNG_EMPTY);
1603 #endif
1604 
1605 #ifdef PNG_PROGRESSIVE_READ_SUPPORTED
1606 PNG_INTERNAL_FUNCTION(void,png_push_read_chunk,(png_structrp png_ptr,
1607     png_inforp info_ptr),PNG_EMPTY);
1608 PNG_INTERNAL_FUNCTION(void,png_push_read_sig,(png_structrp png_ptr,
1609     png_inforp info_ptr),PNG_EMPTY);
1610 PNG_INTERNAL_FUNCTION(void,png_push_check_crc,(png_structrp png_ptr),PNG_EMPTY);
1611 PNG_INTERNAL_FUNCTION(void,png_push_save_buffer,(png_structrp png_ptr),
1612     PNG_EMPTY);
1613 PNG_INTERNAL_FUNCTION(void,png_push_restore_buffer,(png_structrp png_ptr,
1614     png_bytep buffer, size_t buffer_length),PNG_EMPTY);
1615 PNG_INTERNAL_FUNCTION(void,png_push_read_IDAT,(png_structrp png_ptr),PNG_EMPTY);
1616 PNG_INTERNAL_FUNCTION(void,png_process_IDAT_data,(png_structrp png_ptr,
1617     png_bytep buffer, size_t buffer_length),PNG_EMPTY);
1618 PNG_INTERNAL_FUNCTION(void,png_push_process_row,(png_structrp png_ptr),
1619     PNG_EMPTY);
1620 PNG_INTERNAL_FUNCTION(void,png_push_handle_unknown,(png_structrp png_ptr,
1621    png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1622 PNG_INTERNAL_FUNCTION(void,png_push_have_info,(png_structrp png_ptr,
1623    png_inforp info_ptr),PNG_EMPTY);
1624 PNG_INTERNAL_FUNCTION(void,png_push_have_end,(png_structrp png_ptr,
1625    png_inforp info_ptr),PNG_EMPTY);
1626 PNG_INTERNAL_FUNCTION(void,png_push_have_row,(png_structrp png_ptr,
1627     png_bytep row),PNG_EMPTY);
1628 PNG_INTERNAL_FUNCTION(void,png_push_read_end,(png_structrp png_ptr,
1629     png_inforp info_ptr),PNG_EMPTY);
1630 PNG_INTERNAL_FUNCTION(void,png_process_some_data,(png_structrp png_ptr,
1631     png_inforp info_ptr),PNG_EMPTY);
1632 PNG_INTERNAL_FUNCTION(void,png_read_push_finish_row,(png_structrp png_ptr),
1633     PNG_EMPTY);
1634 #  ifdef PNG_READ_tEXt_SUPPORTED
1635 PNG_INTERNAL_FUNCTION(void,png_push_handle_tEXt,(png_structrp png_ptr,
1636     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1637 PNG_INTERNAL_FUNCTION(void,png_push_read_tEXt,(png_structrp png_ptr,
1638     png_inforp info_ptr),PNG_EMPTY);
1639 #  endif
1640 #  ifdef PNG_READ_zTXt_SUPPORTED
1641 PNG_INTERNAL_FUNCTION(void,png_push_handle_zTXt,(png_structrp png_ptr,
1642     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1643 PNG_INTERNAL_FUNCTION(void,png_push_read_zTXt,(png_structrp png_ptr,
1644     png_inforp info_ptr),PNG_EMPTY);
1645 #  endif
1646 #  ifdef PNG_READ_iTXt_SUPPORTED
1647 PNG_INTERNAL_FUNCTION(void,png_push_handle_iTXt,(png_structrp png_ptr,
1648     png_inforp info_ptr, png_uint_32 length),PNG_EMPTY);
1649 PNG_INTERNAL_FUNCTION(void,png_push_read_iTXt,(png_structrp png_ptr,
1650     png_inforp info_ptr),PNG_EMPTY);
1651 #  endif
1652 
1653 #endif /* PROGRESSIVE_READ */
1654 
1655 /* Added at libpng version 1.6.0 */
1656 #ifdef PNG_GAMMA_SUPPORTED
1657 PNG_INTERNAL_FUNCTION(void,png_colorspace_set_gamma,(png_const_structrp png_ptr,
1658     png_colorspacerp colorspace, png_fixed_point gAMA), PNG_EMPTY);
1659    /* Set the colorspace gamma with a value provided by the application or by
1660     * the gAMA chunk on read.  The value will override anything set by an ICC
1661     * profile.
1662     */
1663 
1664 PNG_INTERNAL_FUNCTION(void,png_colorspace_sync_info,(png_const_structrp png_ptr,
1665     png_inforp info_ptr), PNG_EMPTY);
1666    /* Synchronize the info &#39;valid&#39; flags with the colorspace */
1667 
1668 PNG_INTERNAL_FUNCTION(void,png_colorspace_sync,(png_const_structrp png_ptr,
1669     png_inforp info_ptr), PNG_EMPTY);
1670    /* Copy the png_struct colorspace to the info_struct and call the above to
1671     * synchronize the flags.  Checks for NULL info_ptr and does nothing.
1672     */
1673 #endif
1674 
1675 /* Added at libpng version 1.4.0 */
1676 #ifdef PNG_COLORSPACE_SUPPORTED
1677 /* These internal functions are for maintaining the colorspace structure within
1678  * a png_info or png_struct (or, indeed, both).
1679  */
1680 PNG_INTERNAL_FUNCTION(int,png_colorspace_set_chromaticities,
1681    (png_const_structrp png_ptr, png_colorspacerp colorspace, const png_xy *xy,
1682     int preferred), PNG_EMPTY);
1683 
1684 PNG_INTERNAL_FUNCTION(int,png_colorspace_set_endpoints,
1685    (png_const_structrp png_ptr, png_colorspacerp colorspace, const png_XYZ *XYZ,
1686     int preferred), PNG_EMPTY);
1687 
1688 #ifdef PNG_sRGB_SUPPORTED
1689 PNG_INTERNAL_FUNCTION(int,png_colorspace_set_sRGB,(png_const_structrp png_ptr,
1690    png_colorspacerp colorspace, int intent), PNG_EMPTY);
1691    /* This does set the colorspace gAMA and cHRM values too, but doesn&#39;t set the
1692     * flags to write them, if it returns false there was a problem and an error
1693     * message has already been output (but the colorspace may still need to be
1694     * synced to record the invalid flag).
1695     */
1696 #endif /* sRGB */
1697 
1698 #ifdef PNG_iCCP_SUPPORTED
1699 PNG_INTERNAL_FUNCTION(int,png_colorspace_set_ICC,(png_const_structrp png_ptr,
1700    png_colorspacerp colorspace, png_const_charp name,
1701    png_uint_32 profile_length, png_const_bytep profile, int color_type),
1702    PNG_EMPTY);
1703    /* The &#39;name&#39; is used for information only */
1704 
1705 /* Routines for checking parts of an ICC profile. */
1706 #ifdef PNG_READ_iCCP_SUPPORTED
1707 PNG_INTERNAL_FUNCTION(int,png_icc_check_length,(png_const_structrp png_ptr,
1708    png_colorspacerp colorspace, png_const_charp name,
1709    png_uint_32 profile_length), PNG_EMPTY);
1710 #endif /* READ_iCCP */
1711 PNG_INTERNAL_FUNCTION(int,png_icc_check_header,(png_const_structrp png_ptr,
1712    png_colorspacerp colorspace, png_const_charp name,
1713    png_uint_32 profile_length,
1714    png_const_bytep profile /* first 132 bytes only */, int color_type),
1715    PNG_EMPTY);
1716 PNG_INTERNAL_FUNCTION(int,png_icc_check_tag_table,(png_const_structrp png_ptr,
1717    png_colorspacerp colorspace, png_const_charp name,
1718    png_uint_32 profile_length,
1719    png_const_bytep profile /* header plus whole tag table */), PNG_EMPTY);
1720 #ifdef PNG_sRGB_SUPPORTED
1721 PNG_INTERNAL_FUNCTION(void,png_icc_set_sRGB,(
1722    png_const_structrp png_ptr, png_colorspacerp colorspace,
1723    png_const_bytep profile, uLong adler), PNG_EMPTY);
1724    /* &#39;adler&#39; is the Adler32 checksum of the uncompressed profile data. It may
1725     * be zero to indicate that it is not available.  It is used, if provided,
1726     * as a fast check on the profile when checking to see if it is sRGB.
1727     */
1728 #endif
1729 #endif /* iCCP */
1730 
1731 #ifdef PNG_READ_RGB_TO_GRAY_SUPPORTED
1732 PNG_INTERNAL_FUNCTION(void,png_colorspace_set_rgb_coefficients,
1733    (png_structrp png_ptr), PNG_EMPTY);
1734    /* Set the rgb_to_gray coefficients from the colorspace Y values */
1735 #endif /* READ_RGB_TO_GRAY */
1736 #endif /* COLORSPACE */
1737 
1738 /* Added at libpng version 1.4.0 */
1739 PNG_INTERNAL_FUNCTION(void,png_check_IHDR,(png_const_structrp png_ptr,
1740     png_uint_32 width, png_uint_32 height, int bit_depth,
1741     int color_type, int interlace_type, int compression_type,
1742     int filter_type),PNG_EMPTY);
1743 
1744 /* Added at libpng version 1.5.10 */
1745 #if defined(PNG_READ_CHECK_FOR_INVALID_INDEX_SUPPORTED) || \
1746     defined(PNG_WRITE_CHECK_FOR_INVALID_INDEX_SUPPORTED)
1747 PNG_INTERNAL_FUNCTION(void,png_do_check_palette_indexes,
1748    (png_structrp png_ptr, png_row_infop row_info),PNG_EMPTY);
1749 #endif
1750 
1751 #if defined(PNG_FLOATING_POINT_SUPPORTED) &amp;&amp; defined(PNG_ERROR_TEXT_SUPPORTED)
1752 PNG_INTERNAL_FUNCTION(void,png_fixed_error,(png_const_structrp png_ptr,
1753    png_const_charp name),PNG_NORETURN);
1754 #endif
1755 
1756 /* Puts &#39;string&#39; into &#39;buffer&#39; at buffer[pos], taking care never to overwrite
1757  * the end.  Always leaves the buffer nul terminated.  Never errors out (and
1758  * there is no error code.)
1759  */
1760 PNG_INTERNAL_FUNCTION(size_t,png_safecat,(png_charp buffer, size_t bufsize,
1761    size_t pos, png_const_charp string),PNG_EMPTY);
1762 
1763 /* Various internal functions to handle formatted warning messages, currently
1764  * only implemented for warnings.
1765  */
1766 #if defined(PNG_WARNINGS_SUPPORTED) || defined(PNG_TIME_RFC1123_SUPPORTED)
1767 /* Utility to dump an unsigned value into a buffer, given a start pointer and
1768  * and end pointer (which should point just *beyond* the end of the buffer!)
1769  * Returns the pointer to the start of the formatted string.  This utility only
1770  * does unsigned values.
1771  */
1772 PNG_INTERNAL_FUNCTION(png_charp,png_format_number,(png_const_charp start,
1773    png_charp end, int format, png_alloc_size_t number),PNG_EMPTY);
1774 
1775 /* Convenience macro that takes an array: */
1776 #define PNG_FORMAT_NUMBER(buffer,format,number) \
1777    png_format_number(buffer, buffer + (sizeof buffer), format, number)
1778 
1779 /* Suggested size for a number buffer (enough for 64 bits and a sign!) */
1780 #define PNG_NUMBER_BUFFER_SIZE 24
1781 
1782 /* These are the integer formats currently supported, the name is formed from
1783  * the standard printf(3) format string.
1784  */
1785 #define PNG_NUMBER_FORMAT_u     1 /* chose unsigned API! */
1786 #define PNG_NUMBER_FORMAT_02u   2
1787 #define PNG_NUMBER_FORMAT_d     1 /* chose signed API! */
1788 #define PNG_NUMBER_FORMAT_02d   2
1789 #define PNG_NUMBER_FORMAT_x     3
1790 #define PNG_NUMBER_FORMAT_02x   4
1791 #define PNG_NUMBER_FORMAT_fixed 5 /* choose the signed API */
1792 #endif
1793 
1794 #ifdef PNG_WARNINGS_SUPPORTED
1795 /* New defines and members adding in libpng-1.5.4 */
1796 #  define PNG_WARNING_PARAMETER_SIZE 32
1797 #  define PNG_WARNING_PARAMETER_COUNT 8 /* Maximum 9; see pngerror.c */
1798 
1799 /* An l-value of this type has to be passed to the APIs below to cache the
1800  * values of the parameters to a formatted warning message.
1801  */
1802 typedef char png_warning_parameters[PNG_WARNING_PARAMETER_COUNT][
1803    PNG_WARNING_PARAMETER_SIZE];
1804 
1805 PNG_INTERNAL_FUNCTION(void,png_warning_parameter,(png_warning_parameters p,
1806    int number, png_const_charp string),PNG_EMPTY);
1807    /* Parameters are limited in size to PNG_WARNING_PARAMETER_SIZE characters,
1808     * including the trailing &#39;\0&#39;.
1809     */
1810 PNG_INTERNAL_FUNCTION(void,png_warning_parameter_unsigned,
1811    (png_warning_parameters p, int number, int format, png_alloc_size_t value),
1812    PNG_EMPTY);
1813    /* Use png_alloc_size_t because it is an unsigned type as big as any we
1814     * need to output.  Use the following for a signed value.
1815     */
1816 PNG_INTERNAL_FUNCTION(void,png_warning_parameter_signed,
1817    (png_warning_parameters p, int number, int format, png_int_32 value),
1818    PNG_EMPTY);
1819 
1820 PNG_INTERNAL_FUNCTION(void,png_formatted_warning,(png_const_structrp png_ptr,
1821    png_warning_parameters p, png_const_charp message),PNG_EMPTY);
1822    /* &#39;message&#39; follows the X/Open approach of using @1, @2 to insert
1823     * parameters previously supplied using the above functions.  Errors in
1824     * specifying the parameters will simply result in garbage substitutions.
1825     */
1826 #endif
1827 
1828 #ifdef PNG_BENIGN_ERRORS_SUPPORTED
1829 /* Application errors (new in 1.6); use these functions (declared below) for
1830  * errors in the parameters or order of API function calls on read.  The
1831  * &#39;warning&#39; should be used for an error that can be handled completely; the
1832  * &#39;error&#39; for one which can be handled safely but which may lose application
1833  * information or settings.
1834  *
1835  * By default these both result in a png_error call prior to release, while in a
1836  * released version the &#39;warning&#39; is just a warning.  However if the application
1837  * explicitly disables benign errors (explicitly permitting the code to lose
1838  * information) they both turn into warnings.
1839  *
1840  * If benign errors aren&#39;t supported they end up as the corresponding base call
1841  * (png_warning or png_error.)
1842  */
1843 PNG_INTERNAL_FUNCTION(void,png_app_warning,(png_const_structrp png_ptr,
1844    png_const_charp message),PNG_EMPTY);
1845    /* The application provided invalid parameters to an API function or called
1846     * an API function at the wrong time, libpng can completely recover.
1847     */
1848 
1849 PNG_INTERNAL_FUNCTION(void,png_app_error,(png_const_structrp png_ptr,
1850    png_const_charp message),PNG_EMPTY);
1851    /* As above but libpng will ignore the call, or attempt some other partial
1852     * recovery from the error.
1853     */
1854 #else
1855 #  define png_app_warning(pp,s) png_warning(pp,s)
1856 #  define png_app_error(pp,s) png_error(pp,s)
1857 #endif
1858 
1859 PNG_INTERNAL_FUNCTION(void,png_chunk_report,(png_const_structrp png_ptr,
1860    png_const_charp message, int error),PNG_EMPTY);
1861    /* Report a recoverable issue in chunk data.  On read this is used to report
1862     * a problem found while reading a particular chunk and the
1863     * png_chunk_benign_error or png_chunk_warning function is used as
1864     * appropriate.  On write this is used to report an error that comes from
1865     * data set via an application call to a png_set_ API and png_app_error or
1866     * png_app_warning is used as appropriate.
1867     *
1868     * The &#39;error&#39; parameter must have one of the following values:
1869     */
1870 #define PNG_CHUNK_WARNING     0 /* never an error */
1871 #define PNG_CHUNK_WRITE_ERROR 1 /* an error only on write */
1872 #define PNG_CHUNK_ERROR       2 /* always an error */
1873 
1874 /* ASCII to FP interfaces, currently only implemented if sCAL
1875  * support is required.
1876  */
1877 #if defined(PNG_sCAL_SUPPORTED)
1878 /* MAX_DIGITS is actually the maximum number of characters in an sCAL
1879  * width or height, derived from the precision (number of significant
1880  * digits - a build time settable option) and assumptions about the
1881  * maximum ridiculous exponent.
1882  */
1883 #define PNG_sCAL_MAX_DIGITS (PNG_sCAL_PRECISION+1/*.*/+1/*E*/+10/*exponent*/)
1884 
1885 #ifdef PNG_FLOATING_POINT_SUPPORTED
1886 PNG_INTERNAL_FUNCTION(void,png_ascii_from_fp,(png_const_structrp png_ptr,
1887    png_charp ascii, size_t size, double fp, unsigned int precision),
1888    PNG_EMPTY);
1889 #endif /* FLOATING_POINT */
1890 
1891 #ifdef PNG_FIXED_POINT_SUPPORTED
1892 PNG_INTERNAL_FUNCTION(void,png_ascii_from_fixed,(png_const_structrp png_ptr,
1893    png_charp ascii, size_t size, png_fixed_point fp),PNG_EMPTY);
1894 #endif /* FIXED_POINT */
1895 #endif /* sCAL */
1896 
1897 #if defined(PNG_sCAL_SUPPORTED) || defined(PNG_pCAL_SUPPORTED)
1898 /* An internal API to validate the format of a floating point number.
1899  * The result is the index of the next character.  If the number is
1900  * not valid it will be the index of a character in the supposed number.
1901  *
1902  * The format of a number is defined in the PNG extensions specification
1903  * and this API is strictly conformant to that spec, not anyone elses!
1904  *
1905  * The format as a regular expression is:
1906  *
1907  * [+-]?[0-9]+.?([Ee][+-]?[0-9]+)?
1908  *
1909  * or:
1910  *
1911  * [+-]?.[0-9]+(.[0-9]+)?([Ee][+-]?[0-9]+)?
1912  *
1913  * The complexity is that either integer or fraction must be present and the
1914  * fraction is permitted to have no digits only if the integer is present.
1915  *
1916  * NOTE: The dangling E problem.
1917  *   There is a PNG valid floating point number in the following:
1918  *
1919  *       PNG floating point numbers are not greedy.
1920  *
1921  *   Working this out requires *TWO* character lookahead (because of the
1922  *   sign), the parser does not do this - it will fail at the &#39;r&#39; - this
1923  *   doesn&#39;t matter for PNG sCAL chunk values, but it requires more care
1924  *   if the value were ever to be embedded in something more complex.  Use
1925  *   ANSI-C strtod if you need the lookahead.
1926  */
1927 /* State table for the parser. */
1928 #define PNG_FP_INTEGER    0  /* before or in integer */
1929 #define PNG_FP_FRACTION   1  /* before or in fraction */
1930 #define PNG_FP_EXPONENT   2  /* before or in exponent */
1931 #define PNG_FP_STATE      3  /* mask for the above */
1932 #define PNG_FP_SAW_SIGN   4  /* Saw +/- in current state */
1933 #define PNG_FP_SAW_DIGIT  8  /* Saw a digit in current state */
1934 #define PNG_FP_SAW_DOT   16  /* Saw a dot in current state */
1935 #define PNG_FP_SAW_E     32  /* Saw an E (or e) in current state */
1936 #define PNG_FP_SAW_ANY   60  /* Saw any of the above 4 */
1937 
1938 /* These three values don&#39;t affect the parser.  They are set but not used.
1939  */
1940 #define PNG_FP_WAS_VALID 64  /* Preceding substring is a valid fp number */
1941 #define PNG_FP_NEGATIVE 128  /* A negative number, including &quot;-0&quot; */
1942 #define PNG_FP_NONZERO  256  /* A non-zero value */
1943 #define PNG_FP_STICKY   448  /* The above three flags */
1944 
1945 /* This is available for the caller to store in &#39;state&#39; if required.  Do not
1946  * call the parser after setting it (the parser sometimes clears it.)
1947  */
1948 #define PNG_FP_INVALID  512  /* Available for callers as a distinct value */
1949 
1950 /* Result codes for the parser (boolean - true meants ok, false means
1951  * not ok yet.)
1952  */
1953 #define PNG_FP_MAYBE      0  /* The number may be valid in the future */
1954 #define PNG_FP_OK         1  /* The number is valid */
1955 
1956 /* Tests on the sticky non-zero and negative flags.  To pass these checks
1957  * the state must also indicate that the whole number is valid - this is
1958  * achieved by testing PNG_FP_SAW_DIGIT (see the implementation for why this
1959  * is equivalent to PNG_FP_OK above.)
1960  */
1961 #define PNG_FP_NZ_MASK (PNG_FP_SAW_DIGIT | PNG_FP_NEGATIVE | PNG_FP_NONZERO)
1962    /* NZ_MASK: the string is valid and a non-zero negative value */
1963 #define PNG_FP_Z_MASK (PNG_FP_SAW_DIGIT | PNG_FP_NONZERO)
1964    /* Z MASK: the string is valid and a non-zero value. */
1965    /* PNG_FP_SAW_DIGIT: the string is valid. */
1966 #define PNG_FP_IS_ZERO(state) (((state) &amp; PNG_FP_Z_MASK) == PNG_FP_SAW_DIGIT)
1967 #define PNG_FP_IS_POSITIVE(state) (((state) &amp; PNG_FP_NZ_MASK) == PNG_FP_Z_MASK)
1968 #define PNG_FP_IS_NEGATIVE(state) (((state) &amp; PNG_FP_NZ_MASK) == PNG_FP_NZ_MASK)
1969 
1970 /* The actual parser.  This can be called repeatedly. It updates
1971  * the index into the string and the state variable (which must
1972  * be initialized to 0).  It returns a result code, as above.  There
1973  * is no point calling the parser any more if it fails to advance to
1974  * the end of the string - it is stuck on an invalid character (or
1975  * terminated by &#39;\0&#39;).
1976  *
1977  * Note that the pointer will consume an E or even an E+ and then leave
1978  * a &#39;maybe&#39; state even though a preceding integer.fraction is valid.
1979  * The PNG_FP_WAS_VALID flag indicates that a preceding substring was
1980  * a valid number.  It&#39;s possible to recover from this by calling
1981  * the parser again (from the start, with state 0) but with a string
1982  * that omits the last character (i.e. set the size to the index of
1983  * the problem character.)  This has not been tested within libpng.
1984  */
1985 PNG_INTERNAL_FUNCTION(int,png_check_fp_number,(png_const_charp string,
1986    size_t size, int *statep, png_size_tp whereami),PNG_EMPTY);
1987 
1988 /* This is the same but it checks a complete string and returns true
1989  * only if it just contains a floating point number.  As of 1.5.4 this
1990  * function also returns the state at the end of parsing the number if
1991  * it was valid (otherwise it returns 0.)  This can be used for testing
1992  * for negative or zero values using the sticky flag.
1993  */
1994 PNG_INTERNAL_FUNCTION(int,png_check_fp_string,(png_const_charp string,
1995    size_t size),PNG_EMPTY);
1996 #endif /* pCAL || sCAL */
1997 
1998 #if defined(PNG_GAMMA_SUPPORTED) ||\
1999     defined(PNG_INCH_CONVERSIONS_SUPPORTED) || defined(PNG_READ_pHYs_SUPPORTED)
2000 /* Added at libpng version 1.5.0 */
2001 /* This is a utility to provide a*times/div (rounded) and indicate
2002  * if there is an overflow.  The result is a boolean - false (0)
2003  * for overflow, true (1) if no overflow, in which case *res
2004  * holds the result.
2005  */
2006 PNG_INTERNAL_FUNCTION(int,png_muldiv,(png_fixed_point_p res, png_fixed_point a,
2007    png_int_32 multiplied_by, png_int_32 divided_by),PNG_EMPTY);
2008 #endif
2009 
2010 #if defined(PNG_READ_GAMMA_SUPPORTED) || defined(PNG_INCH_CONVERSIONS_SUPPORTED)
2011 /* Same deal, but issue a warning on overflow and return 0. */
2012 PNG_INTERNAL_FUNCTION(png_fixed_point,png_muldiv_warn,
2013    (png_const_structrp png_ptr, png_fixed_point a, png_int_32 multiplied_by,
2014    png_int_32 divided_by),PNG_EMPTY);
2015 #endif
2016 
2017 #ifdef PNG_GAMMA_SUPPORTED
2018 /* Calculate a reciprocal - used for gamma values.  This returns
2019  * 0 if the argument is 0 in order to maintain an undefined value;
2020  * there are no warnings.
2021  */
2022 PNG_INTERNAL_FUNCTION(png_fixed_point,png_reciprocal,(png_fixed_point a),
2023    PNG_EMPTY);
2024 
2025 #ifdef PNG_READ_GAMMA_SUPPORTED
2026 /* The same but gives a reciprocal of the product of two fixed point
2027  * values.  Accuracy is suitable for gamma calculations but this is
2028  * not exact - use png_muldiv for that.  Only required at present on read.
2029  */
2030 PNG_INTERNAL_FUNCTION(png_fixed_point,png_reciprocal2,(png_fixed_point a,
2031    png_fixed_point b),PNG_EMPTY);
2032 #endif
2033 
2034 /* Return true if the gamma value is significantly different from 1.0 */
2035 PNG_INTERNAL_FUNCTION(int,png_gamma_significant,(png_fixed_point gamma_value),
2036    PNG_EMPTY);
2037 #endif
2038 
2039 #ifdef PNG_READ_GAMMA_SUPPORTED
2040 /* Internal fixed point gamma correction.  These APIs are called as
2041  * required to convert single values - they don&#39;t need to be fast,
2042  * they are not used when processing image pixel values.
2043  *
2044  * While the input is an &#39;unsigned&#39; value it must actually be the
2045  * correct bit value - 0..255 or 0..65535 as required.
2046  */
2047 PNG_INTERNAL_FUNCTION(png_uint_16,png_gamma_correct,(png_structrp png_ptr,
2048    unsigned int value, png_fixed_point gamma_value),PNG_EMPTY);
2049 PNG_INTERNAL_FUNCTION(png_uint_16,png_gamma_16bit_correct,(unsigned int value,
2050    png_fixed_point gamma_value),PNG_EMPTY);
2051 PNG_INTERNAL_FUNCTION(png_byte,png_gamma_8bit_correct,(unsigned int value,
2052    png_fixed_point gamma_value),PNG_EMPTY);
2053 PNG_INTERNAL_FUNCTION(void,png_destroy_gamma_table,(png_structrp png_ptr),
2054    PNG_EMPTY);
2055 PNG_INTERNAL_FUNCTION(void,png_build_gamma_table,(png_structrp png_ptr,
2056    int bit_depth),PNG_EMPTY);
2057 #endif
2058 
2059 /* SIMPLIFIED READ/WRITE SUPPORT */
2060 #if defined(PNG_SIMPLIFIED_READ_SUPPORTED) ||\
2061    defined(PNG_SIMPLIFIED_WRITE_SUPPORTED)
2062 /* The internal structure that png_image::opaque points to. */
2063 typedef struct png_control
2064 {
2065    png_structp png_ptr;
2066    png_infop   info_ptr;
2067    png_voidp   error_buf;           /* Always a jmp_buf at present. */
2068 
2069    png_const_bytep memory;          /* Memory buffer. */
2070    size_t          size;            /* Size of the memory buffer. */
2071 
2072    unsigned int for_write       :1; /* Otherwise it is a read structure */
2073    unsigned int owned_file      :1; /* We own the file in io_ptr */
2074 } png_control;
2075 
2076 /* Return the pointer to the jmp_buf from a png_control: necessary because C
2077  * does not reveal the type of the elements of jmp_buf.
2078  */
2079 #ifdef __cplusplus
2080 #  define png_control_jmp_buf(pc) (((jmp_buf*)((pc)-&gt;error_buf))[0])
2081 #else
2082 #  define png_control_jmp_buf(pc) ((pc)-&gt;error_buf)
2083 #endif
2084 
2085 /* Utility to safely execute a piece of libpng code catching and logging any
2086  * errors that might occur.  Returns true on success, false on failure (either
2087  * of the function or as a result of a png_error.)
2088  */
2089 PNG_INTERNAL_CALLBACK(void,png_safe_error,(png_structp png_ptr,
2090    png_const_charp error_message),PNG_NORETURN);
2091 
2092 #ifdef PNG_WARNINGS_SUPPORTED
2093 PNG_INTERNAL_CALLBACK(void,png_safe_warning,(png_structp png_ptr,
2094    png_const_charp warning_message),PNG_EMPTY);
2095 #else
2096 #  define png_safe_warning 0/*dummy argument*/
2097 #endif
2098 
2099 PNG_INTERNAL_FUNCTION(int,png_safe_execute,(png_imagep image,
2100    int (*function)(png_voidp), png_voidp arg),PNG_EMPTY);
2101 
2102 /* Utility to log an error; this also cleans up the png_image; the function
2103  * always returns 0 (false).
2104  */
2105 PNG_INTERNAL_FUNCTION(int,png_image_error,(png_imagep image,
2106    png_const_charp error_message),PNG_EMPTY);
2107 
2108 #ifndef PNG_SIMPLIFIED_READ_SUPPORTED
2109 /* png_image_free is used by the write code but not exported */
2110 PNG_INTERNAL_FUNCTION(void, png_image_free, (png_imagep image), PNG_EMPTY);
2111 #endif /* !SIMPLIFIED_READ */
2112 
2113 #endif /* SIMPLIFIED READ/WRITE */
2114 
2115 /* These are initialization functions for hardware specific PNG filter
2116  * optimizations; list these here then select the appropriate one at compile
2117  * time using the macro PNG_FILTER_OPTIMIZATIONS.  If the macro is not defined
2118  * the generic code is used.
2119  */
2120 #ifdef PNG_FILTER_OPTIMIZATIONS
2121 PNG_INTERNAL_FUNCTION(void, PNG_FILTER_OPTIMIZATIONS, (png_structp png_ptr,
2122    unsigned int bpp), PNG_EMPTY);
2123    /* Just declare the optimization that will be used */
2124 #else
2125    /* List *all* the possible optimizations here - this branch is required if
2126     * the builder of libpng passes the definition of PNG_FILTER_OPTIMIZATIONS in
2127     * CFLAGS in place of CPPFLAGS *and* uses symbol prefixing.
2128     */
2129 #  if PNG_ARM_NEON_OPT &gt; 0
2130 PNG_INTERNAL_FUNCTION(void, png_init_filter_functions_neon,
2131    (png_structp png_ptr, unsigned int bpp), PNG_EMPTY);
2132 #endif
2133 
2134 #if PNG_MIPS_MSA_OPT &gt; 0
2135 PNG_INTERNAL_FUNCTION(void, png_init_filter_functions_msa,
2136    (png_structp png_ptr, unsigned int bpp), PNG_EMPTY);
2137 #endif
2138 
2139 #  if PNG_INTEL_SSE_IMPLEMENTATION &gt; 0
2140 PNG_INTERNAL_FUNCTION(void, png_init_filter_functions_sse2,
2141    (png_structp png_ptr, unsigned int bpp), PNG_EMPTY);
2142 #  endif
2143 #endif
2144 
2145 PNG_INTERNAL_FUNCTION(png_uint_32, png_check_keyword, (png_structrp png_ptr,
2146    png_const_charp key, png_bytep new_key), PNG_EMPTY);
2147 
<a name="7" id="anc7"></a><span class="line-added">2148 #if PNG_ARM_NEON_IMPLEMENTATION == 1</span>
<span class="line-added">2149 PNG_INTERNAL_FUNCTION(void,</span>
<span class="line-added">2150                       png_riffle_palette_neon,</span>
<span class="line-added">2151                       (png_structrp),</span>
<span class="line-added">2152                       PNG_EMPTY);</span>
<span class="line-added">2153 PNG_INTERNAL_FUNCTION(int,</span>
<span class="line-added">2154                       png_do_expand_palette_rgba8_neon,</span>
<span class="line-added">2155                       (png_structrp,</span>
<span class="line-added">2156                        png_row_infop,</span>
<span class="line-added">2157                        png_const_bytep,</span>
<span class="line-added">2158                        const png_bytepp,</span>
<span class="line-added">2159                        const png_bytepp),</span>
<span class="line-added">2160                       PNG_EMPTY);</span>
<span class="line-added">2161 PNG_INTERNAL_FUNCTION(int,</span>
<span class="line-added">2162                       png_do_expand_palette_rgb8_neon,</span>
<span class="line-added">2163                       (png_structrp,</span>
<span class="line-added">2164                        png_row_infop,</span>
<span class="line-added">2165                        png_const_bytep,</span>
<span class="line-added">2166                        const png_bytepp,</span>
<span class="line-added">2167                        const png_bytepp),</span>
<span class="line-added">2168                       PNG_EMPTY);</span>
<span class="line-added">2169 #endif</span>
<span class="line-added">2170 </span>
2171 /* Maintainer: Put new private prototypes here ^ */
2172 
2173 #include &quot;pngdebug.h&quot;
2174 
2175 #ifdef __cplusplus
2176 }
2177 #endif
2178 
2179 #endif /* PNG_VERSION_INFO_ONLY */
2180 #endif /* PNGPRIV_H */
<a name="8" id="anc8"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="8" type="hidden" />
</body>
</html>