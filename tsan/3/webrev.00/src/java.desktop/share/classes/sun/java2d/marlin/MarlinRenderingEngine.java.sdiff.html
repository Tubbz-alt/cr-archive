<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/classes/sun/java2d/marlin/MarlinRenderingEngine.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="Helpers.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="Stroker.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/sun/java2d/marlin/MarlinRenderingEngine.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 228                  src,
 229                  at,
 230                  lw,
 231                  normalize,
 232                  bs.getEndCap(),
 233                  bs.getLineJoin(),
 234                  bs.getMiterLimit(),
 235                  bs.getDashArray(),
 236                  bs.getDashPhase(),
 237                  pc2d);
 238     }
 239 
 240     private float userSpaceLineWidth(AffineTransform at, float lw) {
 241 
 242         float widthScale;
 243 
 244         if (at == null) {
 245             widthScale = 1.0f;
 246         } else if ((at.getType() &amp; (AffineTransform.TYPE_GENERAL_TRANSFORM  |
 247                                     AffineTransform.TYPE_GENERAL_SCALE)) != 0) {
<span class="line-modified"> 248             widthScale = (float)Math.sqrt(at.getDeterminant());</span>

 249         } else {
 250             // First calculate the &quot;maximum scale&quot; of this transform.
 251             double A = at.getScaleX();       // m00
 252             double C = at.getShearX();       // m01
 253             double B = at.getShearY();       // m10
 254             double D = at.getScaleY();       // m11
 255 
 256             /*
 257              * Given a 2 x 2 affine matrix [ A B ] such that
 258              *                             [ C D ]
 259              * v&#39; = [x&#39; y&#39;] = [Ax + Cy, Bx + Dy], we want to
 260              * find the maximum magnitude (norm) of the vector v&#39;
 261              * with the constraint (x^2 + y^2 = 1).
 262              * The equation to maximize is
 263              *     |v&#39;| = sqrt((Ax+Cy)^2+(Bx+Dy)^2)
 264              * or  |v&#39;| = sqrt((AA+BB)x^2 + 2(AC+BD)xy + (CC+DD)y^2).
 265              * Since sqrt is monotonic we can maximize |v&#39;|^2
 266              * instead and plug in the substitution y = sqrt(1 - x^2).
 267              * Trigonometric equalities can then be used to get
 268              * rid of most of the sqrt terms.
</pre>
</td>
<td>
<hr />
<pre>
 228                  src,
 229                  at,
 230                  lw,
 231                  normalize,
 232                  bs.getEndCap(),
 233                  bs.getLineJoin(),
 234                  bs.getMiterLimit(),
 235                  bs.getDashArray(),
 236                  bs.getDashPhase(),
 237                  pc2d);
 238     }
 239 
 240     private float userSpaceLineWidth(AffineTransform at, float lw) {
 241 
 242         float widthScale;
 243 
 244         if (at == null) {
 245             widthScale = 1.0f;
 246         } else if ((at.getType() &amp; (AffineTransform.TYPE_GENERAL_TRANSFORM  |
 247                                     AffineTransform.TYPE_GENERAL_SCALE)) != 0) {
<span class="line-modified"> 248             // Determinant may be negative (flip), use its absolute value:</span>
<span class="line-added"> 249             widthScale = (float)Math.sqrt(Math.abs(at.getDeterminant()));</span>
 250         } else {
 251             // First calculate the &quot;maximum scale&quot; of this transform.
 252             double A = at.getScaleX();       // m00
 253             double C = at.getShearX();       // m01
 254             double B = at.getShearY();       // m10
 255             double D = at.getScaleY();       // m11
 256 
 257             /*
 258              * Given a 2 x 2 affine matrix [ A B ] such that
 259              *                             [ C D ]
 260              * v&#39; = [x&#39; y&#39;] = [Ax + Cy, Bx + Dy], we want to
 261              * find the maximum magnitude (norm) of the vector v&#39;
 262              * with the constraint (x^2 + y^2 = 1).
 263              * The equation to maximize is
 264              *     |v&#39;| = sqrt((Ax+Cy)^2+(Bx+Dy)^2)
 265              * or  |v&#39;| = sqrt((AA+BB)x^2 + 2(AC+BD)xy + (CC+DD)y^2).
 266              * Since sqrt is monotonic we can maximize |v&#39;|^2
 267              * instead and plug in the substitution y = sqrt(1 - x^2).
 268              * Trigonometric equalities can then be used to get
 269              * rid of most of the sqrt terms.
</pre>
</td>
</tr>
</table>
<center><a href="Helpers.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="Stroker.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>