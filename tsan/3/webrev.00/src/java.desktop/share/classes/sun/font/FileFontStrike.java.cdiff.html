<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/classes/sun/font/FileFontStrike.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="FileFont.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="Font2D.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/sun/font/FileFontStrike.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 326,20 ***</span>
       */
      private native long _getGlyphImageFromWindows(String family,
                                                    int style,
                                                    int size,
                                                    int glyphCode,
<span class="line-modified">!                                                   boolean fracMetrics);</span>
  
      long getGlyphImageFromWindows(int glyphCode) {
          String family = fileFont.getFamilyName(null);
          int style = desc.style &amp; Font.BOLD | desc.style &amp; Font.ITALIC
              | fileFont.getStyle();
          int size = intPtSize;
          long ptr = _getGlyphImageFromWindows
              (family, style, size, glyphCode,
<span class="line-modified">!              desc.fmHint == INTVAL_FRACTIONALMETRICS_ON);</span>
          if (ptr != 0) {
              /* Get the advance from the JDK rasterizer. This is mostly
               * necessary for the fractional metrics case, but there are
               * also some very small number (&lt;0.25%) of marginal cases where
               * there is some rounding difference between windows and JDK.
<span class="line-new-header">--- 326,22 ---</span>
       */
      private native long _getGlyphImageFromWindows(String family,
                                                    int style,
                                                    int size,
                                                    int glyphCode,
<span class="line-modified">!                                                   boolean fracMetrics,</span>
<span class="line-added">+                                                   int fontDataSize);</span>
  
      long getGlyphImageFromWindows(int glyphCode) {
          String family = fileFont.getFamilyName(null);
          int style = desc.style &amp; Font.BOLD | desc.style &amp; Font.ITALIC
              | fileFont.getStyle();
          int size = intPtSize;
          long ptr = _getGlyphImageFromWindows
              (family, style, size, glyphCode,
<span class="line-modified">!              desc.fmHint == INTVAL_FRACTIONALMETRICS_ON,</span>
<span class="line-added">+              ((TrueTypeFont)fileFont).fontDataSize);</span>
          if (ptr != 0) {
              /* Get the advance from the JDK rasterizer. This is mostly
               * necessary for the fractional metrics case, but there are
               * also some very small number (&lt;0.25%) of marginal cases where
               * there is some rounding difference between windows and JDK.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 349,10 ***</span>
<span class="line-new-header">--- 351,16 ---</span>
              float advance = getGlyphAdvance(glyphCode, false);
              StrikeCache.unsafe.putFloat(ptr + StrikeCache.xAdvanceOffset,
                                          advance);
              return ptr;
          } else {
<span class="line-added">+             if (FontUtilities.isLogging()) {</span>
<span class="line-added">+                 FontUtilities.getLogger().warning(</span>
<span class="line-added">+                         &quot;Failed to render glyph using GDI: code=&quot; + glyphCode</span>
<span class="line-added">+                                 + &quot;, fontFamily=&quot; + family + &quot;, style=&quot; + style</span>
<span class="line-added">+                                 + &quot;, size=&quot; + size);</span>
<span class="line-added">+             }</span>
              return fileFont.getGlyphImage(pScalerContext, glyphCode);
          }
      }
  
      /* Try the native strikes first, then try the fileFont strike */
</pre>
<center><a href="FileFont.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="Font2D.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>