<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/share/classes/sun/java2d/SunGraphicsEnvironment.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="SunGraphics2D.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="marlin/DDasher.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/sun/java2d/SunGraphicsEnvironment.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 1997, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -37,14 +37,10 @@</span>
  import java.awt.Rectangle;
  import java.awt.Toolkit;
  import java.awt.geom.AffineTransform;
  import java.awt.image.BufferedImage;
  import java.awt.peer.ComponentPeer;
<span class="udiff-line-removed">- import java.io.BufferedReader;</span>
<span class="udiff-line-removed">- import java.io.File;</span>
<span class="udiff-line-removed">- import java.io.FileInputStream;</span>
<span class="udiff-line-removed">- import java.io.InputStreamReader;</span>
  import java.security.AccessController;
  import java.util.Locale;
  import java.util.TreeMap;
  
  import sun.awt.DisplayChangedListener;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -63,70 +59,22 @@</span>
   * @see GraphicsConfiguration
   */
  public abstract class SunGraphicsEnvironment extends GraphicsEnvironment
      implements DisplayChangedListener {
  
<span class="udiff-line-modified-removed">-     public static boolean isOpenSolaris;</span>
<span class="udiff-line-modified-removed">-     private static Font defaultFont;</span>
<span class="udiff-line-modified-added">+     /** Establish the default font to be used by SG2D. */</span>
<span class="udiff-line-modified-added">+     private final Font defaultFont = new Font(Font.DIALOG, Font.PLAIN, 12);</span>
  
      private static final boolean uiScaleEnabled;
      private static final double debugScale;
  
      static {
          uiScaleEnabled = &quot;true&quot;.equals(AccessController.doPrivileged(
                  new GetPropertyAction(&quot;sun.java2d.uiScale.enabled&quot;, &quot;true&quot;)));
          debugScale = uiScaleEnabled ? getScaleFactor(&quot;sun.java2d.uiScale&quot;) : -1;
      }
  
<span class="udiff-line-removed">-     public SunGraphicsEnvironment() {</span>
<span class="udiff-line-removed">-         java.security.AccessController.doPrivileged(</span>
<span class="udiff-line-removed">-                                     new java.security.PrivilegedAction&lt;Object&gt;() {</span>
<span class="udiff-line-removed">-             public Object run() {</span>
<span class="udiff-line-removed">-                 String osName = System.getProperty(&quot;os.name&quot;);</span>
<span class="udiff-line-removed">-                 if (&quot;SunOS&quot;.equals(osName)) {</span>
<span class="udiff-line-removed">-                     String version = System.getProperty(&quot;os.version&quot;, &quot;0.0&quot;);</span>
<span class="udiff-line-removed">-                     try {</span>
<span class="udiff-line-removed">-                         float ver = Float.parseFloat(version);</span>
<span class="udiff-line-removed">-                         if (ver &gt; 5.10f) {</span>
<span class="udiff-line-removed">-                             File f = new File(&quot;/etc/release&quot;);</span>
<span class="udiff-line-removed">-                             FileInputStream fis = new FileInputStream(f);</span>
<span class="udiff-line-removed">-                             InputStreamReader isr</span>
<span class="udiff-line-removed">-                                 = new InputStreamReader(fis, &quot;ISO-8859-1&quot;);</span>
<span class="udiff-line-removed">-                             BufferedReader br = new BufferedReader(isr);</span>
<span class="udiff-line-removed">-                             String line = br.readLine();</span>
<span class="udiff-line-removed">-                             if (line.indexOf(&quot;OpenSolaris&quot;) &gt;= 0) {</span>
<span class="udiff-line-removed">-                                 isOpenSolaris = true;</span>
<span class="udiff-line-removed">-                             } else {</span>
<span class="udiff-line-removed">-                                 /* We are using isOpenSolaris as meaning</span>
<span class="udiff-line-removed">-                                  * we know the Solaris commercial fonts aren&#39;t</span>
<span class="udiff-line-removed">-                                  * present. &quot;Solaris Next&quot; (03/10) did not</span>
<span class="udiff-line-removed">-                                  * include these even though its was not</span>
<span class="udiff-line-removed">-                                  * OpenSolaris. Need to revisit how this is</span>
<span class="udiff-line-removed">-                                  * handled but for now as in 6ux, we&#39;ll use</span>
<span class="udiff-line-removed">-                                  * the test for a standard font resource as</span>
<span class="udiff-line-removed">-                                  * being an indicator as to whether we need</span>
<span class="udiff-line-removed">-                                  * to treat this as OpenSolaris from a font</span>
<span class="udiff-line-removed">-                                  * config perspective.</span>
<span class="udiff-line-removed">-                                  */</span>
<span class="udiff-line-removed">-                                 String courierNew =</span>
<span class="udiff-line-removed">-                                     &quot;/usr/openwin/lib/X11/fonts/TrueType/CourierNew.ttf&quot;;</span>
<span class="udiff-line-removed">-                                 File courierFile = new File(courierNew);</span>
<span class="udiff-line-removed">-                                 isOpenSolaris = !courierFile.exists();</span>
<span class="udiff-line-removed">-                             }</span>
<span class="udiff-line-removed">-                             fis.close();</span>
<span class="udiff-line-removed">-                         }</span>
<span class="udiff-line-removed">-                     } catch (Exception e) {</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-                 /* Establish the default font to be used by SG2D etc */</span>
<span class="udiff-line-removed">-                 defaultFont = new Font(Font.DIALOG, Font.PLAIN, 12);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 return null;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         });</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
      protected GraphicsDevice[] screens;
  
      /**
       * Returns an array of all of the screen devices.
       */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -414,9 +362,40 @@</span>
          gc = getGraphicsConfigurationAtPoint(gc, x, y);
  
          AffineTransform tx = gc.getDefaultTransform();
          x = Region.clipRound(x * tx.getScaleX());
          y = Region.clipRound(y * tx.getScaleY());
<span class="udiff-line-removed">- </span>
          return new Point((int) x, (int) y);
      }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * Converts bounds from the user&#39;s space to the device space using</span>
<span class="udiff-line-added">+      * appropriate device transformation.</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * @param  bounds the rectangle in the user space</span>
<span class="udiff-line-added">+      * @return the rectangle which uses device space(pixels)</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     public static Rectangle convertToDeviceSpace(Rectangle bounds) {</span>
<span class="udiff-line-added">+         GraphicsConfiguration gc = getLocalGraphicsEnvironment()</span>
<span class="udiff-line-added">+                 .getDefaultScreenDevice().getDefaultConfiguration();</span>
<span class="udiff-line-added">+         gc = getGraphicsConfigurationAtPoint(gc, bounds.x, bounds.y);</span>
<span class="udiff-line-added">+         return convertToDeviceSpace(gc, bounds);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * Converts bounds from the user&#39;s space to the device space using</span>
<span class="udiff-line-added">+      * appropriate device transformation of the passed graphics configuration.</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * @param  bounds the rectangle in the user space</span>
<span class="udiff-line-added">+      * @return the rectangle which uses device space(pixels)</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     public static Rectangle convertToDeviceSpace(GraphicsConfiguration gc,</span>
<span class="udiff-line-added">+                                                  Rectangle bounds) {</span>
<span class="udiff-line-added">+         AffineTransform tx = gc.getDefaultTransform();</span>
<span class="udiff-line-added">+         return new Rectangle(</span>
<span class="udiff-line-added">+                 Region.clipRound(bounds.x * tx.getScaleX()),</span>
<span class="udiff-line-added">+                 Region.clipRound(bounds.y * tx.getScaleY()),</span>
<span class="udiff-line-added">+                 Region.clipRound(bounds.width * tx.getScaleX()),</span>
<span class="udiff-line-added">+                 Region.clipRound(bounds.height * tx.getScaleY())</span>
<span class="udiff-line-added">+         );</span>
<span class="udiff-line-added">+     }</span>
  }
</pre>
<center><a href="SunGraphics2D.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="marlin/DDasher.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>