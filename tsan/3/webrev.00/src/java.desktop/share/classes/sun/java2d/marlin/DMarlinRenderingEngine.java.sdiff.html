<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/classes/sun/java2d/marlin/DMarlinRenderingEngine.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="DHelpers.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="DStroker.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/sun/java2d/marlin/DMarlinRenderingEngine.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 229                  src,
 230                  at,
 231                  lw,
 232                  normalize,
 233                  bs.getEndCap(),
 234                  bs.getLineJoin(),
 235                  bs.getMiterLimit(),
 236                  bs.getDashArray(),
 237                  bs.getDashPhase(),
 238                  pc2d);
 239     }
 240 
 241     private double userSpaceLineWidth(AffineTransform at, double lw) {
 242 
 243         double widthScale;
 244 
 245         if (at == null) {
 246             widthScale = 1.0d;
 247         } else if ((at.getType() &amp; (AffineTransform.TYPE_GENERAL_TRANSFORM  |
 248                                     AffineTransform.TYPE_GENERAL_SCALE)) != 0) {
<span class="line-modified"> 249             widthScale = Math.sqrt(at.getDeterminant());</span>

 250         } else {
 251             // First calculate the &quot;maximum scale&quot; of this transform.
 252             double A = at.getScaleX();       // m00
 253             double C = at.getShearX();       // m01
 254             double B = at.getShearY();       // m10
 255             double D = at.getScaleY();       // m11
 256 
 257             /*
 258              * Given a 2 x 2 affine matrix [ A B ] such that
 259              *                             [ C D ]
 260              * v&#39; = [x&#39; y&#39;] = [Ax + Cy, Bx + Dy], we want to
 261              * find the maximum magnitude (norm) of the vector v&#39;
 262              * with the constraint (x^2 + y^2 = 1).
 263              * The equation to maximize is
 264              *     |v&#39;| = sqrt((Ax+Cy)^2+(Bx+Dy)^2)
 265              * or  |v&#39;| = sqrt((AA+BB)x^2 + 2(AC+BD)xy + (CC+DD)y^2).
 266              * Since sqrt is monotonic we can maximize |v&#39;|^2
 267              * instead and plug in the substitution y = sqrt(1 - x^2).
 268              * Trigonometric equalities can then be used to get
 269              * rid of most of the sqrt terms.
</pre>
</td>
<td>
<hr />
<pre>
 229                  src,
 230                  at,
 231                  lw,
 232                  normalize,
 233                  bs.getEndCap(),
 234                  bs.getLineJoin(),
 235                  bs.getMiterLimit(),
 236                  bs.getDashArray(),
 237                  bs.getDashPhase(),
 238                  pc2d);
 239     }
 240 
 241     private double userSpaceLineWidth(AffineTransform at, double lw) {
 242 
 243         double widthScale;
 244 
 245         if (at == null) {
 246             widthScale = 1.0d;
 247         } else if ((at.getType() &amp; (AffineTransform.TYPE_GENERAL_TRANSFORM  |
 248                                     AffineTransform.TYPE_GENERAL_SCALE)) != 0) {
<span class="line-modified"> 249             // Determinant may be negative (flip), use its absolute value:</span>
<span class="line-added"> 250             widthScale = Math.sqrt(Math.abs(at.getDeterminant()));</span>
 251         } else {
 252             // First calculate the &quot;maximum scale&quot; of this transform.
 253             double A = at.getScaleX();       // m00
 254             double C = at.getShearX();       // m01
 255             double B = at.getShearY();       // m10
 256             double D = at.getScaleY();       // m11
 257 
 258             /*
 259              * Given a 2 x 2 affine matrix [ A B ] such that
 260              *                             [ C D ]
 261              * v&#39; = [x&#39; y&#39;] = [Ax + Cy, Bx + Dy], we want to
 262              * find the maximum magnitude (norm) of the vector v&#39;
 263              * with the constraint (x^2 + y^2 = 1).
 264              * The equation to maximize is
 265              *     |v&#39;| = sqrt((Ax+Cy)^2+(Bx+Dy)^2)
 266              * or  |v&#39;| = sqrt((AA+BB)x^2 + 2(AC+BD)xy + (CC+DD)y^2).
 267              * Since sqrt is monotonic we can maximize |v&#39;|^2
 268              * instead and plug in the substitution y = sqrt(1 - x^2).
 269              * Trigonometric equalities can then be used to get
 270              * rid of most of the sqrt terms.
</pre>
</td>
</tr>
</table>
<center><a href="DHelpers.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="DStroker.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>