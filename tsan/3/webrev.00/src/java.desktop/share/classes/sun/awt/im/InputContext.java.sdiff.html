<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/classes/sun/awt/im/InputContext.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ExecutableInputMethodManager.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../resources/awt.properties.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/sun/awt/im/InputContext.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1997, 2013, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 530         // Switch out the old input method
 531         Locale savedLocale = inputMethodLocator.getLocale();
 532         boolean wasInputMethodActive = isInputMethodActive;
 533         boolean wasCompositionEnabledSupported = false;
 534         boolean wasCompositionEnabled = false;
 535         if (inputMethod != null) {
 536             try {
 537                 wasCompositionEnabled = inputMethod.isCompositionEnabled();
 538                 wasCompositionEnabledSupported = true;
 539             } catch (UnsupportedOperationException e) { }
 540 
 541             if (currentClientComponent != null) {
 542                 if (!isInputMethodActive) {
 543                     activateInputMethod(false);
 544                 }
 545                 endComposition();
 546                 deactivateInputMethod(false);
 547                 if (inputMethod instanceof InputMethodAdapter) {
 548                     ((InputMethodAdapter) inputMethod).setClientComponent(null);
 549                 }


 550             }
 551             savedLocale = inputMethod.getLocale();
 552 
 553             // keep the input method instance around for future use
 554             if (usedInputMethods == null) {
 555                 usedInputMethods = new HashMap&lt;&gt;(5);
 556             }
 557             if (perInputMethodState == null) {
 558                 perInputMethodState = new HashMap&lt;&gt;(5);
 559             }
 560             usedInputMethods.put(inputMethodLocator.deriveLocator(null), inputMethod);
 561             perInputMethodState.put(inputMethod,
 562                                     Boolean.valueOf(clientWindowNotificationEnabled));
 563             enableClientWindowNotification(inputMethod, false);
 564             if (this == inputMethodWindowContext) {
 565                 inputMethod.hideWindows();

 566                 inputMethodWindowContext = null;
 567             }
 568             inputMethodLocator = null;
 569             inputMethod = null;
 570             inputMethodCreationFailed = false;
 571         }
 572 
 573         // Switch in the new input method
 574         if (newLocator.getLocale() == null &amp;&amp; savedLocale != null &amp;&amp;
 575                 newLocator.isLocaleAvailable(savedLocale)) {
 576             newLocator = newLocator.deriveLocator(savedLocale);
 577         }
 578         inputMethodLocator = newLocator;
 579         inputMethodCreationFailed = false;
 580 
 581         // activate the new input method if the old one was active
 582         if (wasInputMethodActive) {
 583             inputMethod = getInputMethodInstance();
 584             if (inputMethod instanceof InputMethodAdapter) {
 585                 ((InputMethodAdapter) inputMethod).setAWTFocussedComponent(awtFocussedComponent);
</pre>
<hr />
<pre>
 753 
 754         if (inputMethod == null) {
 755             throw new UnsupportedOperationException(&quot;Null input method&quot;);
 756         }
 757 
 758         String inputMethodInfo = null;
 759         if (inputMethod instanceof InputMethodAdapter) {
 760             // returns the information about the host native input method.
 761             inputMethodInfo = ((InputMethodAdapter)inputMethod).
 762                 getNativeInputMethodInfo();
 763         }
 764 
 765         // extracts the information from the InputMethodDescriptor
 766         // associated with the current java input method.
 767         if (inputMethodInfo == null &amp;&amp; inputMethodLocator != null) {
 768             inputMethodInfo = inputMethodLocator.getDescriptor().
 769                 getInputMethodDisplayName(getLocale(), SunToolkit.
 770                                           getStartupLocale());
 771         }
 772 
<span class="line-modified"> 773         if (inputMethodInfo != null &amp;&amp; !inputMethodInfo.equals(&quot;&quot;)) {</span>
 774             return inputMethodInfo;
 775         }
 776 
 777         // do our best to return something useful.
 778         return inputMethod.toString() + &quot;-&quot; + inputMethod.getLocale().toString();
 779     }
 780 
 781     /**
 782      * Turns off the native IM. The native IM is diabled when
 783      * the deactive method of InputMethod is called. It is
 784      * delayed until the active method is called on a different
 785      * peer component. This method is provided to explicitly disable
 786      * the native IM.
 787      */
 788     public void disableNativeIM() {
 789         InputMethod inputMethod = getInputMethod();
 790         if (inputMethod != null &amp;&amp; inputMethod instanceof InputMethodAdapter) {
 791             ((InputMethodAdapter)inputMethod).stopListening();
 792         }
 793     }
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 530         // Switch out the old input method
 531         Locale savedLocale = inputMethodLocator.getLocale();
 532         boolean wasInputMethodActive = isInputMethodActive;
 533         boolean wasCompositionEnabledSupported = false;
 534         boolean wasCompositionEnabled = false;
 535         if (inputMethod != null) {
 536             try {
 537                 wasCompositionEnabled = inputMethod.isCompositionEnabled();
 538                 wasCompositionEnabledSupported = true;
 539             } catch (UnsupportedOperationException e) { }
 540 
 541             if (currentClientComponent != null) {
 542                 if (!isInputMethodActive) {
 543                     activateInputMethod(false);
 544                 }
 545                 endComposition();
 546                 deactivateInputMethod(false);
 547                 if (inputMethod instanceof InputMethodAdapter) {
 548                     ((InputMethodAdapter) inputMethod).setClientComponent(null);
 549                 }
<span class="line-added"> 550                 if (null == currentClientComponent.getInputMethodRequests())</span>
<span class="line-added"> 551                     wasCompositionEnabledSupported = false;</span>
 552             }
 553             savedLocale = inputMethod.getLocale();
 554 
 555             // keep the input method instance around for future use
 556             if (usedInputMethods == null) {
 557                 usedInputMethods = new HashMap&lt;&gt;(5);
 558             }
 559             if (perInputMethodState == null) {
 560                 perInputMethodState = new HashMap&lt;&gt;(5);
 561             }
 562             usedInputMethods.put(inputMethodLocator.deriveLocator(null), inputMethod);
 563             perInputMethodState.put(inputMethod,
 564                                     Boolean.valueOf(clientWindowNotificationEnabled));
 565             enableClientWindowNotification(inputMethod, false);
 566             if (this == inputMethodWindowContext) {
 567                 inputMethod.hideWindows();
<span class="line-added"> 568                 inputMethod.removeNotify();</span>
 569                 inputMethodWindowContext = null;
 570             }
 571             inputMethodLocator = null;
 572             inputMethod = null;
 573             inputMethodCreationFailed = false;
 574         }
 575 
 576         // Switch in the new input method
 577         if (newLocator.getLocale() == null &amp;&amp; savedLocale != null &amp;&amp;
 578                 newLocator.isLocaleAvailable(savedLocale)) {
 579             newLocator = newLocator.deriveLocator(savedLocale);
 580         }
 581         inputMethodLocator = newLocator;
 582         inputMethodCreationFailed = false;
 583 
 584         // activate the new input method if the old one was active
 585         if (wasInputMethodActive) {
 586             inputMethod = getInputMethodInstance();
 587             if (inputMethod instanceof InputMethodAdapter) {
 588                 ((InputMethodAdapter) inputMethod).setAWTFocussedComponent(awtFocussedComponent);
</pre>
<hr />
<pre>
 756 
 757         if (inputMethod == null) {
 758             throw new UnsupportedOperationException(&quot;Null input method&quot;);
 759         }
 760 
 761         String inputMethodInfo = null;
 762         if (inputMethod instanceof InputMethodAdapter) {
 763             // returns the information about the host native input method.
 764             inputMethodInfo = ((InputMethodAdapter)inputMethod).
 765                 getNativeInputMethodInfo();
 766         }
 767 
 768         // extracts the information from the InputMethodDescriptor
 769         // associated with the current java input method.
 770         if (inputMethodInfo == null &amp;&amp; inputMethodLocator != null) {
 771             inputMethodInfo = inputMethodLocator.getDescriptor().
 772                 getInputMethodDisplayName(getLocale(), SunToolkit.
 773                                           getStartupLocale());
 774         }
 775 
<span class="line-modified"> 776         if (inputMethodInfo != null &amp;&amp; !inputMethodInfo.isEmpty()) {</span>
 777             return inputMethodInfo;
 778         }
 779 
 780         // do our best to return something useful.
 781         return inputMethod.toString() + &quot;-&quot; + inputMethod.getLocale().toString();
 782     }
 783 
 784     /**
 785      * Turns off the native IM. The native IM is diabled when
 786      * the deactive method of InputMethod is called. It is
 787      * delayed until the active method is called on a different
 788      * peer component. This method is provided to explicitly disable
 789      * the native IM.
 790      */
 791     public void disableNativeIM() {
 792         InputMethod inputMethod = getInputMethod();
 793         if (inputMethod != null &amp;&amp; inputMethod instanceof InputMethodAdapter) {
 794             ((InputMethodAdapter)inputMethod).stopListening();
 795         }
 796     }
</pre>
</td>
</tr>
</table>
<center><a href="ExecutableInputMethodManager.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../resources/awt.properties.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>