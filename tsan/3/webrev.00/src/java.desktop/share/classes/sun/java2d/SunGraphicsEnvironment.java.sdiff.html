<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/classes/sun/java2d/SunGraphicsEnvironment.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="SunGraphics2D.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="marlin/DDasher.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/sun/java2d/SunGraphicsEnvironment.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.java2d;
 27 
 28 import java.awt.AWTError;
 29 import java.awt.Color;
 30 import java.awt.Font;
 31 import java.awt.Graphics2D;
 32 import java.awt.GraphicsConfiguration;
 33 import java.awt.GraphicsDevice;
 34 import java.awt.GraphicsEnvironment;
 35 import java.awt.Insets;
 36 import java.awt.Point;
 37 import java.awt.Rectangle;
 38 import java.awt.Toolkit;
 39 import java.awt.geom.AffineTransform;
 40 import java.awt.image.BufferedImage;
 41 import java.awt.peer.ComponentPeer;
<span class="line-removed"> 42 import java.io.BufferedReader;</span>
<span class="line-removed"> 43 import java.io.File;</span>
<span class="line-removed"> 44 import java.io.FileInputStream;</span>
<span class="line-removed"> 45 import java.io.InputStreamReader;</span>
 46 import java.security.AccessController;
 47 import java.util.Locale;
 48 import java.util.TreeMap;
 49 
 50 import sun.awt.DisplayChangedListener;
 51 import sun.awt.SunDisplayChanger;
 52 import sun.font.FontManager;
 53 import sun.font.FontManagerFactory;
 54 import sun.font.FontManagerForSGE;
 55 import sun.java2d.pipe.Region;
 56 import sun.security.action.GetPropertyAction;
 57 
 58 /**
 59  * This is an implementation of a GraphicsEnvironment object for the
 60  * default local GraphicsEnvironment.
 61  *
 62  * @see GraphicsDevice
 63  * @see GraphicsConfiguration
 64  */
 65 public abstract class SunGraphicsEnvironment extends GraphicsEnvironment
 66     implements DisplayChangedListener {
 67 
<span class="line-modified"> 68     public static boolean isOpenSolaris;</span>
<span class="line-modified"> 69     private static Font defaultFont;</span>
 70 
 71     private static final boolean uiScaleEnabled;
 72     private static final double debugScale;
 73 
 74     static {
 75         uiScaleEnabled = &quot;true&quot;.equals(AccessController.doPrivileged(
 76                 new GetPropertyAction(&quot;sun.java2d.uiScale.enabled&quot;, &quot;true&quot;)));
 77         debugScale = uiScaleEnabled ? getScaleFactor(&quot;sun.java2d.uiScale&quot;) : -1;
 78     }
 79 
<span class="line-removed"> 80     public SunGraphicsEnvironment() {</span>
<span class="line-removed"> 81         java.security.AccessController.doPrivileged(</span>
<span class="line-removed"> 82                                     new java.security.PrivilegedAction&lt;Object&gt;() {</span>
<span class="line-removed"> 83             public Object run() {</span>
<span class="line-removed"> 84                 String osName = System.getProperty(&quot;os.name&quot;);</span>
<span class="line-removed"> 85                 if (&quot;SunOS&quot;.equals(osName)) {</span>
<span class="line-removed"> 86                     String version = System.getProperty(&quot;os.version&quot;, &quot;0.0&quot;);</span>
<span class="line-removed"> 87                     try {</span>
<span class="line-removed"> 88                         float ver = Float.parseFloat(version);</span>
<span class="line-removed"> 89                         if (ver &gt; 5.10f) {</span>
<span class="line-removed"> 90                             File f = new File(&quot;/etc/release&quot;);</span>
<span class="line-removed"> 91                             FileInputStream fis = new FileInputStream(f);</span>
<span class="line-removed"> 92                             InputStreamReader isr</span>
<span class="line-removed"> 93                                 = new InputStreamReader(fis, &quot;ISO-8859-1&quot;);</span>
<span class="line-removed"> 94                             BufferedReader br = new BufferedReader(isr);</span>
<span class="line-removed"> 95                             String line = br.readLine();</span>
<span class="line-removed"> 96                             if (line.indexOf(&quot;OpenSolaris&quot;) &gt;= 0) {</span>
<span class="line-removed"> 97                                 isOpenSolaris = true;</span>
<span class="line-removed"> 98                             } else {</span>
<span class="line-removed"> 99                                 /* We are using isOpenSolaris as meaning</span>
<span class="line-removed">100                                  * we know the Solaris commercial fonts aren&#39;t</span>
<span class="line-removed">101                                  * present. &quot;Solaris Next&quot; (03/10) did not</span>
<span class="line-removed">102                                  * include these even though its was not</span>
<span class="line-removed">103                                  * OpenSolaris. Need to revisit how this is</span>
<span class="line-removed">104                                  * handled but for now as in 6ux, we&#39;ll use</span>
<span class="line-removed">105                                  * the test for a standard font resource as</span>
<span class="line-removed">106                                  * being an indicator as to whether we need</span>
<span class="line-removed">107                                  * to treat this as OpenSolaris from a font</span>
<span class="line-removed">108                                  * config perspective.</span>
<span class="line-removed">109                                  */</span>
<span class="line-removed">110                                 String courierNew =</span>
<span class="line-removed">111                                     &quot;/usr/openwin/lib/X11/fonts/TrueType/CourierNew.ttf&quot;;</span>
<span class="line-removed">112                                 File courierFile = new File(courierNew);</span>
<span class="line-removed">113                                 isOpenSolaris = !courierFile.exists();</span>
<span class="line-removed">114                             }</span>
<span class="line-removed">115                             fis.close();</span>
<span class="line-removed">116                         }</span>
<span class="line-removed">117                     } catch (Exception e) {</span>
<span class="line-removed">118                     }</span>
<span class="line-removed">119                 }</span>
<span class="line-removed">120                 /* Establish the default font to be used by SG2D etc */</span>
<span class="line-removed">121                 defaultFont = new Font(Font.DIALOG, Font.PLAIN, 12);</span>
<span class="line-removed">122 </span>
<span class="line-removed">123                 return null;</span>
<span class="line-removed">124             }</span>
<span class="line-removed">125         });</span>
<span class="line-removed">126     }</span>
<span class="line-removed">127 </span>
128     protected GraphicsDevice[] screens;
129 
130     /**
131      * Returns an array of all of the screen devices.
132      */
133     public synchronized GraphicsDevice[] getScreenDevices() {
134         GraphicsDevice[] ret = screens;
135         if (ret == null) {
136             int num = getNumScreens();
137             ret = new GraphicsDevice[num];
138             for (int i = 0; i &lt; num; i++) {
139                 ret[i] = makeScreenDevice(i);
140             }
141             screens = ret;
142         }
143         return ret;
144     }
145 
146     /**
147      * Returns the number of screen devices of this graphics environment.
</pre>
<hr />
<pre>
399         }
400         return current;
401     }
402 
403     /**
404      * Converts coordinates from the user&#39;s space to the device space using
405      * appropriate device transformation.
406      *
407      * @param  x coordinate in the user space
408      * @param  y coordinate in the user space
409      * @return the point which uses device space(pixels)
410      */
411     public static Point convertToDeviceSpace(double x, double y) {
412         GraphicsConfiguration gc = getLocalGraphicsEnvironment()
413                         .getDefaultScreenDevice().getDefaultConfiguration();
414         gc = getGraphicsConfigurationAtPoint(gc, x, y);
415 
416         AffineTransform tx = gc.getDefaultTransform();
417         x = Region.clipRound(x * tx.getScaleX());
418         y = Region.clipRound(y * tx.getScaleY());
<span class="line-removed">419 </span>
420         return new Point((int) x, (int) y);
421     }
































422 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.java2d;
 27 
 28 import java.awt.AWTError;
 29 import java.awt.Color;
 30 import java.awt.Font;
 31 import java.awt.Graphics2D;
 32 import java.awt.GraphicsConfiguration;
 33 import java.awt.GraphicsDevice;
 34 import java.awt.GraphicsEnvironment;
 35 import java.awt.Insets;
 36 import java.awt.Point;
 37 import java.awt.Rectangle;
 38 import java.awt.Toolkit;
 39 import java.awt.geom.AffineTransform;
 40 import java.awt.image.BufferedImage;
 41 import java.awt.peer.ComponentPeer;




 42 import java.security.AccessController;
 43 import java.util.Locale;
 44 import java.util.TreeMap;
 45 
 46 import sun.awt.DisplayChangedListener;
 47 import sun.awt.SunDisplayChanger;
 48 import sun.font.FontManager;
 49 import sun.font.FontManagerFactory;
 50 import sun.font.FontManagerForSGE;
 51 import sun.java2d.pipe.Region;
 52 import sun.security.action.GetPropertyAction;
 53 
 54 /**
 55  * This is an implementation of a GraphicsEnvironment object for the
 56  * default local GraphicsEnvironment.
 57  *
 58  * @see GraphicsDevice
 59  * @see GraphicsConfiguration
 60  */
 61 public abstract class SunGraphicsEnvironment extends GraphicsEnvironment
 62     implements DisplayChangedListener {
 63 
<span class="line-modified"> 64     /** Establish the default font to be used by SG2D. */</span>
<span class="line-modified"> 65     private final Font defaultFont = new Font(Font.DIALOG, Font.PLAIN, 12);</span>
 66 
 67     private static final boolean uiScaleEnabled;
 68     private static final double debugScale;
 69 
 70     static {
 71         uiScaleEnabled = &quot;true&quot;.equals(AccessController.doPrivileged(
 72                 new GetPropertyAction(&quot;sun.java2d.uiScale.enabled&quot;, &quot;true&quot;)));
 73         debugScale = uiScaleEnabled ? getScaleFactor(&quot;sun.java2d.uiScale&quot;) : -1;
 74     }
 75 
















































 76     protected GraphicsDevice[] screens;
 77 
 78     /**
 79      * Returns an array of all of the screen devices.
 80      */
 81     public synchronized GraphicsDevice[] getScreenDevices() {
 82         GraphicsDevice[] ret = screens;
 83         if (ret == null) {
 84             int num = getNumScreens();
 85             ret = new GraphicsDevice[num];
 86             for (int i = 0; i &lt; num; i++) {
 87                 ret[i] = makeScreenDevice(i);
 88             }
 89             screens = ret;
 90         }
 91         return ret;
 92     }
 93 
 94     /**
 95      * Returns the number of screen devices of this graphics environment.
</pre>
<hr />
<pre>
347         }
348         return current;
349     }
350 
351     /**
352      * Converts coordinates from the user&#39;s space to the device space using
353      * appropriate device transformation.
354      *
355      * @param  x coordinate in the user space
356      * @param  y coordinate in the user space
357      * @return the point which uses device space(pixels)
358      */
359     public static Point convertToDeviceSpace(double x, double y) {
360         GraphicsConfiguration gc = getLocalGraphicsEnvironment()
361                         .getDefaultScreenDevice().getDefaultConfiguration();
362         gc = getGraphicsConfigurationAtPoint(gc, x, y);
363 
364         AffineTransform tx = gc.getDefaultTransform();
365         x = Region.clipRound(x * tx.getScaleX());
366         y = Region.clipRound(y * tx.getScaleY());

367         return new Point((int) x, (int) y);
368     }
<span class="line-added">369 </span>
<span class="line-added">370     /**</span>
<span class="line-added">371      * Converts bounds from the user&#39;s space to the device space using</span>
<span class="line-added">372      * appropriate device transformation.</span>
<span class="line-added">373      *</span>
<span class="line-added">374      * @param  bounds the rectangle in the user space</span>
<span class="line-added">375      * @return the rectangle which uses device space(pixels)</span>
<span class="line-added">376      */</span>
<span class="line-added">377     public static Rectangle convertToDeviceSpace(Rectangle bounds) {</span>
<span class="line-added">378         GraphicsConfiguration gc = getLocalGraphicsEnvironment()</span>
<span class="line-added">379                 .getDefaultScreenDevice().getDefaultConfiguration();</span>
<span class="line-added">380         gc = getGraphicsConfigurationAtPoint(gc, bounds.x, bounds.y);</span>
<span class="line-added">381         return convertToDeviceSpace(gc, bounds);</span>
<span class="line-added">382     }</span>
<span class="line-added">383 </span>
<span class="line-added">384     /**</span>
<span class="line-added">385      * Converts bounds from the user&#39;s space to the device space using</span>
<span class="line-added">386      * appropriate device transformation of the passed graphics configuration.</span>
<span class="line-added">387      *</span>
<span class="line-added">388      * @param  bounds the rectangle in the user space</span>
<span class="line-added">389      * @return the rectangle which uses device space(pixels)</span>
<span class="line-added">390      */</span>
<span class="line-added">391     public static Rectangle convertToDeviceSpace(GraphicsConfiguration gc,</span>
<span class="line-added">392                                                  Rectangle bounds) {</span>
<span class="line-added">393         AffineTransform tx = gc.getDefaultTransform();</span>
<span class="line-added">394         return new Rectangle(</span>
<span class="line-added">395                 Region.clipRound(bounds.x * tx.getScaleX()),</span>
<span class="line-added">396                 Region.clipRound(bounds.y * tx.getScaleY()),</span>
<span class="line-added">397                 Region.clipRound(bounds.width * tx.getScaleX()),</span>
<span class="line-added">398                 Region.clipRound(bounds.height * tx.getScaleY())</span>
<span class="line-added">399         );</span>
<span class="line-added">400     }</span>
401 }
</pre>
</td>
</tr>
</table>
<center><a href="SunGraphics2D.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="marlin/DDasher.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>