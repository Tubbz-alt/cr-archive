<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/classes/sun/java2d/pipe/BufferedContext.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../opengl/OGLSurfaceData.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="BufferedOpCodes.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/sun/java2d/pipe/BufferedContext.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2005, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2005, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 28,20 ***</span>
  import java.awt.AlphaComposite;
  import java.awt.Color;
  import java.awt.Composite;
  import java.awt.Paint;
  import java.awt.geom.AffineTransform;
<span class="line-modified">! import sun.java2d.pipe.hw.AccelSurface;</span>
  import sun.java2d.InvalidPipeException;
  import sun.java2d.SunGraphics2D;
  import sun.java2d.loops.XORComposite;
<span class="line-modified">! import static sun.java2d.pipe.BufferedOpCodes.*;</span>
<span class="line-removed">- import static sun.java2d.pipe.BufferedRenderPipe.BYTES_PER_SPAN;</span>
  
<span class="line-modified">! import java.lang.annotation.Native;</span>
<span class="line-modified">! import java.lang.ref.Reference;</span>
<span class="line-modified">! import java.lang.ref.WeakReference;</span>
  
  /**
   * Base context class for managing state in a single-threaded rendering
   * environment.  Each state-setting operation (e.g. SET_COLOR) is added to
   * the provided RenderQueue, which will be processed at a later time by a
<span class="line-new-header">--- 28,31 ---</span>
  import java.awt.AlphaComposite;
  import java.awt.Color;
  import java.awt.Composite;
  import java.awt.Paint;
  import java.awt.geom.AffineTransform;
<span class="line-modified">! import java.lang.annotation.Native;</span>
<span class="line-added">+ import java.lang.ref.Reference;</span>
<span class="line-added">+ import java.lang.ref.WeakReference;</span>
<span class="line-added">+ </span>
  import sun.java2d.InvalidPipeException;
  import sun.java2d.SunGraphics2D;
  import sun.java2d.loops.XORComposite;
<span class="line-modified">! import sun.java2d.pipe.hw.AccelSurface;</span>
  
<span class="line-modified">! import static sun.java2d.pipe.BufferedOpCodes.BEGIN_SHAPE_CLIP;</span>
<span class="line-modified">! import static sun.java2d.pipe.BufferedOpCodes.END_SHAPE_CLIP;</span>
<span class="line-modified">! import static sun.java2d.pipe.BufferedOpCodes.RESET_CLIP;</span>
<span class="line-added">+ import static sun.java2d.pipe.BufferedOpCodes.RESET_COMPOSITE;</span>
<span class="line-added">+ import static sun.java2d.pipe.BufferedOpCodes.RESET_TRANSFORM;</span>
<span class="line-added">+ import static sun.java2d.pipe.BufferedOpCodes.SET_ALPHA_COMPOSITE;</span>
<span class="line-added">+ import static sun.java2d.pipe.BufferedOpCodes.SET_RECT_CLIP;</span>
<span class="line-added">+ import static sun.java2d.pipe.BufferedOpCodes.SET_SHAPE_CLIP_SPANS;</span>
<span class="line-added">+ import static sun.java2d.pipe.BufferedOpCodes.SET_SURFACES;</span>
<span class="line-added">+ import static sun.java2d.pipe.BufferedOpCodes.SET_TRANSFORM;</span>
<span class="line-added">+ import static sun.java2d.pipe.BufferedOpCodes.SET_XOR_COMPOSITE;</span>
<span class="line-added">+ import static sun.java2d.pipe.BufferedRenderPipe.BYTES_PER_SPAN;</span>
  
  /**
   * Base context class for managing state in a single-threaded rendering
   * environment.  Each state-setting operation (e.g. SET_COLOR) is added to
   * the provided RenderQueue, which will be processed at a later time by a
</pre>
<hr />
<pre>
<span class="line-old-header">*** 75,12 ***</span>
       * Indicates that the operation uses an alpha mask, which may determine
       * the code path that is used when setting up the current paint state.
       */
      @Native public static final int USE_MASK         = (1 &lt;&lt; 1);
  
<span class="line-modified">!     protected RenderQueue rq;</span>
<span class="line-modified">!     protected RenderBuffer buf;</span>
  
      /**
       * This is a reference to the most recently validated BufferedContext.  If
       * this value is null, it means that there is no current context.  It is
       * provided here so that validate() only needs to do a quick reference
<span class="line-new-header">--- 86,12 ---</span>
       * Indicates that the operation uses an alpha mask, which may determine
       * the code path that is used when setting up the current paint state.
       */
      @Native public static final int USE_MASK         = (1 &lt;&lt; 1);
  
<span class="line-modified">!     private final RenderQueue rq;</span>
<span class="line-modified">!     private final RenderBuffer buf;</span>
  
      /**
       * This is a reference to the most recently validated BufferedContext.  If
       * this value is null, it means that there is no current context.  It is
       * provided here so that validate() only needs to do a quick reference
</pre>
<hr />
<pre>
<span class="line-old-header">*** 170,11 ***</span>
       * It&#39;s assumed that the type of surfaces has been checked by the Renderer
       *
       * @throws InvalidPipeException if either src or dest surface is not valid
       * or lost
       */
<span class="line-modified">!     public void validate(AccelSurface srcData, AccelSurface dstData,</span>
                           Region clip, Composite comp,
                           AffineTransform xform,
                           Paint paint, SunGraphics2D sg2d, int flags)
      {
          // assert rq.lock.isHeldByCurrentThread();
<span class="line-new-header">--- 181,11 ---</span>
       * It&#39;s assumed that the type of surfaces has been checked by the Renderer
       *
       * @throws InvalidPipeException if either src or dest surface is not valid
       * or lost
       */
<span class="line-modified">!     private void validate(AccelSurface srcData, AccelSurface dstData,</span>
                           Region clip, Composite comp,
                           AffineTransform xform,
                           Paint paint, SunGraphics2D sg2d, int flags)
      {
          // assert rq.lock.isHeldByCurrentThread();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 308,25 ***</span>
          // mark dstData dirty
          // REMIND: is this really needed now? we do it in SunGraphics2D..
          dstData.markDirty();
      }
  
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Invalidates the surfaces associated with this context.  This is</span>
<span class="line-removed">-      * useful when the context is no longer needed, and we want to break</span>
<span class="line-removed">-      * the chain caused by these surface references.</span>
<span class="line-removed">-      *</span>
<span class="line-removed">-      * Note: must be called while the RenderQueue lock is held.</span>
<span class="line-removed">-      *</span>
<span class="line-removed">-      * @see RenderQueue#lock</span>
<span class="line-removed">-      * @see RenderQueue#unlock</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     private void invalidateSurfaces() {</span>
<span class="line-removed">-         validSrcDataRef.clear();</span>
<span class="line-removed">-         validDstDataRef.clear();</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
      private void setSurfaces(AccelSurface srcData,
                               AccelSurface dstData)
      {
          // assert rq.lock.isHeldByCurrentThread();
          rq.ensureCapacityAndAlignment(20, 4);
<span class="line-new-header">--- 319,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 431,16 ***</span>
       * Note: must be called while the RenderQueue lock is held.
       *
       * @see RenderQueue#lock
       * @see RenderQueue#unlock
       */
<span class="line-modified">!     public void invalidateContext() {</span>
          resetTransform();
          resetComposite();
          resetClip();
          BufferedPaints.resetPaint(rq);
<span class="line-modified">!         invalidateSurfaces();</span>
          validCompRef.clear();
          validClipRef.clear();
          validPaintRef.clear();
          isValidatedPaintJustAColor = false;
          xformInUse = false;
<span class="line-new-header">--- 427,17 ---</span>
       * Note: must be called while the RenderQueue lock is held.
       *
       * @see RenderQueue#lock
       * @see RenderQueue#unlock
       */
<span class="line-modified">!     public final void invalidateContext() {</span>
          resetTransform();
          resetComposite();
          resetClip();
          BufferedPaints.resetPaint(rq);
<span class="line-modified">!         validSrcDataRef.clear();</span>
<span class="line-added">+         validDstDataRef.clear();</span>
          validCompRef.clear();
          validClipRef.clear();
          validPaintRef.clear();
          isValidatedPaintJustAColor = false;
          xformInUse = false;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 451,29 ***</span>
       * pipeline.
       *
       * @return a render queue
       * @see RenderQueue
       */
<span class="line-modified">!     public abstract RenderQueue getRenderQueue();</span>
<span class="line-modified">! </span>
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * Saves the state of this context.</span>
<span class="line-removed">-      * It may reset the current context.</span>
<span class="line-removed">-      *</span>
<span class="line-removed">-      * Note: must be called while the RenderQueue lock is held.</span>
<span class="line-removed">-      *</span>
<span class="line-removed">-      * @see RenderQueue#lock</span>
<span class="line-removed">-      * @see RenderQueue#unlock</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public abstract void saveState();</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Restores the native state of this context.</span>
<span class="line-removed">-      * It may reset the current context.</span>
<span class="line-removed">-      *</span>
<span class="line-removed">-      * Note: must be called while the RenderQueue lock is held.</span>
<span class="line-removed">-      *</span>
<span class="line-removed">-      * @see RenderQueue#lock</span>
<span class="line-removed">-      * @see RenderQueue#unlock</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public abstract void restoreState();</span>
  }
<span class="line-new-header">--- 448,9 ---</span>
       * pipeline.
       *
       * @return a render queue
       * @see RenderQueue
       */
<span class="line-modified">!     public final RenderQueue getRenderQueue() {</span>
<span class="line-modified">!         return rq;</span>
<span class="line-modified">!     }</span>
  }
</pre>
<center><a href="../opengl/OGLSurfaceData.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="BufferedOpCodes.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>