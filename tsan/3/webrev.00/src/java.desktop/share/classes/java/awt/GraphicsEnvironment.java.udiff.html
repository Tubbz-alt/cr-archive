<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/share/classes/java/awt/GraphicsEnvironment.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="Frame.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="GridBagLayout.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/java/awt/GraphicsEnvironment.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -29,10 +29,11 @@</span>
  import java.awt.image.BufferedImage;
  import java.security.AccessController;
  import java.security.PrivilegedAction;
  import java.util.Locale;
  
<span class="udiff-line-added">+ import sun.awt.PlatformGraphicsInfo;</span>
  import sun.font.FontManager;
  import sun.font.FontManagerFactory;
  import sun.java2d.HeadlessGraphicsEnvironment;
  import sun.java2d.SunGraphicsEnvironment;
  import sun.security.action.GetPropertyAction;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -82,42 +83,18 @@</span>
           */
          static final GraphicsEnvironment INSTANCE = createGE();
  
          /**
           * Creates and returns the GraphicsEnvironment, according to the
<span class="udiff-line-modified-removed">-          * system property &#39;java.awt.graphicsenv&#39;.</span>
<span class="udiff-line-modified-added">+          * platform-specific proxy class.</span>
           *
           * @return the graphics environment
           */
          private static GraphicsEnvironment createGE() {
<span class="udiff-line-modified-removed">-             GraphicsEnvironment ge;</span>
<span class="udiff-line-modified-removed">-             String nm = AccessController.doPrivileged(new GetPropertyAction(&quot;java.awt.graphicsenv&quot;, null));</span>
<span class="udiff-line-modified-removed">-             try {</span>
<span class="udiff-line-removed">- //              long t0 = System.currentTimeMillis();</span>
<span class="udiff-line-removed">-                 Class&lt;?&gt; geCls;</span>
<span class="udiff-line-removed">-                 try {</span>
<span class="udiff-line-removed">-                     // First we try if the bootstrap class loader finds the</span>
<span class="udiff-line-removed">-                     // requested class. This way we can avoid to run in a privileged</span>
<span class="udiff-line-removed">-                     // block.</span>
<span class="udiff-line-removed">-                     geCls = Class.forName(nm);</span>
<span class="udiff-line-removed">-                 } catch (ClassNotFoundException ex) {</span>
<span class="udiff-line-removed">-                     // If the bootstrap class loader fails, we try again with the</span>
<span class="udiff-line-removed">-                     // application class loader.</span>
<span class="udiff-line-removed">-                     ClassLoader cl = ClassLoader.getSystemClassLoader();</span>
<span class="udiff-line-removed">-                     geCls = Class.forName(nm, true, cl);</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-                 ge = (GraphicsEnvironment)geCls.getConstructor().newInstance();</span>
<span class="udiff-line-removed">- //              long t1 = System.currentTimeMillis();</span>
<span class="udiff-line-removed">- //              System.out.println(&quot;GE creation took &quot; + (t1-t0)+ &quot;ms.&quot;);</span>
<span class="udiff-line-removed">-                 if (isHeadless()) {</span>
<span class="udiff-line-removed">-                     ge = new HeadlessGraphicsEnvironment(ge);</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             } catch (ClassNotFoundException e) {</span>
<span class="udiff-line-removed">-                 throw new Error(&quot;Could not find class: &quot;+nm);</span>
<span class="udiff-line-removed">-             } catch (ReflectiveOperationException | IllegalArgumentException e) {</span>
<span class="udiff-line-removed">-                 throw new Error(&quot;Could not instantiate Graphics Environment: &quot;</span>
<span class="udiff-line-removed">-                         + nm);</span>
<span class="udiff-line-modified-added">+             GraphicsEnvironment ge = PlatformGraphicsInfo.createGE();</span>
<span class="udiff-line-modified-added">+             if (isHeadless()) {</span>
<span class="udiff-line-modified-added">+                 ge = new HeadlessGraphicsEnvironment(ge);</span>
              }
              return ge;
          }
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -153,12 +130,11 @@</span>
      static String getHeadlessMessage() {
          if (headless == null) {
              getHeadlessProperty(); // initialize the values
          }
          return defaultHeadless != Boolean.TRUE ? null :
<span class="udiff-line-modified-removed">-             &quot;\nNo X11 DISPLAY variable was set, &quot; +</span>
<span class="udiff-line-removed">-             &quot;but this program performed an operation which requires it.&quot;;</span>
<span class="udiff-line-modified-added">+             PlatformGraphicsInfo.getDefaultHeadlessMessage();</span>
      }
  
      /**
       * @return the value of the property &quot;java.awt.headless&quot;
       * @since 1.4
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -167,20 +143,12 @@</span>
          if (headless == null) {
              AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {
                  String nm = System.getProperty(&quot;java.awt.headless&quot;);
  
                  if (nm == null) {
<span class="udiff-line-removed">-                     final String osName = System.getProperty(&quot;os.name&quot;);</span>
<span class="udiff-line-removed">-                     final String display = System.getenv(&quot;DISPLAY&quot;);</span>
                      headless = defaultHeadless =
<span class="udiff-line-modified-removed">-                                 (&quot;Linux&quot;.equals(osName) ||</span>
<span class="udiff-line-removed">-                                  &quot;SunOS&quot;.equals(osName) ||</span>
<span class="udiff-line-removed">-                                  &quot;FreeBSD&quot;.equals(osName) ||</span>
<span class="udiff-line-removed">-                                  &quot;NetBSD&quot;.equals(osName) ||</span>
<span class="udiff-line-removed">-                                  &quot;OpenBSD&quot;.equals(osName) ||</span>
<span class="udiff-line-removed">-                                  &quot;AIX&quot;.equals(osName)) &amp;&amp;</span>
<span class="udiff-line-removed">-                                  (display == null || display.trim().isEmpty());</span>
<span class="udiff-line-modified-added">+                         PlatformGraphicsInfo.getDefaultHeadlessProperty();</span>
                  } else {
                      headless = Boolean.valueOf(nm);
                  }
                  return null;
              });
</pre>
<center><a href="Frame.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="GridBagLayout.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>