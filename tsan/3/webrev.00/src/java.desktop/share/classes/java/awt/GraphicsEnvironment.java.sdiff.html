<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/classes/java/awt/GraphicsEnvironment.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="Frame.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="GridBagLayout.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/java/awt/GraphicsEnvironment.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 
 27 package java.awt;
 28 
 29 import java.awt.image.BufferedImage;
 30 import java.security.AccessController;
 31 import java.security.PrivilegedAction;
 32 import java.util.Locale;
 33 

 34 import sun.font.FontManager;
 35 import sun.font.FontManagerFactory;
 36 import sun.java2d.HeadlessGraphicsEnvironment;
 37 import sun.java2d.SunGraphicsEnvironment;
 38 import sun.security.action.GetPropertyAction;
 39 
 40 /**
 41  *
 42  * The {@code GraphicsEnvironment} class describes the collection
 43  * of {@link GraphicsDevice} objects and {@link java.awt.Font} objects
 44  * available to a Java(tm) application on a particular platform.
 45  * The resources in this {@code GraphicsEnvironment} might be local
 46  * or on a remote machine.  {@code GraphicsDevice} objects can be
 47  * screens, printers or image buffers and are the destination of
 48  * {@link Graphics2D} drawing methods.  Each {@code GraphicsDevice}
 49  * has a number of {@link GraphicsConfiguration} objects associated with
 50  * it.  These objects specify the different configurations in which the
 51  * {@code GraphicsDevice} can be used.
 52  * @see GraphicsDevice
 53  * @see GraphicsConfiguration
</pre>
<hr />
<pre>
 67 
 68     /**
 69      * This is an abstract class and cannot be instantiated directly.
 70      * Instances must be obtained from a suitable factory or query method.
 71      */
 72     protected GraphicsEnvironment() {
 73     }
 74 
 75     /**
 76      * Lazy initialization of local graphics environment using holder idiom.
 77      */
 78     private static final class LocalGE {
 79 
 80         /**
 81          * The instance of the local {@code GraphicsEnvironment}.
 82          */
 83         static final GraphicsEnvironment INSTANCE = createGE();
 84 
 85         /**
 86          * Creates and returns the GraphicsEnvironment, according to the
<span class="line-modified"> 87          * system property &#39;java.awt.graphicsenv&#39;.</span>
 88          *
 89          * @return the graphics environment
 90          */
 91         private static GraphicsEnvironment createGE() {
<span class="line-modified"> 92             GraphicsEnvironment ge;</span>
<span class="line-modified"> 93             String nm = AccessController.doPrivileged(new GetPropertyAction(&quot;java.awt.graphicsenv&quot;, null));</span>
<span class="line-modified"> 94             try {</span>
<span class="line-removed"> 95 //              long t0 = System.currentTimeMillis();</span>
<span class="line-removed"> 96                 Class&lt;?&gt; geCls;</span>
<span class="line-removed"> 97                 try {</span>
<span class="line-removed"> 98                     // First we try if the bootstrap class loader finds the</span>
<span class="line-removed"> 99                     // requested class. This way we can avoid to run in a privileged</span>
<span class="line-removed">100                     // block.</span>
<span class="line-removed">101                     geCls = Class.forName(nm);</span>
<span class="line-removed">102                 } catch (ClassNotFoundException ex) {</span>
<span class="line-removed">103                     // If the bootstrap class loader fails, we try again with the</span>
<span class="line-removed">104                     // application class loader.</span>
<span class="line-removed">105                     ClassLoader cl = ClassLoader.getSystemClassLoader();</span>
<span class="line-removed">106                     geCls = Class.forName(nm, true, cl);</span>
<span class="line-removed">107                 }</span>
<span class="line-removed">108                 ge = (GraphicsEnvironment)geCls.getConstructor().newInstance();</span>
<span class="line-removed">109 //              long t1 = System.currentTimeMillis();</span>
<span class="line-removed">110 //              System.out.println(&quot;GE creation took &quot; + (t1-t0)+ &quot;ms.&quot;);</span>
<span class="line-removed">111                 if (isHeadless()) {</span>
<span class="line-removed">112                     ge = new HeadlessGraphicsEnvironment(ge);</span>
<span class="line-removed">113                 }</span>
<span class="line-removed">114             } catch (ClassNotFoundException e) {</span>
<span class="line-removed">115                 throw new Error(&quot;Could not find class: &quot;+nm);</span>
<span class="line-removed">116             } catch (ReflectiveOperationException | IllegalArgumentException e) {</span>
<span class="line-removed">117                 throw new Error(&quot;Could not instantiate Graphics Environment: &quot;</span>
<span class="line-removed">118                         + nm);</span>
119             }
120             return ge;
121         }
122     }
123 
124     /**
125      * Returns the local {@code GraphicsEnvironment}.
126      * @return the local {@code GraphicsEnvironment}
127      */
128     public static GraphicsEnvironment getLocalGraphicsEnvironment() {
129         return LocalGE.INSTANCE;
130     }
131 
132     /**
133      * Tests whether or not a display, keyboard, and mouse can be
134      * supported in this environment.  If this method returns true,
135      * a HeadlessException is thrown from areas of the Toolkit
136      * and GraphicsEnvironment that are dependent on a display,
137      * keyboard, or mouse.
138      * @return {@code true} if this environment cannot support
139      * a display, keyboard, and mouse; {@code false}
140      * otherwise
141      * @see java.awt.HeadlessException
142      * @since 1.4
143      */
144     public static boolean isHeadless() {
145         return getHeadlessProperty();
146     }
147 
148     /**
149      * @return warning message if headless state is assumed by default;
150      * null otherwise
151      * @since 1.5
152      */
153     static String getHeadlessMessage() {
154         if (headless == null) {
155             getHeadlessProperty(); // initialize the values
156         }
157         return defaultHeadless != Boolean.TRUE ? null :
<span class="line-modified">158             &quot;\nNo X11 DISPLAY variable was set, &quot; +</span>
<span class="line-removed">159             &quot;but this program performed an operation which requires it.&quot;;</span>
160     }
161 
162     /**
163      * @return the value of the property &quot;java.awt.headless&quot;
164      * @since 1.4
165      */
166     private static boolean getHeadlessProperty() {
167         if (headless == null) {
168             AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {
169                 String nm = System.getProperty(&quot;java.awt.headless&quot;);
170 
171                 if (nm == null) {
<span class="line-removed">172                     final String osName = System.getProperty(&quot;os.name&quot;);</span>
<span class="line-removed">173                     final String display = System.getenv(&quot;DISPLAY&quot;);</span>
174                     headless = defaultHeadless =
<span class="line-modified">175                                 (&quot;Linux&quot;.equals(osName) ||</span>
<span class="line-removed">176                                  &quot;SunOS&quot;.equals(osName) ||</span>
<span class="line-removed">177                                  &quot;FreeBSD&quot;.equals(osName) ||</span>
<span class="line-removed">178                                  &quot;NetBSD&quot;.equals(osName) ||</span>
<span class="line-removed">179                                  &quot;OpenBSD&quot;.equals(osName) ||</span>
<span class="line-removed">180                                  &quot;AIX&quot;.equals(osName)) &amp;&amp;</span>
<span class="line-removed">181                                  (display == null || display.trim().isEmpty());</span>
182                 } else {
183                     headless = Boolean.valueOf(nm);
184                 }
185                 return null;
186             });
187         }
188         return headless;
189     }
190 
191     /**
192      * Check for headless state and throw HeadlessException if headless
193      * @since 1.4
194      */
195     static void checkHeadless() throws HeadlessException {
196         if (isHeadless()) {
197             throw new HeadlessException();
198         }
199     }
200 
201     /**
</pre>
</td>
<td>
<hr />
<pre>
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 
 27 package java.awt;
 28 
 29 import java.awt.image.BufferedImage;
 30 import java.security.AccessController;
 31 import java.security.PrivilegedAction;
 32 import java.util.Locale;
 33 
<span class="line-added"> 34 import sun.awt.PlatformGraphicsInfo;</span>
 35 import sun.font.FontManager;
 36 import sun.font.FontManagerFactory;
 37 import sun.java2d.HeadlessGraphicsEnvironment;
 38 import sun.java2d.SunGraphicsEnvironment;
 39 import sun.security.action.GetPropertyAction;
 40 
 41 /**
 42  *
 43  * The {@code GraphicsEnvironment} class describes the collection
 44  * of {@link GraphicsDevice} objects and {@link java.awt.Font} objects
 45  * available to a Java(tm) application on a particular platform.
 46  * The resources in this {@code GraphicsEnvironment} might be local
 47  * or on a remote machine.  {@code GraphicsDevice} objects can be
 48  * screens, printers or image buffers and are the destination of
 49  * {@link Graphics2D} drawing methods.  Each {@code GraphicsDevice}
 50  * has a number of {@link GraphicsConfiguration} objects associated with
 51  * it.  These objects specify the different configurations in which the
 52  * {@code GraphicsDevice} can be used.
 53  * @see GraphicsDevice
 54  * @see GraphicsConfiguration
</pre>
<hr />
<pre>
 68 
 69     /**
 70      * This is an abstract class and cannot be instantiated directly.
 71      * Instances must be obtained from a suitable factory or query method.
 72      */
 73     protected GraphicsEnvironment() {
 74     }
 75 
 76     /**
 77      * Lazy initialization of local graphics environment using holder idiom.
 78      */
 79     private static final class LocalGE {
 80 
 81         /**
 82          * The instance of the local {@code GraphicsEnvironment}.
 83          */
 84         static final GraphicsEnvironment INSTANCE = createGE();
 85 
 86         /**
 87          * Creates and returns the GraphicsEnvironment, according to the
<span class="line-modified"> 88          * platform-specific proxy class.</span>
 89          *
 90          * @return the graphics environment
 91          */
 92         private static GraphicsEnvironment createGE() {
<span class="line-modified"> 93             GraphicsEnvironment ge = PlatformGraphicsInfo.createGE();</span>
<span class="line-modified"> 94             if (isHeadless()) {</span>
<span class="line-modified"> 95                 ge = new HeadlessGraphicsEnvironment(ge);</span>
























 96             }
 97             return ge;
 98         }
 99     }
100 
101     /**
102      * Returns the local {@code GraphicsEnvironment}.
103      * @return the local {@code GraphicsEnvironment}
104      */
105     public static GraphicsEnvironment getLocalGraphicsEnvironment() {
106         return LocalGE.INSTANCE;
107     }
108 
109     /**
110      * Tests whether or not a display, keyboard, and mouse can be
111      * supported in this environment.  If this method returns true,
112      * a HeadlessException is thrown from areas of the Toolkit
113      * and GraphicsEnvironment that are dependent on a display,
114      * keyboard, or mouse.
115      * @return {@code true} if this environment cannot support
116      * a display, keyboard, and mouse; {@code false}
117      * otherwise
118      * @see java.awt.HeadlessException
119      * @since 1.4
120      */
121     public static boolean isHeadless() {
122         return getHeadlessProperty();
123     }
124 
125     /**
126      * @return warning message if headless state is assumed by default;
127      * null otherwise
128      * @since 1.5
129      */
130     static String getHeadlessMessage() {
131         if (headless == null) {
132             getHeadlessProperty(); // initialize the values
133         }
134         return defaultHeadless != Boolean.TRUE ? null :
<span class="line-modified">135             PlatformGraphicsInfo.getDefaultHeadlessMessage();</span>

136     }
137 
138     /**
139      * @return the value of the property &quot;java.awt.headless&quot;
140      * @since 1.4
141      */
142     private static boolean getHeadlessProperty() {
143         if (headless == null) {
144             AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {
145                 String nm = System.getProperty(&quot;java.awt.headless&quot;);
146 
147                 if (nm == null) {


148                     headless = defaultHeadless =
<span class="line-modified">149                         PlatformGraphicsInfo.getDefaultHeadlessProperty();</span>






150                 } else {
151                     headless = Boolean.valueOf(nm);
152                 }
153                 return null;
154             });
155         }
156         return headless;
157     }
158 
159     /**
160      * Check for headless state and throw HeadlessException if headless
161      * @since 1.4
162      */
163     static void checkHeadless() throws HeadlessException {
164         if (isHeadless()) {
165             throw new HeadlessException();
166         }
167     }
168 
169     /**
</pre>
</td>
</tr>
</table>
<center><a href="Frame.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="GridBagLayout.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>