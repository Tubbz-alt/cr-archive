<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/classes/java/awt/Toolkit.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="TextField.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="Window.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/java/awt/Toolkit.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 1995, 2017, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 1995, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 76,10 ***</span>
<span class="line-new-header">--- 76,11 ---</span>
  import sun.awt.AWTAccessor;
  import sun.awt.AWTPermissions;
  import sun.awt.AppContext;
  import sun.awt.HeadlessToolkit;
  import sun.awt.PeerEvent;
<span class="line-added">+ import sun.awt.PlatformGraphicsInfo;</span>
  import sun.awt.SunToolkit;
  
  /**
   * This class is the abstract superclass of all actual
   * implementations of the Abstract Window Toolkit. Subclasses of
</pre>
<hr />
<pre>
<span class="line-old-header">*** 501,15 ***</span>
       * assistive technology providers to load.  The order in which providers are
       * loaded is determined by the order in which the ServiceLoader discovers
       * implementations of the AccessibilityProvider interface, not by the order
       * of provider names in the property list.  When a provider is found its
       * accessibility implementation will be started by calling the provider&#39;s
<span class="line-modified">!      * activate method.  All errors are handled via an AWTError exception.</span>
       */
      private static void loadAssistiveTechnologies() {
          // Load any assistive technologies
<span class="line-modified">!         if (atNames != null) {</span>
              ClassLoader cl = ClassLoader.getSystemClassLoader();
              Set&lt;String&gt; names = Arrays.stream(atNames.split(&quot;,&quot;))
                                        .map(String::trim)
                                        .collect(Collectors.toSet());
              final Map&lt;String, AccessibilityProvider&gt; providers = new HashMap&lt;&gt;();
<span class="line-new-header">--- 502,19 ---</span>
       * assistive technology providers to load.  The order in which providers are
       * loaded is determined by the order in which the ServiceLoader discovers
       * implementations of the AccessibilityProvider interface, not by the order
       * of provider names in the property list.  When a provider is found its
       * accessibility implementation will be started by calling the provider&#39;s
<span class="line-modified">!      * activate method. If the list of assistive technology providers is the</span>
<span class="line-added">+      * empty string or contains only</span>
<span class="line-added">+      * {@linkplain Character#isWhitespace(int) white space} characters or</span>
<span class="line-added">+      * {@code null} it is ignored. All other errors are handled via an AWTError</span>
<span class="line-added">+      * exception.</span>
       */
      private static void loadAssistiveTechnologies() {
          // Load any assistive technologies
<span class="line-modified">!         if (atNames != null &amp;&amp; !atNames.isBlank()) {</span>
              ClassLoader cl = ClassLoader.getSystemClassLoader();
              Set&lt;String&gt; names = Arrays.stream(atNames.split(&quot;,&quot;))
                                        .map(String::trim)
                                        .collect(Collectors.toSet());
              final Map&lt;String, AccessibilityProvider&gt; providers = new HashMap&lt;&gt;();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 549,11 ***</span>
       * &lt;p&gt;
       * An example of setting this property is to invoke Java with
       * {@code -Djavax.accessibility.assistive_technologies=MyServiceProvider}.
       * In addition to MyServiceProvider other service providers can be specified
       * using a comma separated list.  Service providers are loaded after the AWT
<span class="line-modified">!      * toolkit is created. All errors are handled via an AWTError exception.</span>
       * &lt;p&gt;
       * The names specified in the assistive_technologies property are used to query
       * each service provider implementation.  If the requested name matches the
       * {@linkplain AccessibilityProvider#getName name} of the service provider, the
       * {@link AccessibilityProvider#activate} method will be invoked to activate the
<span class="line-new-header">--- 554,17 ---</span>
       * &lt;p&gt;
       * An example of setting this property is to invoke Java with
       * {@code -Djavax.accessibility.assistive_technologies=MyServiceProvider}.
       * In addition to MyServiceProvider other service providers can be specified
       * using a comma separated list.  Service providers are loaded after the AWT
<span class="line-modified">!      * toolkit is created.</span>
<span class="line-added">+      * &lt;p&gt;</span>
<span class="line-added">+      * If the list of assistive technology providers as provided through system</span>
<span class="line-added">+      * property &quot;{@systemProperty javax.accessibility.assistive_technologies}&quot;</span>
<span class="line-added">+      * is the empty string or contains only</span>
<span class="line-added">+      * {@linkplain Character#isWhitespace(int) white space} characters it is</span>
<span class="line-added">+      * ignored. All other errors are handled via an AWTError exception.</span>
       * &lt;p&gt;
       * The names specified in the assistive_technologies property are used to query
       * each service provider implementation.  If the requested name matches the
       * {@linkplain AccessibilityProvider#getName name} of the service provider, the
       * {@link AccessibilityProvider#activate} method will be invoked to activate the
</pre>
<hr />
<pre>
<span class="line-old-header">*** 570,47 ***</span>
       * service providers are specified by setting the {@code assistive_technologies=}
       * property.  A single provider or a comma separated list of providers can be
       * specified.
       *
       * @return     the default toolkit.
<span class="line-modified">!      * @exception  AWTError  if a toolkit could not be found, or</span>
<span class="line-removed">-      *                 if one could not be accessed or instantiated.</span>
       * @see java.util.ServiceLoader
       * @see javax.accessibility.AccessibilityProvider
       */
      public static synchronized Toolkit getDefaultToolkit() {
          if (toolkit == null) {
<span class="line-modified">!             java.security.AccessController.doPrivileged(</span>
<span class="line-modified">!                     new java.security.PrivilegedAction&lt;Void&gt;() {</span>
<span class="line-modified">!                 public Void run() {</span>
<span class="line-modified">!                     Class&lt;?&gt; cls = null;</span>
<span class="line-modified">!                     String nm = System.getProperty(&quot;awt.toolkit&quot;);</span>
<span class="line-removed">-                     try {</span>
<span class="line-removed">-                         cls = Class.forName(nm);</span>
<span class="line-removed">-                     } catch (ClassNotFoundException e) {</span>
<span class="line-removed">-                         ClassLoader cl = ClassLoader.getSystemClassLoader();</span>
<span class="line-removed">-                         if (cl != null) {</span>
<span class="line-removed">-                             try {</span>
<span class="line-removed">-                                 cls = cl.loadClass(nm);</span>
<span class="line-removed">-                             } catch (final ClassNotFoundException ignored) {</span>
<span class="line-removed">-                                 throw new AWTError(&quot;Toolkit not found: &quot; + nm);</span>
<span class="line-removed">-                             }</span>
<span class="line-removed">-                         }</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     try {</span>
<span class="line-removed">-                         if (cls != null) {</span>
<span class="line-removed">-                             toolkit = (Toolkit)cls.getConstructor().newInstance();</span>
<span class="line-removed">-                             if (GraphicsEnvironment.isHeadless()) {</span>
<span class="line-removed">-                                 toolkit = new HeadlessToolkit(toolkit);</span>
<span class="line-removed">-                             }</span>
<span class="line-removed">-                         }</span>
<span class="line-removed">-                     } catch (final ReflectiveOperationException ignored) {</span>
<span class="line-removed">-                         throw new AWTError(&quot;Could not create Toolkit: &quot; + nm);</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     return null;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             });</span>
              if (!GraphicsEnvironment.isHeadless()) {
                  loadAssistiveTechnologies();
              }
          }
          return toolkit;
<span class="line-new-header">--- 581,21 ---</span>
       * service providers are specified by setting the {@code assistive_technologies=}
       * property.  A single provider or a comma separated list of providers can be
       * specified.
       *
       * @return     the default toolkit.
<span class="line-modified">!      * @throws  AWTError in case of an error loading assistive technologies.</span>
       * @see java.util.ServiceLoader
       * @see javax.accessibility.AccessibilityProvider
       */
      public static synchronized Toolkit getDefaultToolkit() {
          if (toolkit == null) {
<span class="line-modified">!             toolkit = PlatformGraphicsInfo.createToolkit();</span>
<span class="line-modified">!             if (GraphicsEnvironment.isHeadless() &amp;&amp;</span>
<span class="line-modified">!                 !(toolkit instanceof HeadlessToolkit)) {</span>
<span class="line-modified">!                 toolkit = new HeadlessToolkit(toolkit);</span>
<span class="line-modified">!             }</span>
              if (!GraphicsEnvironment.isHeadless()) {
                  loadAssistiveTechnologies();
              }
          }
          return toolkit;
</pre>
<center><a href="TextField.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="Window.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>