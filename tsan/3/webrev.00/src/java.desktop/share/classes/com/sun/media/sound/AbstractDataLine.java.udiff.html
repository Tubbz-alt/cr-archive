<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/share/classes/com/sun/media/sound/AbstractDataLine.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../java/swing/plaf/motif/resources/motif_zh_TW.properties.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="AbstractLine.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/com/sun/media/sound/AbstractDataLine.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 1999, 2016, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 1999, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -99,19 +99,15 @@</span>
      // DATA LINE METHODS
  
      public final void open(AudioFormat format, int bufferSize) throws LineUnavailableException {
          //$$fb 2001-10-09: Bug #4517739: avoiding deadlock by synchronizing to mixer !
          synchronized (mixer) {
<span class="udiff-line-removed">-             if (Printer.trace) Printer.trace(&quot;&gt; AbstractDataLine.open(format, bufferSize) (class: &quot;+getClass().getName());</span>
<span class="udiff-line-removed">- </span>
              // if the line is not currently open, try to open it with this format and buffer size
              if (!isOpen()) {
                  // make sure that the format is specified correctly
                  // $$fb part of fix for 4679187: Clip.open() throws unexpected Exceptions
                  Toolkit.isFullySpecifiedAudioFormat(format);
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 if (Printer.debug) Printer.debug(&quot;  need to open the mixer...&quot;);</span>
                  // reserve mixer resources for this line
                  //mixer.open(this, format, bufferSize);
                  mixer.open(this);
  
                  try {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -125,12 +121,10 @@</span>
                      // release mixer resources for this line and then throw the exception
                      mixer.close(this);
                      throw e;
                  }
              } else {
<span class="udiff-line-removed">-                 if (Printer.debug) Printer.debug(&quot;  dataline already open&quot;);</span>
<span class="udiff-line-removed">- </span>
                  // if the line is already open and the requested format differs from the
                  // current settings, throw an IllegalStateException
                  //$$fb 2002-04-02: fix for 4661602: Buffersize is checked when re-opening line
                  if (!format.matches(getFormat())) {
                      throw new IllegalStateException(&quot;Line is already open with format &quot; + getFormat() +
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -139,12 +133,10 @@</span>
                  //$$fb 2002-07-26: allow changing the buffersize of already open lines
                  if (bufferSize &gt; 0) {
                      setBufferSize(bufferSize);
                  }
              }
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             if (Printer.trace) Printer.trace(&quot;&lt; AbstractDataLine.open(format, bufferSize) completed&quot;);</span>
          }
      }
  
      public final void open(AudioFormat format) throws LineUnavailableException {
          open(format, AudioSystem.NOT_SPECIFIED);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -161,26 +153,23 @@</span>
      /**
       * This implementation does nothing.
       */
      @Override
      public void drain() {
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;AbstractDataLine: drain&quot;);</span>
      }
  
      /**
       * This implementation does nothing.
       */
      @Override
      public void flush() {
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;AbstractDataLine: flush&quot;);</span>
      }
  
      @Override
      public final void start() {
          //$$fb 2001-10-09: Bug #4517739: avoiding deadlock by synchronizing to mixer !
          synchronized(mixer) {
<span class="udiff-line-removed">-             if (Printer.trace) Printer.trace(&quot;&gt; &quot;+getClass().getName()+&quot;.start() - AbstractDataLine&quot;);</span>
  
              // $$kk: 06.06.99: if not open, this doesn&#39;t work....???
              if (isOpen()) {
  
                  if (!isStartedRunning()) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -192,21 +181,17 @@</span>
          }
  
          synchronized(lock) {
              lock.notifyAll();
          }
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&lt; &quot;+getClass().getName()+&quot;.start() - AbstractDataLine&quot;);</span>
      }
  
      @Override
      public final void stop() {
  
          //$$fb 2001-10-09: Bug #4517739: avoiding deadlock by synchronizing to mixer !
          synchronized(mixer) {
<span class="udiff-line-removed">-             if (Printer.trace) Printer.trace(&quot;&gt; &quot;+getClass().getName()+&quot;.stop() - AbstractDataLine&quot;);</span>
<span class="udiff-line-removed">- </span>
              // $$kk: 06.06.99: if not open, this doesn&#39;t work.
              if (isOpen()) {
  
                  if (isStartedRunning()) {
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -224,12 +209,10 @@</span>
          }
  
          synchronized(lock) {
              lock.notifyAll();
          }
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&lt; &quot;+getClass().getName()+&quot;.stop() - AbstractDataLine&quot;);</span>
      }
  
      // $$jb: 12.10.99: The official API for this is isRunning().
      // Per the denied RFE 4297981,
      // the change to isStarted() is technically an unapproved API change.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -307,13 +290,10 @@</span>
      /**
       * This method sets the active state and generates
       * events if it changes.
       */
      final void setActive(boolean active) {
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&gt; AbstractDataLine: setActive(&quot; + active + &quot;)&quot;);</span>
<span class="udiff-line-removed">- </span>
          //boolean sendEvents = false;
          //long position = getLongFramePosition();
  
          synchronized (this) {
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -339,13 +319,10 @@</span>
      /**
       * This method sets the started state and generates
       * events if it changes.
       */
      final void setStarted(boolean started) {
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&gt; AbstractDataLine: setStarted(&quot; + started + &quot;)&quot;);</span>
<span class="udiff-line-removed">- </span>
          boolean sendEvents = false;
          long position = getLongFramePosition();
  
          synchronized (this) {
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -361,24 +338,20 @@</span>
                  sendEvents(new LineEvent(this, LineEvent.Type.START, position));
              } else {
                  sendEvents(new LineEvent(this, LineEvent.Type.STOP, position));
              }
          }
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&lt; AbstractDataLine: setStarted completed&quot;);</span>
      }
  
      /**
       * This method generates a STOP event and sets the started state to false.
       * It is here for historic reasons when an EOM event existed.
       */
      final void setEOM() {
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&gt; AbstractDataLine: setEOM()&quot;);</span>
          //$$fb 2002-04-21: sometimes, 2 STOP events are generated.
          // better use setStarted() to send STOP event.
          setStarted(false);
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&lt; AbstractDataLine: setEOM() completed&quot;);</span>
      }
  
      // OVERRIDES OF ABSTRACT LINE METHODS
  
      /**
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -387,28 +360,22 @@</span>
       * line is open, this should return quietly because the values
       * requested will match the current ones.
       */
      @Override
      public final void open() throws LineUnavailableException {
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&gt; &quot;+getClass().getName()+&quot;.open() - AbstractDataLine&quot;);</span>
<span class="udiff-line-removed">- </span>
          // this may throw a LineUnavailableException.
          open(format, bufferSize);
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&lt; &quot;+getClass().getName()+&quot;.open() - AbstractDataLine&quot;);</span>
      }
  
      /**
       * This should also stop the line.  The closed line should not be running or active.
       * After we close the line, we reset the format and buffer size to the defaults.
       */
      @Override
      public final void close() {
          //$$fb 2001-10-09: Bug #4517739: avoiding deadlock by synchronizing to mixer !
          synchronized (mixer) {
<span class="udiff-line-removed">-             if (Printer.trace) Printer.trace(&quot;&gt; &quot;+getClass().getName()+&quot;.close() - in AbstractDataLine.&quot;);</span>
<span class="udiff-line-removed">- </span>
              if (isOpen()) {
  
                  // stop
                  stop();
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -424,11 +391,10 @@</span>
                  // reset format and buffer size to the defaults
                  format = defaultFormat;
                  bufferSize = defaultBufferSize;
              }
          }
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&lt; &quot;+getClass().getName()+&quot;.close() - in AbstractDataLine&quot;);</span>
      }
  
      abstract void implOpen(AudioFormat format, int bufferSize) throws LineUnavailableException;
      abstract void implClose();
  
</pre>
<center><a href="../../java/swing/plaf/motif/resources/motif_zh_TW.properties.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="AbstractLine.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>