<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/share/classes/com/sun/media/sound/AbstractMidiDevice.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AbstractLine.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="AbstractMidiDeviceProvider.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/com/sun/media/sound/AbstractMidiDevice.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 1999, 2017, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 1999, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -48,12 +48,10 @@</span>
   * @author Matthias Pfisterer
   * @author Florian Bomers
   */
  abstract class AbstractMidiDevice implements MidiDevice, ReferenceCountingDevice {
  
<span class="udiff-line-removed">-     private static final boolean TRACE_TRANSMITTER = false;</span>
<span class="udiff-line-removed">- </span>
      private ArrayList&lt;Receiver&gt; receiverList;
  
      private TransmitterList transmitterList;
  
      // lock to protect receiverList and transmitterList
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -86,17 +84,12 @@</span>
       */
      /*
       * The initial mode and only supported mode default to OMNI_ON_POLY.
       */
      protected AbstractMidiDevice(MidiDevice.Info info) {
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if(Printer.trace) Printer.trace(&quot;&gt;&gt; AbstractMidiDevice CONSTRUCTOR&quot;);</span>
<span class="udiff-line-removed">- </span>
          this.info = info;
          openRefCount = 0;
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if(Printer.trace) Printer.trace(&quot;&lt;&lt; AbstractMidiDevice CONSTRUCTOR completed&quot;);</span>
      }
  
      // MIDI DEVICE METHODS
  
      @Override
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -109,16 +102,14 @@</span>
       * opened the device implicitly from closing it. The only way to close the device after
       * this call is a call to close().
       */
      @Override
      public final void open() throws MidiUnavailableException {
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&gt; AbstractMidiDevice: open()&quot;);</span>
          synchronized(this) {
              openRefCount = -1;
              doOpen();
          }
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&lt; AbstractMidiDevice: open() completed&quot;);</span>
      }
  
      /** Open the device implicitly.
       * This method is intended to be used by AbstractReceiver
       * and BasicTransmitter. Actually, it is called by getReceiverReferenceCounting() and
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -129,41 +120,35 @@</span>
       * R/T&#39;s are ones that opened the device implicitly.
       *
       * @object The Receiver or Transmitter instance that triggered this implicit open.
       */
      private void openInternal(Object object) throws MidiUnavailableException {
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&gt; AbstractMidiDevice: openInternal()&quot;);</span>
          synchronized(this) {
              if (openRefCount != -1) {
                  openRefCount++;
                  getOpenKeepingObjects().add(object);
              }
              // double calls to doOpens() will be catched by the open flag.
              doOpen();
          }
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&lt; AbstractMidiDevice: openInternal() completed&quot;);</span>
      }
  
      private void doOpen() throws MidiUnavailableException {
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&gt; AbstractMidiDevice: doOpen()&quot;);</span>
          synchronized(this) {
              if (! isOpen()) {
                  implOpen();
                  open = true;
              }
          }
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&lt; AbstractMidiDevice: doOpen() completed&quot;);</span>
      }
  
      @Override
      public final void close() {
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&gt; AbstractMidiDevice: close()&quot;);</span>
          synchronized (this) {
              doClose();
              openRefCount = 0;
          }
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&lt; AbstractMidiDevice: close() completed&quot;);</span>
      }
  
      /** Close the device for an object that implicitely opened it.
       * This method is intended to be used by Transmitter.close() and Receiver.close().
       * Those methods should pass this for the object parameter. Since Transmitters or Receivers
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -175,33 +160,29 @@</span>
       *
       * @param object The object that might have been opening the device implicitely (for now,
       * this may be a Transmitter or receiver).
       */
      public final void closeInternal(Object object) {
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&gt; AbstractMidiDevice: closeInternal()&quot;);</span>
          synchronized(this) {
              if (getOpenKeepingObjects().remove(object)) {
                  if (openRefCount &gt; 0) {
                      openRefCount--;
                      if (openRefCount == 0) {
                          doClose();
                      }
                  }
              }
          }
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&lt; AbstractMidiDevice: closeInternal() completed&quot;);</span>
      }
  
      public final void doClose() {
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&gt; AbstractMidiDevice: doClose()&quot;);</span>
          synchronized(this) {
              if (isOpen()) {
                  implClose();
                  open = false;
              }
          }
<span class="udiff-line-removed">-         if (Printer.trace) Printer.trace(&quot;&lt; AbstractMidiDevice: doClose() completed&quot;);</span>
      }
  
      @Override
      public final boolean isOpen() {
          return open;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -528,11 +509,10 @@</span>
          }
  
          @Override
          public final void setReceiver(Receiver receiver) {
              if (tlist != null &amp;&amp; this.receiver != receiver) {
<span class="udiff-line-removed">-                 if (Printer.debug) Printer.debug(&quot;Transmitter &quot;+toString()+&quot;: set receiver &quot;+receiver);</span>
                  tlist.receiverChanged(this, this.receiver, receiver);
                  this.receiver = receiver;
              }
          }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -581,19 +561,17 @@</span>
                  transmitters.add(t);
              }
              if (t instanceof BasicTransmitter) {
                  ((BasicTransmitter) t).setTransmitterList(this);
              }
<span class="udiff-line-removed">-             if (Printer.debug) Printer.debug(&quot;--added transmitter &quot;+t);</span>
          }
  
          private void remove(Transmitter t) {
              synchronized(transmitters) {
                  int index = transmitters.indexOf(t);
                  if (index &gt;= 0) {
                      transmitters.remove(index);
<span class="udiff-line-removed">-                     if (Printer.debug) Printer.debug(&quot;--removed transmitter &quot;+t);</span>
                  }
              }
          }
  
          private void receiverChanged(BasicTransmitter t,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -623,11 +601,10 @@</span>
                  for(int i = 0; i &lt; transmitters.size(); i++) {
                      transmitters.get(i).close();
                  }
                  transmitters.clear();
              }
<span class="udiff-line-removed">-             if (Printer.trace) Printer.trace(&quot;TransmitterList.close() succeeded&quot;);</span>
          }
  
  
  
          /**
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -640,15 +617,13 @@</span>
              try {
                  synchronized(transmitters) {
                      int size = transmitters.size();
                      if (optimizedReceiverCount == size) {
                          if (midiOutReceiver != null) {
<span class="udiff-line-removed">-                             if (TRACE_TRANSMITTER) Printer.println(&quot;Sending packed message to MidiOutReceiver&quot;);</span>
                              midiOutReceiver.sendPackedMidiMessage(packedMessage, timeStamp);
                          }
                      } else {
<span class="udiff-line-removed">-                         if (TRACE_TRANSMITTER) Printer.println(&quot;Sending packed message to &quot;+size+&quot; transmitter&#39;s receivers&quot;);</span>
                          for (int i = 0; i &lt; size; i++) {
                              Receiver receiver = transmitters.get(i).getReceiver();
                              if (receiver != null) {
                                  if (optimizedReceiverCount &gt; 0) {
                                      if (receiver instanceof MidiOutDevice.MidiOutReceiver) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -670,11 +645,10 @@</span>
  
          void sendMessage(byte[] data, long timeStamp) {
              try {
                  synchronized(transmitters) {
                      int size = transmitters.size();
<span class="udiff-line-removed">-                     if (TRACE_TRANSMITTER) Printer.println(&quot;Sending long message to &quot;+size+&quot; transmitter&#39;s receivers&quot;);</span>
                      for (int i = 0; i &lt; size; i++) {
                          Receiver receiver = transmitters.get(i).getReceiver();
                          if (receiver != null) {
                              //$$fb 2002-04-02: SysexMessages are mutable, so
                              // an application could change the contents of this object,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -701,15 +675,13 @@</span>
              }
              synchronized(transmitters) {
                  int size = transmitters.size();
                  if (optimizedReceiverCount == size) {
                      if (midiOutReceiver != null) {
<span class="udiff-line-removed">-                         if (TRACE_TRANSMITTER) Printer.println(&quot;Sending MIDI message to MidiOutReceiver&quot;);</span>
                          midiOutReceiver.send(message, timeStamp);
                      }
                  } else {
<span class="udiff-line-removed">-                     if (TRACE_TRANSMITTER) Printer.println(&quot;Sending MIDI message to &quot;+size+&quot; transmitter&#39;s receivers&quot;);</span>
                      for (int i = 0; i &lt; size; i++) {
                          Receiver receiver = transmitters.get(i).getReceiver();
                          if (receiver != null) {
                              //$$fb 2002-04-02: ShortMessages are mutable, so
                              // an application could change the contents of this object,
</pre>
<center><a href="AbstractLine.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="AbstractMidiDeviceProvider.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>