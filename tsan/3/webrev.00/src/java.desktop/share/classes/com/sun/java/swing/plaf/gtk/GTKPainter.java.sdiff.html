<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/classes/com/sun/java/swing/plaf/gtk/GTKPainter.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="GTKLookAndFeel.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="GTKStyle.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/com/sun/java/swing/plaf/gtk/GTKPainter.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 518     public void paintMenuBarBackground(SynthContext context, Graphics g,
 519                                        int x, int y, int w, int h) {
 520         Region id = context.getRegion();
 521         synchronized (UNIXToolkit.GTK_LOCK) {
 522             if (ENGINE.paintCachedImage(g, x, y, w, h, id)) {
 523                 return;
 524             }
 525             GTKStyle style = (GTKStyle)context.getStyle();
 526             int shadow = style.getClassSpecificIntValue(
 527                     context, &quot;shadow-type&quot;, 2);
 528             ShadowType shadowType = SHADOWS[shadow];
 529             int gtkState = GTKLookAndFeel.synthStateToGTKState(
 530                     id, context.getComponentState());
 531             ENGINE.startPainting(g, x, y, w, h, id);
 532             ENGINE.paintBox(g, context, id, gtkState,
 533                 shadowType, &quot;menubar&quot;, x, y, w, h);
 534             ENGINE.finishPainting();
 535         }
 536     }
 537 




























 538     //
 539     // MENU
 540     //
 541     public void paintMenuBackground(SynthContext context,
 542                                      Graphics g,
 543                                      int x, int y, int w, int h) {
 544         paintMenuItemBackground(context, g, x, y, w, h);
 545     }
 546 
 547     // This is called for both MENU and MENU_ITEM
 548     public void paintMenuItemBackground(SynthContext context,
 549                                      Graphics g,
 550                                      int x, int y, int w, int h) {
 551         int gtkState = GTKLookAndFeel.synthStateToGTKState(
 552                 context.getRegion(), context.getComponentState());
 553         if (gtkState == SynthConstants.MOUSE_OVER) {



















































 554             Region id = Region.MENU_ITEM;
 555             synchronized (UNIXToolkit.GTK_LOCK) {
 556                 if (! ENGINE.paintCachedImage(g, x, y, w, h, id)) {
 557                     ShadowType shadow = (GTKLookAndFeel.is2_2() ?
 558                         ShadowType.NONE : ShadowType.OUT);
 559                     ENGINE.startPainting(g, x, y, w, h, id);
 560                     ENGINE.paintBox(g, context, id, gtkState, shadow,
 561                             &quot;menuitem&quot;, x, y, w, h);
 562                     ENGINE.finishPainting();
 563                 }
 564             }
 565         }
 566     }
 567 
 568     public void paintPopupMenuBackground(SynthContext context, Graphics g,
 569                                         int x, int y, int w, int h) {
 570         Region id = context.getRegion();
 571         int gtkState = GTKLookAndFeel.synthStateToGTKState(
 572                 id, context.getComponentState());
 573         boolean isHW = SunToolkit.getHeavyweightComponent(
</pre>
</td>
<td>
<hr />
<pre>
 518     public void paintMenuBarBackground(SynthContext context, Graphics g,
 519                                        int x, int y, int w, int h) {
 520         Region id = context.getRegion();
 521         synchronized (UNIXToolkit.GTK_LOCK) {
 522             if (ENGINE.paintCachedImage(g, x, y, w, h, id)) {
 523                 return;
 524             }
 525             GTKStyle style = (GTKStyle)context.getStyle();
 526             int shadow = style.getClassSpecificIntValue(
 527                     context, &quot;shadow-type&quot;, 2);
 528             ShadowType shadowType = SHADOWS[shadow];
 529             int gtkState = GTKLookAndFeel.synthStateToGTKState(
 530                     id, context.getComponentState());
 531             ENGINE.startPainting(g, x, y, w, h, id);
 532             ENGINE.paintBox(g, context, id, gtkState,
 533                 shadowType, &quot;menubar&quot;, x, y, w, h);
 534             ENGINE.finishPainting();
 535         }
 536     }
 537 
<span class="line-added"> 538     private int getBrightness(Color c) {</span>
<span class="line-added"> 539         return Math.max(c.getRed(), Math.max(c.getGreen(), c.getBlue()));</span>
<span class="line-added"> 540     }</span>
<span class="line-added"> 541 </span>
<span class="line-added"> 542     private int getMaxColorDiff(Color c1, Color c2) {</span>
<span class="line-added"> 543         return Math.max(Math.abs(c1.getRed() - c2.getRed()),</span>
<span class="line-added"> 544                 Math.max(Math.abs(c1.getGreen() - c2.getGreen()),</span>
<span class="line-added"> 545                         Math.abs(c1.getBlue() - c2.getBlue())));</span>
<span class="line-added"> 546     }</span>
<span class="line-added"> 547 </span>
<span class="line-added"> 548     private int scaleColorComponent(int color, double scaleFactor) {</span>
<span class="line-added"> 549         return (int)(color + color * scaleFactor);</span>
<span class="line-added"> 550     }</span>
<span class="line-added"> 551     private Color deriveColor(Color originalColor, int originalBrightness,</span>
<span class="line-added"> 552                               int targetBrightness) {</span>
<span class="line-added"> 553         int r, g, b;</span>
<span class="line-added"> 554         if (originalBrightness == 0) {</span>
<span class="line-added"> 555             r = g = b = targetBrightness;</span>
<span class="line-added"> 556         } else {</span>
<span class="line-added"> 557             double scaleFactor = (targetBrightness - originalBrightness)</span>
<span class="line-added"> 558                     / originalBrightness    ;</span>
<span class="line-added"> 559             r = scaleColorComponent(originalColor.getRed(), scaleFactor);</span>
<span class="line-added"> 560             g = scaleColorComponent(originalColor.getGreen(), scaleFactor);</span>
<span class="line-added"> 561             b = scaleColorComponent(originalColor.getBlue(), scaleFactor);</span>
<span class="line-added"> 562         }</span>
<span class="line-added"> 563         return new Color(r, g, b);</span>
<span class="line-added"> 564     }</span>
<span class="line-added"> 565 </span>
 566     //
 567     // MENU
 568     //
 569     public void paintMenuBackground(SynthContext context,
 570                                      Graphics g,
 571                                      int x, int y, int w, int h) {
 572         paintMenuItemBackground(context, g, x, y, w, h);
 573     }
 574 
 575     // This is called for both MENU and MENU_ITEM
 576     public void paintMenuItemBackground(SynthContext context,
 577                                      Graphics g,
 578                                      int x, int y, int w, int h) {
 579         int gtkState = GTKLookAndFeel.synthStateToGTKState(
 580                 context.getRegion(), context.getComponentState());
 581         if (gtkState == SynthConstants.MOUSE_OVER) {
<span class="line-added"> 582             if (GTKLookAndFeel.is3() &amp;&amp; context.getRegion() == Region.MENU) {</span>
<span class="line-added"> 583                 GTKStyle style = (GTKStyle)context.getStyle();</span>
<span class="line-added"> 584                 Color highlightColor = style.getGTKColor(</span>
<span class="line-added"> 585                         GTKEngine.WidgetType.MENU_ITEM.ordinal(),</span>
<span class="line-added"> 586                         gtkState, ColorType.BACKGROUND.getID());</span>
<span class="line-added"> 587                 Color backgroundColor = style.getGTKColor(</span>
<span class="line-added"> 588                         GTKEngine.WidgetType.MENU_BAR.ordinal(),</span>
<span class="line-added"> 589                         SynthConstants.ENABLED, ColorType.BACKGROUND.getID());</span>
<span class="line-added"> 590 </span>
<span class="line-added"> 591                 int minBrightness = 0, maxBrightness = 255;</span>
<span class="line-added"> 592                 int minBrightnessDifference = 100;</span>
<span class="line-added"> 593                 int actualBrightnessDifference =</span>
<span class="line-added"> 594                         getMaxColorDiff(highlightColor, backgroundColor);</span>
<span class="line-added"> 595                 if (actualBrightnessDifference &lt; minBrightnessDifference) {</span>
<span class="line-added"> 596                     int highlightBrightness =</span>
<span class="line-added"> 597                             getBrightness(highlightColor);</span>
<span class="line-added"> 598                     int backgroundBrightness =</span>
<span class="line-added"> 599                             getBrightness(backgroundColor);</span>
<span class="line-added"> 600                     int originalHighlightBrightness =</span>
<span class="line-added"> 601                             highlightBrightness;</span>
<span class="line-added"> 602                     if (highlightBrightness &gt;= backgroundBrightness) {</span>
<span class="line-added"> 603                         if (backgroundBrightness + minBrightnessDifference &lt;=</span>
<span class="line-added"> 604                                 maxBrightness) {</span>
<span class="line-added"> 605                             highlightBrightness =</span>
<span class="line-added"> 606                                     backgroundBrightness +</span>
<span class="line-added"> 607                                             minBrightnessDifference;</span>
<span class="line-added"> 608                         } else {</span>
<span class="line-added"> 609                             highlightBrightness =</span>
<span class="line-added"> 610                                     backgroundBrightness -</span>
<span class="line-added"> 611                                             minBrightnessDifference;</span>
<span class="line-added"> 612                         }</span>
<span class="line-added"> 613                     } else {</span>
<span class="line-added"> 614                         if (backgroundBrightness - minBrightnessDifference &gt;=</span>
<span class="line-added"> 615                                 minBrightness) {</span>
<span class="line-added"> 616                             highlightBrightness =</span>
<span class="line-added"> 617                                     backgroundBrightness -</span>
<span class="line-added"> 618                                             minBrightnessDifference;</span>
<span class="line-added"> 619                         } else {</span>
<span class="line-added"> 620                             highlightBrightness =</span>
<span class="line-added"> 621                                     backgroundBrightness +</span>
<span class="line-added"> 622                                             minBrightnessDifference;</span>
<span class="line-added"> 623                         }</span>
<span class="line-added"> 624                     }</span>
<span class="line-added"> 625 </span>
<span class="line-added"> 626                     g.setColor(deriveColor(highlightColor,</span>
<span class="line-added"> 627                             originalHighlightBrightness,</span>
<span class="line-added"> 628                             highlightBrightness));</span>
<span class="line-added"> 629                     g.fillRect(x, y, w, h);</span>
<span class="line-added"> 630                     return;</span>
<span class="line-added"> 631                 }</span>
<span class="line-added"> 632             }</span>
 633             Region id = Region.MENU_ITEM;
 634             synchronized (UNIXToolkit.GTK_LOCK) {
 635                 if (! ENGINE.paintCachedImage(g, x, y, w, h, id)) {
 636                     ShadowType shadow = (GTKLookAndFeel.is2_2() ?
 637                         ShadowType.NONE : ShadowType.OUT);
 638                     ENGINE.startPainting(g, x, y, w, h, id);
 639                     ENGINE.paintBox(g, context, id, gtkState, shadow,
 640                             &quot;menuitem&quot;, x, y, w, h);
 641                     ENGINE.finishPainting();
 642                 }
 643             }
 644         }
 645     }
 646 
 647     public void paintPopupMenuBackground(SynthContext context, Graphics g,
 648                                         int x, int y, int w, int h) {
 649         Region id = context.getRegion();
 650         int gtkState = GTKLookAndFeel.synthStateToGTKState(
 651                 id, context.getComponentState());
 652         boolean isHW = SunToolkit.getHeavyweightComponent(
</pre>
</td>
</tr>
</table>
<center><a href="GTKLookAndFeel.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="GTKStyle.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>