<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/classes/com/sun/media/sound/PortMixer.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Platform.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PortMixerProvider.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/com/sun/media/sound/PortMixer.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2002, 2014, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2002, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 65,24 ***</span>
          // pass in Line.Info, mixer, controls
          super(portMixerInfo,              // Mixer.Info
                null,                       // Control[]
                null,                       // Line.Info[] sourceLineInfo
                null);                      // Line.Info[] targetLineInfo
<span class="line-removed">- </span>
<span class="line-removed">-         if (Printer.trace) Printer.trace(&quot;&gt;&gt; PortMixer: constructor&quot;);</span>
<span class="line-removed">- </span>
          int count = 0;
          int srcLineCount = 0;
          int dstLineCount = 0;
  
          try {
              try {
                  id = nOpen(getMixerIndex());
                  if (id != 0) {
                      count = nGetPortCount(id);
                      if (count &lt; 0) {
<span class="line-removed">-                         if (Printer.trace) Printer.trace(&quot;nGetPortCount() returned error code: &quot; + count);</span>
                          count = 0;
                      }
                  }
              } catch (Exception e) {}
  
<span class="line-new-header">--- 65,20 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 111,12 ***</span>
                  sourceLineInfo[srcLineCount++] = portInfos[i];
              } else {
                  targetLineInfo[dstLineCount++] = portInfos[i];
              }
          }
<span class="line-removed">- </span>
<span class="line-removed">-         if (Printer.trace) Printer.trace(&quot;&lt;&lt; PortMixer: constructor completed&quot;);</span>
      }
  
      @Override
      public Line getLine(Line.Info info) throws LineUnavailableException {
          Line.Info fullInfo = getLineInfo(info);
<span class="line-new-header">--- 107,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 147,22 ***</span>
          return 0;
      }
  
      @Override
      protected void implOpen() throws LineUnavailableException {
<span class="line-removed">-         if (Printer.trace) Printer.trace(&quot;&gt;&gt; PortMixer: implOpen (id=&quot;+id+&quot;)&quot;);</span>
<span class="line-removed">- </span>
          // open the mixer device
          id = nOpen(getMixerIndex());
<span class="line-removed">- </span>
<span class="line-removed">-         if (Printer.trace) Printer.trace(&quot;&lt;&lt; PortMixer: implOpen succeeded.&quot;);</span>
      }
  
      @Override
      protected void implClose() {
<span class="line-removed">-         if (Printer.trace) Printer.trace(&quot;&gt;&gt; PortMixer: implClose&quot;);</span>
<span class="line-removed">- </span>
          // close the mixer device
          long thisID = id;
          id = 0;
          nClose(thisID);
          if (ports != null) {
<span class="line-new-header">--- 141,16 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 170,12 ***</span>
                  if (ports[i] != null) {
                      ports[i].disposeControls();
                  }
              }
          }
<span class="line-removed">- </span>
<span class="line-removed">-         if (Printer.trace) Printer.trace(&quot;&lt;&lt; PortMixer: implClose succeeded&quot;);</span>
      }
  
      @Override
      protected void implStart() {}
      @Override
<span class="line-new-header">--- 158,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 192,11 ***</span>
          case DST_SPEAKER:      return Port.Info.SPEAKER;
          case DST_HEADPHONE:    return Port.Info.HEADPHONE;
          case DST_LINE_OUT:     return Port.Info.LINE_OUT;
          }
          // should never happen...
<span class="line-modified">!         if (Printer.debug) Printer.debug(&quot;unknown port type: &quot;+type);</span>
          return null;
      }
  
      int getMixerIndex() {
          return ((PortMixerProvider.PortMixerInfo) getMixerInfo()).getIndex();
<span class="line-new-header">--- 178,11 ---</span>
          case DST_SPEAKER:      return Port.Info.SPEAKER;
          case DST_HEADPHONE:    return Port.Info.HEADPHONE;
          case DST_LINE_OUT:     return Port.Info.LINE_OUT;
          }
          // should never happen...
<span class="line-modified">!         if (Printer.err) Printer.err(&quot;unknown port type: &quot;+type);</span>
          return null;
      }
  
      int getMixerIndex() {
          return ((PortMixerProvider.PortMixerInfo) getMixerInfo()).getIndex();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 229,16 ***</span>
  
          private PortMixerPort(Port.Info info,
                                PortMixer mixer,
                                int portIndex) {
              super(info, mixer, null);
<span class="line-removed">-             if (Printer.trace) Printer.trace(&quot;PortMixerPort CONSTRUCTOR: info: &quot; + info);</span>
              this.portIndex = portIndex;
          }
  
          void implOpen() throws LineUnavailableException {
<span class="line-removed">-             if (Printer.trace) Printer.trace(&quot;&gt;&gt; PortMixerPort: implOpen().&quot;);</span>
              long newID = ((PortMixer) mixer).getID();
              if ((id == 0) || (newID != id) || (controls.length == 0)) {
                  id = newID;
                  Vector&lt;Control&gt; vector = new Vector&lt;&gt;();
                  synchronized (vector) {
<span class="line-new-header">--- 215,14 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 249,11 ***</span>
                      }
                  }
              } else {
                  enableControls(controls, true);
              }
<span class="line-removed">-             if (Printer.trace) Printer.trace(&quot;&lt;&lt; PortMixerPort: implOpen() succeeded&quot;);</span>
          }
  
          private void enableControls(Control[] controls, boolean enable) {
              for (int i = 0; i &lt; controls.length; i++) {
                  if (controls[i] instanceof BoolCtrl) {
<span class="line-new-header">--- 233,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 272,23 ***</span>
              enableControls(controls, false);
              controls = new Control[0];
          }
  
          void implClose() {
<span class="line-removed">-             if (Printer.trace) Printer.trace(&quot;&gt;&gt; PortMixerPort: implClose()&quot;);</span>
              // get rid of controls
              enableControls(controls, false);
<span class="line-removed">-             if (Printer.trace) Printer.trace(&quot;&lt;&lt; PortMixerPort: implClose() succeeded&quot;);</span>
          }
  
          // this is very similar to open(AudioFormat, int) in AbstractDataLine...
          @Override
          public void open() throws LineUnavailableException {
              synchronized (mixer) {
                  // if the line is not currently open, try to open it with this format and buffer size
                  if (!isOpen()) {
<span class="line-removed">-                     if (Printer.trace) Printer.trace(&quot;&gt; PortMixerPort: open&quot;);</span>
                      // reserve mixer resources for this line
                      mixer.open(this);
                      try {
                          // open the line.  may throw LineUnavailableException.
                          implOpen();
<span class="line-new-header">--- 255,20 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 298,31 ***</span>
                      } catch (LineUnavailableException e) {
                          // release mixer resources for this line and then throw the exception
                          mixer.close(this);
                          throw e;
                      }
<span class="line-removed">-                     if (Printer.trace) Printer.trace(&quot;&lt; PortMixerPort: open succeeded&quot;);</span>
                  }
              }
          }
  
          // this is very similar to close() in AbstractDataLine...
          @Override
          public void close() {
              synchronized (mixer) {
                  if (isOpen()) {
<span class="line-removed">-                     if (Printer.trace) Printer.trace(&quot;&gt; PortMixerPort.close()&quot;);</span>
<span class="line-removed">- </span>
                      // set the open state to false and send events
                      setOpen(false);
  
                      // close resources for this line
                      implClose();
  
                      // release mixer resources for this line
                      mixer.close(this);
<span class="line-removed">-                     if (Printer.trace) Printer.trace(&quot;&lt; PortMixerPort.close() succeeded&quot;);</span>
                  }
              }
          }
  
      } // class PortMixerPort
<span class="line-new-header">--- 278,27 ---</span>
</pre>
<center><a href="Platform.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PortMixerProvider.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>