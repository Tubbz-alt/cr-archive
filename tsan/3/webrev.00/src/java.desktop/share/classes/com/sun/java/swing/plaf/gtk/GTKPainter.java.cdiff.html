<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/classes/com/sun/java/swing/plaf/gtk/GTKPainter.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="GTKLookAndFeel.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="GTKStyle.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/com/sun/java/swing/plaf/gtk/GTKPainter.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 533,10 ***</span>
<span class="line-new-header">--- 533,38 ---</span>
                  shadowType, &quot;menubar&quot;, x, y, w, h);
              ENGINE.finishPainting();
          }
      }
  
<span class="line-added">+     private int getBrightness(Color c) {</span>
<span class="line-added">+         return Math.max(c.getRed(), Math.max(c.getGreen(), c.getBlue()));</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private int getMaxColorDiff(Color c1, Color c2) {</span>
<span class="line-added">+         return Math.max(Math.abs(c1.getRed() - c2.getRed()),</span>
<span class="line-added">+                 Math.max(Math.abs(c1.getGreen() - c2.getGreen()),</span>
<span class="line-added">+                         Math.abs(c1.getBlue() - c2.getBlue())));</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private int scaleColorComponent(int color, double scaleFactor) {</span>
<span class="line-added">+         return (int)(color + color * scaleFactor);</span>
<span class="line-added">+     }</span>
<span class="line-added">+     private Color deriveColor(Color originalColor, int originalBrightness,</span>
<span class="line-added">+                               int targetBrightness) {</span>
<span class="line-added">+         int r, g, b;</span>
<span class="line-added">+         if (originalBrightness == 0) {</span>
<span class="line-added">+             r = g = b = targetBrightness;</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             double scaleFactor = (targetBrightness - originalBrightness)</span>
<span class="line-added">+                     / originalBrightness    ;</span>
<span class="line-added">+             r = scaleColorComponent(originalColor.getRed(), scaleFactor);</span>
<span class="line-added">+             g = scaleColorComponent(originalColor.getGreen(), scaleFactor);</span>
<span class="line-added">+             b = scaleColorComponent(originalColor.getBlue(), scaleFactor);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         return new Color(r, g, b);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      //
      // MENU
      //
      public void paintMenuBackground(SynthContext context,
                                       Graphics g,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 549,10 ***</span>
<span class="line-new-header">--- 577,61 ---</span>
                                       Graphics g,
                                       int x, int y, int w, int h) {
          int gtkState = GTKLookAndFeel.synthStateToGTKState(
                  context.getRegion(), context.getComponentState());
          if (gtkState == SynthConstants.MOUSE_OVER) {
<span class="line-added">+             if (GTKLookAndFeel.is3() &amp;&amp; context.getRegion() == Region.MENU) {</span>
<span class="line-added">+                 GTKStyle style = (GTKStyle)context.getStyle();</span>
<span class="line-added">+                 Color highlightColor = style.getGTKColor(</span>
<span class="line-added">+                         GTKEngine.WidgetType.MENU_ITEM.ordinal(),</span>
<span class="line-added">+                         gtkState, ColorType.BACKGROUND.getID());</span>
<span class="line-added">+                 Color backgroundColor = style.getGTKColor(</span>
<span class="line-added">+                         GTKEngine.WidgetType.MENU_BAR.ordinal(),</span>
<span class="line-added">+                         SynthConstants.ENABLED, ColorType.BACKGROUND.getID());</span>
<span class="line-added">+ </span>
<span class="line-added">+                 int minBrightness = 0, maxBrightness = 255;</span>
<span class="line-added">+                 int minBrightnessDifference = 100;</span>
<span class="line-added">+                 int actualBrightnessDifference =</span>
<span class="line-added">+                         getMaxColorDiff(highlightColor, backgroundColor);</span>
<span class="line-added">+                 if (actualBrightnessDifference &lt; minBrightnessDifference) {</span>
<span class="line-added">+                     int highlightBrightness =</span>
<span class="line-added">+                             getBrightness(highlightColor);</span>
<span class="line-added">+                     int backgroundBrightness =</span>
<span class="line-added">+                             getBrightness(backgroundColor);</span>
<span class="line-added">+                     int originalHighlightBrightness =</span>
<span class="line-added">+                             highlightBrightness;</span>
<span class="line-added">+                     if (highlightBrightness &gt;= backgroundBrightness) {</span>
<span class="line-added">+                         if (backgroundBrightness + minBrightnessDifference &lt;=</span>
<span class="line-added">+                                 maxBrightness) {</span>
<span class="line-added">+                             highlightBrightness =</span>
<span class="line-added">+                                     backgroundBrightness +</span>
<span class="line-added">+                                             minBrightnessDifference;</span>
<span class="line-added">+                         } else {</span>
<span class="line-added">+                             highlightBrightness =</span>
<span class="line-added">+                                     backgroundBrightness -</span>
<span class="line-added">+                                             minBrightnessDifference;</span>
<span class="line-added">+                         }</span>
<span class="line-added">+                     } else {</span>
<span class="line-added">+                         if (backgroundBrightness - minBrightnessDifference &gt;=</span>
<span class="line-added">+                                 minBrightness) {</span>
<span class="line-added">+                             highlightBrightness =</span>
<span class="line-added">+                                     backgroundBrightness -</span>
<span class="line-added">+                                             minBrightnessDifference;</span>
<span class="line-added">+                         } else {</span>
<span class="line-added">+                             highlightBrightness =</span>
<span class="line-added">+                                     backgroundBrightness +</span>
<span class="line-added">+                                             minBrightnessDifference;</span>
<span class="line-added">+                         }</span>
<span class="line-added">+                     }</span>
<span class="line-added">+ </span>
<span class="line-added">+                     g.setColor(deriveColor(highlightColor,</span>
<span class="line-added">+                             originalHighlightBrightness,</span>
<span class="line-added">+                             highlightBrightness));</span>
<span class="line-added">+                     g.fillRect(x, y, w, h);</span>
<span class="line-added">+                     return;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+             }</span>
              Region id = Region.MENU_ITEM;
              synchronized (UNIXToolkit.GTK_LOCK) {
                  if (! ENGINE.paintCachedImage(g, x, y, w, h, id)) {
                      ShadowType shadow = (GTKLookAndFeel.is2_2() ?
                          ShadowType.NONE : ShadowType.OUT);
</pre>
<center><a href="GTKLookAndFeel.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="GTKStyle.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>