<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/classes/javax/swing/JPopupMenu.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="JLayeredPane.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="JRootPane.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/javax/swing/JPopupMenu.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 308         mi.setAction(a);
 309         add(mi);
 310         return mi;
 311     }
 312 
 313     /**
 314      * Returns an point which has been adjusted to take into account of the
 315      * desktop bounds, taskbar and multi-monitor configuration.
 316      * &lt;p&gt;
 317      * This adustment may be cancelled by invoking the application with
 318      * -Djavax.swing.adjustPopupLocationToFit=false
 319      */
 320     Point adjustPopupLocationToFitScreen(int xPosition, int yPosition) {
 321         Point popupLocation = new Point(xPosition, yPosition);
 322 
 323         if(popupPostionFixDisabled == true || GraphicsEnvironment.isHeadless()) {
 324             return popupLocation;
 325         }
 326 
 327         // Get screen bounds
<span class="line-removed"> 328         Rectangle scrBounds;</span>
 329         GraphicsConfiguration gc = getCurrentGraphicsConfiguration(popupLocation);
<span class="line-modified"> 330         Toolkit toolkit = Toolkit.getDefaultToolkit();</span>
<span class="line-removed"> 331         if(gc != null) {</span>
<span class="line-removed"> 332             // If we have GraphicsConfiguration use it to get screen bounds</span>
<span class="line-removed"> 333             scrBounds = gc.getBounds();</span>
<span class="line-removed"> 334         } else {</span>
 335             // If we don&#39;t have GraphicsConfiguration use primary screen
<span class="line-modified"> 336             scrBounds = new Rectangle(toolkit.getScreenSize());</span>

 337         }

 338 
 339         // Calculate the screen size that popup should fit
 340         Dimension popupSize = JPopupMenu.this.getPreferredSize();
 341         long popupRightX = (long)popupLocation.x + (long)popupSize.width;
 342         long popupBottomY = (long)popupLocation.y + (long)popupSize.height;
 343         int scrWidth = scrBounds.width;
 344         int scrHeight = scrBounds.height;
 345 
 346         if (!canPopupOverlapTaskBar()) {
 347             // Insets include the task bar. Take them into account.

 348             Insets scrInsets = toolkit.getScreenInsets(gc);
 349             scrBounds.x += scrInsets.left;
 350             scrBounds.y += scrInsets.top;
 351             scrWidth -= scrInsets.left + scrInsets.right;
 352             scrHeight -= scrInsets.top + scrInsets.bottom;
 353         }
 354         int scrRightX = scrBounds.x + scrWidth;
 355         int scrBottomY = scrBounds.y + scrHeight;
 356 
 357         // Ensure that popup menu fits the screen
 358         if (popupRightX &gt; (long) scrRightX) {
 359             popupLocation.x = scrRightX - popupSize.width;
 360         }
 361 
 362         if (popupBottomY &gt; (long) scrBottomY) {
 363             popupLocation.y = scrBottomY - popupSize.height;
 364         }
 365 
 366         if (popupLocation.x &lt; scrBounds.x) {
 367             popupLocation.x = scrBounds.x;
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 308         mi.setAction(a);
 309         add(mi);
 310         return mi;
 311     }
 312 
 313     /**
 314      * Returns an point which has been adjusted to take into account of the
 315      * desktop bounds, taskbar and multi-monitor configuration.
 316      * &lt;p&gt;
 317      * This adustment may be cancelled by invoking the application with
 318      * -Djavax.swing.adjustPopupLocationToFit=false
 319      */
 320     Point adjustPopupLocationToFitScreen(int xPosition, int yPosition) {
 321         Point popupLocation = new Point(xPosition, yPosition);
 322 
 323         if(popupPostionFixDisabled == true || GraphicsEnvironment.isHeadless()) {
 324             return popupLocation;
 325         }
 326 
 327         // Get screen bounds

 328         GraphicsConfiguration gc = getCurrentGraphicsConfiguration(popupLocation);
<span class="line-modified"> 329         if (gc == null) {</span>




 330             // If we don&#39;t have GraphicsConfiguration use primary screen
<span class="line-modified"> 331             gc = GraphicsEnvironment.getLocalGraphicsEnvironment().</span>
<span class="line-added"> 332                             getDefaultScreenDevice().getDefaultConfiguration();</span>
 333         }
<span class="line-added"> 334         Rectangle scrBounds = gc.getBounds();</span>
 335 
 336         // Calculate the screen size that popup should fit
 337         Dimension popupSize = JPopupMenu.this.getPreferredSize();
 338         long popupRightX = (long)popupLocation.x + (long)popupSize.width;
 339         long popupBottomY = (long)popupLocation.y + (long)popupSize.height;
 340         int scrWidth = scrBounds.width;
 341         int scrHeight = scrBounds.height;
 342 
 343         if (!canPopupOverlapTaskBar()) {
 344             // Insets include the task bar. Take them into account.
<span class="line-added"> 345             Toolkit toolkit = Toolkit.getDefaultToolkit();</span>
 346             Insets scrInsets = toolkit.getScreenInsets(gc);
 347             scrBounds.x += scrInsets.left;
 348             scrBounds.y += scrInsets.top;
 349             scrWidth -= scrInsets.left + scrInsets.right;
 350             scrHeight -= scrInsets.top + scrInsets.bottom;
 351         }
 352         int scrRightX = scrBounds.x + scrWidth;
 353         int scrBottomY = scrBounds.y + scrHeight;
 354 
 355         // Ensure that popup menu fits the screen
 356         if (popupRightX &gt; (long) scrRightX) {
 357             popupLocation.x = scrRightX - popupSize.width;
 358         }
 359 
 360         if (popupBottomY &gt; (long) scrBottomY) {
 361             popupLocation.y = scrBottomY - popupSize.height;
 362         }
 363 
 364         if (popupLocation.x &lt; scrBounds.x) {
 365             popupLocation.x = scrBounds.x;
</pre>
</td>
</tr>
</table>
<center><a href="JLayeredPane.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="JRootPane.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>