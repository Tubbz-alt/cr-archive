<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/classes/javax/swing/text/html/CSS.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../WrappedPlainView.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="FormView.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/javax/swing/text/html/CSS.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
2504         }
2505 
2506         /**
2507          * Returns true if the length represents a percentage of the
2508          * containing box.
2509          */
2510         boolean isPercentage() {
2511             return percentage;
2512         }
2513 
2514         Object parseCssValue(String value) {
2515             LengthValue lv;
2516             try {
2517                 // Assume pixels
2518                 float absolute = Float.valueOf(value).floatValue();
2519                 lv = new LengthValue();
2520                 lv.span = absolute;
2521             } catch (NumberFormatException nfe) {
2522                 // Not pixels, use LengthUnit
2523                 LengthUnit lu = new LengthUnit(value,
<span class="line-modified">2524                                                LengthUnit.UNINITALIZED_LENGTH,</span>
2525                                                0);
2526 
2527                 // PENDING: currently, we only support absolute values and
2528                 // percentages.
2529                 switch (lu.type) {
2530                 case 0:
2531                     // Absolute
2532                     lv = new LengthValue();
2533                     lv.span =
2534                         (mayBeNegative) ? lu.value : Math.max(0, lu.value);
2535                     lv.units = lu.units;
2536                     break;
2537                 case 1:
2538                     // %
2539                     lv = new LengthValue();
2540                     lv.span = Math.max(0, Math.min(1, lu.value));
2541                     lv.percentage = true;
2542                     break;
2543                 default:
2544                     return null;
</pre>
<hr />
<pre>
2838                             if (tmpImg != null) {
2839                                 image.setImage(tmpImg);
2840                             }
2841                         }
2842                     }
2843                 }
2844             }
2845             return image;
2846         }
2847     }
2848 
2849     /**
2850      * Parses a length value, this is used internally, and never added
2851      * to an AttributeSet or returned to the developer.
2852      */
2853     @SuppressWarnings(&quot;serial&quot;) // Same-version serialization only
2854     static class LengthUnit implements Serializable {
2855         static Hashtable&lt;String, Float&gt; lengthMapping = new Hashtable&lt;String, Float&gt;(6);
2856         static Hashtable&lt;String, Float&gt; w3cLengthMapping = new Hashtable&lt;String, Float&gt;(6);
2857         static {
<span class="line-modified">2858             lengthMapping.put(&quot;pt&quot;, Float.valueOf(1f));</span>
<span class="line-modified">2859             // Not sure about 1.3, determined by experiementation.</span>
<span class="line-modified">2860             lengthMapping.put(&quot;px&quot;, Float.valueOf(1.3f));</span>
<span class="line-modified">2861             lengthMapping.put(&quot;mm&quot;, Float.valueOf(2.83464f));</span>
<span class="line-modified">2862             lengthMapping.put(&quot;cm&quot;, Float.valueOf(28.3464f));</span>
<span class="line-modified">2863             lengthMapping.put(&quot;pc&quot;, Float.valueOf(12f));</span>
<span class="line-modified">2864             lengthMapping.put(&quot;in&quot;, Float.valueOf(72f));</span>
2865             int res = 72;
2866             try {
2867                 res = Toolkit.getDefaultToolkit().getScreenResolution();
2868             } catch (HeadlessException e) {
2869             }
2870             // mapping according to the CSS2 spec
<span class="line-modified">2871             w3cLengthMapping.put(&quot;pt&quot;, Float.valueOf(res/72f));</span>
<span class="line-modified">2872             w3cLengthMapping.put(&quot;px&quot;, Float.valueOf(1f));</span>
<span class="line-modified">2873             w3cLengthMapping.put(&quot;mm&quot;, Float.valueOf(res/25.4f));</span>
<span class="line-modified">2874             w3cLengthMapping.put(&quot;cm&quot;, Float.valueOf(res/2.54f));</span>
<span class="line-modified">2875             w3cLengthMapping.put(&quot;pc&quot;, Float.valueOf(res/6f));</span>
<span class="line-modified">2876             w3cLengthMapping.put(&quot;in&quot;, Float.valueOf((float)res));</span>
2877         }
2878 
2879         LengthUnit(String value, short defaultType, float defaultValue) {
2880             parse(value, defaultType, defaultValue);
2881         }
2882 
2883         void parse(String value, short defaultType, float defaultValue) {
2884             type = defaultType;
2885             this.value = defaultValue;
2886 
2887             int length = value.length();
<span class="line-modified">2888             if (length &gt; 0 &amp;&amp; value.charAt(length - 1) == &#39;%&#39;) {</span>



2889                 try {
<span class="line-modified">2890                     this.value = Float.valueOf(value.substring(0, length - 1)).</span>
<span class="line-removed">2891                                                floatValue() / 100.0f;</span>
2892                     type = 1;
2893                 }
2894                 catch (NumberFormatException nfe) { }
2895             }
<span class="line-modified">2896             if (length &gt;= 2) {</span>
2897                 units = value.substring(length - 2, length);
2898                 Float scale = lengthMapping.get(units);
2899                 if (scale != null) {
2900                     try {
<span class="line-modified">2901                         this.value = Float.valueOf(value.substring(0,</span>
<span class="line-removed">2902                                length - 2)).floatValue();</span>
2903                         type = 0;
2904                     }
2905                     catch (NumberFormatException nfe) { }
2906                 }
2907                 else if (units.equals(&quot;em&quot;) ||
2908                          units.equals(&quot;ex&quot;)) {
2909                     try {
<span class="line-modified">2910                         this.value = Float.valueOf(value.substring(0,</span>
<span class="line-removed">2911                                       length - 2)).floatValue();</span>
2912                         type = 3;
2913                     }
2914                     catch (NumberFormatException nfe) { }
2915                 }
2916                 else if (value.equals(&quot;larger&quot;)) {
<span class="line-modified">2917                     this.value = 2f;</span>
2918                     type = 2;
2919                 }
2920                 else if (value.equals(&quot;smaller&quot;)) {
<span class="line-modified">2921                     this.value = -2;</span>
2922                     type = 2;
2923                 }
2924                 else {
2925                     // treat like points.
2926                     try {
<span class="line-modified">2927                         this.value = Float.valueOf(value).floatValue();</span>
2928                         type = 0;
2929                     } catch (NumberFormatException nfe) {}
2930                 }
2931             }
<span class="line-modified">2932             else if (length &gt; 0) {</span>
2933                 // treat like points.
2934                 try {
<span class="line-modified">2935                     this.value = Float.valueOf(value).floatValue();</span>
2936                     type = 0;
2937                 } catch (NumberFormatException nfe) {}
2938             }
2939         }
2940 
2941         float getValue(boolean w3cLengthUnits) {
2942             Hashtable&lt;String, Float&gt; mapping = (w3cLengthUnits) ? w3cLengthMapping : lengthMapping;
2943             float scale = 1;
2944             if (units != null) {
2945                 Float scaleFloat = mapping.get(units);
2946                 if (scaleFloat != null) {
2947                     scale = scaleFloat.floatValue();
2948                 }
2949             }
2950             return this.value * scale;
2951 
2952         }
2953 
2954         static float getValue(float value, String units, Boolean w3cLengthUnits) {
2955             Hashtable&lt;String, Float&gt; mapping = (w3cLengthUnits) ? w3cLengthMapping : lengthMapping;
</pre>
<hr />
<pre>
2961                 }
2962             }
2963             return value * scale;
2964         }
2965 
2966         public String toString() {
2967             return type + &quot; &quot; + value;
2968         }
2969 
2970         // 0 - value indicates real value
2971         // 1 - % value, value relative to depends upon key.
2972         //     50% will have a value = .5
2973         // 2 - add value to parent value.
2974         // 3 - em/ex relative to font size of element (except for
2975         //     font-size, which is relative to parent).
2976         short type;
2977         float value;
2978         String units = null;
2979 
2980 
<span class="line-modified">2981         static final short UNINITALIZED_LENGTH = (short)10;</span>
2982     }
2983 
2984 
2985     /**
2986      * Class used to parse font property. The font property is shorthand
2987      * for the other font properties. This expands the properties, placing
2988      * them in the attributeset.
2989      */
2990     static class ShorthandFontParser {
2991         /**
2992          * Parses the shorthand font string &lt;code&gt;value&lt;/code&gt;, placing the
2993          * result in &lt;code&gt;attr&lt;/code&gt;.
2994          */
2995         static void parseShorthandFont(CSS css, String value,
2996                                        MutableAttributeSet attr) {
2997             // font is of the form:
2998             // [ &lt;font-style&gt; || &lt;font-variant&gt; || &lt;font-weight&gt; ]? &lt;font-size&gt;
2999             //   [ / &lt;line-height&gt; ]? &lt;font-family&gt;
3000             String[]   strings = CSS.parseStrings(value);
3001             int        count = strings.length;
</pre>
</td>
<td>
<hr />
<pre>
2504         }
2505 
2506         /**
2507          * Returns true if the length represents a percentage of the
2508          * containing box.
2509          */
2510         boolean isPercentage() {
2511             return percentage;
2512         }
2513 
2514         Object parseCssValue(String value) {
2515             LengthValue lv;
2516             try {
2517                 // Assume pixels
2518                 float absolute = Float.valueOf(value).floatValue();
2519                 lv = new LengthValue();
2520                 lv.span = absolute;
2521             } catch (NumberFormatException nfe) {
2522                 // Not pixels, use LengthUnit
2523                 LengthUnit lu = new LengthUnit(value,
<span class="line-modified">2524                                                LengthUnit.UNINITIALIZED_LENGTH,</span>
2525                                                0);
2526 
2527                 // PENDING: currently, we only support absolute values and
2528                 // percentages.
2529                 switch (lu.type) {
2530                 case 0:
2531                     // Absolute
2532                     lv = new LengthValue();
2533                     lv.span =
2534                         (mayBeNegative) ? lu.value : Math.max(0, lu.value);
2535                     lv.units = lu.units;
2536                     break;
2537                 case 1:
2538                     // %
2539                     lv = new LengthValue();
2540                     lv.span = Math.max(0, Math.min(1, lu.value));
2541                     lv.percentage = true;
2542                     break;
2543                 default:
2544                     return null;
</pre>
<hr />
<pre>
2838                             if (tmpImg != null) {
2839                                 image.setImage(tmpImg);
2840                             }
2841                         }
2842                     }
2843                 }
2844             }
2845             return image;
2846         }
2847     }
2848 
2849     /**
2850      * Parses a length value, this is used internally, and never added
2851      * to an AttributeSet or returned to the developer.
2852      */
2853     @SuppressWarnings(&quot;serial&quot;) // Same-version serialization only
2854     static class LengthUnit implements Serializable {
2855         static Hashtable&lt;String, Float&gt; lengthMapping = new Hashtable&lt;String, Float&gt;(6);
2856         static Hashtable&lt;String, Float&gt; w3cLengthMapping = new Hashtable&lt;String, Float&gt;(6);
2857         static {
<span class="line-modified">2858             lengthMapping.put(&quot;pt&quot;, 1f);</span>
<span class="line-modified">2859             // Not sure about 1.3, determined by experimentation.</span>
<span class="line-modified">2860             lengthMapping.put(&quot;px&quot;, 1.3f);</span>
<span class="line-modified">2861             lengthMapping.put(&quot;mm&quot;, 2.83464f);</span>
<span class="line-modified">2862             lengthMapping.put(&quot;cm&quot;, 28.3464f);</span>
<span class="line-modified">2863             lengthMapping.put(&quot;pc&quot;, 12f);</span>
<span class="line-modified">2864             lengthMapping.put(&quot;in&quot;, 72f);</span>
2865             int res = 72;
2866             try {
2867                 res = Toolkit.getDefaultToolkit().getScreenResolution();
2868             } catch (HeadlessException e) {
2869             }
2870             // mapping according to the CSS2 spec
<span class="line-modified">2871             w3cLengthMapping.put(&quot;pt&quot;, res / 72f);</span>
<span class="line-modified">2872             w3cLengthMapping.put(&quot;px&quot;, 1f);</span>
<span class="line-modified">2873             w3cLengthMapping.put(&quot;mm&quot;, res / 25.4f);</span>
<span class="line-modified">2874             w3cLengthMapping.put(&quot;cm&quot;, res / 2.54f);</span>
<span class="line-modified">2875             w3cLengthMapping.put(&quot;pc&quot;, res / 6f);</span>
<span class="line-modified">2876             w3cLengthMapping.put(&quot;in&quot;, (float) res);</span>
2877         }
2878 
2879         LengthUnit(String value, short defaultType, float defaultValue) {
2880             parse(value, defaultType, defaultValue);
2881         }
2882 
2883         void parse(String value, short defaultType, float defaultValue) {
2884             type = defaultType;
2885             this.value = defaultValue;
2886 
2887             int length = value.length();
<span class="line-modified">2888             if (length &lt; 1) {</span>
<span class="line-added">2889                 return;</span>
<span class="line-added">2890             }</span>
<span class="line-added">2891             if (value.charAt(length - 1) == &#39;%&#39;) {</span>
2892                 try {
<span class="line-modified">2893                     this.value = Float.parseFloat(value.substring(0, length - 1)) / 100.0f;</span>

2894                     type = 1;
2895                 }
2896                 catch (NumberFormatException nfe) { }
2897             }
<span class="line-modified">2898             else if (length &gt;= 2) {</span>
2899                 units = value.substring(length - 2, length);
2900                 Float scale = lengthMapping.get(units);
2901                 if (scale != null) {
2902                     try {
<span class="line-modified">2903                         this.value = Float.parseFloat(value.substring(0, length - 2));</span>

2904                         type = 0;
2905                     }
2906                     catch (NumberFormatException nfe) { }
2907                 }
2908                 else if (units.equals(&quot;em&quot;) ||
2909                          units.equals(&quot;ex&quot;)) {
2910                     try {
<span class="line-modified">2911                         this.value = Float.parseFloat(value.substring(0, length - 2));</span>

2912                         type = 3;
2913                     }
2914                     catch (NumberFormatException nfe) { }
2915                 }
2916                 else if (value.equals(&quot;larger&quot;)) {
<span class="line-modified">2917                     this.value = 2.f;</span>
2918                     type = 2;
2919                 }
2920                 else if (value.equals(&quot;smaller&quot;)) {
<span class="line-modified">2921                     this.value = -2.f;</span>
2922                     type = 2;
2923                 }
2924                 else {
2925                     // treat like points.
2926                     try {
<span class="line-modified">2927                         this.value = Float.parseFloat(value);</span>
2928                         type = 0;
2929                     } catch (NumberFormatException nfe) {}
2930                 }
2931             }
<span class="line-modified">2932             else {</span>
2933                 // treat like points.
2934                 try {
<span class="line-modified">2935                     this.value = Float.parseFloat(value);</span>
2936                     type = 0;
2937                 } catch (NumberFormatException nfe) {}
2938             }
2939         }
2940 
2941         float getValue(boolean w3cLengthUnits) {
2942             Hashtable&lt;String, Float&gt; mapping = (w3cLengthUnits) ? w3cLengthMapping : lengthMapping;
2943             float scale = 1;
2944             if (units != null) {
2945                 Float scaleFloat = mapping.get(units);
2946                 if (scaleFloat != null) {
2947                     scale = scaleFloat.floatValue();
2948                 }
2949             }
2950             return this.value * scale;
2951 
2952         }
2953 
2954         static float getValue(float value, String units, Boolean w3cLengthUnits) {
2955             Hashtable&lt;String, Float&gt; mapping = (w3cLengthUnits) ? w3cLengthMapping : lengthMapping;
</pre>
<hr />
<pre>
2961                 }
2962             }
2963             return value * scale;
2964         }
2965 
2966         public String toString() {
2967             return type + &quot; &quot; + value;
2968         }
2969 
2970         // 0 - value indicates real value
2971         // 1 - % value, value relative to depends upon key.
2972         //     50% will have a value = .5
2973         // 2 - add value to parent value.
2974         // 3 - em/ex relative to font size of element (except for
2975         //     font-size, which is relative to parent).
2976         short type;
2977         float value;
2978         String units = null;
2979 
2980 
<span class="line-modified">2981         static final short UNINITIALIZED_LENGTH = (short)10;</span>
2982     }
2983 
2984 
2985     /**
2986      * Class used to parse font property. The font property is shorthand
2987      * for the other font properties. This expands the properties, placing
2988      * them in the attributeset.
2989      */
2990     static class ShorthandFontParser {
2991         /**
2992          * Parses the shorthand font string &lt;code&gt;value&lt;/code&gt;, placing the
2993          * result in &lt;code&gt;attr&lt;/code&gt;.
2994          */
2995         static void parseShorthandFont(CSS css, String value,
2996                                        MutableAttributeSet attr) {
2997             // font is of the form:
2998             // [ &lt;font-style&gt; || &lt;font-variant&gt; || &lt;font-weight&gt; ]? &lt;font-size&gt;
2999             //   [ / &lt;line-height&gt; ]? &lt;font-family&gt;
3000             String[]   strings = CSS.parseStrings(value);
3001             int        count = strings.length;
</pre>
</td>
</tr>
</table>
<center><a href="../WrappedPlainView.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="FormView.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>