<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/classes/javax/swing/ToolTipManager.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="Timer.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="UIManager.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/javax/swing/ToolTipManager.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 
 27 package javax.swing;
 28 
 29 import java.awt.event.*;
 30 import java.awt.*;
 31 import java.util.Objects;


 32 
 33 /**
 34  * Manages all the &lt;code&gt;ToolTips&lt;/code&gt; in the system.
 35  * &lt;p&gt;
 36  * ToolTipManager contains numerous properties for configuring how long it
 37  * will take for the tooltips to become visible, and how long till they
 38  * hide. Consider a component that has a different tooltip based on where
 39  * the mouse is, such as JTree. When the mouse moves into the JTree and
 40  * over a region that has a valid tooltip, the tooltip will become
 41  * visible after &lt;code&gt;initialDelay&lt;/code&gt; milliseconds. After
 42  * &lt;code&gt;dismissDelay&lt;/code&gt; milliseconds the tooltip will be hidden. If
 43  * the mouse is over a region that has a valid tooltip, and the tooltip
 44  * is currently visible, when the mouse moves to a region that doesn&#39;t have
 45  * a valid tooltip the tooltip will be hidden. If the mouse then moves back
 46  * into a region that has a valid tooltip within &lt;code&gt;reshowDelay&lt;/code&gt;
 47  * milliseconds, the tooltip will immediately be shown, otherwise the
 48  * tooltip will be shown again after &lt;code&gt;initialDelay&lt;/code&gt; milliseconds.
 49  *
 50  * @see JComponent#createToolTip
 51  * @author Dave Moore
</pre>
<hr />
<pre>
398     }
399 
400     // add keylistener here to trigger tip for access
401     /**
402      * Registers a component for tooltip management.
403      * &lt;p&gt;
404      * This will register key bindings to show and hide the tooltip text
405      * only if &lt;code&gt;component&lt;/code&gt; has focus bindings. This is done
406      * so that components that are not normally focus traversable, such
407      * as &lt;code&gt;JLabel&lt;/code&gt;, are not made focus traversable as a result
408      * of invoking this method.
409      *
410      * @param component  a &lt;code&gt;JComponent&lt;/code&gt; object to add
411      * @see JComponent#isFocusTraversable
412      */
413     public void registerComponent(JComponent component) {
414         component.removeMouseListener(this);
415         component.addMouseListener(this);
416         component.removeMouseMotionListener(moveBeforeEnterListener);
417         component.addMouseMotionListener(moveBeforeEnterListener);
<span class="line-modified">418         component.removeKeyListener(accessibilityKeyListener);</span>
<span class="line-modified">419         component.addKeyListener(accessibilityKeyListener);</span>






420     }
421 
422     /**
423      * Removes a component from tooltip control.
424      *
425      * @param component  a &lt;code&gt;JComponent&lt;/code&gt; object to remove
426      */
427     public void unregisterComponent(JComponent component) {
428         component.removeMouseListener(this);
429         component.removeMouseMotionListener(moveBeforeEnterListener);
<span class="line-modified">430         component.removeKeyListener(accessibilityKeyListener);</span>




431     }
432 
433     // implements java.awt.event.MouseListener
434     /**
435      *  Called when the mouse enters the region of a component.
436      *  This determines whether the tool tip should be shown.
437      *
438      *  @param event  the event in question
439      */
440     public void mouseEntered(MouseEvent event) {
441         initiateToolTip(event);
442     }
443 
444     private void initiateToolTip(MouseEvent event) {
445         if (event.getSource() == window) {
446             return;
447         }
448         JComponent component = (JComponent)event.getSource();
449         component.removeMouseMotionListener(moveBeforeEnterListener);
450 
</pre>
<hr />
<pre>
850                 }
851                 insideComponent.addFocusListener(focusChangeListener);
852             }
853         }
854     }
855 
856     private void hide(JComponent source) {
857         hideTipWindow();
858         source.removeFocusListener(focusChangeListener);
859         preferredLocation = null;
860         insideComponent = null;
861     }
862 
863     /* This listener is registered when the tooltip is first registered
864      * on a component in order to process accessibility keybindings.
865      * This will apply globally across L&amp;F
866      *
867      * Post Tip: Ctrl+F1
868      * Unpost Tip: Esc and Ctrl+F1
869      */
<span class="line-modified">870     private class AccessibilityKeyListener extends KeyAdapter {</span>
871         public void keyPressed(KeyEvent e) {
872             if (!e.isConsumed()) {
873                 JComponent source = (JComponent) e.getComponent();
874                 KeyStroke keyStrokeForEvent = KeyStroke.getKeyStrokeForEvent(e);
875                 if (hideTip.equals(keyStrokeForEvent)) {
876                     if (tipWindow != null) {
877                         hide(source);
878                         e.consume();
879                     }
880                 } else if (postTip.equals(keyStrokeForEvent)) {
881                     // Shown tooltip will be hidden
882                     ToolTipManager.this.show(source);
883                     e.consume();
884                 }
885             }
886         }



























887     }
888 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 
 27 package javax.swing;
 28 
 29 import java.awt.event.*;
 30 import java.awt.*;
 31 import java.util.Objects;
<span class="line-added"> 32 import javax.swing.event.MenuKeyEvent;</span>
<span class="line-added"> 33 import javax.swing.event.MenuKeyListener;</span>
 34 
 35 /**
 36  * Manages all the &lt;code&gt;ToolTips&lt;/code&gt; in the system.
 37  * &lt;p&gt;
 38  * ToolTipManager contains numerous properties for configuring how long it
 39  * will take for the tooltips to become visible, and how long till they
 40  * hide. Consider a component that has a different tooltip based on where
 41  * the mouse is, such as JTree. When the mouse moves into the JTree and
 42  * over a region that has a valid tooltip, the tooltip will become
 43  * visible after &lt;code&gt;initialDelay&lt;/code&gt; milliseconds. After
 44  * &lt;code&gt;dismissDelay&lt;/code&gt; milliseconds the tooltip will be hidden. If
 45  * the mouse is over a region that has a valid tooltip, and the tooltip
 46  * is currently visible, when the mouse moves to a region that doesn&#39;t have
 47  * a valid tooltip the tooltip will be hidden. If the mouse then moves back
 48  * into a region that has a valid tooltip within &lt;code&gt;reshowDelay&lt;/code&gt;
 49  * milliseconds, the tooltip will immediately be shown, otherwise the
 50  * tooltip will be shown again after &lt;code&gt;initialDelay&lt;/code&gt; milliseconds.
 51  *
 52  * @see JComponent#createToolTip
 53  * @author Dave Moore
</pre>
<hr />
<pre>
400     }
401 
402     // add keylistener here to trigger tip for access
403     /**
404      * Registers a component for tooltip management.
405      * &lt;p&gt;
406      * This will register key bindings to show and hide the tooltip text
407      * only if &lt;code&gt;component&lt;/code&gt; has focus bindings. This is done
408      * so that components that are not normally focus traversable, such
409      * as &lt;code&gt;JLabel&lt;/code&gt;, are not made focus traversable as a result
410      * of invoking this method.
411      *
412      * @param component  a &lt;code&gt;JComponent&lt;/code&gt; object to add
413      * @see JComponent#isFocusTraversable
414      */
415     public void registerComponent(JComponent component) {
416         component.removeMouseListener(this);
417         component.addMouseListener(this);
418         component.removeMouseMotionListener(moveBeforeEnterListener);
419         component.addMouseMotionListener(moveBeforeEnterListener);
<span class="line-modified">420         // use MenuKeyListener for menu items/elements</span>
<span class="line-modified">421         if (component instanceof JMenuItem) {</span>
<span class="line-added">422             ((JMenuItem) component).removeMenuKeyListener((MenuKeyListener) accessibilityKeyListener);</span>
<span class="line-added">423             ((JMenuItem) component).addMenuKeyListener((MenuKeyListener) accessibilityKeyListener);</span>
<span class="line-added">424         } else {</span>
<span class="line-added">425             component.removeKeyListener(accessibilityKeyListener);</span>
<span class="line-added">426             component.addKeyListener(accessibilityKeyListener);</span>
<span class="line-added">427         }</span>
428     }
429 
430     /**
431      * Removes a component from tooltip control.
432      *
433      * @param component  a &lt;code&gt;JComponent&lt;/code&gt; object to remove
434      */
435     public void unregisterComponent(JComponent component) {
436         component.removeMouseListener(this);
437         component.removeMouseMotionListener(moveBeforeEnterListener);
<span class="line-modified">438         if (component instanceof JMenuItem) {</span>
<span class="line-added">439             ((JMenuItem) component).removeMenuKeyListener((MenuKeyListener) accessibilityKeyListener);</span>
<span class="line-added">440         } else {</span>
<span class="line-added">441             component.removeKeyListener(accessibilityKeyListener);</span>
<span class="line-added">442         }</span>
443     }
444 
445     // implements java.awt.event.MouseListener
446     /**
447      *  Called when the mouse enters the region of a component.
448      *  This determines whether the tool tip should be shown.
449      *
450      *  @param event  the event in question
451      */
452     public void mouseEntered(MouseEvent event) {
453         initiateToolTip(event);
454     }
455 
456     private void initiateToolTip(MouseEvent event) {
457         if (event.getSource() == window) {
458             return;
459         }
460         JComponent component = (JComponent)event.getSource();
461         component.removeMouseMotionListener(moveBeforeEnterListener);
462 
</pre>
<hr />
<pre>
862                 }
863                 insideComponent.addFocusListener(focusChangeListener);
864             }
865         }
866     }
867 
868     private void hide(JComponent source) {
869         hideTipWindow();
870         source.removeFocusListener(focusChangeListener);
871         preferredLocation = null;
872         insideComponent = null;
873     }
874 
875     /* This listener is registered when the tooltip is first registered
876      * on a component in order to process accessibility keybindings.
877      * This will apply globally across L&amp;F
878      *
879      * Post Tip: Ctrl+F1
880      * Unpost Tip: Esc and Ctrl+F1
881      */
<span class="line-modified">882     private class AccessibilityKeyListener extends KeyAdapter implements MenuKeyListener {</span>
883         public void keyPressed(KeyEvent e) {
884             if (!e.isConsumed()) {
885                 JComponent source = (JComponent) e.getComponent();
886                 KeyStroke keyStrokeForEvent = KeyStroke.getKeyStrokeForEvent(e);
887                 if (hideTip.equals(keyStrokeForEvent)) {
888                     if (tipWindow != null) {
889                         hide(source);
890                         e.consume();
891                     }
892                 } else if (postTip.equals(keyStrokeForEvent)) {
893                     // Shown tooltip will be hidden
894                     ToolTipManager.this.show(source);
895                     e.consume();
896                 }
897             }
898         }
<span class="line-added">899 </span>
<span class="line-added">900         @Override</span>
<span class="line-added">901         public void menuKeyTyped(MenuKeyEvent e) {}</span>
<span class="line-added">902 </span>
<span class="line-added">903         @Override</span>
<span class="line-added">904         public void menuKeyPressed(MenuKeyEvent e) {</span>
<span class="line-added">905             if (postTip.equals(KeyStroke.getKeyStrokeForEvent(e))) {</span>
<span class="line-added">906                 // get element for the event</span>
<span class="line-added">907                 MenuElement path[] = e.getPath();</span>
<span class="line-added">908                 MenuElement element = path[path.length - 1];</span>
<span class="line-added">909 </span>
<span class="line-added">910                 // retrieve currently highlighted element</span>
<span class="line-added">911                 MenuSelectionManager msm = e.getMenuSelectionManager();</span>
<span class="line-added">912                 MenuElement selectedPath[] = msm.getSelectedPath();</span>
<span class="line-added">913                 MenuElement selectedElement = selectedPath[selectedPath.length - 1];</span>
<span class="line-added">914 </span>
<span class="line-added">915                 if (element.equals(selectedElement)) {</span>
<span class="line-added">916                     // show/hide tooltip message</span>
<span class="line-added">917                     JComponent source = (JComponent) element.getComponent();</span>
<span class="line-added">918                     ToolTipManager.this.show(source);</span>
<span class="line-added">919                     e.consume();</span>
<span class="line-added">920                 }</span>
<span class="line-added">921             }</span>
<span class="line-added">922         }</span>
<span class="line-added">923 </span>
<span class="line-added">924         @Override</span>
<span class="line-added">925         public void menuKeyReleased(MenuKeyEvent e) {}</span>
926     }
927 }
</pre>
</td>
</tr>
</table>
<center><a href="Timer.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="UIManager.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>