<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/classes/javax/swing/text/html/ImageView.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="HTMLEditorKit.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../sun/awt/DebugSettings.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/javax/swing/text/html/ImageView.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 24,10 ***</span>
<span class="line-new-header">--- 24,11 ---</span>
   */
  package javax.swing.text.html;
  
  import java.awt.Rectangle;
  import java.awt.Image;
<span class="line-added">+ import java.awt.Dimension;</span>
  import java.awt.Container;
  import java.awt.Color;
  import java.awt.Shape;
  import java.awt.Graphics;
  import java.awt.Toolkit;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 780,10 ***</span>
<span class="line-new-header">--- 781,39 ---</span>
  
              if (newHeight &gt; 0) {
                  newState |= HEIGHT_FLAG;
              }
  
<span class="line-added">+             Image img;</span>
<span class="line-added">+             synchronized(this) {</span>
<span class="line-added">+                 img = image;</span>
<span class="line-added">+             }</span>
<span class="line-added">+             if (newWidth &lt;= 0) {</span>
<span class="line-added">+                 newWidth = img.getWidth(imageObserver);</span>
<span class="line-added">+                 if (newWidth &lt;= 0) {</span>
<span class="line-added">+                     newWidth = DEFAULT_WIDTH;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+             }</span>
<span class="line-added">+             if (newHeight &lt;= 0) {</span>
<span class="line-added">+                 newHeight = img.getHeight(imageObserver);</span>
<span class="line-added">+                 if (newHeight &lt;= 0) {</span>
<span class="line-added">+                     newHeight = DEFAULT_HEIGHT;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+             }</span>
<span class="line-added">+             /*</span>
<span class="line-added">+             If synchronous loading flag is set, then make sure that the image is</span>
<span class="line-added">+             scaled appropriately.</span>
<span class="line-added">+             Otherwise, the ImageHandler::imageUpdate takes care of scaling the image</span>
<span class="line-added">+             appropriately.</span>
<span class="line-added">+             */</span>
<span class="line-added">+             if (getLoadsSynchronously()) {</span>
<span class="line-added">+                 Dimension d = adjustWidthHeight(newWidth, newHeight);</span>
<span class="line-added">+                 newWidth = d.width;</span>
<span class="line-added">+                 newHeight = d.height;</span>
<span class="line-added">+                 newState |= (WIDTH_FLAG | HEIGHT_FLAG);</span>
<span class="line-added">+             }</span>
<span class="line-added">+ </span>
              // Make sure the image starts loading:
              if ((newState &amp; (WIDTH_FLAG | HEIGHT_FLAG)) != 0) {
                  Toolkit.getDefaultToolkit().prepareImage(newImage, newWidth,
                                                           newHeight,
                                                           imageObserver);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 883,10 ***</span>
<span class="line-new-header">--- 913,44 ---</span>
                      }
                  });
          }
      }
  
<span class="line-added">+     private Dimension adjustWidthHeight(int newWidth, int newHeight) {</span>
<span class="line-added">+         Dimension d = new Dimension();</span>
<span class="line-added">+         double proportion = 0.0;</span>
<span class="line-added">+         final int specifiedWidth = getIntAttr(HTML.Attribute.WIDTH, -1);</span>
<span class="line-added">+         final int specifiedHeight = getIntAttr(HTML.Attribute.HEIGHT, -1);</span>
<span class="line-added">+         /**</span>
<span class="line-added">+          * If either of the attributes are not specified, then calculate the</span>
<span class="line-added">+          * proportion for the specified dimension wrt actual value, and then</span>
<span class="line-added">+          * apply the same proportion to the unspecified dimension as well,</span>
<span class="line-added">+          * so that the aspect ratio of the image is maintained.</span>
<span class="line-added">+          */</span>
<span class="line-added">+         if (specifiedWidth != -1 &amp;&amp; specifiedHeight != -1) {</span>
<span class="line-added">+             newWidth = specifiedWidth;</span>
<span class="line-added">+             newHeight = specifiedHeight;</span>
<span class="line-added">+         } else if (specifiedWidth != -1 ^ specifiedHeight != -1) {</span>
<span class="line-added">+             if (specifiedWidth &lt;= 0) {</span>
<span class="line-added">+                 proportion = specifiedHeight / ((double)newHeight);</span>
<span class="line-added">+                 newWidth = (int)(proportion * newWidth);</span>
<span class="line-added">+                 newHeight = specifiedHeight;</span>
<span class="line-added">+             }</span>
<span class="line-added">+ </span>
<span class="line-added">+             if (specifiedHeight &lt;= 0) {</span>
<span class="line-added">+                 proportion = specifiedWidth / ((double)newWidth);</span>
<span class="line-added">+                 newHeight = (int)(proportion * newHeight);</span>
<span class="line-added">+                 newWidth = specifiedWidth;</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         d.width = newWidth;</span>
<span class="line-added">+         d.height = newHeight;</span>
<span class="line-added">+ </span>
<span class="line-added">+         return d;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      /**
       * ImageHandler implements the ImageObserver to correctly update the
       * display as new parts of the image become available.
       */
      private class ImageHandler implements ImageObserver {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 948,31 ***</span>
                   * then figure out if scaling is necessary based on the
                   * specified HTML attributes.
                   */
                  if (((flags &amp; ImageObserver.HEIGHT) != 0) &amp;&amp;
                      ((flags &amp; ImageObserver.WIDTH) != 0)) {
<span class="line-modified">!                     double proportion = 0.0;</span>
<span class="line-modified">!                     final int specifiedWidth = getIntAttr(HTML.Attribute.WIDTH, -1);</span>
<span class="line-modified">!                     final int specifiedHeight = getIntAttr(HTML.Attribute.HEIGHT, -1);</span>
<span class="line-removed">-                     /**</span>
<span class="line-removed">-                      * If either of the attributes are not specified, then calculate the</span>
<span class="line-removed">-                      * proportion for the specified dimension wrt actual value, and then</span>
<span class="line-removed">-                      * apply the same proportion to the unspecified dimension as well,</span>
<span class="line-removed">-                      * so that the aspect ratio of the image is maintained.</span>
<span class="line-removed">-                      */</span>
<span class="line-removed">-                     if (specifiedWidth != -1 ^ specifiedHeight != -1) {</span>
<span class="line-removed">-                         if (specifiedWidth &lt;= 0) {</span>
<span class="line-removed">-                             proportion = specifiedHeight / ((double)newHeight);</span>
<span class="line-removed">-                             newWidth = (int)(proportion * newWidth);</span>
<span class="line-removed">-                         }</span>
<span class="line-removed">- </span>
<span class="line-removed">-                         if (specifiedHeight &lt;= 0) {</span>
<span class="line-removed">-                             proportion = specifiedWidth / ((double)newWidth);</span>
<span class="line-removed">-                             newHeight = (int)(proportion * newHeight);</span>
<span class="line-removed">-                         }</span>
                          changed |= 3;
<span class="line-removed">-                     }</span>
                  }
                  synchronized(ImageView.this) {
                      if ((changed &amp; 1) == 1 &amp;&amp; (state &amp; HEIGHT_FLAG) == 0) {
                          height = newHeight;
                      }
<span class="line-new-header">--- 1012,14 ---</span>
                   * then figure out if scaling is necessary based on the
                   * specified HTML attributes.
                   */
                  if (((flags &amp; ImageObserver.HEIGHT) != 0) &amp;&amp;
                      ((flags &amp; ImageObserver.WIDTH) != 0)) {
<span class="line-modified">!                         Dimension d = adjustWidthHeight(newWidth, newHeight);</span>
<span class="line-modified">!                         newWidth = d.width;</span>
<span class="line-modified">!                         newHeight = d.height;</span>
                          changed |= 3;
                  }
                  synchronized(ImageView.this) {
                      if ((changed &amp; 1) == 1 &amp;&amp; (state &amp; HEIGHT_FLAG) == 0) {
                          height = newHeight;
                      }
</pre>
<center><a href="HTMLEditorKit.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../sun/awt/DebugSettings.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>