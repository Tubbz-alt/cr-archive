<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/java.desktop/share/classes/javax/imageio/metadata/doc-files/jpeg_metadata.html</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
   1 &lt;!doctype html&gt;
   2 &lt;html lang=&quot;en&quot;&gt;
   3 &lt;head&gt;
   4   &lt;meta charset=&quot;utf-8&quot;/&gt;
   5   &lt;title&gt;JPEG Metadata Format Specification and Usage Notes&lt;/title&gt;
   6 &lt;/head&gt;
   7 &lt;!--
   8 Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.
   9 DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  10 
  11 This code is free software; you can redistribute it and/or modify it
  12 under the terms of the GNU General Public License version 2 only, as
  13 published by the Free Software Foundation.  Oracle designates this
  14 particular file as subject to the &quot;Classpath&quot; exception as provided
  15 by Oracle in the LICENSE file that accompanied this code.
  16 
  17 This code is distributed in the hope that it will be useful, but WITHOUT
  18 ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  19 FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  20 version 2 for more details (a copy is included in the LICENSE file that
  21 accompanied this code).
  22 
  23 You should have received a copy of the GNU General Public License version
  24 2 along with this work; if not, write to the Free Software Foundation,
  25 Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  26 
  27 Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  28 or visit www.oracle.com if you need additional information or have any
  29 questions.
  30 --&gt;
  31 
  32 &lt;body&gt;
  33 &lt;main role=&quot;main&quot;&gt;
  34 &lt;div class=&quot;contentContainer&quot;&gt;
  35 &lt;h1&gt;JPEG Metadata Format Specification and Usage Notes&lt;/h1&gt;
  36 
  37 &lt;p&gt;
  38 &lt;a href=#metadata&gt;JPEG Metadata&lt;/a&gt;&lt;br&gt;
  39 &lt;a href=#abbrev&gt;Abbreviated Streams&lt;/a&gt;&lt;br&gt;
  40 &lt;a href=#tables&gt;Sources of Tables&lt;/a&gt;&lt;br&gt;
  41 &lt;a href=#color&gt;Colorspace Transformations and Conventional Markers&lt;/a&gt;&lt;br&gt;
  42 &lt;a href=#thumbs&gt;Thumbnail Images&lt;/a&gt;&lt;br&gt;
  43 &lt;a href=#prog&gt;Progressive Encoding&lt;/a&gt;&lt;br&gt;
  44 &lt;a href=#tree&gt;Native Metadata Format Tree Structure and Editing&lt;/a&gt;&lt;br&gt;
  45 &lt;a href=#image&gt;Image Metadata DTD&lt;/a&gt;&lt;br&gt;
  46 &lt;a href=#stream&gt;Stream Metadata DTD&lt;/a&gt;
  47 &lt;p&gt;
  48 &lt;b&gt;NOTE&lt;/b&gt;: It is important to call &lt;code&gt;dispose()&lt;/code&gt;
  49 on the JPEG reader and writer objects when they are no longer needed, as
  50 they consume significant native resources which are not adequately recovered
  51 by garbage collection.  Both reader and writer call &lt;code&gt;dispose()&lt;/code&gt;
  52 in their finalizers, but those finalizers may not be called before the native
  53 code has exhausted native memory.
  54 
  55 &lt;p&gt;
  56 
  57 The JPEG writer does not support replacing pixels.
  58 
  59 &lt;h2&gt;
  60 &lt;a id=metadata&gt;JPEG Metadata&lt;/a&gt;
  61 &lt;/h2&gt;
  62 JPEG metadata consists of the data contained in marker segments in a JPEG
  63 stream.  The image metadata object returned from a read describes the
  64 contents of the marker segments between the &lt;code&gt;SOI&lt;/code&gt; marker and
  65 the &lt;code&gt;EOI&lt;/code&gt; marker for that image.  The image metadata object
  66 passed into a write determines the contents of the stream between the
  67 &lt;code&gt;SOI&lt;/code&gt; marker and the &lt;code&gt;EOI&lt;/code&gt; marker for that image,
  68 subject to the controls in any &lt;code&gt;ImageWriteParam&lt;/code&gt;.
  69 
  70 &lt;p&gt;
  71 Stream metadata is used only for tables-only images found (or to be
  72 placed) at the beginning of a stream containing abbreviated images.
  73 Tables-only images are not treated as images and do not consume an
  74 image index.  The stream metadata object returned from a read describes the
  75 contents of the marker segments between the &lt;code&gt;SOI&lt;/code&gt; marker and
  76 the &lt;code&gt;EOI&lt;/code&gt; marker for the single tables-only image at the
  77 beginning of the stream, if one is present.  If no tables-only image is
  78 present at the front of the stream, the &lt;code&gt;getStreamMetadata&lt;/code&gt;
  79 method of &lt;code&gt;ImageReader&lt;/code&gt; returns &lt;code&gt;null&lt;/code&gt;.  If
  80 stream metadata is provided to the writer, a single tables-only image
  81 containing the tables from the stream metadata object will be written at
  82 the beginning of the stream.  If the stream metadata object contains no
  83 tables, default tables will be written.  As the sole purpose of stream
  84 metadata is for specifying tables-only images at the front of abbreviated
  85 streams, the stream metadata argument is useful only on the
  86 &lt;code&gt;ImageWriter.prepareWriteSequence&lt;/code&gt; method.  It is ignored on all
  87 other methods.
  88 
  89 &lt;p&gt;
  90 The &lt;code&gt;ImageWriter.getDefaultStreamMetadata&lt;/code&gt; method returns an
  91 object containing the tables from the &lt;code&gt;ImageWriteParam&lt;/code&gt; argument,
  92 if it is a &lt;code&gt;JPEGImageWriteParam&lt;/code&gt; and contains tables.  Otherwise,
  93 the returned object will contain default tables.
  94 
  95 &lt;p&gt;The &lt;code&gt;ImageWriter.getDefaultImageMetadata&lt;/code&gt; method returns a
  96 metadata object containing &lt;b&gt;no&lt;/b&gt; tables if the
  97 &lt;code&gt;ImageWriteParam&lt;/code&gt; argument contains tables.  Otherwise the
  98 returned metadata object will contain default visually lossless tables.
  99 Of course, only a &lt;code&gt;JPEGImageWriteParam&lt;/code&gt; may contain tables.
 100 
 101 &lt;p&gt;
 102 If &lt;code&gt;ignoreMetadata&lt;/code&gt; is set to &lt;code&gt;true&lt;/code&gt; when the input
 103 is set on the reader, stream metadata will not be available, but image
 104 metadata will.
 105 
 106 &lt;h2&gt;
 107 &lt;a id=abbrev&gt;Abbreviated Streams&lt;/a&gt;
 108 &lt;/h2&gt;
 109 Both the reader and the writer retain their tables from one operation to the
 110 next, thus permitting the use of abbreviated streams quite naturally, with a
 111 few minor restrictions:
 112 &lt;ol&gt;
 113   &lt;li&gt; Abbreviated streams may contain only one tables-only image, which must
 114        come first in the stream.  Subsequent tables-only images will cause
 115        undefined behavior.&lt;/li&gt;
 116   &lt;li&gt; Abbreviated streams must be read fully and in order.  No random access
 117        is allowed, in either direction.  The same image may be read multiple
 118        times.  If a call is made with an image index that is not the same as
 119        or one greater than the most recent call (or 0 if no calls have been
 120        made), then an &lt;code&gt;IllegalArgumentException&lt;/code&gt; is thrown.&lt;/li&gt;
 121 &lt;/ol&gt;
 122 These restrictions mean that streams may contain abbreviated images
 123 interspersed with images containing tables.  As required by JPEG, any tables
 124 appearing in the stream override previous tables, regardless of the source
 125 of the previous tables.
 126 
 127 &lt;p&gt;
 128 Note that once a tables-only image has been read, it&#39;s contents is available
 129 as stream metadata from the reader until either another tables-only image
 130 is read from another stream or the reader is reset.  Changing the input does
 131 not reset the stream metadata.  This is useful for reading the tables from
 132 one file, then changing the input to read an abbreviated stream containing
 133 a sequence of images.  The tables will be used automatically, and will remain
 134 available as &quot;stream&quot; metadata.
 135 
 136 &lt;p&gt;
 137 Abbreviated streams are written using the sequence methods of
 138 &lt;code&gt;ImageWriter&lt;/code&gt;.  Stream metadata is used to write a tables-only
 139 image at the beginning of the stream, and the tables are set up for use, using
 140 &lt;code&gt;ImageWriter.prepareWriteSequence&lt;/code&gt;.  If no stream metadata is
 141 supplied to &lt;code&gt;ImageWriter.prepareWriteSequence&lt;/code&gt;, then no
 142 tables-only image is written.  If stream metadata containing no tables is
 143 supplied to &lt;code&gt;ImageWriter.prepareWriteSequence&lt;/code&gt;, then a tables-only
 144 image containing default visually lossless tables is written.
 145 
 146 &lt;h2&gt;
 147 &lt;a id=tables&gt;Sources of Tables&lt;/a&gt;
 148 &lt;/h2&gt;
 149 &lt;p&gt;
 150 Images are written with tables if tables are present in their metadata objects
 151 or without them if no tables are present in their metadata objects.  If no
 152 metadata object is present then the tables are written.  The tables used for
 153 compression are taken from one of the following sources, which are consulted
 154 in order:
 155 &lt;ol&gt;
 156   &lt;li&gt; If there is an &lt;code&gt;ImageWriteParam&lt;/code&gt; and the compression mode is
 157        set to &lt;code&gt;EXPLICIT&lt;/code&gt;, default tables constructed using the
 158        quality setting are used.  They are written only if the metadata
 159        contains tables or if there is no metadata, but they replace the
 160        tables in the metadata.&lt;/li&gt;
 161   &lt;li&gt; If there is an &lt;code&gt;ImageWriteParam&lt;/code&gt; and the compression mode is
 162        set to &lt;code&gt;DEFAULT&lt;/code&gt;, default visually lossles tables are used.
 163        They are written only if the metadata contains tables or if
 164        there is no metadata, but they replace the tables in the
 165        metadata.&lt;/li&gt;
 166   &lt;li&gt; Otherwise the compression mode on the &lt;code&gt;ImageWriteParam&lt;/code&gt; must
 167        be MODE_COPY_FROM_&lt;code&gt;METADATA&lt;/code&gt;, in which case the following
 168        are used:
 169     &lt;ol&gt;
 170       &lt;li&gt; the tables in the image metadata, if present&lt;/li&gt;
 171       &lt;li&gt; the tables in the stream metadata, if present&lt;/li&gt;
 172       &lt;li&gt; the tables in the &lt;code&gt;JPEGImageWriteParam&lt;/code&gt;, if present&lt;/li&gt;
 173       &lt;li&gt; default visually lossless tables&lt;/li&gt;
 174     &lt;/ol&gt; Tables are written only if they are taken from image metadata.
 175   &lt;/li&gt;
 176 &lt;/ol&gt;
 177 
 178 This ordering implements the design intention that tables should be included
 179 in &lt;code&gt;JPEGImageWriteParam&lt;/code&gt;s only as a means of specifying tables
 180 when no other source is available, and this can occur only when writing to an
 181 abbreviated stream without tables using known non-standard tables for
 182 compression.
 183 
 184 &lt;p&gt;
 185 When reading, tables in a &lt;code&gt;JPEGImageReadParam&lt;/code&gt; are consulted only
 186 if tables have not been set by any previous read.  Tables set from a
 187 &lt;code&gt;JPEGImageReadParam&lt;/code&gt; are overridden by any tables present in the
 188 stream being read.
 189 
 190 &lt;p&gt;
 191 Note that if no image metadata object is specified for a particular image, a
 192 default object is used, which includes default tables.
 193 
 194 &lt;h2&gt;
 195 &lt;a id=color&gt;Colorspace Transformations and Conventional Markers&lt;/a&gt;
 196 &lt;/h2&gt;
 197 Colorspace transformations are controlled by the destination type for
 198 both reading and writing of images.  When &lt;code&gt;Raster&lt;/code&gt;s are
 199 read, no colorspace transformation is performed, and any destination type
 200 is ignored.  A warning is sent to any listeners if a destination type is
 201 specified in this case.  When &lt;code&gt;Raster&lt;/code&gt;s are written, any
 202 destination type is used to interpret the bands.  This might result in a
 203 JFIF or Adobe header being written, or different component ids being written
 204 to the frame and scan headers.  If values present in a metadata object do not
 205 match the destination type, the destination type is used and a warning is sent
 206 to any listeners.
 207 
 208 &lt;p&gt;
 209 
 210 &lt;a id=optcolor&gt;&lt;b&gt;Optional ColorSpace support:&lt;/b&gt;&lt;/a&gt;
 211 Handling of PhotoYCC (YCC), PhotoYCCA (YCCA), RGBA and YCbCrA color spaces
 212 by the standard plugin, as described below, is dependent on capabilities
 213 of the libraries used to interpret the JPEG data. Thus all consequential
 214 behaviors are optional. If the support is not available when decoding,
 215 the color space will be treated as unrecognized and the appropriate
 216 default color space for the specified number of component channels
 217 may be used.
 218 When writing, an Exception may be thrown if no suitable conversion
 219 can be applied before encoding.
 220 But where the support for these color spaces is available, the behavior
 221 must be as documented.
 222 &lt;p&gt;
 223 
 224 When reading, the contents of the stream are interpreted by the usual
 225 JPEG conventions, as follows:
 226 
 227 &lt;ul&gt;
 228   &lt;li&gt; If a JFIF &lt;code&gt;APP0&lt;/code&gt; marker segment is present, the colorspace
 229        is known to be either grayscale or YCbCr.  If an &lt;code&gt;APP2&lt;/code&gt;
 230        marker segment containing an embedded ICC profile is also present, then
 231        the YCbCr is converted to RGB according to the formulas given in the
 232        JFIF spec, and the ICC profile is assumed to refer to the resulting RGB
 233        space.
 234   &lt;li&gt; If an Adobe &lt;code&gt;APP14&lt;/code&gt; marker segment is present, the
 235        colorspace is determined by consulting the &lt;code&gt;transform&lt;/code&gt; flag.
 236        The &lt;code&gt;transform&lt;/code&gt; flag takes one of three values:
 237     &lt;ul&gt;
 238       &lt;li&gt; 2 - The image is encoded as YCCK (implicitly converted from
 239            CMYK on encoding).
 240 
 241       &lt;li&gt; 1 - The image is encoded as YCbCr (implicitly converted from RGB
 242            on encoding).
 243 
 244       &lt;li&gt; 0 - Unknown.  3-channel images are assumed to be RGB, 4-channel
 245            images are assumed to be CMYK.
 246     &lt;/ul&gt;
 247   &lt;li&gt; If neither marker segment is present, the following procedure is
 248        followed: Single-channel images are assumed to be grayscale, and
 249        2-channel images are assumed to be grayscale with an alpha channel.
 250        For 3- and 4-channel images, the component ids are consulted.  If these
 251        values are 1-3 for a 3-channel image, then the image is assumed to be
 252        YCbCr. Subject to the availability of the
 253        &lt;a href=#optcolor&gt;optional color space support&lt;/a&gt;
 254        described above, if these values are 1-4 for a 4-channel image,
 255        then the image is assumed to be YCbCrA.
 256        If these values are &gt; 4, they are checked
 257        against the ASCII codes for &#39;R&#39;, &#39;G&#39;, &#39;B&#39;, &#39;A&#39;, &#39;C&#39;, &#39;c&#39;.  These can
 258        encode the following colorspaces:
 259        &lt;p&gt;
 260        &lt;br&gt;RGB
 261        &lt;br&gt;RGBA
 262        &lt;br&gt;YCC (as &#39;Y&#39;,&#39;C&#39;,&#39;c&#39;), assumed to be PhotoYCC
 263        &lt;br&gt;YCCA (as &#39;Y&#39;,&#39;C&#39;,&#39;c&#39;,&#39;A&#39;), assumed to be PhotoYCCA
 264        &lt;p&gt;
 265        Otherwise, 3-channel subsampled images are assumed to be YCbCr,
 266        3-channel non-subsampled images are assumed to be RGB, 4-channel
 267        subsampled images are assumed to be YCCK, and 4-channel, non-subsampled
 268        images are assumed to be CMYK.
 269 
 270   &lt;li&gt; All other images are declared uninterpretable and an exception is
 271        thrown if an attempt is made to read one as a
 272        &lt;code&gt;BufferedImage&lt;/code&gt;.  Such an image may be read only as a
 273        &lt;code&gt;Raster&lt;/code&gt;.  If an image is interpretable but there is no Java
 274        &lt;code&gt;ColorSpace&lt;/code&gt; available corresponding to the encoded
 275        colorspace (&lt;i&gt;e.g.&lt;/i&gt; YCbCr), then
 276        &lt;code&gt;ImageReader.getRawImageType&lt;/code&gt; will return &lt;code&gt;null&lt;/code&gt;.
 277 &lt;/ul&gt;
 278 
 279 Once an encoded colorspace is determined, then the target colorspace is
 280 determined as follows:
 281 
 282 &lt;ul&gt;
 283   &lt;li&gt; If a destination type is not set, then the following default
 284        transformations take place after upsampling: YCbCr (and YCbCrA) images
 285        are converted to RGB (and RGBA) using the conversion provided by the
 286        underlying IJG library and either the built-in sRGB
 287        &lt;code&gt;ColorSpace&lt;/code&gt; or a custom RGB &lt;code&gt;ColorSpace&lt;/code&gt; object
 288        based on an embedded ICC profile is used to create the output
 289        &lt;code&gt;ColorModel&lt;/code&gt;.  PhotoYCC and PhotoYCCA images are not
 290        converted.  CMYK and YCCK images are currently not supported.&lt;/li&gt;
 291 
 292   &lt;li&gt; If a destination image or type is set, it is used as follows:
 293        If the IJG library provides an appropriate conversion, it is used.
 294        Otherwise the default library conversion is followed by a colorspace
 295        conversion in Java.&lt;/li&gt;
 296 
 297   &lt;li&gt; Bands are selected AFTER any library colorspace conversion.  If a
 298        subset of either source or destination bands is used, then the default
 299        library conversions are used with no further conversion in Java,
 300        regardless of any destination type.&lt;/li&gt;
 301 
 302   &lt;li&gt; An exception is thrown if an attempt is made to read an image in an
 303        unsupported jpeg colorspace as a &lt;code&gt;BufferedImage&lt;/code&gt;
 304        (&lt;i&gt;e.g.&lt;/i&gt; CMYK).  Such images may be read as
 305        &lt;code&gt;Raster&lt;/code&gt;s.  If an image colorspace is unsupported or
 306        uninterpretable, then &lt;code&gt;ImageReader.getImageTypes&lt;/code&gt; will
 307        return an empty &lt;code&gt;Iterator&lt;/code&gt;.   If a subset of the raw bands
 308        are required, a &lt;code&gt;Raster&lt;/code&gt; must be obtained first and the
 309        bands obtained from that. &lt;/li&gt;
 310 &lt;/ul&gt;
 311 
 312 &lt;p&gt;
 313 For writing, the color transformation to apply is determined as
 314 follows:
 315 
 316 &lt;p&gt;
 317 If a subset of the source bands is to be written, no color conversion is
 318 performed.  Any destination, if set, must match the number of bands that will
 319 be written, and serves as an interpretation of the selected bands, rather than
 320 a conversion request.  This behavior is identical to that for
 321 &lt;code&gt;Raster&lt;/code&gt;s.  If all the bands are to be written and an image
 322 (as opposed to a &lt;code&gt;Raster&lt;/code&gt;) is being written, any destination type
 323 is ignored and a warning is sent to any listeners.
 324 
 325 &lt;p&gt;
 326 If a destination type is used and any aspect of the metadata object, if there
 327 is one, is not compatible with that type, the destination type is used, the
 328 metadata written is modified from that provided, and a warning is sent to
 329 listeners.  This includes the &lt;code&gt;app0JFIF&lt;/code&gt; and
 330 &lt;code&gt;app14Adobe&lt;/code&gt; nodes.  The component ids in the &lt;code&gt;sof&lt;/code&gt; and
 331 &lt;code&gt;sos&lt;/code&gt; nodes are not modified, however, as unless a
 332 &lt;code&gt;app0JFIF&lt;/code&gt; node is present, any values may be used.
 333 &lt;p&gt;
 334 
 335 When a full image is written, a destination colorspace will be
 336 chosen based on the image contents and the metadata settings, according to
 337 the following algorithm:
 338 
 339 &lt;p&gt;
 340 
 341 If no metadata object is specified, then the following defaults apply:
 342 
 343 &lt;ul&gt;
 344   &lt;li&gt; Grayscale images are written with a JFIF &lt;code&gt;APP0&lt;/code&gt; marker
 345        segment.  Grayscale images with alpha are written with no special
 346        marker.  As required by JFIF, the component ids in the frame and
 347        scan header is set to 1.
 348 
 349   &lt;li&gt; RGB images are converted to YCbCr, subsampled in the chrominance
 350        channels by half both vertically and horizontally, and written with a
 351        JFIF &lt;code&gt;APP0&lt;/code&gt; marker segment.  If the &lt;code&gt;ColorSpace&lt;/code&gt;
 352        of the image is based on an &lt;code&gt;ICCProfile&lt;/code&gt; (it is an instance
 353        of &lt;code&gt;ICC_ColorSpace&lt;/code&gt;, but is not one of the standard built-in
 354        &lt;code&gt;ColorSpaces&lt;/code&gt;), then that profile is embedded in an
 355        &lt;code&gt;APP2&lt;/code&gt; marker segment.  As required by JFIF, the
 356        component ids in the frame and scan headers are set to 1, 2, and 3.
 357 
 358 
 359   &lt;li&gt; Subject to the &lt;a href=#optcolor&gt;optional library support&lt;/a&gt;
 360         described above,
 361        RGBA images are converted to YCbCrA, subsampled in the
 362        chrominance channels by half both vertically and horizontally, and
 363        written without any special marker segments.  The component ids
 364        in the frame and scan headers are set to 1, 2, 3, and 4.
 365 
 366   &lt;li&gt; Subject to the &lt;a href=#optcolor&gt;optional library support&lt;/a&gt;
 367        described above,
 368        PhotoYCC and YCCAimages are subsampled by half in the chrominance
 369        channels both vertically and horizontally and written with an
 370        Adobe &lt;code&gt;APP14&lt;/code&gt; marker segment and &#39;Y&#39;,&#39;C&#39;, and &#39;c&#39; (and
 371        &#39;A&#39; if an alpha channel is present) as component ids in the frame
 372         and scan headers.
 373 &lt;/ul&gt;
 374 
 375 Default metadata objects for these image types will reflect these settings.
 376 
 377 &lt;p&gt;
 378 
 379 If a metadata object is specified, then the number of channels in the
 380 frame and scan headers must always match the number of bands to be
 381 written, or an exception is thrown.  &lt;code&gt;app0JFIF&lt;/code&gt; and
 382 &lt;code&gt;app14Adobe&lt;/code&gt; nodes may appear in the same metadata object only
 383 if the &lt;code&gt;app14Adobe&lt;/code&gt; node indicates YCbCr, and the component ids
 384 are JFIF compatible (0-2).  The various image types are processed in the
 385 following ways:
 386 
 387 &lt;br&gt;
 388 
 389 (All multi-channel images are subsampled according to the sampling factors
 390 in the frame header node of the metadata object, regardless of color space.)
 391 
 392 &lt;ul&gt;
 393   &lt;li&gt; Grayscale Images:
 394     &lt;ul&gt;
 395       &lt;li&gt; If an &lt;code&gt;app0JFIF&lt;/code&gt; node is present in the metadata object,
 396            a JFIF &lt;code&gt;APP0&lt;/code&gt; marker segment is written.
 397       &lt;li&gt; If an &lt;code&gt;app14Adobe&lt;/code&gt; node is present in the metadata
 398            object, it is checked for validity (&lt;code&gt;transform&lt;/code&gt; must be
 399            &lt;code&gt;UNKNOWN&lt;/code&gt;) and written.
 400       &lt;li&gt; If neither node is present in the metadata object, no special
 401            marker segment is written.
 402     &lt;/ul&gt;
 403 
 404   &lt;li&gt; Grayscale Images with an Alpha Channel:
 405     &lt;ul&gt;
 406       &lt;li&gt; If an &lt;code&gt;app0JFIF&lt;/code&gt; node is present in the metadata object,
 407            it is ignored and a warning is sent to listeners, as JFIF does not
 408            support 2-channel images.
 409       &lt;li&gt; If an &lt;code&gt;app14Adobe&lt;/code&gt; node is present in the metadata
 410            object, it is checked for validity (&lt;code&gt;transform&lt;/code&gt; must be
 411            &lt;code&gt;UNKNOWN&lt;/code&gt;) and written.  If &lt;code&gt;transform&lt;/code&gt; is
 412            not &lt;code&gt;UNKNOWN&lt;/code&gt;, a warning is sent to listeners and the
 413            correct transform is written.
 414       &lt;li&gt; If neither node is present in the metadata object, no special
 415            marker segment is written.
 416     &lt;/ul&gt;
 417 
 418   &lt;li&gt; RGB Images:
 419     &lt;ul&gt;
 420       &lt;li&gt; If an &lt;code&gt;app0JFIF&lt;/code&gt; node is present in the metadata object,
 421            the image is converted to YCbCr and written with a JFIF
 422            &lt;code&gt;APP0&lt;/code&gt; marker segment.  If the &lt;code&gt;ColorSpace&lt;/code&gt;
 423            of the image is based on a non-standard ICC Profile, then that
 424            profile is embedded in an &lt;code&gt;APP2&lt;/code&gt; marker segment.  If the
 425            &lt;code&gt;ColorSpace&lt;/code&gt; is not based on a non-standard ICC Profile,
 426            but an &lt;code&gt;app2ICC&lt;/code&gt; node appears in the metadata, then an
 427            &lt;code&gt;APP2&lt;/code&gt; marker segment is written with the appropriate
 428            standard profile.  Note that the profile must specify an RGB color
 429            space, as the file must be JFIF compliant.
 430 
 431       &lt;li&gt; If an &lt;code&gt;app14Adobe&lt;/code&gt; node is present in the metadata
 432            object, the image is converted according to the color transform
 433            setting and written with an Adobe &lt;code&gt;APP14&lt;/code&gt; marker
 434            segment.  Component ids are written just as they appear in the
 435            frame and scan headers.  The color transform must be either YCbCr
 436            or &lt;code&gt;UNKNOWN&lt;/code&gt;.  If it is &lt;code&gt;UNKNOWN&lt;/code&gt;, the image
 437            is not color converted.
 438 
 439       &lt;li&gt; If neither node is present, the component ids in the frame
 440            header are consulted.  If these indicate a colorspace as described
 441            above, then the image is converted to that colorspace if possible.
 442            If the component ids do not indicate a colorspace, then the
 443            sampling factors are consulted.  If the image is to be subsampled,
 444            it is converted to YCbCr first.  If the image is not to be
 445            subsampled, then no conversion is applied.  No special marker
 446            segmentss are written.
 447     &lt;/ul&gt;
 448 
 449   &lt;li&gt; RGBA images:
 450        Subject to the &lt;a href=#optcolor&gt;optional library support&lt;/a&gt;
 451        described above,
 452     &lt;ul&gt;
 453       &lt;li&gt; If an &lt;code&gt;app0JFIF&lt;/code&gt; node is present in the metadata object,
 454            it is ignored and a warning is sent to listeners, as JFIF does not
 455            support 4-channel images.
 456 
 457       &lt;li&gt; If an &lt;code&gt;app14Adobe&lt;/code&gt; node is present in the metadata
 458            object, the image is written with an Adobe &lt;code&gt;APP14&lt;/code&gt; marker
 459            segment.  No colorspace conversion is performed.  Component ids
 460            are written just as they appear in the frame and scan  headers.
 461            The color transform must be &lt;code&gt;UNKNOWN&lt;/code&gt;.  If it is
 462            not, a warning is sent to listeners.
 463 
 464       &lt;li&gt; If no &lt;code&gt;app14Adobe&lt;/code&gt; node is present, the component ids in
 465            the frame header are consulted.  If these indicate a colorspace as
 466            described above, then the image is converted to that colorspace if
 467            possible.  If the component ids do not indicate a colorspace, then
 468            the sampling factors are consulted.  If the image is to be
 469            subsampled, it is converted to YCbCrA.  If the image is not to be
 470            subsampled, then no conversion is applied.  No special marker
 471            segments are written.
 472     &lt;/ul&gt;
 473 
 474   &lt;li&gt; PhotoYCC Images:
 475        Subject to the &lt;a href=#optcolor&gt;optional library support&lt;/a&gt;
 476        described above,
 477     &lt;ul&gt;
 478       &lt;li&gt; If an &lt;code&gt;app0JFIF&lt;/code&gt; node is present in the metadata object,
 479            the image is converted to sRGB, and then to YCbCr during encoding,
 480            and a JFIF &lt;code&gt;APP0&lt;/code&gt; marker segment is written.
 481 
 482       &lt;li&gt; If an &lt;code&gt;app14Adobe&lt;/code&gt; node is present in the metadata
 483            object, no conversion is applied, and an Adobe &lt;code&gt;APP14&lt;/code&gt;
 484            marker segment is written.  The color transform must be YCC.  If it
 485            is not, a warning is sent to listeners.
 486 
 487       &lt;li&gt; If neither node is present in the metadata object, no conversion
 488            is applied, and no special marker segment is written.
 489     &lt;/ul&gt;
 490 
 491   &lt;li&gt; PhotoYCCA Images:
 492        Subject to the &lt;a href=#optcolor&gt;optional library support&lt;/a&gt;
 493        described above,
 494     &lt;ul&gt;
 495       &lt;li&gt; If an &lt;code&gt;app0JFIF&lt;/code&gt; node is present in the metadata object,
 496            it is ignored and a warning is sent to listeners, as JFIF does not
 497            support 4-channel images.
 498 
 499       &lt;li&gt; If an &lt;code&gt;app14Adobe&lt;/code&gt; node is present in the metadata
 500            object, no conversion is applied, and an Adobe &lt;code&gt;APP14&lt;/code&gt;
 501            marker segment is written.  The color transform must be
 502            &lt;code&gt;UNKNOWN&lt;/code&gt;.  If it is not, a warning is sent to
 503            listeners.
 504 
 505       &lt;li&gt; If neither node is present in the metadata object, no conversion
 506            is applied, and no special marker segment is written.
 507     &lt;/ul&gt;
 508 &lt;/ul&gt;
 509 
 510 &lt;h2&gt;
 511 &lt;a id=thumbs&gt;Thumbnail Images&lt;/a&gt;
 512 &lt;/h2&gt;
 513 Thumbnails are supported by the use of JFIF and JFIF extension marker segments.
 514 Thumbnails provided on the write methods determine the thumbnails that will be
 515 included.  &lt;code&gt;app0JFIF&lt;/code&gt; and &lt;code&gt;app0JFXX&lt;/code&gt; nodes present in
 516 the metadata do not contain any thumbnail pixel data.  However, the kinds of
 517 thumbnails written depend on the contents of the metadata object, as follows.
 518 Any thumbnail which is to be written as an indexed or RGB image and which is
 519 larger than 255 by 255 will be clipped, not scaled, to 255 by 255.  Thumbnails
 520 written as JPEG images may be any size.  A warning is sent to any listeners
 521 whenever a thumbnail is clipped.
 522 &lt;ul&gt;
 523   &lt;li&gt; If there is a single thumbnail, it is processed as follows:
 524     &lt;ul&gt;
 525       &lt;li&gt; If the thumbnail image is an RGB palette image, it is processed as
 526            follows:
 527         &lt;ul&gt;
 528           &lt;li&gt; If no &lt;code&gt;app0JFXX&lt;/code&gt; node is present in the metadata, or
 529                the first &lt;code&gt;app0JFXX&lt;/code&gt; node present in the metadata
 530                contains a &lt;code&gt;JFIFthumbPalette&lt;/code&gt; element, a
 531                palette thumbnail is written in a JFXX &lt;code&gt;APP0&lt;/code&gt; marker
 532                segment.
 533           &lt;li&gt; If the first &lt;code&gt;app0JFXX&lt;/code&gt; node present in the metadata
 534                contains another thumbnail form (RGB or JPEG), the palette
 535                image is expanded to RGB and the indicated thumbnail form is
 536                written.
 537         &lt;/ul&gt;
 538 
 539       &lt;li&gt; If the thumbnail image is an RGB image, it is processed as follows:
 540         &lt;ul&gt;
 541           &lt;li&gt; If no &lt;code&gt;app0JFXX&lt;/code&gt; node is present in the metadata,
 542                the thumbnail is written as part of the JFIF &lt;code&gt;APP0&lt;/code&gt;
 543                marker segment.
 544           &lt;li&gt; If the first &lt;code&gt;app0JFXX&lt;/code&gt; node present in the metadata
 545                contains a &lt;code&gt;JFIFthumbRGB&lt;/code&gt; element, an
 546                RGB thumbnail is written in a JFXX &lt;code&gt;APP0&lt;/code&gt; marker
 547                segment.
 548           &lt;li&gt; If the first &lt;code&gt;app0JFXX&lt;/code&gt; node present in the metadata
 549                contains a &lt;code&gt;JFIFthumbJPEG&lt;/code&gt; element, a
 550                JPEG thumbnail is written in a JFXX &lt;code&gt;APP0&lt;/code&gt; marker
 551                segment.
 552           &lt;li&gt; If the first &lt;code&gt;app0JFXX&lt;/code&gt; node present in the metadata
 553                contains a &lt;code&gt;JFIFthumbPalette&lt;/code&gt; element, an
 554                RGB thumbnail is written in a JFXX &lt;code&gt;APP0&lt;/code&gt; marker
 555                segment and a warning is sent to any listeners.
 556         &lt;/ul&gt;
 557 
 558       &lt;li&gt; If the thumbnail image is a grayscale image, it is processed as
 559            follows:
 560         &lt;ul&gt;
 561           &lt;li&gt; If no &lt;code&gt;app0JFXX&lt;/code&gt; node is present in the metadata,
 562                the thumbnail is expanded to RGB and written as part of the
 563                JFIF &lt;code&gt;APP0&lt;/code&gt; marker segment.
 564           &lt;li&gt; If the first &lt;code&gt;app0JFXX&lt;/code&gt; node present in the metadata
 565                contains a &lt;code&gt;JFIFthumbRGB&lt;/code&gt; element, the thumbnail is
 566                expanded to RGB and written in a separate &lt;code&gt;JFXX&lt;/code&gt; RGB
 567                marker segment.
 568           &lt;li&gt; If the first &lt;code&gt;app0JFXX&lt;/code&gt; node present in the metadata
 569                contains a &lt;code&gt;JFIFthumbJPEG&lt;/code&gt; element, a
 570                JPEG thumbnail is written in a JFXX &lt;code&gt;APP0&lt;/code&gt; marker
 571                segment.
 572           &lt;li&gt; If the first &lt;code&gt;app0JFXX&lt;/code&gt; node present in the metadata
 573                contains a &lt;code&gt;JFIFthumbPalette&lt;/code&gt; element, a
 574                JPEG thumbnail is written in a JFXX &lt;code&gt;APP0&lt;/code&gt; marker
 575                segment and a warning is sent to any listeners.
 576         &lt;/ul&gt;
 577 
 578       &lt;li&gt; Any other thumbnail image types are ignored and a warning is sent
 579            to any listeners.
 580     &lt;/ul&gt;
 581 
 582   &lt;li&gt; If there are multiple thumbnails, each one is processed as above, except
 583        that no thumbnail is placed in the JFIF &lt;code&gt;APP0&lt;/code&gt; segment, and
 584        the &lt;code&gt;app0JFXX&lt;/code&gt; node consulted for each thumbnail is the
 585        &lt;code&gt;app0JFXX&lt;/code&gt; node from the metadata that occurs in the same
 586        sequence as the thumbnail.  &lt;i&gt;I.e.&lt;/i&gt; the first
 587        &lt;code&gt;app0JFXX&lt;/code&gt; node applies to the first thumbnail, the second
 588        node to the second thumbnail, and so on.  If there are fewer
 589        &lt;code&gt;app0JFXX&lt;/code&gt; nodes in the metadata than thumbnails, then
 590        those thumbnails are considered to have no matching
 591        &lt;code&gt;app0JFXX&lt;/code&gt; node.  An RGB thumbnail with no matching
 592        &lt;code&gt;app0JFXX&lt;/code&gt; node is written in a JFXX &lt;code&gt;APP0&lt;/code&gt; marker
 593        segment.  A grayscale thumbnail with no matching
 594        &lt;code&gt;app0JFXX&lt;/code&gt; node is written as a JPEG image to a JFXX
 595        &lt;code&gt;APP0&lt;/code&gt; marker segment.
 596 &lt;/ul&gt;
 597 &lt;p&gt;
 598 
 599 Note that as the only mechanism for storing thumbnails is via the
 600 JFIF or JFIF extension marker segments, only grayscale or RGB images
 601 may have thumbnails.  If thumbnails are present when writing any other type
 602 of image, the thumbnails are ignored and a warning is sent to any warning
 603 listeners.
 604 
 605 &lt;h2&gt;
 606 &lt;a id=prog&gt;Progressive Encoding&lt;/a&gt;
 607 &lt;/h2&gt;
 608 
 609 Progressive encoding must be enabled on the &lt;code&gt;ImageWriteParam&lt;/code&gt;
 610 passed in to a write operation, or the image will be written sequentially,
 611 regardless of the scan headers included in the metadata object.  If
 612 progressive encoding is enabled and set to copy from metadata, then
 613 the sequence of scan headers from the metadata is used to write the
 614 image.  If progressive encoding is enabled and set to use a default,
 615 then the scans in the metadata are ignored and a default set of scans
 616 is used.  Progressive encoding always forces optimized Huffman tables to
 617 be used.  Any Huffman tables present in the metadata will be ignored,
 618 and a warning will be sent to any warning listeners.
 619 
 620 If Huffman-table optimization is requested on the &lt;code&gt;ImageWriteParam&lt;/code&gt;,
 621 all Huffman tables in the metadata or in the &lt;code&gt;ImageWriteParam&lt;/code&gt;
 622 itself are ignored, and a warning will be sent to any warning listeners if
 623 any such tables are present.
 624 
 625 &lt;h2&gt;
 626 &lt;a id=tree&gt;Native Metadata Format Tree Structure and Editing&lt;/a&gt;
 627 &lt;/h2&gt;
 628 
 629 The DTDs below describe just the trees of metadata objects actually returned
 630 by the &lt;code&gt;IIOMetadata&lt;/code&gt; object.  They do not include nodes
 631 corresponding to &lt;code&gt;SOI&lt;/code&gt;, &lt;code&gt;EOI&lt;/code&gt;, or &lt;code&gt;RST&lt;/code&gt;
 632 markers, as these parsing delimiters do not carry any meaningful metadata.
 633 &lt;p&gt;
 634 
 635 The first node is always a &lt;code&gt;JPEGvariety&lt;/code&gt; node.  In the
 636 &lt;code&gt;javax_imageio_jpeg_image_1.0&lt;/code&gt; version of the JPEG metadata
 637 format, this node may have one child, an &lt;code&gt;app0JFIF&lt;/code&gt; node,
 638 indicating that the JPEG stream contains a JFIF marker segment and related
 639 data, or no children, indicating that the stream contains no JFIF marker.
 640 In future versions of the JPEG metadata format, other varieties of JPEG
 641 metadata may be supported (e.g. Exif) by defining other types of nodes
 642 which may appear as a child of the &lt;code&gt;JPEGvariety&lt;/code&gt; node.
 643 &lt;p&gt;
 644 
 645 (Note that an application wishing to interpret Exif metadata given
 646 a metadata tree structure in the &lt;code&gt;javax_imageio_jpeg_image_1.0&lt;/code&gt;
 647 format must check for an &lt;code&gt;unknown&lt;/code&gt; marker segment with a tag
 648 indicating an &lt;code&gt;APP1&lt;/code&gt; marker and containing data identifying it
 649 as an Exif marker segment.  Then it may use application-specific code to
 650 interpret the data in the marker segment.  If such an application were
 651 to encounter a metadata tree formatted according to a future version of
 652 the JPEG metadata format, the Exif marker segment might not be
 653 &lt;code&gt;unknown&lt;/code&gt; in that format - it might be structured as a
 654 child node of the &lt;code&gt;JPEGvariety&lt;/code&gt; node.  Thus, it is important
 655 for an application to specify which version to use by passing the string
 656 identifying the version to the method/constructor used to obtain an
 657 &lt;code&gt;IIOMetadata&lt;/code&gt; object.)
 658 
 659 &lt;p&gt;
 660 
 661 On reading, &lt;code&gt;JFXX&lt;/code&gt; and &lt;code&gt;app2ICC&lt;/code&gt; nodes occur as
 662 children of an &lt;code&gt;app0JFIF&lt;/code&gt; node.
 663 This is true regardless of where the JFXX &lt;code&gt;APP0&lt;/code&gt; and
 664 &lt;code&gt;APP2&lt;/code&gt; marker segments actually occur in the stream.  The ordering
 665 of nodes within the &lt;code&gt;markerSequence&lt;/code&gt; node corresponds to the
 666 ordering of marker segments found in the JPEG stream.
 667 &lt;p&gt;
 668 On writing, any &lt;code&gt;JFXX&lt;/code&gt; and &lt;code&gt;app2ICC&lt;/code&gt; nodes must
 669 occur as children of an &lt;code&gt;app0JFIF&lt;/code&gt; node, itself a child of a
 670 &lt;code&gt;JPEGvariety&lt;/code&gt; node, which must always be the first node.
 671 (If the stream is not to be JFIF compliant, no &lt;code&gt;app0JFIF&lt;/code&gt; node
 672 should be provided, and the &lt;code&gt;JPEGvariety&lt;/code&gt; node should have no
 673 children.)  Any
 674 JFIF &lt;code&gt;APP0&lt;/code&gt;, JFXX &lt;code&gt;APP0&lt;/code&gt;, and &lt;code&gt;APP2&lt;/code&gt; marker
 675 segments are written first, followed by all Adobe &lt;code&gt;APP14&lt;/code&gt;,
 676 &lt;code&gt;APPn&lt;/code&gt;, &lt;code&gt;COM&lt;/code&gt; and unknown segments in the
 677 order in which their corresponding nodes appear in the
 678 &lt;code&gt;markerSequence&lt;/code&gt; node, followed by &lt;code&gt;DQT&lt;/code&gt; (and
 679 &lt;code&gt;DHT&lt;/code&gt; for non-progressive writes) marker segments, followed by the
 680 &lt;code&gt;SOF&lt;/code&gt; and &lt;code&gt;SOS&lt;/code&gt; marker segments.  For progressive writes
 681 using metadata to control progression, the &lt;code&gt;SOS&lt;/code&gt; segments are used
 682 in the order in which their corresponding nodes occur in the
 683 &lt;code&gt;markerSequence&lt;/code&gt; node.
 684 &lt;p&gt;
 685 
 686 The &lt;code&gt;reset&lt;/code&gt;, &lt;code&gt;mergeTree&lt;/code&gt; and &lt;code&gt;setFromTree&lt;/code&gt;
 687 operations have the following semantics for the JPEG plug-in metadata object:
 688 
 689 &lt;p&gt; &lt;code&gt;reset&lt;/code&gt; - A call to &lt;code&gt;reset&lt;/code&gt; will restore the
 690 metadata object to the same state it had immediately after creation, whether
 691 this came about from reading a stream or by obtaining a default object from
 692 the &lt;code&gt;ImageWriter&lt;/code&gt;.  This is true regardless of how many times the
 693 metadata object has been modified since creation.
 694 
 695 &lt;p&gt; &lt;code&gt;mergeTree&lt;/code&gt; - Native Format
 696 &lt;br&gt; The &lt;code&gt;mergeTree&lt;/code&gt; operation accepts valid trees conforming to
 697 the DTD below, and merges the nodes using the following ordering rules.  In
 698 all cases, only data present in the new node is changed in a corresponding
 699 existing node, if any.  This means that nodes cannot be removed using
 700 &lt;code&gt;mergeTree&lt;/code&gt;.  To remove nodes, use &lt;code&gt;setFromTree&lt;/code&gt;.  The
 701 tree must consist of &lt;code&gt;IIOMetadataNode&lt;/code&gt;s.
 702 &lt;ul&gt;
 703   &lt;li&gt; &lt;code&gt;app0JFIF&lt;/code&gt;
 704         &lt;ul&gt;
 705           &lt;li&gt; If an &lt;code&gt;app0JFIF&lt;/code&gt; node already exists, the contents
 706                of the new one modify the existing one.
 707           &lt;li&gt; If there is no such node, a new one is created and inserted in
 708                the appropriate position.
 709         &lt;/ul&gt;
 710   &lt;li&gt; &lt;code&gt;dqt&lt;/code&gt;
 711         &lt;ul&gt;
 712           &lt;li&gt; If there already exist &lt;code&gt;dqt&lt;/code&gt; nodes in the sequence,
 713                then each table in the node replaces the first table, in any
 714                &lt;code&gt;dqt&lt;/code&gt; node, with the same table id.
 715           &lt;li&gt; If none of the existing &lt;code&gt;dqt&lt;/code&gt; nodes contain a table
 716                with the same id, then the table is added to the last existing
 717                &lt;code&gt;dqt&lt;/code&gt; node.
 718           &lt;li&gt; If there are no &lt;code&gt;dqt&lt;/code&gt; nodes, then a new one is
 719                created and added as follows:
 720             &lt;ul&gt;
 721               &lt;li&gt; If there are &lt;code&gt;dht&lt;/code&gt; nodes, the new
 722                    &lt;code&gt;dqt&lt;/code&gt; node is inserted before the first one.
 723               &lt;li&gt; If there are no &lt;code&gt;dht&lt;/code&gt; nodes, the new
 724                    &lt;code&gt;dqt&lt;/code&gt; node is inserted  before an
 725                    &lt;code&gt;sof&lt;/code&gt; node, if there is one.
 726               &lt;li&gt; If there is no &lt;code&gt;sof&lt;/code&gt; node, the new
 727                    &lt;code&gt;dqt&lt;/code&gt; node is inserted before the first
 728                    &lt;code&gt;sos&lt;/code&gt; node, if there is one.
 729               &lt;li&gt; If there is no &lt;code&gt;sos&lt;/code&gt; node, the new
 730                    &lt;code&gt;dqt&lt;/code&gt; node is added to the end of the sequence.
 731             &lt;/ul&gt;
 732         &lt;/ul&gt;
 733   &lt;li&gt; &lt;code&gt;dht&lt;/code&gt;
 734         &lt;ul&gt;
 735           &lt;li&gt; If there already exist &lt;code&gt;dht&lt;/code&gt; nodes in the sequence,
 736                then each table in the node replaces the first table, in any
 737                &lt;code&gt;dht&lt;/code&gt; node, with the same table class and table id.
 738           &lt;li&gt; If none of the existing &lt;code&gt;dht&lt;/code&gt; nodes contain a table
 739                with the same class and id, then the table is added to the last
 740                existing &lt;code&gt;dht&lt;/code&gt; node.
 741           &lt;li&gt; If there are no &lt;code&gt;dht&lt;/code&gt; nodes, then a new one is
 742                created and added as follows:
 743             &lt;ul&gt;
 744               &lt;li&gt; If there are &lt;code&gt;dqt&lt;/code&gt; nodes, the new
 745                    &lt;code&gt;dht&lt;/code&gt; node is inserted immediately following the
 746                    last &lt;code&gt;dqt&lt;/code&gt; node.
 747               &lt;li&gt; If there are no &lt;code&gt;dqt&lt;/code&gt; nodes, the new
 748                    &lt;code&gt;dht&lt;/code&gt; node is inserted before an
 749                    &lt;code&gt;sof&lt;/code&gt; node, if there is one.
 750               &lt;li&gt; If there is no &lt;code&gt;sof&lt;/code&gt; node, the new
 751                    &lt;code&gt;dht&lt;/code&gt; node is inserted before the first
 752                    &lt;code&gt;sos&lt;/code&gt; node, if there is one.
 753               &lt;li&gt; If there is no &lt;code&gt;sos&lt;/code&gt; node, the new
 754                    &lt;code&gt;dht&lt;/code&gt; node is added to the end of the sequence.
 755             &lt;/ul&gt;
 756         &lt;/ul&gt;
 757   &lt;li&gt; &lt;code&gt;dri&lt;/code&gt;
 758         &lt;ul&gt;
 759           &lt;li&gt; If there already exists a &lt;code&gt;dri&lt;/code&gt; node, the restart
 760                interval value is updated.
 761           &lt;li&gt; If there is no &lt;code&gt;dri&lt;/code&gt; node, then a new one is created
 762                and added as follows:
 763             &lt;ul&gt;
 764               &lt;li&gt; If there is an &lt;code&gt;sof&lt;/code&gt; node, the new
 765                    &lt;code&gt;dri&lt;/code&gt; node is inserted before it.
 766               &lt;li&gt; If there is no &lt;code&gt;sof&lt;/code&gt; node, the new
 767                    &lt;code&gt;dri&lt;/code&gt; node is inserted before the first
 768                    &lt;code&gt;sos&lt;/code&gt; node, if there is one.
 769               &lt;li&gt; If there is no &lt;code&gt;sos&lt;/code&gt; node, the new
 770                    &lt;code&gt;dri&lt;/code&gt; node is added to the end of the sequence.
 771             &lt;/ul&gt;
 772         &lt;/ul&gt;
 773   &lt;li&gt; &lt;code&gt;com&lt;/code&gt;
 774         &lt;br&gt; A new &lt;code&gt;com&lt;/code&gt; node is created and inserted as follows:
 775         &lt;ul&gt;
 776           &lt;li&gt; If there already exist &lt;code&gt;com&lt;/code&gt; nodes, the new one is
 777                inserted after the last one.
 778           &lt;li&gt; If there are no &lt;code&gt;com&lt;/code&gt; nodes, the new
 779                &lt;code&gt;com&lt;/code&gt; node is inserted after the
 780                &lt;code&gt;app14Adobe&lt;/code&gt; node, if there is one.
 781           &lt;li&gt; If there is no &lt;code&gt;app14Adobe&lt;/code&gt; node, the new
 782                &lt;code&gt;com&lt;/code&gt; node is inserted at the beginning of the
 783                sequence.
 784         &lt;/ul&gt;
 785   &lt;li&gt; &lt;code&gt;app14Adobe&lt;/code&gt;
 786         &lt;ul&gt;
 787           &lt;li&gt; If there already exists an &lt;code&gt;app14Adobe&lt;/code&gt; node, then
 788                its attributes are updated from the node.
 789           &lt;li&gt; If there is no &lt;code&gt;app14Adobe&lt;/code&gt; node, then a new one is
 790                created and  added as follows:
 791             &lt;ul&gt;
 792               &lt;li&gt; The new &lt;code&gt;app14Adobe&lt;/code&gt; node is inserted after the
 793                    last &lt;code&gt;unknown&lt;/code&gt; node, if there are any.
 794               &lt;li&gt; If there are no &lt;code&gt;unknown&lt;/code&gt; nodes, the new
 795                    &lt;code&gt;app14Adobe&lt;/code&gt; node is inserted at the beginning
 796                    of the sequence.
 797             &lt;/ul&gt;
 798         &lt;/ul&gt;
 799   &lt;li&gt; &lt;code&gt;unknown&lt;/code&gt;
 800        &lt;br&gt; A new &lt;code&gt;unknown&lt;/code&gt; node is created and added to the
 801             sequence as follows:
 802         &lt;ul&gt;
 803           &lt;li&gt; If there already exist &lt;code&gt;unknown&lt;/code&gt; marker nodes, the
 804                new one is inserted after the last one.
 805           &lt;li&gt; If there are no &lt;code&gt;unknown&lt;/code&gt; nodes, the new
 806                &lt;code&gt;unknown&lt;/code&gt; node is inserted before the
 807                &lt;code&gt;app14Adobe&lt;/code&gt; node, if there is one.
 808           &lt;li&gt; If there is no &lt;code&gt;app14Adobe&lt;/code&gt; node, the new
 809                &lt;code&gt;unknown&lt;/code&gt; node is inserted at the beginning of the
 810                sequence.
 811         &lt;/ul&gt;
 812   &lt;li&gt; &lt;code&gt;sof&lt;/code&gt;
 813         &lt;ul&gt;
 814           &lt;li&gt; If there already exists an &lt;code&gt;sof&lt;/code&gt; node in the
 815                sequence, then its values are updated from the node.
 816           &lt;li&gt; If there is no &lt;code&gt;sof&lt;/code&gt; node, then a new one is created
 817                and added as follows:
 818             &lt;ul&gt;
 819               &lt;li&gt; If there are any &lt;code&gt;sos&lt;/code&gt; nodes, the new
 820                    &lt;code&gt;sof&lt;/code&gt; node is inserted before the first one.
 821               &lt;li&gt; If there is no &lt;code&gt;sos&lt;/code&gt; node, the new
 822                    &lt;code&gt;sof&lt;/code&gt; node is added to the end of the sequence.
 823             &lt;/ul&gt;
 824         &lt;/ul&gt;
 825   &lt;li&gt; &lt;code&gt;sos&lt;/code&gt;
 826         &lt;ul&gt;
 827           &lt;li&gt; If there already exists a single &lt;code&gt;sos&lt;/code&gt; node, then
 828                the values are updated from the node.
 829           &lt;li&gt; If there are more than one existing &lt;code&gt;sos&lt;/code&gt; nodes,
 830                then an &lt;code&gt;IIOInvalidTreeException&lt;/code&gt; is thrown, as
 831                &lt;code&gt;sos&lt;/code&gt; nodes cannot be merged into a set of
 832                progressive scans.
 833           &lt;li&gt; If there are no &lt;code&gt;sos&lt;/code&gt; nodes, a new one is created
 834                and added to the end of the sequence.
 835         &lt;/ul&gt;
 836 &lt;/ul&gt;
 837 
 838 &lt;p&gt; &lt;code&gt;mergeTree&lt;/code&gt; - Standard Format
 839 &lt;br&gt;
 840 The &lt;code&gt;mergeTree&lt;/code&gt; operation, when given a tree in the standard
 841 format, will modify the native tree in the following ways:
 842 &lt;ul&gt;
 843    &lt;li&gt; &lt;code&gt;Chroma&lt;/code&gt; - The &lt;code&gt;ColorSpaceType&lt;/code&gt; subnode of a
 844         &lt;code&gt;Chroma&lt;/code&gt; node may change the target colorspace of the
 845         compressed image.  The selection of a new colorspace can cause a number
 846         of changes, in keeping with the algorithms described above:
 847         &lt;code&gt;app0JFIF&lt;/code&gt; and &lt;code&gt;app14Adobe&lt;/code&gt; nodes may be added
 848         or removed, subsampling may be added or removed, component ids may
 849         be changed, and &lt;code&gt;sof&lt;/code&gt; and &lt;code&gt;sos&lt;/code&gt; nodes will be
 850         updated accordingly.  If necessary, additional quantization and
 851         huffman tables are added.  In the case of quantization tables, the
 852         default will be scaled to match the quality level of any existing
 853         tables.  No tables are added to metadata that does not already contain
 854         tables.  If the existing metadata specifies progressive encoding, then
 855         the number of channels must not change.  Any &lt;code&gt;Transparency&lt;/code&gt;
 856         node is also taken into account, as an explicit value of
 857         &lt;code&gt;none&lt;/code&gt; for the &lt;code&gt;Alpha&lt;/code&gt; subnode can cause the
 858         removal of an alpha channel, and anything other than &lt;code&gt;none&lt;/code&gt;
 859         can cause the addition of an alpha channel.
 860    &lt;li&gt; &lt;code&gt;Dimension&lt;/code&gt; - A &lt;code&gt;PixelAspectRatio&lt;/code&gt; specification
 861         can cause the contents of an &lt;code&gt;app0JFIF&lt;/code&gt; node to change, if
 862         there is one present, or the addition of an &lt;code&gt;app0JFIF&lt;/code&gt; node
 863         containing appropriate values, if there can be one.  An appropriate
 864         pair of integers is computed from the floating-point ratio for
 865         inclusion in the node.
 866    &lt;li&gt; &lt;code&gt;Text&lt;/code&gt; - Each uncompressed text item is converted to a
 867         &lt;code&gt;com&lt;/code&gt; node and inserted according to the rules above for
 868         merging &lt;code&gt;com&lt;/code&gt; nodes.
 869 &lt;/ul&gt;
 870 
 871 &lt;p&gt; &lt;code&gt;setFromTree&lt;/code&gt; - Native Format
 872 &lt;br&gt;
 873 The &lt;code&gt;setFromTree&lt;/code&gt; operation, when given a tree in the native
 874 format described below, will simply replace the existing tree in its entirety
 875 with the new one.  The tree must consist of &lt;code&gt;IIOMetadataNode&lt;/code&gt;s.
 876 
 877 &lt;p&gt; &lt;code&gt;setFromTree&lt;/code&gt; - Standard Format
 878 &lt;br&gt;
 879 The &lt;code&gt;setFromTree&lt;/code&gt; operation, when given a tree in the standard
 880 format, performs a &lt;code&gt;reset&lt;/code&gt; followed by a merge of the new tree.
 881 
 882 &lt;h2&gt;
 883 &lt;a id=image&gt;Image Metadata DTD&lt;/a&gt;
 884 &lt;/h2&gt;
 885 
 886 &lt;pre&gt;
 887 &amp;lt;!DOCTYPE &quot;javax_imageio_jpeg_image_1.0&quot; [
 888 
 889   &amp;lt;!ELEMENT &quot;javax_imageio_jpeg_image_1.0&quot; (JPEGvariety, markerSequence)&amp;gt;
 890 
 891     &amp;lt;!ELEMENT &quot;JPEGvariety&quot; (app0JFIF)&amp;gt;
 892       &amp;lt;!-- A node grouping all marker segments specific to the variety of
 893               stream being read/written (e.g. JFIF) - may be empty --&amp;gt;
 894 
 895       &amp;lt;!ELEMENT &quot;app0JFIF&quot; (JFXX?, app2ICC?)&amp;gt;
 896         &amp;lt;!ATTLIST &quot;app0JFIF&quot; &quot;majorVersion&quot; #CDATA &quot;1&quot;&amp;gt;
 897           &amp;lt;!-- The major JFIF version number --&amp;gt;
 898           &amp;lt;!-- Data type: Integer --&amp;gt;
 899           &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
 900           &amp;lt;!-- Max value: 255 (inclusive) --&amp;gt;
 901         &amp;lt;!ATTLIST &quot;app0JFIF&quot; &quot;minorVersion&quot; #CDATA &quot;2&quot;&amp;gt;
 902           &amp;lt;!-- The minor JFIF version number --&amp;gt;
 903           &amp;lt;!-- Data type: Integer --&amp;gt;
 904           &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
 905           &amp;lt;!-- Max value: 255 (inclusive) --&amp;gt;
 906         &amp;lt;!ATTLIST &quot;app0JFIF&quot; &quot;resUnits&quot; (&quot;0&quot; | &quot;1&quot; | &quot;2&quot;) &quot;0&quot;&amp;gt;
 907           &amp;lt;!-- The resolution units for Xdensisty and Ydensity (0 = no
 908                units, just aspect ratio; 1 = dots/inch; 2 = dots/cm) --&amp;gt;
 909         &amp;lt;!ATTLIST &quot;app0JFIF&quot; &quot;Xdensity&quot; #CDATA &quot;1&quot;&amp;gt;
 910           &amp;lt;!-- The horizontal density or aspect ratio numerator --&amp;gt;
 911           &amp;lt;!-- Data type: Integer --&amp;gt;
 912           &amp;lt;!-- Min value: 1 (inclusive) --&amp;gt;
 913           &amp;lt;!-- Max value: 65535 (inclusive) --&amp;gt;
 914         &amp;lt;!ATTLIST &quot;app0JFIF&quot; &quot;Ydensity&quot; #CDATA &quot;1&quot;&amp;gt;
 915           &amp;lt;!-- The vertical density or aspect ratio denominator --&amp;gt;
 916           &amp;lt;!-- Data type: Integer --&amp;gt;
 917           &amp;lt;!-- Min value: 1 (inclusive) --&amp;gt;
 918           &amp;lt;!-- Max value: 65535 (inclusive) --&amp;gt;
 919         &amp;lt;!ATTLIST &quot;app0JFIF&quot; &quot;thumbWidth&quot; #CDATA &quot;0&quot;&amp;gt;
 920           &amp;lt;!-- The width of the thumbnail, or 0 if there isn&#39;t one --&amp;gt;
 921           &amp;lt;!-- Data type: Integer --&amp;gt;
 922           &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
 923           &amp;lt;!-- Max value: 255 (inclusive) --&amp;gt;
 924         &amp;lt;!ATTLIST &quot;app0JFIF&quot; &quot;thumbHeight&quot; #CDATA &quot;0&quot;&amp;gt;
 925           &amp;lt;!-- The height of the thumbnail, or 0 if there isn&#39;t one --&amp;gt;
 926           &amp;lt;!-- Data type: Integer --&amp;gt;
 927           &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
 928           &amp;lt;!-- Max value: 255 (inclusive) --&amp;gt;
 929 
 930         &amp;lt;!ELEMENT &quot;JFXX&quot; (app0JFXX)*&amp;gt;
 931           &amp;lt;!-- Min children: 1 --&amp;gt;
 932 
 933         &amp;lt;!ELEMENT &quot;app0JFXX&quot; (JFIFthumbJPEG | JFIFthumbPalette |
 934           JFIFthumbRGB)&amp;gt;
 935           &amp;lt;!-- A JFIF extension marker segment --&amp;gt;
 936           &amp;lt;!ATTLIST &quot;app0JFXX&quot; &quot;extensionCode&quot; (&quot;16&quot; | &quot;17&quot; | &quot;19&quot;)
 937              #IMPLIED&amp;gt;
 938             &amp;lt;!-- The JFXX extension code identifying thumbnail type: (16 =
 939                  JPEG, 17 = indexed, 19 = RGB --&amp;gt;
 940 
 941           &amp;lt;!ELEMENT &quot;JFIFthumbJPEG&quot; (markerSequence?)&amp;gt;
 942             &amp;lt;!-- A JFIF thumbnail in JPEG format (no JFIF segments
 943                  permitted) --&amp;gt;
 944 
 945           &amp;lt;!ELEMENT &quot;JFIFthumbPalette&quot; EMPTY&amp;gt;
 946             &amp;lt;!-- A JFIF thumbnail as an RGB indexed image --&amp;gt;
 947             &amp;lt;!ATTLIST &quot;JFIFthumbPalette&quot; &quot;thumbWidth&quot; #CDATA #IMPLIED&amp;gt;
 948               &amp;lt;!-- The width of the thumbnail --&amp;gt;
 949               &amp;lt;!-- Data type: Integer --&amp;gt;
 950               &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
 951               &amp;lt;!-- Max value: 255 (inclusive) --&amp;gt;
 952             &amp;lt;!ATTLIST &quot;JFIFthumbPalette&quot; &quot;thumbHeight&quot; #CDATA #IMPLIED&amp;gt;
 953               &amp;lt;!-- The height of the thumbnail --&amp;gt;
 954               &amp;lt;!-- Data type: Integer --&amp;gt;
 955               &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
 956               &amp;lt;!-- Max value: 255 (inclusive) --&amp;gt;
 957 
 958           &amp;lt;!ELEMENT &quot;JFIFthumbRGB&quot; EMPTY&amp;gt;
 959             &amp;lt;!-- A JFIF thumbnail as an RGB image --&amp;gt;
 960             &amp;lt;!ATTLIST &quot;JFIFthumbRGB&quot; &quot;thumbWidth&quot; #CDATA #IMPLIED&amp;gt;
 961               &amp;lt;!-- The width of the thumbnail --&amp;gt;
 962               &amp;lt;!-- Data type: Integer --&amp;gt;
 963               &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
 964               &amp;lt;!-- Max value: 255 (inclusive) --&amp;gt;
 965             &amp;lt;!ATTLIST &quot;JFIFthumbRGB&quot; &quot;thumbHeight&quot; #CDATA #IMPLIED&amp;gt;
 966               &amp;lt;!-- The height of the thumbnail --&amp;gt;
 967               &amp;lt;!-- Data type: Integer --&amp;gt;
 968               &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
 969               &amp;lt;!-- Max value: 255 (inclusive) --&amp;gt;
 970 
 971         &amp;lt;!ELEMENT &quot;app2ICC&quot; EMPTY&amp;gt;
 972           &amp;lt;!-- An ICC profile APP2 marker segment --&amp;gt;
 973           &amp;lt;!-- Optional User object: java.awt.color.ICC_Profile --&amp;gt;
 974 
 975     &amp;lt;!ELEMENT &quot;markerSequence&quot; (dqt | dht | dri | com | unknown |
 976       app14Adobe | sof | sos)*&amp;gt;
 977       &amp;lt;!-- A node grouping all non-jfif marker segments --&amp;gt;
 978 
 979       &amp;lt;!ELEMENT &quot;dqt&quot; (dqtable)*&amp;gt;
 980         &amp;lt;!-- A Define Quantization Table(s) marker segment --&amp;gt;
 981         &amp;lt;!-- Min children: 1 --&amp;gt;
 982         &amp;lt;!-- Max children: 4 --&amp;gt;
 983 
 984         &amp;lt;!ELEMENT &quot;dqtable&quot; EMPTY&amp;gt;
 985           &amp;lt;!-- A single quantization table --&amp;gt;
 986           &amp;lt;!-- User object: javax.imageio.plugins.jpeg.JPEGQTable --&amp;gt;
 987           &amp;lt;!ATTLIST &quot;dqtable&quot; &quot;elementPrecision&quot; #CDATA &quot;0&quot;&amp;gt;
 988             &amp;lt;!-- The number of bits in each table element (0 = 8, 1 = 16)
 989                  --&amp;gt;
 990             &amp;lt;!-- Data type: Integer --&amp;gt;
 991           &amp;lt;!ATTLIST &quot;dqtable&quot; &quot;qtableId&quot; (&quot;0&quot; | &quot;1&quot; | &quot;2&quot; | &quot;3&quot;) #REQUIRED&amp;gt;
 992 
 993       &amp;lt;!ELEMENT &quot;dht&quot; (dhtable)*&amp;gt;
 994         &amp;lt;!-- A Define Huffman Table(s) marker segment --&amp;gt;
 995         &amp;lt;!-- Min children: 1 --&amp;gt;
 996         &amp;lt;!-- Max children: 4 --&amp;gt;
 997 
 998         &amp;lt;!ELEMENT &quot;dhtable&quot; EMPTY&amp;gt;
 999           &amp;lt;!-- A single Huffman table --&amp;gt;
1000           &amp;lt;!-- User object: javax.imageio.plugins.jpeg.JPEGHuffmanTable --&amp;gt;
1001           &amp;lt;!ATTLIST &quot;dhtable&quot; &quot;class&quot; (&quot;0&quot; | &quot;1&quot;) #REQUIRED&amp;gt;
1002             &amp;lt;!-- Indicates whether this is a DC (0) or an AC (1) table --&amp;gt;
1003           &amp;lt;!ATTLIST &quot;dhtable&quot; &quot;htableId&quot; (&quot;0&quot; | &quot;1&quot; | &quot;2&quot; | &quot;3&quot;) #REQUIRED&amp;gt;
1004             &amp;lt;!-- The table id --&amp;gt;
1005 
1006       &amp;lt;!ELEMENT &quot;dri&quot; EMPTY&amp;gt;
1007         &amp;lt;!-- A Define Restart Interval marker segment --&amp;gt;
1008         &amp;lt;!ATTLIST &quot;dri&quot; &quot;interval&quot; #CDATA #REQUIRED&amp;gt;
1009           &amp;lt;!-- The restart interval in MCUs --&amp;gt;
1010           &amp;lt;!-- Data type: Integer --&amp;gt;
1011           &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
1012           &amp;lt;!-- Max value: 65535 (inclusive) --&amp;gt;
1013 
1014       &amp;lt;!ELEMENT &quot;com&quot; EMPTY&amp;gt;
1015         &amp;lt;!-- A Comment marker segment. The user object contains the actual
1016              bytes. --&amp;gt;
1017         &amp;lt;!-- User object: array of [B --&amp;gt;
1018         &amp;lt;!-- Min length: 1 --&amp;gt;
1019         &amp;lt;!-- Max length: 65533 --&amp;gt;
1020         &amp;lt;!ATTLIST &quot;com&quot; &quot;comment&quot; #CDATA #IMPLIED&amp;gt;
1021           &amp;lt;!-- The comment as a string (used only if user object is null)
1022                --&amp;gt;
1023           &amp;lt;!-- Data type: String --&amp;gt;
1024 
1025       &amp;lt;!ELEMENT &quot;unknown&quot; EMPTY&amp;gt;
1026         &amp;lt;!-- An unrecognized marker segment. The user object contains the
1027              data not including length. --&amp;gt;
1028         &amp;lt;!-- User object: array of [B --&amp;gt;
1029         &amp;lt;!-- Min length: 1 --&amp;gt;
1030         &amp;lt;!-- Max length: 65533 --&amp;gt;
1031         &amp;lt;!ATTLIST &quot;unknown&quot; &quot;MarkerTag&quot; #CDATA #REQUIRED&amp;gt;
1032           &amp;lt;!-- The tag identifying this marker segment --&amp;gt;
1033           &amp;lt;!-- Data type: Integer --&amp;gt;
1034           &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
1035           &amp;lt;!-- Max value: 255 (inclusive) --&amp;gt;
1036 
1037       &amp;lt;!ELEMENT &quot;app14Adobe&quot; EMPTY&amp;gt;
1038         &amp;lt;!-- An Adobe APP14 marker segment --&amp;gt;
1039         &amp;lt;!ATTLIST &quot;app14Adobe&quot; &quot;version&quot; #CDATA &quot;100&quot;&amp;gt;
1040           &amp;lt;!-- The version of Adobe APP14 marker segment --&amp;gt;
1041           &amp;lt;!-- Data type: Integer --&amp;gt;
1042           &amp;lt;!-- Min value: 100 (inclusive) --&amp;gt;
1043           &amp;lt;!-- Max value: 255 (inclusive) --&amp;gt;
1044         &amp;lt;!ATTLIST &quot;app14Adobe&quot; &quot;flags0&quot; #CDATA &quot;0&quot;&amp;gt;
1045           &amp;lt;!-- The flags0 variable of an APP14 marker segment --&amp;gt;
1046           &amp;lt;!-- Data type: Integer --&amp;gt;
1047           &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
1048           &amp;lt;!-- Max value: 65535 (inclusive) --&amp;gt;
1049         &amp;lt;!ATTLIST &quot;app14Adobe&quot; &quot;flags1&quot; #CDATA &quot;0&quot;&amp;gt;
1050           &amp;lt;!-- The flags1 variable of an APP14 marker segment --&amp;gt;
1051           &amp;lt;!-- Data type: Integer --&amp;gt;
1052           &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
1053           &amp;lt;!-- Max value: 65535 (inclusive) --&amp;gt;
1054         &amp;lt;!ATTLIST &quot;app14Adobe&quot; &quot;transform&quot; (&quot;0&quot; | &quot;1&quot; | &quot;2&quot;) #REQUIRED&amp;gt;
1055           &amp;lt;!-- The color transform applied to the image (0 = Unknown, 1 =
1056                YCbCr, 2 = YCCK) --&amp;gt;
1057 
1058       &amp;lt;!ELEMENT &quot;sof&quot; (componentSpec)*&amp;gt;
1059         &amp;lt;!-- A Start Of Frame marker segment --&amp;gt;
1060         &amp;lt;!-- Min children: 1 --&amp;gt;
1061         &amp;lt;!-- Max children: 4 --&amp;gt;
1062         &amp;lt;!ATTLIST &quot;sof&quot; &quot;process&quot; (&quot;0&quot; | &quot;1&quot; | &quot;2&quot;) #IMPLIED&amp;gt;
1063           &amp;lt;!-- The JPEG process (0 = Baseline sequential, 1 = Extended
1064                sequential, 2 = Progressive) --&amp;gt;
1065         &amp;lt;!ATTLIST &quot;sof&quot; &quot;samplePrecision&quot; #CDATA &quot;8&quot;&amp;gt;
1066           &amp;lt;!-- The number of bits per sample --&amp;gt;
1067           &amp;lt;!-- Data type: Integer --&amp;gt;
1068         &amp;lt;!ATTLIST &quot;sof&quot; &quot;numLines&quot; #CDATA #IMPLIED&amp;gt;
1069           &amp;lt;!-- The number of lines in the image --&amp;gt;
1070           &amp;lt;!-- Data type: Integer --&amp;gt;
1071           &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
1072           &amp;lt;!-- Max value: 65535 (inclusive) --&amp;gt;
1073         &amp;lt;!ATTLIST &quot;sof&quot; &quot;samplesPerLine&quot; #CDATA #IMPLIED&amp;gt;
1074           &amp;lt;!-- The number of samples per line --&amp;gt;
1075           &amp;lt;!-- Data type: Integer --&amp;gt;
1076           &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
1077           &amp;lt;!-- Max value: 65535 (inclusive) --&amp;gt;
1078         &amp;lt;!ATTLIST &quot;sof&quot; &quot;numFrameComponents&quot; (&quot;1&quot; | &quot;2&quot; | &quot;3&quot; | &quot;4&quot;)
1079            #IMPLIED&amp;gt;
1080           &amp;lt;!-- The number of components in the image --&amp;gt;
1081 
1082         &amp;lt;!ELEMENT &quot;componentSpec&quot; EMPTY&amp;gt;
1083           &amp;lt;!-- A component specification for a frame --&amp;gt;
1084           &amp;lt;!ATTLIST &quot;componentSpec&quot; &quot;componentId&quot; #CDATA #REQUIRED&amp;gt;
1085             &amp;lt;!-- The id for this component --&amp;gt;
1086             &amp;lt;!-- Data type: Integer --&amp;gt;
1087             &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
1088             &amp;lt;!-- Max value: 255 (inclusive) --&amp;gt;
1089           &amp;lt;!ATTLIST &quot;componentSpec&quot; &quot;HsamplingFactor&quot; #CDATA #REQUIRED&amp;gt;
1090             &amp;lt;!-- The horizontal sampling factor for this component --&amp;gt;
1091             &amp;lt;!-- Data type: Integer --&amp;gt;
1092             &amp;lt;!-- Min value: 1 (inclusive) --&amp;gt;
1093             &amp;lt;!-- Max value: 255 (inclusive) --&amp;gt;
1094           &amp;lt;!ATTLIST &quot;componentSpec&quot; &quot;VsamplingFactor&quot; #CDATA #REQUIRED&amp;gt;
1095             &amp;lt;!-- The vertical sampling factor for this component --&amp;gt;
1096             &amp;lt;!-- Data type: Integer --&amp;gt;
1097             &amp;lt;!-- Min value: 1 (inclusive) --&amp;gt;
1098             &amp;lt;!-- Max value: 255 (inclusive) --&amp;gt;
1099           &amp;lt;!ATTLIST &quot;componentSpec&quot; &quot;QtableSelector&quot; (&quot;0&quot; | &quot;1&quot; | &quot;2&quot; |
1100             &quot;3&quot;) #REQUIRED&amp;gt;
1101             &amp;lt;!-- The quantization table to use for this component --&amp;gt;
1102 
1103       &amp;lt;!ELEMENT &quot;sos&quot; (scanComponentSpec)*&amp;gt;
1104         &amp;lt;!-- A Start Of Scan marker segment --&amp;gt;
1105         &amp;lt;!-- Min children: 1 --&amp;gt;
1106         &amp;lt;!-- Max children: 4 --&amp;gt;
1107         &amp;lt;!ATTLIST &quot;sos&quot; &quot;numScanComponents&quot; (&quot;1&quot; | &quot;2&quot; | &quot;3&quot; | &quot;4&quot;)
1108            #REQUIRED&amp;gt;
1109           &amp;lt;!-- The number of components in the scan --&amp;gt;
1110         &amp;lt;!ATTLIST &quot;sos&quot; &quot;startSpectralSelection&quot; #CDATA &quot;0&quot;&amp;gt;
1111           &amp;lt;!-- The first spectral band included in this scan --&amp;gt;
1112           &amp;lt;!-- Data type: Integer --&amp;gt;
1113           &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
1114           &amp;lt;!-- Max value: 63 (inclusive) --&amp;gt;
1115         &amp;lt;!ATTLIST &quot;sos&quot; &quot;endSpectralSelection&quot; #CDATA &quot;63&quot;&amp;gt;
1116           &amp;lt;!-- The last spectral band included in this scan --&amp;gt;
1117           &amp;lt;!-- Data type: Integer --&amp;gt;
1118           &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
1119           &amp;lt;!-- Max value: 63 (inclusive) --&amp;gt;
1120         &amp;lt;!ATTLIST &quot;sos&quot; &quot;approxHigh&quot; #CDATA &quot;0&quot;&amp;gt;
1121           &amp;lt;!-- The highest bit position included in this scan --&amp;gt;
1122           &amp;lt;!-- Data type: Integer --&amp;gt;
1123           &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
1124           &amp;lt;!-- Max value: 15 (inclusive) --&amp;gt;
1125         &amp;lt;!ATTLIST &quot;sos&quot; &quot;approxLow&quot; #CDATA &quot;0&quot;&amp;gt;
1126           &amp;lt;!-- The lowest bit position included in this scan --&amp;gt;
1127           &amp;lt;!-- Data type: Integer --&amp;gt;
1128           &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
1129           &amp;lt;!-- Max value: 15 (inclusive) --&amp;gt;
1130 
1131         &amp;lt;!ELEMENT &quot;scanComponentSpec&quot; EMPTY&amp;gt;
1132           &amp;lt;!-- A component specification for a scan --&amp;gt;
1133           &amp;lt;!ATTLIST &quot;scanComponentSpec&quot; &quot;componentSelector&quot; #CDATA
1134              #REQUIRED&amp;gt;
1135             &amp;lt;!-- The id of this component --&amp;gt;
1136             &amp;lt;!-- Data type: Integer --&amp;gt;
1137             &amp;lt;!-- Min value: 0 (inclusive) --&amp;gt;
1138             &amp;lt;!-- Max value: 255 (inclusive) --&amp;gt;
1139           &amp;lt;!ATTLIST &quot;scanComponentSpec&quot; &quot;dcHuffTable&quot; (&quot;0&quot; | &quot;1&quot; | &quot;2&quot; |
1140             &quot;3&quot;) #REQUIRED&amp;gt;
1141             &amp;lt;!-- The huffman table to use for encoding DC coefficients --&amp;gt;
1142           &amp;lt;!ATTLIST &quot;scanComponentSpec&quot; &quot;acHuffTable&quot; (&quot;0&quot; | &quot;1&quot; | &quot;2&quot; |
1143             &quot;3&quot;) #REQUIRED&amp;gt;
1144             &amp;lt;!-- The huffman table to use for encoding AC coefficients --&amp;gt;
1145 ]&amp;gt;
1146 &lt;/pre&gt;
1147 
1148 &lt;h2&gt;
1149 &lt;a id=stream&gt;Stream Metadata DTD&lt;/a&gt;
1150 &lt;/h2&gt;
1151 
1152 &lt;pre&gt;
1153 &amp;lt;!DOCTYPE &quot;javax_imageio_jpeg_stream_1.0&quot; [
1154   &amp;lt;!ELEMENT &quot;javax_imageio_jpeg_stream_1.0&quot; (dqt |
1155                       dht |
1156                       dri |
1157                       com |
1158                       unknown)*&amp;gt;
1159 
1160   &amp;lt;!-- All elements are as defined above for image metadata --&amp;gt;
1161 ]&amp;gt;
1162 &lt;/pre&gt;
1163 &lt;/div&gt;
1164 &lt;/main&gt;
1165 &lt;/body&gt;
1166 &lt;/html&gt;
    </pre>
  </body>
</html>