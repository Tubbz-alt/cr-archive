<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/java.desktop/share/classes/javax/imageio/metadata/doc-files/tiff_metadata.html</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
   1 &lt;!doctype html&gt;
   2 &lt;html lang=&quot;en&quot;&gt;
   3 &lt;head&gt;
   4     &lt;meta charset=&quot;utf-8&quot;/&gt;
   5     &lt;title&gt;TIFF Metadata Format Specification and Usage Notes&lt;/title&gt;
   6 &lt;/head&gt;
   7 &lt;!--
   8 Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.
   9 DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  10 
  11 This code is free software; you can redistribute it and/or modify it
  12 under the terms of the GNU General Public License version 2 only, as
  13 published by the Free Software Foundation.  Oracle designates this
  14 particular file as subject to the &quot;Classpath&quot; exception as provided
  15 by Oracle in the LICENSE file that accompanied this code.
  16 
  17 This code is distributed in the hope that it will be useful, but WITHOUT
  18 ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  19 FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  20 version 2 for more details (a copy is included in the LICENSE file that
  21 accompanied this code).
  22 
  23 You should have received a copy of the GNU General Public License version
  24 2 along with this work; if not, write to the Free Software Foundation,
  25 Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  26 
  27 Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  28 or visit www.oracle.com if you need additional information or have any
  29 questions.
  30 --&gt;
  31 
  32 &lt;body&gt;
  33 &lt;main role=&quot;main&quot;&gt;
  34 &lt;div class=&quot;contentContainer&quot;&gt;
  35 &lt;h1&gt;TIFF Metadata Format Specification and Usage Notes&lt;/h1&gt;
  36 
  37 &lt;a href=&quot;#Reading&quot;&gt;Reading Images&lt;/a&gt;
  38 &lt;ul&gt;
  39 &lt;li&gt;&lt;a href=&quot;#ColorConversionRead&quot;&gt;Color Conversion&lt;/a&gt;&lt;/li&gt;
  40 &lt;li&gt;&lt;a href=&quot;#ColorSpacesRead&quot;&gt;Color Spaces&lt;/a&gt;&lt;/li&gt;
  41 &lt;li&gt;&lt;a href=&quot;#ICCProfilesRead&quot;&gt;ICC Profiles&lt;/a&gt;&lt;/li&gt;
  42 &lt;li&gt;&lt;a href=&quot;#MetadataIssuesRead&quot;&gt;Metadata Issues&lt;/a&gt;
  43 &lt;ul&gt;
  44 &lt;li&gt;&lt;a href=&quot;#MapNativeStandard&quot;&gt;Native to Standard Metadata Mapping&lt;/a&gt;&lt;/li&gt;
  45 &lt;/ul&gt;
  46 &lt;/li&gt;
  47 &lt;li&gt;&lt;a href=&quot;#ExifRead&quot;&gt;Reading Exif Images&lt;/a&gt;
  48 &lt;ul&gt;
  49 &lt;li&gt;&lt;a href=&quot;#ExifReadTIFF&quot;&gt;Reading Uncompressed Exif Images&lt;/a&gt;&lt;/li&gt;
  50 &lt;li&gt;&lt;a href=&quot;#ExifReadJPEG&quot;&gt;Reading Compressed Exif Images&lt;/a&gt;&lt;/li&gt;
  51 &lt;/ul&gt;
  52 &lt;/li&gt;
  53 &lt;/ul&gt;
  54 &lt;a href=&quot;#Writing&quot;&gt;Writing Images&lt;/a&gt;&lt;br/&gt;
  55 &lt;ul&gt;
  56 &lt;li&gt;&lt;a href=&quot;#Compression&quot;&gt;Compression&lt;/a&gt;&lt;/li&gt;
  57 &lt;li&gt;&lt;a href=&quot;#ColorConversionWrite&quot;&gt;Color Conversion&lt;/a&gt;&lt;/li&gt;
  58 &lt;li&gt;&lt;a href=&quot;#ICCProfilesWrite&quot;&gt;ICC Profiles&lt;/a&gt;&lt;/li&gt;
  59 &lt;li&gt;&lt;a href=&quot;#MetadataIssuesWrite&quot;&gt;Metadata Issues&lt;/a&gt;
  60 &lt;ul&gt;
  61 &lt;li&gt;&lt;a href=&quot;#MapStandardNative&quot;&gt;Standard to Native Metadata Mapping&lt;/a&gt;&lt;/li&gt;
  62 &lt;/ul&gt;
  63 &lt;li&gt;&lt;a href=&quot;#ExifWrite&quot;&gt;Writing Exif Images&lt;/a&gt;
  64 &lt;ul&gt;
  65 &lt;li&gt;&lt;a href=&quot;#ExifWriteTIFF&quot;&gt;Writing Uncompressed Exif Images&lt;/a&gt;&lt;/li&gt;
  66 &lt;li&gt;&lt;a href=&quot;#ExifWriteJPEG&quot;&gt;Writing Compressed Exif Images&lt;/a&gt;&lt;/li&gt;
  67 &lt;/ul&gt;
  68 &lt;/li&gt;
  69 &lt;/ul&gt;
  70 &lt;a href=&quot;#StreamMetadata&quot;&gt;Native Stream Metadata Format&lt;/a&gt;&lt;br/&gt;
  71 &lt;a href=&quot;#ImageMetadata&quot;&gt;Native Image Metadata Format&lt;/a&gt;
  72 
  73 &lt;h2&gt;&lt;a id=&quot;Reading&quot;&gt;Reading Images&lt;/a&gt;&lt;/h2&gt;
  74 
  75 TIFF images are read by an &lt;a href=&quot;../../ImageReader.html&quot;&gt;ImageReader&lt;/a&gt;
  76 which may be controlled by its public interface as well as via a supplied
  77 &lt;a href=&quot;../../plugins/tiff/TIFFImageReadParam.html&quot;&gt;TIFFImageReadParam&lt;/a&gt;.
  78 
  79 &lt;!-- &lt;h3&gt;Supported Image Types&lt;/h3&gt; --&gt;
  80 
  81 &lt;!-- Table? --&gt;
  82 
  83 &lt;h3&gt;&lt;a id=&quot;ColorConversionRead&quot;&gt;Color Conversion&lt;/a&gt;&lt;/h3&gt;
  84 
  85 &lt;p&gt;If the source image data
  86 have photometric type CIE L*a*b* or YCbCr, and the destination color space
  87 type is RGB, then the source image data will be automatically converted to
  88 RGB using an internal color converter.&lt;/p&gt;
  89 
  90 &lt;h3&gt;&lt;a id=&quot;ColorSpacesRead&quot;&gt;Color Spaces&lt;/a&gt;&lt;/h3&gt;
  91 
  92 The raw color space assigned by default, i.e., in the absence of a
  93 user-supplied &lt;a href=&quot;../../ImageTypeSpecifier.html&quot;&gt;ImageTypeSpecifier&lt;/a&gt;,
  94 will be the first among the following which applies:
  95 
  96 &lt;ul&gt;
  97 &lt;li&gt;A color space created from the &lt;a href=&quot;#ICCProfilesRead&quot;&gt;ICC Profile&lt;/a&gt;
  98 metadata field if it is present and compatible with the image data
  99 layout.&lt;/li&gt;
 100 &lt;li&gt;&lt;a id=&quot;nonICCProfile&quot;&gt;&lt;/a&gt;sRGB if the image is monochrome/bilevel
 101 (a two-level color map is created internally).&lt;/li&gt;
 102 &lt;li&gt;sRGB if the image is palette-color.&lt;/li&gt;
 103 &lt;li&gt;Linear RGB if the image has three samples per pixel, has photometric type
 104 CIE L*a*b*, or has photometric type YCbCr and is &lt;i&gt;not&lt;/i&gt;
 105 JPEG-compressed.&lt;/li&gt;
 106 &lt;li&gt;A &lt;a href=&quot;#DefaultCMYK&quot;&gt;default CMYK color space&lt;/a&gt; if the image has
 107 photometric type CMYK and four samples per pixel.&lt;/li&gt;
 108 &lt;li&gt;Grayscale if the image has one or two samples per pixel and uniformly
 109 1, 2, 4, 8, 16, or 32 bits per sample or is floating point.&lt;/li&gt;
 110 &lt;li&gt;sRGB if the image has three or four samples per pixel and uniformly
 111 1, 2, 4, 8, 16, or 32 bits per sample or is floating point.&lt;/li&gt;
 112 &lt;li&gt;A fabricated, &lt;a href=&quot;#GenericCS&quot;&gt;generic color space&lt;/a&gt; if the image
 113 has more than four samples per pixel and the number of bits per sample for
 114 all bands is the same and is a multiple of 8.&lt;/li&gt;
 115 &lt;li&gt;Grayscale if the image has one or two samples per pixel regardless of
 116 the number of bits per sample.&lt;/li&gt;
 117 &lt;li&gt;sRGB if the image has three or four samples per pixel regardless of
 118 the number of bits per sample.&lt;/li&gt;
 119 &lt;li&gt;A fabricated, &lt;a href=&quot;#GenericCS&quot;&gt;generic color space&lt;/a&gt; if the image
 120 has more than four samples per pixel regardless of the number of bits per
 121 sample.&lt;/li&gt;
 122 &lt;/ul&gt;
 123 
 124 &lt;p&gt;&lt;a id=&quot;DefaultCMYK&quot;&gt;&lt;/a&gt;The normalized color coordinate transformations
 125 used for the default CMYK color space are defined as follows:
 126 
 127 &lt;ul&gt;
 128 &lt;li&gt;CMYK to linear RGB
 129 &lt;pre&gt;
 130 R = (1 - K)*(1 - C)
 131 G = (1 - K)*(1 - M)
 132 B = (1 - K)*(1 - Y)
 133 &lt;/pre&gt;
 134 &lt;/li&gt;
 135 &lt;li&gt;Linear RGB to CMYK
 136 &lt;pre&gt;
 137 K = min{1 - R, 1 - G, 1 - B}
 138 if(K != 1) {
 139     C = (1 - R - K)/(1 - K)
 140     M = (1 - G - K)/(1 - K)
 141     Y = (1 - B - K)/(1 - K)
 142 } else {
 143     C = M = Y = 0
 144 }
 145 &lt;/pre&gt;
 146 &lt;/li&gt;
 147 &lt;/ul&gt;
 148 
 149 &lt;p&gt;&lt;a id=&quot;GenericCS&quot;&gt;&lt;/a&gt;The generic color space used when no other color space
 150 can be inferred is provided merely to enable the data to be loaded. It is not
 151 intended to provide accurate conversions of any kind.&lt;/p&gt;
 152 
 153 &lt;p&gt;If the data are known to be in a color space not correctly handled by the
 154 foregoing, then an &lt;code&gt;ImageTypeSpecifier&lt;/code&gt; should be
 155 supplied to the reader and should be derived from a color space which is correct
 156 for the data in question.&lt;/p&gt;
 157 
 158 &lt;h3&gt;&lt;a id=&quot;ICCProfilesRead&quot;&gt;ICC Profiles&lt;/a&gt;&lt;/h3&gt;
 159 
 160 If an ICC profile is contained in the image metadata
 161 (&lt;a href=&quot;../../plugins/tiff/BaselineTIFFTagSet.html&quot;&gt;
 162 BaselineTIFFTagSet&lt;/a&gt;.TAG_ICC_PROFILE, tag number 34675),
 163 an attempt will be made to use it to create the color space
 164 of the loaded image. It will be used if the data layout is of component type
 165 and the number of samples per pixel equals or is one greater than the number
 166 of components described by the ICC profile. If the ICC profile is not used
 167 then the color space will be inferred in one of the subsequent steps described
 168 &lt;a href=&quot;#nonICCProfile&quot;&gt;above&lt;/a&gt;.
 169 
 170 &lt;p&gt;If for some reason the embedded ICC profile is not used automatically, then
 171 it may be used manually by following this procedure:
 172 
 173 &lt;ol&gt;
 174 &lt;li&gt;Obtain the image metadata from
 175 &lt;code&gt;ImageReader.getImageMetadata&lt;/code&gt;&lt;/li&gt;
 176 &lt;li&gt;Extract the ICC profile field and its value.&lt;/li&gt;
 177 &lt;li&gt;Create an &lt;a href=&quot;../../../../java/awt/color/ICC_ColorSpace.html&quot;&gt;
 178 ICC_ColorSpace&lt;/a&gt; from an
 179 &lt;a href=&quot;../../../../java/awt/color/ICC_Profile.html&quot;&gt;
 180 ICC_Profile&lt;/a&gt; created from the ICC profile field data
 181 using &lt;code&gt;ICC_Profile.getInstance(byte[])&lt;/code&gt;.&lt;/li&gt;
 182 &lt;li&gt;Create an &lt;code&gt;ImageTypeSpecifier&lt;/code&gt; from the new color
 183 space using one of its factory methods which accepts an
 184 &lt;code&gt;ICC_ColorSpace&lt;/code&gt;.
 185 &lt;li&gt;Create a compatible &lt;a href=&quot;../../ImageReadParam.html&quot;&gt;ImageReadParam&lt;/a&gt;
 186 and set the &lt;code&gt;ImageTypeSpecifier&lt;/code&gt; using
 187 &lt;code&gt;ImageReadParam.setDestinationType&lt;/code&gt;.&lt;/li&gt;
 188 &lt;li&gt;Pass the parameter object to the appropriate &lt;code&gt;read&lt;/code&gt; method.&lt;/li&gt;
 189 &lt;/ol&gt;
 190 
 191 &lt;p&gt;If the inferred color space not based on the ICC Profile field is compatible
 192 with the ICC profile-based color space, then a second
 193 &lt;code&gt;ImageTypeSpecifier&lt;/code&gt; derived from this inferred color
 194 space will be included in the
 195 {@link java.util.Iterator Iterator} returned by
 196 &lt;code&gt;ImageReader.getImageTypes&lt;/code&gt;. If the iterator contains
 197 more than one type, the first one will be based on the ICC profile and the
 198 second on the inferred color space.&lt;/p&gt;
 199 
 200 &lt;h3&gt;&lt;a id=&quot;MetadataIssuesRead&quot;&gt;Metadata Issues&lt;/a&gt;&lt;/h3&gt;
 201 
 202 By default all recognized fields in the TIFF image file directory (IFD) are
 203 loaded into the native image metadata object. Which fields are loaded may be
 204 controlled by setting which TIFF tags the reader is allowed to recognize,
 205 whether to read fields with unrecognized tags, and whether to ignore all
 206 metadata. The reader is informed to disregard all metadata as usual via the
 207 &lt;code&gt;ignoreMetadata&lt;/code&gt; parameter of
 208 &lt;code&gt;ImageReader.setInput(Object,boolean,boolean)&lt;/code&gt;. It is
 209 informed of which &lt;a href=&quot;../../plugins/tiff/TIFFTag.html&quot;&gt;TIFFTag&lt;/a&gt;s to
 210 recognize or not to recognize via
 211 &lt;code&gt;TIFFImageReadParam.addAllowedTagSet(TIFFTagSet)&lt;/code&gt; and
 212 &lt;code&gt;TIFFImageReadParam.removeAllowedTagSet(TIFFTagSet)&lt;/code&gt;.
 213 If &lt;code&gt;ignoreMetadata&lt;/code&gt; is &lt;code&gt;true&lt;/code&gt;, then only metadata
 214 essential to reading the image will be loaded into the native image metadata
 215 object. If &lt;code&gt;ignoreMetadata&lt;/code&gt; is &lt;code&gt;false&lt;/code&gt;, then the reader
 216 will by default load into the native image metadata object only those fields
 217 which are either essential to reading the image or have a &lt;code&gt;TIFFTag&lt;/code&gt;
 218 contained in the one of the allowed &lt;code&gt;TIFFTagSet&lt;/code&gt;s. Reading of
 219 fields with tags not in the allowed &lt;code&gt;TIFFTagSet&lt;/code&gt;s may be forced
 220 by passing in a &lt;code&gt;TIFFImageReadParam&lt;/code&gt; on which
 221 &lt;code&gt;TIFFImageReadParam.setReadUnknownTags(boolean)&lt;/code&gt; has been
 222 invoked with parameter &lt;code&gt;true&lt;/code&gt;.
 223 
 224 &lt;p&gt;Use of a &lt;a href=&quot;../../plugins/tiff/TIFFDirectory.html&quot;&gt;TIFFDirectory&lt;/a&gt;
 225 object may simplify gaining access to metadata values. An instance of
 226 &lt;code&gt;TIFFDirectory&lt;/code&gt; may be created from the &lt;code&gt;IIOMetadata&lt;/code&gt;
 227 object returned by the TIFF reader using the
 228 &lt;code&gt;TIFFDirectory.createFromMetadata&lt;/code&gt; method.&lt;/p&gt;
 229 
 230 &lt;h4&gt;&lt;a id=&quot;MapNativeStandard&quot;&gt;&lt;/a&gt;
 231 Mapping of TIFF Native Image Metadata to the Standard Metadata Format&lt;/h4&gt;
 232 
 233 The derivation of standard metadata format
 234 &lt;a href=&quot;standard_metadata.html&quot;&gt;javax_imageio_1.0&lt;/a&gt;
 235 elements from &lt;a href=&quot;#ImageMetadata&quot;&gt;TIFF native image metadata&lt;/a&gt; is given
 236 in the following table.
 237 
 238 &lt;table border=&quot;1&quot;&gt;
 239 &lt;thead&gt;
 240 &lt;tr&gt;
 241 &lt;th scope=&quot;col&quot;&gt;Index&lt;/th&gt;
 242 &lt;th scope=&quot;col&quot;&gt;Standard Metadata Element&lt;/th&gt;
 243 &lt;th scope=&quot;col&quot;&gt;Derivation from TIFF Fields&lt;/th&gt;
 244 &lt;/tr&gt;
 245 &lt;/thead&gt;
 246 &lt;tbody&gt;
 247 &lt;tr&gt;
 248 &lt;th scope=&quot;row&quot;&gt;1&lt;/th&gt;
 249 &lt;td&gt;/Chroma/ColorSpaceType@name&lt;/td&gt;
 250 &lt;td&gt;PhotometricInterpretation: WhiteIsZero, BlackIsZero, TransparencyMask =
 251 &quot;GRAY&quot;; RGB, PaletteColor =&amp;gt; &quot;RGB&quot;; CMYK =&amp;gt; &quot;CMYK&quot;;
 252 YCbCr =&amp;gt; &quot;YCbCr&quot;;
 253 CIELab, ICCLab =&amp;gt; &quot;Lab&quot;.&lt;/td&gt;
 254 &lt;/tr&gt;
 255 &lt;tr&gt;
 256 &lt;th scope=&quot;row&quot;&gt;2&lt;/th&gt;
 257 &lt;td&gt;/Chroma/NumChannels@value&lt;/td&gt;
 258 &lt;td&gt;SamplesPerPixel&lt;/td&gt;
 259 &lt;/tr&gt;
 260 &lt;tr&gt;
 261 &lt;th scope=&quot;row&quot;&gt;3&lt;/th&gt;
 262 &lt;td&gt;/Chroma/BlackIsZero@value&lt;/td&gt;
 263 &lt;td&gt;&quot;TRUE&quot; &amp;lt;=&amp;gt; PhotometricInterpretation =&amp;gt; WhiteIsZero&lt;/td&gt;
 264 &lt;/tr&gt;
 265 &lt;tr&gt;
 266 &lt;th scope=&quot;row&quot;&gt;4&lt;/th&gt;
 267 &lt;td&gt;/Chroma/Palette&lt;/td&gt;
 268 &lt;td&gt;ColorMap&lt;/td&gt;
 269 &lt;/tr&gt;
 270 &lt;tr&gt;
 271 &lt;th scope=&quot;row&quot;&gt;5&lt;/th&gt;
 272 &lt;td&gt;/Compression/CompressionTypeName@value&lt;/td&gt;
 273 &lt;td&gt;Compression: Uncompressed =&amp;gt; &quot;none&quot;; CCITT 1D =&amp;gt; &quot;CCITT
 274 RLE&quot;;
 275 Group 3 Fax =&amp;gt; &quot;CCITT T.4&quot;; Group 4 Fax =&amp;gt; &quot;CCITT T.6&quot;;
 276 LZW =&amp;gt; &quot;LZW&quot;;
 277 JPEG =&amp;gt; &quot;Old JPEG&quot;; New JPEG =&amp;gt; &quot;JPEG&quot;; Zlib =&amp;gt;&amp;gt; &quot;ZLib&quot;; PackBits =&amp;gt;
 278 &quot;PackBits&quot;;
 279 Deflate =&amp;gt; &quot;Deflate&quot;; Exif JPEG =&amp;gt; &quot;JPEG&quot;.&lt;/td&gt;
 280 &lt;/tr&gt;
 281 &lt;tr&gt;
 282 &lt;th scope=&quot;row&quot;&gt;6&lt;/th&gt;
 283 &lt;td&gt;/Compression/Lossless@value&lt;/td&gt;
 284 &lt;td&gt;Compression: JPEG or New JPEG =&amp;gt; &quot;FALSE&quot;; otherwise &quot;TRUE&quot;.&lt;/td&gt;
 285 &lt;/tr&gt;
 286 &lt;tr&gt;
 287 &lt;th scope=&quot;row&quot;&gt;7&lt;/th&gt;
 288 &lt;td&gt;/Data/PlanarConfiguration@value&lt;/td&gt;
 289 &lt;td&gt;Chunky =&amp;gt; &quot;PixelInterleaved&quot;; Planar =&amp;gt; &quot;PlaneInterleaved&quot;.&lt;/td&gt;
 290 &lt;/tr&gt;
 291 &lt;tr&gt;
 292 &lt;th scope=&quot;row&quot;&gt;8&lt;/th&gt;
 293 &lt;td&gt;/Data/SampleFormat@value&lt;/td&gt;
 294 &lt;td&gt;PhotometricInterpretation PaletteColor =&amp;gt; &quot;Index&quot;;
 295 SampleFormat unsigned integer data =&amp;gt; &quot;UnsignedIntegral&quot;;
 296 SampleFormat two&#39;s complement signed integer data =&amp;gt; &quot;SignedIntegral&quot;;
 297 SampleFormat IEEE floating point data =&amp;gt; &quot;Real&quot;;
 298 otherwise element not emitted.
 299 &lt;/td&gt;
 300 &lt;/tr&gt;
 301 &lt;tr&gt;
 302 &lt;th scope=&quot;row&quot;&gt;9&lt;/th&gt;
 303 &lt;td&gt;/Data/BitsPerSample@value&lt;/td&gt;
 304 &lt;td&gt;BitsPerSample as a space-separated list.&lt;/td&gt;
 305 &lt;/tr&gt;
 306 &lt;tr&gt;
 307 &lt;th scope=&quot;row&quot;&gt;10&lt;/th&gt;
 308 &lt;td&gt;/Data/SampleMSB@value&lt;/td&gt;
 309 &lt;td&gt;FillOrder: left-to-right =&amp;gt; space-separated list of BitsPerSample-1;
 310 right-to-left =&amp;gt; space-separated list of 0s.&lt;/td&gt;
 311 &lt;/tr&gt;
 312 &lt;tr&gt;
 313 &lt;th scope=&quot;row&quot;&gt;11&lt;/th&gt;
 314 &lt;td&gt;/Dimension/PixelAspectRatio@value&lt;/td&gt;
 315 &lt;td&gt;(1/XResolution)/(1/YResolution)&lt;/td&gt;
 316 &lt;/tr&gt;
 317 &lt;tr&gt;
 318 &lt;th scope=&quot;row&quot;&gt;12&lt;/th&gt;
 319 &lt;td&gt;/Dimension/ImageOrientation@value&lt;/td&gt;
 320 &lt;td&gt;Orientation&lt;/td&gt;
 321 &lt;/tr&gt;
 322 &lt;tr&gt;
 323 &lt;th scope=&quot;row&quot;&gt;13&lt;/th&gt;
 324 &lt;td&gt;/Dimension/HorizontalPixelSize@value&lt;/td&gt;
 325 &lt;td&gt;1/XResolution in millimeters if ResolutionUnit is not None.&lt;/td&gt;
 326 &lt;/tr&gt;
 327 &lt;tr&gt;
 328 &lt;th scope=&quot;row&quot;&gt;14&lt;/th&gt;
 329 &lt;td&gt;/Dimension/VerticalPixelSize@value&lt;/td&gt;
 330 &lt;td&gt;1/YResolution in millimeters if ResolutionUnit is not None.&lt;/td&gt;
 331 &lt;/tr&gt;
 332 &lt;tr&gt;
 333 &lt;th scope=&quot;row&quot;&gt;15&lt;/th&gt;
 334 &lt;td&gt;/Dimension/HorizontalPosition@value&lt;/td&gt;
 335 &lt;td&gt;XPosition in millimeters if ResolutionUnit is not None.&lt;/td&gt;
 336 &lt;/tr&gt;
 337 &lt;tr&gt;
 338 &lt;th scope=&quot;row&quot;&gt;16&lt;/th&gt;
 339 &lt;td&gt;/Dimension/VerticalPosition@value&lt;/td&gt;
 340 &lt;td&gt;YPosition in millimeters if ResolutionUnit is not None.&lt;/td&gt;
 341 &lt;/tr&gt;
 342 &lt;tr&gt;
 343 &lt;th scope=&quot;row&quot;&gt;17&lt;/th&gt;
 344 &lt;td&gt;/Document/FormatVersion@value&lt;/td&gt;
 345 &lt;td&gt;6.0&lt;/td&gt;
 346 &lt;/tr&gt;
 347 &lt;tr&gt;
 348 &lt;th scope=&quot;row&quot;&gt;18&lt;/th&gt;
 349 &lt;td&gt;/Document/SubimageInterpretation@value&lt;/td&gt;
 350 &lt;td&gt;NewSubFileType: transparency =&amp;gt; &quot;TransparencyMask&quot;;
 351 reduced-resolution =&amp;gt; &quot;ReducedResolution&quot;;
 352 single page =&amp;gt; &quot;SinglePage&quot;.&lt;/td&gt;
 353 &lt;/tr&gt;
 354 &lt;tr&gt;
 355 &lt;th scope=&quot;row&quot;&gt;19&lt;/th&gt;
 356 &lt;td&gt;/Document/ImageCreationTime@value&lt;/td&gt;
 357 &lt;td&gt;DateTime&lt;/td&gt;
 358 &lt;/tr&gt;
 359 &lt;tr&gt;
 360 &lt;th scope=&quot;row&quot;&gt;20&lt;/th&gt;
 361 &lt;td&gt;/Text/TextEntry&lt;/td&gt;
 362 &lt;td&gt;DocumentName, ImageDescription, Make, Model, PageName, Software,
 363 Artist, HostComputer, InkNames, Copyright:
 364 /Text/TextEntry@keyword = field name,
 365 /Text/TextEntry@value = field value.&lt;br&gt;
 366 Example: TIFF Software field =&amp;gt; /Text/TextEntry@keyword = &quot;Software&quot;,
 367 /Text/TextEntry@value = Name and version number of the software package(s)
 368 used to create the image.&lt;/td&gt;
 369 &lt;/tr&gt;
 370 &lt;tr&gt;
 371 &lt;th scope=&quot;row&quot;&gt;21&lt;/th&gt;
 372 &lt;td&gt;/Transparency/Alpha@value&lt;/td&gt;
 373 &lt;td&gt;ExtraSamples: associated alpha =&amp;gt; &quot;premultiplied&quot;;
 374 unassociated alpha =&amp;gt; &quot;nonpremultiplied&quot;.&lt;/td&gt;
 375 &lt;/tr&gt;
 376 &lt;/tbody&gt;
 377 &lt;/table&gt;
 378 
 379 &lt;h3&gt;&lt;a id=&quot;ExifRead&quot;&gt;Reading Exif Images&lt;/a&gt;&lt;/h3&gt;
 380 
 381 The TIFF reader may be used to read an uncompressed Exif image or the
 382 contents of the &lt;code&gt;APP1&lt;/code&gt; marker segment of a compressed Exif image.
 383 
 384 &lt;h4&gt;&lt;a id=&quot;ExifReadTIFF&quot;&gt;Reading Uncompressed Exif Images&lt;/a&gt;&lt;/h4&gt;
 385 
 386 An uncompressed Exif image is a one- or two-page uncompressed TIFF image
 387 with a specific ordering of its IFD and image data content. Each pixel
 388 has three 8-bit samples with photometric interpretation RGB or YCbCr.
 389 The image stream must contain a single primary image and may contain a
 390 single thumbnail which if present must also be uncompressed. The usual
 391 &lt;code&gt;ImageReader&lt;/code&gt; methods may be used to read the image
 392 data and metadata:
 393 
 394 &lt;pre&gt;&lt;code&gt;
 395     ImageInputStream input;
 396     ImageReader tiffReader;
 397     ImageReadParam tiffReadParam;
 398 
 399     tiffReader.setInput(input);
 400 
 401     // Read primary image and IFD.
 402     BufferedImage image = tiffReader.read(0, tiffReadParam);
 403     IIOMetadata primaryIFD = tiffReader.getImageMetadata(0);
 404 
 405     // Read thumbnail if present.
 406     BufferedImage thumbnail = null;
 407     if (tiffReader.getNumImages(true) &gt; 1) {
 408         thumbnail = tiffReader.read(1, tiffReadParam);
 409     }
 410 &lt;/code&gt;&lt;/pre&gt;
 411 
 412 Note that the Exif thumbnail is treated as a separate page in the TIFF
 413 stream and not as a thumbnail, i.e.,
 414 &lt;code&gt;tiffReader.hasThumbnails(0)&lt;/code&gt; will return &lt;code&gt;false&lt;/code&gt;.
 415 
 416 &lt;h4&gt;&lt;a id=&quot;ExifReadJPEG&quot;&gt;Reading Compressed Exif Images&lt;/a&gt;&lt;/h4&gt;
 417 
 418 A compressed Exif image is a 3-band ISO/IEC 10918-1 baseline DCT JPEG stream
 419 with an inserted &lt;code&gt;APP1&lt;/code&gt; marker segment. The parameters of the marker
 420 segment after the length are the 6-byte sequence
 421 &lt;code&gt;{&#39;E&#39;,&amp;nbsp;&#39;x&#39;,&amp;nbsp;&#39;i&#39;,&amp;nbsp;&#39;f&#39;,&amp;nbsp;0x00,&amp;nbsp;0x00}&lt;/code&gt;
 422 followed by a complete TIFF stream. The embedded TIFF stream contains a primary
 423 IFD describing the JPEG image optionally followed by a thumbnail IFD and
 424 compressed or uncompressed thumbnail image data. Note that the embedded TIFF
 425 stream does not contain any image data associated with the primary IFD
 426 nor any descriptive fields which duplicate information found in the JPEG
 427 stream itself.
 428 
 429 &lt;p&gt;The parameter content of the &lt;code&gt;APP1&lt;/code&gt; marker segment may be obtained
 430 from the user object of the associated &lt;code&gt;Node&lt;/code&gt; in a
 431 &lt;code&gt;javax_imageio_jpeg_image_1.0&lt;/code&gt; native image metadata tree extracted
 432 from the image metadata object returned by the JPEG reader. This APP1 Exif
 433 node will be a child of the node named &quot;markerSequence&quot; and will
 434 have name &lt;code&gt;unknown&lt;/code&gt; and an attribute named &lt;code&gt;MarkerTag&lt;/code&gt; with
 435 integral value &lt;code&gt;0xE1&lt;/code&gt; (&lt;code&gt;String&lt;/code&gt; value
 436 &lt;code&gt;&quot;225&quot;&lt;/code&gt;). The user object of this node will be a byte array
 437 which starts with the six bytes &lt;code&gt;{&#39;E&#39;, &#39;x&#39;, &#39;i&#39;, &#39;f&#39;, &#39;0&#39;, &#39;0&#39;}&lt;/code&gt;.
 438 The primary IFD and the thumbnail IFD and image may be
 439 read from the user object by the usual &lt;code&gt;ImageReader&lt;/code&gt;
 440 methods:
 441 
 442 &lt;pre&gt;&lt;code&gt;
 443     ImageReader jpegReader;
 444     ImageReader tiffReader;
 445 
 446     // Obtain the APP1 Exif marker data from the JPEG image metadata.
 447     IIOMetadata jpegImageMetadata = jpegReader.getImageMetadata(0);
 448     String nativeFormat = jpegImageMetadata.getNativeMetadataFormatName();
 449     Node jpegImageMetadataTree = jpegImageMetadata.getAsTree(nativeFormat);
 450 
 451     // getExifMarkerData() returns the byte array which is the user object
 452     // of the APP1 Exif marker node.
 453     byte[] app1Params = getExifMarkerData(jpegImageMetadataTree);
 454     if (app1Params == null) {
 455         throw new IIOException(&quot;APP1 Exif marker not found.&quot;);
 456     }
 457 
 458     // Set up input, skipping Exif ID 6-byte sequence.
 459     MemoryCacheImageInputStream app1ExifInput
 460         = new MemoryCacheImageInputStream
 461             (new ByteArrayInputStream(app1Params, 6, app1Params.length - 6));
 462     tiffReader.setInput(app1ExifInput);
 463 
 464     // Read primary IFD.
 465     IIOMetadata primaryIFD = tiffReader.getImageMetadata(0);
 466 
 467     // Read thumbnail if present.
 468     BufferedImage thumbnail = null;
 469     if (tiffReader.getNumImages(true) &gt; 1) {
 470         thumbnail = tiffReader.read(1, tiffReadParam);
 471     }
 472 
 473     // Read the primary image.
 474     BufferedImage image = jpegReader.read(0);
 475 &lt;/code&gt;&lt;/pre&gt;
 476 
 477 Note that &lt;code&gt;tiffReader.getNumImages(true)&lt;/code&gt; returns the number of
 478 IFDs in the embedded TIFF stream including those corresponding to empty
 479 images. Calling &lt;code&gt;tiffReader.read(0,&amp;nbsp;readParam)&lt;/code&gt; will throw
 480 an exception as the primary image in the embedded TIFF stream is always
 481 empty; the primary image should be obtained using the JPEG reader itself.
 482 
 483 &lt;h2&gt;&lt;a id=&quot;Writing&quot;&gt;Writing Images&lt;/a&gt;&lt;/h2&gt;
 484 
 485 TIFF images are written by a &lt;a href=&quot;../../ImageWriter.html&quot;&gt;ImageWriter&lt;/a&gt; which may be
 486 controlled by its public interface as well as via a supplied
 487 &lt;a href=&quot;../../ImageWriteParam.html&quot;&gt;ImageWriteParam&lt;/a&gt;.  For an &lt;code&gt;ImageWriteParam&lt;/code&gt; returned
 488 by the &lt;code&gt;getDefaultWriteParam()&lt;/code&gt; method of the TIFF &lt;code&gt;ImageWriter&lt;/code&gt;,
 489 the &lt;code&gt;canWriteTiles()&lt;/code&gt; and &lt;code&gt;canWriteCompressed()&lt;/code&gt; methods
 490 will return &lt;code&gt;true&lt;/code&gt;; the &lt;code&gt;canOffsetTiles()&lt;/code&gt; and
 491 &lt;code&gt;canWriteProgressive()&lt;/code&gt; methods will return &lt;code&gt;false&lt;/code&gt;.
 492 
 493 The TIFF writer supports many optional capabilities including writing tiled
 494 images, inserting images, writing or inserting empty images, and replacing image
 495 data. Pixels may be replaced in either empty or non-empty images but if and
 496 only if the data are not compressed.
 497 
 498 &lt;p&gt; If tiles are being written, then each of their dimensions will be
 499 rounded to the nearest multiple of 16 per the TIFF specification. If
 500 JPEG-in-TIFF compression is being used, and tiles are being written
 501 each tile dimension will be rounded to the nearest multiple of 8 times
 502 the JPEG minimum coded unit (MCU) in that dimension. If JPEG-in-TIFF
 503 compression is being used and strips are being written, the number of
 504 rows per strip is rounded to a multiple of 8 times the maximum MCU over
 505 both dimensions.&lt;/p&gt;
 506 
 507  &lt;!-- &lt;h3&gt;Supported Image Types&lt;/h3&gt; --&gt;
 508 
 509 &lt;!-- Table? --&gt;
 510 
 511 &lt;h3&gt;&lt;a id=&quot;Compression&quot;&gt;Compression&lt;/a&gt;&lt;/h3&gt;
 512 
 513 The compression type may be set via the &lt;code&gt;setCompressionType()&lt;/code&gt; method of
 514 the &lt;code&gt;ImageWriteParam&lt;/code&gt; after setting the compression mode to
 515 &lt;code&gt;MODE_EXPLICIT&lt;/code&gt;. The set of innately
 516 supported compression types is listed in the following table:
 517 
 518 &lt;table border=1&gt;
 519 &lt;caption&gt;&lt;b&gt;Supported Compression Types&lt;/b&gt;&lt;/caption&gt;
 520 &lt;thead&gt;
 521 &lt;tr&gt;
 522   &lt;th scope=&quot;col&quot;&gt;Index&lt;/th&gt;
 523   &lt;th scope=&quot;col&quot;&gt;Compression Type&lt;/th&gt;
 524   &lt;th scope=&quot;col&quot;&gt;Description&lt;/th&gt;
 525   &lt;th scope=&quot;col&quot;&gt;Reference&lt;/th&gt;
 526 &lt;/tr&gt;
 527 &lt;/thead&gt;
 528 &lt;tbody&gt;
 529 &lt;tr&gt;
 530 &lt;th scope=&quot;row&quot;&gt;1&lt;/th&gt;
 531 &lt;td&gt;CCITT RLE&lt;/td&gt;
 532 &lt;td&gt;Modified Huffman compression&lt;/td&gt;
 533 &lt;td&gt;TIFF 6.0 Specification, Section 10&lt;/td&gt;
 534 &lt;/tr&gt;
 535 &lt;tr&gt;
 536 &lt;th scope=&quot;row&quot;&gt;2&lt;/th&gt;
 537 &lt;td&gt;CCITT T.4&lt;/td&gt;
 538 &lt;td&gt;CCITT T.4 bilevel encoding/Group 3 facsimile compression&lt;/td&gt;
 539 &lt;td&gt;TIFF 6.0 Specification, Section 11&lt;/td&gt;
 540 &lt;/tr&gt;
 541 &lt;tr&gt;
 542 &lt;th scope=&quot;row&quot;&gt;3&lt;/th&gt;
 543 &lt;td&gt;CCITT T.6&lt;/td&gt;
 544 &lt;td&gt;CCITT T.6 bilevel encoding/Group 4 facsimile compression&lt;/td&gt;
 545 &lt;td&gt;TIFF 6.0 Specification, Section 11&lt;/td&gt;&lt;/tr&gt;
 546 &lt;tr&gt;
 547 &lt;th scope=&quot;row&quot;&gt;4&lt;/th&gt;
 548 &lt;td&gt;LZW&lt;/td&gt;
 549 &lt;td&gt;LZW compression&lt;/td&gt;
 550 &lt;td&gt;TIFF 6.0 Specification, Section 13&lt;/td&gt;&lt;/tr&gt;
 551 &lt;tr&gt;
 552 &lt;th scope=&quot;row&quot;&gt;5&lt;/th&gt;
 553 &lt;td&gt;JPEG&lt;/td&gt;
 554 &lt;td&gt;&quot;New&quot; JPEG-in-TIFF compression&lt;/td&gt;
 555 &lt;td&gt;TIFF Technical Note #2&lt;/td&gt;&lt;/tr&gt;
 556 &lt;tr&gt;
 557 &lt;th scope=&quot;row&quot;&gt;6&lt;/th&gt;
 558 &lt;td&gt;ZLib&lt;/td&gt;
 559 &lt;td&gt;&quot;Deflate/Inflate&quot; compression (see note following this table)&lt;/td&gt;
 560 &lt;td&gt;Adobe Photoshop&amp;#174; TIFF Technical Notes&lt;/td&gt;
 561 &lt;/tr&gt;
 562 &lt;tr&gt;
 563 &lt;th scope=&quot;row&quot;&gt;7&lt;/th&gt;
 564 &lt;td&gt;PackBits&lt;/td&gt;
 565 &lt;td&gt;Byte-oriented, run length compression&lt;/td&gt;
 566 &lt;td&gt;TIFF 6.0 Specification, Section 9&lt;/td&gt;
 567 &lt;/tr&gt;
 568 &lt;tr&gt;
 569 &lt;th scope=&quot;row&quot;&gt;8&lt;/th&gt;
 570 &lt;td&gt;Deflate&lt;/td&gt;
 571 &lt;td&gt;&quot;Zip-in-TIFF&quot; compression (see note following this table)&lt;/td&gt;
 572 &lt;td&gt;&lt;a href=&quot;https://tools.ietf.org/html/rfc1950&quot;&gt;
 573 ZLIB Compressed Data Format Specification&lt;/a&gt;,
 574 &lt;a href=&quot;https://tools.ietf.org/html/rfc1951&quot;&gt;
 575 DEFLATE Compressed Data Format Specification&lt;/a&gt;&lt;/td&gt;
 576 &lt;/tr&gt;
 577 &lt;tr&gt;
 578 &lt;th scope=&quot;row&quot;&gt;9&lt;/th&gt;
 579 &lt;td&gt;Exif JPEG&lt;/td&gt;
 580 &lt;td&gt;Exif-specific JPEG compression (see note following this table)&lt;/td&gt;
 581 &lt;td&gt;&lt;a href=&quot;http://www.exif.org/Exif2-2.PDF&quot;&gt;Exif 2.2 Specification&lt;/a&gt;
 582 (PDF), section 4.5.5, &quot;Basic Structure of Thumbnail Data&quot;&lt;/td&gt;
 583 &lt;/tbody&gt;
 584 &lt;/table&gt;
 585 
 586 &lt;p&gt;
 587 Old-style JPEG compression as described in section 22 of the TIFF 6.0
 588 Specification is &lt;i&gt;not&lt;/i&gt; supported.
 589 &lt;/p&gt;
 590 
 591 &lt;p&gt; The CCITT compression types are applicable to bilevel (1-bit)
 592 images only.  The JPEG compression type is applicable to byte
 593 grayscale (1-band) and RGB (3-band) images only.&lt;/p&gt;
 594 
 595 &lt;p&gt;
 596 ZLib and Deflate compression are identical except for the value of the
 597 TIFF Compression field: for ZLib the Compression field has value 8
 598 whereas for Deflate it has value 32946 (0x80b2). In both cases each
 599 image segment (strip or tile) is written as a single complete zlib data
 600 stream.
 601 &lt;/p&gt;
 602 
 603 &lt;p&gt;
 604 &quot;Exif JPEG&quot; is a compression type used when writing the contents of an
 605 APP1 Exif marker segment for inclusion in a JPEG native image metadata
 606 tree. The contents appended to the output when this compression type is
 607 used are a function of whether an empty or non-empty image is written.
 608 If the image is empty, then a TIFF IFD adhering to the specification of
 609 a compressed Exif primary IFD is appended. If the image is non-empty,
 610 then a complete IFD and image adhering to the specification of a
 611 compressed Exif thumbnail IFD and image are appended. Note that the
 612 data of the empty image may &lt;i&gt;not&lt;/i&gt; later be appended using the pixel
 613 replacement capability of the TIFF writer.
 614 &lt;/p&gt;
 615 
 616 &lt;p&gt; If ZLib/Deflate or JPEG compression is used, the compression quality
 617 may be set. For ZLib/Deflate the supplied floating point quality value is
 618 rescaled to the range &lt;code&gt;[1,&amp;nbsp;9]&lt;/code&gt; and truncated to an integer
 619 to derive the Deflate compression level. For JPEG the floating point
 620 quality value is passed directly to the JPEG writer plug-in which
 621 interprets it in the usual way.&lt;/p&gt;
 622 
 623 &lt;h3&gt;&lt;a id=&quot;ColorConversionWrite&quot;&gt;Color Conversion&lt;/a&gt;&lt;/h3&gt;
 624 
 625 &lt;p&gt;If the source image data
 626 color space type is RGB, and the destination photometric type is CIE L*a*b* or
 627 YCbCr, then the source image data will be automatically converted from
 628 RGB using an internal color converter.&lt;/p&gt;
 629 
 630 &lt;h3&gt;&lt;a id=&quot;ICCProfilesWrite&quot;&gt;ICC Profiles&lt;/a&gt;&lt;/h3&gt;
 631 
 632 An &lt;code&gt;ICC Profile&lt;/code&gt; field will be written if either:
 633 &lt;ul&gt;
 634 &lt;li&gt;one is present in the native image metadata
 635 &lt;a href=&quot;../IIOMetadata.html&quot;&gt;IIOMetadata&lt;/a&gt; instance supplied to the writer,
 636 or&lt;/li&gt;
 637 &lt;li&gt;the &lt;a href=&quot;../../../../java/awt/color/ColorSpace.html&quot;&gt;ColorSpace&lt;/a&gt;
 638 of the destination &lt;code&gt;ImageTypeSpecifier&lt;/code&gt; is an instance of
 639 &lt;code&gt;ICC_ColorSpace&lt;/code&gt; which is not one of the standard
 640 color spaces defined by the &lt;code&gt;CS_*&lt;/code&gt; constants in the
 641 &lt;code&gt;ColorSpace&lt;/code&gt; class. The destination type is set via
 642 &lt;code&gt;ImageWriteParam.setDestinationType(ImageTypeSpecifier)&lt;/code&gt; and defaults
 643 to the &lt;code&gt;ImageTypeSpecifier&lt;/code&gt; of the image being written.
 644 &lt;/li&gt;
 645 &lt;/ul&gt;
 646 
 647 &lt;h3&gt;&lt;a id=&quot;MetadataIssuesWrite&quot;&gt;Metadata Issues&lt;/a&gt;&lt;/h3&gt;
 648 
 649 Some behavior of the writer is affected by or may affect the contents of
 650 the image metadata which may be supplied by the user.
 651 
 652 &lt;p&gt;For bilevel images, the &lt;code&gt;FillOrder&lt;/code&gt;, and &lt;code&gt;T4Options&lt;/code&gt;
 653 fields affect the output data. The data will be filled right-to-left if
 654 &lt;code&gt;FillOrder&lt;/code&gt; is present with a value of 2
 655 (&lt;code&gt;BaselineTIFFTagSet.FILL_ORDER_RIGHT_TO_LEFT&lt;/code&gt;)
 656 and will be filled left-to-right otherwise. The value of &lt;code&gt;T4Options&lt;/code&gt;
 657 specifies whether the data should be 1D- or 2D-encoded and whether EOL
 658 padding should be used.&lt;/p&gt;
 659 
 660 &lt;p&gt;For all images the value of the &lt;code&gt;RowsPerStrip&lt;/code&gt; field is used
 661 to the set the number of rows per strip if the image is not tiled. The
 662 default number of rows per strip is either 8 or the number of rows which
 663 would fill no more than 8 kilobytes, whichever is larger.&lt;/p&gt;
 664 
 665 &lt;p&gt;For all images the tile dimensions may be set using the &lt;code&gt;TileWidth&lt;/code&gt;
 666 and &lt;code&gt;TileLength&lt;/code&gt; field values if the tiling mode is
 667 &lt;code&gt;ImageWriteParam.MODE_COPY_FROM_METADATA&lt;/code&gt;. If this mode
 668 is set but the fields are not, their respective default values are the image
 669 width and height.&lt;/p&gt;
 670 
 671 &lt;p&gt;When using JPEG-in-TIFF compression, a &lt;code&gt;JPEGTables&lt;/code&gt; field will be
 672 written to the IFD and abbreviated JPEG streams to each strip or tile if and
 673 only if a &lt;code&gt;JPEGTables&lt;/code&gt; field is contained in the metadata object
 674 provided to the writer. If the contents of the &lt;code&gt;JPEGTables&lt;/code&gt; field is
 675 a valid tables-only JPEG stream, then it will be used; otherwise the contents
 676 of the field will be replaced with default visually lossless tables. If no
 677 such &lt;code&gt;JPEGTables&lt;/code&gt; field is present in the metadata, then no
 678 &lt;code&gt;JPEGTables&lt;/code&gt; field will be written to the output and each strip or
 679 tile will be written as a separate, self-contained JPEG stream.&lt;/p&gt;
 680 
 681 &lt;p&gt;When using Deflate/ZLib or LZW compression, if the image has 8 bits per
 682 sample, a horizontal differencing predictor will be used if the
 683 &lt;code&gt;Predictor&lt;/code&gt; field is present with a value of 2
 684 (&lt;code&gt;BaselineTIFFTagSet.PREDICTOR_HORIZONTAL_DIFFERENCING&lt;/code&gt;).
 685 If prediction is so requested but the image does not have
 686 8 bits per sample the field will be reset to have the value 1
 687 (&lt;code&gt;BaselineTIFFTagSet.PREDICTOR_NONE&lt;/code&gt;).
 688 &lt;/p&gt;
 689 
 690 &lt;p&gt;Some fields may be added or modified:
 691 
 692 &lt;ul&gt;
 693 &lt;li&gt;&lt;code&gt;PhotometricInterpretation&lt;/code&gt; if not present.&lt;/li&gt;
 694 &lt;li&gt;&lt;code&gt;PlanarConfiguration&lt;/code&gt; if this field is present with value
 695 &lt;code&gt;Planar&lt;/code&gt; is is reset to &lt;code&gt;Chunky&lt;/code&gt;.&lt;/li&gt;
 696 &lt;li&gt;&lt;code&gt;Compression&lt;/code&gt; always.&lt;/li&gt;
 697 &lt;li&gt;&lt;code&gt;BitsPerSample&lt;/code&gt; if the image is not bilevel.&lt;/li&gt;
 698 &lt;li&gt;&lt;code&gt;SamplesPerPixel&lt;/code&gt; always.&lt;/li&gt;
 699 &lt;li&gt;&lt;code&gt;ExtraSamples&lt;/code&gt; if an alpha channel is present.&lt;/li&gt;
 700 &lt;li&gt;&lt;code&gt;SampleFormat&lt;/code&gt; if not present and the data are 16- or 32-bit
 701 integers or floating point.&lt;/li&gt;
 702 &lt;li&gt;&lt;code&gt;ColorMap&lt;/code&gt; if the &lt;code&gt;PhotometricInterpretation&lt;/code&gt; is
 703 &lt;code&gt;RGBPalette&lt;/code&gt;.&lt;/li&gt;
 704 &lt;li&gt;&lt;code&gt;ImageWidth&lt;/code&gt; and &lt;code&gt;ImageLength&lt;/code&gt; always.&lt;/li&gt;
 705 &lt;li&gt;&lt;code&gt;TileWidth&lt;/code&gt;, &lt;code&gt;TileLength&lt;/code&gt;, &lt;code&gt;TileOffsets&lt;/code&gt;, and
 706 &lt;code&gt;TileByteCounts&lt;/code&gt; if a tiled image is being written.&lt;/li&gt;
 707 &lt;li&gt;&lt;code&gt;RowsPerStrip&lt;/code&gt;, &lt;code&gt;StripOffsets&lt;/code&gt;, and &lt;code&gt;StripByteCounts&lt;/code&gt;
 708 if a tiled image is &lt;i&gt;not&lt;/i&gt; being written.&lt;/li&gt;
 709 &lt;li&gt;&lt;code&gt;XResolution&lt;/code&gt;, &lt;code&gt;YResolution&lt;/code&gt;, and &lt;code&gt;ResolutionUnit&lt;/code&gt;
 710 if none of these is present.&lt;/li&gt;
 711 &lt;li&gt;&lt;code&gt;YCbCrSubsampling&lt;/code&gt; and &lt;code&gt;YCbCrPositioning&lt;/code&gt; if the
 712 photometric interpretation is YCbCr and the compression type is not JPEG
 713 (only [1,&amp;nbsp;1] subsampling and cosited positioning are supported for
 714 non-JPEG YCbCr output).&lt;/li&gt;
 715 &lt;li&gt;&lt;code&gt;YCbCrSubsampling&lt;/code&gt;, &lt;code&gt;YCbCrPositioning&lt;/code&gt;, and
 716 &lt;code&gt;ReferenceBlackWhite&lt;/code&gt;: if the compression type is JPEG and the color
 717 space is RGB these will be reset to [2,&amp;nbsp;2] centered subsampling with no
 718 headroom/footroom (0:255,128:255,128:255).&lt;/li&gt;
 719 &lt;/ul&gt;
 720 
 721 &lt;p&gt;Some fields may be removed:
 722 
 723 &lt;ul&gt;
 724 &lt;li&gt;&lt;code&gt;BitsPerSample&lt;/code&gt; if the image is bilevel.&lt;/li&gt;
 725 &lt;li&gt;&lt;code&gt;ExtraSamples&lt;/code&gt; if the image does not have an alpha channel.&lt;/li&gt;
 726 &lt;li&gt;&lt;code&gt;ColorMap&lt;/code&gt; if the photometric interpretation is not
 727 &lt;code&gt;RGBPalette&lt;/code&gt;.&lt;/li&gt;
 728 &lt;li&gt;&lt;code&gt;TileWidth&lt;/code&gt;, &lt;code&gt;TileLength&lt;/code&gt;, &lt;code&gt;TileOffsets&lt;/code&gt;, and
 729 &lt;code&gt;TileByteCounts&lt;/code&gt; if tiling &lt;i&gt;is not&lt;/i&gt; being used.&lt;/li&gt;
 730 &lt;li&gt;&lt;code&gt;RowsPerStrip&lt;/code&gt;, &lt;code&gt;StripOffsets&lt;/code&gt;, and &lt;code&gt;StripByteCounts&lt;/code&gt;
 731 if tiling &lt;i&gt;is&lt;/i&gt; being used.&lt;/li&gt;
 732 &lt;li&gt;&lt;code&gt;YCbCrSubsampling&lt;/code&gt;, &lt;code&gt;YCbCrPositioning&lt;/code&gt;, and
 733 &lt;code&gt;ReferenceBlackWhite&lt;/code&gt; if the compression type is JPEG and the
 734 color space is grayscale.&lt;/li&gt;
 735 &lt;li&gt;&lt;code&gt;JPEGProc&lt;/code&gt;, &lt;code&gt;JPEGInterchangeFormat&lt;/code&gt;,
 736 &lt;code&gt;JPEGInterchangeFormatLength&lt;/code&gt;, &lt;code&gt;JPEGRestartInterval&lt;/code&gt;,
 737 &lt;code&gt;JPEGLosslessPredictors&lt;/code&gt;, &lt;code&gt;JPEGPointTransforms&lt;/code&gt;,
 738 &lt;code&gt;JPEGQTables&lt;/code&gt;, &lt;code&gt;JPEGDCTables&lt;/code&gt;, and
 739 &lt;code&gt;JPEGACTables&lt;/code&gt; if the compression type is JPEG.&lt;/li&gt;
 740 &lt;/ul&gt;
 741 
 742 &lt;p&gt;Other fields present in the supplied metadata are uninterpreted and will
 743 be written as supplied.&lt;/p&gt;
 744 
 745 &lt;p&gt;If an Exif image is being written, the set of fields present and their
 746 values will be modified such that the result is in accord with the Exif 2.2
 747 specification.&lt;/p&gt;
 748 
 749 &lt;p&gt;Setting up the image metadata to write to a TIFF stream may be simplified
 750 by using the &lt;code&gt;TIFFDirectory&lt;/code&gt; class
 751 which represents a TIFF IFD. A field in a TIFF IFD is represented by an
 752 instance of &lt;a href=&quot;../../plugins/tiff/TIFFField.html&quot;&gt;TIFFField&lt;/a&gt;. For each
 753 field to be written a &lt;code&gt;TIFFField&lt;/code&gt; may be added to the
 754 &lt;code&gt;TIFFDirectory&lt;/code&gt; and the latter converted to an
 755 &lt;code&gt;IIOMetadata&lt;/code&gt; object by invoking
 756 &lt;code&gt;TIFFDirectory.getAsMetadata&lt;/code&gt;. The
 757 &lt;code&gt;IIOMetadata&lt;/code&gt; object so obtained may then be passed to the TIFF
 758 writer.&lt;/p&gt;
 759 
 760 &lt;h4&gt;&lt;a id=&quot;MapStandardNative&quot;&gt;&lt;/a&gt;
 761 Mapping of the Standard Metadata Format to TIFF Native Image Metadata&lt;/h4&gt;
 762 
 763 The derivation of &lt;a href=&quot;#ImageMetadata&quot;&gt;TIFF native image metadata&lt;/a&gt;
 764 elements from the standard metadata format
 765 &lt;a href=&quot;standard_metadata.html&quot;&gt;javax_imageio_1.0&lt;/a&gt; is
 766 given in the following table.
 767 
 768 &lt;table border=&quot;1&quot;&gt;
 769 &lt;thead&gt;
 770 &lt;tr&gt;
 771 &lt;th scope=&quot;col&quot;&gt;Index&lt;/th&gt;
 772 &lt;th scope=&quot;col&quot;&gt;TIFF Field&lt;/th&gt;
 773 &lt;th scope=&quot;col&quot;&gt;Derivation from Standard Metadata Elements&lt;/th&gt;
 774 &lt;/tr&gt;
 775 &lt;/thead&gt;
 776 &lt;tbody&gt;
 777 &lt;tr&gt;
 778 &lt;th scope=&quot;row&quot;&gt;1&lt;/th&gt;
 779 &lt;td&gt;
 780 PhotometricInterpretation
 781 &lt;/td&gt;
 782 &lt;td&gt;/Chroma/ColorSpaceType@name: &quot;GRAY&quot; and /Chroma/BlackIsZero@value = &quot;FALSE&quot;
 783 =&amp;gt; WhiteIsZero; &quot;GRAY&quot; and /Document/SubimageInterpretation@value =
 784 &quot;TransparencyMask&quot; =&amp;gt; TransparencyMask; &quot;RGB&quot; and /Chroma/Palette present =&amp;gt;
 785 PaletteColor; &quot;GRAY&quot; =&amp;gt; BlackIsZero; &quot;RGB&quot; =&amp;gt; RGB; &quot;YCbCr&quot; =&amp;gt; YCbCr;
 786 &quot;CMYK&quot; =&amp;gt; CMYK; &quot;Lab&quot; =&amp;gt; CIELab.&lt;/td&gt;
 787 &lt;/tr&gt;
 788 &lt;tr&gt;
 789 &lt;th scope=&quot;row&quot;&gt;2&lt;/th&gt;
 790 &lt;td&gt;SamplesPerPixel&lt;/td&gt;
 791 &lt;td&gt;/Chroma/NumChannels@value&lt;/td&gt;
 792 &lt;/tr&gt;
 793 &lt;tr&gt;
 794 &lt;th scope=&quot;row&quot;&gt;3&lt;/th&gt;
 795 &lt;td&gt;ColorMap&lt;/td&gt;
 796 &lt;td&gt;/Chroma/Palette&lt;/td&gt;
 797 &lt;/tr&gt;
 798 &lt;tr&gt;
 799 &lt;th scope=&quot;row&quot;&gt;4&lt;/th&gt;
 800 &lt;td&gt;Compression&lt;/td&gt;
 801 &lt;td&gt;/Compression/CompressionTypeName@value: &quot;none&quot; =&amp;gt; Uncompressed;
 802 &quot;CCITT RLE&quot; =&amp;gt; CCITT 1D; &quot;CCITT T.4&quot; =&amp;gt; Group 3 Fax; &quot;CCITT T.6&quot; =&amp;gt; Group 4
 803 Fax; &quot;LZW&quot; =&amp;gt; LZW; &quot;Old JPEG&quot; =&amp;gt; JPEG; &quot;JPEG&quot; =&amp;gt; New JPEG; &quot;ZLib&quot; =&amp;gt; ZLib;
 804 &quot;PackBits&quot; =&amp;gt; PackBits; &quot;Deflate&quot; =&amp;gt; Deflate.&lt;/td&gt;
 805 &lt;/tr&gt;
 806 &lt;tr&gt;
 807 &lt;th scope=&quot;row&quot;&gt;5&lt;/th&gt;
 808 &lt;td&gt;PlanarConfiguration&lt;/td&gt;
 809 &lt;td&gt;/Data/PlanarConfiguration@value: &quot;PixelInterleaved&quot; =&amp;gt; Chunky;
 810 &quot;PlaneInterleaved&quot; =&amp;gt; Planar.&lt;/td&gt;
 811 &lt;/tr&gt;
 812 &lt;tr&gt;
 813 &lt;th scope=&quot;row&quot;&gt;6&lt;/th&gt;
 814 &lt;td&gt;SampleFormat&lt;/td&gt;
 815 &lt;td&gt;/Data/SampleFormat@value: &quot;SignedIntegral&quot; =&amp;gt; two&#39;s complement signed
 816 integer data; &quot;UnsignedIntegral&quot; =&amp;gt; unsigned integer data; &quot;Real&quot; =&amp;gt;
 817 IEEE floating point data; &quot;Index&quot; =&amp;gt; unsigned integer data.
 818 &lt;/td&gt;
 819 &lt;/tr&gt;
 820 &lt;tr&gt;
 821 &lt;th scope=&quot;row&quot;&gt;7&lt;/th&gt;
 822 &lt;td&gt;BitsPerSample&lt;/td&gt;
 823 &lt;td&gt;/Data/BitsPerSample@value: space-separated list parsed to char array.&lt;/td&gt;
 824 &lt;/tr&gt;
 825 &lt;tr&gt;
 826 &lt;th scope=&quot;row&quot;&gt;8&lt;/th&gt;
 827 &lt;td&gt;FillOrder&lt;/td&gt;
 828 &lt;td&gt;/Data/SampleMSB@value: if all values in space-separated list are 0s =&amp;gt;
 829 right-to-left; otherwise =&amp;gt; left-to-right.
 830 &lt;/td&gt;
 831 &lt;/tr&gt;
 832 &lt;tr&gt;
 833 &lt;th scope=&quot;row&quot;&gt;9&lt;/th&gt;
 834 &lt;td&gt;XResolution&lt;/td&gt;
 835 &lt;td&gt;(10 / /Dimension/HorizontalPixelSize@value) or
 836 (10 / (/Dimension/VerticalPixelSize@value *
 837 /Dimension/PixelAspectRatio@value))&lt;/td&gt;
 838 &lt;/tr&gt;
 839 &lt;tr&gt;
 840 &lt;th scope=&quot;row&quot;&gt;10&lt;/th&gt;
 841 &lt;td&gt;YResolution&lt;/td&gt;
 842 &lt;td&gt;(10 / /Dimension/VerticalPixelSize@value) or
 843 (10 / (/Dimension/HorizontalPixelSize@value /
 844 /Dimension/PixelAspectRatio@value))&lt;/td&gt;
 845 &lt;/tr&gt;
 846 &lt;tr&gt;
 847 &lt;th scope=&quot;row&quot;&gt;11&lt;/th&gt;
 848 &lt;td&gt;ResolutionUnit&lt;/td&gt;
 849 &lt;td&gt;Centimeter if XResolution or YResolution set; otherwise None.&lt;/td&gt;
 850 &lt;/tr&gt;
 851 &lt;tr&gt;
 852 &lt;th scope=&quot;row&quot;&gt;12&lt;/th&gt;
 853 &lt;td&gt;Orientation&lt;/td&gt;
 854 &lt;td&gt;/Dimension/ImageOrientation@value&lt;/td&gt;
 855 &lt;/tr&gt;
 856 &lt;tr&gt;
 857 &lt;th scope=&quot;row&quot;&gt;13&lt;/th&gt;
 858 &lt;td&gt;XPosition&lt;/td&gt;
 859 &lt;td&gt;/Dimension/HorizontalPosition@value / 10&lt;/td&gt;
 860 &lt;/tr&gt;
 861 &lt;tr&gt;
 862 &lt;th scope=&quot;row&quot;&gt;14&lt;/th&gt;
 863 &lt;td&gt;YPosition&lt;/td&gt;
 864 &lt;td&gt;/Dimension/VerticalPosition@value / 10&lt;/td&gt;
 865 &lt;/tr&gt;
 866 &lt;tr&gt;
 867 &lt;th scope=&quot;row&quot;&gt;15&lt;/th&gt;
 868 &lt;td&gt;NewSubFileType&lt;/td&gt;
 869 &lt;td&gt;/Document/SubimageInterpretation@value: &quot;TransparencyMask&quot; =&amp;gt;
 870 transparency mask; &quot;ReducedResolution&quot; =&amp;gt; reduced-resolution;
 871 &quot;SinglePage&quot; =&amp;gt; single page.&lt;/td&gt;
 872 &lt;/tr&gt;
 873 &lt;tr&gt;
 874 &lt;th scope=&quot;row&quot;&gt;16&lt;/th&gt;
 875 &lt;td&gt;DateTime&lt;/td&gt;
 876 &lt;td&gt;/Document/ImageCreationTime@value&lt;/td&gt;
 877 &lt;/tr&gt;
 878 &lt;tr&gt;
 879 &lt;th scope=&quot;row&quot;&gt;17&lt;/th&gt;
 880 &lt;td&gt;DocumentName, ImageDescription, Make, Model, PageName, Software,
 881 Artist, HostComputer, InkNames, Copyright&lt;/td&gt;
 882 &lt;td&gt;/Text/TextEntry: if /Text/TextEntry@keyword is the name of any of the
 883 TIFF Fields, e.g., &quot;Software&quot;, then the field is added with content
 884 /Text/TextEntry@value and count 1.&lt;/td&gt;
 885 &lt;/tr&gt;
 886 &lt;tr&gt;
 887 &lt;th scope=&quot;row&quot;&gt;18&lt;/th&gt;
 888 &lt;td&gt;ExtraSamples&lt;/td&gt;
 889 &lt;td&gt;/Transparency/Alpha@value: &quot;premultiplied&quot; =&amp;gt; associated alpha, count 1;
 890 &quot;nonpremultiplied&quot; =&amp;gt; unassociated alpha, count 1.&lt;/td&gt;
 891 &lt;/tr&gt;
 892 &lt;/tbody&gt;
 893 &lt;/table&gt;
 894 
 895 &lt;h3&gt;&lt;a id=&quot;ExifWrite&quot;&gt;Writing Exif Images&lt;/a&gt;&lt;/h3&gt;
 896 
 897 The TIFF writer may be used to write an uncompressed Exif image or the
 898 contents of the &lt;code&gt;APP1&lt;/code&gt; marker segment of a compressed Exif image.
 899 
 900 &lt;h4&gt;&lt;a id=&quot;ExifWriteTIFF&quot;&gt;Writing Uncompressed Exif Images&lt;/a&gt;&lt;/h4&gt;
 901 
 902 When writing a sequence of images each image is normally recorded as
 903 {IFD,&amp;nbsp;IFD Value,&amp;nbsp;Image Data}. The Exif specification requires
 904 that an uncompressed Exif image be structured as follows:
 905 
 906 &lt;a id=&quot;ExifStructure&quot;&gt;&lt;/a&gt;
 907 &lt;ol&gt;
 908 &lt;li&gt;Image File Header&lt;/li&gt;
 909 &lt;li&gt;Primary IFD&lt;/li&gt;
 910 &lt;li&gt;Primary IFD Value&lt;/li&gt;
 911 &lt;li&gt;Thumbnail IFD&lt;/li&gt;
 912 &lt;li&gt;Thumbnail IFD Value&lt;/li&gt;
 913 &lt;li&gt;Thumbnail Image Data&lt;/li&gt;
 914 &lt;li&gt;Primary Image Data&lt;/li&gt;
 915 &lt;/ol&gt;
 916 
 917 To meet the requirement of the primary image data being recorded last, the
 918 primary image must be written initially as an empty image and have its data
 919 added via pixel replacement after the thumbnail IFD and image data have been
 920 written:
 921 
 922 &lt;pre&gt;&lt;code&gt;
 923     ImageWriter tiffWriter;
 924     ImageWriteParam tiffWriteParam;
 925     IIOMetadata tiffStreamMetadata;
 926     IIOMetadata primaryIFD;
 927     BufferedImage image;
 928     BufferedImage thumbnail;
 929 
 930     // Specify uncompressed output.
 931     tiffWriteParam.setCompressionMode(ImageWriteParam.MODE_DISABLED);
 932 
 933     if (thumbnail != null) {
 934         // Write the TIFF header.
 935         tiffWriter.prepareWriteSequence(tiffStreamMetadata);
 936 
 937         // Append the primary IFD.
 938         tiffWriter.prepareInsertEmpty(-1, // append
 939                 new ImageTypeSpecifier(image),
 940                 image.getWidth(),
 941                 image.getHeight(),
 942                 primaryIFD,
 943                 null, // thumbnails
 944                 tiffWriteParam);
 945         tiffWriter.endInsertEmpty();
 946 
 947         // Append the thumbnail image data.
 948         tiffWriter.writeToSequence(new IIOImage(thumbnail, null, null),
 949                 tiffWriteParam);
 950 
 951         // Insert the primary image data.
 952         tiffWriter.prepareReplacePixels(0, new Rectangle(image.getWidth(),
 953                 image.getHeight()));
 954         tiffWriter.replacePixels(image, tiffWriteParam);
 955         tiffWriter.endReplacePixels();
 956 
 957         // End writing.
 958         tiffWriter.endWriteSequence();
 959     } else {
 960         // Write only the primary IFD and image data.
 961         tiffWriter.write(tiffStreamMetadata,
 962                 new IIOImage(image, null, primaryIFD),
 963                 tiffWriteParam);
 964     }
 965 &lt;/code&gt;&lt;/pre&gt;
 966 
 967 &lt;h4&gt;&lt;a id=&quot;ExifWriteJPEG&quot;&gt;Writing Compressed Exif Images&lt;/a&gt;&lt;/h4&gt;
 968 
 969 The structure of the embedded TIFF stream in the &lt;code&gt;APP1&lt;/code&gt; segment of a
 970 compressed Exif image is identical to the &lt;a href=&quot;#ExifStructure&quot;&gt;
 971 uncompressed Exif image structure&lt;/a&gt; except that there are no primary
 972 image data, i.e., the primary IFD does not refer to any image data.
 973 
 974 &lt;pre&gt;&lt;code&gt;
 975     ImageWriter tiffWriter;
 976     ImageWriteParam tiffWriteParam;
 977     IIOMetadata tiffStreamMetadata;
 978     BufferedImage image;
 979     BufferedImage thumbnail;
 980     IIOMetadata primaryIFD;
 981     ImageOutputStream output;
 982 
 983     // Set up an output to contain the APP1 Exif TIFF stream.
 984     ByteArrayOutputStream baos = new ByteArrayOutputStream();
 985     MemoryCacheImageOutputStream app1ExifOutput =
 986         new MemoryCacheImageOutputStream(baos);
 987     tiffWriter.setOutput(app1ExifOutput);
 988 
 989     // Set compression for the thumbnail.
 990     tiffWriteParam.setCompressionMode(ImageWriteParam.MODE_EXPLICIT);
 991     tiffWriteParam.setCompressionType(&quot;Exif JPEG&quot;);
 992 
 993     // Write the APP1 Exif TIFF stream.
 994     if (thumbnail != null) {
 995         // Write the TIFF header.
 996         tiffWriter.prepareWriteSequence(tiffStreamMetadata);
 997 
 998         // Append the primary IFD.
 999         tiffWriter.prepareInsertEmpty(-1, // append
1000                 new ImageTypeSpecifier(image),
1001                 image.getWidth(),
1002                 image.getHeight(),
1003                 primaryIFD,
1004                 null, // thumbnails
1005                 tiffWriteParam);
1006         tiffWriter.endInsertEmpty();
1007 
1008         // Append the thumbnail IFD and image data.
1009         tiffWriter.writeToSequence(new IIOImage(thumbnail, null,
1010                 null), tiffWriteParam);
1011 
1012         // End writing.
1013         tiffWriter.endWriteSequence();
1014     } else {
1015         // Write only the primary IFD.
1016         tiffWriter.prepareWriteEmpty(tiffStreamMetadata,
1017                 new ImageTypeSpecifier(image),
1018                 image.getWidth(),
1019                 image.getHeight(),
1020                 primaryIFD,
1021                 null, // thumbnails
1022                 tiffWriteParam);
1023         tiffWriter.endWriteEmpty();
1024     }
1025 
1026     // Flush data into byte stream.
1027     app1ExifOutput.flush();
1028 
1029     // Create APP1 parameter array.
1030     byte[] app1Parameters = new byte[6 + baos.size()];
1031 
1032     // Add APP1 Exif ID bytes.
1033     app1Parameters[0] = (byte) &#39;E&#39;;
1034     app1Parameters[1] = (byte) &#39;x&#39;;
1035     app1Parameters[2] = (byte) &#39;i&#39;;
1036     app1Parameters[3] = (byte) &#39;f&#39;;
1037     app1Parameters[4] = app1Parameters[5] = (byte) 0;
1038 
1039     // Append TIFF stream to APP1 parameters.
1040     System.arraycopy(baos.toByteArray(), 0, app1Parameters, 6, baos.size());
1041 
1042     // Create the APP1 Exif node to be added to native JPEG image metadata.
1043     IIOMetadataNode app1Node = new IIOMetadataNode(&quot;unknown&quot;);
1044     app1Node.setAttribute(&quot;MarkerTag&quot;, String.valueOf(0xE1));
1045     app1Node.setUserObject(app1Parameters);
1046 
1047     // Append the APP1 Exif marker to the &quot;markerSequence&quot; node.
1048     IIOMetadata jpegImageMetadata =
1049         jpegWriter.getDefaultImageMetadata(new ImageTypeSpecifier(image),
1050             jpegWriteParam);
1051     String nativeFormat = jpegImageMetadata.getNativeMetadataFormatName();
1052     Node tree = jpegImageMetadata.getAsTree(nativeFormat);
1053     NodeList children = tree.getChildNodes();
1054     int numChildren = children.getLength();
1055     for (int i = 0; i &amp;lt; numChildren; i++) {
1056         Node child = children.item(i);
1057         if (child.getNodeName().equals(&quot;markerSequence&quot;)) {
1058             child.appendChild(app1Node);
1059             break;
1060         }
1061     }
1062     jpegImageMetadata.setFromTree(nativeFormat, tree);
1063 
1064     // Write the JPEG image data including the APP1 Exif marker.
1065     jpegWriter.setOutput(output);
1066     jpegWriter.write(new IIOImage(image, null, jpegImageMetadata));
1067 &lt;/code&gt;&lt;/pre&gt;
1068 
1069 The &lt;code&gt;&quot;unknown&quot;&lt;/code&gt; node created above would be appended to the
1070 &lt;code&gt;&quot;markerSequence&quot;&lt;/code&gt; node of the native JPEG image metadata
1071 and written to the JPEG stream when the primary image is written using
1072 the JPEG writer.
1073 
1074 &lt;h2&gt;&lt;a id=&quot;StreamMetadata&quot;&gt;Stream Metadata&lt;/a&gt;&lt;/h2&gt;
1075 
1076 The DTD for the TIFF native stream metadata format is as follows:
1077 
1078 &lt;pre&gt;
1079 &amp;lt;!DOCTYPE &quot;javax_imageio_tiff_stream_1.0&quot; [
1080 
1081   &amp;lt;!ELEMENT &quot;javax_imageio_tiff_stream_1.0&quot; (ByteOrder)&gt;
1082 
1083     &amp;lt;!ELEMENT &quot;ByteOrder&quot; EMPTY&amp;gt;
1084       &amp;lt;!-- The stream byte order --&amp;gt;
1085       &amp;lt;!ATTLIST &quot;ByteOrder&quot; &quot;value&quot; #CDATA #REQUIRED&amp;gt;
1086         &amp;lt;!-- One of &quot;BIG_ENDIAN&quot; or &quot;LITTLE_ENDIAN&quot; --&amp;gt;
1087         &amp;lt;!-- Data type: String --&amp;gt;
1088 ]&amp;gt;
1089 &lt;/pre&gt;
1090 
1091 &lt;h2&gt;&lt;a id=&quot;ImageMetadata&quot;&gt;Image Metadata&lt;/a&gt;&lt;/h2&gt;
1092 
1093 The DTD for the TIFF native image metadata format is as follows:
1094 
1095 &lt;pre&gt;
1096 &amp;lt;!DOCTYPE &quot;javax_imageio_tiff_image_1.0&quot; [
1097 
1098   &amp;lt;!ELEMENT &quot;javax_imageio_tiff_image_1.0&quot; (TIFFIFD)*&amp;gt;
1099 
1100     &amp;lt;!ELEMENT &quot;TIFFIFD&quot; (TIFFField | TIFFIFD)*&amp;gt;
1101       &amp;lt;!-- An IFD (directory) containing fields --&amp;gt;
1102       &amp;lt;!ATTLIST &quot;TIFFIFD&quot; &quot;tagSets&quot; #CDATA #REQUIRED&amp;gt;
1103         &amp;lt;!-- Data type: String --&amp;gt;
1104       &amp;lt;!ATTLIST &quot;TIFFIFD&quot; &quot;parentTagNumber&quot; #CDATA #IMPLIED&amp;gt;
1105         &amp;lt;!-- The tag number of the field pointing to this IFD --&amp;gt;
1106         &amp;lt;!-- Data type: Integer --&amp;gt;
1107       &amp;lt;!ATTLIST &quot;TIFFIFD&quot; &quot;parentTagName&quot; #CDATA #IMPLIED&amp;gt;
1108         &amp;lt;!-- A mnemonic name for the field pointing to this IFD, if known
1109              --&amp;gt;
1110         &amp;lt;!-- Data type: String --&amp;gt;
1111 
1112       &amp;lt;!ELEMENT &quot;TIFFField&quot; (TIFFBytes | TIFFAsciis |
1113         TIFFShorts | TIFFSShorts | TIFFLongs | TIFFSLongs |
1114         TIFFRationals | TIFFSRationals |
1115         TIFFFloats | TIFFDoubles | TIFFUndefined)&amp;gt;
1116         &amp;lt;!-- A field containing data --&amp;gt;
1117         &amp;lt;!ATTLIST &quot;TIFFField&quot; &quot;number&quot; #CDATA #REQUIRED&amp;gt;
1118           &amp;lt;!-- The tag number asociated with the field --&amp;gt;
1119           &amp;lt;!-- Data type: String --&amp;gt;
1120         &amp;lt;!ATTLIST &quot;TIFFField&quot; &quot;name&quot; #CDATA #IMPLIED&amp;gt;
1121           &amp;lt;!-- A mnemonic name associated with the field, if known --&amp;gt;
1122           &amp;lt;!-- Data type: String --&amp;gt;
1123 
1124         &amp;lt;!ELEMENT &quot;TIFFBytes&quot; (TIFFByte)*&amp;gt;
1125           &amp;lt;!-- A sequence of TIFFByte nodes --&amp;gt;
1126 
1127           &amp;lt;!ELEMENT &quot;TIFFByte&quot; EMPTY&amp;gt;
1128             &amp;lt;!-- An integral value between 0 and 255 --&amp;gt;
1129             &amp;lt;!ATTLIST &quot;TIFFByte&quot; &quot;value&quot; #CDATA #IMPLIED&amp;gt;
1130               &amp;lt;!-- The value --&amp;gt;
1131               &amp;lt;!-- Data type: String --&amp;gt;
1132             &amp;lt;!ATTLIST &quot;TIFFByte&quot; &quot;description&quot; #CDATA #IMPLIED&amp;gt;
1133               &amp;lt;!-- A description, if available --&amp;gt;
1134               &amp;lt;!-- Data type: String --&amp;gt;
1135 
1136         &amp;lt;!ELEMENT &quot;TIFFAsciis&quot; (TIFFAscii)*&amp;gt;
1137           &amp;lt;!-- A sequence of TIFFAscii nodes --&amp;gt;
1138 
1139           &amp;lt;!ELEMENT &quot;TIFFAscii&quot; EMPTY&amp;gt;
1140             &amp;lt;!-- A String value --&amp;gt;
1141             &amp;lt;!ATTLIST &quot;TIFFAscii&quot; &quot;value&quot; #CDATA #IMPLIED&amp;gt;
1142               &amp;lt;!-- The value --&amp;gt;
1143               &amp;lt;!-- Data type: String --&amp;gt;
1144 
1145         &amp;lt;!ELEMENT &quot;TIFFShorts&quot; (TIFFShort)*&amp;gt;
1146           &amp;lt;!-- A sequence of TIFFShort nodes --&amp;gt;
1147 
1148           &amp;lt;!ELEMENT &quot;TIFFShort&quot; EMPTY&amp;gt;
1149             &amp;lt;!-- An integral value between 0 and 65535 --&amp;gt;
1150             &amp;lt;!ATTLIST &quot;TIFFShort&quot; &quot;value&quot; #CDATA #IMPLIED&amp;gt;
1151               &amp;lt;!-- The value --&amp;gt;
1152               &amp;lt;!-- Data type: String --&amp;gt;
1153             &amp;lt;!ATTLIST &quot;TIFFShort&quot; &quot;description&quot; #CDATA #IMPLIED&amp;gt;
1154               &amp;lt;!-- A description, if available --&amp;gt;
1155               &amp;lt;!-- Data type: String --&amp;gt;
1156 
1157         &amp;lt;!ELEMENT &quot;TIFFSShorts&quot; (TIFFSShort)*&amp;gt;
1158           &amp;lt;!-- A sequence of TIFFSShort nodes --&amp;gt;
1159 
1160           &amp;lt;!ELEMENT &quot;TIFFSShort&quot; EMPTY&amp;gt;
1161             &amp;lt;!-- An integral value between -32768 and 32767 --&amp;gt;
1162             &amp;lt;!ATTLIST &quot;TIFFSShort&quot; &quot;value&quot; #CDATA #IMPLIED&amp;gt;
1163               &amp;lt;!-- The value --&amp;gt;
1164               &amp;lt;!-- Data type: String --&amp;gt;
1165             &amp;lt;!ATTLIST &quot;TIFFSShort&quot; &quot;description&quot; #CDATA #IMPLIED&amp;gt;
1166               &amp;lt;!-- A description, if available --&amp;gt;
1167               &amp;lt;!-- Data type: String --&amp;gt;
1168 
1169         &amp;lt;!ELEMENT &quot;TIFFLongs&quot; (TIFFLong)*&amp;gt;
1170           &amp;lt;!-- A sequence of TIFFLong nodes --&amp;gt;
1171 
1172           &amp;lt;!ELEMENT &quot;TIFFLong&quot; EMPTY&amp;gt;
1173             &amp;lt;!-- An integral value between 0 and 4294967295 --&amp;gt;
1174             &amp;lt;!ATTLIST &quot;TIFFLong&quot; &quot;value&quot; #CDATA #IMPLIED&amp;gt;
1175               &amp;lt;!-- The value --&amp;gt;
1176               &amp;lt;!-- Data type: String --&amp;gt;
1177             &amp;lt;!ATTLIST &quot;TIFFLong&quot; &quot;description&quot; #CDATA #IMPLIED&amp;gt;
1178               &amp;lt;!-- A description, if available --&amp;gt;
1179               &amp;lt;!-- Data type: String --&amp;gt;
1180 
1181         &amp;lt;!ELEMENT &quot;TIFFSLongs&quot; (TIFFSLong)*&amp;gt;
1182           &amp;lt;!-- A sequence of TIFFSLong nodes --&amp;gt;
1183 
1184           &amp;lt;!ELEMENT &quot;TIFFSLong&quot; EMPTY&amp;gt;
1185             &amp;lt;!-- An integral value between -2147483648 and 2147482647 --&amp;gt;
1186             &amp;lt;!ATTLIST &quot;TIFFSLong&quot; &quot;value&quot; #CDATA #IMPLIED&amp;gt;
1187               &amp;lt;!-- The value --&amp;gt;
1188               &amp;lt;!-- Data type: String --&amp;gt;
1189             &amp;lt;!ATTLIST &quot;TIFFSLong&quot; &quot;description&quot; #CDATA #IMPLIED&amp;gt;
1190               &amp;lt;!-- A description, if available --&amp;gt;
1191               &amp;lt;!-- Data type: String --&amp;gt;
1192 
1193         &amp;lt;!ELEMENT &quot;TIFFRationals&quot; (TIFFRational)*&amp;gt;
1194           &amp;lt;!-- A sequence of TIFFRational nodes --&amp;gt;
1195 
1196           &amp;lt;!ELEMENT &quot;TIFFRational&quot; EMPTY&amp;gt;
1197             &amp;lt;!-- A rational value consisting of an unsigned numerator and
1198                  denominator --&amp;gt;
1199             &amp;lt;!ATTLIST &quot;TIFFRational&quot; &quot;value&quot; #CDATA #IMPLIED&amp;gt;
1200               &amp;lt;!-- The numerator and denominator, separated by a slash --&amp;gt;
1201               &amp;lt;!-- Data type: String --&amp;gt;
1202 
1203         &amp;lt;!ELEMENT &quot;TIFFSRationals&quot; (TIFFSRational)*&amp;gt;
1204           &amp;lt;!-- A sequence of TIFFSRational nodes --&amp;gt;
1205 
1206           &amp;lt;!ELEMENT &quot;TIFFSRational&quot; EMPTY&amp;gt;
1207             &amp;lt;!-- A rational value consisting of a signed numerator and
1208                  denominator --&amp;gt;
1209             &amp;lt;!ATTLIST &quot;TIFFSRational&quot; &quot;value&quot; #CDATA #IMPLIED&amp;gt;
1210               &amp;lt;!-- The numerator and denominator, separated by a slash --&amp;gt;
1211               &amp;lt;!-- Data type: String --&amp;gt;
1212 
1213         &amp;lt;!ELEMENT &quot;TIFFFloats&quot; (TIFFFloat)*&amp;gt;
1214           &amp;lt;!-- A sequence of TIFFFloat nodes --&amp;gt;
1215 
1216           &amp;lt;!ELEMENT &quot;TIFFFloat&quot; EMPTY&amp;gt;
1217             &amp;lt;!-- A single-precision floating-point value --&amp;gt;
1218             &amp;lt;!ATTLIST &quot;TIFFFloat&quot; &quot;value&quot; #CDATA #IMPLIED&amp;gt;
1219               &amp;lt;!-- The value --&amp;gt;
1220               &amp;lt;!-- Data type: String --&amp;gt;
1221 
1222         &amp;lt;!ELEMENT &quot;TIFFDoubles&quot; (TIFFDouble)*&amp;gt;
1223           &amp;lt;!-- A sequence of TIFFDouble nodes --&amp;gt;
1224 
1225           &amp;lt;!ELEMENT &quot;TIFFDouble&quot; EMPTY&amp;gt;
1226             &amp;lt;!-- A double-precision floating-point value --&amp;gt;
1227             &amp;lt;!ATTLIST &quot;TIFFDouble&quot; &quot;value&quot; #CDATA #IMPLIED&amp;gt;
1228               &amp;lt;!-- The value --&amp;gt;
1229               &amp;lt;!-- Data type: String --&amp;gt;
1230 
1231         &amp;lt;!ELEMENT &quot;TIFFUndefined&quot; EMPTY&amp;gt;
1232           &amp;lt;!-- Uninterpreted byte data --&amp;gt;
1233           &amp;lt;!ATTLIST &quot;TIFFUndefined&quot; &quot;value&quot; #CDATA #IMPLIED&amp;gt;
1234             &amp;lt;!-- A list of comma-separated byte values --&amp;gt;
1235             &amp;lt;!-- Data type: String --&amp;gt;
1236 ]&amp;gt;
1237 &lt;/pre&gt;
1238 
1239 @since 9
1240 &lt;/div&gt;
1241 &lt;/main&gt;
1242 &lt;/body&gt;
1243 &lt;/html&gt;
    </pre>
  </body>
</html>