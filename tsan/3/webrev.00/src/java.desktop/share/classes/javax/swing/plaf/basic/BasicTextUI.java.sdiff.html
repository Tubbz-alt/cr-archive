<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/classes/javax/swing/plaf/basic/BasicTextUI.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="BasicTabbedPaneUI.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="BasicToggleButtonUI.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/javax/swing/plaf/basic/BasicTextUI.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 930      * before requesting the preferred size of the view hierarchy.  This
 931      * allows formatted views to format to the current component size before
 932      * answering the request.  Other views don&#39;t care about currently formatted
 933      * size and give the same answer either way.
 934      *
 935      * @param c the editor component
 936      * @return the size
 937      */
 938     public Dimension getPreferredSize(JComponent c) {
 939         Document doc = editor.getDocument();
 940         Insets i = c.getInsets();
 941         Dimension d = c.getSize();
 942 
 943         if (doc instanceof AbstractDocument) {
 944             ((AbstractDocument)doc).readLock();
 945         }
 946         try {
 947             if ((d.width &gt; (i.left + i.right + caretMargin)) &amp;&amp; (d.height &gt; (i.top + i.bottom))) {
 948                 rootView.setSize(d.width - i.left - i.right -
 949                         caretMargin, d.height - i.top - i.bottom);
<span class="line-modified"> 950             }</span>
<span class="line-removed"> 951             else if (!rootViewInitialized &amp;&amp; (d.width &lt;= 0 || d.height &lt;= 0)) {</span>
 952                 // Probably haven&#39;t been layed out yet, force some sort of
 953                 // initial sizing.
<span class="line-removed"> 954                 rootViewInitialized = true;</span>
 955                 rootView.setSize(Integer.MAX_VALUE, Integer.MAX_VALUE);
 956             }
 957             d.width = (int) Math.min((long) rootView.getPreferredSpan(View.X_AXIS) +
 958                          (long) i.left + (long) i.right + caretMargin, Integer.MAX_VALUE);
 959             d.height = (int) Math.min((long) rootView.getPreferredSpan(View.Y_AXIS) +
 960                                       (long) i.top + (long) i.bottom, Integer.MAX_VALUE);
 961         } finally {
 962             if (doc instanceof AbstractDocument) {
 963                 ((AbstractDocument)doc).readUnlock();
 964             }
 965         }
 966         return d;
 967     }
 968 
 969     /**
 970      * Gets the minimum size for the editor component.
 971      *
 972      * @param c the editor component
 973      * @return the size
 974      */
</pre>
<hr />
<pre>
1386         }
1387 
1388         BasicCursor(String name) {
1389             super(name);
1390         }
1391     }
1392 
1393     private static BasicCursor textCursor = new BasicCursor(Cursor.TEXT_CURSOR);
1394     // ----- member variables ---------------------------------------
1395 
1396     private static final EditorKit defaultKit = new DefaultEditorKit();
1397     transient JTextComponent editor;
1398     transient boolean painted;
1399     transient RootView rootView = new RootView();
1400     transient UpdateHandler updateHandler = new UpdateHandler();
1401     private static final TransferHandler defaultTransferHandler = new TextTransferHandler();
1402     private final DragListener dragListener = getDragListener();
1403     private static final Position.Bias[] discardBias = new Position.Bias[1];
1404     private DefaultCaret dropCaret;
1405     private int caretMargin;
<span class="line-removed">1406     private boolean rootViewInitialized;</span>
1407 
1408     /**
1409      * Root view that acts as a gateway between the component
1410      * and the View hierarchy.
1411      */
1412     class RootView extends View {
1413 
1414         RootView() {
1415             super(null);
1416         }
1417 
1418         void setView(View v) {
1419             View oldView = view;
1420             view = null;
1421             if (oldView != null) {
1422                 // get rid of back reference so that the old
1423                 // hierarchy can be garbage collected.
1424                 oldView.setParent(null);
1425             }
1426             if (v != null) {
</pre>
</td>
<td>
<hr />
<pre>
 930      * before requesting the preferred size of the view hierarchy.  This
 931      * allows formatted views to format to the current component size before
 932      * answering the request.  Other views don&#39;t care about currently formatted
 933      * size and give the same answer either way.
 934      *
 935      * @param c the editor component
 936      * @return the size
 937      */
 938     public Dimension getPreferredSize(JComponent c) {
 939         Document doc = editor.getDocument();
 940         Insets i = c.getInsets();
 941         Dimension d = c.getSize();
 942 
 943         if (doc instanceof AbstractDocument) {
 944             ((AbstractDocument)doc).readLock();
 945         }
 946         try {
 947             if ((d.width &gt; (i.left + i.right + caretMargin)) &amp;&amp; (d.height &gt; (i.top + i.bottom))) {
 948                 rootView.setSize(d.width - i.left - i.right -
 949                         caretMargin, d.height - i.top - i.bottom);
<span class="line-modified"> 950             } else if (d.width == 0 &amp;&amp; d.height == 0) {</span>

 951                 // Probably haven&#39;t been layed out yet, force some sort of
 952                 // initial sizing.

 953                 rootView.setSize(Integer.MAX_VALUE, Integer.MAX_VALUE);
 954             }
 955             d.width = (int) Math.min((long) rootView.getPreferredSpan(View.X_AXIS) +
 956                          (long) i.left + (long) i.right + caretMargin, Integer.MAX_VALUE);
 957             d.height = (int) Math.min((long) rootView.getPreferredSpan(View.Y_AXIS) +
 958                                       (long) i.top + (long) i.bottom, Integer.MAX_VALUE);
 959         } finally {
 960             if (doc instanceof AbstractDocument) {
 961                 ((AbstractDocument)doc).readUnlock();
 962             }
 963         }
 964         return d;
 965     }
 966 
 967     /**
 968      * Gets the minimum size for the editor component.
 969      *
 970      * @param c the editor component
 971      * @return the size
 972      */
</pre>
<hr />
<pre>
1384         }
1385 
1386         BasicCursor(String name) {
1387             super(name);
1388         }
1389     }
1390 
1391     private static BasicCursor textCursor = new BasicCursor(Cursor.TEXT_CURSOR);
1392     // ----- member variables ---------------------------------------
1393 
1394     private static final EditorKit defaultKit = new DefaultEditorKit();
1395     transient JTextComponent editor;
1396     transient boolean painted;
1397     transient RootView rootView = new RootView();
1398     transient UpdateHandler updateHandler = new UpdateHandler();
1399     private static final TransferHandler defaultTransferHandler = new TextTransferHandler();
1400     private final DragListener dragListener = getDragListener();
1401     private static final Position.Bias[] discardBias = new Position.Bias[1];
1402     private DefaultCaret dropCaret;
1403     private int caretMargin;

1404 
1405     /**
1406      * Root view that acts as a gateway between the component
1407      * and the View hierarchy.
1408      */
1409     class RootView extends View {
1410 
1411         RootView() {
1412             super(null);
1413         }
1414 
1415         void setView(View v) {
1416             View oldView = view;
1417             view = null;
1418             if (oldView != null) {
1419                 // get rid of back reference so that the old
1420                 // hierarchy can be garbage collected.
1421                 oldView.setParent(null);
1422             }
1423             if (v != null) {
</pre>
</td>
</tr>
</table>
<center><a href="BasicTabbedPaneUI.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="BasicToggleButtonUI.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>