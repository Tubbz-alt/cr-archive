<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/unix/native/common/awt/X11Color.c</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../classes/sun/print/UnixPrintService.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="awt_Font.c.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/unix/native/common/awt/X11Color.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 1995, 2014, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 1995, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 334,23 ***</span>
  #endif
      }
  
      return awt_color_match(r, g, b, awt_data);
  }
<span class="line-removed">- </span>
<span class="line-removed">- void</span>
<span class="line-removed">- awt_allocate_systemcolors(XColor *colorsPtr, int num_pixels, AwtGraphicsConfigDataPtr awtData) {</span>
<span class="line-removed">-     int i;</span>
<span class="line-removed">-     int r, g, b, pixel;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     for (i=0; i &lt; num_pixels; i++) {</span>
<span class="line-removed">-         r = colorsPtr[i].red   &gt;&gt; 8;</span>
<span class="line-removed">-         g = colorsPtr[i].green &gt;&gt; 8;</span>
<span class="line-removed">-         b = colorsPtr[i].blue  &gt;&gt; 8;</span>
<span class="line-removed">-         pixel = alloc_col(awt_display, awtData-&gt;awt_cmap, r, g, b, -1, awtData);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- }</span>
  #endif /* !HEADLESS */
  
  void
  awt_fill_imgcv(ImgConvertFcn **array, int mask, int value, ImgConvertFcn fcn)
  {
<span class="line-new-header">--- 334,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 400,10 ***</span>
<span class="line-new-header">--- 387,13 ---</span>
      cm = awt_data-&gt;awt_cmap;
      depth = awt_data-&gt;awt_depth;
      pVI = &amp;awt_data-&gt;awt_visInfo;
      awt_data-&gt;awt_num_colors = awt_data-&gt;awt_visInfo.colormap_size;
      awt_data-&gt;awtImage = (awtImageData *) calloc (1, sizeof (awtImageData));
<span class="line-added">+     if (awt_data-&gt;awtImage == NULL) {</span>
<span class="line-added">+         return 0;</span>
<span class="line-added">+     }</span>
  
      pPFV = XListPixmapFormats(dpy, &amp;numpfv);
      if (pPFV) {
          for (i = 0; i &lt; numpfv; i++) {
              if (pPFV[i].depth == depth) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 570,16 ***</span>
      } else {
          paletteSize = MAX_PALETTE8_SIZE;
      }
  
      if (awt_data-&gt;awt_num_colors &gt; paletteSize) {
<span class="line-modified">!         free (awt_data-&gt;awtImage);</span>
          return 0;
      }
  
      /* Allocate ColorData structure */
      awt_data-&gt;color_data = ZALLOC (_ColorData);
      awt_data-&gt;color_data-&gt;screendata = 1; /* This ColorData struct corresponds
                                               to some AWT screen/visual, so when
                                               any IndexColorModel using this
                                               struct is finalized, don&#39;t free
                                               the struct in freeICMColorData.
<span class="line-new-header">--- 560,21 ---</span>
      } else {
          paletteSize = MAX_PALETTE8_SIZE;
      }
  
      if (awt_data-&gt;awt_num_colors &gt; paletteSize) {
<span class="line-modified">!         free(awt_data-&gt;awtImage);</span>
          return 0;
      }
  
      /* Allocate ColorData structure */
      awt_data-&gt;color_data = ZALLOC (_ColorData);
<span class="line-added">+     if (awt_data-&gt;color_data == NULL) {</span>
<span class="line-added">+         free(awt_data-&gt;awtImage);</span>
<span class="line-added">+         return 0;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      awt_data-&gt;color_data-&gt;screendata = 1; /* This ColorData struct corresponds
                                               to some AWT screen/visual, so when
                                               any IndexColorModel using this
                                               struct is finalized, don&#39;t free
                                               the struct in freeICMColorData.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 592,10 ***</span>
<span class="line-new-header">--- 587,15 ---</span>
          cols[i].pixel = i;
      }
  
      awt_data-&gt;color_data-&gt;awt_Colors =
          (ColorEntry *)calloc(paletteSize, sizeof (ColorEntry));
<span class="line-added">+     if (awt_data-&gt;color_data-&gt;awt_Colors == NULL) {</span>
<span class="line-added">+         free(awt_data-&gt;awtImage);</span>
<span class="line-added">+         free(awt_data-&gt;color_data);</span>
<span class="line-added">+         return 0;</span>
<span class="line-added">+     }</span>
  
      XQueryColors(dpy, cm, cols, awt_data-&gt;awt_num_colors);
      for (i = 0; i &lt; awt_data-&gt;awt_num_colors; i++) {
          awt_data-&gt;color_data-&gt;awt_Colors[i].r = cols[i].red &gt;&gt; 8;
          awt_data-&gt;color_data-&gt;awt_Colors[i].g = cols[i].green &gt;&gt; 8;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 665,10 ***</span>
<span class="line-new-header">--- 665,15 ---</span>
              }
          }
  
          awt_data-&gt;color_data-&gt;img_grays =
              (unsigned char *)calloc(256, sizeof(unsigned char));
<span class="line-added">+         if ( awt_data-&gt;color_data-&gt;img_grays == NULL) {</span>
<span class="line-added">+             free(awt_data-&gt;awtImage);</span>
<span class="line-added">+             free(awt_data-&gt;color_data);</span>
<span class="line-added">+             return 0;</span>
<span class="line-added">+         }</span>
          for (g = 0; g &lt; 256; g++) {
              int mindist, besti;
              int d;
  
              p = awt_data-&gt;color_data-&gt;awt_Colors;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 808,10 ***</span>
<span class="line-new-header">--- 813,15 ---</span>
          k = getVirtCubeSize();
      }
      awt_data-&gt;color_data-&gt;img_clr_tbl =
          (unsigned char *)calloc(LOOKUPSIZE * LOOKUPSIZE * LOOKUPSIZE,
                                  sizeof(unsigned char));
<span class="line-added">+     if (awt_data-&gt;color_data-&gt;img_clr_tbl == NULL) {</span>
<span class="line-added">+         free(awt_data-&gt;awtImage);</span>
<span class="line-added">+         free(awt_data-&gt;color_data);</span>
<span class="line-added">+         return 0;</span>
<span class="line-added">+     }</span>
      img_makePalette(cmapsize, k, LOOKUPSIZE, 50, 250,
                      allocatedColorsNum, TRUE, reds, greens, blues,
                      awt_data-&gt;color_data-&gt;img_clr_tbl);
                      /*img_clr_tbl);*/
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 856,10 ***</span>
<span class="line-new-header">--- 866,16 ---</span>
      /* Fill in the ICM lut and lut2cmap mapping */
      awt_data-&gt;color_data-&gt;awt_numICMcolors = 0;
      awt_data-&gt;color_data-&gt;awt_icmLUT2Colors =
          (unsigned char *)calloc(paletteSize, sizeof (unsigned char));
      awt_data-&gt;color_data-&gt;awt_icmLUT = (int *)calloc(paletteSize, sizeof(int));
<span class="line-added">+     if (awt_data-&gt;color_data-&gt;awt_icmLUT2Colors == NULL || awt_data-&gt;color_data-&gt;awt_icmLUT == NULL) {</span>
<span class="line-added">+         free(awt_data-&gt;awtImage);</span>
<span class="line-added">+         free(awt_data-&gt;color_data);</span>
<span class="line-added">+         return 0;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      for (i=0; i &lt; paletteSize; i++) {
          /* Keep the mapping between this lut and the actual cmap */
          awt_data-&gt;color_data-&gt;awt_icmLUT2Colors
              [awt_data-&gt;color_data-&gt;awt_numICMcolors] = i;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1245,16 ***</span>
  #endif /* !HEADLESS */
  
  extern jfieldID colorValueID;
  
  #ifndef HEADLESS
<span class="line-removed">- int awtJNI_GetColor(JNIEnv *env,jobject this)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     /* REMIND: should not be defaultConfig. */</span>
<span class="line-removed">-     return awtJNI_GetColorForVis (env, this, getDefaultConfig(DefaultScreen(awt_display)));</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
  int awtJNI_GetColorForVis (JNIEnv *env,jobject this, AwtGraphicsConfigDataPtr awt_data)
  {
      int col;
      jclass SYSCLR_class;
  
<span class="line-new-header">--- 1261,10 ---</span>
</pre>
<center><a href="../../../classes/sun/print/UnixPrintService.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="awt_Font.c.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>