<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/unix/native/common/java2d/x11/X11FontScaler_md.c</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../opengl/J2D_GL/glxext.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="X11SurfaceData.c.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/unix/native/common/java2d/x11/X11FontScaler_md.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 271,19 ***</span>
      unsigned char *srcRow, *dstRow, *dstByte;
      int wholeByteCount, remainingBitsCount;
      unsigned int imageSize;
      JNIEnv *env;
  
      FONT_AWT_LOCK();
  /*     XTextExtents16(xFont, xChar, 1, &amp;direction, &amp;ascent, &amp;descent, &amp;xcs); */
      XQueryTextExtents16(awt_display,xFont-&gt;fid, xChar, 1,
                          &amp;direction, &amp;ascent, &amp;descent, &amp;xcs);
      width = xcs.rbearing - xcs.lbearing;
      height = xcs.ascent+xcs.descent;
      imageSize = width*height;
<span class="line-removed">- </span>
      glyphInfo = (GlyphInfo*)malloc(sizeof(GlyphInfo)+imageSize);
      glyphInfo-&gt;cellInfo = NULL;
      glyphInfo-&gt;width = width;
      glyphInfo-&gt;height = height;
      glyphInfo-&gt;topLeftX = xcs.lbearing;
      glyphInfo-&gt;topLeftY = -xcs.ascent;
<span class="line-new-header">--- 271,23 ---</span>
      unsigned char *srcRow, *dstRow, *dstByte;
      int wholeByteCount, remainingBitsCount;
      unsigned int imageSize;
      JNIEnv *env;
  
<span class="line-added">+ </span>
      FONT_AWT_LOCK();
  /*     XTextExtents16(xFont, xChar, 1, &amp;direction, &amp;ascent, &amp;descent, &amp;xcs); */
      XQueryTextExtents16(awt_display,xFont-&gt;fid, xChar, 1,
                          &amp;direction, &amp;ascent, &amp;descent, &amp;xcs);
      width = xcs.rbearing - xcs.lbearing;
      height = xcs.ascent+xcs.descent;
      imageSize = width*height;
      glyphInfo = (GlyphInfo*)malloc(sizeof(GlyphInfo)+imageSize);
<span class="line-added">+     if (glyphInfo == NULL) {</span>
<span class="line-added">+         AWT_UNLOCK();</span>
<span class="line-added">+         return (jlong)(uintptr_t)NULL;</span>
<span class="line-added">+     }</span>
      glyphInfo-&gt;cellInfo = NULL;
      glyphInfo-&gt;width = width;
      glyphInfo-&gt;height = height;
      glyphInfo-&gt;topLeftX = xcs.lbearing;
      glyphInfo-&gt;topLeftY = -xcs.ascent;
</pre>
<center><a href="../opengl/J2D_GL/glxext.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="X11SurfaceData.c.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>