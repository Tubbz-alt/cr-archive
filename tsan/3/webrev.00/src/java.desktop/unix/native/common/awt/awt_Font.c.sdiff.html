<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/unix/native/common/awt/awt_Font.c</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="X11Color.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="awt_p.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/unix/native/common/awt/awt_Font.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1995, 2014, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
<span class="line-removed"> 26 #ifndef HEADLESS</span>
<span class="line-removed"> 27 </span>
<span class="line-removed"> 28 #include &quot;awt_p.h&quot;</span>
<span class="line-removed"> 29 #include &lt;string.h&gt;</span>
<span class="line-removed"> 30 #include &quot;java_awt_Component.h&quot;</span>
 31 #include &quot;java_awt_Font.h&quot;
<span class="line-modified"> 32 #include &quot;java_awt_FontMetrics.h&quot;</span>
<span class="line-modified"> 33 #include &quot;sun_awt_X11GraphicsEnvironment.h&quot;</span>
<span class="line-removed"> 34 </span>
<span class="line-removed"> 35 #include &quot;awt_Font.h&quot;</span>
<span class="line-removed"> 36 </span>
<span class="line-removed"> 37 #include &quot;java_awt_Dimension.h&quot;</span>
<span class="line-removed"> 38 #include &quot;multi_font.h&quot;</span>
<span class="line-removed"> 39 #include &quot;Disposer.h&quot;</span>
<span class="line-removed"> 40 #endif /* !HEADLESS */</span>
<span class="line-removed"> 41 #include &lt;jni.h&gt;</span>
<span class="line-removed"> 42 #ifndef HEADLESS</span>
<span class="line-removed"> 43 #include &lt;jni_util.h&gt;</span>
<span class="line-removed"> 44 </span>
<span class="line-removed"> 45 #define defaultXLFD &quot;-*-helvetica-*-*-*-*-12-*-*-*-*-*-iso8859-1&quot;</span>
<span class="line-removed"> 46 </span>
<span class="line-removed"> 47 struct FontIDs fontIDs;</span>
<span class="line-removed"> 48 struct PlatformFontIDs platformFontIDs;</span>
<span class="line-removed"> 49 </span>
<span class="line-removed"> 50 static void pDataDisposeMethod(JNIEnv *env, jlong pData);</span>
 51 
<span class="line-removed"> 52 /* #define FONT_DEBUG 2 */</span>
<span class="line-removed"> 53 /* 1- print failures, 2- print all, 3- terminate on failure */</span>
<span class="line-removed"> 54 #if FONT_DEBUG</span>
<span class="line-removed"> 55 static XFontStruct *XLoadQueryFontX(Display *display, char *name)</span>
<span class="line-removed"> 56 {</span>
<span class="line-removed"> 57     XFontStruct *result = NULL;</span>
<span class="line-removed"> 58     result = XLoadQueryFont(display, name);</span>
<span class="line-removed"> 59 #if FONT_DEBUG &lt; 2</span>
<span class="line-removed"> 60     if (result == NULL)</span>
<span class="line-removed"> 61 #endif</span>
<span class="line-removed"> 62         fprintf(stderr, &quot;XLoadQueryFont(\&quot;%s\&quot;) -&gt; 0x%x.\n&quot;, name, result);</span>
<span class="line-removed"> 63 #if FONT_DEBUG &gt;= 3</span>
<span class="line-removed"> 64     if (result == NULL)</span>
<span class="line-removed"> 65         exit(-1);</span>
<span class="line-removed"> 66 #endif</span>
<span class="line-removed"> 67     return result;</span>
<span class="line-removed"> 68 }</span>
<span class="line-removed"> 69 #define XLoadQueryFont XLoadQueryFontX</span>
<span class="line-removed"> 70 #endif</span>
<span class="line-removed"> 71 #endif /* !HEADLESS */</span>
 72 
 73 /*
 74  * Class:     java_awt_Font
 75  * Method:    initIDs
 76  * Signature: ()V
 77  */
 78 
 79 /* This function gets called from the static initializer for Font.java
 80    to initialize the fieldIDs for fields that may be accessed from C */
 81 
 82 JNIEXPORT void JNICALL
<span class="line-modified"> 83 Java_java_awt_Font_initIDs</span>
<span class="line-removed"> 84   (JNIEnv *env, jclass cls)</span>
<span class="line-removed"> 85 {</span>
<span class="line-removed"> 86 #ifndef HEADLESS</span>
<span class="line-removed"> 87     CHECK_NULL(fontIDs.pData = (*env)-&gt;GetFieldID(env, cls, &quot;pData&quot;, &quot;J&quot;));</span>
<span class="line-removed"> 88     CHECK_NULL(fontIDs.style = (*env)-&gt;GetFieldID(env, cls, &quot;style&quot;, &quot;I&quot;));</span>
<span class="line-removed"> 89     CHECK_NULL(fontIDs.size = (*env)-&gt;GetFieldID(env, cls, &quot;size&quot;, &quot;I&quot;));</span>
<span class="line-removed"> 90     CHECK_NULL(fontIDs.getPeer = (*env)-&gt;GetMethodID(env, cls, &quot;getFontPeer&quot;,</span>
<span class="line-removed"> 91                                                      &quot;()Ljava/awt/peer/FontPeer;&quot;));</span>
<span class="line-removed"> 92     CHECK_NULL(fontIDs.getFamily = (*env)-&gt;GetMethodID(env, cls, &quot;getFamily_NoClientCode&quot;,</span>
<span class="line-removed"> 93                                                        &quot;()Ljava/lang/String;&quot;));</span>
<span class="line-removed"> 94 #endif /* !HEADLESS */</span>
 95 }
 96 
<span class="line-removed"> 97 #ifndef HEADLESS</span>
<span class="line-removed"> 98 /* fieldIDs for FontDescriptor fields that may be accessed from C */</span>
<span class="line-removed"> 99 static struct FontDescriptorIDs {</span>
<span class="line-removed">100     jfieldID nativeName;</span>
<span class="line-removed">101     jfieldID charsetName;</span>
<span class="line-removed">102 } fontDescriptorIDs;</span>
<span class="line-removed">103 #endif /* !HEADLESS */</span>
<span class="line-removed">104 </span>
105 /*
106  * Class:     sun_awt_FontDescriptor
107  * Method:    initIDs
108  * Signature: ()V
109  */
110 
111 /* This function gets called from the static initializer for
112    FontDescriptor.java to initialize the fieldIDs for fields
113    that may be accessed from C */
114 
115 JNIEXPORT void JNICALL
<span class="line-modified">116 Java_sun_awt_FontDescriptor_initIDs</span>
<span class="line-removed">117   (JNIEnv *env, jclass cls)</span>
<span class="line-removed">118 {</span>
<span class="line-removed">119 #ifndef HEADLESS</span>
<span class="line-removed">120     CHECK_NULL(fontDescriptorIDs.nativeName =</span>
<span class="line-removed">121                (*env)-&gt;GetFieldID(env, cls, &quot;nativeName&quot;, &quot;Ljava/lang/String;&quot;));</span>
<span class="line-removed">122     CHECK_NULL(fontDescriptorIDs.charsetName =</span>
<span class="line-removed">123                (*env)-&gt;GetFieldID(env, cls, &quot;charsetName&quot;, &quot;Ljava/lang/String;&quot;));</span>
<span class="line-removed">124 #endif /* !HEADLESS */</span>
125 }
126 
127 /*
128  * Class:     sun_awt_PlatformFont
129  * Method:    initIDs
130  * Signature: ()V
131  */
132 
133 /* This function gets called from the static initializer for
134    PlatformFont.java to initialize the fieldIDs for fields
135    that may be accessed from C */
136 
137 JNIEXPORT void JNICALL
<span class="line-modified">138 Java_sun_awt_PlatformFont_initIDs</span>
<span class="line-removed">139   (JNIEnv *env, jclass cls)</span>
<span class="line-removed">140 {</span>
<span class="line-removed">141 #ifndef HEADLESS</span>
<span class="line-removed">142     CHECK_NULL(platformFontIDs.componentFonts =</span>
<span class="line-removed">143                (*env)-&gt;GetFieldID(env, cls, &quot;componentFonts&quot;,</span>
<span class="line-removed">144                                   &quot;[Lsun/awt/FontDescriptor;&quot;));</span>
<span class="line-removed">145     CHECK_NULL(platformFontIDs.fontConfig =</span>
<span class="line-removed">146                (*env)-&gt;GetFieldID(env,cls, &quot;fontConfig&quot;,</span>
<span class="line-removed">147                                   &quot;Lsun/awt/FontConfiguration;&quot;));</span>
<span class="line-removed">148     CHECK_NULL(platformFontIDs.makeConvertedMultiFontString =</span>
<span class="line-removed">149                (*env)-&gt;GetMethodID(env, cls, &quot;makeConvertedMultiFontString&quot;,</span>
<span class="line-removed">150                                    &quot;(Ljava/lang/String;)[Ljava/lang/Object;&quot;));</span>
<span class="line-removed">151     CHECK_NULL(platformFontIDs.makeConvertedMultiFontChars =</span>
<span class="line-removed">152                (*env)-&gt;GetMethodID(env, cls, &quot;makeConvertedMultiFontChars&quot;,</span>
<span class="line-removed">153                                    &quot;([CII)[Ljava/lang/Object;&quot;));</span>
<span class="line-removed">154 #endif /* !HEADLESS */</span>
<span class="line-removed">155 }</span>
<span class="line-removed">156 </span>
<span class="line-removed">157 #ifndef HEADLESS</span>
<span class="line-removed">158 XFontStruct *</span>
<span class="line-removed">159 loadFont(Display * display, char *name, int32_t pointSize)</span>
<span class="line-removed">160 {</span>
<span class="line-removed">161     XFontStruct *f = NULL;</span>
<span class="line-removed">162 </span>
<span class="line-removed">163     /* try the exact xlfd name in font configuration file */</span>
<span class="line-removed">164     f = XLoadQueryFont(display, name);</span>
<span class="line-removed">165     if (f != NULL) {</span>
<span class="line-removed">166         return f;</span>
<span class="line-removed">167     }</span>
<span class="line-removed">168 </span>
<span class="line-removed">169     /*</span>
<span class="line-removed">170      * try nearly font</span>
<span class="line-removed">171      *</span>
<span class="line-removed">172      *  1. specify FAMILY_NAME, WEIGHT_NAME, SLANT, POINT_SIZE,</span>
<span class="line-removed">173      *     CHARSET_REGISTRY and CHARSET_ENCODING.</span>
<span class="line-removed">174      *  2. change POINT_SIZE to PIXEL_SIZE</span>
<span class="line-removed">175      *  3. change FAMILY_NAME to *</span>
<span class="line-removed">176      *  4. specify only PIXEL_SIZE and CHARSET_REGISTRY/ENCODING</span>
<span class="line-removed">177      *  5. change PIXEL_SIZE +1/-1/+2/-2...+4/-4</span>
<span class="line-removed">178      *  6. default font pattern</span>
<span class="line-removed">179      */</span>
<span class="line-removed">180     {</span>
<span class="line-removed">181         /*</span>
<span class="line-removed">182          * This code assumes the name contains exactly 14 &#39;-&#39; delimiter.</span>
<span class="line-removed">183          * If not use default pattern.</span>
<span class="line-removed">184          */</span>
<span class="line-removed">185         int32_t i, length, pixelSize;</span>
<span class="line-removed">186         Boolean useDefault = FALSE;</span>
<span class="line-removed">187 </span>
<span class="line-removed">188         char buffer[BUFSIZ], buffer2[BUFSIZ];</span>
<span class="line-removed">189         char *family = NULL, *style = NULL, *slant = NULL, *encoding = NULL;</span>
<span class="line-removed">190         char *start = NULL, *end = NULL;</span>
<span class="line-removed">191 </span>
<span class="line-removed">192         if (strlen(name) &gt; BUFSIZ - 1) {</span>
<span class="line-removed">193             useDefault = TRUE;</span>
<span class="line-removed">194         } else {</span>
<span class="line-removed">195             strcpy(buffer, name);</span>
<span class="line-removed">196         }</span>
<span class="line-removed">197 </span>
<span class="line-removed">198 #define NEXT_HYPHEN\</span>
<span class="line-removed">199         start = end + 1;\</span>
<span class="line-removed">200         end = strchr(start, &#39;-&#39;);\</span>
<span class="line-removed">201         if (end == NULL) {\</span>
<span class="line-removed">202                               useDefault = TRUE;\</span>
<span class="line-removed">203         break;\</span>
<span class="line-removed">204         }\</span>
<span class="line-removed">205         *end = &#39;\0&#39;</span>
<span class="line-removed">206 </span>
<span class="line-removed">207              do {</span>
<span class="line-removed">208                  end = buffer;</span>
<span class="line-removed">209 </span>
<span class="line-removed">210                  /* skip FOUNDRY */</span>
<span class="line-removed">211                  NEXT_HYPHEN;</span>
<span class="line-removed">212 </span>
<span class="line-removed">213                  /* set FAMILY_NAME */</span>
<span class="line-removed">214                  NEXT_HYPHEN;</span>
<span class="line-removed">215                  family = start;</span>
<span class="line-removed">216 </span>
<span class="line-removed">217                  /* set STYLE_NAME */</span>
<span class="line-removed">218                  NEXT_HYPHEN;</span>
<span class="line-removed">219                  style = start;</span>
<span class="line-removed">220 </span>
<span class="line-removed">221                  /* set SLANT */</span>
<span class="line-removed">222                  NEXT_HYPHEN;</span>
<span class="line-removed">223                  slant = start;</span>
<span class="line-removed">224 </span>
<span class="line-removed">225                  /* skip SETWIDTH_NAME, ADD_STYLE_NAME, PIXEL_SIZE</span>
<span class="line-removed">226                     POINT_SIZE, RESOLUTION_X, RESOLUTION_Y, SPACING</span>
<span class="line-removed">227                     and AVERAGE_WIDTH */</span>
<span class="line-removed">228                  NEXT_HYPHEN;</span>
<span class="line-removed">229                  NEXT_HYPHEN;</span>
<span class="line-removed">230                  NEXT_HYPHEN;</span>
<span class="line-removed">231                  NEXT_HYPHEN;</span>
<span class="line-removed">232                  NEXT_HYPHEN;</span>
<span class="line-removed">233                  NEXT_HYPHEN;</span>
<span class="line-removed">234                  NEXT_HYPHEN;</span>
<span class="line-removed">235                  NEXT_HYPHEN;</span>
<span class="line-removed">236 </span>
<span class="line-removed">237                  /* set CHARSET_REGISTRY and CHARSET_ENCODING */</span>
<span class="line-removed">238                  encoding = end + 1;</span>
<span class="line-removed">239              }</span>
<span class="line-removed">240              while (0);</span>
<span class="line-removed">241 </span>
<span class="line-removed">242 #define TRY_LOAD\</span>
<span class="line-removed">243         f = XLoadQueryFont(display, buffer2);\</span>
<span class="line-removed">244         if (f != NULL) {\</span>
<span class="line-removed">245                             strcpy(name, buffer2);\</span>
<span class="line-removed">246         return f;\</span>
<span class="line-removed">247         }</span>
<span class="line-removed">248 </span>
<span class="line-removed">249         if (!useDefault) {</span>
<span class="line-removed">250             char *altstyle = NULL;</span>
<span class="line-removed">251 </span>
<span class="line-removed">252             /* Regular is the style for TrueType fonts -- Type1, F3 use roman */</span>
<span class="line-removed">253             if (strcmp(style, &quot;regular&quot;) == 0) {</span>
<span class="line-removed">254                 altstyle = &quot;roman&quot;;</span>
<span class="line-removed">255             }</span>
<span class="line-removed">256 #if defined(__linux__) || defined(MACOSX)</span>
<span class="line-removed">257             if (!strcmp(family, &quot;lucidasans&quot;)) {</span>
<span class="line-removed">258                 family = &quot;lucida&quot;;</span>
<span class="line-removed">259             }</span>
<span class="line-removed">260 #endif</span>
<span class="line-removed">261             /* try 1. */</span>
<span class="line-removed">262             jio_snprintf(buffer2, sizeof(buffer2),</span>
<span class="line-removed">263                          &quot;-*-%s-%s-%s-*-*-*-%d-*-*-*-*-%s&quot;,</span>
<span class="line-removed">264                          family, style, slant, pointSize, encoding);</span>
<span class="line-removed">265             TRY_LOAD;</span>
<span class="line-removed">266 </span>
<span class="line-removed">267             if (altstyle != NULL) {</span>
<span class="line-removed">268                 jio_snprintf(buffer2, sizeof(buffer2),</span>
<span class="line-removed">269                              &quot;-*-%s-%s-%s-*-*-*-%d-*-*-*-*-%s&quot;,</span>
<span class="line-removed">270                              family, altstyle, slant, pointSize, encoding);</span>
<span class="line-removed">271                 TRY_LOAD;</span>
<span class="line-removed">272             }</span>
<span class="line-removed">273 </span>
<span class="line-removed">274             /* search bitmap font */</span>
<span class="line-removed">275             pixelSize = pointSize / 10;</span>
<span class="line-removed">276 </span>
<span class="line-removed">277             /* try 2. */</span>
<span class="line-removed">278             jio_snprintf(buffer2, sizeof(buffer2),</span>
<span class="line-removed">279                          &quot;-*-%s-%s-%s-*-*-%d-*-*-*-*-*-%s&quot;,</span>
<span class="line-removed">280                          family, style, slant, pixelSize, encoding);</span>
<span class="line-removed">281             TRY_LOAD;</span>
<span class="line-removed">282 </span>
<span class="line-removed">283             if (altstyle != NULL) {</span>
<span class="line-removed">284                 jio_snprintf(buffer2, sizeof(buffer2),</span>
<span class="line-removed">285                              &quot;-*-%s-%s-%s-*-*-%d-*-*-*-*-*-%s&quot;,</span>
<span class="line-removed">286                              family, altstyle, slant, pixelSize, encoding);</span>
<span class="line-removed">287                 TRY_LOAD;</span>
<span class="line-removed">288             }</span>
<span class="line-removed">289 </span>
<span class="line-removed">290             /* try 3 */</span>
<span class="line-removed">291             jio_snprintf(buffer2, sizeof(buffer2),</span>
<span class="line-removed">292                          &quot;-*-*-%s-%s-*-*-%d-*-*-*-*-*-%s&quot;,</span>
<span class="line-removed">293                          style, slant, pixelSize, encoding);</span>
<span class="line-removed">294             TRY_LOAD;</span>
<span class="line-removed">295             if (altstyle != NULL) {</span>
<span class="line-removed">296                 jio_snprintf(buffer2, sizeof(buffer2),</span>
<span class="line-removed">297                              &quot;-*-*-%s-%s-*-*-%d-*-*-*-*-*-%s&quot;,</span>
<span class="line-removed">298                              altstyle, slant, pixelSize, encoding);</span>
<span class="line-removed">299                 TRY_LOAD;</span>
<span class="line-removed">300             }</span>
<span class="line-removed">301 </span>
<span class="line-removed">302             /* try 4 */</span>
<span class="line-removed">303             jio_snprintf(buffer2, sizeof(buffer2),</span>
<span class="line-removed">304                          &quot;-*-*-*-%s-*-*-%d-*-*-*-*-*-%s&quot;,</span>
<span class="line-removed">305                          slant, pixelSize, encoding);</span>
<span class="line-removed">306 </span>
<span class="line-removed">307             TRY_LOAD;</span>
<span class="line-removed">308 </span>
<span class="line-removed">309             /* try 5. */</span>
<span class="line-removed">310             jio_snprintf(buffer2, sizeof(buffer2),</span>
<span class="line-removed">311                          &quot;-*-*-*-*-*-*-%d-*-*-*-*-*-%s&quot;,</span>
<span class="line-removed">312                          pixelSize, encoding);</span>
<span class="line-removed">313             TRY_LOAD;</span>
<span class="line-removed">314 </span>
<span class="line-removed">315             /* try 6. */</span>
<span class="line-removed">316             for (i = 1; i &lt; 4; i++) {</span>
<span class="line-removed">317                 if (pixelSize &lt; i)</span>
<span class="line-removed">318                     break;</span>
<span class="line-removed">319                 jio_snprintf(buffer2, sizeof(buffer2),</span>
<span class="line-removed">320                              &quot;-*-%s-%s-%s-*-*-%d-*-*-*-*-*-%s&quot;,</span>
<span class="line-removed">321                              family, style, slant, pixelSize + i, encoding);</span>
<span class="line-removed">322                 TRY_LOAD;</span>
<span class="line-removed">323 </span>
<span class="line-removed">324                 jio_snprintf(buffer2, sizeof(buffer2),</span>
<span class="line-removed">325                              &quot;-*-%s-%s-%s-*-*-%d-*-*-*-*-*-%s&quot;,</span>
<span class="line-removed">326                              family, style, slant, pixelSize - i, encoding);</span>
<span class="line-removed">327                 TRY_LOAD;</span>
<span class="line-removed">328 </span>
<span class="line-removed">329                 jio_snprintf(buffer2, sizeof(buffer2),</span>
<span class="line-removed">330                              &quot;-*-*-*-*-*-*-%d-*-*-*-*-*-%s&quot;,</span>
<span class="line-removed">331                              pixelSize + i, encoding);</span>
<span class="line-removed">332                 TRY_LOAD;</span>
<span class="line-removed">333 </span>
<span class="line-removed">334                 jio_snprintf(buffer2, sizeof(buffer2),</span>
<span class="line-removed">335                              &quot;-*-*-*-*-*-*-%d-*-*-*-*-*-%s&quot;,</span>
<span class="line-removed">336                              pixelSize - i, encoding);</span>
<span class="line-removed">337                 TRY_LOAD;</span>
<span class="line-removed">338             }</span>
<span class="line-removed">339         }</span>
<span class="line-removed">340     }</span>
<span class="line-removed">341 </span>
<span class="line-removed">342     strcpy(name, defaultXLFD);</span>
<span class="line-removed">343     return XLoadQueryFont(display, defaultXLFD);</span>
<span class="line-removed">344 }</span>
<span class="line-removed">345 </span>
<span class="line-removed">346 /*</span>
<span class="line-removed">347  * Hardwired list of mappings for generic font names &quot;Helvetica&quot;,</span>
<span class="line-removed">348  * &quot;TimesRoman&quot;, &quot;Courier&quot;, &quot;Dialog&quot;, and &quot;DialogInput&quot;.</span>
<span class="line-removed">349  */</span>
<span class="line-removed">350 static char *defaultfontname = &quot;fixed&quot;;</span>
<span class="line-removed">351 static char *defaultfoundry = &quot;misc&quot;;</span>
<span class="line-removed">352 static char *anyfoundry = &quot;*&quot;;</span>
<span class="line-removed">353 static char *anystyle = &quot;*-*&quot;;</span>
<span class="line-removed">354 static char *isolatin1 = &quot;iso8859-1&quot;;</span>
<span class="line-removed">355 </span>
<span class="line-removed">356 static char *</span>
<span class="line-removed">357 Style(int32_t s)</span>
<span class="line-removed">358 {</span>
<span class="line-removed">359     switch (s) {</span>
<span class="line-removed">360         case java_awt_Font_ITALIC:</span>
<span class="line-removed">361             return &quot;medium-i&quot;;</span>
<span class="line-removed">362         case java_awt_Font_BOLD:</span>
<span class="line-removed">363             return &quot;bold-r&quot;;</span>
<span class="line-removed">364         case java_awt_Font_BOLD + java_awt_Font_ITALIC:</span>
<span class="line-removed">365             return &quot;bold-i&quot;;</span>
<span class="line-removed">366         case java_awt_Font_PLAIN:</span>
<span class="line-removed">367         default:</span>
<span class="line-removed">368             return &quot;medium-r&quot;;</span>
<span class="line-removed">369     }</span>
<span class="line-removed">370 }</span>
<span class="line-removed">371 </span>
<span class="line-removed">372 static int32_t</span>
<span class="line-removed">373 awtJNI_FontName(JNIEnv * env, jstring name, char **foundry, char **facename, char **encoding)</span>
<span class="line-removed">374 {</span>
<span class="line-removed">375     char *cname = NULL;</span>
<span class="line-removed">376 </span>
<span class="line-removed">377     if (JNU_IsNull(env, name)) {</span>
<span class="line-removed">378         return 0;</span>
<span class="line-removed">379     }</span>
<span class="line-removed">380     cname = (char *) JNU_GetStringPlatformChars(env, name, NULL);</span>
<span class="line-removed">381     if (cname == NULL) {</span>
<span class="line-removed">382         (*env)-&gt;ExceptionClear(env);</span>
<span class="line-removed">383         JNU_ThrowOutOfMemoryError(env, &quot;Could not create font name&quot;);</span>
<span class="line-removed">384         return 0;</span>
<span class="line-removed">385     }</span>
<span class="line-removed">386 </span>
<span class="line-removed">387     /* additional default font names */</span>
<span class="line-removed">388     if (strcmp(cname, &quot;serif&quot;) == 0) {</span>
<span class="line-removed">389         *foundry = &quot;adobe&quot;;</span>
<span class="line-removed">390         *facename = &quot;times&quot;;</span>
<span class="line-removed">391         *encoding = isolatin1;</span>
<span class="line-removed">392     } else if (strcmp(cname, &quot;sansserif&quot;) == 0) {</span>
<span class="line-removed">393         *foundry = &quot;adobe&quot;;</span>
<span class="line-removed">394         *facename = &quot;helvetica&quot;;</span>
<span class="line-removed">395         *encoding = isolatin1;</span>
<span class="line-removed">396     } else if (strcmp(cname, &quot;monospaced&quot;) == 0) {</span>
<span class="line-removed">397         *foundry = &quot;adobe&quot;;</span>
<span class="line-removed">398         *facename = &quot;courier&quot;;</span>
<span class="line-removed">399         *encoding = isolatin1;</span>
<span class="line-removed">400     } else if (strcmp(cname, &quot;helvetica&quot;) == 0) {</span>
<span class="line-removed">401         *foundry = &quot;adobe&quot;;</span>
<span class="line-removed">402         *facename = &quot;helvetica&quot;;</span>
<span class="line-removed">403         *encoding = isolatin1;</span>
<span class="line-removed">404     } else if (strcmp(cname, &quot;timesroman&quot;) == 0) {</span>
<span class="line-removed">405         *foundry = &quot;adobe&quot;;</span>
<span class="line-removed">406         *facename = &quot;times&quot;;</span>
<span class="line-removed">407         *encoding = isolatin1;</span>
<span class="line-removed">408     } else if (strcmp(cname, &quot;courier&quot;) == 0) {</span>
<span class="line-removed">409         *foundry = &quot;adobe&quot;;</span>
<span class="line-removed">410         *facename = &quot;courier&quot;;</span>
<span class="line-removed">411         *encoding = isolatin1;</span>
<span class="line-removed">412     } else if (strcmp(cname, &quot;dialog&quot;) == 0) {</span>
<span class="line-removed">413         *foundry = &quot;b&amp;h&quot;;</span>
<span class="line-removed">414         *facename = &quot;lucida&quot;;</span>
<span class="line-removed">415         *encoding = isolatin1;</span>
<span class="line-removed">416     } else if (strcmp(cname, &quot;dialoginput&quot;) == 0) {</span>
<span class="line-removed">417         *foundry = &quot;b&amp;h&quot;;</span>
<span class="line-removed">418         *facename = &quot;lucidatypewriter&quot;;</span>
<span class="line-removed">419         *encoding = isolatin1;</span>
<span class="line-removed">420     } else if (strcmp(cname, &quot;zapfdingbats&quot;) == 0) {</span>
<span class="line-removed">421         *foundry = &quot;itc&quot;;</span>
<span class="line-removed">422         *facename = &quot;zapfdingbats&quot;;</span>
<span class="line-removed">423         *encoding = &quot;*-*&quot;;</span>
<span class="line-removed">424     } else {</span>
<span class="line-removed">425 #ifdef DEBUG</span>
<span class="line-removed">426         jio_fprintf(stderr, &quot;Unknown font: %s\n&quot;, cname);</span>
<span class="line-removed">427 #endif</span>
<span class="line-removed">428         *foundry = defaultfoundry;</span>
<span class="line-removed">429         *facename = defaultfontname;</span>
<span class="line-removed">430         *encoding = isolatin1;</span>
<span class="line-removed">431     }</span>
<span class="line-removed">432 </span>
<span class="line-removed">433     if (cname != NULL)</span>
<span class="line-removed">434         JNU_ReleaseStringPlatformChars(env, name, (const char *) cname);</span>
<span class="line-removed">435 </span>
<span class="line-removed">436     return 1;</span>
<span class="line-removed">437 }</span>
<span class="line-removed">438 </span>
<span class="line-removed">439 struct FontData *</span>
<span class="line-removed">440 awtJNI_GetFontData(JNIEnv * env, jobject font, char **errmsg)</span>
<span class="line-removed">441 {</span>
<span class="line-removed">442     /* We are going to create at most 4 outstanding local refs in this</span>
<span class="line-removed">443      * function. */</span>
<span class="line-removed">444     if ((*env)-&gt;EnsureLocalCapacity(env, 4) &lt; 0) {</span>
<span class="line-removed">445         return NULL;</span>
<span class="line-removed">446     }</span>
<span class="line-removed">447 </span>
<span class="line-removed">448     if (!JNU_IsNull(env, font) &amp;&amp; awtJNI_IsMultiFont(env, font)) {</span>
<span class="line-removed">449         JNU_CHECK_EXCEPTION_RETURN(env, NULL);</span>
<span class="line-removed">450 </span>
<span class="line-removed">451         struct FontData *fdata = NULL;</span>
<span class="line-removed">452         int32_t i, size;</span>
<span class="line-removed">453         char *fontsetname = NULL;</span>
<span class="line-removed">454         char *nativename = NULL;</span>
<span class="line-removed">455         Boolean doFree = FALSE;</span>
<span class="line-removed">456         jobjectArray componentFonts = NULL;</span>
<span class="line-removed">457         jobject peer = NULL;</span>
<span class="line-removed">458         jobject fontDescriptor = NULL;</span>
<span class="line-removed">459         jstring fontDescriptorName = NULL;</span>
<span class="line-removed">460         jstring charsetName = NULL;</span>
<span class="line-removed">461 </span>
<span class="line-removed">462         fdata = (struct FontData *) JNU_GetLongFieldAsPtr(env,font,</span>
<span class="line-removed">463                                                          fontIDs.pData);</span>
<span class="line-removed">464 </span>
<span class="line-removed">465         if (fdata != NULL &amp;&amp; fdata-&gt;flist != NULL) {</span>
<span class="line-removed">466             return fdata;</span>
<span class="line-removed">467         }</span>
<span class="line-removed">468         size = (*env)-&gt;GetIntField(env, font, fontIDs.size);</span>
<span class="line-removed">469         fdata = (struct FontData *) malloc(sizeof(struct FontData));</span>
<span class="line-removed">470 </span>
<span class="line-removed">471         peer = (*env)-&gt;CallObjectMethod(env, font, fontIDs.getPeer);</span>
<span class="line-removed">472 </span>
<span class="line-removed">473         componentFonts =</span>
<span class="line-removed">474           (*env)-&gt;GetObjectField(env, peer, platformFontIDs.componentFonts);</span>
<span class="line-removed">475         /* We no longer need peer */</span>
<span class="line-removed">476         (*env)-&gt;DeleteLocalRef(env, peer);</span>
<span class="line-removed">477 </span>
<span class="line-removed">478         fdata-&gt;charset_num = (*env)-&gt;GetArrayLength(env, componentFonts);</span>
<span class="line-removed">479 </span>
<span class="line-removed">480         fdata-&gt;flist = (awtFontList *) malloc(sizeof(awtFontList)</span>
<span class="line-removed">481                                               * fdata-&gt;charset_num);</span>
<span class="line-removed">482         fdata-&gt;xfont = NULL;</span>
<span class="line-removed">483         for (i = 0; i &lt; fdata-&gt;charset_num; i++) {</span>
<span class="line-removed">484             /*</span>
<span class="line-removed">485              * set xlfd name</span>
<span class="line-removed">486              */</span>
<span class="line-removed">487 </span>
<span class="line-removed">488             fontDescriptor = (*env)-&gt;GetObjectArrayElement(env, componentFonts, i);</span>
<span class="line-removed">489             fontDescriptorName =</span>
<span class="line-removed">490               (*env)-&gt;GetObjectField(env, fontDescriptor,</span>
<span class="line-removed">491                                      fontDescriptorIDs.nativeName);</span>
<span class="line-removed">492 </span>
<span class="line-removed">493             if (!JNU_IsNull(env, fontDescriptorName)) {</span>
<span class="line-removed">494                 nativename = (char *) JNU_GetStringPlatformChars(env, fontDescriptorName, NULL);</span>
<span class="line-removed">495                 if (nativename == NULL) {</span>
<span class="line-removed">496                     nativename = &quot;&quot;;</span>
<span class="line-removed">497                     doFree = FALSE;</span>
<span class="line-removed">498                 } else {</span>
<span class="line-removed">499                     doFree = TRUE;</span>
<span class="line-removed">500                 }</span>
<span class="line-removed">501             } else {</span>
<span class="line-removed">502                 nativename = &quot;&quot;;</span>
<span class="line-removed">503                 doFree = FALSE;</span>
<span class="line-removed">504             }</span>
<span class="line-removed">505 </span>
<span class="line-removed">506             fdata-&gt;flist[i].xlfd = malloc(strlen(nativename)</span>
<span class="line-removed">507                                           + strlen(defaultXLFD));</span>
<span class="line-removed">508             jio_snprintf(fdata-&gt;flist[i].xlfd, strlen(nativename) + 10,</span>
<span class="line-removed">509                          nativename, size * 10);</span>
<span class="line-removed">510 </span>
<span class="line-removed">511             if (nativename != NULL &amp;&amp; doFree)</span>
<span class="line-removed">512                 JNU_ReleaseStringPlatformChars(env, fontDescriptorName, (const char *) nativename);</span>
<span class="line-removed">513 </span>
<span class="line-removed">514             /*</span>
<span class="line-removed">515              * set charset_name</span>
<span class="line-removed">516              */</span>
<span class="line-removed">517 </span>
<span class="line-removed">518             charsetName =</span>
<span class="line-removed">519               (*env)-&gt;GetObjectField(env, fontDescriptor,</span>
<span class="line-removed">520                                      fontDescriptorIDs.charsetName);</span>
<span class="line-removed">521 </span>
<span class="line-removed">522             fdata-&gt;flist[i].charset_name = (char *)</span>
<span class="line-removed">523                 JNU_GetStringPlatformChars(env, charsetName, NULL);</span>
<span class="line-removed">524             if (fdata-&gt;flist[i].charset_name == NULL) {</span>
<span class="line-removed">525                 (*env)-&gt;ExceptionClear(env);</span>
<span class="line-removed">526                 JNU_ThrowOutOfMemoryError(env, &quot;Could not create charset name&quot;);</span>
<span class="line-removed">527                 return NULL;</span>
<span class="line-removed">528             }</span>
<span class="line-removed">529 </span>
<span class="line-removed">530             /* We are done with the objects. */</span>
<span class="line-removed">531             (*env)-&gt;DeleteLocalRef(env, fontDescriptor);</span>
<span class="line-removed">532             (*env)-&gt;DeleteLocalRef(env, fontDescriptorName);</span>
<span class="line-removed">533             (*env)-&gt;DeleteLocalRef(env, charsetName);</span>
<span class="line-removed">534 </span>
<span class="line-removed">535             /*</span>
<span class="line-removed">536              * set load &amp; XFontStruct</span>
<span class="line-removed">537              */</span>
<span class="line-removed">538             fdata-&gt;flist[i].load = 0;</span>
<span class="line-removed">539 </span>
<span class="line-removed">540             /*</span>
<span class="line-removed">541              * This appears to be a bogus check.  The actual intent appears</span>
<span class="line-removed">542              * to be to find out whether this is the &quot;base&quot; font in a set,</span>
<span class="line-removed">543              * rather than iso8859_1 explicitly.  Note that iso8859_15 will</span>
<span class="line-removed">544              * and must also pass this test.</span>
<span class="line-removed">545              */</span>
<span class="line-removed">546 </span>
<span class="line-removed">547             if (fdata-&gt;xfont == NULL &amp;&amp;</span>
<span class="line-removed">548                 strstr(fdata-&gt;flist[i].charset_name, &quot;8859_1&quot;)) {</span>
<span class="line-removed">549                 fdata-&gt;flist[i].xfont =</span>
<span class="line-removed">550                     loadFont(awt_display, fdata-&gt;flist[i].xlfd, size * 10);</span>
<span class="line-removed">551                 if (fdata-&gt;flist[i].xfont != NULL) {</span>
<span class="line-removed">552                     fdata-&gt;flist[i].load = 1;</span>
<span class="line-removed">553                     fdata-&gt;xfont = fdata-&gt;flist[i].xfont;</span>
<span class="line-removed">554                     fdata-&gt;flist[i].index_length = 1;</span>
<span class="line-removed">555                 } else {</span>
<span class="line-removed">556                     /* Free any already allocated storage and fonts */</span>
<span class="line-removed">557                     int j = i;</span>
<span class="line-removed">558                     for (j = 0; j &lt;= i; j++) {</span>
<span class="line-removed">559                         free((void *)fdata-&gt;flist[j].xlfd);</span>
<span class="line-removed">560                         JNU_ReleaseStringPlatformChars(env, NULL,</span>
<span class="line-removed">561                             fdata-&gt;flist[j].charset_name);</span>
<span class="line-removed">562                         if (fdata-&gt;flist[j].load) {</span>
<span class="line-removed">563                             XFreeFont(awt_display, fdata-&gt;flist[j].xfont);</span>
<span class="line-removed">564                         }</span>
<span class="line-removed">565                     }</span>
<span class="line-removed">566                     free((void *)fdata-&gt;flist);</span>
<span class="line-removed">567                     free((void *)fdata);</span>
<span class="line-removed">568 </span>
<span class="line-removed">569                     if (errmsg != NULL) {</span>
<span class="line-removed">570                         *errmsg = &quot;java/lang&quot; &quot;NullPointerException&quot;;</span>
<span class="line-removed">571                     }</span>
<span class="line-removed">572                     (*env)-&gt;DeleteLocalRef(env, componentFonts);</span>
<span class="line-removed">573                     return NULL;</span>
<span class="line-removed">574                 }</span>
<span class="line-removed">575             }</span>
<span class="line-removed">576         }</span>
<span class="line-removed">577         (*env)-&gt;DeleteLocalRef(env, componentFonts);</span>
<span class="line-removed">578         /*</span>
<span class="line-removed">579          * XFontSet will create if the peer of TextField/TextArea</span>
<span class="line-removed">580          * are used.</span>
<span class="line-removed">581          */</span>
<span class="line-removed">582         fdata-&gt;xfs = NULL;</span>
<span class="line-removed">583 </span>
<span class="line-removed">584         JNU_SetLongFieldFromPtr(env,font,fontIDs.pData,fdata);</span>
<span class="line-removed">585         Disposer_AddRecord(env, font, pDataDisposeMethod, ptr_to_jlong(fdata));</span>
<span class="line-removed">586         return fdata;</span>
<span class="line-removed">587     } else {</span>
<span class="line-removed">588         JNU_CHECK_EXCEPTION_RETURN(env, NULL);</span>
<span class="line-removed">589         Display *display = NULL;</span>
<span class="line-removed">590         struct FontData *fdata = NULL;</span>
<span class="line-removed">591         char fontSpec[1024];</span>
<span class="line-removed">592         int32_t height;</span>
<span class="line-removed">593         int32_t oheight;</span>
<span class="line-removed">594         int32_t above = 0;              /* tries above height */</span>
<span class="line-removed">595         int32_t below = 0;              /* tries below height */</span>
<span class="line-removed">596         char *foundry = NULL;</span>
<span class="line-removed">597         char *name = NULL;</span>
<span class="line-removed">598         char *encoding = NULL;</span>
<span class="line-removed">599         char *style = NULL;</span>
<span class="line-removed">600         XFontStruct *xfont = NULL;</span>
<span class="line-removed">601         jstring family = NULL;</span>
<span class="line-removed">602 </span>
<span class="line-removed">603         if (JNU_IsNull(env, font)) {</span>
<span class="line-removed">604             if (errmsg != NULL) {</span>
<span class="line-removed">605                 *errmsg = &quot;java/lang&quot; &quot;NullPointerException&quot;;</span>
<span class="line-removed">606             }</span>
<span class="line-removed">607             return (struct FontData *) NULL;</span>
<span class="line-removed">608         }</span>
<span class="line-removed">609         display = XDISPLAY;</span>
<span class="line-removed">610 </span>
<span class="line-removed">611         fdata = (struct FontData *) JNU_GetLongFieldAsPtr(env,font,fontIDs.pData);</span>
<span class="line-removed">612         if (fdata != NULL &amp;&amp; fdata-&gt;xfont != NULL) {</span>
<span class="line-removed">613             return fdata;</span>
<span class="line-removed">614         }</span>
<span class="line-removed">615 </span>
<span class="line-removed">616         family = (*env)-&gt;CallObjectMethod(env, font, fontIDs.getFamily);</span>
<span class="line-removed">617 </span>
<span class="line-removed">618         if (!awtJNI_FontName(env, family, &amp;foundry, &amp;name, &amp;encoding)) {</span>
<span class="line-removed">619             if (errmsg != NULL) {</span>
<span class="line-removed">620                 *errmsg = &quot;java/lang&quot; &quot;NullPointerException&quot;;</span>
<span class="line-removed">621             }</span>
<span class="line-removed">622             (*env)-&gt;DeleteLocalRef(env, family);</span>
<span class="line-removed">623             return (struct FontData *) NULL;</span>
<span class="line-removed">624         }</span>
<span class="line-removed">625         style = Style((*env)-&gt;GetIntField(env, font, fontIDs.style));</span>
<span class="line-removed">626         oheight = height = (*env)-&gt;GetIntField(env, font, fontIDs.size);</span>
<span class="line-removed">627 </span>
<span class="line-removed">628         while (1) {</span>
<span class="line-removed">629             jio_snprintf(fontSpec, sizeof(fontSpec), &quot;-%s-%s-%s-*-*-%d-*-*-*-*-*-%s&quot;,</span>
<span class="line-removed">630                          foundry,</span>
<span class="line-removed">631                          name,</span>
<span class="line-removed">632                          style,</span>
<span class="line-removed">633                          height,</span>
<span class="line-removed">634                          encoding);</span>
<span class="line-removed">635 </span>
<span class="line-removed">636             /*fprintf(stderr,&quot;LoadFont: %s\n&quot;, fontSpec); */</span>
<span class="line-removed">637             xfont = XLoadQueryFont(display, fontSpec);</span>
<span class="line-removed">638 </span>
<span class="line-removed">639             /* XXX: sometimes XLoadQueryFont returns a bogus font structure */</span>
<span class="line-removed">640             /* with negative ascent. */</span>
<span class="line-removed">641             if (xfont == NULL || xfont-&gt;ascent &lt; 0) {</span>
<span class="line-removed">642                 if (xfont != NULL) {</span>
<span class="line-removed">643                     XFreeFont(display, xfont);</span>
<span class="line-removed">644                 }</span>
<span class="line-removed">645                 if (foundry != anyfoundry) {  /* Use ptr comparison here, not strcmp */</span>
<span class="line-removed">646                     /* Try any other foundry before messing with the sizes */</span>
<span class="line-removed">647                     foundry = anyfoundry;</span>
<span class="line-removed">648                     continue;</span>
<span class="line-removed">649                 }</span>
<span class="line-removed">650                 /* We couldn&#39;t find the font. We&#39;ll try to find an */</span>
<span class="line-removed">651                 /* alternate by searching for heights above and below our */</span>
<span class="line-removed">652                 /* preferred height. We try for 4 heights above and below. */</span>
<span class="line-removed">653                 /* If we still can&#39;t find a font we repeat the algorithm */</span>
<span class="line-removed">654                 /* using misc-fixed as the font. If we then fail, then we */</span>
<span class="line-removed">655                 /* give up and signal an error. */</span>
<span class="line-removed">656                 if (above == below) {</span>
<span class="line-removed">657                     above++;</span>
<span class="line-removed">658                     height = oheight + above;</span>
<span class="line-removed">659                 } else {</span>
<span class="line-removed">660                     below++;</span>
<span class="line-removed">661                     if (below &gt; 4) {</span>
<span class="line-removed">662                         if (name != defaultfontname || style != anystyle) {</span>
<span class="line-removed">663                             name = defaultfontname;</span>
<span class="line-removed">664                             foundry = defaultfoundry;</span>
<span class="line-removed">665                             height = oheight;</span>
<span class="line-removed">666                             style = anystyle;</span>
<span class="line-removed">667                             encoding = isolatin1;</span>
<span class="line-removed">668                             above = below = 0;</span>
<span class="line-removed">669                             continue;</span>
<span class="line-removed">670                         } else {</span>
<span class="line-removed">671                             if (errmsg != NULL) {</span>
<span class="line-removed">672                                 *errmsg = &quot;java/io/&quot; &quot;FileNotFoundException&quot;;</span>
<span class="line-removed">673                             }</span>
<span class="line-removed">674                             (*env)-&gt;DeleteLocalRef(env, family);</span>
<span class="line-removed">675                             return (struct FontData *) NULL;</span>
<span class="line-removed">676                         }</span>
<span class="line-removed">677                     }</span>
<span class="line-removed">678                     height = oheight - below;</span>
<span class="line-removed">679                 }</span>
<span class="line-removed">680                 continue;</span>
<span class="line-removed">681             } else {</span>
<span class="line-removed">682                 fdata = ZALLOC(FontData);</span>
<span class="line-removed">683 </span>
<span class="line-removed">684                 if (fdata == NULL) {</span>
<span class="line-removed">685                     if (errmsg != NULL) {</span>
<span class="line-removed">686                         *errmsg = &quot;java/lang&quot; &quot;OutOfMemoryError&quot;;</span>
<span class="line-removed">687                     }</span>
<span class="line-removed">688                 } else {</span>
<span class="line-removed">689                     fdata-&gt;xfont = xfont;</span>
<span class="line-removed">690                     JNU_SetLongFieldFromPtr(env,font,fontIDs.pData,fdata);</span>
<span class="line-removed">691                     Disposer_AddRecord(env, font, pDataDisposeMethod,</span>
<span class="line-removed">692                                        ptr_to_jlong(fdata));</span>
<span class="line-removed">693                 }</span>
<span class="line-removed">694                 (*env)-&gt;DeleteLocalRef(env, family);</span>
<span class="line-removed">695                 return fdata;</span>
<span class="line-removed">696             }</span>
<span class="line-removed">697         }</span>
<span class="line-removed">698         /* not reached */</span>
<span class="line-removed">699     }</span>
<span class="line-removed">700 }</span>
<span class="line-removed">701 </span>
<span class="line-removed">702 /*</span>
<span class="line-removed">703  * Registered with the 2D disposer to be called after the Font is GC&#39;d.</span>
<span class="line-removed">704  */</span>
<span class="line-removed">705 static void pDataDisposeMethod(JNIEnv *env, jlong pData)</span>
<span class="line-removed">706 {</span>
<span class="line-removed">707     struct FontData *fdata = NULL;</span>
<span class="line-removed">708     int32_t i = 0;</span>
<span class="line-removed">709     Display *display = XDISPLAY;</span>
<span class="line-removed">710 </span>
<span class="line-removed">711     AWT_LOCK();</span>
<span class="line-removed">712     fdata = (struct FontData *)pData;</span>
<span class="line-removed">713 </span>
<span class="line-removed">714     if (fdata == NULL) {</span>
<span class="line-removed">715         AWT_UNLOCK();</span>
<span class="line-removed">716         return;</span>
<span class="line-removed">717     }</span>
<span class="line-removed">718 </span>
<span class="line-removed">719     if (fdata-&gt;xfs != NULL) {</span>
<span class="line-removed">720         XFreeFontSet(display, fdata-&gt;xfs);</span>
<span class="line-removed">721     }</span>
<span class="line-removed">722 </span>
<span class="line-removed">723     /* AWT fonts are always &quot;multifonts&quot; and probably have been in</span>
<span class="line-removed">724      * all post 1.0 releases, so this test for multi fonts is</span>
<span class="line-removed">725      * probably not needed, and the singleton xfont is probably never used.</span>
<span class="line-removed">726      */</span>
<span class="line-removed">727     if (fdata-&gt;charset_num &gt; 0) {</span>
<span class="line-removed">728         for (i = 0; i &lt; fdata-&gt;charset_num; i++) {</span>
<span class="line-removed">729             free((void *)fdata-&gt;flist[i].xlfd);</span>
<span class="line-removed">730             JNU_ReleaseStringPlatformChars(env, NULL,</span>
<span class="line-removed">731                                            fdata-&gt;flist[i].charset_name);</span>
<span class="line-removed">732             if (fdata-&gt;flist[i].load) {</span>
<span class="line-removed">733                 XFreeFont(display, fdata-&gt;flist[i].xfont);</span>
<span class="line-removed">734             }</span>
<span class="line-removed">735         }</span>
<span class="line-removed">736 </span>
<span class="line-removed">737         free((void *)fdata-&gt;flist);</span>
<span class="line-removed">738 </span>
<span class="line-removed">739         /* Don&#39;t free fdata-&gt;xfont because it is equal to fdata-&gt;flist[i].xfont</span>
<span class="line-removed">740            for some &#39;i&#39; */</span>
<span class="line-removed">741     } else {</span>
<span class="line-removed">742         if (fdata-&gt;xfont != NULL) {</span>
<span class="line-removed">743             XFreeFont(display, fdata-&gt;xfont);</span>
<span class="line-removed">744         }</span>
<span class="line-removed">745     }</span>
<span class="line-removed">746 </span>
<span class="line-removed">747     free((void *)fdata);</span>
<span class="line-removed">748 </span>
<span class="line-removed">749     AWT_UNLOCK();</span>
750 }
<span class="line-removed">751 #endif /* !HEADLESS */</span>
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1995, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 





 26 #include &quot;java_awt_Font.h&quot;
<span class="line-modified"> 27 #include &quot;sun_awt_FontDescriptor.h&quot;</span>
<span class="line-modified"> 28 #include &quot;sun_awt_PlatformFont.h&quot;</span>

















 29 




















 30 
 31 /*
 32  * Class:     java_awt_Font
 33  * Method:    initIDs
 34  * Signature: ()V
 35  */
 36 
 37 /* This function gets called from the static initializer for Font.java
 38    to initialize the fieldIDs for fields that may be accessed from C */
 39 
 40 JNIEXPORT void JNICALL
<span class="line-modified"> 41 Java_java_awt_Font_initIDs(JNIEnv *env, jclass cls) {</span>











 42 }
 43 








 44 /*
 45  * Class:     sun_awt_FontDescriptor
 46  * Method:    initIDs
 47  * Signature: ()V
 48  */
 49 
 50 /* This function gets called from the static initializer for
 51    FontDescriptor.java to initialize the fieldIDs for fields
 52    that may be accessed from C */
 53 
 54 JNIEXPORT void JNICALL
<span class="line-modified"> 55 Java_sun_awt_FontDescriptor_initIDs(JNIEnv *env, jclass cls) {</span>








 56 }
 57 
 58 /*
 59  * Class:     sun_awt_PlatformFont
 60  * Method:    initIDs
 61  * Signature: ()V
 62  */
 63 
 64 /* This function gets called from the static initializer for
 65    PlatformFont.java to initialize the fieldIDs for fields
 66    that may be accessed from C */
 67 
 68 JNIEXPORT void JNICALL
<span class="line-modified"> 69 Java_sun_awt_PlatformFont_initIDs(JNIEnv *env, jclass cls) {</span>



































































































































































































































































































































































































































































































































































































































 70 }

</pre>
</td>
</tr>
</table>
<center><a href="X11Color.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="awt_p.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>