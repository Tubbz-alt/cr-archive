<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/unix/native/libawt_xawt/awt/gtk3_interface.c</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="gtk2_interface.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="gtk3_interface.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/unix/native/libawt_xawt/awt/gtk3_interface.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 381         fp_gtk_widget_get_state_flags = dl_symbol(&quot;gtk_widget_get_state_flags&quot;);
 382         fp_gtk_style_context_set_state =
 383                        dl_symbol(&quot;gtk_style_context_set_state&quot;);
 384         fp_gtk_style_context_add_class =
 385                        dl_symbol(&quot;gtk_style_context_add_class&quot;);
 386         fp_gtk_style_context_save = dl_symbol(&quot;gtk_style_context_save&quot;);
 387         fp_gtk_style_context_restore = dl_symbol(&quot;gtk_style_context_restore&quot;);
 388         fp_gtk_render_check = dl_symbol(&quot;gtk_render_check&quot;);
 389         fp_gtk_render_option = dl_symbol(&quot;gtk_render_option&quot;);
 390         fp_gtk_render_extension = dl_symbol(&quot;gtk_render_extension&quot;);
 391         fp_gtk_render_expander = dl_symbol(&quot;gtk_render_expander&quot;);
 392         fp_gtk_render_frame_gap = dl_symbol(&quot;gtk_render_frame_gap&quot;);
 393         fp_gtk_render_line = dl_symbol(&quot;gtk_render_line&quot;);
 394         fp_gtk_widget_render_icon_pixbuf =
 395                       dl_symbol(&quot;gtk_widget_render_icon_pixbuf&quot;);
 396         if (fp_gtk_check_version(3, 10, 0)) {
 397             gtk3_version_3_10 = FALSE;
 398         } else {
 399             fp_gdk_window_create_similar_image_surface =
 400                        dl_symbol(&quot;gdk_window_create_similar_image_surface&quot;);


 401         }
 402         gtk3_version_3_14 = !fp_gtk_check_version(3, 14, 0);
 403 
 404         if (!fp_gtk_check_version(3, 20, 0)) {
 405             gtk3_version_3_20 = TRUE;
 406             fp_gtk_widget_path_copy = dl_symbol(&quot;gtk_widget_path_copy&quot;);
 407             fp_gtk_widget_path_new = dl_symbol(&quot;gtk_widget_path_new&quot;);
 408             fp_gtk_widget_path_append_type = dl_symbol(&quot;gtk_widget_path_append_type&quot;);
 409             fp_gtk_widget_path_iter_set_object_name = dl_symbol(&quot;gtk_widget_path_iter_set_object_name&quot;);
 410             fp_gtk_style_context_set_path = dl_symbol(&quot;gtk_style_context_set_path&quot;);
 411             fp_gtk_widget_path_unref = dl_symbol(&quot;gtk_widget_path_unref&quot;);
 412             fp_gtk_style_context_get_path = dl_symbol(&quot;gtk_style_context_get_path&quot;);
 413             fp_gtk_style_context_new = dl_symbol(&quot;gtk_style_context_new&quot;);
 414         }
 415 
 416         fp_gdk_window_create_similar_surface =
 417                       dl_symbol(&quot;gdk_window_create_similar_surface&quot;);
 418         fp_gtk_settings_get_for_screen =
 419                       dl_symbol(&quot;gtk_settings_get_for_screen&quot;);
 420         fp_gtk_widget_get_screen = dl_symbol(&quot;gtk_widget_get_screen&quot;);
</pre>
<hr />
<pre>
 460         fp_gtk_style_context_set_junction_sides =
 461                       dl_symbol(&quot;gtk_style_context_set_junction_sides&quot;);
 462         fp_gtk_style_context_add_region =
 463                       dl_symbol(&quot;gtk_style_context_add_region&quot;);
 464 
 465         fp_gtk_init_check = dl_symbol(&quot;gtk_init_check&quot;);
 466 
 467         /* GTK widgets */
 468         fp_gtk_arrow_new = dl_symbol(&quot;gtk_arrow_new&quot;);
 469         fp_gtk_button_new = dl_symbol(&quot;gtk_button_new&quot;);
 470         fp_gtk_spin_button_new = dl_symbol(&quot;gtk_spin_button_new&quot;);
 471         fp_gtk_check_button_new = dl_symbol(&quot;gtk_check_button_new&quot;);
 472         fp_gtk_check_menu_item_new =
 473                 dl_symbol(&quot;gtk_check_menu_item_new&quot;);
 474         fp_gtk_color_selection_dialog_new =
 475                 dl_symbol(&quot;gtk_color_selection_dialog_new&quot;);
 476         fp_gtk_entry_new = dl_symbol(&quot;gtk_entry_new&quot;);
 477         fp_gtk_fixed_new = dl_symbol(&quot;gtk_fixed_new&quot;);
 478         fp_gtk_handle_box_new = dl_symbol(&quot;gtk_handle_box_new&quot;);
 479         fp_gtk_image_new = dl_symbol(&quot;gtk_image_new&quot;);
<span class="line-modified"> 480         fp_gtk_hpaned_new = dl_symbol(&quot;gtk_hpaned_new&quot;);</span>
<span class="line-removed"> 481         fp_gtk_vpaned_new = dl_symbol(&quot;gtk_vpaned_new&quot;);</span>
 482         fp_gtk_scale_new = dl_symbol(&quot;gtk_scale_new&quot;);
 483         fp_gtk_hscrollbar_new = dl_symbol(&quot;gtk_hscrollbar_new&quot;);
 484         fp_gtk_vscrollbar_new = dl_symbol(&quot;gtk_vscrollbar_new&quot;);
 485         fp_gtk_hseparator_new = dl_symbol(&quot;gtk_hseparator_new&quot;);
 486         fp_gtk_vseparator_new = dl_symbol(&quot;gtk_vseparator_new&quot;);
 487         fp_gtk_label_new = dl_symbol(&quot;gtk_label_new&quot;);
 488         fp_gtk_menu_new = dl_symbol(&quot;gtk_menu_new&quot;);
 489         fp_gtk_menu_bar_new = dl_symbol(&quot;gtk_menu_bar_new&quot;);
 490         fp_gtk_menu_item_new = dl_symbol(&quot;gtk_menu_item_new&quot;);
 491         fp_gtk_menu_item_set_submenu =
 492                 dl_symbol(&quot;gtk_menu_item_set_submenu&quot;);
 493         fp_gtk_notebook_new = dl_symbol(&quot;gtk_notebook_new&quot;);
 494         fp_gtk_progress_bar_new =
 495             dl_symbol(&quot;gtk_progress_bar_new&quot;);
 496         fp_gtk_progress_bar_set_orientation =
 497             dl_symbol(&quot;gtk_orientable_set_orientation&quot;);
 498         fp_gtk_radio_button_new =
 499             dl_symbol(&quot;gtk_radio_button_new&quot;);
 500         fp_gtk_radio_menu_item_new =
 501             dl_symbol(&quot;gtk_radio_menu_item_new&quot;);
</pre>
<hr />
<pre>
1064             {
1065                 gtk3_widgets[_GTK_HSEPARATOR_TYPE] =
1066                     (*fp_gtk_hseparator_new)();
1067             }
1068             result = gtk3_widgets[_GTK_HSEPARATOR_TYPE];
1069             break;
1070         case HSLIDER:
1071         case HSLIDER_THUMB:
1072         case HSLIDER_TRACK:
1073             if (init_result = (NULL == gtk3_widgets[_GTK_HSCALE_TYPE]))
1074             {
1075                 gtk3_widgets[_GTK_HSCALE_TYPE] =
1076                     (*fp_gtk_scale_new)(GTK_ORIENTATION_HORIZONTAL, NULL);
1077             }
1078             result = gtk3_widgets[_GTK_HSCALE_TYPE];
1079             break;
1080         case HSPLIT_PANE_DIVIDER:
1081         case SPLIT_PANE:
1082             if (init_result = (NULL == gtk3_widgets[_GTK_HPANED_TYPE]))
1083             {
<span class="line-modified">1084                 gtk3_widgets[_GTK_HPANED_TYPE] = (*fp_gtk_hpaned_new)();</span>
1085             }
1086             result = gtk3_widgets[_GTK_HPANED_TYPE];
1087             break;
1088         case IMAGE:
1089             if (init_result = (NULL == gtk3_widgets[_GTK_IMAGE_TYPE]))
1090             {
1091                 gtk3_widgets[_GTK_IMAGE_TYPE] = (*fp_gtk_image_new)();
1092             }
1093             result = gtk3_widgets[_GTK_IMAGE_TYPE];
1094             break;
1095         case INTERNAL_FRAME:
1096             if (init_result = (NULL == gtk3_widgets[_GTK_WINDOW_TYPE]))
1097             {
1098                 gtk3_widgets[_GTK_WINDOW_TYPE] =
1099                     (*fp_gtk_window_new)(GTK_WINDOW_TOPLEVEL);
1100             }
1101             result = gtk3_widgets[_GTK_WINDOW_TYPE];
1102             break;
1103         case TOOL_TIP:
1104             if (init_result = (NULL == gtk3_widgets[_GTK_TOOLTIP_TYPE]))
</pre>
<hr />
<pre>
1297             break;
1298         case VSLIDER:
1299         case VSLIDER_THUMB:
1300         case VSLIDER_TRACK:
1301             if (init_result = (NULL == gtk3_widgets[_GTK_VSCALE_TYPE]))
1302             {
1303                 gtk3_widgets[_GTK_VSCALE_TYPE] =
1304                     (*fp_gtk_scale_new)(GTK_ORIENTATION_VERTICAL, NULL);
1305             }
1306             result = gtk3_widgets[_GTK_VSCALE_TYPE];
1307             /*
1308              * Vertical JSliders start at the bottom, while vertical
1309              * GtkVScale widgets start at the top (by default), so to fix
1310              * this we set the &quot;inverted&quot; flag to get the Swing behavior.
1311              */
1312              fp_gtk_range_set_inverted((GtkRange*)result, TRUE);
1313             break;
1314         case VSPLIT_PANE_DIVIDER:
1315             if (init_result = (NULL == gtk3_widgets[_GTK_VPANED_TYPE]))
1316             {
<span class="line-modified">1317                 gtk3_widgets[_GTK_VPANED_TYPE] = (*fp_gtk_vpaned_new)();</span>
1318             }
1319             result = gtk3_widgets[_GTK_VPANED_TYPE];
1320             break;
1321         default:
1322             result = NULL;
1323             break;
1324     }
1325 
1326     if (result != NULL &amp;&amp; init_result)
1327     {
1328         if (widget_type == RADIO_BUTTON_MENU_ITEM ||
1329                 widget_type == CHECK_BOX_MENU_ITEM ||
1330                 widget_type == MENU_ITEM ||
1331                 widget_type == MENU ||
1332                 widget_type == POPUP_MENU_SEPARATOR)
1333         {
1334             GtkWidget *menu = gtk3_get_widget(POPUP_MENU);
1335             (*fp_gtk_menu_shell_append)((GtkMenuShell *)menu, result);
1336         }
1337         else if (widget_type == POPUP_MENU)
</pre>
<hr />
<pre>
1417                 if (widget_type == HSCROLL_BAR || widget_type == HSCROLL_BAR_TRACK ||
1418                     widget_type == VSCROLL_BAR || widget_type == VSCROLL_BAR_TRACK) {
1419                     path = createWidgetPath (NULL);
1420                 } else {
1421                     path = createWidgetPath (fp_gtk_style_context_get_path (widget_context));
1422                 }
1423                 append_element(path, detail);
1424             } else if (strcmp(detail, &quot;bar&quot;) == 0) {
1425                 path = createWidgetPath (fp_gtk_style_context_get_path (widget_context));
1426                 append_element(path, &quot;trough&quot;);
1427                 append_element(path, &quot;progress&quot;);
1428             } else if (strcmp(detail, &quot;vscrollbar&quot;) == 0 || strcmp(detail, &quot;hscrollbar&quot;) == 0) {
1429                 path = createWidgetPath (fp_gtk_style_context_get_path (widget_context));
1430                 append_element(path, &quot;button&quot;);
1431             } else if (strcmp(detail, &quot;check&quot;) == 0) {
1432                 path = createWidgetPath (NULL);
1433                 append_element(path, detail);
1434             } else if (strcmp(detail, &quot;option&quot;) == 0) {
1435                 path = createWidgetPath (NULL);
1436                 append_element(path, &quot;radio&quot;);








1437             } else {
1438                 path = createWidgetPath (fp_gtk_style_context_get_path (widget_context));
1439                 append_element(path, detail);
1440             }
1441         } else {
1442             path = createWidgetPath (fp_gtk_style_context_get_path (widget_context));
1443         }
1444 
1445         GtkStyleContext *context = fp_gtk_style_context_new ();
1446         fp_gtk_style_context_set_path (context, path);
1447         fp_gtk_widget_path_unref (path);
1448         return context;
1449     }
1450 }
1451 
1452 static void disposeOrRestoreContext(GtkStyleContext *context)
1453 {
1454     if (!gtk3_version_3_20) {
1455         fp_gtk_style_context_restore (context);
1456     } else {
</pre>
<hr />
<pre>
1760       case GTK_POS_BOTTOM:
1761         fp_gtk_style_context_add_class(context, &quot;top&quot;);
1762         break;
1763       default:
1764         break;
1765     }
1766 
1767     fp_gtk_render_extension(context, cr, x, y, width, height, gap_side);
1768 
1769     fp_gtk_style_context_restore (context);
1770 }
1771 
1772 static void gtk3_paint_flat_box(WidgetType widget_type, GtkStateType state_type,
1773         GtkShadowType shadow_type, const gchar *detail,
1774         gint x, gint y, gint width, gint height, gboolean has_focus)
1775 {
1776     if (state_type == GTK_STATE_PRELIGHT &amp;&amp;
1777         (widget_type == CHECK_BOX || widget_type == RADIO_BUTTON)) {
1778         return;
1779     }
<span class="line-removed">1780     gtk3_widget = gtk3_get_widget(widget_type);</span>
<span class="line-removed">1781 </span>
<span class="line-removed">1782     GtkStyleContext* context = fp_gtk_widget_get_style_context (gtk3_widget);</span>
<span class="line-removed">1783     fp_gtk_style_context_save (context);</span>
1784 
<span class="line-modified">1785     if (detail != 0) {</span>
<span class="line-modified">1786         transform_detail_string(detail, context);</span>









1787     }
1788 
1789     GtkStateFlags flags = get_gtk_flags(state_type);
1790 
1791     if (has_focus) {
1792         flags |= GTK_STATE_FLAG_FOCUSED;
1793     }
1794 
1795     fp_gtk_style_context_set_state (context, flags);
1796 
1797     if (widget_type == COMBO_BOX_TEXT_FIELD) {
1798         width += height /2;
1799     }
1800 
1801     fp_gtk_render_background (context, cr, x, y, width, height);
<span class="line-modified">1802 </span>
<span class="line-modified">1803     fp_gtk_style_context_restore (context);</span>



1804 }
1805 
1806 static void gtk3_paint_focus(WidgetType widget_type, GtkStateType state_type,
1807         const char *detail, gint x, gint y, gint width, gint height)
1808 {
1809     gtk3_widget = gtk3_get_widget(widget_type);
1810 
1811     GtkStyleContext* context = fp_gtk_widget_get_style_context (gtk3_widget);
1812     fp_gtk_style_context_save (context);
1813 
1814     transform_detail_string(detail, context);
1815     fp_gtk_render_focus (context, cr, x, y, width, height);
1816 
1817     fp_gtk_style_context_restore (context);
1818 
1819 }
1820 
1821 static void gtk3_paint_handle(WidgetType widget_type, GtkStateType state_type,
1822         GtkShadowType shadow_type, const gchar *detail,
1823         gint x, gint y, gint width, gint height, GtkOrientation orientation)
1824 {
1825     gtk3_widget = gtk3_get_widget(widget_type);
1826 
<span class="line-modified">1827     GtkStyleContext* context = fp_gtk_widget_get_style_context (gtk3_widget);</span>
<span class="line-removed">1828 </span>
<span class="line-removed">1829     fp_gtk_style_context_save (context);</span>
1830 
1831     GtkStateFlags flags = get_gtk_flags(state_type);
1832     fp_gtk_style_context_set_state(context, GTK_STATE_FLAG_PRELIGHT);
1833 
<span class="line-modified">1834     if (detail != 0) {</span>
1835         transform_detail_string(detail, context);
1836         fp_gtk_style_context_add_class (context, &quot;handlebox_bin&quot;);
1837     }
1838 
<span class="line-modified">1839     fp_gtk_render_handle(context, cr, x, y, width, height);</span>
<span class="line-modified">1840     fp_gtk_render_background(context, cr, x, y, width, height);</span>










1841 
<span class="line-modified">1842     fp_gtk_style_context_restore (context);</span>
1843 }
1844 
1845 static void gtk3_paint_hline(WidgetType widget_type, GtkStateType state_type,
1846         const gchar *detail, gint x, gint y, gint width, gint height)
1847 {
1848     gtk3_widget = gtk3_get_widget(widget_type);
1849 
1850     GtkStyleContext* context = fp_gtk_widget_get_style_context (gtk3_widget);
1851 
1852     fp_gtk_style_context_save (context);
1853 
1854     if (detail != 0) {
1855         transform_detail_string(detail, context);
1856     }
1857 
1858     fp_gtk_render_line(context, cr, x, y, x + width, y);
1859 
1860     fp_gtk_style_context_restore (context);
1861 }
1862 
</pre>
<hr />
<pre>
2343             break;
2344         case WHITE:
2345             color.red = 1;
2346             color.green = 1;
2347             color.blue = 1;
2348             break;
2349     }
2350     return color;
2351 }
2352 
2353 static gint gtk3_get_color_for_state(JNIEnv *env, WidgetType widget_type,
2354                               GtkStateType state_type, ColorType color_type)
2355 {
2356 
2357     gint result = 0;
2358 
2359     GtkStateFlags flags = gtk3_get_state_flags(state_type);
2360 
2361     init_containers();
2362 
<span class="line-modified">2363     if (widget_type == TEXT_FIELD &amp;&amp; state_type == GTK_STATE_SELECTED &amp;&amp;</span>
<span class="line-modified">2364         color_type == TEXT_BACKGROUND) {</span>
<span class="line-modified">2365         widget_type = TEXT_AREA;</span>


2366     }
2367 
<span class="line-modified">2368     gtk3_widget = gtk3_get_widget(widget_type);</span>
<span class="line-removed">2369 </span>
<span class="line-removed">2370     GtkStyleContext* context = fp_gtk_widget_get_style_context(gtk3_widget);</span>
<span class="line-removed">2371 </span>
2372     if (widget_type == TOOL_TIP) {
<span class="line-modified">2373         fp_gtk_style_context_add_class(context, &quot;tooltip&quot;);</span>



2374     }
2375     if (widget_type == CHECK_BOX_MENU_ITEM
2376      || widget_type == RADIO_BUTTON_MENU_ITEM) {
2377         flags &amp;= GTK_STATE_FLAG_NORMAL | GTK_STATE_FLAG_SELECTED
2378                   | GTK_STATE_FLAG_INSENSITIVE | GTK_STATE_FLAG_FOCUSED;
2379     }
2380 
2381     GdkRGBA color = gtk3_get_color_for_flags(context, flags, color_type);
2382 
2383     if (recode_color(color.alpha) == 0) {
2384         color = gtk3_get_color_for_flags(
2385         fp_gtk_widget_get_style_context(gtk3_get_widget(INTERNAL_FRAME)),
2386         0, BACKGROUND);
2387     }
2388 
2389     result = recode_color(color.alpha) &lt;&lt; 24 | recode_color(color.red) &lt;&lt; 16 |
2390              recode_color(color.green) &lt;&lt; 8 | recode_color(color.blue);
<span class="line-modified">2391 </span>


2392     return result;
2393 }
2394 
2395 /*************************************************/
2396 static jobject create_Boolean(JNIEnv *env, jboolean boolean_value);
2397 static jobject create_Integer(JNIEnv *env, jint int_value);
2398 static jobject create_Long(JNIEnv *env, jlong long_value);
2399 static jobject create_Float(JNIEnv *env, jfloat float_value);
2400 static jobject create_Double(JNIEnv *env, jdouble double_value);
2401 static jobject create_Character(JNIEnv *env, jchar char_value);
2402 static jobject create_Insets(JNIEnv *env, GtkBorder *border);
2403 
2404 static jobject gtk3_get_class_value(JNIEnv *env, WidgetType widget_type,
2405                                                      const char* key)
2406 {
2407     init_containers();
2408 
2409     gtk3_widget = gtk3_get_widget(widget_type);
2410 
2411     GValue value = { 0, { { 0 } } };
</pre>
<hr />
<pre>
2859         }
2860 
2861       if (!ruled)
2862         row &amp;= ~(GTK_REGION_EVEN | GTK_REGION_ODD);
2863 
2864       fp_gtk_style_context_add_class (context, &quot;cell&quot;);
2865       fp_gtk_style_context_add_region (context, &quot;row&quot;, row);
2866       fp_gtk_style_context_add_region (context, &quot;column&quot;, col);
2867 
2868       fp_g_strfreev (tokens);
2869     }
2870 }
2871 
2872 static gboolean gtk3_get_drawable_data(JNIEnv *env, jintArray pixelArray,
2873      int x, jint y, jint width, jint height, jint jwidth, int dx, int dy,
2874                                                                    jint scale) {
2875     GdkPixbuf *pixbuf;
2876     jint *ary;
2877 
2878     GdkWindow *root = (*fp_gdk_get_default_root_window)();
<span class="line-modified">2879     pixbuf = (*fp_gdk_pixbuf_get_from_drawable)(root, x, y, width, height);</span>







2880     if (pixbuf &amp;&amp; scale != 1) {
2881         GdkPixbuf *scaledPixbuf;
2882         x /= scale;
2883         y /= scale;
2884         width /= scale;
2885         height /= scale;
2886         dx /= scale;
2887         dy /= scale;
2888         scaledPixbuf = (*fp_gdk_pixbuf_scale_simple)(pixbuf, width, height,
2889                                                      GDK_INTERP_BILINEAR);
2890         (*fp_g_object_unref)(pixbuf);
2891         pixbuf = scaledPixbuf;
2892     }
2893 
2894     if (pixbuf) {
2895         int nchan = (*fp_gdk_pixbuf_get_n_channels)(pixbuf);
2896         int stride = (*fp_gdk_pixbuf_get_rowstride)(pixbuf);
<span class="line-modified">2897         if ((*fp_gdk_pixbuf_get_width)(pixbuf) == width</span>
<span class="line-modified">2898                 &amp;&amp; (*fp_gdk_pixbuf_get_height)(pixbuf) == height</span>
2899                 &amp;&amp; (*fp_gdk_pixbuf_get_bits_per_sample)(pixbuf) == 8
2900                 &amp;&amp; (*fp_gdk_pixbuf_get_colorspace)(pixbuf) == GDK_COLORSPACE_RGB
2901                 &amp;&amp; nchan &gt;= 3
2902                 ) {
2903             guchar *p, *pix = (*fp_gdk_pixbuf_get_pixels)(pixbuf);
2904             ary = (*env)-&gt;GetPrimitiveArrayCritical(env, pixelArray, NULL);
2905             if (ary) {
2906                 jint _x, _y;
2907                 int index;
2908                 for (_y = 0; _y &lt; height; _y++) {
2909                     for (_x = 0; _x &lt; width; _x++) {
2910                         p = pix + _y * stride + _x * nchan;
2911 
2912                         index = (_y + dy) * jwidth + (_x + dx);
2913                         ary[index] = 0xff000000
2914                                         | (p[0] &lt;&lt; 16)
2915                                         | (p[1] &lt;&lt; 8)
2916                                         | (p[2]);
2917 
2918                     }
</pre>
</td>
<td>
<hr />
<pre>
 381         fp_gtk_widget_get_state_flags = dl_symbol(&quot;gtk_widget_get_state_flags&quot;);
 382         fp_gtk_style_context_set_state =
 383                        dl_symbol(&quot;gtk_style_context_set_state&quot;);
 384         fp_gtk_style_context_add_class =
 385                        dl_symbol(&quot;gtk_style_context_add_class&quot;);
 386         fp_gtk_style_context_save = dl_symbol(&quot;gtk_style_context_save&quot;);
 387         fp_gtk_style_context_restore = dl_symbol(&quot;gtk_style_context_restore&quot;);
 388         fp_gtk_render_check = dl_symbol(&quot;gtk_render_check&quot;);
 389         fp_gtk_render_option = dl_symbol(&quot;gtk_render_option&quot;);
 390         fp_gtk_render_extension = dl_symbol(&quot;gtk_render_extension&quot;);
 391         fp_gtk_render_expander = dl_symbol(&quot;gtk_render_expander&quot;);
 392         fp_gtk_render_frame_gap = dl_symbol(&quot;gtk_render_frame_gap&quot;);
 393         fp_gtk_render_line = dl_symbol(&quot;gtk_render_line&quot;);
 394         fp_gtk_widget_render_icon_pixbuf =
 395                       dl_symbol(&quot;gtk_widget_render_icon_pixbuf&quot;);
 396         if (fp_gtk_check_version(3, 10, 0)) {
 397             gtk3_version_3_10 = FALSE;
 398         } else {
 399             fp_gdk_window_create_similar_image_surface =
 400                        dl_symbol(&quot;gdk_window_create_similar_image_surface&quot;);
<span class="line-added"> 401             fp_gdk_window_get_scale_factor =</span>
<span class="line-added"> 402                     dl_symbol(&quot;gdk_window_get_scale_factor&quot;);</span>
 403         }
 404         gtk3_version_3_14 = !fp_gtk_check_version(3, 14, 0);
 405 
 406         if (!fp_gtk_check_version(3, 20, 0)) {
 407             gtk3_version_3_20 = TRUE;
 408             fp_gtk_widget_path_copy = dl_symbol(&quot;gtk_widget_path_copy&quot;);
 409             fp_gtk_widget_path_new = dl_symbol(&quot;gtk_widget_path_new&quot;);
 410             fp_gtk_widget_path_append_type = dl_symbol(&quot;gtk_widget_path_append_type&quot;);
 411             fp_gtk_widget_path_iter_set_object_name = dl_symbol(&quot;gtk_widget_path_iter_set_object_name&quot;);
 412             fp_gtk_style_context_set_path = dl_symbol(&quot;gtk_style_context_set_path&quot;);
 413             fp_gtk_widget_path_unref = dl_symbol(&quot;gtk_widget_path_unref&quot;);
 414             fp_gtk_style_context_get_path = dl_symbol(&quot;gtk_style_context_get_path&quot;);
 415             fp_gtk_style_context_new = dl_symbol(&quot;gtk_style_context_new&quot;);
 416         }
 417 
 418         fp_gdk_window_create_similar_surface =
 419                       dl_symbol(&quot;gdk_window_create_similar_surface&quot;);
 420         fp_gtk_settings_get_for_screen =
 421                       dl_symbol(&quot;gtk_settings_get_for_screen&quot;);
 422         fp_gtk_widget_get_screen = dl_symbol(&quot;gtk_widget_get_screen&quot;);
</pre>
<hr />
<pre>
 462         fp_gtk_style_context_set_junction_sides =
 463                       dl_symbol(&quot;gtk_style_context_set_junction_sides&quot;);
 464         fp_gtk_style_context_add_region =
 465                       dl_symbol(&quot;gtk_style_context_add_region&quot;);
 466 
 467         fp_gtk_init_check = dl_symbol(&quot;gtk_init_check&quot;);
 468 
 469         /* GTK widgets */
 470         fp_gtk_arrow_new = dl_symbol(&quot;gtk_arrow_new&quot;);
 471         fp_gtk_button_new = dl_symbol(&quot;gtk_button_new&quot;);
 472         fp_gtk_spin_button_new = dl_symbol(&quot;gtk_spin_button_new&quot;);
 473         fp_gtk_check_button_new = dl_symbol(&quot;gtk_check_button_new&quot;);
 474         fp_gtk_check_menu_item_new =
 475                 dl_symbol(&quot;gtk_check_menu_item_new&quot;);
 476         fp_gtk_color_selection_dialog_new =
 477                 dl_symbol(&quot;gtk_color_selection_dialog_new&quot;);
 478         fp_gtk_entry_new = dl_symbol(&quot;gtk_entry_new&quot;);
 479         fp_gtk_fixed_new = dl_symbol(&quot;gtk_fixed_new&quot;);
 480         fp_gtk_handle_box_new = dl_symbol(&quot;gtk_handle_box_new&quot;);
 481         fp_gtk_image_new = dl_symbol(&quot;gtk_image_new&quot;);
<span class="line-modified"> 482         fp_gtk_paned_new = dl_symbol(&quot;gtk_paned_new&quot;);</span>

 483         fp_gtk_scale_new = dl_symbol(&quot;gtk_scale_new&quot;);
 484         fp_gtk_hscrollbar_new = dl_symbol(&quot;gtk_hscrollbar_new&quot;);
 485         fp_gtk_vscrollbar_new = dl_symbol(&quot;gtk_vscrollbar_new&quot;);
 486         fp_gtk_hseparator_new = dl_symbol(&quot;gtk_hseparator_new&quot;);
 487         fp_gtk_vseparator_new = dl_symbol(&quot;gtk_vseparator_new&quot;);
 488         fp_gtk_label_new = dl_symbol(&quot;gtk_label_new&quot;);
 489         fp_gtk_menu_new = dl_symbol(&quot;gtk_menu_new&quot;);
 490         fp_gtk_menu_bar_new = dl_symbol(&quot;gtk_menu_bar_new&quot;);
 491         fp_gtk_menu_item_new = dl_symbol(&quot;gtk_menu_item_new&quot;);
 492         fp_gtk_menu_item_set_submenu =
 493                 dl_symbol(&quot;gtk_menu_item_set_submenu&quot;);
 494         fp_gtk_notebook_new = dl_symbol(&quot;gtk_notebook_new&quot;);
 495         fp_gtk_progress_bar_new =
 496             dl_symbol(&quot;gtk_progress_bar_new&quot;);
 497         fp_gtk_progress_bar_set_orientation =
 498             dl_symbol(&quot;gtk_orientable_set_orientation&quot;);
 499         fp_gtk_radio_button_new =
 500             dl_symbol(&quot;gtk_radio_button_new&quot;);
 501         fp_gtk_radio_menu_item_new =
 502             dl_symbol(&quot;gtk_radio_menu_item_new&quot;);
</pre>
<hr />
<pre>
1065             {
1066                 gtk3_widgets[_GTK_HSEPARATOR_TYPE] =
1067                     (*fp_gtk_hseparator_new)();
1068             }
1069             result = gtk3_widgets[_GTK_HSEPARATOR_TYPE];
1070             break;
1071         case HSLIDER:
1072         case HSLIDER_THUMB:
1073         case HSLIDER_TRACK:
1074             if (init_result = (NULL == gtk3_widgets[_GTK_HSCALE_TYPE]))
1075             {
1076                 gtk3_widgets[_GTK_HSCALE_TYPE] =
1077                     (*fp_gtk_scale_new)(GTK_ORIENTATION_HORIZONTAL, NULL);
1078             }
1079             result = gtk3_widgets[_GTK_HSCALE_TYPE];
1080             break;
1081         case HSPLIT_PANE_DIVIDER:
1082         case SPLIT_PANE:
1083             if (init_result = (NULL == gtk3_widgets[_GTK_HPANED_TYPE]))
1084             {
<span class="line-modified">1085                 gtk3_widgets[_GTK_HPANED_TYPE] = (*fp_gtk_paned_new)(GTK_ORIENTATION_HORIZONTAL);</span>
1086             }
1087             result = gtk3_widgets[_GTK_HPANED_TYPE];
1088             break;
1089         case IMAGE:
1090             if (init_result = (NULL == gtk3_widgets[_GTK_IMAGE_TYPE]))
1091             {
1092                 gtk3_widgets[_GTK_IMAGE_TYPE] = (*fp_gtk_image_new)();
1093             }
1094             result = gtk3_widgets[_GTK_IMAGE_TYPE];
1095             break;
1096         case INTERNAL_FRAME:
1097             if (init_result = (NULL == gtk3_widgets[_GTK_WINDOW_TYPE]))
1098             {
1099                 gtk3_widgets[_GTK_WINDOW_TYPE] =
1100                     (*fp_gtk_window_new)(GTK_WINDOW_TOPLEVEL);
1101             }
1102             result = gtk3_widgets[_GTK_WINDOW_TYPE];
1103             break;
1104         case TOOL_TIP:
1105             if (init_result = (NULL == gtk3_widgets[_GTK_TOOLTIP_TYPE]))
</pre>
<hr />
<pre>
1298             break;
1299         case VSLIDER:
1300         case VSLIDER_THUMB:
1301         case VSLIDER_TRACK:
1302             if (init_result = (NULL == gtk3_widgets[_GTK_VSCALE_TYPE]))
1303             {
1304                 gtk3_widgets[_GTK_VSCALE_TYPE] =
1305                     (*fp_gtk_scale_new)(GTK_ORIENTATION_VERTICAL, NULL);
1306             }
1307             result = gtk3_widgets[_GTK_VSCALE_TYPE];
1308             /*
1309              * Vertical JSliders start at the bottom, while vertical
1310              * GtkVScale widgets start at the top (by default), so to fix
1311              * this we set the &quot;inverted&quot; flag to get the Swing behavior.
1312              */
1313              fp_gtk_range_set_inverted((GtkRange*)result, TRUE);
1314             break;
1315         case VSPLIT_PANE_DIVIDER:
1316             if (init_result = (NULL == gtk3_widgets[_GTK_VPANED_TYPE]))
1317             {
<span class="line-modified">1318                 gtk3_widgets[_GTK_VPANED_TYPE] = (*fp_gtk_paned_new)(GTK_ORIENTATION_VERTICAL);</span>
1319             }
1320             result = gtk3_widgets[_GTK_VPANED_TYPE];
1321             break;
1322         default:
1323             result = NULL;
1324             break;
1325     }
1326 
1327     if (result != NULL &amp;&amp; init_result)
1328     {
1329         if (widget_type == RADIO_BUTTON_MENU_ITEM ||
1330                 widget_type == CHECK_BOX_MENU_ITEM ||
1331                 widget_type == MENU_ITEM ||
1332                 widget_type == MENU ||
1333                 widget_type == POPUP_MENU_SEPARATOR)
1334         {
1335             GtkWidget *menu = gtk3_get_widget(POPUP_MENU);
1336             (*fp_gtk_menu_shell_append)((GtkMenuShell *)menu, result);
1337         }
1338         else if (widget_type == POPUP_MENU)
</pre>
<hr />
<pre>
1418                 if (widget_type == HSCROLL_BAR || widget_type == HSCROLL_BAR_TRACK ||
1419                     widget_type == VSCROLL_BAR || widget_type == VSCROLL_BAR_TRACK) {
1420                     path = createWidgetPath (NULL);
1421                 } else {
1422                     path = createWidgetPath (fp_gtk_style_context_get_path (widget_context));
1423                 }
1424                 append_element(path, detail);
1425             } else if (strcmp(detail, &quot;bar&quot;) == 0) {
1426                 path = createWidgetPath (fp_gtk_style_context_get_path (widget_context));
1427                 append_element(path, &quot;trough&quot;);
1428                 append_element(path, &quot;progress&quot;);
1429             } else if (strcmp(detail, &quot;vscrollbar&quot;) == 0 || strcmp(detail, &quot;hscrollbar&quot;) == 0) {
1430                 path = createWidgetPath (fp_gtk_style_context_get_path (widget_context));
1431                 append_element(path, &quot;button&quot;);
1432             } else if (strcmp(detail, &quot;check&quot;) == 0) {
1433                 path = createWidgetPath (NULL);
1434                 append_element(path, detail);
1435             } else if (strcmp(detail, &quot;option&quot;) == 0) {
1436                 path = createWidgetPath (NULL);
1437                 append_element(path, &quot;radio&quot;);
<span class="line-added">1438             } else if (strcmp(detail, &quot;paned&quot;) == 0) {</span>
<span class="line-added">1439                 path = createWidgetPath (fp_gtk_style_context_get_path (widget_context));</span>
<span class="line-added">1440                 append_element(path, &quot;paned&quot;);</span>
<span class="line-added">1441                 append_element(path, &quot;separator&quot;);</span>
<span class="line-added">1442             } else if (strcmp(detail, &quot;spinbutton_down&quot;) == 0 || strcmp(detail, &quot;spinbutton_up&quot;) == 0) {</span>
<span class="line-added">1443                 path = createWidgetPath (fp_gtk_style_context_get_path (widget_context));</span>
<span class="line-added">1444                 append_element(path, &quot;spinbutton&quot;);</span>
<span class="line-added">1445                 append_element(path, &quot;button&quot;);</span>
1446             } else {
1447                 path = createWidgetPath (fp_gtk_style_context_get_path (widget_context));
1448                 append_element(path, detail);
1449             }
1450         } else {
1451             path = createWidgetPath (fp_gtk_style_context_get_path (widget_context));
1452         }
1453 
1454         GtkStyleContext *context = fp_gtk_style_context_new ();
1455         fp_gtk_style_context_set_path (context, path);
1456         fp_gtk_widget_path_unref (path);
1457         return context;
1458     }
1459 }
1460 
1461 static void disposeOrRestoreContext(GtkStyleContext *context)
1462 {
1463     if (!gtk3_version_3_20) {
1464         fp_gtk_style_context_restore (context);
1465     } else {
</pre>
<hr />
<pre>
1769       case GTK_POS_BOTTOM:
1770         fp_gtk_style_context_add_class(context, &quot;top&quot;);
1771         break;
1772       default:
1773         break;
1774     }
1775 
1776     fp_gtk_render_extension(context, cr, x, y, width, height, gap_side);
1777 
1778     fp_gtk_style_context_restore (context);
1779 }
1780 
1781 static void gtk3_paint_flat_box(WidgetType widget_type, GtkStateType state_type,
1782         GtkShadowType shadow_type, const gchar *detail,
1783         gint x, gint y, gint width, gint height, gboolean has_focus)
1784 {
1785     if (state_type == GTK_STATE_PRELIGHT &amp;&amp;
1786         (widget_type == CHECK_BOX || widget_type == RADIO_BUTTON)) {
1787         return;
1788     }




1789 
<span class="line-modified">1790     GtkStyleContext* context = NULL;</span>
<span class="line-modified">1791     if (widget_type == TOOL_TIP) {</span>
<span class="line-added">1792         context = get_style(widget_type, detail);</span>
<span class="line-added">1793         fp_gtk_style_context_add_class(context, &quot;background&quot;);</span>
<span class="line-added">1794     } else {</span>
<span class="line-added">1795         gtk3_widget = gtk3_get_widget(widget_type);</span>
<span class="line-added">1796         context = fp_gtk_widget_get_style_context (gtk3_widget);</span>
<span class="line-added">1797         fp_gtk_style_context_save (context);</span>
<span class="line-added">1798         if (detail != 0) {</span>
<span class="line-added">1799             transform_detail_string(detail, context);</span>
<span class="line-added">1800         }</span>
1801     }
1802 
1803     GtkStateFlags flags = get_gtk_flags(state_type);
1804 
1805     if (has_focus) {
1806         flags |= GTK_STATE_FLAG_FOCUSED;
1807     }
1808 
1809     fp_gtk_style_context_set_state (context, flags);
1810 
1811     if (widget_type == COMBO_BOX_TEXT_FIELD) {
1812         width += height /2;
1813     }
1814 
1815     fp_gtk_render_background (context, cr, x, y, width, height);
<span class="line-modified">1816     if (widget_type == TOOL_TIP) {</span>
<span class="line-modified">1817         disposeOrRestoreContext(context);</span>
<span class="line-added">1818     } else {</span>
<span class="line-added">1819         fp_gtk_style_context_restore (context);</span>
<span class="line-added">1820     }</span>
1821 }
1822 
1823 static void gtk3_paint_focus(WidgetType widget_type, GtkStateType state_type,
1824         const char *detail, gint x, gint y, gint width, gint height)
1825 {
1826     gtk3_widget = gtk3_get_widget(widget_type);
1827 
1828     GtkStyleContext* context = fp_gtk_widget_get_style_context (gtk3_widget);
1829     fp_gtk_style_context_save (context);
1830 
1831     transform_detail_string(detail, context);
1832     fp_gtk_render_focus (context, cr, x, y, width, height);
1833 
1834     fp_gtk_style_context_restore (context);
1835 
1836 }
1837 
1838 static void gtk3_paint_handle(WidgetType widget_type, GtkStateType state_type,
1839         GtkShadowType shadow_type, const gchar *detail,
1840         gint x, gint y, gint width, gint height, GtkOrientation orientation)
1841 {
1842     gtk3_widget = gtk3_get_widget(widget_type);
1843 
<span class="line-modified">1844     GtkStyleContext* context = get_style(widget_type, detail);</span>


1845 
1846     GtkStateFlags flags = get_gtk_flags(state_type);
1847     fp_gtk_style_context_set_state(context, GTK_STATE_FLAG_PRELIGHT);
1848 
<span class="line-modified">1849     if (detail != 0 &amp;&amp; !(strcmp(detail, &quot;paned&quot;) == 0)) {</span>
1850         transform_detail_string(detail, context);
1851         fp_gtk_style_context_add_class (context, &quot;handlebox_bin&quot;);
1852     }
1853 
<span class="line-modified">1854     if (!(strcmp(detail, &quot;paned&quot;) == 0)) {</span>
<span class="line-modified">1855         fp_gtk_render_handle(context, cr, x, y, width, height);</span>
<span class="line-added">1856         fp_gtk_render_background(context, cr, x, y, width, height);</span>
<span class="line-added">1857     } else {</span>
<span class="line-added">1858         if (orientation == GTK_ORIENTATION_VERTICAL) {</span>
<span class="line-added">1859             fp_gtk_render_handle(context, cr, x+width/2, y, 2, height);</span>
<span class="line-added">1860             fp_gtk_render_background(context, cr, x+width/2, y, 2, height);</span>
<span class="line-added">1861         } else {</span>
<span class="line-added">1862             fp_gtk_render_handle(context, cr, x, y+height/2, width, 2);</span>
<span class="line-added">1863             fp_gtk_render_background(context, cr, x, y+height/2, width, 2);</span>
<span class="line-added">1864         }</span>
<span class="line-added">1865     }</span>
1866 
<span class="line-modified">1867     disposeOrRestoreContext(context);</span>
1868 }
1869 
1870 static void gtk3_paint_hline(WidgetType widget_type, GtkStateType state_type,
1871         const gchar *detail, gint x, gint y, gint width, gint height)
1872 {
1873     gtk3_widget = gtk3_get_widget(widget_type);
1874 
1875     GtkStyleContext* context = fp_gtk_widget_get_style_context (gtk3_widget);
1876 
1877     fp_gtk_style_context_save (context);
1878 
1879     if (detail != 0) {
1880         transform_detail_string(detail, context);
1881     }
1882 
1883     fp_gtk_render_line(context, cr, x, y, x + width, y);
1884 
1885     fp_gtk_style_context_restore (context);
1886 }
1887 
</pre>
<hr />
<pre>
2368             break;
2369         case WHITE:
2370             color.red = 1;
2371             color.green = 1;
2372             color.blue = 1;
2373             break;
2374     }
2375     return color;
2376 }
2377 
2378 static gint gtk3_get_color_for_state(JNIEnv *env, WidgetType widget_type,
2379                               GtkStateType state_type, ColorType color_type)
2380 {
2381 
2382     gint result = 0;
2383 
2384     GtkStateFlags flags = gtk3_get_state_flags(state_type);
2385 
2386     init_containers();
2387 
<span class="line-modified">2388     if (gtk3_version_3_20) {</span>
<span class="line-modified">2389         if ((widget_type == TEXT_FIELD || widget_type == PASSWORD_FIELD || widget_type == SPINNER_TEXT_FIELD ||</span>
<span class="line-modified">2390             widget_type == FORMATTED_TEXT_FIELD) &amp;&amp; state_type == GTK_STATE_SELECTED &amp;&amp; color_type == TEXT_BACKGROUND) {</span>
<span class="line-added">2391             widget_type = TEXT_AREA;</span>
<span class="line-added">2392         }</span>
2393     }
2394 
<span class="line-modified">2395     GtkStyleContext* context = NULL;</span>



2396     if (widget_type == TOOL_TIP) {
<span class="line-modified">2397         context = get_style(widget_type, &quot;tooltip&quot;);</span>
<span class="line-added">2398     } else {</span>
<span class="line-added">2399         gtk3_widget = gtk3_get_widget(widget_type);</span>
<span class="line-added">2400         context = fp_gtk_widget_get_style_context(gtk3_widget);</span>
2401     }
2402     if (widget_type == CHECK_BOX_MENU_ITEM
2403      || widget_type == RADIO_BUTTON_MENU_ITEM) {
2404         flags &amp;= GTK_STATE_FLAG_NORMAL | GTK_STATE_FLAG_SELECTED
2405                   | GTK_STATE_FLAG_INSENSITIVE | GTK_STATE_FLAG_FOCUSED;
2406     }
2407 
2408     GdkRGBA color = gtk3_get_color_for_flags(context, flags, color_type);
2409 
2410     if (recode_color(color.alpha) == 0) {
2411         color = gtk3_get_color_for_flags(
2412         fp_gtk_widget_get_style_context(gtk3_get_widget(INTERNAL_FRAME)),
2413         0, BACKGROUND);
2414     }
2415 
2416     result = recode_color(color.alpha) &lt;&lt; 24 | recode_color(color.red) &lt;&lt; 16 |
2417              recode_color(color.green) &lt;&lt; 8 | recode_color(color.blue);
<span class="line-modified">2418     if (widget_type == TOOL_TIP) {</span>
<span class="line-added">2419         disposeOrRestoreContext(context);</span>
<span class="line-added">2420     }</span>
2421     return result;
2422 }
2423 
2424 /*************************************************/
2425 static jobject create_Boolean(JNIEnv *env, jboolean boolean_value);
2426 static jobject create_Integer(JNIEnv *env, jint int_value);
2427 static jobject create_Long(JNIEnv *env, jlong long_value);
2428 static jobject create_Float(JNIEnv *env, jfloat float_value);
2429 static jobject create_Double(JNIEnv *env, jdouble double_value);
2430 static jobject create_Character(JNIEnv *env, jchar char_value);
2431 static jobject create_Insets(JNIEnv *env, GtkBorder *border);
2432 
2433 static jobject gtk3_get_class_value(JNIEnv *env, WidgetType widget_type,
2434                                                      const char* key)
2435 {
2436     init_containers();
2437 
2438     gtk3_widget = gtk3_get_widget(widget_type);
2439 
2440     GValue value = { 0, { { 0 } } };
</pre>
<hr />
<pre>
2888         }
2889 
2890       if (!ruled)
2891         row &amp;= ~(GTK_REGION_EVEN | GTK_REGION_ODD);
2892 
2893       fp_gtk_style_context_add_class (context, &quot;cell&quot;);
2894       fp_gtk_style_context_add_region (context, &quot;row&quot;, row);
2895       fp_gtk_style_context_add_region (context, &quot;column&quot;, col);
2896 
2897       fp_g_strfreev (tokens);
2898     }
2899 }
2900 
2901 static gboolean gtk3_get_drawable_data(JNIEnv *env, jintArray pixelArray,
2902      int x, jint y, jint width, jint height, jint jwidth, int dx, int dy,
2903                                                                    jint scale) {
2904     GdkPixbuf *pixbuf;
2905     jint *ary;
2906 
2907     GdkWindow *root = (*fp_gdk_get_default_root_window)();
<span class="line-modified">2908     if (gtk3_version_3_10) {</span>
<span class="line-added">2909         int win_scale = (*fp_gdk_window_get_scale_factor)(root);</span>
<span class="line-added">2910         pixbuf = (*fp_gdk_pixbuf_get_from_drawable)(</span>
<span class="line-added">2911             root, x, y, (int) (width / (float) win_scale + 0.5), (int) (height / (float) win_scale + 0.5));</span>
<span class="line-added">2912     } else {</span>
<span class="line-added">2913         pixbuf = (*fp_gdk_pixbuf_get_from_drawable)(root, x, y, width, height);</span>
<span class="line-added">2914     }</span>
<span class="line-added">2915 </span>
2916     if (pixbuf &amp;&amp; scale != 1) {
2917         GdkPixbuf *scaledPixbuf;
2918         x /= scale;
2919         y /= scale;
2920         width /= scale;
2921         height /= scale;
2922         dx /= scale;
2923         dy /= scale;
2924         scaledPixbuf = (*fp_gdk_pixbuf_scale_simple)(pixbuf, width, height,
2925                                                      GDK_INTERP_BILINEAR);
2926         (*fp_g_object_unref)(pixbuf);
2927         pixbuf = scaledPixbuf;
2928     }
2929 
2930     if (pixbuf) {
2931         int nchan = (*fp_gdk_pixbuf_get_n_channels)(pixbuf);
2932         int stride = (*fp_gdk_pixbuf_get_rowstride)(pixbuf);
<span class="line-modified">2933         if ((*fp_gdk_pixbuf_get_width)(pixbuf) &gt;= width</span>
<span class="line-modified">2934                 &amp;&amp; (*fp_gdk_pixbuf_get_height)(pixbuf) &gt;= height</span>
2935                 &amp;&amp; (*fp_gdk_pixbuf_get_bits_per_sample)(pixbuf) == 8
2936                 &amp;&amp; (*fp_gdk_pixbuf_get_colorspace)(pixbuf) == GDK_COLORSPACE_RGB
2937                 &amp;&amp; nchan &gt;= 3
2938                 ) {
2939             guchar *p, *pix = (*fp_gdk_pixbuf_get_pixels)(pixbuf);
2940             ary = (*env)-&gt;GetPrimitiveArrayCritical(env, pixelArray, NULL);
2941             if (ary) {
2942                 jint _x, _y;
2943                 int index;
2944                 for (_y = 0; _y &lt; height; _y++) {
2945                     for (_x = 0; _x &lt; width; _x++) {
2946                         p = pix + _y * stride + _x * nchan;
2947 
2948                         index = (_y + dy) * jwidth + (_x + dx);
2949                         ary[index] = 0xff000000
2950                                         | (p[0] &lt;&lt; 16)
2951                                         | (p[1] &lt;&lt; 8)
2952                                         | (p[2]);
2953 
2954                     }
</pre>
</td>
</tr>
</table>
<center><a href="gtk2_interface.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="gtk3_interface.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>