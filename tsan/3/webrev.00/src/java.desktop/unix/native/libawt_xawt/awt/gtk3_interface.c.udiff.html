<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/unix/native/libawt_xawt/awt/gtk3_interface.c</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="gtk2_interface.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="gtk3_interface.h.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/unix/native/libawt_xawt/awt/gtk3_interface.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -396,10 +396,12 @@</span>
          if (fp_gtk_check_version(3, 10, 0)) {
              gtk3_version_3_10 = FALSE;
          } else {
              fp_gdk_window_create_similar_image_surface =
                         dl_symbol(&quot;gdk_window_create_similar_image_surface&quot;);
<span class="udiff-line-added">+             fp_gdk_window_get_scale_factor =</span>
<span class="udiff-line-added">+                     dl_symbol(&quot;gdk_window_get_scale_factor&quot;);</span>
          }
          gtk3_version_3_14 = !fp_gtk_check_version(3, 14, 0);
  
          if (!fp_gtk_check_version(3, 20, 0)) {
              gtk3_version_3_20 = TRUE;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -475,12 +477,11 @@</span>
                  dl_symbol(&quot;gtk_color_selection_dialog_new&quot;);
          fp_gtk_entry_new = dl_symbol(&quot;gtk_entry_new&quot;);
          fp_gtk_fixed_new = dl_symbol(&quot;gtk_fixed_new&quot;);
          fp_gtk_handle_box_new = dl_symbol(&quot;gtk_handle_box_new&quot;);
          fp_gtk_image_new = dl_symbol(&quot;gtk_image_new&quot;);
<span class="udiff-line-modified-removed">-         fp_gtk_hpaned_new = dl_symbol(&quot;gtk_hpaned_new&quot;);</span>
<span class="udiff-line-removed">-         fp_gtk_vpaned_new = dl_symbol(&quot;gtk_vpaned_new&quot;);</span>
<span class="udiff-line-modified-added">+         fp_gtk_paned_new = dl_symbol(&quot;gtk_paned_new&quot;);</span>
          fp_gtk_scale_new = dl_symbol(&quot;gtk_scale_new&quot;);
          fp_gtk_hscrollbar_new = dl_symbol(&quot;gtk_hscrollbar_new&quot;);
          fp_gtk_vscrollbar_new = dl_symbol(&quot;gtk_vscrollbar_new&quot;);
          fp_gtk_hseparator_new = dl_symbol(&quot;gtk_hseparator_new&quot;);
          fp_gtk_vseparator_new = dl_symbol(&quot;gtk_vseparator_new&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1079,11 +1080,11 @@</span>
              break;
          case HSPLIT_PANE_DIVIDER:
          case SPLIT_PANE:
              if (init_result = (NULL == gtk3_widgets[_GTK_HPANED_TYPE]))
              {
<span class="udiff-line-modified-removed">-                 gtk3_widgets[_GTK_HPANED_TYPE] = (*fp_gtk_hpaned_new)();</span>
<span class="udiff-line-modified-added">+                 gtk3_widgets[_GTK_HPANED_TYPE] = (*fp_gtk_paned_new)(GTK_ORIENTATION_HORIZONTAL);</span>
              }
              result = gtk3_widgets[_GTK_HPANED_TYPE];
              break;
          case IMAGE:
              if (init_result = (NULL == gtk3_widgets[_GTK_IMAGE_TYPE]))
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1312,11 +1313,11 @@</span>
               fp_gtk_range_set_inverted((GtkRange*)result, TRUE);
              break;
          case VSPLIT_PANE_DIVIDER:
              if (init_result = (NULL == gtk3_widgets[_GTK_VPANED_TYPE]))
              {
<span class="udiff-line-modified-removed">-                 gtk3_widgets[_GTK_VPANED_TYPE] = (*fp_gtk_vpaned_new)();</span>
<span class="udiff-line-modified-added">+                 gtk3_widgets[_GTK_VPANED_TYPE] = (*fp_gtk_paned_new)(GTK_ORIENTATION_VERTICAL);</span>
              }
              result = gtk3_widgets[_GTK_VPANED_TYPE];
              break;
          default:
              result = NULL;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1432,10 +1433,18 @@</span>
                  path = createWidgetPath (NULL);
                  append_element(path, detail);
              } else if (strcmp(detail, &quot;option&quot;) == 0) {
                  path = createWidgetPath (NULL);
                  append_element(path, &quot;radio&quot;);
<span class="udiff-line-added">+             } else if (strcmp(detail, &quot;paned&quot;) == 0) {</span>
<span class="udiff-line-added">+                 path = createWidgetPath (fp_gtk_style_context_get_path (widget_context));</span>
<span class="udiff-line-added">+                 append_element(path, &quot;paned&quot;);</span>
<span class="udiff-line-added">+                 append_element(path, &quot;separator&quot;);</span>
<span class="udiff-line-added">+             } else if (strcmp(detail, &quot;spinbutton_down&quot;) == 0 || strcmp(detail, &quot;spinbutton_up&quot;) == 0) {</span>
<span class="udiff-line-added">+                 path = createWidgetPath (fp_gtk_style_context_get_path (widget_context));</span>
<span class="udiff-line-added">+                 append_element(path, &quot;spinbutton&quot;);</span>
<span class="udiff-line-added">+                 append_element(path, &quot;button&quot;);</span>
              } else {
                  path = createWidgetPath (fp_gtk_style_context_get_path (widget_context));
                  append_element(path, detail);
              }
          } else {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1775,17 +1784,22 @@</span>
  {
      if (state_type == GTK_STATE_PRELIGHT &amp;&amp;
          (widget_type == CHECK_BOX || widget_type == RADIO_BUTTON)) {
          return;
      }
<span class="udiff-line-removed">-     gtk3_widget = gtk3_get_widget(widget_type);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     GtkStyleContext* context = fp_gtk_widget_get_style_context (gtk3_widget);</span>
<span class="udiff-line-removed">-     fp_gtk_style_context_save (context);</span>
  
<span class="udiff-line-modified-removed">-     if (detail != 0) {</span>
<span class="udiff-line-modified-removed">-         transform_detail_string(detail, context);</span>
<span class="udiff-line-modified-added">+     GtkStyleContext* context = NULL;</span>
<span class="udiff-line-modified-added">+     if (widget_type == TOOL_TIP) {</span>
<span class="udiff-line-added">+         context = get_style(widget_type, detail);</span>
<span class="udiff-line-added">+         fp_gtk_style_context_add_class(context, &quot;background&quot;);</span>
<span class="udiff-line-added">+     } else {</span>
<span class="udiff-line-added">+         gtk3_widget = gtk3_get_widget(widget_type);</span>
<span class="udiff-line-added">+         context = fp_gtk_widget_get_style_context (gtk3_widget);</span>
<span class="udiff-line-added">+         fp_gtk_style_context_save (context);</span>
<span class="udiff-line-added">+         if (detail != 0) {</span>
<span class="udiff-line-added">+             transform_detail_string(detail, context);</span>
<span class="udiff-line-added">+         }</span>
      }
  
      GtkStateFlags flags = get_gtk_flags(state_type);
  
      if (has_focus) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1797,12 +1811,15 @@</span>
      if (widget_type == COMBO_BOX_TEXT_FIELD) {
          width += height /2;
      }
  
      fp_gtk_render_background (context, cr, x, y, width, height);
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-     fp_gtk_style_context_restore (context);</span>
<span class="udiff-line-modified-added">+     if (widget_type == TOOL_TIP) {</span>
<span class="udiff-line-modified-added">+         disposeOrRestoreContext(context);</span>
<span class="udiff-line-added">+     } else {</span>
<span class="udiff-line-added">+         fp_gtk_style_context_restore (context);</span>
<span class="udiff-line-added">+     }</span>
  }
  
  static void gtk3_paint_focus(WidgetType widget_type, GtkStateType state_type,
          const char *detail, gint x, gint y, gint width, gint height)
  {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1822,26 +1839,34 @@</span>
          GtkShadowType shadow_type, const gchar *detail,
          gint x, gint y, gint width, gint height, GtkOrientation orientation)
  {
      gtk3_widget = gtk3_get_widget(widget_type);
  
<span class="udiff-line-modified-removed">-     GtkStyleContext* context = fp_gtk_widget_get_style_context (gtk3_widget);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     fp_gtk_style_context_save (context);</span>
<span class="udiff-line-modified-added">+     GtkStyleContext* context = get_style(widget_type, detail);</span>
  
      GtkStateFlags flags = get_gtk_flags(state_type);
      fp_gtk_style_context_set_state(context, GTK_STATE_FLAG_PRELIGHT);
  
<span class="udiff-line-modified-removed">-     if (detail != 0) {</span>
<span class="udiff-line-modified-added">+     if (detail != 0 &amp;&amp; !(strcmp(detail, &quot;paned&quot;) == 0)) {</span>
          transform_detail_string(detail, context);
          fp_gtk_style_context_add_class (context, &quot;handlebox_bin&quot;);
      }
  
<span class="udiff-line-modified-removed">-     fp_gtk_render_handle(context, cr, x, y, width, height);</span>
<span class="udiff-line-modified-removed">-     fp_gtk_render_background(context, cr, x, y, width, height);</span>
<span class="udiff-line-modified-added">+     if (!(strcmp(detail, &quot;paned&quot;) == 0)) {</span>
<span class="udiff-line-modified-added">+         fp_gtk_render_handle(context, cr, x, y, width, height);</span>
<span class="udiff-line-added">+         fp_gtk_render_background(context, cr, x, y, width, height);</span>
<span class="udiff-line-added">+     } else {</span>
<span class="udiff-line-added">+         if (orientation == GTK_ORIENTATION_VERTICAL) {</span>
<span class="udiff-line-added">+             fp_gtk_render_handle(context, cr, x+width/2, y, 2, height);</span>
<span class="udiff-line-added">+             fp_gtk_render_background(context, cr, x+width/2, y, 2, height);</span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+             fp_gtk_render_handle(context, cr, x, y+height/2, width, 2);</span>
<span class="udiff-line-added">+             fp_gtk_render_background(context, cr, x, y+height/2, width, 2);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
  
<span class="udiff-line-modified-removed">-     fp_gtk_style_context_restore (context);</span>
<span class="udiff-line-modified-added">+     disposeOrRestoreContext(context);</span>
  }
  
  static void gtk3_paint_hline(WidgetType widget_type, GtkStateType state_type,
          const gchar *detail, gint x, gint y, gint width, gint height)
  {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2358,21 +2383,23 @@</span>
  
      GtkStateFlags flags = gtk3_get_state_flags(state_type);
  
      init_containers();
  
<span class="udiff-line-modified-removed">-     if (widget_type == TEXT_FIELD &amp;&amp; state_type == GTK_STATE_SELECTED &amp;&amp;</span>
<span class="udiff-line-modified-removed">-         color_type == TEXT_BACKGROUND) {</span>
<span class="udiff-line-modified-removed">-         widget_type = TEXT_AREA;</span>
<span class="udiff-line-modified-added">+     if (gtk3_version_3_20) {</span>
<span class="udiff-line-modified-added">+         if ((widget_type == TEXT_FIELD || widget_type == PASSWORD_FIELD || widget_type == SPINNER_TEXT_FIELD ||</span>
<span class="udiff-line-modified-added">+             widget_type == FORMATTED_TEXT_FIELD) &amp;&amp; state_type == GTK_STATE_SELECTED &amp;&amp; color_type == TEXT_BACKGROUND) {</span>
<span class="udiff-line-added">+             widget_type = TEXT_AREA;</span>
<span class="udiff-line-added">+         }</span>
      }
  
<span class="udiff-line-modified-removed">-     gtk3_widget = gtk3_get_widget(widget_type);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     GtkStyleContext* context = fp_gtk_widget_get_style_context(gtk3_widget);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-modified-added">+     GtkStyleContext* context = NULL;</span>
      if (widget_type == TOOL_TIP) {
<span class="udiff-line-modified-removed">-         fp_gtk_style_context_add_class(context, &quot;tooltip&quot;);</span>
<span class="udiff-line-modified-added">+         context = get_style(widget_type, &quot;tooltip&quot;);</span>
<span class="udiff-line-added">+     } else {</span>
<span class="udiff-line-added">+         gtk3_widget = gtk3_get_widget(widget_type);</span>
<span class="udiff-line-added">+         context = fp_gtk_widget_get_style_context(gtk3_widget);</span>
      }
      if (widget_type == CHECK_BOX_MENU_ITEM
       || widget_type == RADIO_BUTTON_MENU_ITEM) {
          flags &amp;= GTK_STATE_FLAG_NORMAL | GTK_STATE_FLAG_SELECTED
                    | GTK_STATE_FLAG_INSENSITIVE | GTK_STATE_FLAG_FOCUSED;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2386,11 +2413,13 @@</span>
          0, BACKGROUND);
      }
  
      result = recode_color(color.alpha) &lt;&lt; 24 | recode_color(color.red) &lt;&lt; 16 |
               recode_color(color.green) &lt;&lt; 8 | recode_color(color.blue);
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-added">+     if (widget_type == TOOL_TIP) {</span>
<span class="udiff-line-added">+         disposeOrRestoreContext(context);</span>
<span class="udiff-line-added">+     }</span>
      return result;
  }
  
  /*************************************************/
  static jobject create_Boolean(JNIEnv *env, jboolean boolean_value);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2874,11 +2903,18 @@</span>
                                                                     jint scale) {
      GdkPixbuf *pixbuf;
      jint *ary;
  
      GdkWindow *root = (*fp_gdk_get_default_root_window)();
<span class="udiff-line-modified-removed">-     pixbuf = (*fp_gdk_pixbuf_get_from_drawable)(root, x, y, width, height);</span>
<span class="udiff-line-modified-added">+     if (gtk3_version_3_10) {</span>
<span class="udiff-line-added">+         int win_scale = (*fp_gdk_window_get_scale_factor)(root);</span>
<span class="udiff-line-added">+         pixbuf = (*fp_gdk_pixbuf_get_from_drawable)(</span>
<span class="udiff-line-added">+             root, x, y, (int) (width / (float) win_scale + 0.5), (int) (height / (float) win_scale + 0.5));</span>
<span class="udiff-line-added">+     } else {</span>
<span class="udiff-line-added">+         pixbuf = (*fp_gdk_pixbuf_get_from_drawable)(root, x, y, width, height);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      if (pixbuf &amp;&amp; scale != 1) {
          GdkPixbuf *scaledPixbuf;
          x /= scale;
          y /= scale;
          width /= scale;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2892,12 +2928,12 @@</span>
      }
  
      if (pixbuf) {
          int nchan = (*fp_gdk_pixbuf_get_n_channels)(pixbuf);
          int stride = (*fp_gdk_pixbuf_get_rowstride)(pixbuf);
<span class="udiff-line-modified-removed">-         if ((*fp_gdk_pixbuf_get_width)(pixbuf) == width</span>
<span class="udiff-line-modified-removed">-                 &amp;&amp; (*fp_gdk_pixbuf_get_height)(pixbuf) == height</span>
<span class="udiff-line-modified-added">+         if ((*fp_gdk_pixbuf_get_width)(pixbuf) &gt;= width</span>
<span class="udiff-line-modified-added">+                 &amp;&amp; (*fp_gdk_pixbuf_get_height)(pixbuf) &gt;= height</span>
                  &amp;&amp; (*fp_gdk_pixbuf_get_bits_per_sample)(pixbuf) == 8
                  &amp;&amp; (*fp_gdk_pixbuf_get_colorspace)(pixbuf) == GDK_COLORSPACE_RGB
                  &amp;&amp; nchan &gt;= 3
                  ) {
              guchar *p, *pix = (*fp_gdk_pixbuf_get_pixels)(pixbuf);
</pre>
<center><a href="gtk2_interface.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="gtk3_interface.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>