<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/unix/native/libawt_xawt/awt/multiVis.c</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="gtk_interface.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="swing_GTKEngine.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/unix/native/libawt_xawt/awt/multiVis.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 201 {
 202     Vis-&gt;ext_data=NULL;
 203     Vis-&gt;class = DirectColor ;
 204     Vis-&gt;red_mask =   0x00FF0000;
 205     Vis-&gt;green_mask = 0x0000FF00 ;
 206     Vis-&gt;blue_mask  = 0x000000FF ;
 207     Vis-&gt;map_entries = 256 ;
 208     Vis-&gt;bits_per_rgb = 8 ;
 209 }
 210 
 211 static void
 212 QueryColorMap(Display *disp, Colormap src_cmap, Visual *src_vis,
 213               XColor **src_colors, int *rShift, int *gShift, int *bShift)
 214 {
 215      unsigned int ncolors,i ;
 216      unsigned long       redMask, greenMask, blueMask;
 217      int                 redShift, greenShift, blueShift;
 218      XColor *colors ;
 219 
 220      ncolors = (unsigned) src_vis-&gt;map_entries ;
<span class="line-modified"> 221      *src_colors = colors = (XColor *)malloc(ncolors * sizeof(XColor) ) ;</span>




 222 
 223      if(src_vis-&gt;class != TrueColor &amp;&amp; src_vis-&gt;class != DirectColor)
 224      {
 225          for(i=0 ; i &lt; ncolors ; i++)
 226          {
 227                 colors[i].pixel = i ;
 228                 colors[i].pad = 0;
 229                 colors[i].flags = DoRed|DoGreen|DoBlue;
 230          }
 231      }
 232      else /** src is decomposed rgb ***/
 233      {
 234         /* Get the X colormap */
 235         redMask = src_vis-&gt;red_mask;
 236         greenMask = src_vis-&gt;green_mask;
 237         blueMask = src_vis-&gt;blue_mask;
 238         redShift = 0; while (!(redMask&amp;0x1)) {
 239                 redShift++;
 240                 redMask = redMask&gt;&gt;1;
 241         }
</pre>
</td>
<td>
<hr />
<pre>
 201 {
 202     Vis-&gt;ext_data=NULL;
 203     Vis-&gt;class = DirectColor ;
 204     Vis-&gt;red_mask =   0x00FF0000;
 205     Vis-&gt;green_mask = 0x0000FF00 ;
 206     Vis-&gt;blue_mask  = 0x000000FF ;
 207     Vis-&gt;map_entries = 256 ;
 208     Vis-&gt;bits_per_rgb = 8 ;
 209 }
 210 
 211 static void
 212 QueryColorMap(Display *disp, Colormap src_cmap, Visual *src_vis,
 213               XColor **src_colors, int *rShift, int *gShift, int *bShift)
 214 {
 215      unsigned int ncolors,i ;
 216      unsigned long       redMask, greenMask, blueMask;
 217      int                 redShift, greenShift, blueShift;
 218      XColor *colors ;
 219 
 220      ncolors = (unsigned) src_vis-&gt;map_entries ;
<span class="line-modified"> 221 /* JDK modification.</span>
<span class="line-added"> 222  * use calloc instead of malloc to initialize allocated memory</span>
<span class="line-added"> 223  *   *src_colors = colors = (XColor *)malloc(ncolors * sizeof(XColor) ) ;</span>
<span class="line-added"> 224  */</span>
<span class="line-added"> 225      *src_colors = colors = (XColor *)calloc(ncolors, sizeof(XColor));</span>
 226 
 227      if(src_vis-&gt;class != TrueColor &amp;&amp; src_vis-&gt;class != DirectColor)
 228      {
 229          for(i=0 ; i &lt; ncolors ; i++)
 230          {
 231                 colors[i].pixel = i ;
 232                 colors[i].pad = 0;
 233                 colors[i].flags = DoRed|DoGreen|DoBlue;
 234          }
 235      }
 236      else /** src is decomposed rgb ***/
 237      {
 238         /* Get the X colormap */
 239         redMask = src_vis-&gt;red_mask;
 240         greenMask = src_vis-&gt;green_mask;
 241         blueMask = src_vis-&gt;blue_mask;
 242         redShift = 0; while (!(redMask&amp;0x1)) {
 243                 redShift++;
 244                 redMask = redMask&gt;&gt;1;
 245         }
</pre>
</td>
</tr>
</table>
<center><a href="gtk_interface.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="swing_GTKEngine.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>