<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/unix/native/libawt_xawt/awt/awt_UNIXToolkit.c</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="awt_Robot.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="gtk2_interface.c.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/unix/native/libawt_xawt/awt/awt_UNIXToolkit.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2004, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2004, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 111,30 ***</span>
  Java_sun_awt_UNIXToolkit_load_1gtk_1icon(JNIEnv *env, jobject this,
          jstring filename)
  {
  #ifndef HEADLESS
      int len;
      char *filename_str = NULL;
      GError **error = NULL;
  
      if (filename == NULL)
      {
          return JNI_FALSE;
      }
  
      len = (*env)-&gt;GetStringUTFLength(env, filename);
      filename_str = (char *)SAFE_SIZE_ARRAY_ALLOC(malloc,
              sizeof(char), len + 1);
      if (filename_str == NULL) {
          JNU_ThrowOutOfMemoryError(env, &quot;OutOfMemoryError&quot;);
          return JNI_FALSE;
      }
      if (!init_method(env, this) ) {
          free(filename_str);
          return JNI_FALSE;
      }
<span class="line-modified">!     (*env)-&gt;GetStringUTFRegion(env, filename, 0, len, filename_str);</span>
      jboolean result = gtk-&gt;get_file_icon_data(env, filename_str, error,
                                              icon_upcall_method, this);
  
      /* Release the strings we&#39;ve allocated. */
      free(filename_str);
<span class="line-new-header">--- 111,32 ---</span>
  Java_sun_awt_UNIXToolkit_load_1gtk_1icon(JNIEnv *env, jobject this,
          jstring filename)
  {
  #ifndef HEADLESS
      int len;
<span class="line-added">+     jsize jlen;</span>
      char *filename_str = NULL;
      GError **error = NULL;
  
      if (filename == NULL)
      {
          return JNI_FALSE;
      }
  
      len = (*env)-&gt;GetStringUTFLength(env, filename);
<span class="line-added">+     jlen = (*env)-&gt;GetStringLength(env, filename);</span>
      filename_str = (char *)SAFE_SIZE_ARRAY_ALLOC(malloc,
              sizeof(char), len + 1);
      if (filename_str == NULL) {
          JNU_ThrowOutOfMemoryError(env, &quot;OutOfMemoryError&quot;);
          return JNI_FALSE;
      }
      if (!init_method(env, this) ) {
          free(filename_str);
          return JNI_FALSE;
      }
<span class="line-modified">!     (*env)-&gt;GetStringUTFRegion(env, filename, 0, jlen, filename_str);</span>
      jboolean result = gtk-&gt;get_file_icon_data(env, filename_str, error,
                                              icon_upcall_method, this);
  
      /* Release the strings we&#39;ve allocated. */
      free(filename_str);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 157,40 ***</span>
          jint widget_type, jstring stock_id, jint icon_size,
          jint text_direction, jstring detail)
  {
  #ifndef HEADLESS
      int len;
      char *stock_id_str = NULL;
      char *detail_str = NULL;
      jboolean result = JNI_FALSE;
  
      if (stock_id == NULL)
      {
          return JNI_FALSE;
      }
  
      len = (*env)-&gt;GetStringUTFLength(env, stock_id);
      stock_id_str = (char *)SAFE_SIZE_ARRAY_ALLOC(malloc,
              sizeof(char), len + 1);
      if (stock_id_str == NULL) {
          JNU_ThrowOutOfMemoryError(env, &quot;OutOfMemoryError&quot;);
          return JNI_FALSE;
      }
<span class="line-modified">!     (*env)-&gt;GetStringUTFRegion(env, stock_id, 0, len, stock_id_str);</span>
  
      /* Detail isn&#39;t required so check for NULL. */
      if (detail != NULL)
      {
          len = (*env)-&gt;GetStringUTFLength(env, detail);
          detail_str = (char *)SAFE_SIZE_ARRAY_ALLOC(malloc,
                  sizeof(char), len + 1);
          if (detail_str == NULL) {
              free(stock_id_str);
              JNU_ThrowOutOfMemoryError(env, &quot;OutOfMemoryError&quot;);
              return JNI_FALSE;
          }
<span class="line-modified">!         (*env)-&gt;GetStringUTFRegion(env, detail, 0, len, detail_str);</span>
      }
  
      if (init_method(env, this)) {
          result = gtk-&gt;get_icon_data(env, widget_type, stock_id_str,
                                      icon_size, text_direction, detail_str,
<span class="line-new-header">--- 159,43 ---</span>
          jint widget_type, jstring stock_id, jint icon_size,
          jint text_direction, jstring detail)
  {
  #ifndef HEADLESS
      int len;
<span class="line-added">+     jsize jlen;</span>
      char *stock_id_str = NULL;
      char *detail_str = NULL;
      jboolean result = JNI_FALSE;
  
      if (stock_id == NULL)
      {
          return JNI_FALSE;
      }
  
      len = (*env)-&gt;GetStringUTFLength(env, stock_id);
<span class="line-added">+     jlen = (*env)-&gt;GetStringLength(env, stock_id);</span>
      stock_id_str = (char *)SAFE_SIZE_ARRAY_ALLOC(malloc,
              sizeof(char), len + 1);
      if (stock_id_str == NULL) {
          JNU_ThrowOutOfMemoryError(env, &quot;OutOfMemoryError&quot;);
          return JNI_FALSE;
      }
<span class="line-modified">!     (*env)-&gt;GetStringUTFRegion(env, stock_id, 0, jlen, stock_id_str);</span>
  
      /* Detail isn&#39;t required so check for NULL. */
      if (detail != NULL)
      {
          len = (*env)-&gt;GetStringUTFLength(env, detail);
<span class="line-added">+         jlen = (*env)-&gt;GetStringLength(env, detail);</span>
          detail_str = (char *)SAFE_SIZE_ARRAY_ALLOC(malloc,
                  sizeof(char), len + 1);
          if (detail_str == NULL) {
              free(stock_id_str);
              JNU_ThrowOutOfMemoryError(env, &quot;OutOfMemoryError&quot;);
              return JNI_FALSE;
          }
<span class="line-modified">!         (*env)-&gt;GetStringUTFRegion(env, detail, 0, jlen, detail_str);</span>
      }
  
      if (init_method(env, this)) {
          result = gtk-&gt;get_icon_data(env, widget_type, stock_id_str,
                                      icon_size, text_direction, detail_str,
</pre>
<center><a href="awt_Robot.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="gtk2_interface.c.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>