<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/unix/classes/sun/java2d/xr/XRDrawLine.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../opengl/GLXSurfaceData.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../print/IPPPrintService.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/unix/classes/sun/java2d/xr/XRDrawLine.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
205             } else {
206                 error -= errminor;
207                 x += xStep;
208                 y += yStep;
209             }
210         } while (--steps &gt; 0);
211 
212         // Add last rectangle which isn&#39;t handled by the combination-code
213         // anymore
214         rectBuffer.pushRectValues(rectX, rectY, rectW, rectH);
215     }
216 
217     private boolean clipCoordinates(int cxmin, int cymin, int cxmax, int cymax,
218             boolean xmajor, int dx, int dy, int ax, int ay) {
219         int outcode1, outcode2;
220 
221         outcode1 = outcode(x1, y1, cxmin, cymin, cxmax, cymax);
222         outcode2 = outcode(x2, y2, cxmin, cymin, cxmax, cymax);
223 
224         while ((outcode1 | outcode2) != 0) {
<span class="line-modified">225             int xsteps = 0, ysteps = 0;</span>
226 
227             if ((outcode1 &amp; outcode2) != 0) {
228                 return false;
229             }
230 
231             if (outcode1 != 0) {
232                 if ((outcode1 &amp; (OUTCODE_TOP | OUTCODE_BOTTOM)) != 0) {
233                     if ((outcode1 &amp; OUTCODE_TOP) != 0) {
234                         y1 = cymin;
235                     } else {
236                         y1 = cymax;
237                     }
238                     ysteps = y1 - ucY1;
239                     if (ysteps &lt; 0) {
240                         ysteps = -ysteps;
241                     }
242                     xsteps = 2 * ysteps * ax + ay;
243                     if (xmajor) {
244                         xsteps += ay - ax - 1;
245                     }
246                     xsteps = xsteps / (2 * ay);
247                     if (dx &lt; 0) {
248                         xsteps = -xsteps;
249                     }
<span class="line-modified">250                     x1 = ucX1 + xsteps;</span>
251                 } else if ((outcode1 &amp; (OUTCODE_LEFT | OUTCODE_RIGHT)) != 0) {
252                     if ((outcode1 &amp; OUTCODE_LEFT) != 0) {
253                         x1 = cxmin;
254                     } else {
255                         x1 = cxmax;
256                     }
257                     xsteps = x1 - ucX1;
258                     if (xsteps &lt; 0) {
259                         xsteps = -xsteps;
260                     }
261                     ysteps = 2 * xsteps * ay + ax;
262                     if (!xmajor) {
263                         ysteps += ax - ay - 1;
264                     }
265                     ysteps = ysteps / (2 * ax);
266                     if (dy &lt; 0) {
267                         ysteps = -ysteps;
268                     }
<span class="line-modified">269                     y1 = ucY1 + ysteps;</span>
270                 }
271                 outcode1 = outcode(x1, y1, cxmin, cymin, cxmax, cymax);
272             } else {
273                 if ((outcode2 &amp; (OUTCODE_TOP | OUTCODE_BOTTOM)) != 0) {
274                     if ((outcode2 &amp; OUTCODE_TOP) != 0) {
275                         y2 = cymin;
276                     } else {
277                         y2 = cymax;
278                     }
279                     ysteps = y2 - ucY2;
280                     if (ysteps &lt; 0) {
281                         ysteps = -ysteps;
282                     }
283                     xsteps = 2 * ysteps * ax + ay;
284                     if (xmajor) {
285                         xsteps += ay - ax;
286                     } else {
287                         xsteps -= 1;
288                     }
289                     xsteps = xsteps / (2 * ay);
290                     if (dx &gt; 0) {
291                         xsteps = -xsteps;
292                     }
<span class="line-modified">293                     x2 = ucX2 + xsteps;</span>
294                 } else if ((outcode2 &amp; (OUTCODE_LEFT | OUTCODE_RIGHT)) != 0) {
295                     if ((outcode2 &amp; OUTCODE_LEFT) != 0) {
296                         x2 = cxmin;
297                     } else {
298                         x2 = cxmax;
299                     }
300                     xsteps = x2 - ucX2;
301                     if (xsteps &lt; 0) {
302                         xsteps = -xsteps;
303                     }
304                     ysteps = 2 * xsteps * ay + ax;
305                     if (xmajor) {
306                         ysteps -= 1;
307                     } else {
308                         ysteps += ax - ay;
309                     }
310                     ysteps = ysteps / (2 * ax);
311                     if (dy &gt; 0) {
312                         ysteps = -ysteps;
313                     }
<span class="line-modified">314                     y2 = ucY2 + ysteps;</span>
315                 }
316                 outcode2 = outcode(x2, y2, cxmin, cymin, cxmax, cymax);
317             }
318         }
319 
320         return true;
321     }
322 
323     private void initCoordinates(int x1, int y1, int x2, int y2,
324             boolean checkOverflow) {
325         /*
326          * Part of calculating the Bresenham parameters for line stepping
327          * involves being able to store numbers that are twice the magnitude of
328          * the biggest absolute difference in coordinates. Since we want the
329          * stepping parameters to be stored in jints, we then need to avoid any
330          * absolute differences more than 30 bits. Thus, we need to preprocess
331          * the coordinates to reduce their range to 30 bits regardless of
332          * clipping. We need to cut their range back before we do the clipping
333          * because the Bresenham stepping values need to be calculated based on
334          * the &quot;unclipped&quot; coordinates.
</pre>
</td>
<td>
<hr />
<pre>
205             } else {
206                 error -= errminor;
207                 x += xStep;
208                 y += yStep;
209             }
210         } while (--steps &gt; 0);
211 
212         // Add last rectangle which isn&#39;t handled by the combination-code
213         // anymore
214         rectBuffer.pushRectValues(rectX, rectY, rectW, rectH);
215     }
216 
217     private boolean clipCoordinates(int cxmin, int cymin, int cxmax, int cymax,
218             boolean xmajor, int dx, int dy, int ax, int ay) {
219         int outcode1, outcode2;
220 
221         outcode1 = outcode(x1, y1, cxmin, cymin, cxmax, cymax);
222         outcode2 = outcode(x2, y2, cxmin, cymin, cxmax, cymax);
223 
224         while ((outcode1 | outcode2) != 0) {
<span class="line-modified">225             long xsteps = 0, ysteps = 0;</span>
226 
227             if ((outcode1 &amp; outcode2) != 0) {
228                 return false;
229             }
230 
231             if (outcode1 != 0) {
232                 if ((outcode1 &amp; (OUTCODE_TOP | OUTCODE_BOTTOM)) != 0) {
233                     if ((outcode1 &amp; OUTCODE_TOP) != 0) {
234                         y1 = cymin;
235                     } else {
236                         y1 = cymax;
237                     }
238                     ysteps = y1 - ucY1;
239                     if (ysteps &lt; 0) {
240                         ysteps = -ysteps;
241                     }
242                     xsteps = 2 * ysteps * ax + ay;
243                     if (xmajor) {
244                         xsteps += ay - ax - 1;
245                     }
246                     xsteps = xsteps / (2 * ay);
247                     if (dx &lt; 0) {
248                         xsteps = -xsteps;
249                     }
<span class="line-modified">250                     x1 = ucX1 + (int) xsteps;</span>
251                 } else if ((outcode1 &amp; (OUTCODE_LEFT | OUTCODE_RIGHT)) != 0) {
252                     if ((outcode1 &amp; OUTCODE_LEFT) != 0) {
253                         x1 = cxmin;
254                     } else {
255                         x1 = cxmax;
256                     }
257                     xsteps = x1 - ucX1;
258                     if (xsteps &lt; 0) {
259                         xsteps = -xsteps;
260                     }
261                     ysteps = 2 * xsteps * ay + ax;
262                     if (!xmajor) {
263                         ysteps += ax - ay - 1;
264                     }
265                     ysteps = ysteps / (2 * ax);
266                     if (dy &lt; 0) {
267                         ysteps = -ysteps;
268                     }
<span class="line-modified">269                     y1 = ucY1 + (int) ysteps;</span>
270                 }
271                 outcode1 = outcode(x1, y1, cxmin, cymin, cxmax, cymax);
272             } else {
273                 if ((outcode2 &amp; (OUTCODE_TOP | OUTCODE_BOTTOM)) != 0) {
274                     if ((outcode2 &amp; OUTCODE_TOP) != 0) {
275                         y2 = cymin;
276                     } else {
277                         y2 = cymax;
278                     }
279                     ysteps = y2 - ucY2;
280                     if (ysteps &lt; 0) {
281                         ysteps = -ysteps;
282                     }
283                     xsteps = 2 * ysteps * ax + ay;
284                     if (xmajor) {
285                         xsteps += ay - ax;
286                     } else {
287                         xsteps -= 1;
288                     }
289                     xsteps = xsteps / (2 * ay);
290                     if (dx &gt; 0) {
291                         xsteps = -xsteps;
292                     }
<span class="line-modified">293                     x2 = ucX2 + (int) xsteps;</span>
294                 } else if ((outcode2 &amp; (OUTCODE_LEFT | OUTCODE_RIGHT)) != 0) {
295                     if ((outcode2 &amp; OUTCODE_LEFT) != 0) {
296                         x2 = cxmin;
297                     } else {
298                         x2 = cxmax;
299                     }
300                     xsteps = x2 - ucX2;
301                     if (xsteps &lt; 0) {
302                         xsteps = -xsteps;
303                     }
304                     ysteps = 2 * xsteps * ay + ax;
305                     if (xmajor) {
306                         ysteps -= 1;
307                     } else {
308                         ysteps += ax - ay;
309                     }
310                     ysteps = ysteps / (2 * ax);
311                     if (dy &gt; 0) {
312                         ysteps = -ysteps;
313                     }
<span class="line-modified">314                     y2 = ucY2 + (int) ysteps;</span>
315                 }
316                 outcode2 = outcode(x2, y2, cxmin, cymin, cxmax, cymax);
317             }
318         }
319 
320         return true;
321     }
322 
323     private void initCoordinates(int x1, int y1, int x2, int y2,
324             boolean checkOverflow) {
325         /*
326          * Part of calculating the Bresenham parameters for line stepping
327          * involves being able to store numbers that are twice the magnitude of
328          * the biggest absolute difference in coordinates. Since we want the
329          * stepping parameters to be stored in jints, we then need to avoid any
330          * absolute differences more than 30 bits. Thus, we need to preprocess
331          * the coordinates to reduce their range to 30 bits regardless of
332          * clipping. We need to cut their range back before we do the clipping
333          * because the Bresenham stepping values need to be calculated based on
334          * the &quot;unclipped&quot; coordinates.
</pre>
</td>
</tr>
</table>
<center><a href="../opengl/GLXSurfaceData.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../print/IPPPrintService.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>