<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/unix/classes/sun/print/PrintServiceLookupProvider.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="IPPPrintService.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="UnixPrintJob.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/unix/classes/sun/print/PrintServiceLookupProvider.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
440         return true;
441       }
442 
443     /*
444      * Gets the printer name compatible with the list of printers returned by
445      * the system when we query default or all the available printers.
446      */
447     private String getPrinterDestName(PrintService ps) {
448         if (isMac()) {
449             return ((IPPPrintService)ps).getDest();
450         }
451         return ps.getName();
452     }
453 
454     /* On a network with many (hundreds) of network printers, it
455      * can save several seconds if you know all you want is a particular
456      * printer, to ask for that printer rather than retrieving all printers.
457      */
458     private PrintService getServiceByName(PrinterName nameAttr) {
459         String name = nameAttr.getValue();
<span class="line-modified">460         if (name == null || name.equals(&quot;&quot;) || !checkPrinterName(name)) {</span>
461             return null;
462         }
463         /* check if all printers are already available */
464         if (printServices != null) {
465             for (PrintService printService : printServices) {
466                 PrinterName printerName = printService.getAttribute(PrinterName.class);
467                 if (printerName.getValue().equals(name)) {
468                     return printService;
469                 }
470             }
471         }
472         /* take CUPS into account first */
473         if (CUPSPrinter.isCupsRunning()) {
474             try {
475                 return new IPPPrintService(name,
476                                            new URL(&quot;http://&quot;+
477                                                    CUPSPrinter.getServer()+&quot;:&quot;+
478                                                    CUPSPrinter.getPort()+&quot;/&quot;+
479                                                    name));
480             } catch (Exception e) {
</pre>
<hr />
<pre>
806 
807         String command = &quot;/usr/bin/lpstat -v &quot; + name;
808         String []result = execCmd(command);
809 
810         if (result == null || result[0].indexOf(&quot;unknown printer&quot;) &gt; 0) {
811             return null;
812         } else {
813             return new UnixPrintService(name);
814         }
815     }
816 
817     private String[] getAllPrinterNamesSysV() {
818         String defaultPrinter = &quot;lp&quot;;
819         String command = &quot;/usr/bin/lpstat -v|/usr/bin/expand|/usr/bin/cut -f3 -d&#39; &#39; |/usr/bin/cut -f1 -d&#39;:&#39; | /usr/bin/sort&quot;;
820 
821         String [] names = execCmd(command);
822         ArrayList&lt;String&gt; printerNames = new ArrayList&lt;&gt;();
823         for (int i=0; i &lt; names.length; i++) {
824             if (!names[i].equals(&quot;_default&quot;) &amp;&amp;
825                 !names[i].equals(defaultPrinter) &amp;&amp;
<span class="line-modified">826                 !names[i].equals(&quot;&quot;)) {</span>
827                 printerNames.add(names[i]);
828             }
829         }
830         return printerNames.toArray(new String[printerNames.size()]);
831     }
832 
833     private String getDefaultPrinterNameAIX() {
834         String[] names = execCmd(lpNameComAix[aix_lpstat_d]);
835         // Remove headers and bogus entries added by remote printers.
836         names = UnixPrintService.filterPrinterNamesAIX(names);
837         if (names == null || names.length != 1) {
838             // No default printer found
839             return null;
840         } else {
841             return names[0];
842         }
843     }
844 
845     private PrintService getNamedPrinterNameAIX(String name) {
846         // On AIX there should be no blank after &#39;-v&#39;.
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
440         return true;
441       }
442 
443     /*
444      * Gets the printer name compatible with the list of printers returned by
445      * the system when we query default or all the available printers.
446      */
447     private String getPrinterDestName(PrintService ps) {
448         if (isMac()) {
449             return ((IPPPrintService)ps).getDest();
450         }
451         return ps.getName();
452     }
453 
454     /* On a network with many (hundreds) of network printers, it
455      * can save several seconds if you know all you want is a particular
456      * printer, to ask for that printer rather than retrieving all printers.
457      */
458     private PrintService getServiceByName(PrinterName nameAttr) {
459         String name = nameAttr.getValue();
<span class="line-modified">460         if (name == null || name.isEmpty() || !checkPrinterName(name)) {</span>
461             return null;
462         }
463         /* check if all printers are already available */
464         if (printServices != null) {
465             for (PrintService printService : printServices) {
466                 PrinterName printerName = printService.getAttribute(PrinterName.class);
467                 if (printerName.getValue().equals(name)) {
468                     return printService;
469                 }
470             }
471         }
472         /* take CUPS into account first */
473         if (CUPSPrinter.isCupsRunning()) {
474             try {
475                 return new IPPPrintService(name,
476                                            new URL(&quot;http://&quot;+
477                                                    CUPSPrinter.getServer()+&quot;:&quot;+
478                                                    CUPSPrinter.getPort()+&quot;/&quot;+
479                                                    name));
480             } catch (Exception e) {
</pre>
<hr />
<pre>
806 
807         String command = &quot;/usr/bin/lpstat -v &quot; + name;
808         String []result = execCmd(command);
809 
810         if (result == null || result[0].indexOf(&quot;unknown printer&quot;) &gt; 0) {
811             return null;
812         } else {
813             return new UnixPrintService(name);
814         }
815     }
816 
817     private String[] getAllPrinterNamesSysV() {
818         String defaultPrinter = &quot;lp&quot;;
819         String command = &quot;/usr/bin/lpstat -v|/usr/bin/expand|/usr/bin/cut -f3 -d&#39; &#39; |/usr/bin/cut -f1 -d&#39;:&#39; | /usr/bin/sort&quot;;
820 
821         String [] names = execCmd(command);
822         ArrayList&lt;String&gt; printerNames = new ArrayList&lt;&gt;();
823         for (int i=0; i &lt; names.length; i++) {
824             if (!names[i].equals(&quot;_default&quot;) &amp;&amp;
825                 !names[i].equals(defaultPrinter) &amp;&amp;
<span class="line-modified">826                 !names[i].isEmpty()) {</span>
827                 printerNames.add(names[i]);
828             }
829         }
830         return printerNames.toArray(new String[printerNames.size()]);
831     }
832 
833     private String getDefaultPrinterNameAIX() {
834         String[] names = execCmd(lpNameComAix[aix_lpstat_d]);
835         // Remove headers and bogus entries added by remote printers.
836         names = UnixPrintService.filterPrinterNamesAIX(names);
837         if (names == null || names.length != 1) {
838             // No default printer found
839             return null;
840         } else {
841             return names[0];
842         }
843     }
844 
845     private PrintService getNamedPrinterNameAIX(String name) {
846         // On AIX there should be no blank after &#39;-v&#39;.
</pre>
</td>
</tr>
</table>
<center><a href="IPPPrintService.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="UnixPrintJob.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>