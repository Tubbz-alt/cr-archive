<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/unix/classes/sun/awt/X11/XToolkit.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="XTextFieldPeer.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="XWindow.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/unix/classes/sun/awt/X11/XToolkit.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2002, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2002, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -344,14 +344,18 @@</span>
              AwtScreenData defaultScreen = new AwtScreenData(XToolkit.getDefaultScreenData());
              awt_defaultFg = defaultScreen.get_blackpixel();
  
              arrowCursor = XlibWrapper.XCreateFontCursor(XToolkit.getDisplay(),
                  XCursorFontConstants.XC_arrow);
<span class="udiff-line-modified-removed">-             areExtraMouseButtonsEnabled = Boolean.parseBoolean(System.getProperty(&quot;sun.awt.enableExtraMouseButtons&quot;, &quot;true&quot;));</span>
<span class="udiff-line-modified-removed">-             //set system property if not yet assigned</span>
<span class="udiff-line-modified-removed">-             System.setProperty(&quot;sun.awt.enableExtraMouseButtons&quot;, &quot;&quot;+areExtraMouseButtonsEnabled);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-added">+             final String extraButtons = &quot;sun.awt.enableExtraMouseButtons&quot;;</span>
<span class="udiff-line-modified-added">+             AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {</span>
<span class="udiff-line-modified-added">+                 areExtraMouseButtonsEnabled =</span>
<span class="udiff-line-modified-added">+                     Boolean.parseBoolean(System.getProperty(extraButtons, &quot;true&quot;));</span>
<span class="udiff-line-added">+                 //set system property if not yet assigned</span>
<span class="udiff-line-added">+                 System.setProperty(extraButtons, &quot;&quot;+areExtraMouseButtonsEnabled);</span>
<span class="udiff-line-added">+                 return null;</span>
<span class="udiff-line-added">+             });</span>
              // Detect display mode changes
              XlibWrapper.XSelectInput(XToolkit.getDisplay(), XToolkit.getDefaultRootWindow(), XConstants.StructureNotifyMask);
              XToolkit.addEventDispatcher(XToolkit.getDefaultRootWindow(), new XEventDispatcher() {
                  @Override
                  public void dispatchEvent(XEvent ev) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -421,11 +425,11 @@</span>
              StackTraceElement[] trace = (new Throwable()).getStackTrace();
              int bottom = trace.length - 1;
              if (bottom &gt;= 0) {
                  mainClassName = trace[bottom].getClassName();
              }
<span class="udiff-line-modified-removed">-             if (mainClassName == null || mainClassName.equals(&quot;&quot;)) {</span>
<span class="udiff-line-modified-added">+             if (mainClassName == null || mainClassName.isEmpty()) {</span>
                  mainClassName = &quot;AWT&quot;;
              }
              awtAppClassName = getCorrectXIDString(mainClassName);
  
              init();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2552,18 +2556,20 @@</span>
                                                XConstants.XkbVirtualModsMask,
                                                XConstants.XkbUseCoreKbd);
                   //System.out.println(&quot;XkbNewKeyboard:&quot;+(xke.get_new_kbd()));
                   break;
              case XConstants.XkbMapNotify :
<span class="udiff-line-modified-removed">-                  //TODO: provide a simple unit test.</span>
<span class="udiff-line-modified-removed">-                  XlibWrapper.XkbGetUpdatedMap(getDisplay(),</span>
<span class="udiff-line-modified-removed">-                                               XConstants.XkbKeyTypesMask    |</span>
<span class="udiff-line-modified-removed">-                                               XConstants.XkbKeySymsMask     |</span>
<span class="udiff-line-modified-removed">-                                               XConstants.XkbModifierMapMask |</span>
<span class="udiff-line-modified-removed">-                                               XConstants.XkbVirtualModsMask,</span>
<span class="udiff-line-modified-removed">-                                               awt_XKBDescPtr);</span>
<span class="udiff-line-modified-removed">-                  //System.out.println(&quot;XkbMap:&quot;+(xke.get_map()));</span>
<span class="udiff-line-modified-added">+                  if (awt_XKBDescPtr != 0) {</span>
<span class="udiff-line-modified-added">+                     //TODO: provide a simple unit test.</span>
<span class="udiff-line-modified-added">+                     XlibWrapper.XkbGetUpdatedMap(getDisplay(),</span>
<span class="udiff-line-modified-added">+                                                  XConstants.XkbKeyTypesMask    |</span>
<span class="udiff-line-modified-added">+                                                  XConstants.XkbKeySymsMask     |</span>
<span class="udiff-line-modified-added">+                                                  XConstants.XkbModifierMapMask |</span>
<span class="udiff-line-modified-added">+                                                  XConstants.XkbVirtualModsMask,</span>
<span class="udiff-line-modified-added">+                                                  awt_XKBDescPtr);</span>
<span class="udiff-line-added">+                  }</span>
<span class="udiff-line-added">+                 //System.out.println(&quot;XkbMap:&quot;+(xke.get_map()));</span>
                   break;
              case XConstants.XkbStateNotify :
                   // May use it later e.g. to obtain an effective group etc.
                   //System.out.println(&quot;XkbState:&quot;+(xke.get_state()));
                   break;
</pre>
<center><a href="XTextFieldPeer.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="XWindow.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>