<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/windows/classes/sun/awt/windows/WComponentPeer.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="WChoicePeer.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="WFramePeer.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/windows/classes/sun/awt/windows/WComponentPeer.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 1996, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 1996, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -22,44 +22,57 @@</span>
   * or visit www.oracle.com if you need additional information or have any
   * questions.
   */
  package sun.awt.windows;
  
<span class="udiff-line-modified-removed">- import java.awt.*;</span>
<span class="udiff-line-modified-removed">- import java.awt.peer.*;</span>
<span class="udiff-line-modified-removed">- import java.awt.image.VolatileImage;</span>
<span class="udiff-line-modified-removed">- import sun.awt.RepaintArea;</span>
<span class="udiff-line-modified-removed">- import sun.awt.image.SunVolatileImage;</span>
<span class="udiff-line-modified-removed">- import sun.awt.image.ToolkitImage;</span>
<span class="udiff-line-modified-removed">- import java.awt.image.BufferedImage;</span>
<span class="udiff-line-modified-removed">- import java.awt.image.ImageProducer;</span>
<span class="udiff-line-modified-removed">- import java.awt.image.ImageObserver;</span>
<span class="udiff-line-modified-removed">- import java.awt.image.ColorModel;</span>
<span class="udiff-line-modified-removed">- import java.awt.event.PaintEvent;</span>
<span class="udiff-line-modified-added">+ import java.awt.AWTEvent;</span>
<span class="udiff-line-modified-added">+ import java.awt.AWTException;</span>
<span class="udiff-line-modified-added">+ import java.awt.BufferCapabilities;</span>
<span class="udiff-line-modified-added">+ import java.awt.Color;</span>
<span class="udiff-line-modified-added">+ import java.awt.Component;</span>
<span class="udiff-line-modified-added">+ import java.awt.Container;</span>
<span class="udiff-line-modified-added">+ import java.awt.Dimension;</span>
<span class="udiff-line-modified-added">+ import java.awt.Font;</span>
<span class="udiff-line-modified-added">+ import java.awt.FontMetrics;</span>
<span class="udiff-line-modified-added">+ import java.awt.Graphics;</span>
<span class="udiff-line-modified-added">+ import java.awt.GraphicsConfiguration;</span>
<span class="udiff-line-added">+ import java.awt.GraphicsDevice;</span>
<span class="udiff-line-added">+ import java.awt.Image;</span>
<span class="udiff-line-added">+ import java.awt.Point;</span>
<span class="udiff-line-added">+ import java.awt.Rectangle;</span>
<span class="udiff-line-added">+ import java.awt.SystemColor;</span>
<span class="udiff-line-added">+ import java.awt.Window;</span>
<span class="udiff-line-added">+ import java.awt.dnd.DropTarget;</span>
<span class="udiff-line-added">+ import java.awt.dnd.peer.DropTargetPeer;</span>
<span class="udiff-line-added">+ import java.awt.event.FocusEvent;</span>
<span class="udiff-line-added">+ import java.awt.event.InputEvent;</span>
  import java.awt.event.InvocationEvent;
  import java.awt.event.KeyEvent;
<span class="udiff-line-removed">- import java.awt.event.FocusEvent;</span>
  import java.awt.event.MouseEvent;
  import java.awt.event.MouseWheelEvent;
<span class="udiff-line-modified-removed">- import java.awt.event.InputEvent;</span>
<span class="udiff-line-modified-added">+ import java.awt.event.PaintEvent;</span>
<span class="udiff-line-added">+ import java.awt.geom.AffineTransform;</span>
<span class="udiff-line-added">+ import java.awt.image.BufferedImage;</span>
<span class="udiff-line-added">+ import java.awt.image.ColorModel;</span>
<span class="udiff-line-added">+ import java.awt.image.VolatileImage;</span>
<span class="udiff-line-added">+ import java.awt.peer.ComponentPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.ContainerPeer;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ import sun.awt.AWTAccessor;</span>
<span class="udiff-line-added">+ import sun.awt.PaintEventDispatcher;</span>
<span class="udiff-line-added">+ import sun.awt.RepaintArea;</span>
<span class="udiff-line-added">+ import sun.awt.SunToolkit;</span>
  import sun.awt.Win32GraphicsConfig;
  import sun.awt.Win32GraphicsEnvironment;
<span class="udiff-line-added">+ import sun.awt.event.IgnorePaintEvent;</span>
<span class="udiff-line-added">+ import sun.awt.image.SunVolatileImage;</span>
  import sun.java2d.InvalidPipeException;
<span class="udiff-line-removed">- import sun.java2d.SurfaceData;</span>
  import sun.java2d.ScreenUpdateManager;
<span class="udiff-line-added">+ import sun.java2d.SurfaceData;</span>
  import sun.java2d.d3d.D3DSurfaceData;
  import sun.java2d.opengl.OGLSurfaceData;
  import sun.java2d.pipe.Region;
<span class="udiff-line-removed">- import sun.awt.PaintEventDispatcher;</span>
<span class="udiff-line-removed">- import sun.awt.SunToolkit;</span>
<span class="udiff-line-removed">- import sun.awt.event.IgnorePaintEvent;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- import java.awt.dnd.DropTarget;</span>
<span class="udiff-line-removed">- import java.awt.dnd.peer.DropTargetPeer;</span>
<span class="udiff-line-removed">- import java.awt.geom.AffineTransform;</span>
<span class="udiff-line-removed">- import sun.awt.AWTAccessor;</span>
<span class="udiff-line-removed">- </span>
  import sun.util.logging.PlatformLogger;
  
  public abstract class WComponentPeer extends WObjectPeer
      implements ComponentPeer, DropTargetPeer
  {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -577,27 +590,29 @@</span>
          Component target = (Component)getTarget();
          Window window = SunToolkit.getContainingWindow(target);
          if (window != null) {
              final WWindowPeer wpeer = AWTAccessor.getComponentAccessor()
                                                   .getPeer(window);
<span class="udiff-line-modified-removed">-             Graphics g = wpeer.getTranslucentGraphics();</span>
<span class="udiff-line-modified-removed">-             // getTranslucentGraphics() returns non-null value for non-opaque windows only</span>
<span class="udiff-line-modified-removed">-             if (g != null) {</span>
<span class="udiff-line-modified-removed">-                 // Non-opaque windows do not support heavyweight children.</span>
<span class="udiff-line-modified-removed">-                 // Redirect all painting to the Window&#39;s Graphics instead.</span>
<span class="udiff-line-modified-removed">-                 // The caller is responsible for calling the</span>
<span class="udiff-line-modified-removed">-                 // WindowPeer.updateWindow() after painting has finished.</span>
<span class="udiff-line-modified-removed">-                 int x = 0, y = 0;</span>
<span class="udiff-line-modified-removed">-                 for (Component c = target; c != window; c = c.getParent()) {</span>
<span class="udiff-line-modified-removed">-                     x += c.getX();</span>
<span class="udiff-line-modified-removed">-                     y += c.getY();</span>
<span class="udiff-line-modified-removed">-                 }</span>
<span class="udiff-line-modified-added">+             if (wpeer != null) {</span>
<span class="udiff-line-modified-added">+                 Graphics g = wpeer.getTranslucentGraphics();</span>
<span class="udiff-line-modified-added">+                 // getTranslucentGraphics() returns non-null value for non-opaque windows only</span>
<span class="udiff-line-modified-added">+                 if (g != null) {</span>
<span class="udiff-line-modified-added">+                     // Non-opaque windows do not support heavyweight children.</span>
<span class="udiff-line-modified-added">+                     // Redirect all painting to the Window&#39;s Graphics instead.</span>
<span class="udiff-line-modified-added">+                     // The caller is responsible for calling the</span>
<span class="udiff-line-modified-added">+                     // WindowPeer.updateWindow() after painting has finished.</span>
<span class="udiff-line-modified-added">+                     int x = 0, y = 0;</span>
<span class="udiff-line-modified-added">+                     for (Component c = target; c != window; c = c.getParent()) {</span>
<span class="udiff-line-modified-added">+                         x += c.getX();</span>
<span class="udiff-line-modified-added">+                         y += c.getY();</span>
<span class="udiff-line-added">+                     }</span>
  
<span class="udiff-line-modified-removed">-                 g.translate(x, y);</span>
<span class="udiff-line-modified-removed">-                 g.clipRect(0, 0, target.getWidth(), target.getHeight());</span>
<span class="udiff-line-modified-added">+                     g.translate(x, y);</span>
<span class="udiff-line-modified-added">+                     g.clipRect(0, 0, target.getWidth(), target.getHeight());</span>
  
<span class="udiff-line-modified-removed">-                 return g;</span>
<span class="udiff-line-modified-added">+                     return g;</span>
<span class="udiff-line-added">+                 }</span>
              }
          }
  
          SurfaceData surfaceData = this.surfaceData;
          if (surfaceData != null) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -746,15 +761,10 @@</span>
          }
          WKeyboardFocusManagerPeer.removeLastFocusRequest((Component)target);
          return false;
      }
  
<span class="udiff-line-removed">-     @Override</span>
<span class="udiff-line-removed">-     public Image createImage(ImageProducer producer) {</span>
<span class="udiff-line-removed">-         return new ToolkitImage(producer);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
      @Override
      public Image createImage(int width, int height) {
          Win32GraphicsConfig gc =
              (Win32GraphicsConfig)getGraphicsConfiguration();
          return gc.createAcceleratedImage((Component)target, width, height);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -763,20 +773,10 @@</span>
      @Override
      public VolatileImage createVolatileImage(int width, int height) {
          return new SunVolatileImage((Component)target, width, height);
      }
  
<span class="udiff-line-removed">-     @Override</span>
<span class="udiff-line-removed">-     public boolean prepareImage(Image img, int w, int h, ImageObserver o) {</span>
<span class="udiff-line-removed">-         return Toolkit.getDefaultToolkit().prepareImage(img, w, h, o);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     @Override</span>
<span class="udiff-line-removed">-     public int checkImage(Image img, int w, int h, ImageObserver o) {</span>
<span class="udiff-line-removed">-         return Toolkit.getDefaultToolkit().checkImage(img, w, h, o);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
      // Object overrides
  
      public String toString() {
          return getClass().getName() + &quot;[&quot; + target + &quot;]&quot;;
      }
</pre>
<center><a href="WChoicePeer.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="WFramePeer.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>