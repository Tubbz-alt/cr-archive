<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/windows/classes/sun/awt/windows/WToolkit.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="WMenuPeer.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="awtLocalization.properties.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/windows/classes/sun/awt/windows/WToolkit.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1996, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package sun.awt.windows;
  27 
<span class="line-modified">  28 import java.awt.peer.TaskbarPeer;</span>
<span class="line-modified">  29 import java.awt.*;</span>
<span class="line-modified">  30 import java.awt.im.InputMethodHighlight;</span>
<span class="line-modified">  31 import java.awt.im.spi.InputMethodDescriptor;</span>
<span class="line-modified">  32 import java.awt.image.*;</span>
<span class="line-modified">  33 import java.awt.peer.*;</span>
















































  34 import java.awt.event.FocusEvent;
  35 import java.awt.event.KeyEvent;
  36 import java.awt.event.MouseEvent;
<span class="line-modified">  37 import java.awt.datatransfer.Clipboard;</span>
<span class="line-modified">  38 import java.awt.TextComponent;</span>
<span class="line-modified">  39 import java.awt.TrayIcon;</span>




























  40 import java.beans.PropertyChangeListener;
  41 import java.lang.ref.WeakReference;
  42 import java.security.AccessController;
  43 import java.security.PrivilegedAction;







  44 import javax.swing.text.JTextComponent;
  45 
  46 import sun.awt.AWTAccessor;
<span class="line-removed">  47 import sun.awt.AppContext;</span>
  48 import sun.awt.AWTAutoShutdown;
  49 import sun.awt.AWTPermissions;
  50 import sun.awt.AppContext;
  51 import sun.awt.DisplayChangedListener;
  52 import sun.awt.LightweightFrame;
  53 import sun.awt.SunToolkit;
<span class="line-removed">  54 import sun.awt.util.ThreadGroupUtils;</span>
  55 import sun.awt.Win32GraphicsDevice;
  56 import sun.awt.Win32GraphicsEnvironment;
  57 import sun.awt.datatransfer.DataTransferer;
<span class="line-removed">  58 import sun.java2d.d3d.D3DRenderQueue;</span>
<span class="line-removed">  59 import sun.java2d.opengl.OGLRenderQueue;</span>
<span class="line-removed">  60 </span>
<span class="line-removed">  61 import sun.print.PrintJob2D;</span>
<span class="line-removed">  62 </span>
<span class="line-removed">  63 import java.awt.dnd.DragSource;</span>
<span class="line-removed">  64 import java.awt.dnd.DragGestureListener;</span>
<span class="line-removed">  65 import java.awt.dnd.DragGestureEvent;</span>
<span class="line-removed">  66 import java.awt.dnd.DragGestureRecognizer;</span>
<span class="line-removed">  67 import java.awt.dnd.MouseDragGestureRecognizer;</span>
<span class="line-removed">  68 import java.awt.dnd.InvalidDnDOperationException;</span>
<span class="line-removed">  69 import java.awt.dnd.peer.DragSourceContextPeer;</span>
<span class="line-removed">  70 </span>
<span class="line-removed">  71 import java.util.Hashtable;</span>
<span class="line-removed">  72 import java.util.Locale;</span>
<span class="line-removed">  73 import java.util.Map;</span>
<span class="line-removed">  74 import java.util.Properties;</span>
<span class="line-removed">  75 import java.util.concurrent.ExecutorService;</span>
<span class="line-removed">  76 import java.util.concurrent.Executors;</span>
<span class="line-removed">  77 </span>
  78 import sun.awt.util.PerformanceLogger;

  79 import sun.font.FontManager;
  80 import sun.font.FontManagerFactory;
  81 import sun.font.SunFontManager;



  82 import sun.util.logging.PlatformLogger;
  83 
  84 public final class WToolkit extends SunToolkit implements Runnable {
  85 
  86     private static final PlatformLogger log = PlatformLogger.getLogger(&quot;sun.awt.windows.WToolkit&quot;);
  87 
  88     // Desktop property which specifies whether XP visual styles are in effect
  89     public static final String XPSTYLE_THEME_ACTIVE = &quot;win.xpstyle.themeActive&quot;;
  90 
  91     // System clipboard.
  92     WClipboard clipboard;
  93 
  94     // cache of font peers
  95     private Hashtable&lt;String,FontPeer&gt; cacheFontPeer;
  96 
  97     // Windows properties
  98     private WDesktopProperties  wprops;
  99 
 100     // Dynamic Layout Resize client code setting
 101     protected boolean dynamicLayoutSetting = false;
</pre>
<hr />
<pre>
 116                     @Override
 117                     public Void run() {
 118                         System.loadLibrary(&quot;awt&quot;);
 119                         return null;
 120                     }
 121                 });
 122             loaded = true;
 123         }
 124     }
 125 
 126     private static native String getWindowsVersion();
 127 
 128     static {
 129         loadLibraries();
 130         initIDs();
 131 
 132         // Print out which version of Windows is running
 133         if (log.isLoggable(PlatformLogger.Level.FINE)) {
 134             log.fine(&quot;Win version: &quot; + getWindowsVersion());
 135         }
<span class="line-removed"> 136 </span>
<span class="line-removed"> 137         AccessController.doPrivileged(</span>
<span class="line-removed"> 138             new PrivilegedAction &lt;Void&gt; ()</span>
<span class="line-removed"> 139         {</span>
<span class="line-removed"> 140             @Override</span>
<span class="line-removed"> 141             public Void run() {</span>
<span class="line-removed"> 142                 String browserProp = System.getProperty(&quot;browser&quot;);</span>
<span class="line-removed"> 143                 if (browserProp != null &amp;&amp; browserProp.equals(&quot;sun.plugin&quot;)) {</span>
<span class="line-removed"> 144                     disableCustomPalette();</span>
<span class="line-removed"> 145                 }</span>
<span class="line-removed"> 146                 return null;</span>
<span class="line-removed"> 147             }</span>
<span class="line-removed"> 148         });</span>
 149     }
 150 
<span class="line-removed"> 151     private static native void disableCustomPalette();</span>
<span class="line-removed"> 152 </span>
 153     /*
 154      * NOTE: The following embedded*() methods are non-public API intended
 155      * for internal use only.  The methods are unsupported and could go
 156      * away in future releases.
 157      *
 158      * New hook functions for using the AWT as an embedded service. These
 159      * functions replace the global C function AwtInit() which was previously
 160      * exported by awt.dll.
 161      *
 162      * When used as an embedded service, the AWT does NOT have its own
 163      * message pump. It instead relies on the parent application to provide
 164      * this functionality. embeddedInit() assumes that the thread on which it
 165      * is called is the message pumping thread. Violating this assumption
 166      * will lead to undefined behavior.
 167      *
 168      * embeddedInit must be called before the WToolkit() constructor.
 169      * embeddedDispose should be called before the applicaton terminates the
 170      * Java VM. It is currently unsafe to reinitialize the toolkit again
 171      * after it has been disposed. Instead, awt.dll must be reloaded and the
 172      * class loader which loaded WToolkit must be finalized before it is
</pre>
<hr />
<pre>
 228 
 229     public WToolkit() {
 230         // Startup toolkit threads
 231         if (PerformanceLogger.loggingEnabled()) {
 232             PerformanceLogger.setTime(&quot;WToolkit construction&quot;);
 233         }
 234 
 235         sun.java2d.Disposer.addRecord(anchor, new ToolkitDisposer());
 236 
 237         /*
 238          * Fix for 4701990.
 239          * AWTAutoShutdown state must be changed before the toolkit thread
 240          * starts to avoid race condition.
 241          */
 242         AWTAutoShutdown.notifyToolkitThreadBusy();
 243 
 244         // Find a root TG and attach toolkit thread to it
 245         ThreadGroup rootTG = AccessController.doPrivileged(
 246                 (PrivilegedAction&lt;ThreadGroup&gt;) ThreadGroupUtils::getRootThreadGroup);
 247         if (!startToolkitThread(this, rootTG)) {
<span class="line-modified"> 248             String name = &quot;AWT-Windows&quot;;</span>
<span class="line-modified"> 249             Thread toolkitThread = new Thread(rootTG, this, name, 0, false);</span>
<span class="line-modified"> 250             toolkitThread.setDaemon(true);</span>
<span class="line-modified"> 251             toolkitThread.start();</span>



 252         }
 253 
 254         try {
 255             synchronized(this) {
 256                 while(!inited) {
 257                     wait();
 258                 }
 259             }
 260         } catch (InterruptedException x) {
 261             // swallow the exception
 262         }
 263 
 264         // Enabled &quot;live resizing&quot; by default.  It remains controlled
 265         // by the native system though.
 266         setDynamicLayout(true);
<span class="line-modified"> 267 </span>
<span class="line-modified"> 268         areExtraMouseButtonsEnabled = Boolean.parseBoolean(System.getProperty(&quot;sun.awt.enableExtraMouseButtons&quot;, &quot;true&quot;));</span>
<span class="line-modified"> 269         //set system property if not yet assigned</span>
<span class="line-modified"> 270         System.setProperty(&quot;sun.awt.enableExtraMouseButtons&quot;, &quot;&quot;+areExtraMouseButtonsEnabled);</span>




 271         setExtraMouseButtonsEnabledNative(areExtraMouseButtonsEnabled);
 272     }
 273 
 274     private void registerShutdownHook() {
 275         AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {
 276             Thread shutdown = new Thread(
 277                     ThreadGroupUtils.getRootThreadGroup(), this::shutdown,
 278                     &quot;ToolkitShutdown&quot;, 0, false);
 279             shutdown.setContextClassLoader(null);
 280             Runtime.getRuntime().addShutdownHook(shutdown);
 281             return null;
 282         });
 283      }
 284 
 285     @Override
 286     public void run() {
 287         AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {
 288             Thread.currentThread().setContextClassLoader(null);
 289             Thread.currentThread().setPriority(Thread.NORM_PRIORITY + 1);
 290             return null;
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1996, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package sun.awt.windows;
  27 
<span class="line-modified">  28 import java.awt.AWTEvent;</span>
<span class="line-modified">  29 import java.awt.AWTException;</span>
<span class="line-modified">  30 import java.awt.Button;</span>
<span class="line-modified">  31 import java.awt.Canvas;</span>
<span class="line-modified">  32 import java.awt.Checkbox;</span>
<span class="line-modified">  33 import java.awt.CheckboxMenuItem;</span>
<span class="line-added">  34 import java.awt.Choice;</span>
<span class="line-added">  35 import java.awt.Component;</span>
<span class="line-added">  36 import java.awt.Cursor;</span>
<span class="line-added">  37 import java.awt.Desktop;</span>
<span class="line-added">  38 import java.awt.Dialog;</span>
<span class="line-added">  39 import java.awt.Dimension;</span>
<span class="line-added">  40 import java.awt.EventQueue;</span>
<span class="line-added">  41 import java.awt.FileDialog;</span>
<span class="line-added">  42 import java.awt.Font;</span>
<span class="line-added">  43 import java.awt.FontMetrics;</span>
<span class="line-added">  44 import java.awt.Frame;</span>
<span class="line-added">  45 import java.awt.GraphicsConfiguration;</span>
<span class="line-added">  46 import java.awt.GraphicsDevice;</span>
<span class="line-added">  47 import java.awt.GraphicsEnvironment;</span>
<span class="line-added">  48 import java.awt.HeadlessException;</span>
<span class="line-added">  49 import java.awt.Image;</span>
<span class="line-added">  50 import java.awt.Insets;</span>
<span class="line-added">  51 import java.awt.JobAttributes;</span>
<span class="line-added">  52 import java.awt.Label;</span>
<span class="line-added">  53 import java.awt.List;</span>
<span class="line-added">  54 import java.awt.Menu;</span>
<span class="line-added">  55 import java.awt.MenuBar;</span>
<span class="line-added">  56 import java.awt.MenuItem;</span>
<span class="line-added">  57 import java.awt.PageAttributes;</span>
<span class="line-added">  58 import java.awt.Panel;</span>
<span class="line-added">  59 import java.awt.Point;</span>
<span class="line-added">  60 import java.awt.PopupMenu;</span>
<span class="line-added">  61 import java.awt.PrintJob;</span>
<span class="line-added">  62 import java.awt.RenderingHints;</span>
<span class="line-added">  63 import java.awt.Robot;</span>
<span class="line-added">  64 import java.awt.ScrollPane;</span>
<span class="line-added">  65 import java.awt.Scrollbar;</span>
<span class="line-added">  66 import java.awt.SystemTray;</span>
<span class="line-added">  67 import java.awt.Taskbar;</span>
<span class="line-added">  68 import java.awt.TextArea;</span>
<span class="line-added">  69 import java.awt.TextComponent;</span>
<span class="line-added">  70 import java.awt.TextField;</span>
<span class="line-added">  71 import java.awt.Toolkit;</span>
<span class="line-added">  72 import java.awt.TrayIcon;</span>
<span class="line-added">  73 import java.awt.Window;</span>
<span class="line-added">  74 import java.awt.datatransfer.Clipboard;</span>
<span class="line-added">  75 import java.awt.dnd.DragGestureEvent;</span>
<span class="line-added">  76 import java.awt.dnd.DragGestureListener;</span>
<span class="line-added">  77 import java.awt.dnd.DragGestureRecognizer;</span>
<span class="line-added">  78 import java.awt.dnd.DragSource;</span>
<span class="line-added">  79 import java.awt.dnd.InvalidDnDOperationException;</span>
<span class="line-added">  80 import java.awt.dnd.MouseDragGestureRecognizer;</span>
<span class="line-added">  81 import java.awt.dnd.peer.DragSourceContextPeer;</span>
  82 import java.awt.event.FocusEvent;
  83 import java.awt.event.KeyEvent;
  84 import java.awt.event.MouseEvent;
<span class="line-modified">  85 import java.awt.im.InputMethodHighlight;</span>
<span class="line-modified">  86 import java.awt.im.spi.InputMethodDescriptor;</span>
<span class="line-modified">  87 import java.awt.image.ColorModel;</span>
<span class="line-added">  88 import java.awt.peer.ButtonPeer;</span>
<span class="line-added">  89 import java.awt.peer.CanvasPeer;</span>
<span class="line-added">  90 import java.awt.peer.CheckboxMenuItemPeer;</span>
<span class="line-added">  91 import java.awt.peer.CheckboxPeer;</span>
<span class="line-added">  92 import java.awt.peer.ChoicePeer;</span>
<span class="line-added">  93 import java.awt.peer.DesktopPeer;</span>
<span class="line-added">  94 import java.awt.peer.DialogPeer;</span>
<span class="line-added">  95 import java.awt.peer.FileDialogPeer;</span>
<span class="line-added">  96 import java.awt.peer.FontPeer;</span>
<span class="line-added">  97 import java.awt.peer.FramePeer;</span>
<span class="line-added">  98 import java.awt.peer.KeyboardFocusManagerPeer;</span>
<span class="line-added">  99 import java.awt.peer.LabelPeer;</span>
<span class="line-added"> 100 import java.awt.peer.ListPeer;</span>
<span class="line-added"> 101 import java.awt.peer.MenuBarPeer;</span>
<span class="line-added"> 102 import java.awt.peer.MenuItemPeer;</span>
<span class="line-added"> 103 import java.awt.peer.MenuPeer;</span>
<span class="line-added"> 104 import java.awt.peer.MouseInfoPeer;</span>
<span class="line-added"> 105 import java.awt.peer.PanelPeer;</span>
<span class="line-added"> 106 import java.awt.peer.PopupMenuPeer;</span>
<span class="line-added"> 107 import java.awt.peer.RobotPeer;</span>
<span class="line-added"> 108 import java.awt.peer.ScrollPanePeer;</span>
<span class="line-added"> 109 import java.awt.peer.ScrollbarPeer;</span>
<span class="line-added"> 110 import java.awt.peer.SystemTrayPeer;</span>
<span class="line-added"> 111 import java.awt.peer.TaskbarPeer;</span>
<span class="line-added"> 112 import java.awt.peer.TextAreaPeer;</span>
<span class="line-added"> 113 import java.awt.peer.TextFieldPeer;</span>
<span class="line-added"> 114 import java.awt.peer.TrayIconPeer;</span>
<span class="line-added"> 115 import java.awt.peer.WindowPeer;</span>
 116 import java.beans.PropertyChangeListener;
 117 import java.lang.ref.WeakReference;
 118 import java.security.AccessController;
 119 import java.security.PrivilegedAction;
<span class="line-added"> 120 import java.util.Hashtable;</span>
<span class="line-added"> 121 import java.util.Locale;</span>
<span class="line-added"> 122 import java.util.Map;</span>
<span class="line-added"> 123 import java.util.Properties;</span>
<span class="line-added"> 124 import java.util.concurrent.ExecutorService;</span>
<span class="line-added"> 125 import java.util.concurrent.Executors;</span>
<span class="line-added"> 126 </span>
 127 import javax.swing.text.JTextComponent;
 128 
 129 import sun.awt.AWTAccessor;

 130 import sun.awt.AWTAutoShutdown;
 131 import sun.awt.AWTPermissions;
 132 import sun.awt.AppContext;
 133 import sun.awt.DisplayChangedListener;
 134 import sun.awt.LightweightFrame;
 135 import sun.awt.SunToolkit;

 136 import sun.awt.Win32GraphicsDevice;
 137 import sun.awt.Win32GraphicsEnvironment;
 138 import sun.awt.datatransfer.DataTransferer;




















 139 import sun.awt.util.PerformanceLogger;
<span class="line-added"> 140 import sun.awt.util.ThreadGroupUtils;</span>
 141 import sun.font.FontManager;
 142 import sun.font.FontManagerFactory;
 143 import sun.font.SunFontManager;
<span class="line-added"> 144 import sun.java2d.d3d.D3DRenderQueue;</span>
<span class="line-added"> 145 import sun.java2d.opengl.OGLRenderQueue;</span>
<span class="line-added"> 146 import sun.print.PrintJob2D;</span>
 147 import sun.util.logging.PlatformLogger;
 148 
 149 public final class WToolkit extends SunToolkit implements Runnable {
 150 
 151     private static final PlatformLogger log = PlatformLogger.getLogger(&quot;sun.awt.windows.WToolkit&quot;);
 152 
 153     // Desktop property which specifies whether XP visual styles are in effect
 154     public static final String XPSTYLE_THEME_ACTIVE = &quot;win.xpstyle.themeActive&quot;;
 155 
 156     // System clipboard.
 157     WClipboard clipboard;
 158 
 159     // cache of font peers
 160     private Hashtable&lt;String,FontPeer&gt; cacheFontPeer;
 161 
 162     // Windows properties
 163     private WDesktopProperties  wprops;
 164 
 165     // Dynamic Layout Resize client code setting
 166     protected boolean dynamicLayoutSetting = false;
</pre>
<hr />
<pre>
 181                     @Override
 182                     public Void run() {
 183                         System.loadLibrary(&quot;awt&quot;);
 184                         return null;
 185                     }
 186                 });
 187             loaded = true;
 188         }
 189     }
 190 
 191     private static native String getWindowsVersion();
 192 
 193     static {
 194         loadLibraries();
 195         initIDs();
 196 
 197         // Print out which version of Windows is running
 198         if (log.isLoggable(PlatformLogger.Level.FINE)) {
 199             log.fine(&quot;Win version: &quot; + getWindowsVersion());
 200         }













 201     }
 202 


 203     /*
 204      * NOTE: The following embedded*() methods are non-public API intended
 205      * for internal use only.  The methods are unsupported and could go
 206      * away in future releases.
 207      *
 208      * New hook functions for using the AWT as an embedded service. These
 209      * functions replace the global C function AwtInit() which was previously
 210      * exported by awt.dll.
 211      *
 212      * When used as an embedded service, the AWT does NOT have its own
 213      * message pump. It instead relies on the parent application to provide
 214      * this functionality. embeddedInit() assumes that the thread on which it
 215      * is called is the message pumping thread. Violating this assumption
 216      * will lead to undefined behavior.
 217      *
 218      * embeddedInit must be called before the WToolkit() constructor.
 219      * embeddedDispose should be called before the applicaton terminates the
 220      * Java VM. It is currently unsafe to reinitialize the toolkit again
 221      * after it has been disposed. Instead, awt.dll must be reloaded and the
 222      * class loader which loaded WToolkit must be finalized before it is
</pre>
<hr />
<pre>
 278 
 279     public WToolkit() {
 280         // Startup toolkit threads
 281         if (PerformanceLogger.loggingEnabled()) {
 282             PerformanceLogger.setTime(&quot;WToolkit construction&quot;);
 283         }
 284 
 285         sun.java2d.Disposer.addRecord(anchor, new ToolkitDisposer());
 286 
 287         /*
 288          * Fix for 4701990.
 289          * AWTAutoShutdown state must be changed before the toolkit thread
 290          * starts to avoid race condition.
 291          */
 292         AWTAutoShutdown.notifyToolkitThreadBusy();
 293 
 294         // Find a root TG and attach toolkit thread to it
 295         ThreadGroup rootTG = AccessController.doPrivileged(
 296                 (PrivilegedAction&lt;ThreadGroup&gt;) ThreadGroupUtils::getRootThreadGroup);
 297         if (!startToolkitThread(this, rootTG)) {
<span class="line-modified"> 298             final String name = &quot;AWT-Windows&quot;;</span>
<span class="line-modified"> 299             AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {</span>
<span class="line-modified"> 300                 Thread toolkitThread = new Thread(rootTG, this, name, 0, false);</span>
<span class="line-modified"> 301                 toolkitThread.setDaemon(true);</span>
<span class="line-added"> 302                 toolkitThread.start();</span>
<span class="line-added"> 303                 return null;</span>
<span class="line-added"> 304             });</span>
 305         }
 306 
 307         try {
 308             synchronized(this) {
 309                 while(!inited) {
 310                     wait();
 311                 }
 312             }
 313         } catch (InterruptedException x) {
 314             // swallow the exception
 315         }
 316 
 317         // Enabled &quot;live resizing&quot; by default.  It remains controlled
 318         // by the native system though.
 319         setDynamicLayout(true);
<span class="line-modified"> 320         final String extraButtons = &quot;sun.awt.enableExtraMouseButtons&quot;;</span>
<span class="line-modified"> 321         AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {</span>
<span class="line-modified"> 322             areExtraMouseButtonsEnabled =</span>
<span class="line-modified"> 323                  Boolean.parseBoolean(System.getProperty(extraButtons, &quot;true&quot;));</span>
<span class="line-added"> 324             //set system property if not yet assigned</span>
<span class="line-added"> 325             System.setProperty(extraButtons, &quot;&quot;+areExtraMouseButtonsEnabled);</span>
<span class="line-added"> 326             return null;</span>
<span class="line-added"> 327         });</span>
 328         setExtraMouseButtonsEnabledNative(areExtraMouseButtonsEnabled);
 329     }
 330 
 331     private void registerShutdownHook() {
 332         AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {
 333             Thread shutdown = new Thread(
 334                     ThreadGroupUtils.getRootThreadGroup(), this::shutdown,
 335                     &quot;ToolkitShutdown&quot;, 0, false);
 336             shutdown.setContextClassLoader(null);
 337             Runtime.getRuntime().addShutdownHook(shutdown);
 338             return null;
 339         });
 340      }
 341 
 342     @Override
 343     public void run() {
 344         AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {
 345             Thread.currentThread().setContextClassLoader(null);
 346             Thread.currentThread().setPriority(Thread.NORM_PRIORITY + 1);
 347             return null;
</pre>
</td>
</tr>
</table>
<center><a href="WMenuPeer.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="awtLocalization.properties.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>