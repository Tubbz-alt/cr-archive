<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/windows/classes/sun/awt/shell/Win32ShellFolderManager2.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../com/sun/java/swing/plaf/windows/resources/windows_zh_TW.properties.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../windows/WChoicePeer.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/windows/classes/sun/awt/shell/Win32ShellFolderManager2.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 23,27 ***</span>
   * questions.
   */
  
  package sun.awt.shell;
  
<span class="line-modified">! import java.awt.*;</span>
  import java.awt.image.BufferedImage;
<span class="line-removed">- import java.awt.image.BaseMultiResolutionImage;</span>
<span class="line-removed">- </span>
  import java.io.File;
  import java.io.FileNotFoundException;
  import java.io.IOException;
  import java.security.AccessController;
  import java.security.PrivilegedAction;
<span class="line-modified">! import java.util.*;</span>
  import java.util.List;
<span class="line-modified">! import java.util.concurrent.*;</span>
  import java.util.stream.Stream;
  
<span class="line-removed">- import static sun.awt.shell.Win32ShellFolder2.*;</span>
  import sun.awt.OSInfo;
  import sun.awt.util.ThreadGroupUtils;
  // NOTE: This class supersedes Win32ShellFolderManager, which was removed
  //       from distribution after version 1.4.2.
  
  /**
   * @author Michael Martak
<span class="line-new-header">--- 23,42 ---</span>
   * questions.
   */
  
  package sun.awt.shell;
  
<span class="line-modified">! import java.awt.Image;</span>
<span class="line-added">+ import java.awt.Toolkit;</span>
  import java.awt.image.BufferedImage;
  import java.io.File;
  import java.io.FileNotFoundException;
  import java.io.IOException;
  import java.security.AccessController;
  import java.security.PrivilegedAction;
<span class="line-modified">! import java.util.ArrayList;</span>
<span class="line-added">+ import java.util.Arrays;</span>
  import java.util.List;
<span class="line-modified">! import java.util.concurrent.Callable;</span>
<span class="line-added">+ import java.util.concurrent.ExecutionException;</span>
<span class="line-added">+ import java.util.concurrent.Future;</span>
<span class="line-added">+ import java.util.concurrent.LinkedBlockingQueue;</span>
<span class="line-added">+ import java.util.concurrent.RejectedExecutionException;</span>
<span class="line-added">+ import java.util.concurrent.ThreadFactory;</span>
<span class="line-added">+ import java.util.concurrent.ThreadPoolExecutor;</span>
<span class="line-added">+ import java.util.concurrent.TimeUnit;</span>
  import java.util.stream.Stream;
  
  import sun.awt.OSInfo;
  import sun.awt.util.ThreadGroupUtils;
<span class="line-added">+ import sun.util.logging.PlatformLogger;</span>
<span class="line-added">+ </span>
<span class="line-added">+ import static sun.awt.shell.Win32ShellFolder2.DESKTOP;</span>
<span class="line-added">+ import static sun.awt.shell.Win32ShellFolder2.DRIVES;</span>
<span class="line-added">+ import static sun.awt.shell.Win32ShellFolder2.Invoker;</span>
<span class="line-added">+ import static sun.awt.shell.Win32ShellFolder2.MultiResolutionIconImage;</span>
<span class="line-added">+ import static sun.awt.shell.Win32ShellFolder2.NETWORK;</span>
<span class="line-added">+ import static sun.awt.shell.Win32ShellFolder2.PERSONAL;</span>
<span class="line-added">+ import static sun.awt.shell.Win32ShellFolder2.RECENT;</span>
  // NOTE: This class supersedes Win32ShellFolderManager, which was removed
  //       from distribution after version 1.4.2.
  
  /**
   * @author Michael Martak
</pre>
<hr />
<pre>
<span class="line-old-header">*** 52,10 ***</span>
<span class="line-new-header">--- 67,13 ---</span>
   * @since 1.4
   */
  
  final class Win32ShellFolderManager2 extends ShellFolderManager {
  
<span class="line-added">+     private static final PlatformLogger</span>
<span class="line-added">+             log = PlatformLogger.getLogger(&quot;sun.awt.shell.Win32ShellFolderManager2&quot;);</span>
<span class="line-added">+ </span>
      static {
          // Load library here
          sun.awt.windows.WToolkit.loadLibraries();
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 143,31 ***</span>
  
      static Win32ShellFolder2 getDesktop() {
          if (desktop == null) {
              try {
                  desktop = new Win32ShellFolder2(DESKTOP);
<span class="line-modified">!             } catch (SecurityException e) {</span>
<span class="line-modified">!                 // Ignore error</span>
<span class="line-modified">!             } catch (IOException e) {</span>
<span class="line-modified">!                 // Ignore error</span>
<span class="line-modified">!             } catch (InterruptedException e) {</span>
<span class="line-modified">!                 // Ignore error</span>
              }
          }
          return desktop;
      }
  
      static Win32ShellFolder2 getDrives() {
          if (drives == null) {
              try {
                  drives = new Win32ShellFolder2(DRIVES);
<span class="line-modified">!             } catch (SecurityException e) {</span>
<span class="line-modified">!                 // Ignore error</span>
<span class="line-modified">!             } catch (IOException e) {</span>
<span class="line-modified">!                 // Ignore error</span>
<span class="line-modified">!             } catch (InterruptedException e) {</span>
<span class="line-modified">!                 // Ignore error</span>
              }
          }
          return drives;
      }
  
<span class="line-new-header">--- 161,33 ---</span>
  
      static Win32ShellFolder2 getDesktop() {
          if (desktop == null) {
              try {
                  desktop = new Win32ShellFolder2(DESKTOP);
<span class="line-modified">!             } catch (final SecurityException ignored) {</span>
<span class="line-modified">!                 // Ignore, the message may have sensitive information, not</span>
<span class="line-modified">!                 // accessible other ways</span>
<span class="line-modified">!             } catch (IOException | InterruptedException e) {</span>
<span class="line-modified">!                 if (log.isLoggable(PlatformLogger.Level.WARNING)) {</span>
<span class="line-modified">!                     log.warning(&quot;Cannot access &#39;Desktop&#39;&quot;, e);</span>
<span class="line-added">+                 }</span>
              }
          }
          return desktop;
      }
  
      static Win32ShellFolder2 getDrives() {
          if (drives == null) {
              try {
                  drives = new Win32ShellFolder2(DRIVES);
<span class="line-modified">!             } catch (final SecurityException ignored) {</span>
<span class="line-modified">!                 // Ignore, the message may have sensitive information, not</span>
<span class="line-modified">!                 // accessible other ways</span>
<span class="line-modified">!             } catch (IOException | InterruptedException e) {</span>
<span class="line-modified">!                 if (log.isLoggable(PlatformLogger.Level.WARNING)) {</span>
<span class="line-modified">!                     log.warning(&quot;Cannot access &#39;Drives&#39;&quot;, e);</span>
<span class="line-added">+                 }</span>
              }
          }
          return drives;
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 176,31 ***</span>
              try {
                  String path = Win32ShellFolder2.getFileSystemPath(RECENT);
                  if (path != null) {
                      recent = createShellFolder(getDesktop(), new File(path));
                  }
<span class="line-modified">!             } catch (SecurityException e) {</span>
<span class="line-modified">!                 // Ignore error</span>
<span class="line-modified">!             } catch (InterruptedException e) {</span>
<span class="line-modified">!                 // Ignore error</span>
<span class="line-modified">!             } catch (IOException e) {</span>
<span class="line-modified">!                 // Ignore error</span>
              }
          }
          return recent;
      }
  
      static Win32ShellFolder2 getNetwork() {
          if (network == null) {
              try {
                  network = new Win32ShellFolder2(NETWORK);
<span class="line-modified">!             } catch (SecurityException e) {</span>
<span class="line-modified">!                 // Ignore error</span>
<span class="line-modified">!             } catch (IOException e) {</span>
<span class="line-modified">!                 // Ignore error</span>
<span class="line-modified">!             } catch (InterruptedException e) {</span>
<span class="line-modified">!                 // Ignore error</span>
              }
          }
          return network;
      }
  
<span class="line-new-header">--- 196,33 ---</span>
              try {
                  String path = Win32ShellFolder2.getFileSystemPath(RECENT);
                  if (path != null) {
                      recent = createShellFolder(getDesktop(), new File(path));
                  }
<span class="line-modified">!             } catch (final SecurityException ignored) {</span>
<span class="line-modified">!                 // Ignore, the message may have sensitive information, not</span>
<span class="line-modified">!                 // accessible other ways</span>
<span class="line-modified">!             } catch (InterruptedException | IOException e) {</span>
<span class="line-modified">!                 if (log.isLoggable(PlatformLogger.Level.WARNING)) {</span>
<span class="line-modified">!                     log.warning(&quot;Cannot access &#39;Recent&#39;&quot;, e);</span>
<span class="line-added">+                 }</span>
              }
          }
          return recent;
      }
  
      static Win32ShellFolder2 getNetwork() {
          if (network == null) {
              try {
                  network = new Win32ShellFolder2(NETWORK);
<span class="line-modified">!             } catch (final SecurityException ignored) {</span>
<span class="line-modified">!                 // Ignore, the message may have sensitive information, not</span>
<span class="line-modified">!                 // accessible other ways</span>
<span class="line-modified">!             } catch (IOException | InterruptedException e) {</span>
<span class="line-modified">!                 if (log.isLoggable(PlatformLogger.Level.WARNING)) {</span>
<span class="line-modified">!                     log.warning(&quot;Cannot access &#39;Network&#39;&quot;, e);</span>
<span class="line-added">+                 }</span>
              }
          }
          return network;
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 216,16 ***</span>
                      }
                      if (personal != null) {
                          personal.setIsPersonal();
                      }
                  }
<span class="line-modified">!             } catch (SecurityException e) {</span>
<span class="line-modified">!                 // Ignore error</span>
<span class="line-modified">!             } catch (InterruptedException e) {</span>
<span class="line-modified">!                 // Ignore error</span>
<span class="line-modified">!             } catch (IOException e) {</span>
<span class="line-modified">!                 // Ignore error</span>
              }
          }
          return personal;
      }
  
<span class="line-new-header">--- 238,17 ---</span>
                      }
                      if (personal != null) {
                          personal.setIsPersonal();
                      }
                  }
<span class="line-modified">!             } catch (final SecurityException ignored) {</span>
<span class="line-modified">!                 // Ignore, the message may have sensitive information, not</span>
<span class="line-modified">!                 // accessible other ways</span>
<span class="line-modified">!             } catch (InterruptedException | IOException e) {</span>
<span class="line-modified">!                 if (log.isLoggable(PlatformLogger.Level.WARNING)) {</span>
<span class="line-modified">!                     log.warning(&quot;Cannot access &#39;Personal&#39;&quot;, e);</span>
<span class="line-added">+                 }</span>
              }
          }
          return personal;
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 322,12 ***</span>
<span class="line-new-header">--- 345,18 ---</span>
                      } else if (value instanceof String) {
                          // A path
                          folders.add(createShellFolder(new File((String)value)));
                      }
                  } catch (IOException e) {
<span class="line-added">+                     if (log.isLoggable(PlatformLogger.Level.WARNING)) {</span>
<span class="line-added">+                         log.warning(&quot;Cannot read value = &quot; + value, e);</span>
<span class="line-added">+                     }</span>
                      // Skip this value
                  } catch (InterruptedException e) {
<span class="line-added">+                     if (log.isLoggable(PlatformLogger.Level.WARNING)) {</span>
<span class="line-added">+                         log.warning(&quot;Cannot read value = &quot; + value, e);</span>
<span class="line-added">+                     }</span>
                      // Return empty result
                      return new File[0];
                  }
              } while (value != null);
  
</pre>
<center><a href="../../../com/sun/java/swing/plaf/windows/resources/windows_zh_TW.properties.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../windows/WChoicePeer.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>