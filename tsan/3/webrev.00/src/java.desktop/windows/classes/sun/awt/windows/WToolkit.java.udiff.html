<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/windows/classes/sun/awt/windows/WToolkit.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="WMenuPeer.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="awtLocalization.properties.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/windows/classes/sun/awt/windows/WToolkit.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 1996, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 1996, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -23,64 +23,129 @@</span>
   * questions.
   */
  
  package sun.awt.windows;
  
<span class="udiff-line-modified-removed">- import java.awt.peer.TaskbarPeer;</span>
<span class="udiff-line-modified-removed">- import java.awt.*;</span>
<span class="udiff-line-modified-removed">- import java.awt.im.InputMethodHighlight;</span>
<span class="udiff-line-modified-removed">- import java.awt.im.spi.InputMethodDescriptor;</span>
<span class="udiff-line-modified-removed">- import java.awt.image.*;</span>
<span class="udiff-line-modified-removed">- import java.awt.peer.*;</span>
<span class="udiff-line-modified-added">+ import java.awt.AWTEvent;</span>
<span class="udiff-line-modified-added">+ import java.awt.AWTException;</span>
<span class="udiff-line-modified-added">+ import java.awt.Button;</span>
<span class="udiff-line-modified-added">+ import java.awt.Canvas;</span>
<span class="udiff-line-modified-added">+ import java.awt.Checkbox;</span>
<span class="udiff-line-modified-added">+ import java.awt.CheckboxMenuItem;</span>
<span class="udiff-line-added">+ import java.awt.Choice;</span>
<span class="udiff-line-added">+ import java.awt.Component;</span>
<span class="udiff-line-added">+ import java.awt.Cursor;</span>
<span class="udiff-line-added">+ import java.awt.Desktop;</span>
<span class="udiff-line-added">+ import java.awt.Dialog;</span>
<span class="udiff-line-added">+ import java.awt.Dimension;</span>
<span class="udiff-line-added">+ import java.awt.EventQueue;</span>
<span class="udiff-line-added">+ import java.awt.FileDialog;</span>
<span class="udiff-line-added">+ import java.awt.Font;</span>
<span class="udiff-line-added">+ import java.awt.FontMetrics;</span>
<span class="udiff-line-added">+ import java.awt.Frame;</span>
<span class="udiff-line-added">+ import java.awt.GraphicsConfiguration;</span>
<span class="udiff-line-added">+ import java.awt.GraphicsDevice;</span>
<span class="udiff-line-added">+ import java.awt.GraphicsEnvironment;</span>
<span class="udiff-line-added">+ import java.awt.HeadlessException;</span>
<span class="udiff-line-added">+ import java.awt.Image;</span>
<span class="udiff-line-added">+ import java.awt.Insets;</span>
<span class="udiff-line-added">+ import java.awt.JobAttributes;</span>
<span class="udiff-line-added">+ import java.awt.Label;</span>
<span class="udiff-line-added">+ import java.awt.List;</span>
<span class="udiff-line-added">+ import java.awt.Menu;</span>
<span class="udiff-line-added">+ import java.awt.MenuBar;</span>
<span class="udiff-line-added">+ import java.awt.MenuItem;</span>
<span class="udiff-line-added">+ import java.awt.PageAttributes;</span>
<span class="udiff-line-added">+ import java.awt.Panel;</span>
<span class="udiff-line-added">+ import java.awt.Point;</span>
<span class="udiff-line-added">+ import java.awt.PopupMenu;</span>
<span class="udiff-line-added">+ import java.awt.PrintJob;</span>
<span class="udiff-line-added">+ import java.awt.RenderingHints;</span>
<span class="udiff-line-added">+ import java.awt.Robot;</span>
<span class="udiff-line-added">+ import java.awt.ScrollPane;</span>
<span class="udiff-line-added">+ import java.awt.Scrollbar;</span>
<span class="udiff-line-added">+ import java.awt.SystemTray;</span>
<span class="udiff-line-added">+ import java.awt.Taskbar;</span>
<span class="udiff-line-added">+ import java.awt.TextArea;</span>
<span class="udiff-line-added">+ import java.awt.TextComponent;</span>
<span class="udiff-line-added">+ import java.awt.TextField;</span>
<span class="udiff-line-added">+ import java.awt.Toolkit;</span>
<span class="udiff-line-added">+ import java.awt.TrayIcon;</span>
<span class="udiff-line-added">+ import java.awt.Window;</span>
<span class="udiff-line-added">+ import java.awt.datatransfer.Clipboard;</span>
<span class="udiff-line-added">+ import java.awt.dnd.DragGestureEvent;</span>
<span class="udiff-line-added">+ import java.awt.dnd.DragGestureListener;</span>
<span class="udiff-line-added">+ import java.awt.dnd.DragGestureRecognizer;</span>
<span class="udiff-line-added">+ import java.awt.dnd.DragSource;</span>
<span class="udiff-line-added">+ import java.awt.dnd.InvalidDnDOperationException;</span>
<span class="udiff-line-added">+ import java.awt.dnd.MouseDragGestureRecognizer;</span>
<span class="udiff-line-added">+ import java.awt.dnd.peer.DragSourceContextPeer;</span>
  import java.awt.event.FocusEvent;
  import java.awt.event.KeyEvent;
  import java.awt.event.MouseEvent;
<span class="udiff-line-modified-removed">- import java.awt.datatransfer.Clipboard;</span>
<span class="udiff-line-modified-removed">- import java.awt.TextComponent;</span>
<span class="udiff-line-modified-removed">- import java.awt.TrayIcon;</span>
<span class="udiff-line-modified-added">+ import java.awt.im.InputMethodHighlight;</span>
<span class="udiff-line-modified-added">+ import java.awt.im.spi.InputMethodDescriptor;</span>
<span class="udiff-line-modified-added">+ import java.awt.image.ColorModel;</span>
<span class="udiff-line-added">+ import java.awt.peer.ButtonPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.CanvasPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.CheckboxMenuItemPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.CheckboxPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.ChoicePeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.DesktopPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.DialogPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.FileDialogPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.FontPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.FramePeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.KeyboardFocusManagerPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.LabelPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.ListPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.MenuBarPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.MenuItemPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.MenuPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.MouseInfoPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.PanelPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.PopupMenuPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.RobotPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.ScrollPanePeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.ScrollbarPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.SystemTrayPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.TaskbarPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.TextAreaPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.TextFieldPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.TrayIconPeer;</span>
<span class="udiff-line-added">+ import java.awt.peer.WindowPeer;</span>
  import java.beans.PropertyChangeListener;
  import java.lang.ref.WeakReference;
  import java.security.AccessController;
  import java.security.PrivilegedAction;
<span class="udiff-line-added">+ import java.util.Hashtable;</span>
<span class="udiff-line-added">+ import java.util.Locale;</span>
<span class="udiff-line-added">+ import java.util.Map;</span>
<span class="udiff-line-added">+ import java.util.Properties;</span>
<span class="udiff-line-added">+ import java.util.concurrent.ExecutorService;</span>
<span class="udiff-line-added">+ import java.util.concurrent.Executors;</span>
<span class="udiff-line-added">+ </span>
  import javax.swing.text.JTextComponent;
  
  import sun.awt.AWTAccessor;
<span class="udiff-line-removed">- import sun.awt.AppContext;</span>
  import sun.awt.AWTAutoShutdown;
  import sun.awt.AWTPermissions;
  import sun.awt.AppContext;
  import sun.awt.DisplayChangedListener;
  import sun.awt.LightweightFrame;
  import sun.awt.SunToolkit;
<span class="udiff-line-removed">- import sun.awt.util.ThreadGroupUtils;</span>
  import sun.awt.Win32GraphicsDevice;
  import sun.awt.Win32GraphicsEnvironment;
  import sun.awt.datatransfer.DataTransferer;
<span class="udiff-line-removed">- import sun.java2d.d3d.D3DRenderQueue;</span>
<span class="udiff-line-removed">- import sun.java2d.opengl.OGLRenderQueue;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- import sun.print.PrintJob2D;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- import java.awt.dnd.DragSource;</span>
<span class="udiff-line-removed">- import java.awt.dnd.DragGestureListener;</span>
<span class="udiff-line-removed">- import java.awt.dnd.DragGestureEvent;</span>
<span class="udiff-line-removed">- import java.awt.dnd.DragGestureRecognizer;</span>
<span class="udiff-line-removed">- import java.awt.dnd.MouseDragGestureRecognizer;</span>
<span class="udiff-line-removed">- import java.awt.dnd.InvalidDnDOperationException;</span>
<span class="udiff-line-removed">- import java.awt.dnd.peer.DragSourceContextPeer;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- import java.util.Hashtable;</span>
<span class="udiff-line-removed">- import java.util.Locale;</span>
<span class="udiff-line-removed">- import java.util.Map;</span>
<span class="udiff-line-removed">- import java.util.Properties;</span>
<span class="udiff-line-removed">- import java.util.concurrent.ExecutorService;</span>
<span class="udiff-line-removed">- import java.util.concurrent.Executors;</span>
<span class="udiff-line-removed">- </span>
  import sun.awt.util.PerformanceLogger;
<span class="udiff-line-added">+ import sun.awt.util.ThreadGroupUtils;</span>
  import sun.font.FontManager;
  import sun.font.FontManagerFactory;
  import sun.font.SunFontManager;
<span class="udiff-line-added">+ import sun.java2d.d3d.D3DRenderQueue;</span>
<span class="udiff-line-added">+ import sun.java2d.opengl.OGLRenderQueue;</span>
<span class="udiff-line-added">+ import sun.print.PrintJob2D;</span>
  import sun.util.logging.PlatformLogger;
  
  public final class WToolkit extends SunToolkit implements Runnable {
  
      private static final PlatformLogger log = PlatformLogger.getLogger(&quot;sun.awt.windows.WToolkit&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -131,27 +196,12 @@</span>
  
          // Print out which version of Windows is running
          if (log.isLoggable(PlatformLogger.Level.FINE)) {
              log.fine(&quot;Win version: &quot; + getWindowsVersion());
          }
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         AccessController.doPrivileged(</span>
<span class="udiff-line-removed">-             new PrivilegedAction &lt;Void&gt; ()</span>
<span class="udiff-line-removed">-         {</span>
<span class="udiff-line-removed">-             @Override</span>
<span class="udiff-line-removed">-             public Void run() {</span>
<span class="udiff-line-removed">-                 String browserProp = System.getProperty(&quot;browser&quot;);</span>
<span class="udiff-line-removed">-                 if (browserProp != null &amp;&amp; browserProp.equals(&quot;sun.plugin&quot;)) {</span>
<span class="udiff-line-removed">-                     disableCustomPalette();</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-                 return null;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         });</span>
      }
  
<span class="udiff-line-removed">-     private static native void disableCustomPalette();</span>
<span class="udiff-line-removed">- </span>
      /*
       * NOTE: The following embedded*() methods are non-public API intended
       * for internal use only.  The methods are unsupported and could go
       * away in future releases.
       *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -243,14 +293,17 @@</span>
  
          // Find a root TG and attach toolkit thread to it
          ThreadGroup rootTG = AccessController.doPrivileged(
                  (PrivilegedAction&lt;ThreadGroup&gt;) ThreadGroupUtils::getRootThreadGroup);
          if (!startToolkitThread(this, rootTG)) {
<span class="udiff-line-modified-removed">-             String name = &quot;AWT-Windows&quot;;</span>
<span class="udiff-line-modified-removed">-             Thread toolkitThread = new Thread(rootTG, this, name, 0, false);</span>
<span class="udiff-line-modified-removed">-             toolkitThread.setDaemon(true);</span>
<span class="udiff-line-modified-removed">-             toolkitThread.start();</span>
<span class="udiff-line-modified-added">+             final String name = &quot;AWT-Windows&quot;;</span>
<span class="udiff-line-modified-added">+             AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {</span>
<span class="udiff-line-modified-added">+                 Thread toolkitThread = new Thread(rootTG, this, name, 0, false);</span>
<span class="udiff-line-modified-added">+                 toolkitThread.setDaemon(true);</span>
<span class="udiff-line-added">+                 toolkitThread.start();</span>
<span class="udiff-line-added">+                 return null;</span>
<span class="udiff-line-added">+             });</span>
          }
  
          try {
              synchronized(this) {
                  while(!inited) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -262,14 +315,18 @@</span>
          }
  
          // Enabled &quot;live resizing&quot; by default.  It remains controlled
          // by the native system though.
          setDynamicLayout(true);
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         areExtraMouseButtonsEnabled = Boolean.parseBoolean(System.getProperty(&quot;sun.awt.enableExtraMouseButtons&quot;, &quot;true&quot;));</span>
<span class="udiff-line-modified-removed">-         //set system property if not yet assigned</span>
<span class="udiff-line-modified-removed">-         System.setProperty(&quot;sun.awt.enableExtraMouseButtons&quot;, &quot;&quot;+areExtraMouseButtonsEnabled);</span>
<span class="udiff-line-modified-added">+         final String extraButtons = &quot;sun.awt.enableExtraMouseButtons&quot;;</span>
<span class="udiff-line-modified-added">+         AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {</span>
<span class="udiff-line-modified-added">+             areExtraMouseButtonsEnabled =</span>
<span class="udiff-line-modified-added">+                  Boolean.parseBoolean(System.getProperty(extraButtons, &quot;true&quot;));</span>
<span class="udiff-line-added">+             //set system property if not yet assigned</span>
<span class="udiff-line-added">+             System.setProperty(extraButtons, &quot;&quot;+areExtraMouseButtonsEnabled);</span>
<span class="udiff-line-added">+             return null;</span>
<span class="udiff-line-added">+         });</span>
          setExtraMouseButtonsEnabledNative(areExtraMouseButtonsEnabled);
      }
  
      private void registerShutdownHook() {
          AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {
</pre>
<center><a href="WMenuPeer.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="awtLocalization.properties.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>