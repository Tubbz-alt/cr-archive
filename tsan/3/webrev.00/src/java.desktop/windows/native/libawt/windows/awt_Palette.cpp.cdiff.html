<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/windows/native/libawt/windows/awt_Palette.cpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="awt_MenuItem.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="awt_Palette.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/windows/native/libawt/windows/awt_Palette.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2001, 2017, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2001, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 28,12 ***</span>
  #include &quot;awt_Component.h&quot;
  #include &quot;img_util_md.h&quot;
  #include &quot;awt_CustomPaletteDef.h&quot;
  #include &quot;Trace.h&quot;
  
<span class="line-removed">- BOOL AwtPalette::m_useCustomPalette = TRUE;</span>
<span class="line-removed">- </span>
  #define ERROR_GRAY (-1)
  #define NON_GRAY 0
  #define LINEAR_STATIC_GRAY 1
  #define NON_LINEAR_STATIC_GRAY 2
  
<span class="line-new-header">--- 28,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 44,12 ***</span>
   */
  HPALETTE AwtPalette::Select(HDC hDC)
  {
      HPALETTE prevPalette = NULL;
      if (logicalPalette) {
<span class="line-modified">!         BOOL background = !(m_useCustomPalette);</span>
<span class="line-removed">-         prevPalette = ::SelectPalette(hDC, logicalPalette, background);</span>
      }
      return prevPalette;
  }
  
  /**
<span class="line-new-header">--- 42,11 ---</span>
   */
  HPALETTE AwtPalette::Select(HDC hDC)
  {
      HPALETTE prevPalette = NULL;
      if (logicalPalette) {
<span class="line-modified">!         prevPalette = ::SelectPalette(hDC, logicalPalette, FALSE);</span>
      }
      return prevPalette;
  }
  
  /**
</pre>
<hr />
<pre>
<span class="line-old-header">*** 58,12 ***</span>
   * that HDC.
   */
  void AwtPalette::Realize(HDC hDC)
  {
      if (logicalPalette) {
<span class="line-modified">!         if (!m_useCustomPalette ||</span>
<span class="line-removed">-             AwtComponent::QueryNewPaletteCalled() ||</span>
              AwtToolkit::GetInstance().HasDisplayChanged()) {
              // Fix for bug 4178909, workaround for Windows bug.  Shouldn&#39;t
              // do a RealizePalette until the first QueryNewPalette message
              // has been processed.
              // But if we are switching the primary monitor from non-8bpp
<span class="line-new-header">--- 55,11 ---</span>
   * that HDC.
   */
  void AwtPalette::Realize(HDC hDC)
  {
      if (logicalPalette) {
<span class="line-modified">!         if (AwtComponent::QueryNewPaletteCalled() ||</span>
              AwtToolkit::GetInstance().HasDisplayChanged()) {
              // Fix for bug 4178909, workaround for Windows bug.  Shouldn&#39;t
              // do a RealizePalette until the first QueryNewPalette message
              // has been processed.
              // But if we are switching the primary monitor from non-8bpp
</pre>
<hr />
<pre>
<span class="line-old-header">*** 77,32 ***</span>
              ::RealizePalette(hDC);
          }
      }
  }
  
<span class="line-removed">- /**</span>
<span class="line-removed">-  * Disable the use of our custom palette.  This method is called</span>
<span class="line-removed">-  * during initialization if we detect that we are running inside</span>
<span class="line-removed">-  * the plugin; we do not want to clobber our parent application&#39;s</span>
<span class="line-removed">-  * palette with our own in that situation.</span>
<span class="line-removed">-  */</span>
<span class="line-removed">- void AwtPalette::DisableCustomPalette()</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     m_useCustomPalette = FALSE;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- /**</span>
<span class="line-removed">-  * Returns whether we are currently using a custom palette.  Used</span>
<span class="line-removed">-  * by AwtWin32GraphicsDevice when creating the colorModel of the</span>
<span class="line-removed">-  * device.</span>
<span class="line-removed">-  */</span>
<span class="line-removed">- BOOL AwtPalette::UseCustomPalette()</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     return m_useCustomPalette;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- </span>
  /**
   * Constructor.  Initialize the system and logical palettes.
   * used by this object.
   */
  AwtPalette::AwtPalette(AwtWin32GraphicsDevice *device)
<span class="line-new-header">--- 73,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 151,11 ***</span>
      delete[] pLogPal;
      if ( hPal == 0 ) {
          return 0;
      }
  
<span class="line-modified">!     hPalOld = ::SelectPalette(hDC, hPal, 1);</span>
      if (hPalOld == 0) {
          ::DeleteObject(hPal);
          return 0;
      }
      ::RealizePalette(hDC);
<span class="line-new-header">--- 125,11 ---</span>
      delete[] pLogPal;
      if ( hPal == 0 ) {
          return 0;
      }
  
<span class="line-modified">!     hPalOld = ::SelectPalette(hDC, hPal, TRUE);</span>
      if (hPalOld == 0) {
          ::DeleteObject(hPal);
          return 0;
      }
      ::RealizePalette(hDC);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 166,11 ***</span>
          pPalEntries[iEntry].peRed = GetRValue(rgb);
          pPalEntries[iEntry].peGreen = GetGValue(rgb);
          pPalEntries[iEntry].peBlue = GetBValue(rgb);
      }
  
<span class="line-modified">!     ::SelectPalette(hDC, hPalOld, 0 );</span>
      ::DeleteObject(hPal);
      ::RealizePalette(hDC);
  
      return 256;
  }
<span class="line-new-header">--- 140,11 ---</span>
          pPalEntries[iEntry].peRed = GetRValue(rgb);
          pPalEntries[iEntry].peGreen = GetGValue(rgb);
          pPalEntries[iEntry].peBlue = GetBValue(rgb);
      }
  
<span class="line-modified">!     ::SelectPalette(hDC, hPalOld, FALSE);</span>
      ::DeleteObject(hPal);
      ::RealizePalette(hDC);
  
      return 256;
  }
</pre>
<center><a href="awt_MenuItem.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="awt_Palette.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>