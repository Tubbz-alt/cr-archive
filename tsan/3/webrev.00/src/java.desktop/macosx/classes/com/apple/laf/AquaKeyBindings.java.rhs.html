<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.desktop/macosx/classes/com/apple/laf/AquaKeyBindings.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package com.apple.laf;
 27 
 28 import java.awt.event.ActionEvent;
 29 import java.util.*;
 30 
 31 import javax.swing.*;
 32 import javax.swing.UIDefaults.LazyValue;
 33 import javax.swing.text.*;
 34 import javax.swing.text.DefaultEditorKit.DefaultKeyTypedAction;
 35 
 36 import com.apple.laf.AquaUtils.RecyclableSingleton;
 37 import com.apple.laf.AquaUtils.RecyclableSingletonFromDefaultConstructor;
 38 
 39 public class AquaKeyBindings {
 40     private static final RecyclableSingleton&lt;AquaKeyBindings&gt; instance = new RecyclableSingletonFromDefaultConstructor&lt;AquaKeyBindings&gt;(AquaKeyBindings.class);
 41     static AquaKeyBindings instance() {
 42         return instance.get();
 43     }
 44 
 45     final DefaultKeyTypedAction defaultKeyTypedAction = new DefaultKeyTypedAction();
 46     void setDefaultAction(final String keymapName) {
 47         final javax.swing.text.Keymap map = JTextComponent.getKeymap(keymapName);
 48         map.setDefaultAction(defaultKeyTypedAction);
 49     }
 50 
 51     static final String upMultilineAction = &quot;aqua-move-up&quot;;
 52     static final String downMultilineAction = &quot;aqua-move-down&quot;;
 53     static final String pageUpMultiline = &quot;aqua-page-up&quot;;
 54     static final String pageDownMultiline = &quot;aqua-page-down&quot;;
 55 
 56     final String[] commonTextEditorBindings = {
 57         &quot;ENTER&quot;, JTextField.notifyAction,
 58         &quot;COPY&quot;, DefaultEditorKit.copyAction,
 59         &quot;CUT&quot;, DefaultEditorKit.cutAction,
 60         &quot;PASTE&quot;, DefaultEditorKit.pasteAction,
 61         &quot;meta A&quot;, DefaultEditorKit.selectAllAction,
 62         &quot;meta C&quot;, DefaultEditorKit.copyAction,
 63         &quot;meta V&quot;, DefaultEditorKit.pasteAction,
 64         &quot;meta X&quot;, DefaultEditorKit.cutAction,
 65         &quot;meta BACK_SLASH&quot;, &quot;unselect&quot;,
 66 
 67         &quot;DELETE&quot;, DefaultEditorKit.deleteNextCharAction,
 68         &quot;alt DELETE&quot;, &quot;delete-next-word&quot;,
 69         &quot;BACK_SPACE&quot;, DefaultEditorKit.deletePrevCharAction,
<a name="2" id="anc2"></a><span class="line-added"> 70         &quot;shift BACK_SPACE&quot;, DefaultEditorKit.deletePrevCharAction,</span>
 71         &quot;alt BACK_SPACE&quot;, &quot;delete-previous-word&quot;,
 72 
 73         &quot;LEFT&quot;, DefaultEditorKit.backwardAction,
 74         &quot;KP_LEFT&quot;, DefaultEditorKit.backwardAction,
 75         &quot;RIGHT&quot;, DefaultEditorKit.forwardAction,
 76         &quot;KP_RIGHT&quot;, DefaultEditorKit.forwardAction,
 77         &quot;shift LEFT&quot;, DefaultEditorKit.selectionBackwardAction,
 78         &quot;shift KP_LEFT&quot;, DefaultEditorKit.selectionBackwardAction,
 79         &quot;shift RIGHT&quot;, DefaultEditorKit.selectionForwardAction,
 80         &quot;shift KP_RIGHT&quot;, DefaultEditorKit.selectionForwardAction,
 81         &quot;meta LEFT&quot;, DefaultEditorKit.beginLineAction,
 82         &quot;meta KP_LEFT&quot;, DefaultEditorKit.beginLineAction,
 83         &quot;meta RIGHT&quot;, DefaultEditorKit.endLineAction,
 84         &quot;meta KP_RIGHT&quot;, DefaultEditorKit.endLineAction,
 85         &quot;shift meta LEFT&quot;, DefaultEditorKit.selectionBeginLineAction,
 86         &quot;shift meta KP_LEFT&quot;, DefaultEditorKit.selectionBeginLineAction,
 87         &quot;shift meta RIGHT&quot;, DefaultEditorKit.selectionEndLineAction,
 88         &quot;shift meta KP_RIGHT&quot;, DefaultEditorKit.selectionEndLineAction,
 89         &quot;alt LEFT&quot;, DefaultEditorKit.previousWordAction,
 90         &quot;alt KP_LEFT&quot;, DefaultEditorKit.previousWordAction,
 91         &quot;alt RIGHT&quot;, DefaultEditorKit.nextWordAction,
 92         &quot;alt KP_RIGHT&quot;, DefaultEditorKit.nextWordAction,
 93         &quot;shift alt LEFT&quot;, DefaultEditorKit.selectionPreviousWordAction,
 94         &quot;shift alt KP_LEFT&quot;, DefaultEditorKit.selectionPreviousWordAction,
 95         &quot;shift alt RIGHT&quot;, DefaultEditorKit.selectionNextWordAction,
 96         &quot;shift alt KP_RIGHT&quot;, DefaultEditorKit.selectionNextWordAction,
 97 
 98         &quot;control A&quot;, DefaultEditorKit.beginLineAction,
 99         &quot;control B&quot;, DefaultEditorKit.backwardAction,
100         &quot;control D&quot;, DefaultEditorKit.deleteNextCharAction,
101         &quot;control E&quot;, DefaultEditorKit.endLineAction,
102         &quot;control F&quot;, DefaultEditorKit.forwardAction,
103         &quot;control H&quot;, DefaultEditorKit.deletePrevCharAction,
104         &quot;control W&quot;, &quot;delete-previous-word&quot;,
105         &quot;control shift O&quot;, &quot;toggle-componentOrientation&quot;,
106 
107         &quot;END&quot;, DefaultEditorKit.endAction,
108         &quot;HOME&quot;, DefaultEditorKit.beginAction,
109         &quot;shift END&quot;, DefaultEditorKit.selectionEndAction,
110         &quot;shift HOME&quot;, DefaultEditorKit.selectionBeginAction,
111 
112         &quot;PAGE_DOWN&quot;, pageDownMultiline,
113         &quot;PAGE_UP&quot;, pageUpMultiline,
114         &quot;shift PAGE_DOWN&quot;, &quot;selection-page-down&quot;,
115         &quot;shift PAGE_UP&quot;, &quot;selection-page-up&quot;,
116         &quot;meta shift PAGE_DOWN&quot;, &quot;selection-page-right&quot;,
117         &quot;meta shift PAGE_UP&quot;, &quot;selection-page-left&quot;,
118 
119         &quot;meta DOWN&quot;, DefaultEditorKit.endAction,
120         &quot;meta KP_DOWN&quot;, DefaultEditorKit.endAction,
121         &quot;meta UP&quot;, DefaultEditorKit.beginAction,
122         &quot;meta KP_UP&quot;, DefaultEditorKit.beginAction,
123         &quot;shift meta DOWN&quot;, DefaultEditorKit.selectionEndAction,
124         &quot;shift meta KP_DOWN&quot;, DefaultEditorKit.selectionEndAction,
125         &quot;shift meta UP&quot;, DefaultEditorKit.selectionBeginAction,
126         &quot;shift meta KP_UP&quot;, DefaultEditorKit.selectionBeginAction,
127     };
128 
129     LateBoundInputMap getTextFieldInputMap() {
130         return new LateBoundInputMap(new SimpleBinding(commonTextEditorBindings), new SimpleBinding(new String[] {
131             &quot;DOWN&quot;, DefaultEditorKit.endLineAction,
132             &quot;KP_DOWN&quot;, DefaultEditorKit.endLineAction,
133             &quot;UP&quot;, DefaultEditorKit.beginLineAction,
134             &quot;KP_UP&quot;, DefaultEditorKit.beginLineAction,
135             &quot;shift DOWN&quot;, DefaultEditorKit.selectionEndLineAction,
136             &quot;shift KP_DOWN&quot;, DefaultEditorKit.selectionEndLineAction,
137             &quot;shift UP&quot;, DefaultEditorKit.selectionBeginLineAction,
138             &quot;shift KP_UP&quot;, DefaultEditorKit.selectionBeginLineAction,
139 
140             &quot;control P&quot;, DefaultEditorKit.beginAction,
141             &quot;control N&quot;, DefaultEditorKit.endAction,
142             &quot;control V&quot;, DefaultEditorKit.endAction,
143         }));
144     }
145 
146     LateBoundInputMap getPasswordFieldInputMap() {
147         return new LateBoundInputMap(new SimpleBinding(getTextFieldInputMap().getBindings()),
148                 // nullify all the bindings that may discover space characters in the text
149                 new SimpleBinding(new String[] {
150                         &quot;alt LEFT&quot;, null,
151                         &quot;alt KP_LEFT&quot;, null,
152                         &quot;alt RIGHT&quot;, null,
153                         &quot;alt KP_RIGHT&quot;, null,
154                         &quot;shift alt LEFT&quot;, null,
155                         &quot;shift alt KP_LEFT&quot;, null,
156                         &quot;shift alt RIGHT&quot;, null,
157                         &quot;shift alt KP_RIGHT&quot;, null,
158                 }));
159     }
160 
161     LateBoundInputMap getMultiLineTextInputMap() {
162         return new LateBoundInputMap(new SimpleBinding(commonTextEditorBindings), new SimpleBinding(new String[] {
163             &quot;ENTER&quot;, DefaultEditorKit.insertBreakAction,
164             &quot;DOWN&quot;, downMultilineAction,
165             &quot;KP_DOWN&quot;, downMultilineAction,
166             &quot;UP&quot;, upMultilineAction,
167             &quot;KP_UP&quot;, upMultilineAction,
168             &quot;shift DOWN&quot;, DefaultEditorKit.selectionDownAction,
169             &quot;shift KP_DOWN&quot;, DefaultEditorKit.selectionDownAction,
170             &quot;shift UP&quot;, DefaultEditorKit.selectionUpAction,
171             &quot;shift KP_UP&quot;, DefaultEditorKit.selectionUpAction,
172             &quot;alt shift DOWN&quot;, DefaultEditorKit.selectionEndParagraphAction,
173             &quot;alt shift KP_DOWN&quot;, DefaultEditorKit.selectionEndParagraphAction,
174             &quot;alt shift UP&quot;, DefaultEditorKit.selectionBeginParagraphAction,
175             &quot;alt shift KP_UP&quot;, DefaultEditorKit.selectionBeginParagraphAction,
176 
177             &quot;control P&quot;, DefaultEditorKit.upAction,
178             &quot;control N&quot;, DefaultEditorKit.downAction,
179             &quot;control V&quot;, pageDownMultiline,
180 
181             &quot;TAB&quot;, DefaultEditorKit.insertTabAction,
182             &quot;meta SPACE&quot;, &quot;activate-link-action&quot;,
183             &quot;meta T&quot;, &quot;next-link-action&quot;,
184             &quot;meta shift T&quot;, &quot;previous-link-action&quot;,
185 
186             &quot;END&quot;, DefaultEditorKit.endAction,
187             &quot;HOME&quot;, DefaultEditorKit.beginAction,
188             &quot;shift END&quot;, DefaultEditorKit.selectionEndAction,
189             &quot;shift HOME&quot;, DefaultEditorKit.selectionBeginAction,
190 
191             &quot;PAGE_DOWN&quot;, pageDownMultiline,
192             &quot;PAGE_UP&quot;, pageUpMultiline,
193             &quot;shift PAGE_DOWN&quot;, &quot;selection-page-down&quot;,
194             &quot;shift PAGE_UP&quot;, &quot;selection-page-up&quot;,
195             &quot;meta shift PAGE_DOWN&quot;, &quot;selection-page-right&quot;,
196             &quot;meta shift PAGE_UP&quot;, &quot;selection-page-left&quot;,
197         }));
198     }
199 
200     LateBoundInputMap getFormattedTextFieldInputMap() {
201         return new LateBoundInputMap(getTextFieldInputMap(), new SimpleBinding(new String[] {
202             &quot;UP&quot;, &quot;increment&quot;,
203             &quot;KP_UP&quot;, &quot;increment&quot;,
204             &quot;DOWN&quot;, &quot;decrement&quot;,
205             &quot;KP_DOWN&quot;, &quot;decrement&quot;,
206 
207             &quot;ESCAPE&quot;, &quot;reset-field-edit&quot;,
208         }));
209     }
210 
211     LateBoundInputMap getComboBoxInputMap() {
212         return new LateBoundInputMap(new SimpleBinding(new String[] {
213             &quot;ESCAPE&quot;, &quot;aquaHidePopup&quot;,
214             &quot;PAGE_UP&quot;, &quot;aquaSelectPageUp&quot;,
215             &quot;PAGE_DOWN&quot;, &quot;aquaSelectPageDown&quot;,
216             &quot;HOME&quot;, &quot;aquaSelectHome&quot;,
217             &quot;END&quot;, &quot;aquaSelectEnd&quot;,
218             &quot;ENTER&quot;, &quot;enterPressed&quot;,
219             &quot;UP&quot;, &quot;aquaSelectPrevious&quot;,
220             &quot;KP_UP&quot;, &quot;aquaSelectPrevious&quot;,
221             &quot;DOWN&quot;, &quot;aquaSelectNext&quot;,
222             &quot;KP_DOWN&quot;, &quot;aquaSelectNext&quot;,
223             &quot;SPACE&quot;, &quot;aquaSpacePressed&quot; // &quot;spacePopup&quot;
224         }));
225     }
226 
227     LateBoundInputMap getListInputMap() {
228         return new LateBoundInputMap(new SimpleBinding(new String[] {
229             &quot;meta C&quot;, &quot;copy&quot;,
230             &quot;meta V&quot;, &quot;paste&quot;,
231             &quot;meta X&quot;, &quot;cut&quot;,
232             &quot;COPY&quot;, &quot;copy&quot;,
233             &quot;PASTE&quot;, &quot;paste&quot;,
234             &quot;CUT&quot;, &quot;cut&quot;,
235             &quot;UP&quot;, &quot;selectPreviousRow&quot;,
236             &quot;KP_UP&quot;, &quot;selectPreviousRow&quot;,
237             &quot;shift UP&quot;, &quot;selectPreviousRowExtendSelection&quot;,
238             &quot;shift KP_UP&quot;, &quot;selectPreviousRowExtendSelection&quot;,
239             &quot;DOWN&quot;, &quot;selectNextRow&quot;,
240             &quot;KP_DOWN&quot;, &quot;selectNextRow&quot;,
241             &quot;shift DOWN&quot;, &quot;selectNextRowExtendSelection&quot;,
242             &quot;shift KP_DOWN&quot;, &quot;selectNextRowExtendSelection&quot;,
243             &quot;LEFT&quot;, &quot;selectPreviousColumn&quot;,
244             &quot;KP_LEFT&quot;, &quot;selectPreviousColumn&quot;,
245             &quot;shift LEFT&quot;, &quot;selectPreviousColumnExtendSelection&quot;,
246             &quot;shift KP_LEFT&quot;, &quot;selectPreviousColumnExtendSelection&quot;,
247             &quot;RIGHT&quot;, &quot;selectNextColumn&quot;,
248             &quot;KP_RIGHT&quot;, &quot;selectNextColumn&quot;,
249             &quot;shift RIGHT&quot;, &quot;selectNextColumnExtendSelection&quot;,
250             &quot;shift KP_RIGHT&quot;, &quot;selectNextColumnExtendSelection&quot;,
251             &quot;meta A&quot;, &quot;selectAll&quot;,
252 
253             // aquaHome and aquaEnd are new actions that just move the view so the first or last item is visible.
254             &quot;HOME&quot;, &quot;aquaHome&quot;,
255             &quot;shift HOME&quot;, &quot;selectFirstRowExtendSelection&quot;,
256             &quot;END&quot;, &quot;aquaEnd&quot;,
257             &quot;shift END&quot;, &quot;selectLastRowExtendSelection&quot;,
258 
259             // Unmodified PAGE_UP and PAGE_DOWN are handled by their scroll pane, if any.
260             &quot;shift PAGE_UP&quot;, &quot;scrollUpExtendSelection&quot;,
261             &quot;shift PAGE_DOWN&quot;, &quot;scrollDownExtendSelection&quot;
262         }));
263     }
264 
265     LateBoundInputMap getScrollBarInputMap() {
266         return new LateBoundInputMap(new SimpleBinding(new String[] {
267             &quot;RIGHT&quot;, &quot;positiveUnitIncrement&quot;,
268             &quot;KP_RIGHT&quot;, &quot;positiveUnitIncrement&quot;,
269             &quot;DOWN&quot;, &quot;positiveUnitIncrement&quot;,
270             &quot;KP_DOWN&quot;, &quot;positiveUnitIncrement&quot;,
271             &quot;PAGE_DOWN&quot;, &quot;positiveBlockIncrement&quot;,
272             &quot;LEFT&quot;, &quot;negativeUnitIncrement&quot;,
273             &quot;KP_LEFT&quot;, &quot;negativeUnitIncrement&quot;,
274             &quot;UP&quot;, &quot;negativeUnitIncrement&quot;,
275             &quot;KP_UP&quot;, &quot;negativeUnitIncrement&quot;,
276             &quot;PAGE_UP&quot;, &quot;negativeBlockIncrement&quot;,
277             &quot;HOME&quot;, &quot;minScroll&quot;,
278             &quot;END&quot;, &quot;maxScroll&quot;
279         }));
280     }
281 
282     LateBoundInputMap getScrollBarRightToLeftInputMap() {
283         return new LateBoundInputMap(new SimpleBinding(new String[] {
284             &quot;RIGHT&quot;, &quot;negativeUnitIncrement&quot;,
285             &quot;KP_RIGHT&quot;, &quot;negativeUnitIncrement&quot;,
286             &quot;LEFT&quot;, &quot;positiveUnitIncrement&quot;,
287             &quot;KP_LEFT&quot;, &quot;positiveUnitIncrement&quot;
288         }));
289     }
290 
291     LateBoundInputMap getScrollPaneInputMap() {
292         return new LateBoundInputMap(new SimpleBinding(new String[] {
293             &quot;RIGHT&quot;, &quot;unitScrollRight&quot;,
294             &quot;KP_RIGHT&quot;, &quot;unitScrollRight&quot;,
295             &quot;DOWN&quot;, &quot;unitScrollDown&quot;,
296             &quot;KP_DOWN&quot;, &quot;unitScrollDown&quot;,
297             &quot;LEFT&quot;, &quot;unitScrollLeft&quot;,
298             &quot;KP_LEFT&quot;, &quot;unitScrollLeft&quot;,
299             &quot;UP&quot;, &quot;unitScrollUp&quot;,
300             &quot;KP_UP&quot;, &quot;unitScrollUp&quot;,
301             &quot;PAGE_UP&quot;, &quot;scrollUp&quot;,
302             &quot;PAGE_DOWN&quot;, &quot;scrollDown&quot;,
303             &quot;HOME&quot;, &quot;scrollHome&quot;,
304             &quot;END&quot;, &quot;scrollEnd&quot;
305         }));
306     }
307 
308     LateBoundInputMap getSliderInputMap() {
309         return new LateBoundInputMap(new SimpleBinding(new String[] {
310             &quot;RIGHT&quot;, &quot;positiveUnitIncrement&quot;,
311             &quot;KP_RIGHT&quot;, &quot;positiveUnitIncrement&quot;,
312             &quot;DOWN&quot;, &quot;negativeUnitIncrement&quot;,
313             &quot;KP_DOWN&quot;, &quot;negativeUnitIncrement&quot;,
314             &quot;PAGE_DOWN&quot;, &quot;negativeBlockIncrement&quot;,
315             &quot;LEFT&quot;, &quot;negativeUnitIncrement&quot;,
316             &quot;KP_LEFT&quot;, &quot;negativeUnitIncrement&quot;,
317             &quot;UP&quot;, &quot;positiveUnitIncrement&quot;,
318             &quot;KP_UP&quot;, &quot;positiveUnitIncrement&quot;,
319             &quot;PAGE_UP&quot;, &quot;positiveBlockIncrement&quot;,
320             &quot;HOME&quot;, &quot;minScroll&quot;,
321             &quot;END&quot;, &quot;maxScroll&quot;
322         }));
323     }
324 
325     LateBoundInputMap getSliderRightToLeftInputMap() {
326         return new LateBoundInputMap(new SimpleBinding(new String[] {
327             &quot;RIGHT&quot;, &quot;negativeUnitIncrement&quot;,
328             &quot;KP_RIGHT&quot;, &quot;negativeUnitIncrement&quot;,
329             &quot;LEFT&quot;, &quot;positiveUnitIncrement&quot;,
330             &quot;KP_LEFT&quot;, &quot;positiveUnitIncrement&quot;
331         }));
332     }
333 
334     LateBoundInputMap getSpinnerInputMap() {
335         return new LateBoundInputMap(new SimpleBinding(new String[] {
336             &quot;UP&quot;, &quot;increment&quot;,
337             &quot;KP_UP&quot;, &quot;increment&quot;,
338             &quot;DOWN&quot;, &quot;decrement&quot;,
339             &quot;KP_DOWN&quot;, &quot;decrement&quot;
340         }));
341     }
342 
343     LateBoundInputMap getTableInputMap() {
344         return new LateBoundInputMap(new SimpleBinding(new String[] {
345             &quot;meta C&quot;, &quot;copy&quot;,
346             &quot;meta V&quot;, &quot;paste&quot;,
347             &quot;meta X&quot;, &quot;cut&quot;,
348             &quot;COPY&quot;, &quot;copy&quot;,
349             &quot;PASTE&quot;, &quot;paste&quot;,
350             &quot;CUT&quot;, &quot;cut&quot;,
351             &quot;RIGHT&quot;, &quot;selectNextColumn&quot;,
352             &quot;KP_RIGHT&quot;, &quot;selectNextColumn&quot;,
353             &quot;LEFT&quot;, &quot;selectPreviousColumn&quot;,
354             &quot;KP_LEFT&quot;, &quot;selectPreviousColumn&quot;,
355             &quot;DOWN&quot;, &quot;selectNextRow&quot;,
356             &quot;KP_DOWN&quot;, &quot;selectNextRow&quot;,
357             &quot;UP&quot;, &quot;selectPreviousRow&quot;,
358             &quot;KP_UP&quot;, &quot;selectPreviousRow&quot;,
359             &quot;shift RIGHT&quot;, &quot;selectNextColumnExtendSelection&quot;,
360             &quot;shift KP_RIGHT&quot;, &quot;selectNextColumnExtendSelection&quot;,
361             &quot;shift LEFT&quot;, &quot;selectPreviousColumnExtendSelection&quot;,
362             &quot;shift KP_LEFT&quot;, &quot;selectPreviousColumnExtendSelection&quot;,
363             &quot;shift DOWN&quot;, &quot;selectNextRowExtendSelection&quot;,
364             &quot;shift KP_DOWN&quot;, &quot;selectNextRowExtendSelection&quot;,
365             &quot;shift UP&quot;, &quot;selectPreviousRowExtendSelection&quot;,
366             &quot;shift KP_UP&quot;, &quot;selectPreviousRowExtendSelection&quot;,
367             &quot;PAGE_UP&quot;, &quot;scrollUpChangeSelection&quot;,
368             &quot;PAGE_DOWN&quot;, &quot;scrollDownChangeSelection&quot;,
369             &quot;HOME&quot;, &quot;selectFirstColumn&quot;,
370             &quot;END&quot;, &quot;selectLastColumn&quot;,
371             &quot;shift PAGE_UP&quot;, &quot;scrollUpExtendSelection&quot;,
372             &quot;shift PAGE_DOWN&quot;, &quot;scrollDownExtendSelection&quot;,
373             &quot;shift HOME&quot;, &quot;selectFirstColumnExtendSelection&quot;,
374             &quot;shift END&quot;, &quot;selectLastColumnExtendSelection&quot;,
375             &quot;TAB&quot;, &quot;selectNextColumnCell&quot;,
376             &quot;shift TAB&quot;, &quot;selectPreviousColumnCell&quot;,
377             &quot;meta A&quot;, &quot;selectAll&quot;,
378             &quot;ESCAPE&quot;, &quot;cancel&quot;,
379             &quot;ENTER&quot;, &quot;selectNextRowCell&quot;,
380             &quot;shift ENTER&quot;, &quot;selectPreviousRowCell&quot;,
381             &quot;alt TAB&quot;, &quot;focusHeader&quot;,
382             &quot;alt shift TAB&quot;, &quot;focusHeader&quot;
383         }));
384     }
385 
386     LateBoundInputMap getTableRightToLeftInputMap() {
387         return new LateBoundInputMap(new SimpleBinding(new String[] {
388             &quot;RIGHT&quot;, &quot;selectPreviousColumn&quot;,
389             &quot;KP_RIGHT&quot;, &quot;selectPreviousColumn&quot;,
390             &quot;LEFT&quot;, &quot;selectNextColumn&quot;,
391             &quot;KP_LEFT&quot;, &quot;selectNextColumn&quot;,
392             &quot;shift RIGHT&quot;, &quot;selectPreviousColumnExtendSelection&quot;,
393             &quot;shift KP_RIGHT&quot;, &quot;selectPreviousColumnExtendSelection&quot;,
394             &quot;shift LEFT&quot;, &quot;selectNextColumnExtendSelection&quot;,
395             &quot;shift KP_LEFT&quot;, &quot;selectNextColumnExtendSelection&quot;,
396             &quot;ctrl PAGE_UP&quot;, &quot;scrollRightChangeSelection&quot;,
397             &quot;ctrl PAGE_DOWN&quot;, &quot;scrollLeftChangeSelection&quot;,
398             &quot;ctrl shift PAGE_UP&quot;, &quot;scrollRightExtendSelection&quot;,
399             &quot;ctrl shift PAGE_DOWN&quot;, &quot;scrollLeftExtendSelection&quot;
400         }));
401     }
402 
403     LateBoundInputMap getTreeInputMap() {
404         return new LateBoundInputMap(new SimpleBinding(new String[] {
405             &quot;meta C&quot;, &quot;copy&quot;,
406             &quot;meta V&quot;, &quot;paste&quot;,
407             &quot;meta X&quot;, &quot;cut&quot;,
408             &quot;COPY&quot;, &quot;copy&quot;,
409             &quot;PASTE&quot;, &quot;paste&quot;,
410             &quot;CUT&quot;, &quot;cut&quot;,
411             &quot;UP&quot;, &quot;selectPrevious&quot;,
412             &quot;KP_UP&quot;, &quot;selectPrevious&quot;,
413             &quot;shift UP&quot;, &quot;selectPreviousExtendSelection&quot;,
414             &quot;shift KP_UP&quot;, &quot;selectPreviousExtendSelection&quot;,
415             &quot;DOWN&quot;, &quot;selectNext&quot;,
416             &quot;KP_DOWN&quot;, &quot;selectNext&quot;,
417             &quot;shift DOWN&quot;, &quot;selectNextExtendSelection&quot;,
418             &quot;shift KP_DOWN&quot;, &quot;selectNextExtendSelection&quot;,
419             &quot;RIGHT&quot;, &quot;aquaExpandNode&quot;,
420             &quot;KP_RIGHT&quot;, &quot;aquaExpandNode&quot;,
421             &quot;LEFT&quot;, &quot;aquaCollapseNode&quot;,
422             &quot;KP_LEFT&quot;, &quot;aquaCollapseNode&quot;,
423             &quot;shift RIGHT&quot;, &quot;aquaExpandNode&quot;,
424             &quot;shift KP_RIGHT&quot;, &quot;aquaExpandNode&quot;,
425             &quot;shift LEFT&quot;, &quot;aquaCollapseNode&quot;,
426             &quot;shift KP_LEFT&quot;, &quot;aquaCollapseNode&quot;,
427             &quot;ctrl LEFT&quot;, &quot;aquaCollapseNode&quot;,
428             &quot;ctrl KP_LEFT&quot;, &quot;aquaCollapseNode&quot;,
429             &quot;ctrl RIGHT&quot;, &quot;aquaExpandNode&quot;,
430             &quot;ctrl KP_RIGHT&quot;, &quot;aquaExpandNode&quot;,
431             &quot;alt RIGHT&quot;, &quot;aquaFullyExpandNode&quot;,
432             &quot;alt KP_RIGHT&quot;, &quot;aquaFullyExpandNode&quot;,
433             &quot;alt LEFT&quot;, &quot;aquaFullyCollapseNode&quot;,
434             &quot;alt KP_LEFT&quot;, &quot;aquaFullyCollapseNode&quot;,
435             &quot;meta A&quot;, &quot;selectAll&quot;,
436             &quot;RETURN&quot;, &quot;startEditing&quot;
437         }));
438     }
439 
440     LateBoundInputMap getTreeRightToLeftInputMap() {
441         return new LateBoundInputMap(new SimpleBinding(new String[] {
442             &quot;RIGHT&quot;, &quot;aquaCollapseNode&quot;,
443             &quot;KP_RIGHT&quot;, &quot;aquaCollapseNode&quot;,
444             &quot;LEFT&quot;, &quot;aquaExpandNode&quot;,
445             &quot;KP_LEFT&quot;, &quot;aquaExpandNode&quot;,
446             &quot;shift RIGHT&quot;, &quot;aquaCollapseNode&quot;,
447             &quot;shift KP_RIGHT&quot;, &quot;aquaCollapseNode&quot;,
448             &quot;shift LEFT&quot;, &quot;aquaExpandNode&quot;,
449             &quot;shift KP_LEFT&quot;, &quot;aquaExpandNode&quot;,
450             &quot;ctrl LEFT&quot;, &quot;aquaExpandNode&quot;,
451             &quot;ctrl KP_LEFT&quot;, &quot;aquaExpandNode&quot;,
452             &quot;ctrl RIGHT&quot;, &quot;aquaCollapseNode&quot;,
453             &quot;ctrl KP_RIGHT&quot;, &quot;aquaCollapseNode&quot;
454         }));
455     }
456 
457     // common interface between a string array, and a dynamic provider of string arrays ;-)
458     interface BindingsProvider {
459         public String[] getBindings();
460     }
461 
462     // wraps basic string arrays
463     static class SimpleBinding implements BindingsProvider {
464         final String[] bindings;
465         public SimpleBinding(final String[] bindings) { this.bindings = bindings; }
466         public String[] getBindings() { return bindings; }
467     }
468 
469     // patches all providers together at the moment the UIManager needs the real InputMap
470     static class LateBoundInputMap implements LazyValue, BindingsProvider {
471         private final BindingsProvider[] providerList;
472         private String[] mergedBindings;
473 
474         public LateBoundInputMap(final BindingsProvider ... providerList) {
475             this.providerList = providerList;
476         }
477 
478         public Object createValue(final UIDefaults table) {
479             return LookAndFeel.makeInputMap(getBindings());
480         }
481 
482         public String[] getBindings() {
483             if (mergedBindings != null) return mergedBindings;
484 
485             final String[][] bindingsList = new String[providerList.length][];
486             int size = 0;
487             for (int i = 0; i &lt; providerList.length; i++) {
488                 bindingsList[i] = providerList[i].getBindings();
489                 size += bindingsList[i].length;
490             }
491 
492             if (bindingsList.length == 1) {
493                 return mergedBindings = bindingsList[0];
494             }
495 
496             final ArrayList&lt;String&gt; unifiedList = new ArrayList&lt;String&gt;(size);
497             Collections.addAll(unifiedList, bindingsList[0]); // System.arrayCopy() the first set
498 
499             for (int i = 1; i &lt; providerList.length; i++) {
500                 mergeBindings(unifiedList, bindingsList[i]);
501             }
502 
503             return mergedBindings = unifiedList.toArray(new String[unifiedList.size()]);
504         }
505 
506         static void mergeBindings(final ArrayList&lt;String&gt; unifiedList, final String[] overrides) {
507             for (int i = 0; i &lt; overrides.length; i+=2) {
508                 final String key = overrides[i];
509                 final String value = overrides[i+1];
510 
511                 final int keyIndex = unifiedList.indexOf(key);
512                 if (keyIndex == -1) {
513                     unifiedList.add(key);
514                     unifiedList.add(value);
515                 } else {
516                     unifiedList.set(keyIndex, key);
517                     unifiedList.set(keyIndex + 1, value);
518                 }
519             }
520         }
521     }
522 
523     void installAquaUpDownActions(final JTextComponent component) {
524         final ActionMap actionMap = component.getActionMap();
525         actionMap.put(upMultilineAction, moveUpMultilineAction);
526         actionMap.put(downMultilineAction, moveDownMultilineAction);
527         actionMap.put(pageUpMultiline, pageUpMultilineAction);
528         actionMap.put(pageDownMultiline, pageDownMultilineAction);
529     }
530 
531     // extracted and adapted from DefaultEditorKit in 1.6
532     @SuppressWarnings(&quot;serial&quot;) // Superclass is not serializable across versions
533     abstract static class DeleteWordAction extends TextAction {
534         public DeleteWordAction(final String name) { super(name); }
535 
536         public void actionPerformed(final ActionEvent e) {
537             if (e == null) return;
538 
539             final JTextComponent target = getTextComponent(e);
540             if (target == null) return;
541 
542             if (!target.isEditable() || !target.isEnabled()) {
543                 UIManager.getLookAndFeel().provideErrorFeedback(target);
544                 return;
545             }
546 
547             try {
548                 final int start = target.getSelectionStart();
549                 final Element line = Utilities.getParagraphElement(target, start);
550                 final int end = getEnd(target, line, start);
551 
552                 final int offs = Math.min(start, end);
553                 final int len = Math.abs(end - start);
554                 if (offs &gt;= 0) {
555                     target.getDocument().remove(offs, len);
556                     return;
557                 }
558             } catch (final BadLocationException ignore) {}
559             UIManager.getLookAndFeel().provideErrorFeedback(target);
560         }
561 
562         abstract int getEnd(final JTextComponent target, final Element line, final int start) throws BadLocationException;
563     }
564 
565     final TextAction moveUpMultilineAction = new AquaMultilineAction(upMultilineAction, DefaultEditorKit.upAction, DefaultEditorKit.beginAction);
566     final TextAction moveDownMultilineAction = new AquaMultilineAction(downMultilineAction, DefaultEditorKit.downAction, DefaultEditorKit.endAction);
567     final TextAction pageUpMultilineAction = new AquaMultilineAction(pageUpMultiline, DefaultEditorKit.pageUpAction, DefaultEditorKit.beginAction);
568     final TextAction pageDownMultilineAction = new AquaMultilineAction(pageDownMultiline, DefaultEditorKit.pageDownAction, DefaultEditorKit.endAction);
569 
570     @SuppressWarnings(&quot;serial&quot;) // Superclass is not serializable across versions
571     static class AquaMultilineAction extends TextAction {
572         final String targetActionName;
573         final String proxyActionName;
574 
575         public AquaMultilineAction(final String actionName, final String targetActionName, final String proxyActionName) {
576             super(actionName);
577             this.targetActionName = targetActionName;
578             this.proxyActionName = proxyActionName;
579         }
580 
581         public void actionPerformed(final ActionEvent e) {
582             final JTextComponent c = getTextComponent(e);
583             final ActionMap actionMap = c.getActionMap();
584             final Action targetAction = actionMap.get(targetActionName);
585 
586             final int startPosition = c.getCaretPosition();
587             targetAction.actionPerformed(e);
588             if (startPosition != c.getCaretPosition()) return;
589 
590             final Action proxyAction = actionMap.get(proxyActionName);
591             proxyAction.actionPerformed(e);
592         }
593     }
594 }
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>