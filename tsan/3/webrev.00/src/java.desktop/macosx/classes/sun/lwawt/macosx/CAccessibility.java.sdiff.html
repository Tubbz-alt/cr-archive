<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/macosx/classes/sun/lwawt/macosx/CAccessibility.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../LWWindowPeer.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="CAccessible.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/macosx/classes/sun/lwawt/macosx/CAccessibility.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.lwawt.macosx;
 27 
 28 import java.awt.Component;
 29 import java.awt.Container;
 30 import java.awt.Dimension;
 31 import java.awt.KeyboardFocusManager;
 32 import java.awt.Point;
 33 import java.awt.Window;

 34 import java.beans.PropertyChangeEvent;
 35 import java.beans.PropertyChangeListener;
 36 import java.lang.reflect.InvocationTargetException;
 37 import java.util.ArrayList;
 38 import java.util.HashSet;
 39 import java.util.Set;
 40 import java.util.concurrent.Callable;
 41 
 42 import javax.accessibility.Accessible;
 43 import javax.accessibility.AccessibleAction;
 44 import javax.accessibility.AccessibleComponent;
 45 import javax.accessibility.AccessibleContext;
 46 import javax.accessibility.AccessibleRole;
 47 import javax.accessibility.AccessibleSelection;
 48 import javax.accessibility.AccessibleState;
 49 import javax.accessibility.AccessibleStateSet;
 50 import javax.accessibility.AccessibleTable;
 51 import javax.accessibility.AccessibleText;
 52 import javax.accessibility.AccessibleValue;
 53 import javax.swing.Icon;
 54 import javax.swing.JComponent;
 55 import javax.swing.JEditorPane;
 56 import javax.swing.JLabel;

 57 import javax.swing.JTextArea;

 58 
 59 import sun.awt.AWTAccessor;
 60 import sun.lwawt.LWWindowPeer;
 61 
 62 class CAccessibility implements PropertyChangeListener {
 63     private static Set&lt;String&gt; ignoredRoles;
 64 
 65     static {
 66         // Need to load the native library for this code.
 67         java.security.AccessController.doPrivileged(
 68             new java.security.PrivilegedAction&lt;Void&gt;() {
 69                 public Void run() {
 70                     System.loadLibrary(&quot;awt&quot;);
 71                     return null;
 72                 }
 73             });
 74     }
 75 
 76     static CAccessibility sAccessibility;
 77     static synchronized CAccessibility getAccessibility(final String[] roles) {
</pre>
<hr />
<pre>
338                 if (ac == null) return null;
339 
340                 AccessibleValue accessibleValue = ac.getAccessibleValue();
341                 return accessibleValue;
342             }
343         }, c);
344     }
345 
346     public static String getAccessibleName(final Accessible a, final Component c) {
347         if (a == null) return null;
348 
349         return invokeAndWait(new Callable&lt;String&gt;() {
350             public String call() throws Exception {
351                 final AccessibleContext ac = a.getAccessibleContext();
352                 if (ac == null) return null;
353 
354                 final String accessibleName = ac.getAccessibleName();
355                 if (accessibleName == null) {
356                     return ac.getAccessibleDescription();
357                 }




358                 return accessibleName;
359             }
360         }, c);
361     }
362 
363     public static AccessibleText getAccessibleText(final Accessible a, final Component c) {
364         if (a == null) return null;
365 
366         return invokeAndWait(new Callable&lt;AccessibleText&gt;() {
367             public AccessibleText call() throws Exception {
368                 final AccessibleContext ac = a.getAccessibleContext();
369                 if (ac == null) return null;
370 
371                 AccessibleText accessibleText = ac.getAccessibleText();
372                 return accessibleText;
373             }
374         }, c);
375     }
376 



































377     public static String getAccessibleDescription(final Accessible a, final Component c) {
378         if (a == null) return null;
379 
380         return invokeAndWait(new Callable&lt;String&gt;() {
381             public String call() throws Exception {
382                 final AccessibleContext ac = a.getAccessibleContext();
383                 if (ac == null) return null;
384 
385                 final String accessibleDescription = ac.getAccessibleDescription();
386                 if (accessibleDescription == null) {
387                     if (c instanceof JComponent) {
388                         String toolTipText = ((JComponent)c).getToolTipText();
389                         if (toolTipText != null) {
390                             return toolTipText;
391                         }
392                     }
393                 }
394 
395                 return accessibleDescription;
396             }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.lwawt.macosx;
 27 
 28 import java.awt.Component;
 29 import java.awt.Container;
 30 import java.awt.Dimension;
 31 import java.awt.KeyboardFocusManager;
 32 import java.awt.Point;
 33 import java.awt.Window;
<span class="line-added"> 34 import java.awt.event.KeyEvent;</span>
 35 import java.beans.PropertyChangeEvent;
 36 import java.beans.PropertyChangeListener;
 37 import java.lang.reflect.InvocationTargetException;
 38 import java.util.ArrayList;
 39 import java.util.HashSet;
 40 import java.util.Set;
 41 import java.util.concurrent.Callable;
 42 
 43 import javax.accessibility.Accessible;
 44 import javax.accessibility.AccessibleAction;
 45 import javax.accessibility.AccessibleComponent;
 46 import javax.accessibility.AccessibleContext;
 47 import javax.accessibility.AccessibleRole;
 48 import javax.accessibility.AccessibleSelection;
 49 import javax.accessibility.AccessibleState;
 50 import javax.accessibility.AccessibleStateSet;
 51 import javax.accessibility.AccessibleTable;
 52 import javax.accessibility.AccessibleText;
 53 import javax.accessibility.AccessibleValue;
 54 import javax.swing.Icon;
 55 import javax.swing.JComponent;
 56 import javax.swing.JEditorPane;
 57 import javax.swing.JLabel;
<span class="line-added"> 58 import javax.swing.JMenuItem;</span>
 59 import javax.swing.JTextArea;
<span class="line-added"> 60 import javax.swing.KeyStroke;</span>
 61 
 62 import sun.awt.AWTAccessor;
 63 import sun.lwawt.LWWindowPeer;
 64 
 65 class CAccessibility implements PropertyChangeListener {
 66     private static Set&lt;String&gt; ignoredRoles;
 67 
 68     static {
 69         // Need to load the native library for this code.
 70         java.security.AccessController.doPrivileged(
 71             new java.security.PrivilegedAction&lt;Void&gt;() {
 72                 public Void run() {
 73                     System.loadLibrary(&quot;awt&quot;);
 74                     return null;
 75                 }
 76             });
 77     }
 78 
 79     static CAccessibility sAccessibility;
 80     static synchronized CAccessibility getAccessibility(final String[] roles) {
</pre>
<hr />
<pre>
341                 if (ac == null) return null;
342 
343                 AccessibleValue accessibleValue = ac.getAccessibleValue();
344                 return accessibleValue;
345             }
346         }, c);
347     }
348 
349     public static String getAccessibleName(final Accessible a, final Component c) {
350         if (a == null) return null;
351 
352         return invokeAndWait(new Callable&lt;String&gt;() {
353             public String call() throws Exception {
354                 final AccessibleContext ac = a.getAccessibleContext();
355                 if (ac == null) return null;
356 
357                 final String accessibleName = ac.getAccessibleName();
358                 if (accessibleName == null) {
359                     return ac.getAccessibleDescription();
360                 }
<span class="line-added">361                 final String acceleratorText = getAcceleratorText(ac);</span>
<span class="line-added">362                 if (!acceleratorText.isEmpty()) {</span>
<span class="line-added">363                     return accessibleName +&#39; &#39;+ acceleratorText;</span>
<span class="line-added">364                 }</span>
365                 return accessibleName;
366             }
367         }, c);
368     }
369 
370     public static AccessibleText getAccessibleText(final Accessible a, final Component c) {
371         if (a == null) return null;
372 
373         return invokeAndWait(new Callable&lt;AccessibleText&gt;() {
374             public AccessibleText call() throws Exception {
375                 final AccessibleContext ac = a.getAccessibleContext();
376                 if (ac == null) return null;
377 
378                 AccessibleText accessibleText = ac.getAccessibleText();
379                 return accessibleText;
380             }
381         }, c);
382     }
383 
<span class="line-added">384     /*</span>
<span class="line-added">385      * Returns the JMenuItem accelerator. Implementation of this method is based</span>
<span class="line-added">386      * on AccessBridge.getAccelerator(AccessibleContext) to access the KeyStroke</span>
<span class="line-added">387      * and on AquaMenuPainter.paintMenuItem() to convert it to string.</span>
<span class="line-added">388      */</span>
<span class="line-added">389     @SuppressWarnings(&quot;deprecation&quot;)</span>
<span class="line-added">390     private static String getAcceleratorText(AccessibleContext ac) {</span>
<span class="line-added">391         String accText = &quot;&quot;;</span>
<span class="line-added">392         Accessible parent = ac.getAccessibleParent();</span>
<span class="line-added">393         if (parent != null) {</span>
<span class="line-added">394             // workaround for getAccessibleKeyBinding not returning the</span>
<span class="line-added">395             // JMenuItem accelerator</span>
<span class="line-added">396             int indexInParent = ac.getAccessibleIndexInParent();</span>
<span class="line-added">397             Accessible child = parent.getAccessibleContext()</span>
<span class="line-added">398                                      .getAccessibleChild(indexInParent);</span>
<span class="line-added">399             if (child instanceof JMenuItem) {</span>
<span class="line-added">400                 JMenuItem menuItem = (JMenuItem) child;</span>
<span class="line-added">401                 KeyStroke keyStroke = menuItem.getAccelerator();</span>
<span class="line-added">402                 if (keyStroke != null) {</span>
<span class="line-added">403                     int modifiers = keyStroke.getModifiers();</span>
<span class="line-added">404                     if (modifiers &gt; 0) {</span>
<span class="line-added">405                         accText = KeyEvent.getKeyModifiersText(modifiers);</span>
<span class="line-added">406                     }</span>
<span class="line-added">407                     int keyCode = keyStroke.getKeyCode();</span>
<span class="line-added">408                     if (keyCode != 0) {</span>
<span class="line-added">409                         accText += KeyEvent.getKeyText(keyCode);</span>
<span class="line-added">410                     } else {</span>
<span class="line-added">411                         accText += keyStroke.getKeyChar();</span>
<span class="line-added">412                     }</span>
<span class="line-added">413                 }</span>
<span class="line-added">414             }</span>
<span class="line-added">415         }</span>
<span class="line-added">416         return accText;</span>
<span class="line-added">417     }</span>
<span class="line-added">418 </span>
419     public static String getAccessibleDescription(final Accessible a, final Component c) {
420         if (a == null) return null;
421 
422         return invokeAndWait(new Callable&lt;String&gt;() {
423             public String call() throws Exception {
424                 final AccessibleContext ac = a.getAccessibleContext();
425                 if (ac == null) return null;
426 
427                 final String accessibleDescription = ac.getAccessibleDescription();
428                 if (accessibleDescription == null) {
429                     if (c instanceof JComponent) {
430                         String toolTipText = ((JComponent)c).getToolTipText();
431                         if (toolTipText != null) {
432                             return toolTipText;
433                         }
434                     }
435                 }
436 
437                 return accessibleDescription;
438             }
</pre>
</td>
</tr>
</table>
<center><a href="../LWWindowPeer.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="CAccessible.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>