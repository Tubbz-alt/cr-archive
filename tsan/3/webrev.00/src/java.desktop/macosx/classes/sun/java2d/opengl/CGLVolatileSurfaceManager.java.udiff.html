<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/macosx/classes/sun/java2d/opengl/CGLVolatileSurfaceManager.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="CGLSurfaceData.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../lwawt/LWComponentPeer.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/macosx/classes/sun/java2d/opengl/CGLVolatileSurfaceManager.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2011, 2015, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -23,27 +23,19 @@</span>
   * questions.
   */
  
  package sun.java2d.opengl;
  
<span class="udiff-line-removed">- import java.awt.BufferCapabilities;</span>
<span class="udiff-line-removed">- import static java.awt.BufferCapabilities.FlipContents.*;</span>
<span class="udiff-line-removed">- import java.awt.Component;</span>
  import java.awt.GraphicsConfiguration;
  import java.awt.Transparency;
  import java.awt.image.ColorModel;
<span class="udiff-line-removed">- import java.awt.peer.ComponentPeer;</span>
  
<span class="udiff-line-removed">- import sun.awt.AWTAccessor;</span>
<span class="udiff-line-removed">- import sun.awt.AWTAccessor.ComponentAccessor;</span>
  import sun.awt.image.SunVolatileImage;
  import sun.awt.image.VolatileSurfaceManager;
<span class="udiff-line-removed">- import sun.java2d.BackBufferCapsProvider;</span>
  import sun.java2d.SurfaceData;
<span class="udiff-line-modified-removed">- import static sun.java2d.opengl.OGLContext.OGLContextCaps.*;</span>
<span class="udiff-line-modified-removed">- import sun.java2d.pipe.hw.ExtendedBufferCapabilities;</span>
<span class="udiff-line-removed">- import static sun.java2d.pipe.hw.ExtendedBufferCapabilities.VSyncType.*;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ import static sun.java2d.opengl.OGLContext.OGLContextCaps.CAPS_EXT_FBOBJECT;</span>
  
  public class CGLVolatileSurfaceManager extends VolatileSurfaceManager {
  
      private final boolean accelerationEnabled;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -69,68 +61,24 @@</span>
      /**
       * Create a FBO-based SurfaceData object (or init the backbuffer
       * of an existing window if this is a double buffered GraphicsConfig)
       */
      protected SurfaceData initAcceleratedSurface() {
<span class="udiff-line-removed">-         SurfaceData sData = null;</span>
<span class="udiff-line-removed">-         Component comp = vImg.getComponent();</span>
<span class="udiff-line-removed">-         final ComponentAccessor acc = AWTAccessor.getComponentAccessor();</span>
<span class="udiff-line-removed">-         final ComponentPeer peer = (comp != null) ? acc.getPeer(comp) : null;</span>
<span class="udiff-line-removed">- </span>
          try {
<span class="udiff-line-modified-removed">-             boolean createVSynced = false;</span>
<span class="udiff-line-modified-removed">-             boolean forceback = false;</span>
<span class="udiff-line-modified-removed">-             if (context instanceof Boolean) {</span>
<span class="udiff-line-modified-removed">-                 forceback = ((Boolean)context).booleanValue();</span>
<span class="udiff-line-modified-removed">-                 if (forceback &amp;&amp; peer instanceof BackBufferCapsProvider) {</span>
<span class="udiff-line-modified-removed">-                     BackBufferCapsProvider provider =</span>
<span class="udiff-line-modified-removed">-                         (BackBufferCapsProvider)peer;</span>
<span class="udiff-line-removed">-                     BufferCapabilities caps = provider.getBackBufferCaps();</span>
<span class="udiff-line-removed">-                     if (caps instanceof ExtendedBufferCapabilities) {</span>
<span class="udiff-line-removed">-                         ExtendedBufferCapabilities ebc =</span>
<span class="udiff-line-removed">-                             (ExtendedBufferCapabilities)caps;</span>
<span class="udiff-line-removed">-                         if (ebc.getVSync() == VSYNC_ON &amp;&amp;</span>
<span class="udiff-line-removed">-                             ebc.getFlipContents() == COPIED)</span>
<span class="udiff-line-removed">-                         {</span>
<span class="udiff-line-removed">-                             createVSynced = true;</span>
<span class="udiff-line-removed">-                             forceback = false;</span>
<span class="udiff-line-removed">-                         }</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-modified-added">+             CGLGraphicsConfig gc = (CGLGraphicsConfig)vImg.getGraphicsConfig();</span>
<span class="udiff-line-modified-added">+             ColorModel cm = gc.getColorModel(vImg.getTransparency());</span>
<span class="udiff-line-modified-added">+             int type = vImg.getForcedAccelSurfaceType();</span>
<span class="udiff-line-modified-added">+             // if acceleration type is forced (type != UNDEFINED) then</span>
<span class="udiff-line-modified-added">+             // use the forced type, otherwise choose FBOBJECT</span>
<span class="udiff-line-modified-added">+             if (type == OGLSurfaceData.UNDEFINED) {</span>
<span class="udiff-line-modified-added">+                 type = OGLSurfaceData.FBOBJECT;</span>
              }
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-             if (forceback) {</span>
<span class="udiff-line-modified-removed">-                 // peer must be non-null in this case</span>
<span class="udiff-line-modified-removed">-                 // TODO: modify parameter to delegate</span>
<span class="udiff-line-removed">-                 //                sData = CGLSurfaceData.createData(peer, vImg, FLIP_BACKBUFFER);</span>
<span class="udiff-line-removed">-             } else {</span>
<span class="udiff-line-removed">-                 CGLGraphicsConfig gc =</span>
<span class="udiff-line-removed">-                     (CGLGraphicsConfig)vImg.getGraphicsConfig();</span>
<span class="udiff-line-removed">-                 ColorModel cm = gc.getColorModel(vImg.getTransparency());</span>
<span class="udiff-line-removed">-                 int type = vImg.getForcedAccelSurfaceType();</span>
<span class="udiff-line-removed">-                 // if acceleration type is forced (type != UNDEFINED) then</span>
<span class="udiff-line-removed">-                 // use the forced type, otherwise choose FBOBJECT</span>
<span class="udiff-line-removed">-                 if (type == OGLSurfaceData.UNDEFINED) {</span>
<span class="udiff-line-removed">-                     type = OGLSurfaceData.FBOBJECT;</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-                 if (createVSynced) {</span>
<span class="udiff-line-removed">-                     // TODO: modify parameter to delegate</span>
<span class="udiff-line-removed">- //                  sData = CGLSurfaceData.createData(peer, vImg, type);</span>
<span class="udiff-line-removed">-                 } else {</span>
<span class="udiff-line-removed">-                     sData = CGLSurfaceData.createData(gc,</span>
<span class="udiff-line-removed">-                                                       vImg.getWidth(),</span>
<span class="udiff-line-removed">-                                                       vImg.getHeight(),</span>
<span class="udiff-line-removed">-                                                       cm, vImg, type);</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         } catch (NullPointerException ex) {</span>
<span class="udiff-line-removed">-             sData = null;</span>
<span class="udiff-line-removed">-         } catch (OutOfMemoryError er) {</span>
<span class="udiff-line-removed">-             sData = null;</span>
<span class="udiff-line-modified-added">+             return CGLSurfaceData.createData(gc, vImg.getWidth(),</span>
<span class="udiff-line-modified-added">+                                              vImg.getHeight(), cm, vImg, type);</span>
<span class="udiff-line-modified-added">+         } catch (NullPointerException | OutOfMemoryError ignored) {</span>
<span class="udiff-line-modified-added">+             return null;</span>
          }
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         return sData;</span>
      }
  
      @Override
      protected boolean isConfigValid(GraphicsConfiguration gc) {
          return ((gc == null) || (gc == vImg.getGraphicsConfig()));
</pre>
<center><a href="CGLSurfaceData.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../lwawt/LWComponentPeer.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>