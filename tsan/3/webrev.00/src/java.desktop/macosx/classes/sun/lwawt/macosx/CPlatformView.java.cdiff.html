<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/macosx/classes/sun/lwawt/macosx/CPlatformView.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="CPlatformResponder.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="CPlatformWindow.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/macosx/classes/sun/lwawt/macosx/CPlatformView.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2011, 2016, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 23,23 ***</span>
   * questions.
   */
  
  package sun.lwawt.macosx;
  
<span class="line-modified">! import java.awt.*;</span>
  import java.awt.geom.Rectangle2D;
  import java.util.concurrent.atomic.AtomicBoolean;
  import java.util.concurrent.atomic.AtomicInteger;
  import java.util.concurrent.atomic.AtomicReference;
  
<span class="line-removed">- import sun.awt.CGraphicsConfig;</span>
  import sun.awt.CGraphicsEnvironment;
<span class="line-removed">- import sun.lwawt.LWWindowPeer;</span>
<span class="line-removed">- </span>
  import sun.java2d.SurfaceData;
  import sun.java2d.opengl.CGLLayer;
<span class="line-modified">! import sun.java2d.opengl.CGLSurfaceData;</span>
  
  public class CPlatformView extends CFRetainedResource {
      private native long nativeCreateView(int x, int y, int width, int height, long windowLayerPtr);
      private static native void nativeSetAutoResizable(long awtView, boolean toResize);
      private static native int nativeGetNSViewDisplayID(long awtView);
<span class="line-new-header">--- 23,23 ---</span>
   * questions.
   */
  
  package sun.lwawt.macosx;
  
<span class="line-modified">! import java.awt.GraphicsDevice;</span>
<span class="line-added">+ import java.awt.GraphicsEnvironment;</span>
<span class="line-added">+ import java.awt.Point;</span>
<span class="line-added">+ import java.awt.Rectangle;</span>
  import java.awt.geom.Rectangle2D;
  import java.util.concurrent.atomic.AtomicBoolean;
  import java.util.concurrent.atomic.AtomicInteger;
  import java.util.concurrent.atomic.AtomicReference;
  
  import sun.awt.CGraphicsEnvironment;
  import sun.java2d.SurfaceData;
  import sun.java2d.opengl.CGLLayer;
<span class="line-modified">! import sun.lwawt.LWWindowPeer;</span>
  
  public class CPlatformView extends CFRetainedResource {
      private native long nativeCreateView(int x, int y, int width, int height, long windowLayerPtr);
      private static native void nativeSetAutoResizable(long awtView, boolean toResize);
      private static native int nativeGetNSViewDisplayID(long awtView);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 56,13 ***</span>
      }
  
      public void initialize(LWWindowPeer peer, CPlatformResponder responder) {
          initializeBase(peer, responder);
  
<span class="line-modified">!         if (!LWCToolkit.getSunAwtDisableCALayers()) {</span>
<span class="line-removed">-             this.windowLayer = createCGLayer();</span>
<span class="line-removed">-         }</span>
          setPtr(nativeCreateView(0, 0, 0, 0, getWindowLayerPtr()));
      }
  
      public CGLLayer createCGLayer() {
          return new CGLLayer(peer);
<span class="line-new-header">--- 56,11 ---</span>
      }
  
      public void initialize(LWWindowPeer peer, CPlatformResponder responder) {
          initializeBase(peer, responder);
  
<span class="line-modified">!         this.windowLayer = createCGLayer();</span>
          setPtr(nativeCreateView(0, 0, 0, 0, getWindowLayerPtr()));
      }
  
      public CGLLayer createCGLayer() {
          return new CGLLayer(peer);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 75,14 ***</span>
  
      public long getAWTView() {
          return ptr;
      }
  
<span class="line-removed">-     public boolean isOpaque() {</span>
<span class="line-removed">-         return !peer.isTranslucent();</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
      /*
       * All coordinates passed to the method should be based on the origin being in the bottom-left corner (standard
       * Cocoa coordinates).
       */
      public void setBounds(int x, int y, int width, int height) {
<span class="line-new-header">--- 73,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 92,63 ***</span>
      // REMIND: CGLSurfaceData expects top-level&#39;s size
      public Rectangle getBounds() {
          return peer.getBounds();
      }
  
<span class="line-removed">-     public Object getDestination() {</span>
<span class="line-removed">-         return peer;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
      public void setToolTip(String msg) {
          execute(ptr -&gt; CWrapper.NSView.setToolTip(ptr, msg));
      }
  
      // ----------------------------------------------------------------------
      // PAINTING METHODS
      // ----------------------------------------------------------------------
      public SurfaceData replaceSurfaceData() {
<span class="line-modified">!         if (!LWCToolkit.getSunAwtDisableCALayers()) {</span>
<span class="line-removed">-             surfaceData = windowLayer.replaceSurfaceData();</span>
<span class="line-removed">-         } else {</span>
<span class="line-removed">-             if (surfaceData == null) {</span>
<span class="line-removed">-                 CGraphicsConfig graphicsConfig = (CGraphicsConfig)getGraphicsConfiguration();</span>
<span class="line-removed">-                 surfaceData = graphicsConfig.createSurfaceData(this);</span>
<span class="line-removed">-             } else {</span>
<span class="line-removed">-                 validateSurface();</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
          return surfaceData;
      }
  
<span class="line-removed">-     private void validateSurface() {</span>
<span class="line-removed">-         if (surfaceData != null) {</span>
<span class="line-removed">-             ((CGLSurfaceData)surfaceData).validate();</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     public GraphicsConfiguration getGraphicsConfiguration() {</span>
<span class="line-removed">-         return peer.getGraphicsConfiguration();</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
      public SurfaceData getSurfaceData() {
          return surfaceData;
      }
  
      @Override
      public void dispose() {
<span class="line-modified">!         if (!LWCToolkit.getSunAwtDisableCALayers()) {</span>
<span class="line-removed">-             windowLayer.dispose();</span>
<span class="line-removed">-         }</span>
          super.dispose();
      }
  
      public long getWindowLayerPtr() {
<span class="line-modified">!         if (!LWCToolkit.getSunAwtDisableCALayers()) {</span>
<span class="line-removed">-             return windowLayer.getPointer();</span>
<span class="line-removed">-         } else {</span>
<span class="line-removed">-             return 0;</span>
<span class="line-removed">-         }</span>
      }
  
      public void setAutoResizable(boolean toResize) {
          execute(ptr -&gt; nativeSetAutoResizable(ptr, toResize));
      }
<span class="line-new-header">--- 86,34 ---</span>
      // REMIND: CGLSurfaceData expects top-level&#39;s size
      public Rectangle getBounds() {
          return peer.getBounds();
      }
  
      public void setToolTip(String msg) {
          execute(ptr -&gt; CWrapper.NSView.setToolTip(ptr, msg));
      }
  
      // ----------------------------------------------------------------------
      // PAINTING METHODS
      // ----------------------------------------------------------------------
      public SurfaceData replaceSurfaceData() {
<span class="line-modified">!         surfaceData = windowLayer.replaceSurfaceData();</span>
          return surfaceData;
      }
  
      public SurfaceData getSurfaceData() {
          return surfaceData;
      }
  
      @Override
      public void dispose() {
<span class="line-modified">!         windowLayer.dispose();</span>
          super.dispose();
      }
  
      public long getWindowLayerPtr() {
<span class="line-modified">!         return windowLayer.getPointer();</span>
      }
  
      public void setAutoResizable(boolean toResize) {
          execute(ptr -&gt; nativeSetAutoResizable(ptr, toResize));
      }
</pre>
<center><a href="CPlatformResponder.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="CPlatformWindow.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>