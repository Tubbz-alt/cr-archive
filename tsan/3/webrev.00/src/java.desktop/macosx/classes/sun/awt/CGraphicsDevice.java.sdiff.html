<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/macosx/classes/sun/awt/CGraphicsDevice.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="CGraphicsConfig.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../font/CFont.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/macosx/classes/sun/awt/CGraphicsDevice.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.awt;
 27 
 28 import java.awt.AWTPermission;
 29 import java.awt.DisplayMode;
 30 import java.awt.GraphicsConfiguration;
 31 import java.awt.GraphicsDevice;
 32 import java.awt.Insets;
 33 import java.awt.Rectangle;
 34 import java.awt.Window;
 35 import java.awt.geom.Rectangle2D;

 36 import java.util.Objects;
 37 
 38 import sun.java2d.SunGraphicsEnvironment;
 39 import sun.java2d.opengl.CGLGraphicsConfig;
 40 


 41 public final class CGraphicsDevice extends GraphicsDevice
 42         implements DisplayChangedListener {
 43 
 44     /**
 45      * CoreGraphics display ID. This identifier can become non-valid at any time
 46      * therefore methods, which is using this id should be ready to it.
 47      */
 48     private volatile int displayID;
 49     private volatile double xResolution;
 50     private volatile double yResolution;
 51     private volatile Rectangle bounds;
 52     private volatile int scale;
 53 
 54     private final GraphicsConfiguration config;
 55 
 56     private static AWTPermission fullScreenExclusivePermission;
 57 
 58     // Save/restore DisplayMode for the Full Screen mode
 59     private DisplayMode originalMode;
 60 
 61     public CGraphicsDevice(final int displayID) {
 62         this.displayID = displayID;
 63         config = CGLGraphicsConfig.getConfig(this, displayID, 0);




 64     }
 65 
 66     /**
 67      * Return a list of all configurations.
 68      */
 69     @Override
 70     public GraphicsConfiguration[] getConfigurations() {
 71         return new GraphicsConfiguration[]{config};
 72     }
 73 
 74     /**
 75      * Return the default configuration.
 76      */
 77     @Override
 78     public GraphicsConfiguration getDefaultConfiguration() {
 79         return config;
 80     }
 81 
 82     /**
 83      * Return a human-readable screen description.
</pre>
<hr />
<pre>
108 
109     Rectangle getBounds() {
110         return bounds.getBounds();
111     }
112 
113     public Insets getScreenInsets() {
114         // the insets are queried synchronously and are not cached
115         // since there are no Quartz or Cocoa means to receive notifications
116         // on insets changes (e.g. when the Dock is resized):
117         // the existing CGDisplayReconfigurationCallBack is not notified
118         // as well as the NSApplicationDidChangeScreenParametersNotification
119         // is fired on the Dock location changes only
120         return nativeGetScreenInsets(displayID);
121     }
122 
123     public int getScaleFactor() {
124         return scale;
125     }
126 
127     public void invalidate(final int defaultDisplayID) {

128         displayID = defaultDisplayID;
129     }
130 
131     @Override
132     public void displayChanged() {
133         xResolution = nativeGetXResolution(displayID);
134         yResolution = nativeGetYResolution(displayID);
135         bounds = nativeGetBounds(displayID).getBounds(); //does integer rounding
136         initScaleFactor();
<span class="line-modified">137         //TODO configs/fullscreenWindow/modes?</span>

138     }
139 
140     @Override
141     public void paletteChanged() {
142         // devices do not need to react to this event.
143     }
144 
145     /**
146      * Enters full-screen mode, or returns to windowed mode.
147      */
148     @Override
149     public synchronized void setFullScreenWindow(Window w) {
150         Window old = getFullScreenWindow();
151         if (w == old) {
152             return;
153         }
154 
155         boolean fsSupported = isFullScreenSupported();
156 
157         if (fsSupported &amp;&amp; old != null) {
</pre>
<hr />
<pre>
196                 return false;
197             }
198         }
199         return true;
200     }
201 
202     private static void enterFullScreenExclusive(Window w) {
203         FullScreenCapable peer = AWTAccessor.getComponentAccessor().getPeer(w);
204         if (peer != null) {
205             peer.enterFullScreenMode();
206         }
207     }
208 
209     private static void exitFullScreenExclusive(Window w) {
210         FullScreenCapable peer = AWTAccessor.getComponentAccessor().getPeer(w);
211         if (peer != null) {
212             peer.exitFullScreenMode();
213         }
214     }
215 












216     @Override
217     public boolean isDisplayChangeSupported() {
218         return true;
219     }
220 
221     @Override
222     public void setDisplayMode(final DisplayMode dm) {
223         if (dm == null) {
224             throw new IllegalArgumentException(&quot;Invalid display mode&quot;);
225         }
226         if (!Objects.equals(dm, getDisplayMode())) {
227             nativeSetDisplayMode(displayID, dm.getWidth(), dm.getHeight(),
<span class="line-modified">228                     dm.getBitDepth(), dm.getRefreshRate());</span>
<span class="line-removed">229             if (isFullScreenSupported() &amp;&amp; getFullScreenWindow() != null) {</span>
<span class="line-removed">230                 getFullScreenWindow().setSize(dm.getWidth(), dm.getHeight());</span>
<span class="line-removed">231             }</span>
232         }
233     }
234 
235     @Override
236     public DisplayMode getDisplayMode() {
237         return nativeGetDisplayMode(displayID);
238     }
239 
240     @Override
241     public DisplayMode[] getDisplayModes() {
242         return nativeGetDisplayModes(displayID);
243     }
244 
245     private void initScaleFactor() {
246         if (SunGraphicsEnvironment.isUIScaleEnabled()) {
247             double debugScale = SunGraphicsEnvironment.getDebugScale();
248             scale = (int) (debugScale &gt;= 1
249                     ? Math.round(debugScale)
250                     : nativeGetScaleFactor(displayID));
251         } else {
</pre>
</td>
<td>
<hr />
<pre>
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.awt;
 27 
 28 import java.awt.AWTPermission;
 29 import java.awt.DisplayMode;
 30 import java.awt.GraphicsConfiguration;
 31 import java.awt.GraphicsDevice;
 32 import java.awt.Insets;
 33 import java.awt.Rectangle;
 34 import java.awt.Window;
 35 import java.awt.geom.Rectangle2D;
<span class="line-added"> 36 import java.awt.peer.WindowPeer;</span>
 37 import java.util.Objects;
 38 
 39 import sun.java2d.SunGraphicsEnvironment;
 40 import sun.java2d.opengl.CGLGraphicsConfig;
 41 
<span class="line-added"> 42 import static java.awt.peer.ComponentPeer.SET_BOUNDS;</span>
<span class="line-added"> 43 </span>
 44 public final class CGraphicsDevice extends GraphicsDevice
 45         implements DisplayChangedListener {
 46 
 47     /**
 48      * CoreGraphics display ID. This identifier can become non-valid at any time
 49      * therefore methods, which is using this id should be ready to it.
 50      */
 51     private volatile int displayID;
 52     private volatile double xResolution;
 53     private volatile double yResolution;
 54     private volatile Rectangle bounds;
 55     private volatile int scale;
 56 
 57     private final GraphicsConfiguration config;
 58 
 59     private static AWTPermission fullScreenExclusivePermission;
 60 
 61     // Save/restore DisplayMode for the Full Screen mode
 62     private DisplayMode originalMode;
 63 
 64     public CGraphicsDevice(final int displayID) {
 65         this.displayID = displayID;
 66         config = CGLGraphicsConfig.getConfig(this, displayID, 0);
<span class="line-added"> 67         // initializes default device state, might be redundant step since we</span>
<span class="line-added"> 68         // call &quot;displayChanged()&quot; later anyway, but we do not want to leave the</span>
<span class="line-added"> 69         // device in an inconsistent state after construction</span>
<span class="line-added"> 70         displayChanged();</span>
 71     }
 72 
 73     /**
 74      * Return a list of all configurations.
 75      */
 76     @Override
 77     public GraphicsConfiguration[] getConfigurations() {
 78         return new GraphicsConfiguration[]{config};
 79     }
 80 
 81     /**
 82      * Return the default configuration.
 83      */
 84     @Override
 85     public GraphicsConfiguration getDefaultConfiguration() {
 86         return config;
 87     }
 88 
 89     /**
 90      * Return a human-readable screen description.
</pre>
<hr />
<pre>
115 
116     Rectangle getBounds() {
117         return bounds.getBounds();
118     }
119 
120     public Insets getScreenInsets() {
121         // the insets are queried synchronously and are not cached
122         // since there are no Quartz or Cocoa means to receive notifications
123         // on insets changes (e.g. when the Dock is resized):
124         // the existing CGDisplayReconfigurationCallBack is not notified
125         // as well as the NSApplicationDidChangeScreenParametersNotification
126         // is fired on the Dock location changes only
127         return nativeGetScreenInsets(displayID);
128     }
129 
130     public int getScaleFactor() {
131         return scale;
132     }
133 
134     public void invalidate(final int defaultDisplayID) {
<span class="line-added">135         //TODO do we need to restore the full-screen window/modes on old device?</span>
136         displayID = defaultDisplayID;
137     }
138 
139     @Override
140     public void displayChanged() {
141         xResolution = nativeGetXResolution(displayID);
142         yResolution = nativeGetYResolution(displayID);
143         bounds = nativeGetBounds(displayID).getBounds(); //does integer rounding
144         initScaleFactor();
<span class="line-modified">145         resizeFSWindow(getFullScreenWindow(), bounds);</span>
<span class="line-added">146         //TODO configs?</span>
147     }
148 
149     @Override
150     public void paletteChanged() {
151         // devices do not need to react to this event.
152     }
153 
154     /**
155      * Enters full-screen mode, or returns to windowed mode.
156      */
157     @Override
158     public synchronized void setFullScreenWindow(Window w) {
159         Window old = getFullScreenWindow();
160         if (w == old) {
161             return;
162         }
163 
164         boolean fsSupported = isFullScreenSupported();
165 
166         if (fsSupported &amp;&amp; old != null) {
</pre>
<hr />
<pre>
205                 return false;
206             }
207         }
208         return true;
209     }
210 
211     private static void enterFullScreenExclusive(Window w) {
212         FullScreenCapable peer = AWTAccessor.getComponentAccessor().getPeer(w);
213         if (peer != null) {
214             peer.enterFullScreenMode();
215         }
216     }
217 
218     private static void exitFullScreenExclusive(Window w) {
219         FullScreenCapable peer = AWTAccessor.getComponentAccessor().getPeer(w);
220         if (peer != null) {
221             peer.exitFullScreenMode();
222         }
223     }
224 
<span class="line-added">225     /**</span>
<span class="line-added">226      * Reapplies the size of this device to the full-screen window.</span>
<span class="line-added">227      */</span>
<span class="line-added">228     private static void resizeFSWindow(final Window w, final Rectangle b) {</span>
<span class="line-added">229         if (w != null) {</span>
<span class="line-added">230             WindowPeer peer = AWTAccessor.getComponentAccessor().getPeer(w);</span>
<span class="line-added">231             if (peer != null) {</span>
<span class="line-added">232                 peer.setBounds(b.x, b.y, b.width, b.height, SET_BOUNDS);</span>
<span class="line-added">233             }</span>
<span class="line-added">234         }</span>
<span class="line-added">235     }</span>
<span class="line-added">236 </span>
237     @Override
238     public boolean isDisplayChangeSupported() {
239         return true;
240     }
241 
242     @Override
243     public void setDisplayMode(final DisplayMode dm) {
244         if (dm == null) {
245             throw new IllegalArgumentException(&quot;Invalid display mode&quot;);
246         }
247         if (!Objects.equals(dm, getDisplayMode())) {
248             nativeSetDisplayMode(displayID, dm.getWidth(), dm.getHeight(),
<span class="line-modified">249                                  dm.getBitDepth(), dm.getRefreshRate());</span>



250         }
251     }
252 
253     @Override
254     public DisplayMode getDisplayMode() {
255         return nativeGetDisplayMode(displayID);
256     }
257 
258     @Override
259     public DisplayMode[] getDisplayModes() {
260         return nativeGetDisplayModes(displayID);
261     }
262 
263     private void initScaleFactor() {
264         if (SunGraphicsEnvironment.isUIScaleEnabled()) {
265             double debugScale = SunGraphicsEnvironment.getDebugScale();
266             scale = (int) (debugScale &gt;= 1
267                     ? Math.round(debugScale)
268                     : nativeGetScaleFactor(displayID));
269         } else {
</pre>
</td>
</tr>
</table>
<center><a href="CGraphicsConfig.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../font/CFont.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>