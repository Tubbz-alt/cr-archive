<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/macosx/classes/sun/lwawt/macosx/LWCToolkit.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="CWarningWindow.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../native/libawt_lwawt/awt/AWTEvent.m.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/macosx/classes/sun/lwawt/macosx/LWCToolkit.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  88 import java.net.MalformedURLException;
  89 import java.net.URL;
  90 import java.security.AccessController;
  91 import java.security.PrivilegedAction;
  92 import java.util.HashMap;
  93 import java.util.Locale;
  94 import java.util.Map;
  95 import java.util.MissingResourceException;
  96 import java.util.Objects;
  97 import java.util.ResourceBundle;
  98 import java.util.concurrent.Callable;
  99 
 100 import javax.swing.UIManager;
 101 
 102 import com.apple.laf.AquaMenuBarUI;
 103 import sun.awt.AWTAccessor;
 104 import sun.awt.AppContext;
 105 import sun.awt.CGraphicsConfig;
 106 import sun.awt.CGraphicsDevice;
 107 import sun.awt.LightweightFrame;

 108 import sun.awt.SunToolkit;
 109 import sun.awt.datatransfer.DataTransferer;
 110 import sun.awt.util.ThreadGroupUtils;
 111 import sun.java2d.opengl.OGLRenderQueue;
 112 import sun.lwawt.LWComponentPeer;
 113 import sun.lwawt.LWCursorManager;
 114 import sun.lwawt.LWToolkit;
 115 import sun.lwawt.LWWindowPeer;
 116 import sun.lwawt.LWWindowPeer.PeerType;
 117 import sun.lwawt.PlatformComponent;
 118 import sun.lwawt.PlatformDropTarget;
 119 import sun.lwawt.PlatformWindow;
 120 import sun.lwawt.SecurityWarningWindow;
<span class="line-removed"> 121 import sun.security.action.GetBooleanAction;</span>
 122 
 123 @SuppressWarnings(&quot;serial&quot;) // JDK implementation class
 124 final class NamedCursor extends Cursor {
 125     NamedCursor(String name) {
 126         super(name);
 127     }
 128 }
 129 
 130 /**
 131  * Mac OS X Cocoa-based AWT Toolkit.
 132  */
 133 public final class LWCToolkit extends LWToolkit {
 134     // While it is possible to enumerate all mouse devices
 135     // and query them for the number of buttons, the code
 136     // that does it is rather complex. Instead, we opt for
 137     // the easy way and just support up to 5 mouse buttons,
 138     // like Windows.
 139     private static final int BUTTONS = 5;
 140 
 141     private static native void initIDs();
</pre>
<hr />
<pre>
 146         System.err.flush();
 147 
 148         ResourceBundle platformResources = java.security.AccessController.doPrivileged(
 149                 new java.security.PrivilegedAction&lt;ResourceBundle&gt;() {
 150             @Override
 151             public ResourceBundle run() {
 152                 ResourceBundle platformResources = null;
 153                 try {
 154                     platformResources = ResourceBundle.getBundle(&quot;sun.awt.resources.awtosx&quot;);
 155                 } catch (MissingResourceException e) {
 156                     // No resource file; defaults will be used.
 157                 }
 158 
 159                 System.loadLibrary(&quot;awt&quot;);
 160                 System.loadLibrary(&quot;fontmanager&quot;);
 161 
 162                 return platformResources;
 163             }
 164         });
 165 
<span class="line-modified"> 166         if (!GraphicsEnvironment.isHeadless() &amp;&amp; !isInAquaSession()) {</span>


 167             throw new AWTError(&quot;WindowServer is not available&quot;);
 168         }
 169 
 170         AWTAccessor.getToolkitAccessor().setPlatformResources(platformResources);
 171 
 172         if (!GraphicsEnvironment.isHeadless()) {
 173             initIDs();
 174         }
 175         inAWT = AccessController.doPrivileged(new PrivilegedAction&lt;Boolean&gt;() {
 176             @Override
 177             public Boolean run() {
 178                 return !Boolean.parseBoolean(System.getProperty(&quot;javafx.embed.singleThread&quot;, &quot;false&quot;));
 179             }
 180         });
 181     }
 182 
 183     /*
 184      * If true  we operate in normal mode and nested runloop is executed in JavaRunLoopMode
 185      * If false we operate in singleThreaded FX/AWT interop mode and nested loop uses NSDefaultRunLoopMode
 186      */
 187     private static final boolean inAWT;
 188 
 189     public LWCToolkit() {
<span class="line-modified"> 190         areExtraMouseButtonsEnabled = Boolean.parseBoolean(System.getProperty(&quot;sun.awt.enableExtraMouseButtons&quot;, &quot;true&quot;));</span>
<span class="line-modified"> 191         //set system property if not yet assigned</span>
<span class="line-modified"> 192         System.setProperty(&quot;sun.awt.enableExtraMouseButtons&quot;, &quot;&quot;+areExtraMouseButtonsEnabled);</span>
<span class="line-modified"> 193         initAppkit(ThreadGroupUtils.getRootThreadGroup(), GraphicsEnvironment.isHeadless());</span>






 194     }
 195 
 196     /*
 197      * System colors with default initial values, overwritten by toolkit if system values differ and are available.
 198      */
 199     private static final int NUM_APPLE_COLORS = 3;
 200     public static final int KEYBOARD_FOCUS_COLOR = 0;
 201     public static final int INACTIVE_SELECTION_BACKGROUND_COLOR = 1;
 202     public static final int INACTIVE_SELECTION_FOREGROUND_COLOR = 2;
 203     private static int[] appleColors = {
 204         0xFF808080, // keyboardFocusColor = Color.gray;
 205         0xFFC0C0C0, // secondarySelectedControlColor
 206         0xFF303030, // controlDarkShadowColor
 207     };
 208 
 209     private native void loadNativeColors(final int[] systemColors, final int[] appleColors);
 210 
 211     @Override
 212     protected void loadSystemColors(final int[] systemColors) {
 213         if (systemColors == null) return;
</pre>
<hr />
<pre>
 418         }
 419         @Override
 420         protected char getMissingGlyphCharacter()
 421         {
 422             // Follow up for real implementation
 423             return (char)0xfff8; // see http://developer.apple.com/fonts/LastResortFont/
 424         }
 425     }
 426     @Override
 427     public FontPeer getFontPeer(String name, int style) {
 428         return new OSXPlatformFont(name, style);
 429     }
 430 
 431     @Override
 432     protected void initializeDesktopProperties() {
 433         super.initializeDesktopProperties();
 434         Map &lt;Object, Object&gt; fontHints = new HashMap&lt;&gt;();
 435         fontHints.put(RenderingHints.KEY_TEXT_ANTIALIASING, RenderingHints.VALUE_TEXT_ANTIALIAS_LCD_HRGB);
 436         desktopProperties.put(SunToolkit.DESKTOPFONTHINTS, fontHints);
 437         desktopProperties.put(&quot;awt.mouse.numButtons&quot;, BUTTONS);

 438 
 439         // These DnD properties must be set, otherwise Swing ends up spewing NPEs
 440         // all over the place. The values came straight off of MToolkit.
 441         desktopProperties.put(&quot;DnD.Autoscroll.initialDelay&quot;, Integer.valueOf(50));
 442         desktopProperties.put(&quot;DnD.Autoscroll.interval&quot;, Integer.valueOf(50));
 443         desktopProperties.put(&quot;DnD.Autoscroll.cursorHysteresis&quot;, Integer.valueOf(5));
 444 
 445         desktopProperties.put(&quot;DnD.isDragImageSupported&quot;, Boolean.TRUE);
 446 
 447         // Register DnD cursors
 448         desktopProperties.put(&quot;DnD.Cursor.CopyDrop&quot;, new NamedCursor(&quot;DnD.Cursor.CopyDrop&quot;));
 449         desktopProperties.put(&quot;DnD.Cursor.MoveDrop&quot;, new NamedCursor(&quot;DnD.Cursor.MoveDrop&quot;));
 450         desktopProperties.put(&quot;DnD.Cursor.LinkDrop&quot;, new NamedCursor(&quot;DnD.Cursor.LinkDrop&quot;));
 451         desktopProperties.put(&quot;DnD.Cursor.CopyNoDrop&quot;, new NamedCursor(&quot;DnD.Cursor.CopyNoDrop&quot;));
 452         desktopProperties.put(&quot;DnD.Cursor.MoveNoDrop&quot;, new NamedCursor(&quot;DnD.Cursor.MoveNoDrop&quot;));
 453         desktopProperties.put(&quot;DnD.Cursor.LinkNoDrop&quot;, new NamedCursor(&quot;DnD.Cursor.LinkNoDrop&quot;));
 454     }
 455 
 456     @Override
 457     protected boolean syncNativeQueue(long timeout) {
</pre>
<hr />
<pre>
 512 
 513             default:
 514                 throw new IllegalArgumentException(&quot;invalid key for Toolkit.getLockingKeyState&quot;);
 515         }
 516     }
 517 
 518     //Is it allowed to generate events assigned to extra mouse buttons.
 519     //Set to true by default.
 520     private static boolean areExtraMouseButtonsEnabled = true;
 521 
 522     @Override
 523     public boolean areExtraMouseButtonsEnabled() throws HeadlessException {
 524         return areExtraMouseButtonsEnabled;
 525     }
 526 
 527     @Override
 528     public int getNumberOfButtons(){
 529         return BUTTONS;
 530     }
 531 





 532     @Override
 533     public boolean isTraySupported() {
 534         return true;
 535     }
 536 
 537     @Override
 538     public DataTransferer getDataTransferer() {
 539         return CDataTransferer.getInstanceImpl();
 540     }
 541 
 542     @Override
 543     public boolean isAlwaysOnTopSupported() {
 544         return true;
 545     }
 546 
 547     private static final String APPKIT_THREAD_NAME = &quot;AppKit Thread&quot;;
 548 
 549     // Intended to be called from the LWCToolkit.m only.
 550     private static void installToolkitThreadInJava() {
 551         Thread.currentThread().setName(APPKIT_THREAD_NAME);
</pre>
<hr />
<pre>
 771                                                   Component component,
 772                                                   LWComponentPeer&lt;?, ?&gt; peer) {
 773         return new CDropTarget(dropTarget, component, peer);
 774     }
 775 
 776     // InputMethodSupport Method
 777     /**
 778      * Returns the default keyboard locale of the underlying operating system
 779      */
 780     @Override
 781     public Locale getDefaultKeyboardLocale() {
 782         Locale locale = CInputMethod.getNativeLocale();
 783 
 784         if (locale == null) {
 785             return super.getDefaultKeyboardLocale();
 786         }
 787 
 788         return locale;
 789     }
 790 

















 791     @Override
 792     public InputMethodDescriptor getInputMethodAdapterDescriptor() {
 793         if (sInputMethodDescriptor == null)
 794             sInputMethodDescriptor = new CInputMethodDescriptor();
 795 
 796         return sInputMethodDescriptor;
 797     }
 798 
 799     /**
 800      * Returns a map of visual attributes for thelevel description
 801      * of the given input method highlight, or null if no mapping is found.
 802      * The style field of the input method highlight is ignored. The map
 803      * returned is unmodifiable.
 804      * @param highlight input method highlight
 805      * @return style attribute map, or null
 806      * @since 1.3
 807      */
 808     @Override
 809     public Map&lt;TextAttribute, ?&gt; mapInputMethodHighlight(InputMethodHighlight highlight) {
 810         return CInputMethod.mapInputMethodHighlight(highlight);
</pre>
<hr />
<pre>
 821     }
 822 
 823     /**
 824      * Tests whether specified key modifiers mask can be used to enter a
 825      * printable character.
 826      */
 827     @Override
 828     @SuppressWarnings(&quot;deprecation&quot;)
 829     public boolean isPrintableCharacterModifiersMask(int mods) {
 830         return ((mods &amp; (InputEvent.META_MASK | InputEvent.CTRL_MASK)) == 0);
 831     }
 832 
 833     /**
 834      * Returns whether popup is allowed to be shown above the task bar.
 835      */
 836     @Override
 837     public boolean canPopupOverlapTaskBar() {
 838         return false;
 839     }
 840 
<span class="line-removed"> 841     private static Boolean sunAwtDisableCALayers = null;</span>
<span class="line-removed"> 842 </span>
<span class="line-removed"> 843     /**</span>
<span class="line-removed"> 844      * Returns the value of &quot;sun.awt.disableCALayers&quot; property. Default</span>
<span class="line-removed"> 845      * value is {@code false}.</span>
<span class="line-removed"> 846      */</span>
<span class="line-removed"> 847     public static synchronized boolean getSunAwtDisableCALayers() {</span>
<span class="line-removed"> 848         if (sunAwtDisableCALayers == null) {</span>
<span class="line-removed"> 849             sunAwtDisableCALayers = AccessController.doPrivileged(</span>
<span class="line-removed"> 850                 new GetBooleanAction(&quot;sun.awt.disableCALayers&quot;));</span>
<span class="line-removed"> 851         }</span>
<span class="line-removed"> 852         return sunAwtDisableCALayers;</span>
<span class="line-removed"> 853     }</span>
<span class="line-removed"> 854 </span>
 855     /*
 856      * Returns true if the application (one of its windows) owns keyboard focus.
 857      */
 858     native boolean isApplicationActive();
 859 
 860     /**
 861      * Returns true if AWT toolkit is embedded, false otherwise.
 862      *
 863      * @return true if AWT toolkit is embedded, false otherwise
 864      */
 865     public static native boolean isEmbedded();
 866 
<span class="line-removed"> 867     /**</span>
<span class="line-removed"> 868      * Returns true if the WindowServer is available, false otherwise.</span>
<span class="line-removed"> 869      *</span>
<span class="line-removed"> 870      * @return true if the WindowServer is available, false otherwise</span>
<span class="line-removed"> 871      */</span>
<span class="line-removed"> 872     private static native boolean isInAquaSession();</span>
<span class="line-removed"> 873 </span>
 874     /*
 875      * Activates application ignoring other apps.
 876      */
 877     public native void activateApplicationIgnoringOtherApps();
 878 
 879     /************************
 880      * Native methods section
 881      ************************/
 882 
 883     static native long createAWTRunLoopMediator();
 884     /**
 885      * Method to run a nested run-loop. The nested loop is spinned in the javaRunLoop mode, so selectors sent
 886      * by [JNFRunLoop performOnMainThreadWaiting] are processed.
 887      * @param mediator a native pointer to the mediator object created by createAWTRunLoopMediator
 888      * @param processEvents if true - dispatches event while in the nested loop. Used in DnD.
 889      *                      Additional attention is needed when using this feature as we short-circuit normal event
 890      *                      processing which could break Appkit.
 891      *                      (One known example is when the window is resized with the mouse)
 892      *
 893      *                      if false - all events come after exit form the nested loop
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  88 import java.net.MalformedURLException;
  89 import java.net.URL;
  90 import java.security.AccessController;
  91 import java.security.PrivilegedAction;
  92 import java.util.HashMap;
  93 import java.util.Locale;
  94 import java.util.Map;
  95 import java.util.MissingResourceException;
  96 import java.util.Objects;
  97 import java.util.ResourceBundle;
  98 import java.util.concurrent.Callable;
  99 
 100 import javax.swing.UIManager;
 101 
 102 import com.apple.laf.AquaMenuBarUI;
 103 import sun.awt.AWTAccessor;
 104 import sun.awt.AppContext;
 105 import sun.awt.CGraphicsConfig;
 106 import sun.awt.CGraphicsDevice;
 107 import sun.awt.LightweightFrame;
<span class="line-added"> 108 import sun.awt.PlatformGraphicsInfo;</span>
 109 import sun.awt.SunToolkit;
 110 import sun.awt.datatransfer.DataTransferer;
 111 import sun.awt.util.ThreadGroupUtils;
 112 import sun.java2d.opengl.OGLRenderQueue;
 113 import sun.lwawt.LWComponentPeer;
 114 import sun.lwawt.LWCursorManager;
 115 import sun.lwawt.LWToolkit;
 116 import sun.lwawt.LWWindowPeer;
 117 import sun.lwawt.LWWindowPeer.PeerType;
 118 import sun.lwawt.PlatformComponent;
 119 import sun.lwawt.PlatformDropTarget;
 120 import sun.lwawt.PlatformWindow;
 121 import sun.lwawt.SecurityWarningWindow;

 122 
 123 @SuppressWarnings(&quot;serial&quot;) // JDK implementation class
 124 final class NamedCursor extends Cursor {
 125     NamedCursor(String name) {
 126         super(name);
 127     }
 128 }
 129 
 130 /**
 131  * Mac OS X Cocoa-based AWT Toolkit.
 132  */
 133 public final class LWCToolkit extends LWToolkit {
 134     // While it is possible to enumerate all mouse devices
 135     // and query them for the number of buttons, the code
 136     // that does it is rather complex. Instead, we opt for
 137     // the easy way and just support up to 5 mouse buttons,
 138     // like Windows.
 139     private static final int BUTTONS = 5;
 140 
 141     private static native void initIDs();
</pre>
<hr />
<pre>
 146         System.err.flush();
 147 
 148         ResourceBundle platformResources = java.security.AccessController.doPrivileged(
 149                 new java.security.PrivilegedAction&lt;ResourceBundle&gt;() {
 150             @Override
 151             public ResourceBundle run() {
 152                 ResourceBundle platformResources = null;
 153                 try {
 154                     platformResources = ResourceBundle.getBundle(&quot;sun.awt.resources.awtosx&quot;);
 155                 } catch (MissingResourceException e) {
 156                     // No resource file; defaults will be used.
 157                 }
 158 
 159                 System.loadLibrary(&quot;awt&quot;);
 160                 System.loadLibrary(&quot;fontmanager&quot;);
 161 
 162                 return platformResources;
 163             }
 164         });
 165 
<span class="line-modified"> 166         if (!GraphicsEnvironment.isHeadless() &amp;&amp;</span>
<span class="line-added"> 167             !PlatformGraphicsInfo.isInAquaSession())</span>
<span class="line-added"> 168         {</span>
 169             throw new AWTError(&quot;WindowServer is not available&quot;);
 170         }
 171 
 172         AWTAccessor.getToolkitAccessor().setPlatformResources(platformResources);
 173 
 174         if (!GraphicsEnvironment.isHeadless()) {
 175             initIDs();
 176         }
 177         inAWT = AccessController.doPrivileged(new PrivilegedAction&lt;Boolean&gt;() {
 178             @Override
 179             public Boolean run() {
 180                 return !Boolean.parseBoolean(System.getProperty(&quot;javafx.embed.singleThread&quot;, &quot;false&quot;));
 181             }
 182         });
 183     }
 184 
 185     /*
 186      * If true  we operate in normal mode and nested runloop is executed in JavaRunLoopMode
 187      * If false we operate in singleThreaded FX/AWT interop mode and nested loop uses NSDefaultRunLoopMode
 188      */
 189     private static final boolean inAWT;
 190 
 191     public LWCToolkit() {
<span class="line-modified"> 192         final String extraButtons = &quot;sun.awt.enableExtraMouseButtons&quot;;</span>
<span class="line-modified"> 193         AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {</span>
<span class="line-modified"> 194             areExtraMouseButtonsEnabled =</span>
<span class="line-modified"> 195                  Boolean.parseBoolean(System.getProperty(extraButtons, &quot;true&quot;));</span>
<span class="line-added"> 196             //set system property if not yet assigned</span>
<span class="line-added"> 197             System.setProperty(extraButtons, &quot;&quot;+areExtraMouseButtonsEnabled);</span>
<span class="line-added"> 198             initAppkit(ThreadGroupUtils.getRootThreadGroup(),</span>
<span class="line-added"> 199                        GraphicsEnvironment.isHeadless());</span>
<span class="line-added"> 200             return null;</span>
<span class="line-added"> 201         });</span>
 202     }
 203 
 204     /*
 205      * System colors with default initial values, overwritten by toolkit if system values differ and are available.
 206      */
 207     private static final int NUM_APPLE_COLORS = 3;
 208     public static final int KEYBOARD_FOCUS_COLOR = 0;
 209     public static final int INACTIVE_SELECTION_BACKGROUND_COLOR = 1;
 210     public static final int INACTIVE_SELECTION_FOREGROUND_COLOR = 2;
 211     private static int[] appleColors = {
 212         0xFF808080, // keyboardFocusColor = Color.gray;
 213         0xFFC0C0C0, // secondarySelectedControlColor
 214         0xFF303030, // controlDarkShadowColor
 215     };
 216 
 217     private native void loadNativeColors(final int[] systemColors, final int[] appleColors);
 218 
 219     @Override
 220     protected void loadSystemColors(final int[] systemColors) {
 221         if (systemColors == null) return;
</pre>
<hr />
<pre>
 426         }
 427         @Override
 428         protected char getMissingGlyphCharacter()
 429         {
 430             // Follow up for real implementation
 431             return (char)0xfff8; // see http://developer.apple.com/fonts/LastResortFont/
 432         }
 433     }
 434     @Override
 435     public FontPeer getFontPeer(String name, int style) {
 436         return new OSXPlatformFont(name, style);
 437     }
 438 
 439     @Override
 440     protected void initializeDesktopProperties() {
 441         super.initializeDesktopProperties();
 442         Map &lt;Object, Object&gt; fontHints = new HashMap&lt;&gt;();
 443         fontHints.put(RenderingHints.KEY_TEXT_ANTIALIASING, RenderingHints.VALUE_TEXT_ANTIALIAS_LCD_HRGB);
 444         desktopProperties.put(SunToolkit.DESKTOPFONTHINTS, fontHints);
 445         desktopProperties.put(&quot;awt.mouse.numButtons&quot;, BUTTONS);
<span class="line-added"> 446         desktopProperties.put(&quot;awt.multiClickInterval&quot;, getMultiClickTime());</span>
 447 
 448         // These DnD properties must be set, otherwise Swing ends up spewing NPEs
 449         // all over the place. The values came straight off of MToolkit.
 450         desktopProperties.put(&quot;DnD.Autoscroll.initialDelay&quot;, Integer.valueOf(50));
 451         desktopProperties.put(&quot;DnD.Autoscroll.interval&quot;, Integer.valueOf(50));
 452         desktopProperties.put(&quot;DnD.Autoscroll.cursorHysteresis&quot;, Integer.valueOf(5));
 453 
 454         desktopProperties.put(&quot;DnD.isDragImageSupported&quot;, Boolean.TRUE);
 455 
 456         // Register DnD cursors
 457         desktopProperties.put(&quot;DnD.Cursor.CopyDrop&quot;, new NamedCursor(&quot;DnD.Cursor.CopyDrop&quot;));
 458         desktopProperties.put(&quot;DnD.Cursor.MoveDrop&quot;, new NamedCursor(&quot;DnD.Cursor.MoveDrop&quot;));
 459         desktopProperties.put(&quot;DnD.Cursor.LinkDrop&quot;, new NamedCursor(&quot;DnD.Cursor.LinkDrop&quot;));
 460         desktopProperties.put(&quot;DnD.Cursor.CopyNoDrop&quot;, new NamedCursor(&quot;DnD.Cursor.CopyNoDrop&quot;));
 461         desktopProperties.put(&quot;DnD.Cursor.MoveNoDrop&quot;, new NamedCursor(&quot;DnD.Cursor.MoveNoDrop&quot;));
 462         desktopProperties.put(&quot;DnD.Cursor.LinkNoDrop&quot;, new NamedCursor(&quot;DnD.Cursor.LinkNoDrop&quot;));
 463     }
 464 
 465     @Override
 466     protected boolean syncNativeQueue(long timeout) {
</pre>
<hr />
<pre>
 521 
 522             default:
 523                 throw new IllegalArgumentException(&quot;invalid key for Toolkit.getLockingKeyState&quot;);
 524         }
 525     }
 526 
 527     //Is it allowed to generate events assigned to extra mouse buttons.
 528     //Set to true by default.
 529     private static boolean areExtraMouseButtonsEnabled = true;
 530 
 531     @Override
 532     public boolean areExtraMouseButtonsEnabled() throws HeadlessException {
 533         return areExtraMouseButtonsEnabled;
 534     }
 535 
 536     @Override
 537     public int getNumberOfButtons(){
 538         return BUTTONS;
 539     }
 540 
<span class="line-added"> 541     /**</span>
<span class="line-added"> 542      * Returns the double-click time interval in ms.</span>
<span class="line-added"> 543      */</span>
<span class="line-added"> 544     private static native int getMultiClickTime();</span>
<span class="line-added"> 545 </span>
 546     @Override
 547     public boolean isTraySupported() {
 548         return true;
 549     }
 550 
 551     @Override
 552     public DataTransferer getDataTransferer() {
 553         return CDataTransferer.getInstanceImpl();
 554     }
 555 
 556     @Override
 557     public boolean isAlwaysOnTopSupported() {
 558         return true;
 559     }
 560 
 561     private static final String APPKIT_THREAD_NAME = &quot;AppKit Thread&quot;;
 562 
 563     // Intended to be called from the LWCToolkit.m only.
 564     private static void installToolkitThreadInJava() {
 565         Thread.currentThread().setName(APPKIT_THREAD_NAME);
</pre>
<hr />
<pre>
 785                                                   Component component,
 786                                                   LWComponentPeer&lt;?, ?&gt; peer) {
 787         return new CDropTarget(dropTarget, component, peer);
 788     }
 789 
 790     // InputMethodSupport Method
 791     /**
 792      * Returns the default keyboard locale of the underlying operating system
 793      */
 794     @Override
 795     public Locale getDefaultKeyboardLocale() {
 796         Locale locale = CInputMethod.getNativeLocale();
 797 
 798         if (locale == null) {
 799             return super.getDefaultKeyboardLocale();
 800         }
 801 
 802         return locale;
 803     }
 804 
<span class="line-added"> 805     public static boolean isLocaleUSInternationalPC(Locale locale) {</span>
<span class="line-added"> 806         return (locale != null ?</span>
<span class="line-added"> 807             locale.toString().equals(&quot;_US_UserDefined_15000&quot;) : false);</span>
<span class="line-added"> 808     }</span>
<span class="line-added"> 809 </span>
<span class="line-added"> 810     public static boolean isCharModifierKeyInUSInternationalPC(char ch) {</span>
<span class="line-added"> 811         // 5 characters: APOSTROPHE, QUOTATION MARK, ACCENT GRAVE, SMALL TILDE,</span>
<span class="line-added"> 812         // CIRCUMFLEX ACCENT</span>
<span class="line-added"> 813         final char[] modifierKeys = {&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;`&#39;, &#39;\u02DC&#39;, &#39;\u02C6&#39;};</span>
<span class="line-added"> 814         for (char modKey : modifierKeys) {</span>
<span class="line-added"> 815             if (modKey == ch) {</span>
<span class="line-added"> 816                 return true;</span>
<span class="line-added"> 817             }</span>
<span class="line-added"> 818         }</span>
<span class="line-added"> 819         return false;</span>
<span class="line-added"> 820     }</span>
<span class="line-added"> 821 </span>
 822     @Override
 823     public InputMethodDescriptor getInputMethodAdapterDescriptor() {
 824         if (sInputMethodDescriptor == null)
 825             sInputMethodDescriptor = new CInputMethodDescriptor();
 826 
 827         return sInputMethodDescriptor;
 828     }
 829 
 830     /**
 831      * Returns a map of visual attributes for thelevel description
 832      * of the given input method highlight, or null if no mapping is found.
 833      * The style field of the input method highlight is ignored. The map
 834      * returned is unmodifiable.
 835      * @param highlight input method highlight
 836      * @return style attribute map, or null
 837      * @since 1.3
 838      */
 839     @Override
 840     public Map&lt;TextAttribute, ?&gt; mapInputMethodHighlight(InputMethodHighlight highlight) {
 841         return CInputMethod.mapInputMethodHighlight(highlight);
</pre>
<hr />
<pre>
 852     }
 853 
 854     /**
 855      * Tests whether specified key modifiers mask can be used to enter a
 856      * printable character.
 857      */
 858     @Override
 859     @SuppressWarnings(&quot;deprecation&quot;)
 860     public boolean isPrintableCharacterModifiersMask(int mods) {
 861         return ((mods &amp; (InputEvent.META_MASK | InputEvent.CTRL_MASK)) == 0);
 862     }
 863 
 864     /**
 865      * Returns whether popup is allowed to be shown above the task bar.
 866      */
 867     @Override
 868     public boolean canPopupOverlapTaskBar() {
 869         return false;
 870     }
 871 














 872     /*
 873      * Returns true if the application (one of its windows) owns keyboard focus.
 874      */
 875     native boolean isApplicationActive();
 876 
 877     /**
 878      * Returns true if AWT toolkit is embedded, false otherwise.
 879      *
 880      * @return true if AWT toolkit is embedded, false otherwise
 881      */
 882     public static native boolean isEmbedded();
 883 







 884     /*
 885      * Activates application ignoring other apps.
 886      */
 887     public native void activateApplicationIgnoringOtherApps();
 888 
 889     /************************
 890      * Native methods section
 891      ************************/
 892 
 893     static native long createAWTRunLoopMediator();
 894     /**
 895      * Method to run a nested run-loop. The nested loop is spinned in the javaRunLoop mode, so selectors sent
 896      * by [JNFRunLoop performOnMainThreadWaiting] are processed.
 897      * @param mediator a native pointer to the mediator object created by createAWTRunLoopMediator
 898      * @param processEvents if true - dispatches event while in the nested loop. Used in DnD.
 899      *                      Additional attention is needed when using this feature as we short-circuit normal event
 900      *                      processing which could break Appkit.
 901      *                      (One known example is when the window is resized with the mouse)
 902      *
 903      *                      if false - all events come after exit form the nested loop
</pre>
</td>
</tr>
</table>
<center><a href="CWarningWindow.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../native/libawt_lwawt/awt/AWTEvent.m.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>