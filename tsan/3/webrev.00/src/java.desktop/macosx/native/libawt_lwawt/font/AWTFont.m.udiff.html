<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/macosx/native/libawt_lwawt/font/AWTFont.m</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="AWTFont.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../java2d/opengl/CGLGraphicsConfig.h.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/macosx/native/libawt_lwawt/font/AWTFont.m</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -40,62 +40,31 @@</span>
  - (id) initWithFont:(NSFont *)font {
      self = [super init];
      if (self) {
          fFont = [font retain];
          fNativeCGFont = CTFontCopyGraphicsFont((CTFontRef)font, NULL);
<span class="udiff-line-removed">-         layoutTableCache = NULL;</span>
      }
      return self;
  }
  
<span class="udiff-line-removed">- static TTLayoutTableCache* newCFontLayoutTableCache() {</span>
<span class="udiff-line-removed">-   TTLayoutTableCache* ltc = calloc(1, sizeof(TTLayoutTableCache));</span>
<span class="udiff-line-removed">-   if (ltc) {</span>
<span class="udiff-line-removed">-     int i;</span>
<span class="udiff-line-removed">-     for(i=0;i&lt;LAYOUTCACHE_ENTRIES;i++) {</span>
<span class="udiff-line-removed">-       ltc-&gt;entries[i].len = -1;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">-   return ltc;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- static void freeCFontLayoutTableCache(TTLayoutTableCache* ltc) {</span>
<span class="udiff-line-removed">-   if (ltc) {</span>
<span class="udiff-line-removed">-     int i;</span>
<span class="udiff-line-removed">-     for(i=0;i&lt;LAYOUTCACHE_ENTRIES;i++) {</span>
<span class="udiff-line-removed">-       if(ltc-&gt;entries[i].ptr) free (ltc-&gt;entries[i].ptr);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     if (ltc-&gt;kernPairs) free(ltc-&gt;kernPairs);</span>
<span class="udiff-line-removed">-     free(ltc);</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  - (void) dealloc {
      [fFont release];
      fFont = nil;
  
      if (fNativeCGFont) {
          CGFontRelease(fNativeCGFont);
      fNativeCGFont = NULL;
<span class="udiff-line-removed">-     if (layoutTableCache != NULL) {</span>
<span class="udiff-line-removed">-         freeCFontLayoutTableCache(layoutTableCache);</span>
<span class="udiff-line-removed">-         layoutTableCache = NULL;</span>
<span class="udiff-line-removed">-     }</span>
      }
  
      [super dealloc];
  }
  
  - (void) finalize {
      if (fNativeCGFont) {
          CGFontRelease(fNativeCGFont);
      fNativeCGFont = NULL;
      }
<span class="udiff-line-removed">-     if (layoutTableCache != NULL) {</span>
<span class="udiff-line-removed">-         freeCFontLayoutTableCache(layoutTableCache);</span>
<span class="udiff-line-removed">-         layoutTableCache = NULL;</span>
<span class="udiff-line-removed">-     }</span>
      [super finalize];
  }
  
  + (AWTFont *) awtFontForName:(NSString *)name
                         style:(int)style
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -429,27 +398,10 @@</span>
  {
      AWTFont *awtFont = (AWTFont *)jlong_to_ptr(awtFontPtr);
      return (jlong)(awtFont-&gt;fNativeCGFont);
  }
  
<span class="udiff-line-removed">- /*</span>
<span class="udiff-line-removed">-  * Class:     sun_font_CFont</span>
<span class="udiff-line-removed">-  * Method:    getLayoutTableCacheNative</span>
<span class="udiff-line-removed">-  * Signature: (J)J</span>
<span class="udiff-line-removed">-  */</span>
<span class="udiff-line-removed">- JNIEXPORT jlong JNICALL</span>
<span class="udiff-line-removed">- Java_sun_font_CFont_getLayoutTableCacheNative</span>
<span class="udiff-line-removed">-     (JNIEnv *env, jclass clazz,</span>
<span class="udiff-line-removed">-      jlong awtFontPtr)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     AWTFont *awtFont = (AWTFont *)jlong_to_ptr(awtFontPtr);</span>
<span class="udiff-line-removed">-     if (awtFont-&gt;layoutTableCache == NULL) {</span>
<span class="udiff-line-removed">-         awtFont-&gt;layoutTableCache = newCFontLayoutTableCache();</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     return (jlong)(awtFont-&gt;layoutTableCache);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  /*
   * Class:     sun_font_CFont
   * Method:    getTableBytesNative
   * Signature: (JI)[B
   */
</pre>
<center><a href="AWTFont.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../java2d/opengl/CGLGraphicsConfig.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>