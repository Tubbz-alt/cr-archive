<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/macosx/native/libawt_lwawt/awt/AWTWindow.m</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="AWTView.m.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="CGraphicsDevice.m.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/macosx/native/libawt_lwawt/awt/AWTWindow.m</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 188 @synthesize isMinimizing;
 189 @synthesize keyNotificationRecd;
 190 
 191 - (void) updateMinMaxSize:(BOOL)resizable {
 192     if (resizable) {
 193         [self.nsWindow setMinSize:self.javaMinSize];
 194         [self.nsWindow setMaxSize:self.javaMaxSize];
 195     } else {
 196         NSRect currentFrame = [self.nsWindow frame];
 197         [self.nsWindow setMinSize:currentFrame.size];
 198         [self.nsWindow setMaxSize:currentFrame.size];
 199     }
 200 }
 201 
 202 // creates a new NSWindow style mask based on the _STYLE_PROP_BITMASK bits
 203 + (NSUInteger) styleMaskForStyleBits:(jint)styleBits {
 204     NSUInteger type = 0;
 205     if (IS(styleBits, DECORATED)) {
 206         type |= NSTitledWindowMask;
 207         if (IS(styleBits, CLOSEABLE))            type |= NSClosableWindowMask;
<span class="line-removed"> 208         if (IS(styleBits, MINIMIZABLE))          type |= NSMiniaturizableWindowMask;</span>
 209         if (IS(styleBits, RESIZABLE))            type |= NSResizableWindowMask;
 210         if (IS(styleBits, FULL_WINDOW_CONTENT))  type |= NSFullSizeContentViewWindowMask;
 211     } else {
 212         type |= NSBorderlessWindowMask;
 213     }
 214 

 215     if (IS(styleBits, TEXTURED))      type |= NSTexturedBackgroundWindowMask;
 216     if (IS(styleBits, UNIFIED))       type |= NSUnifiedTitleAndToolbarWindowMask;
 217     if (IS(styleBits, UTILITY))       type |= NSUtilityWindowMask;
 218     if (IS(styleBits, HUD))           type |= NSHUDWindowMask;
 219     if (IS(styleBits, SHEET))         type |= NSWindowStyleMaskDocModalWindow;
 220     if (IS(styleBits, NONACTIVATING)) type |= NSNonactivatingPanelMask;
 221 
 222     return type;
 223 }
 224 
 225 // updates _METHOD_PROP_BITMASK based properties on the window
 226 - (void) setPropertiesForStyleBits:(jint)bits mask:(jint)mask {
 227     if (IS(mask, RESIZABLE)) {
 228         BOOL resizable = IS(bits, RESIZABLE);
 229         [self updateMinMaxSize:resizable];
 230         [self.nsWindow setShowsResizeIndicator:resizable];
 231         // Zoom button should be disabled, if the window is not resizable,
 232         // otherwise button should be restored to initial state.
 233         BOOL zoom = resizable &amp;&amp; IS(bits, ZOOMABLE);
 234         [[self.nsWindow standardWindowButton:NSWindowZoomButton] setEnabled:zoom];
</pre>
<hr />
<pre>
1220 
1221     // TODO: not sure we need displayIfNeeded message in our view
1222     NSWindow *nsWindow = OBJC(windowPtr);
1223     [ThreadUtilities performOnMainThreadWaiting:NO block:^(){
1224 
1225         AWTWindow *window = (AWTWindow*)[nsWindow delegate];
1226 
1227         NSRect rect = ConvertNSScreenRect(NULL, jrect);
1228         [window constrainSize:&amp;rect.size];
1229 
1230         [nsWindow setFrame:rect display:YES];
1231 
1232         // only start tracking events if pointer is above the toplevel
1233         // TODO: should post an Entered event if YES.
1234         NSPoint mLocation = [NSEvent mouseLocation];
1235         [nsWindow setAcceptsMouseMovedEvents:NSPointInRect(mLocation, rect)];
1236 
1237         // ensure we repaint the whole window after the resize operation
1238         // (this will also re-enable screen updates, which were disabled above)
1239         // TODO: send PaintEvent









1240     }];
1241 
1242 JNF_COCOA_EXIT(env);
1243 }
1244 
1245 /*
1246  * Class:     sun_lwawt_macosx_CPlatformWindow
1247  * Method:    nativeSetNSWindowStandardFrame
1248  * Signature: (JDDDD)V
1249  */
1250 JNIEXPORT void JNICALL Java_sun_lwawt_macosx_CPlatformWindow_nativeSetNSWindowStandardFrame
1251 (JNIEnv *env, jclass clazz, jlong windowPtr, jdouble originX, jdouble originY,
1252      jdouble width, jdouble height)
1253 {
1254     JNF_COCOA_ENTER(env);
1255 
1256     NSRect jrect = NSMakeRect(originX, originY, width, height);
1257 
1258     NSWindow *nsWindow = OBJC(windowPtr);
1259     [ThreadUtilities performOnMainThreadWaiting:NO block:^(){
</pre>
</td>
<td>
<hr />
<pre>
 188 @synthesize isMinimizing;
 189 @synthesize keyNotificationRecd;
 190 
 191 - (void) updateMinMaxSize:(BOOL)resizable {
 192     if (resizable) {
 193         [self.nsWindow setMinSize:self.javaMinSize];
 194         [self.nsWindow setMaxSize:self.javaMaxSize];
 195     } else {
 196         NSRect currentFrame = [self.nsWindow frame];
 197         [self.nsWindow setMinSize:currentFrame.size];
 198         [self.nsWindow setMaxSize:currentFrame.size];
 199     }
 200 }
 201 
 202 // creates a new NSWindow style mask based on the _STYLE_PROP_BITMASK bits
 203 + (NSUInteger) styleMaskForStyleBits:(jint)styleBits {
 204     NSUInteger type = 0;
 205     if (IS(styleBits, DECORATED)) {
 206         type |= NSTitledWindowMask;
 207         if (IS(styleBits, CLOSEABLE))            type |= NSClosableWindowMask;

 208         if (IS(styleBits, RESIZABLE))            type |= NSResizableWindowMask;
 209         if (IS(styleBits, FULL_WINDOW_CONTENT))  type |= NSFullSizeContentViewWindowMask;
 210     } else {
 211         type |= NSBorderlessWindowMask;
 212     }
 213 
<span class="line-added"> 214     if (IS(styleBits, MINIMIZABLE))   type |= NSMiniaturizableWindowMask;</span>
 215     if (IS(styleBits, TEXTURED))      type |= NSTexturedBackgroundWindowMask;
 216     if (IS(styleBits, UNIFIED))       type |= NSUnifiedTitleAndToolbarWindowMask;
 217     if (IS(styleBits, UTILITY))       type |= NSUtilityWindowMask;
 218     if (IS(styleBits, HUD))           type |= NSHUDWindowMask;
 219     if (IS(styleBits, SHEET))         type |= NSWindowStyleMaskDocModalWindow;
 220     if (IS(styleBits, NONACTIVATING)) type |= NSNonactivatingPanelMask;
 221 
 222     return type;
 223 }
 224 
 225 // updates _METHOD_PROP_BITMASK based properties on the window
 226 - (void) setPropertiesForStyleBits:(jint)bits mask:(jint)mask {
 227     if (IS(mask, RESIZABLE)) {
 228         BOOL resizable = IS(bits, RESIZABLE);
 229         [self updateMinMaxSize:resizable];
 230         [self.nsWindow setShowsResizeIndicator:resizable];
 231         // Zoom button should be disabled, if the window is not resizable,
 232         // otherwise button should be restored to initial state.
 233         BOOL zoom = resizable &amp;&amp; IS(bits, ZOOMABLE);
 234         [[self.nsWindow standardWindowButton:NSWindowZoomButton] setEnabled:zoom];
</pre>
<hr />
<pre>
1220 
1221     // TODO: not sure we need displayIfNeeded message in our view
1222     NSWindow *nsWindow = OBJC(windowPtr);
1223     [ThreadUtilities performOnMainThreadWaiting:NO block:^(){
1224 
1225         AWTWindow *window = (AWTWindow*)[nsWindow delegate];
1226 
1227         NSRect rect = ConvertNSScreenRect(NULL, jrect);
1228         [window constrainSize:&amp;rect.size];
1229 
1230         [nsWindow setFrame:rect display:YES];
1231 
1232         // only start tracking events if pointer is above the toplevel
1233         // TODO: should post an Entered event if YES.
1234         NSPoint mLocation = [NSEvent mouseLocation];
1235         [nsWindow setAcceptsMouseMovedEvents:NSPointInRect(mLocation, rect)];
1236 
1237         // ensure we repaint the whole window after the resize operation
1238         // (this will also re-enable screen updates, which were disabled above)
1239         // TODO: send PaintEvent
<span class="line-added">1240 </span>
<span class="line-added">1241         // the macOS may ignore our &quot;setFrame&quot; request, in this, case the</span>
<span class="line-added">1242         // windowDidMove() will not come and we need to manually resync the</span>
<span class="line-added">1243         // &quot;java.awt.Window&quot; and NSWindow locations, because &quot;java.awt.Window&quot;</span>
<span class="line-added">1244         // already uses location ignored by the macOS.</span>
<span class="line-added">1245         // see sun.lwawt.LWWindowPeer#notifyReshape()</span>
<span class="line-added">1246         if (!NSEqualRects(rect, [nsWindow frame])) {</span>
<span class="line-added">1247             [window _deliverMoveResizeEvent];</span>
<span class="line-added">1248         }</span>
1249     }];
1250 
1251 JNF_COCOA_EXIT(env);
1252 }
1253 
1254 /*
1255  * Class:     sun_lwawt_macosx_CPlatformWindow
1256  * Method:    nativeSetNSWindowStandardFrame
1257  * Signature: (JDDDD)V
1258  */
1259 JNIEXPORT void JNICALL Java_sun_lwawt_macosx_CPlatformWindow_nativeSetNSWindowStandardFrame
1260 (JNIEnv *env, jclass clazz, jlong windowPtr, jdouble originX, jdouble originY,
1261      jdouble width, jdouble height)
1262 {
1263     JNF_COCOA_ENTER(env);
1264 
1265     NSRect jrect = NSMakeRect(originX, originY, width, height);
1266 
1267     NSWindow *nsWindow = OBJC(windowPtr);
1268     [ThreadUtilities performOnMainThreadWaiting:NO block:^(){
</pre>
</td>
</tr>
</table>
<center><a href="AWTView.m.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="CGraphicsDevice.m.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>