<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/macosx/native/libawt_lwawt/awt/CMenuItem.m</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="CMenu.m.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="CRobot.m.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/macosx/native/libawt_lwawt/awt/CMenuItem.m</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -68,70 +68,50 @@</span>
  // Events
  - (void)handleAction:(NSMenuItem *)sender {
      AWT_ASSERT_APPKIT_THREAD;
      JNIEnv *env = [ThreadUtilities getJNIEnv];
      JNF_COCOA_ENTER(env);
<span class="udiff-line-modified-removed">-     </span>
<span class="udiff-line-modified-added">+ </span>
      // If we are called as a result of user pressing a shortcut, do nothing,
      // because AVTView has already sent corresponding key event to the Java
      // layer from performKeyEquivalent.
      // There is an exception from the rule above, though: if a window with
      // a menu gets minimized by user and there are no other windows to take
      // focus, the window&#39;s menu won&#39;t be removed from the global menu bar.
      // However, the Java layer won&#39;t handle invocation by a shortcut coming
      // from this &quot;frameless&quot; menu, because there are no active windows. This
      // means we have to handle it here.
      NSEvent *currEvent = [[NSApplication sharedApplication] currentEvent];
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if ([currEvent type] == NSKeyDown) {</span>
<span class="udiff-line-added">+         // The action event can be ignored only if the key window is an AWT window.</span>
<span class="udiff-line-added">+         // Otherwise, the action event is the only notification and must be processed.</span>
<span class="udiff-line-added">+         NSWindow *keyWindow = [NSApp keyWindow];</span>
<span class="udiff-line-added">+         if (keyWindow != nil &amp;&amp; [AWTWindow isAWTWindow: keyWindow]) {</span>
<span class="udiff-line-added">+             return;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      if (fIsCheckbox) {
          static JNF_CLASS_CACHE(jc_CCheckboxMenuItem, &quot;sun/lwawt/macosx/CCheckboxMenuItem&quot;);
          static JNF_MEMBER_CACHE(jm_ckHandleAction, jc_CCheckboxMenuItem, &quot;handleAction&quot;, &quot;(Z)V&quot;);
<span class="udiff-line-modified-removed">-         </span>
<span class="udiff-line-modified-added">+ </span>
          // Send the opposite of what&#39;s currently checked -- the action
          // indicates what state we&#39;re going to.
          NSInteger state = [sender state];
          jboolean newState = (state == NSOnState ? JNI_FALSE : JNI_TRUE);
          JNFCallVoidMethod(env, fPeer, jm_ckHandleAction, newState);
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-removed">-     else {</span>
<span class="udiff-line-removed">-         if ([currEvent type] == NSKeyDown) {</span>
<span class="udiff-line-removed">-             // Event available through sender variable hence NSApplication</span>
<span class="udiff-line-removed">-             // not needed for checking the keyboard input sans the modifier keys</span>
<span class="udiff-line-removed">-             // Also, the method used to fetch eventKey earlier would be locale dependent</span>
<span class="udiff-line-removed">-             // With earlier implementation, if MenuKey: e EventKey: à¤¾ ; if input method</span>
<span class="udiff-line-removed">-             // is not U.S. (Devanagari in this case)</span>
<span class="udiff-line-removed">-             // With current implementation, EventKey = MenuKey = e irrespective of</span>
<span class="udiff-line-removed">-             // input method</span>
<span class="udiff-line-removed">-             NSString *eventKey = [sender keyEquivalent];</span>
<span class="udiff-line-removed">-             // Apple uses characters from private Unicode range for some of the</span>
<span class="udiff-line-removed">-             // keys, so we need to do the same translation here that we do</span>
<span class="udiff-line-removed">-             // for the regular key down events</span>
<span class="udiff-line-removed">-             if ([eventKey length] == 1) {</span>
<span class="udiff-line-removed">-                 unichar origChar = [eventKey characterAtIndex:0];</span>
<span class="udiff-line-removed">-                 unichar newChar =  NsCharToJavaChar(origChar, 0);</span>
<span class="udiff-line-removed">-                 if (newChar == java_awt_event_KeyEvent_CHAR_UNDEFINED) {</span>
<span class="udiff-line-removed">-                     newChar = origChar;</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-                 eventKey = [NSString stringWithCharacters: &amp;newChar length: 1];</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             // The action event can be ignored only if the key window is an AWT window.</span>
<span class="udiff-line-removed">-             // Otherwise, the action event is the only notification and must be processed.</span>
<span class="udiff-line-removed">-             NSWindow *keyWindow = [NSApp keyWindow];</span>
<span class="udiff-line-removed">-             if (keyWindow != nil &amp;&amp; [AWTWindow isAWTWindow: keyWindow]) {</span>
<span class="udiff-line-removed">-                 return;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         </span>
<span class="udiff-line-modified-added">+     } else {</span>
          static JNF_CLASS_CACHE(jc_CMenuItem, &quot;sun/lwawt/macosx/CMenuItem&quot;);
          static JNF_MEMBER_CACHE(jm_handleAction, jc_CMenuItem, &quot;handleAction&quot;, &quot;(JI)V&quot;); // AWT_THREADING Safe (event)
  
          NSUInteger modifiers = [currEvent modifierFlags];
          jint javaModifiers = NsKeyModifiersToJavaModifiers(modifiers, NO);
  
          JNFCallVoidMethod(env, fPeer, jm_handleAction, UTC(currEvent), javaModifiers); // AWT_THREADING Safe (event)
      }
      JNF_COCOA_EXIT(env);
<span class="udiff-line-removed">-     </span>
  }
  
  - (void) setJavaLabel:(NSString *)theLabel shortcut:(NSString *)theKeyEquivalent modifierMask:(jint)modifiers {
      
      NSUInteger modifierMask = 0;
</pre>
<center><a href="CMenu.m.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="CRobot.m.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>