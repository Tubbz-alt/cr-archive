<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/macosx/native/libosxapp/NSApplicationAWT.m</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../libjsound/PLATFORM_API_MacOSX_Ports.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../libsplashscreen/splashscreen_sys.m.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/macosx/native/libosxapp/NSApplicationAWT.m</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2011, 2017, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 48,11 ***</span>
  
  /**
   * Subtypes of NSApplicationDefined, which are used for custom events.
   */
  enum {
<span class="line-modified">!     ExecuteBlockEvent, NativeSyncQueueEvent</span>
  };
  
  @implementation NSApplicationAWT
  
  - (id) init
<span class="line-new-header">--- 48,11 ---</span>
  
  /**
   * Subtypes of NSApplicationDefined, which are used for custom events.
   */
  enum {
<span class="line-modified">!     ExecuteBlockEvent = 777, NativeSyncQueueEvent</span>
  };
  
  @implementation NSApplicationAWT
  
  - (id) init
</pre>
<hr />
<pre>
<span class="line-old-header">*** 89,10 ***</span>
<span class="line-new-header">--- 89,29 ---</span>
  {
  AWT_ASSERT_APPKIT_THREAD;
  
      JNIEnv *env = [ThreadUtilities getJNIEnv];
  
<span class="line-added">+     SEL appearanceSel = @selector(setAppearance:); // macOS 10.14+</span>
<span class="line-added">+     if ([self respondsToSelector:appearanceSel]) {</span>
<span class="line-added">+         NSString *appearanceProp = [PropertiesUtilities</span>
<span class="line-added">+                 javaSystemPropertyForKey:@&quot;apple.awt.application.appearance&quot;</span>
<span class="line-added">+                                  withEnv:env];</span>
<span class="line-added">+         if (![@&quot;system&quot; isEqual:appearanceProp]) {</span>
<span class="line-added">+             // by default use light mode, because dark mode is not supported yet</span>
<span class="line-added">+             NSAppearance *appearance = [NSAppearance appearanceNamed:NSAppearanceNameAqua];</span>
<span class="line-added">+             if (appearanceProp != nil) {</span>
<span class="line-added">+                 NSAppearance *requested = [NSAppearance appearanceNamed:appearanceProp];</span>
<span class="line-added">+                 if (requested != nil) {</span>
<span class="line-added">+                     appearance = requested;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+             }</span>
<span class="line-added">+             // [self setAppearance:appearance];</span>
<span class="line-added">+             [self performSelector:appearanceSel withObject:appearance];</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      // Get default nib file location
      // NOTE: This should learn about the current java.version. Probably best thru
      //  the Makefile system&#39;s -DFRAMEWORK_VERSION define. Need to be able to pass this
      //  thru to PB from the Makefile system and for local builds.
      NSString *defaultNibFile = [PropertiesUtilities javaSystemPropertyForKey:@&quot;apple.awt.application.nib&quot; withEnv:env];
</pre>
<hr />
<pre>
<span class="line-old-header">*** 364,15 ***</span>
  
  - (void)sendEvent:(NSEvent *)event
  {
      if ([event type] == NSApplicationDefined
              &amp;&amp; TS_EQUAL([event timestamp], dummyEventTimestamp)
<span class="line-modified">!             &amp;&amp; [event subtype] == NativeSyncQueueEvent) {</span>
          [seenDummyEventLock lockWhenCondition:NO];
          [seenDummyEventLock unlockWithCondition:YES];
<span class="line-modified">! </span>
<span class="line-modified">!     } else if ([event type] == NSApplicationDefined &amp;&amp; [event subtype] == ExecuteBlockEvent) {</span>
          void (^block)() = (void (^)()) [event data1];
          block();
          [block release];
      } else if ([event type] == NSKeyUp &amp;&amp; ([event modifierFlags] &amp; NSCommandKeyMask)) {
          // Cocoa won&#39;t send us key up event when releasing a key while Cmd is down,
<span class="line-new-header">--- 383,18 ---</span>
  
  - (void)sendEvent:(NSEvent *)event
  {
      if ([event type] == NSApplicationDefined
              &amp;&amp; TS_EQUAL([event timestamp], dummyEventTimestamp)
<span class="line-modified">!             &amp;&amp; (short)[event subtype] == NativeSyncQueueEvent</span>
<span class="line-added">+             &amp;&amp; [event data1] == NativeSyncQueueEvent</span>
<span class="line-added">+             &amp;&amp; [event data2] == NativeSyncQueueEvent) {</span>
          [seenDummyEventLock lockWhenCondition:NO];
          [seenDummyEventLock unlockWithCondition:YES];
<span class="line-modified">!     } else if ([event type] == NSApplicationDefined</span>
<span class="line-modified">!                &amp;&amp; (short)[event subtype] == ExecuteBlockEvent</span>
<span class="line-added">+                &amp;&amp; [event data1] != 0 &amp;&amp; [event data2] == ExecuteBlockEvent) {</span>
          void (^block)() = (void (^)()) [event data1];
          block();
          [block release];
      } else if ([event type] == NSKeyUp &amp;&amp; ([event modifierFlags] &amp; NSCommandKeyMask)) {
          // Cocoa won&#39;t send us key up event when releasing a key while Cmd is down,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 399,11 ***</span>
                                         timestamp: 0
                                      windowNumber: 0
                                           context: nil
                                           subtype: ExecuteBlockEvent
                                             data1: encode
<span class="line-modified">!                                            data2: 0];</span>
  
      [NSApp postEvent: event atStart: NO];
      [pool drain];
  }
  
<span class="line-new-header">--- 421,11 ---</span>
                                         timestamp: 0
                                      windowNumber: 0
                                           context: nil
                                           subtype: ExecuteBlockEvent
                                             data1: encode
<span class="line-modified">!                                            data2: ExecuteBlockEvent];</span>
  
      [NSApp postEvent: event atStart: NO];
      [pool drain];
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 417,12 ***</span>
                                     modifierFlags: 0
                                         timestamp: dummyEventTimestamp
                                      windowNumber: 0
                                           context: nil
                                           subtype: NativeSyncQueueEvent
<span class="line-modified">!                                            data1: 0</span>
<span class="line-modified">!                                            data2: 0];</span>
      if (useCocoa) {
          [NSApp postEvent:event atStart:NO];
      } else {
          ProcessSerialNumber psn;
          GetCurrentProcess(&amp;psn);
<span class="line-new-header">--- 439,12 ---</span>
                                     modifierFlags: 0
                                         timestamp: dummyEventTimestamp
                                      windowNumber: 0
                                           context: nil
                                           subtype: NativeSyncQueueEvent
<span class="line-modified">!                                            data1: NativeSyncQueueEvent</span>
<span class="line-modified">!                                            data2: NativeSyncQueueEvent];</span>
      if (useCocoa) {
          [NSApp postEvent:event atStart:NO];
      } else {
          ProcessSerialNumber psn;
          GetCurrentProcess(&amp;psn);
</pre>
<center><a href="../libjsound/PLATFORM_API_MacOSX_Ports.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../libsplashscreen/splashscreen_sys.m.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>