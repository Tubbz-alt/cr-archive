<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/CommandProcessor.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../module-info.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="HotSpotTypeDataBase.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/CommandProcessor.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -534,11 +534,12 @@</span>
                      }
                  }
                  // Not an address
                  boolean all = name.equals(&quot;-a&quot;);
                  Threads threads = VM.getVM().getThreads();
<span class="udiff-line-modified-removed">-                 for (JavaThread thread = threads.first(); thread != null; thread = thread.next()) {</span>
<span class="udiff-line-modified-added">+                 for (int i = 0; i &lt; threads.getNumberOfThreads(); i++) {</span>
<span class="udiff-line-added">+                     JavaThread thread = threads.getJavaThreadAt(i);</span>
                      ByteArrayOutputStream bos = new ByteArrayOutputStream();
                      thread.printThreadIDOn(new PrintStream(bos));
                      if (all || bos.toString().equals(name)) {
                          if (thread instanceof CompilerThread) {
                              CompilerThread ct = (CompilerThread)thread;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -896,11 +897,12 @@</span>
                      usage();
                  } else {
                      String name = t.nextToken();
                      boolean all = name.equals(&quot;-a&quot;);
                      Threads threads = VM.getVM().getThreads();
<span class="udiff-line-modified-removed">-                     for (JavaThread thread = threads.first(); thread != null; thread = thread.next()) {</span>
<span class="udiff-line-modified-added">+                     for (int i = 0; i &lt; threads.getNumberOfThreads(); i++) {</span>
<span class="udiff-line-added">+                         JavaThread thread = threads.getJavaThreadAt(i);</span>
                          ByteArrayOutputStream bos = new ByteArrayOutputStream();
                          thread.printThreadIDOn(new PrintStream(bos));
                          if (all || bos.toString().equals(name)) {
                            if (thread instanceof CompilerThread) {
                              CompilerThread ct = (CompilerThread)thread;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -925,11 +927,12 @@</span>
                      usage();
                  } else {
                      String name = t.nextToken();
                      boolean all = name.equals(&quot;-a&quot;);
                      Threads threads = VM.getVM().getThreads();
<span class="udiff-line-modified-removed">-                     for (JavaThread thread = threads.first(); thread != null; thread = thread.next()) {</span>
<span class="udiff-line-modified-added">+                     for (int i = 0; i &lt; threads.getNumberOfThreads(); i++) {</span>
<span class="udiff-line-added">+                         JavaThread thread = threads.getJavaThreadAt(i);</span>
                          ByteArrayOutputStream bos = new ByteArrayOutputStream();
                          thread.printThreadIDOn(new PrintStream(bos));
                          if (all || bos.toString().equals(name)) {
                            if (thread instanceof CompilerThread) {
                              CompilerThread ct = (CompilerThread)thread;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -952,11 +955,12 @@</span>
                      usage();
                  } else {
                      String name = t.nextToken();
                      boolean all = name.equals(&quot;-a&quot;);
                      Threads threads = VM.getVM().getThreads();
<span class="udiff-line-modified-removed">-                     for (JavaThread thread = threads.first(); thread != null; thread = thread.next()) {</span>
<span class="udiff-line-modified-added">+                     for (int i = 0; i &lt; threads.getNumberOfThreads(); i++) {</span>
<span class="udiff-line-added">+                         JavaThread thread = threads.getJavaThreadAt(i);</span>
                          ByteArrayOutputStream bos = new ByteArrayOutputStream();
                          thread.printThreadIDOn(new PrintStream(bos));
                          if (all || bos.toString().equals(name)) {
                              if (thread instanceof CompilerThread) {
                                  CompilerThread ct = (CompilerThread)thread;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1435,11 +1439,12 @@</span>
                  String type = t.nextToken();
                  final Address value = VM.getVM().getDebugger().parseAddress(t.nextToken());
                  final long stride = VM.getVM().getAddressSize();
                  if (type.equals(&quot;threads&quot;)) {
                      Threads threads = VM.getVM().getThreads();
<span class="udiff-line-modified-removed">-                     for (JavaThread thread = threads.first(); thread != null; thread = thread.next()) {</span>
<span class="udiff-line-modified-added">+                     for (int i = 0; i &lt; threads.getNumberOfThreads(); i++) {</span>
<span class="udiff-line-added">+                         JavaThread thread = threads.getJavaThreadAt(i);</span>
                          Address base = thread.getStackBase();
                          Address end = thread.getLastJavaSP();
                          if (end == null) continue;
                          if (end.lessThan(base)) {
                              Address tmp = base;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1559,11 +1564,12 @@</span>
                      usage();
                  } else {
                      String name = t.nextToken();
                      Threads threads = VM.getVM().getThreads();
                      boolean all = name.equals(&quot;-a&quot;);
<span class="udiff-line-modified-removed">-                     for (JavaThread thread = threads.first(); thread != null; thread = thread.next()) {</span>
<span class="udiff-line-modified-added">+                     for (int i = 0; i &lt; threads.getNumberOfThreads(); i++) {</span>
<span class="udiff-line-added">+                         JavaThread thread = threads.getJavaThreadAt(i);</span>
                          ByteArrayOutputStream bos = new ByteArrayOutputStream();
                          thread.printThreadIDOn(new PrintStream(bos));
                          if (all || bos.toString().equals(name)) {
                              out.println(&quot;Thread &quot; + bos.toString() + &quot; Address: &quot; + thread.getAddress());
                              HTMLGenerator gen = new HTMLGenerator(false);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1588,11 +1594,12 @@</span>
                      usage();
                  } else {
                      String name = t.nextToken();
                      Threads threads = VM.getVM().getThreads();
                      boolean all = name.equals(&quot;-a&quot;);
<span class="udiff-line-modified-removed">-                     for (JavaThread thread = threads.first(); thread != null; thread = thread.next()) {</span>
<span class="udiff-line-modified-added">+                     for (int i = 0; i &lt; threads.getNumberOfThreads(); i++) {</span>
<span class="udiff-line-added">+                         JavaThread thread = threads.getJavaThreadAt(i);</span>
                          ByteArrayOutputStream bos = new ByteArrayOutputStream();
                          thread.printThreadIDOn(new PrintStream(bos));
                          if (all || bos.toString().equals(name)) {
                              out.println(&quot;Thread &quot; + bos.toString() + &quot; Address &quot; + thread.getAddress());
                              thread.printInfoOn(out);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1611,11 +1618,12 @@</span>
              public void doit(Tokens t) {
                  if (t.countTokens() != 0) {
                      usage();
                  } else {
                      Threads threads = VM.getVM().getThreads();
<span class="udiff-line-modified-removed">-                     for (JavaThread thread = threads.first(); thread != null; thread = thread.next()) {</span>
<span class="udiff-line-modified-added">+                     for (int i = 0; i &lt; threads.getNumberOfThreads(); i++) {</span>
<span class="udiff-line-added">+                         JavaThread thread = threads.getJavaThreadAt(i);</span>
                          thread.printThreadIDOn(out);
                          out.println(&quot; &quot; + thread.getThreadName());
                          thread.printInfoOn(out);
                          out.println(&quot;\n...&quot;);
                      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1629,11 +1637,12 @@</span>
                      usage();
                  } else {
                      ArrayList nmethods = new ArrayList();
                      Threads threads = VM.getVM().getThreads();
                      HTMLGenerator gen = new HTMLGenerator(false);
<span class="udiff-line-modified-removed">-                     for (JavaThread thread = threads.first(); thread != null; thread = thread.next()) {</span>
<span class="udiff-line-modified-added">+                     for (int i = 0; i &lt; threads.getNumberOfThreads(); i++) {</span>
<span class="udiff-line-added">+                         JavaThread thread = threads.getJavaThreadAt(i);</span>
                          try {
                              for (JavaVFrame vf = thread.getLastJavaVFrameDbg(); vf != null; vf = vf.javaSender()) {
                                  if (vf instanceof CompiledVFrame) {
                                      NMethod c = ((CompiledVFrame)vf).getCode();
                                      if (!nmethods.contains(c)) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1720,10 +1729,12 @@</span>
          // nothing for now..
      }
  
      // called after debuggee attach
      private void postAttach() {
<span class="udiff-line-added">+         /*</span>
<span class="udiff-line-added">+          * JavaScript engine no longer works. For now disable it. Eventually we will remove it.</span>
          // create JavaScript engine and start it
          try {
              jsengine = new JSJavaScriptEngine() {
                          private ObjectReader reader = new ObjectReader();
                          private JSJavaFactory factory = new JSJavaFactoryImpl();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1763,10 +1774,11 @@</span>
              System.out.println(&quot;Warning! JS Engine can&#39;t start, some commands will not be available.&quot;);
              if (verboseExceptions) {
                  ex.printStackTrace(out);
              }
          }
<span class="udiff-line-added">+         */</span>
      }
  
      public void registerCommand(String cmd, String usage, final String func) {
          commands.put(cmd, new Command(cmd, usage, false) {
                                public void doit(Tokens t) {
</pre>
<center><a href="../../../module-info.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="HotSpotTypeDataBase.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>