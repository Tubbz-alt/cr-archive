<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/utilities/HeapHprofBinWriter.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AbstractHeapGraphWriter.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PointerFinder.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/utilities/HeapHprofBinWriter.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 706,12 ***</span>
          out.writeInt(0);                    // frame count
  
          int frameSerialNum = 0;
          int numThreads = 0;
          Threads threads = VM.getVM().getThreads();
<span class="line-modified">! </span>
<span class="line-modified">!         for (JavaThread thread = threads.first(); thread != null; thread = thread.next()) {</span>
              Oop threadObj = thread.getThreadObj();
              if (threadObj != null &amp;&amp; !thread.isExiting() &amp;&amp; !thread.isHiddenFromExternalView()) {
  
                  // dump thread stack trace
                  ThreadStackTrace st = new ThreadStackTrace(thread);
<span class="line-new-header">--- 706,12 ---</span>
          out.writeInt(0);                    // frame count
  
          int frameSerialNum = 0;
          int numThreads = 0;
          Threads threads = VM.getVM().getThreads();
<span class="line-modified">!         for (int i = 0; i &lt; threads.getNumberOfThreads(); i++) {</span>
<span class="line-modified">!             JavaThread thread = threads.getJavaThreadAt(i);</span>
              Oop threadObj = thread.getThreadObj();
              if (threadObj != null &amp;&amp; !thread.isExiting() &amp;&amp; !thread.isHiddenFromExternalView()) {
  
                  // dump thread stack trace
                  ThreadStackTrace st = new ThreadStackTrace(thread);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1096,14 ***</span>
      }
  
      private void writeSymbol(Symbol sym) throws IOException {
          // If name is already written don&#39;t write it again.
          if (names.add(sym)) {
<span class="line-modified">!             byte[] buf = sym.asString().getBytes(&quot;UTF-8&quot;);</span>
<span class="line-modified">!             writeHeader(HPROF_UTF8, buf.length + OBJ_ID_SIZE);</span>
<span class="line-modified">!             writeSymbolID(sym);</span>
<span class="line-modified">!             out.write(buf);</span>
          }
      }
  
      private void writeClasses() throws IOException {
          // write class list (id, name) association
<span class="line-new-header">--- 1096,19 ---</span>
      }
  
      private void writeSymbol(Symbol sym) throws IOException {
          // If name is already written don&#39;t write it again.
          if (names.add(sym)) {
<span class="line-modified">!             if(sym != null) {</span>
<span class="line-modified">!               byte[] buf = sym.asString().getBytes(&quot;UTF-8&quot;);</span>
<span class="line-modified">!               writeHeader(HPROF_UTF8, buf.length + OBJ_ID_SIZE);</span>
<span class="line-modified">!               writeSymbolID(sym);</span>
<span class="line-added">+               out.write(buf);</span>
<span class="line-added">+            } else {</span>
<span class="line-added">+               writeHeader(HPROF_UTF8, 0 + OBJ_ID_SIZE);</span>
<span class="line-added">+               writeSymbolID(null);</span>
<span class="line-added">+            }</span>
          }
      }
  
      private void writeClasses() throws IOException {
          // write class list (id, name) association
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1150,11 ***</span>
          writeObjectID(address);
      }
  
      private void writeSymbolID(Symbol sym) throws IOException {
          assert names.contains(sym);
<span class="line-modified">!         writeObjectID(getAddressValue(sym.getAddress()));</span>
      }
  
      private void writeObjectID(long address) throws IOException {
          if (OBJ_ID_SIZE == 4) {
              out.writeInt((int) address);
<span class="line-new-header">--- 1155,12 ---</span>
          writeObjectID(address);
      }
  
      private void writeSymbolID(Symbol sym) throws IOException {
          assert names.contains(sym);
<span class="line-modified">!         long address = (sym != null) ? getAddressValue(sym.getAddress()) : getAddressValue(null);</span>
<span class="line-added">+         writeObjectID(address);</span>
      }
  
      private void writeObjectID(long address) throws IOException {
          if (OBJ_ID_SIZE == 4) {
              out.writeInt((int) address);
</pre>
<center><a href="AbstractHeapGraphWriter.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PointerFinder.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>