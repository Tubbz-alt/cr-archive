<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/gc/g1/HeapRegion.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="G1CollectedHeap.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../shared/GCName.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/gc/g1/HeapRegion.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 28 import java.util.ArrayList;
 29 import java.util.List;
 30 import java.util.Observable;
 31 import java.util.Observer;
 32 import sun.jvm.hotspot.debugger.Address;
 33 import sun.jvm.hotspot.debugger.OopHandle;
 34 import sun.jvm.hotspot.gc.shared.CompactibleSpace;
 35 import sun.jvm.hotspot.gc.shared.LiveRegionsProvider;
 36 import sun.jvm.hotspot.memory.MemRegion;
 37 import sun.jvm.hotspot.runtime.VM;
 38 import sun.jvm.hotspot.runtime.VMObjectFactory;
 39 import sun.jvm.hotspot.types.AddressField;
 40 import sun.jvm.hotspot.types.CIntegerField;
 41 import sun.jvm.hotspot.types.Type;
 42 import sun.jvm.hotspot.types.TypeDataBase;
 43 
 44 // Mirror class for HeapRegion. Currently we don&#39;t actually include
 45 // any of its fields but only iterate over it.
 46 
 47 public class HeapRegion extends CompactibleSpace implements LiveRegionsProvider {
<span class="line-modified"> 48     // static int GrainBytes;</span>
<span class="line-removed"> 49     static private CIntegerField grainBytesField;</span>
 50     static private AddressField topField;




 51     private static long typeFieldOffset;
 52     private static long pointerSize;
 53 
 54     private HeapRegionType type;
 55 
 56     static {
 57         VM.registerVMInitializedObserver(new Observer() {
 58                 public void update(Observable o, Object data) {
 59                     initialize(VM.getVM().getTypeDataBase());
 60                 }
 61             });
 62     }
 63 
 64     static private synchronized void initialize(TypeDataBase db) {
 65         Type type = db.lookupType(&quot;HeapRegion&quot;);
 66 
<span class="line-modified"> 67         grainBytesField = type.getCIntegerField(&quot;GrainBytes&quot;);</span>
 68         topField = type.getAddressField(&quot;_top&quot;);




 69         typeFieldOffset = type.getField(&quot;_type&quot;).getOffset();
 70 
 71         pointerSize = db.lookupType(&quot;HeapRegion*&quot;).getSize();
 72     }
 73 
 74     static public long grainBytes() {
 75         return grainBytesField.getValue();
 76     }
 77 
 78     public HeapRegion(Address addr) {
 79         super(addr);
 80         Address typeAddr = (addr instanceof OopHandle) ? addr.addOffsetToAsOopHandle(typeFieldOffset)
 81                                                        : addr.addOffsetTo(typeFieldOffset);
 82         type = (HeapRegionType)VMObjectFactory.newObject(HeapRegionType.class, typeAddr);
 83     }
 84 
<span class="line-modified"> 85     public Address top() {</span>
<span class="line-modified"> 86         return topField.getValue(addr);</span>
<span class="line-modified"> 87     }</span>


 88 
 89     @Override
 90     public List&lt;MemRegion&gt; getLiveRegions() {
 91         List&lt;MemRegion&gt; res = new ArrayList&lt;&gt;();
 92         res.add(new MemRegion(bottom(), top()));
 93         return res;
 94     }
 95 
<span class="line-modified"> 96     @Override</span>





 97     public long used() {
 98         return top().minus(bottom());
 99     }
100 
<span class="line-removed">101     @Override</span>
102     public long free() {
103         return end().minus(top());
104     }
105 
106     public boolean isFree() {
107         return type.isFree();
108     }
109 
110     public boolean isYoung() {
111         return type.isYoung();
112     }
113 
114     public boolean isHumongous() {
115         return type.isHumongous();
116     }
117 
118     public boolean isPinned() {
119         return type.isPinned();
120     }
121 
</pre>
</td>
<td>
<hr />
<pre>
 28 import java.util.ArrayList;
 29 import java.util.List;
 30 import java.util.Observable;
 31 import java.util.Observer;
 32 import sun.jvm.hotspot.debugger.Address;
 33 import sun.jvm.hotspot.debugger.OopHandle;
 34 import sun.jvm.hotspot.gc.shared.CompactibleSpace;
 35 import sun.jvm.hotspot.gc.shared.LiveRegionsProvider;
 36 import sun.jvm.hotspot.memory.MemRegion;
 37 import sun.jvm.hotspot.runtime.VM;
 38 import sun.jvm.hotspot.runtime.VMObjectFactory;
 39 import sun.jvm.hotspot.types.AddressField;
 40 import sun.jvm.hotspot.types.CIntegerField;
 41 import sun.jvm.hotspot.types.Type;
 42 import sun.jvm.hotspot.types.TypeDataBase;
 43 
 44 // Mirror class for HeapRegion. Currently we don&#39;t actually include
 45 // any of its fields but only iterate over it.
 46 
 47 public class HeapRegion extends CompactibleSpace implements LiveRegionsProvider {
<span class="line-modified"> 48     private static AddressField bottomField;</span>

 49     static private AddressField topField;
<span class="line-added"> 50     private static AddressField endField;</span>
<span class="line-added"> 51     private static AddressField compactionTopField;</span>
<span class="line-added"> 52 </span>
<span class="line-added"> 53     static private CIntegerField grainBytesField;</span>
 54     private static long typeFieldOffset;
 55     private static long pointerSize;
 56 
 57     private HeapRegionType type;
 58 
 59     static {
 60         VM.registerVMInitializedObserver(new Observer() {
 61                 public void update(Observable o, Object data) {
 62                     initialize(VM.getVM().getTypeDataBase());
 63                 }
 64             });
 65     }
 66 
 67     static private synchronized void initialize(TypeDataBase db) {
 68         Type type = db.lookupType(&quot;HeapRegion&quot;);
 69 
<span class="line-modified"> 70         bottomField = type.getAddressField(&quot;_bottom&quot;);</span>
 71         topField = type.getAddressField(&quot;_top&quot;);
<span class="line-added"> 72         endField = type.getAddressField(&quot;_end&quot;);</span>
<span class="line-added"> 73         compactionTopField = type.getAddressField(&quot;_compaction_top&quot;);</span>
<span class="line-added"> 74 </span>
<span class="line-added"> 75         grainBytesField = type.getCIntegerField(&quot;GrainBytes&quot;);</span>
 76         typeFieldOffset = type.getField(&quot;_type&quot;).getOffset();
 77 
 78         pointerSize = db.lookupType(&quot;HeapRegion*&quot;).getSize();
 79     }
 80 
 81     static public long grainBytes() {
 82         return grainBytesField.getValue();
 83     }
 84 
 85     public HeapRegion(Address addr) {
 86         super(addr);
 87         Address typeAddr = (addr instanceof OopHandle) ? addr.addOffsetToAsOopHandle(typeFieldOffset)
 88                                                        : addr.addOffsetTo(typeFieldOffset);
 89         type = (HeapRegionType)VMObjectFactory.newObject(HeapRegionType.class, typeAddr);
 90     }
 91 
<span class="line-modified"> 92     public Address bottom()        { return bottomField.getValue(addr); }</span>
<span class="line-modified"> 93     public Address top()           { return topField.getValue(addr); }</span>
<span class="line-modified"> 94     public Address end()           { return endField.getValue(addr); }</span>
<span class="line-added"> 95 </span>
<span class="line-added"> 96     public Address compactionTop() { return compactionTopField.getValue(addr); }</span>
 97 
 98     @Override
 99     public List&lt;MemRegion&gt; getLiveRegions() {
100         List&lt;MemRegion&gt; res = new ArrayList&lt;&gt;();
101         res.add(new MemRegion(bottom(), top()));
102         return res;
103     }
104 
<span class="line-modified">105     /** Returns a subregion of the space containing all the objects in</span>
<span class="line-added">106         the space. */</span>
<span class="line-added">107     public MemRegion usedRegion() {</span>
<span class="line-added">108         return new MemRegion(bottom(), end());</span>
<span class="line-added">109     }</span>
<span class="line-added">110 </span>
111     public long used() {
112         return top().minus(bottom());
113     }
114 

115     public long free() {
116         return end().minus(top());
117     }
118 
119     public boolean isFree() {
120         return type.isFree();
121     }
122 
123     public boolean isYoung() {
124         return type.isYoung();
125     }
126 
127     public boolean isHumongous() {
128         return type.isHumongous();
129     }
130 
131     public boolean isPinned() {
132         return type.isPinned();
133     }
134 
</pre>
</td>
</tr>
</table>
<center><a href="G1CollectedHeap.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../shared/GCName.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>