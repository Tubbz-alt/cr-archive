<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/SALauncher.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="HotSpotTypeDataBase.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ci/ciEnv.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/SALauncher.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2015, 2016, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 24,396 ***</span>
  
  package sun.jvm.hotspot;
  
  import java.util.ArrayList;
  import java.util.Arrays;
  
  import sun.jvm.hotspot.tools.JStack;
  import sun.jvm.hotspot.tools.JMap;
  import sun.jvm.hotspot.tools.JInfo;
  import sun.jvm.hotspot.tools.JSnap;
  
  public class SALauncher {
  
      private static boolean launcherHelp() {
          System.out.println(&quot;    clhsdb       \tcommand line debugger&quot;);
<span class="line-removed">-         System.out.println(&quot;    debugd       \tdebug server&quot;);</span>
          System.out.println(&quot;    hsdb         \tui debugger&quot;);
          System.out.println(&quot;    jstack --help\tto get more information&quot;);
          System.out.println(&quot;    jmap   --help\tto get more information&quot;);
          System.out.println(&quot;    jinfo  --help\tto get more information&quot;);
          System.out.println(&quot;    jsnap  --help\tto get more information&quot;);
          return false;
      }
  
<span class="line-modified">!     private static boolean commonHelp() {</span>
          // --pid &lt;pid&gt;
          // --exe &lt;exe&gt;
          // --core &lt;core&gt;
<span class="line-modified">!         System.out.println(&quot;    --exe\texecutable image name&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --core\tpath to coredump&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --pid\tpid of process to attach&quot;);</span>
          return false;
      }
  
      private static boolean debugdHelp() {
          // [options] &lt;pid&gt; [server-id]
          // [options] &lt;executable&gt; &lt;core&gt; [server-id]
<span class="line-modified">!         java.io.PrintStream out = System.out;</span>
<span class="line-modified">!         out.print(&quot; [option] &lt;pid&gt; [server-id]&quot;);</span>
<span class="line-removed">-         out.println(&quot;\t\t(to connect to a live java process)&quot;);</span>
<span class="line-removed">-         out.print(&quot;   or  [option] &lt;executable&gt; &lt;core&gt; [server-id]&quot;);</span>
<span class="line-removed">-         out.println(&quot;\t\t(to connect to a core file produced by &lt;executable&gt;)&quot;);</span>
<span class="line-removed">-         out.print(&quot;\t\tserver-id is an optional unique id for this debug server, needed &quot;);</span>
<span class="line-removed">-         out.println(&quot;\t\tif multiple debug servers are run on the same machine&quot;);</span>
<span class="line-removed">-         out.println(&quot;where option includes:&quot;);</span>
<span class="line-removed">-         out.println(&quot;   -h | -help\tto print this help message&quot;);</span>
<span class="line-removed">-         return false;</span>
      }
  
      private static boolean jinfoHelp() {
          // --flags -&gt; -flags
          // --sysprops -&gt; -sysprops
<span class="line-modified">!         System.out.println(&quot;    --flags\tto print VM flags&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --sysprops\tto print Java System properties&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    &lt;no option&gt;\tto print both of the above&quot;);</span>
<span class="line-modified">!         return commonHelp();</span>
      }
  
      private static boolean jmapHelp() {
          // --heap -&gt; -heap
          // --binaryheap -&gt; -heap:format=b
          // --histo -&gt; -histo
          // --clstats -&gt; -clstats
          // --finalizerinfo -&gt; -finalizerinfo
  
<span class="line-modified">!         System.out.println(&quot;    &lt;no option&gt;\tto print same info as Solaris pmap&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --heap\tto print java heap summary&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --binaryheap\tto dump java heap in hprof binary format&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --dumpfile\tname of the dump file&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --histo\tto print histogram of java object heap&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --clstats\tto print class loader statistics&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --finalizerinfo\tto print information on objects awaiting finalization&quot;);</span>
<span class="line-modified">!         return commonHelp();</span>
      }
  
      private static boolean jstackHelp() {
          // --locks -&gt; -l
          // --mixed -&gt; -m
<span class="line-modified">!         System.out.println(&quot;    --locks\tto print java.util.concurrent locks&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --mixed\tto print both java and native frames (mixed mode)&quot;);</span>
<span class="line-modified">!         return commonHelp();</span>
      }
  
      private static boolean jsnapHelp() {
<span class="line-modified">!         System.out.println(&quot;    --all\tto print all performance counters&quot;);</span>
<span class="line-modified">!         return commonHelp();</span>
      }
  
      private static boolean toolHelp(String toolName) {
<span class="line-modified">!         if (toolName.equals(&quot;jstack&quot;)) {</span>
<span class="line-modified">!             return jstackHelp();</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         if (toolName.equals(&quot;jinfo&quot;)) {</span>
<span class="line-modified">!             return jinfoHelp();</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         if (toolName.equals(&quot;jmap&quot;)) {</span>
<span class="line-modified">!             return jmapHelp();</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         if (toolName.equals(&quot;jsnap&quot;)) {</span>
<span class="line-modified">!             return jsnapHelp();</span>
          }
<span class="line-removed">-         if (toolName.equals(&quot;debugd&quot;)) {</span>
<span class="line-removed">-             return debugdHelp();</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-         if (toolName.equals(&quot;hsdb&quot;) || toolName.equals(&quot;clhsdb&quot;)) {</span>
<span class="line-removed">-             return commonHelp();</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-         return launcherHelp();</span>
      }
  
<span class="line-modified">!     private static void buildAttachArgs(ArrayList&lt;String&gt; newArgs, String pid,</span>
<span class="line-modified">!                                   String exe, String core, boolean allowEmpty) {</span>
<span class="line-modified">!         if (!allowEmpty &amp;&amp; (pid == null) &amp;&amp; (exe == null)) {</span>
<span class="line-modified">!             throw new SAGetoptException(&quot;You have to set --pid or --exe.&quot;);</span>
          }
  
          if (pid != null) { // Attach to live process
              if (exe != null) {
                  throw new SAGetoptException(&quot;Unnecessary argument: --exe&quot;);
              } else if (core != null) {
                  throw new SAGetoptException(&quot;Unnecessary argument: --core&quot;);
              } else if (!pid.matches(&quot;^\\d+$&quot;)) {
                  throw new SAGetoptException(&quot;Invalid pid: &quot; + pid);
              }
  
              newArgs.add(pid);
          } else if (exe != null) {
<span class="line-modified">!             if (exe.length() == 0) {</span>
                  throw new SAGetoptException(&quot;You have to set --exe.&quot;);
              }
  
              newArgs.add(exe);
  
              if ((core == null) || (core.length() == 0)) {
                  throw new SAGetoptException(&quot;You have to set --core.&quot;);
              }
  
              newArgs.add(core);
          }
      }
  
<span class="line-modified">!     private static void runCLHSDB(String[] oldArgs) {</span>
          SAGetopt sg = new SAGetopt(oldArgs);
<span class="line-modified">!         String[] longOpts = {&quot;exe=&quot;, &quot;core=&quot;, &quot;pid=&quot;};</span>
<span class="line-modified">! </span>
<span class="line-modified">!         ArrayList&lt;String&gt; newArgs = new ArrayList();</span>
<span class="line-modified">!         String pid = null;</span>
<span class="line-modified">!         String exe = null;</span>
<span class="line-modified">!         String core = null;</span>
<span class="line-modified">!         String s = null;</span>
<span class="line-modified">! </span>
<span class="line-modified">!         while((s = sg.next(null, longOpts)) != null) {</span>
<span class="line-modified">!             if (s.equals(&quot;exe&quot;)) {</span>
<span class="line-modified">!                 exe = sg.getOptarg();</span>
<span class="line-modified">!                 continue;</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!             if (s.equals(&quot;core&quot;)) {</span>
<span class="line-modified">!                 core = sg.getOptarg();</span>
<span class="line-modified">!                 continue;</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!             if (s.equals(&quot;pid&quot;)) {</span>
<span class="line-modified">!                 pid = sg.getOptarg();</span>
<span class="line-modified">!                 continue;</span>
              }
          }
  
<span class="line-modified">!         buildAttachArgs(newArgs, pid, exe, core, true);</span>
<span class="line-removed">-         CLHSDB.main(newArgs.toArray(new String[newArgs.size()]));</span>
      }
  
<span class="line-modified">!     private static void runHSDB(String[] oldArgs) {</span>
<span class="line-modified">!         SAGetopt sg = new SAGetopt(oldArgs);</span>
<span class="line-modified">!         String[] longOpts = {&quot;exe=&quot;, &quot;core=&quot;, &quot;pid=&quot;};</span>
<span class="line-modified">! </span>
<span class="line-modified">!         ArrayList&lt;String&gt; newArgs = new ArrayList();</span>
<span class="line-modified">!         String pid = null;</span>
<span class="line-modified">!         String exe = null;</span>
<span class="line-removed">-         String core = null;</span>
<span class="line-removed">-         String s = null;</span>
<span class="line-removed">- </span>
<span class="line-removed">-         while((s = sg.next(null, longOpts)) != null) {</span>
<span class="line-removed">-             if (s.equals(&quot;exe&quot;)) {</span>
<span class="line-removed">-                 exe = sg.getOptarg();</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;core&quot;)) {</span>
<span class="line-removed">-                 core = sg.getOptarg();</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;pid&quot;)) {</span>
<span class="line-removed">-                 pid = sg.getOptarg();</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
  
<span class="line-modified">!         buildAttachArgs(newArgs, pid, exe, core, true);</span>
<span class="line-modified">!         HSDB.main(newArgs.toArray(new String[newArgs.size()]));</span>
      }
  
      private static void runJSTACK(String[] oldArgs) {
<span class="line-modified">!         SAGetopt sg = new SAGetopt(oldArgs);</span>
<span class="line-modified">!         String[] longOpts = {&quot;exe=&quot;, &quot;core=&quot;, &quot;pid=&quot;,</span>
<span class="line-modified">!                                  &quot;mixed&quot;, &quot;locks&quot;};</span>
<span class="line-modified">! </span>
<span class="line-modified">!         ArrayList&lt;String&gt; newArgs = new ArrayList();</span>
<span class="line-modified">!         String pid = null;</span>
<span class="line-modified">!         String exe = null;</span>
<span class="line-removed">-         String core = null;</span>
<span class="line-removed">-         String s = null;</span>
<span class="line-removed">- </span>
<span class="line-removed">-         while((s = sg.next(null, longOpts)) != null) {</span>
<span class="line-removed">-             if (s.equals(&quot;exe&quot;)) {</span>
<span class="line-removed">-                 exe = sg.getOptarg();</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;core&quot;)) {</span>
<span class="line-removed">-                 core = sg.getOptarg();</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;pid&quot;)) {</span>
<span class="line-removed">-                 pid = sg.getOptarg();</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;mixed&quot;)) {</span>
<span class="line-removed">-                 newArgs.add(&quot;-m&quot;);</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;locks&quot;)) {</span>
<span class="line-removed">-                 newArgs.add(&quot;-l&quot;);</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
<span class="line-removed">-         buildAttachArgs(newArgs, pid, exe, core, false);</span>
          JStack jstack = new JStack(false, false);
<span class="line-modified">!         jstack.runWithArgs(newArgs.toArray(new String[newArgs.size()]));</span>
      }
  
      private static void runJMAP(String[] oldArgs) {
<span class="line-modified">!         SAGetopt sg = new SAGetopt(oldArgs);</span>
<span class="line-modified">!         String[] longOpts = {&quot;exe=&quot;, &quot;core=&quot;, &quot;pid=&quot;,</span>
<span class="line-modified">!               &quot;heap&quot;, &quot;binaryheap&quot;, &quot;dumpfile=&quot;, &quot;histo&quot;, &quot;clstats&quot;, &quot;finalizerinfo&quot;};</span>
<span class="line-modified">! </span>
<span class="line-modified">!         ArrayList&lt;String&gt; newArgs = new ArrayList();</span>
<span class="line-modified">!         String pid = null;</span>
<span class="line-modified">!         String exe = null;</span>
<span class="line-modified">!         String core = null;</span>
<span class="line-modified">!         String s = null;</span>
<span class="line-modified">!         String dumpfile = null;</span>
<span class="line-modified">!         boolean requestHeapdump = false;</span>
<span class="line-modified">! </span>
<span class="line-modified">!         while((s = sg.next(null, longOpts)) != null) {</span>
<span class="line-modified">!             if (s.equals(&quot;exe&quot;)) {</span>
<span class="line-removed">-                 exe = sg.getOptarg();</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;core&quot;)) {</span>
<span class="line-removed">-                 core = sg.getOptarg();</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;pid&quot;)) {</span>
<span class="line-removed">-                 pid = sg.getOptarg();</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;heap&quot;)) {</span>
<span class="line-removed">-                 newArgs.add(&quot;-heap&quot;);</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;binaryheap&quot;)) {</span>
<span class="line-removed">-                 requestHeapdump = true;</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;dumpfile&quot;)) {</span>
<span class="line-removed">-                 dumpfile = sg.getOptarg();</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;histo&quot;)) {</span>
<span class="line-removed">-                 newArgs.add(&quot;-histo&quot;);</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;clstats&quot;)) {</span>
<span class="line-removed">-                 newArgs.add(&quot;-clstats&quot;);</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;finalizerinfo&quot;)) {</span>
<span class="line-removed">-                 newArgs.add(&quot;-finalizerinfo&quot;);</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
          if (!requestHeapdump &amp;&amp; (dumpfile != null)) {
<span class="line-modified">!             throw new IllegalArgumentException(&quot;Unexpected argument dumpfile&quot;);</span>
          }
          if (requestHeapdump) {
              if (dumpfile == null) {
<span class="line-modified">!                 newArgs.add(&quot;-heap:format=b&quot;);</span>
              } else {
<span class="line-modified">!                 newArgs.add(&quot;-heap:format=b,file=&quot; + dumpfile);</span>
              }
          }
  
<span class="line-modified">!         buildAttachArgs(newArgs, pid, exe, core, false);</span>
<span class="line-modified">!         JMap.main(newArgs.toArray(new String[newArgs.size()]));</span>
      }
  
      private static void runJINFO(String[] oldArgs) {
<span class="line-modified">!         SAGetopt sg = new SAGetopt(oldArgs);</span>
<span class="line-modified">!         String[] longOpts = {&quot;exe=&quot;, &quot;core=&quot;, &quot;pid=&quot;,</span>
<span class="line-modified">!                                      &quot;flags&quot;, &quot;sysprops&quot;};</span>
<span class="line-modified">! </span>
<span class="line-modified">!         ArrayList&lt;String&gt; newArgs = new ArrayList();</span>
<span class="line-modified">!         String exe = null;</span>
<span class="line-modified">!         String pid = null;</span>
<span class="line-modified">!         String core = null;</span>
<span class="line-removed">-         String s = null;</span>
<span class="line-removed">- </span>
<span class="line-removed">-         while((s = sg.next(null, longOpts)) != null) {</span>
<span class="line-removed">-             if (s.equals(&quot;exe&quot;)) {</span>
<span class="line-removed">-                 exe = sg.getOptarg();</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;core&quot;)) {</span>
<span class="line-removed">-                 core = sg.getOptarg();</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;pid&quot;)) {</span>
<span class="line-removed">-                 pid = sg.getOptarg();</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;flags&quot;)) {</span>
<span class="line-removed">-                 newArgs.add(&quot;-flags&quot;);</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;sysprops&quot;)) {</span>
<span class="line-removed">-                 newArgs.add(&quot;-sysprops&quot;);</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
<span class="line-removed">-         buildAttachArgs(newArgs, pid, exe, core, false);</span>
<span class="line-removed">-         JInfo.main(newArgs.toArray(new String[newArgs.size()]));</span>
      }
  
      private static void runJSNAP(String[] oldArgs) {
<span class="line-modified">!         SAGetopt sg = new SAGetopt(oldArgs);</span>
<span class="line-modified">!         String[] longOpts = {&quot;exe=&quot;, &quot;core=&quot;, &quot;pid=&quot;, &quot;all&quot;};</span>
<span class="line-modified">! </span>
<span class="line-modified">!         ArrayList&lt;String&gt; newArgs = new ArrayList();</span>
<span class="line-modified">!         String exe = null;</span>
<span class="line-modified">!         String pid = null;</span>
<span class="line-modified">!         String core = null;</span>
<span class="line-removed">-         String s = null;</span>
<span class="line-removed">- </span>
<span class="line-removed">-         while((s = sg.next(null, longOpts)) != null) {</span>
<span class="line-removed">-             if (s.equals(&quot;exe&quot;)) {</span>
<span class="line-removed">-                 exe = sg.getOptarg();</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;core&quot;)) {</span>
<span class="line-removed">-                 core = sg.getOptarg();</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;pid&quot;)) {</span>
<span class="line-removed">-                 pid = sg.getOptarg();</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (s.equals(&quot;all&quot;)) {</span>
<span class="line-removed">-                 newArgs.add(&quot;-a&quot;);</span>
<span class="line-removed">-                 continue;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
<span class="line-removed">-         buildAttachArgs(newArgs, pid, exe, core, false);</span>
<span class="line-removed">-         JSnap.main(newArgs.toArray(new String[newArgs.size()]));</span>
      }
  
      private static void runDEBUGD(String[] oldArgs) {
<span class="line-removed">-         if ((oldArgs.length &lt; 1) || (oldArgs.length &gt; 3)) {</span>
<span class="line-removed">-             debugdHelp();</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
          // By default SA agent classes prefer Windows process debugger
          // to windbg debugger. SA expects special properties to be set
          // to choose other debuggers. We will set those here before
          // attaching to SA agent.
          System.setProperty(&quot;sun.jvm.hotspot.debugger.useWindbgDebugger&quot;, &quot;true&quot;);
  
          // delegate to the actual SA debug server.
<span class="line-modified">!         sun.jvm.hotspot.DebugServer.main(oldArgs);</span>
      }
  
      public static void main(String[] args) {
          // Provide a help
          if (args.length == 0) {
              launcherHelp();
              return;
<span class="line-new-header">--- 24,361 ---</span>
  
  package sun.jvm.hotspot;
  
  import java.util.ArrayList;
  import java.util.Arrays;
<span class="line-added">+ import java.util.ArrayList;</span>
<span class="line-added">+ import java.util.HashMap;</span>
<span class="line-added">+ import java.util.List;</span>
<span class="line-added">+ import java.util.Map;</span>
<span class="line-added">+ import java.util.function.Consumer;</span>
  
  import sun.jvm.hotspot.tools.JStack;
  import sun.jvm.hotspot.tools.JMap;
  import sun.jvm.hotspot.tools.JInfo;
  import sun.jvm.hotspot.tools.JSnap;
  
  public class SALauncher {
  
      private static boolean launcherHelp() {
          System.out.println(&quot;    clhsdb       \tcommand line debugger&quot;);
          System.out.println(&quot;    hsdb         \tui debugger&quot;);
<span class="line-added">+         System.out.println(&quot;    debugd --help\tto get more information&quot;);</span>
          System.out.println(&quot;    jstack --help\tto get more information&quot;);
          System.out.println(&quot;    jmap   --help\tto get more information&quot;);
          System.out.println(&quot;    jinfo  --help\tto get more information&quot;);
          System.out.println(&quot;    jsnap  --help\tto get more information&quot;);
          return false;
      }
  
<span class="line-modified">!     private static boolean commonHelp(String mode) {</span>
<span class="line-added">+         return commonHelp(mode, false);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private static boolean commonHelpWithConnect(String mode) {</span>
<span class="line-added">+         return commonHelp(mode, true);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private static boolean commonHelp(String mode, boolean canConnectToRemote) {</span>
          // --pid &lt;pid&gt;
          // --exe &lt;exe&gt;
          // --core &lt;core&gt;
<span class="line-modified">!         // --connect [&lt;id&gt;@]&lt;host&gt;</span>
<span class="line-modified">!         System.out.println(&quot;    --pid &lt;pid&gt;             To attach to and operate on the given live process.&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --core &lt;corefile&gt;       To operate on the given core file.&quot;);</span>
<span class="line-added">+         System.out.println(&quot;    --exe &lt;executable for corefile&gt;&quot;);</span>
<span class="line-added">+         if (canConnectToRemote) {</span>
<span class="line-added">+             System.out.println(&quot;    --connect [&lt;id&gt;@]&lt;host&gt; To connect to a remote debug server (debugd).&quot;);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         System.out.println();</span>
<span class="line-added">+         System.out.println(&quot;    The --core and --exe options must be set together to give the core&quot;);</span>
<span class="line-added">+         System.out.println(&quot;    file, and associated executable, to operate on. They can use&quot;);</span>
<span class="line-added">+         System.out.println(&quot;    absolute or relative paths.&quot;);</span>
<span class="line-added">+         System.out.println(&quot;    The --pid option can be set to operate on a live process.&quot;);</span>
<span class="line-added">+         if (canConnectToRemote) {</span>
<span class="line-added">+             System.out.println(&quot;    The --connect option can be set to connect to a debug server (debugd).&quot;);</span>
<span class="line-added">+             System.out.println(&quot;    --core, --pid, and --connect are mutually exclusive.&quot;);</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             System.out.println(&quot;    --core and --pid are mutually exclusive.&quot;);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         System.out.println();</span>
<span class="line-added">+         System.out.println(&quot;    Examples: jhsdb &quot; + mode + &quot; --pid 1234&quot;);</span>
<span class="line-added">+         System.out.println(&quot;          or  jhsdb &quot; + mode + &quot; --core ./core.1234 --exe ./myexe&quot;);</span>
<span class="line-added">+         if (canConnectToRemote) {</span>
<span class="line-added">+             System.out.println(&quot;          or  jhsdb &quot; + mode + &quot; --connect debugserver&quot;);</span>
<span class="line-added">+             System.out.println(&quot;          or  jhsdb &quot; + mode + &quot; --connect id@debugserver&quot;);</span>
<span class="line-added">+         }</span>
          return false;
      }
  
      private static boolean debugdHelp() {
          // [options] &lt;pid&gt; [server-id]
          // [options] &lt;executable&gt; &lt;core&gt; [server-id]
<span class="line-modified">!         System.out.println(&quot;    --serverid &lt;id&gt;         A unique identifier for this debug server.&quot;);</span>
<span class="line-modified">!         return commonHelp(&quot;debugd&quot;);</span>
      }
  
      private static boolean jinfoHelp() {
          // --flags -&gt; -flags
          // --sysprops -&gt; -sysprops
<span class="line-modified">!         System.out.println(&quot;    --flags                 To print VM flags.&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --sysprops              To print Java System properties.&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    &lt;no option&gt;             To print both of the above.&quot;);</span>
<span class="line-modified">!         return commonHelpWithConnect(&quot;jinfo&quot;);</span>
      }
  
      private static boolean jmapHelp() {
          // --heap -&gt; -heap
          // --binaryheap -&gt; -heap:format=b
          // --histo -&gt; -histo
          // --clstats -&gt; -clstats
          // --finalizerinfo -&gt; -finalizerinfo
  
<span class="line-modified">!         System.out.println(&quot;    &lt;no option&gt;             To print same info as Solaris pmap.&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --heap                  To print java heap summary.&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --binaryheap            To dump java heap in hprof binary format.&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --dumpfile &lt;name&gt;       The name of the dump file.&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --histo                 To print histogram of java object heap.&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --clstats               To print class loader statistics.&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --finalizerinfo         To print information on objects awaiting finalization.&quot;);</span>
<span class="line-modified">!         return commonHelpWithConnect(&quot;jmap&quot;);</span>
      }
  
      private static boolean jstackHelp() {
          // --locks -&gt; -l
          // --mixed -&gt; -m
<span class="line-modified">!         System.out.println(&quot;    --locks                 To print java.util.concurrent locks.&quot;);</span>
<span class="line-modified">!         System.out.println(&quot;    --mixed                 To print both Java and native frames (mixed mode).&quot;);</span>
<span class="line-modified">!         return commonHelpWithConnect(&quot;jstack&quot;);</span>
      }
  
      private static boolean jsnapHelp() {
<span class="line-modified">!         System.out.println(&quot;    --all                   To print all performance counters.&quot;);</span>
<span class="line-modified">!         return commonHelpWithConnect(&quot;jsnap&quot;);</span>
      }
  
      private static boolean toolHelp(String toolName) {
<span class="line-modified">!         switch (toolName) {</span>
<span class="line-modified">!             case &quot;jstack&quot;:</span>
<span class="line-modified">!                 return jstackHelp();</span>
<span class="line-modified">!             case &quot;jinfo&quot;:</span>
<span class="line-modified">!                 return jinfoHelp();</span>
<span class="line-modified">!             case &quot;jmap&quot;:</span>
<span class="line-modified">!                 return jmapHelp();</span>
<span class="line-modified">!             case &quot;jsnap&quot;:</span>
<span class="line-modified">!                 return jsnapHelp();</span>
<span class="line-modified">!             case &quot;debugd&quot;:</span>
<span class="line-modified">!                 return debugdHelp();</span>
<span class="line-added">+             case &quot;hsdb&quot;:</span>
<span class="line-added">+             case &quot;clhsdb&quot;:</span>
<span class="line-added">+                 return commonHelp(toolName);</span>
<span class="line-added">+             default:</span>
<span class="line-added">+                 return launcherHelp();</span>
          }
      }
  
<span class="line-modified">!     private static final String NO_REMOTE = null;</span>
<span class="line-modified">! </span>
<span class="line-modified">!     private static String[] buildAttachArgs(Map&lt;String, String&gt; newArgMap,</span>
<span class="line-modified">!                                             boolean allowEmpty) {</span>
<span class="line-added">+         String pid = newArgMap.remove(&quot;pid&quot;);</span>
<span class="line-added">+         String exe = newArgMap.remove(&quot;exe&quot;);</span>
<span class="line-added">+         String core = newArgMap.remove(&quot;core&quot;);</span>
<span class="line-added">+         String connect = newArgMap.remove(&quot;connect&quot;);</span>
<span class="line-added">+         if (!allowEmpty &amp;&amp; (pid == null) &amp;&amp; (exe == null) &amp;&amp; (connect == NO_REMOTE)) {</span>
<span class="line-added">+             throw new SAGetoptException(&quot;You have to set --pid or --exe or --connect.&quot;);</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         List&lt;String&gt; newArgs = new ArrayList&lt;&gt;();</span>
<span class="line-added">+         for (var entry : newArgMap.entrySet()) {</span>
<span class="line-added">+             newArgs.add(entry.getKey());</span>
<span class="line-added">+             if (entry.getValue() != null) {</span>
<span class="line-added">+                 newArgs.add(entry.getValue());</span>
<span class="line-added">+             }</span>
          }
  
          if (pid != null) { // Attach to live process
              if (exe != null) {
                  throw new SAGetoptException(&quot;Unnecessary argument: --exe&quot;);
              } else if (core != null) {
                  throw new SAGetoptException(&quot;Unnecessary argument: --core&quot;);
<span class="line-added">+             } else if (connect != NO_REMOTE) {</span>
<span class="line-added">+                 throw new SAGetoptException(&quot;Unnecessary argument: --connect&quot;);</span>
              } else if (!pid.matches(&quot;^\\d+$&quot;)) {
                  throw new SAGetoptException(&quot;Invalid pid: &quot; + pid);
              }
  
              newArgs.add(pid);
          } else if (exe != null) {
<span class="line-modified">!             if (connect != NO_REMOTE) {</span>
<span class="line-added">+                 throw new SAGetoptException(&quot;Unnecessary argument: --connect&quot;);</span>
<span class="line-added">+             } else if (exe.length() == 0) {</span>
                  throw new SAGetoptException(&quot;You have to set --exe.&quot;);
              }
  
              newArgs.add(exe);
  
              if ((core == null) || (core.length() == 0)) {
                  throw new SAGetoptException(&quot;You have to set --core.&quot;);
              }
  
              newArgs.add(core);
<span class="line-added">+         } else if (connect != NO_REMOTE) {</span>
<span class="line-added">+             newArgs.add(connect);</span>
          }
<span class="line-added">+ </span>
<span class="line-added">+         return newArgs.toArray(new String[0]);</span>
      }
  
<span class="line-modified">!     /**</span>
<span class="line-added">+      * This method converts jhsdb-style options (oldArgs) to old fashioned</span>
<span class="line-added">+      * style. SALauncher delegates the work to the entry point of each tool.</span>
<span class="line-added">+      * Thus we need to convert the arguments.</span>
<span class="line-added">+      * For example, `jhsdb jstack --mixed` needs to be converted to `jstack -m`.</span>
<span class="line-added">+      *</span>
<span class="line-added">+      * longOptsMap holds the rule how this method should convert the args.</span>
<span class="line-added">+      * The key is the name of jhsdb style, the value is the name of</span>
<span class="line-added">+      * old fashioned style. If you want to convert mixed option in jstack,</span>
<span class="line-added">+      * you need to set &quot;mixed&quot; to the key, and to set &quot;-m&quot; to the value</span>
<span class="line-added">+      * in longOptsMap. If the option have the value, you need to add &quot;=&quot; to</span>
<span class="line-added">+      * the key like &quot;exe=&quot;.</span>
<span class="line-added">+      *</span>
<span class="line-added">+      * You also can set the options which cannot be mapped to old fashioned</span>
<span class="line-added">+      * arguments. For example, `jhsdb jmap --binaryheap` cannot be mapped to</span>
<span class="line-added">+      * `jmap` option directly. But you set it to longOptsMap, then you can know</span>
<span class="line-added">+      * the user sets &quot;binaryheap&quot; option, and SALauncher should set</span>
<span class="line-added">+      * &quot;-heap:format:b&quot; to jmap option.</span>
<span class="line-added">+      *</span>
<span class="line-added">+      * This method returns the map of the old fashioned key/val pairs.</span>
<span class="line-added">+      * It can be used to build args in string array at buildAttachArgs().</span>
<span class="line-added">+      */</span>
<span class="line-added">+     private static Map&lt;String, String&gt; parseOptions(String[] oldArgs,</span>
<span class="line-added">+                                                     Map&lt;String, String&gt; longOptsMap) {</span>
          SAGetopt sg = new SAGetopt(oldArgs);
<span class="line-modified">!         String[] longOpts = longOptsMap.keySet().toArray(new String[0]);</span>
<span class="line-modified">!         Map&lt;String, String&gt; newArgMap = new HashMap&lt;&gt;();</span>
<span class="line-modified">! </span>
<span class="line-modified">!         /*</span>
<span class="line-modified">!          * Parse each jhsdb-style option via SAGetopt.</span>
<span class="line-modified">!          * SAGetopt parses and validates the argument. If the user passes invalid</span>
<span class="line-modified">!          * option, SAGetoptException will be occurred at SAGetopt::next.</span>
<span class="line-modified">!          * Thus there is no need to validate it here.</span>
<span class="line-modified">!          *</span>
<span class="line-modified">!          * We can get option value via SAGetopt::get. If jhsdb-style option has</span>
<span class="line-modified">!          * &#39;=&#39; at the tail, we put old fashioned option with it to newArgMap.</span>
<span class="line-modified">!          */</span>
<span class="line-modified">!         String s;</span>
<span class="line-modified">!         while ((s = sg.next(null, longOpts)) != null) {</span>
<span class="line-modified">!             var val = longOptsMap.get(s);</span>
<span class="line-modified">!             if (val != null) {</span>
<span class="line-modified">!                 newArgMap.put(val, null);</span>
<span class="line-modified">!             } else {</span>
<span class="line-modified">!                 val = longOptsMap.get(s + &quot;=&quot;);</span>
<span class="line-modified">!                 if (val != null) {</span>
<span class="line-added">+                     newArgMap.put(val, sg.getOptarg());</span>
<span class="line-added">+                 }</span>
              }
          }
  
<span class="line-modified">!         return newArgMap;</span>
      }
  
<span class="line-modified">!     private static void runCLHSDB(String[] oldArgs) {</span>
<span class="line-modified">!         Map&lt;String, String&gt; longOptsMap = Map.of(&quot;exe=&quot;, &quot;exe&quot;,</span>
<span class="line-modified">!                                                  &quot;core=&quot;, &quot;core&quot;,</span>
<span class="line-modified">!                                                  &quot;pid=&quot;, &quot;pid&quot;);</span>
<span class="line-modified">!         Map&lt;String, String&gt; newArgMap = parseOptions(oldArgs, longOptsMap);</span>
<span class="line-modified">!         CLHSDB.main(buildAttachArgs(newArgMap, true));</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     private static void runHSDB(String[] oldArgs) {</span>
<span class="line-modified">!         Map&lt;String, String&gt; longOptsMap = Map.of(&quot;exe=&quot;, &quot;exe&quot;,</span>
<span class="line-added">+                                                  &quot;core=&quot;, &quot;core&quot;,</span>
<span class="line-added">+                                                  &quot;pid=&quot;, &quot;pid&quot;);</span>
<span class="line-added">+         Map&lt;String, String&gt; newArgMap = parseOptions(oldArgs, longOptsMap);</span>
<span class="line-added">+         HSDB.main(buildAttachArgs(newArgMap, true));</span>
      }
  
      private static void runJSTACK(String[] oldArgs) {
<span class="line-modified">!         Map&lt;String, String&gt; longOptsMap = Map.of(&quot;exe=&quot;, &quot;exe&quot;,</span>
<span class="line-modified">!                                                  &quot;core=&quot;, &quot;core&quot;,</span>
<span class="line-modified">!                                                  &quot;pid=&quot;, &quot;pid&quot;,</span>
<span class="line-modified">!                                                  &quot;connect=&quot;, &quot;connect&quot;,</span>
<span class="line-modified">!                                                  &quot;mixed&quot;, &quot;-m&quot;,</span>
<span class="line-modified">!                                                  &quot;locks&quot;, &quot;-l&quot;);</span>
<span class="line-modified">!         Map&lt;String, String&gt; newArgMap = parseOptions(oldArgs, longOptsMap);</span>
          JStack jstack = new JStack(false, false);
<span class="line-modified">!         jstack.runWithArgs(buildAttachArgs(newArgMap, false));</span>
      }
  
      private static void runJMAP(String[] oldArgs) {
<span class="line-modified">!         Map&lt;String, String&gt; longOptsMap = Map.of(&quot;exe=&quot;, &quot;exe&quot;,</span>
<span class="line-modified">!                                                  &quot;core=&quot;, &quot;core&quot;,</span>
<span class="line-modified">!                                                  &quot;pid=&quot;, &quot;pid&quot;,</span>
<span class="line-modified">!                                                  &quot;connect=&quot;, &quot;connect&quot;,</span>
<span class="line-modified">!                                                  &quot;heap&quot;, &quot;-heap&quot;,</span>
<span class="line-modified">!                                                  &quot;binaryheap&quot;, &quot;binaryheap&quot;,</span>
<span class="line-modified">!                                                  &quot;dumpfile=&quot;, &quot;dumpfile&quot;,</span>
<span class="line-modified">!                                                  &quot;histo&quot;, &quot;-histo&quot;,</span>
<span class="line-modified">!                                                  &quot;clstats&quot;, &quot;-clstats&quot;,</span>
<span class="line-modified">!                                                  &quot;finalizerinfo&quot;, &quot;-finalizerinfo&quot;);</span>
<span class="line-modified">!         Map&lt;String, String&gt; newArgMap = parseOptions(oldArgs, longOptsMap);</span>
<span class="line-modified">! </span>
<span class="line-modified">!         boolean requestHeapdump = newArgMap.containsKey(&quot;binaryheap&quot;);</span>
<span class="line-modified">!         String dumpfile = newArgMap.get(&quot;dumpfile&quot;);</span>
          if (!requestHeapdump &amp;&amp; (dumpfile != null)) {
<span class="line-modified">!             throw new IllegalArgumentException(&quot;Unexpected argument: dumpfile&quot;);</span>
          }
          if (requestHeapdump) {
              if (dumpfile == null) {
<span class="line-modified">!                 newArgMap.put(&quot;-heap:format=b&quot;, null);</span>
              } else {
<span class="line-modified">!                 newArgMap.put(&quot;-heap:format=b,file=&quot; + dumpfile, null);</span>
              }
          }
  
<span class="line-modified">!         newArgMap.remove(&quot;binaryheap&quot;);</span>
<span class="line-modified">!         newArgMap.remove(&quot;dumpfile&quot;);</span>
<span class="line-added">+         JMap.main(buildAttachArgs(newArgMap, false));</span>
      }
  
      private static void runJINFO(String[] oldArgs) {
<span class="line-modified">!         Map&lt;String, String&gt; longOptsMap = Map.of(&quot;exe=&quot;, &quot;exe&quot;,</span>
<span class="line-modified">!                                                  &quot;core=&quot;, &quot;core&quot;,</span>
<span class="line-modified">!                                                  &quot;pid=&quot;, &quot;pid&quot;,</span>
<span class="line-modified">!                                                  &quot;connect=&quot;, &quot;connect&quot;,</span>
<span class="line-modified">!                                                  &quot;flags&quot;, &quot;-flags&quot;,</span>
<span class="line-modified">!                                                  &quot;sysprops&quot;, &quot;-sysprops&quot;);</span>
<span class="line-modified">!         Map&lt;String, String&gt; newArgMap = parseOptions(oldArgs, longOptsMap);</span>
<span class="line-modified">!         JInfo.main(buildAttachArgs(newArgMap, false));</span>
      }
  
      private static void runJSNAP(String[] oldArgs) {
<span class="line-modified">!         Map&lt;String, String&gt; longOptsMap = Map.of(&quot;exe=&quot;, &quot;exe&quot;,</span>
<span class="line-modified">!                                                  &quot;core=&quot;, &quot;core&quot;,</span>
<span class="line-modified">!                                                  &quot;pid=&quot;, &quot;pid&quot;,</span>
<span class="line-modified">!                                                  &quot;connect=&quot;, &quot;connect&quot;,</span>
<span class="line-modified">!                                                  &quot;all&quot;, &quot;-a&quot;);</span>
<span class="line-modified">!         Map&lt;String, String&gt; newArgMap = parseOptions(oldArgs, longOptsMap);</span>
<span class="line-modified">!         JSnap.main(buildAttachArgs(newArgMap, false));</span>
      }
  
      private static void runDEBUGD(String[] oldArgs) {
          // By default SA agent classes prefer Windows process debugger
          // to windbg debugger. SA expects special properties to be set
          // to choose other debuggers. We will set those here before
          // attaching to SA agent.
          System.setProperty(&quot;sun.jvm.hotspot.debugger.useWindbgDebugger&quot;, &quot;true&quot;);
  
<span class="line-added">+         Map&lt;String, String&gt; longOptsMap = Map.of(&quot;exe=&quot;, &quot;exe&quot;,</span>
<span class="line-added">+                                                  &quot;core=&quot;, &quot;core&quot;,</span>
<span class="line-added">+                                                  &quot;pid=&quot;, &quot;pid&quot;,</span>
<span class="line-added">+                                                  &quot;serverid=&quot;, &quot;serverid&quot;);</span>
<span class="line-added">+         Map&lt;String, String&gt; newArgMap = parseOptions(oldArgs, longOptsMap);</span>
<span class="line-added">+         var serverid = newArgMap.remove(&quot;serverid&quot;);</span>
<span class="line-added">+         List&lt;String&gt; newArgArray = new ArrayList&lt;&gt;();</span>
<span class="line-added">+         newArgArray.addAll(Arrays.asList(buildAttachArgs(newArgMap, false)));</span>
<span class="line-added">+ </span>
<span class="line-added">+         // `serverid` must be located at the tail.</span>
<span class="line-added">+         if (serverid != null) {</span>
<span class="line-added">+             newArgArray.add(serverid);</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
          // delegate to the actual SA debug server.
<span class="line-modified">!         DebugServer.main(newArgArray.toArray(new String[0]));</span>
      }
  
<span class="line-added">+     // Key: tool name, Value: launcher method</span>
<span class="line-added">+     private static Map&lt;String, Consumer&lt;String[]&gt;&gt; toolMap =</span>
<span class="line-added">+         Map.of(&quot;clhsdb&quot;, SALauncher::runCLHSDB,</span>
<span class="line-added">+                &quot;hsdb&quot;, SALauncher::runHSDB,</span>
<span class="line-added">+                &quot;jstack&quot;, SALauncher::runJSTACK,</span>
<span class="line-added">+                &quot;jmap&quot;, SALauncher::runJMAP,</span>
<span class="line-added">+                &quot;jinfo&quot;, SALauncher::runJINFO,</span>
<span class="line-added">+                &quot;jsnap&quot;, SALauncher::runJSNAP,</span>
<span class="line-added">+                &quot;debugd&quot;, SALauncher::runDEBUGD);</span>
<span class="line-added">+ </span>
      public static void main(String[] args) {
          // Provide a help
          if (args.length == 0) {
              launcherHelp();
              return;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 432,48 ***</span>
          }
  
          String[] oldArgs = Arrays.copyOfRange(args, 1, args.length);
  
          try {
<span class="line-modified">!             // Run SA interactive mode</span>
<span class="line-modified">!             if (args[0].equals(&quot;clhsdb&quot;)) {</span>
<span class="line-modified">!                 runCLHSDB(oldArgs);</span>
<span class="line-modified">!                 return;</span>
<span class="line-modified">!             }</span>
<span class="line-removed">- </span>
<span class="line-removed">-             if (args[0].equals(&quot;hsdb&quot;)) {</span>
<span class="line-removed">-                 runHSDB(oldArgs);</span>
<span class="line-removed">-                 return;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">- </span>
<span class="line-removed">-             // Run SA tmtools mode</span>
<span class="line-removed">-             if (args[0].equals(&quot;jstack&quot;)) {</span>
<span class="line-removed">-                 runJSTACK(oldArgs);</span>
<span class="line-removed">-                 return;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">- </span>
<span class="line-removed">-             if (args[0].equals(&quot;jmap&quot;)) {</span>
<span class="line-removed">-                 runJMAP(oldArgs);</span>
<span class="line-removed">-                 return;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">- </span>
<span class="line-removed">-             if (args[0].equals(&quot;jinfo&quot;)) {</span>
<span class="line-removed">-                 runJINFO(oldArgs);</span>
<span class="line-removed">-                 return;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">- </span>
<span class="line-removed">-             if (args[0].equals(&quot;jsnap&quot;)) {</span>
<span class="line-removed">-                 runJSNAP(oldArgs);</span>
<span class="line-removed">-                 return;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">- </span>
<span class="line-removed">-             if (args[0].equals(&quot;debugd&quot;)) {</span>
<span class="line-removed">-                 runDEBUGD(oldArgs);</span>
<span class="line-removed">-                 return;</span>
              }
<span class="line-removed">- </span>
<span class="line-removed">-             throw new SAGetoptException(&quot;Unknown tool: &quot; + args[0]);</span>
          } catch (SAGetoptException e) {
              System.err.println(e.getMessage());
              toolHelp(args[0]);
          }
      }
<span class="line-new-header">--- 397,16 ---</span>
          }
  
          String[] oldArgs = Arrays.copyOfRange(args, 1, args.length);
  
          try {
<span class="line-modified">!             var func = toolMap.get(args[0]);</span>
<span class="line-modified">!             if (func == null) {</span>
<span class="line-modified">!                 throw new SAGetoptException(&quot;Unknown tool: &quot; + args[0]);</span>
<span class="line-modified">!             } else {</span>
<span class="line-modified">!                 func.accept(oldArgs);</span>
              }
          } catch (SAGetoptException e) {
              System.err.println(e.getMessage());
              toolHelp(args[0]);
          }
      }
</pre>
<center><a href="HotSpotTypeDataBase.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ci/ciEnv.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>