<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/SALauncher.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="HotSpotTypeDataBase.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ci/ciEnv.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/SALauncher.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2016, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 package sun.jvm.hotspot;
 26 
 27 import java.util.ArrayList;
 28 import java.util.Arrays;





 29 
 30 import sun.jvm.hotspot.tools.JStack;
 31 import sun.jvm.hotspot.tools.JMap;
 32 import sun.jvm.hotspot.tools.JInfo;
 33 import sun.jvm.hotspot.tools.JSnap;
 34 
 35 public class SALauncher {
 36 
 37     private static boolean launcherHelp() {
 38         System.out.println(&quot;    clhsdb       \tcommand line debugger&quot;);
<span class="line-removed"> 39         System.out.println(&quot;    debugd       \tdebug server&quot;);</span>
 40         System.out.println(&quot;    hsdb         \tui debugger&quot;);

 41         System.out.println(&quot;    jstack --help\tto get more information&quot;);
 42         System.out.println(&quot;    jmap   --help\tto get more information&quot;);
 43         System.out.println(&quot;    jinfo  --help\tto get more information&quot;);
 44         System.out.println(&quot;    jsnap  --help\tto get more information&quot;);
 45         return false;
 46     }
 47 
<span class="line-modified"> 48     private static boolean commonHelp() {</span>








 49         // --pid &lt;pid&gt;
 50         // --exe &lt;exe&gt;
 51         // --core &lt;core&gt;
<span class="line-modified"> 52         System.out.println(&quot;    --exe\texecutable image name&quot;);</span>
<span class="line-modified"> 53         System.out.println(&quot;    --core\tpath to coredump&quot;);</span>
<span class="line-modified"> 54         System.out.println(&quot;    --pid\tpid of process to attach&quot;);</span>






















 55         return false;
 56     }
 57 
 58     private static boolean debugdHelp() {
 59         // [options] &lt;pid&gt; [server-id]
 60         // [options] &lt;executable&gt; &lt;core&gt; [server-id]
<span class="line-modified"> 61         java.io.PrintStream out = System.out;</span>
<span class="line-modified"> 62         out.print(&quot; [option] &lt;pid&gt; [server-id]&quot;);</span>
<span class="line-removed"> 63         out.println(&quot;\t\t(to connect to a live java process)&quot;);</span>
<span class="line-removed"> 64         out.print(&quot;   or  [option] &lt;executable&gt; &lt;core&gt; [server-id]&quot;);</span>
<span class="line-removed"> 65         out.println(&quot;\t\t(to connect to a core file produced by &lt;executable&gt;)&quot;);</span>
<span class="line-removed"> 66         out.print(&quot;\t\tserver-id is an optional unique id for this debug server, needed &quot;);</span>
<span class="line-removed"> 67         out.println(&quot;\t\tif multiple debug servers are run on the same machine&quot;);</span>
<span class="line-removed"> 68         out.println(&quot;where option includes:&quot;);</span>
<span class="line-removed"> 69         out.println(&quot;   -h | -help\tto print this help message&quot;);</span>
<span class="line-removed"> 70         return false;</span>
 71     }
 72 
 73     private static boolean jinfoHelp() {
 74         // --flags -&gt; -flags
 75         // --sysprops -&gt; -sysprops
<span class="line-modified"> 76         System.out.println(&quot;    --flags\tto print VM flags&quot;);</span>
<span class="line-modified"> 77         System.out.println(&quot;    --sysprops\tto print Java System properties&quot;);</span>
<span class="line-modified"> 78         System.out.println(&quot;    &lt;no option&gt;\tto print both of the above&quot;);</span>
<span class="line-modified"> 79         return commonHelp();</span>
 80     }
 81 
 82     private static boolean jmapHelp() {
 83         // --heap -&gt; -heap
 84         // --binaryheap -&gt; -heap:format=b
 85         // --histo -&gt; -histo
 86         // --clstats -&gt; -clstats
 87         // --finalizerinfo -&gt; -finalizerinfo
 88 
<span class="line-modified"> 89         System.out.println(&quot;    &lt;no option&gt;\tto print same info as Solaris pmap&quot;);</span>
<span class="line-modified"> 90         System.out.println(&quot;    --heap\tto print java heap summary&quot;);</span>
<span class="line-modified"> 91         System.out.println(&quot;    --binaryheap\tto dump java heap in hprof binary format&quot;);</span>
<span class="line-modified"> 92         System.out.println(&quot;    --dumpfile\tname of the dump file&quot;);</span>
<span class="line-modified"> 93         System.out.println(&quot;    --histo\tto print histogram of java object heap&quot;);</span>
<span class="line-modified"> 94         System.out.println(&quot;    --clstats\tto print class loader statistics&quot;);</span>
<span class="line-modified"> 95         System.out.println(&quot;    --finalizerinfo\tto print information on objects awaiting finalization&quot;);</span>
<span class="line-modified"> 96         return commonHelp();</span>
 97     }
 98 
 99     private static boolean jstackHelp() {
100         // --locks -&gt; -l
101         // --mixed -&gt; -m
<span class="line-modified">102         System.out.println(&quot;    --locks\tto print java.util.concurrent locks&quot;);</span>
<span class="line-modified">103         System.out.println(&quot;    --mixed\tto print both java and native frames (mixed mode)&quot;);</span>
<span class="line-modified">104         return commonHelp();</span>
105     }
106 
107     private static boolean jsnapHelp() {
<span class="line-modified">108         System.out.println(&quot;    --all\tto print all performance counters&quot;);</span>
<span class="line-modified">109         return commonHelp();</span>
110     }
111 
112     private static boolean toolHelp(String toolName) {
<span class="line-modified">113         if (toolName.equals(&quot;jstack&quot;)) {</span>
<span class="line-modified">114             return jstackHelp();</span>
<span class="line-modified">115         }</span>
<span class="line-modified">116         if (toolName.equals(&quot;jinfo&quot;)) {</span>
<span class="line-modified">117             return jinfoHelp();</span>
<span class="line-modified">118         }</span>
<span class="line-modified">119         if (toolName.equals(&quot;jmap&quot;)) {</span>
<span class="line-modified">120             return jmapHelp();</span>
<span class="line-modified">121         }</span>
<span class="line-modified">122         if (toolName.equals(&quot;jsnap&quot;)) {</span>
<span class="line-modified">123             return jsnapHelp();</span>





124         }
<span class="line-removed">125         if (toolName.equals(&quot;debugd&quot;)) {</span>
<span class="line-removed">126             return debugdHelp();</span>
<span class="line-removed">127         }</span>
<span class="line-removed">128         if (toolName.equals(&quot;hsdb&quot;) || toolName.equals(&quot;clhsdb&quot;)) {</span>
<span class="line-removed">129             return commonHelp();</span>
<span class="line-removed">130         }</span>
<span class="line-removed">131         return launcherHelp();</span>
132     }
133 
<span class="line-modified">134     private static void buildAttachArgs(ArrayList&lt;String&gt; newArgs, String pid,</span>
<span class="line-modified">135                                   String exe, String core, boolean allowEmpty) {</span>
<span class="line-modified">136         if (!allowEmpty &amp;&amp; (pid == null) &amp;&amp; (exe == null)) {</span>
<span class="line-modified">137             throw new SAGetoptException(&quot;You have to set --pid or --exe.&quot;);</span>














138         }
139 
140         if (pid != null) { // Attach to live process
141             if (exe != null) {
142                 throw new SAGetoptException(&quot;Unnecessary argument: --exe&quot;);
143             } else if (core != null) {
144                 throw new SAGetoptException(&quot;Unnecessary argument: --core&quot;);


145             } else if (!pid.matches(&quot;^\\d+$&quot;)) {
146                 throw new SAGetoptException(&quot;Invalid pid: &quot; + pid);
147             }
148 
149             newArgs.add(pid);
150         } else if (exe != null) {
<span class="line-modified">151             if (exe.length() == 0) {</span>


152                 throw new SAGetoptException(&quot;You have to set --exe.&quot;);
153             }
154 
155             newArgs.add(exe);
156 
157             if ((core == null) || (core.length() == 0)) {
158                 throw new SAGetoptException(&quot;You have to set --core.&quot;);
159             }
160 
161             newArgs.add(core);


162         }


163     }
164 
<span class="line-modified">165     private static void runCLHSDB(String[] oldArgs) {</span>























166         SAGetopt sg = new SAGetopt(oldArgs);
<span class="line-modified">167         String[] longOpts = {&quot;exe=&quot;, &quot;core=&quot;, &quot;pid=&quot;};</span>
<span class="line-modified">168 </span>
<span class="line-modified">169         ArrayList&lt;String&gt; newArgs = new ArrayList();</span>
<span class="line-modified">170         String pid = null;</span>
<span class="line-modified">171         String exe = null;</span>
<span class="line-modified">172         String core = null;</span>
<span class="line-modified">173         String s = null;</span>
<span class="line-modified">174 </span>
<span class="line-modified">175         while((s = sg.next(null, longOpts)) != null) {</span>
<span class="line-modified">176             if (s.equals(&quot;exe&quot;)) {</span>
<span class="line-modified">177                 exe = sg.getOptarg();</span>
<span class="line-modified">178                 continue;</span>
<span class="line-modified">179             }</span>
<span class="line-modified">180             if (s.equals(&quot;core&quot;)) {</span>
<span class="line-modified">181                 core = sg.getOptarg();</span>
<span class="line-modified">182                 continue;</span>
<span class="line-modified">183             }</span>
<span class="line-modified">184             if (s.equals(&quot;pid&quot;)) {</span>
<span class="line-modified">185                 pid = sg.getOptarg();</span>
<span class="line-modified">186                 continue;</span>


187             }
188         }
189 
<span class="line-modified">190         buildAttachArgs(newArgs, pid, exe, core, true);</span>
<span class="line-removed">191         CLHSDB.main(newArgs.toArray(new String[newArgs.size()]));</span>
192     }
193 
<span class="line-modified">194     private static void runHSDB(String[] oldArgs) {</span>
<span class="line-modified">195         SAGetopt sg = new SAGetopt(oldArgs);</span>
<span class="line-modified">196         String[] longOpts = {&quot;exe=&quot;, &quot;core=&quot;, &quot;pid=&quot;};</span>
<span class="line-modified">197 </span>
<span class="line-modified">198         ArrayList&lt;String&gt; newArgs = new ArrayList();</span>
<span class="line-modified">199         String pid = null;</span>
<span class="line-modified">200         String exe = null;</span>
<span class="line-removed">201         String core = null;</span>
<span class="line-removed">202         String s = null;</span>
<span class="line-removed">203 </span>
<span class="line-removed">204         while((s = sg.next(null, longOpts)) != null) {</span>
<span class="line-removed">205             if (s.equals(&quot;exe&quot;)) {</span>
<span class="line-removed">206                 exe = sg.getOptarg();</span>
<span class="line-removed">207                 continue;</span>
<span class="line-removed">208             }</span>
<span class="line-removed">209             if (s.equals(&quot;core&quot;)) {</span>
<span class="line-removed">210                 core = sg.getOptarg();</span>
<span class="line-removed">211                 continue;</span>
<span class="line-removed">212             }</span>
<span class="line-removed">213             if (s.equals(&quot;pid&quot;)) {</span>
<span class="line-removed">214                 pid = sg.getOptarg();</span>
<span class="line-removed">215                 continue;</span>
<span class="line-removed">216             }</span>
<span class="line-removed">217         }</span>
218 
<span class="line-modified">219         buildAttachArgs(newArgs, pid, exe, core, true);</span>
<span class="line-modified">220         HSDB.main(newArgs.toArray(new String[newArgs.size()]));</span>




221     }
222 
223     private static void runJSTACK(String[] oldArgs) {
<span class="line-modified">224         SAGetopt sg = new SAGetopt(oldArgs);</span>
<span class="line-modified">225         String[] longOpts = {&quot;exe=&quot;, &quot;core=&quot;, &quot;pid=&quot;,</span>
<span class="line-modified">226                                  &quot;mixed&quot;, &quot;locks&quot;};</span>
<span class="line-modified">227 </span>
<span class="line-modified">228         ArrayList&lt;String&gt; newArgs = new ArrayList();</span>
<span class="line-modified">229         String pid = null;</span>
<span class="line-modified">230         String exe = null;</span>
<span class="line-removed">231         String core = null;</span>
<span class="line-removed">232         String s = null;</span>
<span class="line-removed">233 </span>
<span class="line-removed">234         while((s = sg.next(null, longOpts)) != null) {</span>
<span class="line-removed">235             if (s.equals(&quot;exe&quot;)) {</span>
<span class="line-removed">236                 exe = sg.getOptarg();</span>
<span class="line-removed">237                 continue;</span>
<span class="line-removed">238             }</span>
<span class="line-removed">239             if (s.equals(&quot;core&quot;)) {</span>
<span class="line-removed">240                 core = sg.getOptarg();</span>
<span class="line-removed">241                 continue;</span>
<span class="line-removed">242             }</span>
<span class="line-removed">243             if (s.equals(&quot;pid&quot;)) {</span>
<span class="line-removed">244                 pid = sg.getOptarg();</span>
<span class="line-removed">245                 continue;</span>
<span class="line-removed">246             }</span>
<span class="line-removed">247             if (s.equals(&quot;mixed&quot;)) {</span>
<span class="line-removed">248                 newArgs.add(&quot;-m&quot;);</span>
<span class="line-removed">249                 continue;</span>
<span class="line-removed">250             }</span>
<span class="line-removed">251             if (s.equals(&quot;locks&quot;)) {</span>
<span class="line-removed">252                 newArgs.add(&quot;-l&quot;);</span>
<span class="line-removed">253                 continue;</span>
<span class="line-removed">254             }</span>
<span class="line-removed">255         }</span>
<span class="line-removed">256 </span>
<span class="line-removed">257         buildAttachArgs(newArgs, pid, exe, core, false);</span>
258         JStack jstack = new JStack(false, false);
<span class="line-modified">259         jstack.runWithArgs(newArgs.toArray(new String[newArgs.size()]));</span>
260     }
261 
262     private static void runJMAP(String[] oldArgs) {
<span class="line-modified">263         SAGetopt sg = new SAGetopt(oldArgs);</span>
<span class="line-modified">264         String[] longOpts = {&quot;exe=&quot;, &quot;core=&quot;, &quot;pid=&quot;,</span>
<span class="line-modified">265               &quot;heap&quot;, &quot;binaryheap&quot;, &quot;dumpfile=&quot;, &quot;histo&quot;, &quot;clstats&quot;, &quot;finalizerinfo&quot;};</span>
<span class="line-modified">266 </span>
<span class="line-modified">267         ArrayList&lt;String&gt; newArgs = new ArrayList();</span>
<span class="line-modified">268         String pid = null;</span>
<span class="line-modified">269         String exe = null;</span>
<span class="line-modified">270         String core = null;</span>
<span class="line-modified">271         String s = null;</span>
<span class="line-modified">272         String dumpfile = null;</span>
<span class="line-modified">273         boolean requestHeapdump = false;</span>
<span class="line-modified">274 </span>
<span class="line-modified">275         while((s = sg.next(null, longOpts)) != null) {</span>
<span class="line-modified">276             if (s.equals(&quot;exe&quot;)) {</span>
<span class="line-removed">277                 exe = sg.getOptarg();</span>
<span class="line-removed">278                 continue;</span>
<span class="line-removed">279             }</span>
<span class="line-removed">280             if (s.equals(&quot;core&quot;)) {</span>
<span class="line-removed">281                 core = sg.getOptarg();</span>
<span class="line-removed">282                 continue;</span>
<span class="line-removed">283             }</span>
<span class="line-removed">284             if (s.equals(&quot;pid&quot;)) {</span>
<span class="line-removed">285                 pid = sg.getOptarg();</span>
<span class="line-removed">286                 continue;</span>
<span class="line-removed">287             }</span>
<span class="line-removed">288             if (s.equals(&quot;heap&quot;)) {</span>
<span class="line-removed">289                 newArgs.add(&quot;-heap&quot;);</span>
<span class="line-removed">290                 continue;</span>
<span class="line-removed">291             }</span>
<span class="line-removed">292             if (s.equals(&quot;binaryheap&quot;)) {</span>
<span class="line-removed">293                 requestHeapdump = true;</span>
<span class="line-removed">294                 continue;</span>
<span class="line-removed">295             }</span>
<span class="line-removed">296             if (s.equals(&quot;dumpfile&quot;)) {</span>
<span class="line-removed">297                 dumpfile = sg.getOptarg();</span>
<span class="line-removed">298                 continue;</span>
<span class="line-removed">299             }</span>
<span class="line-removed">300             if (s.equals(&quot;histo&quot;)) {</span>
<span class="line-removed">301                 newArgs.add(&quot;-histo&quot;);</span>
<span class="line-removed">302                 continue;</span>
<span class="line-removed">303             }</span>
<span class="line-removed">304             if (s.equals(&quot;clstats&quot;)) {</span>
<span class="line-removed">305                 newArgs.add(&quot;-clstats&quot;);</span>
<span class="line-removed">306                 continue;</span>
<span class="line-removed">307             }</span>
<span class="line-removed">308             if (s.equals(&quot;finalizerinfo&quot;)) {</span>
<span class="line-removed">309                 newArgs.add(&quot;-finalizerinfo&quot;);</span>
<span class="line-removed">310                 continue;</span>
<span class="line-removed">311             }</span>
<span class="line-removed">312         }</span>
<span class="line-removed">313 </span>
314         if (!requestHeapdump &amp;&amp; (dumpfile != null)) {
<span class="line-modified">315             throw new IllegalArgumentException(&quot;Unexpected argument dumpfile&quot;);</span>
316         }
317         if (requestHeapdump) {
318             if (dumpfile == null) {
<span class="line-modified">319                 newArgs.add(&quot;-heap:format=b&quot;);</span>
320             } else {
<span class="line-modified">321                 newArgs.add(&quot;-heap:format=b,file=&quot; + dumpfile);</span>
322             }
323         }
324 
<span class="line-modified">325         buildAttachArgs(newArgs, pid, exe, core, false);</span>
<span class="line-modified">326         JMap.main(newArgs.toArray(new String[newArgs.size()]));</span>

327     }
328 
329     private static void runJINFO(String[] oldArgs) {
<span class="line-modified">330         SAGetopt sg = new SAGetopt(oldArgs);</span>
<span class="line-modified">331         String[] longOpts = {&quot;exe=&quot;, &quot;core=&quot;, &quot;pid=&quot;,</span>
<span class="line-modified">332                                      &quot;flags&quot;, &quot;sysprops&quot;};</span>
<span class="line-modified">333 </span>
<span class="line-modified">334         ArrayList&lt;String&gt; newArgs = new ArrayList();</span>
<span class="line-modified">335         String exe = null;</span>
<span class="line-modified">336         String pid = null;</span>
<span class="line-modified">337         String core = null;</span>
<span class="line-removed">338         String s = null;</span>
<span class="line-removed">339 </span>
<span class="line-removed">340         while((s = sg.next(null, longOpts)) != null) {</span>
<span class="line-removed">341             if (s.equals(&quot;exe&quot;)) {</span>
<span class="line-removed">342                 exe = sg.getOptarg();</span>
<span class="line-removed">343                 continue;</span>
<span class="line-removed">344             }</span>
<span class="line-removed">345             if (s.equals(&quot;core&quot;)) {</span>
<span class="line-removed">346                 core = sg.getOptarg();</span>
<span class="line-removed">347                 continue;</span>
<span class="line-removed">348             }</span>
<span class="line-removed">349             if (s.equals(&quot;pid&quot;)) {</span>
<span class="line-removed">350                 pid = sg.getOptarg();</span>
<span class="line-removed">351                 continue;</span>
<span class="line-removed">352             }</span>
<span class="line-removed">353             if (s.equals(&quot;flags&quot;)) {</span>
<span class="line-removed">354                 newArgs.add(&quot;-flags&quot;);</span>
<span class="line-removed">355                 continue;</span>
<span class="line-removed">356             }</span>
<span class="line-removed">357             if (s.equals(&quot;sysprops&quot;)) {</span>
<span class="line-removed">358                 newArgs.add(&quot;-sysprops&quot;);</span>
<span class="line-removed">359                 continue;</span>
<span class="line-removed">360             }</span>
<span class="line-removed">361         }</span>
<span class="line-removed">362 </span>
<span class="line-removed">363         buildAttachArgs(newArgs, pid, exe, core, false);</span>
<span class="line-removed">364         JInfo.main(newArgs.toArray(new String[newArgs.size()]));</span>
365     }
366 
367     private static void runJSNAP(String[] oldArgs) {
<span class="line-modified">368         SAGetopt sg = new SAGetopt(oldArgs);</span>
<span class="line-modified">369         String[] longOpts = {&quot;exe=&quot;, &quot;core=&quot;, &quot;pid=&quot;, &quot;all&quot;};</span>
<span class="line-modified">370 </span>
<span class="line-modified">371         ArrayList&lt;String&gt; newArgs = new ArrayList();</span>
<span class="line-modified">372         String exe = null;</span>
<span class="line-modified">373         String pid = null;</span>
<span class="line-modified">374         String core = null;</span>
<span class="line-removed">375         String s = null;</span>
<span class="line-removed">376 </span>
<span class="line-removed">377         while((s = sg.next(null, longOpts)) != null) {</span>
<span class="line-removed">378             if (s.equals(&quot;exe&quot;)) {</span>
<span class="line-removed">379                 exe = sg.getOptarg();</span>
<span class="line-removed">380                 continue;</span>
<span class="line-removed">381             }</span>
<span class="line-removed">382             if (s.equals(&quot;core&quot;)) {</span>
<span class="line-removed">383                 core = sg.getOptarg();</span>
<span class="line-removed">384                 continue;</span>
<span class="line-removed">385             }</span>
<span class="line-removed">386             if (s.equals(&quot;pid&quot;)) {</span>
<span class="line-removed">387                 pid = sg.getOptarg();</span>
<span class="line-removed">388                 continue;</span>
<span class="line-removed">389             }</span>
<span class="line-removed">390             if (s.equals(&quot;all&quot;)) {</span>
<span class="line-removed">391                 newArgs.add(&quot;-a&quot;);</span>
<span class="line-removed">392                 continue;</span>
<span class="line-removed">393             }</span>
<span class="line-removed">394         }</span>
<span class="line-removed">395 </span>
<span class="line-removed">396         buildAttachArgs(newArgs, pid, exe, core, false);</span>
<span class="line-removed">397         JSnap.main(newArgs.toArray(new String[newArgs.size()]));</span>
398     }
399 
400     private static void runDEBUGD(String[] oldArgs) {
<span class="line-removed">401         if ((oldArgs.length &lt; 1) || (oldArgs.length &gt; 3)) {</span>
<span class="line-removed">402             debugdHelp();</span>
<span class="line-removed">403         }</span>
<span class="line-removed">404 </span>
405         // By default SA agent classes prefer Windows process debugger
406         // to windbg debugger. SA expects special properties to be set
407         // to choose other debuggers. We will set those here before
408         // attaching to SA agent.
409         System.setProperty(&quot;sun.jvm.hotspot.debugger.useWindbgDebugger&quot;, &quot;true&quot;);
410 














411         // delegate to the actual SA debug server.
<span class="line-modified">412         sun.jvm.hotspot.DebugServer.main(oldArgs);</span>
413     }
414 










415     public static void main(String[] args) {
416         // Provide a help
417         if (args.length == 0) {
418             launcherHelp();
419             return;
420         }
421         // No arguments imply help for debugd, jstack, jmap, jinfo but launch clhsdb and hsdb
422         if (args.length == 1 &amp;&amp; !args[0].equals(&quot;clhsdb&quot;) &amp;&amp; !args[0].equals(&quot;hsdb&quot;)) {
423             toolHelp(args[0]);
424             return;
425         }
426 
427         for (String arg : args) {
428             if (arg.equals(&quot;-h&quot;) || arg.equals(&quot;-help&quot;) || arg.equals(&quot;--help&quot;)) {
429                 toolHelp(args[0]);
430                 return;
431             }
432         }
433 
434         String[] oldArgs = Arrays.copyOfRange(args, 1, args.length);
435 
436         try {
<span class="line-modified">437             // Run SA interactive mode</span>
<span class="line-modified">438             if (args[0].equals(&quot;clhsdb&quot;)) {</span>
<span class="line-modified">439                 runCLHSDB(oldArgs);</span>
<span class="line-modified">440                 return;</span>
<span class="line-modified">441             }</span>
<span class="line-removed">442 </span>
<span class="line-removed">443             if (args[0].equals(&quot;hsdb&quot;)) {</span>
<span class="line-removed">444                 runHSDB(oldArgs);</span>
<span class="line-removed">445                 return;</span>
<span class="line-removed">446             }</span>
<span class="line-removed">447 </span>
<span class="line-removed">448             // Run SA tmtools mode</span>
<span class="line-removed">449             if (args[0].equals(&quot;jstack&quot;)) {</span>
<span class="line-removed">450                 runJSTACK(oldArgs);</span>
<span class="line-removed">451                 return;</span>
<span class="line-removed">452             }</span>
<span class="line-removed">453 </span>
<span class="line-removed">454             if (args[0].equals(&quot;jmap&quot;)) {</span>
<span class="line-removed">455                 runJMAP(oldArgs);</span>
<span class="line-removed">456                 return;</span>
<span class="line-removed">457             }</span>
<span class="line-removed">458 </span>
<span class="line-removed">459             if (args[0].equals(&quot;jinfo&quot;)) {</span>
<span class="line-removed">460                 runJINFO(oldArgs);</span>
<span class="line-removed">461                 return;</span>
<span class="line-removed">462             }</span>
<span class="line-removed">463 </span>
<span class="line-removed">464             if (args[0].equals(&quot;jsnap&quot;)) {</span>
<span class="line-removed">465                 runJSNAP(oldArgs);</span>
<span class="line-removed">466                 return;</span>
<span class="line-removed">467             }</span>
<span class="line-removed">468 </span>
<span class="line-removed">469             if (args[0].equals(&quot;debugd&quot;)) {</span>
<span class="line-removed">470                 runDEBUGD(oldArgs);</span>
<span class="line-removed">471                 return;</span>
472             }
<span class="line-removed">473 </span>
<span class="line-removed">474             throw new SAGetoptException(&quot;Unknown tool: &quot; + args[0]);</span>
475         } catch (SAGetoptException e) {
476             System.err.println(e.getMessage());
477             toolHelp(args[0]);
478         }
479     }
480 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 package sun.jvm.hotspot;
 26 
 27 import java.util.ArrayList;
 28 import java.util.Arrays;
<span class="line-added"> 29 import java.util.ArrayList;</span>
<span class="line-added"> 30 import java.util.HashMap;</span>
<span class="line-added"> 31 import java.util.List;</span>
<span class="line-added"> 32 import java.util.Map;</span>
<span class="line-added"> 33 import java.util.function.Consumer;</span>
 34 
 35 import sun.jvm.hotspot.tools.JStack;
 36 import sun.jvm.hotspot.tools.JMap;
 37 import sun.jvm.hotspot.tools.JInfo;
 38 import sun.jvm.hotspot.tools.JSnap;
 39 
 40 public class SALauncher {
 41 
 42     private static boolean launcherHelp() {
 43         System.out.println(&quot;    clhsdb       \tcommand line debugger&quot;);

 44         System.out.println(&quot;    hsdb         \tui debugger&quot;);
<span class="line-added"> 45         System.out.println(&quot;    debugd --help\tto get more information&quot;);</span>
 46         System.out.println(&quot;    jstack --help\tto get more information&quot;);
 47         System.out.println(&quot;    jmap   --help\tto get more information&quot;);
 48         System.out.println(&quot;    jinfo  --help\tto get more information&quot;);
 49         System.out.println(&quot;    jsnap  --help\tto get more information&quot;);
 50         return false;
 51     }
 52 
<span class="line-modified"> 53     private static boolean commonHelp(String mode) {</span>
<span class="line-added"> 54         return commonHelp(mode, false);</span>
<span class="line-added"> 55     }</span>
<span class="line-added"> 56 </span>
<span class="line-added"> 57     private static boolean commonHelpWithConnect(String mode) {</span>
<span class="line-added"> 58         return commonHelp(mode, true);</span>
<span class="line-added"> 59     }</span>
<span class="line-added"> 60 </span>
<span class="line-added"> 61     private static boolean commonHelp(String mode, boolean canConnectToRemote) {</span>
 62         // --pid &lt;pid&gt;
 63         // --exe &lt;exe&gt;
 64         // --core &lt;core&gt;
<span class="line-modified"> 65         // --connect [&lt;id&gt;@]&lt;host&gt;</span>
<span class="line-modified"> 66         System.out.println(&quot;    --pid &lt;pid&gt;             To attach to and operate on the given live process.&quot;);</span>
<span class="line-modified"> 67         System.out.println(&quot;    --core &lt;corefile&gt;       To operate on the given core file.&quot;);</span>
<span class="line-added"> 68         System.out.println(&quot;    --exe &lt;executable for corefile&gt;&quot;);</span>
<span class="line-added"> 69         if (canConnectToRemote) {</span>
<span class="line-added"> 70             System.out.println(&quot;    --connect [&lt;id&gt;@]&lt;host&gt; To connect to a remote debug server (debugd).&quot;);</span>
<span class="line-added"> 71         }</span>
<span class="line-added"> 72         System.out.println();</span>
<span class="line-added"> 73         System.out.println(&quot;    The --core and --exe options must be set together to give the core&quot;);</span>
<span class="line-added"> 74         System.out.println(&quot;    file, and associated executable, to operate on. They can use&quot;);</span>
<span class="line-added"> 75         System.out.println(&quot;    absolute or relative paths.&quot;);</span>
<span class="line-added"> 76         System.out.println(&quot;    The --pid option can be set to operate on a live process.&quot;);</span>
<span class="line-added"> 77         if (canConnectToRemote) {</span>
<span class="line-added"> 78             System.out.println(&quot;    The --connect option can be set to connect to a debug server (debugd).&quot;);</span>
<span class="line-added"> 79             System.out.println(&quot;    --core, --pid, and --connect are mutually exclusive.&quot;);</span>
<span class="line-added"> 80         } else {</span>
<span class="line-added"> 81             System.out.println(&quot;    --core and --pid are mutually exclusive.&quot;);</span>
<span class="line-added"> 82         }</span>
<span class="line-added"> 83         System.out.println();</span>
<span class="line-added"> 84         System.out.println(&quot;    Examples: jhsdb &quot; + mode + &quot; --pid 1234&quot;);</span>
<span class="line-added"> 85         System.out.println(&quot;          or  jhsdb &quot; + mode + &quot; --core ./core.1234 --exe ./myexe&quot;);</span>
<span class="line-added"> 86         if (canConnectToRemote) {</span>
<span class="line-added"> 87             System.out.println(&quot;          or  jhsdb &quot; + mode + &quot; --connect debugserver&quot;);</span>
<span class="line-added"> 88             System.out.println(&quot;          or  jhsdb &quot; + mode + &quot; --connect id@debugserver&quot;);</span>
<span class="line-added"> 89         }</span>
 90         return false;
 91     }
 92 
 93     private static boolean debugdHelp() {
 94         // [options] &lt;pid&gt; [server-id]
 95         // [options] &lt;executable&gt; &lt;core&gt; [server-id]
<span class="line-modified"> 96         System.out.println(&quot;    --serverid &lt;id&gt;         A unique identifier for this debug server.&quot;);</span>
<span class="line-modified"> 97         return commonHelp(&quot;debugd&quot;);</span>








 98     }
 99 
100     private static boolean jinfoHelp() {
101         // --flags -&gt; -flags
102         // --sysprops -&gt; -sysprops
<span class="line-modified">103         System.out.println(&quot;    --flags                 To print VM flags.&quot;);</span>
<span class="line-modified">104         System.out.println(&quot;    --sysprops              To print Java System properties.&quot;);</span>
<span class="line-modified">105         System.out.println(&quot;    &lt;no option&gt;             To print both of the above.&quot;);</span>
<span class="line-modified">106         return commonHelpWithConnect(&quot;jinfo&quot;);</span>
107     }
108 
109     private static boolean jmapHelp() {
110         // --heap -&gt; -heap
111         // --binaryheap -&gt; -heap:format=b
112         // --histo -&gt; -histo
113         // --clstats -&gt; -clstats
114         // --finalizerinfo -&gt; -finalizerinfo
115 
<span class="line-modified">116         System.out.println(&quot;    &lt;no option&gt;             To print same info as Solaris pmap.&quot;);</span>
<span class="line-modified">117         System.out.println(&quot;    --heap                  To print java heap summary.&quot;);</span>
<span class="line-modified">118         System.out.println(&quot;    --binaryheap            To dump java heap in hprof binary format.&quot;);</span>
<span class="line-modified">119         System.out.println(&quot;    --dumpfile &lt;name&gt;       The name of the dump file.&quot;);</span>
<span class="line-modified">120         System.out.println(&quot;    --histo                 To print histogram of java object heap.&quot;);</span>
<span class="line-modified">121         System.out.println(&quot;    --clstats               To print class loader statistics.&quot;);</span>
<span class="line-modified">122         System.out.println(&quot;    --finalizerinfo         To print information on objects awaiting finalization.&quot;);</span>
<span class="line-modified">123         return commonHelpWithConnect(&quot;jmap&quot;);</span>
124     }
125 
126     private static boolean jstackHelp() {
127         // --locks -&gt; -l
128         // --mixed -&gt; -m
<span class="line-modified">129         System.out.println(&quot;    --locks                 To print java.util.concurrent locks.&quot;);</span>
<span class="line-modified">130         System.out.println(&quot;    --mixed                 To print both Java and native frames (mixed mode).&quot;);</span>
<span class="line-modified">131         return commonHelpWithConnect(&quot;jstack&quot;);</span>
132     }
133 
134     private static boolean jsnapHelp() {
<span class="line-modified">135         System.out.println(&quot;    --all                   To print all performance counters.&quot;);</span>
<span class="line-modified">136         return commonHelpWithConnect(&quot;jsnap&quot;);</span>
137     }
138 
139     private static boolean toolHelp(String toolName) {
<span class="line-modified">140         switch (toolName) {</span>
<span class="line-modified">141             case &quot;jstack&quot;:</span>
<span class="line-modified">142                 return jstackHelp();</span>
<span class="line-modified">143             case &quot;jinfo&quot;:</span>
<span class="line-modified">144                 return jinfoHelp();</span>
<span class="line-modified">145             case &quot;jmap&quot;:</span>
<span class="line-modified">146                 return jmapHelp();</span>
<span class="line-modified">147             case &quot;jsnap&quot;:</span>
<span class="line-modified">148                 return jsnapHelp();</span>
<span class="line-modified">149             case &quot;debugd&quot;:</span>
<span class="line-modified">150                 return debugdHelp();</span>
<span class="line-added">151             case &quot;hsdb&quot;:</span>
<span class="line-added">152             case &quot;clhsdb&quot;:</span>
<span class="line-added">153                 return commonHelp(toolName);</span>
<span class="line-added">154             default:</span>
<span class="line-added">155                 return launcherHelp();</span>
156         }







157     }
158 
<span class="line-modified">159     private static final String NO_REMOTE = null;</span>
<span class="line-modified">160 </span>
<span class="line-modified">161     private static String[] buildAttachArgs(Map&lt;String, String&gt; newArgMap,</span>
<span class="line-modified">162                                             boolean allowEmpty) {</span>
<span class="line-added">163         String pid = newArgMap.remove(&quot;pid&quot;);</span>
<span class="line-added">164         String exe = newArgMap.remove(&quot;exe&quot;);</span>
<span class="line-added">165         String core = newArgMap.remove(&quot;core&quot;);</span>
<span class="line-added">166         String connect = newArgMap.remove(&quot;connect&quot;);</span>
<span class="line-added">167         if (!allowEmpty &amp;&amp; (pid == null) &amp;&amp; (exe == null) &amp;&amp; (connect == NO_REMOTE)) {</span>
<span class="line-added">168             throw new SAGetoptException(&quot;You have to set --pid or --exe or --connect.&quot;);</span>
<span class="line-added">169         }</span>
<span class="line-added">170 </span>
<span class="line-added">171         List&lt;String&gt; newArgs = new ArrayList&lt;&gt;();</span>
<span class="line-added">172         for (var entry : newArgMap.entrySet()) {</span>
<span class="line-added">173             newArgs.add(entry.getKey());</span>
<span class="line-added">174             if (entry.getValue() != null) {</span>
<span class="line-added">175                 newArgs.add(entry.getValue());</span>
<span class="line-added">176             }</span>
177         }
178 
179         if (pid != null) { // Attach to live process
180             if (exe != null) {
181                 throw new SAGetoptException(&quot;Unnecessary argument: --exe&quot;);
182             } else if (core != null) {
183                 throw new SAGetoptException(&quot;Unnecessary argument: --core&quot;);
<span class="line-added">184             } else if (connect != NO_REMOTE) {</span>
<span class="line-added">185                 throw new SAGetoptException(&quot;Unnecessary argument: --connect&quot;);</span>
186             } else if (!pid.matches(&quot;^\\d+$&quot;)) {
187                 throw new SAGetoptException(&quot;Invalid pid: &quot; + pid);
188             }
189 
190             newArgs.add(pid);
191         } else if (exe != null) {
<span class="line-modified">192             if (connect != NO_REMOTE) {</span>
<span class="line-added">193                 throw new SAGetoptException(&quot;Unnecessary argument: --connect&quot;);</span>
<span class="line-added">194             } else if (exe.length() == 0) {</span>
195                 throw new SAGetoptException(&quot;You have to set --exe.&quot;);
196             }
197 
198             newArgs.add(exe);
199 
200             if ((core == null) || (core.length() == 0)) {
201                 throw new SAGetoptException(&quot;You have to set --core.&quot;);
202             }
203 
204             newArgs.add(core);
<span class="line-added">205         } else if (connect != NO_REMOTE) {</span>
<span class="line-added">206             newArgs.add(connect);</span>
207         }
<span class="line-added">208 </span>
<span class="line-added">209         return newArgs.toArray(new String[0]);</span>
210     }
211 
<span class="line-modified">212     /**</span>
<span class="line-added">213      * This method converts jhsdb-style options (oldArgs) to old fashioned</span>
<span class="line-added">214      * style. SALauncher delegates the work to the entry point of each tool.</span>
<span class="line-added">215      * Thus we need to convert the arguments.</span>
<span class="line-added">216      * For example, `jhsdb jstack --mixed` needs to be converted to `jstack -m`.</span>
<span class="line-added">217      *</span>
<span class="line-added">218      * longOptsMap holds the rule how this method should convert the args.</span>
<span class="line-added">219      * The key is the name of jhsdb style, the value is the name of</span>
<span class="line-added">220      * old fashioned style. If you want to convert mixed option in jstack,</span>
<span class="line-added">221      * you need to set &quot;mixed&quot; to the key, and to set &quot;-m&quot; to the value</span>
<span class="line-added">222      * in longOptsMap. If the option have the value, you need to add &quot;=&quot; to</span>
<span class="line-added">223      * the key like &quot;exe=&quot;.</span>
<span class="line-added">224      *</span>
<span class="line-added">225      * You also can set the options which cannot be mapped to old fashioned</span>
<span class="line-added">226      * arguments. For example, `jhsdb jmap --binaryheap` cannot be mapped to</span>
<span class="line-added">227      * `jmap` option directly. But you set it to longOptsMap, then you can know</span>
<span class="line-added">228      * the user sets &quot;binaryheap&quot; option, and SALauncher should set</span>
<span class="line-added">229      * &quot;-heap:format:b&quot; to jmap option.</span>
<span class="line-added">230      *</span>
<span class="line-added">231      * This method returns the map of the old fashioned key/val pairs.</span>
<span class="line-added">232      * It can be used to build args in string array at buildAttachArgs().</span>
<span class="line-added">233      */</span>
<span class="line-added">234     private static Map&lt;String, String&gt; parseOptions(String[] oldArgs,</span>
<span class="line-added">235                                                     Map&lt;String, String&gt; longOptsMap) {</span>
236         SAGetopt sg = new SAGetopt(oldArgs);
<span class="line-modified">237         String[] longOpts = longOptsMap.keySet().toArray(new String[0]);</span>
<span class="line-modified">238         Map&lt;String, String&gt; newArgMap = new HashMap&lt;&gt;();</span>
<span class="line-modified">239 </span>
<span class="line-modified">240         /*</span>
<span class="line-modified">241          * Parse each jhsdb-style option via SAGetopt.</span>
<span class="line-modified">242          * SAGetopt parses and validates the argument. If the user passes invalid</span>
<span class="line-modified">243          * option, SAGetoptException will be occurred at SAGetopt::next.</span>
<span class="line-modified">244          * Thus there is no need to validate it here.</span>
<span class="line-modified">245          *</span>
<span class="line-modified">246          * We can get option value via SAGetopt::get. If jhsdb-style option has</span>
<span class="line-modified">247          * &#39;=&#39; at the tail, we put old fashioned option with it to newArgMap.</span>
<span class="line-modified">248          */</span>
<span class="line-modified">249         String s;</span>
<span class="line-modified">250         while ((s = sg.next(null, longOpts)) != null) {</span>
<span class="line-modified">251             var val = longOptsMap.get(s);</span>
<span class="line-modified">252             if (val != null) {</span>
<span class="line-modified">253                 newArgMap.put(val, null);</span>
<span class="line-modified">254             } else {</span>
<span class="line-modified">255                 val = longOptsMap.get(s + &quot;=&quot;);</span>
<span class="line-modified">256                 if (val != null) {</span>
<span class="line-added">257                     newArgMap.put(val, sg.getOptarg());</span>
<span class="line-added">258                 }</span>
259             }
260         }
261 
<span class="line-modified">262         return newArgMap;</span>

263     }
264 
<span class="line-modified">265     private static void runCLHSDB(String[] oldArgs) {</span>
<span class="line-modified">266         Map&lt;String, String&gt; longOptsMap = Map.of(&quot;exe=&quot;, &quot;exe&quot;,</span>
<span class="line-modified">267                                                  &quot;core=&quot;, &quot;core&quot;,</span>
<span class="line-modified">268                                                  &quot;pid=&quot;, &quot;pid&quot;);</span>
<span class="line-modified">269         Map&lt;String, String&gt; newArgMap = parseOptions(oldArgs, longOptsMap);</span>
<span class="line-modified">270         CLHSDB.main(buildAttachArgs(newArgMap, true));</span>
<span class="line-modified">271     }</span>

















272 
<span class="line-modified">273     private static void runHSDB(String[] oldArgs) {</span>
<span class="line-modified">274         Map&lt;String, String&gt; longOptsMap = Map.of(&quot;exe=&quot;, &quot;exe&quot;,</span>
<span class="line-added">275                                                  &quot;core=&quot;, &quot;core&quot;,</span>
<span class="line-added">276                                                  &quot;pid=&quot;, &quot;pid&quot;);</span>
<span class="line-added">277         Map&lt;String, String&gt; newArgMap = parseOptions(oldArgs, longOptsMap);</span>
<span class="line-added">278         HSDB.main(buildAttachArgs(newArgMap, true));</span>
279     }
280 
281     private static void runJSTACK(String[] oldArgs) {
<span class="line-modified">282         Map&lt;String, String&gt; longOptsMap = Map.of(&quot;exe=&quot;, &quot;exe&quot;,</span>
<span class="line-modified">283                                                  &quot;core=&quot;, &quot;core&quot;,</span>
<span class="line-modified">284                                                  &quot;pid=&quot;, &quot;pid&quot;,</span>
<span class="line-modified">285                                                  &quot;connect=&quot;, &quot;connect&quot;,</span>
<span class="line-modified">286                                                  &quot;mixed&quot;, &quot;-m&quot;,</span>
<span class="line-modified">287                                                  &quot;locks&quot;, &quot;-l&quot;);</span>
<span class="line-modified">288         Map&lt;String, String&gt; newArgMap = parseOptions(oldArgs, longOptsMap);</span>



























289         JStack jstack = new JStack(false, false);
<span class="line-modified">290         jstack.runWithArgs(buildAttachArgs(newArgMap, false));</span>
291     }
292 
293     private static void runJMAP(String[] oldArgs) {
<span class="line-modified">294         Map&lt;String, String&gt; longOptsMap = Map.of(&quot;exe=&quot;, &quot;exe&quot;,</span>
<span class="line-modified">295                                                  &quot;core=&quot;, &quot;core&quot;,</span>
<span class="line-modified">296                                                  &quot;pid=&quot;, &quot;pid&quot;,</span>
<span class="line-modified">297                                                  &quot;connect=&quot;, &quot;connect&quot;,</span>
<span class="line-modified">298                                                  &quot;heap&quot;, &quot;-heap&quot;,</span>
<span class="line-modified">299                                                  &quot;binaryheap&quot;, &quot;binaryheap&quot;,</span>
<span class="line-modified">300                                                  &quot;dumpfile=&quot;, &quot;dumpfile&quot;,</span>
<span class="line-modified">301                                                  &quot;histo&quot;, &quot;-histo&quot;,</span>
<span class="line-modified">302                                                  &quot;clstats&quot;, &quot;-clstats&quot;,</span>
<span class="line-modified">303                                                  &quot;finalizerinfo&quot;, &quot;-finalizerinfo&quot;);</span>
<span class="line-modified">304         Map&lt;String, String&gt; newArgMap = parseOptions(oldArgs, longOptsMap);</span>
<span class="line-modified">305 </span>
<span class="line-modified">306         boolean requestHeapdump = newArgMap.containsKey(&quot;binaryheap&quot;);</span>
<span class="line-modified">307         String dumpfile = newArgMap.get(&quot;dumpfile&quot;);</span>





































308         if (!requestHeapdump &amp;&amp; (dumpfile != null)) {
<span class="line-modified">309             throw new IllegalArgumentException(&quot;Unexpected argument: dumpfile&quot;);</span>
310         }
311         if (requestHeapdump) {
312             if (dumpfile == null) {
<span class="line-modified">313                 newArgMap.put(&quot;-heap:format=b&quot;, null);</span>
314             } else {
<span class="line-modified">315                 newArgMap.put(&quot;-heap:format=b,file=&quot; + dumpfile, null);</span>
316             }
317         }
318 
<span class="line-modified">319         newArgMap.remove(&quot;binaryheap&quot;);</span>
<span class="line-modified">320         newArgMap.remove(&quot;dumpfile&quot;);</span>
<span class="line-added">321         JMap.main(buildAttachArgs(newArgMap, false));</span>
322     }
323 
324     private static void runJINFO(String[] oldArgs) {
<span class="line-modified">325         Map&lt;String, String&gt; longOptsMap = Map.of(&quot;exe=&quot;, &quot;exe&quot;,</span>
<span class="line-modified">326                                                  &quot;core=&quot;, &quot;core&quot;,</span>
<span class="line-modified">327                                                  &quot;pid=&quot;, &quot;pid&quot;,</span>
<span class="line-modified">328                                                  &quot;connect=&quot;, &quot;connect&quot;,</span>
<span class="line-modified">329                                                  &quot;flags&quot;, &quot;-flags&quot;,</span>
<span class="line-modified">330                                                  &quot;sysprops&quot;, &quot;-sysprops&quot;);</span>
<span class="line-modified">331         Map&lt;String, String&gt; newArgMap = parseOptions(oldArgs, longOptsMap);</span>
<span class="line-modified">332         JInfo.main(buildAttachArgs(newArgMap, false));</span>



























333     }
334 
335     private static void runJSNAP(String[] oldArgs) {
<span class="line-modified">336         Map&lt;String, String&gt; longOptsMap = Map.of(&quot;exe=&quot;, &quot;exe&quot;,</span>
<span class="line-modified">337                                                  &quot;core=&quot;, &quot;core&quot;,</span>
<span class="line-modified">338                                                  &quot;pid=&quot;, &quot;pid&quot;,</span>
<span class="line-modified">339                                                  &quot;connect=&quot;, &quot;connect&quot;,</span>
<span class="line-modified">340                                                  &quot;all&quot;, &quot;-a&quot;);</span>
<span class="line-modified">341         Map&lt;String, String&gt; newArgMap = parseOptions(oldArgs, longOptsMap);</span>
<span class="line-modified">342         JSnap.main(buildAttachArgs(newArgMap, false));</span>























343     }
344 
345     private static void runDEBUGD(String[] oldArgs) {




346         // By default SA agent classes prefer Windows process debugger
347         // to windbg debugger. SA expects special properties to be set
348         // to choose other debuggers. We will set those here before
349         // attaching to SA agent.
350         System.setProperty(&quot;sun.jvm.hotspot.debugger.useWindbgDebugger&quot;, &quot;true&quot;);
351 
<span class="line-added">352         Map&lt;String, String&gt; longOptsMap = Map.of(&quot;exe=&quot;, &quot;exe&quot;,</span>
<span class="line-added">353                                                  &quot;core=&quot;, &quot;core&quot;,</span>
<span class="line-added">354                                                  &quot;pid=&quot;, &quot;pid&quot;,</span>
<span class="line-added">355                                                  &quot;serverid=&quot;, &quot;serverid&quot;);</span>
<span class="line-added">356         Map&lt;String, String&gt; newArgMap = parseOptions(oldArgs, longOptsMap);</span>
<span class="line-added">357         var serverid = newArgMap.remove(&quot;serverid&quot;);</span>
<span class="line-added">358         List&lt;String&gt; newArgArray = new ArrayList&lt;&gt;();</span>
<span class="line-added">359         newArgArray.addAll(Arrays.asList(buildAttachArgs(newArgMap, false)));</span>
<span class="line-added">360 </span>
<span class="line-added">361         // `serverid` must be located at the tail.</span>
<span class="line-added">362         if (serverid != null) {</span>
<span class="line-added">363             newArgArray.add(serverid);</span>
<span class="line-added">364         }</span>
<span class="line-added">365 </span>
366         // delegate to the actual SA debug server.
<span class="line-modified">367         DebugServer.main(newArgArray.toArray(new String[0]));</span>
368     }
369 
<span class="line-added">370     // Key: tool name, Value: launcher method</span>
<span class="line-added">371     private static Map&lt;String, Consumer&lt;String[]&gt;&gt; toolMap =</span>
<span class="line-added">372         Map.of(&quot;clhsdb&quot;, SALauncher::runCLHSDB,</span>
<span class="line-added">373                &quot;hsdb&quot;, SALauncher::runHSDB,</span>
<span class="line-added">374                &quot;jstack&quot;, SALauncher::runJSTACK,</span>
<span class="line-added">375                &quot;jmap&quot;, SALauncher::runJMAP,</span>
<span class="line-added">376                &quot;jinfo&quot;, SALauncher::runJINFO,</span>
<span class="line-added">377                &quot;jsnap&quot;, SALauncher::runJSNAP,</span>
<span class="line-added">378                &quot;debugd&quot;, SALauncher::runDEBUGD);</span>
<span class="line-added">379 </span>
380     public static void main(String[] args) {
381         // Provide a help
382         if (args.length == 0) {
383             launcherHelp();
384             return;
385         }
386         // No arguments imply help for debugd, jstack, jmap, jinfo but launch clhsdb and hsdb
387         if (args.length == 1 &amp;&amp; !args[0].equals(&quot;clhsdb&quot;) &amp;&amp; !args[0].equals(&quot;hsdb&quot;)) {
388             toolHelp(args[0]);
389             return;
390         }
391 
392         for (String arg : args) {
393             if (arg.equals(&quot;-h&quot;) || arg.equals(&quot;-help&quot;) || arg.equals(&quot;--help&quot;)) {
394                 toolHelp(args[0]);
395                 return;
396             }
397         }
398 
399         String[] oldArgs = Arrays.copyOfRange(args, 1, args.length);
400 
401         try {
<span class="line-modified">402             var func = toolMap.get(args[0]);</span>
<span class="line-modified">403             if (func == null) {</span>
<span class="line-modified">404                 throw new SAGetoptException(&quot;Unknown tool: &quot; + args[0]);</span>
<span class="line-modified">405             } else {</span>
<span class="line-modified">406                 func.accept(oldArgs);</span>






























407             }


408         } catch (SAGetoptException e) {
409             System.err.println(e.getMessage());
410             toolHelp(args[0]);
411         }
412     }
413 }
</pre>
</td>
</tr>
</table>
<center><a href="HotSpotTypeDataBase.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ci/ciEnv.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>