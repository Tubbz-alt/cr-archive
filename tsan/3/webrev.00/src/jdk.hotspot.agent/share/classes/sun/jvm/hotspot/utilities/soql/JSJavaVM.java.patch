diff a/src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/utilities/soql/JSJavaVM.java b/src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/utilities/soql/JSJavaVM.java
--- a/src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/utilities/soql/JSJavaVM.java
+++ b/src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/utilities/soql/JSJavaVM.java
@@ -1,7 +1,7 @@
 /*
- * Copyright (c) 2004, 2007, Oracle and/or its affiliates. All rights reserved.
+ * Copyright (c) 2004, 2019, Oracle and/or its affiliates. All rights reserved.
  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  *
  * This code is free software; you can redistribute it and/or modify it
  * under the terms of the GNU General Public License version 2 only, as
  * published by the Free Software Foundation.
@@ -187,16 +187,16 @@
         return sysPropsCache;
     }
 
     private synchronized JSList getThreads() {
         if (threadsCache == null) {
-            List threads = new ArrayList(0);
-            threadsCache = factory.newJSList(threads);
-            JavaThread jthread = vm.getThreads().first();
-            while (jthread != null) {
-                threads.add(jthread);
-                jthread = jthread.next();
+            List threadsList = new ArrayList(0);
+            threadsCache = factory.newJSList(threadsList);
+            Threads threads = VM.getVM().getThreads();
+            for (int i = 0; i < threads.getNumberOfThreads(); i++) {
+                JavaThread thread = threads.getJavaThreadAt(i);
+                threadsList.add(thread);
             }
         }
         return threadsCache;
     }
 
