<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.hotspot.agent/macosx/native/libsaproc/MacosxDebuggerLocal.m</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../../linux/native/libsaproc/symtab.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="ps_core.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/macosx/native/libsaproc/MacosxDebuggerLocal.m</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2002, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  *
</pre>
<hr />
<pre>
 356 
 357   unsigned long alignedAddress;
 358   unsigned long alignedLength = 0;
 359   kern_return_t result;
 360   vm_offset_t *pages;
 361   int *mapped;
 362   long pageCount;
 363   uint byteCount;
 364   int i;
 365   unsigned long remaining;
 366 
 367   alignedAddress = trunc_page(addr);
 368   if (addr != alignedAddress) {
 369     alignedLength += addr - alignedAddress;
 370   }
 371   alignedLength = round_page(numBytes);
 372   pageCount = alignedLength/vm_page_size;
 373 
 374   // Allocate storage for pages and flags.
 375   pages = malloc(pageCount * sizeof(vm_offset_t));




 376   mapped = calloc(pageCount, sizeof(int));





 377 
 378   task_t gTask = getTask(env, this_obj);
 379   // Try to read each of the pages.
 380   for (i = 0; i &lt; pageCount; i++) {
 381     result = vm_read(gTask, alignedAddress + i*vm_page_size, vm_page_size,
 382 		     &amp;pages[i], &amp;byteCount);
 383     mapped[i] = (result == KERN_SUCCESS);
 384     // assume all failures are unmapped pages
 385   }
 386 
 387   print_debug(&quot;%ld pages\n&quot;, pageCount);
 388 
 389   remaining = numBytes;
 390 
 391   for (i = 0; i &lt; pageCount; i++) {
 392     unsigned long len = vm_page_size;
 393     unsigned long start = 0;
 394 
 395     if (i == 0) {
 396       start = addr - alignedAddress;
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2002, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  *
</pre>
<hr />
<pre>
 356 
 357   unsigned long alignedAddress;
 358   unsigned long alignedLength = 0;
 359   kern_return_t result;
 360   vm_offset_t *pages;
 361   int *mapped;
 362   long pageCount;
 363   uint byteCount;
 364   int i;
 365   unsigned long remaining;
 366 
 367   alignedAddress = trunc_page(addr);
 368   if (addr != alignedAddress) {
 369     alignedLength += addr - alignedAddress;
 370   }
 371   alignedLength = round_page(numBytes);
 372   pageCount = alignedLength/vm_page_size;
 373 
 374   // Allocate storage for pages and flags.
 375   pages = malloc(pageCount * sizeof(vm_offset_t));
<span class="line-added"> 376   if (pages == NULL) {</span>
<span class="line-added"> 377     (*env)-&gt;DeleteLocalRef(env, array);</span>
<span class="line-added"> 378     return NULL;</span>
<span class="line-added"> 379   }</span>
 380   mapped = calloc(pageCount, sizeof(int));
<span class="line-added"> 381   if (mapped == NULL) {</span>
<span class="line-added"> 382     (*env)-&gt;DeleteLocalRef(env, array);</span>
<span class="line-added"> 383     free(pages);</span>
<span class="line-added"> 384     return NULL;</span>
<span class="line-added"> 385   }</span>
 386 
 387   task_t gTask = getTask(env, this_obj);
 388   // Try to read each of the pages.
 389   for (i = 0; i &lt; pageCount; i++) {
 390     result = vm_read(gTask, alignedAddress + i*vm_page_size, vm_page_size,
 391 		     &amp;pages[i], &amp;byteCount);
 392     mapped[i] = (result == KERN_SUCCESS);
 393     // assume all failures are unmapped pages
 394   }
 395 
 396   print_debug(&quot;%ld pages\n&quot;, pageCount);
 397 
 398   remaining = numBytes;
 399 
 400   for (i = 0; i &lt; pageCount; i++) {
 401     unsigned long len = vm_page_size;
 402     unsigned long start = 0;
 403 
 404     if (i == 0) {
 405       start = addr - alignedAddress;
</pre>
</td>
</tr>
</table>
<center><a href="../../../linux/native/libsaproc/symtab.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="ps_core.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>