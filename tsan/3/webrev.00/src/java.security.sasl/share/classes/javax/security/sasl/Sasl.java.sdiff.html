<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.security.sasl/share/classes/javax/security/sasl/Sasl.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../com/sun/security/sasl/digest/DigestMD5Server.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../java.smartcardio/share/classes/javax/smartcardio/package-info.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.security.sasl/share/classes/javax/security/sasl/Sasl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1999, 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package javax.security.sasl;
 27 
 28 import javax.security.auth.callback.CallbackHandler;
<span class="line-modified"> 29 </span>


 30 import java.util.Enumeration;
 31 import java.util.Iterator;

 32 import java.util.Map;
 33 import java.util.Set;
 34 import java.util.HashSet;
 35 import java.util.Collections;
 36 import java.security.InvalidParameterException;
 37 import java.security.NoSuchAlgorithmException;
 38 import java.security.Provider;
 39 import java.security.Provider.Service;
 40 import java.security.Security;


 41 
 42 /**
 43  * A static class for creating SASL clients and servers.
 44  *&lt;p&gt;
 45  * This class defines the policy of how to locate, load, and instantiate
 46  * SASL clients and servers.
 47  *&lt;p&gt;
 48  * For example, an application or library gets a SASL client by doing
 49  * something like:
 50  *&lt;blockquote&gt;&lt;pre&gt;
 51  * SaslClient sc = Sasl.createSaslClient(mechanisms,
 52  *     authorizationId, protocol, serverName, props, callbackHandler);
 53  *&lt;/pre&gt;&lt;/blockquote&gt;
 54  * It can then proceed to use the instance to create an authentication connection.
 55  *&lt;p&gt;
 56  * Similarly, a server gets a SASL server by using code that looks as follows:
 57  *&lt;blockquote&gt;&lt;pre&gt;
 58  * SaslServer ss = Sasl.createSaslServer(mechanism,
 59  *     protocol, serverName, props, callbackHandler);
 60  *&lt;/pre&gt;&lt;/blockquote&gt;
 61  *
 62  * @since 1.5
 63  *
 64  * @author Rosanna Lee
 65  * @author Rob Weltman
 66  */
 67 public class Sasl {
























 68     // Cannot create one of these
 69     private Sasl() {
 70     }
 71 
 72     /**
 73      * The name of a property that specifies the quality-of-protection to use.
 74      * The property contains a comma-separated, ordered list
 75      * of quality-of-protection values that the
 76      * client or server is willing to support.  A qop value is one of
 77      * &lt;ul&gt;
 78      * &lt;li&gt;{@code &quot;auth&quot;} - authentication only&lt;/li&gt;
 79      * &lt;li&gt;{@code &quot;auth-int&quot;} - authentication plus integrity protection&lt;/li&gt;
 80      * &lt;li&gt;{@code &quot;auth-conf&quot;} - authentication plus integrity and confidentiality
 81      * protection&lt;/li&gt;
 82      * &lt;/ul&gt;
 83      *
 84      * The order of the list specifies the preference order of the client or
 85      * server. If this property is absent, the default qop is {@code &quot;auth&quot;}.
 86      * The value of this constant is {@code &quot;javax.security.sasl.qop&quot;}.
 87      */
</pre>
<hr />
<pre>
301      * and values that are class names of implementations of
302      * {@code javax.security.sasl.SaslClientFactory}.
303      *
304      * For example, a provider that contains a factory class,
305      * {@code com.wiz.sasl.digest.ClientFactory}, that supports the
306      * &quot;DIGEST-MD5&quot; mechanism would register the following entry with the JCA:
307      * {@code SaslClientFactory.DIGEST-MD5 com.wiz.sasl.digest.ClientFactory}
308      *&lt;p&gt;
309      * See the
310      * &quot;Java Cryptography Architecture API Specification &amp;amp; Reference&quot;
311      * for information about how to install and configure security service
312      *  providers.
313      *
314      * @implNote
315      * The JDK Reference Implementation additionally uses the
316      * {@code jdk.security.provider.preferred}
317      * {@link Security#getProperty(String) Security} property to determine
318      * the preferred provider order for the specified algorithm. This
319      * may be different than the order of providers returned by
320      * {@link Security#getProviders() Security.getProviders()}.



321      *
322      * @param mechanisms The non-null list of mechanism names to try. Each is the
323      * IANA-registered name of a SASL mechanism. (e.g. &quot;GSSAPI&quot;, &quot;CRAM-MD5&quot;).
324      * @param authorizationId The possibly null protocol-dependent
325      * identification to be used for authorization.
326      * If null or empty, the server derives an authorization
327      * ID from the client&#39;s authentication credentials.
328      * When the SASL authentication completes successfully,
329      * the specified entity is granted access.
330      *
331      * @param protocol The non-null string name of the protocol for which
332      * the authentication is being performed (e.g., &quot;ldap&quot;).
333      *
334      * @param serverName The non-null fully-qualified host name of the server
335      * to authenticate to.
336      *
337      * @param props The possibly null set of properties used to
338      * select the SASL mechanism and to configure the authentication
339      * exchange of the selected mechanism.
340      * For example, if {@code props} contains the
</pre>
<hr />
<pre>
364      */
365     public static SaslClient createSaslClient(
366         String[] mechanisms,
367         String authorizationId,
368         String protocol,
369         String serverName,
370         Map&lt;String,?&gt; props,
371         CallbackHandler cbh) throws SaslException {
372 
373         SaslClient mech = null;
374         SaslClientFactory fac;
375         Service service;
376         String mechName;
377 
378         for (int i = 0; i &lt; mechanisms.length; i++) {
379             if ((mechName=mechanisms[i]) == null) {
380                 throw new NullPointerException(
381                     &quot;Mechanism name cannot be null&quot;);
382             } else if (mechName.length() == 0) {
383                 continue;




384             }
385             String type = &quot;SaslClientFactory&quot;;
386             Provider[] provs = Security.getProviders(type + &quot;.&quot; + mechName);
387             if (provs != null) {
388                 for (Provider p : provs) {
389                     service = p.getService(type, mechName);
390                     if (service == null) {
391                         // no such service exists
392                         continue;
393                     }
394 
395                     fac = (SaslClientFactory) loadFactory(service);
396                     if (fac != null) {
397                         mech = fac.createSaslClient(
398                             new String[]{mechanisms[i]}, authorizationId,
399                             protocol, serverName, props, cbh);
400                         if (mech != null) {
401                             return mech;
402                         }
403                     }
</pre>
<hr />
<pre>
451      * and values that are class names of implementations of
452      * {@code javax.security.sasl.SaslServerFactory}.
453      *
454      * For example, a provider that contains a factory class,
455      * {@code com.wiz.sasl.digest.ServerFactory}, that supports the
456      * &quot;DIGEST-MD5&quot; mechanism would register the following entry with the JCA:
457      * {@code SaslServerFactory.DIGEST-MD5  com.wiz.sasl.digest.ServerFactory}
458      *&lt;p&gt;
459      * See the
460      * &quot;Java Cryptography Architecture API Specification &amp;amp; Reference&quot;
461      * for information about how to install and configure security
462      * service providers.
463      *
464      * @implNote
465      * The JDK Reference Implementation additionally uses the
466      * {@code jdk.security.provider.preferred}
467      * {@link Security#getProperty(String) Security} property to determine
468      * the preferred provider order for the specified algorithm. This
469      * may be different than the order of providers returned by
470      * {@link Security#getProviders() Security.getProviders()}.



471      *
472      * @param mechanism The non-null mechanism name. It must be an
473      * IANA-registered name of a SASL mechanism. (e.g. &quot;GSSAPI&quot;, &quot;CRAM-MD5&quot;).
474      * @param protocol The non-null string name of the protocol for which
475      * the authentication is being performed (e.g., &quot;ldap&quot;).
476      * @param serverName The fully qualified host name of the server, or null
477      * if the server is not bound to any specific host name. If the mechanism
478      * does not allow an unbound server, a {@code SaslException} will
479      * be thrown.
480      * @param props The possibly null set of properties used to
481      * select the SASL mechanism and to configure the authentication
482      * exchange of the selected mechanism.
483      * For example, if {@code props} contains the
484      * {@code Sasl.POLICY_NOPLAINTEXT} property with the value
485      * {@code &quot;true&quot;}, then the selected
486      * SASL mechanism must not be susceptible to simple plain passive attacks.
487      * In addition to the standard properties declared in this class,
488      * other, possibly mechanism-specific, properties can be included.
489      * Properties not relevant to the selected mechanism are ignored,
490      * including any map entries with non-String keys.
</pre>
<hr />
<pre>
504      * that will produce one.
505      *@exception SaslException If cannot create a {@code SaslServer} because
506      * of an error.
507      **/
508     public static SaslServer
509         createSaslServer(String mechanism,
510                     String protocol,
511                     String serverName,
512                     Map&lt;String,?&gt; props,
513                     javax.security.auth.callback.CallbackHandler cbh)
514         throws SaslException {
515 
516         SaslServer mech = null;
517         SaslServerFactory fac;
518         Service service;
519 
520         if (mechanism == null) {
521             throw new NullPointerException(&quot;Mechanism name cannot be null&quot;);
522         } else if (mechanism.length() == 0) {
523             return null;




524         }
525 
526         String type = &quot;SaslServerFactory&quot;;
527         Provider[] provs = Security.getProviders(type + &quot;.&quot; + mechanism);
528         if (provs != null) {
529             for (Provider p : provs) {
530                 service = p.getService(type, mechanism);
531                 if (service == null) {
532                     throw new SaslException(&quot;Provider does not support &quot; +
533                         mechanism + &quot; &quot; + type);
534                 }
535                 fac = (SaslServerFactory) loadFactory(service);
536                 if (fac != null) {
537                     mech = fac.createSaslServer(
538                         mechanism, protocol, serverName, props, cbh);
539                     if (mech != null) {
540                         return mech;
541                     }
542                 }
543             }
</pre>
<hr />
<pre>
599         Object fac;
600 
601         for (Provider p : provs) {
602 
603             Iterator&lt;Service&gt; iter = p.getServices().iterator();
604             while (iter.hasNext()) {
605                 Service s = iter.next();
606                 if (s.getType().equals(serviceName)) {
607                     try {
608                         fac = loadFactory(s);
609                         if (fac != null) {
610                             result.add(fac);
611                         }
612                     } catch (Exception ignore) {
613                     }
614                 }
615             }
616         }
617         return Collections.unmodifiableSet(result);
618     }




619 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1999, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package javax.security.sasl;
 27 
 28 import javax.security.auth.callback.CallbackHandler;
<span class="line-modified"> 29 import java.security.AccessController;</span>
<span class="line-added"> 30 import java.security.PrivilegedAction;</span>
<span class="line-added"> 31 import java.util.ArrayList;</span>
 32 import java.util.Enumeration;
 33 import java.util.Iterator;
<span class="line-added"> 34 import java.util.List;</span>
 35 import java.util.Map;
 36 import java.util.Set;
 37 import java.util.HashSet;
 38 import java.util.Collections;
 39 import java.security.InvalidParameterException;
 40 import java.security.NoSuchAlgorithmException;
 41 import java.security.Provider;
 42 import java.security.Provider.Service;
 43 import java.security.Security;
<span class="line-added"> 44 import java.util.logging.Level;</span>
<span class="line-added"> 45 import java.util.logging.Logger;</span>
 46 
 47 /**
 48  * A static class for creating SASL clients and servers.
 49  *&lt;p&gt;
 50  * This class defines the policy of how to locate, load, and instantiate
 51  * SASL clients and servers.
 52  *&lt;p&gt;
 53  * For example, an application or library gets a SASL client by doing
 54  * something like:
 55  *&lt;blockquote&gt;&lt;pre&gt;
 56  * SaslClient sc = Sasl.createSaslClient(mechanisms,
 57  *     authorizationId, protocol, serverName, props, callbackHandler);
 58  *&lt;/pre&gt;&lt;/blockquote&gt;
 59  * It can then proceed to use the instance to create an authentication connection.
 60  *&lt;p&gt;
 61  * Similarly, a server gets a SASL server by using code that looks as follows:
 62  *&lt;blockquote&gt;&lt;pre&gt;
 63  * SaslServer ss = Sasl.createSaslServer(mechanism,
 64  *     protocol, serverName, props, callbackHandler);
 65  *&lt;/pre&gt;&lt;/blockquote&gt;
 66  *
 67  * @since 1.5
 68  *
 69  * @author Rosanna Lee
 70  * @author Rob Weltman
 71  */
 72 public class Sasl {
<span class="line-added"> 73 </span>
<span class="line-added"> 74     private static List&lt;String&gt; disabledMechanisms = new ArrayList&lt;&gt;();</span>
<span class="line-added"> 75 </span>
<span class="line-added"> 76     static {</span>
<span class="line-added"> 77         String prop = AccessController.doPrivileged(</span>
<span class="line-added"> 78                 (PrivilegedAction&lt;String&gt;)</span>
<span class="line-added"> 79                 () -&gt; Security.getProperty(&quot;jdk.sasl.disabledMechanisms&quot;));</span>
<span class="line-added"> 80 </span>
<span class="line-added"> 81         if (prop != null) {</span>
<span class="line-added"> 82             for (String s : prop.split(&quot;\\s*,\\s*&quot;)) {</span>
<span class="line-added"> 83                 if (!s.isEmpty()) {</span>
<span class="line-added"> 84                     disabledMechanisms.add(s);</span>
<span class="line-added"> 85                 }</span>
<span class="line-added"> 86             }</span>
<span class="line-added"> 87         }</span>
<span class="line-added"> 88     }</span>
<span class="line-added"> 89 </span>
<span class="line-added"> 90     private static final String SASL_LOGGER_NAME = &quot;javax.security.sasl&quot;;</span>
<span class="line-added"> 91 </span>
<span class="line-added"> 92     /**</span>
<span class="line-added"> 93      * Logger for debug messages</span>
<span class="line-added"> 94      */</span>
<span class="line-added"> 95     private static final Logger logger = Logger.getLogger(SASL_LOGGER_NAME);</span>
<span class="line-added"> 96 </span>
 97     // Cannot create one of these
 98     private Sasl() {
 99     }
100 
101     /**
102      * The name of a property that specifies the quality-of-protection to use.
103      * The property contains a comma-separated, ordered list
104      * of quality-of-protection values that the
105      * client or server is willing to support.  A qop value is one of
106      * &lt;ul&gt;
107      * &lt;li&gt;{@code &quot;auth&quot;} - authentication only&lt;/li&gt;
108      * &lt;li&gt;{@code &quot;auth-int&quot;} - authentication plus integrity protection&lt;/li&gt;
109      * &lt;li&gt;{@code &quot;auth-conf&quot;} - authentication plus integrity and confidentiality
110      * protection&lt;/li&gt;
111      * &lt;/ul&gt;
112      *
113      * The order of the list specifies the preference order of the client or
114      * server. If this property is absent, the default qop is {@code &quot;auth&quot;}.
115      * The value of this constant is {@code &quot;javax.security.sasl.qop&quot;}.
116      */
</pre>
<hr />
<pre>
330      * and values that are class names of implementations of
331      * {@code javax.security.sasl.SaslClientFactory}.
332      *
333      * For example, a provider that contains a factory class,
334      * {@code com.wiz.sasl.digest.ClientFactory}, that supports the
335      * &quot;DIGEST-MD5&quot; mechanism would register the following entry with the JCA:
336      * {@code SaslClientFactory.DIGEST-MD5 com.wiz.sasl.digest.ClientFactory}
337      *&lt;p&gt;
338      * See the
339      * &quot;Java Cryptography Architecture API Specification &amp;amp; Reference&quot;
340      * for information about how to install and configure security service
341      *  providers.
342      *
343      * @implNote
344      * The JDK Reference Implementation additionally uses the
345      * {@code jdk.security.provider.preferred}
346      * {@link Security#getProperty(String) Security} property to determine
347      * the preferred provider order for the specified algorithm. This
348      * may be different than the order of providers returned by
349      * {@link Security#getProviders() Security.getProviders()}.
<span class="line-added">350      * &lt;p&gt;</span>
<span class="line-added">351      * If a mechanism is listed in the {@code jdk.sasl.disabledMechanisms}</span>
<span class="line-added">352      * security property, it will be ignored and won&#39;t be negotiated.</span>
353      *
354      * @param mechanisms The non-null list of mechanism names to try. Each is the
355      * IANA-registered name of a SASL mechanism. (e.g. &quot;GSSAPI&quot;, &quot;CRAM-MD5&quot;).
356      * @param authorizationId The possibly null protocol-dependent
357      * identification to be used for authorization.
358      * If null or empty, the server derives an authorization
359      * ID from the client&#39;s authentication credentials.
360      * When the SASL authentication completes successfully,
361      * the specified entity is granted access.
362      *
363      * @param protocol The non-null string name of the protocol for which
364      * the authentication is being performed (e.g., &quot;ldap&quot;).
365      *
366      * @param serverName The non-null fully-qualified host name of the server
367      * to authenticate to.
368      *
369      * @param props The possibly null set of properties used to
370      * select the SASL mechanism and to configure the authentication
371      * exchange of the selected mechanism.
372      * For example, if {@code props} contains the
</pre>
<hr />
<pre>
396      */
397     public static SaslClient createSaslClient(
398         String[] mechanisms,
399         String authorizationId,
400         String protocol,
401         String serverName,
402         Map&lt;String,?&gt; props,
403         CallbackHandler cbh) throws SaslException {
404 
405         SaslClient mech = null;
406         SaslClientFactory fac;
407         Service service;
408         String mechName;
409 
410         for (int i = 0; i &lt; mechanisms.length; i++) {
411             if ((mechName=mechanisms[i]) == null) {
412                 throw new NullPointerException(
413                     &quot;Mechanism name cannot be null&quot;);
414             } else if (mechName.length() == 0) {
415                 continue;
<span class="line-added">416             } else if (isDisabled(mechName)) {</span>
<span class="line-added">417                 logger.log(Level.FINE,</span>
<span class="line-added">418                         &quot;Disabled &quot; + mechName + &quot; mechanism ignored&quot;);</span>
<span class="line-added">419                 continue;</span>
420             }
421             String type = &quot;SaslClientFactory&quot;;
422             Provider[] provs = Security.getProviders(type + &quot;.&quot; + mechName);
423             if (provs != null) {
424                 for (Provider p : provs) {
425                     service = p.getService(type, mechName);
426                     if (service == null) {
427                         // no such service exists
428                         continue;
429                     }
430 
431                     fac = (SaslClientFactory) loadFactory(service);
432                     if (fac != null) {
433                         mech = fac.createSaslClient(
434                             new String[]{mechanisms[i]}, authorizationId,
435                             protocol, serverName, props, cbh);
436                         if (mech != null) {
437                             return mech;
438                         }
439                     }
</pre>
<hr />
<pre>
487      * and values that are class names of implementations of
488      * {@code javax.security.sasl.SaslServerFactory}.
489      *
490      * For example, a provider that contains a factory class,
491      * {@code com.wiz.sasl.digest.ServerFactory}, that supports the
492      * &quot;DIGEST-MD5&quot; mechanism would register the following entry with the JCA:
493      * {@code SaslServerFactory.DIGEST-MD5  com.wiz.sasl.digest.ServerFactory}
494      *&lt;p&gt;
495      * See the
496      * &quot;Java Cryptography Architecture API Specification &amp;amp; Reference&quot;
497      * for information about how to install and configure security
498      * service providers.
499      *
500      * @implNote
501      * The JDK Reference Implementation additionally uses the
502      * {@code jdk.security.provider.preferred}
503      * {@link Security#getProperty(String) Security} property to determine
504      * the preferred provider order for the specified algorithm. This
505      * may be different than the order of providers returned by
506      * {@link Security#getProviders() Security.getProviders()}.
<span class="line-added">507      * &lt;p&gt;</span>
<span class="line-added">508      * If {@code mechanism} is listed in the {@code jdk.sasl.disabledMechanisms}</span>
<span class="line-added">509      * security property, it will be ignored and this method returns {@code null}.</span>
510      *
511      * @param mechanism The non-null mechanism name. It must be an
512      * IANA-registered name of a SASL mechanism. (e.g. &quot;GSSAPI&quot;, &quot;CRAM-MD5&quot;).
513      * @param protocol The non-null string name of the protocol for which
514      * the authentication is being performed (e.g., &quot;ldap&quot;).
515      * @param serverName The fully qualified host name of the server, or null
516      * if the server is not bound to any specific host name. If the mechanism
517      * does not allow an unbound server, a {@code SaslException} will
518      * be thrown.
519      * @param props The possibly null set of properties used to
520      * select the SASL mechanism and to configure the authentication
521      * exchange of the selected mechanism.
522      * For example, if {@code props} contains the
523      * {@code Sasl.POLICY_NOPLAINTEXT} property with the value
524      * {@code &quot;true&quot;}, then the selected
525      * SASL mechanism must not be susceptible to simple plain passive attacks.
526      * In addition to the standard properties declared in this class,
527      * other, possibly mechanism-specific, properties can be included.
528      * Properties not relevant to the selected mechanism are ignored,
529      * including any map entries with non-String keys.
</pre>
<hr />
<pre>
543      * that will produce one.
544      *@exception SaslException If cannot create a {@code SaslServer} because
545      * of an error.
546      **/
547     public static SaslServer
548         createSaslServer(String mechanism,
549                     String protocol,
550                     String serverName,
551                     Map&lt;String,?&gt; props,
552                     javax.security.auth.callback.CallbackHandler cbh)
553         throws SaslException {
554 
555         SaslServer mech = null;
556         SaslServerFactory fac;
557         Service service;
558 
559         if (mechanism == null) {
560             throw new NullPointerException(&quot;Mechanism name cannot be null&quot;);
561         } else if (mechanism.length() == 0) {
562             return null;
<span class="line-added">563         } else if (isDisabled(mechanism)) {</span>
<span class="line-added">564             logger.log(Level.FINE,</span>
<span class="line-added">565                     &quot;Disabled &quot; + mechanism + &quot; mechanism ignored&quot;);</span>
<span class="line-added">566             return null;</span>
567         }
568 
569         String type = &quot;SaslServerFactory&quot;;
570         Provider[] provs = Security.getProviders(type + &quot;.&quot; + mechanism);
571         if (provs != null) {
572             for (Provider p : provs) {
573                 service = p.getService(type, mechanism);
574                 if (service == null) {
575                     throw new SaslException(&quot;Provider does not support &quot; +
576                         mechanism + &quot; &quot; + type);
577                 }
578                 fac = (SaslServerFactory) loadFactory(service);
579                 if (fac != null) {
580                     mech = fac.createSaslServer(
581                         mechanism, protocol, serverName, props, cbh);
582                     if (mech != null) {
583                         return mech;
584                     }
585                 }
586             }
</pre>
<hr />
<pre>
642         Object fac;
643 
644         for (Provider p : provs) {
645 
646             Iterator&lt;Service&gt; iter = p.getServices().iterator();
647             while (iter.hasNext()) {
648                 Service s = iter.next();
649                 if (s.getType().equals(serviceName)) {
650                     try {
651                         fac = loadFactory(s);
652                         if (fac != null) {
653                             result.add(fac);
654                         }
655                     } catch (Exception ignore) {
656                     }
657                 }
658             }
659         }
660         return Collections.unmodifiableSet(result);
661     }
<span class="line-added">662 </span>
<span class="line-added">663     private static boolean isDisabled(String name) {</span>
<span class="line-added">664         return disabledMechanisms.contains(name);</span>
<span class="line-added">665     }</span>
666 }
</pre>
</td>
</tr>
</table>
<center><a href="../../../com/sun/security/sasl/digest/DigestMD5Server.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../java.smartcardio/share/classes/javax/smartcardio/package-info.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>