<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.security.sasl/share/classes/javax/security/sasl/Sasl.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../com/sun/security/sasl/digest/DigestMD5Server.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../java.smartcardio/share/classes/javax/smartcardio/package-info.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.security.sasl/share/classes/javax/security/sasl/Sasl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 1999, 2017, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 1999, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -24,22 +24,27 @@</span>
   */
  
  package javax.security.sasl;
  
  import javax.security.auth.callback.CallbackHandler;
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-added">+ import java.security.AccessController;</span>
<span class="udiff-line-added">+ import java.security.PrivilegedAction;</span>
<span class="udiff-line-added">+ import java.util.ArrayList;</span>
  import java.util.Enumeration;
  import java.util.Iterator;
<span class="udiff-line-added">+ import java.util.List;</span>
  import java.util.Map;
  import java.util.Set;
  import java.util.HashSet;
  import java.util.Collections;
  import java.security.InvalidParameterException;
  import java.security.NoSuchAlgorithmException;
  import java.security.Provider;
  import java.security.Provider.Service;
  import java.security.Security;
<span class="udiff-line-added">+ import java.util.logging.Level;</span>
<span class="udiff-line-added">+ import java.util.logging.Logger;</span>
  
  /**
   * A static class for creating SASL clients and servers.
   *&lt;p&gt;
   * This class defines the policy of how to locate, load, and instantiate
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -63,10 +68,34 @@</span>
   *
   * @author Rosanna Lee
   * @author Rob Weltman
   */
  public class Sasl {
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private static List&lt;String&gt; disabledMechanisms = new ArrayList&lt;&gt;();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     static {</span>
<span class="udiff-line-added">+         String prop = AccessController.doPrivileged(</span>
<span class="udiff-line-added">+                 (PrivilegedAction&lt;String&gt;)</span>
<span class="udiff-line-added">+                 () -&gt; Security.getProperty(&quot;jdk.sasl.disabledMechanisms&quot;));</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (prop != null) {</span>
<span class="udiff-line-added">+             for (String s : prop.split(&quot;\\s*,\\s*&quot;)) {</span>
<span class="udiff-line-added">+                 if (!s.isEmpty()) {</span>
<span class="udiff-line-added">+                     disabledMechanisms.add(s);</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private static final String SASL_LOGGER_NAME = &quot;javax.security.sasl&quot;;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * Logger for debug messages</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     private static final Logger logger = Logger.getLogger(SASL_LOGGER_NAME);</span>
<span class="udiff-line-added">+ </span>
      // Cannot create one of these
      private Sasl() {
      }
  
      /**
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -316,10 +345,13 @@</span>
       * {@code jdk.security.provider.preferred}
       * {@link Security#getProperty(String) Security} property to determine
       * the preferred provider order for the specified algorithm. This
       * may be different than the order of providers returned by
       * {@link Security#getProviders() Security.getProviders()}.
<span class="udiff-line-added">+      * &lt;p&gt;</span>
<span class="udiff-line-added">+      * If a mechanism is listed in the {@code jdk.sasl.disabledMechanisms}</span>
<span class="udiff-line-added">+      * security property, it will be ignored and won&#39;t be negotiated.</span>
       *
       * @param mechanisms The non-null list of mechanism names to try. Each is the
       * IANA-registered name of a SASL mechanism. (e.g. &quot;GSSAPI&quot;, &quot;CRAM-MD5&quot;).
       * @param authorizationId The possibly null protocol-dependent
       * identification to be used for authorization.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -379,10 +411,14 @@</span>
              if ((mechName=mechanisms[i]) == null) {
                  throw new NullPointerException(
                      &quot;Mechanism name cannot be null&quot;);
              } else if (mechName.length() == 0) {
                  continue;
<span class="udiff-line-added">+             } else if (isDisabled(mechName)) {</span>
<span class="udiff-line-added">+                 logger.log(Level.FINE,</span>
<span class="udiff-line-added">+                         &quot;Disabled &quot; + mechName + &quot; mechanism ignored&quot;);</span>
<span class="udiff-line-added">+                 continue;</span>
              }
              String type = &quot;SaslClientFactory&quot;;
              Provider[] provs = Security.getProviders(type + &quot;.&quot; + mechName);
              if (provs != null) {
                  for (Provider p : provs) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -466,10 +502,13 @@</span>
       * {@code jdk.security.provider.preferred}
       * {@link Security#getProperty(String) Security} property to determine
       * the preferred provider order for the specified algorithm. This
       * may be different than the order of providers returned by
       * {@link Security#getProviders() Security.getProviders()}.
<span class="udiff-line-added">+      * &lt;p&gt;</span>
<span class="udiff-line-added">+      * If {@code mechanism} is listed in the {@code jdk.sasl.disabledMechanisms}</span>
<span class="udiff-line-added">+      * security property, it will be ignored and this method returns {@code null}.</span>
       *
       * @param mechanism The non-null mechanism name. It must be an
       * IANA-registered name of a SASL mechanism. (e.g. &quot;GSSAPI&quot;, &quot;CRAM-MD5&quot;).
       * @param protocol The non-null string name of the protocol for which
       * the authentication is being performed (e.g., &quot;ldap&quot;).
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -519,10 +558,14 @@</span>
  
          if (mechanism == null) {
              throw new NullPointerException(&quot;Mechanism name cannot be null&quot;);
          } else if (mechanism.length() == 0) {
              return null;
<span class="udiff-line-added">+         } else if (isDisabled(mechanism)) {</span>
<span class="udiff-line-added">+             logger.log(Level.FINE,</span>
<span class="udiff-line-added">+                     &quot;Disabled &quot; + mechanism + &quot; mechanism ignored&quot;);</span>
<span class="udiff-line-added">+             return null;</span>
          }
  
          String type = &quot;SaslServerFactory&quot;;
          Provider[] provs = Security.getProviders(type + &quot;.&quot; + mechanism);
          if (provs != null) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -614,6 +657,10 @@</span>
                  }
              }
          }
          return Collections.unmodifiableSet(result);
      }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private static boolean isDisabled(String name) {</span>
<span class="udiff-line-added">+         return disabledMechanisms.contains(name);</span>
<span class="udiff-line-added">+     }</span>
  }
</pre>
<center><a href="../../../com/sun/security/sasl/digest/DigestMD5Server.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../java.smartcardio/share/classes/javax/smartcardio/package-info.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>