<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.security.sasl/share/classes/com/sun/security/sasl/PlainClient.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ExternalClient.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="digest/DigestMD5Base.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.security.sasl/share/classes/com/sun/security/sasl/PlainClient.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -25,10 +25,12 @@</span>
  
  package com.sun.security.sasl;
  
  import javax.security.sasl.*;
  
<span class="udiff-line-added">+ import static java.nio.charset.StandardCharsets.UTF_8;</span>
<span class="udiff-line-added">+ </span>
  /**
    * Implements the PLAIN SASL client mechanism.
    * (&lt;A
    * HREF=&quot;http://ftp.isi.edu/in-notes/rfc2595.txt&quot;&gt;RFC 2595&lt;/A&gt;)
    *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -87,47 +89,41 @@</span>
       * PLAIN is the concatenation of authorization ID, authentication ID
       * and password, with each component separated by the US-ASCII &lt;NUL&gt; byte.
       *
       * @param challengeData Ignored
       * @return A non-null byte array containing the response to be sent to the server.
<span class="udiff-line-modified-removed">-      * @throws SaslException If cannot encode ids in UTF-8</span>
<span class="udiff-line-removed">-      * @throw IllegalStateException if authentication already completed</span>
<span class="udiff-line-modified-added">+      * @throws IllegalStateException if authentication already completed</span>
       */
<span class="udiff-line-modified-removed">-     public byte[] evaluateChallenge(byte[] challengeData) throws SaslException {</span>
<span class="udiff-line-modified-added">+     public byte[] evaluateChallenge(byte[] challengeData) {</span>
          if (completed) {
              throw new IllegalStateException(
                  &quot;PLAIN authentication already completed&quot;);
          }
          completed = true;
<span class="udiff-line-added">+         byte[] authz = (authorizationID != null)</span>
<span class="udiff-line-added">+             ? authorizationID.getBytes(UTF_8)</span>
<span class="udiff-line-added">+             : null;</span>
<span class="udiff-line-added">+         byte[] auth = authenticationID.getBytes(UTF_8);</span>
  
<span class="udiff-line-modified-removed">-         try {</span>
<span class="udiff-line-removed">-             byte[] authz = (authorizationID != null)?</span>
<span class="udiff-line-removed">-                 authorizationID.getBytes(&quot;UTF8&quot;) :</span>
<span class="udiff-line-removed">-                 null;</span>
<span class="udiff-line-removed">-             byte[] auth = authenticationID.getBytes(&quot;UTF8&quot;);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             byte[] answer = new byte[pw.length + auth.length + 2 +</span>
<span class="udiff-line-modified-added">+         byte[] answer = new byte[pw.length + auth.length + 2 +</span>
                  (authz == null ? 0 : authz.length)];
  
<span class="udiff-line-modified-removed">-             int pos = 0;</span>
<span class="udiff-line-modified-removed">-             if (authz != null) {</span>
<span class="udiff-line-modified-removed">-                 System.arraycopy(authz, 0, answer, 0, authz.length);</span>
<span class="udiff-line-modified-removed">-                 pos = authz.length;</span>
<span class="udiff-line-modified-removed">-             }</span>
<span class="udiff-line-modified-removed">-             answer[pos++] = SEP;</span>
<span class="udiff-line-modified-removed">-             System.arraycopy(auth, 0, answer, pos, auth.length);</span>
<span class="udiff-line-modified-added">+         int pos = 0;</span>
<span class="udiff-line-modified-added">+         if (authz != null) {</span>
<span class="udiff-line-modified-added">+             System.arraycopy(authz, 0, answer, 0, authz.length);</span>
<span class="udiff-line-modified-added">+             pos = authz.length;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         answer[pos++] = SEP;</span>
<span class="udiff-line-modified-added">+         System.arraycopy(auth, 0, answer, pos, auth.length);</span>
  
<span class="udiff-line-modified-removed">-             pos += auth.length;</span>
<span class="udiff-line-modified-removed">-             answer[pos++] = SEP;</span>
<span class="udiff-line-modified-added">+         pos += auth.length;</span>
<span class="udiff-line-modified-added">+         answer[pos++] = SEP;</span>
  
<span class="udiff-line-modified-removed">-             System.arraycopy(pw, 0, answer, pos, pw.length);</span>
<span class="udiff-line-modified-added">+         System.arraycopy(pw, 0, answer, pos, pw.length);</span>
  
<span class="udiff-line-modified-removed">-             clearPassword();</span>
<span class="udiff-line-modified-removed">-             return answer;</span>
<span class="udiff-line-removed">-         } catch (java.io.UnsupportedEncodingException e) {</span>
<span class="udiff-line-removed">-             throw new SaslException(&quot;Cannot get UTF-8 encoding of ids&quot;, e);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+         clearPassword();</span>
<span class="udiff-line-modified-added">+         return answer;</span>
      }
  
      /**
       * Determines whether this mechanism has completed.
       * Plain completes after returning one response.
</pre>
<center><a href="ExternalClient.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="digest/DigestMD5Base.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>