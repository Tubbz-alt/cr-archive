<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.internal.vm.ci/share/classes/jdk.vm.ci.hotspot/src/jdk/vm/ci/hotspot/HotSpotVMConfig.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="HotSpotSpeculationLog.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="HotSpotVMConfigAccess.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.vm.ci/share/classes/jdk.vm.ci.hotspot/src/jdk/vm/ci/hotspot/HotSpotVMConfig.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -23,10 +23,11 @@</span>
  package jdk.vm.ci.hotspot;
  
  import static jdk.vm.ci.hotspot.HotSpotJVMCIRuntime.runtime;
  import static jdk.vm.ci.hotspot.UnsafeAccess.UNSAFE;
  
<span class="udiff-line-added">+ import jdk.vm.ci.services.Services;</span>
  import jdk.internal.misc.Unsafe;
  
  /**
   * Used to access native configuration details.
   *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -50,11 +51,11 @@</span>
      /**
       * Gets the host architecture name for the purpose of finding the corresponding
       * {@linkplain HotSpotJVMCIBackendFactory backend}.
       */
      String getHostArchitectureName() {
<span class="udiff-line-modified-removed">-         String arch = System.getProperty(&quot;os.arch&quot;);</span>
<span class="udiff-line-modified-added">+         String arch = Services.getSavedProperty(&quot;os.arch&quot;);</span>
          switch (arch) {
              case &quot;x86_64&quot;:
                  return &quot;amd64&quot;;
  
              case &quot;sparcv9&quot;:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -68,20 +69,25 @@</span>
  
      final boolean useCompressedOops = getFlag(&quot;UseCompressedOops&quot;, Boolean.class);
  
      final int objectAlignment = getFlag(&quot;ObjectAlignmentInBytes&quot;, Integer.class);
  
<span class="udiff-line-modified-removed">-     final int prototypeMarkWordOffset = getFieldOffset(&quot;Klass::_prototype_header&quot;, Integer.class, &quot;markOop&quot;);</span>
<span class="udiff-line-modified-added">+     final int hubOffset = getFieldOffset(&quot;oopDesc::_metadata._klass&quot;, Integer.class, &quot;Klass*&quot;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     final int prototypeMarkWordOffset = getFieldOffset(&quot;Klass::_prototype_header&quot;, Integer.class, &quot;markWord&quot;);</span>
      final int subklassOffset = getFieldOffset(&quot;Klass::_subklass&quot;, Integer.class, &quot;Klass*&quot;);
<span class="udiff-line-added">+     final int superOffset = getFieldOffset(&quot;Klass::_super&quot;, Integer.class, &quot;Klass*&quot;);</span>
      final int nextSiblingOffset = getFieldOffset(&quot;Klass::_next_sibling&quot;, Integer.class, &quot;Klass*&quot;);
      final int superCheckOffsetOffset = getFieldOffset(&quot;Klass::_super_check_offset&quot;, Integer.class, &quot;juint&quot;);
      final int secondarySuperCacheOffset = getFieldOffset(&quot;Klass::_secondary_super_cache&quot;, Integer.class, &quot;Klass*&quot;);
  
<span class="udiff-line-added">+     final int classLoaderDataOffset = getFieldOffset(&quot;Klass::_class_loader_data&quot;, Integer.class, &quot;ClassLoaderData*&quot;);</span>
<span class="udiff-line-added">+ </span>
      /**
       * The offset of the _java_mirror field (of type {@link Class}) in a Klass.
       */
<span class="udiff-line-modified-removed">-     final int classMirrorHandleOffset = getFieldOffset(&quot;Klass::_java_mirror&quot;, Integer.class, &quot;OopHandle&quot;);</span>
<span class="udiff-line-modified-added">+     final int javaMirrorOffset = getFieldOffset(&quot;Klass::_java_mirror&quot;, Integer.class, &quot;OopHandle&quot;);</span>
  
      final int klassAccessFlagsOffset = getFieldOffset(&quot;Klass::_access_flags&quot;, Integer.class, &quot;AccessFlags&quot;);
      final int klassLayoutHelperOffset = getFieldOffset(&quot;Klass::_layout_helper&quot;, Integer.class, &quot;jint&quot;);
  
      final int klassLayoutHelperNeutralValue = getConstant(&quot;Klass::_lh_neutral_value&quot;, Integer.class);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -93,16 +99,17 @@</span>
      final int instanceKlassSourceFileNameIndexOffset = getFieldOffset(&quot;InstanceKlass::_source_file_name_index&quot;, Integer.class, &quot;u2&quot;);
      final int instanceKlassInitStateOffset = getFieldOffset(&quot;InstanceKlass::_init_state&quot;, Integer.class, &quot;u1&quot;);
      final int instanceKlassConstantsOffset = getFieldOffset(&quot;InstanceKlass::_constants&quot;, Integer.class, &quot;ConstantPool*&quot;);
      final int instanceKlassFieldsOffset = getFieldOffset(&quot;InstanceKlass::_fields&quot;, Integer.class, &quot;Array&lt;u2&gt;*&quot;);
      final int instanceKlassAnnotationsOffset = getFieldOffset(&quot;InstanceKlass::_annotations&quot;, Integer.class, &quot;Annotations*&quot;);
<span class="udiff-line-modified-removed">-     final int instanceKlassMiscFlagsOffset = getFieldOffset(&quot;InstanceKlass::_misc_flags&quot;, Integer.class, &quot;u2&quot;);</span>
<span class="udiff-line-modified-added">+     final int instanceKlassMiscFlagsOffset = getFieldOffset(&quot;InstanceKlass::_misc_flags&quot;, Integer.class, &quot;u4&quot;);</span>
      final int klassVtableStartOffset = getFieldValue(&quot;CompilerToVM::Data::Klass_vtable_start_offset&quot;, Integer.class, &quot;int&quot;);
      final int klassVtableLengthOffset = getFieldValue(&quot;CompilerToVM::Data::Klass_vtable_length_offset&quot;, Integer.class, &quot;int&quot;);
  
      final int instanceKlassStateLinked = getConstant(&quot;InstanceKlass::linked&quot;, Integer.class);
      final int instanceKlassStateFullyInitialized = getConstant(&quot;InstanceKlass::fully_initialized&quot;, Integer.class);
<span class="udiff-line-added">+     final int instanceKlassStateBeingInitialized = getConstant(&quot;InstanceKlass::being_initialized&quot;, Integer.class);</span>
      final int instanceKlassMiscIsUnsafeAnonymous = getConstant(&quot;InstanceKlass::_misc_is_unsafe_anonymous&quot;, Integer.class);
  
      final int annotationsFieldAnnotationsOffset = getFieldOffset(&quot;Annotations::_fields_annotations&quot;, Integer.class, &quot;Array&lt;AnnotationArray*&gt;*&quot;);
      final int fieldsAnnotationsBaseOffset = getFieldValue(&quot;CompilerToVM::Data::_fields_annotations_base_offset&quot;, Integer.class, &quot;int&quot;);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -129,19 +136,20 @@</span>
      final int jvmAccSynthetic = getConstant(&quot;JVM_ACC_SYNTHETIC&quot;, Integer.class);
      final int jvmAccAnnotation = getConstant(&quot;JVM_ACC_ANNOTATION&quot;, Integer.class);
      final int jvmAccBridge = getConstant(&quot;JVM_ACC_BRIDGE&quot;, Integer.class);
      final int jvmAccVarargs = getConstant(&quot;JVM_ACC_VARARGS&quot;, Integer.class);
      final int jvmAccEnum = getConstant(&quot;JVM_ACC_ENUM&quot;, Integer.class);
<span class="udiff-line-added">+     final int jvmAccInterface = getConstant(&quot;JVM_ACC_INTERFACE&quot;, Integer.class);</span>
  
      // This is only valid on AMD64.
      final int runtimeCallStackSize = getConstant(&quot;frame::arg_reg_save_area_bytes&quot;, Integer.class, osArch.equals(&quot;amd64&quot;) ? null : 0);
  
<span class="udiff-line-modified-removed">-     private final int markWordNoHashInPlace = getConstant(&quot;markOopDesc::no_hash_in_place&quot;, Integer.class);</span>
<span class="udiff-line-modified-removed">-     private final int markWordNoLockInPlace = getConstant(&quot;markOopDesc::no_lock_in_place&quot;, Integer.class);</span>
<span class="udiff-line-modified-added">+     private final int markWordNoHashInPlace = getConstant(&quot;markWord::no_hash_in_place&quot;, Integer.class);</span>
<span class="udiff-line-modified-added">+     private final int markWordNoLockInPlace = getConstant(&quot;markWord::no_lock_in_place&quot;, Integer.class);</span>
  
      /**
<span class="udiff-line-modified-removed">-      * See {@code markOopDesc::prototype()}.</span>
<span class="udiff-line-modified-added">+      * See {@code markWord::prototype()}.</span>
       */
      long arrayPrototypeMarkWord() {
          return markWordNoHashInPlace | markWordNoLockInPlace;
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -342,26 +350,22 @@</span>
      final int vmIntrinsicLinkToVirtual = getConstant(&quot;vmIntrinsics::_linkToVirtual&quot;, Integer.class);
      final int vmIntrinsicLinkToStatic = getConstant(&quot;vmIntrinsics::_linkToStatic&quot;, Integer.class);
      final int vmIntrinsicLinkToSpecial = getConstant(&quot;vmIntrinsics::_linkToSpecial&quot;, Integer.class);
      final int vmIntrinsicLinkToInterface = getConstant(&quot;vmIntrinsics::_linkToInterface&quot;, Integer.class);
  
<span class="udiff-line-modified-removed">-     final int codeInstallResultOk = getConstant(&quot;JVMCIEnv::ok&quot;, Integer.class);</span>
<span class="udiff-line-modified-removed">-     final int codeInstallResultDependenciesFailed = getConstant(&quot;JVMCIEnv::dependencies_failed&quot;, Integer.class);</span>
<span class="udiff-line-modified-removed">-     final int codeInstallResultDependenciesInvalid = getConstant(&quot;JVMCIEnv::dependencies_invalid&quot;, Integer.class);</span>
<span class="udiff-line-modified-removed">-     final int codeInstallResultCacheFull = getConstant(&quot;JVMCIEnv::cache_full&quot;, Integer.class);</span>
<span class="udiff-line-removed">-     final int codeInstallResultCodeTooLarge = getConstant(&quot;JVMCIEnv::code_too_large&quot;, Integer.class);</span>
<span class="udiff-line-modified-added">+     final int codeInstallResultOk = getConstant(&quot;JVMCI::ok&quot;, Integer.class);</span>
<span class="udiff-line-modified-added">+     final int codeInstallResultDependenciesFailed = getConstant(&quot;JVMCI::dependencies_failed&quot;, Integer.class);</span>
<span class="udiff-line-modified-added">+     final int codeInstallResultCacheFull = getConstant(&quot;JVMCI::cache_full&quot;, Integer.class);</span>
<span class="udiff-line-modified-added">+     final int codeInstallResultCodeTooLarge = getConstant(&quot;JVMCI::code_too_large&quot;, Integer.class);</span>
  
      String getCodeInstallResultDescription(int codeInstallResult) {
          if (codeInstallResult == codeInstallResultOk) {
              return &quot;ok&quot;;
          }
          if (codeInstallResult == codeInstallResultDependenciesFailed) {
              return &quot;dependencies failed&quot;;
          }
<span class="udiff-line-removed">-         if (codeInstallResult == codeInstallResultDependenciesInvalid) {</span>
<span class="udiff-line-removed">-             return &quot;dependencies invalid&quot;;</span>
<span class="udiff-line-removed">-         }</span>
          if (codeInstallResult == codeInstallResultCacheFull) {
              return &quot;code cache is full&quot;;
          }
          if (codeInstallResult == codeInstallResultCodeTooLarge) {
              return &quot;code is too large&quot;;
</pre>
<center><a href="HotSpotSpeculationLog.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="HotSpotVMConfigAccess.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>