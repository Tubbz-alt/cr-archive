<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/jdk.net/share/classes/jdk/net/SocketFlow.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2014, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.net;
 27 
 28 import java.lang.annotation.Native;
 29 
 30 /**
 31  * Represents the service level properties for the platform specific socket
 32  * option {@link ExtendedSocketOptions#SO_FLOW_SLA}.
 33  * &lt;p&gt;
 34  * The priority and bandwidth parameters must be set before
 35  * setting the socket option.
 36  * &lt;p&gt;
 37  * When the {@code SO_FLOW_SLA} option is set then it may not take effect
 38  * immediately. If the value of the socket option is obtained with
 39  * {@code getOption()} then the status may be returned as {@code INPROGRESS}
 40  * until it takes effect. The priority and bandwidth values are only valid when
 41  * the status is returned as OK.
 42  * &lt;p&gt;
 43  * When a security manager is installed, a {@link NetworkPermission}
 44  * is required to set or get this option.
 45  *
 46  * @deprecated This is supported only on Solaris. Due to deprecation
 47  * of Solaris port, this feature is also deprecated.
 48  *
 49  * @since 1.8
 50  */
 51 @Deprecated(since=&quot;14&quot;, forRemoval=true)
 52 public class SocketFlow {
 53 
 54     @Native public static final int UNSET = -1;
 55     @Native public static final int NORMAL_PRIORITY = 1;
 56     @Native public static final int HIGH_PRIORITY = 2;
 57 
 58     @Native private static final int NO_STATUS_VALUE = 0;
 59     @Native private static final int OK_VALUE = 1;
 60     @Native private static final int NO_PERMISSION_VALUE = 2;
 61     @Native private static final int NOT_CONNECTED_VALUE = 3;
 62     @Native private static final int NOT_SUPPORTED_VALUE = 4;
 63     @Native private static final int ALREADY_CREATED_VALUE = 5;
 64     @Native private static final int IN_PROGRESS_VALUE = 6;
 65     @Native private static final int OTHER_VALUE = 7;
 66 
 67     /**
 68      * Enumeration of the return values from the SO_FLOW_SLA
 69      * socket option. Both setting and getting the option return
 70      * one of these statuses, which reflect the state of socket&#39;s
 71      * flow.
 72      * @deprecated This is supported only on Solaris. Due to
 73      * deprecation of Solaris port, this enum is also deprecated.
 74      *
 75      * @since 1.8
 76      */
 77     @SuppressWarnings(&quot;removal&quot;)
 78     @Deprecated(since=&quot;14&quot;, forRemoval=true)
 79     public enum Status {
 80         /**
 81          * Set or get socket option has not been called yet. Status
 82          * values can only be retrieved after calling set or get.
 83          */
 84         NO_STATUS(NO_STATUS_VALUE),
 85         /**
 86          * Flow successfully created.
 87          */
 88         OK(OK_VALUE),
 89         /**
 90          * Caller has no permission to create flow.
 91          */
 92         NO_PERMISSION(NO_PERMISSION_VALUE),
 93         /**
 94          * Flow can not be created because socket is not connected.
 95          */
 96         NOT_CONNECTED(NOT_CONNECTED_VALUE),
 97         /**
 98          * Flow creation not supported for this socket.
 99          */
100         NOT_SUPPORTED(NOT_SUPPORTED_VALUE),
101         /**
102          * A flow already exists with identical attributes.
103          */
104         ALREADY_CREATED(ALREADY_CREATED_VALUE),
105         /**
106          * A flow is being created.
107          */
108         IN_PROGRESS(IN_PROGRESS_VALUE),
109         /**
110          * Some other unspecified error.
111          */
112         OTHER(OTHER_VALUE);
113 
114         private final int value;
115         Status(int value) { this.value = value; }
116 
117         static Status from(int value) {
118             if      (value == NO_STATUS.value)       return NO_STATUS;
119             else if (value == OK.value)              return OK;
120             else if (value == NO_PERMISSION.value)   return NO_PERMISSION;
121             else if (value == NOT_CONNECTED.value)   return NOT_CONNECTED;
122             else if (value == NOT_SUPPORTED.value)   return NOT_SUPPORTED;
123             else if (value == ALREADY_CREATED.value) return ALREADY_CREATED;
124             else if (value == IN_PROGRESS.value)     return IN_PROGRESS;
125             else if (value == OTHER.value)           return OTHER;
126             else     throw new InternalError(&quot;Unknown value: &quot; + value);
127         }
128     }
129 
130     private int priority = NORMAL_PRIORITY;
131     private long bandwidth = UNSET;
132     private Status status = Status.NO_STATUS;
133 
134     /**
135      * Creates a new SocketFlow that can be used to set the SO_FLOW_SLA
136      * socket option and create a socket flow.
137      */
138     public static SocketFlow create() {
139         return new SocketFlow();
140     }
141 
142     private SocketFlow() { }
143 
144     /**
145      * Sets this SocketFlow&#39;s priority. Must be either NORMAL_PRIORITY
146      * HIGH_PRIORITY. If not set, a flow&#39;s priority is normal.
147      *
148      * @throws IllegalArgumentException if priority is not NORMAL_PRIORITY or
149      *         HIGH_PRIORITY.
150      */
151     public SocketFlow priority(int priority) {
152         if (priority != NORMAL_PRIORITY &amp;&amp; priority != HIGH_PRIORITY)
153             throw new IllegalArgumentException(&quot;invalid priority :&quot; + priority);
154         this.priority = priority;
155         return this;
156     }
157 
158     /**
159      * Sets this SocketFlow&#39;s bandwidth. Must be greater than or equal to zero.
160      * A value of zero drops all packets for the socket.
161      *
162      * @throws IllegalArgumentException if bandwidth is less than zero.
163      */
164     public SocketFlow bandwidth(long bandwidth) {
165         if (bandwidth &lt; 0)
166             throw new IllegalArgumentException(&quot;invalid bandwidth: &quot; + bandwidth);
167         this.bandwidth = bandwidth;
168         return this;
169     }
170 
171     /**
172      * Returns this SocketFlow&#39;s priority.
173      */
174     public int priority() {
175         return priority;
176     }
177 
178     /**
179      * Returns this SocketFlow&#39;s bandwidth.
180      *
181      * @return this SocketFlow&#39;s bandwidth, or {@code -1} if status is not OK.
182      */
183     public long bandwidth() {
184         return bandwidth;
185     }
186 
187     /**
188      * Returns the Status value of this SocketFlow. NO_STATUS is returned
189      * if the object was not used in a call to set or get the option.
190      */
191     public Status status() {
192         return status;
193     }
194 
195     void status(int status) {
196         this.status = Status.from(status);
197     }
198 
199     @Override
200     public String toString() {
201         StringBuilder sb = new StringBuilder(super.toString());
202         sb.append(&quot; [ priority=&quot;).append(priority())
203           .append(&quot;, bandwidth=&quot;).append(bandwidth())
204           .append(&quot;, status=&quot;).append(status())
205           .append(&quot; ]&quot;);
206         return sb.toString();
207     }
208 }
    </pre>
  </body>
</html>