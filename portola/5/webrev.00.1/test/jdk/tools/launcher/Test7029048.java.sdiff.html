<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/tools/launcher/Test7029048.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="ExecutionEnvironment.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TestHelper.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/tools/launcher/Test7029048.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
138                     // copy the files into the directory structures
139                     copyFile(srcLibjvmSo, dstServerLibjvm);
140                     // does not matter if it is client or a server
141                     copyFile(srcLibjvmSo, dstClientLibjvm);
142                     desc = &quot;LD_LIBRARY_PATH should be set&quot;;
143                     break;
144                 case NO_LIBJVM:
145                     if (!dstClientDir.exists()) {
146                         Files.createDirectories(dstClientDir.toPath());
147                     } else {
148                         Files.deleteIfExists(dstClientLibjvm.toPath());
149                     }
150 
151                     if (!dstServerDir.exists()) {
152                         Files.createDirectories(dstServerDir.toPath());
153                     } else {
154                         Files.deleteIfExists(dstServerLibjvm.toPath());
155                     }
156 
157                     desc = &quot;LD_LIBRARY_PATH should not be set (no libjvm.so)&quot;;
<span class="line-modified">158                     if (TestHelper.isAIX) {</span>
159                         System.out.println(&quot;Skipping test case \&quot;&quot; + desc +
<span class="line-modified">160                                            &quot;\&quot; because the Aix launcher adds the paths in any case.&quot;);</span>
161                         continue;
162                     }
163                     break;
164                 case NO_DIR:
165                     if (dstLibDir.exists()) {
166                         recursiveDelete(dstLibDir);
167                     }
168                     desc = &quot;LD_LIBRARY_PATH should not be set (no directory)&quot;;
<span class="line-modified">169                     if (TestHelper.isAIX) {</span>
170                         System.out.println(&quot;Skipping test case \&quot;&quot; + desc +
<span class="line-modified">171                                            &quot;\&quot; because the Aix launcher adds the paths in any case.&quot;);</span>
172                         continue;
173                     }
174                     break;
175                 default:
176                     throw new RuntimeException(&quot;unknown case&quot;);
177             }
178 
179             /*
180              * Case 1: set the server path
181              */
182             env.clear();
183             env.put(LD_LIBRARY_PATH, dstServerDir.getAbsolutePath());
184             run(env,
185                 v.value + 1,            // Add one to account for our setting
186                 &quot;Case 1: &quot; + desc);
187 
188             /*
189              * Case 2: repeat with client path
190              */
191             env.clear();
</pre>
<hr />
<pre>
194                 v.value + 1,            // Add one to account for our setting
195                 &quot;Case 2: &quot; + desc);
196         }
197         return;
198     }
199 
200     public static void main(String... args) throws Exception {
201         if (TestHelper.isWindows || TestHelper.isMacOSX) {
202             System.out.println(&quot;Note: applicable on neither Windows nor MacOSX&quot;);
203             return;
204         }
205         if (!TestHelper.haveServerVM) {
206             System.out.println(&quot;Note: test relies on server vm, not found, exiting&quot;);
207             return;
208         }
209         // create our test jar first
210         ExecutionEnvironment.createTestJar();
211 
212         // run the tests
213         test7029048();



214         if (errors &gt; 0) {
215             throw new Exception(&quot;Test7029048: FAIL: with &quot;
216                     + errors + &quot; errors and passes &quot; + passes);
<span class="line-modified">217         } else if (isLinux &amp;&amp; passes &lt; 6) {</span>
218              throw new Exception(&quot;Test7029048: FAIL: &quot; +
<span class="line-modified">219                     &quot;all tests did not run, expected &quot; + 6 + &quot; got &quot; + passes);</span>
220         } else {
221             System.out.println(&quot;Test7029048: PASS &quot; + passes);
222         }
223     }
224 }
</pre>
</td>
<td>
<hr />
<pre>
138                     // copy the files into the directory structures
139                     copyFile(srcLibjvmSo, dstServerLibjvm);
140                     // does not matter if it is client or a server
141                     copyFile(srcLibjvmSo, dstClientLibjvm);
142                     desc = &quot;LD_LIBRARY_PATH should be set&quot;;
143                     break;
144                 case NO_LIBJVM:
145                     if (!dstClientDir.exists()) {
146                         Files.createDirectories(dstClientDir.toPath());
147                     } else {
148                         Files.deleteIfExists(dstClientLibjvm.toPath());
149                     }
150 
151                     if (!dstServerDir.exists()) {
152                         Files.createDirectories(dstServerDir.toPath());
153                     } else {
154                         Files.deleteIfExists(dstServerLibjvm.toPath());
155                     }
156 
157                     desc = &quot;LD_LIBRARY_PATH should not be set (no libjvm.so)&quot;;
<span class="line-modified">158                     if (TestHelper.isExpandedSharedLibraryPath) {</span>
159                         System.out.println(&quot;Skipping test case \&quot;&quot; + desc +
<span class="line-modified">160                                            &quot;\&quot; because the Aix and Musl launchers add the paths in any case.&quot;);</span>
161                         continue;
162                     }
163                     break;
164                 case NO_DIR:
165                     if (dstLibDir.exists()) {
166                         recursiveDelete(dstLibDir);
167                     }
168                     desc = &quot;LD_LIBRARY_PATH should not be set (no directory)&quot;;
<span class="line-modified">169                     if (TestHelper.isExpandedSharedLibraryPath) {</span>
170                         System.out.println(&quot;Skipping test case \&quot;&quot; + desc +
<span class="line-modified">171                                            &quot;\&quot; because the Aix and Musl launchers add the paths in any case.&quot;);</span>
172                         continue;
173                     }
174                     break;
175                 default:
176                     throw new RuntimeException(&quot;unknown case&quot;);
177             }
178 
179             /*
180              * Case 1: set the server path
181              */
182             env.clear();
183             env.put(LD_LIBRARY_PATH, dstServerDir.getAbsolutePath());
184             run(env,
185                 v.value + 1,            // Add one to account for our setting
186                 &quot;Case 1: &quot; + desc);
187 
188             /*
189              * Case 2: repeat with client path
190              */
191             env.clear();
</pre>
<hr />
<pre>
194                 v.value + 1,            // Add one to account for our setting
195                 &quot;Case 2: &quot; + desc);
196         }
197         return;
198     }
199 
200     public static void main(String... args) throws Exception {
201         if (TestHelper.isWindows || TestHelper.isMacOSX) {
202             System.out.println(&quot;Note: applicable on neither Windows nor MacOSX&quot;);
203             return;
204         }
205         if (!TestHelper.haveServerVM) {
206             System.out.println(&quot;Note: test relies on server vm, not found, exiting&quot;);
207             return;
208         }
209         // create our test jar first
210         ExecutionEnvironment.createTestJar();
211 
212         // run the tests
213         test7029048();
<span class="line-added">214 </span>
<span class="line-added">215         int passesLinux = TestHelper.isMusl ? 2 : 6;</span>
<span class="line-added">216 </span>
217         if (errors &gt; 0) {
218             throw new Exception(&quot;Test7029048: FAIL: with &quot;
219                     + errors + &quot; errors and passes &quot; + passes);
<span class="line-modified">220         } else if (isLinux &amp;&amp; passes &lt; passesLinux) {</span>
221              throw new Exception(&quot;Test7029048: FAIL: &quot; +
<span class="line-modified">222                     &quot;all tests did not run, expected &quot; + passesLinux + &quot; got &quot; + passes);</span>
223         } else {
224             System.out.println(&quot;Test7029048: PASS &quot; + passes);
225         }
226     }
227 }
</pre>
</td>
</tr>
</table>
<center><a href="ExecutionEnvironment.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TestHelper.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>