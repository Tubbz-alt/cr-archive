<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/conf/jib-profiles.js</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="../autoconf/spec.gmk.in.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="../hotspot/lib/CompileJvm.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/conf/jib-profiles.js</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 228     data.dependencies = getJibProfilesDependencies(input, common, data);
 229 
 230     return data;
 231 };
 232 
 233 /**
 234  * Generates some common values
 235  *
 236  * @param input External data to use for generating the configuration
 237  * @returns Common values
 238  */
 239 var getJibProfilesCommon = function (input, data) {
 240     var common = {};
 241 
 242     common.organization = &quot;jpg.infra.builddeps&quot;;
 243     common.build_id = getBuildId(input);
 244     common.build_number = input.build_number != null ? input.build_number : &quot;0&quot;;
 245 
 246     // List of the main profile names used for iteration
 247     common.main_profile_names = [
<span class="line-modified"> 248         &quot;linux-x64&quot;, &quot;linux-x64-musl&quot;, &quot;linux-x86&quot;, &quot;macosx-x64&quot;, &quot;solaris-x64&quot;,</span>
<span class="line-modified"> 249         &quot;solaris-sparcv9&quot;, &quot;windows-x64&quot;, &quot;windows-x86&quot;,</span>
 250         &quot;linux-aarch64&quot;, &quot;linux-arm32&quot;, &quot;linux-ppc64le&quot;, &quot;linux-s390x&quot;
 251     ];
 252 
 253     // These are the base setttings for all the main build profiles.
 254     common.main_profile_base = {
 255         dependencies: [&quot;boot_jdk&quot;, &quot;gnumake&quot;, &quot;jtreg&quot;, &quot;jib&quot;, &quot;autoconf&quot;, &quot;jmh&quot;, &quot;jcov&quot;],
 256         default_make_targets: [&quot;product-bundles&quot;, &quot;test-bundles&quot;, &quot;static-libs-bundles&quot;],
 257         configure_args: concat(&quot;--enable-jtreg-failure-handler&quot;,
 258             &quot;--with-exclude-translations=de,es,fr,it,ko,pt_BR,sv,ca,tr,cs,sk,ja_JP_A,ja_JP_HA,ja_JP_HI,ja_JP_I,zh_TW,zh_HK&quot;,
 259             &quot;--disable-manpages&quot;,
 260             &quot;--disable-jvm-feature-shenandoahgc&quot;,
 261             versionArgs(input, common))
 262     };
 263     // Extra settings for debug profiles
 264     common.debug_suffix = &quot;-debug&quot;;
 265     common.debug_profile_base = {
 266         configure_args: [&quot;--enable-debug&quot;],
 267         labels: &quot;debug&quot;
 268     };
 269     // Extra settings for slowdebug profiles
</pre>
<hr />
<pre>
 393         + common.boot_jdk_version
 394         + (input.build_os == &quot;macosx&quot; ? &quot;.jdk/Contents/Home&quot; : &quot;&quot;);
 395 
 396     return common;
 397 };
 398 
 399 /**
 400  * Generates the profiles part of the configuration.
 401  *
 402  * @param input External data to use for generating the configuration
 403  * @param common The common values
 404  * @returns {{}} Profiles part of the configuration
 405  */
 406 var getJibProfilesProfiles = function (input, common, data) {
 407     // Main SE profiles
 408     var profiles = {
 409 
 410         &quot;linux-x64&quot;: {
 411             target_os: &quot;linux&quot;,
 412             target_cpu: &quot;x64&quot;,
<span class="line-modified"> 413             dependencies: [&quot;devkit&quot;, &quot;graphviz&quot;, &quot;pandoc&quot;, &quot;graalunit_lib&quot;],</span>
 414             configure_args: concat(common.configure_args_64bit,
 415                 &quot;--enable-full-docs&quot;, &quot;--with-zlib=system&quot;,
 416                 (isWsl(input) ? [ &quot;--host=x86_64-unknown-linux-gnu&quot;,
 417                     &quot;--build=x86_64-unknown-linux-gnu&quot; ] : [])),
 418             default_make_targets: [&quot;docs-bundles&quot;],
 419         },
 420 
 421         &quot;linux-x64-musl&quot;: {
 422             target_os: &quot;linux&quot;,
 423             target_cpu: &quot;x64&quot;,
 424             target_libc: &quot;musl&quot;,
 425             configure_args: concat(common.configure_args_64bit,
 426                 &quot;--with-zlib=system&quot;),
 427         },
 428 
 429         &quot;linux-x86&quot;: {
 430             target_os: &quot;linux&quot;,
 431             target_cpu: &quot;x86&quot;,
 432             build_cpu: &quot;x64&quot;,
<span class="line-modified"> 433             dependencies: [&quot;devkit&quot;],</span>
 434             configure_args: concat(common.configure_args_32bit,
 435                 &quot;--with-jvm-variants=minimal,server&quot;, &quot;--with-zlib=system&quot;),
 436         },
 437 
 438         &quot;macosx-x64&quot;: {
 439             target_os: &quot;macosx&quot;,
 440             target_cpu: &quot;x64&quot;,
<span class="line-modified"> 441             dependencies: [&quot;devkit&quot;, &quot;pandoc&quot;, &quot;graalunit_lib&quot;],</span>
 442             configure_args: concat(common.configure_args_64bit, &quot;--with-zlib=system&quot;,
<span class="line-modified"> 443                 &quot;--with-macosx-version-max=10.9.0&quot;),</span>
<span class="line-modified"> 444         },</span>
<span class="line-modified"> 445 </span>
<span class="line-modified"> 446         &quot;solaris-x64&quot;: {</span>
<span class="line-removed"> 447             target_os: &quot;solaris&quot;,</span>
<span class="line-removed"> 448             target_cpu: &quot;x64&quot;,</span>
<span class="line-removed"> 449             dependencies: [&quot;devkit&quot;, &quot;cups&quot;],</span>
<span class="line-removed"> 450             configure_args: concat(common.configure_args_64bit,</span>
<span class="line-removed"> 451                 &quot;--with-zlib=system&quot;, &quot;--enable-dtrace&quot;, &quot;--enable-deprecated-ports=yes&quot;),</span>
<span class="line-removed"> 452         },</span>
<span class="line-removed"> 453 </span>
<span class="line-removed"> 454         &quot;solaris-sparcv9&quot;: {</span>
<span class="line-removed"> 455             target_os: &quot;solaris&quot;,</span>
<span class="line-removed"> 456             target_cpu: &quot;sparcv9&quot;,</span>
<span class="line-removed"> 457             dependencies: [&quot;devkit&quot;, &quot;cups&quot;],</span>
<span class="line-removed"> 458             configure_args: concat(common.configure_args_64bit,</span>
<span class="line-removed"> 459                 &quot;--with-zlib=system&quot;, &quot;--enable-dtrace&quot;, &quot;--enable-deprecated-ports=yes&quot;),</span>
 460         },
 461 
 462         &quot;windows-x64&quot;: {
 463             target_os: &quot;windows&quot;,
 464             target_cpu: &quot;x64&quot;,
<span class="line-modified"> 465             dependencies: [&quot;devkit&quot;, &quot;pandoc&quot;, &quot;graalunit_lib&quot;],</span>
 466             configure_args: concat(common.configure_args_64bit),
 467         },
 468 
 469         &quot;windows-x86&quot;: {
 470             target_os: &quot;windows&quot;,
 471             target_cpu: &quot;x86&quot;,
 472             build_cpu: &quot;x64&quot;,
<span class="line-modified"> 473             dependencies: [&quot;devkit&quot;],</span>
 474             configure_args: concat(common.configure_args_32bit),
 475         },
 476 
 477         &quot;linux-aarch64&quot;: {
 478             target_os: &quot;linux&quot;,
 479             target_cpu: &quot;aarch64&quot;,
 480             build_cpu: &quot;x64&quot;,
<span class="line-modified"> 481             dependencies: [&quot;devkit&quot;, &quot;build_devkit&quot;, &quot;pandoc&quot;],</span>
 482             configure_args: [
 483                 &quot;--openjdk-target=aarch64-linux-gnu&quot;,
 484 		&quot;--disable-jvm-feature-jvmci&quot;,
 485 		&quot;--disable-jvm-feature-graal&quot;,
 486 		&quot;--disable-jvm-feature-aot&quot;,
 487             ],
 488         },
 489 
 490         &quot;linux-arm32&quot;: {
 491             target_os: &quot;linux&quot;,
 492             target_cpu: &quot;arm&quot;,
 493             build_cpu: &quot;x64&quot;,
<span class="line-modified"> 494             dependencies: [&quot;devkit&quot;, &quot;build_devkit&quot;],</span>
 495             configure_args: [
 496                 &quot;--openjdk-target=arm-linux-gnueabihf&quot;, &quot;--with-freetype=bundled&quot;,
 497                 &quot;--with-abi-profile=arm-vfp-hflt&quot;, &quot;--disable-warnings-as-errors&quot;
 498             ],
 499         },
 500 
 501         &quot;linux-ppc64le&quot;: {
 502             target_os: &quot;linux&quot;,
 503             target_cpu: &quot;ppc64le&quot;,
 504             build_cpu: &quot;x64&quot;,
<span class="line-modified"> 505             dependencies: [&quot;devkit&quot;, &quot;build_devkit&quot;],</span>
 506             configure_args: [
 507                 &quot;--openjdk-target=ppc64le-linux-gnu&quot;, &quot;--with-freetype=bundled&quot;,
 508                 &quot;--disable-warnings-as-errors&quot;
 509             ],
 510         },
 511 
 512         &quot;linux-s390x&quot;: {
 513             target_os: &quot;linux&quot;,
 514             target_cpu: &quot;s390x&quot;,
 515             build_cpu: &quot;x64&quot;,
<span class="line-modified"> 516             dependencies: [&quot;devkit&quot;, &quot;build_devkit&quot;],</span>
 517             configure_args: [
 518                 &quot;--openjdk-target=s390x-linux-gnu&quot;, &quot;--with-freetype=bundled&quot;,
 519                 &quot;--disable-warnings-as-errors&quot;
 520             ],
 521         },
 522     };
 523 
 524     // Add the base settings to all the main profiles
 525     common.main_profile_names.forEach(function (name) {
 526         profiles[name] = concatObjects(common.main_profile_base, profiles[name]);
 527     });
 528 
 529     // Generate debug versions of all the main profiles
 530     common.main_profile_names.forEach(function (name) {
 531         var debugName = name + common.debug_suffix;
 532         profiles[debugName] = concatObjects(profiles[name],
 533                                             common.debug_profile_base);
 534     });
 535     // Generate slowdebug versions of all the main profiles
 536     common.main_profile_names.forEach(function (name) {
 537         var debugName = name + common.slowdebug_suffix;
 538         profiles[debugName] = concatObjects(profiles[name],
 539                                             common.slowdebug_profile_base);
 540     });
 541     // Generate testmake profiles for the main profile of each build host
 542     // platform. This profile only runs the makefile tests.
 543     // Ant is needed to run the idea project generator test.
 544     var testmakeBase = {
 545         dependencies: [ &quot;ant&quot; ],
 546         environment: {
 547             &quot;ANT_HOME&quot;: input.get(&quot;ant&quot;, &quot;home_path&quot;)
 548         }
 549     };
<span class="line-modified"> 550     [ &quot;linux-x64&quot;, &quot;macosx-x64&quot;, &quot;solaris-sparcv9&quot;, &quot;solaris-x64&quot;, &quot;windows-x64&quot;]</span>
 551         .forEach(function (name) {
 552             var maketestName = name + &quot;-testmake&quot;;
 553             profiles[maketestName] = concatObjects(profiles[name], testmakeBase);
 554             profiles[maketestName].default_make_targets = [ &quot;test-make&quot; ];
 555         });
 556 
 557     // Generate -gcov profiles
 558     [ &quot;linux-aarch64&quot;, &quot;linux-x64&quot;, &quot;macosx-x64&quot; ].forEach(function (name) {
 559         var gcovName = name + &quot;-gcov&quot;;
 560         profiles[gcovName] = clone(profiles[name]);
 561         profiles[gcovName].default_make_targets = [&quot;product-bundles&quot;, &quot;test-bundles&quot;];
 562         profiles[gcovName].configure_args = concat(profiles[gcovName].configure_args,
 563             [&quot;--enable-native-coverage&quot;, &quot;--disable-warnings-as-errors&quot;]);
 564     });
 565 
 566     // Profiles for building the zero jvm variant. These are used for verification.
 567     var zeroProfiles = {
 568         &quot;linux-x64-zero&quot;: {
 569             target_os: &quot;linux&quot;,
 570             target_cpu: &quot;x64&quot;,
<span class="line-modified"> 571             dependencies: [&quot;devkit&quot;],</span>
 572             configure_args: concat(common.configure_args_64bit, [
 573                 &quot;--with-zlib=system&quot;,
 574                 &quot;--with-jvm-variants=zero&quot;,
 575                 &quot;--enable-libffi-bundling&quot;
 576             ])
 577         },
 578 
 579         &quot;linux-x86-zero&quot;: {
 580             target_os: &quot;linux&quot;,
 581             target_cpu: &quot;x86&quot;,
 582             build_cpu: &quot;x64&quot;,
<span class="line-modified"> 583             dependencies: [&quot;devkit&quot;],</span>
 584             configure_args:  concat(common.configure_args_32bit, [
 585                 &quot;--with-zlib=system&quot;,
 586                 &quot;--with-jvm-variants=zero&quot;,
 587                 &quot;--enable-libffi-bundling&quot;
 588             ])
 589         }
 590     }
 591     profiles = concatObjects(profiles, zeroProfiles);
 592 
 593     // Add the base settings to the zero profiles and generate debug profiles
 594     Object.keys(zeroProfiles).forEach(function (name) {
 595         var debugName = name + common.debug_suffix;
 596         profiles[name] = concatObjects(common.main_profile_base, profiles[name]);
 597         profiles[debugName] = concatObjects(profiles[name], common.debug_profile_base);
 598     });
 599 
 600     // Define a profile with precompiled headers disabled. This is just used for
 601     // verfication of this build configuration.
 602     var noPchProfiles = {
 603         &quot;linux-x64-debug-nopch&quot;: {
 604             target_os: &quot;linux&quot;,
 605             target_cpu: &quot;x64&quot;,
<span class="line-modified"> 606             dependencies: [&quot;devkit&quot;],</span>
 607             configure_args: concat(common.configure_args_64bit,
 608                 &quot;--with-zlib=system&quot;, &quot;--disable-precompiled-headers&quot;),
 609         },
 610     };
 611     profiles = concatObjects(profiles, noPchProfiles);
 612     // Add base settings to noPch profiles
 613     Object.keys(noPchProfiles).forEach(function (name) {
 614         profiles[name] = concatObjects(common.main_profile_base, profiles[name]);
 615         profiles[name] = concatObjects(common.debug_profile_base, profiles[name]);
 616         // Override default make target with hotspot as that&#39;s the only part of
 617         // the build using precompiled headers.
 618         profiles[name].default_make_targets = [&quot;hotspot&quot;];
 619     });
 620 
 621     // Bootcycle profiles runs the build with itself as the boot jdk. This can
 622     // be done in two ways. Either using the builtin bootcycle target in the
 623     // build system. Or by supplying the main jdk build as bootjdk to configure.
<span class="line-modified"> 624     [ &quot;linux-x64&quot;, &quot;macosx-x64&quot;, &quot;solaris-sparcv9&quot;, &quot;windows-x64&quot;]</span>
 625         .forEach(function (name) {
 626             var bootcycleName = name + &quot;-bootcycle&quot;;
 627             var bootcyclePrebuiltName = name + &quot;-bootcycle-prebuilt&quot;;
 628             // The base bootcycle profile just changes the default target
 629             // compared to the base profile
 630             profiles[bootcycleName] = clone(profiles[name]);
 631             profiles[bootcycleName].default_make_targets = [ &quot;bootcycle-images&quot; ];
 632             // The prebuilt bootcycle variant modifies the boot jdk argument
 633             var bootcyclePrebuiltBase = {
 634                 dependencies: [ name + &quot;.jdk&quot; ],
 635                 configure_args: [
 636                     &quot;--with-boot-jdk=&quot; + input.get(name + &quot;.jdk&quot;, &quot;home_path&quot;),
<span class="line-removed"> 637                     // Full docs do not currently work with bootcycle build</span>
<span class="line-removed"> 638                     // since Nashorn was removed. This negates the</span>
<span class="line-removed"> 639                     // --enable-full-docs from the main profile.</span>
<span class="line-removed"> 640                     &quot;--enable-full-docs=auto&quot;,</span>
 641                 ]
 642             }
 643             profiles[bootcyclePrebuiltName] = concatObjects(profiles[name],
 644                 bootcyclePrebuiltBase);
 645             var bootJdkIndex = profiles[bootcyclePrebuiltName].dependencies.indexOf(&quot;boot_jdk&quot;);
 646             delete profiles[bootcyclePrebuiltName].dependencies[bootJdkIndex];
 647             profiles[bootcyclePrebuiltName].default_make_targets = [ &quot;product-images&quot; ];
 648         });
 649 
 650     // JCov profiles build JCov-instrumented JDK image based on images provided through dependencies.
<span class="line-modified"> 651     [ &quot;linux-aarch64&quot;, &quot;linux-x64&quot;, &quot;macosx-x64&quot;, &quot;solaris-sparcv9&quot;, &quot;windows-x64&quot;]</span>
 652         .forEach(function (name) {
 653             var jcovName = name + &quot;-jcov&quot;;
 654             profiles[jcovName] = clone(common.main_profile_base);
 655             profiles[jcovName].target_os = profiles[name].target_os
 656             profiles[jcovName].target_cpu = profiles[name].target_cpu
 657             profiles[jcovName].default_make_targets = [ &quot;jcov-bundles&quot; ];
 658             profiles[jcovName].dependencies = concat(profiles[jcovName].dependencies,
 659                 [ name + &quot;.jdk&quot;, &quot;devkit&quot; ]);
 660             profiles[jcovName].configure_args = concat(profiles[jcovName].configure_args,
 661                 [&quot;--with-jcov-input-jdk=&quot; + input.get(name + &quot;.jdk&quot;, &quot;home_path&quot;)]);
 662         });
 663 
 664     //
 665     // Define artifacts for profiles
 666     //
 667     // Macosx bundles are named osx
 668     // tar.gz.
 669     var artifactData = {
 670         &quot;linux-x64&quot;: {
 671             platform: &quot;linux-x64&quot;,
 672         },
 673         &quot;linux-x64-musl&quot;: {
 674             platform: &quot;linux-x64-musl&quot;,
 675             demo_ext: &quot;tar.gz&quot;
 676         },
 677         &quot;linux-x86&quot;: {
 678             platform: &quot;linux-x86&quot;,
 679         },
 680         &quot;macosx-x64&quot;: {
 681             platform: &quot;osx-x64&quot;,
 682             jdk_subdir: &quot;jdk-&quot; + data.version +  &quot;.jdk/Contents/Home&quot;,
 683         },
<span class="line-removed"> 684         &quot;solaris-x64&quot;: {</span>
<span class="line-removed"> 685             platform: &quot;solaris-x64&quot;,</span>
<span class="line-removed"> 686         },</span>
<span class="line-removed"> 687         &quot;solaris-sparcv9&quot;: {</span>
<span class="line-removed"> 688             platform: &quot;solaris-sparcv9&quot;,</span>
<span class="line-removed"> 689         },</span>
 690         &quot;windows-x64&quot;: {
 691             platform: &quot;windows-x64&quot;,
 692             jdk_suffix: &quot;zip&quot;,
 693         },
 694         &quot;windows-x86&quot;: {
 695             platform: &quot;windows-x86&quot;,
 696             jdk_suffix: &quot;zip&quot;,
 697         },
 698        &quot;linux-aarch64&quot;: {
 699             platform: &quot;linux-aarch64&quot;,
 700         },
 701        &quot;linux-arm32&quot;: {
 702             platform: &quot;linux-arm32&quot;,
 703         },
 704        &quot;linux-ppc64le&quot;: {
 705             platform: &quot;linux-ppc64le&quot;,
 706         },
 707        &quot;linux-s390x&quot;: {
 708             platform: &quot;linux-s390x&quot;,
 709         }
</pre>
<hr />
<pre>
 711     // Generate common artifacts for all main profiles
 712     Object.keys(artifactData).forEach(function (name) {
 713         profiles[name] = concatObjects(profiles[name],
 714             common.main_profile_artifacts(artifactData[name]));
 715     });
 716 
 717     // Generate common artifacts for all debug profiles
 718     Object.keys(artifactData).forEach(function (name) {
 719         var debugName = name + common.debug_suffix;
 720         profiles[debugName] = concatObjects(profiles[debugName],
 721             common.debug_profile_artifacts(artifactData[name]));
 722     });
 723 
 724     profilesArtifacts = {
 725         &quot;linux-x64&quot;: {
 726             artifacts: {
 727                 doc_api_spec: {
 728                     local: &quot;bundles/\\(jdk.*doc-api-spec.tar.gz\\)&quot;,
 729                     remote: [
 730                         &quot;bundles/common/jdk-&quot; + data.version + &quot;_doc-api-spec.tar.gz&quot;,
<span class="line-modified"> 731                         &quot;bundles/linux-x64/\\1&quot;</span>
 732                     ],
 733                 },
 734             }
 735         }
 736     };
 737     profiles = concatObjects(profiles, profilesArtifacts);
 738 
 739     // Generate open only profiles for all the main and debug profiles.
 740     // Rewrite artifact remote paths by adding &quot;openjdk/GPL&quot;.
 741     common.main_profile_names.forEach(function (name) {
 742         var openName = name + common.open_suffix;
 743         profiles[openName] = concatObjects(profiles[name],
 744             common.open_profile_base);
 745         for (artifactName in profiles[openName].artifacts) {
 746             var artifact = profiles[openName].artifacts[artifactName];
 747             artifact.remote = replaceAll(
 748                 &quot;bundles\/&quot;, &quot;bundles/openjdk/GPL/&quot;,
 749                 (artifact.remote != null ? artifact.remote : artifact.local));
 750         }
 751         var debugName = name + common.debug_suffix;
</pre>
<hr />
<pre>
 788                        profiles[openName].artifacts[&quot;jdk&quot;].remote));
 789     });
 790 
 791     // Generate cmp-baseline profiles for each main profile and their
 792     // corresponding debug profile. This profile does a compare build run with no
 793     // changes to verify that the compare script has a clean baseline
 794     common.main_profile_names.forEach(function (name) {
 795         [ &quot;&quot;, common.open_suffix ].forEach(function (suffix) {
 796             var cmpBaselineName = name + suffix + &quot;-cmp-baseline&quot;;
 797             profiles[cmpBaselineName] = clone(profiles[name + suffix]);
 798             // Only compare the images target. This should pressumably be expanded
 799             // to include more build targets when possible.
 800             profiles[cmpBaselineName].default_make_targets = [ &quot;images&quot;, &quot;test-image&quot; ];
 801             if (name == &quot;linux-x64&quot;) {
 802                 profiles[cmpBaselineName].default_make_targets
 803                     = concat(profiles[cmpBaselineName].default_make_targets, &quot;docs&quot;);
 804             }
 805             profiles[cmpBaselineName].make_args = [ &quot;COMPARE_BUILD=CONF=&quot; ];
 806             profiles[cmpBaselineName].configure_args = concat(
 807                 profiles[cmpBaselineName].configure_args,
<span class="line-modified"> 808                 &quot;--with-hotspot-build-time=n/a&quot;, </span>
 809                 &quot;--disable-precompiled-headers&quot;);
 810             // Do not inherit artifact definitions from base profile
 811             delete profiles[cmpBaselineName].artifacts;
 812         });
 813     });
 814 
 815     // Artifacts of JCov profiles
<span class="line-modified"> 816     [ &quot;linux-aarch64&quot;, &quot;linux-x64&quot;, &quot;macosx-x64&quot;, &quot;solaris-sparcv9&quot;, &quot;windows-x64&quot;]</span>
 817         .forEach(function (name) {
 818             var o = artifactData[name]
 819             var jdk_subdir = (o.jdk_subdir != null ? o.jdk_subdir : &quot;jdk-&quot; + data.version);
 820             var jdk_suffix = (o.jdk_suffix != null ? o.jdk_suffix : &quot;tar.gz&quot;);
 821             var pf = o.platform
 822             var jcovName = name + &quot;-jcov&quot;;
 823             profiles[jcovName].artifacts = {
 824                 jdk: {
 825                     local: &quot;bundles/\\(jdk-jcov.*bin.&quot; + jdk_suffix + &quot;\\)&quot;,
 826                     remote: [
 827                         &quot;bundles/&quot; + pf + &quot;/jdk-jcov-&quot; + data.version + &quot;_&quot; + pf + &quot;_bin.&quot; + jdk_suffix
 828                     ],
 829                     subdir: jdk_subdir,
 830                     exploded: &quot;images/jdk-jcov&quot;
 831                 }
 832             };
 833         });
 834 
 835     // Artifacts of gcov (native-code-coverage) profiles
 836     [ &quot;linux-aarch64&quot;, &quot;linux-x64&quot;, &quot;macosx-x64&quot; ].forEach(function (name) {
</pre>
<hr />
<pre>
 985     }
 986 
 987     // Generate the missing platform attributes
 988     profiles = generatePlatformAttributes(profiles);
 989     profiles = generateDefaultMakeTargetsConfigureArg(common, profiles);
 990     return profiles;
 991 };
 992 
 993 /**
 994  * Generate the dependencies part of the configuration
 995  *
 996  * @param input External data to use for generating the configuration
 997  * @param common The common values
 998  * @returns {{}} Dependencies part of configuration
 999  */
1000 var getJibProfilesDependencies = function (input, common) {
1001 
1002     var devkit_platform_revisions = {
1003         linux_x64: &quot;gcc9.2.0-OL6.4+1.0&quot;,
1004         macosx_x64: &quot;Xcode10.1-MacOSX10.14+1.0&quot;,
<span class="line-removed">1005         solaris_x64: &quot;SS12u4-Solaris11u1+1.0&quot;,</span>
<span class="line-removed">1006         solaris_sparcv9: &quot;SS12u6-Solaris11u3+1.0&quot;,</span>
1007         windows_x64: &quot;VS2019-16.5.3+1.0&quot;,
1008         linux_aarch64: &quot;gcc9.2.0-OL7.6+1.0&quot;,
1009         linux_arm: &quot;gcc8.2.0-Fedora27+1.0&quot;,
1010         linux_ppc64le: &quot;gcc8.2.0-Fedora27+1.0&quot;,
1011         linux_s390x: &quot;gcc8.2.0-Fedora27+1.0&quot;
1012     };
1013 
1014     var devkit_platform = (input.target_cpu == &quot;x86&quot;
1015         ? input.target_os + &quot;_x64&quot;
1016         : input.target_platform);
1017 
1018     var devkit_cross_prefix = &quot;&quot;;
<span class="line-modified">1019     if (input.build_platform != input.target_platform</span>
<span class="line-modified">1020        &amp;&amp; input.build_platform != devkit_platform) {</span>
<span class="line-modified">1021         devkit_cross_prefix = input.build_platform + &quot;-to-&quot;;</span>


1022     }
1023 
1024     var boot_jdk_platform = (input.build_os == &quot;macosx&quot; ? &quot;osx&quot; : input.build_os)
1025         + &quot;-&quot; + input.build_cpu +
1026         (input.build_libc ? &quot;-&quot; + input.build_libc : &quot;&quot;);
1027     var boot_jdk_ext = (input.build_os == &quot;windows&quot; ? &quot;.zip&quot; : &quot;.tar.gz&quot;)
1028     // If running in WSL and building for Windows, it will look like Linux,
1029     // but we need a Windows boot JDK.
1030     if (isWsl(input) &amp;&amp; input.target_os == &quot;windows&quot;) {
1031         boot_jdk_platform = &quot;windows-&quot; + input.build_cpu;
1032         boot_jdk_ext = &quot;.zip&quot;;
1033     }
1034 
1035     var makeBinDir = (input.build_os == &quot;windows&quot;
1036         ? input.get(&quot;gnumake&quot;, &quot;install_path&quot;) + &quot;/cygwin/bin&quot;
1037         : input.get(&quot;gnumake&quot;, &quot;install_path&quot;) + &quot;/bin&quot;);
1038 
1039     if (input.build_cpu == &#39;aarch64&#39;) {
1040         boot_jdk = {
1041             organization: common.organization,
1042             ext: &quot;tar.gz&quot;,
1043             module: &quot;jdk-linux_aarch64&quot;,
1044             revision: &quot;14+1.0&quot;,
1045             configure_args: &quot;--with-boot-jdk=&quot; + common.boot_jdk_home,
1046             environment_path: common.boot_jdk_home + &quot;/bin&quot;
1047         }
1048     } else {
1049         boot_jdk = {
1050             server: &quot;jpg&quot;,
1051             product: input.build_libc == &quot;musl&quot; ? &quot;jdk-portola&quot; : &quot;jdk&quot;,
1052             version: common.boot_jdk_version,
1053             build_number: common.boot_jdk_build_number,
1054             file: &quot;bundles/&quot; + boot_jdk_platform + &quot;/jdk-&quot; + common.boot_jdk_version + &quot;_&quot;
1055                 + boot_jdk_platform + &quot;_bin&quot; + boot_jdk_ext,
1056             configure_args: &quot;--with-boot-jdk=&quot; + common.boot_jdk_home,
1057             environment_path: common.boot_jdk_home + &quot;/bin&quot;
1058         }
1059     }
<span class="line-removed">1060     if (input.build_cpu == &#39;sparcv9&#39;) {</span>
<span class="line-removed">1061         boot_jdk.file = &quot;bundles/openjdk/GPL/&quot; + boot_jdk_platform</span>
<span class="line-removed">1062             + &quot;/openjdk-&quot; + common.boot_jdk_version + &quot;_&quot;</span>
<span class="line-removed">1063             + boot_jdk_platform + &quot;_bin&quot; + boot_jdk_ext;</span>
<span class="line-removed">1064     }</span>
1065 
1066     var dependencies = {
1067         boot_jdk: boot_jdk,
1068 
1069         devkit: {
1070             organization: common.organization,
1071             ext: &quot;tar.gz&quot;,
1072             module: &quot;devkit-&quot; + devkit_cross_prefix + devkit_platform,
1073             revision: devkit_platform_revisions[devkit_platform],
1074             environment: {
1075                 &quot;DEVKIT_HOME&quot;: input.get(&quot;devkit&quot;, &quot;home_path&quot;),
1076             }
1077         },
1078 
1079         build_devkit: {
1080             organization: common.organization,
1081             ext: &quot;tar.gz&quot;,
1082             module: &quot;devkit-&quot; + input.build_platform,
1083             revision: devkit_platform_revisions[input.build_platform]
1084         },
1085 
1086         cups: {
1087             organization: common.organization,
1088             ext: &quot;tar.gz&quot;,
1089             revision: &quot;1.0118+1.0&quot;
1090         },
1091 
1092         jtreg: {
1093             server: &quot;jpg&quot;,
1094             product: &quot;jtreg&quot;,
<span class="line-modified">1095             version: &quot;5.0&quot;,</span>
1096             build_number: &quot;b01&quot;,
1097             checksum_file: &quot;MD5_VALUES&quot;,
<span class="line-modified">1098             file: &quot;bundles/jtreg_bin-5.0.zip&quot;,</span>
1099             environment_name: &quot;JT_HOME&quot;,
1100             environment_path: input.get(&quot;jtreg&quot;, &quot;home_path&quot;) + &quot;/bin&quot;,
1101             configure_args: &quot;--with-jtreg=&quot; + input.get(&quot;jtreg&quot;, &quot;home_path&quot;),
1102         },
1103 
1104         jmh: {
1105             organization: common.organization,
1106             ext: &quot;tar.gz&quot;,
1107             revision: &quot;1.21+1.0&quot;
1108         },
1109 
1110         jcov: {
1111             // Until an official build of JCov is available, use custom
1112             // build to support classfile version 57.
1113             // See CODETOOLS-7902358 for more info.
1114             // server: &quot;jpg&quot;,
1115             // product: &quot;jcov&quot;,
1116             // version: &quot;3.0&quot;,
1117             // build_number: &quot;b07&quot;,
1118             // file: &quot;bundles/jcov-3_0.zip&quot;,
</pre>
<hr />
<pre>
1177             revision: &quot;3.0-SNAPSHOT&quot;,
1178             environment_name: &quot;JIB_HOME&quot;,
1179             environment_value: input.get(&quot;jib&quot;, &quot;home_path&quot;)
1180         },
1181 
1182         ant: {
1183             organization: common.organization,
1184             ext: &quot;zip&quot;,
1185             revision: &quot;1.7.1+1.0&quot;,
1186             configure_args: &quot;&quot;,
1187         },
1188 
1189         graalunit_lib: {
1190             organization: common.organization,
1191             ext: &quot;zip&quot;,
1192             revision: &quot;619_Apr_12_2018&quot;,
1193             module: &quot;graalunit-lib&quot;,
1194             configure_args: &quot;--with-graalunit-lib=&quot; + input.get(&quot;graalunit_lib&quot;, &quot;install_path&quot;),
1195             environment_name: &quot;GRAALUNIT_LIB&quot;
1196         },






1197     };
1198 
1199     return dependencies;
1200 };
1201 
1202 /**
1203  * Generate the missing platform attributes for profiles
1204  *
1205  * @param profiles Profiles map to generate attributes on
1206  * @returns {{}} New profiles map with platform attributes fully filled in
1207  */
1208 var generatePlatformAttributes = function (profiles) {
1209     var ret = concatObjects(profiles, {});
1210     for (var profile in profiles) {
1211         if (ret[profile].build_os == null) {
1212             ret[profile].build_os = ret[profile].target_os;
1213         }
1214         if (ret[profile].build_cpu == null) {
1215             ret[profile].build_cpu = ret[profile].target_cpu;
1216         }
</pre>
</td>
<td>
<hr />
<pre>
 228     data.dependencies = getJibProfilesDependencies(input, common, data);
 229 
 230     return data;
 231 };
 232 
 233 /**
 234  * Generates some common values
 235  *
 236  * @param input External data to use for generating the configuration
 237  * @returns Common values
 238  */
 239 var getJibProfilesCommon = function (input, data) {
 240     var common = {};
 241 
 242     common.organization = &quot;jpg.infra.builddeps&quot;;
 243     common.build_id = getBuildId(input);
 244     common.build_number = input.build_number != null ? input.build_number : &quot;0&quot;;
 245 
 246     // List of the main profile names used for iteration
 247     common.main_profile_names = [
<span class="line-modified"> 248         &quot;linux-x64&quot;, &quot;linux-x64-musl&quot;, &quot;linux-x86&quot;, &quot;macosx-x64&quot;,</span>
<span class="line-modified"> 249         &quot;windows-x64&quot;, &quot;windows-x86&quot;,</span>
 250         &quot;linux-aarch64&quot;, &quot;linux-arm32&quot;, &quot;linux-ppc64le&quot;, &quot;linux-s390x&quot;
 251     ];
 252 
 253     // These are the base setttings for all the main build profiles.
 254     common.main_profile_base = {
 255         dependencies: [&quot;boot_jdk&quot;, &quot;gnumake&quot;, &quot;jtreg&quot;, &quot;jib&quot;, &quot;autoconf&quot;, &quot;jmh&quot;, &quot;jcov&quot;],
 256         default_make_targets: [&quot;product-bundles&quot;, &quot;test-bundles&quot;, &quot;static-libs-bundles&quot;],
 257         configure_args: concat(&quot;--enable-jtreg-failure-handler&quot;,
 258             &quot;--with-exclude-translations=de,es,fr,it,ko,pt_BR,sv,ca,tr,cs,sk,ja_JP_A,ja_JP_HA,ja_JP_HI,ja_JP_I,zh_TW,zh_HK&quot;,
 259             &quot;--disable-manpages&quot;,
 260             &quot;--disable-jvm-feature-shenandoahgc&quot;,
 261             versionArgs(input, common))
 262     };
 263     // Extra settings for debug profiles
 264     common.debug_suffix = &quot;-debug&quot;;
 265     common.debug_profile_base = {
 266         configure_args: [&quot;--enable-debug&quot;],
 267         labels: &quot;debug&quot;
 268     };
 269     // Extra settings for slowdebug profiles
</pre>
<hr />
<pre>
 393         + common.boot_jdk_version
 394         + (input.build_os == &quot;macosx&quot; ? &quot;.jdk/Contents/Home&quot; : &quot;&quot;);
 395 
 396     return common;
 397 };
 398 
 399 /**
 400  * Generates the profiles part of the configuration.
 401  *
 402  * @param input External data to use for generating the configuration
 403  * @param common The common values
 404  * @returns {{}} Profiles part of the configuration
 405  */
 406 var getJibProfilesProfiles = function (input, common, data) {
 407     // Main SE profiles
 408     var profiles = {
 409 
 410         &quot;linux-x64&quot;: {
 411             target_os: &quot;linux&quot;,
 412             target_cpu: &quot;x64&quot;,
<span class="line-modified"> 413             dependencies: [&quot;devkit&quot;, &quot;gtest&quot;, &quot;graphviz&quot;, &quot;pandoc&quot;, &quot;graalunit_lib&quot;],</span>
 414             configure_args: concat(common.configure_args_64bit,
 415                 &quot;--enable-full-docs&quot;, &quot;--with-zlib=system&quot;,
 416                 (isWsl(input) ? [ &quot;--host=x86_64-unknown-linux-gnu&quot;,
 417                     &quot;--build=x86_64-unknown-linux-gnu&quot; ] : [])),
 418             default_make_targets: [&quot;docs-bundles&quot;],
 419         },
 420 
 421         &quot;linux-x64-musl&quot;: {
 422             target_os: &quot;linux&quot;,
 423             target_cpu: &quot;x64&quot;,
 424             target_libc: &quot;musl&quot;,
 425             configure_args: concat(common.configure_args_64bit,
 426                 &quot;--with-zlib=system&quot;),
 427         },
 428 
 429         &quot;linux-x86&quot;: {
 430             target_os: &quot;linux&quot;,
 431             target_cpu: &quot;x86&quot;,
 432             build_cpu: &quot;x64&quot;,
<span class="line-modified"> 433             dependencies: [&quot;devkit&quot;, &quot;gtest&quot;],</span>
 434             configure_args: concat(common.configure_args_32bit,
 435                 &quot;--with-jvm-variants=minimal,server&quot;, &quot;--with-zlib=system&quot;),
 436         },
 437 
 438         &quot;macosx-x64&quot;: {
 439             target_os: &quot;macosx&quot;,
 440             target_cpu: &quot;x64&quot;,
<span class="line-modified"> 441             dependencies: [&quot;devkit&quot;, &quot;gtest&quot;, &quot;pandoc&quot;, &quot;graalunit_lib&quot;],</span>
 442             configure_args: concat(common.configure_args_64bit, &quot;--with-zlib=system&quot;,
<span class="line-modified"> 443                 &quot;--with-macosx-version-max=10.9.0&quot;,</span>
<span class="line-modified"> 444                 // Use system SetFile instead of the one in the devkit as the</span>
<span class="line-modified"> 445                 // devkit one may not work on Catalina.</span>
<span class="line-modified"> 446                 &quot;SETFILE=/usr/bin/SetFile&quot;),</span>













 447         },
 448 
 449         &quot;windows-x64&quot;: {
 450             target_os: &quot;windows&quot;,
 451             target_cpu: &quot;x64&quot;,
<span class="line-modified"> 452             dependencies: [&quot;devkit&quot;, &quot;gtest&quot;, &quot;pandoc&quot;, &quot;graalunit_lib&quot;],</span>
 453             configure_args: concat(common.configure_args_64bit),
 454         },
 455 
 456         &quot;windows-x86&quot;: {
 457             target_os: &quot;windows&quot;,
 458             target_cpu: &quot;x86&quot;,
 459             build_cpu: &quot;x64&quot;,
<span class="line-modified"> 460             dependencies: [&quot;devkit&quot;, &quot;gtest&quot;],</span>
 461             configure_args: concat(common.configure_args_32bit),
 462         },
 463 
 464         &quot;linux-aarch64&quot;: {
 465             target_os: &quot;linux&quot;,
 466             target_cpu: &quot;aarch64&quot;,
 467             build_cpu: &quot;x64&quot;,
<span class="line-modified"> 468             dependencies: [&quot;devkit&quot;, &quot;gtest&quot;, &quot;build_devkit&quot;, &quot;pandoc&quot;],</span>
 469             configure_args: [
 470                 &quot;--openjdk-target=aarch64-linux-gnu&quot;,
 471 		&quot;--disable-jvm-feature-jvmci&quot;,
 472 		&quot;--disable-jvm-feature-graal&quot;,
 473 		&quot;--disable-jvm-feature-aot&quot;,
 474             ],
 475         },
 476 
 477         &quot;linux-arm32&quot;: {
 478             target_os: &quot;linux&quot;,
 479             target_cpu: &quot;arm&quot;,
 480             build_cpu: &quot;x64&quot;,
<span class="line-modified"> 481             dependencies: [&quot;devkit&quot;, &quot;gtest&quot;, &quot;build_devkit&quot;],</span>
 482             configure_args: [
 483                 &quot;--openjdk-target=arm-linux-gnueabihf&quot;, &quot;--with-freetype=bundled&quot;,
 484                 &quot;--with-abi-profile=arm-vfp-hflt&quot;, &quot;--disable-warnings-as-errors&quot;
 485             ],
 486         },
 487 
 488         &quot;linux-ppc64le&quot;: {
 489             target_os: &quot;linux&quot;,
 490             target_cpu: &quot;ppc64le&quot;,
 491             build_cpu: &quot;x64&quot;,
<span class="line-modified"> 492             dependencies: [&quot;devkit&quot;, &quot;gtest&quot;, &quot;build_devkit&quot;],</span>
 493             configure_args: [
 494                 &quot;--openjdk-target=ppc64le-linux-gnu&quot;, &quot;--with-freetype=bundled&quot;,
 495                 &quot;--disable-warnings-as-errors&quot;
 496             ],
 497         },
 498 
 499         &quot;linux-s390x&quot;: {
 500             target_os: &quot;linux&quot;,
 501             target_cpu: &quot;s390x&quot;,
 502             build_cpu: &quot;x64&quot;,
<span class="line-modified"> 503             dependencies: [&quot;devkit&quot;, &quot;gtest&quot;, &quot;build_devkit&quot;],</span>
 504             configure_args: [
 505                 &quot;--openjdk-target=s390x-linux-gnu&quot;, &quot;--with-freetype=bundled&quot;,
 506                 &quot;--disable-warnings-as-errors&quot;
 507             ],
 508         },
 509     };
 510 
 511     // Add the base settings to all the main profiles
 512     common.main_profile_names.forEach(function (name) {
 513         profiles[name] = concatObjects(common.main_profile_base, profiles[name]);
 514     });
 515 
 516     // Generate debug versions of all the main profiles
 517     common.main_profile_names.forEach(function (name) {
 518         var debugName = name + common.debug_suffix;
 519         profiles[debugName] = concatObjects(profiles[name],
 520                                             common.debug_profile_base);
 521     });
 522     // Generate slowdebug versions of all the main profiles
 523     common.main_profile_names.forEach(function (name) {
 524         var debugName = name + common.slowdebug_suffix;
 525         profiles[debugName] = concatObjects(profiles[name],
 526                                             common.slowdebug_profile_base);
 527     });
 528     // Generate testmake profiles for the main profile of each build host
 529     // platform. This profile only runs the makefile tests.
 530     // Ant is needed to run the idea project generator test.
 531     var testmakeBase = {
 532         dependencies: [ &quot;ant&quot; ],
 533         environment: {
 534             &quot;ANT_HOME&quot;: input.get(&quot;ant&quot;, &quot;home_path&quot;)
 535         }
 536     };
<span class="line-modified"> 537     [ &quot;linux-x64&quot;, &quot;macosx-x64&quot;, &quot;windows-x64&quot;]</span>
 538         .forEach(function (name) {
 539             var maketestName = name + &quot;-testmake&quot;;
 540             profiles[maketestName] = concatObjects(profiles[name], testmakeBase);
 541             profiles[maketestName].default_make_targets = [ &quot;test-make&quot; ];
 542         });
 543 
 544     // Generate -gcov profiles
 545     [ &quot;linux-aarch64&quot;, &quot;linux-x64&quot;, &quot;macosx-x64&quot; ].forEach(function (name) {
 546         var gcovName = name + &quot;-gcov&quot;;
 547         profiles[gcovName] = clone(profiles[name]);
 548         profiles[gcovName].default_make_targets = [&quot;product-bundles&quot;, &quot;test-bundles&quot;];
 549         profiles[gcovName].configure_args = concat(profiles[gcovName].configure_args,
 550             [&quot;--enable-native-coverage&quot;, &quot;--disable-warnings-as-errors&quot;]);
 551     });
 552 
 553     // Profiles for building the zero jvm variant. These are used for verification.
 554     var zeroProfiles = {
 555         &quot;linux-x64-zero&quot;: {
 556             target_os: &quot;linux&quot;,
 557             target_cpu: &quot;x64&quot;,
<span class="line-modified"> 558             dependencies: [&quot;devkit&quot;, &quot;gtest&quot;],</span>
 559             configure_args: concat(common.configure_args_64bit, [
 560                 &quot;--with-zlib=system&quot;,
 561                 &quot;--with-jvm-variants=zero&quot;,
 562                 &quot;--enable-libffi-bundling&quot;
 563             ])
 564         },
 565 
 566         &quot;linux-x86-zero&quot;: {
 567             target_os: &quot;linux&quot;,
 568             target_cpu: &quot;x86&quot;,
 569             build_cpu: &quot;x64&quot;,
<span class="line-modified"> 570             dependencies: [&quot;devkit&quot;, &quot;gtest&quot;],</span>
 571             configure_args:  concat(common.configure_args_32bit, [
 572                 &quot;--with-zlib=system&quot;,
 573                 &quot;--with-jvm-variants=zero&quot;,
 574                 &quot;--enable-libffi-bundling&quot;
 575             ])
 576         }
 577     }
 578     profiles = concatObjects(profiles, zeroProfiles);
 579 
 580     // Add the base settings to the zero profiles and generate debug profiles
 581     Object.keys(zeroProfiles).forEach(function (name) {
 582         var debugName = name + common.debug_suffix;
 583         profiles[name] = concatObjects(common.main_profile_base, profiles[name]);
 584         profiles[debugName] = concatObjects(profiles[name], common.debug_profile_base);
 585     });
 586 
 587     // Define a profile with precompiled headers disabled. This is just used for
 588     // verfication of this build configuration.
 589     var noPchProfiles = {
 590         &quot;linux-x64-debug-nopch&quot;: {
 591             target_os: &quot;linux&quot;,
 592             target_cpu: &quot;x64&quot;,
<span class="line-modified"> 593             dependencies: [&quot;devkit&quot;, &quot;gtest&quot;],</span>
 594             configure_args: concat(common.configure_args_64bit,
 595                 &quot;--with-zlib=system&quot;, &quot;--disable-precompiled-headers&quot;),
 596         },
 597     };
 598     profiles = concatObjects(profiles, noPchProfiles);
 599     // Add base settings to noPch profiles
 600     Object.keys(noPchProfiles).forEach(function (name) {
 601         profiles[name] = concatObjects(common.main_profile_base, profiles[name]);
 602         profiles[name] = concatObjects(common.debug_profile_base, profiles[name]);
 603         // Override default make target with hotspot as that&#39;s the only part of
 604         // the build using precompiled headers.
 605         profiles[name].default_make_targets = [&quot;hotspot&quot;];
 606     });
 607 
 608     // Bootcycle profiles runs the build with itself as the boot jdk. This can
 609     // be done in two ways. Either using the builtin bootcycle target in the
 610     // build system. Or by supplying the main jdk build as bootjdk to configure.
<span class="line-modified"> 611     [ &quot;linux-x64&quot;, &quot;macosx-x64&quot;, &quot;windows-x64&quot; ]</span>
 612         .forEach(function (name) {
 613             var bootcycleName = name + &quot;-bootcycle&quot;;
 614             var bootcyclePrebuiltName = name + &quot;-bootcycle-prebuilt&quot;;
 615             // The base bootcycle profile just changes the default target
 616             // compared to the base profile
 617             profiles[bootcycleName] = clone(profiles[name]);
 618             profiles[bootcycleName].default_make_targets = [ &quot;bootcycle-images&quot; ];
 619             // The prebuilt bootcycle variant modifies the boot jdk argument
 620             var bootcyclePrebuiltBase = {
 621                 dependencies: [ name + &quot;.jdk&quot; ],
 622                 configure_args: [
 623                     &quot;--with-boot-jdk=&quot; + input.get(name + &quot;.jdk&quot;, &quot;home_path&quot;),




 624                 ]
 625             }
 626             profiles[bootcyclePrebuiltName] = concatObjects(profiles[name],
 627                 bootcyclePrebuiltBase);
 628             var bootJdkIndex = profiles[bootcyclePrebuiltName].dependencies.indexOf(&quot;boot_jdk&quot;);
 629             delete profiles[bootcyclePrebuiltName].dependencies[bootJdkIndex];
 630             profiles[bootcyclePrebuiltName].default_make_targets = [ &quot;product-images&quot; ];
 631         });
 632 
 633     // JCov profiles build JCov-instrumented JDK image based on images provided through dependencies.
<span class="line-modified"> 634     [ &quot;linux-aarch64&quot;, &quot;linux-x64&quot;, &quot;macosx-x64&quot;, &quot;windows-x64&quot; ]</span>
 635         .forEach(function (name) {
 636             var jcovName = name + &quot;-jcov&quot;;
 637             profiles[jcovName] = clone(common.main_profile_base);
 638             profiles[jcovName].target_os = profiles[name].target_os
 639             profiles[jcovName].target_cpu = profiles[name].target_cpu
 640             profiles[jcovName].default_make_targets = [ &quot;jcov-bundles&quot; ];
 641             profiles[jcovName].dependencies = concat(profiles[jcovName].dependencies,
 642                 [ name + &quot;.jdk&quot;, &quot;devkit&quot; ]);
 643             profiles[jcovName].configure_args = concat(profiles[jcovName].configure_args,
 644                 [&quot;--with-jcov-input-jdk=&quot; + input.get(name + &quot;.jdk&quot;, &quot;home_path&quot;)]);
 645         });
 646 
 647     //
 648     // Define artifacts for profiles
 649     //
 650     // Macosx bundles are named osx
 651     // tar.gz.
 652     var artifactData = {
 653         &quot;linux-x64&quot;: {
 654             platform: &quot;linux-x64&quot;,
 655         },
 656         &quot;linux-x64-musl&quot;: {
 657             platform: &quot;linux-x64-musl&quot;,
 658             demo_ext: &quot;tar.gz&quot;
 659         },
 660         &quot;linux-x86&quot;: {
 661             platform: &quot;linux-x86&quot;,
 662         },
 663         &quot;macosx-x64&quot;: {
 664             platform: &quot;osx-x64&quot;,
 665             jdk_subdir: &quot;jdk-&quot; + data.version +  &quot;.jdk/Contents/Home&quot;,
 666         },






 667         &quot;windows-x64&quot;: {
 668             platform: &quot;windows-x64&quot;,
 669             jdk_suffix: &quot;zip&quot;,
 670         },
 671         &quot;windows-x86&quot;: {
 672             platform: &quot;windows-x86&quot;,
 673             jdk_suffix: &quot;zip&quot;,
 674         },
 675        &quot;linux-aarch64&quot;: {
 676             platform: &quot;linux-aarch64&quot;,
 677         },
 678        &quot;linux-arm32&quot;: {
 679             platform: &quot;linux-arm32&quot;,
 680         },
 681        &quot;linux-ppc64le&quot;: {
 682             platform: &quot;linux-ppc64le&quot;,
 683         },
 684        &quot;linux-s390x&quot;: {
 685             platform: &quot;linux-s390x&quot;,
 686         }
</pre>
<hr />
<pre>
 688     // Generate common artifacts for all main profiles
 689     Object.keys(artifactData).forEach(function (name) {
 690         profiles[name] = concatObjects(profiles[name],
 691             common.main_profile_artifacts(artifactData[name]));
 692     });
 693 
 694     // Generate common artifacts for all debug profiles
 695     Object.keys(artifactData).forEach(function (name) {
 696         var debugName = name + common.debug_suffix;
 697         profiles[debugName] = concatObjects(profiles[debugName],
 698             common.debug_profile_artifacts(artifactData[name]));
 699     });
 700 
 701     profilesArtifacts = {
 702         &quot;linux-x64&quot;: {
 703             artifacts: {
 704                 doc_api_spec: {
 705                     local: &quot;bundles/\\(jdk.*doc-api-spec.tar.gz\\)&quot;,
 706                     remote: [
 707                         &quot;bundles/common/jdk-&quot; + data.version + &quot;_doc-api-spec.tar.gz&quot;,
<span class="line-modified"> 708                         &quot;bundles/common/\\1&quot;</span>
 709                     ],
 710                 },
 711             }
 712         }
 713     };
 714     profiles = concatObjects(profiles, profilesArtifacts);
 715 
 716     // Generate open only profiles for all the main and debug profiles.
 717     // Rewrite artifact remote paths by adding &quot;openjdk/GPL&quot;.
 718     common.main_profile_names.forEach(function (name) {
 719         var openName = name + common.open_suffix;
 720         profiles[openName] = concatObjects(profiles[name],
 721             common.open_profile_base);
 722         for (artifactName in profiles[openName].artifacts) {
 723             var artifact = profiles[openName].artifacts[artifactName];
 724             artifact.remote = replaceAll(
 725                 &quot;bundles\/&quot;, &quot;bundles/openjdk/GPL/&quot;,
 726                 (artifact.remote != null ? artifact.remote : artifact.local));
 727         }
 728         var debugName = name + common.debug_suffix;
</pre>
<hr />
<pre>
 765                        profiles[openName].artifacts[&quot;jdk&quot;].remote));
 766     });
 767 
 768     // Generate cmp-baseline profiles for each main profile and their
 769     // corresponding debug profile. This profile does a compare build run with no
 770     // changes to verify that the compare script has a clean baseline
 771     common.main_profile_names.forEach(function (name) {
 772         [ &quot;&quot;, common.open_suffix ].forEach(function (suffix) {
 773             var cmpBaselineName = name + suffix + &quot;-cmp-baseline&quot;;
 774             profiles[cmpBaselineName] = clone(profiles[name + suffix]);
 775             // Only compare the images target. This should pressumably be expanded
 776             // to include more build targets when possible.
 777             profiles[cmpBaselineName].default_make_targets = [ &quot;images&quot;, &quot;test-image&quot; ];
 778             if (name == &quot;linux-x64&quot;) {
 779                 profiles[cmpBaselineName].default_make_targets
 780                     = concat(profiles[cmpBaselineName].default_make_targets, &quot;docs&quot;);
 781             }
 782             profiles[cmpBaselineName].make_args = [ &quot;COMPARE_BUILD=CONF=&quot; ];
 783             profiles[cmpBaselineName].configure_args = concat(
 784                 profiles[cmpBaselineName].configure_args,
<span class="line-modified"> 785                 &quot;--with-hotspot-build-time=n/a&quot;,</span>
 786                 &quot;--disable-precompiled-headers&quot;);
 787             // Do not inherit artifact definitions from base profile
 788             delete profiles[cmpBaselineName].artifacts;
 789         });
 790     });
 791 
 792     // Artifacts of JCov profiles
<span class="line-modified"> 793     [ &quot;linux-aarch64&quot;, &quot;linux-x64&quot;, &quot;macosx-x64&quot;, &quot;windows-x64&quot; ]</span>
 794         .forEach(function (name) {
 795             var o = artifactData[name]
 796             var jdk_subdir = (o.jdk_subdir != null ? o.jdk_subdir : &quot;jdk-&quot; + data.version);
 797             var jdk_suffix = (o.jdk_suffix != null ? o.jdk_suffix : &quot;tar.gz&quot;);
 798             var pf = o.platform
 799             var jcovName = name + &quot;-jcov&quot;;
 800             profiles[jcovName].artifacts = {
 801                 jdk: {
 802                     local: &quot;bundles/\\(jdk-jcov.*bin.&quot; + jdk_suffix + &quot;\\)&quot;,
 803                     remote: [
 804                         &quot;bundles/&quot; + pf + &quot;/jdk-jcov-&quot; + data.version + &quot;_&quot; + pf + &quot;_bin.&quot; + jdk_suffix
 805                     ],
 806                     subdir: jdk_subdir,
 807                     exploded: &quot;images/jdk-jcov&quot;
 808                 }
 809             };
 810         });
 811 
 812     // Artifacts of gcov (native-code-coverage) profiles
 813     [ &quot;linux-aarch64&quot;, &quot;linux-x64&quot;, &quot;macosx-x64&quot; ].forEach(function (name) {
</pre>
<hr />
<pre>
 962     }
 963 
 964     // Generate the missing platform attributes
 965     profiles = generatePlatformAttributes(profiles);
 966     profiles = generateDefaultMakeTargetsConfigureArg(common, profiles);
 967     return profiles;
 968 };
 969 
 970 /**
 971  * Generate the dependencies part of the configuration
 972  *
 973  * @param input External data to use for generating the configuration
 974  * @param common The common values
 975  * @returns {{}} Dependencies part of configuration
 976  */
 977 var getJibProfilesDependencies = function (input, common) {
 978 
 979     var devkit_platform_revisions = {
 980         linux_x64: &quot;gcc9.2.0-OL6.4+1.0&quot;,
 981         macosx_x64: &quot;Xcode10.1-MacOSX10.14+1.0&quot;,


 982         windows_x64: &quot;VS2019-16.5.3+1.0&quot;,
 983         linux_aarch64: &quot;gcc9.2.0-OL7.6+1.0&quot;,
 984         linux_arm: &quot;gcc8.2.0-Fedora27+1.0&quot;,
 985         linux_ppc64le: &quot;gcc8.2.0-Fedora27+1.0&quot;,
 986         linux_s390x: &quot;gcc8.2.0-Fedora27+1.0&quot;
 987     };
 988 
 989     var devkit_platform = (input.target_cpu == &quot;x86&quot;
 990         ? input.target_os + &quot;_x64&quot;
 991         : input.target_platform);
 992 
 993     var devkit_cross_prefix = &quot;&quot;;
<span class="line-modified"> 994     if (!(input.target_os == &quot;windows&quot; &amp;&amp; isWsl(input))) {</span>
<span class="line-modified"> 995         if (input.build_platform != input.target_platform</span>
<span class="line-modified"> 996            &amp;&amp; input.build_platform != devkit_platform) {</span>
<span class="line-added"> 997             devkit_cross_prefix = input.build_platform + &quot;-to-&quot;;</span>
<span class="line-added"> 998         }</span>
 999     }
1000 
1001     var boot_jdk_platform = (input.build_os == &quot;macosx&quot; ? &quot;osx&quot; : input.build_os)
1002         + &quot;-&quot; + input.build_cpu +
1003         (input.build_libc ? &quot;-&quot; + input.build_libc : &quot;&quot;);
1004     var boot_jdk_ext = (input.build_os == &quot;windows&quot; ? &quot;.zip&quot; : &quot;.tar.gz&quot;)
1005     // If running in WSL and building for Windows, it will look like Linux,
1006     // but we need a Windows boot JDK.
1007     if (isWsl(input) &amp;&amp; input.target_os == &quot;windows&quot;) {
1008         boot_jdk_platform = &quot;windows-&quot; + input.build_cpu;
1009         boot_jdk_ext = &quot;.zip&quot;;
1010     }
1011 
1012     var makeBinDir = (input.build_os == &quot;windows&quot;
1013         ? input.get(&quot;gnumake&quot;, &quot;install_path&quot;) + &quot;/cygwin/bin&quot;
1014         : input.get(&quot;gnumake&quot;, &quot;install_path&quot;) + &quot;/bin&quot;);
1015 
1016     if (input.build_cpu == &#39;aarch64&#39;) {
1017         boot_jdk = {
1018             organization: common.organization,
1019             ext: &quot;tar.gz&quot;,
1020             module: &quot;jdk-linux_aarch64&quot;,
1021             revision: &quot;14+1.0&quot;,
1022             configure_args: &quot;--with-boot-jdk=&quot; + common.boot_jdk_home,
1023             environment_path: common.boot_jdk_home + &quot;/bin&quot;
1024         }
1025     } else {
1026         boot_jdk = {
1027             server: &quot;jpg&quot;,
1028             product: input.build_libc == &quot;musl&quot; ? &quot;jdk-portola&quot; : &quot;jdk&quot;,
1029             version: common.boot_jdk_version,
1030             build_number: common.boot_jdk_build_number,
1031             file: &quot;bundles/&quot; + boot_jdk_platform + &quot;/jdk-&quot; + common.boot_jdk_version + &quot;_&quot;
1032                 + boot_jdk_platform + &quot;_bin&quot; + boot_jdk_ext,
1033             configure_args: &quot;--with-boot-jdk=&quot; + common.boot_jdk_home,
1034             environment_path: common.boot_jdk_home + &quot;/bin&quot;
1035         }
1036     }





1037 
1038     var dependencies = {
1039         boot_jdk: boot_jdk,
1040 
1041         devkit: {
1042             organization: common.organization,
1043             ext: &quot;tar.gz&quot;,
1044             module: &quot;devkit-&quot; + devkit_cross_prefix + devkit_platform,
1045             revision: devkit_platform_revisions[devkit_platform],
1046             environment: {
1047                 &quot;DEVKIT_HOME&quot;: input.get(&quot;devkit&quot;, &quot;home_path&quot;),
1048             }
1049         },
1050 
1051         build_devkit: {
1052             organization: common.organization,
1053             ext: &quot;tar.gz&quot;,
1054             module: &quot;devkit-&quot; + input.build_platform,
1055             revision: devkit_platform_revisions[input.build_platform]
1056         },
1057 
1058         cups: {
1059             organization: common.organization,
1060             ext: &quot;tar.gz&quot;,
1061             revision: &quot;1.0118+1.0&quot;
1062         },
1063 
1064         jtreg: {
1065             server: &quot;jpg&quot;,
1066             product: &quot;jtreg&quot;,
<span class="line-modified">1067             version: &quot;5.1&quot;,</span>
1068             build_number: &quot;b01&quot;,
1069             checksum_file: &quot;MD5_VALUES&quot;,
<span class="line-modified">1070             file: &quot;bundles/jtreg_bin-5.1.zip&quot;,</span>
1071             environment_name: &quot;JT_HOME&quot;,
1072             environment_path: input.get(&quot;jtreg&quot;, &quot;home_path&quot;) + &quot;/bin&quot;,
1073             configure_args: &quot;--with-jtreg=&quot; + input.get(&quot;jtreg&quot;, &quot;home_path&quot;),
1074         },
1075 
1076         jmh: {
1077             organization: common.organization,
1078             ext: &quot;tar.gz&quot;,
1079             revision: &quot;1.21+1.0&quot;
1080         },
1081 
1082         jcov: {
1083             // Until an official build of JCov is available, use custom
1084             // build to support classfile version 57.
1085             // See CODETOOLS-7902358 for more info.
1086             // server: &quot;jpg&quot;,
1087             // product: &quot;jcov&quot;,
1088             // version: &quot;3.0&quot;,
1089             // build_number: &quot;b07&quot;,
1090             // file: &quot;bundles/jcov-3_0.zip&quot;,
</pre>
<hr />
<pre>
1149             revision: &quot;3.0-SNAPSHOT&quot;,
1150             environment_name: &quot;JIB_HOME&quot;,
1151             environment_value: input.get(&quot;jib&quot;, &quot;home_path&quot;)
1152         },
1153 
1154         ant: {
1155             organization: common.organization,
1156             ext: &quot;zip&quot;,
1157             revision: &quot;1.7.1+1.0&quot;,
1158             configure_args: &quot;&quot;,
1159         },
1160 
1161         graalunit_lib: {
1162             organization: common.organization,
1163             ext: &quot;zip&quot;,
1164             revision: &quot;619_Apr_12_2018&quot;,
1165             module: &quot;graalunit-lib&quot;,
1166             configure_args: &quot;--with-graalunit-lib=&quot; + input.get(&quot;graalunit_lib&quot;, &quot;install_path&quot;),
1167             environment_name: &quot;GRAALUNIT_LIB&quot;
1168         },
<span class="line-added">1169 </span>
<span class="line-added">1170         gtest: {</span>
<span class="line-added">1171             organization: common.organization,</span>
<span class="line-added">1172             ext: &quot;tar.gz&quot;,</span>
<span class="line-added">1173             revision: &quot;1.8.1&quot;</span>
<span class="line-added">1174         },</span>
1175     };
1176 
1177     return dependencies;
1178 };
1179 
1180 /**
1181  * Generate the missing platform attributes for profiles
1182  *
1183  * @param profiles Profiles map to generate attributes on
1184  * @returns {{}} New profiles map with platform attributes fully filled in
1185  */
1186 var generatePlatformAttributes = function (profiles) {
1187     var ret = concatObjects(profiles, {});
1188     for (var profile in profiles) {
1189         if (ret[profile].build_os == null) {
1190             ret[profile].build_os = ret[profile].target_os;
1191         }
1192         if (ret[profile].build_cpu == null) {
1193             ret[profile].build_cpu = ret[profile].target_cpu;
1194         }
</pre>
</td>
</tr>
</table>
<center><a href="../autoconf/spec.gmk.in.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="../hotspot/lib/CompileJvm.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>