<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/gc/shared/genCollectedHeap.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../../os/linux/os_linux.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../runtime/abstract_vm_version.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shared/genCollectedHeap.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 25,11 ***</span>
  #include &quot;precompiled.hpp&quot;
  #include &quot;aot/aotLoader.hpp&quot;
  #include &quot;classfile/classLoaderDataGraph.hpp&quot;
  #include &quot;classfile/symbolTable.hpp&quot;
  #include &quot;classfile/stringTable.hpp&quot;
<span class="line-removed">- #include &quot;classfile/systemDictionary.hpp&quot;</span>
  #include &quot;classfile/vmSymbols.hpp&quot;
  #include &quot;code/codeCache.hpp&quot;
  #include &quot;code/icBuffer.hpp&quot;
  #include &quot;gc/serial/defNewGeneration.hpp&quot;
  #include &quot;gc/shared/adaptiveSizePolicy.hpp&quot;
<span class="line-new-header">--- 25,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 45,11 ***</span>
<span class="line-new-header">--- 44,14 ---</span>
  #include &quot;gc/shared/genArguments.hpp&quot;
  #include &quot;gc/shared/gcVMOperations.hpp&quot;
  #include &quot;gc/shared/genCollectedHeap.hpp&quot;
  #include &quot;gc/shared/genOopClosures.inline.hpp&quot;
  #include &quot;gc/shared/generationSpec.hpp&quot;
<span class="line-added">+ #include &quot;gc/shared/gcInitLogger.hpp&quot;</span>
  #include &quot;gc/shared/locationPrinter.inline.hpp&quot;
<span class="line-added">+ #include &quot;gc/shared/oopStorage.inline.hpp&quot;</span>
<span class="line-added">+ #include &quot;gc/shared/oopStorageSet.hpp&quot;</span>
  #include &quot;gc/shared/oopStorageParState.inline.hpp&quot;
  #include &quot;gc/shared/scavengableNMethods.hpp&quot;
  #include &quot;gc/shared/space.hpp&quot;
  #include &quot;gc/shared/strongRootsScope.hpp&quot;
  #include &quot;gc/shared/weakProcessor.hpp&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 79,23 ***</span>
  
  GenCollectedHeap::GenCollectedHeap(Generation::Name young,
                                     Generation::Name old,
                                     const char* policy_counters_name) :
    CollectedHeap(),
    _young_gen_spec(new GenerationSpec(young,
                                       NewSize,
                                       MaxNewSize,
                                       GenAlignment)),
    _old_gen_spec(new GenerationSpec(old,
                                     OldSize,
                                     MaxOldSize,
                                     GenAlignment)),
    _rem_set(NULL),
    _soft_ref_gen_policy(),
    _gc_policy_counters(new GCPolicyCounters(policy_counters_name, 2, 2)),
    _full_collections_completed(0),
<span class="line-modified">!   _process_strong_tasks(new SubTasksDone(GCH_PS_NumElements)) {</span>
  }
  
  jint GenCollectedHeap::initialize() {
    // While there are no constraints in the GC code that HeapWordSize
    // be any particular value, there are multiple other areas in the
<span class="line-new-header">--- 81,29 ---</span>
  
  GenCollectedHeap::GenCollectedHeap(Generation::Name young,
                                     Generation::Name old,
                                     const char* policy_counters_name) :
    CollectedHeap(),
<span class="line-added">+   _young_gen(NULL),</span>
<span class="line-added">+   _old_gen(NULL),</span>
    _young_gen_spec(new GenerationSpec(young,
                                       NewSize,
                                       MaxNewSize,
                                       GenAlignment)),
    _old_gen_spec(new GenerationSpec(old,
                                     OldSize,
                                     MaxOldSize,
                                     GenAlignment)),
    _rem_set(NULL),
    _soft_ref_gen_policy(),
<span class="line-added">+   _size_policy(NULL),</span>
    _gc_policy_counters(new GCPolicyCounters(policy_counters_name, 2, 2)),
<span class="line-added">+   _incremental_collection_failed(false),</span>
    _full_collections_completed(0),
<span class="line-modified">!   _process_strong_tasks(new SubTasksDone(GCH_PS_NumElements)),</span>
<span class="line-added">+   _young_manager(NULL),</span>
<span class="line-added">+   _old_manager(NULL) {</span>
  }
  
  jint GenCollectedHeap::initialize() {
    // While there are no constraints in the GC code that HeapWordSize
    // be any particular value, there are multiple other areas in the
</pre>
<hr />
<pre>
<span class="line-old-header">*** 120,17 ***</span>
    _rem_set-&gt;initialize();
    CardTableBarrierSet *bs = new CardTableBarrierSet(_rem_set);
    bs-&gt;initialize();
    BarrierSet::set_barrier_set(bs);
  
<span class="line-modified">!   ReservedSpace young_rs = heap_rs.first_part(_young_gen_spec-&gt;max_size(), false, false);</span>
    _young_gen = _young_gen_spec-&gt;init(young_rs, rem_set());
    ReservedSpace old_rs = heap_rs.last_part(_young_gen_spec-&gt;max_size());
  
<span class="line-modified">!   old_rs = old_rs.first_part(_old_gen_spec-&gt;max_size(), false, false);</span>
    _old_gen = _old_gen_spec-&gt;init(old_rs, rem_set());
<span class="line-modified">!   clear_incremental_collection_failed();</span>
  
    return JNI_OK;
  }
  
  CardTableRS* GenCollectedHeap::create_rem_set(const MemRegion&amp; reserved_region) {
<span class="line-new-header">--- 128,18 ---</span>
    _rem_set-&gt;initialize();
    CardTableBarrierSet *bs = new CardTableBarrierSet(_rem_set);
    bs-&gt;initialize();
    BarrierSet::set_barrier_set(bs);
  
<span class="line-modified">!   ReservedSpace young_rs = heap_rs.first_part(_young_gen_spec-&gt;max_size());</span>
    _young_gen = _young_gen_spec-&gt;init(young_rs, rem_set());
    ReservedSpace old_rs = heap_rs.last_part(_young_gen_spec-&gt;max_size());
  
<span class="line-modified">!   old_rs = old_rs.first_part(_old_gen_spec-&gt;max_size());</span>
    _old_gen = _old_gen_spec-&gt;init(old_rs, rem_set());
<span class="line-modified">! </span>
<span class="line-added">+   GCInitLogger::print();</span>
  
    return JNI_OK;
  }
  
  CardTableRS* GenCollectedHeap::create_rem_set(const MemRegion&amp; reserved_region) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 833,12 ***</span>
  #if INCLUDE_AOT
    if (UseAOT &amp;&amp; _process_strong_tasks-&gt;try_claim_task(GCH_PS_aot_oops_do)) {
      AOTLoader::oops_do(strong_roots);
    }
  #endif
<span class="line-modified">!   if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_SystemDictionary_oops_do)) {</span>
<span class="line-modified">!     SystemDictionary::oops_do(strong_roots);</span>
    }
  
    if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_CodeCache_oops_do)) {
      if (so &amp; SO_ScavengeCodeCache) {
        assert(code_roots != NULL, &quot;must supply closure for code cache&quot;);
<span class="line-new-header">--- 842,12 ---</span>
  #if INCLUDE_AOT
    if (UseAOT &amp;&amp; _process_strong_tasks-&gt;try_claim_task(GCH_PS_aot_oops_do)) {
      AOTLoader::oops_do(strong_roots);
    }
  #endif
<span class="line-modified">!   if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_VMGlobal_oops_do)) {</span>
<span class="line-modified">!     OopStorageSet::vm_global()-&gt;oops_do(strong_roots);</span>
    }
  
    if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_CodeCache_oops_do)) {
      if (so &amp; SO_ScavengeCodeCache) {
        assert(code_roots != NULL, &quot;must supply closure for code cache&quot;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1215,21 ***</span>
    log_debug(gc, verify)(&quot;RemSet&quot;);
    rem_set()-&gt;verify();
  }
  
  void GenCollectedHeap::print_on(outputStream* st) const {
<span class="line-modified">!   _young_gen-&gt;print_on(st);</span>
<span class="line-modified">!   _old_gen-&gt;print_on(st);</span>
    MetaspaceUtils::print_on(st);
  }
  
  void GenCollectedHeap::gc_threads_do(ThreadClosure* tc) const {
  }
  
<span class="line-removed">- void GenCollectedHeap::print_gc_threads_on(outputStream* st) const {</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
  bool GenCollectedHeap::print_location(outputStream* st, void* addr) const {
    return BlockLocationPrinter&lt;GenCollectedHeap&gt;::print_location(st, addr);
  }
  
  void GenCollectedHeap::print_tracing_info() const {
<span class="line-new-header">--- 1224,22 ---</span>
    log_debug(gc, verify)(&quot;RemSet&quot;);
    rem_set()-&gt;verify();
  }
  
  void GenCollectedHeap::print_on(outputStream* st) const {
<span class="line-modified">!   if (_young_gen != NULL) {</span>
<span class="line-modified">!     _young_gen-&gt;print_on(st);</span>
<span class="line-added">+   }</span>
<span class="line-added">+   if (_old_gen != NULL) {</span>
<span class="line-added">+     _old_gen-&gt;print_on(st);</span>
<span class="line-added">+   }</span>
    MetaspaceUtils::print_on(st);
  }
  
  void GenCollectedHeap::gc_threads_do(ThreadClosure* tc) const {
  }
  
  bool GenCollectedHeap::print_location(outputStream* st, void* addr) const {
    return BlockLocationPrinter&lt;GenCollectedHeap&gt;::print_location(st, addr);
  }
  
  void GenCollectedHeap::print_tracing_info() const {
</pre>
<center><a href="../../../os/linux/os_linux.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../runtime/abstract_vm_version.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>