<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/shared/genCollectedHeap.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../../os/linux/os_linux.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../jdk.hotspot.agent/linux/native/libsaproc/ps_proc.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shared/genCollectedHeap.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  32 #include &quot;code/icBuffer.hpp&quot;
  33 #include &quot;gc/serial/defNewGeneration.hpp&quot;
  34 #include &quot;gc/shared/adaptiveSizePolicy.hpp&quot;
  35 #include &quot;gc/shared/cardTableBarrierSet.hpp&quot;
  36 #include &quot;gc/shared/cardTableRS.hpp&quot;
  37 #include &quot;gc/shared/collectedHeap.inline.hpp&quot;
  38 #include &quot;gc/shared/collectorCounters.hpp&quot;
  39 #include &quot;gc/shared/gcId.hpp&quot;
  40 #include &quot;gc/shared/gcLocker.hpp&quot;
  41 #include &quot;gc/shared/gcPolicyCounters.hpp&quot;
  42 #include &quot;gc/shared/gcTrace.hpp&quot;
  43 #include &quot;gc/shared/gcTraceTime.inline.hpp&quot;
  44 #include &quot;gc/shared/genArguments.hpp&quot;
  45 #include &quot;gc/shared/gcVMOperations.hpp&quot;
  46 #include &quot;gc/shared/genCollectedHeap.hpp&quot;
  47 #include &quot;gc/shared/genOopClosures.inline.hpp&quot;
  48 #include &quot;gc/shared/generationSpec.hpp&quot;
  49 #include &quot;gc/shared/gcInitLogger.hpp&quot;
  50 #include &quot;gc/shared/locationPrinter.inline.hpp&quot;
  51 #include &quot;gc/shared/oopStorage.inline.hpp&quot;
<span class="line-modified">  52 #include &quot;gc/shared/oopStorageSet.hpp&quot;</span>
  53 #include &quot;gc/shared/oopStorageParState.inline.hpp&quot;
  54 #include &quot;gc/shared/scavengableNMethods.hpp&quot;
  55 #include &quot;gc/shared/space.hpp&quot;
  56 #include &quot;gc/shared/strongRootsScope.hpp&quot;
  57 #include &quot;gc/shared/weakProcessor.hpp&quot;
  58 #include &quot;gc/shared/workgroup.hpp&quot;
  59 #include &quot;memory/filemap.hpp&quot;
  60 #include &quot;memory/iterator.hpp&quot;
  61 #include &quot;memory/metaspaceCounters.hpp&quot;
  62 #include &quot;memory/resourceArea.hpp&quot;
  63 #include &quot;memory/universe.hpp&quot;
  64 #include &quot;oops/oop.inline.hpp&quot;
  65 #include &quot;runtime/biasedLocking.hpp&quot;
  66 #include &quot;runtime/flags/flagSetting.hpp&quot;
  67 #include &quot;runtime/handles.hpp&quot;
  68 #include &quot;runtime/handles.inline.hpp&quot;
  69 #include &quot;runtime/java.hpp&quot;
  70 #include &quot;runtime/vmThread.hpp&quot;
  71 #include &quot;services/management.hpp&quot;
  72 #include &quot;services/memoryService.hpp&quot;
</pre>
<hr />
<pre>
 808   // General roots.
 809   assert(code_roots != NULL, &quot;code root closure should always be set&quot;);
 810   // _n_termination for _process_strong_tasks should be set up stream
 811   // in a method not running in a GC worker.  Otherwise the GC worker
 812   // could be trying to change the termination condition while the task
 813   // is executing in another GC worker.
 814 
 815   if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_ClassLoaderDataGraph_oops_do)) {
 816     ClassLoaderDataGraph::roots_cld_do(strong_cld_closure, weak_cld_closure);
 817   }
 818 
 819   // Only process code roots from thread stacks if we aren&#39;t visiting the entire CodeCache anyway
 820   CodeBlobToOopClosure* roots_from_code_p = (so &amp; SO_AllCodeCache) ? NULL : code_roots;
 821 
 822   bool is_par = scope-&gt;n_threads() &gt; 1;
 823   Threads::possibly_parallel_oops_do(is_par, strong_roots, roots_from_code_p);
 824 
 825   if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_Universe_oops_do)) {
 826     Universe::oops_do(strong_roots);
 827   }
<span class="line-removed"> 828   // Global (strong) JNI handles</span>
<span class="line-removed"> 829   if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_JNIHandles_oops_do)) {</span>
<span class="line-removed"> 830     JNIHandles::oops_do(strong_roots);</span>
<span class="line-removed"> 831   }</span>
 832 
 833   if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_ObjectSynchronizer_oops_do)) {
 834     ObjectSynchronizer::oops_do(strong_roots);
 835   }
 836   if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_Management_oops_do)) {
 837     Management::oops_do(strong_roots);
 838   }
 839   if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_jvmti_oops_do)) {
 840     JvmtiExport::oops_do(strong_roots);
 841   }
 842 #if INCLUDE_AOT
 843   if (UseAOT &amp;&amp; _process_strong_tasks-&gt;try_claim_task(GCH_PS_aot_oops_do)) {
 844     AOTLoader::oops_do(strong_roots);
 845   }
 846 #endif
<span class="line-modified"> 847   if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_VMGlobal_oops_do)) {</span>
<span class="line-modified"> 848     OopStorageSet::vm_global()-&gt;oops_do(strong_roots);</span>
 849   }
 850 
 851   if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_CodeCache_oops_do)) {
 852     if (so &amp; SO_ScavengeCodeCache) {
 853       assert(code_roots != NULL, &quot;must supply closure for code cache&quot;);
 854 
 855       // We only visit parts of the CodeCache when scavenging.
 856       ScavengableNMethods::nmethods_do(code_roots);
 857     }
 858     if (so &amp; SO_AllCodeCache) {
 859       assert(code_roots != NULL, &quot;must supply closure for code cache&quot;);
 860 
 861       // CMSCollector uses this to do intermediate-strength collections.
 862       // We scan the entire code cache, since CodeCache::do_unloading is not called.
 863       CodeCache::blobs_do(code_roots);
 864     }
 865     // Verify that the code cache contents are not subject to
 866     // movement by a scavenging collection.
 867     DEBUG_ONLY(CodeBlobToOopClosure assert_code_is_non_scavengable(&amp;assert_is_non_scavengable_closure, !CodeBlobToOopClosure::FixRelocations));
 868     DEBUG_ONLY(ScavengableNMethods::asserted_non_scavengable_nmethods_do(&amp;assert_code_is_non_scavengable));
</pre>
<hr />
<pre>
1182                                           bool old_to_young) {
1183   if (old_to_young) {
1184     cl-&gt;do_generation(_old_gen);
1185     cl-&gt;do_generation(_young_gen);
1186   } else {
1187     cl-&gt;do_generation(_young_gen);
1188     cl-&gt;do_generation(_old_gen);
1189   }
1190 }
1191 
1192 bool GenCollectedHeap::is_maximal_no_gc() const {
1193   return _young_gen-&gt;is_maximal_no_gc() &amp;&amp; _old_gen-&gt;is_maximal_no_gc();
1194 }
1195 
1196 void GenCollectedHeap::save_marks() {
1197   _young_gen-&gt;save_marks();
1198   _old_gen-&gt;save_marks();
1199 }
1200 
1201 GenCollectedHeap* GenCollectedHeap::heap() {
<span class="line-modified">1202   CollectedHeap* heap = Universe::heap();</span>
<span class="line-modified">1203   assert(heap != NULL, &quot;Uninitialized access to GenCollectedHeap::heap()&quot;);</span>
<span class="line-removed">1204   assert(heap-&gt;kind() == CollectedHeap::Serial, &quot;Invalid name&quot;);</span>
<span class="line-removed">1205   return (GenCollectedHeap*) heap;</span>
1206 }
1207 
1208 #if INCLUDE_SERIALGC
1209 void GenCollectedHeap::prepare_for_compaction() {
1210   // Start by compacting into same gen.
1211   CompactPoint cp(_old_gen);
1212   _old_gen-&gt;prepare_for_compaction(&amp;cp);
1213   _young_gen-&gt;prepare_for_compaction(&amp;cp);
1214 }
1215 #endif // INCLUDE_SERIALGC
1216 
1217 void GenCollectedHeap::verify(VerifyOption option /* ignored */) {
1218   log_debug(gc, verify)(&quot;%s&quot;, _old_gen-&gt;name());
1219   _old_gen-&gt;verify();
1220 
1221   log_debug(gc, verify)(&quot;%s&quot;, _old_gen-&gt;name());
1222   _young_gen-&gt;verify();
1223 
1224   log_debug(gc, verify)(&quot;RemSet&quot;);
1225   rem_set()-&gt;verify();
</pre>
</td>
<td>
<hr />
<pre>
  32 #include &quot;code/icBuffer.hpp&quot;
  33 #include &quot;gc/serial/defNewGeneration.hpp&quot;
  34 #include &quot;gc/shared/adaptiveSizePolicy.hpp&quot;
  35 #include &quot;gc/shared/cardTableBarrierSet.hpp&quot;
  36 #include &quot;gc/shared/cardTableRS.hpp&quot;
  37 #include &quot;gc/shared/collectedHeap.inline.hpp&quot;
  38 #include &quot;gc/shared/collectorCounters.hpp&quot;
  39 #include &quot;gc/shared/gcId.hpp&quot;
  40 #include &quot;gc/shared/gcLocker.hpp&quot;
  41 #include &quot;gc/shared/gcPolicyCounters.hpp&quot;
  42 #include &quot;gc/shared/gcTrace.hpp&quot;
  43 #include &quot;gc/shared/gcTraceTime.inline.hpp&quot;
  44 #include &quot;gc/shared/genArguments.hpp&quot;
  45 #include &quot;gc/shared/gcVMOperations.hpp&quot;
  46 #include &quot;gc/shared/genCollectedHeap.hpp&quot;
  47 #include &quot;gc/shared/genOopClosures.inline.hpp&quot;
  48 #include &quot;gc/shared/generationSpec.hpp&quot;
  49 #include &quot;gc/shared/gcInitLogger.hpp&quot;
  50 #include &quot;gc/shared/locationPrinter.inline.hpp&quot;
  51 #include &quot;gc/shared/oopStorage.inline.hpp&quot;
<span class="line-modified">  52 #include &quot;gc/shared/oopStorageSet.inline.hpp&quot;</span>
  53 #include &quot;gc/shared/oopStorageParState.inline.hpp&quot;
  54 #include &quot;gc/shared/scavengableNMethods.hpp&quot;
  55 #include &quot;gc/shared/space.hpp&quot;
  56 #include &quot;gc/shared/strongRootsScope.hpp&quot;
  57 #include &quot;gc/shared/weakProcessor.hpp&quot;
  58 #include &quot;gc/shared/workgroup.hpp&quot;
  59 #include &quot;memory/filemap.hpp&quot;
  60 #include &quot;memory/iterator.hpp&quot;
  61 #include &quot;memory/metaspaceCounters.hpp&quot;
  62 #include &quot;memory/resourceArea.hpp&quot;
  63 #include &quot;memory/universe.hpp&quot;
  64 #include &quot;oops/oop.inline.hpp&quot;
  65 #include &quot;runtime/biasedLocking.hpp&quot;
  66 #include &quot;runtime/flags/flagSetting.hpp&quot;
  67 #include &quot;runtime/handles.hpp&quot;
  68 #include &quot;runtime/handles.inline.hpp&quot;
  69 #include &quot;runtime/java.hpp&quot;
  70 #include &quot;runtime/vmThread.hpp&quot;
  71 #include &quot;services/management.hpp&quot;
  72 #include &quot;services/memoryService.hpp&quot;
</pre>
<hr />
<pre>
 808   // General roots.
 809   assert(code_roots != NULL, &quot;code root closure should always be set&quot;);
 810   // _n_termination for _process_strong_tasks should be set up stream
 811   // in a method not running in a GC worker.  Otherwise the GC worker
 812   // could be trying to change the termination condition while the task
 813   // is executing in another GC worker.
 814 
 815   if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_ClassLoaderDataGraph_oops_do)) {
 816     ClassLoaderDataGraph::roots_cld_do(strong_cld_closure, weak_cld_closure);
 817   }
 818 
 819   // Only process code roots from thread stacks if we aren&#39;t visiting the entire CodeCache anyway
 820   CodeBlobToOopClosure* roots_from_code_p = (so &amp; SO_AllCodeCache) ? NULL : code_roots;
 821 
 822   bool is_par = scope-&gt;n_threads() &gt; 1;
 823   Threads::possibly_parallel_oops_do(is_par, strong_roots, roots_from_code_p);
 824 
 825   if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_Universe_oops_do)) {
 826     Universe::oops_do(strong_roots);
 827   }




 828 
 829   if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_ObjectSynchronizer_oops_do)) {
 830     ObjectSynchronizer::oops_do(strong_roots);
 831   }
 832   if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_Management_oops_do)) {
 833     Management::oops_do(strong_roots);
 834   }
 835   if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_jvmti_oops_do)) {
 836     JvmtiExport::oops_do(strong_roots);
 837   }
 838 #if INCLUDE_AOT
 839   if (UseAOT &amp;&amp; _process_strong_tasks-&gt;try_claim_task(GCH_PS_aot_oops_do)) {
 840     AOTLoader::oops_do(strong_roots);
 841   }
 842 #endif
<span class="line-modified"> 843   if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_OopStorageSet_oops_do)) {</span>
<span class="line-modified"> 844     OopStorageSet::strong_oops_do(strong_roots);</span>
 845   }
 846 
 847   if (_process_strong_tasks-&gt;try_claim_task(GCH_PS_CodeCache_oops_do)) {
 848     if (so &amp; SO_ScavengeCodeCache) {
 849       assert(code_roots != NULL, &quot;must supply closure for code cache&quot;);
 850 
 851       // We only visit parts of the CodeCache when scavenging.
 852       ScavengableNMethods::nmethods_do(code_roots);
 853     }
 854     if (so &amp; SO_AllCodeCache) {
 855       assert(code_roots != NULL, &quot;must supply closure for code cache&quot;);
 856 
 857       // CMSCollector uses this to do intermediate-strength collections.
 858       // We scan the entire code cache, since CodeCache::do_unloading is not called.
 859       CodeCache::blobs_do(code_roots);
 860     }
 861     // Verify that the code cache contents are not subject to
 862     // movement by a scavenging collection.
 863     DEBUG_ONLY(CodeBlobToOopClosure assert_code_is_non_scavengable(&amp;assert_is_non_scavengable_closure, !CodeBlobToOopClosure::FixRelocations));
 864     DEBUG_ONLY(ScavengableNMethods::asserted_non_scavengable_nmethods_do(&amp;assert_code_is_non_scavengable));
</pre>
<hr />
<pre>
1178                                           bool old_to_young) {
1179   if (old_to_young) {
1180     cl-&gt;do_generation(_old_gen);
1181     cl-&gt;do_generation(_young_gen);
1182   } else {
1183     cl-&gt;do_generation(_young_gen);
1184     cl-&gt;do_generation(_old_gen);
1185   }
1186 }
1187 
1188 bool GenCollectedHeap::is_maximal_no_gc() const {
1189   return _young_gen-&gt;is_maximal_no_gc() &amp;&amp; _old_gen-&gt;is_maximal_no_gc();
1190 }
1191 
1192 void GenCollectedHeap::save_marks() {
1193   _young_gen-&gt;save_marks();
1194   _old_gen-&gt;save_marks();
1195 }
1196 
1197 GenCollectedHeap* GenCollectedHeap::heap() {
<span class="line-modified">1198   // SerialHeap is the only subtype of GenCollectedHeap.</span>
<span class="line-modified">1199   return named_heap&lt;GenCollectedHeap&gt;(CollectedHeap::Serial);</span>


1200 }
1201 
1202 #if INCLUDE_SERIALGC
1203 void GenCollectedHeap::prepare_for_compaction() {
1204   // Start by compacting into same gen.
1205   CompactPoint cp(_old_gen);
1206   _old_gen-&gt;prepare_for_compaction(&amp;cp);
1207   _young_gen-&gt;prepare_for_compaction(&amp;cp);
1208 }
1209 #endif // INCLUDE_SERIALGC
1210 
1211 void GenCollectedHeap::verify(VerifyOption option /* ignored */) {
1212   log_debug(gc, verify)(&quot;%s&quot;, _old_gen-&gt;name());
1213   _old_gen-&gt;verify();
1214 
1215   log_debug(gc, verify)(&quot;%s&quot;, _old_gen-&gt;name());
1216   _young_gen-&gt;verify();
1217 
1218   log_debug(gc, verify)(&quot;RemSet&quot;);
1219   rem_set()-&gt;verify();
</pre>
</td>
</tr>
</table>
<center><a href="../../../os/linux/os_linux.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../jdk.hotspot.agent/linux/native/libsaproc/ps_proc.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>