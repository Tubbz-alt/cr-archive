<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/hotspot/lib/CompileJvm.gmk</title>
    <link rel="stylesheet" href="../../../style.css" />
  </head>
<body>
<center><a href="../../autoconf/spec.gmk.in.sdiff.html" target="_top">&lt; prev</a> <a href="../../../index.html" target="_top">index</a> <a href="../../../src/hotspot/os/linux/os_linux.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/hotspot/lib/CompileJvm.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 83 # Disabled warnings
 84 
 85 DISABLED_WARNINGS_gcc := parentheses comment unknown-pragmas address \
 86     delete-non-virtual-dtor char-subscripts array-bounds int-in-bool-context \
 87     ignored-qualifiers  missing-field-initializers implicit-fallthrough \
 88     empty-body strict-overflow sequence-point maybe-uninitialized \
 89     misleading-indentation cast-function-type shift-negative-value
 90 
 91 ifeq ($(call check-jvm-feature, zero), true)
 92   DISABLED_WARNINGS_gcc += return-type switch clobbered
 93 endif
 94 
 95 DISABLED_WARNINGS_clang := tautological-compare \
 96     undefined-var-template sometimes-uninitialized unknown-pragmas \
 97     delete-non-virtual-dtor missing-braces char-subscripts \
 98     ignored-qualifiers missing-field-initializers mismatched-tags \
 99     shift-negative-value
100 
101 DISABLED_WARNINGS_xlc := tautological-compare shift-negative-value
102 
<span class="line-modified">103 DISABLED_WARNINGS_microsoft :=</span>
<span class="line-removed">104 </span>
<span class="line-removed">105 </span>
106 
107 ################################################################################
108 # Platform specific setup
109 
110 # ARM source selection
111 
112 ifeq ($(call And, $(call isTargetOs, linux) $(call isTargetCpu, arm)), true)
113   JVM_EXCLUDE_PATTERNS += arm_64
114 
115 else ifeq ($(call And, $(call isTargetOs, linux) $(call isTargetCpu, aarch64)), true)
116   # For 64-bit arm builds, we use the 64 bit hotspot/src/cpu/arm
117   # hotspot sources if HOTSPOT_TARGET_CPU_ARCH is set to arm.
118   # Exclude the aarch64 and 32 bit arm files for this build.
119   ifeq ($(HOTSPOT_TARGET_CPU_ARCH), arm)
120     JVM_EXCLUDE_PATTERNS += arm_32 aarch64
121   endif
122 endif
123 
124 ifeq ($(call isTargetOs, linux macosx windows), true)
125   JVM_PRECOMPILED_HEADER := $(TOPDIR)/src/hotspot/share/precompiled/precompiled.hpp
126 endif
127 
128 ifeq ($(call isTargetCpu, x86), true)
129   JVM_EXCLUDE_PATTERNS += x86_64
130 else ifeq ($(call isTargetCpu, x86_64), true)
131   JVM_EXCLUDE_PATTERNS += x86_32
132 endif
133 
<span class="line-removed">134 ifeq ($(call isTargetOs, windows), true)</span>
<span class="line-removed">135   ifeq ($(call isTargetCpuBits, 64), true)</span>
<span class="line-removed">136     RC_DESC := 64-Bit$(SPACE)</span>
<span class="line-removed">137   endif</span>
<span class="line-removed">138   JVM_RCFLAGS += -D&quot;HS_FILEDESC=$(HOTSPOT_VM_DISTRO) $(RC_DESC)$(JVM_VARIANT) VM&quot;</span>
<span class="line-removed">139 endif</span>
<span class="line-removed">140 </span>
141 JVM_OPTIMIZATION ?= HIGHEST_JVM
142 
143 # Need to set JVM_STRIPFLAGS to the default value from SPEC since the STRIPFLAGS
144 # parameter to SetupNativeCompilation allows an empty value to override the
145 # default.
146 JVM_STRIPFLAGS ?= $(STRIPFLAGS)
147 
148 # This source set is reused so save in cache.
149 $(call FillFindCache, $(JVM_SRC_DIRS))
150 
151 ################################################################################
152 # Now set up the actual compilation of the main hotspot native library
153 
<span class="line-modified">154 $(eval $(call SetupNativeCompilation, BUILD_LIBJVM, \</span>
155     NAME := jvm, \
156     TOOLCHAIN := TOOLCHAIN_LINK_CXX, \
157     OUTPUT_DIR := $(JVM_LIB_OUTPUTDIR), \
158     SRC := $(JVM_SRC_DIRS), \
159     EXCLUDES := $(JVM_EXCLUDES), \
160     EXCLUDE_FILES := $(JVM_EXCLUDE_FILES), \
161     EXCLUDE_PATTERNS := $(JVM_EXCLUDE_PATTERNS), \
162     CFLAGS := $(JVM_CFLAGS), \
163     abstract_vm_version.cpp_CXXFLAGS := $(CFLAGS_VM_VERSION), \
164     arguments.cpp_CXXFLAGS := $(CFLAGS_VM_VERSION), \
165     DISABLED_WARNINGS_gcc := $(DISABLED_WARNINGS_gcc), \
166     DISABLED_WARNINGS_clang := $(DISABLED_WARNINGS_clang), \
167     DISABLED_WARNINGS_xlc := $(DISABLED_WARNINGS_xlc), \
168     DISABLED_WARNINGS_microsoft := $(DISABLED_WARNINGS_microsoft), \
169     ASFLAGS := $(JVM_ASFLAGS), \
170     LDFLAGS := $(JVM_LDFLAGS), \
171     LIBS := $(JVM_LIBS), \
172     OPTIMIZATION := $(JVM_OPTIMIZATION), \
173     OBJECT_DIR := $(JVM_OUTPUTDIR)/objs, \
174     MAPFILE := $(JVM_MAPFILE), \
175     USE_MAPFILE_FOR_SYMBOLS := true, \
176     STRIPFLAGS := $(JVM_STRIPFLAGS), \
177     EMBED_MANIFEST := true, \
<span class="line-modified">178     RC_FLAGS := $(JVM_RCFLAGS), \</span>
<span class="line-removed">179     VERSIONINFO_RESOURCE := $(TOPDIR)/src/hotspot/os/windows/version.rc, \</span>
180     PRECOMPILED_HEADER := $(JVM_PRECOMPILED_HEADER), \
181     PRECOMPILED_HEADER_EXCLUDE := $(JVM_PRECOMPILED_HEADER_EXCLUDE), \
182 ))
183 
184 # Always recompile abstract_vm_version.cpp if libjvm needs to be relinked. This ensures
185 # that the internal vm version is updated as it relies on __DATE__ and __TIME__
186 # macros.
187 ABSTRACT_VM_VERSION_OBJ := $(JVM_OUTPUTDIR)/objs/abstract_vm_version$(OBJ_SUFFIX)
188 $(ABSTRACT_VM_VERSION_OBJ): $(filter-out $(ABSTRACT_VM_VERSION_OBJ) $(JVM_MAPFILE), \
189     $(BUILD_LIBJVM_TARGET_DEPS))
190 
191 ifneq ($(GENERATE_COMPILE_COMMANDS_ONLY), true)
192   ifeq ($(call isTargetOs, windows), true)
193     # It doesn&#39;t matter which jvm.lib file gets exported, but we need
194     # to pick just one.
195     ifeq ($(JVM_VARIANT), $(JVM_VARIANT_MAIN))
196       $(eval $(call SetupCopyFiles, COPY_JVM_LIB, \
197           DEST := $(LIB_OUTPUTDIR), \
198           FILES :=$(BUILD_LIBJVM_IMPORT_LIBRARY), \
199       ))
</pre>
</td>
<td>
<hr />
<pre>
 83 # Disabled warnings
 84 
 85 DISABLED_WARNINGS_gcc := parentheses comment unknown-pragmas address \
 86     delete-non-virtual-dtor char-subscripts array-bounds int-in-bool-context \
 87     ignored-qualifiers  missing-field-initializers implicit-fallthrough \
 88     empty-body strict-overflow sequence-point maybe-uninitialized \
 89     misleading-indentation cast-function-type shift-negative-value
 90 
 91 ifeq ($(call check-jvm-feature, zero), true)
 92   DISABLED_WARNINGS_gcc += return-type switch clobbered
 93 endif
 94 
 95 DISABLED_WARNINGS_clang := tautological-compare \
 96     undefined-var-template sometimes-uninitialized unknown-pragmas \
 97     delete-non-virtual-dtor missing-braces char-subscripts \
 98     ignored-qualifiers missing-field-initializers mismatched-tags \
 99     shift-negative-value
100 
101 DISABLED_WARNINGS_xlc := tautological-compare shift-negative-value
102 
<span class="line-modified">103 DISABLED_WARNINGS_microsoft := 4100 4127 4201 4244 4291 4351 4511 4512 4514 4996</span>


104 
105 ################################################################################
106 # Platform specific setup
107 
108 # ARM source selection
109 
110 ifeq ($(call And, $(call isTargetOs, linux) $(call isTargetCpu, arm)), true)
111   JVM_EXCLUDE_PATTERNS += arm_64
112 
113 else ifeq ($(call And, $(call isTargetOs, linux) $(call isTargetCpu, aarch64)), true)
114   # For 64-bit arm builds, we use the 64 bit hotspot/src/cpu/arm
115   # hotspot sources if HOTSPOT_TARGET_CPU_ARCH is set to arm.
116   # Exclude the aarch64 and 32 bit arm files for this build.
117   ifeq ($(HOTSPOT_TARGET_CPU_ARCH), arm)
118     JVM_EXCLUDE_PATTERNS += arm_32 aarch64
119   endif
120 endif
121 
122 ifeq ($(call isTargetOs, linux macosx windows), true)
123   JVM_PRECOMPILED_HEADER := $(TOPDIR)/src/hotspot/share/precompiled/precompiled.hpp
124 endif
125 
126 ifeq ($(call isTargetCpu, x86), true)
127   JVM_EXCLUDE_PATTERNS += x86_64
128 else ifeq ($(call isTargetCpu, x86_64), true)
129   JVM_EXCLUDE_PATTERNS += x86_32
130 endif
131 







132 JVM_OPTIMIZATION ?= HIGHEST_JVM
133 
134 # Need to set JVM_STRIPFLAGS to the default value from SPEC since the STRIPFLAGS
135 # parameter to SetupNativeCompilation allows an empty value to override the
136 # default.
137 JVM_STRIPFLAGS ?= $(STRIPFLAGS)
138 
139 # This source set is reused so save in cache.
140 $(call FillFindCache, $(JVM_SRC_DIRS))
141 
142 ################################################################################
143 # Now set up the actual compilation of the main hotspot native library
144 
<span class="line-modified">145 $(eval $(call SetupJdkLibrary, BUILD_LIBJVM, \</span>
146     NAME := jvm, \
147     TOOLCHAIN := TOOLCHAIN_LINK_CXX, \
148     OUTPUT_DIR := $(JVM_LIB_OUTPUTDIR), \
149     SRC := $(JVM_SRC_DIRS), \
150     EXCLUDES := $(JVM_EXCLUDES), \
151     EXCLUDE_FILES := $(JVM_EXCLUDE_FILES), \
152     EXCLUDE_PATTERNS := $(JVM_EXCLUDE_PATTERNS), \
153     CFLAGS := $(JVM_CFLAGS), \
154     abstract_vm_version.cpp_CXXFLAGS := $(CFLAGS_VM_VERSION), \
155     arguments.cpp_CXXFLAGS := $(CFLAGS_VM_VERSION), \
156     DISABLED_WARNINGS_gcc := $(DISABLED_WARNINGS_gcc), \
157     DISABLED_WARNINGS_clang := $(DISABLED_WARNINGS_clang), \
158     DISABLED_WARNINGS_xlc := $(DISABLED_WARNINGS_xlc), \
159     DISABLED_WARNINGS_microsoft := $(DISABLED_WARNINGS_microsoft), \
160     ASFLAGS := $(JVM_ASFLAGS), \
161     LDFLAGS := $(JVM_LDFLAGS), \
162     LIBS := $(JVM_LIBS), \
163     OPTIMIZATION := $(JVM_OPTIMIZATION), \
164     OBJECT_DIR := $(JVM_OUTPUTDIR)/objs, \
165     MAPFILE := $(JVM_MAPFILE), \
166     USE_MAPFILE_FOR_SYMBOLS := true, \
167     STRIPFLAGS := $(JVM_STRIPFLAGS), \
168     EMBED_MANIFEST := true, \
<span class="line-modified">169     RC_FILEDESC := $(HOTSPOT_VM_DISTRO) $(OPENJDK_TARGET_CPU_BITS)-Bit $(JVM_VARIANT) VM, \</span>

170     PRECOMPILED_HEADER := $(JVM_PRECOMPILED_HEADER), \
171     PRECOMPILED_HEADER_EXCLUDE := $(JVM_PRECOMPILED_HEADER_EXCLUDE), \
172 ))
173 
174 # Always recompile abstract_vm_version.cpp if libjvm needs to be relinked. This ensures
175 # that the internal vm version is updated as it relies on __DATE__ and __TIME__
176 # macros.
177 ABSTRACT_VM_VERSION_OBJ := $(JVM_OUTPUTDIR)/objs/abstract_vm_version$(OBJ_SUFFIX)
178 $(ABSTRACT_VM_VERSION_OBJ): $(filter-out $(ABSTRACT_VM_VERSION_OBJ) $(JVM_MAPFILE), \
179     $(BUILD_LIBJVM_TARGET_DEPS))
180 
181 ifneq ($(GENERATE_COMPILE_COMMANDS_ONLY), true)
182   ifeq ($(call isTargetOs, windows), true)
183     # It doesn&#39;t matter which jvm.lib file gets exported, but we need
184     # to pick just one.
185     ifeq ($(JVM_VARIANT), $(JVM_VARIANT_MAIN))
186       $(eval $(call SetupCopyFiles, COPY_JVM_LIB, \
187           DEST := $(LIB_OUTPUTDIR), \
188           FILES :=$(BUILD_LIBJVM_IMPORT_LIBRARY), \
189       ))
</pre>
</td>
</tr>
</table>
<center><a href="../../autoconf/spec.gmk.in.sdiff.html" target="_top">&lt; prev</a> <a href="../../../index.html" target="_top">index</a> <a href="../../../src/hotspot/os/linux/os_linux.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>