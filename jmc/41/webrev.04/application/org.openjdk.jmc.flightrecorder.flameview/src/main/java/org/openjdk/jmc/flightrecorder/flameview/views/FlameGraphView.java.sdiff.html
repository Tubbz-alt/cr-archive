<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff application/org.openjdk.jmc.flightrecorder.flameview/src/main/java/org/openjdk/jmc/flightrecorder/flameview/views/FlameGraphView.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../../../pom.xml.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../js/flameviewColoring.js.sdiff.html" target="_top">next &gt;</a></center>    <h2>application/org.openjdk.jmc.flightrecorder.flameview/src/main/java/org/openjdk/jmc/flightrecorder/flameview/views/FlameGraphView.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 83 import org.eclipse.ui.ISelectionListener;
 84 import org.eclipse.ui.ISharedImages;
 85 import org.eclipse.ui.IViewSite;
 86 import org.eclipse.ui.IWorkbenchPart;
 87 import org.eclipse.ui.PartInitException;
 88 import org.eclipse.ui.PlatformUI;
 89 import org.eclipse.ui.part.ViewPart;
 90 import org.eclipse.ui.plugin.AbstractUIPlugin;
 91 import org.openjdk.jmc.common.item.IItemCollection;
 92 import org.openjdk.jmc.common.util.StringToolkit;
 93 import org.openjdk.jmc.flightrecorder.flameview.FlameviewImages;
 94 import org.openjdk.jmc.flightrecorder.flameview.tree.TraceNode;
 95 import org.openjdk.jmc.flightrecorder.flameview.tree.TraceTreeUtils;
 96 import org.openjdk.jmc.flightrecorder.stacktrace.FrameSeparator;
 97 import org.openjdk.jmc.flightrecorder.stacktrace.FrameSeparator.FrameCategorization;
 98 import org.openjdk.jmc.flightrecorder.ui.FlightRecorderUI;
 99 import org.openjdk.jmc.flightrecorder.ui.common.ImageConstants;
100 import org.openjdk.jmc.flightrecorder.ui.messages.internal.Messages;
101 import org.openjdk.jmc.ui.CoreImages;
102 import org.openjdk.jmc.ui.common.util.AdapterUtil;


103 import org.openjdk.jmc.ui.handlers.MCContextMenuManager;
104 import org.openjdk.jmc.ui.misc.DisplayToolkit;
105 
106 public class FlameGraphView extends ViewPart implements ISelectionListener {
107 	private static final String DIR_ICONS = &quot;icons/&quot;; //$NON-NLS-1$
108 	private static final String PLUGIN_ID = &quot;org.openjdk.jmc.flightrecorder.flameview&quot;; //$NON-NLS-1$
109 	private static final String UNCLASSIFIABLE_FRAME = getStacktraceMessage(STACKTRACE_UNCLASSIFIABLE_FRAME);
110 	private static final String UNCLASSIFIABLE_FRAME_DESC = getStacktraceMessage(STACKTRACE_UNCLASSIFIABLE_FRAME_DESC);
111 	private static final String HTML_PAGE;
112 	static {
113 		// from: https://cdn.jsdelivr.net/gh/spiermar/d3-flame-graph@2.0.3/dist/d3-flamegraph.css
114 		String cssD3Flamegraph = &quot;jslibs/d3-flamegraph.css&quot;;
115 		// from: https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js
116 		String jsHtml5shiv = &quot;jslibs/html5shiv.min.js&quot;;
117 		// from: https://oss.maxcdn.com/respond/1.4.2/respond.min.js
118 		String jsRespond = &quot;jslibs/respond.min.js&quot;;
119 		// from: https://d3js.org/d3.v4.min.js
120 		String jsD3V4 = &quot;jslibs/d3.v4.min.js&quot;;
121 		// from: https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.9.1/d3-tip.min.js
122 		String jsD3Tip = &quot;jslibs/d3-tip.min.js&quot;;
123 		// from: https://cdn.jsdelivr.net/gh/spiermar/d3-flame-graph@2.0.3/dist/d3-flamegraph.min.js
124 		String jsD3FlameGraph = &quot;jslibs/d3-flamegraph.min.js&quot;;


125 		// jmc flameview coloring functions
126 		String jsFlameviewColoringName = &quot;flameviewColoring.js&quot;;
127 		String cssFlameview = &quot;flameview.css&quot;;
128 




129 		String jsIeLibraries = loadLibraries(jsHtml5shiv, jsRespond);
130 		String jsD3Libraries = loadLibraries(jsD3V4, jsD3Tip, jsD3FlameGraph);
131 		String styleheets = loadLibraries(cssD3Flamegraph, cssFlameview);
132 		String jsFlameviewColoring = fileContent(jsFlameviewColoringName);
133 
134 		String magnifierIcon = getIconBase64(ImageConstants.ICON_MAGNIFIER);
135 
136 		// formatter arguments for the template: %1 - CSSs stylesheets, %2 - IE9 specific scripts,
137 		// %3 - Search Icon Base64, %4 - 3rd party scripts, %5 - Flameview Coloring,
<span class="line-modified">138 		HTML_PAGE = String.format(fileContent(&quot;page.template&quot;), styleheets, jsIeLibraries, magnifierIcon, jsD3Libraries,</span>
139 				jsFlameviewColoring);
140 	}
141 
142 	private static final ExecutorService MODEL_EXECUTOR = Executors.newFixedThreadPool(1);
143 	private FrameSeparator frameSeparator;
144 
145 	private Browser browser;
146 	private SashForm container;
147 	private TraceNode currentRoot;
148 	private CompletableFuture&lt;TraceNode&gt; currentModelCalculator;
149 	private boolean threadRootAtTop = true;
150 	private boolean icicleViewActive = true;
151 	private IItemCollection currentItems;
152 	private GroupByAction[] groupByActions;
153 	private GroupByFlameviewAction[] groupByFlameviewActions;
154 	private ExportAction[] exportActions;
155 
156 	private enum GroupActionType {
157 		THREAD_ROOT(Messages.STACKTRACE_VIEW_THREAD_ROOT, IAction.AS_RADIO_BUTTON, CoreImages.THREAD),
158 		LAST_FRAME(Messages.STACKTRACE_VIEW_LAST_FRAME, IAction.AS_RADIO_BUTTON, CoreImages.METHOD_NON_OPTIMIZED),
</pre>
</td>
<td>
<hr />
<pre>
 83 import org.eclipse.ui.ISelectionListener;
 84 import org.eclipse.ui.ISharedImages;
 85 import org.eclipse.ui.IViewSite;
 86 import org.eclipse.ui.IWorkbenchPart;
 87 import org.eclipse.ui.PartInitException;
 88 import org.eclipse.ui.PlatformUI;
 89 import org.eclipse.ui.part.ViewPart;
 90 import org.eclipse.ui.plugin.AbstractUIPlugin;
 91 import org.openjdk.jmc.common.item.IItemCollection;
 92 import org.openjdk.jmc.common.util.StringToolkit;
 93 import org.openjdk.jmc.flightrecorder.flameview.FlameviewImages;
 94 import org.openjdk.jmc.flightrecorder.flameview.tree.TraceNode;
 95 import org.openjdk.jmc.flightrecorder.flameview.tree.TraceTreeUtils;
 96 import org.openjdk.jmc.flightrecorder.stacktrace.FrameSeparator;
 97 import org.openjdk.jmc.flightrecorder.stacktrace.FrameSeparator.FrameCategorization;
 98 import org.openjdk.jmc.flightrecorder.ui.FlightRecorderUI;
 99 import org.openjdk.jmc.flightrecorder.ui.common.ImageConstants;
100 import org.openjdk.jmc.flightrecorder.ui.messages.internal.Messages;
101 import org.openjdk.jmc.ui.CoreImages;
102 import org.openjdk.jmc.ui.common.util.AdapterUtil;
<span class="line-added">103 import org.openjdk.jmc.ui.common.util.Environment;</span>
<span class="line-added">104 import org.openjdk.jmc.ui.common.util.Environment.OSType;</span>
105 import org.openjdk.jmc.ui.handlers.MCContextMenuManager;
106 import org.openjdk.jmc.ui.misc.DisplayToolkit;
107 
108 public class FlameGraphView extends ViewPart implements ISelectionListener {
109 	private static final String DIR_ICONS = &quot;icons/&quot;; //$NON-NLS-1$
110 	private static final String PLUGIN_ID = &quot;org.openjdk.jmc.flightrecorder.flameview&quot;; //$NON-NLS-1$
111 	private static final String UNCLASSIFIABLE_FRAME = getStacktraceMessage(STACKTRACE_UNCLASSIFIABLE_FRAME);
112 	private static final String UNCLASSIFIABLE_FRAME_DESC = getStacktraceMessage(STACKTRACE_UNCLASSIFIABLE_FRAME_DESC);
113 	private static final String HTML_PAGE;
114 	static {
115 		// from: https://cdn.jsdelivr.net/gh/spiermar/d3-flame-graph@2.0.3/dist/d3-flamegraph.css
116 		String cssD3Flamegraph = &quot;jslibs/d3-flamegraph.css&quot;;
117 		// from: https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js
118 		String jsHtml5shiv = &quot;jslibs/html5shiv.min.js&quot;;
119 		// from: https://oss.maxcdn.com/respond/1.4.2/respond.min.js
120 		String jsRespond = &quot;jslibs/respond.min.js&quot;;
121 		// from: https://d3js.org/d3.v4.min.js
122 		String jsD3V4 = &quot;jslibs/d3.v4.min.js&quot;;
123 		// from: https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.9.1/d3-tip.min.js
124 		String jsD3Tip = &quot;jslibs/d3-tip.min.js&quot;;
125 		// from: https://cdn.jsdelivr.net/gh/spiermar/d3-flame-graph@2.0.3/dist/d3-flamegraph.min.js
126 		String jsD3FlameGraph = &quot;jslibs/d3-flamegraph.min.js&quot;;
<span class="line-added">127 		// from: https://cdn.jsdelivr.net/gh/aptmac/d3-flame-graph@internet-explorer-compatibility/dist/d3-flamegraph-ie.min.js</span>
<span class="line-added">128 		String jsD3FlameGraphIE = &quot;jslibs/d3-flamegraph-ie.min.js&quot;;</span>
129 		// jmc flameview coloring functions
130 		String jsFlameviewColoringName = &quot;flameviewColoring.js&quot;;
131 		String cssFlameview = &quot;flameview.css&quot;;
132 
<span class="line-added">133 		if (Environment.getOSType().equals(OSType.WINDOWS)) {</span>
<span class="line-added">134 			jsD3FlameGraph = jsD3FlameGraphIE;</span>
<span class="line-added">135 		}</span>
<span class="line-added">136 </span>
137 		String jsIeLibraries = loadLibraries(jsHtml5shiv, jsRespond);
138 		String jsD3Libraries = loadLibraries(jsD3V4, jsD3Tip, jsD3FlameGraph);
139 		String styleheets = loadLibraries(cssD3Flamegraph, cssFlameview);
140 		String jsFlameviewColoring = fileContent(jsFlameviewColoringName);
141 
142 		String magnifierIcon = getIconBase64(ImageConstants.ICON_MAGNIFIER);
143 
144 		// formatter arguments for the template: %1 - CSSs stylesheets, %2 - IE9 specific scripts,
145 		// %3 - Search Icon Base64, %4 - 3rd party scripts, %5 - Flameview Coloring,
<span class="line-modified">146 		HTML_PAGE = String.format(fileContent(&quot;template.html&quot;), styleheets, jsIeLibraries, magnifierIcon, jsD3Libraries,</span>
147 				jsFlameviewColoring);
148 	}
149 
150 	private static final ExecutorService MODEL_EXECUTOR = Executors.newFixedThreadPool(1);
151 	private FrameSeparator frameSeparator;
152 
153 	private Browser browser;
154 	private SashForm container;
155 	private TraceNode currentRoot;
156 	private CompletableFuture&lt;TraceNode&gt; currentModelCalculator;
157 	private boolean threadRootAtTop = true;
158 	private boolean icicleViewActive = true;
159 	private IItemCollection currentItems;
160 	private GroupByAction[] groupByActions;
161 	private GroupByFlameviewAction[] groupByFlameviewActions;
162 	private ExportAction[] exportActions;
163 
164 	private enum GroupActionType {
165 		THREAD_ROOT(Messages.STACKTRACE_VIEW_THREAD_ROOT, IAction.AS_RADIO_BUTTON, CoreImages.THREAD),
166 		LAST_FRAME(Messages.STACKTRACE_VIEW_LAST_FRAME, IAction.AS_RADIO_BUTTON, CoreImages.METHOD_NON_OPTIMIZED),
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../../../pom.xml.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../js/flameviewColoring.js.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>