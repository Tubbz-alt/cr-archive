<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff core/org.openjdk.jmc.flightrecorder.rules.jdk/src/main/java/org/openjdk/jmc/flightrecorder/rules/jdk/util/SingleEntryItemCollection.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DefaultIItemResultSet.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../../../org.openjdk.jmc.flightrecorder/src/main/java/org/openjdk/jmc/flightrecorder/EventCollection.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>core/org.openjdk.jmc.flightrecorder.rules.jdk/src/main/java/org/openjdk/jmc/flightrecorder/rules/jdk/util/SingleEntryItemCollection.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 19  * the distribution.
 20  *
 21  * 3. Neither the name of the copyright holder nor the names of its contributors may be used to
 22  * endorse or promote products derived from this software without specific prior written permission.
 23  *
 24  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR
 25  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
 26  * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR
 27  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 28  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 29  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
 30  * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY
 31  * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 32  */
 33 package org.openjdk.jmc.flightrecorder.rules.jdk.util;
 34 
 35 import java.util.ArrayList;
 36 import java.util.Iterator;
 37 import java.util.List;
 38 import java.util.NoSuchElementException;

 39 
 40 import org.openjdk.jmc.common.IPredicate;
 41 import org.openjdk.jmc.common.item.IAggregator;
 42 import org.openjdk.jmc.common.item.IItem;
 43 import org.openjdk.jmc.common.item.IItemCollection;
 44 import org.openjdk.jmc.common.item.IItemConsumer;
 45 import org.openjdk.jmc.common.item.IItemFilter;
 46 import org.openjdk.jmc.common.item.IItemIterable;
 47 import org.openjdk.jmc.common.item.IType;


 48 
 49 /**
 50  * Implementation helper class for handling a singular {@link IItem} as an {@link IItemCollection}.
 51  */
 52 final class SingleEntryItemCollection implements IItemCollection {
 53 	private static final IItemCollection NULLCOLLECTION = new IItemCollection() {
 54 		@Override
 55 		public Iterator&lt;IItemIterable&gt; iterator() {
 56 			return null;
 57 		}
 58 
 59 		@Override
 60 		public boolean hasItems() {
 61 			return false;
 62 		}
 63 
 64 		@Override
 65 		public &lt;V, C extends IItemConsumer&lt;C&gt;&gt; V getAggregate(IAggregator&lt;V, C&gt; aggregator) {
 66 			return null;
 67 		}
 68 
 69 		@Override
 70 		public IItemCollection apply(IItemFilter filter) {
 71 			return this;
 72 		}





 73 	};
 74 
 75 	private static final IItemIterable NULLITERABLE = new IItemIterable() {
 76 		@Override
 77 		public Iterator&lt;IItem&gt; iterator() {
 78 			return null;
 79 		}
 80 
 81 		@Override
 82 		public IType&lt;IItem&gt; getType() {
 83 			return null;
 84 		}
 85 
 86 		@Override
 87 		public boolean hasItems() {
 88 			return false;
 89 		}
 90 
 91 		@Override
 92 		public long getItemCount() {
</pre>
<hr />
<pre>
151 		@Override
152 		public boolean hasItems() {
153 			return false;
154 		}
155 
156 		@Override
157 		public long getItemCount() {
158 			return 1;
159 		}
160 
161 		@Override
162 		public IItemIterable apply(IPredicate&lt;IItem&gt; predicate) {
163 			if (predicate.evaluate(itemList.get(0))) {
164 				return this;
165 			}
166 			return NULLITERABLE;
167 		}
168 	}
169 
170 	private final IItem item;

171 
<span class="line-modified">172 	SingleEntryItemCollection(IItem item) {</span>
173 		this.item = item;

174 	}
175 
176 	@Override
177 	public Iterator&lt;IItemIterable&gt; iterator() {
178 		return new SingleEntryIteratorOfIterable(item);
179 	}
180 
181 	@SuppressWarnings(&quot;unchecked&quot;)
182 	@Override
183 	public IItemCollection apply(IItemFilter filter) {
184 		return filter.getPredicate((IType&lt;IItem&gt;) item.getType()).evaluate(item) ? this : NULLCOLLECTION;
185 	}
186 
187 	@Override
188 	public &lt;V, C extends IItemConsumer&lt;C&gt;&gt; V getAggregate(final IAggregator&lt;V, C&gt; aggregator) {
189 		return aggregator.getValue(new Iterator&lt;C&gt;() {
190 			boolean picked = false;
191 
192 			@Override
193 			public boolean hasNext() {
</pre>
<hr />
<pre>
200 					picked = true;
201 					@SuppressWarnings(&quot;unchecked&quot;)
202 					C calc = aggregator.newItemConsumer((IType&lt;IItem&gt;) item.getType());
203 					calc.consume(item);
204 					return calc;
205 				}
206 				throw new NoSuchElementException();
207 			}
208 
209 			@Override
210 			public void remove() {
211 				throw new UnsupportedOperationException();
212 			}
213 		});
214 	}
215 
216 	@Override
217 	public boolean hasItems() {
218 		return true;
219 	}





220 }
</pre>
</td>
<td>
<hr />
<pre>
 19  * the distribution.
 20  *
 21  * 3. Neither the name of the copyright holder nor the names of its contributors may be used to
 22  * endorse or promote products derived from this software without specific prior written permission.
 23  *
 24  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR
 25  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
 26  * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR
 27  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 28  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 29  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
 30  * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY
 31  * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 32  */
 33 package org.openjdk.jmc.flightrecorder.rules.jdk.util;
 34 
 35 import java.util.ArrayList;
 36 import java.util.Iterator;
 37 import java.util.List;
 38 import java.util.NoSuchElementException;
<span class="line-added"> 39 import java.util.Set;</span>
 40 
 41 import org.openjdk.jmc.common.IPredicate;
 42 import org.openjdk.jmc.common.item.IAggregator;
 43 import org.openjdk.jmc.common.item.IItem;
 44 import org.openjdk.jmc.common.item.IItemCollection;
 45 import org.openjdk.jmc.common.item.IItemConsumer;
 46 import org.openjdk.jmc.common.item.IItemFilter;
 47 import org.openjdk.jmc.common.item.IItemIterable;
 48 import org.openjdk.jmc.common.item.IType;
<span class="line-added"> 49 import org.openjdk.jmc.common.unit.IQuantity;</span>
<span class="line-added"> 50 import org.openjdk.jmc.common.unit.IRange;</span>
 51 
 52 /**
 53  * Implementation helper class for handling a singular {@link IItem} as an {@link IItemCollection}.
 54  */
 55 final class SingleEntryItemCollection implements IItemCollection {
 56 	private static final IItemCollection NULLCOLLECTION = new IItemCollection() {
 57 		@Override
 58 		public Iterator&lt;IItemIterable&gt; iterator() {
 59 			return null;
 60 		}
 61 
 62 		@Override
 63 		public boolean hasItems() {
 64 			return false;
 65 		}
 66 
 67 		@Override
 68 		public &lt;V, C extends IItemConsumer&lt;C&gt;&gt; V getAggregate(IAggregator&lt;V, C&gt; aggregator) {
 69 			return null;
 70 		}
 71 
 72 		@Override
 73 		public IItemCollection apply(IItemFilter filter) {
 74 			return this;
 75 		}
<span class="line-added"> 76 </span>
<span class="line-added"> 77 		@Override</span>
<span class="line-added"> 78 		public Set&lt;IRange&lt;IQuantity&gt;&gt; getChunkRanges() {</span>
<span class="line-added"> 79 			return null;</span>
<span class="line-added"> 80 		}</span>
 81 	};
 82 
 83 	private static final IItemIterable NULLITERABLE = new IItemIterable() {
 84 		@Override
 85 		public Iterator&lt;IItem&gt; iterator() {
 86 			return null;
 87 		}
 88 
 89 		@Override
 90 		public IType&lt;IItem&gt; getType() {
 91 			return null;
 92 		}
 93 
 94 		@Override
 95 		public boolean hasItems() {
 96 			return false;
 97 		}
 98 
 99 		@Override
100 		public long getItemCount() {
</pre>
<hr />
<pre>
159 		@Override
160 		public boolean hasItems() {
161 			return false;
162 		}
163 
164 		@Override
165 		public long getItemCount() {
166 			return 1;
167 		}
168 
169 		@Override
170 		public IItemIterable apply(IPredicate&lt;IItem&gt; predicate) {
171 			if (predicate.evaluate(itemList.get(0))) {
172 				return this;
173 			}
174 			return NULLITERABLE;
175 		}
176 	}
177 
178 	private final IItem item;
<span class="line-added">179 	private final Set&lt;IRange&lt;IQuantity&gt;&gt; chunkRanges;</span>
180 
<span class="line-modified">181 	SingleEntryItemCollection(IItem item, Set&lt;IRange&lt;IQuantity&gt;&gt; chunkRanges) {</span>
182 		this.item = item;
<span class="line-added">183 		this.chunkRanges = chunkRanges;</span>
184 	}
185 
186 	@Override
187 	public Iterator&lt;IItemIterable&gt; iterator() {
188 		return new SingleEntryIteratorOfIterable(item);
189 	}
190 
191 	@SuppressWarnings(&quot;unchecked&quot;)
192 	@Override
193 	public IItemCollection apply(IItemFilter filter) {
194 		return filter.getPredicate((IType&lt;IItem&gt;) item.getType()).evaluate(item) ? this : NULLCOLLECTION;
195 	}
196 
197 	@Override
198 	public &lt;V, C extends IItemConsumer&lt;C&gt;&gt; V getAggregate(final IAggregator&lt;V, C&gt; aggregator) {
199 		return aggregator.getValue(new Iterator&lt;C&gt;() {
200 			boolean picked = false;
201 
202 			@Override
203 			public boolean hasNext() {
</pre>
<hr />
<pre>
210 					picked = true;
211 					@SuppressWarnings(&quot;unchecked&quot;)
212 					C calc = aggregator.newItemConsumer((IType&lt;IItem&gt;) item.getType());
213 					calc.consume(item);
214 					return calc;
215 				}
216 				throw new NoSuchElementException();
217 			}
218 
219 			@Override
220 			public void remove() {
221 				throw new UnsupportedOperationException();
222 			}
223 		});
224 	}
225 
226 	@Override
227 	public boolean hasItems() {
228 		return true;
229 	}
<span class="line-added">230 </span>
<span class="line-added">231 	@Override</span>
<span class="line-added">232 	public Set&lt;IRange&lt;IQuantity&gt;&gt; getChunkRanges() {</span>
<span class="line-added">233 		return chunkRanges;</span>
<span class="line-added">234 	}</span>
235 }
</pre>
</td>
</tr>
</table>
<center><a href="DefaultIItemResultSet.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../../../org.openjdk.jmc.flightrecorder/src/main/java/org/openjdk/jmc/flightrecorder/EventCollection.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>