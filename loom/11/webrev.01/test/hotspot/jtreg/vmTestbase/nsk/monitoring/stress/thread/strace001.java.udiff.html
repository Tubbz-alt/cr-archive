<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/hotspot/jtreg/vmTestbase/nsk/monitoring/stress/thread/strace001.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../share/thread/WaitingThread.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../stress/strace/strace001.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/monitoring/stress/thread/strace001.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -40,10 +40,11 @@</span>
      public static Integer activeThreads;
      private static Log log;
      private static int depth;
      private static int threadCount;
      private static String[] expectedTrace;
<span class="udiff-line-added">+     private static String[] expectedSystemTrace;</span>
      private static ThreadMonitor monitor;
      private static ThreadController controller;
  
      public static void main(String[] argv) {
          System.exit(run(argv, System.out) + Consts.JCK_STATUS_BASE);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -134,39 +135,48 @@</span>
      }
  
      // Fill expectedTrace array according to the invocation type that is set in
      // test options
      private static boolean fillTrace() {
<span class="udiff-line-added">+         expectedSystemTrace = new String[]{</span>
<span class="udiff-line-added">+                 &quot;java.lang.Thread.sleep&quot;,</span>
<span class="udiff-line-added">+                 &quot;java.lang.Thread.sleep0&quot;,</span>
<span class="udiff-line-added">+                 &quot;java.lang.Thread.getVirtualThread&quot;,</span>
<span class="udiff-line-added">+                 &quot;java.lang.Thread.sleepMillis&quot;,</span>
<span class="udiff-line-added">+                 &quot;java.lang.Thread.yield&quot;,</span>
<span class="udiff-line-added">+                 &quot;java.lang.Thread.yield0&quot;,</span>
<span class="udiff-line-added">+                 &quot;java.lang.Thread.currentCarrierThread&quot;,</span>
<span class="udiff-line-added">+                 &quot;java.lang.Thread.currentThread&quot;,</span>
<span class="udiff-line-added">+                 &quot;java.lang.Thread.currentThread0&quot;,</span>
<span class="udiff-line-added">+                 &quot;jdk.internal.event.ThreadSleepEvent.&lt;clinit&gt;&quot;,</span>
<span class="udiff-line-added">+                 &quot;jdk.internal.event.ThreadSleepEvent.isTurnedOn&quot;,</span>
<span class="udiff-line-added">+                 &quot;jdk.internal.event.ThreadSleepEvent.isEnabled&quot;</span>
<span class="udiff-line-added">+         };</span>
<span class="udiff-line-added">+ </span>
          switch (controller.getInvocationType()) {
              case ThreadController.JAVA_TYPE:
<span class="udiff-line-modified-removed">-                 expectedTrace = new String[] {</span>
<span class="udiff-line-modified-removed">-                     &quot;java.lang.Thread.sleep&quot;</span>
<span class="udiff-line-modified-removed">-                     , &quot;java.lang.Thread.yield&quot;</span>
<span class="udiff-line-modified-removed">-                     , THREAD_NAME + &quot;.waitForSign&quot;</span>
<span class="udiff-line-removed">-                     , THREAD_NAME + &quot;.recursionJava&quot;</span>
<span class="udiff-line-removed">-                     , THREAD_NAME + &quot;.run&quot;</span>
<span class="udiff-line-modified-added">+                 expectedTrace = new String[]{</span>
<span class="udiff-line-modified-added">+                         THREAD_NAME + &quot;.waitForSign&quot;,</span>
<span class="udiff-line-modified-added">+                         THREAD_NAME + &quot;.recursionJava&quot;,</span>
<span class="udiff-line-modified-added">+                         THREAD_NAME + &quot;.run&quot;</span>
                  };
                  break;
  
              case ThreadController.NATIVE_TYPE:
<span class="udiff-line-modified-removed">-                 expectedTrace = new String[] {</span>
<span class="udiff-line-modified-removed">-                     &quot;java.lang.Thread.sleep&quot;</span>
<span class="udiff-line-modified-removed">-                     , &quot;java.lang.Thread.yield&quot;</span>
<span class="udiff-line-modified-removed">-                     , THREAD_NAME + &quot;.waitForSign&quot;</span>
<span class="udiff-line-removed">-                     , THREAD_NAME + &quot;.recursionNative&quot;</span>
<span class="udiff-line-removed">-                     , THREAD_NAME + &quot;.run&quot;</span>
<span class="udiff-line-modified-added">+                 expectedTrace = new String[]{</span>
<span class="udiff-line-modified-added">+                         THREAD_NAME + &quot;.waitForSign&quot;,</span>
<span class="udiff-line-modified-added">+                         THREAD_NAME + &quot;.recursionNative&quot;,</span>
<span class="udiff-line-modified-added">+                         THREAD_NAME + &quot;.run&quot;</span>
                  };
                  break;
  
              case ThreadController.MIXED_TYPE:
<span class="udiff-line-modified-removed">-                 expectedTrace = new String[] {</span>
<span class="udiff-line-modified-removed">-                     &quot;java.lang.Thread.sleep&quot;</span>
<span class="udiff-line-modified-removed">-                     , &quot;java.lang.Thread.yield&quot;</span>
<span class="udiff-line-modified-removed">-                     , THREAD_NAME + &quot;.waitForSign&quot;</span>
<span class="udiff-line-modified-removed">-                     , THREAD_NAME + &quot;.recursionNative&quot;</span>
<span class="udiff-line-removed">-                     , THREAD_NAME + &quot;.recursionJava&quot;</span>
<span class="udiff-line-removed">-                     , THREAD_NAME + &quot;.run&quot;</span>
<span class="udiff-line-modified-added">+                 expectedTrace = new String[]{</span>
<span class="udiff-line-modified-added">+                         THREAD_NAME + &quot;.waitForSign&quot;,</span>
<span class="udiff-line-modified-added">+                         THREAD_NAME + &quot;.recursionNative&quot;,</span>
<span class="udiff-line-modified-added">+                         THREAD_NAME + &quot;.recursionJava&quot;,</span>
<span class="udiff-line-modified-added">+                         THREAD_NAME + &quot;.run&quot;</span>
                  };
                  break;
  
              default:
                  return false;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -191,11 +201,11 @@</span>
      }
  
      // The method performs checks of the stack trace
      private static boolean checkTrace(StackTraceElement[] elements) {
          int length = elements.length;
<span class="udiff-line-modified-removed">-         int expectedLength = depth +3;</span>
<span class="udiff-line-modified-added">+         int expectedLength = depth + 5;</span>
          boolean result = true;
  
          // Check the length of the trace. It must not be greater than
          // expectedLength. Number of recursionJava() or recursionNative()
          // methods must not ne greater than depth, also one Object.wait() or
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -233,10 +243,16 @@</span>
          for (int i = 0; i &lt; expectedTrace.length - 1; i++) {
              if (expectedTrace[i].equals(name))
                  return true;
          }
  
<span class="udiff-line-added">+         // Implementation of sleep/wait/yield</span>
<span class="udiff-line-added">+         for (int i = 0; i &lt; expectedSystemTrace.length; i++) {</span>
<span class="udiff-line-added">+             if (expectedSystemTrace[i].equals(name))</span>
<span class="udiff-line-added">+                 return true;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
          log.complain(&quot;Unexpected &quot; + n + &quot; element of the stack trace:\n\t&quot;
                     + name);
          return false;
      }
  
</pre>
<center><a href="../../share/thread/WaitingThread.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../stress/strace/strace001.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>