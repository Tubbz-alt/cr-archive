<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/macosx/native/libawt_lwawt/java2d/metal/MTLTextRenderer.m</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>src/java.desktop/macosx/native/libawt_lwawt/java2d/metal/MTLTextRenderer.m</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 247,34 ***</span>
   * Adds the given glyph to the glyph cache (texture and data structure)
   * associated with the given MTLContext.
   */
  static void
  MTLTR_AddToGlyphCache(GlyphInfo *glyph, MTLContext *mtlc,
<span class="line-modified">!                       MTLPixelFormat pixelFormat)</span>
  {
      MTLCacheCellInfo *ccinfo;
      MTLGlyphCacheInfo *gcinfo;
<span class="line-removed">-     jboolean isLCD = JNI_FALSE;</span>
      jint w = glyph-&gt;width;
      jint h = glyph-&gt;height;
  
      J2dTraceLn(J2D_TRACE_INFO, &quot;MTLTR_AddToGlyphCache&quot;);
<span class="line-modified">!     if (pixelFormat == MTLPixelFormatA8Unorm) {</span>
          gcinfo = glyphCacheAA;
      } else {
          gcinfo = glyphCacheLCD;
<span class="line-removed">-         isLCD = JNI_TRUE;</span>
      }
  
      if ((gcinfo == NULL) || (glyph-&gt;image == NULL)) {
          return;
      }
  
      bool isCacheFull = MTLGlyphCache_IsCacheFull(gcinfo, glyph);
      if (isCacheFull) {
          MTLGlyphCache_Free(gcinfo);
<span class="line-modified">!         if (!isLCD) {</span>
              MTLTR_InitGlyphCache(mtlc, JNI_FALSE);
              gcinfo = glyphCacheAA;
          } else {
              MTLTR_InitGlyphCache(mtlc, JNI_TRUE);
              gcinfo = glyphCacheLCD;
<span class="line-new-header">--- 247,32 ---</span>
   * Adds the given glyph to the glyph cache (texture and data structure)
   * associated with the given MTLContext.
   */
  static void
  MTLTR_AddToGlyphCache(GlyphInfo *glyph, MTLContext *mtlc,
<span class="line-modified">!                       jboolean lcdCache)</span>
  {
      MTLCacheCellInfo *ccinfo;
      MTLGlyphCacheInfo *gcinfo;
      jint w = glyph-&gt;width;
      jint h = glyph-&gt;height;
  
      J2dTraceLn(J2D_TRACE_INFO, &quot;MTLTR_AddToGlyphCache&quot;);
<span class="line-modified">!     if (!lcdCache) {</span>
          gcinfo = glyphCacheAA;
      } else {
          gcinfo = glyphCacheLCD;
      }
  
      if ((gcinfo == NULL) || (glyph-&gt;image == NULL)) {
          return;
      }
  
      bool isCacheFull = MTLGlyphCache_IsCacheFull(gcinfo, glyph);
      if (isCacheFull) {
          MTLGlyphCache_Free(gcinfo);
<span class="line-modified">!         if (!lcdCache) {</span>
              MTLTR_InitGlyphCache(mtlc, JNI_FALSE);
              gcinfo = glyphCacheAA;
          } else {
              MTLTR_InitGlyphCache(mtlc, JNI_TRUE);
              gcinfo = glyphCacheLCD;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 287,11 ***</span>
          // store glyph image in texture cell
          MTLRegion region = {
                  {ccinfo-&gt;x,  ccinfo-&gt;y,   0},
                  {w, h, 1}
          };
<span class="line-modified">!         if (!isLCD) {</span>
              // Opengl uses GL_INTENSITY as internal pixel format to set number of
              // color components in the texture for grayscale texture.
              // It is mentioned that for GL_INTENSITY format,
              // the GL assembles it into an RGBA element by replicating the
              // intensity value three times for red, green, blue, and alpha.
<span class="line-new-header">--- 285,11 ---</span>
          // store glyph image in texture cell
          MTLRegion region = {
                  {ccinfo-&gt;x,  ccinfo-&gt;y,   0},
                  {w, h, 1}
          };
<span class="line-modified">!         if (!lcdCache) {</span>
              // Opengl uses GL_INTENSITY as internal pixel format to set number of
              // color components in the texture for grayscale texture.
              // It is mentioned that for GL_INTENSITY format,
              // the GL assembles it into an RGBA element by replicating the
              // intensity value three times for red, green, blue, and alpha.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 551,11 ***</span>
          glyphMode = MODE_USE_CACHE_GRAY;
      }
  
      if (ginfo-&gt;cellInfo == NULL) {
          // attempt to add glyph to accelerated glyph cache
<span class="line-modified">!         MTLTR_AddToGlyphCache(ginfo, mtlc, MTLPixelFormatA8Unorm);</span>
  
          if (ginfo-&gt;cellInfo == NULL) {
              // we&#39;ll just no-op in the rare case that the cell is NULL
              return JNI_TRUE;
          }
<span class="line-new-header">--- 549,11 ---</span>
          glyphMode = MODE_USE_CACHE_GRAY;
      }
  
      if (ginfo-&gt;cellInfo == NULL) {
          // attempt to add glyph to accelerated glyph cache
<span class="line-modified">!         MTLTR_AddToGlyphCache(ginfo, mtlc, JNI_FALSE);</span>
  
          if (ginfo-&gt;cellInfo == NULL) {
              // we&#39;ll just no-op in the rare case that the cell is NULL
              return JNI_TRUE;
          }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 647,11 ***</span>
      }
  
      if (ginfo-&gt;cellInfo == NULL) {
          // attempt to add glyph to accelerated glyph cache
          // TODO : Handle RGB order
<span class="line-modified">!         MTLTR_AddToGlyphCache(ginfo, mtlc, MTLPixelFormatRGBA8Unorm);</span>
  
          if (ginfo-&gt;cellInfo == NULL) {
              // we&#39;ll just no-op in the rare case that the cell is NULL
              return JNI_TRUE;
          }
<span class="line-new-header">--- 645,11 ---</span>
      }
  
      if (ginfo-&gt;cellInfo == NULL) {
          // attempt to add glyph to accelerated glyph cache
          // TODO : Handle RGB order
<span class="line-modified">!         MTLTR_AddToGlyphCache(ginfo, mtlc, JNI_TRUE);</span>
  
          if (ginfo-&gt;cellInfo == NULL) {
              // we&#39;ll just no-op in the rare case that the cell is NULL
              return JNI_TRUE;
          }
</pre>
<center>&lt; prev <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>