<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/jdk/jshell/VariablesTest.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="ToolSimpleTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../../lib/combo/tools/javac/combo/CompilationTestCase.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/jdk/jshell/VariablesTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8144903 8177466 8191842 8211694 8213725</span>
 27  * @summary Tests for EvaluationState.variables
 28  * @library /tools/lib
 29  * @modules jdk.compiler/com.sun.tools.javac.api
 30  *          jdk.compiler/com.sun.tools.javac.main
 31  *          jdk.jshell
 32  * @build Compiler KullaTesting TestingInputStream ExpectedDiagnostic
 33  * @run testng VariablesTest
 34  */
 35 
 36 import java.nio.file.Path;
 37 import java.nio.file.Paths;
 38 import java.util.List;
 39 import javax.tools.Diagnostic;
 40 
 41 import jdk.jshell.Snippet;
 42 import jdk.jshell.TypeDeclSnippet;
 43 import jdk.jshell.VarSnippet;
 44 import jdk.jshell.Snippet.SubKind;
 45 import jdk.jshell.SnippetEvent;
 46 import org.testng.annotations.BeforeMethod;
</pre>
<hr />
<pre>
449         assertEval(v2.name() + &quot;.i&quot;, &quot;42&quot;);
450         assertEval(v2.name() + &quot;.i2&quot;, &quot;42&quot;);
451         assertEval(v2.name() + &quot;.m2()&quot;, &quot;42&quot;);
452         assertDeclareFail(v2.name() + &quot;.i1&quot;,
453                           new ExpectedDiagnostic(&quot;compiler.err.cant.resolve.location&quot;, 0, 5, 2,
454                                                  -1, -1, Diagnostic.Kind.ERROR));
455     }
456 
457     public void displayName() {
458         assertVarDisplayName(&quot;var v1 = 234;&quot;, &quot;int&quot;);
459         assertVarDisplayName(&quot;var v2 = new int[] {234};&quot;, &quot;int[]&quot;);
460         assertEval(&quot;&lt;Z extends Runnable &amp; CharSequence&gt; Z get() { return null; }&quot;, added(VALID));
461         assertVarDisplayName(&quot;var v3 = get();&quot;, &quot;CharSequence&amp;Runnable&quot;);
462         assertVarDisplayName(&quot;var v4a = new java.util.ArrayList&lt;String&gt;();&quot;, &quot;java.util.ArrayList&lt;String&gt;&quot;);
463         assertEval(&quot;v4a.add(\&quot;a\&quot;);&quot;);
464         assertVarDisplayName(&quot;var v4b = v4a.get(0);&quot;, &quot;String&quot;);
465         assertVarDisplayName(&quot;var v5 = new Object() { };&quot;, &quot;&lt;anonymous class extending Object&gt;&quot;);
466         assertVarDisplayName(&quot;var v6 = new Runnable() { public void run() { } };&quot;, &quot;&lt;anonymous class implementing Runnable&gt;&quot;);
467     }
468 









469     public void varDeclNoInit() {
470         assertVarDeclNoInit(&quot;byte&quot;, &quot;b&quot;,  &quot;0&quot;);
471         assertVarDeclNoInit(&quot;short&quot;, &quot;h&quot;,  &quot;0&quot;);
472         assertVarDeclNoInit(&quot;int&quot;, &quot;i&quot;,  &quot;0&quot;);
473         assertVarDeclNoInit(&quot;long&quot;, &quot;l&quot;,  &quot;0&quot;);
474         assertVarDeclNoInit(&quot;float&quot;, &quot;f&quot;,  &quot;0.0&quot;);
475         assertVarDeclNoInit(&quot;double&quot;, &quot;d&quot;,  &quot;0.0&quot;);
476         assertVarDeclNoInit(&quot;boolean&quot;, &quot;n&quot;,  &quot;false&quot;);
477         assertVarDeclNoInit(&quot;char&quot;, &quot;c&quot;,  &quot;&#39;\\000&#39;&quot;);
478         assertVarDeclNoInit(&quot;Object&quot;, &quot;o&quot;,  &quot;null&quot;);
479         assertVarDeclNoInit(&quot;String&quot;, &quot;s&quot;, &quot;null&quot;);
480     }
481 
482     public void varDeclRedefNoInit() {
483         assertVarDeclRedefNoInit(&quot;byte&quot;, &quot;b&quot;, &quot;1&quot;, &quot;0&quot;);
484         assertVarDeclRedefNoInit(&quot;short&quot;, &quot;h&quot;, &quot;2&quot;, &quot;0&quot;);
485         assertVarDeclRedefNoInit(&quot;int&quot;, &quot;i&quot;, &quot;3&quot;, &quot;0&quot;);
486         assertVarDeclRedefNoInit(&quot;long&quot;, &quot;l&quot;, &quot;4L&quot;, IGNORE_VALUE, &quot;0&quot;);
487         assertVarDeclRedefNoInit(&quot;float&quot;, &quot;f&quot;, &quot;3.14f&quot;, IGNORE_VALUE, &quot;0.0&quot;);
488         assertVarDeclRedefNoInit(&quot;double&quot;, &quot;d&quot;, &quot;3.1415926&quot;, &quot;0.0&quot;);
</pre>
<hr />
<pre>
562                 &quot;       this.s = \&quot;empty\&quot;;\n&quot; +
563                 &quot;       this.l = l;\n&quot; +
564                 &quot;   }\n&quot; +
565                 &quot;}\n&quot;,
566                 &quot;package api;\n&quot; +
567                 &quot;\n&quot; +
568                 &quot;import java.util.List;\n&quot; +
569                 &quot;\n&quot; +
570                 &quot;public class G&lt;T&gt; {\n&quot; +
571                 &quot;   public List&lt;T&gt; l;\n&quot; +
572                 &quot;   public G(List&lt;T&gt; l) {\n&quot; +
573                 &quot;       this.l = l;\n&quot; +
574                 &quot;   }\n&quot; +
575                 &quot;}\n&quot;,
576                 &quot;package api;\n&quot; +
577                 &quot;\n&quot; +
578                 &quot;import java.util.List;\n&quot; +
579                 &quot;\n&quot; +
580                 &quot;public interface J&lt;T&gt; {\n&quot; +
581                 &quot;   public List&lt;T&gt; get();\n&quot; +




582                 &quot;}\n&quot;);
583         String tpath = compiler.getPath(path).toString();
584         setUp(b -&gt; b
585                 .remoteVMOptions(&quot;--class-path&quot;, tpath)
586                 .compilerOptions(&quot;--class-path&quot;, tpath));
587     }
588 }
</pre>
</td>
<td>
<hr />
<pre>
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8144903 8177466 8191842 8211694 8213725 8239536</span>
 27  * @summary Tests for EvaluationState.variables
 28  * @library /tools/lib
 29  * @modules jdk.compiler/com.sun.tools.javac.api
 30  *          jdk.compiler/com.sun.tools.javac.main
 31  *          jdk.jshell
 32  * @build Compiler KullaTesting TestingInputStream ExpectedDiagnostic
 33  * @run testng VariablesTest
 34  */
 35 
 36 import java.nio.file.Path;
 37 import java.nio.file.Paths;
 38 import java.util.List;
 39 import javax.tools.Diagnostic;
 40 
 41 import jdk.jshell.Snippet;
 42 import jdk.jshell.TypeDeclSnippet;
 43 import jdk.jshell.VarSnippet;
 44 import jdk.jshell.Snippet.SubKind;
 45 import jdk.jshell.SnippetEvent;
 46 import org.testng.annotations.BeforeMethod;
</pre>
<hr />
<pre>
449         assertEval(v2.name() + &quot;.i&quot;, &quot;42&quot;);
450         assertEval(v2.name() + &quot;.i2&quot;, &quot;42&quot;);
451         assertEval(v2.name() + &quot;.m2()&quot;, &quot;42&quot;);
452         assertDeclareFail(v2.name() + &quot;.i1&quot;,
453                           new ExpectedDiagnostic(&quot;compiler.err.cant.resolve.location&quot;, 0, 5, 2,
454                                                  -1, -1, Diagnostic.Kind.ERROR));
455     }
456 
457     public void displayName() {
458         assertVarDisplayName(&quot;var v1 = 234;&quot;, &quot;int&quot;);
459         assertVarDisplayName(&quot;var v2 = new int[] {234};&quot;, &quot;int[]&quot;);
460         assertEval(&quot;&lt;Z extends Runnable &amp; CharSequence&gt; Z get() { return null; }&quot;, added(VALID));
461         assertVarDisplayName(&quot;var v3 = get();&quot;, &quot;CharSequence&amp;Runnable&quot;);
462         assertVarDisplayName(&quot;var v4a = new java.util.ArrayList&lt;String&gt;();&quot;, &quot;java.util.ArrayList&lt;String&gt;&quot;);
463         assertEval(&quot;v4a.add(\&quot;a\&quot;);&quot;);
464         assertVarDisplayName(&quot;var v4b = v4a.get(0);&quot;, &quot;String&quot;);
465         assertVarDisplayName(&quot;var v5 = new Object() { };&quot;, &quot;&lt;anonymous class extending Object&gt;&quot;);
466         assertVarDisplayName(&quot;var v6 = new Runnable() { public void run() { } };&quot;, &quot;&lt;anonymous class implementing Runnable&gt;&quot;);
467     }
468 
<span class="line-added">469     public void varType() {</span>
<span class="line-added">470         assertEval(&quot;import java.util.*;&quot;);</span>
<span class="line-added">471         var firstVar = varKey(assertEval(&quot;var v1 = List.of(1);&quot;, added(VALID)));</span>
<span class="line-added">472         assertEval(&quot;import list.List;&quot;, DiagCheck.DIAG_OK, DiagCheck.DIAG_ERROR, added(VALID),</span>
<span class="line-added">473                                         ste(firstVar, VALID, RECOVERABLE_NOT_DEFINED, true, MAIN_SNIPPET));</span>
<span class="line-added">474         assertEval(&quot;var v2 = java.util.List.of(1);&quot;, added(VALID));</span>
<span class="line-added">475         assertEval(&quot;v2&quot;, &quot;[1]&quot;);</span>
<span class="line-added">476     }</span>
<span class="line-added">477 </span>
478     public void varDeclNoInit() {
479         assertVarDeclNoInit(&quot;byte&quot;, &quot;b&quot;,  &quot;0&quot;);
480         assertVarDeclNoInit(&quot;short&quot;, &quot;h&quot;,  &quot;0&quot;);
481         assertVarDeclNoInit(&quot;int&quot;, &quot;i&quot;,  &quot;0&quot;);
482         assertVarDeclNoInit(&quot;long&quot;, &quot;l&quot;,  &quot;0&quot;);
483         assertVarDeclNoInit(&quot;float&quot;, &quot;f&quot;,  &quot;0.0&quot;);
484         assertVarDeclNoInit(&quot;double&quot;, &quot;d&quot;,  &quot;0.0&quot;);
485         assertVarDeclNoInit(&quot;boolean&quot;, &quot;n&quot;,  &quot;false&quot;);
486         assertVarDeclNoInit(&quot;char&quot;, &quot;c&quot;,  &quot;&#39;\\000&#39;&quot;);
487         assertVarDeclNoInit(&quot;Object&quot;, &quot;o&quot;,  &quot;null&quot;);
488         assertVarDeclNoInit(&quot;String&quot;, &quot;s&quot;, &quot;null&quot;);
489     }
490 
491     public void varDeclRedefNoInit() {
492         assertVarDeclRedefNoInit(&quot;byte&quot;, &quot;b&quot;, &quot;1&quot;, &quot;0&quot;);
493         assertVarDeclRedefNoInit(&quot;short&quot;, &quot;h&quot;, &quot;2&quot;, &quot;0&quot;);
494         assertVarDeclRedefNoInit(&quot;int&quot;, &quot;i&quot;, &quot;3&quot;, &quot;0&quot;);
495         assertVarDeclRedefNoInit(&quot;long&quot;, &quot;l&quot;, &quot;4L&quot;, IGNORE_VALUE, &quot;0&quot;);
496         assertVarDeclRedefNoInit(&quot;float&quot;, &quot;f&quot;, &quot;3.14f&quot;, IGNORE_VALUE, &quot;0.0&quot;);
497         assertVarDeclRedefNoInit(&quot;double&quot;, &quot;d&quot;, &quot;3.1415926&quot;, &quot;0.0&quot;);
</pre>
<hr />
<pre>
571                 &quot;       this.s = \&quot;empty\&quot;;\n&quot; +
572                 &quot;       this.l = l;\n&quot; +
573                 &quot;   }\n&quot; +
574                 &quot;}\n&quot;,
575                 &quot;package api;\n&quot; +
576                 &quot;\n&quot; +
577                 &quot;import java.util.List;\n&quot; +
578                 &quot;\n&quot; +
579                 &quot;public class G&lt;T&gt; {\n&quot; +
580                 &quot;   public List&lt;T&gt; l;\n&quot; +
581                 &quot;   public G(List&lt;T&gt; l) {\n&quot; +
582                 &quot;       this.l = l;\n&quot; +
583                 &quot;   }\n&quot; +
584                 &quot;}\n&quot;,
585                 &quot;package api;\n&quot; +
586                 &quot;\n&quot; +
587                 &quot;import java.util.List;\n&quot; +
588                 &quot;\n&quot; +
589                 &quot;public interface J&lt;T&gt; {\n&quot; +
590                 &quot;   public List&lt;T&gt; get();\n&quot; +
<span class="line-added">591                 &quot;}\n&quot;,</span>
<span class="line-added">592                 &quot;package list;\n&quot; +</span>
<span class="line-added">593                 &quot;\n&quot; +</span>
<span class="line-added">594                 &quot;public class List {\n&quot; +</span>
595                 &quot;}\n&quot;);
596         String tpath = compiler.getPath(path).toString();
597         setUp(b -&gt; b
598                 .remoteVMOptions(&quot;--class-path&quot;, tpath)
599                 .compilerOptions(&quot;--class-path&quot;, tpath));
600     }
601 }
</pre>
</td>
</tr>
</table>
<center><a href="ToolSimpleTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../../lib/combo/tools/javac/combo/CompilationTestCase.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>