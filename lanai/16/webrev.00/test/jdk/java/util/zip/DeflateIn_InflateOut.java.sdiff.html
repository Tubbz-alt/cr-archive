<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/util/zip/DeflateIn_InflateOut.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../regex/RegExTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../javax/management/loading/MletParserLocaleTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/util/zip/DeflateIn_InflateOut.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2006, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 25  * @test
 26  * @bug 4679743
 27  * @summary Test basic functionality of DeflaterInputStream and InflaterOutputStream
 28  * @key randomness
 29  */
 30 
 31 import java.io.*;
 32 import java.util.*;
 33 import java.util.zip.*;
 34 
 35 public class DeflateIn_InflateOut {
 36     private static byte[] data = new byte[1024 * 1024];
 37 
 38     private static ByteArrayInputStream bais;
 39     private static DeflaterInputStream dis;
 40 
 41     private static ByteArrayOutputStream baos;
 42     private static InflaterOutputStream ios;
 43 
 44     private static void reset() {
<span class="line-removed"> 45         new Random(new Date().getTime()).nextBytes(data);</span>
<span class="line-removed"> 46 </span>
 47         bais = new ByteArrayInputStream(data);
 48         dis = new DeflaterInputStream(bais);
 49 
 50         baos = new ByteArrayOutputStream();
 51         ios = new InflaterOutputStream(baos);
 52     }
 53 
 54     /** Check byte arrays read/write. */
 55     private static void ArrayReadWrite() throws Throwable {
 56         byte[] buf = new byte[512];
 57 
 58         reset();
 59         check(dis.available() == 1);
 60         for (;;) {
 61             int len = dis.read(buf, 0, buf.length);
 62             if (len &lt; 0) {
 63                 break;
 64             } else {
 65                 ios.write(buf, 0, len);
 66             }
</pre>
<hr />
<pre>
201         for (int i = 0; ; i++) {
202             if (numNotSkipped + numSkipBytes &gt; numReadable) {
203                 numSkipBytes = numReadable - numNotSkipped;
204                 check(dis.skip(numSkipBytes) == numSkipBytes);
205                 check(dis.read(buf, 0, buf.length) == -1);
206                 check(dis.available() == 0);
207             } else {
208                 int count = dis.read(buf, 0, buf.length);
209                 if (count &lt; 0) {
210                     break;
211                 } else {
212                     numNotSkipped += count;
213                 }
214             }
215         }
216         check(numNotSkipped + numSkipBytes == numReadable);
217     }
218 
219 
220     public static void realMain(String[] args) throws Throwable {


221         ArrayReadWrite();
222 
223         ArrayReadByteWrite();
224 
225         ByteReadArrayWrite();
226 
227         ByteReadByteWrite();
228 
229         SkipBytes();
230     }
231 
232     //--------------------- Infrastructure ---------------------------
233     static volatile int passed = 0, failed = 0;
234     static void pass() {passed++;}
235     static void fail() {failed++; Thread.dumpStack();}
236     static void fail(String msg) {System.out.println(msg); fail();}
237     static void unexpected(Throwable t) {failed++; t.printStackTrace();}
238     static void check(boolean cond) {if (cond) pass(); else fail();}
239     static void equal(Object x, Object y) {
240         if (x == null ? y == null : x.equals(y)) pass();
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2006, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 25  * @test
 26  * @bug 4679743
 27  * @summary Test basic functionality of DeflaterInputStream and InflaterOutputStream
 28  * @key randomness
 29  */
 30 
 31 import java.io.*;
 32 import java.util.*;
 33 import java.util.zip.*;
 34 
 35 public class DeflateIn_InflateOut {
 36     private static byte[] data = new byte[1024 * 1024];
 37 
 38     private static ByteArrayInputStream bais;
 39     private static DeflaterInputStream dis;
 40 
 41     private static ByteArrayOutputStream baos;
 42     private static InflaterOutputStream ios;
 43 
 44     private static void reset() {


 45         bais = new ByteArrayInputStream(data);
 46         dis = new DeflaterInputStream(bais);
 47 
 48         baos = new ByteArrayOutputStream();
 49         ios = new InflaterOutputStream(baos);
 50     }
 51 
 52     /** Check byte arrays read/write. */
 53     private static void ArrayReadWrite() throws Throwable {
 54         byte[] buf = new byte[512];
 55 
 56         reset();
 57         check(dis.available() == 1);
 58         for (;;) {
 59             int len = dis.read(buf, 0, buf.length);
 60             if (len &lt; 0) {
 61                 break;
 62             } else {
 63                 ios.write(buf, 0, len);
 64             }
</pre>
<hr />
<pre>
199         for (int i = 0; ; i++) {
200             if (numNotSkipped + numSkipBytes &gt; numReadable) {
201                 numSkipBytes = numReadable - numNotSkipped;
202                 check(dis.skip(numSkipBytes) == numSkipBytes);
203                 check(dis.read(buf, 0, buf.length) == -1);
204                 check(dis.available() == 0);
205             } else {
206                 int count = dis.read(buf, 0, buf.length);
207                 if (count &lt; 0) {
208                     break;
209                 } else {
210                     numNotSkipped += count;
211                 }
212             }
213         }
214         check(numNotSkipped + numSkipBytes == numReadable);
215     }
216 
217 
218     public static void realMain(String[] args) throws Throwable {
<span class="line-added">219         new Random(new Date().getTime()).nextBytes(data);</span>
<span class="line-added">220 </span>
221         ArrayReadWrite();
222 
223         ArrayReadByteWrite();
224 
225         ByteReadArrayWrite();
226 
227         ByteReadByteWrite();
228 
229         SkipBytes();
230     }
231 
232     //--------------------- Infrastructure ---------------------------
233     static volatile int passed = 0, failed = 0;
234     static void pass() {passed++;}
235     static void fail() {failed++; Thread.dumpStack();}
236     static void fail(String msg) {System.out.println(msg); fail();}
237     static void unexpected(Throwable t) {failed++; t.printStackTrace();}
238     static void check(boolean cond) {if (cond) pass(); else fail();}
239     static void equal(Object x, Object y) {
240         if (x == null ? y == null : x.equals(y)) pass();
</pre>
</td>
</tr>
</table>
<center><a href="../regex/RegExTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../javax/management/loading/MletParserLocaleTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>