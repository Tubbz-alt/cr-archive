diff a/test/jdk/sun/tools/jhsdb/HeapDumpTest.java b/test/jdk/sun/tools/jhsdb/HeapDumpTest.java
--- a/test/jdk/sun/tools/jhsdb/HeapDumpTest.java
+++ b/test/jdk/sun/tools/jhsdb/HeapDumpTest.java
@@ -23,11 +23,11 @@
 
 /**
  * @test
  * @bug 8163346
  * @summary Test hashing of extended characters in Serviceability Agent.
- * @requires vm.hasSAandCanAttach
+ * @requires vm.hasSA
  * @library /test/lib
  * @compile -encoding utf8 HeapDumpTest.java
  * @run main/timeout=240 HeapDumpTest
  */
 
@@ -36,16 +36,16 @@
 import java.io.IOException;
 import java.io.File;
 import java.util.List;
 import java.util.Arrays;
 
-import jdk.test.lib.Platform;
+import jdk.test.lib.apps.LingeredApp;
+import jdk.test.lib.hprof.parser.HprofReader;
 import jdk.test.lib.JDKToolLauncher;
 import jdk.test.lib.process.OutputAnalyzer;
 import jdk.test.lib.process.ProcessTools;
-import jdk.test.lib.apps.LingeredApp;
-import jdk.test.lib.hprof.parser.HprofReader;
+import jdk.test.lib.SA.SATestUtils;
 
 public class HeapDumpTest {
 
     private static LingeredAppWithExtendedChars theApp = null;
 
@@ -70,11 +70,11 @@
                 launcher.addToolArg(cmd);
             }
 
             launcher.addToolArg("--pid=" + Long.toString(theApp.getPid()));
 
-            ProcessBuilder processBuilder = new ProcessBuilder(launcher.getCommand());
+            ProcessBuilder processBuilder = SATestUtils.createProcessBuilder(launcher);
             processBuilder.redirectError(ProcessBuilder.Redirect.INHERIT);
             OutputAnalyzer output = ProcessTools.executeProcess(processBuilder);
             System.out.println("stdout:");
             System.out.println(output.getStdout());
             System.out.println("stderr:");
@@ -123,11 +123,11 @@
 
         dump.delete();
     }
 
     public static void main(String[] args) throws Exception {
-
+        SATestUtils.skipIfCannotAttach(); // throws SkippedException if attach not expected to work.
         testHeapDump();
 
         // The test throws RuntimeException on error.
         // IOException is thrown if LingeredApp can't start because of some bad
         // environment condition
