<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.core.test/src/org/graalvm/compiler/core/test/ea/PartialEscapeUnsafeStoreTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="PartialEscapeAnalysisTreesTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="TrufflePEATest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.core.test/src/org/graalvm/compiler/core/test/ea/PartialEscapeUnsafeStoreTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2016, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
  23 
  24 
  25 package org.graalvm.compiler.core.test.ea;
  26 
<span class="line-removed">  27 import java.lang.reflect.Field;</span>
<span class="line-removed">  28 </span>
  29 import org.graalvm.compiler.core.test.GraalCompilerTest;
  30 import org.junit.Test;
  31 
<span class="line-removed">  32 import sun.misc.Unsafe;</span>
<span class="line-removed">  33 </span>
  34 /**
  35  * Exercise a mix of unsafe and normal reads ands writes in situations where EA might attempt to
  36  * fold the operations.
  37  */
  38 public class PartialEscapeUnsafeStoreTest extends GraalCompilerTest {
  39 
<span class="line-modified">  40     private static final Unsafe unsafe = initUnsafe();</span>
<span class="line-removed">  41 </span>
<span class="line-removed">  42     private static Unsafe initUnsafe() {</span>
<span class="line-removed">  43         try {</span>
<span class="line-removed">  44             Field theUnsafe = Unsafe.class.getDeclaredField(&quot;theUnsafe&quot;);</span>
<span class="line-removed">  45             theUnsafe.setAccessible(true);</span>
<span class="line-removed">  46             return (Unsafe) theUnsafe.get(Unsafe.class);</span>
<span class="line-removed">  47         } catch (Exception e) {</span>
<span class="line-removed">  48             throw new RuntimeException(&quot;exception while trying to get Unsafe&quot;, e);</span>
<span class="line-removed">  49         }</span>
<span class="line-removed">  50     }</span>
<span class="line-removed">  51 </span>
<span class="line-removed">  52     private static final long byteArrayBaseOffset = unsafe.arrayBaseOffset(byte[].class);</span>
  53     private static byte byteValue = 0x61;
  54 
  55     public static byte[] testByteArrayWithCharStoreSnippet(char v) {
  56         byte[] b = new byte[8];
<span class="line-modified">  57         unsafe.putChar(b, byteArrayBaseOffset, v);</span>
  58         return b;
  59     }
  60 
  61     @Test
  62     public void testByteArrayWithCharStore() {
  63         test(&quot;testByteArrayWithCharStoreSnippet&quot;, charValue);
  64     }
  65 
  66     public static byte[] testByteArrayWithShortStoreSnippet(short v) {
  67         byte[] b = new byte[8];
<span class="line-modified">  68         unsafe.putShort(b, byteArrayBaseOffset, v);</span>
  69         return b;
  70     }
  71 
  72     @Test
  73     public void testByteArrayWithShortStore() {
  74         test(&quot;testByteArrayWithShortStoreSnippet&quot;, shortValue);
  75     }
  76 
  77     public static byte[] testByteArrayWithIntStoreSnippet(int v) {
  78         byte[] b = new byte[8];
<span class="line-modified">  79         unsafe.putInt(b, byteArrayBaseOffset, v);</span>
  80         return b;
  81     }
  82 
  83     @Test
  84     public void testByteArrayWithIntStore() {
  85         test(&quot;testByteArrayWithIntStoreSnippet&quot;, intValue);
  86     }
  87 
  88     public static byte[] testByteArrayWithLongStoreSnippet(long v) {
  89         byte[] b = new byte[8];
<span class="line-modified">  90         unsafe.putLong(b, byteArrayBaseOffset, v);</span>
  91         return b;
  92     }
  93 
  94     @Test
  95     public void testByteArrayWithLongStore() {
  96         test(&quot;testByteArrayWithLongStoreSnippet&quot;, longValue);
  97     }
  98 
  99     public static byte[] testByteArrayWithFloatStoreSnippet(float v) {
 100         byte[] b = new byte[8];
<span class="line-modified"> 101         unsafe.putFloat(b, byteArrayBaseOffset, v);</span>
 102         return b;
 103     }
 104 
 105     @Test
 106     public void testByteArrayWithFloatStore() {
 107         test(&quot;testByteArrayWithFloatStoreSnippet&quot;, floatValue);
 108     }
 109 
 110     public static byte[] testByteArrayWithDoubleStoreSnippet(double v) {
 111         byte[] b = new byte[8];
<span class="line-modified"> 112         unsafe.putDouble(b, byteArrayBaseOffset, v);</span>
 113         return b;
 114     }
 115 
 116     @Test
 117     public void testByteArrayWithDoubleStore() {
 118         test(&quot;testByteArrayWithDoubleStoreSnippet&quot;, doubleValue);
 119     }
 120 
<span class="line-modified"> 121     private static final long charArrayBaseOffset = unsafe.arrayBaseOffset(char[].class);</span>
 122     private static char charValue = 0x4142;
 123 
 124     public static char[] testCharArrayWithByteStoreSnippet(byte v) {
 125         char[] b = new char[4];
<span class="line-modified"> 126         unsafe.putByte(b, charArrayBaseOffset, v);</span>
 127         return b;
 128     }
 129 
 130     @Test
 131     public void testCharArrayWithByteStore() {
 132         test(&quot;testCharArrayWithByteStoreSnippet&quot;, byteValue);
 133     }
 134 
 135     public static char[] testCharArrayWithShortStoreSnippet(short v) {
 136         char[] b = new char[4];
<span class="line-modified"> 137         unsafe.putShort(b, charArrayBaseOffset, v);</span>
 138         return b;
 139     }
 140 
 141     @Test
 142     public void testCharArrayWithShortStore() {
 143         test(&quot;testCharArrayWithShortStoreSnippet&quot;, shortValue);
 144     }
 145 
 146     public static char[] testCharArrayWithIntStoreSnippet(int v) {
 147         char[] b = new char[4];
<span class="line-modified"> 148         unsafe.putInt(b, charArrayBaseOffset, v);</span>
 149         return b;
 150     }
 151 
 152     @Test
 153     public void testCharArrayWithIntStore() {
 154         test(&quot;testCharArrayWithIntStoreSnippet&quot;, intValue);
 155     }
 156 
 157     public static char[] testCharArrayWithLongStoreSnippet(long v) {
 158         char[] b = new char[4];
<span class="line-modified"> 159         unsafe.putLong(b, charArrayBaseOffset, v);</span>
 160         return b;
 161     }
 162 
 163     @Test
 164     public void testCharArrayWithLongStore() {
 165         test(&quot;testCharArrayWithLongStoreSnippet&quot;, longValue);
 166     }
 167 
 168     public static char[] testCharArrayWithFloatStoreSnippet(float v) {
 169         char[] b = new char[4];
<span class="line-modified"> 170         unsafe.putFloat(b, charArrayBaseOffset, v);</span>
 171         return b;
 172     }
 173 
 174     @Test
 175     public void testCharArrayWithFloatStore() {
 176         test(&quot;testCharArrayWithFloatStoreSnippet&quot;, floatValue);
 177     }
 178 
 179     public static char[] testCharArrayWithDoubleStoreSnippet(double v) {
 180         char[] b = new char[4];
<span class="line-modified"> 181         unsafe.putDouble(b, charArrayBaseOffset, v);</span>
 182         return b;
 183     }
 184 
 185     @Test
 186     public void testCharArrayWithDoubleStore() {
 187         test(&quot;testCharArrayWithDoubleStoreSnippet&quot;, doubleValue);
 188     }
 189 
<span class="line-modified"> 190     private static final long shortArrayBaseOffset = unsafe.arrayBaseOffset(short[].class);</span>
 191     private static short shortValue = 0x1112;
 192 
 193     public static short[] testShortArrayWithByteStoreSnippet(byte v) {
 194         short[] b = new short[4];
<span class="line-modified"> 195         unsafe.putByte(b, shortArrayBaseOffset, v);</span>
 196         return b;
 197     }
 198 
 199     @Test
 200     public void testShortArrayWithByteStore() {
 201         test(&quot;testShortArrayWithByteStoreSnippet&quot;, byteValue);
 202     }
 203 
 204     public static short[] testShortArrayWithCharStoreSnippet(char v) {
 205         short[] b = new short[4];
<span class="line-modified"> 206         unsafe.putChar(b, shortArrayBaseOffset, v);</span>
 207         return b;
 208     }
 209 
 210     @Test
 211     public void testShortArrayWithCharStore() {
 212         test(&quot;testShortArrayWithCharStoreSnippet&quot;, charValue);
 213     }
 214 
 215     public static short[] testShortArrayWithIntStoreSnippet(int v) {
 216         short[] b = new short[4];
<span class="line-modified"> 217         unsafe.putInt(b, shortArrayBaseOffset, v);</span>
 218         return b;
 219     }
 220 
 221     @Test
 222     public void testShortArrayWithIntStore() {
 223         test(&quot;testShortArrayWithIntStoreSnippet&quot;, intValue);
 224     }
 225 
 226     public static short[] testShortArrayWithLongStoreSnippet(long v) {
 227         short[] b = new short[4];
<span class="line-modified"> 228         unsafe.putLong(b, shortArrayBaseOffset, v);</span>
 229         return b;
 230     }
 231 
 232     @Test
 233     public void testShortArrayWithLongStore() {
 234         test(&quot;testShortArrayWithLongStoreSnippet&quot;, longValue);
 235     }
 236 
 237     public static short[] testShortArrayWithFloatStoreSnippet(float v) {
 238         short[] b = new short[4];
<span class="line-modified"> 239         unsafe.putFloat(b, shortArrayBaseOffset, v);</span>
 240         return b;
 241     }
 242 
 243     @Test
 244     public void testShortArrayWithFloatStore() {
 245         test(&quot;testShortArrayWithFloatStoreSnippet&quot;, floatValue);
 246     }
 247 
 248     public static short[] testShortArrayWithDoubleStoreSnippet(double v) {
 249         short[] b = new short[4];
<span class="line-modified"> 250         unsafe.putDouble(b, shortArrayBaseOffset, v);</span>
 251         return b;
 252     }
 253 
 254     @Test
 255     public void testShortArrayWithDoubleStore() {
 256         test(&quot;testShortArrayWithDoubleStoreSnippet&quot;, doubleValue);
 257     }
 258 
<span class="line-modified"> 259     private static final long intArrayBaseOffset = unsafe.arrayBaseOffset(int[].class);</span>
 260     private static int intValue = 0x01020304;
 261 
 262     public static int[] testIntArrayWithByteStoreSnippet(byte v) {
 263         int[] b = new int[4];
<span class="line-modified"> 264         unsafe.putByte(b, intArrayBaseOffset, v);</span>
 265         return b;
 266     }
 267 
 268     @Test
 269     public void testIntArrayWithByteStore() {
 270         test(&quot;testIntArrayWithByteStoreSnippet&quot;, byteValue);
 271     }
 272 
 273     public static int[] testIntArrayWithCharStoreSnippet(char v) {
 274         int[] b = new int[4];
<span class="line-modified"> 275         unsafe.putChar(b, intArrayBaseOffset, v);</span>
 276         return b;
 277     }
 278 
 279     @Test
 280     public void testIntArrayWithCharStore() {
 281         test(&quot;testIntArrayWithCharStoreSnippet&quot;, charValue);
 282     }
 283 
 284     public static int[] testIntArrayWithShortStoreSnippet(short v) {
 285         int[] b = new int[4];
<span class="line-modified"> 286         unsafe.putShort(b, intArrayBaseOffset, v);</span>
 287         return b;
 288     }
 289 
 290     @Test
 291     public void testIntArrayWithShortStore() {
 292         test(&quot;testIntArrayWithShortStoreSnippet&quot;, shortValue);
 293     }
 294 
 295     public static int[] testIntArrayWithLongStoreSnippet(long v) {
 296         int[] b = new int[4];
<span class="line-modified"> 297         unsafe.putLong(b, intArrayBaseOffset, v);</span>
 298         return b;
 299     }
 300 
 301     @Test
 302     public void testIntArrayWithLongStore() {
 303         test(&quot;testIntArrayWithLongStoreSnippet&quot;, longValue);
 304     }
 305 
 306     public static int[] testIntArrayWithFloatStoreSnippet(float v) {
 307         int[] b = new int[4];
<span class="line-modified"> 308         unsafe.putFloat(b, intArrayBaseOffset, v);</span>
 309         return b;
 310     }
 311 
 312     @Test
 313     public void testIntArrayWithFloatStore() {
 314         test(&quot;testIntArrayWithFloatStoreSnippet&quot;, floatValue);
 315     }
 316 
 317     public static int[] testIntArrayWithDoubleStoreSnippet(double v) {
 318         int[] b = new int[4];
<span class="line-modified"> 319         unsafe.putDouble(b, intArrayBaseOffset, v);</span>
 320         return b;
 321     }
 322 
 323     @Test
 324     public void testIntArrayWithDoubleStore() {
 325         test(&quot;testIntArrayWithDoubleStoreSnippet&quot;, doubleValue);
 326     }
 327 
<span class="line-modified"> 328     private static final long longArrayBaseOffset = unsafe.arrayBaseOffset(long[].class);</span>
 329     private static long longValue = 0x31323334353637L;
 330 
 331     public static long[] testLongArrayWithByteStoreSnippet(byte v) {
 332         long[] b = new long[4];
<span class="line-modified"> 333         unsafe.putByte(b, longArrayBaseOffset, v);</span>
 334         return b;
 335     }
 336 
 337     @Test
 338     public void testLongArrayWithByteStore() {
 339         test(&quot;testLongArrayWithByteStoreSnippet&quot;, byteValue);
 340     }
 341 
 342     public static long[] testLongArrayWithCharStoreSnippet(char v) {
 343         long[] b = new long[4];
<span class="line-modified"> 344         unsafe.putChar(b, longArrayBaseOffset, v);</span>
 345         return b;
 346     }
 347 
 348     @Test
 349     public void testLongArrayWithCharStore() {
 350         test(&quot;testLongArrayWithCharStoreSnippet&quot;, charValue);
 351     }
 352 
 353     public static long[] testLongArrayWithShortStoreSnippet(short v) {
 354         long[] b = new long[4];
<span class="line-modified"> 355         unsafe.putShort(b, longArrayBaseOffset, v);</span>
 356         return b;
 357     }
 358 
 359     @Test
 360     public void testLongArrayWithShortStore() {
 361         test(&quot;testLongArrayWithShortStoreSnippet&quot;, shortValue);
 362     }
 363 
 364     public static long[] testLongArrayWithIntStoreSnippet(int v) {
 365         long[] b = new long[4];
<span class="line-modified"> 366         unsafe.putInt(b, longArrayBaseOffset, v);</span>
 367         return b;
 368     }
 369 
 370     @Test
 371     public void testLongArrayWithIntStore() {
 372         test(&quot;testLongArrayWithIntStoreSnippet&quot;, intValue);
 373     }
 374 
 375     public static long[] testLongArrayWithFloatStoreSnippet(float v) {
 376         long[] b = new long[4];
<span class="line-modified"> 377         unsafe.putFloat(b, longArrayBaseOffset, v);</span>
 378         return b;
 379     }
 380 
 381     @Test
 382     public void testLongArrayWithFloatStore() {
 383         test(&quot;testLongArrayWithFloatStoreSnippet&quot;, floatValue);
 384     }
 385 
 386     public static long[] testLongArrayWithDoubleStoreSnippet(double v) {
 387         long[] b = new long[4];
<span class="line-modified"> 388         unsafe.putDouble(b, longArrayBaseOffset, v);</span>
 389         return b;
 390     }
 391 
 392     @Test
 393     public void testLongArrayWithDoubleStore() {
 394         test(&quot;testLongArrayWithDoubleStoreSnippet&quot;, doubleValue);
 395     }
 396 
<span class="line-modified"> 397     private static final long floatArrayBaseOffset = unsafe.arrayBaseOffset(float[].class);</span>
 398     private static float floatValue = Float.NaN;
 399 
 400     public static float[] testFloatArrayWithByteStoreSnippet(byte v) {
 401         float[] b = new float[4];
<span class="line-modified"> 402         unsafe.putByte(b, floatArrayBaseOffset, v);</span>
 403         return b;
 404     }
 405 
 406     @Test
 407     public void testFloatArrayWithByteStore() {
 408         test(&quot;testFloatArrayWithByteStoreSnippet&quot;, byteValue);
 409     }
 410 
 411     public static float[] testFloatArrayWithCharStoreSnippet(char v) {
 412         float[] b = new float[4];
<span class="line-modified"> 413         unsafe.putChar(b, floatArrayBaseOffset, v);</span>
 414         return b;
 415     }
 416 
 417     @Test
 418     public void testFloatArrayWithCharStore() {
 419         test(&quot;testFloatArrayWithCharStoreSnippet&quot;, charValue);
 420     }
 421 
 422     public static float[] testFloatArrayWithShortStoreSnippet(short v) {
 423         float[] b = new float[4];
<span class="line-modified"> 424         unsafe.putShort(b, floatArrayBaseOffset, v);</span>
 425         return b;
 426     }
 427 
 428     @Test
 429     public void testFloatArrayWithShortStore() {
 430         test(&quot;testFloatArrayWithShortStoreSnippet&quot;, shortValue);
 431     }
 432 
 433     public static float[] testFloatArrayWithIntStoreSnippet(int v) {
 434         float[] b = new float[4];
<span class="line-modified"> 435         unsafe.putInt(b, floatArrayBaseOffset, v);</span>
 436         return b;
 437     }
 438 
 439     @Test
 440     public void testFloatArrayWithIntStore() {
 441         test(&quot;testFloatArrayWithIntStoreSnippet&quot;, intValue);
 442     }
 443 
 444     public static float[] testFloatArrayWithLongStoreSnippet(long v) {
 445         float[] b = new float[4];
<span class="line-modified"> 446         unsafe.putLong(b, floatArrayBaseOffset, v);</span>
 447         return b;
 448     }
 449 
 450     @Test
 451     public void testFloatArrayWithLongStore() {
 452         test(&quot;testFloatArrayWithLongStoreSnippet&quot;, longValue);
 453     }
 454 
 455     public static float[] testFloatArrayWithDoubleStoreSnippet(double v) {
 456         float[] b = new float[4];
<span class="line-modified"> 457         unsafe.putDouble(b, floatArrayBaseOffset, v);</span>
 458         return b;
 459     }
 460 
 461     @Test
 462     public void testFloatArrayWithDoubleStore() {
 463         test(&quot;testFloatArrayWithDoubleStoreSnippet&quot;, doubleValue);
 464     }
 465 
<span class="line-modified"> 466     private static final long doubleArrayBaseOffset = unsafe.arrayBaseOffset(double[].class);</span>
 467     private static double doubleValue = Double.NaN;
 468     private static final int byteSize = 1;
 469     private static final int charSize = 2;
 470     private static final int shortSize = 2;
 471     private static final int intSize = 4;
 472     private static final int floatSize = 4;
 473     private static final int longSize = 8;
 474     private static final int doubleSize = 8;
 475 
 476     public static double[] testDoubleArrayWithByteStoreSnippet(byte v) {
 477         double[] b = new double[4];
<span class="line-modified"> 478         unsafe.putByte(b, doubleArrayBaseOffset, v);</span>
 479         return b;
 480     }
 481 
 482     @Test
 483     public void testDoubleArrayWithByteStore() {
 484         test(&quot;testDoubleArrayWithByteStoreSnippet&quot;, byteValue);
 485     }
 486 
 487     public static double[] testDoubleArrayWithCharStoreSnippet(char v) {
 488         double[] b = new double[4];
<span class="line-modified"> 489         unsafe.putChar(b, doubleArrayBaseOffset, v);</span>
 490         return b;
 491     }
 492 
 493     @Test
 494     public void testDoubleArrayWithCharStore() {
 495         test(&quot;testDoubleArrayWithCharStoreSnippet&quot;, charValue);
 496     }
 497 
 498     public static double[] testDoubleArrayWithShortStoreSnippet(short v) {
 499         double[] b = new double[4];
<span class="line-modified"> 500         unsafe.putShort(b, doubleArrayBaseOffset, v);</span>
 501         return b;
 502     }
 503 
 504     @Test
 505     public void testDoubleArrayWithShortStore() {
 506         test(&quot;testDoubleArrayWithShortStoreSnippet&quot;, shortValue);
 507     }
 508 
 509     public static double[] testDoubleArrayWithIntStoreSnippet(int v) {
 510         double[] b = new double[4];
<span class="line-modified"> 511         unsafe.putInt(b, doubleArrayBaseOffset, v);</span>
 512         return b;
 513     }
 514 
 515     @Test
 516     public void testDoubleArrayWithIntStore() {
 517         test(&quot;testDoubleArrayWithIntStoreSnippet&quot;, intValue);
 518     }
 519 
 520     public static double[] testDoubleArrayWithLongStoreSnippet(long v) {
 521         double[] b = new double[4];
<span class="line-modified"> 522         unsafe.putLong(b, doubleArrayBaseOffset, v);</span>
 523         return b;
 524     }
 525 
 526     @Test
 527     public void testDoubleArrayWithLongStore() {
 528         test(&quot;testDoubleArrayWithLongStoreSnippet&quot;, longValue);
 529     }
 530 
 531     public static double[] testDoubleArrayWithFloatStoreSnippet(float v) {
 532         double[] b = new double[4];
<span class="line-modified"> 533         unsafe.putFloat(b, doubleArrayBaseOffset, v);</span>
 534         return b;
 535     }
 536 
 537     @Test
 538     public void testDoubleArrayWithFloatStore() {
 539         test(&quot;testDoubleArrayWithFloatStoreSnippet&quot;, floatValue);
 540     }
 541 
 542     public static byte testByteArrayWithCharStoreAndReadSnippet(char v) {
 543         byte[] b = new byte[4];
<span class="line-modified"> 544         unsafe.putChar(b, byteArrayBaseOffset, v);</span>
 545         return b[(byteSize / charSize) + 1];
 546     }
 547 
 548     @Test
 549     public void testByteArrayWithCharStoreAndRead() {
 550         test(&quot;testByteArrayWithCharStoreAndReadSnippet&quot;, charValue);
 551     }
 552 
 553     public static byte testByteArrayWithShortStoreAndReadSnippet(short v) {
 554         byte[] b = new byte[4];
<span class="line-modified"> 555         unsafe.putShort(b, byteArrayBaseOffset, v);</span>
 556         return b[(byteSize / shortSize) + 1];
 557     }
 558 
 559     @Test
 560     public void testByteArrayWithShortStoreAndRead() {
 561         test(&quot;testByteArrayWithShortStoreAndReadSnippet&quot;, shortValue);
 562     }
 563 
 564     public static byte testByteArrayWithIntStoreAndReadSnippet(int v) {
 565         byte[] b = new byte[4];
<span class="line-modified"> 566         unsafe.putInt(b, byteArrayBaseOffset, v);</span>
 567         return b[(byteSize / intSize) + 1];
 568     }
 569 
 570     @Test
 571     public void testByteArrayWithIntStoreAndRead() {
 572         test(&quot;testByteArrayWithIntStoreAndReadSnippet&quot;, intValue);
 573     }
 574 
 575     public static byte testByteArrayWithLongStoreAndReadSnippet(long v) {
 576         byte[] b = new byte[4];
<span class="line-modified"> 577         unsafe.putLong(b, byteArrayBaseOffset, v);</span>
 578         return b[(byteSize / longSize) + 1];
 579     }
 580 
 581     @Test
 582     public void testByteArrayWithLongStoreAndRead() {
 583         test(&quot;testByteArrayWithLongStoreAndReadSnippet&quot;, longValue);
 584     }
 585 
 586     public static byte testByteArrayWithFloatStoreAndReadSnippet(float v) {
 587         byte[] b = new byte[4];
<span class="line-modified"> 588         unsafe.putFloat(b, byteArrayBaseOffset, v);</span>
 589         return b[(byteSize / floatSize) + 1];
 590     }
 591 
 592     @Test
 593     public void testByteArrayWithFloatStoreAndRead() {
 594         test(&quot;testByteArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
 595     }
 596 
 597     public static byte testByteArrayWithDoubleStoreAndReadSnippet(double v) {
 598         byte[] b = new byte[4];
<span class="line-modified"> 599         unsafe.putDouble(b, byteArrayBaseOffset, v);</span>
 600         return b[(byteSize / doubleSize) + 1];
 601     }
 602 
 603     @Test
 604     public void testByteArrayWithDoubleStoreAndRead() {
 605         test(&quot;testByteArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
 606     }
 607 
 608     public static char testCharArrayWithByteStoreAndReadSnippet(byte v) {
 609         char[] b = new char[4];
<span class="line-modified"> 610         unsafe.putByte(b, charArrayBaseOffset, v);</span>
 611         return b[(charSize / byteSize) + 1];
 612     }
 613 
 614     @Test
 615     public void testCharArrayWithByteStoreAndRead() {
 616         test(&quot;testCharArrayWithByteStoreAndReadSnippet&quot;, byteValue);
 617     }
 618 
 619     public static char testCharArrayWithShortStoreAndReadSnippet(short v) {
 620         char[] b = new char[4];
<span class="line-modified"> 621         unsafe.putShort(b, charArrayBaseOffset, v);</span>
 622         return b[(charSize / shortSize) + 1];
 623     }
 624 
 625     @Test
 626     public void testCharArrayWithShortStoreAndRead() {
 627         test(&quot;testCharArrayWithShortStoreAndReadSnippet&quot;, shortValue);
 628     }
 629 
 630     public static char testCharArrayWithIntStoreAndReadSnippet(int v) {
 631         char[] b = new char[4];
<span class="line-modified"> 632         unsafe.putInt(b, charArrayBaseOffset, v);</span>
 633         return b[(charSize / intSize) + 1];
 634     }
 635 
 636     @Test
 637     public void testCharArrayWithIntStoreAndRead() {
 638         test(&quot;testCharArrayWithIntStoreAndReadSnippet&quot;, intValue);
 639     }
 640 
 641     public static char testCharArrayWithLongStoreAndReadSnippet(long v) {
 642         char[] b = new char[4];
<span class="line-modified"> 643         unsafe.putLong(b, charArrayBaseOffset, v);</span>
 644         return b[(charSize / longSize) + 1];
 645     }
 646 
 647     @Test
 648     public void testCharArrayWithLongStoreAndRead() {
 649         test(&quot;testCharArrayWithLongStoreAndReadSnippet&quot;, longValue);
 650     }
 651 
 652     public static char testCharArrayWithFloatStoreAndReadSnippet(float v) {
 653         char[] b = new char[4];
<span class="line-modified"> 654         unsafe.putFloat(b, charArrayBaseOffset, v);</span>
 655         return b[(charSize / floatSize) + 1];
 656     }
 657 
 658     @Test
 659     public void testCharArrayWithFloatStoreAndRead() {
 660         test(&quot;testCharArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
 661     }
 662 
 663     public static char testCharArrayWithDoubleStoreAndReadSnippet(double v) {
 664         char[] b = new char[4];
<span class="line-modified"> 665         unsafe.putDouble(b, charArrayBaseOffset, v);</span>
 666         return b[(charSize / doubleSize) + 1];
 667     }
 668 
 669     @Test
 670     public void testCharArrayWithDoubleStoreAndRead() {
 671         test(&quot;testCharArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
 672     }
 673 
 674     public static short testShortArrayWithByteStoreAndReadSnippet(byte v) {
 675         short[] b = new short[4];
<span class="line-modified"> 676         unsafe.putByte(b, shortArrayBaseOffset, v);</span>
 677         return b[(shortSize / byteSize) + 1];
 678     }
 679 
 680     @Test
 681     public void testShortArrayWithByteStoreAndRead() {
 682         test(&quot;testShortArrayWithByteStoreAndReadSnippet&quot;, byteValue);
 683     }
 684 
 685     public static short testShortArrayWithCharStoreAndReadSnippet(char v) {
 686         short[] b = new short[4];
<span class="line-modified"> 687         unsafe.putChar(b, shortArrayBaseOffset, v);</span>
 688         return b[(shortSize / charSize) + 1];
 689     }
 690 
 691     @Test
 692     public void testShortArrayWithCharStoreAndRead() {
 693         test(&quot;testShortArrayWithCharStoreAndReadSnippet&quot;, charValue);
 694     }
 695 
 696     public static short testShortArrayWithIntStoreAndReadSnippet(int v) {
 697         short[] b = new short[4];
<span class="line-modified"> 698         unsafe.putInt(b, shortArrayBaseOffset, v);</span>
 699         return b[(shortSize / intSize) + 1];
 700     }
 701 
 702     @Test
 703     public void testShortArrayWithIntStoreAndRead() {
 704         test(&quot;testShortArrayWithIntStoreAndReadSnippet&quot;, intValue);
 705     }
 706 
 707     public static short testShortArrayWithLongStoreAndReadSnippet(long v) {
 708         short[] b = new short[4];
<span class="line-modified"> 709         unsafe.putLong(b, shortArrayBaseOffset, v);</span>
 710         return b[(shortSize / longSize) + 1];
 711     }
 712 
 713     @Test
 714     public void testShortArrayWithLongStoreAndRead() {
 715         test(&quot;testShortArrayWithLongStoreAndReadSnippet&quot;, longValue);
 716     }
 717 
 718     public static short testShortArrayWithFloatStoreAndReadSnippet(float v) {
 719         short[] b = new short[4];
<span class="line-modified"> 720         unsafe.putFloat(b, shortArrayBaseOffset, v);</span>
 721         return b[(shortSize / floatSize) + 1];
 722     }
 723 
 724     @Test
 725     public void testShortArrayWithFloatStoreAndRead() {
 726         test(&quot;testShortArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
 727     }
 728 
 729     public static short testShortArrayWithDoubleStoreAndReadSnippet(double v) {
 730         short[] b = new short[4];
<span class="line-modified"> 731         unsafe.putDouble(b, shortArrayBaseOffset, v);</span>
 732         return b[(shortSize / doubleSize) + 1];
 733     }
 734 
 735     @Test
 736     public void testShortArrayWithDoubleStoreAndRead() {
 737         test(&quot;testShortArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
 738     }
 739 
 740     public static int testIntArrayWithByteStoreAndReadSnippet(byte v) {
 741         int[] b = new int[4];
<span class="line-modified"> 742         unsafe.putByte(b, intArrayBaseOffset, v);</span>
 743         return b[(intSize / byteSize) + 1];
 744     }
 745 
 746     @Test
 747     public void testIntArrayWithByteStoreAndRead() {
 748         test(&quot;testIntArrayWithByteStoreAndReadSnippet&quot;, byteValue);
 749     }
 750 
 751     public static int testIntArrayWithCharStoreAndReadSnippet(char v) {
 752         int[] b = new int[4];
<span class="line-modified"> 753         unsafe.putChar(b, intArrayBaseOffset, v);</span>
 754         return b[(intSize / charSize) + 1];
 755     }
 756 
 757     @Test
 758     public void testIntArrayWithCharStoreAndRead() {
 759         test(&quot;testIntArrayWithCharStoreAndReadSnippet&quot;, charValue);
 760     }
 761 
 762     public static int testIntArrayWithShortStoreAndReadSnippet(short v) {
 763         int[] b = new int[4];
<span class="line-modified"> 764         unsafe.putShort(b, intArrayBaseOffset, v);</span>
 765         return b[(intSize / shortSize) + 1];
 766     }
 767 
 768     @Test
 769     public void testIntArrayWithShortStoreAndRead() {
 770         test(&quot;testIntArrayWithShortStoreAndReadSnippet&quot;, shortValue);
 771     }
 772 
 773     public static int testIntArrayWithLongStoreAndReadSnippet(long v) {
 774         int[] b = new int[4];
<span class="line-modified"> 775         unsafe.putLong(b, intArrayBaseOffset, v);</span>
 776         return b[(intSize / longSize) + 1];
 777     }
 778 
 779     @Test
 780     public void testIntArrayWithLongStoreAndRead() {
 781         test(&quot;testIntArrayWithLongStoreAndReadSnippet&quot;, longValue);
 782     }
 783 
 784     public static int testIntArrayWithFloatStoreAndReadSnippet(float v) {
 785         int[] b = new int[4];
<span class="line-modified"> 786         unsafe.putFloat(b, intArrayBaseOffset, v);</span>
 787         return b[(intSize / floatSize) + 1];
 788     }
 789 
 790     @Test
 791     public void testIntArrayWithFloatStoreAndRead() {
 792         test(&quot;testIntArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
 793     }
 794 
 795     public static int testIntArrayWithDoubleStoreAndReadSnippet(double v) {
 796         int[] b = new int[4];
<span class="line-modified"> 797         unsafe.putDouble(b, intArrayBaseOffset, v);</span>
 798         return b[(intSize / doubleSize) + 1];
 799     }
 800 
 801     @Test
 802     public void testIntArrayWithDoubleStoreAndRead() {
 803         test(&quot;testIntArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
 804     }
 805 
 806     public static long testLongArrayWithByteStoreAndReadSnippet(byte v) {
 807         long[] b = new long[4];
<span class="line-modified"> 808         unsafe.putByte(b, longArrayBaseOffset, v);</span>
 809         return b[(longSize / byteSize) + 1];
 810     }
 811 
 812     @Test
 813     public void testLongArrayWithByteStoreAndRead() {
 814         test(&quot;testLongArrayWithByteStoreAndReadSnippet&quot;, byteValue);
 815     }
 816 
 817     public static long testLongArrayWithCharStoreAndReadSnippet(char v) {
 818         long[] b = new long[4];
<span class="line-modified"> 819         unsafe.putChar(b, longArrayBaseOffset, v);</span>
 820         return b[(longSize / charSize) + 1];
 821     }
 822 
 823     @Test
 824     public void testLongArrayWithCharStoreAndRead() {
 825         test(&quot;testLongArrayWithCharStoreAndReadSnippet&quot;, charValue);
 826     }
 827 
 828     public static long testLongArrayWithShortStoreAndReadSnippet(short v) {
 829         long[] b = new long[4];
<span class="line-modified"> 830         unsafe.putShort(b, longArrayBaseOffset, v);</span>
 831         return b[(longSize / shortSize) + 1];
 832     }
 833 
 834     @Test
 835     public void testLongArrayWithShortStoreAndRead() {
 836         test(&quot;testLongArrayWithShortStoreAndReadSnippet&quot;, shortValue);
 837     }
 838 
 839     public static long testLongArrayWithIntStoreAndReadSnippet(int v) {
 840         long[] b = new long[4];
<span class="line-modified"> 841         unsafe.putInt(b, longArrayBaseOffset, v);</span>
 842         return b[(longSize / intSize) + 1];
 843     }
 844 
 845     @Test
 846     public void testLongArrayWithIntStoreAndRead() {
 847         test(&quot;testLongArrayWithIntStoreAndReadSnippet&quot;, intValue);
 848     }
 849 
 850     public static long testLongArrayWithFloatStoreAndReadSnippet(float v) {
 851         long[] b = new long[4];
<span class="line-modified"> 852         unsafe.putFloat(b, longArrayBaseOffset, v);</span>
 853         return b[(longSize / floatSize) + 1];
 854     }
 855 
 856     @Test
 857     public void testLongArrayWithFloatStoreAndRead() {
 858         test(&quot;testLongArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
 859     }
 860 
 861     public static long testLongArrayWithDoubleStoreAndReadSnippet(double v) {
 862         long[] b = new long[4];
<span class="line-modified"> 863         unsafe.putDouble(b, longArrayBaseOffset, v);</span>
 864         return b[(longSize / doubleSize) + 1];
 865     }
 866 
 867     @Test
 868     public void testLongArrayWithDoubleStoreAndRead() {
 869         test(&quot;testLongArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
 870     }
 871 
 872     public static float testFloatArrayWithByteStoreAndReadSnippet(byte v) {
 873         float[] b = new float[4];
<span class="line-modified"> 874         unsafe.putByte(b, floatArrayBaseOffset, v);</span>
 875         return b[(floatSize / byteSize) + 1];
 876     }
 877 
 878     @Test
 879     public void testFloatArrayWithByteStoreAndRead() {
 880         test(&quot;testFloatArrayWithByteStoreAndReadSnippet&quot;, byteValue);
 881     }
 882 
 883     public static float testFloatArrayWithCharStoreAndReadSnippet(char v) {
 884         float[] b = new float[4];
<span class="line-modified"> 885         unsafe.putChar(b, floatArrayBaseOffset, v);</span>
 886         return b[(floatSize / charSize) + 1];
 887     }
 888 
 889     @Test
 890     public void testFloatArrayWithCharStoreAndRead() {
 891         test(&quot;testFloatArrayWithCharStoreAndReadSnippet&quot;, charValue);
 892     }
 893 
 894     public static float testFloatArrayWithShortStoreAndReadSnippet(short v) {
 895         float[] b = new float[4];
<span class="line-modified"> 896         unsafe.putShort(b, floatArrayBaseOffset, v);</span>
 897         return b[(floatSize / shortSize) + 1];
 898     }
 899 
 900     @Test
 901     public void testFloatArrayWithShortStoreAndRead() {
 902         test(&quot;testFloatArrayWithShortStoreAndReadSnippet&quot;, shortValue);
 903     }
 904 
 905     public static float testFloatArrayWithIntStoreAndReadSnippet(int v) {
 906         float[] b = new float[4];
<span class="line-modified"> 907         unsafe.putInt(b, floatArrayBaseOffset, v);</span>
 908         return b[(floatSize / intSize) + 1];
 909     }
 910 
 911     @Test
 912     public void testFloatArrayWithIntStoreAndRead() {
 913         test(&quot;testFloatArrayWithIntStoreAndReadSnippet&quot;, intValue);
 914     }
 915 
 916     public static float testFloatArrayWithLongStoreAndReadSnippet(long v) {
 917         float[] b = new float[4];
<span class="line-modified"> 918         unsafe.putLong(b, floatArrayBaseOffset, v);</span>
 919         return b[(floatSize / longSize) + 1];
 920     }
 921 
 922     @Test
 923     public void testFloatArrayWithLongStoreAndRead() {
 924         test(&quot;testFloatArrayWithLongStoreAndReadSnippet&quot;, longValue);
 925     }
 926 
 927     public static float testFloatArrayWithDoubleStoreAndReadSnippet(double v) {
 928         float[] b = new float[4];
<span class="line-modified"> 929         unsafe.putDouble(b, floatArrayBaseOffset, v);</span>
 930         return b[(floatSize / doubleSize) + 1];
 931     }
 932 
 933     @Test
 934     public void testFloatArrayWithDoubleStoreAndRead() {
 935         test(&quot;testFloatArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
 936     }
 937 
 938     public static double testDoubleArrayWithByteStoreAndReadSnippet(byte v) {
 939         double[] b = new double[4];
<span class="line-modified"> 940         unsafe.putByte(b, doubleArrayBaseOffset, v);</span>
 941         return b[(doubleSize / byteSize) + 1];
 942     }
 943 
 944     @Test
 945     public void testDoubleArrayWithByteStoreAndRead() {
 946         test(&quot;testDoubleArrayWithByteStoreAndReadSnippet&quot;, byteValue);
 947     }
 948 
 949     public static double testDoubleArrayWithCharStoreAndReadSnippet(char v) {
 950         double[] b = new double[4];
<span class="line-modified"> 951         unsafe.putChar(b, doubleArrayBaseOffset, v);</span>
 952         return b[(doubleSize / charSize) + 1];
 953     }
 954 
 955     @Test
 956     public void testDoubleArrayWithCharStoreAndRead() {
 957         test(&quot;testDoubleArrayWithCharStoreAndReadSnippet&quot;, charValue);
 958     }
 959 
 960     public static double testDoubleArrayWithShortStoreAndReadSnippet(short v) {
 961         double[] b = new double[4];
<span class="line-modified"> 962         unsafe.putShort(b, doubleArrayBaseOffset, v);</span>
 963         return b[(doubleSize / shortSize) + 1];
 964     }
 965 
 966     @Test
 967     public void testDoubleArrayWithShortStoreAndRead() {
 968         test(&quot;testDoubleArrayWithShortStoreAndReadSnippet&quot;, shortValue);
 969     }
 970 
 971     public static double testDoubleArrayWithIntStoreAndReadSnippet(int v) {
 972         double[] b = new double[4];
<span class="line-modified"> 973         unsafe.putInt(b, doubleArrayBaseOffset, v);</span>
 974         return b[(doubleSize / intSize) + 1];
 975     }
 976 
 977     @Test
 978     public void testDoubleArrayWithIntStoreAndRead() {
 979         test(&quot;testDoubleArrayWithIntStoreAndReadSnippet&quot;, intValue);
 980     }
 981 
 982     public static double testDoubleArrayWithLongStoreAndReadSnippet(long v) {
 983         double[] b = new double[4];
<span class="line-modified"> 984         unsafe.putLong(b, doubleArrayBaseOffset, v);</span>
 985         return b[(doubleSize / longSize) + 1];
 986     }
 987 
 988     @Test
 989     public void testDoubleArrayWithLongStoreAndRead() {
 990         test(&quot;testDoubleArrayWithLongStoreAndReadSnippet&quot;, longValue);
 991     }
 992 
 993     public static double testDoubleArrayWithFloatStoreAndReadSnippet(float v) {
 994         double[] b = new double[4];
<span class="line-modified"> 995         unsafe.putFloat(b, doubleArrayBaseOffset, v);</span>
 996         return b[(doubleSize / floatSize) + 1];
 997     }
 998 
 999     @Test
1000     public void testDoubleArrayWithFloatStoreAndRead() {
1001         test(&quot;testDoubleArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
1002     }
1003 }
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2016, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
  23 
  24 
  25 package org.graalvm.compiler.core.test.ea;
  26 


  27 import org.graalvm.compiler.core.test.GraalCompilerTest;
  28 import org.junit.Test;
  29 


  30 /**
  31  * Exercise a mix of unsafe and normal reads ands writes in situations where EA might attempt to
  32  * fold the operations.
  33  */
  34 public class PartialEscapeUnsafeStoreTest extends GraalCompilerTest {
  35 
<span class="line-modified">  36     private static final long byteArrayBaseOffset = UNSAFE.arrayBaseOffset(byte[].class);</span>












  37     private static byte byteValue = 0x61;
  38 
  39     public static byte[] testByteArrayWithCharStoreSnippet(char v) {
  40         byte[] b = new byte[8];
<span class="line-modified">  41         UNSAFE.putChar(b, byteArrayBaseOffset, v);</span>
  42         return b;
  43     }
  44 
  45     @Test
  46     public void testByteArrayWithCharStore() {
  47         test(&quot;testByteArrayWithCharStoreSnippet&quot;, charValue);
  48     }
  49 
  50     public static byte[] testByteArrayWithShortStoreSnippet(short v) {
  51         byte[] b = new byte[8];
<span class="line-modified">  52         UNSAFE.putShort(b, byteArrayBaseOffset, v);</span>
  53         return b;
  54     }
  55 
  56     @Test
  57     public void testByteArrayWithShortStore() {
  58         test(&quot;testByteArrayWithShortStoreSnippet&quot;, shortValue);
  59     }
  60 
  61     public static byte[] testByteArrayWithIntStoreSnippet(int v) {
  62         byte[] b = new byte[8];
<span class="line-modified">  63         UNSAFE.putInt(b, byteArrayBaseOffset, v);</span>
  64         return b;
  65     }
  66 
  67     @Test
  68     public void testByteArrayWithIntStore() {
  69         test(&quot;testByteArrayWithIntStoreSnippet&quot;, intValue);
  70     }
  71 
  72     public static byte[] testByteArrayWithLongStoreSnippet(long v) {
  73         byte[] b = new byte[8];
<span class="line-modified">  74         UNSAFE.putLong(b, byteArrayBaseOffset, v);</span>
  75         return b;
  76     }
  77 
  78     @Test
  79     public void testByteArrayWithLongStore() {
  80         test(&quot;testByteArrayWithLongStoreSnippet&quot;, longValue);
  81     }
  82 
  83     public static byte[] testByteArrayWithFloatStoreSnippet(float v) {
  84         byte[] b = new byte[8];
<span class="line-modified">  85         UNSAFE.putFloat(b, byteArrayBaseOffset, v);</span>
  86         return b;
  87     }
  88 
  89     @Test
  90     public void testByteArrayWithFloatStore() {
  91         test(&quot;testByteArrayWithFloatStoreSnippet&quot;, floatValue);
  92     }
  93 
  94     public static byte[] testByteArrayWithDoubleStoreSnippet(double v) {
  95         byte[] b = new byte[8];
<span class="line-modified">  96         UNSAFE.putDouble(b, byteArrayBaseOffset, v);</span>
  97         return b;
  98     }
  99 
 100     @Test
 101     public void testByteArrayWithDoubleStore() {
 102         test(&quot;testByteArrayWithDoubleStoreSnippet&quot;, doubleValue);
 103     }
 104 
<span class="line-modified"> 105     private static final long charArrayBaseOffset = UNSAFE.arrayBaseOffset(char[].class);</span>
 106     private static char charValue = 0x4142;
 107 
 108     public static char[] testCharArrayWithByteStoreSnippet(byte v) {
 109         char[] b = new char[4];
<span class="line-modified"> 110         UNSAFE.putByte(b, charArrayBaseOffset, v);</span>
 111         return b;
 112     }
 113 
 114     @Test
 115     public void testCharArrayWithByteStore() {
 116         test(&quot;testCharArrayWithByteStoreSnippet&quot;, byteValue);
 117     }
 118 
 119     public static char[] testCharArrayWithShortStoreSnippet(short v) {
 120         char[] b = new char[4];
<span class="line-modified"> 121         UNSAFE.putShort(b, charArrayBaseOffset, v);</span>
 122         return b;
 123     }
 124 
 125     @Test
 126     public void testCharArrayWithShortStore() {
 127         test(&quot;testCharArrayWithShortStoreSnippet&quot;, shortValue);
 128     }
 129 
 130     public static char[] testCharArrayWithIntStoreSnippet(int v) {
 131         char[] b = new char[4];
<span class="line-modified"> 132         UNSAFE.putInt(b, charArrayBaseOffset, v);</span>
 133         return b;
 134     }
 135 
 136     @Test
 137     public void testCharArrayWithIntStore() {
 138         test(&quot;testCharArrayWithIntStoreSnippet&quot;, intValue);
 139     }
 140 
 141     public static char[] testCharArrayWithLongStoreSnippet(long v) {
 142         char[] b = new char[4];
<span class="line-modified"> 143         UNSAFE.putLong(b, charArrayBaseOffset, v);</span>
 144         return b;
 145     }
 146 
 147     @Test
 148     public void testCharArrayWithLongStore() {
 149         test(&quot;testCharArrayWithLongStoreSnippet&quot;, longValue);
 150     }
 151 
 152     public static char[] testCharArrayWithFloatStoreSnippet(float v) {
 153         char[] b = new char[4];
<span class="line-modified"> 154         UNSAFE.putFloat(b, charArrayBaseOffset, v);</span>
 155         return b;
 156     }
 157 
 158     @Test
 159     public void testCharArrayWithFloatStore() {
 160         test(&quot;testCharArrayWithFloatStoreSnippet&quot;, floatValue);
 161     }
 162 
 163     public static char[] testCharArrayWithDoubleStoreSnippet(double v) {
 164         char[] b = new char[4];
<span class="line-modified"> 165         UNSAFE.putDouble(b, charArrayBaseOffset, v);</span>
 166         return b;
 167     }
 168 
 169     @Test
 170     public void testCharArrayWithDoubleStore() {
 171         test(&quot;testCharArrayWithDoubleStoreSnippet&quot;, doubleValue);
 172     }
 173 
<span class="line-modified"> 174     private static final long shortArrayBaseOffset = UNSAFE.arrayBaseOffset(short[].class);</span>
 175     private static short shortValue = 0x1112;
 176 
 177     public static short[] testShortArrayWithByteStoreSnippet(byte v) {
 178         short[] b = new short[4];
<span class="line-modified"> 179         UNSAFE.putByte(b, shortArrayBaseOffset, v);</span>
 180         return b;
 181     }
 182 
 183     @Test
 184     public void testShortArrayWithByteStore() {
 185         test(&quot;testShortArrayWithByteStoreSnippet&quot;, byteValue);
 186     }
 187 
 188     public static short[] testShortArrayWithCharStoreSnippet(char v) {
 189         short[] b = new short[4];
<span class="line-modified"> 190         UNSAFE.putChar(b, shortArrayBaseOffset, v);</span>
 191         return b;
 192     }
 193 
 194     @Test
 195     public void testShortArrayWithCharStore() {
 196         test(&quot;testShortArrayWithCharStoreSnippet&quot;, charValue);
 197     }
 198 
 199     public static short[] testShortArrayWithIntStoreSnippet(int v) {
 200         short[] b = new short[4];
<span class="line-modified"> 201         UNSAFE.putInt(b, shortArrayBaseOffset, v);</span>
 202         return b;
 203     }
 204 
 205     @Test
 206     public void testShortArrayWithIntStore() {
 207         test(&quot;testShortArrayWithIntStoreSnippet&quot;, intValue);
 208     }
 209 
 210     public static short[] testShortArrayWithLongStoreSnippet(long v) {
 211         short[] b = new short[4];
<span class="line-modified"> 212         UNSAFE.putLong(b, shortArrayBaseOffset, v);</span>
 213         return b;
 214     }
 215 
 216     @Test
 217     public void testShortArrayWithLongStore() {
 218         test(&quot;testShortArrayWithLongStoreSnippet&quot;, longValue);
 219     }
 220 
 221     public static short[] testShortArrayWithFloatStoreSnippet(float v) {
 222         short[] b = new short[4];
<span class="line-modified"> 223         UNSAFE.putFloat(b, shortArrayBaseOffset, v);</span>
 224         return b;
 225     }
 226 
 227     @Test
 228     public void testShortArrayWithFloatStore() {
 229         test(&quot;testShortArrayWithFloatStoreSnippet&quot;, floatValue);
 230     }
 231 
 232     public static short[] testShortArrayWithDoubleStoreSnippet(double v) {
 233         short[] b = new short[4];
<span class="line-modified"> 234         UNSAFE.putDouble(b, shortArrayBaseOffset, v);</span>
 235         return b;
 236     }
 237 
 238     @Test
 239     public void testShortArrayWithDoubleStore() {
 240         test(&quot;testShortArrayWithDoubleStoreSnippet&quot;, doubleValue);
 241     }
 242 
<span class="line-modified"> 243     private static final long intArrayBaseOffset = UNSAFE.arrayBaseOffset(int[].class);</span>
 244     private static int intValue = 0x01020304;
 245 
 246     public static int[] testIntArrayWithByteStoreSnippet(byte v) {
 247         int[] b = new int[4];
<span class="line-modified"> 248         UNSAFE.putByte(b, intArrayBaseOffset, v);</span>
 249         return b;
 250     }
 251 
 252     @Test
 253     public void testIntArrayWithByteStore() {
 254         test(&quot;testIntArrayWithByteStoreSnippet&quot;, byteValue);
 255     }
 256 
 257     public static int[] testIntArrayWithCharStoreSnippet(char v) {
 258         int[] b = new int[4];
<span class="line-modified"> 259         UNSAFE.putChar(b, intArrayBaseOffset, v);</span>
 260         return b;
 261     }
 262 
 263     @Test
 264     public void testIntArrayWithCharStore() {
 265         test(&quot;testIntArrayWithCharStoreSnippet&quot;, charValue);
 266     }
 267 
 268     public static int[] testIntArrayWithShortStoreSnippet(short v) {
 269         int[] b = new int[4];
<span class="line-modified"> 270         UNSAFE.putShort(b, intArrayBaseOffset, v);</span>
 271         return b;
 272     }
 273 
 274     @Test
 275     public void testIntArrayWithShortStore() {
 276         test(&quot;testIntArrayWithShortStoreSnippet&quot;, shortValue);
 277     }
 278 
 279     public static int[] testIntArrayWithLongStoreSnippet(long v) {
 280         int[] b = new int[4];
<span class="line-modified"> 281         UNSAFE.putLong(b, intArrayBaseOffset, v);</span>
 282         return b;
 283     }
 284 
 285     @Test
 286     public void testIntArrayWithLongStore() {
 287         test(&quot;testIntArrayWithLongStoreSnippet&quot;, longValue);
 288     }
 289 
 290     public static int[] testIntArrayWithFloatStoreSnippet(float v) {
 291         int[] b = new int[4];
<span class="line-modified"> 292         UNSAFE.putFloat(b, intArrayBaseOffset, v);</span>
 293         return b;
 294     }
 295 
 296     @Test
 297     public void testIntArrayWithFloatStore() {
 298         test(&quot;testIntArrayWithFloatStoreSnippet&quot;, floatValue);
 299     }
 300 
 301     public static int[] testIntArrayWithDoubleStoreSnippet(double v) {
 302         int[] b = new int[4];
<span class="line-modified"> 303         UNSAFE.putDouble(b, intArrayBaseOffset, v);</span>
 304         return b;
 305     }
 306 
 307     @Test
 308     public void testIntArrayWithDoubleStore() {
 309         test(&quot;testIntArrayWithDoubleStoreSnippet&quot;, doubleValue);
 310     }
 311 
<span class="line-modified"> 312     private static final long longArrayBaseOffset = UNSAFE.arrayBaseOffset(long[].class);</span>
 313     private static long longValue = 0x31323334353637L;
 314 
 315     public static long[] testLongArrayWithByteStoreSnippet(byte v) {
 316         long[] b = new long[4];
<span class="line-modified"> 317         UNSAFE.putByte(b, longArrayBaseOffset, v);</span>
 318         return b;
 319     }
 320 
 321     @Test
 322     public void testLongArrayWithByteStore() {
 323         test(&quot;testLongArrayWithByteStoreSnippet&quot;, byteValue);
 324     }
 325 
 326     public static long[] testLongArrayWithCharStoreSnippet(char v) {
 327         long[] b = new long[4];
<span class="line-modified"> 328         UNSAFE.putChar(b, longArrayBaseOffset, v);</span>
 329         return b;
 330     }
 331 
 332     @Test
 333     public void testLongArrayWithCharStore() {
 334         test(&quot;testLongArrayWithCharStoreSnippet&quot;, charValue);
 335     }
 336 
 337     public static long[] testLongArrayWithShortStoreSnippet(short v) {
 338         long[] b = new long[4];
<span class="line-modified"> 339         UNSAFE.putShort(b, longArrayBaseOffset, v);</span>
 340         return b;
 341     }
 342 
 343     @Test
 344     public void testLongArrayWithShortStore() {
 345         test(&quot;testLongArrayWithShortStoreSnippet&quot;, shortValue);
 346     }
 347 
 348     public static long[] testLongArrayWithIntStoreSnippet(int v) {
 349         long[] b = new long[4];
<span class="line-modified"> 350         UNSAFE.putInt(b, longArrayBaseOffset, v);</span>
 351         return b;
 352     }
 353 
 354     @Test
 355     public void testLongArrayWithIntStore() {
 356         test(&quot;testLongArrayWithIntStoreSnippet&quot;, intValue);
 357     }
 358 
 359     public static long[] testLongArrayWithFloatStoreSnippet(float v) {
 360         long[] b = new long[4];
<span class="line-modified"> 361         UNSAFE.putFloat(b, longArrayBaseOffset, v);</span>
 362         return b;
 363     }
 364 
 365     @Test
 366     public void testLongArrayWithFloatStore() {
 367         test(&quot;testLongArrayWithFloatStoreSnippet&quot;, floatValue);
 368     }
 369 
 370     public static long[] testLongArrayWithDoubleStoreSnippet(double v) {
 371         long[] b = new long[4];
<span class="line-modified"> 372         UNSAFE.putDouble(b, longArrayBaseOffset, v);</span>
 373         return b;
 374     }
 375 
 376     @Test
 377     public void testLongArrayWithDoubleStore() {
 378         test(&quot;testLongArrayWithDoubleStoreSnippet&quot;, doubleValue);
 379     }
 380 
<span class="line-modified"> 381     private static final long floatArrayBaseOffset = UNSAFE.arrayBaseOffset(float[].class);</span>
 382     private static float floatValue = Float.NaN;
 383 
 384     public static float[] testFloatArrayWithByteStoreSnippet(byte v) {
 385         float[] b = new float[4];
<span class="line-modified"> 386         UNSAFE.putByte(b, floatArrayBaseOffset, v);</span>
 387         return b;
 388     }
 389 
 390     @Test
 391     public void testFloatArrayWithByteStore() {
 392         test(&quot;testFloatArrayWithByteStoreSnippet&quot;, byteValue);
 393     }
 394 
 395     public static float[] testFloatArrayWithCharStoreSnippet(char v) {
 396         float[] b = new float[4];
<span class="line-modified"> 397         UNSAFE.putChar(b, floatArrayBaseOffset, v);</span>
 398         return b;
 399     }
 400 
 401     @Test
 402     public void testFloatArrayWithCharStore() {
 403         test(&quot;testFloatArrayWithCharStoreSnippet&quot;, charValue);
 404     }
 405 
 406     public static float[] testFloatArrayWithShortStoreSnippet(short v) {
 407         float[] b = new float[4];
<span class="line-modified"> 408         UNSAFE.putShort(b, floatArrayBaseOffset, v);</span>
 409         return b;
 410     }
 411 
 412     @Test
 413     public void testFloatArrayWithShortStore() {
 414         test(&quot;testFloatArrayWithShortStoreSnippet&quot;, shortValue);
 415     }
 416 
 417     public static float[] testFloatArrayWithIntStoreSnippet(int v) {
 418         float[] b = new float[4];
<span class="line-modified"> 419         UNSAFE.putInt(b, floatArrayBaseOffset, v);</span>
 420         return b;
 421     }
 422 
 423     @Test
 424     public void testFloatArrayWithIntStore() {
 425         test(&quot;testFloatArrayWithIntStoreSnippet&quot;, intValue);
 426     }
 427 
 428     public static float[] testFloatArrayWithLongStoreSnippet(long v) {
 429         float[] b = new float[4];
<span class="line-modified"> 430         UNSAFE.putLong(b, floatArrayBaseOffset, v);</span>
 431         return b;
 432     }
 433 
 434     @Test
 435     public void testFloatArrayWithLongStore() {
 436         test(&quot;testFloatArrayWithLongStoreSnippet&quot;, longValue);
 437     }
 438 
 439     public static float[] testFloatArrayWithDoubleStoreSnippet(double v) {
 440         float[] b = new float[4];
<span class="line-modified"> 441         UNSAFE.putDouble(b, floatArrayBaseOffset, v);</span>
 442         return b;
 443     }
 444 
 445     @Test
 446     public void testFloatArrayWithDoubleStore() {
 447         test(&quot;testFloatArrayWithDoubleStoreSnippet&quot;, doubleValue);
 448     }
 449 
<span class="line-modified"> 450     private static final long doubleArrayBaseOffset = UNSAFE.arrayBaseOffset(double[].class);</span>
 451     private static double doubleValue = Double.NaN;
 452     private static final int byteSize = 1;
 453     private static final int charSize = 2;
 454     private static final int shortSize = 2;
 455     private static final int intSize = 4;
 456     private static final int floatSize = 4;
 457     private static final int longSize = 8;
 458     private static final int doubleSize = 8;
 459 
 460     public static double[] testDoubleArrayWithByteStoreSnippet(byte v) {
 461         double[] b = new double[4];
<span class="line-modified"> 462         UNSAFE.putByte(b, doubleArrayBaseOffset, v);</span>
 463         return b;
 464     }
 465 
 466     @Test
 467     public void testDoubleArrayWithByteStore() {
 468         test(&quot;testDoubleArrayWithByteStoreSnippet&quot;, byteValue);
 469     }
 470 
 471     public static double[] testDoubleArrayWithCharStoreSnippet(char v) {
 472         double[] b = new double[4];
<span class="line-modified"> 473         UNSAFE.putChar(b, doubleArrayBaseOffset, v);</span>
 474         return b;
 475     }
 476 
 477     @Test
 478     public void testDoubleArrayWithCharStore() {
 479         test(&quot;testDoubleArrayWithCharStoreSnippet&quot;, charValue);
 480     }
 481 
 482     public static double[] testDoubleArrayWithShortStoreSnippet(short v) {
 483         double[] b = new double[4];
<span class="line-modified"> 484         UNSAFE.putShort(b, doubleArrayBaseOffset, v);</span>
 485         return b;
 486     }
 487 
 488     @Test
 489     public void testDoubleArrayWithShortStore() {
 490         test(&quot;testDoubleArrayWithShortStoreSnippet&quot;, shortValue);
 491     }
 492 
 493     public static double[] testDoubleArrayWithIntStoreSnippet(int v) {
 494         double[] b = new double[4];
<span class="line-modified"> 495         UNSAFE.putInt(b, doubleArrayBaseOffset, v);</span>
 496         return b;
 497     }
 498 
 499     @Test
 500     public void testDoubleArrayWithIntStore() {
 501         test(&quot;testDoubleArrayWithIntStoreSnippet&quot;, intValue);
 502     }
 503 
 504     public static double[] testDoubleArrayWithLongStoreSnippet(long v) {
 505         double[] b = new double[4];
<span class="line-modified"> 506         UNSAFE.putLong(b, doubleArrayBaseOffset, v);</span>
 507         return b;
 508     }
 509 
 510     @Test
 511     public void testDoubleArrayWithLongStore() {
 512         test(&quot;testDoubleArrayWithLongStoreSnippet&quot;, longValue);
 513     }
 514 
 515     public static double[] testDoubleArrayWithFloatStoreSnippet(float v) {
 516         double[] b = new double[4];
<span class="line-modified"> 517         UNSAFE.putFloat(b, doubleArrayBaseOffset, v);</span>
 518         return b;
 519     }
 520 
 521     @Test
 522     public void testDoubleArrayWithFloatStore() {
 523         test(&quot;testDoubleArrayWithFloatStoreSnippet&quot;, floatValue);
 524     }
 525 
 526     public static byte testByteArrayWithCharStoreAndReadSnippet(char v) {
 527         byte[] b = new byte[4];
<span class="line-modified"> 528         UNSAFE.putChar(b, byteArrayBaseOffset, v);</span>
 529         return b[(byteSize / charSize) + 1];
 530     }
 531 
 532     @Test
 533     public void testByteArrayWithCharStoreAndRead() {
 534         test(&quot;testByteArrayWithCharStoreAndReadSnippet&quot;, charValue);
 535     }
 536 
 537     public static byte testByteArrayWithShortStoreAndReadSnippet(short v) {
 538         byte[] b = new byte[4];
<span class="line-modified"> 539         UNSAFE.putShort(b, byteArrayBaseOffset, v);</span>
 540         return b[(byteSize / shortSize) + 1];
 541     }
 542 
 543     @Test
 544     public void testByteArrayWithShortStoreAndRead() {
 545         test(&quot;testByteArrayWithShortStoreAndReadSnippet&quot;, shortValue);
 546     }
 547 
 548     public static byte testByteArrayWithIntStoreAndReadSnippet(int v) {
 549         byte[] b = new byte[4];
<span class="line-modified"> 550         UNSAFE.putInt(b, byteArrayBaseOffset, v);</span>
 551         return b[(byteSize / intSize) + 1];
 552     }
 553 
 554     @Test
 555     public void testByteArrayWithIntStoreAndRead() {
 556         test(&quot;testByteArrayWithIntStoreAndReadSnippet&quot;, intValue);
 557     }
 558 
 559     public static byte testByteArrayWithLongStoreAndReadSnippet(long v) {
 560         byte[] b = new byte[4];
<span class="line-modified"> 561         UNSAFE.putLong(b, byteArrayBaseOffset, v);</span>
 562         return b[(byteSize / longSize) + 1];
 563     }
 564 
 565     @Test
 566     public void testByteArrayWithLongStoreAndRead() {
 567         test(&quot;testByteArrayWithLongStoreAndReadSnippet&quot;, longValue);
 568     }
 569 
 570     public static byte testByteArrayWithFloatStoreAndReadSnippet(float v) {
 571         byte[] b = new byte[4];
<span class="line-modified"> 572         UNSAFE.putFloat(b, byteArrayBaseOffset, v);</span>
 573         return b[(byteSize / floatSize) + 1];
 574     }
 575 
 576     @Test
 577     public void testByteArrayWithFloatStoreAndRead() {
 578         test(&quot;testByteArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
 579     }
 580 
 581     public static byte testByteArrayWithDoubleStoreAndReadSnippet(double v) {
 582         byte[] b = new byte[4];
<span class="line-modified"> 583         UNSAFE.putDouble(b, byteArrayBaseOffset, v);</span>
 584         return b[(byteSize / doubleSize) + 1];
 585     }
 586 
 587     @Test
 588     public void testByteArrayWithDoubleStoreAndRead() {
 589         test(&quot;testByteArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
 590     }
 591 
 592     public static char testCharArrayWithByteStoreAndReadSnippet(byte v) {
 593         char[] b = new char[4];
<span class="line-modified"> 594         UNSAFE.putByte(b, charArrayBaseOffset, v);</span>
 595         return b[(charSize / byteSize) + 1];
 596     }
 597 
 598     @Test
 599     public void testCharArrayWithByteStoreAndRead() {
 600         test(&quot;testCharArrayWithByteStoreAndReadSnippet&quot;, byteValue);
 601     }
 602 
 603     public static char testCharArrayWithShortStoreAndReadSnippet(short v) {
 604         char[] b = new char[4];
<span class="line-modified"> 605         UNSAFE.putShort(b, charArrayBaseOffset, v);</span>
 606         return b[(charSize / shortSize) + 1];
 607     }
 608 
 609     @Test
 610     public void testCharArrayWithShortStoreAndRead() {
 611         test(&quot;testCharArrayWithShortStoreAndReadSnippet&quot;, shortValue);
 612     }
 613 
 614     public static char testCharArrayWithIntStoreAndReadSnippet(int v) {
 615         char[] b = new char[4];
<span class="line-modified"> 616         UNSAFE.putInt(b, charArrayBaseOffset, v);</span>
 617         return b[(charSize / intSize) + 1];
 618     }
 619 
 620     @Test
 621     public void testCharArrayWithIntStoreAndRead() {
 622         test(&quot;testCharArrayWithIntStoreAndReadSnippet&quot;, intValue);
 623     }
 624 
 625     public static char testCharArrayWithLongStoreAndReadSnippet(long v) {
 626         char[] b = new char[4];
<span class="line-modified"> 627         UNSAFE.putLong(b, charArrayBaseOffset, v);</span>
 628         return b[(charSize / longSize) + 1];
 629     }
 630 
 631     @Test
 632     public void testCharArrayWithLongStoreAndRead() {
 633         test(&quot;testCharArrayWithLongStoreAndReadSnippet&quot;, longValue);
 634     }
 635 
 636     public static char testCharArrayWithFloatStoreAndReadSnippet(float v) {
 637         char[] b = new char[4];
<span class="line-modified"> 638         UNSAFE.putFloat(b, charArrayBaseOffset, v);</span>
 639         return b[(charSize / floatSize) + 1];
 640     }
 641 
 642     @Test
 643     public void testCharArrayWithFloatStoreAndRead() {
 644         test(&quot;testCharArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
 645     }
 646 
 647     public static char testCharArrayWithDoubleStoreAndReadSnippet(double v) {
 648         char[] b = new char[4];
<span class="line-modified"> 649         UNSAFE.putDouble(b, charArrayBaseOffset, v);</span>
 650         return b[(charSize / doubleSize) + 1];
 651     }
 652 
 653     @Test
 654     public void testCharArrayWithDoubleStoreAndRead() {
 655         test(&quot;testCharArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
 656     }
 657 
 658     public static short testShortArrayWithByteStoreAndReadSnippet(byte v) {
 659         short[] b = new short[4];
<span class="line-modified"> 660         UNSAFE.putByte(b, shortArrayBaseOffset, v);</span>
 661         return b[(shortSize / byteSize) + 1];
 662     }
 663 
 664     @Test
 665     public void testShortArrayWithByteStoreAndRead() {
 666         test(&quot;testShortArrayWithByteStoreAndReadSnippet&quot;, byteValue);
 667     }
 668 
 669     public static short testShortArrayWithCharStoreAndReadSnippet(char v) {
 670         short[] b = new short[4];
<span class="line-modified"> 671         UNSAFE.putChar(b, shortArrayBaseOffset, v);</span>
 672         return b[(shortSize / charSize) + 1];
 673     }
 674 
 675     @Test
 676     public void testShortArrayWithCharStoreAndRead() {
 677         test(&quot;testShortArrayWithCharStoreAndReadSnippet&quot;, charValue);
 678     }
 679 
 680     public static short testShortArrayWithIntStoreAndReadSnippet(int v) {
 681         short[] b = new short[4];
<span class="line-modified"> 682         UNSAFE.putInt(b, shortArrayBaseOffset, v);</span>
 683         return b[(shortSize / intSize) + 1];
 684     }
 685 
 686     @Test
 687     public void testShortArrayWithIntStoreAndRead() {
 688         test(&quot;testShortArrayWithIntStoreAndReadSnippet&quot;, intValue);
 689     }
 690 
 691     public static short testShortArrayWithLongStoreAndReadSnippet(long v) {
 692         short[] b = new short[4];
<span class="line-modified"> 693         UNSAFE.putLong(b, shortArrayBaseOffset, v);</span>
 694         return b[(shortSize / longSize) + 1];
 695     }
 696 
 697     @Test
 698     public void testShortArrayWithLongStoreAndRead() {
 699         test(&quot;testShortArrayWithLongStoreAndReadSnippet&quot;, longValue);
 700     }
 701 
 702     public static short testShortArrayWithFloatStoreAndReadSnippet(float v) {
 703         short[] b = new short[4];
<span class="line-modified"> 704         UNSAFE.putFloat(b, shortArrayBaseOffset, v);</span>
 705         return b[(shortSize / floatSize) + 1];
 706     }
 707 
 708     @Test
 709     public void testShortArrayWithFloatStoreAndRead() {
 710         test(&quot;testShortArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
 711     }
 712 
 713     public static short testShortArrayWithDoubleStoreAndReadSnippet(double v) {
 714         short[] b = new short[4];
<span class="line-modified"> 715         UNSAFE.putDouble(b, shortArrayBaseOffset, v);</span>
 716         return b[(shortSize / doubleSize) + 1];
 717     }
 718 
 719     @Test
 720     public void testShortArrayWithDoubleStoreAndRead() {
 721         test(&quot;testShortArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
 722     }
 723 
 724     public static int testIntArrayWithByteStoreAndReadSnippet(byte v) {
 725         int[] b = new int[4];
<span class="line-modified"> 726         UNSAFE.putByte(b, intArrayBaseOffset, v);</span>
 727         return b[(intSize / byteSize) + 1];
 728     }
 729 
 730     @Test
 731     public void testIntArrayWithByteStoreAndRead() {
 732         test(&quot;testIntArrayWithByteStoreAndReadSnippet&quot;, byteValue);
 733     }
 734 
 735     public static int testIntArrayWithCharStoreAndReadSnippet(char v) {
 736         int[] b = new int[4];
<span class="line-modified"> 737         UNSAFE.putChar(b, intArrayBaseOffset, v);</span>
 738         return b[(intSize / charSize) + 1];
 739     }
 740 
 741     @Test
 742     public void testIntArrayWithCharStoreAndRead() {
 743         test(&quot;testIntArrayWithCharStoreAndReadSnippet&quot;, charValue);
 744     }
 745 
 746     public static int testIntArrayWithShortStoreAndReadSnippet(short v) {
 747         int[] b = new int[4];
<span class="line-modified"> 748         UNSAFE.putShort(b, intArrayBaseOffset, v);</span>
 749         return b[(intSize / shortSize) + 1];
 750     }
 751 
 752     @Test
 753     public void testIntArrayWithShortStoreAndRead() {
 754         test(&quot;testIntArrayWithShortStoreAndReadSnippet&quot;, shortValue);
 755     }
 756 
 757     public static int testIntArrayWithLongStoreAndReadSnippet(long v) {
 758         int[] b = new int[4];
<span class="line-modified"> 759         UNSAFE.putLong(b, intArrayBaseOffset, v);</span>
 760         return b[(intSize / longSize) + 1];
 761     }
 762 
 763     @Test
 764     public void testIntArrayWithLongStoreAndRead() {
 765         test(&quot;testIntArrayWithLongStoreAndReadSnippet&quot;, longValue);
 766     }
 767 
 768     public static int testIntArrayWithFloatStoreAndReadSnippet(float v) {
 769         int[] b = new int[4];
<span class="line-modified"> 770         UNSAFE.putFloat(b, intArrayBaseOffset, v);</span>
 771         return b[(intSize / floatSize) + 1];
 772     }
 773 
 774     @Test
 775     public void testIntArrayWithFloatStoreAndRead() {
 776         test(&quot;testIntArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
 777     }
 778 
 779     public static int testIntArrayWithDoubleStoreAndReadSnippet(double v) {
 780         int[] b = new int[4];
<span class="line-modified"> 781         UNSAFE.putDouble(b, intArrayBaseOffset, v);</span>
 782         return b[(intSize / doubleSize) + 1];
 783     }
 784 
 785     @Test
 786     public void testIntArrayWithDoubleStoreAndRead() {
 787         test(&quot;testIntArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
 788     }
 789 
 790     public static long testLongArrayWithByteStoreAndReadSnippet(byte v) {
 791         long[] b = new long[4];
<span class="line-modified"> 792         UNSAFE.putByte(b, longArrayBaseOffset, v);</span>
 793         return b[(longSize / byteSize) + 1];
 794     }
 795 
 796     @Test
 797     public void testLongArrayWithByteStoreAndRead() {
 798         test(&quot;testLongArrayWithByteStoreAndReadSnippet&quot;, byteValue);
 799     }
 800 
 801     public static long testLongArrayWithCharStoreAndReadSnippet(char v) {
 802         long[] b = new long[4];
<span class="line-modified"> 803         UNSAFE.putChar(b, longArrayBaseOffset, v);</span>
 804         return b[(longSize / charSize) + 1];
 805     }
 806 
 807     @Test
 808     public void testLongArrayWithCharStoreAndRead() {
 809         test(&quot;testLongArrayWithCharStoreAndReadSnippet&quot;, charValue);
 810     }
 811 
 812     public static long testLongArrayWithShortStoreAndReadSnippet(short v) {
 813         long[] b = new long[4];
<span class="line-modified"> 814         UNSAFE.putShort(b, longArrayBaseOffset, v);</span>
 815         return b[(longSize / shortSize) + 1];
 816     }
 817 
 818     @Test
 819     public void testLongArrayWithShortStoreAndRead() {
 820         test(&quot;testLongArrayWithShortStoreAndReadSnippet&quot;, shortValue);
 821     }
 822 
 823     public static long testLongArrayWithIntStoreAndReadSnippet(int v) {
 824         long[] b = new long[4];
<span class="line-modified"> 825         UNSAFE.putInt(b, longArrayBaseOffset, v);</span>
 826         return b[(longSize / intSize) + 1];
 827     }
 828 
 829     @Test
 830     public void testLongArrayWithIntStoreAndRead() {
 831         test(&quot;testLongArrayWithIntStoreAndReadSnippet&quot;, intValue);
 832     }
 833 
 834     public static long testLongArrayWithFloatStoreAndReadSnippet(float v) {
 835         long[] b = new long[4];
<span class="line-modified"> 836         UNSAFE.putFloat(b, longArrayBaseOffset, v);</span>
 837         return b[(longSize / floatSize) + 1];
 838     }
 839 
 840     @Test
 841     public void testLongArrayWithFloatStoreAndRead() {
 842         test(&quot;testLongArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
 843     }
 844 
 845     public static long testLongArrayWithDoubleStoreAndReadSnippet(double v) {
 846         long[] b = new long[4];
<span class="line-modified"> 847         UNSAFE.putDouble(b, longArrayBaseOffset, v);</span>
 848         return b[(longSize / doubleSize) + 1];
 849     }
 850 
 851     @Test
 852     public void testLongArrayWithDoubleStoreAndRead() {
 853         test(&quot;testLongArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
 854     }
 855 
 856     public static float testFloatArrayWithByteStoreAndReadSnippet(byte v) {
 857         float[] b = new float[4];
<span class="line-modified"> 858         UNSAFE.putByte(b, floatArrayBaseOffset, v);</span>
 859         return b[(floatSize / byteSize) + 1];
 860     }
 861 
 862     @Test
 863     public void testFloatArrayWithByteStoreAndRead() {
 864         test(&quot;testFloatArrayWithByteStoreAndReadSnippet&quot;, byteValue);
 865     }
 866 
 867     public static float testFloatArrayWithCharStoreAndReadSnippet(char v) {
 868         float[] b = new float[4];
<span class="line-modified"> 869         UNSAFE.putChar(b, floatArrayBaseOffset, v);</span>
 870         return b[(floatSize / charSize) + 1];
 871     }
 872 
 873     @Test
 874     public void testFloatArrayWithCharStoreAndRead() {
 875         test(&quot;testFloatArrayWithCharStoreAndReadSnippet&quot;, charValue);
 876     }
 877 
 878     public static float testFloatArrayWithShortStoreAndReadSnippet(short v) {
 879         float[] b = new float[4];
<span class="line-modified"> 880         UNSAFE.putShort(b, floatArrayBaseOffset, v);</span>
 881         return b[(floatSize / shortSize) + 1];
 882     }
 883 
 884     @Test
 885     public void testFloatArrayWithShortStoreAndRead() {
 886         test(&quot;testFloatArrayWithShortStoreAndReadSnippet&quot;, shortValue);
 887     }
 888 
 889     public static float testFloatArrayWithIntStoreAndReadSnippet(int v) {
 890         float[] b = new float[4];
<span class="line-modified"> 891         UNSAFE.putInt(b, floatArrayBaseOffset, v);</span>
 892         return b[(floatSize / intSize) + 1];
 893     }
 894 
 895     @Test
 896     public void testFloatArrayWithIntStoreAndRead() {
 897         test(&quot;testFloatArrayWithIntStoreAndReadSnippet&quot;, intValue);
 898     }
 899 
 900     public static float testFloatArrayWithLongStoreAndReadSnippet(long v) {
 901         float[] b = new float[4];
<span class="line-modified"> 902         UNSAFE.putLong(b, floatArrayBaseOffset, v);</span>
 903         return b[(floatSize / longSize) + 1];
 904     }
 905 
 906     @Test
 907     public void testFloatArrayWithLongStoreAndRead() {
 908         test(&quot;testFloatArrayWithLongStoreAndReadSnippet&quot;, longValue);
 909     }
 910 
 911     public static float testFloatArrayWithDoubleStoreAndReadSnippet(double v) {
 912         float[] b = new float[4];
<span class="line-modified"> 913         UNSAFE.putDouble(b, floatArrayBaseOffset, v);</span>
 914         return b[(floatSize / doubleSize) + 1];
 915     }
 916 
 917     @Test
 918     public void testFloatArrayWithDoubleStoreAndRead() {
 919         test(&quot;testFloatArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
 920     }
 921 
 922     public static double testDoubleArrayWithByteStoreAndReadSnippet(byte v) {
 923         double[] b = new double[4];
<span class="line-modified"> 924         UNSAFE.putByte(b, doubleArrayBaseOffset, v);</span>
 925         return b[(doubleSize / byteSize) + 1];
 926     }
 927 
 928     @Test
 929     public void testDoubleArrayWithByteStoreAndRead() {
 930         test(&quot;testDoubleArrayWithByteStoreAndReadSnippet&quot;, byteValue);
 931     }
 932 
 933     public static double testDoubleArrayWithCharStoreAndReadSnippet(char v) {
 934         double[] b = new double[4];
<span class="line-modified"> 935         UNSAFE.putChar(b, doubleArrayBaseOffset, v);</span>
 936         return b[(doubleSize / charSize) + 1];
 937     }
 938 
 939     @Test
 940     public void testDoubleArrayWithCharStoreAndRead() {
 941         test(&quot;testDoubleArrayWithCharStoreAndReadSnippet&quot;, charValue);
 942     }
 943 
 944     public static double testDoubleArrayWithShortStoreAndReadSnippet(short v) {
 945         double[] b = new double[4];
<span class="line-modified"> 946         UNSAFE.putShort(b, doubleArrayBaseOffset, v);</span>
 947         return b[(doubleSize / shortSize) + 1];
 948     }
 949 
 950     @Test
 951     public void testDoubleArrayWithShortStoreAndRead() {
 952         test(&quot;testDoubleArrayWithShortStoreAndReadSnippet&quot;, shortValue);
 953     }
 954 
 955     public static double testDoubleArrayWithIntStoreAndReadSnippet(int v) {
 956         double[] b = new double[4];
<span class="line-modified"> 957         UNSAFE.putInt(b, doubleArrayBaseOffset, v);</span>
 958         return b[(doubleSize / intSize) + 1];
 959     }
 960 
 961     @Test
 962     public void testDoubleArrayWithIntStoreAndRead() {
 963         test(&quot;testDoubleArrayWithIntStoreAndReadSnippet&quot;, intValue);
 964     }
 965 
 966     public static double testDoubleArrayWithLongStoreAndReadSnippet(long v) {
 967         double[] b = new double[4];
<span class="line-modified"> 968         UNSAFE.putLong(b, doubleArrayBaseOffset, v);</span>
 969         return b[(doubleSize / longSize) + 1];
 970     }
 971 
 972     @Test
 973     public void testDoubleArrayWithLongStoreAndRead() {
 974         test(&quot;testDoubleArrayWithLongStoreAndReadSnippet&quot;, longValue);
 975     }
 976 
 977     public static double testDoubleArrayWithFloatStoreAndReadSnippet(float v) {
 978         double[] b = new double[4];
<span class="line-modified"> 979         UNSAFE.putFloat(b, doubleArrayBaseOffset, v);</span>
 980         return b[(doubleSize / floatSize) + 1];
 981     }
 982 
 983     @Test
 984     public void testDoubleArrayWithFloatStoreAndRead() {
 985         test(&quot;testDoubleArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
 986     }
 987 }
</pre>
</td>
</tr>
</table>
<center><a href="PartialEscapeAnalysisTreesTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="TrufflePEATest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>