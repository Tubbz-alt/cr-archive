<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.core.test/src/org/graalvm/compiler/core/test/ea/PartialEscapeUnsafeStoreTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2016, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 
 25 package org.graalvm.compiler.core.test.ea;
 26 
 27 import org.graalvm.compiler.core.test.GraalCompilerTest;
 28 import org.junit.Test;
 29 
 30 /**
 31  * Exercise a mix of unsafe and normal reads ands writes in situations where EA might attempt to
 32  * fold the operations.
 33  */
 34 public class PartialEscapeUnsafeStoreTest extends GraalCompilerTest {
 35 
 36     private static final long byteArrayBaseOffset = UNSAFE.arrayBaseOffset(byte[].class);
 37     private static byte byteValue = 0x61;
 38 
 39     public static byte[] testByteArrayWithCharStoreSnippet(char v) {
 40         byte[] b = new byte[8];
 41         UNSAFE.putChar(b, byteArrayBaseOffset, v);
 42         return b;
 43     }
 44 
 45     @Test
 46     public void testByteArrayWithCharStore() {
 47         test(&quot;testByteArrayWithCharStoreSnippet&quot;, charValue);
 48     }
 49 
 50     public static byte[] testByteArrayWithShortStoreSnippet(short v) {
 51         byte[] b = new byte[8];
 52         UNSAFE.putShort(b, byteArrayBaseOffset, v);
 53         return b;
 54     }
 55 
 56     @Test
 57     public void testByteArrayWithShortStore() {
 58         test(&quot;testByteArrayWithShortStoreSnippet&quot;, shortValue);
 59     }
 60 
 61     public static byte[] testByteArrayWithIntStoreSnippet(int v) {
 62         byte[] b = new byte[8];
 63         UNSAFE.putInt(b, byteArrayBaseOffset, v);
 64         return b;
 65     }
 66 
 67     @Test
 68     public void testByteArrayWithIntStore() {
 69         test(&quot;testByteArrayWithIntStoreSnippet&quot;, intValue);
 70     }
 71 
 72     public static byte[] testByteArrayWithLongStoreSnippet(long v) {
 73         byte[] b = new byte[8];
 74         UNSAFE.putLong(b, byteArrayBaseOffset, v);
 75         return b;
 76     }
 77 
 78     @Test
 79     public void testByteArrayWithLongStore() {
 80         test(&quot;testByteArrayWithLongStoreSnippet&quot;, longValue);
 81     }
 82 
 83     public static byte[] testByteArrayWithFloatStoreSnippet(float v) {
 84         byte[] b = new byte[8];
 85         UNSAFE.putFloat(b, byteArrayBaseOffset, v);
 86         return b;
 87     }
 88 
 89     @Test
 90     public void testByteArrayWithFloatStore() {
 91         test(&quot;testByteArrayWithFloatStoreSnippet&quot;, floatValue);
 92     }
 93 
 94     public static byte[] testByteArrayWithDoubleStoreSnippet(double v) {
 95         byte[] b = new byte[8];
 96         UNSAFE.putDouble(b, byteArrayBaseOffset, v);
 97         return b;
 98     }
 99 
100     @Test
101     public void testByteArrayWithDoubleStore() {
102         test(&quot;testByteArrayWithDoubleStoreSnippet&quot;, doubleValue);
103     }
104 
105     private static final long charArrayBaseOffset = UNSAFE.arrayBaseOffset(char[].class);
106     private static char charValue = 0x4142;
107 
108     public static char[] testCharArrayWithByteStoreSnippet(byte v) {
109         char[] b = new char[4];
110         UNSAFE.putByte(b, charArrayBaseOffset, v);
111         return b;
112     }
113 
114     @Test
115     public void testCharArrayWithByteStore() {
116         test(&quot;testCharArrayWithByteStoreSnippet&quot;, byteValue);
117     }
118 
119     public static char[] testCharArrayWithShortStoreSnippet(short v) {
120         char[] b = new char[4];
121         UNSAFE.putShort(b, charArrayBaseOffset, v);
122         return b;
123     }
124 
125     @Test
126     public void testCharArrayWithShortStore() {
127         test(&quot;testCharArrayWithShortStoreSnippet&quot;, shortValue);
128     }
129 
130     public static char[] testCharArrayWithIntStoreSnippet(int v) {
131         char[] b = new char[4];
132         UNSAFE.putInt(b, charArrayBaseOffset, v);
133         return b;
134     }
135 
136     @Test
137     public void testCharArrayWithIntStore() {
138         test(&quot;testCharArrayWithIntStoreSnippet&quot;, intValue);
139     }
140 
141     public static char[] testCharArrayWithLongStoreSnippet(long v) {
142         char[] b = new char[4];
143         UNSAFE.putLong(b, charArrayBaseOffset, v);
144         return b;
145     }
146 
147     @Test
148     public void testCharArrayWithLongStore() {
149         test(&quot;testCharArrayWithLongStoreSnippet&quot;, longValue);
150     }
151 
152     public static char[] testCharArrayWithFloatStoreSnippet(float v) {
153         char[] b = new char[4];
154         UNSAFE.putFloat(b, charArrayBaseOffset, v);
155         return b;
156     }
157 
158     @Test
159     public void testCharArrayWithFloatStore() {
160         test(&quot;testCharArrayWithFloatStoreSnippet&quot;, floatValue);
161     }
162 
163     public static char[] testCharArrayWithDoubleStoreSnippet(double v) {
164         char[] b = new char[4];
165         UNSAFE.putDouble(b, charArrayBaseOffset, v);
166         return b;
167     }
168 
169     @Test
170     public void testCharArrayWithDoubleStore() {
171         test(&quot;testCharArrayWithDoubleStoreSnippet&quot;, doubleValue);
172     }
173 
174     private static final long shortArrayBaseOffset = UNSAFE.arrayBaseOffset(short[].class);
175     private static short shortValue = 0x1112;
176 
177     public static short[] testShortArrayWithByteStoreSnippet(byte v) {
178         short[] b = new short[4];
179         UNSAFE.putByte(b, shortArrayBaseOffset, v);
180         return b;
181     }
182 
183     @Test
184     public void testShortArrayWithByteStore() {
185         test(&quot;testShortArrayWithByteStoreSnippet&quot;, byteValue);
186     }
187 
188     public static short[] testShortArrayWithCharStoreSnippet(char v) {
189         short[] b = new short[4];
190         UNSAFE.putChar(b, shortArrayBaseOffset, v);
191         return b;
192     }
193 
194     @Test
195     public void testShortArrayWithCharStore() {
196         test(&quot;testShortArrayWithCharStoreSnippet&quot;, charValue);
197     }
198 
199     public static short[] testShortArrayWithIntStoreSnippet(int v) {
200         short[] b = new short[4];
201         UNSAFE.putInt(b, shortArrayBaseOffset, v);
202         return b;
203     }
204 
205     @Test
206     public void testShortArrayWithIntStore() {
207         test(&quot;testShortArrayWithIntStoreSnippet&quot;, intValue);
208     }
209 
210     public static short[] testShortArrayWithLongStoreSnippet(long v) {
211         short[] b = new short[4];
212         UNSAFE.putLong(b, shortArrayBaseOffset, v);
213         return b;
214     }
215 
216     @Test
217     public void testShortArrayWithLongStore() {
218         test(&quot;testShortArrayWithLongStoreSnippet&quot;, longValue);
219     }
220 
221     public static short[] testShortArrayWithFloatStoreSnippet(float v) {
222         short[] b = new short[4];
223         UNSAFE.putFloat(b, shortArrayBaseOffset, v);
224         return b;
225     }
226 
227     @Test
228     public void testShortArrayWithFloatStore() {
229         test(&quot;testShortArrayWithFloatStoreSnippet&quot;, floatValue);
230     }
231 
232     public static short[] testShortArrayWithDoubleStoreSnippet(double v) {
233         short[] b = new short[4];
234         UNSAFE.putDouble(b, shortArrayBaseOffset, v);
235         return b;
236     }
237 
238     @Test
239     public void testShortArrayWithDoubleStore() {
240         test(&quot;testShortArrayWithDoubleStoreSnippet&quot;, doubleValue);
241     }
242 
243     private static final long intArrayBaseOffset = UNSAFE.arrayBaseOffset(int[].class);
244     private static int intValue = 0x01020304;
245 
246     public static int[] testIntArrayWithByteStoreSnippet(byte v) {
247         int[] b = new int[4];
248         UNSAFE.putByte(b, intArrayBaseOffset, v);
249         return b;
250     }
251 
252     @Test
253     public void testIntArrayWithByteStore() {
254         test(&quot;testIntArrayWithByteStoreSnippet&quot;, byteValue);
255     }
256 
257     public static int[] testIntArrayWithCharStoreSnippet(char v) {
258         int[] b = new int[4];
259         UNSAFE.putChar(b, intArrayBaseOffset, v);
260         return b;
261     }
262 
263     @Test
264     public void testIntArrayWithCharStore() {
265         test(&quot;testIntArrayWithCharStoreSnippet&quot;, charValue);
266     }
267 
268     public static int[] testIntArrayWithShortStoreSnippet(short v) {
269         int[] b = new int[4];
270         UNSAFE.putShort(b, intArrayBaseOffset, v);
271         return b;
272     }
273 
274     @Test
275     public void testIntArrayWithShortStore() {
276         test(&quot;testIntArrayWithShortStoreSnippet&quot;, shortValue);
277     }
278 
279     public static int[] testIntArrayWithLongStoreSnippet(long v) {
280         int[] b = new int[4];
281         UNSAFE.putLong(b, intArrayBaseOffset, v);
282         return b;
283     }
284 
285     @Test
286     public void testIntArrayWithLongStore() {
287         test(&quot;testIntArrayWithLongStoreSnippet&quot;, longValue);
288     }
289 
290     public static int[] testIntArrayWithFloatStoreSnippet(float v) {
291         int[] b = new int[4];
292         UNSAFE.putFloat(b, intArrayBaseOffset, v);
293         return b;
294     }
295 
296     @Test
297     public void testIntArrayWithFloatStore() {
298         test(&quot;testIntArrayWithFloatStoreSnippet&quot;, floatValue);
299     }
300 
301     public static int[] testIntArrayWithDoubleStoreSnippet(double v) {
302         int[] b = new int[4];
303         UNSAFE.putDouble(b, intArrayBaseOffset, v);
304         return b;
305     }
306 
307     @Test
308     public void testIntArrayWithDoubleStore() {
309         test(&quot;testIntArrayWithDoubleStoreSnippet&quot;, doubleValue);
310     }
311 
312     private static final long longArrayBaseOffset = UNSAFE.arrayBaseOffset(long[].class);
313     private static long longValue = 0x31323334353637L;
314 
315     public static long[] testLongArrayWithByteStoreSnippet(byte v) {
316         long[] b = new long[4];
317         UNSAFE.putByte(b, longArrayBaseOffset, v);
318         return b;
319     }
320 
321     @Test
322     public void testLongArrayWithByteStore() {
323         test(&quot;testLongArrayWithByteStoreSnippet&quot;, byteValue);
324     }
325 
326     public static long[] testLongArrayWithCharStoreSnippet(char v) {
327         long[] b = new long[4];
328         UNSAFE.putChar(b, longArrayBaseOffset, v);
329         return b;
330     }
331 
332     @Test
333     public void testLongArrayWithCharStore() {
334         test(&quot;testLongArrayWithCharStoreSnippet&quot;, charValue);
335     }
336 
337     public static long[] testLongArrayWithShortStoreSnippet(short v) {
338         long[] b = new long[4];
339         UNSAFE.putShort(b, longArrayBaseOffset, v);
340         return b;
341     }
342 
343     @Test
344     public void testLongArrayWithShortStore() {
345         test(&quot;testLongArrayWithShortStoreSnippet&quot;, shortValue);
346     }
347 
348     public static long[] testLongArrayWithIntStoreSnippet(int v) {
349         long[] b = new long[4];
350         UNSAFE.putInt(b, longArrayBaseOffset, v);
351         return b;
352     }
353 
354     @Test
355     public void testLongArrayWithIntStore() {
356         test(&quot;testLongArrayWithIntStoreSnippet&quot;, intValue);
357     }
358 
359     public static long[] testLongArrayWithFloatStoreSnippet(float v) {
360         long[] b = new long[4];
361         UNSAFE.putFloat(b, longArrayBaseOffset, v);
362         return b;
363     }
364 
365     @Test
366     public void testLongArrayWithFloatStore() {
367         test(&quot;testLongArrayWithFloatStoreSnippet&quot;, floatValue);
368     }
369 
370     public static long[] testLongArrayWithDoubleStoreSnippet(double v) {
371         long[] b = new long[4];
372         UNSAFE.putDouble(b, longArrayBaseOffset, v);
373         return b;
374     }
375 
376     @Test
377     public void testLongArrayWithDoubleStore() {
378         test(&quot;testLongArrayWithDoubleStoreSnippet&quot;, doubleValue);
379     }
380 
381     private static final long floatArrayBaseOffset = UNSAFE.arrayBaseOffset(float[].class);
382     private static float floatValue = Float.NaN;
383 
384     public static float[] testFloatArrayWithByteStoreSnippet(byte v) {
385         float[] b = new float[4];
386         UNSAFE.putByte(b, floatArrayBaseOffset, v);
387         return b;
388     }
389 
390     @Test
391     public void testFloatArrayWithByteStore() {
392         test(&quot;testFloatArrayWithByteStoreSnippet&quot;, byteValue);
393     }
394 
395     public static float[] testFloatArrayWithCharStoreSnippet(char v) {
396         float[] b = new float[4];
397         UNSAFE.putChar(b, floatArrayBaseOffset, v);
398         return b;
399     }
400 
401     @Test
402     public void testFloatArrayWithCharStore() {
403         test(&quot;testFloatArrayWithCharStoreSnippet&quot;, charValue);
404     }
405 
406     public static float[] testFloatArrayWithShortStoreSnippet(short v) {
407         float[] b = new float[4];
408         UNSAFE.putShort(b, floatArrayBaseOffset, v);
409         return b;
410     }
411 
412     @Test
413     public void testFloatArrayWithShortStore() {
414         test(&quot;testFloatArrayWithShortStoreSnippet&quot;, shortValue);
415     }
416 
417     public static float[] testFloatArrayWithIntStoreSnippet(int v) {
418         float[] b = new float[4];
419         UNSAFE.putInt(b, floatArrayBaseOffset, v);
420         return b;
421     }
422 
423     @Test
424     public void testFloatArrayWithIntStore() {
425         test(&quot;testFloatArrayWithIntStoreSnippet&quot;, intValue);
426     }
427 
428     public static float[] testFloatArrayWithLongStoreSnippet(long v) {
429         float[] b = new float[4];
430         UNSAFE.putLong(b, floatArrayBaseOffset, v);
431         return b;
432     }
433 
434     @Test
435     public void testFloatArrayWithLongStore() {
436         test(&quot;testFloatArrayWithLongStoreSnippet&quot;, longValue);
437     }
438 
439     public static float[] testFloatArrayWithDoubleStoreSnippet(double v) {
440         float[] b = new float[4];
441         UNSAFE.putDouble(b, floatArrayBaseOffset, v);
442         return b;
443     }
444 
445     @Test
446     public void testFloatArrayWithDoubleStore() {
447         test(&quot;testFloatArrayWithDoubleStoreSnippet&quot;, doubleValue);
448     }
449 
450     private static final long doubleArrayBaseOffset = UNSAFE.arrayBaseOffset(double[].class);
451     private static double doubleValue = Double.NaN;
452     private static final int byteSize = 1;
453     private static final int charSize = 2;
454     private static final int shortSize = 2;
455     private static final int intSize = 4;
456     private static final int floatSize = 4;
457     private static final int longSize = 8;
458     private static final int doubleSize = 8;
459 
460     public static double[] testDoubleArrayWithByteStoreSnippet(byte v) {
461         double[] b = new double[4];
462         UNSAFE.putByte(b, doubleArrayBaseOffset, v);
463         return b;
464     }
465 
466     @Test
467     public void testDoubleArrayWithByteStore() {
468         test(&quot;testDoubleArrayWithByteStoreSnippet&quot;, byteValue);
469     }
470 
471     public static double[] testDoubleArrayWithCharStoreSnippet(char v) {
472         double[] b = new double[4];
473         UNSAFE.putChar(b, doubleArrayBaseOffset, v);
474         return b;
475     }
476 
477     @Test
478     public void testDoubleArrayWithCharStore() {
479         test(&quot;testDoubleArrayWithCharStoreSnippet&quot;, charValue);
480     }
481 
482     public static double[] testDoubleArrayWithShortStoreSnippet(short v) {
483         double[] b = new double[4];
484         UNSAFE.putShort(b, doubleArrayBaseOffset, v);
485         return b;
486     }
487 
488     @Test
489     public void testDoubleArrayWithShortStore() {
490         test(&quot;testDoubleArrayWithShortStoreSnippet&quot;, shortValue);
491     }
492 
493     public static double[] testDoubleArrayWithIntStoreSnippet(int v) {
494         double[] b = new double[4];
495         UNSAFE.putInt(b, doubleArrayBaseOffset, v);
496         return b;
497     }
498 
499     @Test
500     public void testDoubleArrayWithIntStore() {
501         test(&quot;testDoubleArrayWithIntStoreSnippet&quot;, intValue);
502     }
503 
504     public static double[] testDoubleArrayWithLongStoreSnippet(long v) {
505         double[] b = new double[4];
506         UNSAFE.putLong(b, doubleArrayBaseOffset, v);
507         return b;
508     }
509 
510     @Test
511     public void testDoubleArrayWithLongStore() {
512         test(&quot;testDoubleArrayWithLongStoreSnippet&quot;, longValue);
513     }
514 
515     public static double[] testDoubleArrayWithFloatStoreSnippet(float v) {
516         double[] b = new double[4];
517         UNSAFE.putFloat(b, doubleArrayBaseOffset, v);
518         return b;
519     }
520 
521     @Test
522     public void testDoubleArrayWithFloatStore() {
523         test(&quot;testDoubleArrayWithFloatStoreSnippet&quot;, floatValue);
524     }
525 
526     public static byte testByteArrayWithCharStoreAndReadSnippet(char v) {
527         byte[] b = new byte[4];
528         UNSAFE.putChar(b, byteArrayBaseOffset, v);
529         return b[(byteSize / charSize) + 1];
530     }
531 
532     @Test
533     public void testByteArrayWithCharStoreAndRead() {
534         test(&quot;testByteArrayWithCharStoreAndReadSnippet&quot;, charValue);
535     }
536 
537     public static byte testByteArrayWithShortStoreAndReadSnippet(short v) {
538         byte[] b = new byte[4];
539         UNSAFE.putShort(b, byteArrayBaseOffset, v);
540         return b[(byteSize / shortSize) + 1];
541     }
542 
543     @Test
544     public void testByteArrayWithShortStoreAndRead() {
545         test(&quot;testByteArrayWithShortStoreAndReadSnippet&quot;, shortValue);
546     }
547 
548     public static byte testByteArrayWithIntStoreAndReadSnippet(int v) {
549         byte[] b = new byte[4];
550         UNSAFE.putInt(b, byteArrayBaseOffset, v);
551         return b[(byteSize / intSize) + 1];
552     }
553 
554     @Test
555     public void testByteArrayWithIntStoreAndRead() {
556         test(&quot;testByteArrayWithIntStoreAndReadSnippet&quot;, intValue);
557     }
558 
559     public static byte testByteArrayWithLongStoreAndReadSnippet(long v) {
560         byte[] b = new byte[4];
561         UNSAFE.putLong(b, byteArrayBaseOffset, v);
562         return b[(byteSize / longSize) + 1];
563     }
564 
565     @Test
566     public void testByteArrayWithLongStoreAndRead() {
567         test(&quot;testByteArrayWithLongStoreAndReadSnippet&quot;, longValue);
568     }
569 
570     public static byte testByteArrayWithFloatStoreAndReadSnippet(float v) {
571         byte[] b = new byte[4];
572         UNSAFE.putFloat(b, byteArrayBaseOffset, v);
573         return b[(byteSize / floatSize) + 1];
574     }
575 
576     @Test
577     public void testByteArrayWithFloatStoreAndRead() {
578         test(&quot;testByteArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
579     }
580 
581     public static byte testByteArrayWithDoubleStoreAndReadSnippet(double v) {
582         byte[] b = new byte[4];
583         UNSAFE.putDouble(b, byteArrayBaseOffset, v);
584         return b[(byteSize / doubleSize) + 1];
585     }
586 
587     @Test
588     public void testByteArrayWithDoubleStoreAndRead() {
589         test(&quot;testByteArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
590     }
591 
592     public static char testCharArrayWithByteStoreAndReadSnippet(byte v) {
593         char[] b = new char[4];
594         UNSAFE.putByte(b, charArrayBaseOffset, v);
595         return b[(charSize / byteSize) + 1];
596     }
597 
598     @Test
599     public void testCharArrayWithByteStoreAndRead() {
600         test(&quot;testCharArrayWithByteStoreAndReadSnippet&quot;, byteValue);
601     }
602 
603     public static char testCharArrayWithShortStoreAndReadSnippet(short v) {
604         char[] b = new char[4];
605         UNSAFE.putShort(b, charArrayBaseOffset, v);
606         return b[(charSize / shortSize) + 1];
607     }
608 
609     @Test
610     public void testCharArrayWithShortStoreAndRead() {
611         test(&quot;testCharArrayWithShortStoreAndReadSnippet&quot;, shortValue);
612     }
613 
614     public static char testCharArrayWithIntStoreAndReadSnippet(int v) {
615         char[] b = new char[4];
616         UNSAFE.putInt(b, charArrayBaseOffset, v);
617         return b[(charSize / intSize) + 1];
618     }
619 
620     @Test
621     public void testCharArrayWithIntStoreAndRead() {
622         test(&quot;testCharArrayWithIntStoreAndReadSnippet&quot;, intValue);
623     }
624 
625     public static char testCharArrayWithLongStoreAndReadSnippet(long v) {
626         char[] b = new char[4];
627         UNSAFE.putLong(b, charArrayBaseOffset, v);
628         return b[(charSize / longSize) + 1];
629     }
630 
631     @Test
632     public void testCharArrayWithLongStoreAndRead() {
633         test(&quot;testCharArrayWithLongStoreAndReadSnippet&quot;, longValue);
634     }
635 
636     public static char testCharArrayWithFloatStoreAndReadSnippet(float v) {
637         char[] b = new char[4];
638         UNSAFE.putFloat(b, charArrayBaseOffset, v);
639         return b[(charSize / floatSize) + 1];
640     }
641 
642     @Test
643     public void testCharArrayWithFloatStoreAndRead() {
644         test(&quot;testCharArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
645     }
646 
647     public static char testCharArrayWithDoubleStoreAndReadSnippet(double v) {
648         char[] b = new char[4];
649         UNSAFE.putDouble(b, charArrayBaseOffset, v);
650         return b[(charSize / doubleSize) + 1];
651     }
652 
653     @Test
654     public void testCharArrayWithDoubleStoreAndRead() {
655         test(&quot;testCharArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
656     }
657 
658     public static short testShortArrayWithByteStoreAndReadSnippet(byte v) {
659         short[] b = new short[4];
660         UNSAFE.putByte(b, shortArrayBaseOffset, v);
661         return b[(shortSize / byteSize) + 1];
662     }
663 
664     @Test
665     public void testShortArrayWithByteStoreAndRead() {
666         test(&quot;testShortArrayWithByteStoreAndReadSnippet&quot;, byteValue);
667     }
668 
669     public static short testShortArrayWithCharStoreAndReadSnippet(char v) {
670         short[] b = new short[4];
671         UNSAFE.putChar(b, shortArrayBaseOffset, v);
672         return b[(shortSize / charSize) + 1];
673     }
674 
675     @Test
676     public void testShortArrayWithCharStoreAndRead() {
677         test(&quot;testShortArrayWithCharStoreAndReadSnippet&quot;, charValue);
678     }
679 
680     public static short testShortArrayWithIntStoreAndReadSnippet(int v) {
681         short[] b = new short[4];
682         UNSAFE.putInt(b, shortArrayBaseOffset, v);
683         return b[(shortSize / intSize) + 1];
684     }
685 
686     @Test
687     public void testShortArrayWithIntStoreAndRead() {
688         test(&quot;testShortArrayWithIntStoreAndReadSnippet&quot;, intValue);
689     }
690 
691     public static short testShortArrayWithLongStoreAndReadSnippet(long v) {
692         short[] b = new short[4];
693         UNSAFE.putLong(b, shortArrayBaseOffset, v);
694         return b[(shortSize / longSize) + 1];
695     }
696 
697     @Test
698     public void testShortArrayWithLongStoreAndRead() {
699         test(&quot;testShortArrayWithLongStoreAndReadSnippet&quot;, longValue);
700     }
701 
702     public static short testShortArrayWithFloatStoreAndReadSnippet(float v) {
703         short[] b = new short[4];
704         UNSAFE.putFloat(b, shortArrayBaseOffset, v);
705         return b[(shortSize / floatSize) + 1];
706     }
707 
708     @Test
709     public void testShortArrayWithFloatStoreAndRead() {
710         test(&quot;testShortArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
711     }
712 
713     public static short testShortArrayWithDoubleStoreAndReadSnippet(double v) {
714         short[] b = new short[4];
715         UNSAFE.putDouble(b, shortArrayBaseOffset, v);
716         return b[(shortSize / doubleSize) + 1];
717     }
718 
719     @Test
720     public void testShortArrayWithDoubleStoreAndRead() {
721         test(&quot;testShortArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
722     }
723 
724     public static int testIntArrayWithByteStoreAndReadSnippet(byte v) {
725         int[] b = new int[4];
726         UNSAFE.putByte(b, intArrayBaseOffset, v);
727         return b[(intSize / byteSize) + 1];
728     }
729 
730     @Test
731     public void testIntArrayWithByteStoreAndRead() {
732         test(&quot;testIntArrayWithByteStoreAndReadSnippet&quot;, byteValue);
733     }
734 
735     public static int testIntArrayWithCharStoreAndReadSnippet(char v) {
736         int[] b = new int[4];
737         UNSAFE.putChar(b, intArrayBaseOffset, v);
738         return b[(intSize / charSize) + 1];
739     }
740 
741     @Test
742     public void testIntArrayWithCharStoreAndRead() {
743         test(&quot;testIntArrayWithCharStoreAndReadSnippet&quot;, charValue);
744     }
745 
746     public static int testIntArrayWithShortStoreAndReadSnippet(short v) {
747         int[] b = new int[4];
748         UNSAFE.putShort(b, intArrayBaseOffset, v);
749         return b[(intSize / shortSize) + 1];
750     }
751 
752     @Test
753     public void testIntArrayWithShortStoreAndRead() {
754         test(&quot;testIntArrayWithShortStoreAndReadSnippet&quot;, shortValue);
755     }
756 
757     public static int testIntArrayWithLongStoreAndReadSnippet(long v) {
758         int[] b = new int[4];
759         UNSAFE.putLong(b, intArrayBaseOffset, v);
760         return b[(intSize / longSize) + 1];
761     }
762 
763     @Test
764     public void testIntArrayWithLongStoreAndRead() {
765         test(&quot;testIntArrayWithLongStoreAndReadSnippet&quot;, longValue);
766     }
767 
768     public static int testIntArrayWithFloatStoreAndReadSnippet(float v) {
769         int[] b = new int[4];
770         UNSAFE.putFloat(b, intArrayBaseOffset, v);
771         return b[(intSize / floatSize) + 1];
772     }
773 
774     @Test
775     public void testIntArrayWithFloatStoreAndRead() {
776         test(&quot;testIntArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
777     }
778 
779     public static int testIntArrayWithDoubleStoreAndReadSnippet(double v) {
780         int[] b = new int[4];
781         UNSAFE.putDouble(b, intArrayBaseOffset, v);
782         return b[(intSize / doubleSize) + 1];
783     }
784 
785     @Test
786     public void testIntArrayWithDoubleStoreAndRead() {
787         test(&quot;testIntArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
788     }
789 
790     public static long testLongArrayWithByteStoreAndReadSnippet(byte v) {
791         long[] b = new long[4];
792         UNSAFE.putByte(b, longArrayBaseOffset, v);
793         return b[(longSize / byteSize) + 1];
794     }
795 
796     @Test
797     public void testLongArrayWithByteStoreAndRead() {
798         test(&quot;testLongArrayWithByteStoreAndReadSnippet&quot;, byteValue);
799     }
800 
801     public static long testLongArrayWithCharStoreAndReadSnippet(char v) {
802         long[] b = new long[4];
803         UNSAFE.putChar(b, longArrayBaseOffset, v);
804         return b[(longSize / charSize) + 1];
805     }
806 
807     @Test
808     public void testLongArrayWithCharStoreAndRead() {
809         test(&quot;testLongArrayWithCharStoreAndReadSnippet&quot;, charValue);
810     }
811 
812     public static long testLongArrayWithShortStoreAndReadSnippet(short v) {
813         long[] b = new long[4];
814         UNSAFE.putShort(b, longArrayBaseOffset, v);
815         return b[(longSize / shortSize) + 1];
816     }
817 
818     @Test
819     public void testLongArrayWithShortStoreAndRead() {
820         test(&quot;testLongArrayWithShortStoreAndReadSnippet&quot;, shortValue);
821     }
822 
823     public static long testLongArrayWithIntStoreAndReadSnippet(int v) {
824         long[] b = new long[4];
825         UNSAFE.putInt(b, longArrayBaseOffset, v);
826         return b[(longSize / intSize) + 1];
827     }
828 
829     @Test
830     public void testLongArrayWithIntStoreAndRead() {
831         test(&quot;testLongArrayWithIntStoreAndReadSnippet&quot;, intValue);
832     }
833 
834     public static long testLongArrayWithFloatStoreAndReadSnippet(float v) {
835         long[] b = new long[4];
836         UNSAFE.putFloat(b, longArrayBaseOffset, v);
837         return b[(longSize / floatSize) + 1];
838     }
839 
840     @Test
841     public void testLongArrayWithFloatStoreAndRead() {
842         test(&quot;testLongArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
843     }
844 
845     public static long testLongArrayWithDoubleStoreAndReadSnippet(double v) {
846         long[] b = new long[4];
847         UNSAFE.putDouble(b, longArrayBaseOffset, v);
848         return b[(longSize / doubleSize) + 1];
849     }
850 
851     @Test
852     public void testLongArrayWithDoubleStoreAndRead() {
853         test(&quot;testLongArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
854     }
855 
856     public static float testFloatArrayWithByteStoreAndReadSnippet(byte v) {
857         float[] b = new float[4];
858         UNSAFE.putByte(b, floatArrayBaseOffset, v);
859         return b[(floatSize / byteSize) + 1];
860     }
861 
862     @Test
863     public void testFloatArrayWithByteStoreAndRead() {
864         test(&quot;testFloatArrayWithByteStoreAndReadSnippet&quot;, byteValue);
865     }
866 
867     public static float testFloatArrayWithCharStoreAndReadSnippet(char v) {
868         float[] b = new float[4];
869         UNSAFE.putChar(b, floatArrayBaseOffset, v);
870         return b[(floatSize / charSize) + 1];
871     }
872 
873     @Test
874     public void testFloatArrayWithCharStoreAndRead() {
875         test(&quot;testFloatArrayWithCharStoreAndReadSnippet&quot;, charValue);
876     }
877 
878     public static float testFloatArrayWithShortStoreAndReadSnippet(short v) {
879         float[] b = new float[4];
880         UNSAFE.putShort(b, floatArrayBaseOffset, v);
881         return b[(floatSize / shortSize) + 1];
882     }
883 
884     @Test
885     public void testFloatArrayWithShortStoreAndRead() {
886         test(&quot;testFloatArrayWithShortStoreAndReadSnippet&quot;, shortValue);
887     }
888 
889     public static float testFloatArrayWithIntStoreAndReadSnippet(int v) {
890         float[] b = new float[4];
891         UNSAFE.putInt(b, floatArrayBaseOffset, v);
892         return b[(floatSize / intSize) + 1];
893     }
894 
895     @Test
896     public void testFloatArrayWithIntStoreAndRead() {
897         test(&quot;testFloatArrayWithIntStoreAndReadSnippet&quot;, intValue);
898     }
899 
900     public static float testFloatArrayWithLongStoreAndReadSnippet(long v) {
901         float[] b = new float[4];
902         UNSAFE.putLong(b, floatArrayBaseOffset, v);
903         return b[(floatSize / longSize) + 1];
904     }
905 
906     @Test
907     public void testFloatArrayWithLongStoreAndRead() {
908         test(&quot;testFloatArrayWithLongStoreAndReadSnippet&quot;, longValue);
909     }
910 
911     public static float testFloatArrayWithDoubleStoreAndReadSnippet(double v) {
912         float[] b = new float[4];
913         UNSAFE.putDouble(b, floatArrayBaseOffset, v);
914         return b[(floatSize / doubleSize) + 1];
915     }
916 
917     @Test
918     public void testFloatArrayWithDoubleStoreAndRead() {
919         test(&quot;testFloatArrayWithDoubleStoreAndReadSnippet&quot;, doubleValue);
920     }
921 
922     public static double testDoubleArrayWithByteStoreAndReadSnippet(byte v) {
923         double[] b = new double[4];
924         UNSAFE.putByte(b, doubleArrayBaseOffset, v);
925         return b[(doubleSize / byteSize) + 1];
926     }
927 
928     @Test
929     public void testDoubleArrayWithByteStoreAndRead() {
930         test(&quot;testDoubleArrayWithByteStoreAndReadSnippet&quot;, byteValue);
931     }
932 
933     public static double testDoubleArrayWithCharStoreAndReadSnippet(char v) {
934         double[] b = new double[4];
935         UNSAFE.putChar(b, doubleArrayBaseOffset, v);
936         return b[(doubleSize / charSize) + 1];
937     }
938 
939     @Test
940     public void testDoubleArrayWithCharStoreAndRead() {
941         test(&quot;testDoubleArrayWithCharStoreAndReadSnippet&quot;, charValue);
942     }
943 
944     public static double testDoubleArrayWithShortStoreAndReadSnippet(short v) {
945         double[] b = new double[4];
946         UNSAFE.putShort(b, doubleArrayBaseOffset, v);
947         return b[(doubleSize / shortSize) + 1];
948     }
949 
950     @Test
951     public void testDoubleArrayWithShortStoreAndRead() {
952         test(&quot;testDoubleArrayWithShortStoreAndReadSnippet&quot;, shortValue);
953     }
954 
955     public static double testDoubleArrayWithIntStoreAndReadSnippet(int v) {
956         double[] b = new double[4];
957         UNSAFE.putInt(b, doubleArrayBaseOffset, v);
958         return b[(doubleSize / intSize) + 1];
959     }
960 
961     @Test
962     public void testDoubleArrayWithIntStoreAndRead() {
963         test(&quot;testDoubleArrayWithIntStoreAndReadSnippet&quot;, intValue);
964     }
965 
966     public static double testDoubleArrayWithLongStoreAndReadSnippet(long v) {
967         double[] b = new double[4];
968         UNSAFE.putLong(b, doubleArrayBaseOffset, v);
969         return b[(doubleSize / longSize) + 1];
970     }
971 
972     @Test
973     public void testDoubleArrayWithLongStoreAndRead() {
974         test(&quot;testDoubleArrayWithLongStoreAndReadSnippet&quot;, longValue);
975     }
976 
977     public static double testDoubleArrayWithFloatStoreAndReadSnippet(float v) {
978         double[] b = new double[4];
979         UNSAFE.putFloat(b, doubleArrayBaseOffset, v);
980         return b[(doubleSize / floatSize) + 1];
981     }
982 
983     @Test
984     public void testDoubleArrayWithFloatStoreAndRead() {
985         test(&quot;testDoubleArrayWithFloatStoreAndReadSnippet&quot;, floatValue);
986     }
987 }
    </pre>
  </body>
</html>