<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.asm.amd64/src/org/graalvm/compiler/asm/amd64/AMD64Address.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../org.graalvm.compiler.asm.aarch64/src/org/graalvm/compiler/asm/aarch64/AArch64MacroAssembler.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="AMD64Assembler.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.asm.amd64/src/org/graalvm/compiler/asm/amd64/AMD64Address.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2010, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 
 25 package org.graalvm.compiler.asm.amd64;
 26 
<span class="line-removed"> 27 import jdk.vm.ci.code.Register;</span>
<span class="line-removed"> 28 </span>
 29 import org.graalvm.compiler.asm.AbstractAddress;




 30 
 31 /**
 32  * Represents an address in target machine memory, specified via some combination of a base
 33  * register, an index register, a displacement and a scale. Note that the base and index registers
 34  * may be a variable that will get a register assigned later by the register allocator.
 35  */
 36 public final class AMD64Address extends AbstractAddress {
 37 
 38     private final Register base;
 39     private final Register index;
 40     private final Scale scale;
 41     private final int displacement;
 42 
 43     /**
 44      * The start of the instruction, i.e., the value that is used as the key for looking up
 45      * placeholder patching information. Only used for {@link AMD64Assembler#getPlaceholder
 46      * placeholder addresses}.
 47      */
 48     final int instructionStartPosition;
 49 
</pre>
<hr />
<pre>
109         Times1(1, 0),
110         Times2(2, 1),
111         Times4(4, 2),
112         Times8(8, 3);
113 
114         Scale(int value, int log2) {
115             this.value = value;
116             this.log2 = log2;
117         }
118 
119         /**
120          * The value (or multiplier) of this scale.
121          */
122         public final int value;
123 
124         /**
125          * The {@linkplain #value value} of this scale log 2.
126          */
127         public final int log2;
128 





129         public static Scale fromInt(int scale) {
130             switch (scale) {
131                 case 1:
132                     return Times1;
133                 case 2:
134                     return Times2;
135                 case 4:
136                     return Times4;
137                 case 8:
138                     return Times8;
139                 default:
<span class="line-modified">140                     return null;</span>
141             }
142         }
143 





144         public static Scale fromShift(int shift) {
145             switch (shift) {
146                 case 0:
147                     return Times1;
148                 case 1:
149                     return Times2;
150                 case 2:
151                     return Times4;
152                 case 3:
153                     return Times8;
154                 default:
<span class="line-modified">155                     return null;</span>
156             }
157         }














158     }
159 
160     @Override
161     public String toString() {
162         StringBuilder s = new StringBuilder();
163         s.append(&quot;[&quot;);
164         String sep = &quot;&quot;;
165         if (!getBase().equals(Register.None)) {
166             s.append(getBase());
167             sep = &quot; + &quot;;
168         }
169         if (!getIndex().equals(Register.None)) {
170             s.append(sep).append(getIndex()).append(&quot; * &quot;).append(getScale().value);
171             sep = &quot; + &quot;;
172         }
173         if (getDisplacement() &lt; 0) {
174             s.append(&quot; - &quot;).append(-getDisplacement());
175         } else if (getDisplacement() &gt; 0) {
176             s.append(sep).append(getDisplacement());
177         }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2010, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 
 25 package org.graalvm.compiler.asm.amd64;
 26 


 27 import org.graalvm.compiler.asm.AbstractAddress;
<span class="line-added"> 28 import org.graalvm.compiler.debug.GraalError;</span>
<span class="line-added"> 29 </span>
<span class="line-added"> 30 import jdk.vm.ci.code.CodeUtil;</span>
<span class="line-added"> 31 import jdk.vm.ci.code.Register;</span>
 32 
 33 /**
 34  * Represents an address in target machine memory, specified via some combination of a base
 35  * register, an index register, a displacement and a scale. Note that the base and index registers
 36  * may be a variable that will get a register assigned later by the register allocator.
 37  */
 38 public final class AMD64Address extends AbstractAddress {
 39 
 40     private final Register base;
 41     private final Register index;
 42     private final Scale scale;
 43     private final int displacement;
 44 
 45     /**
 46      * The start of the instruction, i.e., the value that is used as the key for looking up
 47      * placeholder patching information. Only used for {@link AMD64Assembler#getPlaceholder
 48      * placeholder addresses}.
 49      */
 50     final int instructionStartPosition;
 51 
</pre>
<hr />
<pre>
111         Times1(1, 0),
112         Times2(2, 1),
113         Times4(4, 2),
114         Times8(8, 3);
115 
116         Scale(int value, int log2) {
117             this.value = value;
118             this.log2 = log2;
119         }
120 
121         /**
122          * The value (or multiplier) of this scale.
123          */
124         public final int value;
125 
126         /**
127          * The {@linkplain #value value} of this scale log 2.
128          */
129         public final int log2;
130 
<span class="line-added">131         /**</span>
<span class="line-added">132          * Creates a {@link Scale} for the scaling factor in {@code scale}.</span>
<span class="line-added">133          *</span>
<span class="line-added">134          * @throws IllegalArgumentException if {@code scale} is an unsupported scaling factor</span>
<span class="line-added">135          */</span>
136         public static Scale fromInt(int scale) {
137             switch (scale) {
138                 case 1:
139                     return Times1;
140                 case 2:
141                     return Times2;
142                 case 4:
143                     return Times4;
144                 case 8:
145                     return Times8;
146                 default:
<span class="line-modified">147                     throw new IllegalArgumentException(&quot;Unsupported SIB addressing mode scaling factor: &quot; + scale);</span>
148             }
149         }
150 
<span class="line-added">151         /**</span>
<span class="line-added">152          * Creates a {@link Scale} for the log2 scaling factor {@code shift}.</span>
<span class="line-added">153          *</span>
<span class="line-added">154          * @throws IllegalArgumentException if {@code shift} is an unsupported scaling factor</span>
<span class="line-added">155          */</span>
156         public static Scale fromShift(int shift) {
157             switch (shift) {
158                 case 0:
159                     return Times1;
160                 case 1:
161                     return Times2;
162                 case 2:
163                     return Times4;
164                 case 3:
165                     return Times8;
166                 default:
<span class="line-modified">167                     throw GraalError.shouldNotReachHere(&quot;Unsupported SIB addressing mode scaling factor: &quot; + (1 &lt;&lt; shift));</span>
168             }
169         }
<span class="line-added">170 </span>
<span class="line-added">171         /**</span>
<span class="line-added">172          * Determines if the scaling factor {@code scale} is supported.</span>
<span class="line-added">173          */</span>
<span class="line-added">174         public static boolean isScaleSupported(int scale) {</span>
<span class="line-added">175             return CodeUtil.isPowerOf2(scale) &amp;&amp; scale &lt;= 8;</span>
<span class="line-added">176         }</span>
<span class="line-added">177 </span>
<span class="line-added">178         /**</span>
<span class="line-added">179          * Determines if the log2 scaling factor {@code shift} is supported.</span>
<span class="line-added">180          */</span>
<span class="line-added">181         public static boolean isScaleShiftSupported(int shift) {</span>
<span class="line-added">182             return shift &gt;= 0 &amp;&amp; shift &lt;= 3;</span>
<span class="line-added">183         }</span>
184     }
185 
186     @Override
187     public String toString() {
188         StringBuilder s = new StringBuilder();
189         s.append(&quot;[&quot;);
190         String sep = &quot;&quot;;
191         if (!getBase().equals(Register.None)) {
192             s.append(getBase());
193             sep = &quot; + &quot;;
194         }
195         if (!getIndex().equals(Register.None)) {
196             s.append(sep).append(getIndex()).append(&quot; * &quot;).append(getScale().value);
197             sep = &quot; + &quot;;
198         }
199         if (getDisplacement() &lt; 0) {
200             s.append(&quot; - &quot;).append(-getDisplacement());
201         } else if (getDisplacement() &gt; 0) {
202             s.append(sep).append(getDisplacement());
203         }
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../org.graalvm.compiler.asm.aarch64/src/org/graalvm/compiler/asm/aarch64/AArch64MacroAssembler.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="AMD64Assembler.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>