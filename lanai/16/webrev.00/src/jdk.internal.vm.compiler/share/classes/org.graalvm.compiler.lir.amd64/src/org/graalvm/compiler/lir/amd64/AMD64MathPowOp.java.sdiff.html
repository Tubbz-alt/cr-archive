<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.lir.amd64/src/org/graalvm/compiler/lir/amd64/AMD64MathPowOp.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AMD64MathLogOp.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="AMD64MathSinOp.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.lir.amd64/src/org/graalvm/compiler/lir/amd64/AMD64MathPowOp.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * Copyright (c) 2016, Intel Corporation. All rights reserved.
   4  * Intel Math Library (LIBM) Source Code
   5  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   6  *
   7  * This code is free software; you can redistribute it and/or modify it
   8  * under the terms of the GNU General Public License version 2 only, as
   9  * published by the Free Software Foundation.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  31 import static jdk.vm.ci.amd64.AMD64.r8;
  32 import static jdk.vm.ci.amd64.AMD64.r9;
  33 import static jdk.vm.ci.amd64.AMD64.rax;
  34 import static jdk.vm.ci.amd64.AMD64.rcx;
  35 import static jdk.vm.ci.amd64.AMD64.rdx;
  36 import static jdk.vm.ci.amd64.AMD64.rsp;
  37 import static jdk.vm.ci.amd64.AMD64.xmm0;
  38 import static jdk.vm.ci.amd64.AMD64.xmm1;
  39 import static jdk.vm.ci.amd64.AMD64.xmm2;
  40 import static jdk.vm.ci.amd64.AMD64.xmm3;
  41 import static jdk.vm.ci.amd64.AMD64.xmm4;
  42 import static jdk.vm.ci.amd64.AMD64.xmm5;
  43 import static jdk.vm.ci.amd64.AMD64.xmm6;
  44 import static jdk.vm.ci.amd64.AMD64.xmm7;
  45 import static org.graalvm.compiler.lir.amd64.AMD64HotSpotHelper.pointerConstant;
  46 import static org.graalvm.compiler.lir.amd64.AMD64HotSpotHelper.recordExternalAddress;
  47 
  48 import org.graalvm.compiler.asm.Label;
  49 import org.graalvm.compiler.asm.amd64.AMD64Address;
  50 import org.graalvm.compiler.asm.amd64.AMD64Assembler;

  51 import org.graalvm.compiler.asm.amd64.AMD64MacroAssembler;
  52 import org.graalvm.compiler.lir.LIRInstructionClass;
  53 import org.graalvm.compiler.lir.asm.ArrayDataPointerConstant;
  54 import org.graalvm.compiler.lir.asm.CompilationResultBuilder;
  55 
  56 import jdk.vm.ci.code.Register;
  57 
  58 /**
  59  * &lt;pre&gt;
  60  *                     ALGORITHM DESCRIPTION  - POW()
  61  *                     ---------------------
  62  *
  63  *    Let x=2^k * mx, mx in [1,2)
  64  *
  65  *    log2(x) calculation:
  66  *
  67  *    Get B~1/mx based on the output of rcpps instruction (B0)
  68  *    B = int((B0*LH*2^9+0.5))/2^9
  69  *    LH is a short approximation for log2(e)
  70  *
</pre>
<hr />
<pre>
 890         Label block50 = new Label();
 891         Label block51 = new Label();
 892         Label block52 = new Label();
 893         Label block53 = new Label();
 894         Label block54 = new Label();
 895         Label block55 = new Label();
 896         Label block56 = new Label();
 897         Label block57 = new Label();
 898 
 899         Register tmp1 = r8;
 900         Register tmp2 = r9;
 901         Register tmp3 = r10;
 902         Register tmp4 = r11;
 903 
 904         masm.subq(rsp, 40);
 905         masm.movsd(new AMD64Address(rsp, 8), xmm0);
 906         masm.movsd(new AMD64Address(rsp, 16), xmm1);
 907 
 908         // Special case: pow(x, 2.0) =&gt; x * x
 909         masm.movdq(tmp1, xmm1);

 910         masm.cmpq(tmp1, recordExternalAddress(crb, double2));
 911         masm.jccb(AMD64Assembler.ConditionFlag.NotEqual, block57);
 912         masm.mulsd(xmm0, xmm0);
 913         masm.jmp(block56);
 914 
 915         masm.bind(block57);
 916         masm.pextrw(rax, xmm0, 3);
 917         masm.xorpd(xmm2, xmm2);
 918         masm.movq(tmp2, 0x3ff0000000000000L);
 919         masm.movdq(xmm2, tmp2);
 920         masm.movl(tmp1, 1069088768);
 921         masm.movdq(xmm7, tmp1);
 922         masm.xorpd(xmm1, xmm1);
 923         masm.movq(tmp3, 0x77f0000000000000L);
 924         masm.movdq(xmm1, tmp3);
 925         masm.movdqu(xmm3, xmm0);
 926         masm.movl(rdx, 32752);
 927         masm.andl(rdx, rax);
 928         masm.subl(rdx, 16368);
 929         masm.movl(rcx, rdx);
 930         masm.sarl(rdx, 31);
 931         masm.addl(rcx, rdx);
 932         masm.xorl(rcx, rdx);
 933         masm.por(xmm0, xmm2);
 934         masm.movdqu(xmm6, recordExternalAddress(crb, highsigmask));    // 0x00000000, 0xfffff800,
 935                                                                        // 0x00000000, 0xfffff800
 936         masm.psrlq(xmm0, 27);
 937         masm.movq(xmm2, recordExternalAddress(crb, log2E));            // 0x00000000, 0x3ff72000,
 938                                                                        // 0x161bb241, 0xbf5dabe1
 939         masm.psrld(xmm0, 2);
 940         masm.addl(rcx, 16);
 941         masm.bsrl(rcx, rcx);
 942         masm.rcpps(xmm0, xmm0);
 943         masm.psllq(xmm3, 12);
 944         masm.movl(tmp4, 8192);
 945         masm.movdq(xmm4, tmp4);
 946         masm.psrlq(xmm3, 12);
 947         masm.subl(rax, 16);
<span class="line-modified"> 948         masm.cmpl(rax, 32736);</span>
<span class="line-removed"> 949         masm.jcc(AMD64Assembler.ConditionFlag.AboveEqual, block0);</span>
 950         masm.movl(tmp1, 0);
 951 
 952         masm.bind(block1);
 953         masm.mulss(xmm0, xmm7);
 954         masm.movl(rdx, -1);
 955         masm.subl(rcx, 4);
 956         masm.shll(rdx);
 957         masm.shlq(rdx, 32);
 958         masm.movdq(xmm5, rdx);
 959         masm.por(xmm3, xmm1);
 960         masm.subl(rax, 16351);
<span class="line-modified"> 961         masm.cmpl(rax, 1);</span>
<span class="line-removed"> 962         masm.jcc(AMD64Assembler.ConditionFlag.BelowEqual, block2);</span>
 963         masm.paddd(xmm0, xmm4);
 964         masm.pand(xmm5, xmm3);
 965         masm.movdl(rdx, xmm0);
 966         masm.psllq(xmm0, 29);
 967 
 968         masm.bind(block3);
 969         masm.subsd(xmm3, xmm5);
 970         masm.pand(xmm0, xmm6);
 971         masm.subl(rax, 1);
 972         masm.sarl(rax, 4);
 973         masm.cvtsi2sdl(xmm7, rax);
 974         masm.mulpd(xmm5, xmm0);
 975 
 976         masm.bind(block4);
 977         masm.mulsd(xmm3, xmm0);
 978         masm.movdqu(xmm1, recordExternalAddress(crb, coeff));          // 0x6dc96112, 0xbf836578,
 979                                                                        // 0xee241472, 0xbf9b0301
 980         masm.leaq(tmp4, recordExternalAddress(crb, lTbl));
 981         masm.subsd(xmm5, xmm2);
 982         masm.movdqu(xmm4, recordExternalAddress(crb, coeff16));        // 0x9f95985a, 0xbfb528db,
</pre>
<hr />
<pre>
1001         masm.mulpd(xmm1, xmm2);
1002         masm.mulpd(xmm4, xmm2);
1003         masm.addsd(xmm5, xmm7);
1004         masm.mulsd(xmm2, xmm3);
1005         masm.addpd(xmm6, xmm1);
1006         masm.mulsd(xmm3, xmm3);
1007         masm.addpd(xmm0, xmm4);
1008         masm.movq(xmm1, new AMD64Address(rsp, 16));
1009         masm.movw(rcx, new AMD64Address(rsp, 22));
1010         masm.pshufd(xmm7, xmm5, 238);
1011         masm.movq(xmm4, recordExternalAddress(crb, highmaskY));        // 0x00000000, 0xfffffff8,
1012                                                                        // 0x00000000, 0xffffffff
1013         masm.mulpd(xmm6, xmm2);
1014         masm.pshufd(xmm3, xmm3, 68);
1015         masm.mulpd(xmm0, xmm2);
1016         masm.shll(rax, 4);
1017         masm.subl(rax, 15872);
1018         masm.andl(rcx, 32752);
1019         masm.addl(rax, rcx);
1020         masm.mulpd(xmm3, xmm6);
<span class="line-modified">1021         masm.cmpl(rax, 624);</span>
<span class="line-removed">1022         masm.jcc(AMD64Assembler.ConditionFlag.AboveEqual, block5);</span>
1023         masm.xorpd(xmm6, xmm6);
1024         masm.movl(rdx, 17080);
1025         masm.pinsrw(xmm6, rdx, 3);
1026         masm.movdqu(xmm2, xmm1);
1027         masm.pand(xmm4, xmm1);
1028         masm.subsd(xmm1, xmm4);
1029         masm.mulsd(xmm4, xmm5);
1030         masm.addsd(xmm0, xmm7);
1031         masm.mulsd(xmm1, xmm5);
1032         masm.movdqu(xmm7, xmm6);
1033         masm.addsd(xmm6, xmm4);
1034         masm.leaq(tmp4, recordExternalAddress(crb, tExp));
1035         masm.addpd(xmm3, xmm0);
1036         masm.movdl(rdx, xmm6);
1037         masm.subsd(xmm6, xmm7);
1038         masm.pshufd(xmm0, xmm3, 238);
1039         masm.subsd(xmm4, xmm6);
1040         masm.addsd(xmm0, xmm3);
1041         masm.movl(rcx, rdx);
1042         masm.andl(rdx, 255);
</pre>
<hr />
<pre>
1063         masm.mulpd(xmm7, xmm4);
1064         masm.paddd(xmm5, xmm6);
1065         masm.mulsd(xmm1, xmm5);
1066         masm.pshufd(xmm6, xmm5, 238);
1067         masm.mulsd(xmm0, xmm0);
1068         masm.addpd(xmm3, xmm7);
1069         masm.addsd(xmm1, xmm6);
1070         masm.mulpd(xmm0, xmm3);
1071         masm.pshufd(xmm3, xmm0, 238);
1072         masm.mulsd(xmm0, xmm5);
1073         masm.mulsd(xmm3, xmm5);
1074         masm.addsd(xmm0, xmm1);
1075         masm.addsd(xmm0, xmm3);
1076         masm.addsd(xmm0, xmm5);
1077         masm.jmp(block56);
1078 
1079         masm.bind(block0);
1080         masm.addl(rax, 16);
1081         masm.movl(rdx, 32752);
1082         masm.andl(rdx, rax);
<span class="line-modified">1083         masm.cmpl(rdx, 32752);</span>
<span class="line-modified">1084         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block6);</span>
<span class="line-removed">1085         masm.testl(rax, 32768);</span>
<span class="line-removed">1086         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block7);</span>
1087 
1088         masm.bind(block8);
1089         masm.movq(xmm0, new AMD64Address(rsp, 8));
1090         masm.movq(xmm3, new AMD64Address(rsp, 8));
1091         masm.movdl(rdx, xmm3);
1092         masm.psrlq(xmm3, 32);
1093         masm.movdl(rcx, xmm3);
1094         masm.orl(rdx, rcx);
<span class="line-modified">1095         masm.cmpl(rdx, 0);</span>
<span class="line-removed">1096         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block9);</span>
1097         masm.xorpd(xmm3, xmm3);
1098         masm.movl(rax, 18416);
1099         masm.pinsrw(xmm3, rax, 3);
1100         masm.mulsd(xmm0, xmm3);
1101         masm.xorpd(xmm2, xmm2);
1102         masm.movl(rax, 16368);
1103         masm.pinsrw(xmm2, rax, 3);
1104         masm.movdqu(xmm3, xmm0);
1105         masm.pextrw(rax, xmm0, 3);
1106         masm.por(xmm0, xmm2);
1107         masm.movl(rcx, 18416);
1108         masm.psrlq(xmm0, 27);
1109         masm.movq(xmm2, recordExternalAddress(crb, log2E));            // 0x00000000, 0x3ff72000,
1110                                                                        // 0x161bb241, 0xbf5dabe1
1111         masm.psrld(xmm0, 2);
1112         masm.rcpps(xmm0, xmm0);
1113         masm.psllq(xmm3, 12);
1114         masm.movdqu(xmm6, recordExternalAddress(crb, highsigmask));    // 0x00000000, 0xfffff800,
1115                                                                        // 0x00000000, 0xfffff800
1116         masm.psrlq(xmm3, 12);
</pre>
<hr />
<pre>
1123         masm.movdl(rdx, xmm0);
1124         masm.psllq(xmm0, 29);
1125         masm.pand(xmm5, xmm3);
1126         masm.movl(tmp1, 0);
1127         masm.pand(xmm0, xmm6);
1128         masm.subsd(xmm3, xmm5);
1129         masm.andl(rax, 32752);
1130         masm.subl(rax, 18416);
1131         masm.sarl(rax, 4);
1132         masm.cvtsi2sdl(xmm7, rax);
1133         masm.mulpd(xmm5, xmm0);
1134         masm.jmp(block4);
1135 
1136         masm.bind(block10);
1137         masm.movq(xmm0, new AMD64Address(rsp, 8));
1138         masm.movq(xmm3, new AMD64Address(rsp, 8));
1139         masm.movdl(rdx, xmm3);
1140         masm.psrlq(xmm3, 32);
1141         masm.movdl(rcx, xmm3);
1142         masm.orl(rdx, rcx);
<span class="line-modified">1143         masm.cmpl(rdx, 0);</span>
<span class="line-removed">1144         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block9);</span>
1145         masm.xorpd(xmm3, xmm3);
1146         masm.movl(rax, 18416);
1147         masm.pinsrw(xmm3, rax, 3);
1148         masm.mulsd(xmm0, xmm3);
1149         masm.xorpd(xmm2, xmm2);
1150         masm.movl(rax, 16368);
1151         masm.pinsrw(xmm2, rax, 3);
1152         masm.movdqu(xmm3, xmm0);
1153         masm.pextrw(rax, xmm0, 3);
1154         masm.por(xmm0, xmm2);
1155         masm.movl(rcx, 18416);
1156         masm.psrlq(xmm0, 27);
1157         masm.movq(xmm2, recordExternalAddress(crb, log2E));            // 0x00000000, 0x3ff72000,
1158                                                                        // 0x161bb241, 0xbf5dabe1
1159         masm.psrld(xmm0, 2);
1160         masm.rcpps(xmm0, xmm0);
1161         masm.psllq(xmm3, 12);
1162         masm.movdqu(xmm6, recordExternalAddress(crb, highsigmask));    // 0x00000000, 0xfffff800,
1163                                                                        // 0x00000000, 0xfffff800
1164         masm.psrlq(xmm3, 12);
1165         masm.mulss(xmm0, xmm7);
1166         masm.movl(rdx, -1024);
1167         masm.movdl(xmm5, rdx);
1168         masm.por(xmm3, xmm1);
1169         masm.paddd(xmm0, xmm4);
1170         masm.psllq(xmm5, 32);
1171         masm.movdl(rdx, xmm0);
1172         masm.psllq(xmm0, 29);
1173         masm.pand(xmm5, xmm3);
1174         masm.movl(tmp1, Integer.MIN_VALUE);
1175         masm.pand(xmm0, xmm6);
1176         masm.subsd(xmm3, xmm5);
1177         masm.andl(rax, 32752);
1178         masm.subl(rax, 18416);
1179         masm.sarl(rax, 4);
1180         masm.cvtsi2sdl(xmm7, rax);
1181         masm.mulpd(xmm5, xmm0);
1182         masm.jmp(block4);
1183 
1184         masm.bind(block5);
<span class="line-modified">1185         masm.cmpl(rax, 0);</span>
<span class="line-modified">1186         masm.jcc(AMD64Assembler.ConditionFlag.Less, block11);</span>
<span class="line-removed">1187         masm.cmpl(rax, 752);</span>
<span class="line-removed">1188         masm.jcc(AMD64Assembler.ConditionFlag.AboveEqual, block12);</span>
1189         masm.addsd(xmm0, xmm7);
1190         masm.movq(xmm2, recordExternalAddress(crb, halfmask));         // 0xf8000000, 0xffffffff,
1191                                                                        // 0xf8000000, 0xffffffff
1192         masm.addpd(xmm3, xmm0);
1193         masm.xorpd(xmm6, xmm6);
1194         masm.movl(rax, 17080);
1195         masm.pinsrw(xmm6, rax, 3);
1196         masm.pshufd(xmm0, xmm3, 238);
1197         masm.addsd(xmm0, xmm3);
1198         masm.movdqu(xmm3, xmm5);
1199         masm.addsd(xmm5, xmm0);
1200         masm.movdqu(xmm4, xmm2);
1201         masm.subsd(xmm3, xmm5);
1202         masm.movdqu(xmm7, xmm5);
1203         masm.pand(xmm5, xmm2);
1204         masm.movdqu(xmm2, xmm1);
1205         masm.pand(xmm4, xmm1);
1206         masm.subsd(xmm7, xmm5);
1207         masm.addsd(xmm0, xmm3);
1208         masm.subsd(xmm1, xmm4);
</pre>
<hr />
<pre>
1220                                                                        // 0xd704a0c0, 0x3fac6b08
1221         masm.movdqu(xmm3, recordExternalAddress(crb, eCoeff16));       // 0x6fba4e77, 0x3f83b2ab,
1222                                                                        // 0xff82c58f, 0x3fcebfbd
1223         masm.subsd(xmm4, xmm6);
1224         masm.pextrw(rdx, xmm6, 3);
1225         masm.movl(rcx, rax);
1226         masm.andl(rax, 255);
1227         masm.addl(rax, rax);
1228         masm.movdqu(xmm5, new AMD64Address(tmp4, rax, AMD64Address.Scale.Times8, 0));
1229         masm.addsd(xmm2, xmm4);
1230         masm.sarl(rcx, 8);
1231         masm.movl(rax, rcx);
1232         masm.sarl(rcx, 1);
1233         masm.subl(rax, rcx);
1234         masm.shll(rcx, 20);
1235         masm.xorl(rcx, tmp1);
1236         masm.movdl(xmm6, rcx);
1237         masm.movq(xmm1, recordExternalAddress(crb, eCoeff32));         // 0xfefa39ef, 0x3fe62e42,
1238                                                                        // 0x00000000, 0x00000000
1239         masm.andl(rdx, 32767);
<span class="line-modified">1240         masm.cmpl(rdx, 16529);</span>
<span class="line-removed">1241         masm.jcc(AMD64Assembler.ConditionFlag.Above, block12);</span>
1242         masm.pshufd(xmm0, xmm2, 68);
1243         masm.pshufd(xmm4, xmm2, 68);
1244         masm.mulpd(xmm0, xmm0);
1245         masm.mulpd(xmm7, xmm4);
1246         masm.pshufd(xmm6, xmm6, 17);
1247         masm.mulsd(xmm1, xmm2);
1248         masm.mulsd(xmm0, xmm0);
1249         masm.paddd(xmm5, xmm6);
1250         masm.addpd(xmm3, xmm7);
1251         masm.mulsd(xmm1, xmm5);
1252         masm.pshufd(xmm6, xmm5, 238);
1253         masm.mulpd(xmm0, xmm3);
1254         masm.addsd(xmm1, xmm6);
1255         masm.pshufd(xmm3, xmm0, 238);
1256         masm.mulsd(xmm0, xmm5);
1257         masm.mulsd(xmm3, xmm5);
1258         masm.shll(rax, 4);
1259         masm.xorpd(xmm4, xmm4);
1260         masm.addl(rax, 16368);
1261         masm.pinsrw(xmm4, rax, 3);
1262         masm.addsd(xmm0, xmm1);
1263         masm.addsd(xmm0, xmm3);
1264         masm.movdqu(xmm1, xmm0);
1265         masm.addsd(xmm0, xmm5);
1266         masm.mulsd(xmm0, xmm4);
1267         masm.pextrw(rax, xmm0, 3);
<span class="line-modified">1268         masm.andl(rax, 32752);</span>
<span class="line-modified">1269         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block13);</span>
<span class="line-removed">1270         masm.cmpl(rax, 32752);</span>
<span class="line-removed">1271         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block14);</span>
1272         masm.jmp(block56);
1273 
1274         masm.bind(block6);
1275         masm.movq(xmm1, new AMD64Address(rsp, 16));
1276         masm.movq(xmm0, new AMD64Address(rsp, 8));
1277         masm.movdqu(xmm2, xmm0);
1278         masm.movdl(rax, xmm2);
1279         masm.psrlq(xmm2, 20);
1280         masm.movdl(rdx, xmm2);
1281         masm.orl(rax, rdx);
<span class="line-modified">1282         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block15);</span>
1283         masm.movdl(rax, xmm1);
1284         masm.psrlq(xmm1, 32);
1285         masm.movdl(rdx, xmm1);
1286         masm.movl(rcx, rdx);
1287         masm.addl(rdx, rdx);
1288         masm.orl(rax, rdx);
<span class="line-modified">1289         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block16);</span>
1290         masm.addsd(xmm0, xmm0);
1291         masm.jmp(block56);
1292 
1293         masm.bind(block16);
1294         masm.xorpd(xmm0, xmm0);
1295         masm.movl(rax, 16368);
1296         masm.pinsrw(xmm0, rax, 3);
1297         masm.movl(new AMD64Address(rsp, 0), 29);
1298         masm.jmp(block17);
1299 
1300         masm.bind(block18);
1301         masm.movq(xmm0, new AMD64Address(rsp, 16));
1302         masm.addpd(xmm0, xmm0);
1303         masm.jmp(block56);
1304 
1305         masm.bind(block15);
1306         masm.movdl(rax, xmm1);
1307         masm.movdqu(xmm2, xmm1);
1308         masm.psrlq(xmm1, 32);
1309         masm.movdl(rdx, xmm1);
1310         masm.movl(rcx, rdx);
1311         masm.addl(rdx, rdx);
1312         masm.orl(rax, rdx);
<span class="line-modified">1313         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block19);</span>
1314         masm.pextrw(rax, xmm2, 3);
1315         masm.andl(rax, 32752);
<span class="line-modified">1316         masm.cmpl(rax, 32752);</span>
<span class="line-removed">1317         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block20);</span>
1318         masm.movdl(rax, xmm2);
1319         masm.psrlq(xmm2, 20);
1320         masm.movdl(rdx, xmm2);
1321         masm.orl(rax, rdx);
<span class="line-modified">1322         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block18);</span>
1323 
1324         masm.bind(block20);
1325         masm.pextrw(rax, xmm0, 3);
<span class="line-modified">1326         masm.testl(rax, 32768);</span>
<span class="line-modified">1327         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block21);</span>
<span class="line-removed">1328         masm.testl(rcx, Integer.MIN_VALUE);</span>
<span class="line-removed">1329         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block22);</span>
1330         masm.jmp(block56);
1331 
1332         masm.bind(block23);
1333         masm.movq(xmm1, new AMD64Address(rsp, 16));
1334         masm.movdl(rax, xmm1);
<span class="line-modified">1335         masm.testl(rax, 1);</span>
<span class="line-modified">1336         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block24);</span>
<span class="line-removed">1337         masm.testl(rax, 2);</span>
<span class="line-removed">1338         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block25);</span>
1339         masm.jmp(block24);
1340 
1341         masm.bind(block21);
1342         masm.shrl(rcx, 20);
1343         masm.andl(rcx, 2047);
<span class="line-modified">1344         masm.cmpl(rcx, 1075);</span>
<span class="line-modified">1345         masm.jcc(AMD64Assembler.ConditionFlag.Above, block24);</span>
<span class="line-modified">1346         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block26);</span>
<span class="line-modified">1347         masm.cmpl(rcx, 1074);</span>
<span class="line-removed">1348         masm.jcc(AMD64Assembler.ConditionFlag.Above, block23);</span>
<span class="line-removed">1349         masm.cmpl(rcx, 1023);</span>
<span class="line-removed">1350         masm.jcc(AMD64Assembler.ConditionFlag.Below, block24);</span>
1351         masm.movq(xmm1, new AMD64Address(rsp, 16));
1352         masm.movl(rax, 17208);
1353         masm.xorpd(xmm3, xmm3);
1354         masm.pinsrw(xmm3, rax, 3);
1355         masm.movdqu(xmm4, xmm3);
1356         masm.addsd(xmm3, xmm1);
1357         masm.subsd(xmm4, xmm3);
1358         masm.addsd(xmm1, xmm4);
1359         masm.pextrw(rax, xmm1, 3);
<span class="line-modified">1360         masm.andl(rax, 32752);</span>
<span class="line-removed">1361         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block24);</span>
1362         masm.movdl(rax, xmm3);
<span class="line-modified">1363         masm.andl(rax, 1);</span>
<span class="line-removed">1364         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block24);</span>
1365 
1366         masm.bind(block25);
1367         masm.movq(xmm1, new AMD64Address(rsp, 16));
1368         masm.pextrw(rax, xmm1, 3);
<span class="line-modified">1369         masm.andl(rax, 32768);</span>
<span class="line-removed">1370         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block27);</span>
1371         masm.jmp(block56);
1372 
1373         masm.bind(block27);
1374         masm.xorpd(xmm0, xmm0);
1375         masm.movl(rax, 32768);
1376         masm.pinsrw(xmm0, rax, 3);
1377         masm.jmp(block56);
1378 
1379         masm.bind(block24);
1380         masm.movq(xmm1, new AMD64Address(rsp, 16));
1381         masm.pextrw(rax, xmm1, 3);
<span class="line-modified">1382         masm.andl(rax, 32768);</span>
<span class="line-removed">1383         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block22);</span>
1384         masm.xorpd(xmm0, xmm0);
1385         masm.movl(rax, 32752);
1386         masm.pinsrw(xmm0, rax, 3);
1387         masm.jmp(block56);
1388 
1389         masm.bind(block26);
1390         masm.movq(xmm1, new AMD64Address(rsp, 16));
1391         masm.movdl(rax, xmm1);
<span class="line-modified">1392         masm.andl(rax, 1);</span>
<span class="line-removed">1393         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block24);</span>
1394         masm.jmp(block25);
1395 
1396         masm.bind(block28);
1397         masm.movdl(rax, xmm1);
1398         masm.psrlq(xmm1, 20);
1399         masm.movdl(rdx, xmm1);
1400         masm.orl(rax, rdx);
<span class="line-modified">1401         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block29);</span>
1402         masm.movq(xmm0, new AMD64Address(rsp, 16));
1403         masm.addsd(xmm0, xmm0);
1404         masm.jmp(block56);
1405 
1406         masm.bind(block29);
1407         masm.movq(xmm0, new AMD64Address(rsp, 8));
1408         masm.pextrw(rax, xmm0, 3);
<span class="line-modified">1409         masm.cmpl(rax, 49136);</span>
<span class="line-removed">1410         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block30);</span>
1411         masm.movdl(rcx, xmm0);
1412         masm.psrlq(xmm0, 20);
1413         masm.movdl(rdx, xmm0);
1414         masm.orl(rcx, rdx);
<span class="line-modified">1415         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block30);</span>
1416         masm.xorpd(xmm0, xmm0);
1417         masm.movl(rax, 32760);
1418         masm.pinsrw(xmm0, rax, 3);
1419         masm.jmp(block56);
1420 
1421         masm.bind(block30);
1422         masm.movq(xmm1, new AMD64Address(rsp, 16));
1423         masm.andl(rax, 32752);
1424         masm.subl(rax, 16368);
1425         masm.pextrw(rdx, xmm1, 3);
1426         masm.xorpd(xmm0, xmm0);
1427         masm.xorl(rax, rdx);
<span class="line-modified">1428         masm.andl(rax, 32768);</span>
<span class="line-removed">1429         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block31);</span>
1430         masm.jmp(block56);
1431 
1432         masm.bind(block31);
1433         masm.movl(rcx, 32752);
1434         masm.pinsrw(xmm0, rcx, 3);
1435         masm.jmp(block56);
1436 
1437         masm.bind(block32);
1438         masm.movdl(rax, xmm1);
<span class="line-modified">1439         masm.cmpl(rdx, 17184);</span>
<span class="line-modified">1440         masm.jcc(AMD64Assembler.ConditionFlag.Above, block33);</span>
<span class="line-modified">1441         masm.testl(rax, 1);</span>
<span class="line-removed">1442         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block34);</span>
<span class="line-removed">1443         masm.testl(rax, 2);</span>
<span class="line-removed">1444         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block35);</span>
1445         masm.jmp(block36);
1446 
1447         masm.bind(block33);
<span class="line-modified">1448         masm.testl(rax, 1);</span>
<span class="line-removed">1449         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block35);</span>
1450         masm.jmp(block36);
1451 
1452         masm.bind(block7);
1453         masm.movq(xmm2, new AMD64Address(rsp, 8));
1454         masm.movdl(rax, xmm2);
1455         masm.psrlq(xmm2, 31);
1456         masm.movdl(rcx, xmm2);
1457         masm.orl(rax, rcx);
<span class="line-modified">1458         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block9);</span>
1459         masm.movq(xmm1, new AMD64Address(rsp, 16));
1460         masm.pextrw(rdx, xmm1, 3);
1461         masm.movdl(rax, xmm1);
1462         masm.movdqu(xmm2, xmm1);
1463         masm.psrlq(xmm2, 32);
1464         masm.movdl(rcx, xmm2);
1465         masm.addl(rcx, rcx);
1466         masm.orl(rcx, rax);
<span class="line-modified">1467         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block37);</span>
1468         masm.andl(rdx, 32752);
<span class="line-modified">1469         masm.cmpl(rdx, 32752);</span>
<span class="line-modified">1470         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block28);</span>
<span class="line-modified">1471         masm.cmpl(rdx, 17200);</span>
<span class="line-modified">1472         masm.jcc(AMD64Assembler.ConditionFlag.Above, block35);</span>
<span class="line-removed">1473         masm.cmpl(rdx, 17184);</span>
<span class="line-removed">1474         masm.jcc(AMD64Assembler.ConditionFlag.AboveEqual, block32);</span>
<span class="line-removed">1475         masm.cmpl(rdx, 16368);</span>
<span class="line-removed">1476         masm.jcc(AMD64Assembler.ConditionFlag.Below, block34);</span>
1477         masm.movl(rax, 17208);
1478         masm.xorpd(xmm2, xmm2);
1479         masm.pinsrw(xmm2, rax, 3);
1480         masm.movdqu(xmm4, xmm2);
1481         masm.addsd(xmm2, xmm1);
1482         masm.subsd(xmm4, xmm2);
1483         masm.addsd(xmm1, xmm4);
1484         masm.pextrw(rax, xmm1, 3);
<span class="line-modified">1485         masm.andl(rax, 32767);</span>
<span class="line-removed">1486         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block34);</span>
1487         masm.movdl(rax, xmm2);
<span class="line-modified">1488         masm.andl(rax, 1);</span>
<span class="line-removed">1489         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block35);</span>
1490 
1491         masm.bind(block36);
1492         masm.xorpd(xmm1, xmm1);
1493         masm.movl(rdx, 30704);
1494         masm.pinsrw(xmm1, rdx, 3);
1495         masm.movq(xmm2, recordExternalAddress(crb, log2E));            // 0x00000000, 0x3ff72000,
1496                                                                        // 0x161bb241, 0xbf5dabe1
1497         masm.movq(xmm4, new AMD64Address(rsp, 8));
1498         masm.pextrw(rax, xmm4, 3);
1499         masm.movl(rdx, 8192);
1500         masm.movdl(xmm4, rdx);
1501         masm.andl(rax, 32767);
<span class="line-modified">1502         masm.subl(rax, 16);</span>
<span class="line-removed">1503         masm.jcc(AMD64Assembler.ConditionFlag.Less, block10);</span>
1504         masm.movl(rdx, rax);
1505         masm.andl(rdx, 32752);
1506         masm.subl(rdx, 16368);
1507         masm.movl(rcx, rdx);
1508         masm.sarl(rdx, 31);
1509         masm.addl(rcx, rdx);
1510         masm.xorl(rcx, rdx);
1511         masm.addl(rcx, 16);
1512         masm.bsrl(rcx, rcx);
1513         masm.movl(tmp1, Integer.MIN_VALUE);
1514         masm.jmp(block1);
1515 
1516         masm.bind(block34);
1517         masm.xorpd(xmm1, xmm1);
1518         masm.movl(rax, 32752);
1519         masm.pinsrw(xmm1, rax, 3);
1520         masm.xorpd(xmm0, xmm0);
1521         masm.mulsd(xmm0, xmm1);
1522         masm.movl(new AMD64Address(rsp, 0), 28);
1523         masm.jmp(block17);
1524 
1525         masm.bind(block35);
1526         masm.xorpd(xmm1, xmm1);
1527         masm.movl(rdx, 30704);
1528         masm.pinsrw(xmm1, rdx, 3);
1529         masm.movq(xmm2, recordExternalAddress(crb, log2E));            // 0x00000000, 0x3ff72000,
1530                                                                        // 0x161bb241, 0xbf5dabe1
1531         masm.movq(xmm4, new AMD64Address(rsp, 8));
1532         masm.pextrw(rax, xmm4, 3);
1533         masm.movl(rdx, 8192);
1534         masm.movdl(xmm4, rdx);
1535         masm.andl(rax, 32767);
<span class="line-modified">1536         masm.subl(rax, 16);</span>
<span class="line-removed">1537         masm.jcc(AMD64Assembler.ConditionFlag.Less, block8);</span>
1538         masm.movl(rdx, rax);
1539         masm.andl(rdx, 32752);
1540         masm.subl(rdx, 16368);
1541         masm.movl(rcx, rdx);
1542         masm.sarl(rdx, 31);
1543         masm.addl(rcx, rdx);
1544         masm.xorl(rcx, rdx);
1545         masm.addl(rcx, 16);
1546         masm.bsrl(rcx, rcx);
1547         masm.movl(tmp1, 0);
1548         masm.jmp(block1);
1549 
1550         masm.bind(block19);
1551         masm.xorpd(xmm0, xmm0);
1552         masm.movl(rax, 16368);
1553         masm.pinsrw(xmm0, rax, 3);
1554         masm.jmp(block56);
1555 
1556         masm.bind(block22);
1557         masm.xorpd(xmm0, xmm0);
1558         masm.jmp(block56);
1559 
1560         masm.bind(block11);
1561         masm.addl(rax, 384);
<span class="line-modified">1562         masm.cmpl(rax, 0);</span>
<span class="line-removed">1563         masm.jcc(AMD64Assembler.ConditionFlag.Less, block38);</span>
1564         masm.mulsd(xmm5, xmm1);
1565         masm.addsd(xmm0, xmm7);
1566         masm.shrl(tmp1, 31);
1567         masm.addpd(xmm3, xmm0);
1568         masm.pshufd(xmm0, xmm3, 238);
1569         masm.addsd(xmm3, xmm0);
1570         masm.leaq(tmp4, recordExternalAddress(crb, log2));             // 0xfefa39ef, 0x3fe62e42,
1571                                                                        // 0xfefa39ef, 0xbfe62e42
1572         masm.movq(xmm4, new AMD64Address(tmp4, tmp1, AMD64Address.Scale.Times8, 0));
1573         masm.mulsd(xmm1, xmm3);
1574         masm.xorpd(xmm0, xmm0);
1575         masm.movl(rax, 16368);
1576         masm.shll(tmp1, 15);
1577         masm.orl(rax, tmp1);
1578         masm.pinsrw(xmm0, rax, 3);
1579         masm.addsd(xmm5, xmm1);
1580         masm.mulsd(xmm5, xmm4);
1581         masm.addsd(xmm0, xmm5);
1582         masm.jmp(block56);
1583 
1584         masm.bind(block38);
1585 
1586         masm.bind(block37);
1587         masm.xorpd(xmm0, xmm0);
1588         masm.movl(rax, 16368);
1589         masm.pinsrw(xmm0, rax, 3);
1590         masm.jmp(block56);
1591 
1592         masm.bind(block39);
1593         masm.xorpd(xmm0, xmm0);
1594         masm.movl(rax, 16368);
1595         masm.pinsrw(xmm0, rax, 3);
1596         masm.movl(new AMD64Address(rsp, 0), 26);
1597         masm.jmp(block17);
1598 
1599         masm.bind(block9);
1600         masm.movq(xmm1, new AMD64Address(rsp, 16));
1601         masm.movdqu(xmm2, xmm1);
1602         masm.pextrw(rax, xmm1, 3);
1603         masm.andl(rax, 32752);
<span class="line-modified">1604         masm.cmpl(rax, 32752);</span>
<span class="line-removed">1605         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block40);</span>
1606         masm.movdl(rax, xmm2);
1607         masm.psrlq(xmm2, 20);
1608         masm.movdl(rdx, xmm2);
1609         masm.orl(rax, rdx);
<span class="line-modified">1610         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block18);</span>
1611 
1612         masm.bind(block40);
1613         masm.movdl(rax, xmm1);
1614         masm.psrlq(xmm1, 32);
1615         masm.movdl(rdx, xmm1);
1616         masm.movl(rcx, rdx);
1617         masm.addl(rdx, rdx);
1618         masm.orl(rax, rdx);
<span class="line-modified">1619         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block39);</span>
1620         masm.shrl(rdx, 21);
<span class="line-modified">1621         masm.cmpl(rdx, 1075);</span>
<span class="line-modified">1622         masm.jcc(AMD64Assembler.ConditionFlag.Above, block41);</span>
<span class="line-modified">1623         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block42);</span>
<span class="line-removed">1624         masm.cmpl(rdx, 1023);</span>
<span class="line-removed">1625         masm.jcc(AMD64Assembler.ConditionFlag.Below, block41);</span>
1626         masm.movq(xmm1, new AMD64Address(rsp, 16));
1627         masm.movl(rax, 17208);
1628         masm.xorpd(xmm3, xmm3);
1629         masm.pinsrw(xmm3, rax, 3);
1630         masm.movdqu(xmm4, xmm3);
1631         masm.addsd(xmm3, xmm1);
1632         masm.subsd(xmm4, xmm3);
1633         masm.addsd(xmm1, xmm4);
1634         masm.pextrw(rax, xmm1, 3);
<span class="line-modified">1635         masm.andl(rax, 32752);</span>
<span class="line-removed">1636         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block41);</span>
1637         masm.movdl(rax, xmm3);
<span class="line-modified">1638         masm.andl(rax, 1);</span>
<span class="line-removed">1639         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block41);</span>
1640 
1641         masm.bind(block43);
1642         masm.movq(xmm0, new AMD64Address(rsp, 8));
<span class="line-modified">1643         masm.testl(rcx, Integer.MIN_VALUE);</span>
<span class="line-removed">1644         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block44);</span>
1645         masm.jmp(block56);
1646 
1647         masm.bind(block42);
1648         masm.movq(xmm1, new AMD64Address(rsp, 16));
1649         masm.movdl(rax, xmm1);
<span class="line-modified">1650         masm.testl(rax, 1);</span>
<span class="line-removed">1651         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block43);</span>
1652 
1653         masm.bind(block41);
<span class="line-modified">1654         masm.testl(rcx, Integer.MIN_VALUE);</span>
<span class="line-removed">1655         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block22);</span>
1656         masm.xorpd(xmm0, xmm0);
1657 
1658         masm.bind(block44);
1659         masm.movl(rax, 16368);
1660         masm.xorpd(xmm1, xmm1);
1661         masm.pinsrw(xmm1, rax, 3);
1662         masm.divsd(xmm1, xmm0);
1663         masm.movdqu(xmm0, xmm1);
1664         masm.movl(new AMD64Address(rsp, 0), 27);
1665         masm.jmp(block17);
1666 
1667         masm.bind(block12);
1668         masm.movq(xmm2, new AMD64Address(rsp, 8));
1669         masm.movq(xmm6, new AMD64Address(rsp, 16));
1670         masm.pextrw(rax, xmm2, 3);
1671         masm.pextrw(rdx, xmm6, 3);
1672         masm.movl(rcx, 32752);
1673         masm.andl(rcx, rdx);
<span class="line-modified">1674         masm.cmpl(rcx, 32752);</span>
<span class="line-removed">1675         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block45);</span>
1676         masm.andl(rax, 32752);
1677         masm.subl(rax, 16368);
1678         masm.xorl(rdx, rax);
<span class="line-modified">1679         masm.testl(rdx, 32768);</span>
<span class="line-removed">1680         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block46);</span>
1681 
1682         masm.bind(block47);
1683         masm.movl(rax, 32736);
1684         masm.pinsrw(xmm0, rax, 3);
1685         masm.shrl(tmp1, 16);
1686         masm.orl(rax, tmp1);
1687         masm.pinsrw(xmm1, rax, 3);
1688         masm.mulsd(xmm0, xmm1);
1689 
1690         masm.bind(block14);
1691         masm.movl(new AMD64Address(rsp, 0), 24);
1692         masm.jmp(block17);
1693 
1694         masm.bind(block46);
1695         masm.movl(rax, 16);
1696         masm.pinsrw(xmm0, rax, 3);
1697         masm.mulsd(xmm0, xmm0);
<span class="line-modified">1698         masm.testl(tmp1, Integer.MIN_VALUE);</span>
<span class="line-removed">1699         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block48);</span>
1700         masm.movq(tmp2, 0x8000000000000000L);
1701         masm.movdq(xmm2, tmp2);
1702         masm.xorpd(xmm0, xmm2);
1703 
1704         masm.bind(block48);
1705         masm.movl(new AMD64Address(rsp, 0), 25);
1706         masm.jmp(block17);
1707 
1708         masm.bind(block13);
1709         masm.pextrw(rcx, xmm5, 3);
1710         masm.pextrw(rdx, xmm4, 3);
1711         masm.movl(rax, -1);
1712         masm.andl(rcx, 32752);
1713         masm.subl(rcx, 16368);
1714         masm.andl(rdx, 32752);
1715         masm.addl(rdx, rcx);
1716         masm.movl(rcx, -31);
1717         masm.sarl(rdx, 4);
<span class="line-modified">1718         masm.subl(rcx, rdx);</span>
<span class="line-modified">1719         masm.jcc(AMD64Assembler.ConditionFlag.LessEqual, block49);</span>
<span class="line-removed">1720         masm.cmpl(rcx, 20);</span>
<span class="line-removed">1721         masm.jcc(AMD64Assembler.ConditionFlag.Above, block50);</span>
1722         masm.shll(rax);
1723 
1724         masm.bind(block49);
1725         masm.movdl(xmm0, rax);
1726         masm.psllq(xmm0, 32);
1727         masm.pand(xmm0, xmm5);
1728         masm.subsd(xmm5, xmm0);
1729         masm.addsd(xmm5, xmm1);
1730         masm.mulsd(xmm0, xmm4);
1731         masm.mulsd(xmm5, xmm4);
1732         masm.addsd(xmm0, xmm5);
1733 
1734         masm.bind(block50);
1735         masm.jmp(block48);
1736 
1737         masm.bind(block2);
1738         masm.movw(rcx, new AMD64Address(rsp, 22));
1739         masm.movl(rdx, Integer.MIN_VALUE);
1740         masm.movdl(xmm1, rdx);
1741         masm.xorpd(xmm7, xmm7);
1742         masm.paddd(xmm0, xmm4);
1743         masm.movdl(rdx, xmm0);
1744         masm.psllq(xmm0, 29);
1745         masm.paddq(xmm1, xmm3);
1746         masm.pand(xmm5, xmm1);
1747         masm.andl(rcx, 32752);
<span class="line-modified">1748         masm.cmpl(rcx, 16560);</span>
<span class="line-removed">1749         masm.jcc(AMD64Assembler.ConditionFlag.Less, block3);</span>
1750         masm.pand(xmm0, xmm6);
1751         masm.subsd(xmm3, xmm5);
1752         masm.addl(rax, 16351);
1753         masm.shrl(rax, 4);
1754         masm.subl(rax, 1022);
1755         masm.cvtsi2sdl(xmm7, rax);
1756         masm.mulpd(xmm5, xmm0);
1757         masm.leaq(r11, recordExternalAddress(crb, lTbl));
1758         masm.movq(xmm4, recordExternalAddress(crb, coeffH));           // 0x00000000, 0xbfd61a00,
1759                                                                        // 0x00000000, 0xbf5dabe1
1760         masm.mulsd(xmm3, xmm0);
1761         masm.movq(xmm6, recordExternalAddress(crb, coeffH));           // 0x00000000, 0xbfd61a00,
1762                                                                        // 0x00000000, 0xbf5dabe1
1763         masm.subsd(xmm5, xmm2);
1764         masm.movq(xmm1, recordExternalAddress(crb, coeffH8));          // 0x00000000, 0xbf5dabe1
1765         masm.pshufd(xmm2, xmm3, 68);
1766         masm.unpcklpd(xmm5, xmm3);
1767         masm.addsd(xmm3, xmm5);
1768         masm.movq(xmm0, recordExternalAddress(crb, coeffH8));          // 0x00000000, 0xbf5dabe1
1769         masm.andl(rdx, 16760832);
</pre>
<hr />
<pre>
1821         masm.addpd(xmm0, xmm1);
1822         masm.addpd(xmm5, xmm2);
1823         masm.mulsd(xmm4, xmm3);
1824         masm.movq(xmm2, recordExternalAddress(crb, highmaskLogX));     // 0xf8000000, 0xffffffff,
1825                                                                        // 0x00000000, 0xfffff800
1826         masm.mulpd(xmm3, xmm3);
1827         masm.movq(xmm1, new AMD64Address(rsp, 16));
1828         masm.movw(rcx, new AMD64Address(rsp, 22));
1829         masm.mulpd(xmm0, xmm4);
1830         masm.pextrw(rax, xmm7, 3);
1831         masm.mulpd(xmm5, xmm4);
1832         masm.mulpd(xmm0, xmm3);
1833         masm.movq(xmm4, recordExternalAddress(crb, highmaskY8));       // 0x00000000, 0xffffffff
1834         masm.pand(xmm2, xmm7);
1835         masm.addsd(xmm5, xmm6);
1836         masm.subsd(xmm7, xmm2);
1837         masm.addpd(xmm5, xmm0);
1838         masm.andl(rax, 32752);
1839         masm.subl(rax, 16368);
1840         masm.andl(rcx, 32752);
<span class="line-modified">1841         masm.cmpl(rcx, 32752);</span>
<span class="line-removed">1842         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block45);</span>
1843         masm.addl(rcx, rax);
<span class="line-modified">1844         masm.cmpl(rcx, 16576);</span>
<span class="line-removed">1845         masm.jcc(AMD64Assembler.ConditionFlag.AboveEqual, block51);</span>
1846         masm.pshufd(xmm0, xmm5, 238);
1847         masm.pand(xmm4, xmm1);
1848         masm.movdqu(xmm3, xmm1);
1849         masm.addsd(xmm5, xmm0);
1850         masm.subsd(xmm1, xmm4);
1851         masm.xorpd(xmm6, xmm6);
1852         masm.movl(rdx, 17080);
1853         masm.pinsrw(xmm6, rdx, 3);
1854         masm.addsd(xmm7, xmm5);
1855         masm.mulsd(xmm4, xmm2);
1856         masm.mulsd(xmm1, xmm2);
1857         masm.movdqu(xmm5, xmm6);
1858         masm.mulsd(xmm3, xmm7);
1859         masm.addsd(xmm6, xmm4);
1860         masm.addsd(xmm1, xmm3);
1861         masm.movdqu(xmm7, recordExternalAddress(crb, eCoeff));         // 0xe78a6731, 0x3f55d87f,
1862                                                                        // 0xd704a0c0, 0x3fac6b08
1863         masm.movdl(rdx, xmm6);
1864         masm.subsd(xmm6, xmm5);
1865         masm.leaq(tmp4, recordExternalAddress(crb, tExp));
</pre>
<hr />
<pre>
1870         masm.subsd(xmm4, xmm6);
1871         masm.movl(rcx, rdx);
1872         masm.andl(rdx, 255);
1873         masm.addl(rdx, rdx);
1874         masm.movdqu(xmm5, new AMD64Address(tmp4, rdx, AMD64Address.Scale.Times8, 0));
1875         masm.addsd(xmm4, xmm1);
1876         masm.pextrw(rdx, xmm6, 3);
1877         masm.shrl(rcx, 8);
1878         masm.movl(rax, rcx);
1879         masm.shrl(rcx, 1);
1880         masm.subl(rax, rcx);
1881         masm.shll(rcx, 20);
1882         masm.movdl(xmm6, rcx);
1883         masm.pshufd(xmm0, xmm4, 68);
1884         masm.pshufd(xmm1, xmm4, 68);
1885         masm.mulpd(xmm0, xmm0);
1886         masm.mulpd(xmm7, xmm1);
1887         masm.pshufd(xmm6, xmm6, 17);
1888         masm.mulsd(xmm2, xmm4);
1889         masm.andl(rdx, 32767);
<span class="line-modified">1890         masm.cmpl(rdx, 16529);</span>
<span class="line-removed">1891         masm.jcc(AMD64Assembler.ConditionFlag.Above, block12);</span>
1892         masm.mulsd(xmm0, xmm0);
1893         masm.paddd(xmm5, xmm6);
1894         masm.addpd(xmm3, xmm7);
1895         masm.mulsd(xmm2, xmm5);
1896         masm.pshufd(xmm6, xmm5, 238);
1897         masm.mulpd(xmm0, xmm3);
1898         masm.addsd(xmm2, xmm6);
1899         masm.pshufd(xmm3, xmm0, 238);
1900         masm.addl(rax, 1023);
1901         masm.shll(rax, 20);
1902         masm.orl(rax, tmp1);
1903         masm.movdl(xmm4, rax);
1904         masm.mulsd(xmm0, xmm5);
1905         masm.mulsd(xmm3, xmm5);
1906         masm.addsd(xmm0, xmm2);
1907         masm.psllq(xmm4, 32);
1908         masm.addsd(xmm0, xmm3);
1909         masm.movdqu(xmm1, xmm0);
1910         masm.addsd(xmm0, xmm5);
1911         masm.mulsd(xmm0, xmm4);
1912         masm.pextrw(rax, xmm0, 3);
<span class="line-modified">1913         masm.andl(rax, 32752);</span>
<span class="line-modified">1914         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block13);</span>
<span class="line-removed">1915         masm.cmpl(rax, 32752);</span>
<span class="line-removed">1916         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block14);</span>
1917 
1918         masm.bind(block52);
1919         masm.jmp(block56);
1920 
1921         masm.bind(block45);
1922         masm.movq(xmm0, new AMD64Address(rsp, 8));
1923         masm.xorpd(xmm2, xmm2);
1924         masm.movl(rax, 49136);
1925         masm.pinsrw(xmm2, rax, 3);
1926         masm.addsd(xmm2, xmm0);
1927         masm.pextrw(rax, xmm2, 3);
<span class="line-modified">1928         masm.cmpl(rax, 0);</span>
<span class="line-removed">1929         masm.jcc(AMD64Assembler.ConditionFlag.NotEqual, block53);</span>
1930         masm.xorpd(xmm0, xmm0);
1931         masm.movl(rax, 32760);
1932         masm.pinsrw(xmm0, rax, 3);
1933         masm.jmp(block56);
1934 
1935         masm.bind(block53);
1936         masm.movq(xmm1, new AMD64Address(rsp, 16));
1937         masm.movdl(rdx, xmm1);
1938         masm.movdqu(xmm3, xmm1);
1939         masm.psrlq(xmm3, 20);
1940         masm.movdl(rcx, xmm3);
1941         masm.orl(rcx, rdx);
<span class="line-modified">1942         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block54);</span>
1943         masm.addsd(xmm1, xmm1);
1944         masm.movdqu(xmm0, xmm1);
1945         masm.jmp(block56);
1946 
1947         masm.bind(block51);
1948         masm.pextrw(rax, xmm1, 3);
1949         masm.pextrw(rcx, xmm2, 3);
1950         masm.xorl(rax, rcx);
<span class="line-modified">1951         masm.testl(rax, 32768);</span>
<span class="line-removed">1952         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block47);</span>
1953         masm.jmp(block46);
1954 
1955         masm.bind(block54);
1956         masm.pextrw(rax, xmm0, 3);
1957         masm.andl(rax, 32752);
1958         masm.pextrw(rdx, xmm1, 3);
1959         masm.xorpd(xmm0, xmm0);
1960         masm.subl(rax, 16368);
1961         masm.xorl(rax, rdx);
<span class="line-modified">1962         masm.testl(rax, 32768);</span>
<span class="line-removed">1963         masm.jcc(AMD64Assembler.ConditionFlag.Equal, block55);</span>
1964         masm.jmp(block56);
1965 
1966         masm.bind(block55);
1967         masm.movl(rdx, 32752);
1968         masm.pinsrw(xmm0, rdx, 3);
1969         masm.jmp(block56);
1970 
1971         masm.bind(block17);
1972         masm.movq(new AMD64Address(rsp, 24), xmm0);
1973 
1974         masm.movq(xmm0, new AMD64Address(rsp, 24));
1975 
1976         masm.bind(block56);
1977         masm.addq(rsp, 40);
1978     }
1979 }
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2018, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * Copyright (c) 2016, Intel Corporation. All rights reserved.
   4  * Intel Math Library (LIBM) Source Code
   5  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   6  *
   7  * This code is free software; you can redistribute it and/or modify it
   8  * under the terms of the GNU General Public License version 2 only, as
   9  * published by the Free Software Foundation.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  31 import static jdk.vm.ci.amd64.AMD64.r8;
  32 import static jdk.vm.ci.amd64.AMD64.r9;
  33 import static jdk.vm.ci.amd64.AMD64.rax;
  34 import static jdk.vm.ci.amd64.AMD64.rcx;
  35 import static jdk.vm.ci.amd64.AMD64.rdx;
  36 import static jdk.vm.ci.amd64.AMD64.rsp;
  37 import static jdk.vm.ci.amd64.AMD64.xmm0;
  38 import static jdk.vm.ci.amd64.AMD64.xmm1;
  39 import static jdk.vm.ci.amd64.AMD64.xmm2;
  40 import static jdk.vm.ci.amd64.AMD64.xmm3;
  41 import static jdk.vm.ci.amd64.AMD64.xmm4;
  42 import static jdk.vm.ci.amd64.AMD64.xmm5;
  43 import static jdk.vm.ci.amd64.AMD64.xmm6;
  44 import static jdk.vm.ci.amd64.AMD64.xmm7;
  45 import static org.graalvm.compiler.lir.amd64.AMD64HotSpotHelper.pointerConstant;
  46 import static org.graalvm.compiler.lir.amd64.AMD64HotSpotHelper.recordExternalAddress;
  47 
  48 import org.graalvm.compiler.asm.Label;
  49 import org.graalvm.compiler.asm.amd64.AMD64Address;
  50 import org.graalvm.compiler.asm.amd64.AMD64Assembler;
<span class="line-added">  51 import org.graalvm.compiler.asm.amd64.AMD64Assembler.ConditionFlag;</span>
  52 import org.graalvm.compiler.asm.amd64.AMD64MacroAssembler;
  53 import org.graalvm.compiler.lir.LIRInstructionClass;
  54 import org.graalvm.compiler.lir.asm.ArrayDataPointerConstant;
  55 import org.graalvm.compiler.lir.asm.CompilationResultBuilder;
  56 
  57 import jdk.vm.ci.code.Register;
  58 
  59 /**
  60  * &lt;pre&gt;
  61  *                     ALGORITHM DESCRIPTION  - POW()
  62  *                     ---------------------
  63  *
  64  *    Let x=2^k * mx, mx in [1,2)
  65  *
  66  *    log2(x) calculation:
  67  *
  68  *    Get B~1/mx based on the output of rcpps instruction (B0)
  69  *    B = int((B0*LH*2^9+0.5))/2^9
  70  *    LH is a short approximation for log2(e)
  71  *
</pre>
<hr />
<pre>
 891         Label block50 = new Label();
 892         Label block51 = new Label();
 893         Label block52 = new Label();
 894         Label block53 = new Label();
 895         Label block54 = new Label();
 896         Label block55 = new Label();
 897         Label block56 = new Label();
 898         Label block57 = new Label();
 899 
 900         Register tmp1 = r8;
 901         Register tmp2 = r9;
 902         Register tmp3 = r10;
 903         Register tmp4 = r11;
 904 
 905         masm.subq(rsp, 40);
 906         masm.movsd(new AMD64Address(rsp, 8), xmm0);
 907         masm.movsd(new AMD64Address(rsp, 16), xmm1);
 908 
 909         // Special case: pow(x, 2.0) =&gt; x * x
 910         masm.movdq(tmp1, xmm1);
<span class="line-added"> 911         // TODO (yz) adjust recorded address before jcc mitigation</span>
 912         masm.cmpq(tmp1, recordExternalAddress(crb, double2));
 913         masm.jccb(AMD64Assembler.ConditionFlag.NotEqual, block57);
 914         masm.mulsd(xmm0, xmm0);
 915         masm.jmp(block56);
 916 
 917         masm.bind(block57);
 918         masm.pextrw(rax, xmm0, 3);
 919         masm.xorpd(xmm2, xmm2);
 920         masm.movq(tmp2, 0x3ff0000000000000L);
 921         masm.movdq(xmm2, tmp2);
 922         masm.movl(tmp1, 1069088768);
 923         masm.movdq(xmm7, tmp1);
 924         masm.xorpd(xmm1, xmm1);
 925         masm.movq(tmp3, 0x77f0000000000000L);
 926         masm.movdq(xmm1, tmp3);
 927         masm.movdqu(xmm3, xmm0);
 928         masm.movl(rdx, 32752);
 929         masm.andl(rdx, rax);
 930         masm.subl(rdx, 16368);
 931         masm.movl(rcx, rdx);
 932         masm.sarl(rdx, 31);
 933         masm.addl(rcx, rdx);
 934         masm.xorl(rcx, rdx);
 935         masm.por(xmm0, xmm2);
 936         masm.movdqu(xmm6, recordExternalAddress(crb, highsigmask));    // 0x00000000, 0xfffff800,
 937                                                                        // 0x00000000, 0xfffff800
 938         masm.psrlq(xmm0, 27);
 939         masm.movq(xmm2, recordExternalAddress(crb, log2E));            // 0x00000000, 0x3ff72000,
 940                                                                        // 0x161bb241, 0xbf5dabe1
 941         masm.psrld(xmm0, 2);
 942         masm.addl(rcx, 16);
 943         masm.bsrl(rcx, rcx);
 944         masm.rcpps(xmm0, xmm0);
 945         masm.psllq(xmm3, 12);
 946         masm.movl(tmp4, 8192);
 947         masm.movdq(xmm4, tmp4);
 948         masm.psrlq(xmm3, 12);
 949         masm.subl(rax, 16);
<span class="line-modified"> 950         masm.cmplAndJcc(rax, 32736, ConditionFlag.AboveEqual, block0, false);</span>

 951         masm.movl(tmp1, 0);
 952 
 953         masm.bind(block1);
 954         masm.mulss(xmm0, xmm7);
 955         masm.movl(rdx, -1);
 956         masm.subl(rcx, 4);
 957         masm.shll(rdx);
 958         masm.shlq(rdx, 32);
 959         masm.movdq(xmm5, rdx);
 960         masm.por(xmm3, xmm1);
 961         masm.subl(rax, 16351);
<span class="line-modified"> 962         masm.cmplAndJcc(rax, 1, ConditionFlag.BelowEqual, block2, false);</span>

 963         masm.paddd(xmm0, xmm4);
 964         masm.pand(xmm5, xmm3);
 965         masm.movdl(rdx, xmm0);
 966         masm.psllq(xmm0, 29);
 967 
 968         masm.bind(block3);
 969         masm.subsd(xmm3, xmm5);
 970         masm.pand(xmm0, xmm6);
 971         masm.subl(rax, 1);
 972         masm.sarl(rax, 4);
 973         masm.cvtsi2sdl(xmm7, rax);
 974         masm.mulpd(xmm5, xmm0);
 975 
 976         masm.bind(block4);
 977         masm.mulsd(xmm3, xmm0);
 978         masm.movdqu(xmm1, recordExternalAddress(crb, coeff));          // 0x6dc96112, 0xbf836578,
 979                                                                        // 0xee241472, 0xbf9b0301
 980         masm.leaq(tmp4, recordExternalAddress(crb, lTbl));
 981         masm.subsd(xmm5, xmm2);
 982         masm.movdqu(xmm4, recordExternalAddress(crb, coeff16));        // 0x9f95985a, 0xbfb528db,
</pre>
<hr />
<pre>
1001         masm.mulpd(xmm1, xmm2);
1002         masm.mulpd(xmm4, xmm2);
1003         masm.addsd(xmm5, xmm7);
1004         masm.mulsd(xmm2, xmm3);
1005         masm.addpd(xmm6, xmm1);
1006         masm.mulsd(xmm3, xmm3);
1007         masm.addpd(xmm0, xmm4);
1008         masm.movq(xmm1, new AMD64Address(rsp, 16));
1009         masm.movw(rcx, new AMD64Address(rsp, 22));
1010         masm.pshufd(xmm7, xmm5, 238);
1011         masm.movq(xmm4, recordExternalAddress(crb, highmaskY));        // 0x00000000, 0xfffffff8,
1012                                                                        // 0x00000000, 0xffffffff
1013         masm.mulpd(xmm6, xmm2);
1014         masm.pshufd(xmm3, xmm3, 68);
1015         masm.mulpd(xmm0, xmm2);
1016         masm.shll(rax, 4);
1017         masm.subl(rax, 15872);
1018         masm.andl(rcx, 32752);
1019         masm.addl(rax, rcx);
1020         masm.mulpd(xmm3, xmm6);
<span class="line-modified">1021         masm.cmplAndJcc(rax, 624, ConditionFlag.AboveEqual, block5, false);</span>

1022         masm.xorpd(xmm6, xmm6);
1023         masm.movl(rdx, 17080);
1024         masm.pinsrw(xmm6, rdx, 3);
1025         masm.movdqu(xmm2, xmm1);
1026         masm.pand(xmm4, xmm1);
1027         masm.subsd(xmm1, xmm4);
1028         masm.mulsd(xmm4, xmm5);
1029         masm.addsd(xmm0, xmm7);
1030         masm.mulsd(xmm1, xmm5);
1031         masm.movdqu(xmm7, xmm6);
1032         masm.addsd(xmm6, xmm4);
1033         masm.leaq(tmp4, recordExternalAddress(crb, tExp));
1034         masm.addpd(xmm3, xmm0);
1035         masm.movdl(rdx, xmm6);
1036         masm.subsd(xmm6, xmm7);
1037         masm.pshufd(xmm0, xmm3, 238);
1038         masm.subsd(xmm4, xmm6);
1039         masm.addsd(xmm0, xmm3);
1040         masm.movl(rcx, rdx);
1041         masm.andl(rdx, 255);
</pre>
<hr />
<pre>
1062         masm.mulpd(xmm7, xmm4);
1063         masm.paddd(xmm5, xmm6);
1064         masm.mulsd(xmm1, xmm5);
1065         masm.pshufd(xmm6, xmm5, 238);
1066         masm.mulsd(xmm0, xmm0);
1067         masm.addpd(xmm3, xmm7);
1068         masm.addsd(xmm1, xmm6);
1069         masm.mulpd(xmm0, xmm3);
1070         masm.pshufd(xmm3, xmm0, 238);
1071         masm.mulsd(xmm0, xmm5);
1072         masm.mulsd(xmm3, xmm5);
1073         masm.addsd(xmm0, xmm1);
1074         masm.addsd(xmm0, xmm3);
1075         masm.addsd(xmm0, xmm5);
1076         masm.jmp(block56);
1077 
1078         masm.bind(block0);
1079         masm.addl(rax, 16);
1080         masm.movl(rdx, 32752);
1081         masm.andl(rdx, rax);
<span class="line-modified">1082         masm.cmplAndJcc(rdx, 32752, ConditionFlag.Equal, block6, false);</span>
<span class="line-modified">1083         masm.testlAndJcc(rax, 32768, ConditionFlag.NotEqual, block7, false);</span>


1084 
1085         masm.bind(block8);
1086         masm.movq(xmm0, new AMD64Address(rsp, 8));
1087         masm.movq(xmm3, new AMD64Address(rsp, 8));
1088         masm.movdl(rdx, xmm3);
1089         masm.psrlq(xmm3, 32);
1090         masm.movdl(rcx, xmm3);
1091         masm.orl(rdx, rcx);
<span class="line-modified">1092         masm.cmplAndJcc(rdx, 0, ConditionFlag.Equal, block9, false);</span>

1093         masm.xorpd(xmm3, xmm3);
1094         masm.movl(rax, 18416);
1095         masm.pinsrw(xmm3, rax, 3);
1096         masm.mulsd(xmm0, xmm3);
1097         masm.xorpd(xmm2, xmm2);
1098         masm.movl(rax, 16368);
1099         masm.pinsrw(xmm2, rax, 3);
1100         masm.movdqu(xmm3, xmm0);
1101         masm.pextrw(rax, xmm0, 3);
1102         masm.por(xmm0, xmm2);
1103         masm.movl(rcx, 18416);
1104         masm.psrlq(xmm0, 27);
1105         masm.movq(xmm2, recordExternalAddress(crb, log2E));            // 0x00000000, 0x3ff72000,
1106                                                                        // 0x161bb241, 0xbf5dabe1
1107         masm.psrld(xmm0, 2);
1108         masm.rcpps(xmm0, xmm0);
1109         masm.psllq(xmm3, 12);
1110         masm.movdqu(xmm6, recordExternalAddress(crb, highsigmask));    // 0x00000000, 0xfffff800,
1111                                                                        // 0x00000000, 0xfffff800
1112         masm.psrlq(xmm3, 12);
</pre>
<hr />
<pre>
1119         masm.movdl(rdx, xmm0);
1120         masm.psllq(xmm0, 29);
1121         masm.pand(xmm5, xmm3);
1122         masm.movl(tmp1, 0);
1123         masm.pand(xmm0, xmm6);
1124         masm.subsd(xmm3, xmm5);
1125         masm.andl(rax, 32752);
1126         masm.subl(rax, 18416);
1127         masm.sarl(rax, 4);
1128         masm.cvtsi2sdl(xmm7, rax);
1129         masm.mulpd(xmm5, xmm0);
1130         masm.jmp(block4);
1131 
1132         masm.bind(block10);
1133         masm.movq(xmm0, new AMD64Address(rsp, 8));
1134         masm.movq(xmm3, new AMD64Address(rsp, 8));
1135         masm.movdl(rdx, xmm3);
1136         masm.psrlq(xmm3, 32);
1137         masm.movdl(rcx, xmm3);
1138         masm.orl(rdx, rcx);
<span class="line-modified">1139         masm.cmplAndJcc(rdx, 0, ConditionFlag.Equal, block9, false);</span>

1140         masm.xorpd(xmm3, xmm3);
1141         masm.movl(rax, 18416);
1142         masm.pinsrw(xmm3, rax, 3);
1143         masm.mulsd(xmm0, xmm3);
1144         masm.xorpd(xmm2, xmm2);
1145         masm.movl(rax, 16368);
1146         masm.pinsrw(xmm2, rax, 3);
1147         masm.movdqu(xmm3, xmm0);
1148         masm.pextrw(rax, xmm0, 3);
1149         masm.por(xmm0, xmm2);
1150         masm.movl(rcx, 18416);
1151         masm.psrlq(xmm0, 27);
1152         masm.movq(xmm2, recordExternalAddress(crb, log2E));            // 0x00000000, 0x3ff72000,
1153                                                                        // 0x161bb241, 0xbf5dabe1
1154         masm.psrld(xmm0, 2);
1155         masm.rcpps(xmm0, xmm0);
1156         masm.psllq(xmm3, 12);
1157         masm.movdqu(xmm6, recordExternalAddress(crb, highsigmask));    // 0x00000000, 0xfffff800,
1158                                                                        // 0x00000000, 0xfffff800
1159         masm.psrlq(xmm3, 12);
1160         masm.mulss(xmm0, xmm7);
1161         masm.movl(rdx, -1024);
1162         masm.movdl(xmm5, rdx);
1163         masm.por(xmm3, xmm1);
1164         masm.paddd(xmm0, xmm4);
1165         masm.psllq(xmm5, 32);
1166         masm.movdl(rdx, xmm0);
1167         masm.psllq(xmm0, 29);
1168         masm.pand(xmm5, xmm3);
1169         masm.movl(tmp1, Integer.MIN_VALUE);
1170         masm.pand(xmm0, xmm6);
1171         masm.subsd(xmm3, xmm5);
1172         masm.andl(rax, 32752);
1173         masm.subl(rax, 18416);
1174         masm.sarl(rax, 4);
1175         masm.cvtsi2sdl(xmm7, rax);
1176         masm.mulpd(xmm5, xmm0);
1177         masm.jmp(block4);
1178 
1179         masm.bind(block5);
<span class="line-modified">1180         masm.cmplAndJcc(rax, 0, ConditionFlag.Less, block11, false);</span>
<span class="line-modified">1181         masm.cmplAndJcc(rax, 752, ConditionFlag.AboveEqual, block12, false);</span>


1182         masm.addsd(xmm0, xmm7);
1183         masm.movq(xmm2, recordExternalAddress(crb, halfmask));         // 0xf8000000, 0xffffffff,
1184                                                                        // 0xf8000000, 0xffffffff
1185         masm.addpd(xmm3, xmm0);
1186         masm.xorpd(xmm6, xmm6);
1187         masm.movl(rax, 17080);
1188         masm.pinsrw(xmm6, rax, 3);
1189         masm.pshufd(xmm0, xmm3, 238);
1190         masm.addsd(xmm0, xmm3);
1191         masm.movdqu(xmm3, xmm5);
1192         masm.addsd(xmm5, xmm0);
1193         masm.movdqu(xmm4, xmm2);
1194         masm.subsd(xmm3, xmm5);
1195         masm.movdqu(xmm7, xmm5);
1196         masm.pand(xmm5, xmm2);
1197         masm.movdqu(xmm2, xmm1);
1198         masm.pand(xmm4, xmm1);
1199         masm.subsd(xmm7, xmm5);
1200         masm.addsd(xmm0, xmm3);
1201         masm.subsd(xmm1, xmm4);
</pre>
<hr />
<pre>
1213                                                                        // 0xd704a0c0, 0x3fac6b08
1214         masm.movdqu(xmm3, recordExternalAddress(crb, eCoeff16));       // 0x6fba4e77, 0x3f83b2ab,
1215                                                                        // 0xff82c58f, 0x3fcebfbd
1216         masm.subsd(xmm4, xmm6);
1217         masm.pextrw(rdx, xmm6, 3);
1218         masm.movl(rcx, rax);
1219         masm.andl(rax, 255);
1220         masm.addl(rax, rax);
1221         masm.movdqu(xmm5, new AMD64Address(tmp4, rax, AMD64Address.Scale.Times8, 0));
1222         masm.addsd(xmm2, xmm4);
1223         masm.sarl(rcx, 8);
1224         masm.movl(rax, rcx);
1225         masm.sarl(rcx, 1);
1226         masm.subl(rax, rcx);
1227         masm.shll(rcx, 20);
1228         masm.xorl(rcx, tmp1);
1229         masm.movdl(xmm6, rcx);
1230         masm.movq(xmm1, recordExternalAddress(crb, eCoeff32));         // 0xfefa39ef, 0x3fe62e42,
1231                                                                        // 0x00000000, 0x00000000
1232         masm.andl(rdx, 32767);
<span class="line-modified">1233         masm.cmplAndJcc(rdx, 16529, ConditionFlag.Above, block12, false);</span>

1234         masm.pshufd(xmm0, xmm2, 68);
1235         masm.pshufd(xmm4, xmm2, 68);
1236         masm.mulpd(xmm0, xmm0);
1237         masm.mulpd(xmm7, xmm4);
1238         masm.pshufd(xmm6, xmm6, 17);
1239         masm.mulsd(xmm1, xmm2);
1240         masm.mulsd(xmm0, xmm0);
1241         masm.paddd(xmm5, xmm6);
1242         masm.addpd(xmm3, xmm7);
1243         masm.mulsd(xmm1, xmm5);
1244         masm.pshufd(xmm6, xmm5, 238);
1245         masm.mulpd(xmm0, xmm3);
1246         masm.addsd(xmm1, xmm6);
1247         masm.pshufd(xmm3, xmm0, 238);
1248         masm.mulsd(xmm0, xmm5);
1249         masm.mulsd(xmm3, xmm5);
1250         masm.shll(rax, 4);
1251         masm.xorpd(xmm4, xmm4);
1252         masm.addl(rax, 16368);
1253         masm.pinsrw(xmm4, rax, 3);
1254         masm.addsd(xmm0, xmm1);
1255         masm.addsd(xmm0, xmm3);
1256         masm.movdqu(xmm1, xmm0);
1257         masm.addsd(xmm0, xmm5);
1258         masm.mulsd(xmm0, xmm4);
1259         masm.pextrw(rax, xmm0, 3);
<span class="line-modified">1260         masm.andlAndJcc(rax, 32752, ConditionFlag.Equal, block13, false);</span>
<span class="line-modified">1261         masm.cmplAndJcc(rax, 32752, ConditionFlag.Equal, block14, false);</span>


1262         masm.jmp(block56);
1263 
1264         masm.bind(block6);
1265         masm.movq(xmm1, new AMD64Address(rsp, 16));
1266         masm.movq(xmm0, new AMD64Address(rsp, 8));
1267         masm.movdqu(xmm2, xmm0);
1268         masm.movdl(rax, xmm2);
1269         masm.psrlq(xmm2, 20);
1270         masm.movdl(rdx, xmm2);
1271         masm.orl(rax, rdx);
<span class="line-modified">1272         masm.jcc(ConditionFlag.Equal, block15);</span>
1273         masm.movdl(rax, xmm1);
1274         masm.psrlq(xmm1, 32);
1275         masm.movdl(rdx, xmm1);
1276         masm.movl(rcx, rdx);
1277         masm.addl(rdx, rdx);
1278         masm.orl(rax, rdx);
<span class="line-modified">1279         masm.jcc(ConditionFlag.Equal, block16);</span>
1280         masm.addsd(xmm0, xmm0);
1281         masm.jmp(block56);
1282 
1283         masm.bind(block16);
1284         masm.xorpd(xmm0, xmm0);
1285         masm.movl(rax, 16368);
1286         masm.pinsrw(xmm0, rax, 3);
1287         masm.movl(new AMD64Address(rsp, 0), 29);
1288         masm.jmp(block17);
1289 
1290         masm.bind(block18);
1291         masm.movq(xmm0, new AMD64Address(rsp, 16));
1292         masm.addpd(xmm0, xmm0);
1293         masm.jmp(block56);
1294 
1295         masm.bind(block15);
1296         masm.movdl(rax, xmm1);
1297         masm.movdqu(xmm2, xmm1);
1298         masm.psrlq(xmm1, 32);
1299         masm.movdl(rdx, xmm1);
1300         masm.movl(rcx, rdx);
1301         masm.addl(rdx, rdx);
1302         masm.orl(rax, rdx);
<span class="line-modified">1303         masm.jcc(ConditionFlag.Equal, block19);</span>
1304         masm.pextrw(rax, xmm2, 3);
1305         masm.andl(rax, 32752);
<span class="line-modified">1306         masm.cmplAndJcc(rax, 32752, ConditionFlag.NotEqual, block20, false);</span>

1307         masm.movdl(rax, xmm2);
1308         masm.psrlq(xmm2, 20);
1309         masm.movdl(rdx, xmm2);
1310         masm.orl(rax, rdx);
<span class="line-modified">1311         masm.jcc(ConditionFlag.NotEqual, block18);</span>
1312 
1313         masm.bind(block20);
1314         masm.pextrw(rax, xmm0, 3);
<span class="line-modified">1315         masm.testlAndJcc(rax, 32768, ConditionFlag.NotEqual, block21, false);</span>
<span class="line-modified">1316         masm.testlAndJcc(rcx, Integer.MIN_VALUE, ConditionFlag.NotEqual, block22, false);</span>


1317         masm.jmp(block56);
1318 
1319         masm.bind(block23);
1320         masm.movq(xmm1, new AMD64Address(rsp, 16));
1321         masm.movdl(rax, xmm1);
<span class="line-modified">1322         masm.testlAndJcc(rax, 1, ConditionFlag.NotEqual, block24, false);</span>
<span class="line-modified">1323         masm.testlAndJcc(rax, 2, ConditionFlag.NotEqual, block25, false);</span>


1324         masm.jmp(block24);
1325 
1326         masm.bind(block21);
1327         masm.shrl(rcx, 20);
1328         masm.andl(rcx, 2047);
<span class="line-modified">1329         masm.cmplAndJcc(rcx, 1075, ConditionFlag.Above, block24, false);</span>
<span class="line-modified">1330         masm.jcc(ConditionFlag.Equal, block26);</span>
<span class="line-modified">1331         masm.cmplAndJcc(rcx, 1074, ConditionFlag.Above, block23, false);</span>
<span class="line-modified">1332         masm.cmplAndJcc(rcx, 1023, ConditionFlag.Below, block24, false);</span>



1333         masm.movq(xmm1, new AMD64Address(rsp, 16));
1334         masm.movl(rax, 17208);
1335         masm.xorpd(xmm3, xmm3);
1336         masm.pinsrw(xmm3, rax, 3);
1337         masm.movdqu(xmm4, xmm3);
1338         masm.addsd(xmm3, xmm1);
1339         masm.subsd(xmm4, xmm3);
1340         masm.addsd(xmm1, xmm4);
1341         masm.pextrw(rax, xmm1, 3);
<span class="line-modified">1342         masm.andlAndJcc(rax, 32752, ConditionFlag.NotEqual, block24, false);</span>

1343         masm.movdl(rax, xmm3);
<span class="line-modified">1344         masm.andlAndJcc(rax, 1, ConditionFlag.Equal, block24, false);</span>

1345 
1346         masm.bind(block25);
1347         masm.movq(xmm1, new AMD64Address(rsp, 16));
1348         masm.pextrw(rax, xmm1, 3);
<span class="line-modified">1349         masm.andlAndJcc(rax, 32768, ConditionFlag.NotEqual, block27, false);</span>

1350         masm.jmp(block56);
1351 
1352         masm.bind(block27);
1353         masm.xorpd(xmm0, xmm0);
1354         masm.movl(rax, 32768);
1355         masm.pinsrw(xmm0, rax, 3);
1356         masm.jmp(block56);
1357 
1358         masm.bind(block24);
1359         masm.movq(xmm1, new AMD64Address(rsp, 16));
1360         masm.pextrw(rax, xmm1, 3);
<span class="line-modified">1361         masm.andlAndJcc(rax, 32768, ConditionFlag.NotEqual, block22, false);</span>

1362         masm.xorpd(xmm0, xmm0);
1363         masm.movl(rax, 32752);
1364         masm.pinsrw(xmm0, rax, 3);
1365         masm.jmp(block56);
1366 
1367         masm.bind(block26);
1368         masm.movq(xmm1, new AMD64Address(rsp, 16));
1369         masm.movdl(rax, xmm1);
<span class="line-modified">1370         masm.andlAndJcc(rax, 1, ConditionFlag.Equal, block24, false);</span>

1371         masm.jmp(block25);
1372 
1373         masm.bind(block28);
1374         masm.movdl(rax, xmm1);
1375         masm.psrlq(xmm1, 20);
1376         masm.movdl(rdx, xmm1);
1377         masm.orl(rax, rdx);
<span class="line-modified">1378         masm.jcc(ConditionFlag.Equal, block29);</span>
1379         masm.movq(xmm0, new AMD64Address(rsp, 16));
1380         masm.addsd(xmm0, xmm0);
1381         masm.jmp(block56);
1382 
1383         masm.bind(block29);
1384         masm.movq(xmm0, new AMD64Address(rsp, 8));
1385         masm.pextrw(rax, xmm0, 3);
<span class="line-modified">1386         masm.cmplAndJcc(rax, 49136, ConditionFlag.NotEqual, block30, false);</span>

1387         masm.movdl(rcx, xmm0);
1388         masm.psrlq(xmm0, 20);
1389         masm.movdl(rdx, xmm0);
1390         masm.orl(rcx, rdx);
<span class="line-modified">1391         masm.jcc(ConditionFlag.NotEqual, block30);</span>
1392         masm.xorpd(xmm0, xmm0);
1393         masm.movl(rax, 32760);
1394         masm.pinsrw(xmm0, rax, 3);
1395         masm.jmp(block56);
1396 
1397         masm.bind(block30);
1398         masm.movq(xmm1, new AMD64Address(rsp, 16));
1399         masm.andl(rax, 32752);
1400         masm.subl(rax, 16368);
1401         masm.pextrw(rdx, xmm1, 3);
1402         masm.xorpd(xmm0, xmm0);
1403         masm.xorl(rax, rdx);
<span class="line-modified">1404         masm.andlAndJcc(rax, 32768, ConditionFlag.Equal, block31, false);</span>

1405         masm.jmp(block56);
1406 
1407         masm.bind(block31);
1408         masm.movl(rcx, 32752);
1409         masm.pinsrw(xmm0, rcx, 3);
1410         masm.jmp(block56);
1411 
1412         masm.bind(block32);
1413         masm.movdl(rax, xmm1);
<span class="line-modified">1414         masm.cmplAndJcc(rdx, 17184, ConditionFlag.Above, block33, false);</span>
<span class="line-modified">1415         masm.testlAndJcc(rax, 1, ConditionFlag.NotEqual, block34, false);</span>
<span class="line-modified">1416         masm.testlAndJcc(rax, 2, ConditionFlag.Equal, block35, false);</span>



1417         masm.jmp(block36);
1418 
1419         masm.bind(block33);
<span class="line-modified">1420         masm.testlAndJcc(rax, 1, ConditionFlag.Equal, block35, false);</span>

1421         masm.jmp(block36);
1422 
1423         masm.bind(block7);
1424         masm.movq(xmm2, new AMD64Address(rsp, 8));
1425         masm.movdl(rax, xmm2);
1426         masm.psrlq(xmm2, 31);
1427         masm.movdl(rcx, xmm2);
1428         masm.orl(rax, rcx);
<span class="line-modified">1429         masm.jcc(ConditionFlag.Equal, block9);</span>
1430         masm.movq(xmm1, new AMD64Address(rsp, 16));
1431         masm.pextrw(rdx, xmm1, 3);
1432         masm.movdl(rax, xmm1);
1433         masm.movdqu(xmm2, xmm1);
1434         masm.psrlq(xmm2, 32);
1435         masm.movdl(rcx, xmm2);
1436         masm.addl(rcx, rcx);
1437         masm.orl(rcx, rax);
<span class="line-modified">1438         masm.jcc(ConditionFlag.Equal, block37);</span>
1439         masm.andl(rdx, 32752);
<span class="line-modified">1440         masm.cmplAndJcc(rdx, 32752, ConditionFlag.Equal, block28, false);</span>
<span class="line-modified">1441         masm.cmplAndJcc(rdx, 17200, ConditionFlag.Above, block35, false);</span>
<span class="line-modified">1442         masm.cmplAndJcc(rdx, 17184, ConditionFlag.AboveEqual, block32, false);</span>
<span class="line-modified">1443         masm.cmplAndJcc(rdx, 16368, ConditionFlag.Below, block34, false);</span>




1444         masm.movl(rax, 17208);
1445         masm.xorpd(xmm2, xmm2);
1446         masm.pinsrw(xmm2, rax, 3);
1447         masm.movdqu(xmm4, xmm2);
1448         masm.addsd(xmm2, xmm1);
1449         masm.subsd(xmm4, xmm2);
1450         masm.addsd(xmm1, xmm4);
1451         masm.pextrw(rax, xmm1, 3);
<span class="line-modified">1452         masm.andlAndJcc(rax, 32767, ConditionFlag.NotEqual, block34, false);</span>

1453         masm.movdl(rax, xmm2);
<span class="line-modified">1454         masm.andlAndJcc(rax, 1, ConditionFlag.Equal, block35, false);</span>

1455 
1456         masm.bind(block36);
1457         masm.xorpd(xmm1, xmm1);
1458         masm.movl(rdx, 30704);
1459         masm.pinsrw(xmm1, rdx, 3);
1460         masm.movq(xmm2, recordExternalAddress(crb, log2E));            // 0x00000000, 0x3ff72000,
1461                                                                        // 0x161bb241, 0xbf5dabe1
1462         masm.movq(xmm4, new AMD64Address(rsp, 8));
1463         masm.pextrw(rax, xmm4, 3);
1464         masm.movl(rdx, 8192);
1465         masm.movdl(xmm4, rdx);
1466         masm.andl(rax, 32767);
<span class="line-modified">1467         masm.sublAndJcc(rax, 16, ConditionFlag.Less, block10, false);</span>

1468         masm.movl(rdx, rax);
1469         masm.andl(rdx, 32752);
1470         masm.subl(rdx, 16368);
1471         masm.movl(rcx, rdx);
1472         masm.sarl(rdx, 31);
1473         masm.addl(rcx, rdx);
1474         masm.xorl(rcx, rdx);
1475         masm.addl(rcx, 16);
1476         masm.bsrl(rcx, rcx);
1477         masm.movl(tmp1, Integer.MIN_VALUE);
1478         masm.jmp(block1);
1479 
1480         masm.bind(block34);
1481         masm.xorpd(xmm1, xmm1);
1482         masm.movl(rax, 32752);
1483         masm.pinsrw(xmm1, rax, 3);
1484         masm.xorpd(xmm0, xmm0);
1485         masm.mulsd(xmm0, xmm1);
1486         masm.movl(new AMD64Address(rsp, 0), 28);
1487         masm.jmp(block17);
1488 
1489         masm.bind(block35);
1490         masm.xorpd(xmm1, xmm1);
1491         masm.movl(rdx, 30704);
1492         masm.pinsrw(xmm1, rdx, 3);
1493         masm.movq(xmm2, recordExternalAddress(crb, log2E));            // 0x00000000, 0x3ff72000,
1494                                                                        // 0x161bb241, 0xbf5dabe1
1495         masm.movq(xmm4, new AMD64Address(rsp, 8));
1496         masm.pextrw(rax, xmm4, 3);
1497         masm.movl(rdx, 8192);
1498         masm.movdl(xmm4, rdx);
1499         masm.andl(rax, 32767);
<span class="line-modified">1500         masm.sublAndJcc(rax, 16, ConditionFlag.Less, block8, false);</span>

1501         masm.movl(rdx, rax);
1502         masm.andl(rdx, 32752);
1503         masm.subl(rdx, 16368);
1504         masm.movl(rcx, rdx);
1505         masm.sarl(rdx, 31);
1506         masm.addl(rcx, rdx);
1507         masm.xorl(rcx, rdx);
1508         masm.addl(rcx, 16);
1509         masm.bsrl(rcx, rcx);
1510         masm.movl(tmp1, 0);
1511         masm.jmp(block1);
1512 
1513         masm.bind(block19);
1514         masm.xorpd(xmm0, xmm0);
1515         masm.movl(rax, 16368);
1516         masm.pinsrw(xmm0, rax, 3);
1517         masm.jmp(block56);
1518 
1519         masm.bind(block22);
1520         masm.xorpd(xmm0, xmm0);
1521         masm.jmp(block56);
1522 
1523         masm.bind(block11);
1524         masm.addl(rax, 384);
<span class="line-modified">1525         masm.cmplAndJcc(rax, 0, ConditionFlag.Less, block38, false);</span>

1526         masm.mulsd(xmm5, xmm1);
1527         masm.addsd(xmm0, xmm7);
1528         masm.shrl(tmp1, 31);
1529         masm.addpd(xmm3, xmm0);
1530         masm.pshufd(xmm0, xmm3, 238);
1531         masm.addsd(xmm3, xmm0);
1532         masm.leaq(tmp4, recordExternalAddress(crb, log2));             // 0xfefa39ef, 0x3fe62e42,
1533                                                                        // 0xfefa39ef, 0xbfe62e42
1534         masm.movq(xmm4, new AMD64Address(tmp4, tmp1, AMD64Address.Scale.Times8, 0));
1535         masm.mulsd(xmm1, xmm3);
1536         masm.xorpd(xmm0, xmm0);
1537         masm.movl(rax, 16368);
1538         masm.shll(tmp1, 15);
1539         masm.orl(rax, tmp1);
1540         masm.pinsrw(xmm0, rax, 3);
1541         masm.addsd(xmm5, xmm1);
1542         masm.mulsd(xmm5, xmm4);
1543         masm.addsd(xmm0, xmm5);
1544         masm.jmp(block56);
1545 
1546         masm.bind(block38);
1547 
1548         masm.bind(block37);
1549         masm.xorpd(xmm0, xmm0);
1550         masm.movl(rax, 16368);
1551         masm.pinsrw(xmm0, rax, 3);
1552         masm.jmp(block56);
1553 
1554         masm.bind(block39);
1555         masm.xorpd(xmm0, xmm0);
1556         masm.movl(rax, 16368);
1557         masm.pinsrw(xmm0, rax, 3);
1558         masm.movl(new AMD64Address(rsp, 0), 26);
1559         masm.jmp(block17);
1560 
1561         masm.bind(block9);
1562         masm.movq(xmm1, new AMD64Address(rsp, 16));
1563         masm.movdqu(xmm2, xmm1);
1564         masm.pextrw(rax, xmm1, 3);
1565         masm.andl(rax, 32752);
<span class="line-modified">1566         masm.cmplAndJcc(rax, 32752, ConditionFlag.NotEqual, block40, false);</span>

1567         masm.movdl(rax, xmm2);
1568         masm.psrlq(xmm2, 20);
1569         masm.movdl(rdx, xmm2);
1570         masm.orl(rax, rdx);
<span class="line-modified">1571         masm.jcc(ConditionFlag.NotEqual, block18);</span>
1572 
1573         masm.bind(block40);
1574         masm.movdl(rax, xmm1);
1575         masm.psrlq(xmm1, 32);
1576         masm.movdl(rdx, xmm1);
1577         masm.movl(rcx, rdx);
1578         masm.addl(rdx, rdx);
1579         masm.orl(rax, rdx);
<span class="line-modified">1580         masm.jcc(ConditionFlag.Equal, block39);</span>
1581         masm.shrl(rdx, 21);
<span class="line-modified">1582         masm.cmplAndJcc(rdx, 1075, ConditionFlag.Above, block41, false);</span>
<span class="line-modified">1583         masm.jcc(ConditionFlag.Equal, block42);</span>
<span class="line-modified">1584         masm.cmplAndJcc(rdx, 1023, ConditionFlag.Below, block41, false);</span>


1585         masm.movq(xmm1, new AMD64Address(rsp, 16));
1586         masm.movl(rax, 17208);
1587         masm.xorpd(xmm3, xmm3);
1588         masm.pinsrw(xmm3, rax, 3);
1589         masm.movdqu(xmm4, xmm3);
1590         masm.addsd(xmm3, xmm1);
1591         masm.subsd(xmm4, xmm3);
1592         masm.addsd(xmm1, xmm4);
1593         masm.pextrw(rax, xmm1, 3);
<span class="line-modified">1594         masm.andlAndJcc(rax, 32752, ConditionFlag.NotEqual, block41, false);</span>

1595         masm.movdl(rax, xmm3);
<span class="line-modified">1596         masm.andlAndJcc(rax, 1, ConditionFlag.Equal, block41, false);</span>

1597 
1598         masm.bind(block43);
1599         masm.movq(xmm0, new AMD64Address(rsp, 8));
<span class="line-modified">1600         masm.testlAndJcc(rcx, Integer.MIN_VALUE, ConditionFlag.NotEqual, block44, false);</span>

1601         masm.jmp(block56);
1602 
1603         masm.bind(block42);
1604         masm.movq(xmm1, new AMD64Address(rsp, 16));
1605         masm.movdl(rax, xmm1);
<span class="line-modified">1606         masm.testlAndJcc(rax, 1, ConditionFlag.NotEqual, block43, false);</span>

1607 
1608         masm.bind(block41);
<span class="line-modified">1609         masm.testlAndJcc(rcx, Integer.MIN_VALUE, ConditionFlag.Equal, block22, false);</span>

1610         masm.xorpd(xmm0, xmm0);
1611 
1612         masm.bind(block44);
1613         masm.movl(rax, 16368);
1614         masm.xorpd(xmm1, xmm1);
1615         masm.pinsrw(xmm1, rax, 3);
1616         masm.divsd(xmm1, xmm0);
1617         masm.movdqu(xmm0, xmm1);
1618         masm.movl(new AMD64Address(rsp, 0), 27);
1619         masm.jmp(block17);
1620 
1621         masm.bind(block12);
1622         masm.movq(xmm2, new AMD64Address(rsp, 8));
1623         masm.movq(xmm6, new AMD64Address(rsp, 16));
1624         masm.pextrw(rax, xmm2, 3);
1625         masm.pextrw(rdx, xmm6, 3);
1626         masm.movl(rcx, 32752);
1627         masm.andl(rcx, rdx);
<span class="line-modified">1628         masm.cmplAndJcc(rcx, 32752, ConditionFlag.Equal, block45, false);</span>

1629         masm.andl(rax, 32752);
1630         masm.subl(rax, 16368);
1631         masm.xorl(rdx, rax);
<span class="line-modified">1632         masm.testlAndJcc(rdx, 32768, ConditionFlag.NotEqual, block46, false);</span>

1633 
1634         masm.bind(block47);
1635         masm.movl(rax, 32736);
1636         masm.pinsrw(xmm0, rax, 3);
1637         masm.shrl(tmp1, 16);
1638         masm.orl(rax, tmp1);
1639         masm.pinsrw(xmm1, rax, 3);
1640         masm.mulsd(xmm0, xmm1);
1641 
1642         masm.bind(block14);
1643         masm.movl(new AMD64Address(rsp, 0), 24);
1644         masm.jmp(block17);
1645 
1646         masm.bind(block46);
1647         masm.movl(rax, 16);
1648         masm.pinsrw(xmm0, rax, 3);
1649         masm.mulsd(xmm0, xmm0);
<span class="line-modified">1650         masm.testlAndJcc(tmp1, Integer.MIN_VALUE, ConditionFlag.Equal, block48, false);</span>

1651         masm.movq(tmp2, 0x8000000000000000L);
1652         masm.movdq(xmm2, tmp2);
1653         masm.xorpd(xmm0, xmm2);
1654 
1655         masm.bind(block48);
1656         masm.movl(new AMD64Address(rsp, 0), 25);
1657         masm.jmp(block17);
1658 
1659         masm.bind(block13);
1660         masm.pextrw(rcx, xmm5, 3);
1661         masm.pextrw(rdx, xmm4, 3);
1662         masm.movl(rax, -1);
1663         masm.andl(rcx, 32752);
1664         masm.subl(rcx, 16368);
1665         masm.andl(rdx, 32752);
1666         masm.addl(rdx, rcx);
1667         masm.movl(rcx, -31);
1668         masm.sarl(rdx, 4);
<span class="line-modified">1669         masm.sublAndJcc(rcx, rdx, ConditionFlag.LessEqual, block49, false);</span>
<span class="line-modified">1670         masm.cmplAndJcc(rcx, 20, ConditionFlag.Above, block50, false);</span>


1671         masm.shll(rax);
1672 
1673         masm.bind(block49);
1674         masm.movdl(xmm0, rax);
1675         masm.psllq(xmm0, 32);
1676         masm.pand(xmm0, xmm5);
1677         masm.subsd(xmm5, xmm0);
1678         masm.addsd(xmm5, xmm1);
1679         masm.mulsd(xmm0, xmm4);
1680         masm.mulsd(xmm5, xmm4);
1681         masm.addsd(xmm0, xmm5);
1682 
1683         masm.bind(block50);
1684         masm.jmp(block48);
1685 
1686         masm.bind(block2);
1687         masm.movw(rcx, new AMD64Address(rsp, 22));
1688         masm.movl(rdx, Integer.MIN_VALUE);
1689         masm.movdl(xmm1, rdx);
1690         masm.xorpd(xmm7, xmm7);
1691         masm.paddd(xmm0, xmm4);
1692         masm.movdl(rdx, xmm0);
1693         masm.psllq(xmm0, 29);
1694         masm.paddq(xmm1, xmm3);
1695         masm.pand(xmm5, xmm1);
1696         masm.andl(rcx, 32752);
<span class="line-modified">1697         masm.cmplAndJcc(rcx, 16560, ConditionFlag.Less, block3, false);</span>

1698         masm.pand(xmm0, xmm6);
1699         masm.subsd(xmm3, xmm5);
1700         masm.addl(rax, 16351);
1701         masm.shrl(rax, 4);
1702         masm.subl(rax, 1022);
1703         masm.cvtsi2sdl(xmm7, rax);
1704         masm.mulpd(xmm5, xmm0);
1705         masm.leaq(r11, recordExternalAddress(crb, lTbl));
1706         masm.movq(xmm4, recordExternalAddress(crb, coeffH));           // 0x00000000, 0xbfd61a00,
1707                                                                        // 0x00000000, 0xbf5dabe1
1708         masm.mulsd(xmm3, xmm0);
1709         masm.movq(xmm6, recordExternalAddress(crb, coeffH));           // 0x00000000, 0xbfd61a00,
1710                                                                        // 0x00000000, 0xbf5dabe1
1711         masm.subsd(xmm5, xmm2);
1712         masm.movq(xmm1, recordExternalAddress(crb, coeffH8));          // 0x00000000, 0xbf5dabe1
1713         masm.pshufd(xmm2, xmm3, 68);
1714         masm.unpcklpd(xmm5, xmm3);
1715         masm.addsd(xmm3, xmm5);
1716         masm.movq(xmm0, recordExternalAddress(crb, coeffH8));          // 0x00000000, 0xbf5dabe1
1717         masm.andl(rdx, 16760832);
</pre>
<hr />
<pre>
1769         masm.addpd(xmm0, xmm1);
1770         masm.addpd(xmm5, xmm2);
1771         masm.mulsd(xmm4, xmm3);
1772         masm.movq(xmm2, recordExternalAddress(crb, highmaskLogX));     // 0xf8000000, 0xffffffff,
1773                                                                        // 0x00000000, 0xfffff800
1774         masm.mulpd(xmm3, xmm3);
1775         masm.movq(xmm1, new AMD64Address(rsp, 16));
1776         masm.movw(rcx, new AMD64Address(rsp, 22));
1777         masm.mulpd(xmm0, xmm4);
1778         masm.pextrw(rax, xmm7, 3);
1779         masm.mulpd(xmm5, xmm4);
1780         masm.mulpd(xmm0, xmm3);
1781         masm.movq(xmm4, recordExternalAddress(crb, highmaskY8));       // 0x00000000, 0xffffffff
1782         masm.pand(xmm2, xmm7);
1783         masm.addsd(xmm5, xmm6);
1784         masm.subsd(xmm7, xmm2);
1785         masm.addpd(xmm5, xmm0);
1786         masm.andl(rax, 32752);
1787         masm.subl(rax, 16368);
1788         masm.andl(rcx, 32752);
<span class="line-modified">1789         masm.cmplAndJcc(rcx, 32752, ConditionFlag.Equal, block45, false);</span>

1790         masm.addl(rcx, rax);
<span class="line-modified">1791         masm.cmplAndJcc(rcx, 16576, ConditionFlag.AboveEqual, block51, false);</span>

1792         masm.pshufd(xmm0, xmm5, 238);
1793         masm.pand(xmm4, xmm1);
1794         masm.movdqu(xmm3, xmm1);
1795         masm.addsd(xmm5, xmm0);
1796         masm.subsd(xmm1, xmm4);
1797         masm.xorpd(xmm6, xmm6);
1798         masm.movl(rdx, 17080);
1799         masm.pinsrw(xmm6, rdx, 3);
1800         masm.addsd(xmm7, xmm5);
1801         masm.mulsd(xmm4, xmm2);
1802         masm.mulsd(xmm1, xmm2);
1803         masm.movdqu(xmm5, xmm6);
1804         masm.mulsd(xmm3, xmm7);
1805         masm.addsd(xmm6, xmm4);
1806         masm.addsd(xmm1, xmm3);
1807         masm.movdqu(xmm7, recordExternalAddress(crb, eCoeff));         // 0xe78a6731, 0x3f55d87f,
1808                                                                        // 0xd704a0c0, 0x3fac6b08
1809         masm.movdl(rdx, xmm6);
1810         masm.subsd(xmm6, xmm5);
1811         masm.leaq(tmp4, recordExternalAddress(crb, tExp));
</pre>
<hr />
<pre>
1816         masm.subsd(xmm4, xmm6);
1817         masm.movl(rcx, rdx);
1818         masm.andl(rdx, 255);
1819         masm.addl(rdx, rdx);
1820         masm.movdqu(xmm5, new AMD64Address(tmp4, rdx, AMD64Address.Scale.Times8, 0));
1821         masm.addsd(xmm4, xmm1);
1822         masm.pextrw(rdx, xmm6, 3);
1823         masm.shrl(rcx, 8);
1824         masm.movl(rax, rcx);
1825         masm.shrl(rcx, 1);
1826         masm.subl(rax, rcx);
1827         masm.shll(rcx, 20);
1828         masm.movdl(xmm6, rcx);
1829         masm.pshufd(xmm0, xmm4, 68);
1830         masm.pshufd(xmm1, xmm4, 68);
1831         masm.mulpd(xmm0, xmm0);
1832         masm.mulpd(xmm7, xmm1);
1833         masm.pshufd(xmm6, xmm6, 17);
1834         masm.mulsd(xmm2, xmm4);
1835         masm.andl(rdx, 32767);
<span class="line-modified">1836         masm.cmplAndJcc(rdx, 16529, ConditionFlag.Above, block12, false);</span>

1837         masm.mulsd(xmm0, xmm0);
1838         masm.paddd(xmm5, xmm6);
1839         masm.addpd(xmm3, xmm7);
1840         masm.mulsd(xmm2, xmm5);
1841         masm.pshufd(xmm6, xmm5, 238);
1842         masm.mulpd(xmm0, xmm3);
1843         masm.addsd(xmm2, xmm6);
1844         masm.pshufd(xmm3, xmm0, 238);
1845         masm.addl(rax, 1023);
1846         masm.shll(rax, 20);
1847         masm.orl(rax, tmp1);
1848         masm.movdl(xmm4, rax);
1849         masm.mulsd(xmm0, xmm5);
1850         masm.mulsd(xmm3, xmm5);
1851         masm.addsd(xmm0, xmm2);
1852         masm.psllq(xmm4, 32);
1853         masm.addsd(xmm0, xmm3);
1854         masm.movdqu(xmm1, xmm0);
1855         masm.addsd(xmm0, xmm5);
1856         masm.mulsd(xmm0, xmm4);
1857         masm.pextrw(rax, xmm0, 3);
<span class="line-modified">1858         masm.andlAndJcc(rax, 32752, ConditionFlag.Equal, block13, false);</span>
<span class="line-modified">1859         masm.cmplAndJcc(rax, 32752, ConditionFlag.Equal, block14, false);</span>


1860 
1861         masm.bind(block52);
1862         masm.jmp(block56);
1863 
1864         masm.bind(block45);
1865         masm.movq(xmm0, new AMD64Address(rsp, 8));
1866         masm.xorpd(xmm2, xmm2);
1867         masm.movl(rax, 49136);
1868         masm.pinsrw(xmm2, rax, 3);
1869         masm.addsd(xmm2, xmm0);
1870         masm.pextrw(rax, xmm2, 3);
<span class="line-modified">1871         masm.cmplAndJcc(rax, 0, ConditionFlag.NotEqual, block53, false);</span>

1872         masm.xorpd(xmm0, xmm0);
1873         masm.movl(rax, 32760);
1874         masm.pinsrw(xmm0, rax, 3);
1875         masm.jmp(block56);
1876 
1877         masm.bind(block53);
1878         masm.movq(xmm1, new AMD64Address(rsp, 16));
1879         masm.movdl(rdx, xmm1);
1880         masm.movdqu(xmm3, xmm1);
1881         masm.psrlq(xmm3, 20);
1882         masm.movdl(rcx, xmm3);
1883         masm.orl(rcx, rdx);
<span class="line-modified">1884         masm.jcc(ConditionFlag.Equal, block54);</span>
1885         masm.addsd(xmm1, xmm1);
1886         masm.movdqu(xmm0, xmm1);
1887         masm.jmp(block56);
1888 
1889         masm.bind(block51);
1890         masm.pextrw(rax, xmm1, 3);
1891         masm.pextrw(rcx, xmm2, 3);
1892         masm.xorl(rax, rcx);
<span class="line-modified">1893         masm.testlAndJcc(rax, 32768, ConditionFlag.Equal, block47, false);</span>

1894         masm.jmp(block46);
1895 
1896         masm.bind(block54);
1897         masm.pextrw(rax, xmm0, 3);
1898         masm.andl(rax, 32752);
1899         masm.pextrw(rdx, xmm1, 3);
1900         masm.xorpd(xmm0, xmm0);
1901         masm.subl(rax, 16368);
1902         masm.xorl(rax, rdx);
<span class="line-modified">1903         masm.testlAndJcc(rax, 32768, ConditionFlag.Equal, block55, false);</span>

1904         masm.jmp(block56);
1905 
1906         masm.bind(block55);
1907         masm.movl(rdx, 32752);
1908         masm.pinsrw(xmm0, rdx, 3);
1909         masm.jmp(block56);
1910 
1911         masm.bind(block17);
1912         masm.movq(new AMD64Address(rsp, 24), xmm0);
1913 
1914         masm.movq(xmm0, new AMD64Address(rsp, 24));
1915 
1916         masm.bind(block56);
1917         masm.addq(rsp, 40);
1918     }
1919 }
</pre>
</td>
</tr>
</table>
<center><a href="AMD64MathLogOp.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="AMD64MathSinOp.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>