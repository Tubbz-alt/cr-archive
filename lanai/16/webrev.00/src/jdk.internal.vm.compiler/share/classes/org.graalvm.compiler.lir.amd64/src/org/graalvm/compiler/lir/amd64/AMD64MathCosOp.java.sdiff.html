<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.lir.amd64/src/org/graalvm/compiler/lir/amd64/AMD64MathCosOp.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AMD64FrameMap.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="AMD64MathExpOp.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.lir.amd64/src/org/graalvm/compiler/lir/amd64/AMD64MathCosOp.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * Copyright (c) 2016, Intel Corporation. All rights reserved.
  4  * Intel Math Library (LIBM) Source Code
  5  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  6  *
  7  * This code is free software; you can redistribute it and/or modify it
  8  * under the terms of the GNU General Public License version 2 only, as
  9  * published by the Free Software Foundation.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
423         Label block3 = new Label();
424         Label block4 = new Label();
425         Label block5 = new Label();
426         Label block6 = new Label();
427         Label block7 = new Label();
428         Label block8 = new Label();
429         Label block9 = new Label();
430         Label block10 = new Label();
431         Label block11 = new Label();
432         Label block12 = new Label();
433         Label block13 = new Label();
434 
435         masm.push(rbx);
436         masm.subq(rsp, 16);
437         masm.movsd(new AMD64Address(rsp, 8), xmm0);
438 
439         masm.movl(rax, new AMD64Address(rsp, 12));
440         masm.movq(xmm1, recordExternalAddress(crb, pi32Inv));          // 0x6dc9c883, 0x40245f30
441         masm.andl(rax, 2147418112);
442         masm.subl(rax, 808452096);
<span class="line-modified">443         masm.cmpl(rax, 281346048);</span>
<span class="line-removed">444         masm.jcc(ConditionFlag.Above, block0);</span>
445         masm.mulsd(xmm1, xmm0);
446         masm.movdqu(xmm5, recordExternalAddress(crb, onehalf));        // 0x00000000, 0x3fe00000,
447                                                                        // 0x00000000, 0x3fe00000
448         masm.movq(xmm4, recordExternalAddress(crb, signMask));         // 0x00000000, 0x80000000
449         masm.pand(xmm4, xmm0);
450         masm.por(xmm5, xmm4);
451         masm.addpd(xmm1, xmm5);
452         masm.cvttsd2sil(rdx, xmm1);
453         masm.cvtsi2sdl(xmm1, rdx);
454         masm.movdqu(xmm2, recordExternalAddress(crb, p2));             // 0x1a600000, 0x3d90b461,
455                                                                        // 0x1a600000, 0x3d90b461
456         masm.movq(xmm3, recordExternalAddress(crb, p1));               // 0x54400000, 0x3fb921fb
457         masm.mulsd(xmm3, xmm1);
458         masm.unpcklpd(xmm1, xmm1);
459         masm.addq(rdx, 1865232);
460         masm.movdqu(xmm4, xmm0);
461         masm.andq(rdx, 63);
462         masm.movdqu(xmm5, recordExternalAddress(crb, sc4));            // 0xa556c734, 0x3ec71de3,
463                                                                        // 0x1a01a01a, 0x3efa01a0
464         masm.leaq(rax, recordExternalAddress(crb, ctable));
</pre>
<hr />
<pre>
514         masm.addsd(xmm0, xmm3);
515         masm.addsd(xmm0, xmm6);
516         masm.unpckhpd(xmm6, xmm6);
517         masm.addsd(xmm0, xmm6);
518         masm.addsd(xmm0, xmm4);
519         masm.jmp(block13);
520 
521         masm.bind(block0);
522         masm.jcc(ConditionFlag.Greater, block1);
523         masm.pextrw(rax, xmm0, 3);
524         masm.andl(rax, 32767);
525         masm.pinsrw(xmm0, rax, 3);
526         masm.movq(xmm1, recordExternalAddress(crb, one));              // 0x00000000, 0x3ff00000
527         masm.subsd(xmm1, xmm0);
528         masm.movdqu(xmm0, xmm1);
529         masm.jmp(block13);
530 
531         masm.bind(block1);
532         masm.pextrw(rax, xmm0, 3);
533         masm.andl(rax, 32752);
<span class="line-modified">534         masm.cmpl(rax, 32752);</span>
<span class="line-removed">535         masm.jcc(ConditionFlag.Equal, block2);</span>
536         masm.pextrw(rcx, xmm0, 3);
537         masm.andl(rcx, 32752);
538         masm.subl(rcx, 16224);
539         masm.shrl(rcx, 7);
540         masm.andl(rcx, 65532);
541         masm.leaq(r11, recordExternalAddress(crb, piInvTable));
542         masm.addq(rcx, r11);
543         masm.movdq(rax, xmm0);
544         masm.movl(r10, new AMD64Address(rcx, 20));
545         masm.movl(r8, new AMD64Address(rcx, 24));
546         masm.movl(rdx, rax);
547         masm.shrq(rax, 21);
548         masm.orl(rax, Integer.MIN_VALUE);
549         masm.shrl(rax, 11);
550         masm.movl(r9, r10);
551         masm.imulq(r10, rdx);
552         masm.imulq(r9, rax);
553         masm.imulq(r8, rax);
554         masm.movl(rsi, new AMD64Address(rcx, 16));
555         masm.movl(rdi, new AMD64Address(rcx, 12));
</pre>
<hr />
<pre>
607         masm.shrq(rdi, 32);
608         masm.addq(r9, rsi);
609         masm.addq(r9, rdi);
610         masm.imulq(rdx, rax);
611         masm.pextrw(rbx, xmm0, 3);
612         masm.leaq(rdi, recordExternalAddress(crb, piInvTable));
613         masm.subq(rcx, rdi);
614         masm.addl(rcx, rcx);
615         masm.addl(rcx, rcx);
616         masm.addl(rcx, rcx);
617         masm.addl(rcx, 19);
618         masm.movl(rsi, 32768);
619         masm.andl(rsi, rbx);
620         masm.shrl(rbx, 4);
621         masm.andl(rbx, 2047);
622         masm.subl(rbx, 1023);
623         masm.subl(rcx, rbx);
624         masm.addq(r9, rdx);
625         masm.movl(rdx, rcx);
626         masm.addl(rdx, 32);
<span class="line-modified">627         masm.cmpl(rcx, 1);</span>
<span class="line-removed">628         masm.jcc(ConditionFlag.Less, block3);</span>
629         masm.negl(rcx);
630         masm.addl(rcx, 29);
631         masm.shll(r9);
632         masm.movl(rdi, r9);
633         masm.andl(r9, 536870911);
<span class="line-modified">634         masm.testl(r9, 268435456);</span>
<span class="line-removed">635         masm.jcc(ConditionFlag.NotEqual, block4);</span>
636         masm.shrl(r9);
637         masm.movl(rbx, 0);
638         masm.shlq(r9, 32);
639         masm.orq(r9, r11);
640 
641         masm.bind(block5);
642 
643         masm.bind(block6);
<span class="line-modified">644         masm.cmpq(r9, 0);</span>
<span class="line-removed">645         masm.jcc(ConditionFlag.Equal, block7);</span>
646 
647         masm.bind(block8);
648         masm.bsrq(r11, r9);
649         masm.movl(rcx, 29);
<span class="line-modified">650         masm.subl(rcx, r11);</span>
<span class="line-removed">651         masm.jcc(ConditionFlag.LessEqual, block9);</span>
652         masm.shlq(r9);
653         masm.movq(rax, r10);
654         masm.shlq(r10);
655         masm.addl(rdx, rcx);
656         masm.negl(rcx);
657         masm.addl(rcx, 64);
658         masm.shrq(rax);
659         masm.shrq(r8);
660         masm.orq(r9, rax);
661         masm.orq(r10, r8);
662 
663         masm.bind(block10);
664         masm.cvtsi2sdq(xmm0, r9);
665         masm.shrq(r10, 1);
666         masm.cvtsi2sdq(xmm3, r10);
667         masm.xorpd(xmm4, xmm4);
668         masm.shll(rdx, 4);
669         masm.negl(rdx);
670         masm.addl(rdx, 16368);
671         masm.orl(rdx, rsi);
</pre>
<hr />
<pre>
767         masm.subsd(xmm5, xmm3);
768         masm.subsd(xmm3, xmm4);
769         masm.addsd(xmm1, new AMD64Address(rax, 16));
770         masm.mulpd(xmm6, xmm2);
771         masm.addsd(xmm5, xmm0);
772         masm.addsd(xmm3, xmm7);
773         masm.addsd(xmm1, xmm5);
774         masm.addsd(xmm1, xmm3);
775         masm.addsd(xmm1, xmm6);
776         masm.unpckhpd(xmm6, xmm6);
777         masm.movdqu(xmm0, xmm4);
778         masm.addsd(xmm1, xmm6);
779         masm.addsd(xmm0, xmm1);
780         masm.jmp(block13);
781 
782         masm.bind(block7);
783         masm.addl(rdx, 64);
784         masm.movq(r9, r10);
785         masm.movq(r10, r8);
786         masm.movl(r8, 0);
<span class="line-modified">787         masm.cmpq(r9, 0);</span>
<span class="line-removed">788         masm.jcc(ConditionFlag.NotEqual, block8);</span>
789         masm.addl(rdx, 64);
790         masm.movq(r9, r10);
791         masm.movq(r10, r8);
<span class="line-modified">792         masm.cmpq(r9, 0);</span>
<span class="line-removed">793         masm.jcc(ConditionFlag.NotEqual, block8);</span>
794         masm.xorpd(xmm0, xmm0);
795         masm.xorpd(xmm6, xmm6);
796         masm.jmp(block11);
797 
798         masm.bind(block9);
799         masm.jcc(ConditionFlag.Equal, block10);
800         masm.negl(rcx);
801         masm.shrq(r10);
802         masm.movq(rax, r9);
803         masm.shrq(r9);
804         masm.subl(rdx, rcx);
805         masm.negl(rcx);
806         masm.addl(rcx, 64);
807         masm.shlq(rax);
808         masm.orq(r10, rax);
809         masm.jmp(block10);
810         masm.bind(block3);
811         masm.negl(rcx);
812         masm.shlq(r9, 32);
813         masm.orq(r9, r11);
814         masm.shlq(r9);
815         masm.movq(rdi, r9);
<span class="line-modified">816         masm.testl(r9, Integer.MIN_VALUE);</span>
<span class="line-removed">817         masm.jcc(ConditionFlag.NotEqual, block12);</span>
818         masm.shrl(r9);
819         masm.movl(rbx, 0);
820         masm.shrq(rdi, 3);
821         masm.jmp(block6);
822 
823         masm.bind(block4);
824         masm.shrl(r9);
825         masm.movl(rbx, 536870912);
826         masm.shrl(rbx);
827         masm.shlq(r9, 32);
828         masm.orq(r9, r11);
829         masm.shlq(rbx, 32);
830         masm.addl(rdi, 536870912);
831         masm.movl(rcx, 0);
832         masm.movl(r11, 0);
833         masm.subq(rcx, r8);
834         masm.sbbq(r11, r10);
835         masm.sbbq(rbx, r9);
836         masm.movq(r8, rcx);
837         masm.movq(r10, r11);
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2018, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * Copyright (c) 2016, Intel Corporation. All rights reserved.
  4  * Intel Math Library (LIBM) Source Code
  5  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  6  *
  7  * This code is free software; you can redistribute it and/or modify it
  8  * under the terms of the GNU General Public License version 2 only, as
  9  * published by the Free Software Foundation.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
423         Label block3 = new Label();
424         Label block4 = new Label();
425         Label block5 = new Label();
426         Label block6 = new Label();
427         Label block7 = new Label();
428         Label block8 = new Label();
429         Label block9 = new Label();
430         Label block10 = new Label();
431         Label block11 = new Label();
432         Label block12 = new Label();
433         Label block13 = new Label();
434 
435         masm.push(rbx);
436         masm.subq(rsp, 16);
437         masm.movsd(new AMD64Address(rsp, 8), xmm0);
438 
439         masm.movl(rax, new AMD64Address(rsp, 12));
440         masm.movq(xmm1, recordExternalAddress(crb, pi32Inv));          // 0x6dc9c883, 0x40245f30
441         masm.andl(rax, 2147418112);
442         masm.subl(rax, 808452096);
<span class="line-modified">443         masm.cmplAndJcc(rax, 281346048, ConditionFlag.Above, block0, false);</span>

444         masm.mulsd(xmm1, xmm0);
445         masm.movdqu(xmm5, recordExternalAddress(crb, onehalf));        // 0x00000000, 0x3fe00000,
446                                                                        // 0x00000000, 0x3fe00000
447         masm.movq(xmm4, recordExternalAddress(crb, signMask));         // 0x00000000, 0x80000000
448         masm.pand(xmm4, xmm0);
449         masm.por(xmm5, xmm4);
450         masm.addpd(xmm1, xmm5);
451         masm.cvttsd2sil(rdx, xmm1);
452         masm.cvtsi2sdl(xmm1, rdx);
453         masm.movdqu(xmm2, recordExternalAddress(crb, p2));             // 0x1a600000, 0x3d90b461,
454                                                                        // 0x1a600000, 0x3d90b461
455         masm.movq(xmm3, recordExternalAddress(crb, p1));               // 0x54400000, 0x3fb921fb
456         masm.mulsd(xmm3, xmm1);
457         masm.unpcklpd(xmm1, xmm1);
458         masm.addq(rdx, 1865232);
459         masm.movdqu(xmm4, xmm0);
460         masm.andq(rdx, 63);
461         masm.movdqu(xmm5, recordExternalAddress(crb, sc4));            // 0xa556c734, 0x3ec71de3,
462                                                                        // 0x1a01a01a, 0x3efa01a0
463         masm.leaq(rax, recordExternalAddress(crb, ctable));
</pre>
<hr />
<pre>
513         masm.addsd(xmm0, xmm3);
514         masm.addsd(xmm0, xmm6);
515         masm.unpckhpd(xmm6, xmm6);
516         masm.addsd(xmm0, xmm6);
517         masm.addsd(xmm0, xmm4);
518         masm.jmp(block13);
519 
520         masm.bind(block0);
521         masm.jcc(ConditionFlag.Greater, block1);
522         masm.pextrw(rax, xmm0, 3);
523         masm.andl(rax, 32767);
524         masm.pinsrw(xmm0, rax, 3);
525         masm.movq(xmm1, recordExternalAddress(crb, one));              // 0x00000000, 0x3ff00000
526         masm.subsd(xmm1, xmm0);
527         masm.movdqu(xmm0, xmm1);
528         masm.jmp(block13);
529 
530         masm.bind(block1);
531         masm.pextrw(rax, xmm0, 3);
532         masm.andl(rax, 32752);
<span class="line-modified">533         masm.cmplAndJcc(rax, 32752, ConditionFlag.Equal, block2, false);</span>

534         masm.pextrw(rcx, xmm0, 3);
535         masm.andl(rcx, 32752);
536         masm.subl(rcx, 16224);
537         masm.shrl(rcx, 7);
538         masm.andl(rcx, 65532);
539         masm.leaq(r11, recordExternalAddress(crb, piInvTable));
540         masm.addq(rcx, r11);
541         masm.movdq(rax, xmm0);
542         masm.movl(r10, new AMD64Address(rcx, 20));
543         masm.movl(r8, new AMD64Address(rcx, 24));
544         masm.movl(rdx, rax);
545         masm.shrq(rax, 21);
546         masm.orl(rax, Integer.MIN_VALUE);
547         masm.shrl(rax, 11);
548         masm.movl(r9, r10);
549         masm.imulq(r10, rdx);
550         masm.imulq(r9, rax);
551         masm.imulq(r8, rax);
552         masm.movl(rsi, new AMD64Address(rcx, 16));
553         masm.movl(rdi, new AMD64Address(rcx, 12));
</pre>
<hr />
<pre>
605         masm.shrq(rdi, 32);
606         masm.addq(r9, rsi);
607         masm.addq(r9, rdi);
608         masm.imulq(rdx, rax);
609         masm.pextrw(rbx, xmm0, 3);
610         masm.leaq(rdi, recordExternalAddress(crb, piInvTable));
611         masm.subq(rcx, rdi);
612         masm.addl(rcx, rcx);
613         masm.addl(rcx, rcx);
614         masm.addl(rcx, rcx);
615         masm.addl(rcx, 19);
616         masm.movl(rsi, 32768);
617         masm.andl(rsi, rbx);
618         masm.shrl(rbx, 4);
619         masm.andl(rbx, 2047);
620         masm.subl(rbx, 1023);
621         masm.subl(rcx, rbx);
622         masm.addq(r9, rdx);
623         masm.movl(rdx, rcx);
624         masm.addl(rdx, 32);
<span class="line-modified">625         masm.cmplAndJcc(rcx, 1, ConditionFlag.Less, block3, false);</span>

626         masm.negl(rcx);
627         masm.addl(rcx, 29);
628         masm.shll(r9);
629         masm.movl(rdi, r9);
630         masm.andl(r9, 536870911);
<span class="line-modified">631         masm.testlAndJcc(r9, 268435456, ConditionFlag.NotEqual, block4, false);</span>

632         masm.shrl(r9);
633         masm.movl(rbx, 0);
634         masm.shlq(r9, 32);
635         masm.orq(r9, r11);
636 
637         masm.bind(block5);
638 
639         masm.bind(block6);
<span class="line-modified">640         masm.cmpqAndJcc(r9, 0, ConditionFlag.Equal, block7, false);</span>

641 
642         masm.bind(block8);
643         masm.bsrq(r11, r9);
644         masm.movl(rcx, 29);
<span class="line-modified">645         masm.sublAndJcc(rcx, r11, ConditionFlag.LessEqual, block9, false);</span>

646         masm.shlq(r9);
647         masm.movq(rax, r10);
648         masm.shlq(r10);
649         masm.addl(rdx, rcx);
650         masm.negl(rcx);
651         masm.addl(rcx, 64);
652         masm.shrq(rax);
653         masm.shrq(r8);
654         masm.orq(r9, rax);
655         masm.orq(r10, r8);
656 
657         masm.bind(block10);
658         masm.cvtsi2sdq(xmm0, r9);
659         masm.shrq(r10, 1);
660         masm.cvtsi2sdq(xmm3, r10);
661         masm.xorpd(xmm4, xmm4);
662         masm.shll(rdx, 4);
663         masm.negl(rdx);
664         masm.addl(rdx, 16368);
665         masm.orl(rdx, rsi);
</pre>
<hr />
<pre>
761         masm.subsd(xmm5, xmm3);
762         masm.subsd(xmm3, xmm4);
763         masm.addsd(xmm1, new AMD64Address(rax, 16));
764         masm.mulpd(xmm6, xmm2);
765         masm.addsd(xmm5, xmm0);
766         masm.addsd(xmm3, xmm7);
767         masm.addsd(xmm1, xmm5);
768         masm.addsd(xmm1, xmm3);
769         masm.addsd(xmm1, xmm6);
770         masm.unpckhpd(xmm6, xmm6);
771         masm.movdqu(xmm0, xmm4);
772         masm.addsd(xmm1, xmm6);
773         masm.addsd(xmm0, xmm1);
774         masm.jmp(block13);
775 
776         masm.bind(block7);
777         masm.addl(rdx, 64);
778         masm.movq(r9, r10);
779         masm.movq(r10, r8);
780         masm.movl(r8, 0);
<span class="line-modified">781         masm.cmpqAndJcc(r9, 0, ConditionFlag.NotEqual, block8, false);</span>

782         masm.addl(rdx, 64);
783         masm.movq(r9, r10);
784         masm.movq(r10, r8);
<span class="line-modified">785         masm.cmpqAndJcc(r9, 0, ConditionFlag.NotEqual, block8, false);</span>

786         masm.xorpd(xmm0, xmm0);
787         masm.xorpd(xmm6, xmm6);
788         masm.jmp(block11);
789 
790         masm.bind(block9);
791         masm.jcc(ConditionFlag.Equal, block10);
792         masm.negl(rcx);
793         masm.shrq(r10);
794         masm.movq(rax, r9);
795         masm.shrq(r9);
796         masm.subl(rdx, rcx);
797         masm.negl(rcx);
798         masm.addl(rcx, 64);
799         masm.shlq(rax);
800         masm.orq(r10, rax);
801         masm.jmp(block10);
802         masm.bind(block3);
803         masm.negl(rcx);
804         masm.shlq(r9, 32);
805         masm.orq(r9, r11);
806         masm.shlq(r9);
807         masm.movq(rdi, r9);
<span class="line-modified">808         masm.testlAndJcc(r9, Integer.MIN_VALUE, ConditionFlag.NotEqual, block12, false);</span>

809         masm.shrl(r9);
810         masm.movl(rbx, 0);
811         masm.shrq(rdi, 3);
812         masm.jmp(block6);
813 
814         masm.bind(block4);
815         masm.shrl(r9);
816         masm.movl(rbx, 536870912);
817         masm.shrl(rbx);
818         masm.shlq(r9, 32);
819         masm.orq(r9, r11);
820         masm.shlq(rbx, 32);
821         masm.addl(rdi, 536870912);
822         masm.movl(rcx, 0);
823         masm.movl(r11, 0);
824         masm.subq(rcx, r8);
825         masm.sbbq(r11, r10);
826         masm.sbbq(rbx, r9);
827         masm.movq(r8, rcx);
828         masm.movq(r10, r11);
</pre>
</td>
</tr>
</table>
<center><a href="AMD64FrameMap.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="AMD64MathExpOp.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>