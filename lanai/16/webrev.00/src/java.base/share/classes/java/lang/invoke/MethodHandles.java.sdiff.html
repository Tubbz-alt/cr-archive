<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/lang/invoke/MethodHandles.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="MethodHandleInfo.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="MethodType.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/lang/invoke/MethodHandles.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2008, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 301      * access checks when they are called, but rather when they are created.
 302      * Therefore, method handle access
 303      * restrictions must be enforced when a method handle is created.
 304      * The caller class against which those restrictions are enforced
 305      * is known as the {@linkplain #lookupClass() lookup class}.
 306      * &lt;p&gt;
 307      * A lookup class which needs to create method handles will call
 308      * {@link MethodHandles#lookup() MethodHandles.lookup} to create a factory for itself.
 309      * When the {@code Lookup} factory object is created, the identity of the lookup class is
 310      * determined, and securely stored in the {@code Lookup} object.
 311      * The lookup class (or its delegates) may then use factory methods
 312      * on the {@code Lookup} object to create method handles for access-checked members.
 313      * This includes all methods, constructors, and fields which are allowed to the lookup class,
 314      * even private ones.
 315      *
 316      * &lt;h2&gt;&lt;a id=&quot;lookups&quot;&gt;&lt;/a&gt;Lookup Factory Methods&lt;/h2&gt;
 317      * The factory methods on a {@code Lookup} object correspond to all major
 318      * use cases for methods, constructors, and fields.
 319      * Each method handle created by a factory method is the functional
 320      * equivalent of a particular &lt;em&gt;bytecode behavior&lt;/em&gt;.
<span class="line-modified"> 321      * (Bytecode behaviors are described in section 5.4.3.5 of the Java Virtual Machine Specification.)</span>

 322      * Here is a summary of the correspondence between these factory methods and
 323      * the behavior of the resulting method handles:
 324      * &lt;table class=&quot;striped&quot;&gt;
 325      * &lt;caption style=&quot;display:none&quot;&gt;lookup method behaviors&lt;/caption&gt;
 326      * &lt;thead&gt;
 327      * &lt;tr&gt;
 328      *     &lt;th scope=&quot;col&quot;&gt;&lt;a id=&quot;equiv&quot;&gt;&lt;/a&gt;lookup expression&lt;/th&gt;
 329      *     &lt;th scope=&quot;col&quot;&gt;member&lt;/th&gt;
 330      *     &lt;th scope=&quot;col&quot;&gt;bytecode behavior&lt;/th&gt;
 331      * &lt;/tr&gt;
 332      * &lt;/thead&gt;
 333      * &lt;tbody&gt;
 334      * &lt;tr&gt;
 335      *     &lt;th scope=&quot;row&quot;&gt;{@link java.lang.invoke.MethodHandles.Lookup#findGetter lookup.findGetter(C.class,&quot;f&quot;,FT.class)}&lt;/th&gt;
 336      *     &lt;td&gt;{@code FT f;}&lt;/td&gt;&lt;td&gt;{@code (T) this.f;}&lt;/td&gt;
 337      * &lt;/tr&gt;
 338      * &lt;tr&gt;
 339      *     &lt;th scope=&quot;row&quot;&gt;{@link java.lang.invoke.MethodHandles.Lookup#findStaticGetter lookup.findStaticGetter(C.class,&quot;f&quot;,FT.class)}&lt;/th&gt;
 340      *     &lt;td&gt;{@code static}&lt;br&gt;{@code FT f;}&lt;/td&gt;&lt;td&gt;{@code (FT) C.f;}&lt;/td&gt;
 341      * &lt;/tr&gt;
</pre>
<hr />
<pre>
 485      * under which the lookup class could have compiled, verified, and resolved a call to {@code M}.
 486      * Where the JVM would raise exceptions like {@code NoSuchMethodError},
 487      * a method handle lookup will generally raise a corresponding
 488      * checked exception, such as {@code NoSuchMethodException}.
 489      * And the effect of invoking the method handle resulting from the lookup
 490      * is &lt;a href=&quot;MethodHandles.Lookup.html#equiv&quot;&gt;exactly equivalent&lt;/a&gt;
 491      * to executing the compiled, verified, and resolved call to {@code M}.
 492      * The same point is true of fields and constructors.
 493      * &lt;p style=&quot;font-size:smaller;&quot;&gt;
 494      * &lt;em&gt;Discussion:&lt;/em&gt;
 495      * Access checks only apply to named and reflected methods,
 496      * constructors, and fields.
 497      * Other method handle creation methods, such as
 498      * {@link MethodHandle#asType MethodHandle.asType},
 499      * do not require any access checks, and are used
 500      * independently of any {@code Lookup} object.
 501      * &lt;p&gt;
 502      * If the desired member is {@code protected}, the usual JVM rules apply,
 503      * including the requirement that the lookup class must either be in the
 504      * same package as the desired member, or must inherit that member.
<span class="line-modified"> 505      * (See the Java Virtual Machine Specification, sections 4.9.2, 5.4.3.5, and 6.4.)</span>

 506      * In addition, if the desired member is a non-static field or method
 507      * in a different package, the resulting method handle may only be applied
 508      * to objects of the lookup class or one of its subclasses.
 509      * This requirement is enforced by narrowing the type of the leading
 510      * {@code this} parameter from {@code C}
 511      * (which will necessarily be a superclass of the lookup class)
 512      * to the lookup class itself.
 513      * &lt;p&gt;
 514      * The JVM imposes a similar requirement on {@code invokespecial} instruction,
 515      * that the receiver argument must match both the resolved method &lt;em&gt;and&lt;/em&gt;
 516      * the current class.  Again, this requirement is enforced by narrowing the
 517      * type of the leading parameter to the resulting method handle.
<span class="line-modified"> 518      * (See the Java Virtual Machine Specification, section 4.10.1.9.)</span>
 519      * &lt;p&gt;
 520      * The JVM represents constructors and static initializer blocks as internal methods
 521      * with special names ({@code &quot;&lt;init&gt;&quot;} and {@code &quot;&lt;clinit&gt;&quot;}).
 522      * The internal syntax of invocation instructions allows them to refer to such internal
 523      * methods as if they were normal methods, but the JVM bytecode verifier rejects them.
 524      * A lookup of such an internal method will produce a {@code NoSuchMethodException}.
 525      * &lt;p&gt;
 526      * If the relationship between nested types is expressed directly through the
 527      * {@code NestHost} and {@code NestMembers} attributes
<span class="line-modified"> 528      * (see the Java Virtual Machine Specification, sections 4.7.28 and 4.7.29),</span>

 529      * then the associated {@code Lookup} object provides direct access to
 530      * the lookup class and all of its nestmates
 531      * (see {@link java.lang.Class#getNestHost Class.getNestHost}).
 532      * Otherwise, access between nested classes is obtained by the Java compiler creating
 533      * a wrapper method to access a private method of another class in the same nest.
 534      * For example, a nested class {@code C.D}
 535      * can access private members within other related classes such as
 536      * {@code C}, {@code C.D.E}, or {@code C.B},
 537      * but the Java compiler may need to generate wrapper methods in
 538      * those related classes.  In such cases, a {@code Lookup} object on
 539      * {@code C.E} would be unable to access those private members.
 540      * A workaround for this limitation is the {@link Lookup#in Lookup.in} method,
 541      * which can transform a lookup on {@code C.E} into one on any of those other
 542      * classes, without special elevation of privilege.
 543      * &lt;p&gt;
 544      * The accesses permitted to a given lookup object may be limited,
 545      * according to its set of {@link #lookupModes lookupModes},
 546      * to a subset of members normally accessible to the lookup class.
 547      * For example, the {@link MethodHandles#publicLookup publicLookup}
 548      * method produces a lookup object which is only allowed to access
</pre>
<hr />
<pre>
 720      * &lt;/tr&gt;
 721      * &lt;tr&gt;
 722      * &lt;th scope=&quot;row&quot; style=&quot;text-align:left&quot;&gt;qualified-exported packages from {@code M1} to {@code M0}&lt;/th&gt;
 723      * &lt;/tr&gt;
 724      * &lt;tr&gt;
 725      * &lt;th scope=&quot;row&quot; style=&quot;text-align:left&quot;&gt;qualified-exported packages from {@code M0} to {@code M1}
 726      * if {@code M1} reads {@code M0}&lt;/th&gt;
 727      * &lt;/tr&gt;
 728      * &lt;tr&gt;
 729      * &lt;th scope=&quot;row&quot; style=&quot;text-align:left&quot;&gt;qualified-exported packages from a third module {@code M2} to
 730      * both {@code M0} and {@code M1} if both {@code M0} and {@code M1} read {@code M2}&lt;/th&gt;
 731      * &lt;/tr&gt;
 732      * &lt;/tbody&gt;
 733      * &lt;/table&gt;
 734      *
 735      * &lt;h2&gt;&lt;a id=&quot;access-modes&quot;&gt;&lt;/a&gt;Access modes&lt;/h2&gt;
 736      *
 737      * The table below shows the access modes of a {@code Lookup} produced by
 738      * any of the following factory or transformation methods:
 739      * &lt;ul&gt;
<span class="line-modified"> 740      * &lt;li&gt;{@link #lookup() MethodHandles.lookup()}&lt;/li&gt;</span>
<span class="line-modified"> 741      * &lt;li&gt;{@link #publicLookup() MethodHandles.publicLookup()}&lt;/li&gt;</span>
<span class="line-modified"> 742      * &lt;li&gt;{@link #privateLookupIn(Class, Lookup) MethodHandles.privateLookupIn}&lt;/li&gt;</span>
<span class="line-modified"> 743      * &lt;li&gt;{@link Lookup#in}&lt;/li&gt;</span>
<span class="line-modified"> 744      * &lt;li&gt;{@link Lookup#dropLookupMode(int)}&lt;/li&gt;</span>
 745      * &lt;/ul&gt;
 746      *
 747      * &lt;table class=&quot;striped&quot;&gt;
 748      * &lt;caption style=&quot;display:none&quot;&gt;
 749      * Access mode summary
 750      * &lt;/caption&gt;
 751      * &lt;thead&gt;
 752      * &lt;tr&gt;
 753      * &lt;th scope=&quot;col&quot;&gt;Lookup object&lt;/th&gt;
 754      * &lt;th style=&quot;text-align:center&quot;&gt;protected&lt;/th&gt;
 755      * &lt;th style=&quot;text-align:center&quot;&gt;private&lt;/th&gt;
 756      * &lt;th style=&quot;text-align:center&quot;&gt;package&lt;/th&gt;
 757      * &lt;th style=&quot;text-align:center&quot;&gt;module&lt;/th&gt;
 758      * &lt;th style=&quot;text-align:center&quot;&gt;public&lt;/th&gt;
 759      * &lt;/tr&gt;
 760      * &lt;/thead&gt;
 761      * &lt;tbody&gt;
 762      * &lt;tr&gt;
 763      * &lt;th scope=&quot;row&quot; style=&quot;text-align:left&quot;&gt;{@code CL = MethodHandles.lookup()} in {@code C}&lt;/th&gt;
 764      * &lt;td style=&quot;text-align:center&quot;&gt;PRO&lt;/td&gt;
</pre>
<hr />
<pre>
1504                 newModes &amp;= ~(PACKAGE|PRIVATE|PROTECTED);
1505             }
1506             // Allow nestmate lookups to be created without special privilege:
1507             if ((newModes &amp; PRIVATE) != 0
1508                 &amp;&amp; !VerifyAccess.isSamePackageMember(this.lookupClass, requestedLookupClass)) {
1509                 newModes &amp;= ~(PRIVATE|PROTECTED);
1510             }
1511             if ((newModes &amp; (PUBLIC|UNCONDITIONAL)) != 0
1512                 &amp;&amp; !VerifyAccess.isClassAccessible(requestedLookupClass, this.lookupClass, this.prevLookupClass, allowedModes)) {
1513                 // The requested class it not accessible from the lookup class.
1514                 // No permissions.
1515                 newModes = 0;
1516             }
1517             return newLookup(requestedLookupClass, plc, newModes);
1518         }
1519 
1520         /**
1521          * Creates a lookup on the same lookup class which this lookup object
1522          * finds members, but with a lookup mode that has lost the given lookup mode.
1523          * The lookup mode to drop is one of {@link #PUBLIC PUBLIC}, {@link #MODULE
<span class="line-modified">1524          * MODULE}, {@link #PACKAGE PACKAGE}, {@link #PROTECTED PROTECTED} or {@link #PRIVATE PRIVATE}.</span>
<span class="line-modified">1525          * {@link #PROTECTED PROTECTED} is always</span>
<span class="line-modified">1526          * dropped and so the resulting lookup mode will never have this access capability.</span>
<span class="line-modified">1527          * When dropping {@code PACKAGE} then the resulting lookup will not have {@code PACKAGE}</span>
<span class="line-modified">1528          * or {@code PRIVATE} access. When dropping {@code MODULE} then the resulting lookup will</span>
<span class="line-modified">1529          * not have {@code MODULE}, {@code PACKAGE}, or {@code PRIVATE} access. If {@code PUBLIC}</span>
<span class="line-modified">1530          * is dropped then the resulting lookup has no access. If {@code UNCONDITIONAL}</span>
<span class="line-modified">1531          * is dropped then the resulting lookup has no access.</span>








1532          *
1533          * @apiNote
1534          * A lookup with {@code PACKAGE} but not {@code PRIVATE} mode can safely
1535          * delegate non-public access within the package of the lookup class without
1536          * conferring  &lt;a href=&quot;MethodHandles.Lookup.html#privacc&quot;&gt;private access&lt;/a&gt;.
1537          * A lookup with {@code MODULE} but not
1538          * {@code PACKAGE} mode can safely delegate {@code PUBLIC} access within
1539          * the module of the lookup class without conferring package access.
1540          * A lookup with a {@linkplain #previousLookupClass() previous lookup class}
1541          * (and {@code PUBLIC} but not {@code MODULE} mode) can safely delegate access
1542          * to public classes accessible to both the module of the lookup class
1543          * and the module of the previous lookup class.
1544          *
1545          * @param modeToDrop the lookup mode to drop
1546          * @return a lookup object which lacks the indicated mode, or the same object if there is no change
1547          * @throws IllegalArgumentException if {@code modeToDrop} is not one of {@code PUBLIC},
1548          * {@code MODULE}, {@code PACKAGE}, {@code PROTECTED}, {@code PRIVATE} or {@code UNCONDITIONAL}
1549          * @see MethodHandles#privateLookupIn
1550          * @since 9
1551          */
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2008, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 301      * access checks when they are called, but rather when they are created.
 302      * Therefore, method handle access
 303      * restrictions must be enforced when a method handle is created.
 304      * The caller class against which those restrictions are enforced
 305      * is known as the {@linkplain #lookupClass() lookup class}.
 306      * &lt;p&gt;
 307      * A lookup class which needs to create method handles will call
 308      * {@link MethodHandles#lookup() MethodHandles.lookup} to create a factory for itself.
 309      * When the {@code Lookup} factory object is created, the identity of the lookup class is
 310      * determined, and securely stored in the {@code Lookup} object.
 311      * The lookup class (or its delegates) may then use factory methods
 312      * on the {@code Lookup} object to create method handles for access-checked members.
 313      * This includes all methods, constructors, and fields which are allowed to the lookup class,
 314      * even private ones.
 315      *
 316      * &lt;h2&gt;&lt;a id=&quot;lookups&quot;&gt;&lt;/a&gt;Lookup Factory Methods&lt;/h2&gt;
 317      * The factory methods on a {@code Lookup} object correspond to all major
 318      * use cases for methods, constructors, and fields.
 319      * Each method handle created by a factory method is the functional
 320      * equivalent of a particular &lt;em&gt;bytecode behavior&lt;/em&gt;.
<span class="line-modified"> 321      * (Bytecode behaviors are described in section {@jvms 5.4.3.5} of</span>
<span class="line-added"> 322      * the Java Virtual Machine Specification.)</span>
 323      * Here is a summary of the correspondence between these factory methods and
 324      * the behavior of the resulting method handles:
 325      * &lt;table class=&quot;striped&quot;&gt;
 326      * &lt;caption style=&quot;display:none&quot;&gt;lookup method behaviors&lt;/caption&gt;
 327      * &lt;thead&gt;
 328      * &lt;tr&gt;
 329      *     &lt;th scope=&quot;col&quot;&gt;&lt;a id=&quot;equiv&quot;&gt;&lt;/a&gt;lookup expression&lt;/th&gt;
 330      *     &lt;th scope=&quot;col&quot;&gt;member&lt;/th&gt;
 331      *     &lt;th scope=&quot;col&quot;&gt;bytecode behavior&lt;/th&gt;
 332      * &lt;/tr&gt;
 333      * &lt;/thead&gt;
 334      * &lt;tbody&gt;
 335      * &lt;tr&gt;
 336      *     &lt;th scope=&quot;row&quot;&gt;{@link java.lang.invoke.MethodHandles.Lookup#findGetter lookup.findGetter(C.class,&quot;f&quot;,FT.class)}&lt;/th&gt;
 337      *     &lt;td&gt;{@code FT f;}&lt;/td&gt;&lt;td&gt;{@code (T) this.f;}&lt;/td&gt;
 338      * &lt;/tr&gt;
 339      * &lt;tr&gt;
 340      *     &lt;th scope=&quot;row&quot;&gt;{@link java.lang.invoke.MethodHandles.Lookup#findStaticGetter lookup.findStaticGetter(C.class,&quot;f&quot;,FT.class)}&lt;/th&gt;
 341      *     &lt;td&gt;{@code static}&lt;br&gt;{@code FT f;}&lt;/td&gt;&lt;td&gt;{@code (FT) C.f;}&lt;/td&gt;
 342      * &lt;/tr&gt;
</pre>
<hr />
<pre>
 486      * under which the lookup class could have compiled, verified, and resolved a call to {@code M}.
 487      * Where the JVM would raise exceptions like {@code NoSuchMethodError},
 488      * a method handle lookup will generally raise a corresponding
 489      * checked exception, such as {@code NoSuchMethodException}.
 490      * And the effect of invoking the method handle resulting from the lookup
 491      * is &lt;a href=&quot;MethodHandles.Lookup.html#equiv&quot;&gt;exactly equivalent&lt;/a&gt;
 492      * to executing the compiled, verified, and resolved call to {@code M}.
 493      * The same point is true of fields and constructors.
 494      * &lt;p style=&quot;font-size:smaller;&quot;&gt;
 495      * &lt;em&gt;Discussion:&lt;/em&gt;
 496      * Access checks only apply to named and reflected methods,
 497      * constructors, and fields.
 498      * Other method handle creation methods, such as
 499      * {@link MethodHandle#asType MethodHandle.asType},
 500      * do not require any access checks, and are used
 501      * independently of any {@code Lookup} object.
 502      * &lt;p&gt;
 503      * If the desired member is {@code protected}, the usual JVM rules apply,
 504      * including the requirement that the lookup class must either be in the
 505      * same package as the desired member, or must inherit that member.
<span class="line-modified"> 506      * (See the Java Virtual Machine Specification, sections {@jvms</span>
<span class="line-added"> 507      * 4.9.2}, {@jvms 5.4.3.5}, and {@jvms 6.4}.)</span>
 508      * In addition, if the desired member is a non-static field or method
 509      * in a different package, the resulting method handle may only be applied
 510      * to objects of the lookup class or one of its subclasses.
 511      * This requirement is enforced by narrowing the type of the leading
 512      * {@code this} parameter from {@code C}
 513      * (which will necessarily be a superclass of the lookup class)
 514      * to the lookup class itself.
 515      * &lt;p&gt;
 516      * The JVM imposes a similar requirement on {@code invokespecial} instruction,
 517      * that the receiver argument must match both the resolved method &lt;em&gt;and&lt;/em&gt;
 518      * the current class.  Again, this requirement is enforced by narrowing the
 519      * type of the leading parameter to the resulting method handle.
<span class="line-modified"> 520      * (See the Java Virtual Machine Specification, section {@jmvs 4.10.1.9}.)</span>
 521      * &lt;p&gt;
 522      * The JVM represents constructors and static initializer blocks as internal methods
 523      * with special names ({@code &quot;&lt;init&gt;&quot;} and {@code &quot;&lt;clinit&gt;&quot;}).
 524      * The internal syntax of invocation instructions allows them to refer to such internal
 525      * methods as if they were normal methods, but the JVM bytecode verifier rejects them.
 526      * A lookup of such an internal method will produce a {@code NoSuchMethodException}.
 527      * &lt;p&gt;
 528      * If the relationship between nested types is expressed directly through the
 529      * {@code NestHost} and {@code NestMembers} attributes
<span class="line-modified"> 530      * (see the Java Virtual Machine Specification, sections {@jvms</span>
<span class="line-added"> 531      * 4.7.28} and {@jvms 4.7.29}),</span>
 532      * then the associated {@code Lookup} object provides direct access to
 533      * the lookup class and all of its nestmates
 534      * (see {@link java.lang.Class#getNestHost Class.getNestHost}).
 535      * Otherwise, access between nested classes is obtained by the Java compiler creating
 536      * a wrapper method to access a private method of another class in the same nest.
 537      * For example, a nested class {@code C.D}
 538      * can access private members within other related classes such as
 539      * {@code C}, {@code C.D.E}, or {@code C.B},
 540      * but the Java compiler may need to generate wrapper methods in
 541      * those related classes.  In such cases, a {@code Lookup} object on
 542      * {@code C.E} would be unable to access those private members.
 543      * A workaround for this limitation is the {@link Lookup#in Lookup.in} method,
 544      * which can transform a lookup on {@code C.E} into one on any of those other
 545      * classes, without special elevation of privilege.
 546      * &lt;p&gt;
 547      * The accesses permitted to a given lookup object may be limited,
 548      * according to its set of {@link #lookupModes lookupModes},
 549      * to a subset of members normally accessible to the lookup class.
 550      * For example, the {@link MethodHandles#publicLookup publicLookup}
 551      * method produces a lookup object which is only allowed to access
</pre>
<hr />
<pre>
 723      * &lt;/tr&gt;
 724      * &lt;tr&gt;
 725      * &lt;th scope=&quot;row&quot; style=&quot;text-align:left&quot;&gt;qualified-exported packages from {@code M1} to {@code M0}&lt;/th&gt;
 726      * &lt;/tr&gt;
 727      * &lt;tr&gt;
 728      * &lt;th scope=&quot;row&quot; style=&quot;text-align:left&quot;&gt;qualified-exported packages from {@code M0} to {@code M1}
 729      * if {@code M1} reads {@code M0}&lt;/th&gt;
 730      * &lt;/tr&gt;
 731      * &lt;tr&gt;
 732      * &lt;th scope=&quot;row&quot; style=&quot;text-align:left&quot;&gt;qualified-exported packages from a third module {@code M2} to
 733      * both {@code M0} and {@code M1} if both {@code M0} and {@code M1} read {@code M2}&lt;/th&gt;
 734      * &lt;/tr&gt;
 735      * &lt;/tbody&gt;
 736      * &lt;/table&gt;
 737      *
 738      * &lt;h2&gt;&lt;a id=&quot;access-modes&quot;&gt;&lt;/a&gt;Access modes&lt;/h2&gt;
 739      *
 740      * The table below shows the access modes of a {@code Lookup} produced by
 741      * any of the following factory or transformation methods:
 742      * &lt;ul&gt;
<span class="line-modified"> 743      * &lt;li&gt;{@link #lookup() MethodHandles::lookup}&lt;/li&gt;</span>
<span class="line-modified"> 744      * &lt;li&gt;{@link #publicLookup() MethodHandles::publicLookup}&lt;/li&gt;</span>
<span class="line-modified"> 745      * &lt;li&gt;{@link #privateLookupIn(Class, Lookup) MethodHandles::privateLookupIn}&lt;/li&gt;</span>
<span class="line-modified"> 746      * &lt;li&gt;{@link Lookup#in Lookup::in}&lt;/li&gt;</span>
<span class="line-modified"> 747      * &lt;li&gt;{@link Lookup#dropLookupMode(int) Lookup::dropLookupMode}&lt;/li&gt;</span>
 748      * &lt;/ul&gt;
 749      *
 750      * &lt;table class=&quot;striped&quot;&gt;
 751      * &lt;caption style=&quot;display:none&quot;&gt;
 752      * Access mode summary
 753      * &lt;/caption&gt;
 754      * &lt;thead&gt;
 755      * &lt;tr&gt;
 756      * &lt;th scope=&quot;col&quot;&gt;Lookup object&lt;/th&gt;
 757      * &lt;th style=&quot;text-align:center&quot;&gt;protected&lt;/th&gt;
 758      * &lt;th style=&quot;text-align:center&quot;&gt;private&lt;/th&gt;
 759      * &lt;th style=&quot;text-align:center&quot;&gt;package&lt;/th&gt;
 760      * &lt;th style=&quot;text-align:center&quot;&gt;module&lt;/th&gt;
 761      * &lt;th style=&quot;text-align:center&quot;&gt;public&lt;/th&gt;
 762      * &lt;/tr&gt;
 763      * &lt;/thead&gt;
 764      * &lt;tbody&gt;
 765      * &lt;tr&gt;
 766      * &lt;th scope=&quot;row&quot; style=&quot;text-align:left&quot;&gt;{@code CL = MethodHandles.lookup()} in {@code C}&lt;/th&gt;
 767      * &lt;td style=&quot;text-align:center&quot;&gt;PRO&lt;/td&gt;
</pre>
<hr />
<pre>
1507                 newModes &amp;= ~(PACKAGE|PRIVATE|PROTECTED);
1508             }
1509             // Allow nestmate lookups to be created without special privilege:
1510             if ((newModes &amp; PRIVATE) != 0
1511                 &amp;&amp; !VerifyAccess.isSamePackageMember(this.lookupClass, requestedLookupClass)) {
1512                 newModes &amp;= ~(PRIVATE|PROTECTED);
1513             }
1514             if ((newModes &amp; (PUBLIC|UNCONDITIONAL)) != 0
1515                 &amp;&amp; !VerifyAccess.isClassAccessible(requestedLookupClass, this.lookupClass, this.prevLookupClass, allowedModes)) {
1516                 // The requested class it not accessible from the lookup class.
1517                 // No permissions.
1518                 newModes = 0;
1519             }
1520             return newLookup(requestedLookupClass, plc, newModes);
1521         }
1522 
1523         /**
1524          * Creates a lookup on the same lookup class which this lookup object
1525          * finds members, but with a lookup mode that has lost the given lookup mode.
1526          * The lookup mode to drop is one of {@link #PUBLIC PUBLIC}, {@link #MODULE
<span class="line-modified">1527          * MODULE}, {@link #PACKAGE PACKAGE}, {@link #PROTECTED PROTECTED},</span>
<span class="line-modified">1528          * {@link #PRIVATE PRIVATE}, or {@link #UNCONDITIONAL UNCONDITIONAL}.</span>
<span class="line-modified">1529          *</span>
<span class="line-modified">1530          * &lt;p&gt; If this lookup is a {@linkplain MethodHandles#publicLookup() public lookup},</span>
<span class="line-modified">1531          * this lookup has {@code UNCONDITIONAL} mode set and it has no other mode set.</span>
<span class="line-modified">1532          * When dropping {@code UNCONDITIONAL} on a public lookup then the resulting</span>
<span class="line-modified">1533          * lookup has no access.</span>
<span class="line-modified">1534          *</span>
<span class="line-added">1535          * &lt;p&gt; If this lookup is not a public lookup, then the following applies</span>
<span class="line-added">1536          * regardless of its {@linkplain #lookupModes() lookup modes}.</span>
<span class="line-added">1537          * {@link #PROTECTED PROTECTED} is always dropped and so the resulting lookup</span>
<span class="line-added">1538          * mode will never have this access capability. When dropping {@code PACKAGE}</span>
<span class="line-added">1539          * then the resulting lookup will not have {@code PACKAGE} or {@code PRIVATE}</span>
<span class="line-added">1540          * access. When dropping {@code MODULE} then the resulting lookup will not</span>
<span class="line-added">1541          * have {@code MODULE}, {@code PACKAGE}, or {@code PRIVATE} access.</span>
<span class="line-added">1542          * When dropping {@code PUBLIC} then the resulting lookup has no access.</span>
1543          *
1544          * @apiNote
1545          * A lookup with {@code PACKAGE} but not {@code PRIVATE} mode can safely
1546          * delegate non-public access within the package of the lookup class without
1547          * conferring  &lt;a href=&quot;MethodHandles.Lookup.html#privacc&quot;&gt;private access&lt;/a&gt;.
1548          * A lookup with {@code MODULE} but not
1549          * {@code PACKAGE} mode can safely delegate {@code PUBLIC} access within
1550          * the module of the lookup class without conferring package access.
1551          * A lookup with a {@linkplain #previousLookupClass() previous lookup class}
1552          * (and {@code PUBLIC} but not {@code MODULE} mode) can safely delegate access
1553          * to public classes accessible to both the module of the lookup class
1554          * and the module of the previous lookup class.
1555          *
1556          * @param modeToDrop the lookup mode to drop
1557          * @return a lookup object which lacks the indicated mode, or the same object if there is no change
1558          * @throws IllegalArgumentException if {@code modeToDrop} is not one of {@code PUBLIC},
1559          * {@code MODULE}, {@code PACKAGE}, {@code PROTECTED}, {@code PRIVATE} or {@code UNCONDITIONAL}
1560          * @see MethodHandles#privateLookupIn
1561          * @since 9
1562          */
</pre>
</td>
</tr>
</table>
<center><a href="MethodHandleInfo.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="MethodType.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>