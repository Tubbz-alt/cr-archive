<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/x509/X509CRLImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="X509CRLEntryImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../util/cldr/CLDRTimeZoneNameProviderImpl.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/x509/X509CRLImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  82  */
  83 public class X509CRLImpl extends X509CRL implements DerEncoder {
  84 
  85     // CRL data, and its envelope
  86     private byte[]      signedCRL = null; // DER encoded crl
  87     private byte[]      signature = null; // raw signature bits
  88     private byte[]      tbsCertList = null; // DER encoded &quot;to-be-signed&quot; CRL
  89     private AlgorithmId sigAlgId = null; // sig alg in CRL
  90 
  91     // crl information
  92     private int              version;
  93     private AlgorithmId      infoSigAlgId; // sig alg in &quot;to-be-signed&quot; crl
  94     private X500Name         issuer = null;
  95     private X500Principal    issuerPrincipal = null;
  96     private Date             thisUpdate = null;
  97     private Date             nextUpdate = null;
  98     private Map&lt;X509IssuerSerial,X509CRLEntry&gt; revokedMap = new TreeMap&lt;&gt;();
  99     private List&lt;X509CRLEntry&gt; revokedList = new LinkedList&lt;&gt;();
 100     private CRLExtensions    extensions = null;
 101     private static final boolean isExplicit = true;
<span class="line-removed"> 102     private static final long YR_2050 = 2524636800000L;</span>
 103 
 104     private boolean readOnly = false;
 105 
 106     /**
 107      * PublicKey that has previously been used to successfully verify
 108      * the signature of this CRL. Null if the CRL has not
 109      * yet been verified (successfully).
 110      */
 111     private PublicKey verifiedPublicKey;
 112     /**
 113      * If verifiedPublicKey is not null, name of the provider used to
 114      * successfully verify the signature of this CRL, or the
 115      * empty String if no provider was explicitly specified.
 116      */
 117     private String verifiedProvider;
 118 
 119     /**
 120      * Not to be used. As it would lead to cases of uninitialized
 121      * CRL objects.
 122      */
</pre>
<hr />
<pre>
 269 
 270     /**
 271      * Encodes the &quot;to-be-signed&quot; CRL to the OutputStream.
 272      *
 273      * @param out the OutputStream to write to.
 274      * @exception CRLException on encoding errors.
 275      */
 276     public void encodeInfo(OutputStream out) throws CRLException {
 277         try {
 278             DerOutputStream tmp = new DerOutputStream();
 279             DerOutputStream rCerts = new DerOutputStream();
 280             DerOutputStream seq = new DerOutputStream();
 281 
 282             if (version != 0) // v2 crl encode version
 283                 tmp.putInteger(version);
 284             infoSigAlgId.encode(tmp);
 285             if ((version == 0) &amp;&amp; (issuer.toString() == null))
 286                 throw new CRLException(&quot;Null Issuer DN not allowed in v1 CRL&quot;);
 287             issuer.encode(tmp);
 288 
<span class="line-modified"> 289             if (thisUpdate.getTime() &lt; YR_2050)</span>
 290                 tmp.putUTCTime(thisUpdate);
 291             else
 292                 tmp.putGeneralizedTime(thisUpdate);
 293 
 294             if (nextUpdate != null) {
<span class="line-modified"> 295                 if (nextUpdate.getTime() &lt; YR_2050)</span>
 296                     tmp.putUTCTime(nextUpdate);
 297                 else
 298                     tmp.putGeneralizedTime(nextUpdate);
 299             }
 300 
 301             if (!revokedList.isEmpty()) {
 302                 for (X509CRLEntry entry : revokedList) {
 303                     ((X509CRLEntryImpl)entry).encode(rCerts);
 304                 }
 305                 tmp.write(DerValue.tag_Sequence, rCerts);
 306             }
 307 
 308             if (extensions != null)
 309                 extensions.encode(tmp, isExplicit);
 310 
 311             seq.write(DerValue.tag_Sequence, tmp);
 312 
 313             tbsCertList = seq.toByteArray();
 314             out.write(tbsCertList);
 315         } catch (IOException e) {
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1997, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  82  */
  83 public class X509CRLImpl extends X509CRL implements DerEncoder {
  84 
  85     // CRL data, and its envelope
  86     private byte[]      signedCRL = null; // DER encoded crl
  87     private byte[]      signature = null; // raw signature bits
  88     private byte[]      tbsCertList = null; // DER encoded &quot;to-be-signed&quot; CRL
  89     private AlgorithmId sigAlgId = null; // sig alg in CRL
  90 
  91     // crl information
  92     private int              version;
  93     private AlgorithmId      infoSigAlgId; // sig alg in &quot;to-be-signed&quot; crl
  94     private X500Name         issuer = null;
  95     private X500Principal    issuerPrincipal = null;
  96     private Date             thisUpdate = null;
  97     private Date             nextUpdate = null;
  98     private Map&lt;X509IssuerSerial,X509CRLEntry&gt; revokedMap = new TreeMap&lt;&gt;();
  99     private List&lt;X509CRLEntry&gt; revokedList = new LinkedList&lt;&gt;();
 100     private CRLExtensions    extensions = null;
 101     private static final boolean isExplicit = true;

 102 
 103     private boolean readOnly = false;
 104 
 105     /**
 106      * PublicKey that has previously been used to successfully verify
 107      * the signature of this CRL. Null if the CRL has not
 108      * yet been verified (successfully).
 109      */
 110     private PublicKey verifiedPublicKey;
 111     /**
 112      * If verifiedPublicKey is not null, name of the provider used to
 113      * successfully verify the signature of this CRL, or the
 114      * empty String if no provider was explicitly specified.
 115      */
 116     private String verifiedProvider;
 117 
 118     /**
 119      * Not to be used. As it would lead to cases of uninitialized
 120      * CRL objects.
 121      */
</pre>
<hr />
<pre>
 268 
 269     /**
 270      * Encodes the &quot;to-be-signed&quot; CRL to the OutputStream.
 271      *
 272      * @param out the OutputStream to write to.
 273      * @exception CRLException on encoding errors.
 274      */
 275     public void encodeInfo(OutputStream out) throws CRLException {
 276         try {
 277             DerOutputStream tmp = new DerOutputStream();
 278             DerOutputStream rCerts = new DerOutputStream();
 279             DerOutputStream seq = new DerOutputStream();
 280 
 281             if (version != 0) // v2 crl encode version
 282                 tmp.putInteger(version);
 283             infoSigAlgId.encode(tmp);
 284             if ((version == 0) &amp;&amp; (issuer.toString() == null))
 285                 throw new CRLException(&quot;Null Issuer DN not allowed in v1 CRL&quot;);
 286             issuer.encode(tmp);
 287 
<span class="line-modified"> 288             if (thisUpdate.getTime() &lt; CertificateValidity.YR_2050)</span>
 289                 tmp.putUTCTime(thisUpdate);
 290             else
 291                 tmp.putGeneralizedTime(thisUpdate);
 292 
 293             if (nextUpdate != null) {
<span class="line-modified"> 294                 if (nextUpdate.getTime() &lt; CertificateValidity.YR_2050)</span>
 295                     tmp.putUTCTime(nextUpdate);
 296                 else
 297                     tmp.putGeneralizedTime(nextUpdate);
 298             }
 299 
 300             if (!revokedList.isEmpty()) {
 301                 for (X509CRLEntry entry : revokedList) {
 302                     ((X509CRLEntryImpl)entry).encode(rCerts);
 303                 }
 304                 tmp.write(DerValue.tag_Sequence, rCerts);
 305             }
 306 
 307             if (extensions != null)
 308                 extensions.encode(tmp, isExplicit);
 309 
 310             seq.write(DerValue.tag_Sequence, tmp);
 311 
 312             tbsCertList = seq.toByteArray();
 313             out.write(tbsCertList);
 314         } catch (IOException e) {
</pre>
</td>
</tr>
</table>
<center><a href="X509CRLEntryImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../util/cldr/CLDRTimeZoneNameProviderImpl.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>