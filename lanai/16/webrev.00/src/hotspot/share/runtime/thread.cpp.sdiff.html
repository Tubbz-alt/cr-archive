<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/runtime/thread.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="signature.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="thread.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/runtime/thread.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 332 #endif
 333   assert(ThreadLocalStorage::thread() == NULL, &quot;ThreadLocalStorage::thread already initialized&quot;);
 334   ThreadLocalStorage::set_thread(this);
 335   assert(Thread::current() == ThreadLocalStorage::thread(), &quot;TLS mismatch!&quot;);
 336 }
 337 
 338 void Thread::clear_thread_current() {
 339   assert(Thread::current() == ThreadLocalStorage::thread(), &quot;TLS mismatch!&quot;);
 340 #ifndef USE_LIBRARY_BASED_TLS_ONLY
 341   _thr_current = NULL;
 342 #endif
 343   ThreadLocalStorage::set_thread(NULL);
 344 }
 345 
 346 void Thread::record_stack_base_and_size() {
 347   // Note: at this point, Thread object is not yet initialized. Do not rely on
 348   // any members being initialized. Do not rely on Thread::current() being set.
 349   // If possible, refrain from doing anything which may crash or assert since
 350   // quite probably those crash dumps will be useless.
 351   set_stack_base(os::current_stack_base());

 352   set_stack_size(os::current_stack_size());
 353 
 354 #ifdef SOLARIS
 355   if (os::is_primordial_thread()) {
 356     os::Solaris::correct_stack_boundaries_for_primordial_thread(this);
 357   }
 358 #endif
 359 
 360   // Set stack limits after thread is initialized.
 361   if (is_Java_thread()) {
 362     ((JavaThread*) this)-&gt;set_stack_overflow_limit();
 363     ((JavaThread*) this)-&gt;set_reserved_stack_activation(stack_base());
 364   }
 365 }
 366 
 367 #if INCLUDE_NMT
 368 void Thread::register_thread_stack_with_NMT() {
 369   MemTracker::record_thread_stack(stack_end(), stack_size());
 370 }
 371 #endif // INCLUDE_NMT
 372 
 373 void Thread::call_run() {
 374   DEBUG_ONLY(_run_state = CALL_RUN;)
 375 
 376   // At this point, Thread object should be fully initialized and
 377   // Thread::current() should be set.
 378 
 379   assert(Thread::current_or_null() != NULL, &quot;current thread is unset&quot;);
 380   assert(Thread::current_or_null() == this, &quot;current thread is wrong&quot;);
 381 
 382   // Perform common initialization actions
 383 
 384   register_thread_stack_with_NMT();
 385 
 386   JFR_ONLY(Jfr::on_thread_start(this);)
 387 
 388   log_debug(os, thread)(&quot;Thread &quot; UINTX_FORMAT &quot; stack dimensions: &quot;
 389     PTR_FORMAT &quot;-&quot; PTR_FORMAT &quot; (&quot; SIZE_FORMAT &quot;k).&quot;,
<span class="line-modified"> 390     os::current_thread_id(), p2i(stack_base() - stack_size()),</span>
 391     p2i(stack_base()), stack_size()/1024);
 392 
 393   // Perform &lt;ChildClass&gt; initialization actions
 394   DEBUG_ONLY(_run_state = PRE_RUN;)
 395   this-&gt;pre_run();
 396 
 397   // Invoke &lt;ChildClass&gt;::run()
 398   DEBUG_ONLY(_run_state = RUN;)
 399   this-&gt;run();
 400   // Returned from &lt;ChildClass&gt;::run(). Thread finished.
 401 
 402   // Perform common tear-down actions
 403 
 404   assert(Thread::current_or_null() != NULL, &quot;current thread is unset&quot;);
 405   assert(Thread::current_or_null() == this, &quot;current thread is wrong&quot;);
 406 
 407   // Perform &lt;ChildClass&gt; tear-down actions
 408   DEBUG_ONLY(_run_state = POST_RUN;)
 409   this-&gt;post_run();
 410 
</pre>
<hr />
<pre>
 870     }
 871   }
 872 
 873   return true;
 874 }
 875 
 876 // GC Support
 877 bool Thread::claim_par_threads_do(uintx claim_token) {
 878   uintx token = _threads_do_token;
 879   if (token != claim_token) {
 880     uintx res = Atomic::cmpxchg(&amp;_threads_do_token, token, claim_token);
 881     if (res == token) {
 882       return true;
 883     }
 884     guarantee(res == claim_token, &quot;invariant&quot;);
 885   }
 886   return false;
 887 }
 888 
 889 void Thread::oops_do(OopClosure* f, CodeBlobClosure* cf) {
<span class="line-modified"> 890   active_handles()-&gt;oops_do(f);</span>


 891   // Do oop for ThreadShadow
 892   f-&gt;do_oop((oop*)&amp;_pending_exception);
 893   handle_area()-&gt;oops_do(f);
 894 
 895   // We scan thread local monitor lists here, and the remaining global
 896   // monitors in ObjectSynchronizer::oops_do().
 897   ObjectSynchronizer::thread_local_used_oops_do(this, f);
 898 }
 899 
 900 void Thread::metadata_handles_do(void f(Metadata*)) {
 901   // Only walk the Handles in Thread.
 902   if (metadata_handles() != NULL) {
 903     for (int i = 0; i&lt; metadata_handles()-&gt;length(); i++) {
 904       f(metadata_handles()-&gt;at(i));
 905     }
 906   }
 907 }
 908 
 909 void Thread::print_on(outputStream* st, bool print_extended_info) const {
 910   // get_priority assumes osthread initialized
</pre>
<hr />
<pre>
1001 
1002 void Thread::check_for_valid_safepoint_state() {
1003   if (!is_Java_thread()) return;
1004 
1005   // Check NoSafepointVerifier, which is implied by locks taken that can be
1006   // shared with the VM thread.  This makes sure that no locks with allow_vm_block
1007   // are held.
1008   check_possible_safepoint();
1009 
1010   if (((JavaThread*)this)-&gt;thread_state() != _thread_in_vm) {
1011     fatal(&quot;LEAF method calling lock?&quot;);
1012   }
1013 
1014   if (GCALotAtAllSafepoints) {
1015     // We could enter a safepoint here and thus have a gc
1016     InterfaceSupport::check_gc_alot();
1017   }
1018 }
1019 #endif // ASSERT
1020 
<span class="line-removed">1021 bool Thread::is_in_stack(address adr) const {</span>
<span class="line-removed">1022   assert(Thread::current() == this, &quot;is_in_stack can only be called from current thread&quot;);</span>
<span class="line-removed">1023   address end = os::current_stack_pointer();</span>
<span class="line-removed">1024   // Allow non Java threads to call this without stack_base</span>
<span class="line-removed">1025   if (_stack_base == NULL) return true;</span>
<span class="line-removed">1026   if (stack_base() &gt; adr &amp;&amp; adr &gt;= end) return true;</span>
<span class="line-removed">1027 </span>
<span class="line-removed">1028   return false;</span>
<span class="line-removed">1029 }</span>
<span class="line-removed">1030 </span>
<span class="line-removed">1031 bool Thread::is_in_usable_stack(address adr) const {</span>
<span class="line-removed">1032   size_t stack_guard_size = os::uses_stack_guard_pages() ? JavaThread::stack_guard_zone_size() : 0;</span>
<span class="line-removed">1033   size_t usable_stack_size = _stack_size - stack_guard_size;</span>
<span class="line-removed">1034 </span>
<span class="line-removed">1035   return ((adr &lt; stack_base()) &amp;&amp; (adr &gt;= stack_base() - usable_stack_size));</span>
<span class="line-removed">1036 }</span>
<span class="line-removed">1037 </span>
<span class="line-removed">1038 </span>
1039 // We had to move these methods here, because vm threads get into ObjectSynchronizer::enter
1040 // However, there is a note in JavaThread::is_lock_owned() about the VM threads not being
1041 // used for compilation in the future. If that change is made, the need for these methods
1042 // should be revisited, and they should be removed if possible.
1043 
1044 bool Thread::is_lock_owned(address adr) const {
<span class="line-modified">1045   return on_local_stack(adr);</span>
1046 }
1047 
1048 bool Thread::set_as_starting_thread() {
1049   assert(_starting_thread == NULL, &quot;already initialized: &quot;
1050          &quot;_starting_thread=&quot; INTPTR_FORMAT, p2i(_starting_thread));
1051   // NOTE: this must be called inside the main thread.
1052   DEBUG_ONLY(_starting_thread = this;)
1053   return os::create_main_thread((JavaThread*)this);
1054 }
1055 
1056 static void initialize_class(Symbol* class_name, TRAPS) {
1057   Klass* klass = SystemDictionary::resolve_or_fail(class_name, true, CHECK);
1058   InstanceKlass::cast(klass)-&gt;initialize(CHECK);
1059 }
1060 
1061 
1062 // Creates the initial ThreadGroup
1063 static Handle create_initial_thread_group(TRAPS) {
1064   Handle system_instance = JavaCalls::construct_new_instance(
1065                             SystemDictionary::ThreadGroup_klass(),
</pre>
<hr />
<pre>
1242     // (java.lang.Thread doesn&#39;t have a constructor taking only a ThreadGroup argument)
1243     JavaCalls::call_special(&amp;result,
1244                             thread_oop,
1245                             ik,
1246                             vmSymbols::object_initializer_name(),
1247                             vmSymbols::threadgroup_runnable_void_signature(),
1248                             thread_group,
1249                             Handle(),
1250                             THREAD);
1251   }
1252 
1253 
1254   if (daemon) {
1255     java_lang_Thread::set_daemon(thread_oop());
1256   }
1257 
1258   if (HAS_PENDING_EXCEPTION) {
1259     return;
1260   }
1261 
<span class="line-modified">1262   Klass* group =  SystemDictionary::ThreadGroup_klass();</span>
1263   Handle threadObj(THREAD, this-&gt;threadObj());
1264 
1265   JavaCalls::call_special(&amp;result,
1266                           thread_group,
1267                           group,
1268                           vmSymbols::add_method_name(),
1269                           vmSymbols::thread_void_signature(),
1270                           threadObj,          // Arg 1
1271                           THREAD);
1272 }
1273 
1274 // List of all NonJavaThreads and safe iteration over that list.
1275 
1276 class NonJavaThread::List {
1277 public:
1278   NonJavaThread* volatile _head;
1279   SingleWriterSynchronizer _protect;
1280 
1281   List() : _head(NULL), _protect() {}
1282 };
</pre>
<hr />
<pre>
1812   // some exception code in c1, c2 or the interpreter isn&#39;t unwinding
1813   // when it should.
1814   guarantee(cur_sp &gt; stack_reserved_zone_base(),
1815             &quot;not enough space to reguard - increase StackShadowPages&quot;);
1816   if (_stack_guard_state == stack_guard_yellow_reserved_disabled) {
1817     enable_stack_yellow_reserved_zone();
1818     if (reserved_stack_activation() != stack_base()) {
1819       set_reserved_stack_activation(stack_base());
1820     }
1821   } else if (_stack_guard_state == stack_guard_reserved_disabled) {
1822     set_reserved_stack_activation(stack_base());
1823     enable_stack_reserved_zone();
1824   }
1825   return true;
1826 }
1827 
1828 bool JavaThread::reguard_stack(void) {
1829   return reguard_stack(os::current_stack_pointer());
1830 }
1831 
<span class="line-removed">1832 </span>
1833 void JavaThread::block_if_vm_exited() {
1834   if (_terminated == _vm_exited) {
1835     // _vm_exited is set at safepoint, and Threads_lock is never released
1836     // we will block here forever.
1837     // Here we can be doing a jump from a safe state to an unsafe state without
1838     // proper transition, but it happens after the final safepoint has begun.
1839     set_thread_state(_thread_in_vm);
1840     Threads_lock-&gt;lock();
1841     ShouldNotReachHere();
1842   }
1843 }
1844 
1845 
1846 // Remove this ifdef when C1 is ported to the compiler interface.
1847 static void compiler_thread_entry(JavaThread* thread, TRAPS);
1848 static void sweeper_thread_entry(JavaThread* thread, TRAPS);
1849 
1850 JavaThread::JavaThread(ThreadFunction entry_point, size_t stack_sz) :
1851                        Thread() {
1852   initialize();
</pre>
<hr />
<pre>
2399 
2400 void JavaThread::send_thread_stop(oop java_throwable)  {
2401   ResourceMark rm;
2402   assert(Thread::current()-&gt;is_VM_thread() || Thread::current() == this, &quot;should be in the vm thread&quot;);
2403 
2404   // Do not throw asynchronous exceptions against the compiler thread
2405   // (the compiler thread should not be a Java thread -- fix in 1.4.2)
2406   if (!can_call_java()) return;
2407 
2408   {
2409     // Actually throw the Throwable against the target Thread - however
2410     // only if there is no thread death exception installed already.
2411     if (_pending_async_exception == NULL || !_pending_async_exception-&gt;is_a(SystemDictionary::ThreadDeath_klass())) {
2412       // If the topmost frame is a runtime stub, then we are calling into
2413       // OptoRuntime from compiled code. Some runtime stubs (new, monitor_exit..)
2414       // must deoptimize the caller before continuing, as the compiled  exception handler table
2415       // may not be valid
2416       if (has_last_Java_frame()) {
2417         frame f = last_frame();
2418         if (f.is_runtime_frame() || f.is_safepoint_blob_frame()) {
<span class="line-modified">2419           // BiasedLocking needs an updated RegisterMap for the revoke monitors pass</span>
<span class="line-removed">2420           RegisterMap reg_map(this, UseBiasedLocking);</span>
2421           frame compiled_frame = f.sender(&amp;reg_map);
2422           if (!StressCompiledExceptionHandlers &amp;&amp; compiled_frame.can_be_deoptimized()) {
<span class="line-modified">2423             Deoptimization::deoptimize(this, compiled_frame, &amp;reg_map);</span>
2424           }
2425         }
2426       }
2427 
2428       // Set async. pending exception in thread.
2429       set_pending_async_exception(java_throwable);
2430 
2431       if (log_is_enabled(Info, exceptions)) {
2432          ResourceMark rm;
2433         log_info(exceptions)(&quot;Pending Async. exception installed of type: %s&quot;,
2434                              InstanceKlass::cast(_pending_async_exception-&gt;klass())-&gt;external_name());
2435       }
2436       // for AbortVMOnException flag
2437       Exceptions::debug_check_abort(_pending_async_exception-&gt;klass()-&gt;external_name());
2438     }
2439   }
2440 
2441 
2442   // Interrupt thread so it will wake up from a potential wait()/sleep()/park()
2443   java_lang_Thread::set_interrupted(threadObj(), true);
</pre>
<hr />
<pre>
2848   if (!os::unguard_memory((char *)base, stack_red_zone_size())) {
2849     warning(&quot;Attempt to unguard stack red zone failed.&quot;);
2850   }
2851 }
2852 
2853 void JavaThread::frames_do(void f(frame*, const RegisterMap* map)) {
2854   // ignore is there is no stack
2855   if (!has_last_Java_frame()) return;
2856   // traverse the stack frames. Starts from top frame.
2857   for (StackFrameStream fst(this); !fst.is_done(); fst.next()) {
2858     frame* fr = fst.current();
2859     f(fr, fst.register_map());
2860   }
2861 }
2862 
2863 
2864 #ifndef PRODUCT
2865 // Deoptimization
2866 // Function for testing deoptimization
2867 void JavaThread::deoptimize() {
<span class="line-modified">2868   // BiasedLocking needs an updated RegisterMap for the revoke monitors pass</span>
<span class="line-removed">2869   StackFrameStream fst(this, UseBiasedLocking);</span>
2870   bool deopt = false;           // Dump stack only if a deopt actually happens.
2871   bool only_at = strlen(DeoptimizeOnlyAt) &gt; 0;
2872   // Iterate over all frames in the thread and deoptimize
2873   for (; !fst.is_done(); fst.next()) {
2874     if (fst.current()-&gt;can_be_deoptimized()) {
2875 
2876       if (only_at) {
2877         // Deoptimize only at particular bcis.  DeoptimizeOnlyAt
2878         // consists of comma or carriage return separated numbers so
2879         // search for the current bci in that string.
2880         address pc = fst.current()-&gt;pc();
2881         nmethod* nm =  (nmethod*) fst.current()-&gt;cb();
2882         ScopeDesc* sd = nm-&gt;scope_desc_at(pc);
2883         char buffer[8];
2884         jio_snprintf(buffer, sizeof(buffer), &quot;%d&quot;, sd-&gt;bci());
2885         size_t len = strlen(buffer);
2886         const char * found = strstr(DeoptimizeOnlyAt, buffer);
2887         while (found != NULL) {
2888           if ((found[len] == &#39;,&#39; || found[len] == &#39;\n&#39; || found[len] == &#39;\0&#39;) &amp;&amp;
2889               (found == DeoptimizeOnlyAt || found[-1] == &#39;,&#39; || found[-1] == &#39;\n&#39;)) {
2890             // Check that the bci found is bracketed by terminators.
2891             break;
2892           }
2893           found = strstr(found + 1, buffer);
2894         }
2895         if (!found) {
2896           continue;
2897         }
2898       }
2899 
2900       if (DebugDeoptimization &amp;&amp; !deopt) {
2901         deopt = true; // One-time only print before deopt
2902         tty-&gt;print_cr(&quot;[BEFORE Deoptimization]&quot;);
2903         trace_frames();
2904         trace_stack();
2905       }
<span class="line-modified">2906       Deoptimization::deoptimize(this, *fst.current(), fst.register_map());</span>
2907     }
2908   }
2909 
2910   if (DebugDeoptimization &amp;&amp; deopt) {
2911     tty-&gt;print_cr(&quot;[AFTER Deoptimization]&quot;);
2912     trace_frames();
2913   }
2914 }
2915 
2916 
2917 // Make zombies
2918 void JavaThread::make_zombies() {
2919   for (StackFrameStream fst(this); !fst.is_done(); fst.next()) {
2920     if (fst.current()-&gt;can_be_deoptimized()) {
2921       // it is a Java nmethod
2922       nmethod* nm = CodeCache::find_nmethod(fst.current()-&gt;pc());
2923       nm-&gt;make_not_entrant();
2924     }
2925   }
2926 }
2927 #endif // PRODUCT
2928 
2929 
2930 void JavaThread::deoptimize_marked_methods() {
2931   if (!has_last_Java_frame()) return;
<span class="line-modified">2932   // BiasedLocking needs an updated RegisterMap for the revoke monitors pass</span>
<span class="line-removed">2933   StackFrameStream fst(this, UseBiasedLocking);</span>
2934   for (; !fst.is_done(); fst.next()) {
2935     if (fst.current()-&gt;should_be_deoptimized()) {
<span class="line-modified">2936       Deoptimization::deoptimize(this, *fst.current(), fst.register_map());</span>
2937     }
2938   }
2939 }
2940 
2941 // If the caller is a NamedThread, then remember, in the current scope,
2942 // the given JavaThread in its _processed_thread field.
2943 class RememberProcessedThread: public StackObj {
2944   NamedThread* _cur_thr;
2945  public:
2946   RememberProcessedThread(JavaThread* jthr) {
2947     Thread* thread = Thread::current();
2948     if (thread-&gt;is_Named_thread()) {
2949       _cur_thr = (NamedThread *)thread;
2950       _cur_thr-&gt;set_processed_thread(jthr);
2951     } else {
2952       _cur_thr = NULL;
2953     }
2954   }
2955 
2956   ~RememberProcessedThread() {
</pre>
<hr />
<pre>
3618     }
3619   }
3620   VMThread* vmt = VMThread::vm_thread();
3621   if (vmt-&gt;claim_threads_do(is_par, claim_token)) {
3622     tc-&gt;do_thread(vmt);
3623   }
3624 }
3625 
3626 // The system initialization in the library has three phases.
3627 //
3628 // Phase 1: java.lang.System class initialization
3629 //     java.lang.System is a primordial class loaded and initialized
3630 //     by the VM early during startup.  java.lang.System.&lt;clinit&gt;
3631 //     only does registerNatives and keeps the rest of the class
3632 //     initialization work later until thread initialization completes.
3633 //
3634 //     System.initPhase1 initializes the system properties, the static
3635 //     fields in, out, and err. Set up java signal handlers, OS-specific
3636 //     system settings, and thread group of the main thread.
3637 static void call_initPhase1(TRAPS) {
<span class="line-modified">3638   Klass* klass =  SystemDictionary::resolve_or_fail(vmSymbols::java_lang_System(), true, CHECK);</span>
3639   JavaValue result(T_VOID);
3640   JavaCalls::call_static(&amp;result, klass, vmSymbols::initPhase1_name(),
3641                                          vmSymbols::void_method_signature(), CHECK);
3642 }
3643 
3644 // Phase 2. Module system initialization
3645 //     This will initialize the module system.  Only java.base classes
3646 //     can be loaded until phase 2 completes.
3647 //
3648 //     Call System.initPhase2 after the compiler initialization and jsr292
3649 //     classes get initialized because module initialization runs a lot of java
3650 //     code, that for performance reasons, should be compiled.  Also, this will
3651 //     enable the startup code to use lambda and other language features in this
3652 //     phase and onward.
3653 //
3654 //     After phase 2, The VM will begin search classes from -Xbootclasspath/a.
3655 static void call_initPhase2(TRAPS) {
3656   TraceTime timer(&quot;Initialize module system&quot;, TRACETIME_LOG(Info, startuptime));
3657 
<span class="line-modified">3658   Klass* klass = SystemDictionary::resolve_or_fail(vmSymbols::java_lang_System(), true, CHECK);</span>
3659 
3660   JavaValue result(T_INT);
3661   JavaCallArguments args;
3662   args.push_int(DisplayVMOutputToStderr);
3663   args.push_int(log_is_enabled(Debug, init)); // print stack trace if exception thrown
3664   JavaCalls::call_static(&amp;result, klass, vmSymbols::initPhase2_name(),
3665                                          vmSymbols::boolean_boolean_int_signature(), &amp;args, CHECK);
3666   if (result.get_jint() != JNI_OK) {
3667     vm_exit_during_initialization(); // no message or exception
3668   }
3669 
3670   universe_post_module_init();
3671 }
3672 
3673 // Phase 3. final setup - set security manager, system class loader and TCCL
3674 //
3675 //     This will instantiate and set the security manager, set the system class
3676 //     loader as well as the thread context class loader.  The security manager
3677 //     and system class loader may be a custom class loaded from -Xbootclasspath/a,
3678 //     other modules or the application&#39;s classpath.
3679 static void call_initPhase3(TRAPS) {
<span class="line-modified">3680   Klass* klass = SystemDictionary::resolve_or_fail(vmSymbols::java_lang_System(), true, CHECK);</span>
3681   JavaValue result(T_VOID);
3682   JavaCalls::call_static(&amp;result, klass, vmSymbols::initPhase3_name(),
3683                                          vmSymbols::void_method_signature(), CHECK);
3684 }
3685 
3686 void Threads::initialize_java_lang_classes(JavaThread* main_thread, TRAPS) {
3687   TraceTime timer(&quot;Initialize java.lang classes&quot;, TRACETIME_LOG(Info, startuptime));
3688 
3689   if (EagerXrunInit &amp;&amp; Arguments::init_libraries_at_startup()) {
3690     create_vm_init_libraries();
3691   }
3692 
3693   initialize_class(vmSymbols::java_lang_String(), CHECK);
3694 
3695   // Inject CompactStrings value after the static initializers for String ran.
3696   java_lang_String::set_compact_strings(CompactStrings);
3697 
3698   // Initialize java_lang.System (needed before creating the thread)
3699   initialize_class(vmSymbols::java_lang_System(), CHECK);
3700   // The VM creates &amp; returns objects of this class. Make sure it&#39;s initialized.
</pre>
<hr />
<pre>
4331     if (on_load_entry != NULL) {
4332       // Invoke the JVM_OnLoad function
4333       JavaThread* thread = JavaThread::current();
4334       ThreadToNativeFromVM ttn(thread);
4335       HandleMark hm(thread);
4336       jint err = (*on_load_entry)(&amp;main_vm, agent-&gt;options(), NULL);
4337       if (err != JNI_OK) {
4338         vm_exit_during_initialization(&quot;-Xrun library failed to init&quot;, agent-&gt;name());
4339       }
4340     } else {
4341       vm_exit_during_initialization(&quot;Could not find JVM_OnLoad function in -Xrun library&quot;, agent-&gt;name());
4342     }
4343   }
4344 }
4345 
4346 
4347 // Last thread running calls java.lang.Shutdown.shutdown()
4348 void JavaThread::invoke_shutdown_hooks() {
4349   HandleMark hm(this);
4350 







4351   // We could get here with a pending exception, if so clear it now.
4352   if (this-&gt;has_pending_exception()) {
4353     this-&gt;clear_pending_exception();
4354   }
4355 
4356   EXCEPTION_MARK;
4357   Klass* shutdown_klass =
4358     SystemDictionary::resolve_or_null(vmSymbols::java_lang_Shutdown(),
4359                                       THREAD);
4360   if (shutdown_klass != NULL) {
4361     // SystemDictionary::resolve_or_null will return null if there was
4362     // an exception.  If we cannot load the Shutdown class, just don&#39;t
4363     // call Shutdown.shutdown() at all.  This will mean the shutdown hooks
4364     // won&#39;t be run.  Note that if a shutdown hook was registered,
4365     // the Shutdown class would have already been loaded
4366     // (Runtime.addShutdownHook will load it).
4367     JavaValue result(T_VOID);
4368     JavaCalls::call_static(&amp;result,
4369                            shutdown_klass,
4370                            vmSymbols::shutdown_name(),
</pre>
</td>
<td>
<hr />
<pre>
 332 #endif
 333   assert(ThreadLocalStorage::thread() == NULL, &quot;ThreadLocalStorage::thread already initialized&quot;);
 334   ThreadLocalStorage::set_thread(this);
 335   assert(Thread::current() == ThreadLocalStorage::thread(), &quot;TLS mismatch!&quot;);
 336 }
 337 
 338 void Thread::clear_thread_current() {
 339   assert(Thread::current() == ThreadLocalStorage::thread(), &quot;TLS mismatch!&quot;);
 340 #ifndef USE_LIBRARY_BASED_TLS_ONLY
 341   _thr_current = NULL;
 342 #endif
 343   ThreadLocalStorage::set_thread(NULL);
 344 }
 345 
 346 void Thread::record_stack_base_and_size() {
 347   // Note: at this point, Thread object is not yet initialized. Do not rely on
 348   // any members being initialized. Do not rely on Thread::current() being set.
 349   // If possible, refrain from doing anything which may crash or assert since
 350   // quite probably those crash dumps will be useless.
 351   set_stack_base(os::current_stack_base());
<span class="line-added"> 352   assert(_stack_base != NULL, &quot;current_stack_base failed for %s&quot;, name());</span>
 353   set_stack_size(os::current_stack_size());
 354 
 355 #ifdef SOLARIS
 356   if (os::is_primordial_thread()) {
 357     os::Solaris::correct_stack_boundaries_for_primordial_thread(this);
 358   }
 359 #endif
 360 
 361   // Set stack limits after thread is initialized.
 362   if (is_Java_thread()) {
 363     ((JavaThread*) this)-&gt;set_stack_overflow_limit();
 364     ((JavaThread*) this)-&gt;set_reserved_stack_activation(stack_base());
 365   }
 366 }
 367 
 368 #if INCLUDE_NMT
 369 void Thread::register_thread_stack_with_NMT() {
 370   MemTracker::record_thread_stack(stack_end(), stack_size());
 371 }
 372 #endif // INCLUDE_NMT
 373 
 374 void Thread::call_run() {
 375   DEBUG_ONLY(_run_state = CALL_RUN;)
 376 
 377   // At this point, Thread object should be fully initialized and
 378   // Thread::current() should be set.
 379 
 380   assert(Thread::current_or_null() != NULL, &quot;current thread is unset&quot;);
 381   assert(Thread::current_or_null() == this, &quot;current thread is wrong&quot;);
 382 
 383   // Perform common initialization actions
 384 
 385   register_thread_stack_with_NMT();
 386 
 387   JFR_ONLY(Jfr::on_thread_start(this);)
 388 
 389   log_debug(os, thread)(&quot;Thread &quot; UINTX_FORMAT &quot; stack dimensions: &quot;
 390     PTR_FORMAT &quot;-&quot; PTR_FORMAT &quot; (&quot; SIZE_FORMAT &quot;k).&quot;,
<span class="line-modified"> 391     os::current_thread_id(), p2i(stack_end()),</span>
 392     p2i(stack_base()), stack_size()/1024);
 393 
 394   // Perform &lt;ChildClass&gt; initialization actions
 395   DEBUG_ONLY(_run_state = PRE_RUN;)
 396   this-&gt;pre_run();
 397 
 398   // Invoke &lt;ChildClass&gt;::run()
 399   DEBUG_ONLY(_run_state = RUN;)
 400   this-&gt;run();
 401   // Returned from &lt;ChildClass&gt;::run(). Thread finished.
 402 
 403   // Perform common tear-down actions
 404 
 405   assert(Thread::current_or_null() != NULL, &quot;current thread is unset&quot;);
 406   assert(Thread::current_or_null() == this, &quot;current thread is wrong&quot;);
 407 
 408   // Perform &lt;ChildClass&gt; tear-down actions
 409   DEBUG_ONLY(_run_state = POST_RUN;)
 410   this-&gt;post_run();
 411 
</pre>
<hr />
<pre>
 871     }
 872   }
 873 
 874   return true;
 875 }
 876 
 877 // GC Support
 878 bool Thread::claim_par_threads_do(uintx claim_token) {
 879   uintx token = _threads_do_token;
 880   if (token != claim_token) {
 881     uintx res = Atomic::cmpxchg(&amp;_threads_do_token, token, claim_token);
 882     if (res == token) {
 883       return true;
 884     }
 885     guarantee(res == claim_token, &quot;invariant&quot;);
 886   }
 887   return false;
 888 }
 889 
 890 void Thread::oops_do(OopClosure* f, CodeBlobClosure* cf) {
<span class="line-modified"> 891   if (active_handles() != NULL) {</span>
<span class="line-added"> 892     active_handles()-&gt;oops_do(f);</span>
<span class="line-added"> 893   }</span>
 894   // Do oop for ThreadShadow
 895   f-&gt;do_oop((oop*)&amp;_pending_exception);
 896   handle_area()-&gt;oops_do(f);
 897 
 898   // We scan thread local monitor lists here, and the remaining global
 899   // monitors in ObjectSynchronizer::oops_do().
 900   ObjectSynchronizer::thread_local_used_oops_do(this, f);
 901 }
 902 
 903 void Thread::metadata_handles_do(void f(Metadata*)) {
 904   // Only walk the Handles in Thread.
 905   if (metadata_handles() != NULL) {
 906     for (int i = 0; i&lt; metadata_handles()-&gt;length(); i++) {
 907       f(metadata_handles()-&gt;at(i));
 908     }
 909   }
 910 }
 911 
 912 void Thread::print_on(outputStream* st, bool print_extended_info) const {
 913   // get_priority assumes osthread initialized
</pre>
<hr />
<pre>
1004 
1005 void Thread::check_for_valid_safepoint_state() {
1006   if (!is_Java_thread()) return;
1007 
1008   // Check NoSafepointVerifier, which is implied by locks taken that can be
1009   // shared with the VM thread.  This makes sure that no locks with allow_vm_block
1010   // are held.
1011   check_possible_safepoint();
1012 
1013   if (((JavaThread*)this)-&gt;thread_state() != _thread_in_vm) {
1014     fatal(&quot;LEAF method calling lock?&quot;);
1015   }
1016 
1017   if (GCALotAtAllSafepoints) {
1018     // We could enter a safepoint here and thus have a gc
1019     InterfaceSupport::check_gc_alot();
1020   }
1021 }
1022 #endif // ASSERT
1023 


















1024 // We had to move these methods here, because vm threads get into ObjectSynchronizer::enter
1025 // However, there is a note in JavaThread::is_lock_owned() about the VM threads not being
1026 // used for compilation in the future. If that change is made, the need for these methods
1027 // should be revisited, and they should be removed if possible.
1028 
1029 bool Thread::is_lock_owned(address adr) const {
<span class="line-modified">1030   return is_in_full_stack(adr);</span>
1031 }
1032 
1033 bool Thread::set_as_starting_thread() {
1034   assert(_starting_thread == NULL, &quot;already initialized: &quot;
1035          &quot;_starting_thread=&quot; INTPTR_FORMAT, p2i(_starting_thread));
1036   // NOTE: this must be called inside the main thread.
1037   DEBUG_ONLY(_starting_thread = this;)
1038   return os::create_main_thread((JavaThread*)this);
1039 }
1040 
1041 static void initialize_class(Symbol* class_name, TRAPS) {
1042   Klass* klass = SystemDictionary::resolve_or_fail(class_name, true, CHECK);
1043   InstanceKlass::cast(klass)-&gt;initialize(CHECK);
1044 }
1045 
1046 
1047 // Creates the initial ThreadGroup
1048 static Handle create_initial_thread_group(TRAPS) {
1049   Handle system_instance = JavaCalls::construct_new_instance(
1050                             SystemDictionary::ThreadGroup_klass(),
</pre>
<hr />
<pre>
1227     // (java.lang.Thread doesn&#39;t have a constructor taking only a ThreadGroup argument)
1228     JavaCalls::call_special(&amp;result,
1229                             thread_oop,
1230                             ik,
1231                             vmSymbols::object_initializer_name(),
1232                             vmSymbols::threadgroup_runnable_void_signature(),
1233                             thread_group,
1234                             Handle(),
1235                             THREAD);
1236   }
1237 
1238 
1239   if (daemon) {
1240     java_lang_Thread::set_daemon(thread_oop());
1241   }
1242 
1243   if (HAS_PENDING_EXCEPTION) {
1244     return;
1245   }
1246 
<span class="line-modified">1247   Klass* group = SystemDictionary::ThreadGroup_klass();</span>
1248   Handle threadObj(THREAD, this-&gt;threadObj());
1249 
1250   JavaCalls::call_special(&amp;result,
1251                           thread_group,
1252                           group,
1253                           vmSymbols::add_method_name(),
1254                           vmSymbols::thread_void_signature(),
1255                           threadObj,          // Arg 1
1256                           THREAD);
1257 }
1258 
1259 // List of all NonJavaThreads and safe iteration over that list.
1260 
1261 class NonJavaThread::List {
1262 public:
1263   NonJavaThread* volatile _head;
1264   SingleWriterSynchronizer _protect;
1265 
1266   List() : _head(NULL), _protect() {}
1267 };
</pre>
<hr />
<pre>
1797   // some exception code in c1, c2 or the interpreter isn&#39;t unwinding
1798   // when it should.
1799   guarantee(cur_sp &gt; stack_reserved_zone_base(),
1800             &quot;not enough space to reguard - increase StackShadowPages&quot;);
1801   if (_stack_guard_state == stack_guard_yellow_reserved_disabled) {
1802     enable_stack_yellow_reserved_zone();
1803     if (reserved_stack_activation() != stack_base()) {
1804       set_reserved_stack_activation(stack_base());
1805     }
1806   } else if (_stack_guard_state == stack_guard_reserved_disabled) {
1807     set_reserved_stack_activation(stack_base());
1808     enable_stack_reserved_zone();
1809   }
1810   return true;
1811 }
1812 
1813 bool JavaThread::reguard_stack(void) {
1814   return reguard_stack(os::current_stack_pointer());
1815 }
1816 

1817 void JavaThread::block_if_vm_exited() {
1818   if (_terminated == _vm_exited) {
1819     // _vm_exited is set at safepoint, and Threads_lock is never released
1820     // we will block here forever.
1821     // Here we can be doing a jump from a safe state to an unsafe state without
1822     // proper transition, but it happens after the final safepoint has begun.
1823     set_thread_state(_thread_in_vm);
1824     Threads_lock-&gt;lock();
1825     ShouldNotReachHere();
1826   }
1827 }
1828 
1829 
1830 // Remove this ifdef when C1 is ported to the compiler interface.
1831 static void compiler_thread_entry(JavaThread* thread, TRAPS);
1832 static void sweeper_thread_entry(JavaThread* thread, TRAPS);
1833 
1834 JavaThread::JavaThread(ThreadFunction entry_point, size_t stack_sz) :
1835                        Thread() {
1836   initialize();
</pre>
<hr />
<pre>
2383 
2384 void JavaThread::send_thread_stop(oop java_throwable)  {
2385   ResourceMark rm;
2386   assert(Thread::current()-&gt;is_VM_thread() || Thread::current() == this, &quot;should be in the vm thread&quot;);
2387 
2388   // Do not throw asynchronous exceptions against the compiler thread
2389   // (the compiler thread should not be a Java thread -- fix in 1.4.2)
2390   if (!can_call_java()) return;
2391 
2392   {
2393     // Actually throw the Throwable against the target Thread - however
2394     // only if there is no thread death exception installed already.
2395     if (_pending_async_exception == NULL || !_pending_async_exception-&gt;is_a(SystemDictionary::ThreadDeath_klass())) {
2396       // If the topmost frame is a runtime stub, then we are calling into
2397       // OptoRuntime from compiled code. Some runtime stubs (new, monitor_exit..)
2398       // must deoptimize the caller before continuing, as the compiled  exception handler table
2399       // may not be valid
2400       if (has_last_Java_frame()) {
2401         frame f = last_frame();
2402         if (f.is_runtime_frame() || f.is_safepoint_blob_frame()) {
<span class="line-modified">2403           RegisterMap reg_map(this, false);</span>

2404           frame compiled_frame = f.sender(&amp;reg_map);
2405           if (!StressCompiledExceptionHandlers &amp;&amp; compiled_frame.can_be_deoptimized()) {
<span class="line-modified">2406             Deoptimization::deoptimize(this, compiled_frame);</span>
2407           }
2408         }
2409       }
2410 
2411       // Set async. pending exception in thread.
2412       set_pending_async_exception(java_throwable);
2413 
2414       if (log_is_enabled(Info, exceptions)) {
2415          ResourceMark rm;
2416         log_info(exceptions)(&quot;Pending Async. exception installed of type: %s&quot;,
2417                              InstanceKlass::cast(_pending_async_exception-&gt;klass())-&gt;external_name());
2418       }
2419       // for AbortVMOnException flag
2420       Exceptions::debug_check_abort(_pending_async_exception-&gt;klass()-&gt;external_name());
2421     }
2422   }
2423 
2424 
2425   // Interrupt thread so it will wake up from a potential wait()/sleep()/park()
2426   java_lang_Thread::set_interrupted(threadObj(), true);
</pre>
<hr />
<pre>
2831   if (!os::unguard_memory((char *)base, stack_red_zone_size())) {
2832     warning(&quot;Attempt to unguard stack red zone failed.&quot;);
2833   }
2834 }
2835 
2836 void JavaThread::frames_do(void f(frame*, const RegisterMap* map)) {
2837   // ignore is there is no stack
2838   if (!has_last_Java_frame()) return;
2839   // traverse the stack frames. Starts from top frame.
2840   for (StackFrameStream fst(this); !fst.is_done(); fst.next()) {
2841     frame* fr = fst.current();
2842     f(fr, fst.register_map());
2843   }
2844 }
2845 
2846 
2847 #ifndef PRODUCT
2848 // Deoptimization
2849 // Function for testing deoptimization
2850 void JavaThread::deoptimize() {
<span class="line-modified">2851   StackFrameStream fst(this, false);</span>

2852   bool deopt = false;           // Dump stack only if a deopt actually happens.
2853   bool only_at = strlen(DeoptimizeOnlyAt) &gt; 0;
2854   // Iterate over all frames in the thread and deoptimize
2855   for (; !fst.is_done(); fst.next()) {
2856     if (fst.current()-&gt;can_be_deoptimized()) {
2857 
2858       if (only_at) {
2859         // Deoptimize only at particular bcis.  DeoptimizeOnlyAt
2860         // consists of comma or carriage return separated numbers so
2861         // search for the current bci in that string.
2862         address pc = fst.current()-&gt;pc();
2863         nmethod* nm =  (nmethod*) fst.current()-&gt;cb();
2864         ScopeDesc* sd = nm-&gt;scope_desc_at(pc);
2865         char buffer[8];
2866         jio_snprintf(buffer, sizeof(buffer), &quot;%d&quot;, sd-&gt;bci());
2867         size_t len = strlen(buffer);
2868         const char * found = strstr(DeoptimizeOnlyAt, buffer);
2869         while (found != NULL) {
2870           if ((found[len] == &#39;,&#39; || found[len] == &#39;\n&#39; || found[len] == &#39;\0&#39;) &amp;&amp;
2871               (found == DeoptimizeOnlyAt || found[-1] == &#39;,&#39; || found[-1] == &#39;\n&#39;)) {
2872             // Check that the bci found is bracketed by terminators.
2873             break;
2874           }
2875           found = strstr(found + 1, buffer);
2876         }
2877         if (!found) {
2878           continue;
2879         }
2880       }
2881 
2882       if (DebugDeoptimization &amp;&amp; !deopt) {
2883         deopt = true; // One-time only print before deopt
2884         tty-&gt;print_cr(&quot;[BEFORE Deoptimization]&quot;);
2885         trace_frames();
2886         trace_stack();
2887       }
<span class="line-modified">2888       Deoptimization::deoptimize(this, *fst.current());</span>
2889     }
2890   }
2891 
2892   if (DebugDeoptimization &amp;&amp; deopt) {
2893     tty-&gt;print_cr(&quot;[AFTER Deoptimization]&quot;);
2894     trace_frames();
2895   }
2896 }
2897 
2898 
2899 // Make zombies
2900 void JavaThread::make_zombies() {
2901   for (StackFrameStream fst(this); !fst.is_done(); fst.next()) {
2902     if (fst.current()-&gt;can_be_deoptimized()) {
2903       // it is a Java nmethod
2904       nmethod* nm = CodeCache::find_nmethod(fst.current()-&gt;pc());
2905       nm-&gt;make_not_entrant();
2906     }
2907   }
2908 }
2909 #endif // PRODUCT
2910 
2911 
2912 void JavaThread::deoptimize_marked_methods() {
2913   if (!has_last_Java_frame()) return;
<span class="line-modified">2914   StackFrameStream fst(this, false);</span>

2915   for (; !fst.is_done(); fst.next()) {
2916     if (fst.current()-&gt;should_be_deoptimized()) {
<span class="line-modified">2917       Deoptimization::deoptimize(this, *fst.current());</span>
2918     }
2919   }
2920 }
2921 
2922 // If the caller is a NamedThread, then remember, in the current scope,
2923 // the given JavaThread in its _processed_thread field.
2924 class RememberProcessedThread: public StackObj {
2925   NamedThread* _cur_thr;
2926  public:
2927   RememberProcessedThread(JavaThread* jthr) {
2928     Thread* thread = Thread::current();
2929     if (thread-&gt;is_Named_thread()) {
2930       _cur_thr = (NamedThread *)thread;
2931       _cur_thr-&gt;set_processed_thread(jthr);
2932     } else {
2933       _cur_thr = NULL;
2934     }
2935   }
2936 
2937   ~RememberProcessedThread() {
</pre>
<hr />
<pre>
3599     }
3600   }
3601   VMThread* vmt = VMThread::vm_thread();
3602   if (vmt-&gt;claim_threads_do(is_par, claim_token)) {
3603     tc-&gt;do_thread(vmt);
3604   }
3605 }
3606 
3607 // The system initialization in the library has three phases.
3608 //
3609 // Phase 1: java.lang.System class initialization
3610 //     java.lang.System is a primordial class loaded and initialized
3611 //     by the VM early during startup.  java.lang.System.&lt;clinit&gt;
3612 //     only does registerNatives and keeps the rest of the class
3613 //     initialization work later until thread initialization completes.
3614 //
3615 //     System.initPhase1 initializes the system properties, the static
3616 //     fields in, out, and err. Set up java signal handlers, OS-specific
3617 //     system settings, and thread group of the main thread.
3618 static void call_initPhase1(TRAPS) {
<span class="line-modified">3619   Klass* klass = SystemDictionary::System_klass();</span>
3620   JavaValue result(T_VOID);
3621   JavaCalls::call_static(&amp;result, klass, vmSymbols::initPhase1_name(),
3622                                          vmSymbols::void_method_signature(), CHECK);
3623 }
3624 
3625 // Phase 2. Module system initialization
3626 //     This will initialize the module system.  Only java.base classes
3627 //     can be loaded until phase 2 completes.
3628 //
3629 //     Call System.initPhase2 after the compiler initialization and jsr292
3630 //     classes get initialized because module initialization runs a lot of java
3631 //     code, that for performance reasons, should be compiled.  Also, this will
3632 //     enable the startup code to use lambda and other language features in this
3633 //     phase and onward.
3634 //
3635 //     After phase 2, The VM will begin search classes from -Xbootclasspath/a.
3636 static void call_initPhase2(TRAPS) {
3637   TraceTime timer(&quot;Initialize module system&quot;, TRACETIME_LOG(Info, startuptime));
3638 
<span class="line-modified">3639   Klass* klass = SystemDictionary::System_klass();</span>
3640 
3641   JavaValue result(T_INT);
3642   JavaCallArguments args;
3643   args.push_int(DisplayVMOutputToStderr);
3644   args.push_int(log_is_enabled(Debug, init)); // print stack trace if exception thrown
3645   JavaCalls::call_static(&amp;result, klass, vmSymbols::initPhase2_name(),
3646                                          vmSymbols::boolean_boolean_int_signature(), &amp;args, CHECK);
3647   if (result.get_jint() != JNI_OK) {
3648     vm_exit_during_initialization(); // no message or exception
3649   }
3650 
3651   universe_post_module_init();
3652 }
3653 
3654 // Phase 3. final setup - set security manager, system class loader and TCCL
3655 //
3656 //     This will instantiate and set the security manager, set the system class
3657 //     loader as well as the thread context class loader.  The security manager
3658 //     and system class loader may be a custom class loaded from -Xbootclasspath/a,
3659 //     other modules or the application&#39;s classpath.
3660 static void call_initPhase3(TRAPS) {
<span class="line-modified">3661   Klass* klass = SystemDictionary::System_klass();</span>
3662   JavaValue result(T_VOID);
3663   JavaCalls::call_static(&amp;result, klass, vmSymbols::initPhase3_name(),
3664                                          vmSymbols::void_method_signature(), CHECK);
3665 }
3666 
3667 void Threads::initialize_java_lang_classes(JavaThread* main_thread, TRAPS) {
3668   TraceTime timer(&quot;Initialize java.lang classes&quot;, TRACETIME_LOG(Info, startuptime));
3669 
3670   if (EagerXrunInit &amp;&amp; Arguments::init_libraries_at_startup()) {
3671     create_vm_init_libraries();
3672   }
3673 
3674   initialize_class(vmSymbols::java_lang_String(), CHECK);
3675 
3676   // Inject CompactStrings value after the static initializers for String ran.
3677   java_lang_String::set_compact_strings(CompactStrings);
3678 
3679   // Initialize java_lang.System (needed before creating the thread)
3680   initialize_class(vmSymbols::java_lang_System(), CHECK);
3681   // The VM creates &amp; returns objects of this class. Make sure it&#39;s initialized.
</pre>
<hr />
<pre>
4312     if (on_load_entry != NULL) {
4313       // Invoke the JVM_OnLoad function
4314       JavaThread* thread = JavaThread::current();
4315       ThreadToNativeFromVM ttn(thread);
4316       HandleMark hm(thread);
4317       jint err = (*on_load_entry)(&amp;main_vm, agent-&gt;options(), NULL);
4318       if (err != JNI_OK) {
4319         vm_exit_during_initialization(&quot;-Xrun library failed to init&quot;, agent-&gt;name());
4320       }
4321     } else {
4322       vm_exit_during_initialization(&quot;Could not find JVM_OnLoad function in -Xrun library&quot;, agent-&gt;name());
4323     }
4324   }
4325 }
4326 
4327 
4328 // Last thread running calls java.lang.Shutdown.shutdown()
4329 void JavaThread::invoke_shutdown_hooks() {
4330   HandleMark hm(this);
4331 
<span class="line-added">4332   // Link all classes for dynamic CDS dumping before vm exit.</span>
<span class="line-added">4333   // Same operation is being done in JVM_BeforeHalt for handling the</span>
<span class="line-added">4334   // case where the application calls System.exit().</span>
<span class="line-added">4335   if (DynamicDumpSharedSpaces) {</span>
<span class="line-added">4336     MetaspaceShared::link_and_cleanup_shared_classes(this);</span>
<span class="line-added">4337   }</span>
<span class="line-added">4338 </span>
4339   // We could get here with a pending exception, if so clear it now.
4340   if (this-&gt;has_pending_exception()) {
4341     this-&gt;clear_pending_exception();
4342   }
4343 
4344   EXCEPTION_MARK;
4345   Klass* shutdown_klass =
4346     SystemDictionary::resolve_or_null(vmSymbols::java_lang_Shutdown(),
4347                                       THREAD);
4348   if (shutdown_klass != NULL) {
4349     // SystemDictionary::resolve_or_null will return null if there was
4350     // an exception.  If we cannot load the Shutdown class, just don&#39;t
4351     // call Shutdown.shutdown() at all.  This will mean the shutdown hooks
4352     // won&#39;t be run.  Note that if a shutdown hook was registered,
4353     // the Shutdown class would have already been loaded
4354     // (Runtime.addShutdownHook will load it).
4355     JavaValue result(T_VOID);
4356     JavaCalls::call_static(&amp;result,
4357                            shutdown_klass,
4358                            vmSymbols::shutdown_name(),
</pre>
</td>
</tr>
</table>
<center><a href="signature.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="thread.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>