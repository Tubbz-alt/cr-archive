<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New make/lib/Awt2dLibraries.gmk</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
  <body>
    <pre>
   1 #
   2 # Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.
   3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4 #
   5 # This code is free software; you can redistribute it and/or modify it
   6 # under the terms of the GNU General Public License version 2 only, as
   7 # published by the Free Software Foundation.  Oracle designates this
   8 # particular file as subject to the &quot;Classpath&quot; exception as provided
   9 # by Oracle in the LICENSE file that accompanied this code.
  10 #
  11 # This code is distributed in the hope that it will be useful, but WITHOUT
  12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14 # version 2 for more details (a copy is included in the LICENSE file that
  15 # accompanied this code).
  16 #
  17 # You should have received a copy of the GNU General Public License version
  18 # 2 along with this work; if not, write to the Free Software Foundation,
  19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20 #
  21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22 # or visit www.oracle.com if you need additional information or have any
  23 # questions.
  24 #
  25 
  26 $(eval $(call IncludeCustomExtension, lib/Awt2dLibraries-pre.gmk))
  27 
  28 WIN_AWT_LIB := $(SUPPORT_OUTPUTDIR)/native/$(MODULE)/libawt/awt.lib
  29 
  30 LIBAWT_DEFAULT_HEADER_DIRS := \
  31     libawt/awt/image \
  32     libawt/awt/image/cvutils \
  33     libawt/java2d \
  34     libawt/java2d/loops \
  35     libawt/java2d/pipe \
  36     #
  37 
  38 ################################################################################
  39 
  40 # We must not include java.desktop/unix/native/libmlib_image, which is only
  41 # for usage by solaris-sparc in libmlib_image_v.
  42 BUILD_LIBMLIB_EXCLUDE_SRC_PATTERNS := /unix/
  43 
  44 BUILD_LIBMLIB_CFLAGS := -D__USE_J2D_NAMES -D__MEDIALIB_OLD_NAMES -DMLIB_NO_LIBSUNMATH
  45 
  46 ifeq ($(call isTargetCpuBits, 64), true)
  47   BUILD_LIBMLIB_CFLAGS += -DMLIB_OS64BIT
  48 endif
  49 
  50 $(eval $(call SetupJdkLibrary, BUILD_LIBMLIB_IMAGE, \
  51     NAME := mlib_image, \
  52     EXTRA_SRC := common/awt/medialib, \
  53     EXCLUDE_FILES := mlib_c_ImageBlendTable.c, \
  54     EXCLUDE_SRC_PATTERNS := $(BUILD_LIBMLIB_EXCLUDE_SRC_PATTERNS), \
  55     OPTIMIZATION := HIGHEST, \
  56     CFLAGS := $(CFLAGS_JDKLIB) \
  57         $(BUILD_LIBMLIB_CFLAGS), \
  58     DISABLED_WARNINGS_gcc := unused-function, \
  59     LDFLAGS := $(LDFLAGS_JDKLIB) \
  60         $(call SET_SHARED_LIBRARY_ORIGIN), \
  61     LIBS := $(JDKLIB_LIBS), \
  62     LIBS_unix := $(LIBM) $(LIBDL), \
  63 ))
  64 
  65 $(BUILD_LIBMLIB_IMAGE): $(call FindLib, java.base, java)
  66 
  67 TARGETS += $(BUILD_LIBMLIB_IMAGE)
  68 
  69 ################################################################################
  70 
  71 ifeq ($(call And, $(call isTargetOs, solaris) $(call isTargetCpuArch, sparc)), true)
  72 
  73   # libmlib_image_v is basically built from mlib_image sources, with some additions
  74   # and some exclusions.
  75   LIBMLIB_IMAGE_V_SRC := \
  76      libmlib_image \
  77      common/awt/medialib \
  78      #
  79 
  80   LIBMLIB_IMAGE_V_CFLAGS := -xarch=sparcvis -D__USE_J2D_NAMES -D__MEDIALIB_OLD_NAMES \
  81       $(TOPDIR)/src/$(MODULE)/unix/native/libmlib_image/vis_$(OPENJDK_TARGET_CPU_BITS).il
  82 
  83   ifeq ($(call isTargetCpuBits, 64), true)
  84     LIBMLIB_IMAGE_V_CFLAGS += -DMLIB_OS64BIT
  85   endif
  86 
  87   BUILD_LIBMLIB_IMAGE_V_EXFILES := \
  88       awt_ImagingLib.c \
  89       mlib_c_ImageAffine_BC.c \
  90       mlib_c_ImageAffine_BC_S16.c \
  91       mlib_c_ImageAffine_BC_U16.c \
  92       mlib_c_ImageAffine_BL.c \
  93       mlib_c_ImageAffine_BL_S16.c \
  94       mlib_c_ImageAffine_BL_U16.c \
  95       mlib_c_ImageAffine_NN.c \
  96       mlib_c_ImageConvClearEdge.c \
  97       mlib_c_ImageConvCopyEdge.c \
  98       mlib_c_ImageConv_f.c \
  99       mlib_c_ImageConvVersion.c \
 100       mlib_c_ImageCopy.c \
 101       mlib_c_ImageLookUp.c \
 102       mlib_c_ImageLookUp_f.c \
 103       #
 104 
 105   $(eval $(call SetupJdkLibrary, BUILD_LIBMLIB_IMAGE_V, \
 106       NAME := mlib_image_v, \
 107       SRC := $(LIBMLIB_IMAGE_V_SRC), \
 108       EXCLUDE_FILES := $(BUILD_LIBMLIB_IMAGE_V_EXFILES), \
 109       OPTIMIZATION := HIGHEST, \
 110       CFLAGS := $(CFLAGS_JDKLIB) \
 111           $(LIBMLIB_IMAGE_V_CFLAGS), \
 112       LDFLAGS := $(LDFLAGS_JDKLIB) \
 113           $(call SET_SHARED_LIBRARY_ORIGIN), \
 114       LIBS := -ljava -ljvm $(LIBM) $(LIBDL), \
 115   ))
 116 
 117   $(BUILD_LIBMLIB_IMAGE_V): $(call FindLib, java.base, java)
 118 
 119   TARGETS += $(BUILD_LIBMLIB_IMAGE_V)
 120 
 121 endif
 122 
 123 ################################################################################
 124 
 125 LIBAWT_EXTRA_SRC := \
 126     common/awt/debug \
 127     $(TOPDIR)/src/$(MODULE)/$(OPENJDK_TARGET_OS_TYPE)/native/common/awt \
 128     #
 129 
 130 ifeq ($(call And, $(call isTargetOs, solaris) $(call isTargetCpuArch, sparc)), true)
 131   LIBAWT_EXTRA_SRC += $(TOPDIR)/src/$(MODULE)/share/native/common/awt/medialib
 132 endif
 133 
 134 ifeq ($(call isTargetOs, windows), true)
 135   LIBAWT_EXTRA_SRC += \
 136       $(TOPDIR)/src/$(MODULE)/share/native/common/awt/utility \
 137       $(TOPDIR)/src/$(MODULE)/share/native/common/font \
 138       $(TOPDIR)/src/$(MODULE)/share/native/common/java2d/opengl \
 139       $(TOPDIR)/src/$(MODULE)/$(OPENJDK_TARGET_OS_TYPE)/native/common/awt/systemscale \
 140       #
 141 endif
 142 
 143 ifeq ($(call isTargetOs, solaris linux macosx aix), true)
 144   LIBAWT_EXFILES += awt_Font.c CUPSfuncs.c fontpath.c X11Color.c
 145 endif
 146 
 147 ifeq ($(call isTargetOs, macosx), true)
 148   LIBAWT_EXFILES += initIDs.c awt/image/cvutils/img_colors.c
 149 endif
 150 
 151 ifeq ($(call isTargetOs, windows), true)
 152   LIBAWT_EXFILES += \
 153       java2d/d3d/D3DShaderGen.c \
 154       awt/image/cvutils/img_colors.c \
 155       #
 156 endif
 157 
 158 ifeq ($(call And, $(call isTargetOs, solaris) $(call isTargetCpu, sparcv9)), true)
 159   LIBAWT_EXFILES += java2d/loops/MapAccelFunc.c
 160 else
 161   LIBAWT_EXCLUDES += \
 162       $(TOPDIR)/src/$(MODULE)/unix/native/libawt/awt/medialib \
 163       $(TOPDIR)/src/$(MODULE)/unix/native/libawt/java2d/loops \
 164       $(TOPDIR)/src/$(MODULE)/unix/native/common/awt/medialib \
 165       #
 166 endif
 167 
 168 LIBAWT_EXTRA_HEADER_DIRS := \
 169     $(LIBAWT_DEFAULT_HEADER_DIRS) \
 170     $(call GetJavaHeaderDir, java.base) \
 171     libawt/awt/medialib \
 172     libawt/java2d/d3d \
 173     libawt/java2d/opengl \
 174     libawt/java2d/windows \
 175     libawt/windows \
 176     common/awt/medialib \
 177     libmlib_image \
 178     include \
 179     java.base:libjava \
 180     java.base:include \
 181     #
 182 
 183 LIBAWT_CFLAGS += -D__MEDIALIB_OLD_NAMES -D__USE_J2D_NAMES $(X_CFLAGS)
 184 
 185 ifeq ($(call And, $(call isTargetOs, solaris) $(call isTargetCpu, sparcv9)), true)
 186   LIBAWT_CFLAGS += -xarch=sparcvis -DMLIB_ADD_SUFF \
 187       $(TOPDIR)/src/$(MODULE)/unix/native/libmlib_image/vis_$(OPENJDK_TARGET_CPU_BITS).il
 188 
 189   LIBAWT_ASFLAGS = -P -xarch=v9a
 190 endif
 191 
 192 ifeq ($(call isTargetOs, solaris), false)
 193   LIBAWT_CFLAGS += -DMLIB_NO_LIBSUNMATH
 194 endif
 195 
 196 ifeq ($(call isTargetOs, windows), true)
 197   LIBAWT_CFLAGS += -EHsc -DUNICODE -D_UNICODE
 198   ifeq ($(call isTargetCpuBits, 64), true)
 199     LIBAWT_CFLAGS += -DMLIB_OS64BIT
 200   endif
 201 
 202   LIBAWT_RC_FLAGS ?= -I $(TOPDIR)/src/java.base/windows/native/launcher/icons
 203   LIBAWT_VERSIONINFO_RESOURCE := $(TOPDIR)/src/$(MODULE)/windows/native/libawt/windows/awt.rc
 204 endif
 205 
 206 ifeq ($(call isTargetOs, linux), true)
 207   # FIXME: This is probably not what we want to do, but keep it now for compatibility.
 208   LIBAWT_CFLAGS += $(EXPORT_ALL_SYMBOLS)
 209 endif
 210 
 211 # Turn off all warnings for debug_mem.c This is needed because the specific warning
 212 # about initializing a declared &#39;extern&#39; cannot be turned off individually. Only
 213 # applies to debug builds.
 214 ifeq ($(TOOLCHAIN_TYPE), gcc)
 215   BUILD_LIBAWT_debug_mem.c_CFLAGS := -w
 216   # This option improves performance of MaskFill in Java2D by 20% for some gcc
 217   LIBAWT_CFLAGS += -fgcse-after-reload
 218 endif
 219 
 220 $(eval $(call SetupJdkLibrary, BUILD_LIBAWT, \
 221     NAME := awt, \
 222     EXTRA_SRC := $(LIBAWT_EXTRA_SRC), \
 223     EXCLUDES := $(LIBAWT_EXCLUDES), \
 224     EXCLUDE_FILES := $(LIBAWT_EXFILES), \
 225     OPTIMIZATION := LOW, \
 226     CFLAGS := $(CFLAGS_JDKLIB) $(LIBAWT_CFLAGS), \
 227     EXTRA_HEADER_DIRS := $(LIBAWT_EXTRA_HEADER_DIRS), \
 228     DISABLED_WARNINGS_gcc := sign-compare unused-result maybe-uninitialized \
 229         format-nonliteral parentheses unused-value unused-function, \
 230     DISABLED_WARNINGS_clang := logical-op-parentheses extern-initializer \
 231         sign-compare format-nonliteral, \
 232     DISABLED_WARNINGS_microsoft := 4244 4267 4996, \
 233     ASFLAGS := $(LIBAWT_ASFLAGS), \
 234     LDFLAGS := $(LDFLAGS_JDKLIB) $(call SET_SHARED_LIBRARY_ORIGIN), \
 235     LDFLAGS_macosx := -L$(INSTALL_LIBRARIES_HERE), \
 236     LDFLAGS_windows := -delayload:user32.dll -delayload:gdi32.dll \
 237         -delayload:shell32.dll -delayload:winmm.dll \
 238         -delayload:winspool.drv -delayload:imm32.dll \
 239         -delayload:ole32.dll -delayload:comdlg32.dll \
 240         -delayload:comctl32.dll -delayload:shlwapi.dll, \
 241     LIBS_unix := -ljvm -ljava $(LIBM), \
 242     LIBS_linux :=  $(LIBDL), \
 243     LIBS_solaris := $(LIBDL), \
 244     LIBS_aix := $(LIBDL),\
 245     LIBS_macosx := -lmlib_image \
 246         -framework Cocoa \
 247         -framework OpenGL \
 248         -framework Metal \
 249         -framework JavaNativeFoundation \
 250         -framework JavaRuntimeSupport \
 251         -framework ApplicationServices \
 252         -framework AudioToolbox, \
 253     LIBS_windows := kernel32.lib user32.lib gdi32.lib winspool.lib \
 254         imm32.lib ole32.lib uuid.lib shell32.lib \
 255         comdlg32.lib winmm.lib comctl32.lib shlwapi.lib \
 256         delayimp.lib jvm.lib $(WIN_JAVA_LIB) advapi32.lib, \
 257     VERSIONINFO_RESOURCE := $(LIBAWT_VERSIONINFO_RESOURCE), \
 258     RC_FLAGS := $(RC_FLAGS) $(LIBAWT_RC_FLAGS) \
 259         -D &quot;JDK_FNAME=awt.dll&quot; \
 260         -D &quot;JDK_INTERNAL_NAME=awt&quot; \
 261         -D &quot;JDK_FTYPE=0x2L&quot;, \
 262 ))
 263 
 264 $(BUILD_LIBAWT): $(call FindLib, java.base, java)
 265 
 266 ifeq ($(call isTargetOs, macosx), true)
 267   $(BUILD_LIBAWT): $(BUILD_LIBMLIB_IMAGE)
 268 endif
 269 
 270 TARGETS += $(BUILD_LIBAWT)
 271 
 272 ################################################################################
 273 
 274 ifeq ($(call isTargetOs, windows macosx), false)
 275   ifeq ($(ENABLE_HEADLESS_ONLY), false)
 276 
 277     LIBAWT_XAWT_EXTRA_SRC := \
 278         common/awt \
 279         common/java2d \
 280         common/font \
 281         #
 282 
 283     LIBAWT_XAWT_EXCLUDES := medialib debug
 284 
 285     LIBAWT_XAWT_EXTRA_HEADER_DIRS := \
 286         $(LIBAWT_DEFAULT_HEADER_DIRS) \
 287         libawt_xawt/awt \
 288         include \
 289         common/awt/debug \
 290         common/awt/systemscale \
 291         common/font \
 292         common/java2d/opengl \
 293         common/java2d/x11 \
 294         #
 295 
 296     LIBAWT_XAWT_CFLAGS += -DXAWT -DXAWT_HACK \
 297         $(FONTCONFIG_CFLAGS) \
 298         $(CUPS_CFLAGS)
 299 
 300     ifeq ($(call isTargetOs, solaris), true)
 301       LIBAWT_XAWT_CFLAGS += -DFUNCPROTO=15
 302     endif
 303 
 304     ifeq ($(call isTargetOs, linux), true)
 305       ifeq ($(DISABLE_XRENDER), true)
 306         LIBAWT_XAWT_CFLAGS += -DDISABLE_XRENDER_BY_DEFAULT=true
 307       endif
 308     endif
 309 
 310     LIBAWT_XAWT_LIBS := $(LIBM) -lawt -lXext -lX11 -lXrender $(LIBDL) -lXtst -lXi -ljava -ljvm
 311 
 312     ifeq ($(call isTargetOs, linux), true)
 313       LIBAWT_XAWT_LIBS += -lpthread
 314     endif
 315 
 316     ifeq ($(TOOLCHAIN_TYPE), gcc)
 317       # Turn off all warnings for the following files since they contain warnings
 318       # that cannot be turned of individually.
 319       # redefining a macro
 320       BUILD_LIBAWT_XAWT_gtk2_interface.c_CFLAGS := -w
 321       # comparison between pointer and integer
 322       BUILD_LIBAWT_XAWT_awt_Font.c_CFLAGS := -w
 323       # initializing a declared &#39;extern&#39;
 324       BUILD_LIBAWT_XAWT_debug_mem.c_CFLAGS := -w
 325     endif
 326 
 327     $(eval $(call SetupJdkLibrary, BUILD_LIBAWT_XAWT, \
 328         NAME := awt_xawt, \
 329         EXTRA_SRC := $(LIBAWT_XAWT_EXTRA_SRC), \
 330         EXTRA_HEADER_DIRS := $(LIBAWT_XAWT_EXTRA_HEADER_DIRS), \
 331         EXCLUDES := $(LIBAWT_XAWT_EXCLUDES), \
 332         OPTIMIZATION := LOW, \
 333         CFLAGS := $(CFLAGS_JDKLIB) $(LIBAWT_XAWT_CFLAGS) \
 334             $(X_CFLAGS), \
 335         WARNINGS_AS_ERRORS_xlc := false, \
 336         DISABLED_WARNINGS_gcc := type-limits pointer-to-int-cast \
 337             unused-result maybe-uninitialized format \
 338             format-security int-to-pointer-cast parentheses \
 339             implicit-fallthrough undef unused-function, \
 340         DISABLED_WARNINGS_clang := parentheses format undef \
 341             logical-op-parentheses format-nonliteral int-conversion, \
 342         DISABLED_WARNINGS_solstudio := E_ASSIGNMENT_TYPE_MISMATCH \
 343              E_NON_CONST_INIT, \
 344         LDFLAGS := $(LDFLAGS_JDKLIB) \
 345             $(call SET_SHARED_LIBRARY_ORIGIN) \
 346             -L$(INSTALL_LIBRARIES_HERE), \
 347         LIBS :=  $(X_LIBS) $(LIBAWT_XAWT_LIBS), \
 348     ))
 349 
 350     $(BUILD_LIBAWT_XAWT): $(call FindLib, java.base, java)
 351 
 352     $(BUILD_LIBAWT_XAWT): $(BUILD_LIBAWT)
 353 
 354     TARGETS += $(BUILD_LIBAWT_XAWT)
 355 
 356   endif
 357 endif
 358 
 359 ################################################################################
 360 
 361 # The fast floor code loses precision.
 362 LCMS_CFLAGS=-DCMS_DONT_USE_FAST_FLOOR
 363 
 364 ifeq ($(USE_EXTERNAL_LCMS), true)
 365   # If we&#39;re using an external library, we&#39;ll just need the wrapper part.
 366   # By including it explicitly, all other files will be excluded.
 367   BUILD_LIBLCMS_INCLUDE_FILES := LCMS.c
 368   # If we&#39;re using an external library, we can&#39;t include our own SRC path
 369   # as includes, instead the system headers should be used.
 370   LIBLCMS_HEADERS_FROM_SRC := false
 371 else
 372   BUILD_LIBLCMS_INCLUDE_FILES :=
 373 endif
 374 
 375 $(eval $(call SetupJdkLibrary, BUILD_LIBLCMS, \
 376     NAME := lcms, \
 377     INCLUDE_FILES := $(BUILD_LIBLCMS_INCLUDE_FILES), \
 378     OPTIMIZATION := HIGHEST, \
 379     CFLAGS := $(CFLAGS_JDKLIB) \
 380         $(LCMS_CFLAGS), \
 381     CFLAGS_windows := -DCMS_IS_WINDOWS_, \
 382     EXTRA_HEADER_DIRS := \
 383         common/awt/debug \
 384         libawt/java2d, \
 385     HEADERS_FROM_SRC := $(LIBLCMS_HEADERS_FROM_SRC), \
 386     DISABLED_WARNINGS_gcc := format-nonliteral type-limits \
 387         misleading-indentation undef unused-function stringop-truncation, \
 388     DISABLED_WARNINGS_clang := tautological-compare format-nonliteral undef, \
 389     DISABLED_WARNINGS_solstudio := E_STATEMENT_NOT_REACHED, \
 390     DISABLED_WARNINGS_microsoft := 4819, \
 391     LDFLAGS := $(LDFLAGS_JDKLIB) \
 392         $(call SET_SHARED_LIBRARY_ORIGIN), \
 393     LDFLAGS_unix := -L$(INSTALL_LIBRARIES_HERE), \
 394     LIBS_unix := -lawt -ljvm -ljava $(LCMS_LIBS) $(LIBM), \
 395     LIBS_windows := $(WIN_AWT_LIB) $(WIN_JAVA_LIB), \
 396 ))
 397 
 398 TARGETS += $(BUILD_LIBLCMS)
 399 
 400 $(BUILD_LIBLCMS): $(BUILD_LIBAWT)
 401 
 402 ################################################################################
 403 
 404 # &quot;DISABLED_WARNINGS_gcc := clobbered&quot; rationale:
 405 # Suppress gcc warnings like &quot;variable might be clobbered by &#39;longjmp&#39;
 406 # or &#39;vfork&#39;&quot;: this warning indicates that some variable is placed to
 407 # a register by optimized compiler and it&#39;s value might be lost on longjmp().
 408 # Recommended way to avoid such warning is to declare the variable as
 409 # volatile to prevent the optimization. However, this approach does not
 410 # work because we have to declare all variables as volatile in result.
 411 
 412 ifeq ($(USE_EXTERNAL_LIBJPEG), true)
 413   LIBJPEG_LIBS := -ljpeg
 414   BUILD_LIBJAVAJPEG_INCLUDE_FILES := \
 415       imageioJPEG.c \
 416       jpegdecoder.c
 417   # If we&#39;re using an external library, we can&#39;t include our own SRC path
 418   # as includes, instead the system headers should be used.
 419   LIBJPEG_HEADERS_FROM_SRC := false
 420 else
 421   LIBJPEG_LIBS :=
 422   BUILD_LIBJAVAJPEG_INCLUDE_FILES :=
 423 endif
 424 
 425 $(eval $(call SetupJdkLibrary, BUILD_LIBJAVAJPEG, \
 426     NAME := javajpeg, \
 427     INCLUDE_FILES := $(BUILD_LIBJAVAJPEG_INCLUDE_FILES), \
 428     OPTIMIZATION := HIGHEST, \
 429     CFLAGS := $(CFLAGS_JDKLIB), \
 430     HEADERS_FROM_SRC := $(LIBJPEG_HEADERS_FROM_SRC), \
 431     DISABLED_WARNINGS_gcc := clobbered implicit-fallthrough shift-negative-value, \
 432     LDFLAGS := $(LDFLAGS_JDKLIB) \
 433         $(call SET_SHARED_LIBRARY_ORIGIN), \
 434     LIBS := $(LIBJPEG_LIBS) $(JDKLIB_LIBS), \
 435     LIBS_windows := $(WIN_JAVA_LIB) jvm.lib, \
 436 ))
 437 
 438 $(BUILD_LIBJAVAJPEG): $(call FindLib, java.base, java)
 439 
 440 TARGETS += $(BUILD_LIBJAVAJPEG)
 441 
 442 ################################################################################
 443 
 444 # Mac and Windows only use the native AWT lib, do not build libawt_headless
 445 ifeq ($(call isTargetOs, windows macosx), false)
 446 
 447   LIBAWT_HEADLESS_EXTRA_SRC := \
 448       common/font \
 449       common/java2d \
 450       $(TOPDIR)/src/$(MODULE)/$(OPENJDK_TARGET_OS_TYPE)/native/common/awt \
 451       #
 452 
 453   LIBAWT_HEADLESS_EXCLUDES := medialib
 454 
 455   LIBAWT_HEADLESS_EXTRA_HEADER_DIRS := \
 456       $(LIBAWT_DEFAULT_HEADER_DIRS) \
 457       common/awt/debug \
 458       common/font \
 459       common/java2d/opengl \
 460       #
 461 
 462   LIBAWT_HEADLESS_CFLAGS := $(CUPS_CFLAGS) $(FONTCONFIG_CFLAGS) $(X_CFLAGS) \
 463       -DHEADLESS=true
 464 
 465   $(eval $(call SetupJdkLibrary, BUILD_LIBAWT_HEADLESS, \
 466       NAME := awt_headless, \
 467       EXTRA_SRC := $(LIBAWT_HEADLESS_EXTRA_SRC), \
 468       EXCLUDES := $(LIBAWT_HEADLESS_EXCLUDES), \
 469       OPTIMIZATION := LOW, \
 470       CFLAGS := $(CFLAGS_JDKLIB) \
 471           $(LIBAWT_HEADLESS_CFLAGS), \
 472       EXTRA_HEADER_DIRS := $(LIBAWT_HEADLESS_EXTRA_HEADER_DIRS), \
 473       DISABLED_WARNINGS_gcc := unused-function, \
 474       DISABLED_WARNINGS_solstudio := E_EMPTY_TRANSLATION_UNIT, \
 475       LDFLAGS := $(LDFLAGS_JDKLIB) \
 476           $(call SET_SHARED_LIBRARY_ORIGIN), \
 477       LDFLAGS_unix := -L$(INSTALL_LIBRARIES_HERE), \
 478       LIBS_unix := -lawt -ljvm -ljava, \
 479       LIBS_linux := $(LIBM) $(LIBDL), \
 480       LIBS_solaris := $(LIBM) $(LIBDL) $(LIBCXX), \
 481   ))
 482 
 483   $(BUILD_LIBAWT_HEADLESS): $(BUILD_LIBAWT)
 484 
 485   TARGETS += $(BUILD_LIBAWT_HEADLESS)
 486 
 487 endif
 488 
 489 ################################################################################
 490 
 491 ifeq ($(FREETYPE_TO_USE), system)
 492   # For use by libfontmanager:
 493   LIBFREETYPE_CFLAGS := $(FREETYPE_CFLAGS)
 494   LIBFREETYPE_LIBS := $(FREETYPE_LIBS)
 495 else
 496   BUILD_LIBFREETYPE_HEADER_DIRS := $(TOPDIR)/src/$(MODULE)/share/native/libfreetype/include
 497   BUILD_LIBFREETYPE_CFLAGS := -DFT2_BUILD_LIBRARY $(EXPORT_ALL_SYMBOLS)
 498 
 499   # For use by libfontmanager:
 500   LIBFREETYPE_CFLAGS := -I$(BUILD_LIBFREETYPE_HEADER_DIRS)
 501   ifeq ($(call isTargetOs, windows), true)
 502     LIBFREETYPE_LIBS := $(SUPPORT_OUTPUTDIR)/native/$(MODULE)/libfreetype/freetype.lib
 503     # freetype now requires you to manually define this (see ftconfig.h)
 504     BUILD_LIBFREETYPE_CFLAGS += -DDLL_EXPORT
 505   else
 506     LIBFREETYPE_LIBS := -lfreetype
 507   endif
 508 
 509   $(eval $(call SetupJdkLibrary, BUILD_LIBFREETYPE, \
 510       NAME := freetype, \
 511       OPTIMIZATION := HIGHEST, \
 512       CFLAGS := $(CFLAGS_JDKLIB) \
 513           $(BUILD_LIBFREETYPE_CFLAGS), \
 514       EXTRA_HEADER_DIRS := $(BUILD_LIBFREETYPE_HEADER_DIRS), \
 515       DISABLED_WARNINGS_solstudio := \
 516          E_STATEMENT_NOT_REACHED \
 517          E_END_OF_LOOP_CODE_NOT_REACHED, \
 518       DISABLED_WARNINGS_microsoft := 4018 4267 4244 4312 4819, \
 519       DISABLED_WARNINGS_gcc := implicit-fallthrough cast-function-type bad-function-cast, \
 520       LDFLAGS := $(LDFLAGS_JDKLIB) \
 521           $(call SET_SHARED_LIBRARY_ORIGIN), \
 522   ))
 523 
 524   TARGETS += $(BUILD_LIBFREETYPE)
 525 endif
 526 
 527 ###########################################################################
 528 
 529 #### Begin harfbuzz configuration
 530 
 531 HARFBUZZ_CFLAGS := -DHAVE_OT -DHAVE_FALLBACK -DHAVE_UCDN -DHAVE_ROUND
 532 
 533 ifeq ($(call isTargetOs, windows), false)
 534   HARFBUZZ_CFLAGS += -DGETPAGESIZE -DHAVE_MPROTECT -DHAVE_PTHREAD \
 535                       -DHAVE_SYSCONF -DHAVE_SYS_MMAN_H -DHAVE_UNISTD_H \
 536                       -DHB_NO_PRAGMA_GCC_DIAGNOSTIC
 537 endif
 538 ifeq ($(call isTargetOs, linux macosx), true)
 539   HARFBUZZ_CFLAGS += -DHAVE_INTEL_ATOMIC_PRIMITIVES
 540 endif
 541 ifeq ($(call isTargetOs, solaris), true)
 542   HARFBUZZ_CFLAGS += -DHAVE_SOLARIS_ATOMIC_OPS
 543 endif
 544 ifeq ($(call isTargetOs, macosx), true)
 545   HARFBUZZ_CFLAGS += -DHAVE_CORETEXT
 546 endif
 547 ifeq ($(call isTargetOs, macosx), false)
 548   LIBFONTMANAGER_EXCLUDE_FILES += harfbuzz/hb-coretext.cc
 549 endif
 550 # hb-ft.cc is not presently needed, and requires freetype 2.4.2 or later.
 551 LIBFONTMANAGER_EXCLUDE_FILES += harfbuzz/hb-ft.cc
 552 
 553 LIBFONTMANAGER_CFLAGS += $(HARFBUZZ_CFLAGS)
 554 
 555 #### End harfbuzz configuration
 556 
 557 LIBFONTMANAGER_EXTRA_HEADER_DIRS := \
 558     libfontmanager/harfbuzz \
 559     libfontmanager/harfbuzz/hb-ucdn \
 560     common/awt \
 561     common/font \
 562     libawt/java2d \
 563     libawt/java2d/pipe \
 564     libawt/java2d/loops \
 565     #
 566 
 567 LIBFONTMANAGER_CFLAGS += $(LIBFREETYPE_CFLAGS)
 568 BUILD_LIBFONTMANAGER_FONTLIB += $(LIBFREETYPE_LIBS)
 569 
 570 LIBFONTMANAGER_OPTIMIZATION := HIGH
 571 
 572 ifeq ($(call isTargetOs, windows), true)
 573   LIBFONTMANAGER_EXCLUDE_FILES += X11FontScaler.c \
 574       X11TextRenderer.c
 575   LIBFONTMANAGER_OPTIMIZATION := HIGHEST
 576 else ifeq ($(call isTargetOs, macosx), true)
 577   LIBFONTMANAGER_EXCLUDE_FILES += X11FontScaler.c \
 578       X11TextRenderer.c \
 579       fontpath.c \
 580       lcdglyph.c
 581 else
 582   LIBFONTMANAGER_EXCLUDE_FILES += fontpath.c \
 583       lcdglyph.c
 584 endif
 585 
 586 LIBFONTMANAGER_CFLAGS += $(X_CFLAGS) -DLE_STANDALONE -DHEADLESS
 587 
 588 ifeq ($(TOOLCHAIN_TYPE), gcc)
 589   # Turn off all warnings for sunFont.c. This is needed because the specific warning
 590   # about discarding &#39;const&#39; qualifier cannot be turned off individually.
 591   BUILD_LIBFONTMANAGER_sunFont.c_CFLAGS := -w
 592 endif
 593 
 594 # LDFLAGS clarification:
 595 #   Filter relevant linker flags disallowing unresolved symbols as we cannot
 596 #   build-time decide to which library to link against (libawt_headless or
 597 #   libawt_xawt). See JDK-8196516 for details.
 598 $(eval $(call SetupJdkLibrary, BUILD_LIBFONTMANAGER, \
 599     NAME := fontmanager, \
 600     EXCLUDE_FILES := $(LIBFONTMANAGER_EXCLUDE_FILES) \
 601         AccelGlyphCache.c, \
 602     TOOLCHAIN := TOOLCHAIN_LINK_CXX, \
 603     CFLAGS := $(CFLAGS_JDKLIB) $(LIBFONTMANAGER_CFLAGS), \
 604     CXXFLAGS := $(CXXFLAGS_JDKLIB) $(LIBFONTMANAGER_CFLAGS), \
 605     OPTIMIZATION := $(LIBFONTMANAGER_OPTIMIZATION), \
 606     CFLAGS_windows = -DCC_NOEX, \
 607     EXTRA_HEADER_DIRS := $(LIBFONTMANAGER_EXTRA_HEADER_DIRS), \
 608     WARNINGS_AS_ERRORS_xlc := false, \
 609     DISABLED_WARNINGS_gcc := sign-compare int-to-pointer-cast \
 610         type-limits missing-field-initializers implicit-fallthrough \
 611         strict-aliasing undef unused-function, \
 612     DISABLED_WARNINGS_CXX_gcc := reorder delete-non-virtual-dtor strict-overflow \
 613         maybe-uninitialized class-memaccess, \
 614     DISABLED_WARNINGS_clang := unused-value incompatible-pointer-types \
 615         tautological-constant-out-of-range-compare int-to-pointer-cast \
 616         sign-compare undef missing-field-initializers, \
 617     DISABLED_WARNINGS_C_solstudio = \
 618         E_INTEGER_OVERFLOW_DETECTED \
 619         E_ARG_INCOMPATIBLE_WITH_ARG_L \
 620         E_ENUM_VAL_OVERFLOWS_INT_MAX, \
 621     DISABLED_WARNINGS_CXX_solstudio := \
 622         truncwarn wvarhidenmem wvarhidemem wbadlkginit identexpected \
 623         hidevf w_novirtualdescr arrowrtn2 refmemnoconstr_aggr unknownpragma \
 624         doubunder wunreachable, \
 625     DISABLED_WARNINGS_microsoft := 4267 4244 4018 4090 4996 4146 4334 4819 4101 4068 4805 4138, \
 626     LDFLAGS := $(subst -Xlinker -z -Xlinker defs,, \
 627         $(subst -Wl$(COMMA)-z$(COMMA)defs,,$(LDFLAGS_JDKLIB))) $(LDFLAGS_CXX_JDK) \
 628         $(call SET_SHARED_LIBRARY_ORIGIN), \
 629     LDFLAGS_unix := -L$(INSTALL_LIBRARIES_HERE), \
 630     LDFLAGS_aix := -Wl$(COMMA)-berok, \
 631     LIBS := $(BUILD_LIBFONTMANAGER_FONTLIB), \
 632     LIBS_unix := -lawt -ljava -ljvm $(LIBM) $(LIBCXX), \
 633     LIBS_macosx := -lawt_lwawt -framework CoreText -framework CoreFoundation \
 634         -framework CoreGraphics, \
 635     LIBS_windows := $(WIN_JAVA_LIB) advapi32.lib user32.lib gdi32.lib \
 636         $(WIN_AWT_LIB), \
 637 ))
 638 
 639 $(BUILD_LIBFONTMANAGER): $(BUILD_LIBAWT)
 640 
 641 ifeq ($(call isTargetOs, macosx), true)
 642   $(BUILD_LIBFONTMANAGER): $(call FindLib, $(MODULE), awt_lwawt)
 643 endif
 644 
 645 ifeq ($(FREETYPE_TO_USE), bundled)
 646   $(BUILD_LIBFONTMANAGER): $(BUILD_LIBFREETYPE)
 647 endif
 648 
 649 TARGETS += $(BUILD_LIBFONTMANAGER)
 650 
 651 ################################################################################
 652 
 653 ifeq ($(call isTargetOs, windows), true)
 654 
 655   LIBJAWT_CFLAGS := -EHsc -DUNICODE -D_UNICODE
 656 
 657   LIBJAWT_EXTRA_HEADER_DIRS := \
 658       include \
 659       common/awt/debug \
 660       libawt/awt/image/cvutils \
 661       libawt/java2d \
 662       libawt/java2d/windows \
 663       libawt/windows \
 664       java.base:include \
 665       java.base:libjava \
 666       #
 667 
 668   ifeq ($(call isTargetCpu, x86), true)
 669     KERNEL32_LIB := kernel32.lib
 670   endif
 671 
 672   $(eval $(call SetupJdkLibrary, BUILD_LIBJAWT, \
 673       NAME := jawt, \
 674       OPTIMIZATION := LOW, \
 675       CFLAGS := $(CXXFLAGS_JDKLIB) \
 676           $(LIBJAWT_CFLAGS), \
 677       EXTRA_HEADER_DIRS := $(LIBJAWT_EXTRA_HEADER_DIRS), \
 678       LDFLAGS := $(LDFLAGS_JDKLIB) $(LDFLAGS_CXX_JDK), \
 679       LIBS := $(JDKLIB_LIBS) $(KERNEL32_LIB) advapi32.lib $(WIN_AWT_LIB), \
 680   ))
 681 
 682   $(BUILD_LIBJAWT): $(BUILD_LIBAWT)
 683 
 684   $(eval $(call SetupCopyFiles, COPY_JAWT_LIB, \
 685       FILES := $(BUILD_LIBJAWT_IMPORT_LIBRARY), \
 686       DEST := $(SUPPORT_OUTPUTDIR)/modules_libs/$(MODULE), \
 687   ))
 688 
 689   $(COPY_JAWT_LIB): $(BUILD_LIBJAWT)
 690 
 691   TARGETS += $(COPY_JAWT_LIB)
 692 
 693 else # not windows
 694 
 695   ifeq ($(call isTargetOs, macosx), true)
 696     # libjawt on macosx do not use the unix code
 697     LIBJAWT_EXCLUDE_SRC_PATTERNS := /unix/
 698   endif
 699 
 700   ifeq ($(call isTargetOs, macosx), true)
 701     JAWT_LIBS := -lawt_lwawt
 702   else
 703     JAWT_LIBS :=
 704     ifeq ($(call isTargetOs, solaris), false)
 705       JAWT_LIBS += -lawt
 706     endif
 707     ifeq ($(ENABLE_HEADLESS_ONLY), false)
 708       JAWT_LIBS += -lawt_xawt
 709     else
 710       JAWT_LIBS += -lawt_headless
 711       ifeq ($(call isTargetOs, linux), true)
 712         JAWT_CFLAGS += -DHEADLESS
 713       endif
 714     endif
 715   endif
 716 
 717   $(eval $(call SetupJdkLibrary, BUILD_LIBJAWT, \
 718       NAME := jawt, \
 719       EXCLUDE_SRC_PATTERNS := $(LIBJAWT_EXCLUDE_SRC_PATTERNS), \
 720       INCLUDE_FILES := $(JAWT_FILES), \
 721       OPTIMIZATION := LOW, \
 722       CFLAGS := $(CFLAGS_JDKLIB) \
 723           $(JAWT_CFLAGS), \
 724       DISABLED_WARNINGS_clang := sign-compare, \
 725       EXTRA_HEADER_DIRS := \
 726           include \
 727           common/awt, \
 728       LDFLAGS := $(LDFLAGS_JDKLIB) \
 729           $(call SET_SHARED_LIBRARY_ORIGIN), \
 730       LDFLAGS_unix := -L$(INSTALL_LIBRARIES_HERE), \
 731       LDFLAGS_macosx := -Wl$(COMMA)-rpath$(COMMA)@loader_path, \
 732       LIBS_unix := $(JAWT_LIBS) $(JDKLIB_LIBS), \
 733       LIBS_solaris := $(X_LIBS) -lXrender, \
 734       LIBS_macosx := -framework Cocoa, \
 735   ))
 736 
 737   ifeq ($(ENABLE_HEADLESS_ONLY), false)
 738     $(BUILD_LIBJAWT): $(BUILD_LIBAWT_XAWT)
 739   else
 740     $(BUILD_LIBJAWT): $(call FindLib, $(MODULE), awt_headless)
 741   endif
 742 
 743   ifeq ($(call isTargetOs, macosx), true)
 744    $(BUILD_LIBJAWT): $(call FindLib, $(MODULE), awt_lwawt)
 745   endif
 746 
 747 endif
 748 
 749 TARGETS += $(BUILD_LIBJAWT)
 750 
 751 ################################################################################
 752 
 753 ifeq ($(ENABLE_HEADLESS_ONLY), false)
 754 
 755   LIBSPLASHSCREEN_EXTRA_SRC := \
 756       common/awt/systemscale \
 757       #
 758 
 759   ifeq ($(USE_EXTERNAL_LIBGIF), false)
 760     LIBSPLASHSCREEN_HEADER_DIRS += libsplashscreen/giflib
 761   else
 762     LIBSPLASHSCREEN_EXCLUDES := giflib
 763     GIFLIB_LIBS := -lgif
 764   endif
 765 
 766   ifeq ($(USE_EXTERNAL_LIBJPEG), false)
 767     # While the following ought to work, it will currently pull in the closed
 768     # additions to this library, and this was not done previously in the build.
 769     # LIBSPLASHSCREEN_EXTRA_SRC += libjavajpeg
 770     LIBSPLASHSCREEN_EXTRA_SRC += $(TOPDIR)/src/java.desktop/share/native/libjavajpeg
 771   else
 772     LIBJPEG_LIBS := -ljpeg
 773   endif
 774 
 775   ifeq ($(USE_EXTERNAL_LIBPNG), false)
 776     LIBSPLASHSCREEN_HEADER_DIRS += libsplashscreen/libpng
 777   else
 778     LIBSPLASHSCREEN_EXCLUDES += libpng
 779   endif
 780 
 781   ifeq ($(USE_EXTERNAL_LIBZ), false)
 782     LIBSPLASHSCREEN_EXTRA_SRC += java.base:libzip/zlib
 783   endif
 784 
 785   ifeq ($(call isTargetOs, macosx), true)
 786     # libsplashscreen on macosx do not use the unix code
 787     LIBSPLASHSCREEN_EXCLUDE_SRC_PATTERNS := /unix/
 788   endif
 789 
 790   LIBSPLASHSCREEN_CFLAGS += -DSPLASHSCREEN -DPNG_NO_MMX_CODE \
 791                             -DPNG_ARM_NEON_OPT=0 -DPNG_ARM_NEON_IMPLEMENTATION=0
 792 
 793   ifeq ($(call isTargetOs, linux), true)
 794     ifeq ($(call isTargetCpuArch, ppc), true)
 795       LIBSPLASHSCREEN_CFLAGS += -DPNG_POWERPC_VSX_OPT=0
 796     endif
 797   endif
 798 
 799   ifeq ($(call isTargetOs, macosx), true)
 800     LIBSPLASHSCREEN_CFLAGS += -DWITH_MACOSX
 801 
 802     BUILD_LIBSPLASHSCREEN_java_awt_SplashScreen.c_CFLAGS := -x objective-c -O0
 803     BUILD_LIBSPLASHSCREEN_splashscreen_gfx_impl.c_CFLAGS := -x objective-c -O0
 804     BUILD_LIBSPLASHSCREEN_splashscreen_gif.c_CFLAGS := -x objective-c -O0
 805     BUILD_LIBSPLASHSCREEN_splashscreen_impl.c_CFLAGS := -x objective-c -O0
 806     BUILD_LIBSPLASHSCREEN_splashscreen_jpeg.c_CFLAGS := -x objective-c -O0
 807     BUILD_LIBSPLASHSCREEN_splashscreen_png.c_CFLAGS := -x objective-c -O0
 808     BUILD_LIBSPLASHSCREEN_splashscreen_sys.m_CFLAGS := -O0
 809 
 810   else ifeq ($(call isTargetOs, windows), true)
 811     LIBSPLASHSCREEN_CFLAGS += -DWITH_WIN32
 812   else
 813     LIBSPLASHSCREEN_CFLAGS += -DWITH_X11 $(X_CFLAGS)
 814   endif
 815 
 816   LIBSPLASHSCREEN_LIBS :=
 817 
 818   ifeq ($(call isTargetOs, macosx), true)
 819     LIBSPLASHSCREEN_LIBS += \
 820         $(LIBM) -lpthread -liconv -losxapp \
 821         -framework ApplicationServices \
 822         -framework Foundation \
 823         -framework Security \
 824         -framework Cocoa \
 825         -framework Metal \
 826         -framework JavaNativeFoundation
 827   else ifeq ($(call isTargetOs, windows), true)
 828     LIBSPLASHSCREEN_LIBS += kernel32.lib user32.lib gdi32.lib delayimp.lib $(WIN_JAVA_LIB) jvm.lib
 829   else
 830     LIBSPLASHSCREEN_LIBS += $(X_LIBS) -lX11 -lXext $(LIBM) -lpthread -ldl
 831   endif
 832 
 833   LIBSPLASHSCREEN_HEADER_DIRS += \
 834       libosxapp \
 835       java.base:include \
 836       java.base:libjava \
 837       #
 838 
 839   $(eval $(call SetupJdkLibrary, BUILD_LIBSPLASHSCREEN, \
 840       NAME := splashscreen, \
 841       EXTRA_SRC := $(LIBSPLASHSCREEN_EXTRA_SRC), \
 842       EXCLUDE_SRC_PATTERNS := $(LIBSPLASHSCREEN_EXCLUDE_SRC_PATTERNS), \
 843       EXCLUDE_FILES := imageioJPEG.c jpegdecoder.c pngtest.c, \
 844       EXCLUDES := $(LIBSPLASHSCREEN_EXCLUDES), \
 845       OPTIMIZATION := LOW, \
 846       CFLAGS := $(CFLAGS_JDKLIB) $(LIBSPLASHSCREEN_CFLAGS) \
 847           $(GIFLIB_CFLAGS) $(LIBJPEG_CFLAGS) $(PNG_CFLAGS) $(LIBZ_CFLAGS), \
 848       EXTRA_HEADER_DIRS := $(LIBSPLASHSCREEN_HEADER_DIRS), \
 849       DISABLED_WARNINGS_gcc := sign-compare type-limits unused-result \
 850           maybe-uninitialized shift-negative-value implicit-fallthrough \
 851           unused-function, \
 852       DISABLED_WARNINGS_clang := incompatible-pointer-types sign-compare, \
 853       DISABLED_WARNINGS_solstudio := E_STATEMENT_NOT_REACHED, \
 854       DISABLED_WARNINGS_microsoft := 4018 4244 4267, \
 855       LDFLAGS := $(LDFLAGS_JDKLIB) \
 856           $(call SET_SHARED_LIBRARY_ORIGIN), \
 857       LDFLAGS_macosx := -L$(INSTALL_LIBRARIES_HERE), \
 858       LDFLAGS_windows := -delayload:user32.dll, \
 859       LIBS := $(JDKLIB_LIBS) $(LIBSPLASHSCREEN_LIBS) $(LIBZ_LIBS) \
 860           $(GIFLIB_LIBS) $(LIBJPEG_LIBS) $(PNG_LIBS), \
 861       LIBS_aix := -liconv, \
 862   ))
 863 
 864   TARGETS += $(BUILD_LIBSPLASHSCREEN)
 865 
 866   ifeq ($(call isTargetOs, macosx), true)
 867     $(BUILD_LIBSPLASHSCREEN): $(call FindLib, $(MODULE), osxapp)
 868   endif
 869 
 870 endif
 871 
 872 ################################################################################
 873 
 874 ifeq ($(call isTargetOs, macosx), true)
 875 
 876   LIBAWT_LWAWT_EXTRA_SRC := \
 877       $(TOPDIR)/src/$(MODULE)/unix/native/common/awt \
 878       $(TOPDIR)/src/$(MODULE)/share/native/common/font \
 879       $(TOPDIR)/src/$(MODULE)/share/native/common/java2d \
 880       #
 881 
 882   LIBAWT_LWAWT_EXTRA_HEADER_DIRS := \
 883       $(LIBAWT_DEFAULT_HEADER_DIRS) \
 884       libawt_lwawt/awt \
 885       libawt_lwawt/font \
 886       libawt_lwawt/java2d/opengl \
 887       libawt_lwawt/java2d/metal \
 888       include \
 889       common/awt/debug \
 890       common/java2d/opengl \
 891       libosxapp \
 892       #
 893 
 894   LIBAWT_LWAWT_CFLAGS := $(X_CFLAGS) $(X_LIBS)
 895 
 896   LIBAWT_LWAWT_EXFILES := fontpath.c awt_Font.c X11Color.c
 897   LIBAWT_LWAWT_EXCLUDES := $(TOPDIR)/src/$(MODULE)/unix/native/common/awt/medialib
 898 
 899   $(eval $(call SetupJdkLibrary, BUILD_LIBAWT_LWAWT, \
 900       NAME := awt_lwawt, \
 901       EXTRA_SRC := $(LIBAWT_LWAWT_EXTRA_SRC), \
 902       INCLUDE_FILES := $(LIBAWT_LWAWT_FILES), \
 903       EXCLUDE_FILES := $(LIBAWT_LWAWT_EXFILES), \
 904       EXCLUDES := $(LIBAWT_LWAWT_EXCLUDES), \
 905       OPTIMIZATION := LOW, \
 906       CFLAGS := $(CFLAGS_JDKLIB) \
 907           $(LIBAWT_LWAWT_CFLAGS), \
 908       EXTRA_HEADER_DIRS := $(LIBAWT_LWAWT_EXTRA_HEADER_DIRS), \
 909       DISABLED_WARNINGS_clang := incomplete-implementation enum-conversion \
 910           deprecated-declarations objc-method-access bitwise-op-parentheses \
 911           incompatible-pointer-types parentheses-equality extra-tokens \
 912           sign-compare semicolon-before-method-body format-nonliteral undef \
 913           pointer-arith, \
 914       LDFLAGS := $(LDFLAGS_JDKLIB) \
 915           $(call SET_SHARED_LIBRARY_ORIGIN) \
 916           -L$(INSTALL_LIBRARIES_HERE), \
 917       LIBS := -lawt -lmlib_image -losxapp -ljvm $(LIBM) \
 918           -framework Accelerate \
 919           -framework ApplicationServices \
 920           -framework AudioToolbox \
 921           -framework Carbon \
 922           -framework Cocoa \
 923           -framework Metal \
 924           -framework Security \
 925           -framework ExceptionHandling \
 926           -framework JavaNativeFoundation \
 927           -framework JavaRuntimeSupport \
 928           -framework OpenGL \
 929           -framework QuartzCore -ljava, \
 930   ))
 931 
 932   TARGETS += $(BUILD_LIBAWT_LWAWT)
 933 
 934   $(BUILD_LIBAWT_LWAWT): $(BUILD_LIBAWT)
 935 
 936   $(BUILD_LIBAWT_LWAWT): $(BUILD_LIBMLIB_IMAGE)
 937 
 938   $(BUILD_LIBAWT_LWAWT): $(call FindLib, $(MODULE), osxapp)
 939 
 940   $(BUILD_LIBAWT_LWAWT): $(call FindLib, java.base, java)
 941 
 942 endif
 943 
 944 ################################################################################
 945 
 946 ifeq ($(call isTargetOs, macosx), true)
 947   SHADERS_SRC := $(TOPDIR)/src/java.desktop/macosx/native/libawt_lwawt/awt/shaders.metal
 948   SHADERS_SUPPORT_DIR := $(SUPPORT_OUTPUTDIR)/native/java.desktop/libosxui
 949   SHADERS_AIR := $(SHADERS_SUPPORT_DIR)/shaders.air
 950   SHADERS_LIB := $(INSTALL_LIBRARIES_HERE)/shaders.metallib
 951 
 952   $(eval $(call SetupExecute, metal_shaders, \
 953       INFO := Running metal on $(notdir $(SHADERS_SRC)) (for libosxui.dylib), \
 954       DEPS := $(SHADERS_SRC), \
 955       OUTPUT_FILE := $(SHADERS_AIR), \
 956       SUPPORT_DIR := $(SHADERS_SUPPORT_DIR), \
 957       COMMAND := $(METAL) -c -std=osx-metal2.0 -o $(SHADERS_AIR) $(SHADERS_SRC), \
 958   ))
 959 
 960   $(eval $(call SetupExecute, metallib_shaders, \
 961       INFO := Running metallib on $(notdir $(SHADERS_AIR)) (for libosxui.dylib), \
 962       DEPS := $(SHADERS_AIR), \
 963       OUTPUT_FILE := $(SHADERS_LIB), \
 964       SUPPORT_DIR := $(SHADERS_SUPPORT_DIR), \
 965       COMMAND := $(METALLIB) -o $(SHADERS_LIB) $(SHADERS_AIR), \
 966   ))
 967 
 968   TARGETS += $(SHADERS_LIB)
 969 
 970   $(eval $(call SetupJdkLibrary, BUILD_LIBOSXUI, \
 971       NAME := osxui, \
 972       OPTIMIZATION := LOW, \
 973       CFLAGS := $(CFLAGS_JDKLIB), \
 974       EXTRA_HEADER_DIRS := \
 975           libawt_lwawt/awt \
 976           libosxapp, \
 977       DISABLED_WARNINGS_clang := deprecated-declarations sign-compare, \
 978       LDFLAGS := $(LDFLAGS_JDKLIB) \
 979           $(call SET_SHARED_LIBRARY_ORIGIN) \
 980           -Wl$(COMMA)-rpath$(COMMA)@loader_path \
 981           -L$(INSTALL_LIBRARIES_HERE), \
 982       LIBS := -lawt -losxapp -lawt_lwawt \
 983           -framework Cocoa \
 984           -framework Metal \
 985           -framework Carbon \
 986           -framework ApplicationServices \
 987           -framework JavaNativeFoundation \
 988           -framework JavaRuntimeSupport \
 989           -ljava -ljvm, \
 990   ))
 991 
 992   TARGETS += $(BUILD_LIBOSXUI)
 993   $(BUILD_LIBOSXUI): $(SHADERS_LIB)
 994 
 995   $(BUILD_LIBOSXUI): $(BUILD_LIBAWT)
 996 
 997   $(BUILD_LIBOSXUI): $(call FindLib, $(MODULE), osxapp)
 998 
 999   $(BUILD_LIBOSXUI): $(BUILD_LIBAWT_LWAWT)
1000 
1001 endif
1002 
1003 ################################################################################
1004 
1005 # Hook to include the corresponding custom file, if present.
1006 $(eval $(call IncludeCustomExtension, lib/Awt2dLibraries.gmk))
    </pre>
  </body>
</html>