<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/macosx/native/libawt_lwawt/java2d/metal/MTLPaints.m</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="MTLContext.m.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>src/java.desktop/macosx/native/libawt_lwawt/java2d/metal/MTLPaints.m</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
284 
285 // For the current paint mode:
286 // 1. Selects vertex+fragment shaders (and corresponding pipelineDesc) and set pipelineState
287 // 2. Set vertex and fragment buffers
288 - (void)setPipelineState:(id&lt;MTLRenderCommandEncoder&gt;)encoder
289                composite:(MTLComposite *)composite
290            isStencilUsed:(jboolean)isStencilUsed
291                isTexture:(jboolean)isTexture
292                     isAA:(jboolean)isAA
293                 srcFlags:(const SurfaceRasterFlags *)srcFlags
294                 dstFlags:(const SurfaceRasterFlags *)dstFlags
295     pipelineStateStorage:(MTLPipelineStatesStorage *)pipelineStateStorage
296 {
297     initTemplatePipelineDescriptors();
298 
299     const bool stencil = isStencilUsed == JNI_TRUE;
300 
301     id&lt;MTLRenderPipelineState&gt; pipelineState = nil;
302     if (isTexture) {
303 


















304         if (isAA) {
<span class="line-modified">305             pipelineState = [pipelineStateStorage getPipelineState:templateAATexturePipelineDesc</span>
<span class="line-modified">306                                                     vertexShaderId:@&quot;vert_txt&quot;</span>
<span class="line-modified">307                                                   fragmentShaderId:@&quot;aa_frag_txt&quot;</span>
<span class="line-modified">308                                                      compositeRule:[composite getRule]</span>
<span class="line-modified">309                                                               isAA:JNI_FALSE</span>
<span class="line-modified">310                                                           srcFlags:srcFlags</span>
<span class="line-modified">311                                                           dstFlags:dstFlags</span>
<span class="line-modified">312                                                      stencilNeeded:stencil];</span>


313         } else {
<span class="line-modified">314             pipelineState = [pipelineStateStorage getPipelineState:templateTexturePipelineDesc</span>
<span class="line-modified">315                                                     vertexShaderId:@&quot;vert_txt&quot;</span>
<span class="line-modified">316                                                   fragmentShaderId:@&quot;frag_txt&quot;</span>
<span class="line-modified">317                                                      compositeRule:[composite getRule]</span>
<span class="line-modified">318                                                               isAA:JNI_FALSE</span>
<span class="line-modified">319                                                           srcFlags:srcFlags</span>
<span class="line-modified">320                                                           dstFlags:dstFlags</span>
<span class="line-modified">321                                                      stencilNeeded:stencil];</span>

322         }

323         if (_paintState == sun_java2d_SunGraphics2D_PAINT_ALPHACOLOR) {
<span class="line-modified">324             struct TxtFrameUniforms uf = {RGBA_TO_V4(_color), 1, srcFlags-&gt;isOpaque, dstFlags-&gt;isOpaque };</span>
<span class="line-modified">325             [encoder setFragmentBytes:&amp;uf length:sizeof(uf) atIndex:FrameUniformBuffer];</span>
326         } else {
<span class="line-modified">327             struct TxtFrameUniforms uf = {RGBA_TO_V4(0), 0, srcFlags-&gt;isOpaque, dstFlags-&gt;isOpaque };</span>
<span class="line-modified">328             [encoder setFragmentBytes:&amp;uf length:sizeof(uf) atIndex:FrameUniformBuffer];</span>
329         }

330     } else {
331         if (_paintState == sun_java2d_SunGraphics2D_PAINT_ALPHACOLOR) {
332             pipelineState = [pipelineStateStorage getPipelineState:templateRenderPipelineDesc
333                                                     vertexShaderId:@&quot;vert_col&quot;
334                                                   fragmentShaderId:@&quot;frag_col&quot;
335                                                      compositeRule:[composite getRule]
336                                                               isAA:isAA
337                                                           srcFlags:srcFlags
338                                                           dstFlags:dstFlags
339                                                      stencilNeeded:stencil];
340 
341             struct FrameUniforms uf = {RGBA_TO_V4(_color)};
342             [encoder setVertexBytes:&amp;uf length:sizeof(uf) atIndex:FrameUniformBuffer];
343         } else if (_paintState == sun_java2d_SunGraphics2D_PAINT_GRADIENT) {
344             pipelineState = [pipelineStateStorage getPipelineState:templateRenderPipelineDesc
345                                                     vertexShaderId:@&quot;vert_grad&quot;
346                                                   fragmentShaderId:@&quot;frag_grad&quot;
347                                                      compositeRule:[composite getRule]
348                                                               isAA:isAA
349                                                           srcFlags:srcFlags
</pre>
</td>
<td>
<hr />
<pre>
284 
285 // For the current paint mode:
286 // 1. Selects vertex+fragment shaders (and corresponding pipelineDesc) and set pipelineState
287 // 2. Set vertex and fragment buffers
288 - (void)setPipelineState:(id&lt;MTLRenderCommandEncoder&gt;)encoder
289                composite:(MTLComposite *)composite
290            isStencilUsed:(jboolean)isStencilUsed
291                isTexture:(jboolean)isTexture
292                     isAA:(jboolean)isAA
293                 srcFlags:(const SurfaceRasterFlags *)srcFlags
294                 dstFlags:(const SurfaceRasterFlags *)dstFlags
295     pipelineStateStorage:(MTLPipelineStatesStorage *)pipelineStateStorage
296 {
297     initTemplatePipelineDescriptors();
298 
299     const bool stencil = isStencilUsed == JNI_TRUE;
300 
301     id&lt;MTLRenderPipelineState&gt; pipelineState = nil;
302     if (isTexture) {
303 
<span class="line-added">304       if (_paintState == sun_java2d_SunGraphics2D_PAINT_TEXTURE) {</span>
<span class="line-added">305         pipelineState = [pipelineStateStorage getPipelineState:templateTexturePipelineDesc</span>
<span class="line-added">306                                                 vertexShaderId:@&quot;vert_txt_tp&quot;</span>
<span class="line-added">307                                               fragmentShaderId:@&quot;frag_txt_tp&quot;</span>
<span class="line-added">308                                                  compositeRule:[composite getRule]</span>
<span class="line-added">309                                                           isAA:JNI_FALSE</span>
<span class="line-added">310                                                       srcFlags:srcFlags</span>
<span class="line-added">311                                                       dstFlags:dstFlags</span>
<span class="line-added">312                                                  stencilNeeded:stencil];</span>
<span class="line-added">313         [encoder setVertexBytes:&amp;_anchor length:sizeof(_anchor) atIndex:FrameUniformBuffer];</span>
<span class="line-added">314         [encoder setFragmentTexture:_paintTexture atIndex: 1];</span>
<span class="line-added">315 </span>
<span class="line-added">316         struct TxtFrameUniforms uf = {RGBA_TO_V4(0), 0, srcFlags-&gt;isOpaque,</span>
<span class="line-added">317                                       dstFlags-&gt;isOpaque};</span>
<span class="line-added">318         [encoder setFragmentBytes:&amp;uf length:sizeof(uf)</span>
<span class="line-added">319                           atIndex:FrameUniformBuffer];</span>
<span class="line-added">320 </span>
<span class="line-added">321       } else {</span>
322         if (isAA) {
<span class="line-modified">323           pipelineState = [pipelineStateStorage</span>
<span class="line-modified">324               getPipelineState:templateAATexturePipelineDesc</span>
<span class="line-modified">325                 vertexShaderId:@&quot;vert_txt&quot;</span>
<span class="line-modified">326               fragmentShaderId:@&quot;aa_frag_txt&quot;</span>
<span class="line-modified">327                  compositeRule:[composite getRule]</span>
<span class="line-modified">328                           isAA:JNI_FALSE</span>
<span class="line-modified">329                       srcFlags:srcFlags</span>
<span class="line-modified">330                       dstFlags:dstFlags</span>
<span class="line-added">331                  stencilNeeded:stencil];</span>
<span class="line-added">332 </span>
333         } else {
<span class="line-modified">334           pipelineState =</span>
<span class="line-modified">335               [pipelineStateStorage getPipelineState:templateTexturePipelineDesc</span>
<span class="line-modified">336                                       vertexShaderId:@&quot;vert_txt&quot;</span>
<span class="line-modified">337                                     fragmentShaderId:@&quot;frag_txt&quot;</span>
<span class="line-modified">338                                        compositeRule:[composite getRule]</span>
<span class="line-modified">339                                                 isAA:JNI_FALSE</span>
<span class="line-modified">340                                             srcFlags:srcFlags</span>
<span class="line-modified">341                                             dstFlags:dstFlags</span>
<span class="line-added">342                                        stencilNeeded:stencil];</span>
343         }
<span class="line-added">344 </span>
345         if (_paintState == sun_java2d_SunGraphics2D_PAINT_ALPHACOLOR) {
<span class="line-modified">346           struct TxtFrameUniforms uf = {RGBA_TO_V4(_color), 1, srcFlags-&gt;isOpaque, dstFlags-&gt;isOpaque };</span>
<span class="line-modified">347           [encoder setFragmentBytes:&amp;uf length:sizeof(uf) atIndex:FrameUniformBuffer];</span>
348         } else {
<span class="line-modified">349           struct TxtFrameUniforms uf = {RGBA_TO_V4(0), 0, srcFlags-&gt;isOpaque, dstFlags-&gt;isOpaque };</span>
<span class="line-modified">350           [encoder setFragmentBytes:&amp;uf length:sizeof(uf) atIndex:FrameUniformBuffer];</span>
351         }
<span class="line-added">352       }</span>
353     } else {
354         if (_paintState == sun_java2d_SunGraphics2D_PAINT_ALPHACOLOR) {
355             pipelineState = [pipelineStateStorage getPipelineState:templateRenderPipelineDesc
356                                                     vertexShaderId:@&quot;vert_col&quot;
357                                                   fragmentShaderId:@&quot;frag_col&quot;
358                                                      compositeRule:[composite getRule]
359                                                               isAA:isAA
360                                                           srcFlags:srcFlags
361                                                           dstFlags:dstFlags
362                                                      stencilNeeded:stencil];
363 
364             struct FrameUniforms uf = {RGBA_TO_V4(_color)};
365             [encoder setVertexBytes:&amp;uf length:sizeof(uf) atIndex:FrameUniformBuffer];
366         } else if (_paintState == sun_java2d_SunGraphics2D_PAINT_GRADIENT) {
367             pipelineState = [pipelineStateStorage getPipelineState:templateRenderPipelineDesc
368                                                     vertexShaderId:@&quot;vert_grad&quot;
369                                                   fragmentShaderId:@&quot;frag_grad&quot;
370                                                      compositeRule:[composite getRule]
371                                                               isAA:isAA
372                                                           srcFlags:srcFlags
</pre>
</td>
</tr>
</table>
<center><a href="MTLContext.m.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>