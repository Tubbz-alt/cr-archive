<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/macosx/native/libawt_lwawt/java2d/metal/MTLPaints.m</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="MTLContext.m.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>src/java.desktop/macosx/native/libawt_lwawt/java2d/metal/MTLPaints.m</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 299,36 ***</span>
      const bool stencil = isStencilUsed == JNI_TRUE;
  
      id&lt;MTLRenderPipelineState&gt; pipelineState = nil;
      if (isTexture) {
  
          if (isAA) {
<span class="line-modified">!             pipelineState = [pipelineStateStorage getPipelineState:templateAATexturePipelineDesc</span>
<span class="line-modified">!                                                     vertexShaderId:@&quot;vert_txt&quot;</span>
<span class="line-modified">!                                                   fragmentShaderId:@&quot;aa_frag_txt&quot;</span>
<span class="line-modified">!                                                      compositeRule:[composite getRule]</span>
<span class="line-modified">!                                                               isAA:JNI_FALSE</span>
<span class="line-modified">!                                                           srcFlags:srcFlags</span>
<span class="line-modified">!                                                           dstFlags:dstFlags</span>
<span class="line-modified">!                                                      stencilNeeded:stencil];</span>
          } else {
<span class="line-modified">!             pipelineState = [pipelineStateStorage getPipelineState:templateTexturePipelineDesc</span>
<span class="line-modified">!                                                     vertexShaderId:@&quot;vert_txt&quot;</span>
<span class="line-modified">!                                                   fragmentShaderId:@&quot;frag_txt&quot;</span>
<span class="line-modified">!                                                      compositeRule:[composite getRule]</span>
<span class="line-modified">!                                                               isAA:JNI_FALSE</span>
<span class="line-modified">!                                                           srcFlags:srcFlags</span>
<span class="line-modified">!                                                           dstFlags:dstFlags</span>
<span class="line-modified">!                                                      stencilNeeded:stencil];</span>
          }
          if (_paintState == sun_java2d_SunGraphics2D_PAINT_ALPHACOLOR) {
<span class="line-modified">!             struct TxtFrameUniforms uf = {RGBA_TO_V4(_color), 1, srcFlags-&gt;isOpaque, dstFlags-&gt;isOpaque };</span>
<span class="line-modified">!             [encoder setFragmentBytes:&amp;uf length:sizeof(uf) atIndex:FrameUniformBuffer];</span>
          } else {
<span class="line-modified">!             struct TxtFrameUniforms uf = {RGBA_TO_V4(0), 0, srcFlags-&gt;isOpaque, dstFlags-&gt;isOpaque };</span>
<span class="line-modified">!             [encoder setFragmentBytes:&amp;uf length:sizeof(uf) atIndex:FrameUniformBuffer];</span>
          }
      } else {
          if (_paintState == sun_java2d_SunGraphics2D_PAINT_ALPHACOLOR) {
              pipelineState = [pipelineStateStorage getPipelineState:templateRenderPipelineDesc
                                                      vertexShaderId:@&quot;vert_col&quot;
                                                    fragmentShaderId:@&quot;frag_col&quot;
<span class="line-new-header">--- 299,59 ---</span>
      const bool stencil = isStencilUsed == JNI_TRUE;
  
      id&lt;MTLRenderPipelineState&gt; pipelineState = nil;
      if (isTexture) {
  
<span class="line-added">+       if (_paintState == sun_java2d_SunGraphics2D_PAINT_TEXTURE) {</span>
<span class="line-added">+         pipelineState = [pipelineStateStorage getPipelineState:templateTexturePipelineDesc</span>
<span class="line-added">+                                                 vertexShaderId:@&quot;vert_txt_tp&quot;</span>
<span class="line-added">+                                               fragmentShaderId:@&quot;frag_txt_tp&quot;</span>
<span class="line-added">+                                                  compositeRule:[composite getRule]</span>
<span class="line-added">+                                                           isAA:JNI_FALSE</span>
<span class="line-added">+                                                       srcFlags:srcFlags</span>
<span class="line-added">+                                                       dstFlags:dstFlags</span>
<span class="line-added">+                                                  stencilNeeded:stencil];</span>
<span class="line-added">+         [encoder setVertexBytes:&amp;_anchor length:sizeof(_anchor) atIndex:FrameUniformBuffer];</span>
<span class="line-added">+         [encoder setFragmentTexture:_paintTexture atIndex: 1];</span>
<span class="line-added">+ </span>
<span class="line-added">+         struct TxtFrameUniforms uf = {RGBA_TO_V4(0), 0, srcFlags-&gt;isOpaque,</span>
<span class="line-added">+                                       dstFlags-&gt;isOpaque};</span>
<span class="line-added">+         [encoder setFragmentBytes:&amp;uf length:sizeof(uf)</span>
<span class="line-added">+                           atIndex:FrameUniformBuffer];</span>
<span class="line-added">+ </span>
<span class="line-added">+       } else {</span>
          if (isAA) {
<span class="line-modified">!           pipelineState = [pipelineStateStorage</span>
<span class="line-modified">!               getPipelineState:templateAATexturePipelineDesc</span>
<span class="line-modified">!                 vertexShaderId:@&quot;vert_txt&quot;</span>
<span class="line-modified">!               fragmentShaderId:@&quot;aa_frag_txt&quot;</span>
<span class="line-modified">!                  compositeRule:[composite getRule]</span>
<span class="line-modified">!                           isAA:JNI_FALSE</span>
<span class="line-modified">!                       srcFlags:srcFlags</span>
<span class="line-modified">!                       dstFlags:dstFlags</span>
<span class="line-added">+                  stencilNeeded:stencil];</span>
<span class="line-added">+ </span>
          } else {
<span class="line-modified">!           pipelineState =</span>
<span class="line-modified">!               [pipelineStateStorage getPipelineState:templateTexturePipelineDesc</span>
<span class="line-modified">!                                       vertexShaderId:@&quot;vert_txt&quot;</span>
<span class="line-modified">!                                     fragmentShaderId:@&quot;frag_txt&quot;</span>
<span class="line-modified">!                                        compositeRule:[composite getRule]</span>
<span class="line-modified">!                                                 isAA:JNI_FALSE</span>
<span class="line-modified">!                                             srcFlags:srcFlags</span>
<span class="line-modified">!                                             dstFlags:dstFlags</span>
<span class="line-added">+                                        stencilNeeded:stencil];</span>
          }
<span class="line-added">+ </span>
          if (_paintState == sun_java2d_SunGraphics2D_PAINT_ALPHACOLOR) {
<span class="line-modified">!           struct TxtFrameUniforms uf = {RGBA_TO_V4(_color), 1, srcFlags-&gt;isOpaque, dstFlags-&gt;isOpaque };</span>
<span class="line-modified">!           [encoder setFragmentBytes:&amp;uf length:sizeof(uf) atIndex:FrameUniformBuffer];</span>
          } else {
<span class="line-modified">!           struct TxtFrameUniforms uf = {RGBA_TO_V4(0), 0, srcFlags-&gt;isOpaque, dstFlags-&gt;isOpaque };</span>
<span class="line-modified">!           [encoder setFragmentBytes:&amp;uf length:sizeof(uf) atIndex:FrameUniformBuffer];</span>
          }
<span class="line-added">+       }</span>
      } else {
          if (_paintState == sun_java2d_SunGraphics2D_PAINT_ALPHACOLOR) {
              pipelineState = [pipelineStateStorage getPipelineState:templateRenderPipelineDesc
                                                      vertexShaderId:@&quot;vert_col&quot;
                                                    fragmentShaderId:@&quot;frag_col&quot;
</pre>
<center><a href="MTLContext.m.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>