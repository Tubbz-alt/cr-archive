<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/demo/share/java2d/RenderPerfTest/src/renderperf/RenderPerfTest.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>src/demo/share/java2d/RenderPerfTest/src/renderperf/RenderPerfTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package renderperf;
 27 
 28 
 29 import javax.imageio.ImageIO;
 30 import javax.swing.*;
 31 import java.awt.*;
 32 import java.awt.event.WindowAdapter;
 33 import java.awt.event.WindowEvent;
 34 import java.awt.geom.AffineTransform;

 35 import java.awt.geom.Point2D;
 36 import java.awt.geom.QuadCurve2D;
 37 import java.awt.image.BufferedImage;
 38 import java.io.IOException;
 39 import java.lang.reflect.InvocationTargetException;
 40 import java.lang.reflect.Method;
 41 import java.util.HashSet;
 42 import java.util.Objects;
 43 import java.util.concurrent.CountDownLatch;
 44 import java.util.concurrent.atomic.AtomicBoolean;
 45 
 46 
 47 public class RenderPerfTest {
 48     private static HashSet&lt;String&gt; ignoredTests = new HashSet&lt;&gt;();
 49 
 50     static {
 51             ignoredTests.add(&quot;testWhiteTextBubblesNoAA&quot;);
 52             ignoredTests.add(&quot;testWhiteTextBubblesLCD&quot;);
 53             ignoredTests.add(&quot;testWhiteTextBubblesGray&quot;);
 54             ignoredTests.add(&quot;testLinGradOvalRotBubblesAA&quot;);
</pre>
<hr />
<pre>
177         Color[] colors;
178         float r;
179 
180         FlatParticleRenderer(int n, float r) {
181             colors = new Color[n];
182             this.r = r;
183             for (int i = 0; i &lt; n; i++) {
184                 colors[i] = new Color((float) Math.random(),
185                         (float) Math.random(), (float) Math.random());
186             }
187         }
188 
189         @Override
190         public void render(Graphics2D g2d, int id, float[] x, float[] y, float[] vx, float[] vy) {
191             g2d.setColor(colors[id % colors.length]);
192             g2d.fillOval((int)(x[id] - r), (int)(y[id] - r), (int)(2*r), (int)(2*r));
193         }
194 
195     }
196 
















197     static class WhiteTextParticleRenderer implements ParticleRenderer {
198         float r;
199 
200         WhiteTextParticleRenderer(float r) {
201             this.r = r;
202         }
203 
204         void setPaint(Graphics2D g2d, int id) {
205             g2d.setColor(Color.WHITE);
206         }
207 
208         @Override
209         public void render(Graphics2D g2d, int id, float[] x, float[] y, float[] vx, float[] vy) {
210             setPaint(g2d, id);
211             g2d.drawString(&quot;The quick brown fox jumps over the lazy dog&quot;,
212                     (int)(x[id] - r), (int)(y[id] - r));
213             g2d.drawString(&quot;The quick brown fox jumps over the lazy dog&quot;,
214                     (int)(x[id] - r), (int)y[id]);
215             g2d.drawString(&quot;The quick brown fox jumps over the lazy dog&quot;,
216                     (int)(x[id] - r), (int)(y[id] + r));
</pre>
<hr />
<pre>
305                     new LinearGradientPaint(start, end, dist, cls);
306             g2d.setPaint(p);
307         }
308     }
309 
310     static class FlatBoxParticleRenderer extends FlatParticleRenderer {
311 
312 
313         FlatBoxParticleRenderer(int n, float r) {
314             super(n, r);
315         }
316         @Override
317         public void render(Graphics2D g2d, int id, float[] x, float[] y, float[] vx, float[] vy) {
318             g2d.setColor(colors[id % colors.length]);
319             g2d.fillRect((int)(x[id] - r), (int)(y[id] - r), (int)(2*r), (int)(2*r));
320 
321         }
322 
323     }
324 
















325     static class ImgParticleRenderer extends FlatParticleRenderer {
326         BufferedImage dukeImg;
327 
328         ImgParticleRenderer(int n, float r) {
329             super(n, r);
330             try {
331                 dukeImg = ImageIO.read(
332                         Objects.requireNonNull(
333                                 RenderPerfTest.class.getClassLoader().getResourceAsStream(
334                                         &quot;renderperf/images/duke.png&quot;)));
335             } catch (IOException e) {
336                 throw new RuntimeException(e);
337             }
338         }
339 
340         @Override
341         public void render(Graphics2D g2d, int id, float[] x, float[] y, float[] vx, float[] vy) {
342             g2d.setColor(colors[id % colors.length]);
343             g2d.drawImage(dukeImg, (int)(x[id] - r), (int)(y[id] - r), (int)(2*r), (int)(2*r), null);
344         }
</pre>
<hr />
<pre>
560                 fps = 0;
561             }
562 
563             return this;
564         }
565 
566         private void report() {
567             System.err.println(name + &quot; : &quot; + String.format(&quot;%.2f FPS&quot;, fps));
568         }
569 
570         private boolean isAlmostEqual(Color c1, Color c2) {
571             return Math.abs(c1.getRed() - c2.getRed()) &lt; COLOR_TOLERANCE ||
572                     Math.abs(c1.getGreen() - c2.getGreen()) &lt; COLOR_TOLERANCE ||
573                     Math.abs(c1.getBlue() - c2.getBlue()) &lt; COLOR_TOLERANCE;
574 
575         }
576     }
577 
578     private static final Particles balls = new Particles(N, R, BW, BH, WIDTH, HEIGHT);
579     private static final ParticleRenderer flatRenderer = new FlatParticleRenderer(N, R);

580     private static final ParticleRenderer flatOvalRotRenderer = new FlatOvalRotParticleRenderer(N, R);
581     private static final ParticleRenderer flatBoxRenderer = new FlatBoxParticleRenderer(N, R);

582     private static final ParticleRenderer flatBoxRotRenderer = new FlatBoxRotParticleRenderer(N, R);
583     private static final ParticleRenderer linGradOvalRotRenderer = new LinGradOvalRotParticleRenderer(N, R);
584     private static final ParticleRenderer wiredRenderer = new WiredParticleRenderer(N, R);
585     private static final ParticleRenderer wiredBoxRenderer = new WiredBoxParticleRenderer(N, R);
586     private static final ParticleRenderer segRenderer = new SegParticleRenderer(N, R);
587     private static final ParticleRenderer flatQuadRenderer = new FlatQuadParticleRenderer(N, R);
588     private static final ParticleRenderer wiredQuadRenderer = new WiredQuadParticleRenderer(N, R);
589     private static final ParticleRenderer imgRenderer = new ImgParticleRenderer(N, R);
590     private static final ParticleRenderer textRenderer = new TextParticleRenderer(N, R);
591     private static final ParticleRenderer largeTextRenderer = new LargeTextParticleRenderer(N, R);
592     private static final ParticleRenderer whiteTextRenderer = new WhiteTextParticleRenderer(R);
593 
594     private static final Configurable AA = (Graphics2D g2d) -&gt;
595         g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING,
596             RenderingHints.VALUE_ANTIALIAS_ON);
597 
598     private static final Configurable TextLCD = (Graphics2D g2d) -&gt;
599         g2d.setRenderingHint(RenderingHints.KEY_TEXT_ANTIALIASING,
600                 RenderingHints.VALUE_TEXT_ANTIALIAS_LCD_HRGB);
601 
602     private static final Configurable TextAA = (Graphics2D g2d) -&gt;
603         g2d.setRenderingHint(RenderingHints.KEY_TEXT_ANTIALIASING,
604                 RenderingHints.VALUE_TEXT_ANTIALIAS_ON);
605 
606     public void testFlatBubbles() throws Exception {
607         (new PerfMeter(&quot;FlatOval&quot;)).exec(createPR(flatRenderer)).report();
608     }
609 
610     public void testFlatBubblesAA() throws Exception {
611         (new PerfMeter(&quot;FlatOvalAA&quot;)).exec(createPR(flatRenderer).configure(AA)).report();
612     }
613 








614     public void testFlatBoxBubbles() throws Exception {
615         (new PerfMeter(&quot;FlatBox&quot;)).exec(createPR(flatBoxRenderer)).report();
616     }
617 
618     public void testFlatBoxBubblesAA() throws Exception {
619         (new PerfMeter(&quot;FlatBoxAA&quot;)).exec(createPR(flatBoxRenderer).configure(AA)).report();
620     }
621 








622     public void testImgBubbles() throws Exception {
623         (new PerfMeter(&quot;Image&quot;)).exec(createPR(imgRenderer)).report();
624     }
625 
626     public void testImgBubblesAA() throws Exception {
627         (new PerfMeter(&quot;ImageAA&quot;)).exec(createPR(imgRenderer).configure(AA)).report();
628     }
629 
630     public void testFlatBoxRotBubbles() throws Exception {
631         (new PerfMeter(&quot;RotatedBox&quot;)).exec(createPR(flatBoxRotRenderer)).report();
632     }
633 
634     public void testFlatBoxRotBubblesAA() throws Exception {
635         (new PerfMeter(&quot;RotatedBoxAA&quot;)).exec(createPR(flatBoxRotRenderer).configure(AA)).report();
636     }
637 
638     public void testFlatOvalRotBubbles() throws Exception {
639         (new PerfMeter(&quot;RotatedOval&quot;)).exec(createPR(flatOvalRotRenderer)).report();
640     }
641 
</pre>
</td>
<td>
<hr />
<pre>
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package renderperf;
 27 
 28 
 29 import javax.imageio.ImageIO;
 30 import javax.swing.*;
 31 import java.awt.*;
 32 import java.awt.event.WindowAdapter;
 33 import java.awt.event.WindowEvent;
 34 import java.awt.geom.AffineTransform;
<span class="line-added"> 35 import java.awt.geom.Ellipse2D;</span>
 36 import java.awt.geom.Point2D;
 37 import java.awt.geom.QuadCurve2D;
 38 import java.awt.image.BufferedImage;
 39 import java.io.IOException;
 40 import java.lang.reflect.InvocationTargetException;
 41 import java.lang.reflect.Method;
 42 import java.util.HashSet;
 43 import java.util.Objects;
 44 import java.util.concurrent.CountDownLatch;
 45 import java.util.concurrent.atomic.AtomicBoolean;
 46 
 47 
 48 public class RenderPerfTest {
 49     private static HashSet&lt;String&gt; ignoredTests = new HashSet&lt;&gt;();
 50 
 51     static {
 52             ignoredTests.add(&quot;testWhiteTextBubblesNoAA&quot;);
 53             ignoredTests.add(&quot;testWhiteTextBubblesLCD&quot;);
 54             ignoredTests.add(&quot;testWhiteTextBubblesGray&quot;);
 55             ignoredTests.add(&quot;testLinGradOvalRotBubblesAA&quot;);
</pre>
<hr />
<pre>
178         Color[] colors;
179         float r;
180 
181         FlatParticleRenderer(int n, float r) {
182             colors = new Color[n];
183             this.r = r;
184             for (int i = 0; i &lt; n; i++) {
185                 colors[i] = new Color((float) Math.random(),
186                         (float) Math.random(), (float) Math.random());
187             }
188         }
189 
190         @Override
191         public void render(Graphics2D g2d, int id, float[] x, float[] y, float[] vx, float[] vy) {
192             g2d.setColor(colors[id % colors.length]);
193             g2d.fillOval((int)(x[id] - r), (int)(y[id] - r), (int)(2*r), (int)(2*r));
194         }
195 
196     }
197 
<span class="line-added">198     static class ClipFlatParticleRenderer extends FlatParticleRenderer {</span>
<span class="line-added">199 </span>
<span class="line-added">200         ClipFlatParticleRenderer(int n, float r) {</span>
<span class="line-added">201             super(n, r);</span>
<span class="line-added">202         }</span>
<span class="line-added">203 </span>
<span class="line-added">204         @Override</span>
<span class="line-added">205         public void render(Graphics2D g2d, int id, float[] x, float[] y, float[] vx, float[] vy) {</span>
<span class="line-added">206             if ((id % 5) == 0) {</span>
<span class="line-added">207                 g2d.setColor(colors[id % colors.length]);</span>
<span class="line-added">208                 g2d.setClip(new Ellipse2D.Double((int) (x[id] - r), (int) (y[id] - r), (int) (2 * r), (int) (2 * r)));</span>
<span class="line-added">209                 g2d.fillRect((int) (x[id] - 2 * r), (int) (y[id] - 2 * r), (int) (4 * r), (int) (4 * r));</span>
<span class="line-added">210             }</span>
<span class="line-added">211         }</span>
<span class="line-added">212 </span>
<span class="line-added">213     }</span>
214     static class WhiteTextParticleRenderer implements ParticleRenderer {
215         float r;
216 
217         WhiteTextParticleRenderer(float r) {
218             this.r = r;
219         }
220 
221         void setPaint(Graphics2D g2d, int id) {
222             g2d.setColor(Color.WHITE);
223         }
224 
225         @Override
226         public void render(Graphics2D g2d, int id, float[] x, float[] y, float[] vx, float[] vy) {
227             setPaint(g2d, id);
228             g2d.drawString(&quot;The quick brown fox jumps over the lazy dog&quot;,
229                     (int)(x[id] - r), (int)(y[id] - r));
230             g2d.drawString(&quot;The quick brown fox jumps over the lazy dog&quot;,
231                     (int)(x[id] - r), (int)y[id]);
232             g2d.drawString(&quot;The quick brown fox jumps over the lazy dog&quot;,
233                     (int)(x[id] - r), (int)(y[id] + r));
</pre>
<hr />
<pre>
322                     new LinearGradientPaint(start, end, dist, cls);
323             g2d.setPaint(p);
324         }
325     }
326 
327     static class FlatBoxParticleRenderer extends FlatParticleRenderer {
328 
329 
330         FlatBoxParticleRenderer(int n, float r) {
331             super(n, r);
332         }
333         @Override
334         public void render(Graphics2D g2d, int id, float[] x, float[] y, float[] vx, float[] vy) {
335             g2d.setColor(colors[id % colors.length]);
336             g2d.fillRect((int)(x[id] - r), (int)(y[id] - r), (int)(2*r), (int)(2*r));
337 
338         }
339 
340     }
341 
<span class="line-added">342     static class ClipFlatBoxParticleRenderer extends FlatParticleRenderer {</span>
<span class="line-added">343 </span>
<span class="line-added">344 </span>
<span class="line-added">345         ClipFlatBoxParticleRenderer(int n, float r) {</span>
<span class="line-added">346             super(n, r);</span>
<span class="line-added">347         }</span>
<span class="line-added">348         @Override</span>
<span class="line-added">349         public void render(Graphics2D g2d, int id, float[] x, float[] y, float[] vx, float[] vy) {</span>
<span class="line-added">350             if ((id % 5) == 0) {</span>
<span class="line-added">351                 g2d.setColor(colors[id % colors.length]);</span>
<span class="line-added">352                 g2d.setClip((int) (x[id] - r), (int) (y[id] - r), (int) (2 * r), (int) (2 * r));</span>
<span class="line-added">353                 g2d.fillRect((int) (x[id] - 2 * r), (int) (y[id] - 2 * r), (int) (4 * r), (int) (4 * r));</span>
<span class="line-added">354             }</span>
<span class="line-added">355         }</span>
<span class="line-added">356     }</span>
<span class="line-added">357 </span>
358     static class ImgParticleRenderer extends FlatParticleRenderer {
359         BufferedImage dukeImg;
360 
361         ImgParticleRenderer(int n, float r) {
362             super(n, r);
363             try {
364                 dukeImg = ImageIO.read(
365                         Objects.requireNonNull(
366                                 RenderPerfTest.class.getClassLoader().getResourceAsStream(
367                                         &quot;renderperf/images/duke.png&quot;)));
368             } catch (IOException e) {
369                 throw new RuntimeException(e);
370             }
371         }
372 
373         @Override
374         public void render(Graphics2D g2d, int id, float[] x, float[] y, float[] vx, float[] vy) {
375             g2d.setColor(colors[id % colors.length]);
376             g2d.drawImage(dukeImg, (int)(x[id] - r), (int)(y[id] - r), (int)(2*r), (int)(2*r), null);
377         }
</pre>
<hr />
<pre>
593                 fps = 0;
594             }
595 
596             return this;
597         }
598 
599         private void report() {
600             System.err.println(name + &quot; : &quot; + String.format(&quot;%.2f FPS&quot;, fps));
601         }
602 
603         private boolean isAlmostEqual(Color c1, Color c2) {
604             return Math.abs(c1.getRed() - c2.getRed()) &lt; COLOR_TOLERANCE ||
605                     Math.abs(c1.getGreen() - c2.getGreen()) &lt; COLOR_TOLERANCE ||
606                     Math.abs(c1.getBlue() - c2.getBlue()) &lt; COLOR_TOLERANCE;
607 
608         }
609     }
610 
611     private static final Particles balls = new Particles(N, R, BW, BH, WIDTH, HEIGHT);
612     private static final ParticleRenderer flatRenderer = new FlatParticleRenderer(N, R);
<span class="line-added">613     private static final ParticleRenderer clipFlatRenderer = new ClipFlatParticleRenderer(N, R);</span>
614     private static final ParticleRenderer flatOvalRotRenderer = new FlatOvalRotParticleRenderer(N, R);
615     private static final ParticleRenderer flatBoxRenderer = new FlatBoxParticleRenderer(N, R);
<span class="line-added">616     private static final ParticleRenderer clipFlatBoxParticleRenderer = new ClipFlatBoxParticleRenderer(N, R);</span>
617     private static final ParticleRenderer flatBoxRotRenderer = new FlatBoxRotParticleRenderer(N, R);
618     private static final ParticleRenderer linGradOvalRotRenderer = new LinGradOvalRotParticleRenderer(N, R);
619     private static final ParticleRenderer wiredRenderer = new WiredParticleRenderer(N, R);
620     private static final ParticleRenderer wiredBoxRenderer = new WiredBoxParticleRenderer(N, R);
621     private static final ParticleRenderer segRenderer = new SegParticleRenderer(N, R);
622     private static final ParticleRenderer flatQuadRenderer = new FlatQuadParticleRenderer(N, R);
623     private static final ParticleRenderer wiredQuadRenderer = new WiredQuadParticleRenderer(N, R);
624     private static final ParticleRenderer imgRenderer = new ImgParticleRenderer(N, R);
625     private static final ParticleRenderer textRenderer = new TextParticleRenderer(N, R);
626     private static final ParticleRenderer largeTextRenderer = new LargeTextParticleRenderer(N, R);
627     private static final ParticleRenderer whiteTextRenderer = new WhiteTextParticleRenderer(R);
628 
629     private static final Configurable AA = (Graphics2D g2d) -&gt;
630         g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING,
631             RenderingHints.VALUE_ANTIALIAS_ON);
632 
633     private static final Configurable TextLCD = (Graphics2D g2d) -&gt;
634         g2d.setRenderingHint(RenderingHints.KEY_TEXT_ANTIALIASING,
635                 RenderingHints.VALUE_TEXT_ANTIALIAS_LCD_HRGB);
636 
637     private static final Configurable TextAA = (Graphics2D g2d) -&gt;
638         g2d.setRenderingHint(RenderingHints.KEY_TEXT_ANTIALIASING,
639                 RenderingHints.VALUE_TEXT_ANTIALIAS_ON);
640 
641     public void testFlatBubbles() throws Exception {
642         (new PerfMeter(&quot;FlatOval&quot;)).exec(createPR(flatRenderer)).report();
643     }
644 
645     public void testFlatBubblesAA() throws Exception {
646         (new PerfMeter(&quot;FlatOvalAA&quot;)).exec(createPR(flatRenderer).configure(AA)).report();
647     }
648 
<span class="line-added">649     public void testClipFlatBubbles() throws Exception {</span>
<span class="line-added">650         (new PerfMeter(&quot;ClipFlatOval&quot;)).exec(createPR(clipFlatRenderer)).report();</span>
<span class="line-added">651     }</span>
<span class="line-added">652 </span>
<span class="line-added">653     public void testClipFlatBubblesAA() throws Exception {</span>
<span class="line-added">654         (new PerfMeter(&quot;ClipFlatOvalAA&quot;)).exec(createPR(clipFlatRenderer).configure(AA)).report();</span>
<span class="line-added">655     }</span>
<span class="line-added">656 </span>
657     public void testFlatBoxBubbles() throws Exception {
658         (new PerfMeter(&quot;FlatBox&quot;)).exec(createPR(flatBoxRenderer)).report();
659     }
660 
661     public void testFlatBoxBubblesAA() throws Exception {
662         (new PerfMeter(&quot;FlatBoxAA&quot;)).exec(createPR(flatBoxRenderer).configure(AA)).report();
663     }
664 
<span class="line-added">665     public void testClipFlatBoxBubbles() throws Exception {</span>
<span class="line-added">666         (new PerfMeter(&quot;ClipFlatBox&quot;)).exec(createPR(clipFlatBoxParticleRenderer)).report();</span>
<span class="line-added">667     }</span>
<span class="line-added">668 </span>
<span class="line-added">669     public void testClipFlatBoxBubblesAA() throws Exception {</span>
<span class="line-added">670         (new PerfMeter(&quot;ClipFlatBoxAA&quot;)).exec(createPR(clipFlatBoxParticleRenderer).configure(AA)).report();</span>
<span class="line-added">671     }</span>
<span class="line-added">672 </span>
673     public void testImgBubbles() throws Exception {
674         (new PerfMeter(&quot;Image&quot;)).exec(createPR(imgRenderer)).report();
675     }
676 
677     public void testImgBubblesAA() throws Exception {
678         (new PerfMeter(&quot;ImageAA&quot;)).exec(createPR(imgRenderer).configure(AA)).report();
679     }
680 
681     public void testFlatBoxRotBubbles() throws Exception {
682         (new PerfMeter(&quot;RotatedBox&quot;)).exec(createPR(flatBoxRotRenderer)).report();
683     }
684 
685     public void testFlatBoxRotBubblesAA() throws Exception {
686         (new PerfMeter(&quot;RotatedBoxAA&quot;)).exec(createPR(flatBoxRotRenderer).configure(AA)).report();
687     }
688 
689     public void testFlatOvalRotBubbles() throws Exception {
690         (new PerfMeter(&quot;RotatedOval&quot;)).exec(createPR(flatOvalRotRenderer)).report();
691     }
692 
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>