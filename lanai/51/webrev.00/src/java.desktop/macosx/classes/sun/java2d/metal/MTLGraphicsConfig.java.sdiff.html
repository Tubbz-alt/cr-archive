<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/macosx/classes/sun/java2d/metal/MTLGraphicsConfig.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="MTLContext.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../native/libawt_lwawt/awt/common.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/macosx/classes/sun/java2d/metal/MTLGraphicsConfig.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 35 import sun.java2d.Surface;
 36 import sun.java2d.SurfaceData;
 37 import sun.java2d.pipe.hw.AccelGraphicsConfig;
 38 import sun.java2d.pipe.hw.AccelSurface;
 39 import sun.java2d.pipe.hw.AccelTypedVolatileImage;
 40 import sun.java2d.pipe.hw.ContextCapabilities;
 41 import sun.lwawt.LWComponentPeer;
 42 import sun.lwawt.macosx.CFRetainedResource;
 43 
 44 import java.awt.*;
 45 import java.awt.color.ColorSpace;
 46 import java.awt.image.*;
 47 import java.io.File;
 48 import java.security.AccessController;
 49 import java.security.PrivilegedAction;
 50 
 51 import static sun.java2d.opengl.OGLSurfaceData.TEXTURE;
 52 import static sun.java2d.pipe.hw.AccelSurface.RT_TEXTURE;
 53 import static sun.java2d.pipe.hw.ContextCapabilities.*;
 54 


 55 public final class MTLGraphicsConfig extends CGraphicsConfig
 56         implements AccelGraphicsConfig, SurfaceManager.ProxiedGraphicsConfig
 57 {
 58     //private static final int kOpenGLSwapInterval =
 59     // RuntimeOptions.getCurrentOptions().OpenGLSwapInterval;
 60     private static final int kOpenGLSwapInterval = 0; // TODO
 61     private static boolean mtlAvailable;
 62     private static ImageCapabilities imageCaps = new MTLImageCaps();
 63 
 64     private static final String mtlShadersLib = AccessController.doPrivileged(
 65             (PrivilegedAction&lt;String&gt;) () -&gt;
 66                     System.getProperty(&quot;java.home&quot;, &quot;&quot;) + File.separator +
 67                             &quot;lib&quot; + File.separator + &quot;shaders.metallib&quot;);
 68 
 69 
 70     private int pixfmt;
 71     private BufferCapabilities bufferCaps;
 72     private long pConfigInfo;
 73     private ContextCapabilities mtlCaps;
 74     private final MTLContext context;
</pre>
<hr />
<pre>
140                 textureSize = nativeGetMaxTextureSize();
141                 // 7160609: GL still fails to create a square texture of this
142                 // size. Half should be safe enough.
143                 // Explicitly not support a texture more than 2^14, see 8010999.
144                 textureSize = textureSize &lt;= 16384 ? textureSize / 2 : 8192;
145                 MTLContext.setScratchSurface(cfginfo);
146                 rq.flushAndInvokeNow(() -&gt; {
147                     ids[0] = MTLContext.getMTLIdString();
148                 });
149             }
150         } finally {
151             rq.unlock();
152         }
153         if (cfginfo == 0) {
154             return null;
155         }
156 
157         ContextCapabilities caps = new MTLContext.MTLContextCaps(
158                 CAPS_PS30 | CAPS_PS20 | CAPS_RT_PLAIN_ALPHA |
159                         CAPS_RT_TEXTURE_ALPHA | CAPS_RT_TEXTURE_OPAQUE |
<span class="line-modified">160                         CAPS_MULTITEXTURE | CAPS_TEXNONPOW2 | CAPS_TEXNONSQUARE,</span>
161                 ids[0]);
162         return new MTLGraphicsConfig(device, pixfmt, cfginfo, textureSize, caps);
163     }
164 
165     /**
166      * Returns true if the provided capability bit is present for this config.
167      * See MTLContext.java for a list of supported capabilities.
168      */
169     public boolean isCapPresent(int cap) {
170         return ((mtlCaps.getCaps() &amp; cap) != 0);
171     }
172 
173     public long getNativeConfigInfo() {
174         return pConfigInfo;
175     }
176 
177     /**
178      * {@inheritDoc}
179      *
180      * @see sun.java2d.pipe.hw.BufferedContextProvider#getContext
</pre>
</td>
<td>
<hr />
<pre>
 35 import sun.java2d.Surface;
 36 import sun.java2d.SurfaceData;
 37 import sun.java2d.pipe.hw.AccelGraphicsConfig;
 38 import sun.java2d.pipe.hw.AccelSurface;
 39 import sun.java2d.pipe.hw.AccelTypedVolatileImage;
 40 import sun.java2d.pipe.hw.ContextCapabilities;
 41 import sun.lwawt.LWComponentPeer;
 42 import sun.lwawt.macosx.CFRetainedResource;
 43 
 44 import java.awt.*;
 45 import java.awt.color.ColorSpace;
 46 import java.awt.image.*;
 47 import java.io.File;
 48 import java.security.AccessController;
 49 import java.security.PrivilegedAction;
 50 
 51 import static sun.java2d.opengl.OGLSurfaceData.TEXTURE;
 52 import static sun.java2d.pipe.hw.AccelSurface.RT_TEXTURE;
 53 import static sun.java2d.pipe.hw.ContextCapabilities.*;
 54 
<span class="line-added"> 55 import static sun.java2d.metal.MTLContext.MTLContextCaps.CAPS_EXT_BIOP_SHADER;</span>
<span class="line-added"> 56 </span>
 57 public final class MTLGraphicsConfig extends CGraphicsConfig
 58         implements AccelGraphicsConfig, SurfaceManager.ProxiedGraphicsConfig
 59 {
 60     //private static final int kOpenGLSwapInterval =
 61     // RuntimeOptions.getCurrentOptions().OpenGLSwapInterval;
 62     private static final int kOpenGLSwapInterval = 0; // TODO
 63     private static boolean mtlAvailable;
 64     private static ImageCapabilities imageCaps = new MTLImageCaps();
 65 
 66     private static final String mtlShadersLib = AccessController.doPrivileged(
 67             (PrivilegedAction&lt;String&gt;) () -&gt;
 68                     System.getProperty(&quot;java.home&quot;, &quot;&quot;) + File.separator +
 69                             &quot;lib&quot; + File.separator + &quot;shaders.metallib&quot;);
 70 
 71 
 72     private int pixfmt;
 73     private BufferCapabilities bufferCaps;
 74     private long pConfigInfo;
 75     private ContextCapabilities mtlCaps;
 76     private final MTLContext context;
</pre>
<hr />
<pre>
142                 textureSize = nativeGetMaxTextureSize();
143                 // 7160609: GL still fails to create a square texture of this
144                 // size. Half should be safe enough.
145                 // Explicitly not support a texture more than 2^14, see 8010999.
146                 textureSize = textureSize &lt;= 16384 ? textureSize / 2 : 8192;
147                 MTLContext.setScratchSurface(cfginfo);
148                 rq.flushAndInvokeNow(() -&gt; {
149                     ids[0] = MTLContext.getMTLIdString();
150                 });
151             }
152         } finally {
153             rq.unlock();
154         }
155         if (cfginfo == 0) {
156             return null;
157         }
158 
159         ContextCapabilities caps = new MTLContext.MTLContextCaps(
160                 CAPS_PS30 | CAPS_PS20 | CAPS_RT_PLAIN_ALPHA |
161                         CAPS_RT_TEXTURE_ALPHA | CAPS_RT_TEXTURE_OPAQUE |
<span class="line-modified">162                         CAPS_MULTITEXTURE | CAPS_TEXNONPOW2 | CAPS_TEXNONSQUARE | CAPS_EXT_BIOP_SHADER,</span>
163                 ids[0]);
164         return new MTLGraphicsConfig(device, pixfmt, cfginfo, textureSize, caps);
165     }
166 
167     /**
168      * Returns true if the provided capability bit is present for this config.
169      * See MTLContext.java for a list of supported capabilities.
170      */
171     public boolean isCapPresent(int cap) {
172         return ((mtlCaps.getCaps() &amp; cap) != 0);
173     }
174 
175     public long getNativeConfigInfo() {
176         return pConfigInfo;
177     }
178 
179     /**
180      * {@inheritDoc}
181      *
182      * @see sun.java2d.pipe.hw.BufferedContextProvider#getContext
</pre>
</td>
</tr>
</table>
<center><a href="MTLContext.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../native/libawt_lwawt/awt/common.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>