<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/solaris/native/libjvm_db/libjvm_db.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../../share/native/libzip/zip_util.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../unix/native/libnet/NetworkInterface.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/solaris/native/libjvm_db/libjvm_db.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 535   short klassSymbolLength;
 536   short nameSymbolLength;
 537   short signatureSymbolLength;
 538   char * nameString = NULL;
 539   char * klassString = NULL;
 540   char * signatureString = NULL;
 541   int err;
 542 
 543   err = read_pointer(J, methodPtr + OFFSET_Method_constMethod, &amp;constMethod);
 544   CHECK_FAIL(err);
 545   err = read_pointer(J, constMethod + OFFSET_ConstMethod_constants, &amp;constantPool);
 546   CHECK_FAIL(err);
 547 
 548   /* To get name string */
 549   err = ps_pread(J-&gt;P, constMethod + OFFSET_ConstMethod_name_index, &amp;nameIndex, 2);
 550   CHECK_FAIL(err);
 551   err = read_pointer(J, constantPool + nameIndex * POINTER_SIZE + SIZE_ConstantPool, &amp;nameSymbol);
 552   CHECK_FAIL(err);
 553   // The symbol is a CPSlot and has lower bit set to indicate metadata
 554   nameSymbol &amp;= (~1); // remove metadata lsb
<span class="line-modified"> 555   // The length is in the top half of the word.</span>
<span class="line-removed"> 556   err = ps_pread(J-&gt;P, nameSymbol + OFFSET_Symbol_length_and_refcount, &amp;nameSymbolLength, 2);</span>
 557   CHECK_FAIL(err);
 558   nameString = (char*)calloc(nameSymbolLength + 1, 1);
 559   err = ps_pread(J-&gt;P, nameSymbol + OFFSET_Symbol_body, nameString, nameSymbolLength);
 560   CHECK_FAIL(err);
 561 
 562   /* To get signature string */
 563   err = ps_pread(J-&gt;P, constMethod + OFFSET_ConstMethod_signature_index, &amp;signatureIndex, 2);
 564   CHECK_FAIL(err);
 565   err = read_pointer(J, constantPool + signatureIndex * POINTER_SIZE + SIZE_ConstantPool, &amp;signatureSymbol);
 566   CHECK_FAIL(err);
 567   signatureSymbol &amp;= (~1);  // remove metadata lsb
<span class="line-modified"> 568   err = ps_pread(J-&gt;P, signatureSymbol + OFFSET_Symbol_length_and_refcount, &amp;signatureSymbolLength, 2);</span>
 569   CHECK_FAIL(err);
 570   signatureString = (char*)calloc(signatureSymbolLength + 1, 1);
 571   err = ps_pread(J-&gt;P, signatureSymbol + OFFSET_Symbol_body, signatureString, signatureSymbolLength);
 572   CHECK_FAIL(err);
 573 
 574   /* To get klass string */
 575   err = read_pointer(J, constantPool + OFFSET_ConstantPool_pool_holder, &amp;klassPtr);
 576   CHECK_FAIL(err);
 577   err = read_pointer(J, klassPtr + OFFSET_Klass_name, &amp;klassSymbol);
 578   CHECK_FAIL(err);
<span class="line-modified"> 579   err = ps_pread(J-&gt;P, klassSymbol + OFFSET_Symbol_length_and_refcount, &amp;klassSymbolLength, 2);</span>
 580   CHECK_FAIL(err);
 581   klassString = (char*)calloc(klassSymbolLength + 1, 1);
 582   err = ps_pread(J-&gt;P, klassSymbol + OFFSET_Symbol_body, klassString, klassSymbolLength);
 583   CHECK_FAIL(err);
 584 
 585   result[0] = &#39;\0&#39;;
 586   if (snprintf(result, size,
 587     &quot;%s.%s%s&quot;,
 588     klassString,
 589     nameString,
 590     signatureString) &gt;= size) {
 591     // truncation
 592     goto fail;
 593   }
 594 
 595   if (nameString != NULL) free(nameString);
 596   if (klassString != NULL) free(klassString);
 597   if (signatureString != NULL) free(signatureString);
 598 
 599   return PS_OK;
</pre>
</td>
<td>
<hr />
<pre>
 535   short klassSymbolLength;
 536   short nameSymbolLength;
 537   short signatureSymbolLength;
 538   char * nameString = NULL;
 539   char * klassString = NULL;
 540   char * signatureString = NULL;
 541   int err;
 542 
 543   err = read_pointer(J, methodPtr + OFFSET_Method_constMethod, &amp;constMethod);
 544   CHECK_FAIL(err);
 545   err = read_pointer(J, constMethod + OFFSET_ConstMethod_constants, &amp;constantPool);
 546   CHECK_FAIL(err);
 547 
 548   /* To get name string */
 549   err = ps_pread(J-&gt;P, constMethod + OFFSET_ConstMethod_name_index, &amp;nameIndex, 2);
 550   CHECK_FAIL(err);
 551   err = read_pointer(J, constantPool + nameIndex * POINTER_SIZE + SIZE_ConstantPool, &amp;nameSymbol);
 552   CHECK_FAIL(err);
 553   // The symbol is a CPSlot and has lower bit set to indicate metadata
 554   nameSymbol &amp;= (~1); // remove metadata lsb
<span class="line-modified"> 555   err = ps_pread(J-&gt;P, nameSymbol + OFFSET_Symbol_length, &amp;nameSymbolLength, 2);</span>

 556   CHECK_FAIL(err);
 557   nameString = (char*)calloc(nameSymbolLength + 1, 1);
 558   err = ps_pread(J-&gt;P, nameSymbol + OFFSET_Symbol_body, nameString, nameSymbolLength);
 559   CHECK_FAIL(err);
 560 
 561   /* To get signature string */
 562   err = ps_pread(J-&gt;P, constMethod + OFFSET_ConstMethod_signature_index, &amp;signatureIndex, 2);
 563   CHECK_FAIL(err);
 564   err = read_pointer(J, constantPool + signatureIndex * POINTER_SIZE + SIZE_ConstantPool, &amp;signatureSymbol);
 565   CHECK_FAIL(err);
 566   signatureSymbol &amp;= (~1);  // remove metadata lsb
<span class="line-modified"> 567   err = ps_pread(J-&gt;P, signatureSymbol + OFFSET_Symbol_length, &amp;signatureSymbolLength, 2);</span>
 568   CHECK_FAIL(err);
 569   signatureString = (char*)calloc(signatureSymbolLength + 1, 1);
 570   err = ps_pread(J-&gt;P, signatureSymbol + OFFSET_Symbol_body, signatureString, signatureSymbolLength);
 571   CHECK_FAIL(err);
 572 
 573   /* To get klass string */
 574   err = read_pointer(J, constantPool + OFFSET_ConstantPool_pool_holder, &amp;klassPtr);
 575   CHECK_FAIL(err);
 576   err = read_pointer(J, klassPtr + OFFSET_Klass_name, &amp;klassSymbol);
 577   CHECK_FAIL(err);
<span class="line-modified"> 578   err = ps_pread(J-&gt;P, klassSymbol + OFFSET_Symbol_length, &amp;klassSymbolLength, 2);</span>
 579   CHECK_FAIL(err);
 580   klassString = (char*)calloc(klassSymbolLength + 1, 1);
 581   err = ps_pread(J-&gt;P, klassSymbol + OFFSET_Symbol_body, klassString, klassSymbolLength);
 582   CHECK_FAIL(err);
 583 
 584   result[0] = &#39;\0&#39;;
 585   if (snprintf(result, size,
 586     &quot;%s.%s%s&quot;,
 587     klassString,
 588     nameString,
 589     signatureString) &gt;= size) {
 590     // truncation
 591     goto fail;
 592   }
 593 
 594   if (nameString != NULL) free(nameString);
 595   if (klassString != NULL) free(klassString);
 596   if (signatureString != NULL) free(signatureString);
 597 
 598   return PS_OK;
</pre>
</td>
</tr>
</table>
<center><a href="../../../share/native/libzip/zip_util.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../unix/native/libnet/NetworkInterface.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>