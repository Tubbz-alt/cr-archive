<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/classfile/systemDictionaryShared.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="systemDictionaryShared.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="verifier.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/classfile/systemDictionaryShared.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
</pre>
<hr />
<pre>
275 
276   static InstanceKlass* lookup_from_stream(Symbol* class_name,
277                                            Handle class_loader,
278                                            Handle protection_domain,
279                                            const ClassFileStream* st,
280                                            TRAPS);
281   // &quot;verification_constraints&quot; are a set of checks performed by
282   // VerificationType::is_reference_assignable_from when verifying a shared class during
283   // dump time.
284   //
285   // With AppCDS, it is possible to override archived classes by calling
286   // ClassLoader.defineClass() directly. SystemDictionary::load_shared_class() already
287   // ensures that you cannot load a shared class if its super type(s) are changed. However,
288   // we need an additional check to ensure that the verification_constraints did not change
289   // between dump time and runtime.
290   static bool add_verification_constraint(InstanceKlass* k, Symbol* name,
291                   Symbol* from_name, bool from_field_is_protected,
292                   bool from_is_array, bool from_is_object) NOT_CDS_RETURN_(false);
293   static void check_verification_constraints(InstanceKlass* klass,
294                                              TRAPS) NOT_CDS_RETURN;


295   static bool is_builtin(InstanceKlass* k) {
296     return (k-&gt;shared_classpath_index() != UNREGISTERED_INDEX);
297   }
298   static void check_excluded_classes();
299   static void validate_before_archiving(InstanceKlass* k);
300   static bool is_excluded_class(InstanceKlass* k);
301   static void dumptime_classes_do(class MetaspaceClosure* it);
302   static size_t estimate_size_for_archive();
303   static void write_to_archive(bool is_static_archive = true);
304   static void serialize_dictionary_headers(class SerializeClosure* soc,
305                                            bool is_static_archive = true);

306   static void print() { return print_on(tty); }
307   static void print_on(outputStream* st) NOT_CDS_RETURN;
308   static void print_table_statistics(outputStream* st) NOT_CDS_RETURN;
309   static bool empty_dumptime_table() NOT_CDS_RETURN_(true);
310 
311   DEBUG_ONLY(static bool no_class_loading_should_happen() {return _no_class_loading_should_happen;})
312 
313 #ifdef ASSERT
314   class NoClassLoadingMark: public StackObj {
315   public:
316     NoClassLoadingMark() {
317       assert(!_no_class_loading_should_happen, &quot;must not be nested&quot;);
318       _no_class_loading_should_happen = true;
319     }
320     ~NoClassLoadingMark() {
321       _no_class_loading_should_happen = false;
322     }
323   };
324 #endif
325 
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
</pre>
<hr />
<pre>
275 
276   static InstanceKlass* lookup_from_stream(Symbol* class_name,
277                                            Handle class_loader,
278                                            Handle protection_domain,
279                                            const ClassFileStream* st,
280                                            TRAPS);
281   // &quot;verification_constraints&quot; are a set of checks performed by
282   // VerificationType::is_reference_assignable_from when verifying a shared class during
283   // dump time.
284   //
285   // With AppCDS, it is possible to override archived classes by calling
286   // ClassLoader.defineClass() directly. SystemDictionary::load_shared_class() already
287   // ensures that you cannot load a shared class if its super type(s) are changed. However,
288   // we need an additional check to ensure that the verification_constraints did not change
289   // between dump time and runtime.
290   static bool add_verification_constraint(InstanceKlass* k, Symbol* name,
291                   Symbol* from_name, bool from_field_is_protected,
292                   bool from_is_array, bool from_is_object) NOT_CDS_RETURN_(false);
293   static void check_verification_constraints(InstanceKlass* klass,
294                                              TRAPS) NOT_CDS_RETURN;
<span class="line-added">295   static void set_class_has_failed_verification(InstanceKlass* ik) NOT_CDS_RETURN;</span>
<span class="line-added">296   static bool has_class_failed_verification(InstanceKlass* ik) NOT_CDS_RETURN_(false);</span>
297   static bool is_builtin(InstanceKlass* k) {
298     return (k-&gt;shared_classpath_index() != UNREGISTERED_INDEX);
299   }
300   static void check_excluded_classes();
301   static void validate_before_archiving(InstanceKlass* k);
302   static bool is_excluded_class(InstanceKlass* k);
303   static void dumptime_classes_do(class MetaspaceClosure* it);
304   static size_t estimate_size_for_archive();
305   static void write_to_archive(bool is_static_archive = true);
306   static void serialize_dictionary_headers(class SerializeClosure* soc,
307                                            bool is_static_archive = true);
<span class="line-added">308   static void serialize_well_known_klasses(class SerializeClosure* soc);</span>
309   static void print() { return print_on(tty); }
310   static void print_on(outputStream* st) NOT_CDS_RETURN;
311   static void print_table_statistics(outputStream* st) NOT_CDS_RETURN;
312   static bool empty_dumptime_table() NOT_CDS_RETURN_(true);
313 
314   DEBUG_ONLY(static bool no_class_loading_should_happen() {return _no_class_loading_should_happen;})
315 
316 #ifdef ASSERT
317   class NoClassLoadingMark: public StackObj {
318   public:
319     NoClassLoadingMark() {
320       assert(!_no_class_loading_should_happen, &quot;must not be nested&quot;);
321       _no_class_loading_should_happen = true;
322     }
323     ~NoClassLoadingMark() {
324       _no_class_loading_should_happen = false;
325     }
326   };
327 #endif
328 
</pre>
</td>
</tr>
</table>
<center><a href="systemDictionaryShared.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="verifier.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>