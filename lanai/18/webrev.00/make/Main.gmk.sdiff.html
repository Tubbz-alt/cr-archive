<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/Main.gmk</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="Init.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="RunTests.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/Main.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  55 
  56 # All modules for the current target platform.
  57 ALL_MODULES := $(call FindAllModules)
  58 
  59 ################################################################################
  60 ################################################################################
  61 #
  62 # Recipes for all targets. Only recipes, dependencies are declared later.
  63 #
  64 ################################################################################
  65 
  66 ################################################################################
  67 # Interim/build tools targets, compiling tools used during the build
  68 
  69 buildtools-langtools:
  70 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ToolsLangtools.gmk)
  71 
  72 interim-langtools:
  73 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileInterimLangtools.gmk)
  74 
<span class="line-removed">  75 interim-rmic:</span>
<span class="line-removed">  76 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileInterimRmic.gmk)</span>
<span class="line-removed">  77 </span>
<span class="line-removed">  78 interim-cldrconverter:</span>
<span class="line-removed">  79 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CopyInterimCLDRConverter.gmk)</span>
<span class="line-removed">  80 </span>
  81 interim-tzdb:
  82 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CopyInterimTZDB.gmk)
  83 
  84 
  85 buildtools-jdk:
  86 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileToolsJdk.gmk)
  87 
  88 buildtools-modules:
  89 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileModuleTools.gmk)
  90 
  91 buildtools-hotspot:
  92 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileToolsHotspot.gmk)
  93 
  94 ALL_TARGETS += buildtools-langtools interim-langtools \
<span class="line-modified">  95     interim-rmic interim-cldrconverter interim-tzdb buildtools-jdk buildtools-modules \</span>
  96     buildtools-hotspot
  97 
  98 ################################################################################
  99 # Special targets for certain modules
 100 
 101 generate-exported-symbols:
 102 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f BuildStatic.gmk)
 103 
 104 ALL_TARGETS += generate-exported-symbols
 105 
 106 ################################################################################
 107 # Gensrc targets, generating source before java compilation can be done
 108 #
 109 $(eval $(call DeclareRecipesForPhase, GENSRC, \
 110     TARGET_SUFFIX := gensrc-src, \
 111     FILE_PREFIX := Gensrc, \
 112     MAKE_SUBDIR := gensrc, \
 113     CHECK_MODULES := $(ALL_MODULES), \
 114 ))
 115 
</pre>
<hr />
<pre>
 179 
 180 $(foreach m, $(IMPORT_COPY_MODULES), $(eval $(call DeclareImportCopyRecipe,$m)))
 181 
 182 ALL_TARGETS += $(ALL_COPY_TARGETS)
 183 
 184 ################################################################################
 185 # Targets for compiling all java modules.
 186 JAVA_MODULES := $(ALL_MODULES)
 187 JAVA_TARGETS := $(addsuffix -java, $(JAVA_MODULES))
 188 
 189 define DeclareCompileJavaRecipe
 190   $1-java:
 191 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) \
 192 	    -f CompileJavaModules.gmk MODULE=$1)
 193 endef
 194 
 195 $(foreach m, $(JAVA_MODULES), $(eval $(call DeclareCompileJavaRecipe,$m)))
 196 
 197 ALL_TARGETS += $(JAVA_TARGETS)
 198 
<span class="line-removed"> 199 ################################################################################</span>
<span class="line-removed"> 200 # Targets for running rmic.</span>
<span class="line-removed"> 201 $(eval $(call DeclareRecipesForPhase, RMIC, \</span>
<span class="line-removed"> 202     TARGET_SUFFIX := rmic, \</span>
<span class="line-removed"> 203     FILE_PREFIX := Rmic, \</span>
<span class="line-removed"> 204     MAKE_SUBDIR := rmic, \</span>
<span class="line-removed"> 205     CHECK_MODULES := $(ALL_MODULES)))</span>
<span class="line-removed"> 206 </span>
<span class="line-removed"> 207 ALL_TARGETS += $(RMIC_TARGETS)</span>
<span class="line-removed"> 208 </span>
 209 ################################################################################
 210 # Targets for compiling native libraries
 211 $(eval $(call DeclareRecipesForPhase, LIBS, \
 212     TARGET_SUFFIX := libs, \
 213     FILE_PREFIX := Lib, \
 214     MAKE_SUBDIR := lib, \
 215     CHECK_MODULES := $(ALL_MODULES), \
 216     USE_WRAPPER := true))
 217 
 218 ALL_TARGETS += $(LIBS_TARGETS)
 219 
 220 ################################################################################
 221 # Targets for compiling static versions of certain native libraries. These do
 222 # not end up in the jmods or the normal JDK image, but are instead bundled into
 223 # a special deliverable.
 224 $(eval $(call DeclareRecipesForPhase, STATIC_LIBS, \
 225     TARGET_SUFFIX := static-libs, \
 226     FILE_PREFIX := Lib, \
 227     MAKE_SUBDIR := lib, \
 228     CHECK_MODULES := $(STATIC_LIBS_MODULES), \
</pre>
<hr />
<pre>
 660 #
 661 # These are declared in two groups. First all dependencies between targets that
 662 # have recipes above as these dependencies may be disabled. Then the aggregator
 663 # targets that do not have recipes of their own, which will never have their
 664 # dependencies disabled.
 665 #
 666 ################################################################################
 667 # Targets with recipes above
 668 
 669 # If running an *-only target, parallel execution and dependencies between
 670 # recipe targets are disabled. This makes it possible to run a select set of
 671 # recipe targets in order. It&#39;s the responsibility of the user to make sure
 672 # all prerequisites are fulfilled.
 673 ifneq ($(findstring -only, $(MAKECMDGOALS)), )
 674   .NOTPARALLEL:
 675 else
 676   $(LANGTOOLS_GENSRC_TARGETS): buildtools-langtools
 677 
 678   interim-langtools: $(INTERIM_LANGTOOLS_GENSRC_TARGETS)
 679 
<span class="line-modified"> 680   buildtools-jdk: interim-langtools interim-cldrconverter interim-tzdb</span>
 681 
 682   buildtools-hotspot: interim-langtools
 683 
 684   buildtools-modules: exploded-image-base
 685 
 686   $(HOTSPOT_GENSRC_TARGETS): interim-langtools buildtools-hotspot
 687 
 688   $(JDK_GENSRC_TARGETS): interim-langtools buildtools-jdk
 689 
 690   $(GENSRC_MODULEINFO_TARGETS): buildtools-jdk
 691 
 692   $(GENDATA_TARGETS): interim-langtools buildtools-jdk
 693 
<span class="line-removed"> 694   interim-rmic: interim-langtools</span>
<span class="line-removed"> 695 </span>
<span class="line-removed"> 696   $(RMIC_TARGETS): interim-langtools interim-rmic</span>
<span class="line-removed"> 697 </span>
 698   $(JAVA_TARGETS): interim-langtools
 699 
 700   # Declare dependencies between hotspot-&lt;variant&gt;* targets
 701   $(foreach v, $(JVM_VARIANTS), \
 702       $(eval hotspot-$v-gensrc: java.base-copy) \
 703       $(eval hotspot-$v-libs: hotspot-$v-gensrc java.base-copy) \
 704   )
 705 
 706   hotspot-ide-project: hotspot exploded-image
 707 
 708   generate-exported-symbols: java.base-libs jdk.jdwp.agent-libs
 709 
 710   # If not already set, set the JVM variant target so that the JVM will be built.
 711   JVM_MAIN_LIB_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-libs
 712 
 713   # Building one JVM variant is enough to start building the other libs
 714   $(LIBS_TARGETS): $(JVM_MAIN_LIB_TARGETS)
 715 
 716   $(LAUNCHER_TARGETS): java.base-libs
 717 
 718   ifeq ($(STATIC_BUILD), true)
 719     $(LAUNCHER_TARGETS): generate-exported-symbols
 720   endif
 721 
 722   # The demos are currently linking to libjvm and libjava, just like all other
 723   # jdk libs, even though they don&#39;t need to. To avoid warnings, make sure they
 724   # aren&#39;t built until after libjava and libjvm are available to link to.
 725   demos-jdk: java.base-libs exploded-image
 726   test-image-demos-jdk: demos-jdk
 727 
 728   # Declare dependency from &lt;module&gt;-java to &lt;module&gt;-gensrc
 729   $(foreach m, $(GENSRC_MODULES), $(eval $m-java: $m-gensrc))
 730 
 731   # Declare dependencies between java modules
 732   $(foreach m, $(JAVA_MODULES), \
 733       $(eval $m-java: $(addsuffix -java, $(filter $(JAVA_MODULES), \
 734       $(call FindDepsForModule,$m)))))
 735   # Declare dependencies between the module meta targets
 736   $(foreach m, $(ALL_MODULES), $(eval $m: $(call FindDepsForModule,$m)))
 737 
<span class="line-removed"> 738   # Declare dependencies between &lt;module&gt;-rmic to &lt;module&gt;-java</span>
<span class="line-removed"> 739   $(foreach m, $(RMIC_MODULES), $(eval $m-rmic: $m-java))</span>
<span class="line-removed"> 740 </span>
 741   # Declare dependencies from &lt;module&gt;-lib to &lt;module&gt;-java
 742   # Skip modules that do not have java source.
 743   $(foreach m, $(filter $(JAVA_MODULES), $(LIBS_MODULES)), $(eval $m-libs: $m-java))
 744 
 745   # Declare dependencies from all other &lt;module&gt;-lib to java.base-lib
 746   $(foreach t, $(filter-out java.base-libs, $(LIBS_TARGETS)), \
 747       $(eval $t: java.base-libs))
 748 
 749   # jdk.accessibility depends on java.desktop
 750   jdk.accessibility-libs: java.desktop-libs
 751 
 752   # This dependency needs to be explicitly declared. jdk.jdi-gensrc generates a
 753   # header file used by jdk.jdwp.agent-libs. The jdk.jdwp.agent-gensrc is a
 754   # virtual target.
 755   jdk.jdwp.agent-libs: jdk.jdwp.agent-gensrc
 756 
 757   # The swing beans need to have java base properly generated to avoid errors
 758   # in javadoc. The X11 wrappers need the java.base include files to have been
 759   # copied and processed.
 760   java.desktop-gensrc-src: java.base-gensrc java.base-copy
 761 
 762   # The annotation processing for jdk.internal.vm.compiler
 763   # and jdk.internal.vm.compiler.management needs classes from the current JDK.
 764   jdk.internal.vm.compiler-gensrc-src: $(addsuffix -java, \
 765       $(call FindTransitiveDepsForModule, jdk.internal.vm.compiler))
 766   jdk.internal.vm.compiler.management-gensrc-src: $(addsuffix -java, \
 767       $(call FindTransitiveDepsForModule, jdk.internal.vm.compiler.management))
 768 
 769   # For these modules, the gensrc step is generating a module-info.java.extra
 770   # file to be processed by the gensrc-moduleinfo target.
 771   jdk.internal.vm.compiler-gensrc-moduleinfo: jdk.internal.vm.compiler-gensrc-src
 772   jdk.internal.vm.compiler.management-gensrc-moduleinfo: jdk.internal.vm.compiler.management-gensrc-src
 773 
<span class="line-modified"> 774   jdk.jdeps-gendata: java rmic</span>
 775 
 776   # The ct.sym generation uses all the moduleinfos as input
 777   jdk.compiler-gendata: $(GENSRC_MODULEINFO_TARGETS)
 778 
 779   # Declare dependencies between jmod targets.
 780   # java.base jmod needs jrt-fs.jar and access to the other jmods to be built.
 781   # When creating the BUILDJDK, we don&#39;t need to add hashes to java.base, thus
 782   # we don&#39;t need to depend on all other jmods
 783   ifneq ($(CREATING_BUILDJDK), true)
 784     java.base-jmod: jrtfs-jar $(filter-out java.base-jmod, $(JMOD_TARGETS))
 785   endif
 786 
 787   # If not already set, set the JVM target so that the JVM will be built.
 788   JVM_MAIN_TARGETS ?= hotspot
 789 
 790   # Building java.base-jmod requires all of VM (ie hotspot) to be built.
 791   java.base-jmod: $(JVM_MAIN_TARGETS)
 792 
 793   # Declare dependencies from &lt;module&gt;-jmod to all other module targets
 794   $(foreach m, $(JAVA_MODULES), $(eval $m_JMOD_DEPS += $m-java))
 795   $(foreach m, $(GENDATA_MODULES), $(eval $m_JMOD_DEPS += $m-gendata))
<span class="line-removed"> 796   $(foreach m, $(RMIC_MODULES), $(eval $m_JMOD_DEPS += $m-rmic))</span>
 797   $(foreach m, $(LIBS_MODULES), $(eval $m_JMOD_DEPS += $m-libs))
 798   $(foreach m, $(LAUNCHER_MODULES), $(eval $m_JMOD_DEPS += $m-launchers))
 799   $(foreach m, $(COPY_MODULES), $(eval $m_JMOD_DEPS += $m-copy))
 800   $(foreach m, $(ALL_MODULES), $(eval $m-jmod: $($(m)_JMOD_DEPS)))
 801   $(foreach m, $(INTERIM_IMAGE_MODULES), $(eval $m-interim-jmod: $($(m)_JMOD_DEPS)))
 802 
 803   # Setup the minimal set of generated native source dependencies for hotspot
 804   $(foreach v, $(JVM_VARIANTS), \
 805     $(eval hotspot-$v-libs-compile-commands: hotspot-$v-gensrc) \
 806     $(foreach m, $(filter java.desktop jdk.hotspot.agent, $(GENSRC_MODULES)), \
 807       $(eval hotspot-$v-libs-compile-commands: $m-gensrc)) \
 808   )
 809 
 810   # For the full JDK compile commands, create all possible generated sources
 811   $(foreach m, $(GENSRC_MODULES), $(eval $m-libs-compile-commands: $m-gensrc))
 812   $(foreach m, $(filter $(JAVA_MODULES), $(LIBS_MODULES)), $(eval $m-libs-compile-commands: $m-java))
 813 
 814   $(COMPILE_COMMANDS_TARGETS_HOTSPOT): clean-compile-commands
 815   $(COMPILE_COMMANDS_TARGETS_JDK): clean-compile-commands
 816   compile-commands-hotspot: $(COMPILE_COMMANDS_TARGETS_HOTSPOT)
</pre>
<hr />
<pre>
 842       # * all java modules
 843       # * jdk.jlink-launchers
 844       # * copy jvm.cfg (done in java.base-copy)
 845       # * tzdb.dat (done in java.base-gendata)
 846       # Without all of these jimage, jlink and jmod won&#39;t start.
 847       $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): java.base-libs java.base-copy \
 848           java.base-gendata jdk.jlink-launchers java
 849     endif
 850   else
 851     # The normal non cross compilation case uses needs to wait for the full
 852     # exploded-image to avoid a race with the optimize target.
 853     $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): exploded-image
 854   endif
 855 
 856   # All modules include the main license files from java.base.
 857   $(JMOD_TARGETS): java.base-copy
 858 
 859   zip-security: java.base-java java.security.jgss-java java.security.jgss-libs \
 860       $(filter jdk.crypto%, $(JAVA_TARGETS))
 861 
<span class="line-modified"> 862   zip-source: gensrc rmic</span>
 863 
 864   jrtfs-jar: interim-langtools
 865 
 866   build-microbenchmark: interim-langtools exploded-image
 867 
 868   ifeq ($(ENABLE_GENERATE_CLASSLIST), true)
 869     ifeq ($(CREATE_BUILDJDK), true)
 870       # If creating a buildjdk, the interim image needs to be based on that.
 871       generate-link-opt-data: create-buildjdk
 872     else ifeq ($(EXTERNAL_BUILDJDK), false)
 873       # If an external buildjdk has been provided, we skip generating an
 874       # interim-image and just use the external buildjdk for generating
 875       # classlist.
 876       generate-link-opt-data: interim-image
 877     endif
 878     generate-link-opt-data: buildtools-jdk
 879 
 880     # The generated classlist needs to go into java.base-jmod.
 881     java.base-jmod jdk.jlink-jmod jdk-image legacy-jre-image: generate-link-opt-data
 882   endif
</pre>
<hr />
<pre>
 889 
 890   static-libs-image: $(STATIC_LIBS_TARGETS)
 891 
 892   graal-builder-image: jdk-image static-libs-image
 893 
 894   mac-jdk-bundle: jdk-image
 895   mac-legacy-jre-bundle: legacy-jre-image
 896 
 897   ifeq ($(JCOV_INPUT_JDK), )
 898     jcov-image: jdk-image
 899   endif
 900 
 901   # The optimize target can run as soon as the modules dir has been completely
 902   # populated (java, copy and gendata targets) and the basic libs and launchers
 903   # have been built.
 904   exploded-image-optimize: java copy gendata java.base-libs java.base-launchers \
 905       buildtools-modules
 906 
 907   bootcycle-images: jdk-image
 908 
<span class="line-modified"> 909   docs-jdk-api-javadoc: $(GENSRC_TARGETS) rmic</span>
 910 
<span class="line-modified"> 911   docs-javase-api-javadoc: $(GENSRC_TARGETS) rmic</span>
 912 
<span class="line-modified"> 913   docs-reference-api-javadoc: $(GENSRC_TARGETS) rmic</span>
 914 
 915   docs-jdk-api-modulegraph: exploded-image buildtools-modules
 916 
 917   docs-javase-api-modulegraph: exploded-image buildtools-modules
 918 
 919   docs-reference-api-modulegraph: exploded-image buildtools-modules
 920 
 921   # If not already set, then set the JVM specific docs targets
 922   JVM_DOCS_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-gensrc
 923 
 924   # The gensrc steps for hotspot and jdk.jdi create html spec files.
 925   docs-jdk-specs: buildtools-jdk $(JVM_DOCS_TARGETS) jdk.jdi-gensrc \
 926       docs-jdk-index
 927 
 928   docs-zip: docs-jdk
 929 
 930   docs-specs-zip: docs-jdk-specs
 931 
 932   # Tests
 933   test: jdk-image test-image
</pre>
<hr />
<pre>
 975 
 976   test-bundles: test-image
 977 
 978   docs-bundles: docs-image
 979 
 980   jcov-bundles: jcov-image
 981 
 982   static-libs-bundles: static-libs-image
 983 
 984   generate-summary: jmods buildtools-modules
 985 
 986   update-x11wrappers: java.base-copy buildtools-jdk
 987 
 988 endif
 989 
 990 ################################################################################
 991 # Virtual targets without recipes
 992 
 993 # If not already set, set the JVM specific tools targets
 994 JVM_TOOLS_TARGETS ?= buildtools-hotspot
<span class="line-modified"> 995 buildtools: buildtools-langtools interim-langtools interim-rmic \</span>
 996     buildtools-jdk $(JVM_TOOLS_TARGETS)
 997 
 998 # Declare dependencies from hotspot-&lt;variant&gt; targets
 999 $(foreach v, $(JVM_VARIANTS), \
1000   $(eval hotspot-$v: hotspot-$v-gensrc hotspot-$v-libs) \
1001 )
1002 hotspot: $(HOTSPOT_VARIANT_TARGETS)
1003 
1004 # Create targets hotspot-libs and hotspot-gensrc.
1005 $(foreach v, $(JVM_VARIANTS), \
1006   $(eval hotspot-libs: hotspot-$v-libs) \
1007   $(eval hotspot-gensrc: hotspot-$v-gensrc) \
1008 )
1009 
1010 gensrc: $(GENSRC_TARGETS)
1011 
1012 gendata: $(GENDATA_TARGETS)
1013 
1014 copy: $(ALL_COPY_TARGETS)
1015 
1016 java: $(JAVA_TARGETS)
1017 
<span class="line-removed">1018 rmic: $(RMIC_TARGETS)</span>
<span class="line-removed">1019 </span>
1020 libs: $(LIBS_TARGETS)
1021 
1022 static-libs: $(STATIC_LIBS_TARGETS)
1023 
1024 launchers: $(LAUNCHER_TARGETS)
1025 
1026 jmods: $(JMOD_TARGETS)
1027 
1028 # Explicitly declare dependency for virtual target jdk.jdwp.agent-gensrc which
1029 # is actually handled by jdk.jdi-gensrc
1030 jdk.jdwp.agent-gensrc: jdk.jdi-gensrc
1031 
1032 # Declare dependencies from &lt;module&gt; to all the individual targets specific
1033 # to that module &lt;module&gt;-*, that are needed for the exploded image.
1034 $(foreach m, $(GENSRC_MODULES), $(eval $m: $m-gensrc))
1035 $(foreach m, $(JAVA_MODULES), $(eval $m: $m-java))
1036 $(foreach m, $(GENDATA_MODULES), $(eval $m: $m-gendata))
<span class="line-removed">1037 $(foreach m, $(RMIC_MODULES), $(eval $m: $m-rmic))</span>
1038 $(foreach m, $(LIBS_MODULES), $(eval $m: $m-libs))
1039 $(foreach m, $(LAUNCHER_MODULES), $(eval $m: $m-launchers))
1040 $(foreach m, $(ALL_COPY_MODULES), $(eval $m: $m-copy))
1041 
1042 # Building java.base includes building all of hotspot.
1043 java.base: $(JVM_MAIN_TARGETS)
1044 
1045 demos: demos-jdk
1046 
1047 # The &quot;exploded image&quot; is a locally runnable JDK in $(OUTPUTDIR)/jdk.
1048 exploded-image-base: $(ALL_MODULES)
1049 exploded-image: exploded-image-base release-file
1050 # When cross compiling, no need to optimize the exploded image since it won&#39;t
1051 # be runnable on the host platform anyway.
1052 ifneq ($(COMPILE_TYPE), cross)
1053   exploded-image: exploded-image-optimize
1054 endif
1055 
1056 create-buildjdk: create-buildjdk-interim-image
1057 
</pre>
<hr />
<pre>
1117 endif
1118 
1119 # This target builds the test image
1120 test-image: prepare-test-image \
1121     test-image-jdk-jtreg-native test-image-failure-handler \
1122     test-image-demos-jdk $(JVM_TEST_IMAGE_TARGETS)
1123 
1124 ifneq ($(JMH_CORE_JAR), )
1125   test-image: build-microbenchmark
1126 endif
1127 
1128 ################################################################################
1129 
1130 # all-images builds all our deliverables as images.
1131 all-images: product-images test-image docs-image
1132 
1133 # all-bundles packages all our deliverables as tar.gz bundles.
1134 all-bundles: product-bundles test-bundles docs-bundles static-libs-bundles
1135 
1136 ALL_TARGETS += buildtools hotspot hotspot-libs hotspot-gensrc gensrc gendata \
<span class="line-modified">1137     copy java rmic libs static-libs launchers jmods \</span>
1138     jdk.jdwp.agent-gensrc $(ALL_MODULES) demos \
1139     exploded-image-base exploded-image \
1140     create-buildjdk docs-jdk-api docs-javase-api docs-reference-api docs-jdk \
1141     docs-javase docs-reference docs-javadoc mac-bundles product-images legacy-images \
1142     docs-image test-image all-images \
1143     all-bundles
1144 
1145 ################################################################################
1146 
1147 # Traditional targets typically run by users.
1148 # These can be considered aliases for the targets now named by a more
1149 # &quot;modern&quot; naming scheme.
1150 default: $(DEFAULT_MAKE_TARGET)
1151 jdk: exploded-image
1152 images: product-images
1153 docs: docs-image
1154 bundles: all-bundles
1155 all: all-images
1156 
1157 ALL_TARGETS += default jdk images docs bundles all
</pre>
</td>
<td>
<hr />
<pre>
  55 
  56 # All modules for the current target platform.
  57 ALL_MODULES := $(call FindAllModules)
  58 
  59 ################################################################################
  60 ################################################################################
  61 #
  62 # Recipes for all targets. Only recipes, dependencies are declared later.
  63 #
  64 ################################################################################
  65 
  66 ################################################################################
  67 # Interim/build tools targets, compiling tools used during the build
  68 
  69 buildtools-langtools:
  70 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ToolsLangtools.gmk)
  71 
  72 interim-langtools:
  73 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileInterimLangtools.gmk)
  74 






  75 interim-tzdb:
  76 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CopyInterimTZDB.gmk)
  77 
  78 
  79 buildtools-jdk:
  80 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileToolsJdk.gmk)
  81 
  82 buildtools-modules:
  83 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileModuleTools.gmk)
  84 
  85 buildtools-hotspot:
  86 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileToolsHotspot.gmk)
  87 
  88 ALL_TARGETS += buildtools-langtools interim-langtools \
<span class="line-modified">  89     interim-tzdb buildtools-jdk buildtools-modules \</span>
  90     buildtools-hotspot
  91 
  92 ################################################################################
  93 # Special targets for certain modules
  94 
  95 generate-exported-symbols:
  96 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f BuildStatic.gmk)
  97 
  98 ALL_TARGETS += generate-exported-symbols
  99 
 100 ################################################################################
 101 # Gensrc targets, generating source before java compilation can be done
 102 #
 103 $(eval $(call DeclareRecipesForPhase, GENSRC, \
 104     TARGET_SUFFIX := gensrc-src, \
 105     FILE_PREFIX := Gensrc, \
 106     MAKE_SUBDIR := gensrc, \
 107     CHECK_MODULES := $(ALL_MODULES), \
 108 ))
 109 
</pre>
<hr />
<pre>
 173 
 174 $(foreach m, $(IMPORT_COPY_MODULES), $(eval $(call DeclareImportCopyRecipe,$m)))
 175 
 176 ALL_TARGETS += $(ALL_COPY_TARGETS)
 177 
 178 ################################################################################
 179 # Targets for compiling all java modules.
 180 JAVA_MODULES := $(ALL_MODULES)
 181 JAVA_TARGETS := $(addsuffix -java, $(JAVA_MODULES))
 182 
 183 define DeclareCompileJavaRecipe
 184   $1-java:
 185 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) \
 186 	    -f CompileJavaModules.gmk MODULE=$1)
 187 endef
 188 
 189 $(foreach m, $(JAVA_MODULES), $(eval $(call DeclareCompileJavaRecipe,$m)))
 190 
 191 ALL_TARGETS += $(JAVA_TARGETS)
 192 










 193 ################################################################################
 194 # Targets for compiling native libraries
 195 $(eval $(call DeclareRecipesForPhase, LIBS, \
 196     TARGET_SUFFIX := libs, \
 197     FILE_PREFIX := Lib, \
 198     MAKE_SUBDIR := lib, \
 199     CHECK_MODULES := $(ALL_MODULES), \
 200     USE_WRAPPER := true))
 201 
 202 ALL_TARGETS += $(LIBS_TARGETS)
 203 
 204 ################################################################################
 205 # Targets for compiling static versions of certain native libraries. These do
 206 # not end up in the jmods or the normal JDK image, but are instead bundled into
 207 # a special deliverable.
 208 $(eval $(call DeclareRecipesForPhase, STATIC_LIBS, \
 209     TARGET_SUFFIX := static-libs, \
 210     FILE_PREFIX := Lib, \
 211     MAKE_SUBDIR := lib, \
 212     CHECK_MODULES := $(STATIC_LIBS_MODULES), \
</pre>
<hr />
<pre>
 644 #
 645 # These are declared in two groups. First all dependencies between targets that
 646 # have recipes above as these dependencies may be disabled. Then the aggregator
 647 # targets that do not have recipes of their own, which will never have their
 648 # dependencies disabled.
 649 #
 650 ################################################################################
 651 # Targets with recipes above
 652 
 653 # If running an *-only target, parallel execution and dependencies between
 654 # recipe targets are disabled. This makes it possible to run a select set of
 655 # recipe targets in order. It&#39;s the responsibility of the user to make sure
 656 # all prerequisites are fulfilled.
 657 ifneq ($(findstring -only, $(MAKECMDGOALS)), )
 658   .NOTPARALLEL:
 659 else
 660   $(LANGTOOLS_GENSRC_TARGETS): buildtools-langtools
 661 
 662   interim-langtools: $(INTERIM_LANGTOOLS_GENSRC_TARGETS)
 663 
<span class="line-modified"> 664   buildtools-jdk: interim-langtools interim-tzdb</span>
 665 
 666   buildtools-hotspot: interim-langtools
 667 
 668   buildtools-modules: exploded-image-base
 669 
 670   $(HOTSPOT_GENSRC_TARGETS): interim-langtools buildtools-hotspot
 671 
 672   $(JDK_GENSRC_TARGETS): interim-langtools buildtools-jdk
 673 
 674   $(GENSRC_MODULEINFO_TARGETS): buildtools-jdk
 675 
 676   $(GENDATA_TARGETS): interim-langtools buildtools-jdk
 677 




 678   $(JAVA_TARGETS): interim-langtools
 679 
 680   # Declare dependencies between hotspot-&lt;variant&gt;* targets
 681   $(foreach v, $(JVM_VARIANTS), \
 682       $(eval hotspot-$v-gensrc: java.base-copy) \
 683       $(eval hotspot-$v-libs: hotspot-$v-gensrc java.base-copy) \
 684   )
 685 
 686   hotspot-ide-project: hotspot exploded-image
 687 
 688   generate-exported-symbols: java.base-libs jdk.jdwp.agent-libs
 689 
 690   # If not already set, set the JVM variant target so that the JVM will be built.
 691   JVM_MAIN_LIB_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-libs
 692 
 693   # Building one JVM variant is enough to start building the other libs
 694   $(LIBS_TARGETS): $(JVM_MAIN_LIB_TARGETS)
 695 
 696   $(LAUNCHER_TARGETS): java.base-libs
 697 
 698   ifeq ($(STATIC_BUILD), true)
 699     $(LAUNCHER_TARGETS): generate-exported-symbols
 700   endif
 701 
 702   # The demos are currently linking to libjvm and libjava, just like all other
 703   # jdk libs, even though they don&#39;t need to. To avoid warnings, make sure they
 704   # aren&#39;t built until after libjava and libjvm are available to link to.
 705   demos-jdk: java.base-libs exploded-image
 706   test-image-demos-jdk: demos-jdk
 707 
 708   # Declare dependency from &lt;module&gt;-java to &lt;module&gt;-gensrc
 709   $(foreach m, $(GENSRC_MODULES), $(eval $m-java: $m-gensrc))
 710 
 711   # Declare dependencies between java modules
 712   $(foreach m, $(JAVA_MODULES), \
 713       $(eval $m-java: $(addsuffix -java, $(filter $(JAVA_MODULES), \
 714       $(call FindDepsForModule,$m)))))
 715   # Declare dependencies between the module meta targets
 716   $(foreach m, $(ALL_MODULES), $(eval $m: $(call FindDepsForModule,$m)))
 717 



 718   # Declare dependencies from &lt;module&gt;-lib to &lt;module&gt;-java
 719   # Skip modules that do not have java source.
 720   $(foreach m, $(filter $(JAVA_MODULES), $(LIBS_MODULES)), $(eval $m-libs: $m-java))
 721 
 722   # Declare dependencies from all other &lt;module&gt;-lib to java.base-lib
 723   $(foreach t, $(filter-out java.base-libs, $(LIBS_TARGETS)), \
 724       $(eval $t: java.base-libs))
 725 
 726   # jdk.accessibility depends on java.desktop
 727   jdk.accessibility-libs: java.desktop-libs
 728 
 729   # This dependency needs to be explicitly declared. jdk.jdi-gensrc generates a
 730   # header file used by jdk.jdwp.agent-libs. The jdk.jdwp.agent-gensrc is a
 731   # virtual target.
 732   jdk.jdwp.agent-libs: jdk.jdwp.agent-gensrc
 733 
 734   # The swing beans need to have java base properly generated to avoid errors
 735   # in javadoc. The X11 wrappers need the java.base include files to have been
 736   # copied and processed.
 737   java.desktop-gensrc-src: java.base-gensrc java.base-copy
 738 
 739   # The annotation processing for jdk.internal.vm.compiler
 740   # and jdk.internal.vm.compiler.management needs classes from the current JDK.
 741   jdk.internal.vm.compiler-gensrc-src: $(addsuffix -java, \
 742       $(call FindTransitiveDepsForModule, jdk.internal.vm.compiler))
 743   jdk.internal.vm.compiler.management-gensrc-src: $(addsuffix -java, \
 744       $(call FindTransitiveDepsForModule, jdk.internal.vm.compiler.management))
 745 
 746   # For these modules, the gensrc step is generating a module-info.java.extra
 747   # file to be processed by the gensrc-moduleinfo target.
 748   jdk.internal.vm.compiler-gensrc-moduleinfo: jdk.internal.vm.compiler-gensrc-src
 749   jdk.internal.vm.compiler.management-gensrc-moduleinfo: jdk.internal.vm.compiler.management-gensrc-src
 750 
<span class="line-modified"> 751   jdk.jdeps-gendata: java</span>
 752 
 753   # The ct.sym generation uses all the moduleinfos as input
 754   jdk.compiler-gendata: $(GENSRC_MODULEINFO_TARGETS)
 755 
 756   # Declare dependencies between jmod targets.
 757   # java.base jmod needs jrt-fs.jar and access to the other jmods to be built.
 758   # When creating the BUILDJDK, we don&#39;t need to add hashes to java.base, thus
 759   # we don&#39;t need to depend on all other jmods
 760   ifneq ($(CREATING_BUILDJDK), true)
 761     java.base-jmod: jrtfs-jar $(filter-out java.base-jmod, $(JMOD_TARGETS))
 762   endif
 763 
 764   # If not already set, set the JVM target so that the JVM will be built.
 765   JVM_MAIN_TARGETS ?= hotspot
 766 
 767   # Building java.base-jmod requires all of VM (ie hotspot) to be built.
 768   java.base-jmod: $(JVM_MAIN_TARGETS)
 769 
 770   # Declare dependencies from &lt;module&gt;-jmod to all other module targets
 771   $(foreach m, $(JAVA_MODULES), $(eval $m_JMOD_DEPS += $m-java))
 772   $(foreach m, $(GENDATA_MODULES), $(eval $m_JMOD_DEPS += $m-gendata))

 773   $(foreach m, $(LIBS_MODULES), $(eval $m_JMOD_DEPS += $m-libs))
 774   $(foreach m, $(LAUNCHER_MODULES), $(eval $m_JMOD_DEPS += $m-launchers))
 775   $(foreach m, $(COPY_MODULES), $(eval $m_JMOD_DEPS += $m-copy))
 776   $(foreach m, $(ALL_MODULES), $(eval $m-jmod: $($(m)_JMOD_DEPS)))
 777   $(foreach m, $(INTERIM_IMAGE_MODULES), $(eval $m-interim-jmod: $($(m)_JMOD_DEPS)))
 778 
 779   # Setup the minimal set of generated native source dependencies for hotspot
 780   $(foreach v, $(JVM_VARIANTS), \
 781     $(eval hotspot-$v-libs-compile-commands: hotspot-$v-gensrc) \
 782     $(foreach m, $(filter java.desktop jdk.hotspot.agent, $(GENSRC_MODULES)), \
 783       $(eval hotspot-$v-libs-compile-commands: $m-gensrc)) \
 784   )
 785 
 786   # For the full JDK compile commands, create all possible generated sources
 787   $(foreach m, $(GENSRC_MODULES), $(eval $m-libs-compile-commands: $m-gensrc))
 788   $(foreach m, $(filter $(JAVA_MODULES), $(LIBS_MODULES)), $(eval $m-libs-compile-commands: $m-java))
 789 
 790   $(COMPILE_COMMANDS_TARGETS_HOTSPOT): clean-compile-commands
 791   $(COMPILE_COMMANDS_TARGETS_JDK): clean-compile-commands
 792   compile-commands-hotspot: $(COMPILE_COMMANDS_TARGETS_HOTSPOT)
</pre>
<hr />
<pre>
 818       # * all java modules
 819       # * jdk.jlink-launchers
 820       # * copy jvm.cfg (done in java.base-copy)
 821       # * tzdb.dat (done in java.base-gendata)
 822       # Without all of these jimage, jlink and jmod won&#39;t start.
 823       $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): java.base-libs java.base-copy \
 824           java.base-gendata jdk.jlink-launchers java
 825     endif
 826   else
 827     # The normal non cross compilation case uses needs to wait for the full
 828     # exploded-image to avoid a race with the optimize target.
 829     $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): exploded-image
 830   endif
 831 
 832   # All modules include the main license files from java.base.
 833   $(JMOD_TARGETS): java.base-copy
 834 
 835   zip-security: java.base-java java.security.jgss-java java.security.jgss-libs \
 836       $(filter jdk.crypto%, $(JAVA_TARGETS))
 837 
<span class="line-modified"> 838   zip-source: gensrc</span>
 839 
 840   jrtfs-jar: interim-langtools
 841 
 842   build-microbenchmark: interim-langtools exploded-image
 843 
 844   ifeq ($(ENABLE_GENERATE_CLASSLIST), true)
 845     ifeq ($(CREATE_BUILDJDK), true)
 846       # If creating a buildjdk, the interim image needs to be based on that.
 847       generate-link-opt-data: create-buildjdk
 848     else ifeq ($(EXTERNAL_BUILDJDK), false)
 849       # If an external buildjdk has been provided, we skip generating an
 850       # interim-image and just use the external buildjdk for generating
 851       # classlist.
 852       generate-link-opt-data: interim-image
 853     endif
 854     generate-link-opt-data: buildtools-jdk
 855 
 856     # The generated classlist needs to go into java.base-jmod.
 857     java.base-jmod jdk.jlink-jmod jdk-image legacy-jre-image: generate-link-opt-data
 858   endif
</pre>
<hr />
<pre>
 865 
 866   static-libs-image: $(STATIC_LIBS_TARGETS)
 867 
 868   graal-builder-image: jdk-image static-libs-image
 869 
 870   mac-jdk-bundle: jdk-image
 871   mac-legacy-jre-bundle: legacy-jre-image
 872 
 873   ifeq ($(JCOV_INPUT_JDK), )
 874     jcov-image: jdk-image
 875   endif
 876 
 877   # The optimize target can run as soon as the modules dir has been completely
 878   # populated (java, copy and gendata targets) and the basic libs and launchers
 879   # have been built.
 880   exploded-image-optimize: java copy gendata java.base-libs java.base-launchers \
 881       buildtools-modules
 882 
 883   bootcycle-images: jdk-image
 884 
<span class="line-modified"> 885   docs-jdk-api-javadoc: $(GENSRC_TARGETS)</span>
 886 
<span class="line-modified"> 887   docs-javase-api-javadoc: $(GENSRC_TARGETS)</span>
 888 
<span class="line-modified"> 889   docs-reference-api-javadoc: $(GENSRC_TARGETS)</span>
 890 
 891   docs-jdk-api-modulegraph: exploded-image buildtools-modules
 892 
 893   docs-javase-api-modulegraph: exploded-image buildtools-modules
 894 
 895   docs-reference-api-modulegraph: exploded-image buildtools-modules
 896 
 897   # If not already set, then set the JVM specific docs targets
 898   JVM_DOCS_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-gensrc
 899 
 900   # The gensrc steps for hotspot and jdk.jdi create html spec files.
 901   docs-jdk-specs: buildtools-jdk $(JVM_DOCS_TARGETS) jdk.jdi-gensrc \
 902       docs-jdk-index
 903 
 904   docs-zip: docs-jdk
 905 
 906   docs-specs-zip: docs-jdk-specs
 907 
 908   # Tests
 909   test: jdk-image test-image
</pre>
<hr />
<pre>
 951 
 952   test-bundles: test-image
 953 
 954   docs-bundles: docs-image
 955 
 956   jcov-bundles: jcov-image
 957 
 958   static-libs-bundles: static-libs-image
 959 
 960   generate-summary: jmods buildtools-modules
 961 
 962   update-x11wrappers: java.base-copy buildtools-jdk
 963 
 964 endif
 965 
 966 ################################################################################
 967 # Virtual targets without recipes
 968 
 969 # If not already set, set the JVM specific tools targets
 970 JVM_TOOLS_TARGETS ?= buildtools-hotspot
<span class="line-modified"> 971 buildtools: buildtools-langtools interim-langtools \</span>
 972     buildtools-jdk $(JVM_TOOLS_TARGETS)
 973 
 974 # Declare dependencies from hotspot-&lt;variant&gt; targets
 975 $(foreach v, $(JVM_VARIANTS), \
 976   $(eval hotspot-$v: hotspot-$v-gensrc hotspot-$v-libs) \
 977 )
 978 hotspot: $(HOTSPOT_VARIANT_TARGETS)
 979 
 980 # Create targets hotspot-libs and hotspot-gensrc.
 981 $(foreach v, $(JVM_VARIANTS), \
 982   $(eval hotspot-libs: hotspot-$v-libs) \
 983   $(eval hotspot-gensrc: hotspot-$v-gensrc) \
 984 )
 985 
 986 gensrc: $(GENSRC_TARGETS)
 987 
 988 gendata: $(GENDATA_TARGETS)
 989 
 990 copy: $(ALL_COPY_TARGETS)
 991 
 992 java: $(JAVA_TARGETS)
 993 


 994 libs: $(LIBS_TARGETS)
 995 
 996 static-libs: $(STATIC_LIBS_TARGETS)
 997 
 998 launchers: $(LAUNCHER_TARGETS)
 999 
1000 jmods: $(JMOD_TARGETS)
1001 
1002 # Explicitly declare dependency for virtual target jdk.jdwp.agent-gensrc which
1003 # is actually handled by jdk.jdi-gensrc
1004 jdk.jdwp.agent-gensrc: jdk.jdi-gensrc
1005 
1006 # Declare dependencies from &lt;module&gt; to all the individual targets specific
1007 # to that module &lt;module&gt;-*, that are needed for the exploded image.
1008 $(foreach m, $(GENSRC_MODULES), $(eval $m: $m-gensrc))
1009 $(foreach m, $(JAVA_MODULES), $(eval $m: $m-java))
1010 $(foreach m, $(GENDATA_MODULES), $(eval $m: $m-gendata))

1011 $(foreach m, $(LIBS_MODULES), $(eval $m: $m-libs))
1012 $(foreach m, $(LAUNCHER_MODULES), $(eval $m: $m-launchers))
1013 $(foreach m, $(ALL_COPY_MODULES), $(eval $m: $m-copy))
1014 
1015 # Building java.base includes building all of hotspot.
1016 java.base: $(JVM_MAIN_TARGETS)
1017 
1018 demos: demos-jdk
1019 
1020 # The &quot;exploded image&quot; is a locally runnable JDK in $(OUTPUTDIR)/jdk.
1021 exploded-image-base: $(ALL_MODULES)
1022 exploded-image: exploded-image-base release-file
1023 # When cross compiling, no need to optimize the exploded image since it won&#39;t
1024 # be runnable on the host platform anyway.
1025 ifneq ($(COMPILE_TYPE), cross)
1026   exploded-image: exploded-image-optimize
1027 endif
1028 
1029 create-buildjdk: create-buildjdk-interim-image
1030 
</pre>
<hr />
<pre>
1090 endif
1091 
1092 # This target builds the test image
1093 test-image: prepare-test-image \
1094     test-image-jdk-jtreg-native test-image-failure-handler \
1095     test-image-demos-jdk $(JVM_TEST_IMAGE_TARGETS)
1096 
1097 ifneq ($(JMH_CORE_JAR), )
1098   test-image: build-microbenchmark
1099 endif
1100 
1101 ################################################################################
1102 
1103 # all-images builds all our deliverables as images.
1104 all-images: product-images test-image docs-image
1105 
1106 # all-bundles packages all our deliverables as tar.gz bundles.
1107 all-bundles: product-bundles test-bundles docs-bundles static-libs-bundles
1108 
1109 ALL_TARGETS += buildtools hotspot hotspot-libs hotspot-gensrc gensrc gendata \
<span class="line-modified">1110     copy java libs static-libs launchers jmods \</span>
1111     jdk.jdwp.agent-gensrc $(ALL_MODULES) demos \
1112     exploded-image-base exploded-image \
1113     create-buildjdk docs-jdk-api docs-javase-api docs-reference-api docs-jdk \
1114     docs-javase docs-reference docs-javadoc mac-bundles product-images legacy-images \
1115     docs-image test-image all-images \
1116     all-bundles
1117 
1118 ################################################################################
1119 
1120 # Traditional targets typically run by users.
1121 # These can be considered aliases for the targets now named by a more
1122 # &quot;modern&quot; naming scheme.
1123 default: $(DEFAULT_MAKE_TARGET)
1124 jdk: exploded-image
1125 images: product-images
1126 docs: docs-image
1127 bundles: all-bundles
1128 all: all-images
1129 
1130 ALL_TARGETS += default jdk images docs bundles all
</pre>
</td>
</tr>
</table>
<center><a href="Init.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="RunTests.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>