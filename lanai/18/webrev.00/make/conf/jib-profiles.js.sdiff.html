<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/conf/jib-profiles.js</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="../common/SetupJavaCompilers.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="../data/charsetmapping/MS950.map.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/conf/jib-profiles.js</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 234     var common = {};
 235 
 236     common.organization = &quot;jpg.infra.builddeps&quot;;
 237     common.build_id = getBuildId(input);
 238     common.build_number = input.build_number != null ? input.build_number : &quot;0&quot;;
 239 
 240     // List of the main profile names used for iteration
 241     common.main_profile_names = [
 242         &quot;linux-x64&quot;, &quot;linux-x86&quot;, &quot;macosx-x64&quot;, &quot;solaris-x64&quot;,
 243         &quot;solaris-sparcv9&quot;, &quot;windows-x64&quot;, &quot;windows-x86&quot;,
 244         &quot;linux-aarch64&quot;, &quot;linux-arm32&quot;, &quot;linux-ppc64le&quot;, &quot;linux-s390x&quot;
 245     ];
 246 
 247     // These are the base setttings for all the main build profiles.
 248     common.main_profile_base = {
 249         dependencies: [&quot;boot_jdk&quot;, &quot;gnumake&quot;, &quot;jtreg&quot;, &quot;jib&quot;, &quot;autoconf&quot;, &quot;jmh&quot;, &quot;jcov&quot;],
 250         default_make_targets: [&quot;product-bundles&quot;, &quot;test-bundles&quot;, &quot;static-libs-bundles&quot;],
 251         configure_args: concat([&quot;--enable-jtreg-failure-handler&quot;],
 252             &quot;--with-exclude-translations=de,es,fr,it,ko,pt_BR,sv,ca,tr,cs,sk,ja_JP_A,ja_JP_HA,ja_JP_HI,ja_JP_I,zh_TW,zh_HK&quot;,
 253             &quot;--disable-manpages&quot;,
<span class="line-modified"> 254             &quot;--with-jvm-features=-shenandoahgc&quot;,</span>
 255             versionArgs(input, common))
 256     };
 257     // Extra settings for debug profiles
 258     common.debug_suffix = &quot;-debug&quot;;
 259     common.debug_profile_base = {
 260         configure_args: [&quot;--enable-debug&quot;],
 261         labels: &quot;debug&quot;
 262     };
 263     // Extra settings for slowdebug profiles
 264     common.slowdebug_suffix = &quot;-slowdebug&quot;;
 265     common.slowdebug_profile_base = {
 266         configure_args: [&quot;--with-debug-level=slowdebug&quot;],
 267         labels: &quot;slowdebug&quot;
 268     };
 269     // Extra settings for openjdk only profiles
 270     common.open_suffix = &quot;-open&quot;;
 271     common.open_profile_base = {
 272         configure_args: [&quot;--enable-openjdk-only&quot;],
 273         labels: &quot;open&quot;
 274     };
</pre>
<hr />
<pre>
 449             target_os: &quot;windows&quot;,
 450             target_cpu: &quot;x64&quot;,
 451             dependencies: [&quot;devkit&quot;, &quot;pandoc&quot;, &quot;graalunit_lib&quot;],
 452             configure_args: concat(common.configure_args_64bit),
 453         },
 454 
 455         &quot;windows-x86&quot;: {
 456             target_os: &quot;windows&quot;,
 457             target_cpu: &quot;x86&quot;,
 458             build_cpu: &quot;x64&quot;,
 459             dependencies: [&quot;devkit&quot;],
 460             configure_args: concat(common.configure_args_32bit),
 461         },
 462 
 463         &quot;linux-aarch64&quot;: {
 464             target_os: &quot;linux&quot;,
 465             target_cpu: &quot;aarch64&quot;,
 466             build_cpu: &quot;x64&quot;,
 467             dependencies: [&quot;devkit&quot;, &quot;build_devkit&quot;, &quot;cups&quot;],
 468             configure_args: [
<span class="line-modified"> 469                 &quot;--openjdk-target=aarch64-linux-gnu&quot;, &quot;--with-freetype=bundled&quot;,</span>
<span class="line-removed"> 470                 &quot;--disable-warnings-as-errors&quot;</span>
 471             ],
 472         },
 473 
 474         &quot;linux-arm32&quot;: {
 475             target_os: &quot;linux&quot;,
 476             target_cpu: &quot;arm&quot;,
 477             build_cpu: &quot;x64&quot;,
 478             dependencies: [&quot;devkit&quot;, &quot;build_devkit&quot;, &quot;cups&quot;],
 479             configure_args: [
 480                 &quot;--openjdk-target=arm-linux-gnueabihf&quot;, &quot;--with-freetype=bundled&quot;,
 481                 &quot;--with-abi-profile=arm-vfp-hflt&quot;, &quot;--disable-warnings-as-errors&quot;
 482             ],
 483         },
 484 
 485         &quot;linux-ppc64le&quot;: {
 486             target_os: &quot;linux&quot;,
 487             target_cpu: &quot;ppc64le&quot;,
 488             build_cpu: &quot;x64&quot;,
 489             dependencies: [&quot;devkit&quot;, &quot;build_devkit&quot;, &quot;cups&quot;],
 490             configure_args: [
</pre>
<hr />
<pre>
 522         profiles[debugName] = concatObjects(profiles[name],
 523                                             common.slowdebug_profile_base);
 524     });
 525     // Generate testmake profiles for the main profile of each build host
 526     // platform. This profile only runs the makefile tests.
 527     // Ant is needed to run the idea project generator test.
 528     var testmakeBase = {
 529         dependencies: [ &quot;ant&quot; ],
 530         environment: {
 531             &quot;ANT_HOME&quot;: input.get(&quot;ant&quot;, &quot;home_path&quot;)
 532         }
 533     };
 534     [ &quot;linux-x64&quot;, &quot;macosx-x64&quot;, &quot;solaris-sparcv9&quot;, &quot;solaris-x64&quot;, &quot;windows-x64&quot;]
 535         .forEach(function (name) {
 536             var maketestName = name + &quot;-testmake&quot;;
 537             profiles[maketestName] = concatObjects(profiles[name], testmakeBase);
 538             profiles[maketestName].default_make_targets = [ &quot;test-make&quot; ];
 539         });
 540 
 541     // Generate -gcov profiles
<span class="line-modified"> 542     [ &quot;linux-x64&quot;, &quot;macosx-x64&quot; ].forEach(function (name) {</span>
 543         var gcovName = name + &quot;-gcov&quot;;
 544         profiles[gcovName] = clone(profiles[name]);
 545         profiles[gcovName].default_make_targets = [&quot;product-bundles&quot;, &quot;test-bundles&quot;];
 546         profiles[gcovName].configure_args = concat(profiles[gcovName].configure_args,
 547             [&quot;--enable-native-coverage&quot;, &quot;--disable-warnings-as-errors&quot;]);
 548     });
 549 
 550     // Profiles for building the zero jvm variant. These are used for verification.
 551     var zeroProfiles = {
 552         &quot;linux-x64-zero&quot;: {
 553             target_os: &quot;linux&quot;,
 554             target_cpu: &quot;x64&quot;,
 555             dependencies: [&quot;devkit&quot;],
 556             configure_args: concat(common.configure_args_64bit, [
 557                 &quot;--with-zlib=system&quot;,
 558                 &quot;--with-jvm-variants=zero&quot;,
 559                 &quot;--enable-libffi-bundling&quot;
 560             ])
 561         },
 562 
</pre>
<hr />
<pre>
 609         .forEach(function (name) {
 610             var bootcycleName = name + &quot;-bootcycle&quot;;
 611             var bootcyclePrebuiltName = name + &quot;-bootcycle-prebuilt&quot;;
 612             // The base bootcycle profile just changes the default target
 613             // compared to the base profile
 614             profiles[bootcycleName] = clone(profiles[name]);
 615             profiles[bootcycleName].default_make_targets = [ &quot;bootcycle-images&quot; ];
 616             // The prebuilt bootcycle variant modifies the boot jdk argument
 617             var bootcyclePrebuiltBase = {
 618                 dependencies: [ name + &quot;.jdk&quot; ],
 619                 configure_args: &quot;--with-boot-jdk=&quot; + input.get(name + &quot;.jdk&quot;, &quot;home_path&quot;),
 620             }
 621             profiles[bootcyclePrebuiltName] = concatObjects(profiles[name],
 622                 bootcyclePrebuiltBase);
 623             var bootJdkIndex = profiles[bootcyclePrebuiltName].dependencies.indexOf(&quot;boot_jdk&quot;);
 624             delete profiles[bootcyclePrebuiltName].dependencies[bootJdkIndex];
 625             profiles[bootcyclePrebuiltName].default_make_targets = [ &quot;product-images&quot; ];
 626         });
 627 
 628     // JCov profiles build JCov-instrumented JDK image based on images provided through dependencies.
<span class="line-modified"> 629     [ &quot;linux-x64&quot;, &quot;macosx-x64&quot;, &quot;solaris-sparcv9&quot;, &quot;windows-x64&quot;]</span>
 630         .forEach(function (name) {
 631             var jcovName = name + &quot;-jcov&quot;;
 632             profiles[jcovName] = clone(common.main_profile_base);
 633             profiles[jcovName].target_os = profiles[name].target_os
 634             profiles[jcovName].target_cpu = profiles[name].target_cpu
 635             profiles[jcovName].default_make_targets = [ &quot;jcov-bundles&quot; ];
 636             profiles[jcovName].dependencies = concat(profiles[jcovName].dependencies,
 637                 [ name + &quot;.jdk&quot;, &quot;devkit&quot; ]);
 638             profiles[jcovName].configure_args = concat(profiles[jcovName].configure_args,
 639                 [&quot;--with-jcov-input-jdk=&quot; + input.get(name + &quot;.jdk&quot;, &quot;home_path&quot;)]);
 640         });
 641 
 642     //
 643     // Define artifacts for profiles
 644     //
 645     // Macosx bundles are named osx
 646     // tar.gz.
 647     var artifactData = {
 648         &quot;linux-x64&quot;: {
 649             platform: &quot;linux-x64&quot;,
</pre>
<hr />
<pre>
 766     // corresponding debug profile. This profile does a compare build run with no
 767     // changes to verify that the compare script has a clean baseline
 768     common.main_profile_names.forEach(function (name) {
 769         [ &quot;&quot;, common.open_suffix ].forEach(function (suffix) {
 770             var cmpBaselineName = name + suffix + &quot;-cmp-baseline&quot;;
 771             profiles[cmpBaselineName] = clone(profiles[name + suffix]);
 772             // Only compare the images target. This should pressumably be expanded
 773             // to include more build targets when possible.
 774             profiles[cmpBaselineName].default_make_targets = [ &quot;images&quot;, &quot;test-image&quot; ];
 775             if (name == &quot;linux-x64&quot;) {
 776                 profiles[cmpBaselineName].default_make_targets
 777                     = concat(profiles[cmpBaselineName].default_make_targets, &quot;docs&quot;);
 778             }
 779             profiles[cmpBaselineName].make_args = [ &quot;COMPARE_BUILD=CONF=&quot; ];
 780             // Do not inherit artifact definitions from base profile
 781             delete profiles[cmpBaselineName].artifacts;
 782         });
 783     });
 784 
 785     // Artifacts of JCov profiles
<span class="line-modified"> 786     [ &quot;linux-x64&quot;, &quot;macosx-x64&quot;, &quot;solaris-sparcv9&quot;, &quot;windows-x64&quot;]</span>
 787         .forEach(function (name) {
 788             var o = artifactData[name]
 789             var jdk_subdir = (o.jdk_subdir != null ? o.jdk_subdir : &quot;jdk-&quot; + data.version);
 790             var jdk_suffix = (o.jdk_suffix != null ? o.jdk_suffix : &quot;tar.gz&quot;);
 791             var pf = o.platform
 792             var jcovName = name + &quot;-jcov&quot;;
 793             profiles[jcovName].artifacts = {
 794                 jdk: {
 795                     local: &quot;bundles/\\(jdk-jcov.*bin.&quot; + jdk_suffix + &quot;\\)&quot;,
 796                     remote: [
 797                         &quot;bundles/&quot; + pf + &quot;/jdk-jcov-&quot; + data.version + &quot;_&quot; + pf + &quot;_bin.&quot; + jdk_suffix
 798                     ],
 799                     subdir: jdk_subdir,
 800                     exploded: &quot;images/jdk-jcov&quot;
 801                 }
 802             };
 803         });
 804 
 805     // Artifacts of gcov (native-code-coverage) profiles
<span class="line-modified"> 806     [ &quot;linux-x64&quot;, &quot;macosx-x64&quot; ].forEach(function (name) {</span>
 807         var o = artifactData[name]
 808         var pf = o.platform
 809         var jdk_subdir = (o.jdk_subdir != null ? o.jdk_subdir : &quot;jdk-&quot; + data.version);
 810         var jdk_suffix = (o.jdk_suffix != null ? o.jdk_suffix : &quot;tar.gz&quot;);
 811         var gcovName = name + &quot;-gcov&quot;;
 812         profiles[gcovName].artifacts = {
 813             jdk: {
 814                 local: &quot;bundles/\\(jdk.*bin.&quot; + jdk_suffix + &quot;\\)&quot;,
 815                 remote: [
 816                     &quot;bundles/&quot; + pf + &quot;/jdk-&quot; + data.version + &quot;_&quot; + pf + &quot;_bin-gcov.&quot; + jdk_suffix,
 817                 ],
 818                 subdir: jdk_subdir,
 819                 exploded: &quot;images/jdk&quot;,
 820             },
 821             test: {
 822                     local: &quot;bundles/\\(jdk.*bin-tests.tar.gz\\)&quot;,
 823                     remote: [
 824                         &quot;bundles/&quot; + pf + &quot;/jdk-&quot; + data.version + &quot;_&quot; + pf + &quot;_bin-gcov-tests.tar.gz&quot;,
 825                     ],
 826                     exploded: &quot;images/test&quot;
</pre>
<hr />
<pre>
 849         }
 850     };
 851     profiles = concatObjects(profiles, testOnlyProfiles);
 852 
 853     // Profiles used to run tests using Jib for internal dependencies.
 854     var testedProfile = input.testedProfile;
 855     if (testedProfile == null) {
 856         testedProfile = input.build_os + &quot;-&quot; + input.build_cpu;
 857     }
 858     var testedProfileJdk = testedProfile + &quot;.jdk&quot;;
 859     // Make it possible to use the test image from a different profile
 860     var testImageProfile;
 861     if (input.testImageProfile != null) {
 862         testImageProfile = input.testImageProfile;
 863     } else if (testedProfile.endsWith(&quot;-jcov&quot;)) {
 864         testImageProfile = testedProfile.substring(0, testedProfile.length - &quot;-jcov&quot;.length);
 865     } else {
 866         testImageProfile = testedProfile;
 867     }
 868     var testedProfileTest = testImageProfile + &quot;.test&quot;
<span class="line-modified"> 869     var testOnlyMake = [ &quot;run-test-prebuilt&quot;, &quot;LOG_CMDLINES=true&quot;, &quot;JTREG_VERBOSE=fail,error,time&quot; ];</span>
 870     if (testedProfile.endsWith(&quot;-gcov&quot;)) {
 871         testOnlyMake = concat(testOnlyMake, &quot;GCOV_ENABLED=true&quot;)
 872     }
 873     var testOnlyProfilesPrebuilt = {
 874         &quot;run-test-prebuilt&quot;: {
 875             target_os: input.build_os,
 876             target_cpu: input.build_cpu,
 877             dependencies: [
 878                 &quot;jtreg&quot;, &quot;gnumake&quot;, &quot;boot_jdk&quot;, &quot;devkit&quot;, &quot;jib&quot;, &quot;jcov&quot;, testedProfileJdk,
 879                 testedProfileTest
 880             ],
 881             src: &quot;src.conf&quot;,
 882             make_args: testOnlyMake,
 883             environment: {
 884                 &quot;BOOT_JDK&quot;: common.boot_jdk_home,
 885                 &quot;JDK_IMAGE_DIR&quot;: input.get(testedProfileJdk, &quot;home_path&quot;),
 886                 &quot;TEST_IMAGE_DIR&quot;: input.get(testedProfileTest, &quot;home_path&quot;)
 887             },
 888             labels: &quot;test&quot;
 889         }
</pre>
<hr />
<pre>
 957     profiles = generatePlatformAttributes(profiles);
 958     profiles = generateDefaultMakeTargetsConfigureArg(common, profiles);
 959     return profiles;
 960 };
 961 
 962 /**
 963  * Generate the dependencies part of the configuration
 964  *
 965  * @param input External data to use for generating the configuration
 966  * @param common The common values
 967  * @returns {{}} Dependencies part of configuration
 968  */
 969 var getJibProfilesDependencies = function (input, common) {
 970 
 971     var devkit_platform_revisions = {
 972         linux_x64: &quot;gcc8.3.0-OL6.4+1.0&quot;,
 973         macosx_x64: &quot;Xcode10.1-MacOSX10.14+1.0&quot;,
 974         solaris_x64: &quot;SS12u4-Solaris11u1+1.0&quot;,
 975         solaris_sparcv9: &quot;SS12u6-Solaris11u3+1.0&quot;,
 976         windows_x64: &quot;VS2017-15.9.16+1.0&quot;,
<span class="line-modified"> 977         linux_aarch64: &quot;gcc8.2.0-Fedora27+1.0&quot;,</span>
 978         linux_arm: &quot;gcc8.2.0-Fedora27+1.0&quot;,
 979         linux_ppc64le: &quot;gcc8.2.0-Fedora27+1.0&quot;,
 980         linux_s390x: &quot;gcc8.2.0-Fedora27+1.0&quot;
 981     };
 982 
 983     var devkit_platform = (input.target_cpu == &quot;x86&quot;
 984         ? input.target_os + &quot;_x64&quot;
 985         : input.target_platform);
 986 
 987     var devkit_cross_prefix = &quot;&quot;;
 988     if (input.build_platform != input.target_platform
 989        &amp;&amp; input.build_platform != devkit_platform) {
 990         devkit_cross_prefix = input.build_platform + &quot;-to-&quot;;
 991     }
 992 
 993     var boot_jdk_platform = (input.build_os == &quot;macosx&quot; ? &quot;osx&quot; : input.build_os)
 994         + &quot;-&quot; + input.build_cpu;
 995     var boot_jdk_ext = (input.build_os == &quot;windows&quot; ? &quot;.zip&quot; : &quot;.tar.gz&quot;)
 996     // If running in WSL and building for Windows, it will look like Linux,
 997     // but we need a Windows boot JDK.
 998     if (isWsl(input) &amp;&amp; input.target_os == &quot;windows&quot;) {
 999         boot_jdk_platform = &quot;windows-&quot; + input.build_cpu;
1000         boot_jdk_ext = &quot;.zip&quot;;
1001     }
1002 
1003     var makeBinDir = (input.build_os == &quot;windows&quot;
1004         ? input.get(&quot;gnumake&quot;, &quot;install_path&quot;) + &quot;/cygwin/bin&quot;
1005         : input.get(&quot;gnumake&quot;, &quot;install_path&quot;) + &quot;/bin&quot;);
1006 
<span class="line-modified">1007     var dependencies = {</span>
<span class="line-modified">1008 </span>
<span class="line-modified">1009         boot_jdk: {</span>








1010             server: &quot;jpg&quot;,
1011             product: &quot;jdk&quot;,
1012             version: common.boot_jdk_version,
1013             build_number: common.boot_jdk_build_number,
1014             file: &quot;bundles/&quot; + boot_jdk_platform + &quot;/jdk-&quot; + common.boot_jdk_version + &quot;_&quot;
1015                 + boot_jdk_platform + &quot;_bin&quot; + boot_jdk_ext,
1016             configure_args: &quot;--with-boot-jdk=&quot; + common.boot_jdk_home,
1017             environment_path: common.boot_jdk_home + &quot;/bin&quot;
<span class="line-modified">1018         },</span>




1019 
1020         devkit: {
1021             organization: common.organization,
1022             ext: &quot;tar.gz&quot;,
1023             module: &quot;devkit-&quot; + devkit_cross_prefix + devkit_platform,
1024             revision: devkit_platform_revisions[devkit_platform],
1025             environment: {
1026                 &quot;DEVKIT_HOME&quot;: input.get(&quot;devkit&quot;, &quot;home_path&quot;),
1027             }
1028         },
1029 
1030         build_devkit: {
1031             organization: common.organization,
1032             ext: &quot;tar.gz&quot;,
1033             module: &quot;devkit-&quot; + input.build_platform,
1034             revision: devkit_platform_revisions[input.build_platform]
1035         },
1036 
1037         cups: {
1038             organization: common.organization,
1039             ext: &quot;tar.gz&quot;,
1040             revision: &quot;1.0118+1.0&quot;
1041         },
1042 
1043         jtreg: {
<span class="line-modified">1044             server: &quot;javare&quot;,</span>
<span class="line-modified">1045             revision: &quot;4.2&quot;,</span>
<span class="line-modified">1046             build_number: &quot;b16&quot;,</span>

1047             checksum_file: &quot;MD5_VALUES&quot;,
<span class="line-modified">1048             file: &quot;jtreg_bin-4.2.zip&quot;,</span>
1049             environment_name: &quot;JT_HOME&quot;,
1050             environment_path: input.get(&quot;jtreg&quot;, &quot;install_path&quot;) + &quot;/jtreg/bin&quot;
1051         },
1052 
1053         jmh: {
1054             organization: common.organization,
1055             ext: &quot;tar.gz&quot;,
1056             revision: &quot;1.21+1.0&quot;
1057         },
1058 
1059         jcov: {
1060             // Until an official build of JCov is available, use custom
1061             // build to support classfile version 57.
1062             // See CODETOOLS-7902358 for more info.
1063             // server: &quot;jpg&quot;,
1064             // product: &quot;jcov&quot;,
1065             // version: &quot;3.0&quot;,
1066             // build_number: &quot;b07&quot;,
1067             // file: &quot;bundles/jcov-3_0.zip&quot;,
1068             organization: common.organization,
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2015, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 234     var common = {};
 235 
 236     common.organization = &quot;jpg.infra.builddeps&quot;;
 237     common.build_id = getBuildId(input);
 238     common.build_number = input.build_number != null ? input.build_number : &quot;0&quot;;
 239 
 240     // List of the main profile names used for iteration
 241     common.main_profile_names = [
 242         &quot;linux-x64&quot;, &quot;linux-x86&quot;, &quot;macosx-x64&quot;, &quot;solaris-x64&quot;,
 243         &quot;solaris-sparcv9&quot;, &quot;windows-x64&quot;, &quot;windows-x86&quot;,
 244         &quot;linux-aarch64&quot;, &quot;linux-arm32&quot;, &quot;linux-ppc64le&quot;, &quot;linux-s390x&quot;
 245     ];
 246 
 247     // These are the base setttings for all the main build profiles.
 248     common.main_profile_base = {
 249         dependencies: [&quot;boot_jdk&quot;, &quot;gnumake&quot;, &quot;jtreg&quot;, &quot;jib&quot;, &quot;autoconf&quot;, &quot;jmh&quot;, &quot;jcov&quot;],
 250         default_make_targets: [&quot;product-bundles&quot;, &quot;test-bundles&quot;, &quot;static-libs-bundles&quot;],
 251         configure_args: concat([&quot;--enable-jtreg-failure-handler&quot;],
 252             &quot;--with-exclude-translations=de,es,fr,it,ko,pt_BR,sv,ca,tr,cs,sk,ja_JP_A,ja_JP_HA,ja_JP_HI,ja_JP_I,zh_TW,zh_HK&quot;,
 253             &quot;--disable-manpages&quot;,
<span class="line-modified"> 254             &quot;--disable-jvm-feature-shenandoahgc&quot;,</span>
 255             versionArgs(input, common))
 256     };
 257     // Extra settings for debug profiles
 258     common.debug_suffix = &quot;-debug&quot;;
 259     common.debug_profile_base = {
 260         configure_args: [&quot;--enable-debug&quot;],
 261         labels: &quot;debug&quot;
 262     };
 263     // Extra settings for slowdebug profiles
 264     common.slowdebug_suffix = &quot;-slowdebug&quot;;
 265     common.slowdebug_profile_base = {
 266         configure_args: [&quot;--with-debug-level=slowdebug&quot;],
 267         labels: &quot;slowdebug&quot;
 268     };
 269     // Extra settings for openjdk only profiles
 270     common.open_suffix = &quot;-open&quot;;
 271     common.open_profile_base = {
 272         configure_args: [&quot;--enable-openjdk-only&quot;],
 273         labels: &quot;open&quot;
 274     };
</pre>
<hr />
<pre>
 449             target_os: &quot;windows&quot;,
 450             target_cpu: &quot;x64&quot;,
 451             dependencies: [&quot;devkit&quot;, &quot;pandoc&quot;, &quot;graalunit_lib&quot;],
 452             configure_args: concat(common.configure_args_64bit),
 453         },
 454 
 455         &quot;windows-x86&quot;: {
 456             target_os: &quot;windows&quot;,
 457             target_cpu: &quot;x86&quot;,
 458             build_cpu: &quot;x64&quot;,
 459             dependencies: [&quot;devkit&quot;],
 460             configure_args: concat(common.configure_args_32bit),
 461         },
 462 
 463         &quot;linux-aarch64&quot;: {
 464             target_os: &quot;linux&quot;,
 465             target_cpu: &quot;aarch64&quot;,
 466             build_cpu: &quot;x64&quot;,
 467             dependencies: [&quot;devkit&quot;, &quot;build_devkit&quot;, &quot;cups&quot;],
 468             configure_args: [
<span class="line-modified"> 469                 &quot;--openjdk-target=aarch64-linux-gnu&quot;,</span>

 470             ],
 471         },
 472 
 473         &quot;linux-arm32&quot;: {
 474             target_os: &quot;linux&quot;,
 475             target_cpu: &quot;arm&quot;,
 476             build_cpu: &quot;x64&quot;,
 477             dependencies: [&quot;devkit&quot;, &quot;build_devkit&quot;, &quot;cups&quot;],
 478             configure_args: [
 479                 &quot;--openjdk-target=arm-linux-gnueabihf&quot;, &quot;--with-freetype=bundled&quot;,
 480                 &quot;--with-abi-profile=arm-vfp-hflt&quot;, &quot;--disable-warnings-as-errors&quot;
 481             ],
 482         },
 483 
 484         &quot;linux-ppc64le&quot;: {
 485             target_os: &quot;linux&quot;,
 486             target_cpu: &quot;ppc64le&quot;,
 487             build_cpu: &quot;x64&quot;,
 488             dependencies: [&quot;devkit&quot;, &quot;build_devkit&quot;, &quot;cups&quot;],
 489             configure_args: [
</pre>
<hr />
<pre>
 521         profiles[debugName] = concatObjects(profiles[name],
 522                                             common.slowdebug_profile_base);
 523     });
 524     // Generate testmake profiles for the main profile of each build host
 525     // platform. This profile only runs the makefile tests.
 526     // Ant is needed to run the idea project generator test.
 527     var testmakeBase = {
 528         dependencies: [ &quot;ant&quot; ],
 529         environment: {
 530             &quot;ANT_HOME&quot;: input.get(&quot;ant&quot;, &quot;home_path&quot;)
 531         }
 532     };
 533     [ &quot;linux-x64&quot;, &quot;macosx-x64&quot;, &quot;solaris-sparcv9&quot;, &quot;solaris-x64&quot;, &quot;windows-x64&quot;]
 534         .forEach(function (name) {
 535             var maketestName = name + &quot;-testmake&quot;;
 536             profiles[maketestName] = concatObjects(profiles[name], testmakeBase);
 537             profiles[maketestName].default_make_targets = [ &quot;test-make&quot; ];
 538         });
 539 
 540     // Generate -gcov profiles
<span class="line-modified"> 541     [ &quot;linux-aarch64&quot;, &quot;linux-x64&quot;, &quot;macosx-x64&quot; ].forEach(function (name) {</span>
 542         var gcovName = name + &quot;-gcov&quot;;
 543         profiles[gcovName] = clone(profiles[name]);
 544         profiles[gcovName].default_make_targets = [&quot;product-bundles&quot;, &quot;test-bundles&quot;];
 545         profiles[gcovName].configure_args = concat(profiles[gcovName].configure_args,
 546             [&quot;--enable-native-coverage&quot;, &quot;--disable-warnings-as-errors&quot;]);
 547     });
 548 
 549     // Profiles for building the zero jvm variant. These are used for verification.
 550     var zeroProfiles = {
 551         &quot;linux-x64-zero&quot;: {
 552             target_os: &quot;linux&quot;,
 553             target_cpu: &quot;x64&quot;,
 554             dependencies: [&quot;devkit&quot;],
 555             configure_args: concat(common.configure_args_64bit, [
 556                 &quot;--with-zlib=system&quot;,
 557                 &quot;--with-jvm-variants=zero&quot;,
 558                 &quot;--enable-libffi-bundling&quot;
 559             ])
 560         },
 561 
</pre>
<hr />
<pre>
 608         .forEach(function (name) {
 609             var bootcycleName = name + &quot;-bootcycle&quot;;
 610             var bootcyclePrebuiltName = name + &quot;-bootcycle-prebuilt&quot;;
 611             // The base bootcycle profile just changes the default target
 612             // compared to the base profile
 613             profiles[bootcycleName] = clone(profiles[name]);
 614             profiles[bootcycleName].default_make_targets = [ &quot;bootcycle-images&quot; ];
 615             // The prebuilt bootcycle variant modifies the boot jdk argument
 616             var bootcyclePrebuiltBase = {
 617                 dependencies: [ name + &quot;.jdk&quot; ],
 618                 configure_args: &quot;--with-boot-jdk=&quot; + input.get(name + &quot;.jdk&quot;, &quot;home_path&quot;),
 619             }
 620             profiles[bootcyclePrebuiltName] = concatObjects(profiles[name],
 621                 bootcyclePrebuiltBase);
 622             var bootJdkIndex = profiles[bootcyclePrebuiltName].dependencies.indexOf(&quot;boot_jdk&quot;);
 623             delete profiles[bootcyclePrebuiltName].dependencies[bootJdkIndex];
 624             profiles[bootcyclePrebuiltName].default_make_targets = [ &quot;product-images&quot; ];
 625         });
 626 
 627     // JCov profiles build JCov-instrumented JDK image based on images provided through dependencies.
<span class="line-modified"> 628     [ &quot;linux-aarch64&quot;, &quot;linux-x64&quot;, &quot;macosx-x64&quot;, &quot;solaris-sparcv9&quot;, &quot;windows-x64&quot;]</span>
 629         .forEach(function (name) {
 630             var jcovName = name + &quot;-jcov&quot;;
 631             profiles[jcovName] = clone(common.main_profile_base);
 632             profiles[jcovName].target_os = profiles[name].target_os
 633             profiles[jcovName].target_cpu = profiles[name].target_cpu
 634             profiles[jcovName].default_make_targets = [ &quot;jcov-bundles&quot; ];
 635             profiles[jcovName].dependencies = concat(profiles[jcovName].dependencies,
 636                 [ name + &quot;.jdk&quot;, &quot;devkit&quot; ]);
 637             profiles[jcovName].configure_args = concat(profiles[jcovName].configure_args,
 638                 [&quot;--with-jcov-input-jdk=&quot; + input.get(name + &quot;.jdk&quot;, &quot;home_path&quot;)]);
 639         });
 640 
 641     //
 642     // Define artifacts for profiles
 643     //
 644     // Macosx bundles are named osx
 645     // tar.gz.
 646     var artifactData = {
 647         &quot;linux-x64&quot;: {
 648             platform: &quot;linux-x64&quot;,
</pre>
<hr />
<pre>
 765     // corresponding debug profile. This profile does a compare build run with no
 766     // changes to verify that the compare script has a clean baseline
 767     common.main_profile_names.forEach(function (name) {
 768         [ &quot;&quot;, common.open_suffix ].forEach(function (suffix) {
 769             var cmpBaselineName = name + suffix + &quot;-cmp-baseline&quot;;
 770             profiles[cmpBaselineName] = clone(profiles[name + suffix]);
 771             // Only compare the images target. This should pressumably be expanded
 772             // to include more build targets when possible.
 773             profiles[cmpBaselineName].default_make_targets = [ &quot;images&quot;, &quot;test-image&quot; ];
 774             if (name == &quot;linux-x64&quot;) {
 775                 profiles[cmpBaselineName].default_make_targets
 776                     = concat(profiles[cmpBaselineName].default_make_targets, &quot;docs&quot;);
 777             }
 778             profiles[cmpBaselineName].make_args = [ &quot;COMPARE_BUILD=CONF=&quot; ];
 779             // Do not inherit artifact definitions from base profile
 780             delete profiles[cmpBaselineName].artifacts;
 781         });
 782     });
 783 
 784     // Artifacts of JCov profiles
<span class="line-modified"> 785     [ &quot;linux-aarch64&quot;, &quot;linux-x64&quot;, &quot;macosx-x64&quot;, &quot;solaris-sparcv9&quot;, &quot;windows-x64&quot;]</span>
 786         .forEach(function (name) {
 787             var o = artifactData[name]
 788             var jdk_subdir = (o.jdk_subdir != null ? o.jdk_subdir : &quot;jdk-&quot; + data.version);
 789             var jdk_suffix = (o.jdk_suffix != null ? o.jdk_suffix : &quot;tar.gz&quot;);
 790             var pf = o.platform
 791             var jcovName = name + &quot;-jcov&quot;;
 792             profiles[jcovName].artifacts = {
 793                 jdk: {
 794                     local: &quot;bundles/\\(jdk-jcov.*bin.&quot; + jdk_suffix + &quot;\\)&quot;,
 795                     remote: [
 796                         &quot;bundles/&quot; + pf + &quot;/jdk-jcov-&quot; + data.version + &quot;_&quot; + pf + &quot;_bin.&quot; + jdk_suffix
 797                     ],
 798                     subdir: jdk_subdir,
 799                     exploded: &quot;images/jdk-jcov&quot;
 800                 }
 801             };
 802         });
 803 
 804     // Artifacts of gcov (native-code-coverage) profiles
<span class="line-modified"> 805     [ &quot;linux-aarch64&quot;, &quot;linux-x64&quot;, &quot;macosx-x64&quot; ].forEach(function (name) {</span>
 806         var o = artifactData[name]
 807         var pf = o.platform
 808         var jdk_subdir = (o.jdk_subdir != null ? o.jdk_subdir : &quot;jdk-&quot; + data.version);
 809         var jdk_suffix = (o.jdk_suffix != null ? o.jdk_suffix : &quot;tar.gz&quot;);
 810         var gcovName = name + &quot;-gcov&quot;;
 811         profiles[gcovName].artifacts = {
 812             jdk: {
 813                 local: &quot;bundles/\\(jdk.*bin.&quot; + jdk_suffix + &quot;\\)&quot;,
 814                 remote: [
 815                     &quot;bundles/&quot; + pf + &quot;/jdk-&quot; + data.version + &quot;_&quot; + pf + &quot;_bin-gcov.&quot; + jdk_suffix,
 816                 ],
 817                 subdir: jdk_subdir,
 818                 exploded: &quot;images/jdk&quot;,
 819             },
 820             test: {
 821                     local: &quot;bundles/\\(jdk.*bin-tests.tar.gz\\)&quot;,
 822                     remote: [
 823                         &quot;bundles/&quot; + pf + &quot;/jdk-&quot; + data.version + &quot;_&quot; + pf + &quot;_bin-gcov-tests.tar.gz&quot;,
 824                     ],
 825                     exploded: &quot;images/test&quot;
</pre>
<hr />
<pre>
 848         }
 849     };
 850     profiles = concatObjects(profiles, testOnlyProfiles);
 851 
 852     // Profiles used to run tests using Jib for internal dependencies.
 853     var testedProfile = input.testedProfile;
 854     if (testedProfile == null) {
 855         testedProfile = input.build_os + &quot;-&quot; + input.build_cpu;
 856     }
 857     var testedProfileJdk = testedProfile + &quot;.jdk&quot;;
 858     // Make it possible to use the test image from a different profile
 859     var testImageProfile;
 860     if (input.testImageProfile != null) {
 861         testImageProfile = input.testImageProfile;
 862     } else if (testedProfile.endsWith(&quot;-jcov&quot;)) {
 863         testImageProfile = testedProfile.substring(0, testedProfile.length - &quot;-jcov&quot;.length);
 864     } else {
 865         testImageProfile = testedProfile;
 866     }
 867     var testedProfileTest = testImageProfile + &quot;.test&quot;
<span class="line-modified"> 868     var testOnlyMake = [ &quot;test-prebuilt&quot;, &quot;LOG_CMDLINES=true&quot;, &quot;JTREG_VERBOSE=fail,error,time&quot; ];</span>
 869     if (testedProfile.endsWith(&quot;-gcov&quot;)) {
 870         testOnlyMake = concat(testOnlyMake, &quot;GCOV_ENABLED=true&quot;)
 871     }
 872     var testOnlyProfilesPrebuilt = {
 873         &quot;run-test-prebuilt&quot;: {
 874             target_os: input.build_os,
 875             target_cpu: input.build_cpu,
 876             dependencies: [
 877                 &quot;jtreg&quot;, &quot;gnumake&quot;, &quot;boot_jdk&quot;, &quot;devkit&quot;, &quot;jib&quot;, &quot;jcov&quot;, testedProfileJdk,
 878                 testedProfileTest
 879             ],
 880             src: &quot;src.conf&quot;,
 881             make_args: testOnlyMake,
 882             environment: {
 883                 &quot;BOOT_JDK&quot;: common.boot_jdk_home,
 884                 &quot;JDK_IMAGE_DIR&quot;: input.get(testedProfileJdk, &quot;home_path&quot;),
 885                 &quot;TEST_IMAGE_DIR&quot;: input.get(testedProfileTest, &quot;home_path&quot;)
 886             },
 887             labels: &quot;test&quot;
 888         }
</pre>
<hr />
<pre>
 956     profiles = generatePlatformAttributes(profiles);
 957     profiles = generateDefaultMakeTargetsConfigureArg(common, profiles);
 958     return profiles;
 959 };
 960 
 961 /**
 962  * Generate the dependencies part of the configuration
 963  *
 964  * @param input External data to use for generating the configuration
 965  * @param common The common values
 966  * @returns {{}} Dependencies part of configuration
 967  */
 968 var getJibProfilesDependencies = function (input, common) {
 969 
 970     var devkit_platform_revisions = {
 971         linux_x64: &quot;gcc8.3.0-OL6.4+1.0&quot;,
 972         macosx_x64: &quot;Xcode10.1-MacOSX10.14+1.0&quot;,
 973         solaris_x64: &quot;SS12u4-Solaris11u1+1.0&quot;,
 974         solaris_sparcv9: &quot;SS12u6-Solaris11u3+1.0&quot;,
 975         windows_x64: &quot;VS2017-15.9.16+1.0&quot;,
<span class="line-modified"> 976         linux_aarch64: &quot;gcc8.3.0-OL7.6+1.0&quot;,</span>
 977         linux_arm: &quot;gcc8.2.0-Fedora27+1.0&quot;,
 978         linux_ppc64le: &quot;gcc8.2.0-Fedora27+1.0&quot;,
 979         linux_s390x: &quot;gcc8.2.0-Fedora27+1.0&quot;
 980     };
 981 
 982     var devkit_platform = (input.target_cpu == &quot;x86&quot;
 983         ? input.target_os + &quot;_x64&quot;
 984         : input.target_platform);
 985 
 986     var devkit_cross_prefix = &quot;&quot;;
 987     if (input.build_platform != input.target_platform
 988        &amp;&amp; input.build_platform != devkit_platform) {
 989         devkit_cross_prefix = input.build_platform + &quot;-to-&quot;;
 990     }
 991 
 992     var boot_jdk_platform = (input.build_os == &quot;macosx&quot; ? &quot;osx&quot; : input.build_os)
 993         + &quot;-&quot; + input.build_cpu;
 994     var boot_jdk_ext = (input.build_os == &quot;windows&quot; ? &quot;.zip&quot; : &quot;.tar.gz&quot;)
 995     // If running in WSL and building for Windows, it will look like Linux,
 996     // but we need a Windows boot JDK.
 997     if (isWsl(input) &amp;&amp; input.target_os == &quot;windows&quot;) {
 998         boot_jdk_platform = &quot;windows-&quot; + input.build_cpu;
 999         boot_jdk_ext = &quot;.zip&quot;;
1000     }
1001 
1002     var makeBinDir = (input.build_os == &quot;windows&quot;
1003         ? input.get(&quot;gnumake&quot;, &quot;install_path&quot;) + &quot;/cygwin/bin&quot;
1004         : input.get(&quot;gnumake&quot;, &quot;install_path&quot;) + &quot;/bin&quot;);
1005 
<span class="line-modified">1006     if (input.build_cpu == &#39;aarch64&#39;) {</span>
<span class="line-modified">1007 	boot_jdk = {</span>
<span class="line-modified">1008             organization: common.organization,</span>
<span class="line-added">1009             ext: &quot;tar.gz&quot;,</span>
<span class="line-added">1010             module: &quot;jdk-linux_aarch64&quot;,</span>
<span class="line-added">1011             revision: &quot;13+1.0&quot;,</span>
<span class="line-added">1012             configure_args: &quot;--with-boot-jdk=&quot; + common.boot_jdk_home,</span>
<span class="line-added">1013             environment_path: common.boot_jdk_home + &quot;/bin&quot;</span>
<span class="line-added">1014 	}</span>
<span class="line-added">1015     } else {</span>
<span class="line-added">1016 	boot_jdk = {</span>
1017             server: &quot;jpg&quot;,
1018             product: &quot;jdk&quot;,
1019             version: common.boot_jdk_version,
1020             build_number: common.boot_jdk_build_number,
1021             file: &quot;bundles/&quot; + boot_jdk_platform + &quot;/jdk-&quot; + common.boot_jdk_version + &quot;_&quot;
1022                 + boot_jdk_platform + &quot;_bin&quot; + boot_jdk_ext,
1023             configure_args: &quot;--with-boot-jdk=&quot; + common.boot_jdk_home,
1024             environment_path: common.boot_jdk_home + &quot;/bin&quot;
<span class="line-modified">1025 	}</span>
<span class="line-added">1026     }</span>
<span class="line-added">1027 </span>
<span class="line-added">1028     var dependencies = {</span>
<span class="line-added">1029         boot_jdk: boot_jdk,</span>
1030 
1031         devkit: {
1032             organization: common.organization,
1033             ext: &quot;tar.gz&quot;,
1034             module: &quot;devkit-&quot; + devkit_cross_prefix + devkit_platform,
1035             revision: devkit_platform_revisions[devkit_platform],
1036             environment: {
1037                 &quot;DEVKIT_HOME&quot;: input.get(&quot;devkit&quot;, &quot;home_path&quot;),
1038             }
1039         },
1040 
1041         build_devkit: {
1042             organization: common.organization,
1043             ext: &quot;tar.gz&quot;,
1044             module: &quot;devkit-&quot; + input.build_platform,
1045             revision: devkit_platform_revisions[input.build_platform]
1046         },
1047 
1048         cups: {
1049             organization: common.organization,
1050             ext: &quot;tar.gz&quot;,
1051             revision: &quot;1.0118+1.0&quot;
1052         },
1053 
1054         jtreg: {
<span class="line-modified">1055             server: &quot;jpg&quot;,</span>
<span class="line-modified">1056             product: &quot;jtreg&quot;,</span>
<span class="line-modified">1057             version: &quot;5.0&quot;,</span>
<span class="line-added">1058             build_number: &quot;b01&quot;,</span>
1059             checksum_file: &quot;MD5_VALUES&quot;,
<span class="line-modified">1060             file: &quot;bundles/jtreg_bin-5.0.zip&quot;,</span>
1061             environment_name: &quot;JT_HOME&quot;,
1062             environment_path: input.get(&quot;jtreg&quot;, &quot;install_path&quot;) + &quot;/jtreg/bin&quot;
1063         },
1064 
1065         jmh: {
1066             organization: common.organization,
1067             ext: &quot;tar.gz&quot;,
1068             revision: &quot;1.21+1.0&quot;
1069         },
1070 
1071         jcov: {
1072             // Until an official build of JCov is available, use custom
1073             // build to support classfile version 57.
1074             // See CODETOOLS-7902358 for more info.
1075             // server: &quot;jpg&quot;,
1076             // product: &quot;jcov&quot;,
1077             // version: &quot;3.0&quot;,
1078             // build_number: &quot;b07&quot;,
1079             // file: &quot;bundles/jcov-3_0.zip&quot;,
1080             organization: common.organization,
</pre>
</td>
</tr>
</table>
<center><a href="../common/SetupJavaCompilers.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="../data/charsetmapping/MS950.map.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>