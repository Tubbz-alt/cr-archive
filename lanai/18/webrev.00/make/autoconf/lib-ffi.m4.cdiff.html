<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff make/autoconf/lib-ffi.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="jdk-options.m4.cdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="lib-tests.m4.cdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/lib-ffi.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  #
<span class="line-modified">! # Copyright (c) 2015, Oracle and/or its affiliates. All rights reserved.</span>
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
  # published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  #
<span class="line-modified">! # Copyright (c) 2015, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
  # published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 26,19 ***</span>
  ################################################################################
  # Setup libffi (Foreign Function Interface)
  ################################################################################
  AC_DEFUN_ONCE([LIB_SETUP_LIBFFI],
  [
    AC_ARG_WITH(libffi, [AS_HELP_STRING([--with-libffi],
        [specify prefix directory for the libffi package
        (expecting the libraries under PATH/lib and the headers under PATH/include)])])
    AC_ARG_WITH(libffi-include, [AS_HELP_STRING([--with-libffi-include],
        [specify directory for the libffi include files])])
    AC_ARG_WITH(libffi-lib, [AS_HELP_STRING([--with-libffi-lib],
        [specify directory for the libffi library])])
<span class="line-removed">-   AC_ARG_ENABLE(libffi-bundling, [AS_HELP_STRING([--enable-libffi-bundling],</span>
<span class="line-removed">-       [enable bundling of libffi.so to make the built JDK runnable on more systems])])</span>
  
    if test &quot;x$NEEDS_LIB_FFI&quot; = xfalse; then
      if (test &quot;x${with_libffi}&quot; != x &amp;&amp; test &quot;x${with_libffi}&quot; != xno) || \
          (test &quot;x${with_libffi_include}&quot; != x &amp;&amp; test &quot;x${with_libffi_include}&quot; != xno) || \
          (test &quot;x${with_libffi_lib}&quot; != x &amp;&amp; test &quot;x${with_libffi_lib}&quot; != xno); then
<span class="line-new-header">--- 26,21 ---</span>
  ################################################################################
  # Setup libffi (Foreign Function Interface)
  ################################################################################
  AC_DEFUN_ONCE([LIB_SETUP_LIBFFI],
  [
<span class="line-added">+   UTIL_ARG_ENABLE(NAME: libffi-bundling, DEFAULT: false,</span>
<span class="line-added">+       RESULT: ENABLE_LIBFFI_BUNDLING,</span>
<span class="line-added">+       DESC: [enable bundling of libffi.so to make the built JDK runnable on more systems])</span>
<span class="line-added">+ </span>
    AC_ARG_WITH(libffi, [AS_HELP_STRING([--with-libffi],
        [specify prefix directory for the libffi package
        (expecting the libraries under PATH/lib and the headers under PATH/include)])])
    AC_ARG_WITH(libffi-include, [AS_HELP_STRING([--with-libffi-include],
        [specify directory for the libffi include files])])
    AC_ARG_WITH(libffi-lib, [AS_HELP_STRING([--with-libffi-lib],
        [specify directory for the libffi library])])
  
    if test &quot;x$NEEDS_LIB_FFI&quot; = xfalse; then
      if (test &quot;x${with_libffi}&quot; != x &amp;&amp; test &quot;x${with_libffi}&quot; != xno) || \
          (test &quot;x${with_libffi_include}&quot; != x &amp;&amp; test &quot;x${with_libffi_include}&quot; != xno) || \
          (test &quot;x${with_libffi_lib}&quot; != x &amp;&amp; test &quot;x${with_libffi_lib}&quot; != xno); then
</pre>
<hr />
<pre>
<span class="line-old-header">*** 112,24 ***</span>
      if test &quot;x$LIBFFI_WORKS&quot; = xno; then
        HELP_MSG_MISSING_DEPENDENCY([ffi])
        AC_MSG_ERROR([Found libffi but could not link and compile with it. $HELP_MSG])
      fi
  
<span class="line-removed">-     AC_MSG_CHECKING([if libffi should be bundled])</span>
<span class="line-removed">-     if test &quot;x$enable_libffi_bundling&quot; = &quot;x&quot;; then</span>
<span class="line-removed">-       AC_MSG_RESULT([no])</span>
<span class="line-removed">-       ENABLE_LIBFFI_BUNDLING=false</span>
<span class="line-removed">-     elif  test &quot;x$enable_libffi_bundling&quot; = &quot;xno&quot;; then</span>
<span class="line-removed">-       AC_MSG_RESULT([no, forced])</span>
<span class="line-removed">-       ENABLE_LIBFFI_BUNDLING=false</span>
<span class="line-removed">-     elif  test &quot;x$enable_libffi_bundling&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">-       AC_MSG_RESULT([yes, forced])</span>
<span class="line-removed">-       ENABLE_LIBFFI_BUNDLING=true</span>
<span class="line-removed">-     else</span>
<span class="line-removed">-       AC_MSG_ERROR([Invalid value for --enable-libffi-bundling])</span>
<span class="line-removed">-     fi</span>
<span class="line-removed">- </span>
      # Find the libffi.so.X to bundle
      if test &quot;x${ENABLE_LIBFFI_BUNDLING}&quot; = &quot;xtrue&quot;; then
        AC_MSG_CHECKING([for libffi lib file location])
        if test &quot;x${LIBFFI_LIB_PATH}&quot; != x; then
          if test -e ${LIBFFI_LIB_PATH}/libffi.so.?; then
<span class="line-new-header">--- 114,10 ---</span>
</pre>
<center><a href="jdk-options.m4.cdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="lib-tests.m4.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>