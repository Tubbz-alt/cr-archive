<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/jdk-options.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="hotspot.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="lib-ffi.m4.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/jdk-options.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 ###############################################################################
 27 # Check which variant of the JDK that we want to build.
 28 # Currently we have:
 29 #    normal:   standard edition
 30 # but the custom make system may add other variants
 31 #
 32 # Effectively the JDK variant gives a name to a specific set of
 33 # modules to compile into the JDK.
 34 AC_DEFUN_ONCE([JDKOPT_SETUP_JDK_VARIANT],
 35 [
 36   # Deprecated in JDK 12
<span class="line-modified"> 37   BASIC_DEPRECATED_ARG_WITH([jdk-variant])</span>
 38 ])
 39 
 40 ###############################################################################
 41 # Set the debug level
 42 #    release: no debug information, all optimizations, no asserts.
 43 #    optimized: no debug information, all optimizations, no asserts, HotSpot target is &#39;optimized&#39;.
 44 #    fastdebug: debug information (-g), all optimizations, all asserts
 45 #    slowdebug: debug information (-g), no optimizations, all asserts
 46 AC_DEFUN_ONCE([JDKOPT_SETUP_DEBUG_LEVEL],
 47 [
 48   DEBUG_LEVEL=&quot;release&quot;
<span class="line-removed"> 49   AC_MSG_CHECKING([which debug level to use])</span>
<span class="line-removed"> 50   AC_ARG_ENABLE([debug], [AS_HELP_STRING([--enable-debug],</span>
<span class="line-removed"> 51       [set the debug level to fastdebug (shorthand for --with-debug-level=fastdebug) @&lt;:@disabled@:&gt;@])],</span>
<span class="line-removed"> 52       [</span>
<span class="line-removed"> 53         ENABLE_DEBUG=&quot;${enableval}&quot;</span>
<span class="line-removed"> 54         DEBUG_LEVEL=&quot;fastdebug&quot;</span>
<span class="line-removed"> 55       ], [ENABLE_DEBUG=&quot;no&quot;])</span>
 56 





 57   AC_ARG_WITH([debug-level], [AS_HELP_STRING([--with-debug-level],
 58       [set the debug level (release, fastdebug, slowdebug, optimized) @&lt;:@release@:&gt;@])],
 59       [
 60         DEBUG_LEVEL=&quot;${withval}&quot;
<span class="line-modified"> 61         if test &quot;x$ENABLE_DEBUG&quot; = xyes; then</span>
 62           AC_MSG_ERROR([You cannot use both --enable-debug and --with-debug-level at the same time.])
 63         fi
 64       ])
 65   AC_MSG_RESULT([$DEBUG_LEVEL])
 66 
 67   if test &quot;x$DEBUG_LEVEL&quot; != xrelease &amp;&amp; \
 68       test &quot;x$DEBUG_LEVEL&quot; != xoptimized &amp;&amp; \
 69       test &quot;x$DEBUG_LEVEL&quot; != xfastdebug &amp;&amp; \
 70       test &quot;x$DEBUG_LEVEL&quot; != xslowdebug; then
 71     AC_MSG_ERROR([Allowed debug levels are: release, fastdebug, slowdebug and optimized])
 72   fi
 73 
 74   # Translate DEBUG_LEVEL to debug level used by Hotspot
 75   HOTSPOT_DEBUG_LEVEL=&quot;$DEBUG_LEVEL&quot;
 76   if test &quot;x$DEBUG_LEVEL&quot; = xrelease; then
 77     HOTSPOT_DEBUG_LEVEL=&quot;product&quot;
 78   elif test &quot;x$DEBUG_LEVEL&quot; = xslowdebug; then
 79     HOTSPOT_DEBUG_LEVEL=&quot;debug&quot;
 80   fi
 81 
</pre>
<hr />
<pre>
 86     # &#39;release&#39; debug level which is called &#39;product&#39; in the HotSpot build) but
 87     # with the exception that it can contain additional code which is otherwise
 88     # protected by &#39;#ifndef PRODUCT&#39; macros. These &#39;optimized&#39; builds are used to
 89     # test new and/or experimental features which are not intended for customer
 90     # shipment. Because these new features need to be tested and benchmarked in
 91     # real world scenarios, we want to build the containing JDK at the &#39;release&#39;
 92     # debug level.
 93     DEBUG_LEVEL=&quot;release&quot;
 94   fi
 95 
 96   AC_SUBST(HOTSPOT_DEBUG_LEVEL)
 97   AC_SUBST(DEBUG_LEVEL)
 98 ])
 99 
100 ###############################################################################
101 #
102 # Should we build only OpenJDK even if closed sources are present?
103 #
104 AC_DEFUN_ONCE([JDKOPT_SETUP_OPEN_OR_CUSTOM],
105 [
<span class="line-modified">106   AC_ARG_ENABLE([openjdk-only], [AS_HELP_STRING([--enable-openjdk-only],</span>
<span class="line-modified">107       [suppress building custom source even if present @&lt;:@disabled@:&gt;@])],,[enable_openjdk_only=&quot;no&quot;])</span>
<span class="line-modified">108 </span>
<span class="line-modified">109   AC_MSG_CHECKING([if custom source is suppressed (openjdk-only)])</span>
<span class="line-removed">110   AC_MSG_RESULT([$enable_openjdk_only])</span>
<span class="line-removed">111   if test &quot;x$enable_openjdk_only&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">112     SUPPRESS_CUSTOM_EXTENSIONS=&quot;true&quot;</span>
<span class="line-removed">113   elif test &quot;x$enable_openjdk_only&quot; = &quot;xno&quot;; then</span>
<span class="line-removed">114     SUPPRESS_CUSTOM_EXTENSIONS=&quot;false&quot;</span>
<span class="line-removed">115   else</span>
<span class="line-removed">116     AC_MSG_ERROR([Invalid value for --enable-openjdk-only: $enable_openjdk_only])</span>
<span class="line-removed">117   fi</span>
118 ])
119 
120 AC_DEFUN_ONCE([JDKOPT_SETUP_JDK_OPTIONS],
121 [
122   # Should we build a JDK without a graphical UI?
<span class="line-modified">123   AC_MSG_CHECKING([headless only])</span>
<span class="line-modified">124   AC_ARG_ENABLE([headless-only], [AS_HELP_STRING([--enable-headless-only],</span>
<span class="line-modified">125       [only build headless (no GUI) support @&lt;:@disabled@:&gt;@])])</span>
<span class="line-modified">126 </span>
<span class="line-removed">127   if test &quot;x$enable_headless_only&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">128     ENABLE_HEADLESS_ONLY=&quot;true&quot;</span>
<span class="line-removed">129     AC_MSG_RESULT([yes])</span>
<span class="line-removed">130   elif test &quot;x$enable_headless_only&quot; = &quot;xno&quot;; then</span>
<span class="line-removed">131     ENABLE_HEADLESS_ONLY=&quot;false&quot;</span>
<span class="line-removed">132     AC_MSG_RESULT([no])</span>
<span class="line-removed">133   elif test &quot;x$enable_headless_only&quot; = &quot;x&quot;; then</span>
<span class="line-removed">134     ENABLE_HEADLESS_ONLY=&quot;false&quot;</span>
<span class="line-removed">135     AC_MSG_RESULT([no])</span>
<span class="line-removed">136   else</span>
<span class="line-removed">137     AC_MSG_ERROR([--enable-headless-only can only take yes or no])</span>
<span class="line-removed">138   fi</span>
<span class="line-removed">139 </span>
140   AC_SUBST(ENABLE_HEADLESS_ONLY)
141 
142   # should we linktime gc unused code sections in the JDK build ?
<span class="line-modified">143   AC_MSG_CHECKING([linktime gc])</span>
<span class="line-modified">144   AC_ARG_ENABLE([linktime-gc], [AS_HELP_STRING([--enable-linktime-gc],</span>
<span class="line-removed">145       [linktime gc unused code sections in the JDK build @&lt;:@disabled@:&gt;@])])</span>
<span class="line-removed">146 </span>
<span class="line-removed">147   if test &quot;x$enable_linktime_gc&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">148     ENABLE_LINKTIME_GC=&quot;true&quot;</span>
<span class="line-removed">149     AC_MSG_RESULT([yes])</span>
<span class="line-removed">150   elif test &quot;x$enable_linktime_gc&quot; = &quot;xno&quot;; then</span>
<span class="line-removed">151     ENABLE_LINKTIME_GC=&quot;false&quot;</span>
<span class="line-removed">152     AC_MSG_RESULT([no])</span>
<span class="line-removed">153   elif test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xlinux&quot; &amp;&amp; test &quot;x$OPENJDK_TARGET_CPU&quot; = xs390x; then</span>
<span class="line-removed">154     ENABLE_LINKTIME_GC=&quot;true&quot;</span>
<span class="line-removed">155     AC_MSG_RESULT([yes])</span>
<span class="line-removed">156   elif test &quot;x$enable_linktime_gc&quot; = &quot;x&quot;; then</span>
<span class="line-removed">157     ENABLE_LINKTIME_GC=&quot;false&quot;</span>
<span class="line-removed">158     AC_MSG_RESULT([no])</span>
159   else
<span class="line-modified">160     AC_MSG_ERROR([--enable-linktime-gc can only take yes or no])</span>
161   fi
162 




163   AC_SUBST(ENABLE_LINKTIME_GC)
164 
<span class="line-modified">165 </span>
<span class="line-modified">166   # Should we build the complete docs, or just a lightweight version?</span>
<span class="line-removed">167   AC_ARG_ENABLE([full-docs], [AS_HELP_STRING([--enable-full-docs],</span>
<span class="line-removed">168       [build complete documentation @&lt;:@enabled if all tools found@:&gt;@])])</span>
<span class="line-removed">169 </span>
<span class="line-removed">170   # Verify dependencies</span>
171   AC_MSG_CHECKING([for graphviz dot])
172   if test &quot;x$DOT&quot; != &quot;x&quot;; then
173     AC_MSG_RESULT([yes])
174   else
175     AC_MSG_RESULT([no, cannot generate full docs])
<span class="line-modified">176     FULL_DOCS_DEP_MISSING=true</span>
177   fi
178 
179   AC_MSG_CHECKING([for pandoc])
180   if test &quot;x$PANDOC&quot; != &quot;x&quot;; then
181     AC_MSG_RESULT([yes])
182   else
183     AC_MSG_RESULT([no, cannot generate full docs])
<span class="line-modified">184     FULL_DOCS_DEP_MISSING=true</span>
<span class="line-removed">185   fi</span>
<span class="line-removed">186 </span>
<span class="line-removed">187   AC_MSG_CHECKING([full docs])</span>
<span class="line-removed">188   if test &quot;x$enable_full_docs&quot; = xyes; then</span>
<span class="line-removed">189     if test &quot;x$FULL_DOCS_DEP_MISSING&quot; = &quot;xtrue&quot;; then</span>
<span class="line-removed">190       AC_MSG_RESULT([no, missing dependencies])</span>
<span class="line-removed">191       HELP_MSG_MISSING_DEPENDENCY([dot])</span>
<span class="line-removed">192       AC_MSG_ERROR([Cannot enable full docs with missing dependencies. See above. $HELP_MSG])</span>
<span class="line-removed">193     else</span>
<span class="line-removed">194       ENABLE_FULL_DOCS=true</span>
<span class="line-removed">195       AC_MSG_RESULT([yes, forced])</span>
<span class="line-removed">196     fi</span>
<span class="line-removed">197   elif test &quot;x$enable_full_docs&quot; = xno; then</span>
<span class="line-removed">198     ENABLE_FULL_DOCS=false</span>
<span class="line-removed">199     AC_MSG_RESULT([no, forced])</span>
<span class="line-removed">200   elif test &quot;x$enable_full_docs&quot; = x; then</span>
<span class="line-removed">201     # Check for prerequisites</span>
<span class="line-removed">202     if test &quot;x$FULL_DOCS_DEP_MISSING&quot; = xtrue; then</span>
<span class="line-removed">203       ENABLE_FULL_DOCS=false</span>
<span class="line-removed">204       AC_MSG_RESULT([no, missing dependencies])</span>
<span class="line-removed">205     else</span>
<span class="line-removed">206       ENABLE_FULL_DOCS=true</span>
<span class="line-removed">207       AC_MSG_RESULT([yes, dependencies present])</span>
<span class="line-removed">208     fi</span>
<span class="line-removed">209   else</span>
<span class="line-removed">210     AC_MSG_ERROR([--enable-full-docs can only take yes or no])</span>
211   fi
212 




213   AC_SUBST(ENABLE_FULL_DOCS)
214 
215   # Choose cacerts source file
216   AC_ARG_WITH(cacerts-file, [AS_HELP_STRING([--with-cacerts-file],
217       [specify alternative cacerts file])])
218   AC_MSG_CHECKING([for cacerts file])
219   if test &quot;x$with_cacerts_file&quot; == x; then
220     AC_MSG_RESULT([default])
221   else
222     CACERTS_FILE=$with_cacerts_file
223     if test ! -f &quot;$CACERTS_FILE&quot;; then
224       AC_MSG_RESULT([fail])
225       AC_MSG_ERROR([Specified cacerts file &quot;$CACERTS_FILE&quot; does not exist])
226     fi
227     AC_MSG_RESULT([$CACERTS_FILE])
228   fi
229   AC_SUBST(CACERTS_FILE)
230 
231   # Enable or disable unlimited crypto
<span class="line-modified">232   AC_ARG_ENABLE(unlimited-crypto, [AS_HELP_STRING([--disable-unlimited-crypto],</span>
<span class="line-modified">233       [Disable unlimited crypto policy @&lt;:@enabled@:&gt;@])],,</span>
<span class="line-removed">234       [enable_unlimited_crypto=yes])</span>
<span class="line-removed">235   if test &quot;x$enable_unlimited_crypto&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">236     UNLIMITED_CRYPTO=true</span>
<span class="line-removed">237   else</span>
<span class="line-removed">238     UNLIMITED_CRYPTO=false</span>
<span class="line-removed">239   fi</span>
240   AC_SUBST(UNLIMITED_CRYPTO)
241 
242   # Should we build the serviceability agent (SA)?
243   INCLUDE_SA=true
244   if HOTSPOT_CHECK_JVM_VARIANT(zero); then
245     INCLUDE_SA=false
246   fi
247   if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix ; then
248     INCLUDE_SA=false
249   fi
250   if test &quot;x$OPENJDK_TARGET_CPU&quot; = xs390x ; then
251     INCLUDE_SA=false
252   fi
253   AC_SUBST(INCLUDE_SA)
254 
255   # Compress jars
256   COMPRESS_JARS=false
257 
258   AC_SUBST(COMPRESS_JARS)
259 
</pre>
<hr />
<pre>
297 # Enable or disable the elliptic curve crypto implementation
298 #
299 AC_DEFUN_ONCE([JDKOPT_DETECT_INTREE_EC],
300 [
301   AC_MSG_CHECKING([if elliptic curve crypto implementation is present])
302 
303   if test -d &quot;${TOPDIR}/src/jdk.crypto.ec/share/native/libsunec/impl&quot;; then
304     ENABLE_INTREE_EC=true
305     AC_MSG_RESULT([yes])
306   else
307     ENABLE_INTREE_EC=false
308     AC_MSG_RESULT([no])
309   fi
310 
311   AC_SUBST(ENABLE_INTREE_EC)
312 ])
313 
314 AC_DEFUN_ONCE([JDKOPT_SETUP_DEBUG_SYMBOLS],
315 [
316   #
<span class="line-modified">317   # NATIVE_DEBUG_SYMBOLS</span>
318   # This must be done after the toolchain is setup, since we&#39;re looking at objcopy.
319   #
320   AC_MSG_CHECKING([what type of native debug symbols to use])
321   AC_ARG_WITH([native-debug-symbols],
322       [AS_HELP_STRING([--with-native-debug-symbols],
323       [set the native debug symbol configuration (none, internal, external, zipped) @&lt;:@varying@:&gt;@])],
324       [
325         if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
326           if test &quot;x$withval&quot; = xexternal || test &quot;x$withval&quot; = xzipped; then
327             AC_MSG_ERROR([AIX only supports the parameters &#39;none&#39; and &#39;internal&#39; for --with-native-debug-symbols])
328           fi
<span class="line-modified">329         else</span>
<span class="line-modified">330           if test &quot;x$OPENJDK_TARGET_OS&quot; = xwindows; then</span>
<span class="line-modified">331             if test &quot;x$withval&quot; = xinternal; then</span>
<span class="line-removed">332               AC_MSG_ERROR([Windows does not support the parameter &#39;internal&#39; for --with-native-debug-symbols])</span>
<span class="line-removed">333             fi</span>
334           fi
335         fi
336       ],
337       [
338         if test &quot;x$STATIC_BUILD&quot; = xtrue; then
339           with_native_debug_symbols=&quot;none&quot;
340         else
341           if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
342             # AIX doesn&#39;t support &#39;external&#39; so use &#39;internal&#39; as default
343             with_native_debug_symbols=&quot;internal&quot;
344           else
345             with_native_debug_symbols=&quot;external&quot;
346           fi
347         fi
348       ])
<span class="line-modified">349   NATIVE_DEBUG_SYMBOLS=$with_native_debug_symbols</span>
<span class="line-removed">350   AC_MSG_RESULT([$NATIVE_DEBUG_SYMBOLS])</span>
351 
<span class="line-modified">352   if test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xnone; then</span>
353     COMPILE_WITH_DEBUG_SYMBOLS=false
354     COPY_DEBUG_SYMBOLS=false
355     ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="line-modified">356   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xinternal; then</span>
357     COMPILE_WITH_DEBUG_SYMBOLS=true
358     COPY_DEBUG_SYMBOLS=false
359     ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="line-modified">360   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xexternal; then</span>
361 
362     if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
363       if test &quot;x$OBJCOPY&quot; = x; then
364         # enabling of enable-debug-symbols and can&#39;t find objcopy
365         # this is an error
366         AC_MSG_ERROR([Unable to find objcopy, cannot enable native debug symbols])
367       fi
368     fi
369 
370     COMPILE_WITH_DEBUG_SYMBOLS=true
371     COPY_DEBUG_SYMBOLS=true
372     ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="line-modified">373   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xzipped; then</span>
374 
375     if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
376       if test &quot;x$OBJCOPY&quot; = x; then
377         # enabling of enable-debug-symbols and can&#39;t find objcopy
378         # this is an error
379         AC_MSG_ERROR([Unable to find objcopy, cannot enable native debug symbols])
380       fi
381     fi
382 
383     COMPILE_WITH_DEBUG_SYMBOLS=true
384     COPY_DEBUG_SYMBOLS=true
385     ZIP_EXTERNAL_DEBUG_SYMBOLS=true
386   else
387     AC_MSG_ERROR([Allowed native debug symbols are: none, internal, external, zipped])
388   fi
389 
390   AC_SUBST(COMPILE_WITH_DEBUG_SYMBOLS)
391   AC_SUBST(COPY_DEBUG_SYMBOLS)
392   AC_SUBST(ZIP_EXTERNAL_DEBUG_SYMBOLS)



























393 ])
394 
395 ################################################################################
396 #
397 # Native and Java code coverage
398 #
399 AC_DEFUN_ONCE([JDKOPT_SETUP_CODE_COVERAGE],
400 [
<span class="line-modified">401   AC_ARG_ENABLE(native-coverage, [AS_HELP_STRING([--enable-native-coverage],</span>
<span class="line-modified">402       [enable native compilation with code coverage data@&lt;:@disabled@:&gt;@])])</span>
<span class="line-modified">403   GCOV_ENABLED=&quot;false&quot;</span>
<span class="line-modified">404   if test &quot;x$enable_native_coverage&quot; = &quot;xyes&quot;; then</span>
<span class="line-modified">405     case $TOOLCHAIN_TYPE in</span>
<span class="line-modified">406       gcc | clang)</span>
<span class="line-modified">407         AC_MSG_CHECKING([if native coverage is enabled])</span>
<span class="line-modified">408         AC_MSG_RESULT([yes])</span>





409         GCOV_CFLAGS=&quot;-fprofile-arcs -ftest-coverage -fno-inline&quot;
410         GCOV_LDFLAGS=&quot;-fprofile-arcs&quot;
411         JVM_CFLAGS=&quot;$JVM_CFLAGS $GCOV_CFLAGS&quot;
412         JVM_LDFLAGS=&quot;$JVM_LDFLAGS $GCOV_LDFLAGS&quot;
413         CFLAGS_JDKLIB=&quot;$CFLAGS_JDKLIB $GCOV_CFLAGS&quot;
414         CFLAGS_JDKEXE=&quot;$CFLAGS_JDKEXE $GCOV_CFLAGS&quot;
415         CXXFLAGS_JDKLIB=&quot;$CXXFLAGS_JDKLIB $GCOV_CFLAGS&quot;
416         CXXFLAGS_JDKEXE=&quot;$CXXFLAGS_JDKEXE $GCOV_CFLAGS&quot;
417         LDFLAGS_JDKLIB=&quot;$LDFLAGS_JDKLIB $GCOV_LDFLAGS&quot;
418         LDFLAGS_JDKEXE=&quot;$LDFLAGS_JDKEXE $GCOV_LDFLAGS&quot;
<span class="line-modified">419         GCOV_ENABLED=&quot;true&quot;</span>
<span class="line-removed">420         ;;</span>
<span class="line-removed">421       *)</span>
<span class="line-removed">422         AC_MSG_ERROR([--enable-native-coverage only works with toolchain type gcc or clang])</span>
<span class="line-removed">423         ;;</span>
<span class="line-removed">424     esac</span>
<span class="line-removed">425   elif test &quot;x$enable_native_coverage&quot; = &quot;xno&quot;; then</span>
<span class="line-removed">426     AC_MSG_CHECKING([if native coverage is enabled])</span>
<span class="line-removed">427     AC_MSG_RESULT([no])</span>
<span class="line-removed">428   elif test &quot;x$enable_native_coverage&quot; != &quot;x&quot;; then</span>
<span class="line-removed">429     AC_MSG_ERROR([--enable-native-coverage can only be assigned &quot;yes&quot; or &quot;no&quot;])</span>
<span class="line-removed">430   fi</span>
431   AC_SUBST(GCOV_ENABLED)
432 
433   AC_ARG_WITH(jcov, [AS_HELP_STRING([--with-jcov],
434       [jcov library location])])
435   AC_ARG_WITH(jcov-input-jdk, [AS_HELP_STRING([--with-jcov-input-jdk],
436       [jdk image to instrument])])
437   AC_ARG_WITH(jcov-filters, [AS_HELP_STRING([--with-jcov-filters],
438       [filters to limit code for jcov instrumentation and report generation])])
439   JCOV_HOME=
440   JCOV_INPUT_JDK=
441   JCOV_ENABLED=
442   JCOV_FILTERS=
443   if test &quot;x$with_jcov&quot; = &quot;x&quot; ; then
444     JCOV_ENABLED=&quot;false&quot;
445   else
446     JCOV_HOME=&quot;$with_jcov&quot;
447     if test ! -f &quot;$JCOV_HOME/lib/jcov.jar&quot;; then
448       AC_MSG_RESULT([fail])
449       AC_MSG_ERROR([Invalid JCov bundle: &quot;$JCOV_HOME/lib/jcov.jar&quot; does not exist])
450     fi
451     JCOV_ENABLED=&quot;true&quot;
<span class="line-modified">452     BASIC_FIXUP_PATH(JCOV_HOME)</span>
453     if test &quot;x$with_jcov_input_jdk&quot; != &quot;x&quot; ; then
454       JCOV_INPUT_JDK=&quot;$with_jcov_input_jdk&quot;
455       if test ! -f &quot;$JCOV_INPUT_JDK/bin/java$EXE_SUFFIX&quot;; then
456         AC_MSG_RESULT([fail])
457         AC_MSG_ERROR([Invalid JDK bundle: &quot;$JCOV_INPUT_JDK/bin/java$EXE_SUFFIX&quot; does not exist])
458       fi
<span class="line-modified">459       BASIC_FIXUP_PATH(JCOV_INPUT_JDK)</span>
460     fi
461     if test &quot;x$with_jcov_filters&quot; != &quot;x&quot; ; then
462       JCOV_FILTERS=&quot;$with_jcov_filters&quot;
463     fi
464   fi
465   AC_SUBST(JCOV_ENABLED)
466   AC_SUBST(JCOV_HOME)
467   AC_SUBST(JCOV_INPUT_JDK)
468   AC_SUBST(JCOV_FILTERS)
469 ])
470 
471 ###############################################################################
472 #
473 # AddressSanitizer
474 #
475 AC_DEFUN_ONCE([JDKOPT_SETUP_ADDRESS_SANITIZER],
476 [
<span class="line-modified">477   AC_ARG_ENABLE(asan, [AS_HELP_STRING([--enable-asan],</span>
<span class="line-modified">478       [enable AddressSanitizer if possible @&lt;:@disabled@:&gt;@])])</span>
<span class="line-modified">479   ASAN_ENABLED=&quot;no&quot;</span>
<span class="line-modified">480   if test &quot;x$enable_asan&quot; = &quot;xyes&quot;; then</span>
<span class="line-modified">481     case $TOOLCHAIN_TYPE in</span>
<span class="line-modified">482       gcc | clang)</span>
<span class="line-modified">483         AC_MSG_CHECKING([if asan is enabled])</span>
<span class="line-modified">484         AC_MSG_RESULT([yes])</span>





485         ASAN_CFLAGS=&quot;-fsanitize=address -fno-omit-frame-pointer&quot;
486         ASAN_LDFLAGS=&quot;-fsanitize=address&quot;
487         JVM_CFLAGS=&quot;$JVM_CFLAGS $ASAN_CFLAGS&quot;
488         JVM_LDFLAGS=&quot;$JVM_LDFLAGS $ASAN_LDFLAGS&quot;
489         CFLAGS_JDKLIB=&quot;$CFLAGS_JDKLIB $ASAN_CFLAGS&quot;
490         CFLAGS_JDKEXE=&quot;$CFLAGS_JDKEXE $ASAN_CFLAGS&quot;
491         CXXFLAGS_JDKLIB=&quot;$CXXFLAGS_JDKLIB $ASAN_CFLAGS&quot;
492         CXXFLAGS_JDKEXE=&quot;$CXXFLAGS_JDKEXE $ASAN_CFLAGS&quot;
493         LDFLAGS_JDKLIB=&quot;$LDFLAGS_JDKLIB $ASAN_LDFLAGS&quot;
494         LDFLAGS_JDKEXE=&quot;$LDFLAGS_JDKEXE $ASAN_LDFLAGS&quot;
495         ASAN_ENABLED=&quot;yes&quot;
<span class="line-modified">496         ;;</span>
<span class="line-modified">497       *)</span>
<span class="line-modified">498         AC_MSG_ERROR([--enable-asan only works with toolchain type gcc or clang])</span>
<span class="line-modified">499         ;;</span>
<span class="line-removed">500     esac</span>
<span class="line-removed">501   elif test &quot;x$enable_asan&quot; = &quot;xno&quot;; then</span>
<span class="line-removed">502     AC_MSG_CHECKING([if asan is enabled])</span>
<span class="line-removed">503     AC_MSG_RESULT([no])</span>
<span class="line-removed">504   elif test &quot;x$enable_asan&quot; != &quot;x&quot;; then</span>
<span class="line-removed">505     AC_MSG_ERROR([--enable-asan can only be assigned &quot;yes&quot; or &quot;no&quot;])</span>
<span class="line-removed">506   fi</span>
507 
508   AC_SUBST(ASAN_ENABLED)
509 ])
510 
511 ################################################################################
512 #
513 # Static build support.  When enabled will generate static
514 # libraries instead of shared libraries for all JDK libs.
515 #
516 AC_DEFUN_ONCE([JDKOPT_SETUP_STATIC_BUILD],
517 [
<span class="line-modified">518   AC_ARG_ENABLE([static-build], [AS_HELP_STRING([--enable-static-build],</span>
<span class="line-modified">519     [enable static library build @&lt;:@disabled@:&gt;@])])</span>
<span class="line-modified">520   STATIC_BUILD=false</span>
<span class="line-modified">521   if test &quot;x$enable_static_build&quot; = &quot;xyes&quot;; then</span>
<span class="line-modified">522     AC_MSG_CHECKING([if static build is enabled])</span>
<span class="line-modified">523     AC_MSG_RESULT([yes])</span>
<span class="line-modified">524     if test &quot;x$OPENJDK_TARGET_OS&quot; != &quot;xmacosx&quot;; then</span>
<span class="line-modified">525       AC_MSG_ERROR([--enable-static-build is only supported for macosx builds])</span>
<span class="line-modified">526     fi</span>
<span class="line-modified">527     STATIC_BUILD_CFLAGS=&quot;-DSTATIC_BUILD=1&quot;</span>
<span class="line-modified">528     CFLAGS_JDKLIB_EXTRA=&quot;$CFLAGS_JDKLIB_EXTRA $STATIC_BUILD_CFLAGS&quot;</span>
<span class="line-modified">529     CXXFLAGS_JDKLIB_EXTRA=&quot;$CXXFLAGS_JDKLIB_EXTRA $STATIC_BUILD_CFLAGS&quot;</span>
<span class="line-modified">530     STATIC_BUILD=true</span>
<span class="line-modified">531   elif test &quot;x$enable_static_build&quot; = &quot;xno&quot;; then</span>
<span class="line-modified">532     AC_MSG_CHECKING([if static build is enabled])</span>
<span class="line-modified">533     AC_MSG_RESULT([no])</span>
<span class="line-modified">534   elif test &quot;x$enable_static_build&quot; != &quot;x&quot;; then</span>
<span class="line-removed">535     AC_MSG_ERROR([--enable-static-build can only be assigned &quot;yes&quot; or &quot;no&quot;])</span>
<span class="line-removed">536   fi</span>
<span class="line-removed">537 </span>
538   AC_SUBST(STATIC_BUILD)
539 ])
540 
541 ################################################################################
542 #
543 # jlink options.
544 # We always keep packaged modules in JDK image.
545 #
546 AC_DEFUN_ONCE([JDKOPT_SETUP_JLINK_OPTIONS],
547 [
<span class="line-modified">548   AC_ARG_ENABLE([keep-packaged-modules], [AS_HELP_STRING([--disable-keep-packaged-modules],</span>
<span class="line-modified">549     [Do not keep packaged modules in jdk image @&lt;:@enable@:&gt;@])])</span>
<span class="line-modified">550 </span>
<span class="line-modified">551   AC_MSG_CHECKING([if packaged modules are kept])</span>
<span class="line-removed">552   if test &quot;x$enable_keep_packaged_modules&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">553     AC_MSG_RESULT([yes])</span>
<span class="line-removed">554     JLINK_KEEP_PACKAGED_MODULES=true</span>
<span class="line-removed">555   elif test &quot;x$enable_keep_packaged_modules&quot; = &quot;xno&quot;; then</span>
<span class="line-removed">556     AC_MSG_RESULT([no])</span>
<span class="line-removed">557     JLINK_KEEP_PACKAGED_MODULES=false</span>
<span class="line-removed">558   elif test &quot;x$enable_keep_packaged_modules&quot; = &quot;x&quot;; then</span>
<span class="line-removed">559     AC_MSG_RESULT([yes (default)])</span>
<span class="line-removed">560     JLINK_KEEP_PACKAGED_MODULES=true</span>
<span class="line-removed">561   else</span>
<span class="line-removed">562     AC_MSG_RESULT([error])</span>
<span class="line-removed">563     AC_MSG_ERROR([--enable-keep-packaged-modules accepts no argument])</span>
<span class="line-removed">564   fi</span>
<span class="line-removed">565 </span>
566   AC_SUBST(JLINK_KEEP_PACKAGED_MODULES)
567 ])
568 
569 ################################################################################
570 #
571 # Check if building of the jtreg failure handler should be enabled.
572 #
573 AC_DEFUN_ONCE([JDKOPT_ENABLE_DISABLE_FAILURE_HANDLER],
574 [
<span class="line-modified">575   AC_ARG_ENABLE([jtreg-failure-handler], [AS_HELP_STRING([--enable-jtreg-failure-handler],</span>
<span class="line-modified">576     [forces build of the jtreg failure handler to be enabled, missing dependencies</span>
<span class="line-modified">577      become fatal errors. Default is auto, where the failure handler is built if all</span>
<span class="line-modified">578      dependencies are present and otherwise just disabled.])])</span>
<span class="line-modified">579 </span>
<span class="line-modified">580   AC_MSG_CHECKING([if jtreg failure handler should be built])</span>
<span class="line-modified">581 </span>
<span class="line-modified">582   if test &quot;x$enable_jtreg_failure_handler&quot; = &quot;xyes&quot;; then</span>
<span class="line-modified">583     if test &quot;x$JT_HOME&quot; = &quot;x&quot;; then</span>
<span class="line-modified">584       AC_MSG_ERROR([Cannot enable jtreg failure handler without jtreg.])</span>
<span class="line-modified">585     else</span>
<span class="line-modified">586       BUILD_FAILURE_HANDLER=true</span>
<span class="line-modified">587       AC_MSG_RESULT([yes, forced])</span>
<span class="line-modified">588     fi</span>
<span class="line-removed">589   elif test &quot;x$enable_jtreg_failure_handler&quot; = &quot;xno&quot;; then</span>
<span class="line-removed">590     BUILD_FAILURE_HANDLER=false</span>
<span class="line-removed">591     AC_MSG_RESULT([no, forced])</span>
<span class="line-removed">592   elif test &quot;x$enable_jtreg_failure_handler&quot; = &quot;xauto&quot; \</span>
<span class="line-removed">593       || test &quot;x$enable_jtreg_failure_handler&quot; = &quot;x&quot;; then</span>
<span class="line-removed">594     if test &quot;x$JT_HOME&quot; = &quot;x&quot;; then</span>
<span class="line-removed">595       BUILD_FAILURE_HANDLER=false</span>
<span class="line-removed">596       AC_MSG_RESULT([no, missing jtreg])</span>
<span class="line-removed">597     else</span>
<span class="line-removed">598       BUILD_FAILURE_HANDLER=true</span>
<span class="line-removed">599       AC_MSG_RESULT([yes, jtreg present])</span>
<span class="line-removed">600     fi</span>
<span class="line-removed">601   else</span>
<span class="line-removed">602     AC_MSG_ERROR([Invalid value for --enable-jtreg-failure-handler: $enable_jtreg_failure_handler])</span>
<span class="line-removed">603   fi</span>
<span class="line-removed">604 </span>
605   AC_SUBST(BUILD_FAILURE_HANDLER)
606 ])
607 
608 ################################################################################
609 #
610 # Enable or disable generation of the classlist at build time
611 #
612 AC_DEFUN_ONCE([JDKOPT_ENABLE_DISABLE_GENERATE_CLASSLIST],
613 [
<span class="line-modified">614   AC_ARG_ENABLE([generate-classlist], [AS_HELP_STRING([--disable-generate-classlist],</span>
<span class="line-modified">615       [forces enabling or disabling of the generation of a CDS classlist at build time.</span>
<span class="line-modified">616       Default is to generate it when either the server or client JVMs are built and</span>
<span class="line-modified">617       enable-cds is true.])])</span>
<span class="line-modified">618 </span>
<span class="line-modified">619   # Check if it&#39;s likely that it&#39;s possible to generate the classlist. Depending</span>
<span class="line-modified">620   # on exact jvm configuration it could be possible anyway.</span>
<span class="line-modified">621   if test &quot;x$ENABLE_CDS&quot; = &quot;xtrue&quot; &amp;&amp; (HOTSPOT_CHECK_JVM_VARIANT(server) || HOTSPOT_CHECK_JVM_VARIANT(client) || HOTSPOT_CHECK_JVM_FEATURE(cds)); then</span>
<span class="line-removed">622     ENABLE_GENERATE_CLASSLIST_POSSIBLE=&quot;true&quot;</span>
<span class="line-removed">623   else</span>
<span class="line-removed">624     ENABLE_GENERATE_CLASSLIST_POSSIBLE=&quot;false&quot;</span>
<span class="line-removed">625   fi</span>
<span class="line-removed">626 </span>
<span class="line-removed">627   AC_MSG_CHECKING([if the CDS classlist generation should be enabled])</span>
<span class="line-removed">628   if test &quot;x$enable_generate_classlist&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">629     AC_MSG_RESULT([yes, forced])</span>
<span class="line-removed">630     ENABLE_GENERATE_CLASSLIST=&quot;true&quot;</span>
<span class="line-removed">631     if test &quot;x$ENABLE_GENERATE_CLASSLIST_POSSIBLE&quot; = &quot;xfalse&quot;; then</span>
<span class="line-removed">632       if test &quot;x$ENABLE_CDS&quot; = &quot;xfalse&quot;; then</span>
<span class="line-removed">633         # In GenerateLinkOptData.gmk, DumpLoadedClassList is used to generate the</span>
<span class="line-removed">634         # classlist file. It never will work in this case since the VM will report</span>
<span class="line-removed">635         # an error for DumpLoadedClassList when CDS is disabled.</span>
<span class="line-removed">636         AC_MSG_ERROR([Generation of classlist is not possible with enable-cds=false])</span>
<span class="line-removed">637       else</span>
<span class="line-removed">638         AC_MSG_WARN([Generation of classlist might not be possible with JVM Variants $JVM_VARIANTS and enable-cds=$ENABLE_CDS])</span>
<span class="line-removed">639       fi</span>
<span class="line-removed">640     fi</span>
<span class="line-removed">641   elif test &quot;x$enable_generate_classlist&quot; = &quot;xno&quot;; then</span>
<span class="line-removed">642     AC_MSG_RESULT([no, forced])</span>
<span class="line-removed">643     ENABLE_GENERATE_CLASSLIST=&quot;false&quot;</span>
<span class="line-removed">644   elif test &quot;x$enable_generate_classlist&quot; = &quot;x&quot;; then</span>
<span class="line-removed">645     if test &quot;x$ENABLE_GENERATE_CLASSLIST_POSSIBLE&quot; = &quot;xtrue&quot;; then</span>
<span class="line-removed">646       AC_MSG_RESULT([yes])</span>
<span class="line-removed">647       ENABLE_GENERATE_CLASSLIST=&quot;true&quot;</span>
<span class="line-removed">648     else</span>
<span class="line-removed">649       AC_MSG_RESULT([no])</span>
<span class="line-removed">650       ENABLE_GENERATE_CLASSLIST=&quot;false&quot;</span>
<span class="line-removed">651     fi</span>
<span class="line-removed">652   else</span>
<span class="line-removed">653     AC_MSG_ERROR([Invalid value for --enable-generate-classlist: $enable_generate_classlist])</span>
<span class="line-removed">654   fi</span>
<span class="line-removed">655 </span>
656   AC_SUBST(ENABLE_GENERATE_CLASSLIST)
657 ])
658 
659 ################################################################################
660 #
661 # Optionally filter resource translations
662 #
663 AC_DEFUN([JDKOPT_EXCLUDE_TRANSLATIONS],
664 [
665   AC_ARG_WITH([exclude-translations], [AS_HELP_STRING([--with-exclude-translations],
666       [a comma separated list of locales to exclude translations for. Default is
667       to include all translations present in the source.])])
668 
669   EXCLUDE_TRANSLATIONS=&quot;&quot;
670   AC_MSG_CHECKING([if any translations should be excluded])
671   if test &quot;x$with_exclude_translations&quot; != &quot;x&quot;; then
672     EXCLUDE_TRANSLATIONS=&quot;${with_exclude_translations//,/ }&quot;
673     AC_MSG_RESULT([yes: $EXCLUDE_TRANSLATIONS])
674   else
675     AC_MSG_RESULT([no])
676   fi
677 
678   AC_SUBST(EXCLUDE_TRANSLATIONS)
679 ])
680 
681 ################################################################################
682 #
683 # Optionally disable man pages
684 #
685 AC_DEFUN([JDKOPT_ENABLE_DISABLE_MANPAGES],
686 [
<span class="line-modified">687   AC_ARG_ENABLE([manpages], [AS_HELP_STRING([--disable-manpages],</span>
<span class="line-modified">688       [Set to disable copy of static man pages @&lt;:@enabled@:&gt;@])])</span>
<span class="line-modified">689 </span>
<span class="line-removed">690   BUILD_MANPAGES=&quot;true&quot;</span>
<span class="line-removed">691   AC_MSG_CHECKING([if static man pages should be copied])</span>
<span class="line-removed">692   if test &quot;x$enable_manpages&quot; = &quot;x&quot;; then</span>
<span class="line-removed">693     AC_MSG_RESULT([yes])</span>
<span class="line-removed">694   elif test &quot;x$enable_manpages&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">695     AC_MSG_RESULT([yes, forced])</span>
<span class="line-removed">696   elif test &quot;x$enable_manpages&quot; = &quot;xno&quot;; then</span>
<span class="line-removed">697     AC_MSG_RESULT([no, forced])</span>
<span class="line-removed">698     BUILD_MANPAGES=&quot;false&quot;</span>
<span class="line-removed">699   else</span>
<span class="line-removed">700     AC_MSG_RESULT([no])</span>
<span class="line-removed">701     AC_MSG_ERROR([--enable-manpages can only yes/no or empty])</span>
<span class="line-removed">702   fi</span>
<span class="line-removed">703 </span>
704   AC_SUBST(BUILD_MANPAGES)
705 ])
706 
707 ################################################################################
708 #
709 # Disable the default CDS archive generation
<span class="line-removed">710 #   cross compilation - disabled</span>
711 #
712 AC_DEFUN([JDKOPT_ENABLE_DISABLE_CDS_ARCHIVE],
713 [
<span class="line-modified">714   AC_ARG_ENABLE([cds-archive], [AS_HELP_STRING([--disable-cds-archive],</span>
<span class="line-modified">715       [Set to disable generation of a default CDS archive in the product image @&lt;:@enabled@:&gt;@])])</span>
<span class="line-modified">716 </span>
<span class="line-modified">717   AC_MSG_CHECKING([if a default CDS archive should be generated])</span>
<span class="line-modified">718   if test &quot;x$ENABLE_CDS&quot; = &quot;xfalse&quot;; then</span>
<span class="line-modified">719     AC_MSG_RESULT([no, because CDS is disabled])</span>
<span class="line-modified">720     BUILD_CDS_ARCHIVE=&quot;false&quot;</span>
<span class="line-modified">721   elif test &quot;x$COMPILE_TYPE&quot; = &quot;xcross&quot;; then</span>
<span class="line-modified">722     AC_MSG_RESULT([no, not possible with cross compilation])</span>
<span class="line-modified">723     BUILD_CDS_ARCHIVE=&quot;false&quot;</span>
<span class="line-modified">724   elif test &quot;x$enable_cds_archive&quot; = &quot;xyes&quot;; then</span>
<span class="line-modified">725     AC_MSG_RESULT([yes, forced])</span>
<span class="line-modified">726     BUILD_CDS_ARCHIVE=&quot;true&quot;</span>
<span class="line-modified">727   elif test &quot;x$enable_cds_archive&quot; = &quot;x&quot;; then</span>
<span class="line-modified">728     AC_MSG_RESULT([yes])</span>
<span class="line-modified">729     BUILD_CDS_ARCHIVE=&quot;true&quot;</span>
<span class="line-removed">730   elif test &quot;x$enable_cds_archive&quot; = &quot;xno&quot;; then</span>
<span class="line-removed">731     AC_MSG_RESULT([no, forced])</span>
<span class="line-removed">732     BUILD_CDS_ARCHIVE=&quot;false&quot;</span>
<span class="line-removed">733   else</span>
<span class="line-removed">734     AC_MSG_RESULT([no])</span>
<span class="line-removed">735     AC_MSG_ERROR([--enable-cds_archive can only be yes/no or empty])</span>
<span class="line-removed">736   fi</span>
<span class="line-removed">737 </span>
738   AC_SUBST(BUILD_CDS_ARCHIVE)
739 ])
</pre>
</td>
<td>
<hr />
<pre>
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 ###############################################################################
 27 # Check which variant of the JDK that we want to build.
 28 # Currently we have:
 29 #    normal:   standard edition
 30 # but the custom make system may add other variants
 31 #
 32 # Effectively the JDK variant gives a name to a specific set of
 33 # modules to compile into the JDK.
 34 AC_DEFUN_ONCE([JDKOPT_SETUP_JDK_VARIANT],
 35 [
 36   # Deprecated in JDK 12
<span class="line-modified"> 37   UTIL_DEPRECATED_ARG_WITH([jdk-variant])</span>
 38 ])
 39 
 40 ###############################################################################
 41 # Set the debug level
 42 #    release: no debug information, all optimizations, no asserts.
 43 #    optimized: no debug information, all optimizations, no asserts, HotSpot target is &#39;optimized&#39;.
 44 #    fastdebug: debug information (-g), all optimizations, all asserts
 45 #    slowdebug: debug information (-g), no optimizations, all asserts
 46 AC_DEFUN_ONCE([JDKOPT_SETUP_DEBUG_LEVEL],
 47 [
 48   DEBUG_LEVEL=&quot;release&quot;







 49 
<span class="line-added"> 50   UTIL_ARG_ENABLE(NAME: debug, DEFAULT: false, RESULT: ENABLE_DEBUG,</span>
<span class="line-added"> 51       DESC: [enable debugging (shorthand for --with-debug-level=fastdebug)],</span>
<span class="line-added"> 52       IF_ENABLED: [ DEBUG_LEVEL=&quot;fastdebug&quot; ])</span>
<span class="line-added"> 53 </span>
<span class="line-added"> 54   AC_MSG_CHECKING([which debug level to use])</span>
 55   AC_ARG_WITH([debug-level], [AS_HELP_STRING([--with-debug-level],
 56       [set the debug level (release, fastdebug, slowdebug, optimized) @&lt;:@release@:&gt;@])],
 57       [
 58         DEBUG_LEVEL=&quot;${withval}&quot;
<span class="line-modified"> 59         if test &quot;x$ENABLE_DEBUG&quot; = xtrue; then</span>
 60           AC_MSG_ERROR([You cannot use both --enable-debug and --with-debug-level at the same time.])
 61         fi
 62       ])
 63   AC_MSG_RESULT([$DEBUG_LEVEL])
 64 
 65   if test &quot;x$DEBUG_LEVEL&quot; != xrelease &amp;&amp; \
 66       test &quot;x$DEBUG_LEVEL&quot; != xoptimized &amp;&amp; \
 67       test &quot;x$DEBUG_LEVEL&quot; != xfastdebug &amp;&amp; \
 68       test &quot;x$DEBUG_LEVEL&quot; != xslowdebug; then
 69     AC_MSG_ERROR([Allowed debug levels are: release, fastdebug, slowdebug and optimized])
 70   fi
 71 
 72   # Translate DEBUG_LEVEL to debug level used by Hotspot
 73   HOTSPOT_DEBUG_LEVEL=&quot;$DEBUG_LEVEL&quot;
 74   if test &quot;x$DEBUG_LEVEL&quot; = xrelease; then
 75     HOTSPOT_DEBUG_LEVEL=&quot;product&quot;
 76   elif test &quot;x$DEBUG_LEVEL&quot; = xslowdebug; then
 77     HOTSPOT_DEBUG_LEVEL=&quot;debug&quot;
 78   fi
 79 
</pre>
<hr />
<pre>
 84     # &#39;release&#39; debug level which is called &#39;product&#39; in the HotSpot build) but
 85     # with the exception that it can contain additional code which is otherwise
 86     # protected by &#39;#ifndef PRODUCT&#39; macros. These &#39;optimized&#39; builds are used to
 87     # test new and/or experimental features which are not intended for customer
 88     # shipment. Because these new features need to be tested and benchmarked in
 89     # real world scenarios, we want to build the containing JDK at the &#39;release&#39;
 90     # debug level.
 91     DEBUG_LEVEL=&quot;release&quot;
 92   fi
 93 
 94   AC_SUBST(HOTSPOT_DEBUG_LEVEL)
 95   AC_SUBST(DEBUG_LEVEL)
 96 ])
 97 
 98 ###############################################################################
 99 #
100 # Should we build only OpenJDK even if closed sources are present?
101 #
102 AC_DEFUN_ONCE([JDKOPT_SETUP_OPEN_OR_CUSTOM],
103 [
<span class="line-modified">104   UTIL_ARG_ENABLE(NAME: openjdk-only, DEFAULT: false,</span>
<span class="line-modified">105       RESULT: SUPPRESS_CUSTOM_EXTENSIONS,</span>
<span class="line-modified">106       DESC: [suppress building custom source even if present],</span>
<span class="line-modified">107       CHECKING_MSG: [if custom source is suppressed (openjdk-only)])</span>








108 ])
109 
110 AC_DEFUN_ONCE([JDKOPT_SETUP_JDK_OPTIONS],
111 [
112   # Should we build a JDK without a graphical UI?
<span class="line-modified">113   UTIL_ARG_ENABLE(NAME: headless-only, DEFAULT: false,</span>
<span class="line-modified">114       RESULT: ENABLE_HEADLESS_ONLY,</span>
<span class="line-modified">115       DESC: [only build headless (no GUI) support],</span>
<span class="line-modified">116       CHECKING_MSG: [if we should build headless-only (no GUI)])</span>













117   AC_SUBST(ENABLE_HEADLESS_ONLY)
118 
119   # should we linktime gc unused code sections in the JDK build ?
<span class="line-modified">120   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xlinux&quot; &amp;&amp; test &quot;x$OPENJDK_TARGET_CPU&quot; = xs390x; then</span>
<span class="line-modified">121     LINKTIME_GC_DEFAULT=true</span>














122   else
<span class="line-modified">123     LINKTIME_GC_DEFAULT=false</span>
124   fi
125 
<span class="line-added">126   UTIL_ARG_ENABLE(NAME: linktime-gc, DEFAULT: $LINKTIME_GC_DEFAULT,</span>
<span class="line-added">127       DEFAULT_DESC: [auto], RESULT: ENABLE_LINKTIME_GC,</span>
<span class="line-added">128       DESC: [use link time gc on unused code sections in the JDK build],</span>
<span class="line-added">129       CHECKING_MSG: [if linker should clean out unused code (linktime-gc)])</span>
130   AC_SUBST(ENABLE_LINKTIME_GC)
131 
<span class="line-modified">132   # Check for full doc dependencies</span>
<span class="line-modified">133   FULL_DOCS_AVAILABLE=true</span>




134   AC_MSG_CHECKING([for graphviz dot])
135   if test &quot;x$DOT&quot; != &quot;x&quot;; then
136     AC_MSG_RESULT([yes])
137   else
138     AC_MSG_RESULT([no, cannot generate full docs])
<span class="line-modified">139     FULL_DOCS_AVAILABLE=false</span>
140   fi
141 
142   AC_MSG_CHECKING([for pandoc])
143   if test &quot;x$PANDOC&quot; != &quot;x&quot;; then
144     AC_MSG_RESULT([yes])
145   else
146     AC_MSG_RESULT([no, cannot generate full docs])
<span class="line-modified">147     FULL_DOCS_AVAILABLE=false</span>


























148   fi
149 
<span class="line-added">150   # Should we build the complete docs, or just a lightweight version?</span>
<span class="line-added">151   UTIL_ARG_ENABLE(NAME: full-docs, DEFAULT: auto, RESULT: ENABLE_FULL_DOCS,</span>
<span class="line-added">152       AVAILABLE: $FULL_DOCS_AVAILABLE, DESC: [build complete documentation],</span>
<span class="line-added">153       DEFAULT_DESC: [enabled if all tools found])</span>
154   AC_SUBST(ENABLE_FULL_DOCS)
155 
156   # Choose cacerts source file
157   AC_ARG_WITH(cacerts-file, [AS_HELP_STRING([--with-cacerts-file],
158       [specify alternative cacerts file])])
159   AC_MSG_CHECKING([for cacerts file])
160   if test &quot;x$with_cacerts_file&quot; == x; then
161     AC_MSG_RESULT([default])
162   else
163     CACERTS_FILE=$with_cacerts_file
164     if test ! -f &quot;$CACERTS_FILE&quot;; then
165       AC_MSG_RESULT([fail])
166       AC_MSG_ERROR([Specified cacerts file &quot;$CACERTS_FILE&quot; does not exist])
167     fi
168     AC_MSG_RESULT([$CACERTS_FILE])
169   fi
170   AC_SUBST(CACERTS_FILE)
171 
172   # Enable or disable unlimited crypto
<span class="line-modified">173   UTIL_ARG_ENABLE(NAME: unlimited-crypto, DEFAULT: true, RESULT: UNLIMITED_CRYPTO,</span>
<span class="line-modified">174       DESC: [enable unlimited crypto policy])</span>






175   AC_SUBST(UNLIMITED_CRYPTO)
176 
177   # Should we build the serviceability agent (SA)?
178   INCLUDE_SA=true
179   if HOTSPOT_CHECK_JVM_VARIANT(zero); then
180     INCLUDE_SA=false
181   fi
182   if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix ; then
183     INCLUDE_SA=false
184   fi
185   if test &quot;x$OPENJDK_TARGET_CPU&quot; = xs390x ; then
186     INCLUDE_SA=false
187   fi
188   AC_SUBST(INCLUDE_SA)
189 
190   # Compress jars
191   COMPRESS_JARS=false
192 
193   AC_SUBST(COMPRESS_JARS)
194 
</pre>
<hr />
<pre>
232 # Enable or disable the elliptic curve crypto implementation
233 #
234 AC_DEFUN_ONCE([JDKOPT_DETECT_INTREE_EC],
235 [
236   AC_MSG_CHECKING([if elliptic curve crypto implementation is present])
237 
238   if test -d &quot;${TOPDIR}/src/jdk.crypto.ec/share/native/libsunec/impl&quot;; then
239     ENABLE_INTREE_EC=true
240     AC_MSG_RESULT([yes])
241   else
242     ENABLE_INTREE_EC=false
243     AC_MSG_RESULT([no])
244   fi
245 
246   AC_SUBST(ENABLE_INTREE_EC)
247 ])
248 
249 AC_DEFUN_ONCE([JDKOPT_SETUP_DEBUG_SYMBOLS],
250 [
251   #
<span class="line-modified">252   # Native debug symbols.</span>
253   # This must be done after the toolchain is setup, since we&#39;re looking at objcopy.
254   #
255   AC_MSG_CHECKING([what type of native debug symbols to use])
256   AC_ARG_WITH([native-debug-symbols],
257       [AS_HELP_STRING([--with-native-debug-symbols],
258       [set the native debug symbol configuration (none, internal, external, zipped) @&lt;:@varying@:&gt;@])],
259       [
260         if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
261           if test &quot;x$withval&quot; = xexternal || test &quot;x$withval&quot; = xzipped; then
262             AC_MSG_ERROR([AIX only supports the parameters &#39;none&#39; and &#39;internal&#39; for --with-native-debug-symbols])
263           fi
<span class="line-modified">264         elif test &quot;x$OPENJDK_TARGET_OS&quot; = xwindows; then</span>
<span class="line-modified">265           if test &quot;x$withval&quot; = xinternal; then</span>
<span class="line-modified">266             AC_MSG_ERROR([Windows does not support the parameter &#39;internal&#39; for --with-native-debug-symbols])</span>


267           fi
268         fi
269       ],
270       [
271         if test &quot;x$STATIC_BUILD&quot; = xtrue; then
272           with_native_debug_symbols=&quot;none&quot;
273         else
274           if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
275             # AIX doesn&#39;t support &#39;external&#39; so use &#39;internal&#39; as default
276             with_native_debug_symbols=&quot;internal&quot;
277           else
278             with_native_debug_symbols=&quot;external&quot;
279           fi
280         fi
281       ])
<span class="line-modified">282   AC_MSG_RESULT([$with_native_debug_symbols])</span>

283 
<span class="line-modified">284   if test &quot;x$with_native_debug_symbols&quot; = xnone; then</span>
285     COMPILE_WITH_DEBUG_SYMBOLS=false
286     COPY_DEBUG_SYMBOLS=false
287     ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="line-modified">288   elif test &quot;x$with_native_debug_symbols&quot; = xinternal; then</span>
289     COMPILE_WITH_DEBUG_SYMBOLS=true
290     COPY_DEBUG_SYMBOLS=false
291     ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="line-modified">292   elif test &quot;x$with_native_debug_symbols&quot; = xexternal; then</span>
293 
294     if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
295       if test &quot;x$OBJCOPY&quot; = x; then
296         # enabling of enable-debug-symbols and can&#39;t find objcopy
297         # this is an error
298         AC_MSG_ERROR([Unable to find objcopy, cannot enable native debug symbols])
299       fi
300     fi
301 
302     COMPILE_WITH_DEBUG_SYMBOLS=true
303     COPY_DEBUG_SYMBOLS=true
304     ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="line-modified">305   elif test &quot;x$with_native_debug_symbols&quot; = xzipped; then</span>
306 
307     if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
308       if test &quot;x$OBJCOPY&quot; = x; then
309         # enabling of enable-debug-symbols and can&#39;t find objcopy
310         # this is an error
311         AC_MSG_ERROR([Unable to find objcopy, cannot enable native debug symbols])
312       fi
313     fi
314 
315     COMPILE_WITH_DEBUG_SYMBOLS=true
316     COPY_DEBUG_SYMBOLS=true
317     ZIP_EXTERNAL_DEBUG_SYMBOLS=true
318   else
319     AC_MSG_ERROR([Allowed native debug symbols are: none, internal, external, zipped])
320   fi
321 
322   AC_SUBST(COMPILE_WITH_DEBUG_SYMBOLS)
323   AC_SUBST(COPY_DEBUG_SYMBOLS)
324   AC_SUBST(ZIP_EXTERNAL_DEBUG_SYMBOLS)
<span class="line-added">325 </span>
<span class="line-added">326   # Should we add external native debug symbols to the shipped bundles?</span>
<span class="line-added">327   AC_MSG_CHECKING([if we should add external native debug symbols to the shipped bundles])</span>
<span class="line-added">328   AC_ARG_WITH([external-symbols-in-bundles],</span>
<span class="line-added">329       [AS_HELP_STRING([--with-external-symbols-in-bundles],</span>
<span class="line-added">330       [which type of external native debug symbol information shall be shipped in product bundles (none, public, full)</span>
<span class="line-added">331       (e.g. ship full/stripped pdbs on Windows) @&lt;:@none@:&gt;@])])</span>
<span class="line-added">332 </span>
<span class="line-added">333   if test &quot;x$with_external_symbols_in_bundles&quot; = x || test &quot;x$with_external_symbols_in_bundles&quot; = xnone ; then</span>
<span class="line-added">334     AC_MSG_RESULT([no])</span>
<span class="line-added">335   elif test &quot;x$with_external_symbols_in_bundles&quot; = xfull || test &quot;x$with_external_symbols_in_bundles&quot; = xpublic ; then</span>
<span class="line-added">336     if test &quot;x$OPENJDK_TARGET_OS&quot; != xwindows ; then</span>
<span class="line-added">337       AC_MSG_ERROR([--with-external-symbols-in-bundles currently only works on windows!])</span>
<span class="line-added">338     elif test &quot;x$COPY_DEBUG_SYMBOLS&quot; != xtrue ; then</span>
<span class="line-added">339       AC_MSG_ERROR([--with-external-symbols-in-bundles only works when --with-native-debug-symbols=external is used!])</span>
<span class="line-added">340     elif test &quot;x$with_external_symbols_in_bundles&quot; = xfull ; then</span>
<span class="line-added">341       AC_MSG_RESULT([full])</span>
<span class="line-added">342       SHIP_DEBUG_SYMBOLS=full</span>
<span class="line-added">343     else</span>
<span class="line-added">344       AC_MSG_RESULT([public])</span>
<span class="line-added">345       SHIP_DEBUG_SYMBOLS=public</span>
<span class="line-added">346     fi</span>
<span class="line-added">347   else</span>
<span class="line-added">348     AC_MSG_ERROR([$with_external_symbols_in_bundles is an unknown value for --with-external-symbols-in-bundles])</span>
<span class="line-added">349   fi</span>
<span class="line-added">350 </span>
<span class="line-added">351   AC_SUBST(SHIP_DEBUG_SYMBOLS)</span>
352 ])
353 
354 ################################################################################
355 #
356 # Native and Java code coverage
357 #
358 AC_DEFUN_ONCE([JDKOPT_SETUP_CODE_COVERAGE],
359 [
<span class="line-modified">360   UTIL_ARG_ENABLE(NAME: native-coverage, DEFAULT: false, RESULT: GCOV_ENABLED,</span>
<span class="line-modified">361       DESC: [enable native compilation with code coverage data],</span>
<span class="line-modified">362       CHECK_AVAILABLE: [</span>
<span class="line-modified">363         AC_MSG_CHECKING([if native coverage is available])</span>
<span class="line-modified">364         if test &quot;x$TOOLCHAIN_TYPE&quot; = &quot;xgcc&quot; ||</span>
<span class="line-modified">365             test &quot;x$TOOLCHAIN_TYPE&quot; = &quot;xclang&quot;; then</span>
<span class="line-modified">366           AC_MSG_RESULT([yes])</span>
<span class="line-modified">367         else</span>
<span class="line-added">368           AC_MSG_RESULT([no])</span>
<span class="line-added">369           AVAILABLE=false</span>
<span class="line-added">370         fi</span>
<span class="line-added">371       ],</span>
<span class="line-added">372       IF_ENABLED: [</span>
373         GCOV_CFLAGS=&quot;-fprofile-arcs -ftest-coverage -fno-inline&quot;
374         GCOV_LDFLAGS=&quot;-fprofile-arcs&quot;
375         JVM_CFLAGS=&quot;$JVM_CFLAGS $GCOV_CFLAGS&quot;
376         JVM_LDFLAGS=&quot;$JVM_LDFLAGS $GCOV_LDFLAGS&quot;
377         CFLAGS_JDKLIB=&quot;$CFLAGS_JDKLIB $GCOV_CFLAGS&quot;
378         CFLAGS_JDKEXE=&quot;$CFLAGS_JDKEXE $GCOV_CFLAGS&quot;
379         CXXFLAGS_JDKLIB=&quot;$CXXFLAGS_JDKLIB $GCOV_CFLAGS&quot;
380         CXXFLAGS_JDKEXE=&quot;$CXXFLAGS_JDKEXE $GCOV_CFLAGS&quot;
381         LDFLAGS_JDKLIB=&quot;$LDFLAGS_JDKLIB $GCOV_LDFLAGS&quot;
382         LDFLAGS_JDKEXE=&quot;$LDFLAGS_JDKEXE $GCOV_LDFLAGS&quot;
<span class="line-modified">383       ])</span>











384   AC_SUBST(GCOV_ENABLED)
385 
386   AC_ARG_WITH(jcov, [AS_HELP_STRING([--with-jcov],
387       [jcov library location])])
388   AC_ARG_WITH(jcov-input-jdk, [AS_HELP_STRING([--with-jcov-input-jdk],
389       [jdk image to instrument])])
390   AC_ARG_WITH(jcov-filters, [AS_HELP_STRING([--with-jcov-filters],
391       [filters to limit code for jcov instrumentation and report generation])])
392   JCOV_HOME=
393   JCOV_INPUT_JDK=
394   JCOV_ENABLED=
395   JCOV_FILTERS=
396   if test &quot;x$with_jcov&quot; = &quot;x&quot; ; then
397     JCOV_ENABLED=&quot;false&quot;
398   else
399     JCOV_HOME=&quot;$with_jcov&quot;
400     if test ! -f &quot;$JCOV_HOME/lib/jcov.jar&quot;; then
401       AC_MSG_RESULT([fail])
402       AC_MSG_ERROR([Invalid JCov bundle: &quot;$JCOV_HOME/lib/jcov.jar&quot; does not exist])
403     fi
404     JCOV_ENABLED=&quot;true&quot;
<span class="line-modified">405     UTIL_FIXUP_PATH(JCOV_HOME)</span>
406     if test &quot;x$with_jcov_input_jdk&quot; != &quot;x&quot; ; then
407       JCOV_INPUT_JDK=&quot;$with_jcov_input_jdk&quot;
408       if test ! -f &quot;$JCOV_INPUT_JDK/bin/java$EXE_SUFFIX&quot;; then
409         AC_MSG_RESULT([fail])
410         AC_MSG_ERROR([Invalid JDK bundle: &quot;$JCOV_INPUT_JDK/bin/java$EXE_SUFFIX&quot; does not exist])
411       fi
<span class="line-modified">412       UTIL_FIXUP_PATH(JCOV_INPUT_JDK)</span>
413     fi
414     if test &quot;x$with_jcov_filters&quot; != &quot;x&quot; ; then
415       JCOV_FILTERS=&quot;$with_jcov_filters&quot;
416     fi
417   fi
418   AC_SUBST(JCOV_ENABLED)
419   AC_SUBST(JCOV_HOME)
420   AC_SUBST(JCOV_INPUT_JDK)
421   AC_SUBST(JCOV_FILTERS)
422 ])
423 
424 ###############################################################################
425 #
426 # AddressSanitizer
427 #
428 AC_DEFUN_ONCE([JDKOPT_SETUP_ADDRESS_SANITIZER],
429 [
<span class="line-modified">430   UTIL_ARG_ENABLE(NAME: asan, DEFAULT: false,</span>
<span class="line-modified">431       DESC: [enable AddressSanitizer],</span>
<span class="line-modified">432       CHECK_AVAILABLE: [</span>
<span class="line-modified">433         AC_MSG_CHECKING([if AddressSanitizer (asan) is available])</span>
<span class="line-modified">434         if test &quot;x$TOOLCHAIN_TYPE&quot; = &quot;xgcc&quot; ||</span>
<span class="line-modified">435             test &quot;x$TOOLCHAIN_TYPE&quot; = &quot;xclang&quot;; then</span>
<span class="line-modified">436           AC_MSG_RESULT([yes])</span>
<span class="line-modified">437         else</span>
<span class="line-added">438           AC_MSG_RESULT([no])</span>
<span class="line-added">439           AVAILABLE=false</span>
<span class="line-added">440         fi</span>
<span class="line-added">441       ],</span>
<span class="line-added">442       IF_ENABLED: [</span>
443         ASAN_CFLAGS=&quot;-fsanitize=address -fno-omit-frame-pointer&quot;
444         ASAN_LDFLAGS=&quot;-fsanitize=address&quot;
445         JVM_CFLAGS=&quot;$JVM_CFLAGS $ASAN_CFLAGS&quot;
446         JVM_LDFLAGS=&quot;$JVM_LDFLAGS $ASAN_LDFLAGS&quot;
447         CFLAGS_JDKLIB=&quot;$CFLAGS_JDKLIB $ASAN_CFLAGS&quot;
448         CFLAGS_JDKEXE=&quot;$CFLAGS_JDKEXE $ASAN_CFLAGS&quot;
449         CXXFLAGS_JDKLIB=&quot;$CXXFLAGS_JDKLIB $ASAN_CFLAGS&quot;
450         CXXFLAGS_JDKEXE=&quot;$CXXFLAGS_JDKEXE $ASAN_CFLAGS&quot;
451         LDFLAGS_JDKLIB=&quot;$LDFLAGS_JDKLIB $ASAN_LDFLAGS&quot;
452         LDFLAGS_JDKEXE=&quot;$LDFLAGS_JDKEXE $ASAN_LDFLAGS&quot;
453         ASAN_ENABLED=&quot;yes&quot;
<span class="line-modified">454       ],</span>
<span class="line-modified">455       IF_DISABLED: [</span>
<span class="line-modified">456         ASAN_ENABLED=&quot;no&quot;</span>
<span class="line-modified">457       ])</span>







458 
459   AC_SUBST(ASAN_ENABLED)
460 ])
461 
462 ################################################################################
463 #
464 # Static build support.  When enabled will generate static
465 # libraries instead of shared libraries for all JDK libs.
466 #
467 AC_DEFUN_ONCE([JDKOPT_SETUP_STATIC_BUILD],
468 [
<span class="line-modified">469   UTIL_ARG_ENABLE(NAME: static-build, DEFAULT: false, RESULT: STATIC_BUILD,</span>
<span class="line-modified">470       DESC: [enable static library build],</span>
<span class="line-modified">471       CHECKING_MSG: [if static build is enabled],</span>
<span class="line-modified">472       CHECK_AVAILABLE: [</span>
<span class="line-modified">473         AC_MSG_CHECKING([if static build is available])</span>
<span class="line-modified">474         if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xmacosx&quot;; then</span>
<span class="line-modified">475           AC_MSG_RESULT([yes])</span>
<span class="line-modified">476         else</span>
<span class="line-modified">477           AC_MSG_RESULT([no])</span>
<span class="line-modified">478           AVAILABLE=false</span>
<span class="line-modified">479         fi</span>
<span class="line-modified">480       ],</span>
<span class="line-modified">481       IF_ENABLED: [</span>
<span class="line-modified">482         STATIC_BUILD_CFLAGS=&quot;-DSTATIC_BUILD=1&quot;</span>
<span class="line-modified">483         CFLAGS_JDKLIB_EXTRA=&quot;$CFLAGS_JDKLIB_EXTRA $STATIC_BUILD_CFLAGS&quot;</span>
<span class="line-modified">484         CXXFLAGS_JDKLIB_EXTRA=&quot;$CXXFLAGS_JDKLIB_EXTRA $STATIC_BUILD_CFLAGS&quot;</span>
<span class="line-modified">485       ])</span>



486   AC_SUBST(STATIC_BUILD)
487 ])
488 
489 ################################################################################
490 #
491 # jlink options.
492 # We always keep packaged modules in JDK image.
493 #
494 AC_DEFUN_ONCE([JDKOPT_SETUP_JLINK_OPTIONS],
495 [
<span class="line-modified">496   UTIL_ARG_ENABLE(NAME: keep-packaged-modules, DEFAULT: true,</span>
<span class="line-modified">497       RESULT: JLINK_KEEP_PACKAGED_MODULES,</span>
<span class="line-modified">498       DESC: [enable keeping of packaged modules in jdk image],</span>
<span class="line-modified">499       CHECKING_MSG: [if packaged modules are kept])</span>














500   AC_SUBST(JLINK_KEEP_PACKAGED_MODULES)
501 ])
502 
503 ################################################################################
504 #
505 # Check if building of the jtreg failure handler should be enabled.
506 #
507 AC_DEFUN_ONCE([JDKOPT_ENABLE_DISABLE_FAILURE_HANDLER],
508 [
<span class="line-modified">509   UTIL_ARG_ENABLE(NAME: jtreg-failure-handler, DEFAULT: auto,</span>
<span class="line-modified">510       RESULT: BUILD_FAILURE_HANDLER,</span>
<span class="line-modified">511       DESC: [enable keeping of packaged modules in jdk image],</span>
<span class="line-modified">512       DEFAULT_DESC: [enabled if jtreg is present],</span>
<span class="line-modified">513       CHECKING_MSG: [if the jtreg failure handler should be built],</span>
<span class="line-modified">514       CHECK_AVAILABLE: [</span>
<span class="line-modified">515         AC_MSG_CHECKING([if the jtreg failure handler is available])</span>
<span class="line-modified">516         if test &quot;x$JT_HOME&quot; != &quot;x&quot;; then</span>
<span class="line-modified">517           AC_MSG_RESULT([yes])</span>
<span class="line-modified">518         else</span>
<span class="line-modified">519           AVAILABLE=false</span>
<span class="line-modified">520           AC_MSG_RESULT([no (jtreg not present)])</span>
<span class="line-modified">521         fi</span>
<span class="line-modified">522       ])</span>
















523   AC_SUBST(BUILD_FAILURE_HANDLER)
524 ])
525 
526 ################################################################################
527 #
528 # Enable or disable generation of the classlist at build time
529 #
530 AC_DEFUN_ONCE([JDKOPT_ENABLE_DISABLE_GENERATE_CLASSLIST],
531 [
<span class="line-modified">532   # In GenerateLinkOptData.gmk, DumpLoadedClassList is used to generate the</span>
<span class="line-modified">533   # classlist file. It never will work if CDS is disabled, since the VM will report</span>
<span class="line-modified">534   # an error for DumpLoadedClassList.</span>
<span class="line-modified">535   UTIL_ARG_ENABLE(NAME: generate-classlist, DEFAULT: auto,</span>
<span class="line-modified">536       RESULT: ENABLE_GENERATE_CLASSLIST, AVAILABLE: $ENABLE_CDS,</span>
<span class="line-modified">537       DESC: [enable generation of a CDS classlist at build time],</span>
<span class="line-modified">538       DEFAULT_DESC: [enabled if the JVM feature &#39;cds&#39; is enabled for all JVM variants],</span>
<span class="line-modified">539       CHECKING_MSG: [if the CDS classlist generation should be enabled])</span>


































540   AC_SUBST(ENABLE_GENERATE_CLASSLIST)
541 ])
542 
543 ################################################################################
544 #
545 # Optionally filter resource translations
546 #
547 AC_DEFUN([JDKOPT_EXCLUDE_TRANSLATIONS],
548 [
549   AC_ARG_WITH([exclude-translations], [AS_HELP_STRING([--with-exclude-translations],
550       [a comma separated list of locales to exclude translations for. Default is
551       to include all translations present in the source.])])
552 
553   EXCLUDE_TRANSLATIONS=&quot;&quot;
554   AC_MSG_CHECKING([if any translations should be excluded])
555   if test &quot;x$with_exclude_translations&quot; != &quot;x&quot;; then
556     EXCLUDE_TRANSLATIONS=&quot;${with_exclude_translations//,/ }&quot;
557     AC_MSG_RESULT([yes: $EXCLUDE_TRANSLATIONS])
558   else
559     AC_MSG_RESULT([no])
560   fi
561 
562   AC_SUBST(EXCLUDE_TRANSLATIONS)
563 ])
564 
565 ################################################################################
566 #
567 # Optionally disable man pages
568 #
569 AC_DEFUN([JDKOPT_ENABLE_DISABLE_MANPAGES],
570 [
<span class="line-modified">571   UTIL_ARG_ENABLE(NAME: manpages, DEFAULT: true, RESULT: BUILD_MANPAGES,</span>
<span class="line-modified">572       DESC: [enable copying of static man pages],</span>
<span class="line-modified">573       CHECKING_MSG: [if static man pages should be copied])</span>














574   AC_SUBST(BUILD_MANPAGES)
575 ])
576 
577 ################################################################################
578 #
579 # Disable the default CDS archive generation

580 #
581 AC_DEFUN([JDKOPT_ENABLE_DISABLE_CDS_ARCHIVE],
582 [
<span class="line-modified">583   UTIL_ARG_ENABLE(NAME: cds-archive, DEFAULT: auto, RESULT: BUILD_CDS_ARCHIVE,</span>
<span class="line-modified">584       DESC: [enable generation of a default CDS archive in the product image],</span>
<span class="line-modified">585       DEFAULT_DESC: [enabled if possible],</span>
<span class="line-modified">586       CHECKING_MSG: [if a default CDS archive should be generated],</span>
<span class="line-modified">587       CHECK_AVAILABLE: [</span>
<span class="line-modified">588         AC_MSG_CHECKING([if CDS archive is available])</span>
<span class="line-modified">589         if test &quot;x$ENABLE_CDS&quot; = &quot;xfalse&quot;; then</span>
<span class="line-modified">590           AC_MSG_RESULT([no (CDS is disabled)])</span>
<span class="line-modified">591           AVAILABLE=false</span>
<span class="line-modified">592         elif test &quot;x$COMPILE_TYPE&quot; = &quot;xcross&quot;; then</span>
<span class="line-modified">593           AC_MSG_RESULT([no (not possible with cross compilation)])</span>
<span class="line-modified">594           AVAILABLE=false</span>
<span class="line-modified">595         else</span>
<span class="line-modified">596           AC_MSG_RESULT([yes])</span>
<span class="line-modified">597         fi</span>
<span class="line-modified">598       ])</span>








599   AC_SUBST(BUILD_CDS_ARCHIVE)
600 ])
</pre>
</td>
</tr>
</table>
<center><a href="hotspot.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="lib-ffi.m4.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>