<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/toolchain.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="spec.gmk.in.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="toolchain_windows.m4.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/toolchain.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  15 # accompanied this code).
  16 #
  17 # You should have received a copy of the GNU General Public License version
  18 # 2 along with this work; if not, write to the Free Software Foundation,
  19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20 #
  21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22 # or visit www.oracle.com if you need additional information or have any
  23 # questions.
  24 #
  25 
  26 ########################################################################
  27 # This file is responsible for detecting, verifying and setting up the
  28 # toolchain, i.e. the compiler, linker and related utilities. It will setup
  29 # proper paths to the binaries, but it will not setup any flags.
  30 #
  31 # The binaries used is determined by the toolchain type, which is the family of
  32 # compilers and related tools that are used.
  33 ########################################################################
  34 

  35 
  36 # All valid toolchains, regardless of platform (used by help.m4)
  37 VALID_TOOLCHAINS_all=&quot;gcc clang solstudio xlc microsoft&quot;
  38 
  39 # These toolchains are valid on different platforms
  40 VALID_TOOLCHAINS_linux=&quot;gcc clang&quot;
  41 VALID_TOOLCHAINS_solaris=&quot;solstudio&quot;
  42 VALID_TOOLCHAINS_macosx=&quot;gcc clang&quot;
  43 VALID_TOOLCHAINS_aix=&quot;xlc&quot;
  44 VALID_TOOLCHAINS_windows=&quot;microsoft&quot;
  45 
  46 # Toolchain descriptions
  47 TOOLCHAIN_DESCRIPTION_clang=&quot;clang/LLVM&quot;
  48 TOOLCHAIN_DESCRIPTION_gcc=&quot;GNU Compiler Collection&quot;
  49 TOOLCHAIN_DESCRIPTION_microsoft=&quot;Microsoft Visual Studio&quot;
  50 TOOLCHAIN_DESCRIPTION_solstudio=&quot;Oracle Solaris Studio&quot;
  51 TOOLCHAIN_DESCRIPTION_xlc=&quot;IBM XL C/C++&quot;
  52 
  53 # Minimum supported versions, empty means unspecified
  54 TOOLCHAIN_MINIMUM_VERSION_clang=&quot;3.2&quot;
</pre>
<hr />
<pre>
  75   # We only check CC_VERSION_NUMBER since we assume CXX_VERSION_NUMBER is equal.
  76   if [ [[ &quot;[$]$1CC_VERSION_NUMBER&quot; =~ (.*\.){4} ]] ]; then
  77     AC_MSG_WARN([C compiler version number has more than four parts (W.X.Y.Z): [$]$1CC_VERSION_NUMBER. Comparisons might be wrong.])
  78   fi
  79 
  80   if [ [[  &quot;[$]$1CC_VERSION_NUMBER&quot; =~ [0-9]{6} ]] ]; then
  81     AC_MSG_WARN([C compiler version number has a part larger than 99999: [$]$1CC_VERSION_NUMBER. Comparisons might be wrong.])
  82   fi
  83 
  84   $2COMPARABLE_ACTUAL_VERSION=`$AWK -F. &#39;{ printf(&quot;%05d%05d%05d%05d\n&quot;, [$]1, [$]2, [$]3, [$]4) }&#39; &lt;&lt;&lt; &quot;[$]$1CC_VERSION_NUMBER&quot;`
  85 ])
  86 
  87 # Check if the configured compiler (C and C++) is of a specific version or
  88 # newer. TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS must have been called before.
  89 #
  90 # Arguments:
  91 #   VERSION:   The version string to check against the found version
  92 #   IF_AT_LEAST:   block to run if the compiler is at least this version (&gt;=)
  93 #   IF_OLDER_THAN:   block to run if the compiler is older than this version (&lt;)
  94 #   PREFIX:   Optional variable prefix for compiler to compare version for (OPENJDK_BUILD_)
<span class="line-modified">  95 BASIC_DEFUN_NAMED([TOOLCHAIN_CHECK_COMPILER_VERSION],</span>
  96     [*VERSION PREFIX IF_AT_LEAST IF_OLDER_THAN], [$@],
  97 [
  98   # Need to assign to a variable since m4 is blocked from modifying parts in [].
  99   REFERENCE_VERSION=ARG_VERSION
 100 
 101   if [ [[ &quot;$REFERENCE_VERSION&quot; =~ (.*\.){4} ]] ]; then
 102     AC_MSG_ERROR([Internal error: Cannot compare to ARG_VERSION, only four parts (W.X.Y.Z) is supported])
 103   fi
 104 
 105   if [ [[ &quot;$REFERENCE_VERSION&quot; =~ [0-9]{6} ]] ]; then
 106     AC_MSG_ERROR([Internal error: Cannot compare to ARG_VERSION, only parts &lt; 99999 is supported])
 107   fi
 108 
 109   # Version comparison method inspired by http://stackoverflow.com/a/24067243
 110   COMPARABLE_REFERENCE_VERSION=`$AWK -F. &#39;{ printf(&quot;%05d%05d%05d%05d\n&quot;, [$]1, [$]2, [$]3, [$]4) }&#39; &lt;&lt;&lt; &quot;$REFERENCE_VERSION&quot;`
 111 
 112   if test [$]ARG_PREFIX[COMPARABLE_ACTUAL_VERSION] -ge $COMPARABLE_REFERENCE_VERSION ; then
 113     :
 114     ARG_IF_AT_LEAST
 115   else
</pre>
<hr />
<pre>
 126 [
 127   if [ [[ &quot;[$]$1LD_VERSION_NUMBER&quot; =~ (.*\.){4} ]] ]; then
 128     AC_MSG_WARN([Linker version number has more than four parts (W.X.Y.Z): [$]$1LD_VERSION_NUMBER. Comparisons might be wrong.])
 129   fi
 130 
 131   if [ [[  &quot;[$]$1LD_VERSION_NUMBER&quot; =~ [0-9]{6} ]] ]; then
 132     AC_MSG_WARN([Linker version number has a part larger than 99999: [$]$1LD_VERSION_NUMBER. Comparisons might be wrong.])
 133   fi
 134 
 135   $2COMPARABLE_ACTUAL_LD_VERSION=`$AWK -F. &#39;{ printf(&quot;%05d%05d%05d%05d\n&quot;, [$]1, [$]2, [$]3, [$]4) }&#39; &lt;&lt;&lt; &quot;[$]$1LD_VERSION_NUMBER&quot;`
 136 ])
 137 
 138 # Check if the configured linker is of a specific version or
 139 # newer. TOOLCHAIN_PREPARE_FOR_LD_VERSION_COMPARISONS must have been called before.
 140 #
 141 # Arguments:
 142 #   VERSION:   The version string to check against the found version
 143 #   IF_AT_LEAST:   block to run if the compiler is at least this version (&gt;=)
 144 #   IF_OLDER_THAN:   block to run if the compiler is older than this version (&lt;)
 145 #   PREFIX:   Optional variable prefix for compiler to compare version for (OPENJDK_BUILD_)
<span class="line-modified"> 146 BASIC_DEFUN_NAMED([TOOLCHAIN_CHECK_LINKER_VERSION],</span>
 147     [*VERSION PREFIX IF_AT_LEAST IF_OLDER_THAN], [$@],
 148 [
 149   # Need to assign to a variable since m4 is blocked from modifying parts in [].
 150   REFERENCE_VERSION=ARG_VERSION
 151 
 152   if [ [[ &quot;$REFERENCE_VERSION&quot; =~ (.*\.){4} ]] ]; then
 153     AC_MSG_ERROR([Internal error: Cannot compare to ARG_VERSION, only four parts (W.X.Y.Z) is supported])
 154   fi
 155 
 156   if [ [[ &quot;$REFERENCE_VERSION&quot; =~ [0-9]{6} ]] ]; then
 157     AC_MSG_ERROR([Internal error: Cannot compare to ARG_VERSION, only parts &lt; 99999 is supported])
 158   fi
 159 
 160   # Version comparison method inspired by http://stackoverflow.com/a/24067243
 161   COMPARABLE_REFERENCE_VERSION=`$AWK -F. &#39;{ printf(&quot;%05d%05d%05d%05d\n&quot;, [$]1, [$]2, [$]3, [$]4) }&#39; &lt;&lt;&lt; &quot;$REFERENCE_VERSION&quot;`
 162 
 163   if test [$]ARG_PREFIX[COMPARABLE_ACTUAL_LD_VERSION] -ge $COMPARABLE_REFERENCE_VERSION ; then
 164     :
 165     ARG_IF_AT_LEAST
 166   else
</pre>
<hr />
<pre>
 332   # FIXME: Is this needed?
 333   AC_LANG(C++)
 334 
 335   # Store the CFLAGS etc passed to the configure script.
 336   ORG_CFLAGS=&quot;$CFLAGS&quot;
 337   ORG_CXXFLAGS=&quot;$CXXFLAGS&quot;
 338 
 339   # autoconf magic only relies on PATH, so update it if tools dir is specified
 340   OLD_PATH=&quot;$PATH&quot;
 341 
 342   # On Windows, we need to detect the visual studio installation first.
 343   # This will change the PATH, but we need to keep that new PATH even
 344   # after toolchain detection is done, since the compiler (on x86) uses
 345   # it for DLL resolution in runtime.
 346   if test &quot;x$OPENJDK_BUILD_OS&quot; = &quot;xwindows&quot; \
 347       &amp;&amp; test &quot;x$TOOLCHAIN_TYPE&quot; = &quot;xmicrosoft&quot;; then
 348     TOOLCHAIN_SETUP_VISUAL_STUDIO_ENV
 349     if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
 350       # Append VS_PATH. In WSL, VS_PATH will not contain the WSL env path needed
 351       # for using basic Unix tools, so need to keep the original PATH.
<span class="line-modified"> 352       BASIC_APPEND_TO_PATH(PATH, $VS_PATH)</span>
<span class="line-modified"> 353       BASIC_APPEND_TO_PATH(WSLENV, &quot;PATH/l:LIB:INCLUDE&quot;)</span>
 354       export WSLENV
 355     else
 356       # Reset path to VS_PATH. It will include everything that was on PATH at the time we
 357       # ran TOOLCHAIN_SETUP_VISUAL_STUDIO_ENV.
 358       PATH=&quot;$VS_PATH&quot;
 359     fi
 360     # The microsoft toolchain also requires INCLUDE and LIB to be set.
 361     export INCLUDE=&quot;$VS_INCLUDE&quot;
 362     export LIB=&quot;$VS_LIB&quot;
 363   else
 364     if test &quot;x$XCODE_VERSION_OUTPUT&quot; != x; then
 365       # For Xcode, we set the Xcode version as TOOLCHAIN_VERSION
 366       TOOLCHAIN_VERSION=`$ECHO $XCODE_VERSION_OUTPUT | $CUT -f 2 -d &#39; &#39;`
 367       TOOLCHAIN_DESCRIPTION=&quot;$TOOLCHAIN_DESCRIPTION from Xcode $TOOLCHAIN_VERSION&quot;
 368     else
 369       # Currently we do not define this for other toolchains. This might change as the need arise.
 370       TOOLCHAIN_VERSION=
 371     fi
 372   fi
 373   AC_SUBST(TOOLCHAIN_VERSION)
</pre>
<hr />
<pre>
 563       PATH=&quot;$TOOLCHAIN_PATH&quot;
 564       AC_PATH_TOOL(TOOLCHAIN_PATH_$1, $SEARCH_LIST)
 565       $1=$TOOLCHAIN_PATH_$1
 566       PATH=&quot;$PATH_save&quot;
 567     fi
 568 
 569     # AC_PATH_TOOL can&#39;t be run multiple times with the same variable,
 570     # so create a new name for this run.
 571     if test &quot;x[$]$1&quot; = x; then
 572       AC_PATH_TOOL(POTENTIAL_$1, $SEARCH_LIST)
 573       $1=$POTENTIAL_$1
 574     fi
 575 
 576     if test &quot;x[$]$1&quot; = x; then
 577       HELP_MSG_MISSING_DEPENDENCY([devkit])
 578       AC_MSG_ERROR([Could not find a $COMPILER_NAME compiler. $HELP_MSG])
 579     fi
 580   fi
 581 
 582   # Now we have a compiler binary in $1. Make sure it&#39;s okay.
<span class="line-modified"> 583   BASIC_FIXUP_EXECUTABLE($1)</span>
 584   TEST_COMPILER=&quot;[$]$1&quot;
 585 
 586   AC_MSG_CHECKING([resolved symbolic links for $1])
 587   SYMLINK_ORIGINAL=&quot;$TEST_COMPILER&quot;
<span class="line-modified"> 588   BASIC_REMOVE_SYMBOLIC_LINKS(SYMLINK_ORIGINAL)</span>
 589   if test &quot;x$TEST_COMPILER&quot; = &quot;x$SYMLINK_ORIGINAL&quot;; then
 590     AC_MSG_RESULT([no symlink])
 591   else
 592     AC_MSG_RESULT([$SYMLINK_ORIGINAL])
 593 
 594     # We can&#39;t handle ccache by gcc wrappers, since we need to know if we&#39;re
 595     # using ccache. Instead ccache usage must be controlled by a configure option.
 596     COMPILER_BASENAME=`$BASENAME &quot;$SYMLINK_ORIGINAL&quot;`
 597     if test &quot;x$COMPILER_BASENAME&quot; = &quot;xccache&quot;; then
 598       AC_MSG_NOTICE([Please use --enable-ccache instead of providing a wrapped compiler.])
 599       AC_MSG_ERROR([$TEST_COMPILER is a symbolic link to ccache. This is not supported.])
 600     fi
 601   fi
 602 
 603   TOOLCHAIN_EXTRACT_COMPILER_VERSION([$1], [$COMPILER_NAME])
 604 ])
 605 
 606 # Retrieve the linker version number and store it in LD_VERSION_NUMBER
 607 # (as a dotted number), and
 608 # the full version string in LD_VERSION_STRING.
</pre>
<hr />
<pre>
 699   AC_PROG_CXX([$CXX])
 700 
 701   # This is the compiler version number on the form X.Y[.Z]
 702   AC_SUBST(CC_VERSION_NUMBER)
 703   AC_SUBST(CXX_VERSION_NUMBER)
 704 
 705   TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS
 706 
 707   if test &quot;x$TOOLCHAIN_MINIMUM_VERSION&quot; != x; then
 708     TOOLCHAIN_CHECK_COMPILER_VERSION(VERSION: $TOOLCHAIN_MINIMUM_VERSION,
 709         IF_OLDER_THAN: [
 710           AC_MSG_WARN([You are using $TOOLCHAIN_TYPE older than $TOOLCHAIN_MINIMUM_VERSION. This is not a supported configuration.])
 711         ]
 712     )
 713   fi
 714 
 715   #
 716   # Setup the preprocessor (CPP and CXXCPP)
 717   #
 718   AC_PROG_CPP
<span class="line-modified"> 719   BASIC_FIXUP_EXECUTABLE(CPP)</span>
 720   AC_PROG_CXXCPP
<span class="line-modified"> 721   BASIC_FIXUP_EXECUTABLE(CXXCPP)</span>
 722 
 723   #
 724   # Setup the linker (LD)
 725   #
 726   if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 727     # In the Microsoft toolchain we have a separate LD command &quot;link&quot;.
 728     # Make sure we reject /usr/bin/link (as determined in CYGWIN_LINK), which is
 729     # a cygwin program for something completely different.
 730     AC_CHECK_PROG([LD], [link$EXE_SUFFIX],[link$EXE_SUFFIX],,, [$CYGWIN_LINK])
<span class="line-modified"> 731     BASIC_FIXUP_EXECUTABLE(LD)</span>
 732     # Verify that we indeed succeeded with this trick.
 733     AC_MSG_CHECKING([if the found link.exe is actually the Visual Studio linker])
 734     &quot;$LD&quot; --version &gt; /dev/null
 735     if test $? -eq 0 ; then
 736       AC_MSG_RESULT([no])
 737       AC_MSG_ERROR([This is the Cygwin link tool. Please check your PATH and rerun configure.])
 738     else
 739       AC_MSG_RESULT([yes])
 740     fi
 741     LDCXX=&quot;$LD&quot;
 742     # jaotc being a windows program expects the linker to be supplied with exe suffix.
 743     LD_JAOTC=&quot;$LD$EXE_SUFFIX&quot;
 744   else
 745     # All other toolchains use the compiler to link.
 746     LD=&quot;$CC&quot;
 747     LDCXX=&quot;$CXX&quot;
 748     # jaotc expects &#39;ld&#39; as the linker rather than the compiler.
<span class="line-modified"> 749     BASIC_CHECK_TOOLS([LD_JAOTC], ld)</span>
<span class="line-modified"> 750     BASIC_FIXUP_EXECUTABLE(LD_JAOTC)</span>
 751   fi
 752   AC_SUBST(LD)
 753   AC_SUBST(LD_JAOTC)
 754   # FIXME: it should be CXXLD, according to standard (cf CXXCPP)
 755   AC_SUBST(LDCXX)
 756 
 757   TOOLCHAIN_EXTRACT_LD_VERSION([LD], [linker])
 758   TOOLCHAIN_PREPARE_FOR_LD_VERSION_COMPARISONS
 759 
 760   if test &quot;x$TOOLCHAIN_MINIMUM_LD_VERSION&quot; != x; then
 761     TOOLCHAIN_CHECK_LINKER_VERSION(VERSION: $TOOLCHAIN_MINIMUM_LD_VERSION,
 762         IF_OLDER_THAN: [
 763           AC_MSG_WARN([You are using a linker older than $TOOLCHAIN_MINIMUM_LD_VERSION. This is not a supported configuration.])
 764         ]
 765     )
 766   fi
 767 
 768   #
 769   # Setup the assembler (AS)
 770   #
 771   if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris; then
<span class="line-modified"> 772     BASIC_PATH_PROGS(AS, as)</span>
<span class="line-modified"> 773     BASIC_FIXUP_EXECUTABLE(AS)</span>
 774     if test &quot;x$AS&quot; = x; then
 775       AC_MSG_ERROR([Solaris assembler (as) is required. Please install via &quot;pkg install pkg:/developer/assembler&quot;.])
 776     fi
 777   else
 778     # FIXME: is this correct for microsoft?
 779     AS=&quot;$CC -c&quot;
 780   fi
 781   AC_SUBST(AS)
 782 
 783   #
 784   # Setup the archiver (AR)
 785   #
 786   if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 787     # The corresponding ar tool is lib.exe (used to create static libraries)
 788     AC_CHECK_PROG([AR], [lib$EXE_SUFFIX],[lib$EXE_SUFFIX],,,)
 789   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
<span class="line-modified"> 790     BASIC_CHECK_TOOLS(AR, ar gcc-ar)</span>
 791   else
<span class="line-modified"> 792     BASIC_CHECK_TOOLS(AR, ar)</span>
 793   fi
<span class="line-modified"> 794   BASIC_FIXUP_EXECUTABLE(AR)</span>
 795 ])
 796 
 797 # Setup additional tools that is considered a part of the toolchain, but not the
 798 # core part. Many of these are highly platform-specific and do not exist,
 799 # and/or are not needed on all platforms.
 800 AC_DEFUN_ONCE([TOOLCHAIN_DETECT_TOOLCHAIN_EXTRA],
 801 [
 802   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xmacosx&quot;; then
<span class="line-modified"> 803     BASIC_PATH_PROGS(LIPO, lipo)</span>
<span class="line-modified"> 804     BASIC_FIXUP_EXECUTABLE(LIPO)</span>
<span class="line-modified"> 805     BASIC_REQUIRE_PROGS(OTOOL, otool)</span>
<span class="line-modified"> 806     BASIC_FIXUP_EXECUTABLE(OTOOL)</span>
<span class="line-modified"> 807     BASIC_REQUIRE_PROGS(INSTALL_NAME_TOOL, install_name_tool)</span>
<span class="line-modified"> 808     BASIC_FIXUP_EXECUTABLE(INSTALL_NAME_TOOL)</span>
<span class="line-modified"> 809 </span>
<span class="line-modified"> 810     BASIC_PATH_PROGS(METAL, metal)</span>
 811     if test &quot;x$METAL&quot; = x; then
 812       AC_MSG_CHECKING([if metal can be run using xcrun])
 813       METAL=&quot;xcrun -sdk macosx metal&quot;
 814       test_metal=`$METAL --version 2&gt;&amp;1`
 815       if test $? -ne 0; then
 816         AC_MSG_RESULT([no])
 817         AC_MSG_ERROR([XCode tool &#39;metal&#39; neither found in path nor with xcrun])
 818       else
 819         AC_MSG_RESULT([yes, will be using &#39;$METAL&#39;])
 820       fi
 821     fi
 822 
<span class="line-modified"> 823     BASIC_PATH_PROGS(METALLIB, metallib)</span>
 824     if test &quot;x$METALLIB&quot; = x; then
 825       AC_MSG_CHECKING([if metallib can be run using xcrun])
 826       METALLIB=&quot;xcrun -sdk macosx metallib&quot;
 827       test_metallib=`$METALLIB --version 2&gt;&amp;1`
 828       if test $? -ne 0; then
 829         AC_MSG_RESULT([no])
 830         AC_MSG_ERROR([XCode tool &#39;metallib&#39; neither found in path nor with xcrun])
 831       else
 832         AC_MSG_RESULT([yes, will be using &#39;$METALLIB&#39;])
 833       fi
 834     fi
 835   fi
 836 
 837   if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 838     AC_CHECK_PROG([MT], [mt$EXE_SUFFIX], [mt$EXE_SUFFIX],,, [/usr/bin/mt])
<span class="line-modified"> 839     BASIC_FIXUP_EXECUTABLE(MT)</span>
 840     # Setup the resource compiler (RC)
 841     AC_CHECK_PROG([RC], [rc$EXE_SUFFIX], [rc$EXE_SUFFIX],,, [/usr/bin/rc])
<span class="line-modified"> 842     BASIC_FIXUP_EXECUTABLE(RC)</span>
 843     AC_CHECK_PROG([DUMPBIN], [dumpbin$EXE_SUFFIX], [dumpbin$EXE_SUFFIX],,,)
<span class="line-modified"> 844     BASIC_FIXUP_EXECUTABLE(DUMPBIN)</span>
 845     # We need to check for &#39;msbuild.exe&#39; because at the place where we expect to
 846     # find &#39;msbuild.exe&#39; there&#39;s also a directory called &#39;msbuild&#39; and configure
 847     # won&#39;t find the &#39;msbuild.exe&#39; executable in that case (and the
 848     # &#39;ac_executable_extensions&#39; is unusable due to performance reasons).
 849     # Notice that we intentionally don&#39;t fix up the path to MSBUILD because we
 850     # will call it in a DOS shell during freetype detection on Windows (see
 851     # &#39;LIB_SETUP_FREETYPE&#39; in &quot;libraries.m4&quot;
 852     AC_CHECK_PROG([MSBUILD], [msbuild$EXE_SUFFIX], [msbuild$EXE_SUFFIX],,,)
 853   fi
 854 
 855   if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris; then
<span class="line-modified"> 856     BASIC_PATH_PROGS(STRIP, strip)</span>
<span class="line-modified"> 857     BASIC_FIXUP_EXECUTABLE(STRIP)</span>
<span class="line-modified"> 858     BASIC_PATH_PROGS(NM, nm)</span>
<span class="line-modified"> 859     BASIC_FIXUP_EXECUTABLE(NM)</span>
<span class="line-modified"> 860     BASIC_PATH_PROGS(GNM, gnm)</span>
<span class="line-modified"> 861     BASIC_FIXUP_EXECUTABLE(GNM)</span>
 862   elif test &quot;x$OPENJDK_TARGET_OS&quot; != xwindows; then
 863     # FIXME: we should unify this with the solaris case above.
<span class="line-modified"> 864     BASIC_CHECK_TOOLS(STRIP, strip)</span>
<span class="line-modified"> 865     BASIC_FIXUP_EXECUTABLE(STRIP)</span>
 866     if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
<span class="line-modified"> 867       BASIC_CHECK_TOOLS(NM, nm gcc-nm)</span>
 868     else
<span class="line-modified"> 869       BASIC_CHECK_TOOLS(NM, nm)</span>
 870     fi
<span class="line-modified"> 871     BASIC_FIXUP_EXECUTABLE(NM)</span>
 872     GNM=&quot;$NM&quot;
 873     AC_SUBST(GNM)
 874   fi
 875 
 876   # objcopy is used for moving debug symbols to separate files when
 877   # full debug symbols are enabled.
 878   if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
<span class="line-modified"> 879     BASIC_CHECK_TOOLS(OBJCOPY, [gobjcopy objcopy])</span>
 880     # Only call fixup if objcopy was found.
 881     if test -n &quot;$OBJCOPY&quot;; then
<span class="line-modified"> 882       BASIC_FIXUP_EXECUTABLE(OBJCOPY)</span>
 883       if test &quot;x$OPENJDK_BUILD_OS&quot; = xsolaris; then
 884         # objcopy prior to 2.21.1 on solaris is broken and is not usable.
 885         # Rewrite objcopy version output to VALID_VERSION or BAD_VERSION.
 886         # - version number is last blank separate word on first line
 887         # - version number formats that have been seen:
 888         #   - &lt;major&gt;.&lt;minor&gt;
 889         #   - &lt;major&gt;.&lt;minor&gt;.&lt;micro&gt;
 890         OBJCOPY_VERSION=`$OBJCOPY --version | $HEAD -n 1`
 891         # The outer [ ] is to prevent m4 from eating the [] in the sed expression.
 892         [ OBJCOPY_VERSION_CHECK=`$ECHO $OBJCOPY_VERSION | $SED -n \
 893               -e &#39;s/.* //&#39; \
 894               -e &#39;/^[01]\./b bad&#39; \
 895               -e &#39;/^2\./{&#39; \
 896               -e &#39;  s/^2\.//&#39; \
 897               -e &#39;  /^[0-9]$/b bad&#39; \
 898               -e &#39;  /^[0-9]\./b bad&#39; \
 899               -e &#39;  /^1[0-9]$/b bad&#39; \
 900               -e &#39;  /^1[0-9]\./b bad&#39; \
 901               -e &#39;  /^20\./b bad&#39; \
 902               -e &#39;  /^21\.0$/b bad&#39; \
 903               -e &#39;  /^21\.0\./b bad&#39; \
 904               -e &#39;}&#39; \
 905               -e &#39;:good&#39; \
 906               -e &#39;s/.*/VALID_VERSION/p&#39; \
 907               -e &#39;q&#39; \
 908               -e &#39;:bad&#39; \
 909               -e &#39;s/.*/BAD_VERSION/p&#39; \
 910               -e &#39;q&#39;` ]
 911         if test &quot;x$OBJCOPY_VERSION_CHECK&quot; = xBAD_VERSION; then
 912           OBJCOPY=
 913           AC_MSG_WARN([Ignoring found objcopy since it is broken (prior to 2.21.1). No debug symbols will be generated.])
 914           AC_MSG_NOTICE([objcopy reports version $OBJCOPY_VERSION])
 915           AC_MSG_NOTICE([Note: patch 149063-01 or newer contains the correct Solaris 10 SPARC version])
 916           AC_MSG_NOTICE([Note: patch 149064-01 or newer contains the correct Solaris 10 X86 version])
 917           AC_MSG_NOTICE([Note: Solaris 11 Update 1 contains the correct version])
 918         fi
 919       fi
 920     fi
 921   fi
 922 
<span class="line-modified"> 923   BASIC_CHECK_TOOLS(OBJDUMP, [gobjdump objdump])</span>
 924   if test &quot;x$OBJDUMP&quot; != x; then
<span class="line-modified"> 925     # Only used for compare.sh; we can live without it. BASIC_FIXUP_EXECUTABLE</span>
 926     # bails if argument is missing.
<span class="line-modified"> 927     BASIC_FIXUP_EXECUTABLE(OBJDUMP)</span>
 928   fi
 929 
 930   case $TOOLCHAIN_TYPE in
 931     gcc|clang|solstudio)
<span class="line-modified"> 932       BASIC_CHECK_TOOLS(CXXFILT, [c++filt])</span>
<span class="line-modified"> 933       BASIC_CHECK_NONEMPTY(CXXFILT)</span>
<span class="line-modified"> 934       BASIC_FIXUP_EXECUTABLE(CXXFILT)</span>
 935       ;;
 936   esac
 937 ])
 938 
 939 # Setup the build tools (i.e, the compiler and linker used to build programs
 940 # that should be run on the build platform, not the target platform, as a build
 941 # helper). Since the non-cross-compile case uses the normal, target compilers
 942 # for this, we can only do this after these have been setup.
 943 AC_DEFUN_ONCE([TOOLCHAIN_SETUP_BUILD_COMPILERS],
 944 [
 945   if test &quot;x$COMPILE_TYPE&quot; = &quot;xcross&quot;; then
 946     # Now we need to find a C/C++ compiler that can build executables for the
 947     # build platform. We can&#39;t use the AC_PROG_CC macro, since it can only be
 948     # used once. Also, we need to do this without adding a tools dir to the
 949     # path, otherwise we might pick up cross-compilers which don&#39;t use standard
 950     # naming.
 951 
 952     OLDPATH=&quot;$PATH&quot;
 953 
 954     AC_ARG_WITH(build-devkit, [AS_HELP_STRING([--with-build-devkit],
 955         [Devkit to use for the build platform toolchain])])
 956     if test &quot;x$with_build_devkit&quot; = &quot;xyes&quot;; then
 957       AC_MSG_ERROR([--with-build-devkit must have a value])
 958     elif test -n &quot;$with_build_devkit&quot;; then
 959       if test ! -d &quot;$with_build_devkit&quot;; then
 960         AC_MSG_ERROR([--with-build-devkit points to non existing dir: $with_build_devkit])
 961       else
<span class="line-modified"> 962         BASIC_FIXUP_PATH([with_build_devkit])</span>
 963         BUILD_DEVKIT_ROOT=&quot;$with_build_devkit&quot;
 964         # Check for a meta data info file in the root of the devkit
 965         if test -f &quot;$BUILD_DEVKIT_ROOT/devkit.info&quot;; then
 966           # Process devkit.info so that existing devkit variables are not
 967           # modified by this
 968           $SED -e &quot;s/^DEVKIT_/BUILD_DEVKIT_/g&quot; \
 969               -e &quot;s/\$DEVKIT_ROOT/\$BUILD_DEVKIT_ROOT/g&quot; \
 970               -e &quot;s/\$host/\$build/g&quot; \
 971               $BUILD_DEVKIT_ROOT/devkit.info \
 972               &gt; $CONFIGURESUPPORT_OUTPUTDIR/build-devkit.info
 973           . $CONFIGURESUPPORT_OUTPUTDIR/build-devkit.info
 974           # This potentially sets the following:
 975           # A descriptive name of the devkit
 976           BASIC_EVAL_DEVKIT_VARIABLE([BUILD_DEVKIT_NAME])
 977           # Corresponds to --with-extra-path
 978           BASIC_EVAL_DEVKIT_VARIABLE([BUILD_DEVKIT_EXTRA_PATH])
 979           # Corresponds to --with-toolchain-path
 980           BASIC_EVAL_DEVKIT_VARIABLE([BUILD_DEVKIT_TOOLCHAIN_PATH])
 981           # Corresponds to --with-sysroot
 982           BASIC_EVAL_DEVKIT_VARIABLE([BUILD_DEVKIT_SYSROOT])
</pre>
<hr />
<pre>
 986         AC_MSG_CHECKING([for build platform devkit])
 987         if test &quot;x$BUILD_DEVKIT_NAME&quot; != x; then
 988           AC_MSG_RESULT([$BUILD_DEVKIT_NAME in $BUILD_DEVKIT_ROOT])
 989         else
 990           AC_MSG_RESULT([$BUILD_DEVKIT_ROOT])
 991         fi
 992 
 993         BUILD_SYSROOT=&quot;$BUILD_DEVKIT_SYSROOT&quot;
 994 
 995          # Fallback default of just /bin if DEVKIT_PATH is not defined
 996         if test &quot;x$BUILD_DEVKIT_TOOLCHAIN_PATH&quot; = x; then
 997           BUILD_DEVKIT_TOOLCHAIN_PATH=&quot;$BUILD_DEVKIT_ROOT/bin&quot;
 998         fi
 999         PATH=&quot;$BUILD_DEVKIT_TOOLCHAIN_PATH:$BUILD_DEVKIT_EXTRA_PATH&quot;
1000       fi
1001     fi
1002 
1003     # FIXME: we should list the discovered compilers as an exclude pattern!
1004     # If we do that, we can do this detection before POST_DETECTION, and still
1005     # find the build compilers in the tools dir, if needed.
<span class="line-modified">1006     BASIC_REQUIRE_PROGS(BUILD_CC, [cl cc gcc])</span>
<span class="line-modified">1007     BASIC_FIXUP_EXECUTABLE(BUILD_CC)</span>
<span class="line-modified">1008     BASIC_REQUIRE_PROGS(BUILD_CXX, [cl CC g++])</span>
<span class="line-modified">1009     BASIC_FIXUP_EXECUTABLE(BUILD_CXX)</span>
<span class="line-modified">1010     BASIC_PATH_PROGS(BUILD_NM, nm gcc-nm)</span>
<span class="line-modified">1011     BASIC_FIXUP_EXECUTABLE(BUILD_NM)</span>
<span class="line-modified">1012     BASIC_PATH_PROGS(BUILD_AR, ar gcc-ar)</span>
<span class="line-modified">1013     BASIC_FIXUP_EXECUTABLE(BUILD_AR)</span>
<span class="line-modified">1014     BASIC_PATH_PROGS(BUILD_OBJCOPY, objcopy)</span>
<span class="line-modified">1015     BASIC_FIXUP_EXECUTABLE(BUILD_OBJCOPY)</span>
<span class="line-modified">1016     BASIC_PATH_PROGS(BUILD_STRIP, strip)</span>
<span class="line-modified">1017     BASIC_FIXUP_EXECUTABLE(BUILD_STRIP)</span>
1018     # Assume the C compiler is the assembler
1019     BUILD_AS=&quot;$BUILD_CC -c&quot;
1020     # Just like for the target compiler, use the compiler as linker
1021     BUILD_LD=&quot;$BUILD_CC&quot;
1022     BUILD_LDCXX=&quot;$BUILD_CXX&quot;
1023 
1024     PATH=&quot;$OLDPATH&quot;
1025 
1026     TOOLCHAIN_EXTRACT_COMPILER_VERSION(BUILD_CC, [BuildC])
1027     TOOLCHAIN_EXTRACT_COMPILER_VERSION(BUILD_CXX, [BuildC++])
1028     TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS([BUILD_], [OPENJDK_BUILD_], [build ])
1029     TOOLCHAIN_EXTRACT_LD_VERSION(BUILD_LD, [build linker])
1030     TOOLCHAIN_PREPARE_FOR_LD_VERSION_COMPARISONS([BUILD_], [OPENJDK_BUILD_])
1031   else
1032     # If we are not cross compiling, use the normal target compilers for
1033     # building the build platform executables.
1034     BUILD_CC=&quot;$CC&quot;
1035     BUILD_CXX=&quot;$CXX&quot;
1036     BUILD_LD=&quot;$LD&quot;
1037     BUILD_LDCXX=&quot;$LDCXX&quot;
</pre>
<hr />
<pre>
1091     HOTSPOT_TOOLCHAIN_TYPE=gcc
1092   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
1093     HOTSPOT_TOOLCHAIN_TYPE=visCPP
1094   fi
1095   AC_SUBST(HOTSPOT_TOOLCHAIN_TYPE)
1096 ])
1097 
1098 # Setup the JTReg Regression Test Harness.
1099 AC_DEFUN_ONCE([TOOLCHAIN_SETUP_JTREG],
1100 [
1101   AC_ARG_WITH(jtreg, [AS_HELP_STRING([--with-jtreg],
1102       [Regression Test Harness @&lt;:@probed@:&gt;@])])
1103 
1104   if test &quot;x$with_jtreg&quot; = xno; then
1105     # jtreg disabled
1106     AC_MSG_CHECKING([for jtreg test harness])
1107     AC_MSG_RESULT([no, disabled])
1108   elif test &quot;x$with_jtreg&quot; != xyes &amp;&amp; test &quot;x$with_jtreg&quot; != x; then
1109     # An explicit path is specified, use it.
1110     JT_HOME=&quot;$with_jtreg&quot;
<span class="line-modified">1111     BASIC_FIXUP_PATH([JT_HOME])</span>
1112     if test ! -d &quot;$JT_HOME&quot;; then
1113       AC_MSG_ERROR([jtreg home directory from --with-jtreg=$with_jtreg does not exist])
1114     fi
1115 
1116     if test ! -e &quot;$JT_HOME/lib/jtreg.jar&quot;; then
1117       AC_MSG_ERROR([jtreg home directory from --with-jtreg=$with_jtreg is not a valid jtreg home])
1118     fi
1119 
1120     JTREGEXE=&quot;$JT_HOME/bin/jtreg&quot;
1121     if test ! -x &quot;$JTREGEXE&quot;; then
1122       AC_MSG_ERROR([jtreg home directory from --with-jtreg=$with_jtreg does not contain valid jtreg executable])
1123     fi
1124 
1125     AC_MSG_CHECKING([for jtreg test harness])
1126     AC_MSG_RESULT([$JT_HOME])
1127   else
1128     # Try to locate jtreg
1129     if test &quot;x$JT_HOME&quot; != x; then
1130       # JT_HOME set in environment, use it
1131       if test ! -d &quot;$JT_HOME&quot;; then
1132         AC_MSG_WARN([Ignoring JT_HOME pointing to invalid directory: $JT_HOME])
1133         JT_HOME=
1134       else
1135         if test ! -e &quot;$JT_HOME/lib/jtreg.jar&quot;; then
1136           AC_MSG_WARN([Ignoring JT_HOME which is not a valid jtreg home: $JT_HOME])
1137           JT_HOME=
1138         elif test ! -x &quot;$JT_HOME/bin/jtreg&quot;; then
1139           AC_MSG_WARN([Ignoring JT_HOME which does not contain valid jtreg executable: $JT_HOME])
1140           JT_HOME=
1141         else
1142           JTREGEXE=&quot;$JT_HOME/bin/jtreg&quot;
1143           AC_MSG_NOTICE([Located jtreg using JT_HOME from environment])
1144         fi
1145       fi
1146     fi
1147 
1148     if test &quot;x$JT_HOME&quot; = x; then
1149       # JT_HOME is not set in environment, or was deemed invalid.
1150       # Try to find jtreg on path
<span class="line-modified">1151       BASIC_PATH_PROGS(JTREGEXE, jtreg)</span>
1152       if test &quot;x$JTREGEXE&quot; != x; then
1153         # That&#39;s good, now try to derive JT_HOME
1154         JT_HOME=`(cd $($DIRNAME $JTREGEXE)/.. &amp;&amp; pwd)`
1155         if test ! -e &quot;$JT_HOME/lib/jtreg.jar&quot;; then
1156           AC_MSG_WARN([Ignoring jtreg from path since a valid jtreg home cannot be found])
1157           JT_HOME=
1158           JTREGEXE=
1159         else
1160           AC_MSG_NOTICE([Located jtreg using jtreg executable in path])
1161         fi
1162       fi
1163     fi
1164 
1165     AC_MSG_CHECKING([for jtreg test harness])
1166     if test &quot;x$JT_HOME&quot; != x; then
1167       AC_MSG_RESULT([$JT_HOME])
1168     else
1169       AC_MSG_RESULT([no, not found])
1170 
1171       if test &quot;x$with_jtreg&quot; = xyes; then
1172         AC_MSG_ERROR([--with-jtreg was specified, but no jtreg found.])
1173       fi
1174     fi
1175   fi
1176 
<span class="line-modified">1177   BASIC_FIXUP_EXECUTABLE(JTREGEXE)</span>
<span class="line-modified">1178   BASIC_FIXUP_PATH(JT_HOME)</span>
1179   AC_SUBST(JT_HOME)
1180   AC_SUBST(JTREGEXE)
1181 ])
1182 
1183 # Setup the JIB dependency resolver
1184 AC_DEFUN_ONCE([TOOLCHAIN_SETUP_JIB],
1185 [
1186   AC_ARG_WITH(jib, [AS_HELP_STRING([--with-jib],
1187       [Jib dependency management tool @&lt;:@not used@:&gt;@])])
1188 
1189   if test &quot;x$with_jib&quot; = xno || test &quot;x$with_jib&quot; = x; then
1190     # jib disabled
1191     AC_MSG_CHECKING([for jib])
1192     AC_MSG_RESULT(no)
1193   elif test &quot;x$with_jib&quot; = xyes; then
1194     AC_MSG_ERROR([Must supply a value to --with-jib])
1195   else
1196     JIB_HOME=&quot;${with_jib}&quot;
1197     AC_MSG_CHECKING([for jib])
1198     AC_MSG_RESULT(${JIB_HOME})
</pre>
</td>
<td>
<hr />
<pre>
  15 # accompanied this code).
  16 #
  17 # You should have received a copy of the GNU General Public License version
  18 # 2 along with this work; if not, write to the Free Software Foundation,
  19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20 #
  21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22 # or visit www.oracle.com if you need additional information or have any
  23 # questions.
  24 #
  25 
  26 ########################################################################
  27 # This file is responsible for detecting, verifying and setting up the
  28 # toolchain, i.e. the compiler, linker and related utilities. It will setup
  29 # proper paths to the binaries, but it will not setup any flags.
  30 #
  31 # The binaries used is determined by the toolchain type, which is the family of
  32 # compilers and related tools that are used.
  33 ########################################################################
  34 
<span class="line-added">  35 m4_include([toolchain_windows.m4])</span>
  36 
  37 # All valid toolchains, regardless of platform (used by help.m4)
  38 VALID_TOOLCHAINS_all=&quot;gcc clang solstudio xlc microsoft&quot;
  39 
  40 # These toolchains are valid on different platforms
  41 VALID_TOOLCHAINS_linux=&quot;gcc clang&quot;
  42 VALID_TOOLCHAINS_solaris=&quot;solstudio&quot;
  43 VALID_TOOLCHAINS_macosx=&quot;gcc clang&quot;
  44 VALID_TOOLCHAINS_aix=&quot;xlc&quot;
  45 VALID_TOOLCHAINS_windows=&quot;microsoft&quot;
  46 
  47 # Toolchain descriptions
  48 TOOLCHAIN_DESCRIPTION_clang=&quot;clang/LLVM&quot;
  49 TOOLCHAIN_DESCRIPTION_gcc=&quot;GNU Compiler Collection&quot;
  50 TOOLCHAIN_DESCRIPTION_microsoft=&quot;Microsoft Visual Studio&quot;
  51 TOOLCHAIN_DESCRIPTION_solstudio=&quot;Oracle Solaris Studio&quot;
  52 TOOLCHAIN_DESCRIPTION_xlc=&quot;IBM XL C/C++&quot;
  53 
  54 # Minimum supported versions, empty means unspecified
  55 TOOLCHAIN_MINIMUM_VERSION_clang=&quot;3.2&quot;
</pre>
<hr />
<pre>
  76   # We only check CC_VERSION_NUMBER since we assume CXX_VERSION_NUMBER is equal.
  77   if [ [[ &quot;[$]$1CC_VERSION_NUMBER&quot; =~ (.*\.){4} ]] ]; then
  78     AC_MSG_WARN([C compiler version number has more than four parts (W.X.Y.Z): [$]$1CC_VERSION_NUMBER. Comparisons might be wrong.])
  79   fi
  80 
  81   if [ [[  &quot;[$]$1CC_VERSION_NUMBER&quot; =~ [0-9]{6} ]] ]; then
  82     AC_MSG_WARN([C compiler version number has a part larger than 99999: [$]$1CC_VERSION_NUMBER. Comparisons might be wrong.])
  83   fi
  84 
  85   $2COMPARABLE_ACTUAL_VERSION=`$AWK -F. &#39;{ printf(&quot;%05d%05d%05d%05d\n&quot;, [$]1, [$]2, [$]3, [$]4) }&#39; &lt;&lt;&lt; &quot;[$]$1CC_VERSION_NUMBER&quot;`
  86 ])
  87 
  88 # Check if the configured compiler (C and C++) is of a specific version or
  89 # newer. TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS must have been called before.
  90 #
  91 # Arguments:
  92 #   VERSION:   The version string to check against the found version
  93 #   IF_AT_LEAST:   block to run if the compiler is at least this version (&gt;=)
  94 #   IF_OLDER_THAN:   block to run if the compiler is older than this version (&lt;)
  95 #   PREFIX:   Optional variable prefix for compiler to compare version for (OPENJDK_BUILD_)
<span class="line-modified">  96 UTIL_DEFUN_NAMED([TOOLCHAIN_CHECK_COMPILER_VERSION],</span>
  97     [*VERSION PREFIX IF_AT_LEAST IF_OLDER_THAN], [$@],
  98 [
  99   # Need to assign to a variable since m4 is blocked from modifying parts in [].
 100   REFERENCE_VERSION=ARG_VERSION
 101 
 102   if [ [[ &quot;$REFERENCE_VERSION&quot; =~ (.*\.){4} ]] ]; then
 103     AC_MSG_ERROR([Internal error: Cannot compare to ARG_VERSION, only four parts (W.X.Y.Z) is supported])
 104   fi
 105 
 106   if [ [[ &quot;$REFERENCE_VERSION&quot; =~ [0-9]{6} ]] ]; then
 107     AC_MSG_ERROR([Internal error: Cannot compare to ARG_VERSION, only parts &lt; 99999 is supported])
 108   fi
 109 
 110   # Version comparison method inspired by http://stackoverflow.com/a/24067243
 111   COMPARABLE_REFERENCE_VERSION=`$AWK -F. &#39;{ printf(&quot;%05d%05d%05d%05d\n&quot;, [$]1, [$]2, [$]3, [$]4) }&#39; &lt;&lt;&lt; &quot;$REFERENCE_VERSION&quot;`
 112 
 113   if test [$]ARG_PREFIX[COMPARABLE_ACTUAL_VERSION] -ge $COMPARABLE_REFERENCE_VERSION ; then
 114     :
 115     ARG_IF_AT_LEAST
 116   else
</pre>
<hr />
<pre>
 127 [
 128   if [ [[ &quot;[$]$1LD_VERSION_NUMBER&quot; =~ (.*\.){4} ]] ]; then
 129     AC_MSG_WARN([Linker version number has more than four parts (W.X.Y.Z): [$]$1LD_VERSION_NUMBER. Comparisons might be wrong.])
 130   fi
 131 
 132   if [ [[  &quot;[$]$1LD_VERSION_NUMBER&quot; =~ [0-9]{6} ]] ]; then
 133     AC_MSG_WARN([Linker version number has a part larger than 99999: [$]$1LD_VERSION_NUMBER. Comparisons might be wrong.])
 134   fi
 135 
 136   $2COMPARABLE_ACTUAL_LD_VERSION=`$AWK -F. &#39;{ printf(&quot;%05d%05d%05d%05d\n&quot;, [$]1, [$]2, [$]3, [$]4) }&#39; &lt;&lt;&lt; &quot;[$]$1LD_VERSION_NUMBER&quot;`
 137 ])
 138 
 139 # Check if the configured linker is of a specific version or
 140 # newer. TOOLCHAIN_PREPARE_FOR_LD_VERSION_COMPARISONS must have been called before.
 141 #
 142 # Arguments:
 143 #   VERSION:   The version string to check against the found version
 144 #   IF_AT_LEAST:   block to run if the compiler is at least this version (&gt;=)
 145 #   IF_OLDER_THAN:   block to run if the compiler is older than this version (&lt;)
 146 #   PREFIX:   Optional variable prefix for compiler to compare version for (OPENJDK_BUILD_)
<span class="line-modified"> 147 UTIL_DEFUN_NAMED([TOOLCHAIN_CHECK_LINKER_VERSION],</span>
 148     [*VERSION PREFIX IF_AT_LEAST IF_OLDER_THAN], [$@],
 149 [
 150   # Need to assign to a variable since m4 is blocked from modifying parts in [].
 151   REFERENCE_VERSION=ARG_VERSION
 152 
 153   if [ [[ &quot;$REFERENCE_VERSION&quot; =~ (.*\.){4} ]] ]; then
 154     AC_MSG_ERROR([Internal error: Cannot compare to ARG_VERSION, only four parts (W.X.Y.Z) is supported])
 155   fi
 156 
 157   if [ [[ &quot;$REFERENCE_VERSION&quot; =~ [0-9]{6} ]] ]; then
 158     AC_MSG_ERROR([Internal error: Cannot compare to ARG_VERSION, only parts &lt; 99999 is supported])
 159   fi
 160 
 161   # Version comparison method inspired by http://stackoverflow.com/a/24067243
 162   COMPARABLE_REFERENCE_VERSION=`$AWK -F. &#39;{ printf(&quot;%05d%05d%05d%05d\n&quot;, [$]1, [$]2, [$]3, [$]4) }&#39; &lt;&lt;&lt; &quot;$REFERENCE_VERSION&quot;`
 163 
 164   if test [$]ARG_PREFIX[COMPARABLE_ACTUAL_LD_VERSION] -ge $COMPARABLE_REFERENCE_VERSION ; then
 165     :
 166     ARG_IF_AT_LEAST
 167   else
</pre>
<hr />
<pre>
 333   # FIXME: Is this needed?
 334   AC_LANG(C++)
 335 
 336   # Store the CFLAGS etc passed to the configure script.
 337   ORG_CFLAGS=&quot;$CFLAGS&quot;
 338   ORG_CXXFLAGS=&quot;$CXXFLAGS&quot;
 339 
 340   # autoconf magic only relies on PATH, so update it if tools dir is specified
 341   OLD_PATH=&quot;$PATH&quot;
 342 
 343   # On Windows, we need to detect the visual studio installation first.
 344   # This will change the PATH, but we need to keep that new PATH even
 345   # after toolchain detection is done, since the compiler (on x86) uses
 346   # it for DLL resolution in runtime.
 347   if test &quot;x$OPENJDK_BUILD_OS&quot; = &quot;xwindows&quot; \
 348       &amp;&amp; test &quot;x$TOOLCHAIN_TYPE&quot; = &quot;xmicrosoft&quot;; then
 349     TOOLCHAIN_SETUP_VISUAL_STUDIO_ENV
 350     if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
 351       # Append VS_PATH. In WSL, VS_PATH will not contain the WSL env path needed
 352       # for using basic Unix tools, so need to keep the original PATH.
<span class="line-modified"> 353       UTIL_APPEND_TO_PATH(PATH, $VS_PATH)</span>
<span class="line-modified"> 354       UTIL_APPEND_TO_PATH(WSLENV, &quot;PATH/l:LIB:INCLUDE&quot;)</span>
 355       export WSLENV
 356     else
 357       # Reset path to VS_PATH. It will include everything that was on PATH at the time we
 358       # ran TOOLCHAIN_SETUP_VISUAL_STUDIO_ENV.
 359       PATH=&quot;$VS_PATH&quot;
 360     fi
 361     # The microsoft toolchain also requires INCLUDE and LIB to be set.
 362     export INCLUDE=&quot;$VS_INCLUDE&quot;
 363     export LIB=&quot;$VS_LIB&quot;
 364   else
 365     if test &quot;x$XCODE_VERSION_OUTPUT&quot; != x; then
 366       # For Xcode, we set the Xcode version as TOOLCHAIN_VERSION
 367       TOOLCHAIN_VERSION=`$ECHO $XCODE_VERSION_OUTPUT | $CUT -f 2 -d &#39; &#39;`
 368       TOOLCHAIN_DESCRIPTION=&quot;$TOOLCHAIN_DESCRIPTION from Xcode $TOOLCHAIN_VERSION&quot;
 369     else
 370       # Currently we do not define this for other toolchains. This might change as the need arise.
 371       TOOLCHAIN_VERSION=
 372     fi
 373   fi
 374   AC_SUBST(TOOLCHAIN_VERSION)
</pre>
<hr />
<pre>
 564       PATH=&quot;$TOOLCHAIN_PATH&quot;
 565       AC_PATH_TOOL(TOOLCHAIN_PATH_$1, $SEARCH_LIST)
 566       $1=$TOOLCHAIN_PATH_$1
 567       PATH=&quot;$PATH_save&quot;
 568     fi
 569 
 570     # AC_PATH_TOOL can&#39;t be run multiple times with the same variable,
 571     # so create a new name for this run.
 572     if test &quot;x[$]$1&quot; = x; then
 573       AC_PATH_TOOL(POTENTIAL_$1, $SEARCH_LIST)
 574       $1=$POTENTIAL_$1
 575     fi
 576 
 577     if test &quot;x[$]$1&quot; = x; then
 578       HELP_MSG_MISSING_DEPENDENCY([devkit])
 579       AC_MSG_ERROR([Could not find a $COMPILER_NAME compiler. $HELP_MSG])
 580     fi
 581   fi
 582 
 583   # Now we have a compiler binary in $1. Make sure it&#39;s okay.
<span class="line-modified"> 584   UTIL_FIXUP_EXECUTABLE($1)</span>
 585   TEST_COMPILER=&quot;[$]$1&quot;
 586 
 587   AC_MSG_CHECKING([resolved symbolic links for $1])
 588   SYMLINK_ORIGINAL=&quot;$TEST_COMPILER&quot;
<span class="line-modified"> 589   UTIL_REMOVE_SYMBOLIC_LINKS(SYMLINK_ORIGINAL)</span>
 590   if test &quot;x$TEST_COMPILER&quot; = &quot;x$SYMLINK_ORIGINAL&quot;; then
 591     AC_MSG_RESULT([no symlink])
 592   else
 593     AC_MSG_RESULT([$SYMLINK_ORIGINAL])
 594 
 595     # We can&#39;t handle ccache by gcc wrappers, since we need to know if we&#39;re
 596     # using ccache. Instead ccache usage must be controlled by a configure option.
 597     COMPILER_BASENAME=`$BASENAME &quot;$SYMLINK_ORIGINAL&quot;`
 598     if test &quot;x$COMPILER_BASENAME&quot; = &quot;xccache&quot;; then
 599       AC_MSG_NOTICE([Please use --enable-ccache instead of providing a wrapped compiler.])
 600       AC_MSG_ERROR([$TEST_COMPILER is a symbolic link to ccache. This is not supported.])
 601     fi
 602   fi
 603 
 604   TOOLCHAIN_EXTRACT_COMPILER_VERSION([$1], [$COMPILER_NAME])
 605 ])
 606 
 607 # Retrieve the linker version number and store it in LD_VERSION_NUMBER
 608 # (as a dotted number), and
 609 # the full version string in LD_VERSION_STRING.
</pre>
<hr />
<pre>
 700   AC_PROG_CXX([$CXX])
 701 
 702   # This is the compiler version number on the form X.Y[.Z]
 703   AC_SUBST(CC_VERSION_NUMBER)
 704   AC_SUBST(CXX_VERSION_NUMBER)
 705 
 706   TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS
 707 
 708   if test &quot;x$TOOLCHAIN_MINIMUM_VERSION&quot; != x; then
 709     TOOLCHAIN_CHECK_COMPILER_VERSION(VERSION: $TOOLCHAIN_MINIMUM_VERSION,
 710         IF_OLDER_THAN: [
 711           AC_MSG_WARN([You are using $TOOLCHAIN_TYPE older than $TOOLCHAIN_MINIMUM_VERSION. This is not a supported configuration.])
 712         ]
 713     )
 714   fi
 715 
 716   #
 717   # Setup the preprocessor (CPP and CXXCPP)
 718   #
 719   AC_PROG_CPP
<span class="line-modified"> 720   UTIL_FIXUP_EXECUTABLE(CPP)</span>
 721   AC_PROG_CXXCPP
<span class="line-modified"> 722   UTIL_FIXUP_EXECUTABLE(CXXCPP)</span>
 723 
 724   #
 725   # Setup the linker (LD)
 726   #
 727   if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 728     # In the Microsoft toolchain we have a separate LD command &quot;link&quot;.
 729     # Make sure we reject /usr/bin/link (as determined in CYGWIN_LINK), which is
 730     # a cygwin program for something completely different.
 731     AC_CHECK_PROG([LD], [link$EXE_SUFFIX],[link$EXE_SUFFIX],,, [$CYGWIN_LINK])
<span class="line-modified"> 732     UTIL_FIXUP_EXECUTABLE(LD)</span>
 733     # Verify that we indeed succeeded with this trick.
 734     AC_MSG_CHECKING([if the found link.exe is actually the Visual Studio linker])
 735     &quot;$LD&quot; --version &gt; /dev/null
 736     if test $? -eq 0 ; then
 737       AC_MSG_RESULT([no])
 738       AC_MSG_ERROR([This is the Cygwin link tool. Please check your PATH and rerun configure.])
 739     else
 740       AC_MSG_RESULT([yes])
 741     fi
 742     LDCXX=&quot;$LD&quot;
 743     # jaotc being a windows program expects the linker to be supplied with exe suffix.
 744     LD_JAOTC=&quot;$LD$EXE_SUFFIX&quot;
 745   else
 746     # All other toolchains use the compiler to link.
 747     LD=&quot;$CC&quot;
 748     LDCXX=&quot;$CXX&quot;
 749     # jaotc expects &#39;ld&#39; as the linker rather than the compiler.
<span class="line-modified"> 750     UTIL_CHECK_TOOLS([LD_JAOTC], ld)</span>
<span class="line-modified"> 751     UTIL_FIXUP_EXECUTABLE(LD_JAOTC)</span>
 752   fi
 753   AC_SUBST(LD)
 754   AC_SUBST(LD_JAOTC)
 755   # FIXME: it should be CXXLD, according to standard (cf CXXCPP)
 756   AC_SUBST(LDCXX)
 757 
 758   TOOLCHAIN_EXTRACT_LD_VERSION([LD], [linker])
 759   TOOLCHAIN_PREPARE_FOR_LD_VERSION_COMPARISONS
 760 
 761   if test &quot;x$TOOLCHAIN_MINIMUM_LD_VERSION&quot; != x; then
 762     TOOLCHAIN_CHECK_LINKER_VERSION(VERSION: $TOOLCHAIN_MINIMUM_LD_VERSION,
 763         IF_OLDER_THAN: [
 764           AC_MSG_WARN([You are using a linker older than $TOOLCHAIN_MINIMUM_LD_VERSION. This is not a supported configuration.])
 765         ]
 766     )
 767   fi
 768 
 769   #
 770   # Setup the assembler (AS)
 771   #
 772   if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris; then
<span class="line-modified"> 773     UTIL_PATH_PROGS(AS, as)</span>
<span class="line-modified"> 774     UTIL_FIXUP_EXECUTABLE(AS)</span>
 775     if test &quot;x$AS&quot; = x; then
 776       AC_MSG_ERROR([Solaris assembler (as) is required. Please install via &quot;pkg install pkg:/developer/assembler&quot;.])
 777     fi
 778   else
 779     # FIXME: is this correct for microsoft?
 780     AS=&quot;$CC -c&quot;
 781   fi
 782   AC_SUBST(AS)
 783 
 784   #
 785   # Setup the archiver (AR)
 786   #
 787   if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 788     # The corresponding ar tool is lib.exe (used to create static libraries)
 789     AC_CHECK_PROG([AR], [lib$EXE_SUFFIX],[lib$EXE_SUFFIX],,,)
 790   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
<span class="line-modified"> 791     UTIL_CHECK_TOOLS(AR, ar gcc-ar)</span>
 792   else
<span class="line-modified"> 793     UTIL_CHECK_TOOLS(AR, ar)</span>
 794   fi
<span class="line-modified"> 795   UTIL_FIXUP_EXECUTABLE(AR)</span>
 796 ])
 797 
 798 # Setup additional tools that is considered a part of the toolchain, but not the
 799 # core part. Many of these are highly platform-specific and do not exist,
 800 # and/or are not needed on all platforms.
 801 AC_DEFUN_ONCE([TOOLCHAIN_DETECT_TOOLCHAIN_EXTRA],
 802 [
 803   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xmacosx&quot;; then
<span class="line-modified"> 804     UTIL_PATH_PROGS(LIPO, lipo)</span>
<span class="line-modified"> 805     UTIL_FIXUP_EXECUTABLE(LIPO)</span>
<span class="line-modified"> 806     UTIL_REQUIRE_PROGS(OTOOL, otool)</span>
<span class="line-modified"> 807     UTIL_FIXUP_EXECUTABLE(OTOOL)</span>
<span class="line-modified"> 808     UTIL_REQUIRE_PROGS(INSTALL_NAME_TOOL, install_name_tool)</span>
<span class="line-modified"> 809     UTIL_FIXUP_EXECUTABLE(INSTALL_NAME_TOOL)</span>
<span class="line-modified"> 810 </span>
<span class="line-modified"> 811     UTIL_PATH_PROGS(METAL, metal)</span>
 812     if test &quot;x$METAL&quot; = x; then
 813       AC_MSG_CHECKING([if metal can be run using xcrun])
 814       METAL=&quot;xcrun -sdk macosx metal&quot;
 815       test_metal=`$METAL --version 2&gt;&amp;1`
 816       if test $? -ne 0; then
 817         AC_MSG_RESULT([no])
 818         AC_MSG_ERROR([XCode tool &#39;metal&#39; neither found in path nor with xcrun])
 819       else
 820         AC_MSG_RESULT([yes, will be using &#39;$METAL&#39;])
 821       fi
 822     fi
 823 
<span class="line-modified"> 824     UTIL_PATH_PROGS(METALLIB, metallib)</span>
 825     if test &quot;x$METALLIB&quot; = x; then
 826       AC_MSG_CHECKING([if metallib can be run using xcrun])
 827       METALLIB=&quot;xcrun -sdk macosx metallib&quot;
 828       test_metallib=`$METALLIB --version 2&gt;&amp;1`
 829       if test $? -ne 0; then
 830         AC_MSG_RESULT([no])
 831         AC_MSG_ERROR([XCode tool &#39;metallib&#39; neither found in path nor with xcrun])
 832       else
 833         AC_MSG_RESULT([yes, will be using &#39;$METALLIB&#39;])
 834       fi
 835     fi
 836   fi
 837 
 838   if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 839     AC_CHECK_PROG([MT], [mt$EXE_SUFFIX], [mt$EXE_SUFFIX],,, [/usr/bin/mt])
<span class="line-modified"> 840     UTIL_FIXUP_EXECUTABLE(MT)</span>
 841     # Setup the resource compiler (RC)
 842     AC_CHECK_PROG([RC], [rc$EXE_SUFFIX], [rc$EXE_SUFFIX],,, [/usr/bin/rc])
<span class="line-modified"> 843     UTIL_FIXUP_EXECUTABLE(RC)</span>
 844     AC_CHECK_PROG([DUMPBIN], [dumpbin$EXE_SUFFIX], [dumpbin$EXE_SUFFIX],,,)
<span class="line-modified"> 845     UTIL_FIXUP_EXECUTABLE(DUMPBIN)</span>
 846     # We need to check for &#39;msbuild.exe&#39; because at the place where we expect to
 847     # find &#39;msbuild.exe&#39; there&#39;s also a directory called &#39;msbuild&#39; and configure
 848     # won&#39;t find the &#39;msbuild.exe&#39; executable in that case (and the
 849     # &#39;ac_executable_extensions&#39; is unusable due to performance reasons).
 850     # Notice that we intentionally don&#39;t fix up the path to MSBUILD because we
 851     # will call it in a DOS shell during freetype detection on Windows (see
 852     # &#39;LIB_SETUP_FREETYPE&#39; in &quot;libraries.m4&quot;
 853     AC_CHECK_PROG([MSBUILD], [msbuild$EXE_SUFFIX], [msbuild$EXE_SUFFIX],,,)
 854   fi
 855 
 856   if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris; then
<span class="line-modified"> 857     UTIL_PATH_PROGS(STRIP, strip)</span>
<span class="line-modified"> 858     UTIL_FIXUP_EXECUTABLE(STRIP)</span>
<span class="line-modified"> 859     UTIL_PATH_PROGS(NM, nm)</span>
<span class="line-modified"> 860     UTIL_FIXUP_EXECUTABLE(NM)</span>
<span class="line-modified"> 861     UTIL_PATH_PROGS(GNM, gnm)</span>
<span class="line-modified"> 862     UTIL_FIXUP_EXECUTABLE(GNM)</span>
 863   elif test &quot;x$OPENJDK_TARGET_OS&quot; != xwindows; then
 864     # FIXME: we should unify this with the solaris case above.
<span class="line-modified"> 865     UTIL_CHECK_TOOLS(STRIP, strip)</span>
<span class="line-modified"> 866     UTIL_FIXUP_EXECUTABLE(STRIP)</span>
 867     if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
<span class="line-modified"> 868       UTIL_CHECK_TOOLS(NM, nm gcc-nm)</span>
 869     else
<span class="line-modified"> 870       UTIL_CHECK_TOOLS(NM, nm)</span>
 871     fi
<span class="line-modified"> 872     UTIL_FIXUP_EXECUTABLE(NM)</span>
 873     GNM=&quot;$NM&quot;
 874     AC_SUBST(GNM)
 875   fi
 876 
 877   # objcopy is used for moving debug symbols to separate files when
 878   # full debug symbols are enabled.
 879   if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
<span class="line-modified"> 880     UTIL_CHECK_TOOLS(OBJCOPY, [gobjcopy objcopy])</span>
 881     # Only call fixup if objcopy was found.
 882     if test -n &quot;$OBJCOPY&quot;; then
<span class="line-modified"> 883       UTIL_FIXUP_EXECUTABLE(OBJCOPY)</span>
 884       if test &quot;x$OPENJDK_BUILD_OS&quot; = xsolaris; then
 885         # objcopy prior to 2.21.1 on solaris is broken and is not usable.
 886         # Rewrite objcopy version output to VALID_VERSION or BAD_VERSION.
 887         # - version number is last blank separate word on first line
 888         # - version number formats that have been seen:
 889         #   - &lt;major&gt;.&lt;minor&gt;
 890         #   - &lt;major&gt;.&lt;minor&gt;.&lt;micro&gt;
 891         OBJCOPY_VERSION=`$OBJCOPY --version | $HEAD -n 1`
 892         # The outer [ ] is to prevent m4 from eating the [] in the sed expression.
 893         [ OBJCOPY_VERSION_CHECK=`$ECHO $OBJCOPY_VERSION | $SED -n \
 894               -e &#39;s/.* //&#39; \
 895               -e &#39;/^[01]\./b bad&#39; \
 896               -e &#39;/^2\./{&#39; \
 897               -e &#39;  s/^2\.//&#39; \
 898               -e &#39;  /^[0-9]$/b bad&#39; \
 899               -e &#39;  /^[0-9]\./b bad&#39; \
 900               -e &#39;  /^1[0-9]$/b bad&#39; \
 901               -e &#39;  /^1[0-9]\./b bad&#39; \
 902               -e &#39;  /^20\./b bad&#39; \
 903               -e &#39;  /^21\.0$/b bad&#39; \
 904               -e &#39;  /^21\.0\./b bad&#39; \
 905               -e &#39;}&#39; \
 906               -e &#39;:good&#39; \
 907               -e &#39;s/.*/VALID_VERSION/p&#39; \
 908               -e &#39;q&#39; \
 909               -e &#39;:bad&#39; \
 910               -e &#39;s/.*/BAD_VERSION/p&#39; \
 911               -e &#39;q&#39;` ]
 912         if test &quot;x$OBJCOPY_VERSION_CHECK&quot; = xBAD_VERSION; then
 913           OBJCOPY=
 914           AC_MSG_WARN([Ignoring found objcopy since it is broken (prior to 2.21.1). No debug symbols will be generated.])
 915           AC_MSG_NOTICE([objcopy reports version $OBJCOPY_VERSION])
 916           AC_MSG_NOTICE([Note: patch 149063-01 or newer contains the correct Solaris 10 SPARC version])
 917           AC_MSG_NOTICE([Note: patch 149064-01 or newer contains the correct Solaris 10 X86 version])
 918           AC_MSG_NOTICE([Note: Solaris 11 Update 1 contains the correct version])
 919         fi
 920       fi
 921     fi
 922   fi
 923 
<span class="line-modified"> 924   UTIL_CHECK_TOOLS(OBJDUMP, [gobjdump objdump])</span>
 925   if test &quot;x$OBJDUMP&quot; != x; then
<span class="line-modified"> 926     # Only used for compare.sh; we can live without it. UTIL_FIXUP_EXECUTABLE</span>
 927     # bails if argument is missing.
<span class="line-modified"> 928     UTIL_FIXUP_EXECUTABLE(OBJDUMP)</span>
 929   fi
 930 
 931   case $TOOLCHAIN_TYPE in
 932     gcc|clang|solstudio)
<span class="line-modified"> 933       UTIL_CHECK_TOOLS(CXXFILT, [c++filt])</span>
<span class="line-modified"> 934       UTIL_CHECK_NONEMPTY(CXXFILT)</span>
<span class="line-modified"> 935       UTIL_FIXUP_EXECUTABLE(CXXFILT)</span>
 936       ;;
 937   esac
 938 ])
 939 
 940 # Setup the build tools (i.e, the compiler and linker used to build programs
 941 # that should be run on the build platform, not the target platform, as a build
 942 # helper). Since the non-cross-compile case uses the normal, target compilers
 943 # for this, we can only do this after these have been setup.
 944 AC_DEFUN_ONCE([TOOLCHAIN_SETUP_BUILD_COMPILERS],
 945 [
 946   if test &quot;x$COMPILE_TYPE&quot; = &quot;xcross&quot;; then
 947     # Now we need to find a C/C++ compiler that can build executables for the
 948     # build platform. We can&#39;t use the AC_PROG_CC macro, since it can only be
 949     # used once. Also, we need to do this without adding a tools dir to the
 950     # path, otherwise we might pick up cross-compilers which don&#39;t use standard
 951     # naming.
 952 
 953     OLDPATH=&quot;$PATH&quot;
 954 
 955     AC_ARG_WITH(build-devkit, [AS_HELP_STRING([--with-build-devkit],
 956         [Devkit to use for the build platform toolchain])])
 957     if test &quot;x$with_build_devkit&quot; = &quot;xyes&quot;; then
 958       AC_MSG_ERROR([--with-build-devkit must have a value])
 959     elif test -n &quot;$with_build_devkit&quot;; then
 960       if test ! -d &quot;$with_build_devkit&quot;; then
 961         AC_MSG_ERROR([--with-build-devkit points to non existing dir: $with_build_devkit])
 962       else
<span class="line-modified"> 963         UTIL_FIXUP_PATH([with_build_devkit])</span>
 964         BUILD_DEVKIT_ROOT=&quot;$with_build_devkit&quot;
 965         # Check for a meta data info file in the root of the devkit
 966         if test -f &quot;$BUILD_DEVKIT_ROOT/devkit.info&quot;; then
 967           # Process devkit.info so that existing devkit variables are not
 968           # modified by this
 969           $SED -e &quot;s/^DEVKIT_/BUILD_DEVKIT_/g&quot; \
 970               -e &quot;s/\$DEVKIT_ROOT/\$BUILD_DEVKIT_ROOT/g&quot; \
 971               -e &quot;s/\$host/\$build/g&quot; \
 972               $BUILD_DEVKIT_ROOT/devkit.info \
 973               &gt; $CONFIGURESUPPORT_OUTPUTDIR/build-devkit.info
 974           . $CONFIGURESUPPORT_OUTPUTDIR/build-devkit.info
 975           # This potentially sets the following:
 976           # A descriptive name of the devkit
 977           BASIC_EVAL_DEVKIT_VARIABLE([BUILD_DEVKIT_NAME])
 978           # Corresponds to --with-extra-path
 979           BASIC_EVAL_DEVKIT_VARIABLE([BUILD_DEVKIT_EXTRA_PATH])
 980           # Corresponds to --with-toolchain-path
 981           BASIC_EVAL_DEVKIT_VARIABLE([BUILD_DEVKIT_TOOLCHAIN_PATH])
 982           # Corresponds to --with-sysroot
 983           BASIC_EVAL_DEVKIT_VARIABLE([BUILD_DEVKIT_SYSROOT])
</pre>
<hr />
<pre>
 987         AC_MSG_CHECKING([for build platform devkit])
 988         if test &quot;x$BUILD_DEVKIT_NAME&quot; != x; then
 989           AC_MSG_RESULT([$BUILD_DEVKIT_NAME in $BUILD_DEVKIT_ROOT])
 990         else
 991           AC_MSG_RESULT([$BUILD_DEVKIT_ROOT])
 992         fi
 993 
 994         BUILD_SYSROOT=&quot;$BUILD_DEVKIT_SYSROOT&quot;
 995 
 996          # Fallback default of just /bin if DEVKIT_PATH is not defined
 997         if test &quot;x$BUILD_DEVKIT_TOOLCHAIN_PATH&quot; = x; then
 998           BUILD_DEVKIT_TOOLCHAIN_PATH=&quot;$BUILD_DEVKIT_ROOT/bin&quot;
 999         fi
1000         PATH=&quot;$BUILD_DEVKIT_TOOLCHAIN_PATH:$BUILD_DEVKIT_EXTRA_PATH&quot;
1001       fi
1002     fi
1003 
1004     # FIXME: we should list the discovered compilers as an exclude pattern!
1005     # If we do that, we can do this detection before POST_DETECTION, and still
1006     # find the build compilers in the tools dir, if needed.
<span class="line-modified">1007     UTIL_REQUIRE_PROGS(BUILD_CC, [cl cc gcc])</span>
<span class="line-modified">1008     UTIL_FIXUP_EXECUTABLE(BUILD_CC)</span>
<span class="line-modified">1009     UTIL_REQUIRE_PROGS(BUILD_CXX, [cl CC g++])</span>
<span class="line-modified">1010     UTIL_FIXUP_EXECUTABLE(BUILD_CXX)</span>
<span class="line-modified">1011     UTIL_PATH_PROGS(BUILD_NM, nm gcc-nm)</span>
<span class="line-modified">1012     UTIL_FIXUP_EXECUTABLE(BUILD_NM)</span>
<span class="line-modified">1013     UTIL_PATH_PROGS(BUILD_AR, ar gcc-ar)</span>
<span class="line-modified">1014     UTIL_FIXUP_EXECUTABLE(BUILD_AR)</span>
<span class="line-modified">1015     UTIL_PATH_PROGS(BUILD_OBJCOPY, objcopy)</span>
<span class="line-modified">1016     UTIL_FIXUP_EXECUTABLE(BUILD_OBJCOPY)</span>
<span class="line-modified">1017     UTIL_PATH_PROGS(BUILD_STRIP, strip)</span>
<span class="line-modified">1018     UTIL_FIXUP_EXECUTABLE(BUILD_STRIP)</span>
1019     # Assume the C compiler is the assembler
1020     BUILD_AS=&quot;$BUILD_CC -c&quot;
1021     # Just like for the target compiler, use the compiler as linker
1022     BUILD_LD=&quot;$BUILD_CC&quot;
1023     BUILD_LDCXX=&quot;$BUILD_CXX&quot;
1024 
1025     PATH=&quot;$OLDPATH&quot;
1026 
1027     TOOLCHAIN_EXTRACT_COMPILER_VERSION(BUILD_CC, [BuildC])
1028     TOOLCHAIN_EXTRACT_COMPILER_VERSION(BUILD_CXX, [BuildC++])
1029     TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS([BUILD_], [OPENJDK_BUILD_], [build ])
1030     TOOLCHAIN_EXTRACT_LD_VERSION(BUILD_LD, [build linker])
1031     TOOLCHAIN_PREPARE_FOR_LD_VERSION_COMPARISONS([BUILD_], [OPENJDK_BUILD_])
1032   else
1033     # If we are not cross compiling, use the normal target compilers for
1034     # building the build platform executables.
1035     BUILD_CC=&quot;$CC&quot;
1036     BUILD_CXX=&quot;$CXX&quot;
1037     BUILD_LD=&quot;$LD&quot;
1038     BUILD_LDCXX=&quot;$LDCXX&quot;
</pre>
<hr />
<pre>
1092     HOTSPOT_TOOLCHAIN_TYPE=gcc
1093   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
1094     HOTSPOT_TOOLCHAIN_TYPE=visCPP
1095   fi
1096   AC_SUBST(HOTSPOT_TOOLCHAIN_TYPE)
1097 ])
1098 
1099 # Setup the JTReg Regression Test Harness.
1100 AC_DEFUN_ONCE([TOOLCHAIN_SETUP_JTREG],
1101 [
1102   AC_ARG_WITH(jtreg, [AS_HELP_STRING([--with-jtreg],
1103       [Regression Test Harness @&lt;:@probed@:&gt;@])])
1104 
1105   if test &quot;x$with_jtreg&quot; = xno; then
1106     # jtreg disabled
1107     AC_MSG_CHECKING([for jtreg test harness])
1108     AC_MSG_RESULT([no, disabled])
1109   elif test &quot;x$with_jtreg&quot; != xyes &amp;&amp; test &quot;x$with_jtreg&quot; != x; then
1110     # An explicit path is specified, use it.
1111     JT_HOME=&quot;$with_jtreg&quot;
<span class="line-modified">1112     UTIL_FIXUP_PATH([JT_HOME])</span>
1113     if test ! -d &quot;$JT_HOME&quot;; then
1114       AC_MSG_ERROR([jtreg home directory from --with-jtreg=$with_jtreg does not exist])
1115     fi
1116 
1117     if test ! -e &quot;$JT_HOME/lib/jtreg.jar&quot;; then
1118       AC_MSG_ERROR([jtreg home directory from --with-jtreg=$with_jtreg is not a valid jtreg home])
1119     fi
1120 
1121     JTREGEXE=&quot;$JT_HOME/bin/jtreg&quot;
1122     if test ! -x &quot;$JTREGEXE&quot;; then
1123       AC_MSG_ERROR([jtreg home directory from --with-jtreg=$with_jtreg does not contain valid jtreg executable])
1124     fi
1125 
1126     AC_MSG_CHECKING([for jtreg test harness])
1127     AC_MSG_RESULT([$JT_HOME])
1128   else
1129     # Try to locate jtreg
1130     if test &quot;x$JT_HOME&quot; != x; then
1131       # JT_HOME set in environment, use it
1132       if test ! -d &quot;$JT_HOME&quot;; then
1133         AC_MSG_WARN([Ignoring JT_HOME pointing to invalid directory: $JT_HOME])
1134         JT_HOME=
1135       else
1136         if test ! -e &quot;$JT_HOME/lib/jtreg.jar&quot;; then
1137           AC_MSG_WARN([Ignoring JT_HOME which is not a valid jtreg home: $JT_HOME])
1138           JT_HOME=
1139         elif test ! -x &quot;$JT_HOME/bin/jtreg&quot;; then
1140           AC_MSG_WARN([Ignoring JT_HOME which does not contain valid jtreg executable: $JT_HOME])
1141           JT_HOME=
1142         else
1143           JTREGEXE=&quot;$JT_HOME/bin/jtreg&quot;
1144           AC_MSG_NOTICE([Located jtreg using JT_HOME from environment])
1145         fi
1146       fi
1147     fi
1148 
1149     if test &quot;x$JT_HOME&quot; = x; then
1150       # JT_HOME is not set in environment, or was deemed invalid.
1151       # Try to find jtreg on path
<span class="line-modified">1152       UTIL_PATH_PROGS(JTREGEXE, jtreg)</span>
1153       if test &quot;x$JTREGEXE&quot; != x; then
1154         # That&#39;s good, now try to derive JT_HOME
1155         JT_HOME=`(cd $($DIRNAME $JTREGEXE)/.. &amp;&amp; pwd)`
1156         if test ! -e &quot;$JT_HOME/lib/jtreg.jar&quot;; then
1157           AC_MSG_WARN([Ignoring jtreg from path since a valid jtreg home cannot be found])
1158           JT_HOME=
1159           JTREGEXE=
1160         else
1161           AC_MSG_NOTICE([Located jtreg using jtreg executable in path])
1162         fi
1163       fi
1164     fi
1165 
1166     AC_MSG_CHECKING([for jtreg test harness])
1167     if test &quot;x$JT_HOME&quot; != x; then
1168       AC_MSG_RESULT([$JT_HOME])
1169     else
1170       AC_MSG_RESULT([no, not found])
1171 
1172       if test &quot;x$with_jtreg&quot; = xyes; then
1173         AC_MSG_ERROR([--with-jtreg was specified, but no jtreg found.])
1174       fi
1175     fi
1176   fi
1177 
<span class="line-modified">1178   UTIL_FIXUP_EXECUTABLE(JTREGEXE)</span>
<span class="line-modified">1179   UTIL_FIXUP_PATH(JT_HOME)</span>
1180   AC_SUBST(JT_HOME)
1181   AC_SUBST(JTREGEXE)
1182 ])
1183 
1184 # Setup the JIB dependency resolver
1185 AC_DEFUN_ONCE([TOOLCHAIN_SETUP_JIB],
1186 [
1187   AC_ARG_WITH(jib, [AS_HELP_STRING([--with-jib],
1188       [Jib dependency management tool @&lt;:@not used@:&gt;@])])
1189 
1190   if test &quot;x$with_jib&quot; = xno || test &quot;x$with_jib&quot; = x; then
1191     # jib disabled
1192     AC_MSG_CHECKING([for jib])
1193     AC_MSG_RESULT(no)
1194   elif test &quot;x$with_jib&quot; = xyes; then
1195     AC_MSG_ERROR([Must supply a value to --with-jib])
1196   else
1197     JIB_HOME=&quot;${with_jib}&quot;
1198     AC_MSG_CHECKING([for jib])
1199     AC_MSG_RESULT(${JIB_HOME})
</pre>
</td>
</tr>
</table>
<center><a href="spec.gmk.in.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="toolchain_windows.m4.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>