<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff make/autoconf/hotspot.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="help.m4.udiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="jdk-options.m4.udiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/hotspot.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  #
<span class="udiff-line-modified-removed">- # Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+ # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
  # published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -21,18 +21,10 @@</span>
  # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  # or visit www.oracle.com if you need additional information or have any
  # questions.
  #
  
<span class="udiff-line-removed">- # All valid JVM features, regardless of platform</span>
<span class="udiff-line-removed">- VALID_JVM_FEATURES=&quot;compiler1 compiler2 zero minimal dtrace jvmti jvmci \</span>
<span class="udiff-line-removed">-     graal vm-structs jni-check services management epsilongc g1gc parallelgc serialgc shenandoahgc zgc nmt cds \</span>
<span class="udiff-line-removed">-     static-build link-time-opt aot jfr&quot;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- # Deprecated JVM features (these are ignored, but with a warning)</span>
<span class="udiff-line-removed">- DEPRECATED_JVM_FEATURES=&quot;trace cmsgc&quot;</span>
<span class="udiff-line-removed">- </span>
  # All valid JVM variants
  VALID_JVM_VARIANTS=&quot;server client minimal core zero custom&quot;
  
  ###############################################################################
  # Check if the specified JVM variant should be built. To be used in shell if
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -44,36 +36,10 @@</span>
  # Definition kept in one line to allow inlining in if statements.
  # Additional [] needed to keep m4 from mangling shell constructs.
  AC_DEFUN([HOTSPOT_CHECK_JVM_VARIANT],
  [ [ [[ &quot; $JVM_VARIANTS &quot; =~ &quot; $1 &quot; ]] ] ])
  
<span class="udiff-line-removed">- ###############################################################################</span>
<span class="udiff-line-removed">- # Check if the specified JVM feature is enabled. To be used in shell if</span>
<span class="udiff-line-removed">- # constructs, like this:</span>
<span class="udiff-line-removed">- # if HOTSPOT_CHECK_JVM_FEATURE(jvmti); then</span>
<span class="udiff-line-removed">- #</span>
<span class="udiff-line-removed">- # Only valid to use after HOTSPOT_SETUP_JVM_FEATURES has setup features.</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- # Definition kept in one line to allow inlining in if statements.</span>
<span class="udiff-line-removed">- # Additional [] needed to keep m4 from mangling shell constructs.</span>
<span class="udiff-line-removed">- AC_DEFUN([HOTSPOT_CHECK_JVM_FEATURE],</span>
<span class="udiff-line-removed">- [ [ [[ &quot; $JVM_FEATURES &quot; =~ &quot; $1 &quot; ]] ] ])</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- ###############################################################################</span>
<span class="udiff-line-removed">- # Check if the specified JVM feature is explicitly disabled. To be used in</span>
<span class="udiff-line-removed">- # shell if constructs, like this:</span>
<span class="udiff-line-removed">- # if HOTSPOT_IS_JVM_FEATURE_DISABLED(jvmci); then</span>
<span class="udiff-line-removed">- #</span>
<span class="udiff-line-removed">- # This function is internal to hotspot.m4, and is only used when constructing</span>
<span class="udiff-line-removed">- # the valid set of enabled JVM features. Users outside of hotspot.m4 should just</span>
<span class="udiff-line-removed">- # use HOTSPOT_CHECK_JVM_FEATURE to check if a feature is enabled or not.</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- # Definition kept in one line to allow inlining in if statements.</span>
<span class="udiff-line-removed">- # Additional [] needed to keep m4 from mangling shell constructs.</span>
<span class="udiff-line-removed">- AC_DEFUN([HOTSPOT_IS_JVM_FEATURE_DISABLED],</span>
<span class="udiff-line-removed">- [ [ [[ &quot; $DISABLED_JVM_FEATURES &quot; =~ &quot; $1 &quot; ]] ] ])</span>
<span class="udiff-line-removed">- </span>
  ###############################################################################
  # Check which variants of the JVM that we want to build. Available variants are:
  #   server: normal interpreter, and a tiered C1/C2 compiler
  #   client: normal interpreter, and C1 (no C2 compiler)
  #   minimal: reduced form of client with optional features stripped out
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -82,11 +48,12 @@</span>
  #   custom: baseline JVM with no default features
  #
  AC_DEFUN_ONCE([HOTSPOT_SETUP_JVM_VARIANTS],
  [
    AC_ARG_WITH([jvm-variants], [AS_HELP_STRING([--with-jvm-variants],
<span class="udiff-line-modified-removed">-       [JVM variants (separated by commas) to build (server,client,minimal,core,zero,custom) @&lt;:@server@:&gt;@])])</span>
<span class="udiff-line-modified-added">+       [JVM variants to build, separated by commas (server client minimal core</span>
<span class="udiff-line-added">+       zero custom) @&lt;:@server@:&gt;@])])</span>
  
    if test &quot;x$with_jvm_variants&quot; = x; then
      with_jvm_variants=&quot;server&quot;
    fi
    JVM_VARIANTS_OPT=&quot;$with_jvm_variants&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -106,22 +73,25 @@</span>
    # Also use minimal, not minimal1 (which is kept for backwards compatibility).
    JVM_VARIANTS=`$ECHO $JVM_VARIANTS_OPT | $SED -e &#39;s/,/ /g&#39; -e &#39;s/minimal1/minimal/&#39;`
    AC_MSG_RESULT([$JVM_VARIANTS])
  
    # Check that the selected variants are valid
<span class="udiff-line-modified-removed">-   BASIC_GET_NON_MATCHING_VALUES(INVALID_VARIANTS, $JVM_VARIANTS, $VALID_JVM_VARIANTS)</span>
<span class="udiff-line-modified-added">+   UTIL_GET_NON_MATCHING_VALUES(INVALID_VARIANTS, $JVM_VARIANTS, \</span>
<span class="udiff-line-added">+       $VALID_JVM_VARIANTS)</span>
    if test &quot;x$INVALID_VARIANTS&quot; != x; then
      AC_MSG_NOTICE([Unknown variant(s) specified: &quot;$INVALID_VARIANTS&quot;])
      AC_MSG_NOTICE([The available JVM variants are: &quot;$VALID_JVM_VARIANTS&quot;])
      AC_MSG_ERROR([Cannot continue])
    fi
  
    # All &quot;special&quot; variants share the same output directory (&quot;server&quot;)
    VALID_MULTIPLE_JVM_VARIANTS=&quot;server client minimal&quot;
<span class="udiff-line-modified-removed">-   BASIC_GET_NON_MATCHING_VALUES(INVALID_MULTIPLE_VARIANTS, $JVM_VARIANTS, $VALID_MULTIPLE_JVM_VARIANTS)</span>
<span class="udiff-line-modified-removed">-   if  test &quot;x$INVALID_MULTIPLE_VARIANTS&quot; != x &amp;&amp; test &quot;x$BUILDING_MULTIPLE_JVM_VARIANTS&quot; = xtrue; then</span>
<span class="udiff-line-modified-removed">-     AC_MSG_ERROR([You cannot build multiple variants with anything else than $VALID_MULTIPLE_JVM_VARIANTS.])</span>
<span class="udiff-line-modified-added">+   UTIL_GET_NON_MATCHING_VALUES(INVALID_MULTIPLE_VARIANTS, $JVM_VARIANTS, \</span>
<span class="udiff-line-modified-added">+       $VALID_MULTIPLE_JVM_VARIANTS)</span>
<span class="udiff-line-modified-added">+   if  test &quot;x$INVALID_MULTIPLE_VARIANTS&quot; != x &amp;&amp; \</span>
<span class="udiff-line-added">+       test &quot;x$BUILDING_MULTIPLE_JVM_VARIANTS&quot; = xtrue; then</span>
<span class="udiff-line-added">+     AC_MSG_ERROR([You can only build multiple variants using these variants: &#39;$VALID_MULTIPLE_JVM_VARIANTS&#39;])</span>
    fi
  
    # The &quot;main&quot; variant is the one used by other libs to link against during the
    # build.
    if test &quot;x$BUILDING_MULTIPLE_JVM_VARIANTS&quot; = &quot;xtrue&quot;; then
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -137,510 +107,62 @@</span>
    fi
  
    AC_SUBST(JVM_VARIANTS)
    AC_SUBST(VALID_JVM_VARIANTS)
    AC_SUBST(JVM_VARIANT_MAIN)
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   if HOTSPOT_CHECK_JVM_VARIANT(zero); then</span>
<span class="udiff-line-removed">-     # zero behaves as a platform and rewrites these values. This is really weird. :(</span>
<span class="udiff-line-removed">-     # We are guaranteed that we do not build any other variants when building zero.</span>
<span class="udiff-line-removed">-     HOTSPOT_TARGET_CPU=zero</span>
<span class="udiff-line-removed">-     HOTSPOT_TARGET_CPU_ARCH=zero</span>
<span class="udiff-line-removed">-   fi</span>
  ])
  
  ###############################################################################
<span class="udiff-line-modified-removed">- # Check if dtrace should be enabled and has all prerequisites present.</span>
<span class="udiff-line-removed">- #</span>
<span class="udiff-line-removed">- AC_DEFUN_ONCE([HOTSPOT_SETUP_DTRACE],</span>
<span class="udiff-line-removed">- [</span>
<span class="udiff-line-removed">-   # Test for dtrace dependencies</span>
<span class="udiff-line-removed">-   AC_ARG_ENABLE([dtrace], [AS_HELP_STRING([--enable-dtrace@&lt;:@=yes/no/auto@:&gt;@],</span>
<span class="udiff-line-removed">-       [enable dtrace. Default is auto, where dtrace is enabled if all dependencies</span>
<span class="udiff-line-removed">-       are present.])])</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   DTRACE_DEP_MISSING=false</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   AC_MSG_CHECKING([for dtrace tool])</span>
<span class="udiff-line-removed">-   if test &quot;x$DTRACE&quot; != &quot;x&quot; &amp;&amp; test -x &quot;$DTRACE&quot;; then</span>
<span class="udiff-line-removed">-     AC_MSG_RESULT([$DTRACE])</span>
<span class="udiff-line-removed">-   else</span>
<span class="udiff-line-removed">-     AC_MSG_RESULT([not found, cannot build dtrace])</span>
<span class="udiff-line-removed">-     DTRACE_DEP_MISSING=true</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   AC_CHECK_HEADERS([sys/sdt.h], [DTRACE_HEADERS_OK=yes],[DTRACE_HEADERS_OK=no])</span>
<span class="udiff-line-removed">-   if test &quot;x$DTRACE_HEADERS_OK&quot; != &quot;xyes&quot;; then</span>
<span class="udiff-line-removed">-     DTRACE_DEP_MISSING=true</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   AC_MSG_CHECKING([if dtrace should be built])</span>
<span class="udiff-line-removed">-   if test &quot;x$enable_dtrace&quot; = &quot;xyes&quot;; then</span>
<span class="udiff-line-removed">-     if test &quot;x$DTRACE_DEP_MISSING&quot; = &quot;xtrue&quot;; then</span>
<span class="udiff-line-removed">-       AC_MSG_RESULT([no, missing dependencies])</span>
<span class="udiff-line-removed">-       HELP_MSG_MISSING_DEPENDENCY([dtrace])</span>
<span class="udiff-line-removed">-       AC_MSG_ERROR([Cannot enable dtrace with missing dependencies. See above. $HELP_MSG])</span>
<span class="udiff-line-removed">-     else</span>
<span class="udiff-line-removed">-       INCLUDE_DTRACE=true</span>
<span class="udiff-line-removed">-       AC_MSG_RESULT([yes, forced])</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-   elif test &quot;x$enable_dtrace&quot; = &quot;xno&quot;; then</span>
<span class="udiff-line-removed">-     INCLUDE_DTRACE=false</span>
<span class="udiff-line-removed">-     AC_MSG_RESULT([no, forced])</span>
<span class="udiff-line-removed">-   elif test &quot;x$enable_dtrace&quot; = &quot;xauto&quot; || test &quot;x$enable_dtrace&quot; = &quot;x&quot;; then</span>
<span class="udiff-line-removed">-     if test &quot;x$DTRACE_DEP_MISSING&quot; = &quot;xtrue&quot;; then</span>
<span class="udiff-line-removed">-       INCLUDE_DTRACE=false</span>
<span class="udiff-line-removed">-       AC_MSG_RESULT([no, missing dependencies])</span>
<span class="udiff-line-removed">-     else</span>
<span class="udiff-line-removed">-       INCLUDE_DTRACE=true</span>
<span class="udiff-line-removed">-       AC_MSG_RESULT([yes, dependencies present])</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-   else</span>
<span class="udiff-line-removed">-     AC_MSG_ERROR([Invalid value for --enable-dtrace: $enable_dtrace])</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- ])</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- ################################################################################</span>
<span class="udiff-line-removed">- # Check if AOT should be enabled</span>
<span class="udiff-line-modified-added">+ # Check if gtest should be built</span>
  #
<span class="udiff-line-modified-removed">- AC_DEFUN_ONCE([HOTSPOT_ENABLE_DISABLE_AOT],</span>
<span class="udiff-line-modified-added">+ AC_DEFUN_ONCE([HOTSPOT_ENABLE_DISABLE_GTEST],</span>
  [
<span class="udiff-line-modified-removed">-   AC_ARG_ENABLE([aot], [AS_HELP_STRING([--enable-aot@&lt;:@=yes/no/auto@:&gt;@],</span>
<span class="udiff-line-removed">-       [enable ahead of time compilation feature. Default is auto, where aot is enabled if all dependencies are present.])])</span>
<span class="udiff-line-modified-added">+   GTEST_AVAILABLE=true</span>
  
<span class="udiff-line-modified-removed">-   if test &quot;x$enable_aot&quot; = &quot;x&quot; || test &quot;x$enable_aot&quot; = &quot;xauto&quot;; then</span>
<span class="udiff-line-modified-removed">-     ENABLE_AOT=&quot;true&quot;</span>
<span class="udiff-line-modified-removed">-   elif test &quot;x$enable_aot&quot; = &quot;xyes&quot;; then</span>
<span class="udiff-line-removed">-     ENABLE_AOT=&quot;true&quot;</span>
<span class="udiff-line-removed">-   elif test &quot;x$enable_aot&quot; = &quot;xno&quot;; then</span>
<span class="udiff-line-removed">-     ENABLE_AOT=&quot;false&quot;</span>
<span class="udiff-line-modified-added">+   AC_MSG_CHECKING([if Hotspot gtest test source is present])</span>
<span class="udiff-line-modified-added">+   if test -e &quot;${TOPDIR}/test/hotspot/gtest&quot;; then</span>
<span class="udiff-line-modified-added">+     AC_MSG_RESULT([yes])</span>
    else
<span class="udiff-line-modified-removed">-     AC_MSG_ERROR([Invalid value for --enable-aot: $enable_aot])</span>
<span class="udiff-line-modified-added">+     AC_MSG_RESULT([no, cannot build gtest])</span>
<span class="udiff-line-added">+     GTEST_AVAILABLE=false</span>
    fi
  
<span class="udiff-line-modified-removed">-   if test &quot;x$ENABLE_AOT&quot; = &quot;xtrue&quot;; then</span>
<span class="udiff-line-modified-removed">-     # Only enable AOT on X64 platforms.</span>
<span class="udiff-line-modified-removed">-     if test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86_64&quot; || test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xaarch64&quot; ; then</span>
<span class="udiff-line-modified-removed">-       if test -e &quot;${TOPDIR}/src/jdk.aot&quot;; then</span>
<span class="udiff-line-modified-removed">-         if test -e &quot;${TOPDIR}/src/jdk.internal.vm.compiler&quot;; then</span>
<span class="udiff-line-modified-removed">-           ENABLE_AOT=&quot;true&quot;</span>
<span class="udiff-line-removed">-         else</span>
<span class="udiff-line-removed">-           ENABLE_AOT=&quot;false&quot;</span>
<span class="udiff-line-removed">-           if test &quot;x$enable_aot&quot; = &quot;xyes&quot;; then</span>
<span class="udiff-line-removed">-             AC_MSG_ERROR([Cannot build AOT without src/jdk.internal.vm.compiler sources. Remove --enable-aot.])</span>
<span class="udiff-line-removed">-           fi</span>
<span class="udiff-line-removed">-         fi</span>
<span class="udiff-line-removed">-       else</span>
<span class="udiff-line-removed">-         ENABLE_AOT=&quot;false&quot;</span>
<span class="udiff-line-removed">-         if test &quot;x$enable_aot&quot; = &quot;xyes&quot;; then</span>
<span class="udiff-line-removed">-           AC_MSG_ERROR([Cannot build AOT without src/jdk.aot sources. Remove --enable-aot.])</span>
<span class="udiff-line-removed">-         fi</span>
<span class="udiff-line-removed">-       fi</span>
<span class="udiff-line-modified-added">+   # On solaris, we also must have the libstlport.so.1 library, setup in</span>
<span class="udiff-line-modified-added">+   # LIB_SETUP_LIBRARIES.</span>
<span class="udiff-line-modified-added">+   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xsolaris&quot;; then</span>
<span class="udiff-line-modified-added">+     AC_MSG_CHECKING([if the libstlport.so.1 library is present])</span>
<span class="udiff-line-modified-added">+     if test &quot;x$STLPORT_LIB&quot; != &quot;x&quot;; then</span>
<span class="udiff-line-modified-added">+       AC_MSG_RESULT([yes])</span>
      else
<span class="udiff-line-modified-removed">-       ENABLE_AOT=&quot;false&quot;</span>
<span class="udiff-line-modified-removed">-       if test &quot;x$enable_aot&quot; = &quot;xyes&quot;; then</span>
<span class="udiff-line-removed">-         AC_MSG_ERROR([AOT is currently only supported on x86_64 and aarch64. Remove --enable-aot.])</span>
<span class="udiff-line-removed">-       fi</span>
<span class="udiff-line-modified-added">+       AC_MSG_RESULT([no, cannot build gtest])</span>
<span class="udiff-line-modified-added">+       GTEST_AVAILABLE=false</span>
      fi
    fi
  
<span class="udiff-line-modified-removed">-   AC_SUBST(ENABLE_AOT)</span>
<span class="udiff-line-modified-removed">- ])</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- ################################################################################</span>
<span class="udiff-line-modified-removed">- # Allow to disable CDS</span>
<span class="udiff-line-removed">- #</span>
<span class="udiff-line-removed">- AC_DEFUN_ONCE([HOTSPOT_ENABLE_DISABLE_CDS],</span>
<span class="udiff-line-removed">- [</span>
<span class="udiff-line-removed">-   AC_ARG_ENABLE([cds], [AS_HELP_STRING([--enable-cds@&lt;:@=yes/no/auto@:&gt;@],</span>
<span class="udiff-line-removed">-       [enable class data sharing feature in non-minimal VM. Default is auto, where cds is enabled if supported on the platform.])])</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   if test &quot;x$enable_cds&quot; = &quot;x&quot; || test &quot;x$enable_cds&quot; = &quot;xauto&quot;; then</span>
<span class="udiff-line-removed">-     ENABLE_CDS=&quot;true&quot;</span>
<span class="udiff-line-removed">-   elif test &quot;x$enable_cds&quot; = &quot;xyes&quot;; then</span>
<span class="udiff-line-removed">-     ENABLE_CDS=&quot;true&quot;</span>
<span class="udiff-line-removed">-   elif test &quot;x$enable_cds&quot; = &quot;xno&quot;; then</span>
<span class="udiff-line-removed">-     ENABLE_CDS=&quot;false&quot;</span>
<span class="udiff-line-removed">-   else</span>
<span class="udiff-line-removed">-     AC_MSG_ERROR([Invalid value for --enable-cds: $enable_cds])</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   AC_SUBST(ENABLE_CDS)</span>
<span class="udiff-line-modified-added">+   UTIL_ARG_ENABLE(NAME: hotspot-gtest, DEFAULT: auto,</span>
<span class="udiff-line-modified-added">+       RESULT: BUILD_GTEST, AVAILABLE: $GTEST_AVAILABLE,</span>
<span class="udiff-line-modified-added">+       DEFAULT_DESC: [enabled if possible to build],</span>
<span class="udiff-line-modified-added">+       DESC: [enable building of the Hotspot unit tests])</span>
<span class="udiff-line-modified-added">+   AC_SUBST(BUILD_GTEST)</span>
  ])
  
  ###############################################################################
<span class="udiff-line-modified-removed">- # Set up all JVM features for each JVM variant.</span>
<span class="udiff-line-modified-added">+ # Misc hotspot setup that does not fit elsewhere.</span>
  #
<span class="udiff-line-modified-removed">- AC_DEFUN_ONCE([HOTSPOT_SETUP_JVM_FEATURES],</span>
<span class="udiff-line-modified-added">+ AC_DEFUN_ONCE([HOTSPOT_SETUP_MISC],</span>
  [
<span class="udiff-line-modified-removed">-   # Prettify the VALID_JVM_FEATURES string</span>
<span class="udiff-line-modified-removed">-   BASIC_SORT_LIST(VALID_JVM_FEATURES, $VALID_JVM_FEATURES)</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-   # The user can in some cases supply additional jvm features. For the custom</span>
<span class="udiff-line-modified-removed">-   # variant, this defines the entire variant.</span>
<span class="udiff-line-removed">-   AC_ARG_WITH([jvm-features], [AS_HELP_STRING([--with-jvm-features],</span>
<span class="udiff-line-removed">-       [JVM features to enable (foo) or disable (-foo), separated by comma. Use &#39;--help&#39; to show possible values @&lt;:@none@:&gt;@])])</span>
<span class="udiff-line-removed">-   if test &quot;x$with_jvm_features&quot; != x; then</span>
<span class="udiff-line-removed">-     AC_MSG_CHECKING([user specified JVM feature list])</span>
<span class="udiff-line-removed">-     USER_JVM_FEATURE_LIST=`$ECHO $with_jvm_features | $SED -e &#39;s/,/ /g&#39;`</span>
<span class="udiff-line-removed">-     AC_MSG_RESULT([$user_jvm_feature_list])</span>
<span class="udiff-line-removed">-     # These features will be added to all variant defaults</span>
<span class="udiff-line-removed">-     JVM_FEATURES=`$ECHO $USER_JVM_FEATURE_LIST | $AWK &#39;{ for (i=1; i&lt;=NF; i++) if (!match($i, /^-.*/)) printf(&quot;%s &quot;, $i) }&#39;`</span>
<span class="udiff-line-removed">-     # These features will be removed from all variant defaults</span>
<span class="udiff-line-removed">-     DISABLED_JVM_FEATURES=`$ECHO $USER_JVM_FEATURE_LIST | $AWK &#39;{ for (i=1; i&lt;=NF; i++) if (match($i, /^-.*/)) printf(&quot;%s &quot;, substr($i, 2))}&#39;`</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     # Verify that the user has provided valid features</span>
<span class="udiff-line-removed">-     BASIC_GET_NON_MATCHING_VALUES(INVALID_FEATURES, $JVM_FEATURES $DISABLED_JVM_FEATURES, $VALID_JVM_FEATURES $DEPRECATED_JVM_FEATURES)</span>
<span class="udiff-line-removed">-     if test &quot;x$INVALID_FEATURES&quot; != x; then</span>
<span class="udiff-line-removed">-       AC_MSG_NOTICE([Unknown JVM features specified: &quot;$INVALID_FEATURES&quot;])</span>
<span class="udiff-line-removed">-       AC_MSG_NOTICE([The available JVM features are: &quot;$VALID_JVM_FEATURES&quot;])</span>
<span class="udiff-line-removed">-       AC_MSG_ERROR([Cannot continue])</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     # Check if the user has provided deprecated features</span>
<span class="udiff-line-removed">-     BASIC_GET_MATCHING_VALUES(DEPRECATED_FEATURES, $JVM_FEATURES $DISABLED_JVM_FEATURES, $DEPRECATED_JVM_FEATURES)</span>
<span class="udiff-line-removed">-     if test &quot;x$DEPRECATED_FEATURES&quot; != x; then</span>
<span class="udiff-line-removed">-       AC_MSG_WARN([Deprecated JVM features specified (will be ignored): &quot;$DEPRECATED_FEATURES&quot;])</span>
<span class="udiff-line-removed">-       # Filter out deprecated features</span>
<span class="udiff-line-removed">-       BASIC_GET_NON_MATCHING_VALUES(JVM_FEATURES, $JVM_FEATURES, $DEPRECATED_FEATURES)</span>
<span class="udiff-line-removed">-       BASIC_GET_NON_MATCHING_VALUES(DISABLED_JVM_FEATURES, $DISABLED_JVM_FEATURES, $DEPRECATED_FEATURES)</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-modified-added">+   if HOTSPOT_CHECK_JVM_VARIANT(zero); then</span>
<span class="udiff-line-modified-added">+     # zero behaves as a platform and rewrites these values. This is a bit weird.</span>
<span class="udiff-line-modified-added">+     # But when building zero, we never build any other variants so it works.</span>
<span class="udiff-line-modified-added">+     HOTSPOT_TARGET_CPU=zero</span>
<span class="udiff-line-modified-added">+     HOTSPOT_TARGET_CPU_ARCH=zero</span>
    fi
  
    # Override hotspot cpu definitions for ARM platforms
    if test &quot;x$OPENJDK_TARGET_CPU&quot; = xarm; then
      HOTSPOT_TARGET_CPU=arm_32
      HOTSPOT_TARGET_CPU_DEFINE=&quot;ARM32&quot;
    fi
  
<span class="udiff-line-removed">-   # Verify that dependencies are met for explicitly set features.</span>
<span class="udiff-line-removed">-   if HOTSPOT_CHECK_JVM_FEATURE(jvmti) &amp;&amp; ! HOTSPOT_CHECK_JVM_FEATURE(services); then</span>
<span class="udiff-line-removed">-     AC_MSG_ERROR([Specified JVM feature &#39;jvmti&#39; requires feature &#39;services&#39;])</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   if HOTSPOT_CHECK_JVM_FEATURE(management) &amp;&amp; ! HOTSPOT_CHECK_JVM_FEATURE(nmt); then</span>
<span class="udiff-line-removed">-     AC_MSG_ERROR([Specified JVM feature &#39;management&#39; requires feature &#39;nmt&#39;])</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   if HOTSPOT_CHECK_JVM_FEATURE(jvmci) &amp;&amp; ! (HOTSPOT_CHECK_JVM_FEATURE(compiler1) || HOTSPOT_CHECK_JVM_FEATURE(compiler2)); then</span>
<span class="udiff-line-removed">-     AC_MSG_ERROR([Specified JVM feature &#39;jvmci&#39; requires feature &#39;compiler2&#39; or &#39;compiler1&#39;])</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   # Enable JFR by default, except for Zero, linux-sparcv9 and on minimal.</span>
<span class="udiff-line-removed">-   if ! HOTSPOT_CHECK_JVM_VARIANT(zero); then</span>
<span class="udiff-line-removed">-     if test &quot;x$OPENJDK_TARGET_OS&quot; != xaix; then</span>
<span class="udiff-line-removed">-       if test &quot;x$OPENJDK_TARGET_OS&quot; != xlinux || test &quot;x$OPENJDK_TARGET_CPU&quot; != xsparcv9; then</span>
<span class="udiff-line-removed">-         NON_MINIMAL_FEATURES=&quot;$NON_MINIMAL_FEATURES jfr&quot;</span>
<span class="udiff-line-removed">-       fi</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   # Only enable Shenandoah on supported arches</span>
<span class="udiff-line-removed">-   AC_MSG_CHECKING([if shenandoah can be built])</span>
<span class="udiff-line-removed">-   if test &quot;x$OPENJDK_TARGET_CPU_ARCH&quot; = &quot;xx86&quot; || test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xaarch64&quot; ; then</span>
<span class="udiff-line-removed">-     AC_MSG_RESULT([yes])</span>
<span class="udiff-line-removed">-   else</span>
<span class="udiff-line-removed">-     DISABLED_JVM_FEATURES=&quot;$DISABLED_JVM_FEATURES shenandoahgc&quot;</span>
<span class="udiff-line-removed">-     AC_MSG_RESULT([no, platform not supported])</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   # Only enable ZGC on supported platforms</span>
<span class="udiff-line-removed">-   if (test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xwindows&quot; &amp;&amp; test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86_64&quot;); then</span>
<span class="udiff-line-removed">-     AC_MSG_CHECKING([if zgc can be built on windows])</span>
<span class="udiff-line-removed">-     AC_COMPILE_IFELSE(</span>
<span class="udiff-line-removed">-       [AC_LANG_PROGRAM([[#include &lt;windows.h&gt;]],</span>
<span class="udiff-line-removed">-         [[struct MEM_EXTENDED_PARAMETER x;]])</span>
<span class="udiff-line-removed">-       ],</span>
<span class="udiff-line-removed">-       [</span>
<span class="udiff-line-removed">-         AC_MSG_RESULT([yes])</span>
<span class="udiff-line-removed">-         CAN_BUILD_ZGC_ON_WINDOWS=&quot;yes&quot;</span>
<span class="udiff-line-removed">-       ],</span>
<span class="udiff-line-removed">-       [</span>
<span class="udiff-line-removed">-         AC_MSG_RESULT([no, missing required APIs])</span>
<span class="udiff-line-removed">-         CAN_BUILD_ZGC_ON_WINDOWS=&quot;no&quot;</span>
<span class="udiff-line-removed">-       ]</span>
<span class="udiff-line-removed">-     )</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   AC_MSG_CHECKING([if zgc can be built])</span>
<span class="udiff-line-removed">-   if (test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xlinux&quot; &amp;&amp; test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86_64&quot;) || \</span>
<span class="udiff-line-removed">-      (test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xlinux&quot; &amp;&amp; test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xaarch64&quot;) || \</span>
<span class="udiff-line-removed">-      (test &quot;x$CAN_BUILD_ZGC_ON_WINDOWS&quot; = &quot;xyes&quot;) || \</span>
<span class="udiff-line-removed">-      (test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xmacosx&quot; &amp;&amp; test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86_64&quot;); then</span>
<span class="udiff-line-removed">-     AC_MSG_RESULT([yes])</span>
<span class="udiff-line-removed">-   else</span>
<span class="udiff-line-removed">-     DISABLED_JVM_FEATURES=&quot;$DISABLED_JVM_FEATURES zgc&quot;</span>
<span class="udiff-line-removed">-     AC_MSG_RESULT([no, platform not supported])</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   # Disable unsupported GCs for Zero</span>
<span class="udiff-line-removed">-   if HOTSPOT_CHECK_JVM_VARIANT(zero); then</span>
<span class="udiff-line-removed">-     DISABLED_JVM_FEATURES=&quot;$DISABLED_JVM_FEATURES epsilongc g1gc zgc shenandoahgc&quot;</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   # Turn on additional features based on other parts of configure</span>
<span class="udiff-line-removed">-   if test &quot;x$INCLUDE_DTRACE&quot; = &quot;xtrue&quot;; then</span>
<span class="udiff-line-removed">-     JVM_FEATURES=&quot;$JVM_FEATURES dtrace&quot;</span>
<span class="udiff-line-removed">-   else</span>
<span class="udiff-line-removed">-     if HOTSPOT_CHECK_JVM_FEATURE(dtrace); then</span>
<span class="udiff-line-removed">-       AC_MSG_ERROR([To enable dtrace, you must use --enable-dtrace])</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   if test &quot;x$STATIC_BUILD&quot; = &quot;xtrue&quot;; then</span>
<span class="udiff-line-removed">-     JVM_FEATURES=&quot;$JVM_FEATURES static-build&quot;</span>
<span class="udiff-line-removed">-   else</span>
<span class="udiff-line-removed">-     if HOTSPOT_CHECK_JVM_FEATURE(static-build); then</span>
<span class="udiff-line-removed">-       AC_MSG_ERROR([To enable static-build, you must use --enable-static-build])</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   if ! HOTSPOT_CHECK_JVM_VARIANT(zero); then</span>
<span class="udiff-line-removed">-     if HOTSPOT_CHECK_JVM_FEATURE(zero); then</span>
<span class="udiff-line-removed">-       AC_MSG_ERROR([To enable zero, you must use --with-jvm-variants=zero])</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   AC_MSG_CHECKING([if jvmci module jdk.internal.vm.ci should be built])</span>
<span class="udiff-line-removed">-   # Check if jvmci is diabled</span>
<span class="udiff-line-removed">-   if HOTSPOT_IS_JVM_FEATURE_DISABLED(jvmci); then</span>
<span class="udiff-line-removed">-     AC_MSG_RESULT([no, forced])</span>
<span class="udiff-line-removed">-     JVM_FEATURES_jvmci=&quot;&quot;</span>
<span class="udiff-line-removed">-     INCLUDE_JVMCI=&quot;false&quot;</span>
<span class="udiff-line-removed">-   else</span>
<span class="udiff-line-removed">-     # Only enable jvmci on x86_64 and aarch64</span>
<span class="udiff-line-removed">-     if test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86_64&quot; || \</span>
<span class="udiff-line-removed">-        test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xaarch64&quot; ; then</span>
<span class="udiff-line-removed">-       AC_MSG_RESULT([yes])</span>
<span class="udiff-line-removed">-       JVM_FEATURES_jvmci=&quot;jvmci&quot;</span>
<span class="udiff-line-removed">-       INCLUDE_JVMCI=&quot;true&quot;</span>
<span class="udiff-line-removed">-     else</span>
<span class="udiff-line-removed">-       AC_MSG_RESULT([no])</span>
<span class="udiff-line-removed">-       JVM_FEATURES_jvmci=&quot;&quot;</span>
<span class="udiff-line-removed">-       INCLUDE_JVMCI=&quot;false&quot;</span>
<span class="udiff-line-removed">-       if HOTSPOT_CHECK_JVM_FEATURE(jvmci); then</span>
<span class="udiff-line-removed">-         AC_MSG_ERROR([JVMCI is currently not supported on this platform.])</span>
<span class="udiff-line-removed">-       fi</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   AC_SUBST(INCLUDE_JVMCI)</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   AC_MSG_CHECKING([if graal module jdk.internal.vm.compiler should be built])</span>
<span class="udiff-line-removed">-   # Check if graal is diabled</span>
<span class="udiff-line-removed">-   if HOTSPOT_IS_JVM_FEATURE_DISABLED(graal); then</span>
<span class="udiff-line-removed">-     AC_MSG_RESULT([no, forced])</span>
<span class="udiff-line-removed">-     JVM_FEATURES_graal=&quot;&quot;</span>
<span class="udiff-line-removed">-     INCLUDE_GRAAL=&quot;false&quot;</span>
<span class="udiff-line-removed">-   else</span>
<span class="udiff-line-removed">-     if HOTSPOT_CHECK_JVM_FEATURE(graal); then</span>
<span class="udiff-line-removed">-       AC_MSG_RESULT([yes, forced])</span>
<span class="udiff-line-removed">-       if test &quot;x$JVM_FEATURES_jvmci&quot; != &quot;xjvmci&quot; ; then</span>
<span class="udiff-line-removed">-         AC_MSG_ERROR([Specified JVM feature &#39;graal&#39; requires feature &#39;jvmci&#39;])</span>
<span class="udiff-line-removed">-       fi</span>
<span class="udiff-line-removed">-       JVM_FEATURES_graal=&quot;graal&quot;</span>
<span class="udiff-line-removed">-       INCLUDE_GRAAL=&quot;true&quot;</span>
<span class="udiff-line-removed">-     else</span>
<span class="udiff-line-removed">-       # By default enable graal build on x64 or where AOT is available.</span>
<span class="udiff-line-removed">-       # graal build requires jvmci.</span>
<span class="udiff-line-removed">-       if test &quot;x$JVM_FEATURES_jvmci&quot; = &quot;xjvmci&quot; &amp;&amp; \</span>
<span class="udiff-line-removed">-           (test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86_64&quot; || \</span>
<span class="udiff-line-removed">-            test &quot;x$ENABLE_AOT&quot; = &quot;xtrue&quot;) ; then</span>
<span class="udiff-line-removed">-         AC_MSG_RESULT([yes])</span>
<span class="udiff-line-removed">-         JVM_FEATURES_graal=&quot;graal&quot;</span>
<span class="udiff-line-removed">-         INCLUDE_GRAAL=&quot;true&quot;</span>
<span class="udiff-line-removed">-       else</span>
<span class="udiff-line-removed">-         AC_MSG_RESULT([no])</span>
<span class="udiff-line-removed">-         JVM_FEATURES_graal=&quot;&quot;</span>
<span class="udiff-line-removed">-         INCLUDE_GRAAL=&quot;false&quot;</span>
<span class="udiff-line-removed">-       fi</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   AC_SUBST(INCLUDE_GRAAL)</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   # Disable aot with &#39;--with-jvm-features=-aot&#39;</span>
<span class="udiff-line-removed">-   if HOTSPOT_IS_JVM_FEATURE_DISABLED(aot); then</span>
<span class="udiff-line-removed">-     ENABLE_AOT=&quot;false&quot;</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   AC_MSG_CHECKING([if aot should be enabled])</span>
<span class="udiff-line-removed">-   if test &quot;x$ENABLE_AOT&quot; = &quot;xtrue&quot;; then</span>
<span class="udiff-line-removed">-     if test &quot;x$JVM_FEATURES_graal&quot; != &quot;xgraal&quot;; then</span>
<span class="udiff-line-removed">-       if test &quot;x$enable_aot&quot; = &quot;xyes&quot; || HOTSPOT_CHECK_JVM_FEATURE(aot); then</span>
<span class="udiff-line-removed">-         AC_MSG_RESULT([yes, forced])</span>
<span class="udiff-line-removed">-         AC_MSG_ERROR([Specified JVM feature &#39;aot&#39; requires feature &#39;graal&#39;])</span>
<span class="udiff-line-removed">-       else</span>
<span class="udiff-line-removed">-         AC_MSG_RESULT([no])</span>
<span class="udiff-line-removed">-       fi</span>
<span class="udiff-line-removed">-       JVM_FEATURES_aot=&quot;&quot;</span>
<span class="udiff-line-removed">-       ENABLE_AOT=&quot;false&quot;</span>
<span class="udiff-line-removed">-     else</span>
<span class="udiff-line-removed">-       if test &quot;x$enable_aot&quot; = &quot;xyes&quot; || HOTSPOT_CHECK_JVM_FEATURE(aot); then</span>
<span class="udiff-line-removed">-         AC_MSG_RESULT([yes, forced])</span>
<span class="udiff-line-removed">-       else</span>
<span class="udiff-line-removed">-         AC_MSG_RESULT([yes])</span>
<span class="udiff-line-removed">-       fi</span>
<span class="udiff-line-removed">-       JVM_FEATURES_aot=&quot;aot&quot;</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-   else</span>
<span class="udiff-line-removed">-     if test &quot;x$enable_aot&quot; = &quot;xno&quot; || HOTSPOT_IS_JVM_FEATURE_DISABLED(aot); then</span>
<span class="udiff-line-removed">-       AC_MSG_RESULT([no, forced])</span>
<span class="udiff-line-removed">-     else</span>
<span class="udiff-line-removed">-       AC_MSG_RESULT([no])</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-     JVM_FEATURES_aot=&quot;&quot;</span>
<span class="udiff-line-removed">-     if HOTSPOT_CHECK_JVM_FEATURE(aot); then</span>
<span class="udiff-line-removed">-       AC_MSG_ERROR([To enable aot, you must use --enable-aot])</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   AC_SUBST(ENABLE_AOT)</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   if test &quot;x$OPENJDK_TARGET_CPU&quot; = xarm ; then</span>
<span class="udiff-line-removed">-     # Default to use link time optimizations on minimal on arm</span>
<span class="udiff-line-removed">-     JVM_FEATURES_link_time_opt=&quot;link-time-opt&quot;</span>
<span class="udiff-line-removed">-   else</span>
<span class="udiff-line-removed">-     JVM_FEATURES_link_time_opt=&quot;&quot;</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   # All variants but minimal (and custom) get these features</span>
<span class="udiff-line-removed">-   NON_MINIMAL_FEATURES=&quot;$NON_MINIMAL_FEATURES g1gc parallelgc serialgc epsilongc shenandoahgc jni-check jvmti management nmt services vm-structs zgc&quot;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   # Disable CDS on AIX.</span>
<span class="udiff-line-removed">-   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xaix&quot;; then</span>
<span class="udiff-line-removed">-     ENABLE_CDS=&quot;false&quot;</span>
<span class="udiff-line-removed">-     if test &quot;x$enable_cds&quot; = &quot;xyes&quot;; then</span>
<span class="udiff-line-removed">-       AC_MSG_ERROR([CDS is currently not supported on AIX. Remove --enable-cds.])</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   # Disable CDS if user requested it with --with-jvm-features=-cds.</span>
<span class="udiff-line-removed">-   if HOTSPOT_IS_JVM_FEATURE_DISABLED(cds); then</span>
<span class="udiff-line-removed">-     ENABLE_CDS=&quot;false&quot;</span>
<span class="udiff-line-removed">-     if test &quot;x$enable_cds&quot; = &quot;xyes&quot;; then</span>
<span class="udiff-line-removed">-       AC_MSG_ERROR([CDS was disabled by --with-jvm-features=-cds. Remove --enable-cds.])</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   if ! HOTSPOT_CHECK_JVM_VARIANT(server) &amp;&amp; ! HOTSPOT_CHECK_JVM_VARIANT(client); then</span>
<span class="udiff-line-removed">-     # ..except when the user explicitely requested it with --enable-jvm-features</span>
<span class="udiff-line-removed">-     if ! HOTSPOT_CHECK_JVM_FEATURE(cds); then</span>
<span class="udiff-line-removed">-       ENABLE_CDS=&quot;false&quot;</span>
<span class="udiff-line-removed">-       if test &quot;x$enable_cds&quot; = &quot;xyes&quot;; then</span>
<span class="udiff-line-removed">-         AC_MSG_ERROR([CDS not implemented for variants zero, minimal, core. Remove --enable-cds.])</span>
<span class="udiff-line-removed">-       fi</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   AC_MSG_CHECKING([if cds should be enabled])</span>
<span class="udiff-line-removed">-   if test &quot;x$ENABLE_CDS&quot; = &quot;xtrue&quot;; then</span>
<span class="udiff-line-removed">-     if test &quot;x$enable_cds&quot; = &quot;xyes&quot;; then</span>
<span class="udiff-line-removed">-       AC_MSG_RESULT([yes, forced])</span>
<span class="udiff-line-removed">-     else</span>
<span class="udiff-line-removed">-       AC_MSG_RESULT([yes])</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-     NON_MINIMAL_FEATURES=&quot;$NON_MINIMAL_FEATURES cds&quot;</span>
<span class="udiff-line-removed">-   else</span>
<span class="udiff-line-removed">-     if test &quot;x$enable_cds&quot; = &quot;xno&quot;; then</span>
<span class="udiff-line-removed">-       AC_MSG_RESULT([no, forced])</span>
<span class="udiff-line-removed">-     else</span>
<span class="udiff-line-removed">-       AC_MSG_RESULT([no])</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   # Enable features depending on variant.</span>
<span class="udiff-line-removed">-   JVM_FEATURES_server=&quot;compiler1 compiler2 $NON_MINIMAL_FEATURES $JVM_FEATURES $JVM_FEATURES_jvmci $JVM_FEATURES_aot $JVM_FEATURES_graal&quot;</span>
<span class="udiff-line-removed">-   JVM_FEATURES_client=&quot;compiler1 $NON_MINIMAL_FEATURES $JVM_FEATURES&quot;</span>
<span class="udiff-line-removed">-   JVM_FEATURES_core=&quot;$NON_MINIMAL_FEATURES $JVM_FEATURES&quot;</span>
<span class="udiff-line-removed">-   JVM_FEATURES_minimal=&quot;compiler1 minimal serialgc $JVM_FEATURES $JVM_FEATURES_link_time_opt&quot;</span>
<span class="udiff-line-removed">-   JVM_FEATURES_zero=&quot;zero $NON_MINIMAL_FEATURES $JVM_FEATURES&quot;</span>
<span class="udiff-line-removed">-   JVM_FEATURES_custom=&quot;$JVM_FEATURES&quot;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   AC_SUBST(JVM_FEATURES_server)</span>
<span class="udiff-line-removed">-   AC_SUBST(JVM_FEATURES_client)</span>
<span class="udiff-line-removed">-   AC_SUBST(JVM_FEATURES_core)</span>
<span class="udiff-line-removed">-   AC_SUBST(JVM_FEATURES_minimal)</span>
<span class="udiff-line-removed">-   AC_SUBST(JVM_FEATURES_zero)</span>
<span class="udiff-line-removed">-   AC_SUBST(JVM_FEATURES_custom)</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   # Used for verification of Makefiles by check-jvm-feature</span>
<span class="udiff-line-removed">-   AC_SUBST(VALID_JVM_FEATURES)</span>
<span class="udiff-line-removed">- </span>
    # --with-cpu-port is no longer supported
<span class="udiff-line-modified-removed">-   BASIC_DEPRECATED_ARG_WITH(with-cpu-port)</span>
<span class="udiff-line-removed">- ])</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- ###############################################################################</span>
<span class="udiff-line-removed">- # Finalize JVM features once all setup is complete, including custom setup.</span>
<span class="udiff-line-removed">- #</span>
<span class="udiff-line-removed">- AC_DEFUN_ONCE([HOTSPOT_FINALIZE_JVM_FEATURES],</span>
<span class="udiff-line-removed">- [</span>
<span class="udiff-line-removed">-   for variant in $JVM_VARIANTS; do</span>
<span class="udiff-line-removed">-     AC_MSG_CHECKING([JVM features for JVM variant &#39;$variant&#39;])</span>
<span class="udiff-line-removed">-     features_var_name=JVM_FEATURES_$variant</span>
<span class="udiff-line-removed">-     JVM_FEATURES_FOR_VARIANT=${!features_var_name}</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     # Filter out user-requested disabled features</span>
<span class="udiff-line-removed">-     BASIC_GET_NON_MATCHING_VALUES(JVM_FEATURES_FOR_VARIANT, $JVM_FEATURES_FOR_VARIANT, $DISABLED_JVM_FEATURES)</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     # Keep feature lists sorted and free of duplicates</span>
<span class="udiff-line-removed">-     BASIC_SORT_LIST(JVM_FEATURES_FOR_VARIANT, $JVM_FEATURES_FOR_VARIANT)</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     # Update real feature set variable</span>
<span class="udiff-line-removed">-     eval $features_var_name=&#39;&quot;&#39;$JVM_FEATURES_FOR_VARIANT&#39;&quot;&#39;</span>
<span class="udiff-line-removed">-     AC_MSG_RESULT([&quot;$JVM_FEATURES_FOR_VARIANT&quot;])</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     # Verify that we have at least one gc selected</span>
<span class="udiff-line-removed">-     GC_FEATURES=`$ECHO $JVM_FEATURES_FOR_VARIANT | $GREP gc`</span>
<span class="udiff-line-removed">-     if test &quot;x$GC_FEATURES&quot; = x; then</span>
<span class="udiff-line-removed">-       AC_MSG_WARN([Invalid JVM features: No gc selected for variant $variant.])</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     # Validate features (for configure script errors, not user errors)</span>
<span class="udiff-line-removed">-     BASIC_GET_NON_MATCHING_VALUES(INVALID_FEATURES, $JVM_FEATURES_FOR_VARIANT, $VALID_JVM_FEATURES)</span>
<span class="udiff-line-removed">-     if test &quot;x$INVALID_FEATURES&quot; != x; then</span>
<span class="udiff-line-removed">-       AC_MSG_ERROR([Internal configure script error. Invalid JVM feature(s): $INVALID_FEATURES])</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-   done</span>
<span class="udiff-line-removed">- ])</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- ################################################################################</span>
<span class="udiff-line-removed">- # Check if gtest should be built</span>
<span class="udiff-line-removed">- #</span>
<span class="udiff-line-removed">- AC_DEFUN_ONCE([HOTSPOT_ENABLE_DISABLE_GTEST],</span>
<span class="udiff-line-removed">- [</span>
<span class="udiff-line-removed">-   AC_ARG_ENABLE([hotspot-gtest], [AS_HELP_STRING([--disable-hotspot-gtest],</span>
<span class="udiff-line-removed">-       [Disables building of the Hotspot unit tests @&lt;:@enabled@:&gt;@])])</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   if test -e &quot;${TOPDIR}/test/hotspot/gtest&quot;; then</span>
<span class="udiff-line-removed">-     GTEST_DIR_EXISTS=&quot;true&quot;</span>
<span class="udiff-line-removed">-   else</span>
<span class="udiff-line-removed">-     GTEST_DIR_EXISTS=&quot;false&quot;</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   AC_MSG_CHECKING([if Hotspot gtest unit tests should be built])</span>
<span class="udiff-line-removed">-   if test &quot;x$enable_hotspot_gtest&quot; = &quot;xyes&quot;; then</span>
<span class="udiff-line-removed">-     if test &quot;x$GTEST_DIR_EXISTS&quot; = &quot;xtrue&quot;; then</span>
<span class="udiff-line-removed">-       AC_MSG_RESULT([yes, forced])</span>
<span class="udiff-line-removed">-       BUILD_GTEST=&quot;true&quot;</span>
<span class="udiff-line-removed">-     else</span>
<span class="udiff-line-removed">-       AC_MSG_ERROR([Cannot build gtest without the test source])</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-   elif test &quot;x$enable_hotspot_gtest&quot; = &quot;xno&quot;; then</span>
<span class="udiff-line-removed">-     AC_MSG_RESULT([no, forced])</span>
<span class="udiff-line-removed">-     BUILD_GTEST=&quot;false&quot;</span>
<span class="udiff-line-removed">-   elif test &quot;x$enable_hotspot_gtest&quot; = &quot;x&quot;; then</span>
<span class="udiff-line-removed">-     if test &quot;x$GTEST_DIR_EXISTS&quot; = &quot;xtrue&quot;; then</span>
<span class="udiff-line-removed">-       AC_MSG_RESULT([yes])</span>
<span class="udiff-line-removed">-       BUILD_GTEST=&quot;true&quot;</span>
<span class="udiff-line-removed">-     else</span>
<span class="udiff-line-removed">-       AC_MSG_RESULT([no])</span>
<span class="udiff-line-removed">-       BUILD_GTEST=&quot;false&quot;</span>
<span class="udiff-line-removed">-     fi</span>
<span class="udiff-line-removed">-   else</span>
<span class="udiff-line-removed">-     AC_MSG_ERROR([--enable-gtest must be either yes or no])</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   AC_SUBST(BUILD_GTEST)</span>
<span class="udiff-line-modified-added">+   UTIL_DEPRECATED_ARG_WITH(with-cpu-port)</span>
  ])
</pre>
<center><a href="help.m4.udiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="jdk-options.m4.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>