<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/hotspot.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="help.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="jdk-options.m4.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/hotspot.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
<span class="line-removed"> 26 # All valid JVM features, regardless of platform</span>
<span class="line-removed"> 27 VALID_JVM_FEATURES=&quot;compiler1 compiler2 zero minimal dtrace jvmti jvmci \</span>
<span class="line-removed"> 28     graal vm-structs jni-check services management epsilongc g1gc parallelgc serialgc shenandoahgc zgc nmt cds \</span>
<span class="line-removed"> 29     static-build link-time-opt aot jfr&quot;</span>
<span class="line-removed"> 30 </span>
<span class="line-removed"> 31 # Deprecated JVM features (these are ignored, but with a warning)</span>
<span class="line-removed"> 32 DEPRECATED_JVM_FEATURES=&quot;trace cmsgc&quot;</span>
<span class="line-removed"> 33 </span>
 34 # All valid JVM variants
 35 VALID_JVM_VARIANTS=&quot;server client minimal core zero custom&quot;
 36 
 37 ###############################################################################
 38 # Check if the specified JVM variant should be built. To be used in shell if
 39 # constructs, like this:
 40 # if HOTSPOT_CHECK_JVM_VARIANT(server); then
 41 #
 42 # Only valid to use after HOTSPOT_SETUP_JVM_VARIANTS has setup variants.
 43 
 44 # Definition kept in one line to allow inlining in if statements.
 45 # Additional [] needed to keep m4 from mangling shell constructs.
 46 AC_DEFUN([HOTSPOT_CHECK_JVM_VARIANT],
 47 [ [ [[ &quot; $JVM_VARIANTS &quot; =~ &quot; $1 &quot; ]] ] ])
 48 
<span class="line-removed"> 49 ###############################################################################</span>
<span class="line-removed"> 50 # Check if the specified JVM feature is enabled. To be used in shell if</span>
<span class="line-removed"> 51 # constructs, like this:</span>
<span class="line-removed"> 52 # if HOTSPOT_CHECK_JVM_FEATURE(jvmti); then</span>
<span class="line-removed"> 53 #</span>
<span class="line-removed"> 54 # Only valid to use after HOTSPOT_SETUP_JVM_FEATURES has setup features.</span>
<span class="line-removed"> 55 </span>
<span class="line-removed"> 56 # Definition kept in one line to allow inlining in if statements.</span>
<span class="line-removed"> 57 # Additional [] needed to keep m4 from mangling shell constructs.</span>
<span class="line-removed"> 58 AC_DEFUN([HOTSPOT_CHECK_JVM_FEATURE],</span>
<span class="line-removed"> 59 [ [ [[ &quot; $JVM_FEATURES &quot; =~ &quot; $1 &quot; ]] ] ])</span>
<span class="line-removed"> 60 </span>
<span class="line-removed"> 61 ###############################################################################</span>
<span class="line-removed"> 62 # Check if the specified JVM feature is explicitly disabled. To be used in</span>
<span class="line-removed"> 63 # shell if constructs, like this:</span>
<span class="line-removed"> 64 # if HOTSPOT_IS_JVM_FEATURE_DISABLED(jvmci); then</span>
<span class="line-removed"> 65 #</span>
<span class="line-removed"> 66 # This function is internal to hotspot.m4, and is only used when constructing</span>
<span class="line-removed"> 67 # the valid set of enabled JVM features. Users outside of hotspot.m4 should just</span>
<span class="line-removed"> 68 # use HOTSPOT_CHECK_JVM_FEATURE to check if a feature is enabled or not.</span>
<span class="line-removed"> 69 </span>
<span class="line-removed"> 70 # Definition kept in one line to allow inlining in if statements.</span>
<span class="line-removed"> 71 # Additional [] needed to keep m4 from mangling shell constructs.</span>
<span class="line-removed"> 72 AC_DEFUN([HOTSPOT_IS_JVM_FEATURE_DISABLED],</span>
<span class="line-removed"> 73 [ [ [[ &quot; $DISABLED_JVM_FEATURES &quot; =~ &quot; $1 &quot; ]] ] ])</span>
<span class="line-removed"> 74 </span>
 75 ###############################################################################
 76 # Check which variants of the JVM that we want to build. Available variants are:
 77 #   server: normal interpreter, and a tiered C1/C2 compiler
 78 #   client: normal interpreter, and C1 (no C2 compiler)
 79 #   minimal: reduced form of client with optional features stripped out
 80 #   core: normal interpreter only, no compiler
 81 #   zero: C++ based interpreter only, no compiler
 82 #   custom: baseline JVM with no default features
 83 #
 84 AC_DEFUN_ONCE([HOTSPOT_SETUP_JVM_VARIANTS],
 85 [
 86   AC_ARG_WITH([jvm-variants], [AS_HELP_STRING([--with-jvm-variants],
<span class="line-modified"> 87       [JVM variants (separated by commas) to build (server,client,minimal,core,zero,custom) @&lt;:@server@:&gt;@])])</span>

 88 
 89   if test &quot;x$with_jvm_variants&quot; = x; then
 90     with_jvm_variants=&quot;server&quot;
 91   fi
 92   JVM_VARIANTS_OPT=&quot;$with_jvm_variants&quot;
 93 
 94   # Has the user listed more than one variant?
 95   # Additional [] needed to keep m4 from mangling shell constructs.
 96   if [ [[ &quot;$JVM_VARIANTS_OPT&quot; =~ &quot;,&quot; ]] ]; then
 97     BUILDING_MULTIPLE_JVM_VARIANTS=true
 98   else
 99     BUILDING_MULTIPLE_JVM_VARIANTS=false
100   fi
101   # Replace the commas with AND for use in the build directory name.
102   JVM_VARIANTS_WITH_AND=`$ECHO &quot;$JVM_VARIANTS_OPT&quot; | $SED -e &#39;s/,/AND/g&#39;`
103 
104   AC_MSG_CHECKING([which variants of the JVM to build])
105   # JVM_VARIANTS is a space-separated list.
106   # Also use minimal, not minimal1 (which is kept for backwards compatibility).
107   JVM_VARIANTS=`$ECHO $JVM_VARIANTS_OPT | $SED -e &#39;s/,/ /g&#39; -e &#39;s/minimal1/minimal/&#39;`
108   AC_MSG_RESULT([$JVM_VARIANTS])
109 
110   # Check that the selected variants are valid
<span class="line-modified">111   BASIC_GET_NON_MATCHING_VALUES(INVALID_VARIANTS, $JVM_VARIANTS, $VALID_JVM_VARIANTS)</span>

112   if test &quot;x$INVALID_VARIANTS&quot; != x; then
113     AC_MSG_NOTICE([Unknown variant(s) specified: &quot;$INVALID_VARIANTS&quot;])
114     AC_MSG_NOTICE([The available JVM variants are: &quot;$VALID_JVM_VARIANTS&quot;])
115     AC_MSG_ERROR([Cannot continue])
116   fi
117 
118   # All &quot;special&quot; variants share the same output directory (&quot;server&quot;)
119   VALID_MULTIPLE_JVM_VARIANTS=&quot;server client minimal&quot;
<span class="line-modified">120   BASIC_GET_NON_MATCHING_VALUES(INVALID_MULTIPLE_VARIANTS, $JVM_VARIANTS, $VALID_MULTIPLE_JVM_VARIANTS)</span>
<span class="line-modified">121   if  test &quot;x$INVALID_MULTIPLE_VARIANTS&quot; != x &amp;&amp; test &quot;x$BUILDING_MULTIPLE_JVM_VARIANTS&quot; = xtrue; then</span>
<span class="line-modified">122     AC_MSG_ERROR([You cannot build multiple variants with anything else than $VALID_MULTIPLE_JVM_VARIANTS.])</span>


123   fi
124 
125   # The &quot;main&quot; variant is the one used by other libs to link against during the
126   # build.
127   if test &quot;x$BUILDING_MULTIPLE_JVM_VARIANTS&quot; = &quot;xtrue&quot;; then
128     MAIN_VARIANT_PRIO_ORDER=&quot;server client minimal&quot;
129     for variant in $MAIN_VARIANT_PRIO_ORDER; do
130       if HOTSPOT_CHECK_JVM_VARIANT($variant); then
131         JVM_VARIANT_MAIN=&quot;$variant&quot;
132         break
133       fi
134     done
135   else
136     JVM_VARIANT_MAIN=&quot;$JVM_VARIANTS&quot;
137   fi
138 
139   AC_SUBST(JVM_VARIANTS)
140   AC_SUBST(VALID_JVM_VARIANTS)
141   AC_SUBST(JVM_VARIANT_MAIN)
<span class="line-removed">142 </span>
<span class="line-removed">143   if HOTSPOT_CHECK_JVM_VARIANT(zero); then</span>
<span class="line-removed">144     # zero behaves as a platform and rewrites these values. This is really weird. :(</span>
<span class="line-removed">145     # We are guaranteed that we do not build any other variants when building zero.</span>
<span class="line-removed">146     HOTSPOT_TARGET_CPU=zero</span>
<span class="line-removed">147     HOTSPOT_TARGET_CPU_ARCH=zero</span>
<span class="line-removed">148   fi</span>
149 ])
150 
151 ###############################################################################
<span class="line-modified">152 # Check if dtrace should be enabled and has all prerequisites present.</span>
<span class="line-removed">153 #</span>
<span class="line-removed">154 AC_DEFUN_ONCE([HOTSPOT_SETUP_DTRACE],</span>
<span class="line-removed">155 [</span>
<span class="line-removed">156   # Test for dtrace dependencies</span>
<span class="line-removed">157   AC_ARG_ENABLE([dtrace], [AS_HELP_STRING([--enable-dtrace@&lt;:@=yes/no/auto@:&gt;@],</span>
<span class="line-removed">158       [enable dtrace. Default is auto, where dtrace is enabled if all dependencies</span>
<span class="line-removed">159       are present.])])</span>
<span class="line-removed">160 </span>
<span class="line-removed">161   DTRACE_DEP_MISSING=false</span>
<span class="line-removed">162 </span>
<span class="line-removed">163   AC_MSG_CHECKING([for dtrace tool])</span>
<span class="line-removed">164   if test &quot;x$DTRACE&quot; != &quot;x&quot; &amp;&amp; test -x &quot;$DTRACE&quot;; then</span>
<span class="line-removed">165     AC_MSG_RESULT([$DTRACE])</span>
<span class="line-removed">166   else</span>
<span class="line-removed">167     AC_MSG_RESULT([not found, cannot build dtrace])</span>
<span class="line-removed">168     DTRACE_DEP_MISSING=true</span>
<span class="line-removed">169   fi</span>
<span class="line-removed">170 </span>
<span class="line-removed">171   AC_CHECK_HEADERS([sys/sdt.h], [DTRACE_HEADERS_OK=yes],[DTRACE_HEADERS_OK=no])</span>
<span class="line-removed">172   if test &quot;x$DTRACE_HEADERS_OK&quot; != &quot;xyes&quot;; then</span>
<span class="line-removed">173     DTRACE_DEP_MISSING=true</span>
<span class="line-removed">174   fi</span>
<span class="line-removed">175 </span>
<span class="line-removed">176   AC_MSG_CHECKING([if dtrace should be built])</span>
<span class="line-removed">177   if test &quot;x$enable_dtrace&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">178     if test &quot;x$DTRACE_DEP_MISSING&quot; = &quot;xtrue&quot;; then</span>
<span class="line-removed">179       AC_MSG_RESULT([no, missing dependencies])</span>
<span class="line-removed">180       HELP_MSG_MISSING_DEPENDENCY([dtrace])</span>
<span class="line-removed">181       AC_MSG_ERROR([Cannot enable dtrace with missing dependencies. See above. $HELP_MSG])</span>
<span class="line-removed">182     else</span>
<span class="line-removed">183       INCLUDE_DTRACE=true</span>
<span class="line-removed">184       AC_MSG_RESULT([yes, forced])</span>
<span class="line-removed">185     fi</span>
<span class="line-removed">186   elif test &quot;x$enable_dtrace&quot; = &quot;xno&quot;; then</span>
<span class="line-removed">187     INCLUDE_DTRACE=false</span>
<span class="line-removed">188     AC_MSG_RESULT([no, forced])</span>
<span class="line-removed">189   elif test &quot;x$enable_dtrace&quot; = &quot;xauto&quot; || test &quot;x$enable_dtrace&quot; = &quot;x&quot;; then</span>
<span class="line-removed">190     if test &quot;x$DTRACE_DEP_MISSING&quot; = &quot;xtrue&quot;; then</span>
<span class="line-removed">191       INCLUDE_DTRACE=false</span>
<span class="line-removed">192       AC_MSG_RESULT([no, missing dependencies])</span>
<span class="line-removed">193     else</span>
<span class="line-removed">194       INCLUDE_DTRACE=true</span>
<span class="line-removed">195       AC_MSG_RESULT([yes, dependencies present])</span>
<span class="line-removed">196     fi</span>
<span class="line-removed">197   else</span>
<span class="line-removed">198     AC_MSG_ERROR([Invalid value for --enable-dtrace: $enable_dtrace])</span>
<span class="line-removed">199   fi</span>
<span class="line-removed">200 ])</span>
<span class="line-removed">201 </span>
<span class="line-removed">202 ################################################################################</span>
<span class="line-removed">203 # Check if AOT should be enabled</span>
204 #
<span class="line-modified">205 AC_DEFUN_ONCE([HOTSPOT_ENABLE_DISABLE_AOT],</span>
206 [
<span class="line-modified">207   AC_ARG_ENABLE([aot], [AS_HELP_STRING([--enable-aot@&lt;:@=yes/no/auto@:&gt;@],</span>
<span class="line-removed">208       [enable ahead of time compilation feature. Default is auto, where aot is enabled if all dependencies are present.])])</span>
209 
<span class="line-modified">210   if test &quot;x$enable_aot&quot; = &quot;x&quot; || test &quot;x$enable_aot&quot; = &quot;xauto&quot;; then</span>
<span class="line-modified">211     ENABLE_AOT=&quot;true&quot;</span>
<span class="line-modified">212   elif test &quot;x$enable_aot&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">213     ENABLE_AOT=&quot;true&quot;</span>
<span class="line-removed">214   elif test &quot;x$enable_aot&quot; = &quot;xno&quot;; then</span>
<span class="line-removed">215     ENABLE_AOT=&quot;false&quot;</span>
216   else
<span class="line-modified">217     AC_MSG_ERROR([Invalid value for --enable-aot: $enable_aot])</span>

218   fi
219 
<span class="line-modified">220   if test &quot;x$ENABLE_AOT&quot; = &quot;xtrue&quot;; then</span>
<span class="line-modified">221     # Only enable AOT on X64 platforms.</span>
<span class="line-modified">222     if test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86_64&quot; || test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xaarch64&quot; ; then</span>
<span class="line-modified">223       if test -e &quot;${TOPDIR}/src/jdk.aot&quot;; then</span>
<span class="line-modified">224         if test -e &quot;${TOPDIR}/src/jdk.internal.vm.compiler&quot;; then</span>
<span class="line-modified">225           ENABLE_AOT=&quot;true&quot;</span>
<span class="line-removed">226         else</span>
<span class="line-removed">227           ENABLE_AOT=&quot;false&quot;</span>
<span class="line-removed">228           if test &quot;x$enable_aot&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">229             AC_MSG_ERROR([Cannot build AOT without src/jdk.internal.vm.compiler sources. Remove --enable-aot.])</span>
<span class="line-removed">230           fi</span>
<span class="line-removed">231         fi</span>
<span class="line-removed">232       else</span>
<span class="line-removed">233         ENABLE_AOT=&quot;false&quot;</span>
<span class="line-removed">234         if test &quot;x$enable_aot&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">235           AC_MSG_ERROR([Cannot build AOT without src/jdk.aot sources. Remove --enable-aot.])</span>
<span class="line-removed">236         fi</span>
<span class="line-removed">237       fi</span>
238     else
<span class="line-modified">239       ENABLE_AOT=&quot;false&quot;</span>
<span class="line-modified">240       if test &quot;x$enable_aot&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">241         AC_MSG_ERROR([AOT is currently only supported on x86_64 and aarch64. Remove --enable-aot.])</span>
<span class="line-removed">242       fi</span>
243     fi
244   fi
245 
<span class="line-modified">246   AC_SUBST(ENABLE_AOT)</span>
<span class="line-modified">247 ])</span>
<span class="line-modified">248 </span>
<span class="line-modified">249 ################################################################################</span>
<span class="line-modified">250 # Allow to disable CDS</span>
<span class="line-removed">251 #</span>
<span class="line-removed">252 AC_DEFUN_ONCE([HOTSPOT_ENABLE_DISABLE_CDS],</span>
<span class="line-removed">253 [</span>
<span class="line-removed">254   AC_ARG_ENABLE([cds], [AS_HELP_STRING([--enable-cds@&lt;:@=yes/no/auto@:&gt;@],</span>
<span class="line-removed">255       [enable class data sharing feature in non-minimal VM. Default is auto, where cds is enabled if supported on the platform.])])</span>
<span class="line-removed">256 </span>
<span class="line-removed">257   if test &quot;x$enable_cds&quot; = &quot;x&quot; || test &quot;x$enable_cds&quot; = &quot;xauto&quot;; then</span>
<span class="line-removed">258     ENABLE_CDS=&quot;true&quot;</span>
<span class="line-removed">259   elif test &quot;x$enable_cds&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">260     ENABLE_CDS=&quot;true&quot;</span>
<span class="line-removed">261   elif test &quot;x$enable_cds&quot; = &quot;xno&quot;; then</span>
<span class="line-removed">262     ENABLE_CDS=&quot;false&quot;</span>
<span class="line-removed">263   else</span>
<span class="line-removed">264     AC_MSG_ERROR([Invalid value for --enable-cds: $enable_cds])</span>
<span class="line-removed">265   fi</span>
<span class="line-removed">266 </span>
<span class="line-removed">267   AC_SUBST(ENABLE_CDS)</span>
268 ])
269 
270 ###############################################################################
<span class="line-modified">271 # Set up all JVM features for each JVM variant.</span>
272 #
<span class="line-modified">273 AC_DEFUN_ONCE([HOTSPOT_SETUP_JVM_FEATURES],</span>
274 [
<span class="line-modified">275   # Prettify the VALID_JVM_FEATURES string</span>
<span class="line-modified">276   BASIC_SORT_LIST(VALID_JVM_FEATURES, $VALID_JVM_FEATURES)</span>
<span class="line-modified">277 </span>
<span class="line-modified">278   # The user can in some cases supply additional jvm features. For the custom</span>
<span class="line-modified">279   # variant, this defines the entire variant.</span>
<span class="line-removed">280   AC_ARG_WITH([jvm-features], [AS_HELP_STRING([--with-jvm-features],</span>
<span class="line-removed">281       [JVM features to enable (foo) or disable (-foo), separated by comma. Use &#39;--help&#39; to show possible values @&lt;:@none@:&gt;@])])</span>
<span class="line-removed">282   if test &quot;x$with_jvm_features&quot; != x; then</span>
<span class="line-removed">283     AC_MSG_CHECKING([user specified JVM feature list])</span>
<span class="line-removed">284     USER_JVM_FEATURE_LIST=`$ECHO $with_jvm_features | $SED -e &#39;s/,/ /g&#39;`</span>
<span class="line-removed">285     AC_MSG_RESULT([$user_jvm_feature_list])</span>
<span class="line-removed">286     # These features will be added to all variant defaults</span>
<span class="line-removed">287     JVM_FEATURES=`$ECHO $USER_JVM_FEATURE_LIST | $AWK &#39;{ for (i=1; i&lt;=NF; i++) if (!match($i, /^-.*/)) printf(&quot;%s &quot;, $i) }&#39;`</span>
<span class="line-removed">288     # These features will be removed from all variant defaults</span>
<span class="line-removed">289     DISABLED_JVM_FEATURES=`$ECHO $USER_JVM_FEATURE_LIST | $AWK &#39;{ for (i=1; i&lt;=NF; i++) if (match($i, /^-.*/)) printf(&quot;%s &quot;, substr($i, 2))}&#39;`</span>
<span class="line-removed">290 </span>
<span class="line-removed">291     # Verify that the user has provided valid features</span>
<span class="line-removed">292     BASIC_GET_NON_MATCHING_VALUES(INVALID_FEATURES, $JVM_FEATURES $DISABLED_JVM_FEATURES, $VALID_JVM_FEATURES $DEPRECATED_JVM_FEATURES)</span>
<span class="line-removed">293     if test &quot;x$INVALID_FEATURES&quot; != x; then</span>
<span class="line-removed">294       AC_MSG_NOTICE([Unknown JVM features specified: &quot;$INVALID_FEATURES&quot;])</span>
<span class="line-removed">295       AC_MSG_NOTICE([The available JVM features are: &quot;$VALID_JVM_FEATURES&quot;])</span>
<span class="line-removed">296       AC_MSG_ERROR([Cannot continue])</span>
<span class="line-removed">297     fi</span>
<span class="line-removed">298 </span>
<span class="line-removed">299     # Check if the user has provided deprecated features</span>
<span class="line-removed">300     BASIC_GET_MATCHING_VALUES(DEPRECATED_FEATURES, $JVM_FEATURES $DISABLED_JVM_FEATURES, $DEPRECATED_JVM_FEATURES)</span>
<span class="line-removed">301     if test &quot;x$DEPRECATED_FEATURES&quot; != x; then</span>
<span class="line-removed">302       AC_MSG_WARN([Deprecated JVM features specified (will be ignored): &quot;$DEPRECATED_FEATURES&quot;])</span>
<span class="line-removed">303       # Filter out deprecated features</span>
<span class="line-removed">304       BASIC_GET_NON_MATCHING_VALUES(JVM_FEATURES, $JVM_FEATURES, $DEPRECATED_FEATURES)</span>
<span class="line-removed">305       BASIC_GET_NON_MATCHING_VALUES(DISABLED_JVM_FEATURES, $DISABLED_JVM_FEATURES, $DEPRECATED_FEATURES)</span>
<span class="line-removed">306     fi</span>
<span class="line-removed">307 </span>
308   fi
309 
310   # Override hotspot cpu definitions for ARM platforms
311   if test &quot;x$OPENJDK_TARGET_CPU&quot; = xarm; then
312     HOTSPOT_TARGET_CPU=arm_32
313     HOTSPOT_TARGET_CPU_DEFINE=&quot;ARM32&quot;
314   fi
315 
<span class="line-removed">316   # Verify that dependencies are met for explicitly set features.</span>
<span class="line-removed">317   if HOTSPOT_CHECK_JVM_FEATURE(jvmti) &amp;&amp; ! HOTSPOT_CHECK_JVM_FEATURE(services); then</span>
<span class="line-removed">318     AC_MSG_ERROR([Specified JVM feature &#39;jvmti&#39; requires feature &#39;services&#39;])</span>
<span class="line-removed">319   fi</span>
<span class="line-removed">320 </span>
<span class="line-removed">321   if HOTSPOT_CHECK_JVM_FEATURE(management) &amp;&amp; ! HOTSPOT_CHECK_JVM_FEATURE(nmt); then</span>
<span class="line-removed">322     AC_MSG_ERROR([Specified JVM feature &#39;management&#39; requires feature &#39;nmt&#39;])</span>
<span class="line-removed">323   fi</span>
<span class="line-removed">324 </span>
<span class="line-removed">325   if HOTSPOT_CHECK_JVM_FEATURE(jvmci) &amp;&amp; ! (HOTSPOT_CHECK_JVM_FEATURE(compiler1) || HOTSPOT_CHECK_JVM_FEATURE(compiler2)); then</span>
<span class="line-removed">326     AC_MSG_ERROR([Specified JVM feature &#39;jvmci&#39; requires feature &#39;compiler2&#39; or &#39;compiler1&#39;])</span>
<span class="line-removed">327   fi</span>
<span class="line-removed">328 </span>
<span class="line-removed">329   # Enable JFR by default, except for Zero, linux-sparcv9 and on minimal.</span>
<span class="line-removed">330   if ! HOTSPOT_CHECK_JVM_VARIANT(zero); then</span>
<span class="line-removed">331     if test &quot;x$OPENJDK_TARGET_OS&quot; != xaix; then</span>
<span class="line-removed">332       if test &quot;x$OPENJDK_TARGET_OS&quot; != xlinux || test &quot;x$OPENJDK_TARGET_CPU&quot; != xsparcv9; then</span>
<span class="line-removed">333         NON_MINIMAL_FEATURES=&quot;$NON_MINIMAL_FEATURES jfr&quot;</span>
<span class="line-removed">334       fi</span>
<span class="line-removed">335     fi</span>
<span class="line-removed">336   fi</span>
<span class="line-removed">337 </span>
<span class="line-removed">338   # Only enable Shenandoah on supported arches</span>
<span class="line-removed">339   AC_MSG_CHECKING([if shenandoah can be built])</span>
<span class="line-removed">340   if test &quot;x$OPENJDK_TARGET_CPU_ARCH&quot; = &quot;xx86&quot; || test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xaarch64&quot; ; then</span>
<span class="line-removed">341     AC_MSG_RESULT([yes])</span>
<span class="line-removed">342   else</span>
<span class="line-removed">343     DISABLED_JVM_FEATURES=&quot;$DISABLED_JVM_FEATURES shenandoahgc&quot;</span>
<span class="line-removed">344     AC_MSG_RESULT([no, platform not supported])</span>
<span class="line-removed">345   fi</span>
<span class="line-removed">346 </span>
<span class="line-removed">347   # Only enable ZGC on supported platforms</span>
<span class="line-removed">348   if (test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xwindows&quot; &amp;&amp; test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86_64&quot;); then</span>
<span class="line-removed">349     AC_MSG_CHECKING([if zgc can be built on windows])</span>
<span class="line-removed">350     AC_COMPILE_IFELSE(</span>
<span class="line-removed">351       [AC_LANG_PROGRAM([[#include &lt;windows.h&gt;]],</span>
<span class="line-removed">352         [[struct MEM_EXTENDED_PARAMETER x;]])</span>
<span class="line-removed">353       ],</span>
<span class="line-removed">354       [</span>
<span class="line-removed">355         AC_MSG_RESULT([yes])</span>
<span class="line-removed">356         CAN_BUILD_ZGC_ON_WINDOWS=&quot;yes&quot;</span>
<span class="line-removed">357       ],</span>
<span class="line-removed">358       [</span>
<span class="line-removed">359         AC_MSG_RESULT([no, missing required APIs])</span>
<span class="line-removed">360         CAN_BUILD_ZGC_ON_WINDOWS=&quot;no&quot;</span>
<span class="line-removed">361       ]</span>
<span class="line-removed">362     )</span>
<span class="line-removed">363   fi</span>
<span class="line-removed">364 </span>
<span class="line-removed">365   AC_MSG_CHECKING([if zgc can be built])</span>
<span class="line-removed">366   if (test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xlinux&quot; &amp;&amp; test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86_64&quot;) || \</span>
<span class="line-removed">367      (test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xlinux&quot; &amp;&amp; test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xaarch64&quot;) || \</span>
<span class="line-removed">368      (test &quot;x$CAN_BUILD_ZGC_ON_WINDOWS&quot; = &quot;xyes&quot;) || \</span>
<span class="line-removed">369      (test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xmacosx&quot; &amp;&amp; test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86_64&quot;); then</span>
<span class="line-removed">370     AC_MSG_RESULT([yes])</span>
<span class="line-removed">371   else</span>
<span class="line-removed">372     DISABLED_JVM_FEATURES=&quot;$DISABLED_JVM_FEATURES zgc&quot;</span>
<span class="line-removed">373     AC_MSG_RESULT([no, platform not supported])</span>
<span class="line-removed">374   fi</span>
<span class="line-removed">375 </span>
<span class="line-removed">376   # Disable unsupported GCs for Zero</span>
<span class="line-removed">377   if HOTSPOT_CHECK_JVM_VARIANT(zero); then</span>
<span class="line-removed">378     DISABLED_JVM_FEATURES=&quot;$DISABLED_JVM_FEATURES epsilongc g1gc zgc shenandoahgc&quot;</span>
<span class="line-removed">379   fi</span>
<span class="line-removed">380 </span>
<span class="line-removed">381   # Turn on additional features based on other parts of configure</span>
<span class="line-removed">382   if test &quot;x$INCLUDE_DTRACE&quot; = &quot;xtrue&quot;; then</span>
<span class="line-removed">383     JVM_FEATURES=&quot;$JVM_FEATURES dtrace&quot;</span>
<span class="line-removed">384   else</span>
<span class="line-removed">385     if HOTSPOT_CHECK_JVM_FEATURE(dtrace); then</span>
<span class="line-removed">386       AC_MSG_ERROR([To enable dtrace, you must use --enable-dtrace])</span>
<span class="line-removed">387     fi</span>
<span class="line-removed">388   fi</span>
<span class="line-removed">389 </span>
<span class="line-removed">390   if test &quot;x$STATIC_BUILD&quot; = &quot;xtrue&quot;; then</span>
<span class="line-removed">391     JVM_FEATURES=&quot;$JVM_FEATURES static-build&quot;</span>
<span class="line-removed">392   else</span>
<span class="line-removed">393     if HOTSPOT_CHECK_JVM_FEATURE(static-build); then</span>
<span class="line-removed">394       AC_MSG_ERROR([To enable static-build, you must use --enable-static-build])</span>
<span class="line-removed">395     fi</span>
<span class="line-removed">396   fi</span>
<span class="line-removed">397 </span>
<span class="line-removed">398   if ! HOTSPOT_CHECK_JVM_VARIANT(zero); then</span>
<span class="line-removed">399     if HOTSPOT_CHECK_JVM_FEATURE(zero); then</span>
<span class="line-removed">400       AC_MSG_ERROR([To enable zero, you must use --with-jvm-variants=zero])</span>
<span class="line-removed">401     fi</span>
<span class="line-removed">402   fi</span>
<span class="line-removed">403 </span>
<span class="line-removed">404   AC_MSG_CHECKING([if jvmci module jdk.internal.vm.ci should be built])</span>
<span class="line-removed">405   # Check if jvmci is diabled</span>
<span class="line-removed">406   if HOTSPOT_IS_JVM_FEATURE_DISABLED(jvmci); then</span>
<span class="line-removed">407     AC_MSG_RESULT([no, forced])</span>
<span class="line-removed">408     JVM_FEATURES_jvmci=&quot;&quot;</span>
<span class="line-removed">409     INCLUDE_JVMCI=&quot;false&quot;</span>
<span class="line-removed">410   else</span>
<span class="line-removed">411     # Only enable jvmci on x86_64 and aarch64</span>
<span class="line-removed">412     if test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86_64&quot; || \</span>
<span class="line-removed">413        test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xaarch64&quot; ; then</span>
<span class="line-removed">414       AC_MSG_RESULT([yes])</span>
<span class="line-removed">415       JVM_FEATURES_jvmci=&quot;jvmci&quot;</span>
<span class="line-removed">416       INCLUDE_JVMCI=&quot;true&quot;</span>
<span class="line-removed">417     else</span>
<span class="line-removed">418       AC_MSG_RESULT([no])</span>
<span class="line-removed">419       JVM_FEATURES_jvmci=&quot;&quot;</span>
<span class="line-removed">420       INCLUDE_JVMCI=&quot;false&quot;</span>
<span class="line-removed">421       if HOTSPOT_CHECK_JVM_FEATURE(jvmci); then</span>
<span class="line-removed">422         AC_MSG_ERROR([JVMCI is currently not supported on this platform.])</span>
<span class="line-removed">423       fi</span>
<span class="line-removed">424     fi</span>
<span class="line-removed">425   fi</span>
<span class="line-removed">426 </span>
<span class="line-removed">427   AC_SUBST(INCLUDE_JVMCI)</span>
<span class="line-removed">428 </span>
<span class="line-removed">429   AC_MSG_CHECKING([if graal module jdk.internal.vm.compiler should be built])</span>
<span class="line-removed">430   # Check if graal is diabled</span>
<span class="line-removed">431   if HOTSPOT_IS_JVM_FEATURE_DISABLED(graal); then</span>
<span class="line-removed">432     AC_MSG_RESULT([no, forced])</span>
<span class="line-removed">433     JVM_FEATURES_graal=&quot;&quot;</span>
<span class="line-removed">434     INCLUDE_GRAAL=&quot;false&quot;</span>
<span class="line-removed">435   else</span>
<span class="line-removed">436     if HOTSPOT_CHECK_JVM_FEATURE(graal); then</span>
<span class="line-removed">437       AC_MSG_RESULT([yes, forced])</span>
<span class="line-removed">438       if test &quot;x$JVM_FEATURES_jvmci&quot; != &quot;xjvmci&quot; ; then</span>
<span class="line-removed">439         AC_MSG_ERROR([Specified JVM feature &#39;graal&#39; requires feature &#39;jvmci&#39;])</span>
<span class="line-removed">440       fi</span>
<span class="line-removed">441       JVM_FEATURES_graal=&quot;graal&quot;</span>
<span class="line-removed">442       INCLUDE_GRAAL=&quot;true&quot;</span>
<span class="line-removed">443     else</span>
<span class="line-removed">444       # By default enable graal build on x64 or where AOT is available.</span>
<span class="line-removed">445       # graal build requires jvmci.</span>
<span class="line-removed">446       if test &quot;x$JVM_FEATURES_jvmci&quot; = &quot;xjvmci&quot; &amp;&amp; \</span>
<span class="line-removed">447           (test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86_64&quot; || \</span>
<span class="line-removed">448            test &quot;x$ENABLE_AOT&quot; = &quot;xtrue&quot;) ; then</span>
<span class="line-removed">449         AC_MSG_RESULT([yes])</span>
<span class="line-removed">450         JVM_FEATURES_graal=&quot;graal&quot;</span>
<span class="line-removed">451         INCLUDE_GRAAL=&quot;true&quot;</span>
<span class="line-removed">452       else</span>
<span class="line-removed">453         AC_MSG_RESULT([no])</span>
<span class="line-removed">454         JVM_FEATURES_graal=&quot;&quot;</span>
<span class="line-removed">455         INCLUDE_GRAAL=&quot;false&quot;</span>
<span class="line-removed">456       fi</span>
<span class="line-removed">457     fi</span>
<span class="line-removed">458   fi</span>
<span class="line-removed">459 </span>
<span class="line-removed">460   AC_SUBST(INCLUDE_GRAAL)</span>
<span class="line-removed">461 </span>
<span class="line-removed">462   # Disable aot with &#39;--with-jvm-features=-aot&#39;</span>
<span class="line-removed">463   if HOTSPOT_IS_JVM_FEATURE_DISABLED(aot); then</span>
<span class="line-removed">464     ENABLE_AOT=&quot;false&quot;</span>
<span class="line-removed">465   fi</span>
<span class="line-removed">466 </span>
<span class="line-removed">467   AC_MSG_CHECKING([if aot should be enabled])</span>
<span class="line-removed">468   if test &quot;x$ENABLE_AOT&quot; = &quot;xtrue&quot;; then</span>
<span class="line-removed">469     if test &quot;x$JVM_FEATURES_graal&quot; != &quot;xgraal&quot;; then</span>
<span class="line-removed">470       if test &quot;x$enable_aot&quot; = &quot;xyes&quot; || HOTSPOT_CHECK_JVM_FEATURE(aot); then</span>
<span class="line-removed">471         AC_MSG_RESULT([yes, forced])</span>
<span class="line-removed">472         AC_MSG_ERROR([Specified JVM feature &#39;aot&#39; requires feature &#39;graal&#39;])</span>
<span class="line-removed">473       else</span>
<span class="line-removed">474         AC_MSG_RESULT([no])</span>
<span class="line-removed">475       fi</span>
<span class="line-removed">476       JVM_FEATURES_aot=&quot;&quot;</span>
<span class="line-removed">477       ENABLE_AOT=&quot;false&quot;</span>
<span class="line-removed">478     else</span>
<span class="line-removed">479       if test &quot;x$enable_aot&quot; = &quot;xyes&quot; || HOTSPOT_CHECK_JVM_FEATURE(aot); then</span>
<span class="line-removed">480         AC_MSG_RESULT([yes, forced])</span>
<span class="line-removed">481       else</span>
<span class="line-removed">482         AC_MSG_RESULT([yes])</span>
<span class="line-removed">483       fi</span>
<span class="line-removed">484       JVM_FEATURES_aot=&quot;aot&quot;</span>
<span class="line-removed">485     fi</span>
<span class="line-removed">486   else</span>
<span class="line-removed">487     if test &quot;x$enable_aot&quot; = &quot;xno&quot; || HOTSPOT_IS_JVM_FEATURE_DISABLED(aot); then</span>
<span class="line-removed">488       AC_MSG_RESULT([no, forced])</span>
<span class="line-removed">489     else</span>
<span class="line-removed">490       AC_MSG_RESULT([no])</span>
<span class="line-removed">491     fi</span>
<span class="line-removed">492     JVM_FEATURES_aot=&quot;&quot;</span>
<span class="line-removed">493     if HOTSPOT_CHECK_JVM_FEATURE(aot); then</span>
<span class="line-removed">494       AC_MSG_ERROR([To enable aot, you must use --enable-aot])</span>
<span class="line-removed">495     fi</span>
<span class="line-removed">496   fi</span>
<span class="line-removed">497 </span>
<span class="line-removed">498   AC_SUBST(ENABLE_AOT)</span>
<span class="line-removed">499 </span>
<span class="line-removed">500   if test &quot;x$OPENJDK_TARGET_CPU&quot; = xarm ; then</span>
<span class="line-removed">501     # Default to use link time optimizations on minimal on arm</span>
<span class="line-removed">502     JVM_FEATURES_link_time_opt=&quot;link-time-opt&quot;</span>
<span class="line-removed">503   else</span>
<span class="line-removed">504     JVM_FEATURES_link_time_opt=&quot;&quot;</span>
<span class="line-removed">505   fi</span>
<span class="line-removed">506 </span>
<span class="line-removed">507   # All variants but minimal (and custom) get these features</span>
<span class="line-removed">508   NON_MINIMAL_FEATURES=&quot;$NON_MINIMAL_FEATURES g1gc parallelgc serialgc epsilongc shenandoahgc jni-check jvmti management nmt services vm-structs zgc&quot;</span>
<span class="line-removed">509 </span>
<span class="line-removed">510   # Disable CDS on AIX.</span>
<span class="line-removed">511   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xaix&quot;; then</span>
<span class="line-removed">512     ENABLE_CDS=&quot;false&quot;</span>
<span class="line-removed">513     if test &quot;x$enable_cds&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">514       AC_MSG_ERROR([CDS is currently not supported on AIX. Remove --enable-cds.])</span>
<span class="line-removed">515     fi</span>
<span class="line-removed">516   fi</span>
<span class="line-removed">517 </span>
<span class="line-removed">518   # Disable CDS if user requested it with --with-jvm-features=-cds.</span>
<span class="line-removed">519   if HOTSPOT_IS_JVM_FEATURE_DISABLED(cds); then</span>
<span class="line-removed">520     ENABLE_CDS=&quot;false&quot;</span>
<span class="line-removed">521     if test &quot;x$enable_cds&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">522       AC_MSG_ERROR([CDS was disabled by --with-jvm-features=-cds. Remove --enable-cds.])</span>
<span class="line-removed">523     fi</span>
<span class="line-removed">524   fi</span>
<span class="line-removed">525 </span>
<span class="line-removed">526   if ! HOTSPOT_CHECK_JVM_VARIANT(server) &amp;&amp; ! HOTSPOT_CHECK_JVM_VARIANT(client); then</span>
<span class="line-removed">527     # ..except when the user explicitely requested it with --enable-jvm-features</span>
<span class="line-removed">528     if ! HOTSPOT_CHECK_JVM_FEATURE(cds); then</span>
<span class="line-removed">529       ENABLE_CDS=&quot;false&quot;</span>
<span class="line-removed">530       if test &quot;x$enable_cds&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">531         AC_MSG_ERROR([CDS not implemented for variants zero, minimal, core. Remove --enable-cds.])</span>
<span class="line-removed">532       fi</span>
<span class="line-removed">533     fi</span>
<span class="line-removed">534   fi</span>
<span class="line-removed">535 </span>
<span class="line-removed">536   AC_MSG_CHECKING([if cds should be enabled])</span>
<span class="line-removed">537   if test &quot;x$ENABLE_CDS&quot; = &quot;xtrue&quot;; then</span>
<span class="line-removed">538     if test &quot;x$enable_cds&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">539       AC_MSG_RESULT([yes, forced])</span>
<span class="line-removed">540     else</span>
<span class="line-removed">541       AC_MSG_RESULT([yes])</span>
<span class="line-removed">542     fi</span>
<span class="line-removed">543     NON_MINIMAL_FEATURES=&quot;$NON_MINIMAL_FEATURES cds&quot;</span>
<span class="line-removed">544   else</span>
<span class="line-removed">545     if test &quot;x$enable_cds&quot; = &quot;xno&quot;; then</span>
<span class="line-removed">546       AC_MSG_RESULT([no, forced])</span>
<span class="line-removed">547     else</span>
<span class="line-removed">548       AC_MSG_RESULT([no])</span>
<span class="line-removed">549     fi</span>
<span class="line-removed">550   fi</span>
<span class="line-removed">551 </span>
<span class="line-removed">552   # Enable features depending on variant.</span>
<span class="line-removed">553   JVM_FEATURES_server=&quot;compiler1 compiler2 $NON_MINIMAL_FEATURES $JVM_FEATURES $JVM_FEATURES_jvmci $JVM_FEATURES_aot $JVM_FEATURES_graal&quot;</span>
<span class="line-removed">554   JVM_FEATURES_client=&quot;compiler1 $NON_MINIMAL_FEATURES $JVM_FEATURES&quot;</span>
<span class="line-removed">555   JVM_FEATURES_core=&quot;$NON_MINIMAL_FEATURES $JVM_FEATURES&quot;</span>
<span class="line-removed">556   JVM_FEATURES_minimal=&quot;compiler1 minimal serialgc $JVM_FEATURES $JVM_FEATURES_link_time_opt&quot;</span>
<span class="line-removed">557   JVM_FEATURES_zero=&quot;zero $NON_MINIMAL_FEATURES $JVM_FEATURES&quot;</span>
<span class="line-removed">558   JVM_FEATURES_custom=&quot;$JVM_FEATURES&quot;</span>
<span class="line-removed">559 </span>
<span class="line-removed">560   AC_SUBST(JVM_FEATURES_server)</span>
<span class="line-removed">561   AC_SUBST(JVM_FEATURES_client)</span>
<span class="line-removed">562   AC_SUBST(JVM_FEATURES_core)</span>
<span class="line-removed">563   AC_SUBST(JVM_FEATURES_minimal)</span>
<span class="line-removed">564   AC_SUBST(JVM_FEATURES_zero)</span>
<span class="line-removed">565   AC_SUBST(JVM_FEATURES_custom)</span>
<span class="line-removed">566 </span>
<span class="line-removed">567   # Used for verification of Makefiles by check-jvm-feature</span>
<span class="line-removed">568   AC_SUBST(VALID_JVM_FEATURES)</span>
<span class="line-removed">569 </span>
570   # --with-cpu-port is no longer supported
<span class="line-modified">571   BASIC_DEPRECATED_ARG_WITH(with-cpu-port)</span>
<span class="line-removed">572 ])</span>
<span class="line-removed">573 </span>
<span class="line-removed">574 ###############################################################################</span>
<span class="line-removed">575 # Finalize JVM features once all setup is complete, including custom setup.</span>
<span class="line-removed">576 #</span>
<span class="line-removed">577 AC_DEFUN_ONCE([HOTSPOT_FINALIZE_JVM_FEATURES],</span>
<span class="line-removed">578 [</span>
<span class="line-removed">579   for variant in $JVM_VARIANTS; do</span>
<span class="line-removed">580     AC_MSG_CHECKING([JVM features for JVM variant &#39;$variant&#39;])</span>
<span class="line-removed">581     features_var_name=JVM_FEATURES_$variant</span>
<span class="line-removed">582     JVM_FEATURES_FOR_VARIANT=${!features_var_name}</span>
<span class="line-removed">583 </span>
<span class="line-removed">584     # Filter out user-requested disabled features</span>
<span class="line-removed">585     BASIC_GET_NON_MATCHING_VALUES(JVM_FEATURES_FOR_VARIANT, $JVM_FEATURES_FOR_VARIANT, $DISABLED_JVM_FEATURES)</span>
<span class="line-removed">586 </span>
<span class="line-removed">587     # Keep feature lists sorted and free of duplicates</span>
<span class="line-removed">588     BASIC_SORT_LIST(JVM_FEATURES_FOR_VARIANT, $JVM_FEATURES_FOR_VARIANT)</span>
<span class="line-removed">589 </span>
<span class="line-removed">590     # Update real feature set variable</span>
<span class="line-removed">591     eval $features_var_name=&#39;&quot;&#39;$JVM_FEATURES_FOR_VARIANT&#39;&quot;&#39;</span>
<span class="line-removed">592     AC_MSG_RESULT([&quot;$JVM_FEATURES_FOR_VARIANT&quot;])</span>
<span class="line-removed">593 </span>
<span class="line-removed">594     # Verify that we have at least one gc selected</span>
<span class="line-removed">595     GC_FEATURES=`$ECHO $JVM_FEATURES_FOR_VARIANT | $GREP gc`</span>
<span class="line-removed">596     if test &quot;x$GC_FEATURES&quot; = x; then</span>
<span class="line-removed">597       AC_MSG_WARN([Invalid JVM features: No gc selected for variant $variant.])</span>
<span class="line-removed">598     fi</span>
<span class="line-removed">599 </span>
<span class="line-removed">600     # Validate features (for configure script errors, not user errors)</span>
<span class="line-removed">601     BASIC_GET_NON_MATCHING_VALUES(INVALID_FEATURES, $JVM_FEATURES_FOR_VARIANT, $VALID_JVM_FEATURES)</span>
<span class="line-removed">602     if test &quot;x$INVALID_FEATURES&quot; != x; then</span>
<span class="line-removed">603       AC_MSG_ERROR([Internal configure script error. Invalid JVM feature(s): $INVALID_FEATURES])</span>
<span class="line-removed">604     fi</span>
<span class="line-removed">605   done</span>
<span class="line-removed">606 ])</span>
<span class="line-removed">607 </span>
<span class="line-removed">608 ################################################################################</span>
<span class="line-removed">609 # Check if gtest should be built</span>
<span class="line-removed">610 #</span>
<span class="line-removed">611 AC_DEFUN_ONCE([HOTSPOT_ENABLE_DISABLE_GTEST],</span>
<span class="line-removed">612 [</span>
<span class="line-removed">613   AC_ARG_ENABLE([hotspot-gtest], [AS_HELP_STRING([--disable-hotspot-gtest],</span>
<span class="line-removed">614       [Disables building of the Hotspot unit tests @&lt;:@enabled@:&gt;@])])</span>
<span class="line-removed">615 </span>
<span class="line-removed">616   if test -e &quot;${TOPDIR}/test/hotspot/gtest&quot;; then</span>
<span class="line-removed">617     GTEST_DIR_EXISTS=&quot;true&quot;</span>
<span class="line-removed">618   else</span>
<span class="line-removed">619     GTEST_DIR_EXISTS=&quot;false&quot;</span>
<span class="line-removed">620   fi</span>
<span class="line-removed">621 </span>
<span class="line-removed">622   AC_MSG_CHECKING([if Hotspot gtest unit tests should be built])</span>
<span class="line-removed">623   if test &quot;x$enable_hotspot_gtest&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">624     if test &quot;x$GTEST_DIR_EXISTS&quot; = &quot;xtrue&quot;; then</span>
<span class="line-removed">625       AC_MSG_RESULT([yes, forced])</span>
<span class="line-removed">626       BUILD_GTEST=&quot;true&quot;</span>
<span class="line-removed">627     else</span>
<span class="line-removed">628       AC_MSG_ERROR([Cannot build gtest without the test source])</span>
<span class="line-removed">629     fi</span>
<span class="line-removed">630   elif test &quot;x$enable_hotspot_gtest&quot; = &quot;xno&quot;; then</span>
<span class="line-removed">631     AC_MSG_RESULT([no, forced])</span>
<span class="line-removed">632     BUILD_GTEST=&quot;false&quot;</span>
<span class="line-removed">633   elif test &quot;x$enable_hotspot_gtest&quot; = &quot;x&quot;; then</span>
<span class="line-removed">634     if test &quot;x$GTEST_DIR_EXISTS&quot; = &quot;xtrue&quot;; then</span>
<span class="line-removed">635       AC_MSG_RESULT([yes])</span>
<span class="line-removed">636       BUILD_GTEST=&quot;true&quot;</span>
<span class="line-removed">637     else</span>
<span class="line-removed">638       AC_MSG_RESULT([no])</span>
<span class="line-removed">639       BUILD_GTEST=&quot;false&quot;</span>
<span class="line-removed">640     fi</span>
<span class="line-removed">641   else</span>
<span class="line-removed">642     AC_MSG_ERROR([--enable-gtest must be either yes or no])</span>
<span class="line-removed">643   fi</span>
<span class="line-removed">644 </span>
<span class="line-removed">645   AC_SUBST(BUILD_GTEST)</span>
646 ])
</pre>
</td>
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 








 26 # All valid JVM variants
 27 VALID_JVM_VARIANTS=&quot;server client minimal core zero custom&quot;
 28 
 29 ###############################################################################
 30 # Check if the specified JVM variant should be built. To be used in shell if
 31 # constructs, like this:
 32 # if HOTSPOT_CHECK_JVM_VARIANT(server); then
 33 #
 34 # Only valid to use after HOTSPOT_SETUP_JVM_VARIANTS has setup variants.
 35 
 36 # Definition kept in one line to allow inlining in if statements.
 37 # Additional [] needed to keep m4 from mangling shell constructs.
 38 AC_DEFUN([HOTSPOT_CHECK_JVM_VARIANT],
 39 [ [ [[ &quot; $JVM_VARIANTS &quot; =~ &quot; $1 &quot; ]] ] ])
 40 


























 41 ###############################################################################
 42 # Check which variants of the JVM that we want to build. Available variants are:
 43 #   server: normal interpreter, and a tiered C1/C2 compiler
 44 #   client: normal interpreter, and C1 (no C2 compiler)
 45 #   minimal: reduced form of client with optional features stripped out
 46 #   core: normal interpreter only, no compiler
 47 #   zero: C++ based interpreter only, no compiler
 48 #   custom: baseline JVM with no default features
 49 #
 50 AC_DEFUN_ONCE([HOTSPOT_SETUP_JVM_VARIANTS],
 51 [
 52   AC_ARG_WITH([jvm-variants], [AS_HELP_STRING([--with-jvm-variants],
<span class="line-modified"> 53       [JVM variants to build, separated by commas (server client minimal core</span>
<span class="line-added"> 54       zero custom) @&lt;:@server@:&gt;@])])</span>
 55 
 56   if test &quot;x$with_jvm_variants&quot; = x; then
 57     with_jvm_variants=&quot;server&quot;
 58   fi
 59   JVM_VARIANTS_OPT=&quot;$with_jvm_variants&quot;
 60 
 61   # Has the user listed more than one variant?
 62   # Additional [] needed to keep m4 from mangling shell constructs.
 63   if [ [[ &quot;$JVM_VARIANTS_OPT&quot; =~ &quot;,&quot; ]] ]; then
 64     BUILDING_MULTIPLE_JVM_VARIANTS=true
 65   else
 66     BUILDING_MULTIPLE_JVM_VARIANTS=false
 67   fi
 68   # Replace the commas with AND for use in the build directory name.
 69   JVM_VARIANTS_WITH_AND=`$ECHO &quot;$JVM_VARIANTS_OPT&quot; | $SED -e &#39;s/,/AND/g&#39;`
 70 
 71   AC_MSG_CHECKING([which variants of the JVM to build])
 72   # JVM_VARIANTS is a space-separated list.
 73   # Also use minimal, not minimal1 (which is kept for backwards compatibility).
 74   JVM_VARIANTS=`$ECHO $JVM_VARIANTS_OPT | $SED -e &#39;s/,/ /g&#39; -e &#39;s/minimal1/minimal/&#39;`
 75   AC_MSG_RESULT([$JVM_VARIANTS])
 76 
 77   # Check that the selected variants are valid
<span class="line-modified"> 78   UTIL_GET_NON_MATCHING_VALUES(INVALID_VARIANTS, $JVM_VARIANTS, \</span>
<span class="line-added"> 79       $VALID_JVM_VARIANTS)</span>
 80   if test &quot;x$INVALID_VARIANTS&quot; != x; then
 81     AC_MSG_NOTICE([Unknown variant(s) specified: &quot;$INVALID_VARIANTS&quot;])
 82     AC_MSG_NOTICE([The available JVM variants are: &quot;$VALID_JVM_VARIANTS&quot;])
 83     AC_MSG_ERROR([Cannot continue])
 84   fi
 85 
 86   # All &quot;special&quot; variants share the same output directory (&quot;server&quot;)
 87   VALID_MULTIPLE_JVM_VARIANTS=&quot;server client minimal&quot;
<span class="line-modified"> 88   UTIL_GET_NON_MATCHING_VALUES(INVALID_MULTIPLE_VARIANTS, $JVM_VARIANTS, \</span>
<span class="line-modified"> 89       $VALID_MULTIPLE_JVM_VARIANTS)</span>
<span class="line-modified"> 90   if  test &quot;x$INVALID_MULTIPLE_VARIANTS&quot; != x &amp;&amp; \</span>
<span class="line-added"> 91       test &quot;x$BUILDING_MULTIPLE_JVM_VARIANTS&quot; = xtrue; then</span>
<span class="line-added"> 92     AC_MSG_ERROR([You can only build multiple variants using these variants: &#39;$VALID_MULTIPLE_JVM_VARIANTS&#39;])</span>
 93   fi
 94 
 95   # The &quot;main&quot; variant is the one used by other libs to link against during the
 96   # build.
 97   if test &quot;x$BUILDING_MULTIPLE_JVM_VARIANTS&quot; = &quot;xtrue&quot;; then
 98     MAIN_VARIANT_PRIO_ORDER=&quot;server client minimal&quot;
 99     for variant in $MAIN_VARIANT_PRIO_ORDER; do
100       if HOTSPOT_CHECK_JVM_VARIANT($variant); then
101         JVM_VARIANT_MAIN=&quot;$variant&quot;
102         break
103       fi
104     done
105   else
106     JVM_VARIANT_MAIN=&quot;$JVM_VARIANTS&quot;
107   fi
108 
109   AC_SUBST(JVM_VARIANTS)
110   AC_SUBST(VALID_JVM_VARIANTS)
111   AC_SUBST(JVM_VARIANT_MAIN)







112 ])
113 
114 ###############################################################################
<span class="line-modified">115 # Check if gtest should be built</span>



















































116 #
<span class="line-modified">117 AC_DEFUN_ONCE([HOTSPOT_ENABLE_DISABLE_GTEST],</span>
118 [
<span class="line-modified">119   GTEST_AVAILABLE=true</span>

120 
<span class="line-modified">121   AC_MSG_CHECKING([if Hotspot gtest test source is present])</span>
<span class="line-modified">122   if test -e &quot;${TOPDIR}/test/hotspot/gtest&quot;; then</span>
<span class="line-modified">123     AC_MSG_RESULT([yes])</span>



124   else
<span class="line-modified">125     AC_MSG_RESULT([no, cannot build gtest])</span>
<span class="line-added">126     GTEST_AVAILABLE=false</span>
127   fi
128 
<span class="line-modified">129   # On solaris, we also must have the libstlport.so.1 library, setup in</span>
<span class="line-modified">130   # LIB_SETUP_LIBRARIES.</span>
<span class="line-modified">131   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xsolaris&quot;; then</span>
<span class="line-modified">132     AC_MSG_CHECKING([if the libstlport.so.1 library is present])</span>
<span class="line-modified">133     if test &quot;x$STLPORT_LIB&quot; != &quot;x&quot;; then</span>
<span class="line-modified">134       AC_MSG_RESULT([yes])</span>












135     else
<span class="line-modified">136       AC_MSG_RESULT([no, cannot build gtest])</span>
<span class="line-modified">137       GTEST_AVAILABLE=false</span>


138     fi
139   fi
140 
<span class="line-modified">141   UTIL_ARG_ENABLE(NAME: hotspot-gtest, DEFAULT: auto,</span>
<span class="line-modified">142       RESULT: BUILD_GTEST, AVAILABLE: $GTEST_AVAILABLE,</span>
<span class="line-modified">143       DEFAULT_DESC: [enabled if possible to build],</span>
<span class="line-modified">144       DESC: [enable building of the Hotspot unit tests])</span>
<span class="line-modified">145   AC_SUBST(BUILD_GTEST)</span>

















146 ])
147 
148 ###############################################################################
<span class="line-modified">149 # Misc hotspot setup that does not fit elsewhere.</span>
150 #
<span class="line-modified">151 AC_DEFUN_ONCE([HOTSPOT_SETUP_MISC],</span>
152 [
<span class="line-modified">153   if HOTSPOT_CHECK_JVM_VARIANT(zero); then</span>
<span class="line-modified">154     # zero behaves as a platform and rewrites these values. This is a bit weird.</span>
<span class="line-modified">155     # But when building zero, we never build any other variants so it works.</span>
<span class="line-modified">156     HOTSPOT_TARGET_CPU=zero</span>
<span class="line-modified">157     HOTSPOT_TARGET_CPU_ARCH=zero</span>




























158   fi
159 
160   # Override hotspot cpu definitions for ARM platforms
161   if test &quot;x$OPENJDK_TARGET_CPU&quot; = xarm; then
162     HOTSPOT_TARGET_CPU=arm_32
163     HOTSPOT_TARGET_CPU_DEFINE=&quot;ARM32&quot;
164   fi
165 






























































































































































































































































166   # --with-cpu-port is no longer supported
<span class="line-modified">167   UTIL_DEPRECATED_ARG_WITH(with-cpu-port)</span>










































































168 ])
</pre>
</td>
</tr>
</table>
<center><a href="help.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="jdk-options.m4.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>