<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/langtools/jdk/jshell/ToolSimpleTest.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2016, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 8153716 8143955 8151754 8150382 8153920 8156910 8131024 8160089 8153897 8167128 8154513 8170015 8170368 8172102 8172103  8165405 8173073 8173848 8174041 8173916 8174028 8174262 8174797 8177079 8180508 8177466 8172154 8192979 8191842 8198573 8198801 8210596 8210959 8215099 8199623 8236715
 27  * @summary Simple jshell tool tests
 28  * @modules jdk.compiler/com.sun.tools.javac.api
 29  *          jdk.compiler/com.sun.tools.javac.main
 30  *          jdk.jdeps/com.sun.tools.javap
 31  *          jdk.jshell/jdk.internal.jshell.tool
 32  * @build KullaTesting TestingInputStream
 33  * @run testng/othervm ToolSimpleTest
 34  */
 35 
 36 import java.util.ArrayList;
 37 import java.util.Arrays;
 38 import java.util.List;
 39 import java.util.Locale;
 40 import java.util.function.Consumer;
 41 import java.util.regex.Pattern;
 42 import java.util.stream.Collectors;
 43 import java.util.stream.Stream;
 44 
 45 import org.testng.annotations.Test;
 46 
 47 import static org.testng.Assert.assertEquals;
 48 import static org.testng.Assert.assertTrue;
 49 
 50 public class ToolSimpleTest extends ReplToolTesting {
 51 
 52     @Test
 53     public void testRemaining() {
 54         test(
 55                 (a) -&gt; assertCommand(a, &quot;int z; z =&quot;, &quot;z ==&gt; 0&quot;),
 56                 (a) -&gt; assertCommand(a, &quot;5&quot;, &quot;z ==&gt; 5&quot;),
 57                 (a) -&gt; assertCommand(a, &quot;/*nada*/; int q =&quot;, &quot;&quot;),
 58                 (a) -&gt; assertCommand(a, &quot;77&quot;, &quot;q ==&gt; 77&quot;),
 59                 (a) -&gt; assertCommand(a, &quot;//comment;&quot;, &quot;&quot;),
 60                 (a) -&gt; assertCommand(a, &quot;int v;&quot;, &quot;v ==&gt; 0&quot;),
 61                 (a) -&gt; assertCommand(a, &quot;int v; int c&quot;,
 62                         &quot;v ==&gt; 0\n&quot; +
 63                         &quot;c ==&gt; 0&quot;)
 64         );
 65     }
 66 
 67     @Test
 68     public void testOpenComment() {
 69         test(
 70                 (a) -&gt; assertCommand(a, &quot;int z = /* blah&quot;, &quot;&quot;),
 71                 (a) -&gt; assertCommand(a, &quot;baz */ 5&quot;, &quot;z ==&gt; 5&quot;),
 72                 (a) -&gt; assertCommand(a, &quot;/** hoge &quot;, &quot;&quot;),
 73                 (a) -&gt; assertCommand(a, &quot;baz **/&quot;, &quot;&quot;),
 74                 (a) -&gt; assertCommand(a, &quot;int v&quot;, &quot;v ==&gt; 0&quot;)
 75         );
 76     }
 77 
 78     @Test
 79     public void testSwitchExpression() {
 80         test(false, new String[]{&quot;--enable-preview&quot;, &quot;--no-startup&quot;},
 81                 (a) -&gt; assertCommand(a, &quot;enum Day {MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY }&quot;, &quot;|  created enum Day&quot;),
 82                 (a) -&gt; assertCommand(a, &quot;Day day = Day.FRIDAY;&quot;, &quot;day ==&gt; FRIDAY&quot;),
 83                 (a) -&gt; assertCommand(a, &quot;switch (day) {&quot;, &quot;&quot;),
 84                 (a) -&gt; assertCommand(a, &quot;case MONDAY, FRIDAY, SUNDAY -&gt; 6;&quot;, &quot;&quot;),
 85                 (a) -&gt; assertCommand(a, &quot;case TUESDAY -&gt; 7;&quot;, &quot;&quot;),
 86                 (a) -&gt; assertCommand(a, &quot;case THURSDAY, SATURDAY -&gt; 8;&quot;, &quot;&quot;),
 87                 (a) -&gt; assertCommand(a, &quot;case WEDNESDAY -&gt; 9;&quot;, &quot;&quot;),
 88                 (a) -&gt; assertCommandOutputContains(a, &quot;}&quot;, &quot; ==&gt; 6&quot;)
 89                 );
 90     }
 91 
 92     @Test
 93     public void testSwitchExpressionCompletion() {
 94         test(false, new String[]{&quot;--enable-preview&quot;, &quot;--no-startup&quot;},
 95                 (a) -&gt; assertCommand(a, &quot;enum Day {MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY }&quot;, &quot;|  created enum Day&quot;),
 96                 (a) -&gt; assertCommand(a, &quot;Day day = Day.FRIDAY;&quot;, &quot;day ==&gt; FRIDAY&quot;),
 97                 (a) -&gt; assertCommand(a, &quot;switch (day) {&quot;, &quot;&quot;),
 98                 (a) -&gt; assertCommand(a, &quot;case MONDAY, FRIDAY, SUNDAY -&gt; 6;&quot;, &quot;&quot;),
 99                 (a) -&gt; assertCommand(a, &quot;case TUESDAY -&gt; 7;&quot;, &quot;&quot;),
100                 (a) -&gt; assertCommand(a, &quot;case THURSDAY, SATURDAY -&gt; 8;&quot;, &quot;&quot;),
101                 (a) -&gt; assertCommand(a, &quot;case WEDNESDAY -&gt; 9;&quot;, &quot;&quot;),
102                 (a) -&gt; assertCommand(a, &quot;} +&quot;, &quot;&quot;),
103                 (a) -&gt; assertCommandOutputContains(a, &quot;1000&quot;, &quot; ==&gt; 1006&quot;)
104                 );
105     }
106 
107     @Test
108     public void testLessThan() {
109         test(
110                 (a) -&gt; assertCommand(a, &quot;45&quot;, &quot;$1 ==&gt; 45&quot;),
111                 (a) -&gt; assertCommand(a, &quot;72&quot;, &quot;$2 ==&gt; 72&quot;),
112                 (a) -&gt; assertCommand(a, &quot;$1 &lt; $2&quot;, &quot;$3 ==&gt; true&quot;),
113                 (a) -&gt; assertCommand(a, &quot;int a, b&quot;, &quot;a ==&gt; 0\n&quot; +
114                         &quot;b ==&gt; 0&quot;),
115                 (a) -&gt; assertCommand(a, &quot;a &lt; b&quot;, &quot;$6 ==&gt; false&quot;)
116         );
117     }
118 
119     @Test
120     public void testChainedThrow() {
121         test(
122                 (a) -&gt; assertCommand(a, &quot;void p() throws Exception { ((String) null).toString(); }&quot;,
123                         &quot;|  created method p()&quot;),
124                 (a) -&gt; assertCommand(a, &quot;void n() throws Exception { try { p(); } catch (Exception ex) { throw new IOException(\&quot;bar\&quot;, ex); }}&quot;,
125                         &quot;|  created method n()&quot;),
126                 (a) -&gt; assertCommand(a, &quot;void m() { try { n(); } catch (Exception ex) { throw new RuntimeException(\&quot;foo\&quot;, ex); }}&quot;,
127                         &quot;|  created method m()&quot;),
128                 (a) -&gt; assertCommand(a, &quot;m()&quot;,
129                           &quot;|  Exception java.lang.RuntimeException: foo\n&quot;
130                         + &quot;|        at m (#3:1)\n&quot;
131                         + &quot;|        at (#4:1)\n&quot;
132                         + &quot;|  Caused by: java.io.IOException: bar\n&quot;
133                         + &quot;|        at n (#2:1)\n&quot;
134                         + &quot;|        ...\n&quot;
135                         + &quot;|  Caused by: java.lang.NullPointerException\n&quot;
136                         + &quot;|        at p (#1:1)\n&quot;
137                         + &quot;|        ...&quot;),
138                 (a) -&gt; assertCommand(a, &quot;/drop p&quot;,
139                         &quot;|  dropped method p()&quot;),
140                 (a) -&gt; assertCommand(a, &quot;m()&quot;,
141                         &quot;|  attempted to call method n() which cannot be invoked until method p() is declared&quot;)
142         );
143     }
144 
145     @Test
146     public void testThrowWithPercent() {
147         test(
148                 (a) -&gt; assertCommandCheckOutput(a,
149                         &quot;URI u = new URI(\&quot;http\&quot;, null, \&quot;h\&quot;, -1, \&quot;a\&quot; + (char)0x04, null, null);&quot;, (s) -&gt;
150                                 assertTrue(s.contains(&quot;URISyntaxException&quot;) &amp;&amp; !s.contains(&quot;JShellTool&quot;),
151                                         &quot;Output: &#39;&quot; + s + &quot;&#39;&quot;)),
152                 (a) -&gt; assertCommandCheckOutput(a,
153                         &quot;throw new Exception(\&quot;%z\&quot;)&quot;, (s) -&gt;
154                                 assertTrue(s.contains(&quot;java.lang.Exception&quot;) &amp;&amp; !s.contains(&quot;UnknownFormatConversionException&quot;),
155                                         &quot;Output: &#39;&quot; + s + &quot;&#39;&quot;))
156         );
157     }
158 
159     @Test
160     public void oneLineOfError() {
161         test(
162                 (a) -&gt; assertCommand(a, &quot;12+&quot;, null),
163                 (a) -&gt; assertCommandCheckOutput(a, &quot;  true&quot;, (s) -&gt;
164                         assertTrue(s.contains(&quot;12+&quot;) &amp;&amp; !s.contains(&quot;true&quot;), &quot;Output: &#39;&quot; + s + &quot;&#39;&quot;))
165         );
166     }
167 
168     @Test
169     public void defineVariables() {
170         test(
171                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
172                 (a) -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables()),
173                 (a) -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
174                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
175                 (a) -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables()),
176                 (a) -&gt; assertVariable(a, &quot;double&quot;, &quot;a&quot;, &quot;1&quot;, &quot;1.0&quot;),
177                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
178                 (a) -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables()),
179                 (a) -&gt; evaluateExpression(a, &quot;double&quot;, &quot;2 * a&quot;, &quot;2.0&quot;),
180                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
181                 (a) -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables())
182         );
183     }
184 
185     @Test
186     public void defineMethods() {
187         test(
188                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
189                 (a) -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods()),
190                 (a) -&gt; assertMethod(a, &quot;int f() { return 0; }&quot;, &quot;()int&quot;, &quot;f&quot;),
191                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
192                 (a) -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods()),
193                 (a) -&gt; assertMethod(a, &quot;void f(int a) { g(); }&quot;, &quot;(int)void&quot;, &quot;f&quot;),
194                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
195                 (a) -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods()),
196                 (a) -&gt; assertMethod(a, &quot;void g() {}&quot;, &quot;()void&quot;, &quot;g&quot;),
197                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
198                 (a) -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods())
199         );
200     }
201 
202     @Test
203     public void defineTypes() {
204         test(
205                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
206                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
207                 (a) -&gt; assertClass(a, &quot;class A { }&quot;, &quot;class&quot;, &quot;A&quot;),
208                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
209                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
210                 (a) -&gt; assertClass(a, &quot;interface A { }&quot;, &quot;interface&quot;, &quot;A&quot;),
211                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
212                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
213                 (a) -&gt; assertClass(a, &quot;enum A { }&quot;, &quot;enum&quot;, &quot;A&quot;),
214                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
215                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
216                 (a) -&gt; assertClass(a, &quot;@interface A { }&quot;, &quot;@interface&quot;, &quot;A&quot;),
217                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
218                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses())
219         );
220     }
221 
222     @Test
223     public void defineImports() {
224         test(
225                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
226                 (a) -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports()),
227                 (a) -&gt; assertImport(a, &quot;import java.util.stream.Stream;&quot;, &quot;&quot;, &quot;java.util.stream.Stream&quot;),
228                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
229                 (a) -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports()),
230                 (a) -&gt; assertImport(a, &quot;import java.util.stream.*;&quot;, &quot;&quot;, &quot;java.util.stream.*&quot;),
231                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
232                 (a) -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports()),
233                 (a) -&gt; assertImport(a, &quot;import static java.lang.Math.PI;&quot;, &quot;static&quot;, &quot;java.lang.Math.PI&quot;),
234                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
235                 (a) -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports()),
236                 (a) -&gt; assertImport(a, &quot;import static java.lang.Math.*;&quot;, &quot;static&quot;, &quot;java.lang.Math.*&quot;),
237                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
238                 (a) -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports())
239         );
240     }
241 
242     @Test
243     public void defineVar() {
244         test(
245                 (a) -&gt; assertCommand(a, &quot;int x = 72&quot;, &quot;x ==&gt; 72&quot;),
246                 (a) -&gt; assertCommand(a, &quot;x&quot;, &quot;x ==&gt; 72&quot;),
247                 (a) -&gt; assertCommand(a, &quot;/vars&quot;, &quot;|    int x = 72&quot;)
248         );
249     }
250 
251     @Test
252     public void defineUnresolvedVar() {
253         test(
254                 (a) -&gt; assertCommand(a, &quot;undefined x&quot;,
255                         &quot;|  created variable x, however, it cannot be referenced until class undefined is declared&quot;),
256                 (a) -&gt; assertCommand(a, &quot;/vars&quot;, &quot;|    undefined x = (not-active)&quot;)
257         );
258     }
259 
260     @Test
261     public void testUnresolved() {
262         test(
263                 (a) -&gt; assertCommand(a, &quot;int f() { return g() + x + new A().a; }&quot;,
264                         &quot;|  created method f(), however, it cannot be invoked until method g(), variable x, and class A are declared&quot;),
265                 (a) -&gt; assertCommand(a, &quot;f()&quot;,
266                         &quot;|  attempted to call method f() which cannot be invoked until method g(), variable x, and class A are declared&quot;),
267                 (a) -&gt; assertCommandOutputStartsWith(a, &quot;int g() { return x; }&quot;,
268                         &quot;|  created method g(), however, it cannot be invoked until variable x is declared&quot;),
269                 (a) -&gt; assertCommand(a, &quot;g()&quot;, &quot;|  attempted to call method g() which cannot be invoked until variable x is declared&quot;)
270         );
271     }
272 
273     // 8199623
274     @Test
275     public void testTwoForkedDrop() {
276         test(
277                 (a) -&gt; assertCommand(a, &quot;void p() throws Exception { ((String) null).toString(); }&quot;,
278                         &quot;|  created method p()&quot;),
279                 (a) -&gt; assertCommand(a, &quot;void n() throws Exception { try { p(); } catch (Exception ex) { throw new IOException(\&quot;bar\&quot;, ex); }} &quot;,
280                         &quot;|  created method n()&quot;),
281                 (a) -&gt; assertCommand(a, &quot;void m() { try { n(); } catch (Exception ex) { throw new RuntimeException(\&quot;foo\&quot;, ex); }}&quot;,
282                         &quot;|  created method m()&quot;),
283                 (a) -&gt; assertCommand(a, &quot;void c() throws Throwable { p(); }&quot;,
284                         &quot;|  created method c()&quot;),
285                 (a) -&gt; assertCommand(a, &quot;/drop p&quot;,
286                         &quot;|  dropped method p()&quot;),
287                 (a) -&gt; assertCommand(a, &quot;m()&quot;,
288                         &quot;|  attempted to call method n() which cannot be invoked until method p() is declared&quot;),
289                 (a) -&gt; assertCommand(a, &quot;/meth n&quot;,
290                         &quot;|    void n()\n&quot; +
291                         &quot;|       which cannot be invoked until method p() is declared&quot;),
292                 (a) -&gt; assertCommand(a, &quot;/meth m&quot;,
293                         &quot;|    void m()&quot;),
294                 (a) -&gt; assertCommand(a, &quot;/meth c&quot;,
295                         &quot;|    void c()\n&quot; +
296                                 &quot;|       which cannot be invoked until method p() is declared&quot;)
297         );
298     }
299 
300     @Test
301     public void testUnknownCommand() {
302         test((a) -&gt; assertCommand(a, &quot;/unknown&quot;,
303                 &quot;|  Invalid command: /unknown\n&quot; +
304                 &quot;|  Type /help for help.&quot;));
305     }
306 
307     @Test
308     public void testEmptyClassPath() {
309         test(after -&gt; assertCommand(after, &quot;/env --class-path&quot;, &quot;|  Argument to class-path missing.&quot;));
310     }
311 
312     @Test
313     public void testInvalidClassPath() {
314         test(
315                 a -&gt; assertCommand(a, &quot;/env --class-path snurgefusal&quot;,
316                         &quot;|  File &#39;snurgefusal&#39; for &#39;--class-path&#39; is not found.&quot;),
317                 a -&gt; assertCommand(a, &quot;/env --class-path ?&quot;,
318                         &quot;|  File &#39;?&#39; for &#39;--class-path&#39; is not found.&quot;)
319         );
320     }
321 
322     @Test
323     public void testNoArgument() {
324         test(
325                 (a) -&gt; assertCommand(a, &quot;/save&quot;,
326                         &quot;|  &#39;/save&#39; requires a filename argument.&quot;),
327                 (a) -&gt; assertCommand(a, &quot;/open&quot;,
328                         &quot;|  &#39;/open&#39; requires a filename argument.&quot;),
329                 (a) -&gt; assertCommandOutputStartsWith(a, &quot;/drop&quot;,
330                         &quot;|  In the /drop argument, please specify an import, variable, method, or class to drop.&quot;)
331         );
332     }
333 
334     @Test
335     public void testDebug() {
336         test(
337                 (a) -&gt; assertCommand(a, &quot;/deb&quot;, &quot;|  Debugging on&quot;),
338                 (a) -&gt; assertCommand(a, &quot;/debug&quot;, &quot;|  Debugging off&quot;),
339                 (a) -&gt; assertCommand(a, &quot;/debug&quot;, &quot;|  Debugging on&quot;),
340                 (a) -&gt; assertCommand(a, &quot;/deb&quot;, &quot;|  Debugging off&quot;)
341         );
342     }
343 
344     @Test
345     public void testDrop() {
346         test(false, new String[]{&quot;--no-startup&quot;},
347                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
348                 a -&gt; dropVariable(a, &quot;/drop 1&quot;, &quot;int a = 0&quot;, &quot;|  dropped variable a&quot;),
349                 a -&gt; assertMethod(a, &quot;int b() { return 0; }&quot;, &quot;()int&quot;, &quot;b&quot;),
350                 a -&gt; dropMethod(a, &quot;/drop 2&quot;, &quot;int b()&quot;, &quot;|  dropped method b()&quot;),
351                 a -&gt; assertClass(a, &quot;class A {}&quot;, &quot;class&quot;, &quot;A&quot;),
352                 a -&gt; dropClass(a, &quot;/drop 3&quot;, &quot;class A&quot;, &quot;|  dropped class A&quot;),
353                 a -&gt; assertImport(a, &quot;import java.util.stream.*;&quot;, &quot;&quot;, &quot;java.util.stream.*&quot;),
354                 a -&gt; dropImport(a, &quot;/drop 4&quot;, &quot;import java.util.stream.*&quot;, &quot;&quot;),
355                 a -&gt; assertCommand(a, &quot;for (int i = 0; i &lt; 10; ++i) {}&quot;, &quot;&quot;),
356                 a -&gt; assertCommand(a, &quot;/drop 5&quot;, &quot;&quot;),
357                 a -&gt; assertCommand(a, &quot;/list&quot;, &quot;&quot;),
358                 a -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables()),
359                 a -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods()),
360                 a -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
361                 a -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports())
362         );
363         test(false, new String[]{&quot;--no-startup&quot;},
364                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
365                 a -&gt; dropVariable(a, &quot;/drop a&quot;, &quot;int a = 0&quot;, &quot;|  dropped variable a&quot;),
366                 a -&gt; assertMethod(a, &quot;int b() { return 0; }&quot;, &quot;()int&quot;, &quot;b&quot;),
367                 a -&gt; dropMethod(a, &quot;/drop b&quot;, &quot;int b()&quot;, &quot;|  dropped method b()&quot;),
368                 a -&gt; assertClass(a, &quot;class A {}&quot;, &quot;class&quot;, &quot;A&quot;),
369                 a -&gt; dropClass(a, &quot;/drop A&quot;, &quot;class A&quot;, &quot;|  dropped class A&quot;),
370                 a -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables()),
371                 a -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods()),
372                 a -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
373                 a -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports())
374         );
375     }
376 
377     @Test
378     public void testDropRange() {
379         test(false, new String[]{&quot;--no-startup&quot;},
380                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
381                 a -&gt; assertMethod(a, &quot;int b() { return 0; }&quot;, &quot;()int&quot;, &quot;b&quot;),
382                 a -&gt; assertClass(a, &quot;class A {}&quot;, &quot;class&quot;, &quot;A&quot;),
383                 a -&gt; assertImport(a, &quot;import java.util.stream.*;&quot;, &quot;&quot;, &quot;java.util.stream.*&quot;),
384                 a -&gt; assertCommand(a, &quot;for (int i = 0; i &lt; 10; ++i) {}&quot;, &quot;&quot;),
385                 a -&gt; assertCommand(a, &quot;/drop 3-5 b 1&quot;,
386                         &quot;|  dropped class A\n&quot; +
387                         &quot;|  dropped method b()\n&quot; +
388                         &quot;|  dropped variable a\n&quot;),
389                 a -&gt; assertCommand(a, &quot;/list&quot;, &quot;&quot;)
390         );
391     }
392 
393     @Test
394     public void testDropNegative() {
395         test(false, new String[]{&quot;--no-startup&quot;},
396                 a -&gt; assertCommandOutputStartsWith(a, &quot;/drop 0&quot;, &quot;|  No snippet with ID: 0&quot;),
397                 a -&gt; assertCommandOutputStartsWith(a, &quot;/drop a&quot;, &quot;|  No such snippet: a&quot;),
398                 a -&gt; assertCommandCheckOutput(a, &quot;/drop&quot;,
399                         assertStartsWith(&quot;|  In the /drop argument, please specify an import, variable, method, or class to drop.&quot;)),
400                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
401                 a -&gt; assertCommand(a, &quot;a&quot;, &quot;a ==&gt; 0&quot;),
402                 a -&gt; assertCommand(a, &quot;/drop 2&quot;, &quot;&quot;),
403                 a -&gt; assertCommand(a, &quot;/drop 2&quot;,
404                         &quot;|  This command does not accept the snippet &#39;2&#39; : a\n&quot; +
405                         &quot;|  See /types, /methods, /vars, or /list&quot;)
406         );
407     }
408 
409     @Test
410     public void testAmbiguousDrop() {
411         test(
412                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
413                 a -&gt; assertMethod(a, &quot;int a() { return 0; }&quot;, &quot;()int&quot;, &quot;a&quot;),
414                 a -&gt; assertClass(a, &quot;class a {}&quot;, &quot;class&quot;, &quot;a&quot;),
415                 a -&gt; assertCommand(a, &quot;/drop a&quot;,
416                         &quot;|  dropped variable a\n&quot; +
417                         &quot;|  dropped method a()\n&quot; +
418                         &quot;|  dropped class a&quot;)
419         );
420         test(
421                 a -&gt; assertMethod(a, &quot;int a() { return 0; }&quot;, &quot;()int&quot;, &quot;a&quot;),
422                 a -&gt; assertMethod(a, &quot;double a(int a) { return 0; }&quot;, &quot;(int)double&quot;, &quot;a&quot;),
423                 a -&gt; assertMethod(a, &quot;double a(double a) { return 0; }&quot;, &quot;(double)double&quot;, &quot;a&quot;),
424                 a -&gt; assertCommand(a, &quot;/drop a&quot;,
425                         &quot;|  dropped method a()\n&quot; +
426                         &quot;|  dropped method a(int)\n&quot; +
427                         &quot;|  dropped method a(double)\n&quot;)
428         );
429     }
430 
431     @Test
432     public void testApplicationOfPost() {
433         test(
434                 (a) -&gt; assertCommand(a, &quot;/set mode t normal -command&quot;, &quot;|  Created new feedback mode: t&quot;),
435                 (a) -&gt; assertCommand(a, &quot;/set feedback t&quot;, &quot;|  Feedback mode: t&quot;),
436                 (a) -&gt; assertCommand(a, &quot;/set format t post \&quot;$%n\&quot;&quot;, &quot;&quot;),
437                 (a) -&gt; assertCommand(a, &quot;/set prompt t \&quot;+\&quot; \&quot;-\&quot;&quot;, &quot;&quot;),
438                 (a) -&gt; assertCommand(a, &quot;/set prompt t&quot;, &quot;|  /set prompt t \&quot;+\&quot; \&quot;-\&quot;$&quot;)
439         );
440     }
441 
442     @Test
443     public void testHelpLength() {
444         Consumer&lt;String&gt; testOutput = (s) -&gt; {
445             List&lt;String&gt; ss = Stream.of(s.split(&quot;\n&quot;))
446                     .filter(l -&gt; !l.isEmpty())
447                     .collect(Collectors.toList());
448             assertTrue(ss.size() &gt;= 10, &quot;Help does not print enough lines:&quot; + s);
449         };
450         test(
451                 (a) -&gt; assertCommandCheckOutput(a, &quot;/?&quot;, testOutput),
452                 (a) -&gt; assertCommandCheckOutput(a, &quot;/help&quot;, testOutput),
453                 (a) -&gt; assertCommandCheckOutput(a, &quot;/help /list&quot;, testOutput)
454         );
455     }
456 
457     @Test
458     public void testHelp() {
459         test(
460                 (a) -&gt; assertHelp(a, &quot;/?&quot;, &quot;/list&quot;, &quot;/help&quot;, &quot;/exit&quot;, &quot;intro&quot;),
461                 (a) -&gt; assertHelp(a, &quot;/help&quot;, &quot;/list&quot;, &quot;/help&quot;, &quot;/exit&quot;, &quot;intro&quot;),
462                 (a) -&gt; assertHelp(a, &quot;/help short&quot;, &quot;shortcuts&quot;, &quot;Tab&quot;),
463                 (a) -&gt; assertHelp(a, &quot;/help keys&quot;, &quot;line&quot;, &quot;Shift&quot;, &quot;imports&quot;, &quot;history&quot;),
464                 (a) -&gt; assertHelp(a, &quot;/? /li&quot;, &quot;/list -all&quot;, &quot;snippets&quot;),
465                 (a) -&gt; assertHelp(a, &quot;/help /set prompt&quot;, &quot;optionally contain &#39;%s&#39;&quot;, &quot;quoted&quot;),
466                 (a) -&gt; assertHelp(a, &quot;/help /help&quot;, &quot;/help &lt;command&gt;&quot;),
467                 (a) -&gt; assertHelp(a, &quot;/help li&quot;, &quot;/list -start&quot;),
468                 (a) -&gt; assertHelp(a, &quot;/help fe&quot;, &quot;/set feedback -retain&quot;)
469         );
470     }
471 
472     @Test
473     public void testHelpStart() {
474         test(
475                 (a) -&gt; assertCommandCheckOutput(a, &quot;/help /exit&quot;,
476                         s -&gt; assertTrue(s.replaceAll(&quot;\\r\\n?&quot;, &quot;\n&quot;).startsWith(
477                                 &quot;|  \n&quot; +
478                                 &quot;|                                   /exit\n&quot; +
479                                 &quot;|                                   =====\n&quot; +
480                                 &quot;|  &quot;
481                         ))
482                 )
483         );
484     }
485 
486     @Test
487     public void testHelpFormat() {
488         test(
489                 (a) -&gt; assertCommandCheckOutput(a, &quot;/help&quot;, s -&gt; {
490                     String[] lines = s.split(&quot;\\R&quot;);
491                     assertTrue(lines.length &gt; 20,
492                             &quot;Too few lines of /help output: &quot; + lines.length
493                           + &quot;\n&quot; + s);
494                     for (int i = 0; i &lt; lines.length; ++i) {
495                         String l = lines[i];
496                         assertTrue(l.startsWith(&quot;| &quot;),
497                                 &quot;Expected /help line to start with | :\n&quot; + l);
498                         assertTrue(l.length() &lt;= 80,
499                                 &quot;/help line too long: &quot; + l.length() + &quot;\n&quot; + l);
500                     }
501                  })
502         );
503     }
504 
505     @Test
506     public void testConfusedUserPseudoCommands() {
507         test(
508                 (a) -&gt; assertHelp(a, &quot;/-&lt;n&gt;&quot;, &quot;last snippet&quot;, &quot;digits&quot;),
509                 (a) -&gt; assertHelp(a, &quot;/&lt;id&gt;&quot;, &quot;last snippet&quot;, &quot;digits&quot;)
510         );
511     }
512 
513     private void assertHelp(boolean a, String command, String... find) {
514         assertCommandCheckOutput(a, command, s -&gt; {
515             for (String f : find) {
516                 assertTrue(s.contains(f),
517                         &quot;Expected output of &quot; + command + &quot; to contain: &quot; + f
518                       + &quot;\n&quot; + s);
519             }
520         });
521     }
522 
523     // Check that each line of output contains the corresponding string from the list
524     private void checkLineToList(String in, List&lt;String&gt; match) {
525         String trimmed = in.trim();
526         String[] res = trimmed.isEmpty()
527                 ? new String[0]
528                 : trimmed.split(&quot;\n&quot;);
529         assertEquals(res.length, match.size(), &quot;Got: &quot; + Arrays.asList(res));
530         for (int i = 0; i &lt; match.size(); ++i) {
531             assertTrue(res[i].contains(match.get(i)));
532         }
533     }
534 
535     @Test
536     public void testListArgs() {
537         String arg = &quot;qqqq&quot;;
538         List&lt;String&gt; startVarList = new ArrayList&lt;&gt;(START_UP);
539         startVarList.add(&quot;int aardvark&quot;);
540         startVarList.add(&quot;int weevil&quot;);
541         test(
542                 a -&gt; assertCommandCheckOutput(a, &quot;/list -all&quot;,
543                         s -&gt; checkLineToList(s, START_UP)),
544                 a -&gt; assertCommandOutputStartsWith(a, &quot;/list &quot; + arg,
545                         &quot;|  No such snippet: &quot; + arg),
546                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;aardvark&quot;),
547                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;weevil&quot;),
548                 a -&gt; assertCommandOutputContains(a, &quot;/list aardvark&quot;, &quot;aardvark&quot;),
549                 a -&gt; assertCommandCheckOutput(a, &quot;/list -start&quot;,
550                         s -&gt; checkLineToList(s, START_UP)),
551                 a -&gt; assertCommandCheckOutput(a, &quot;/list -all&quot;,
552                         s -&gt; checkLineToList(s, startVarList)),
553                 a -&gt; assertCommandOutputStartsWith(a, &quot;/list s3&quot;,
554                         &quot;s3 : import&quot;),
555                 a -&gt; assertCommandCheckOutput(a, &quot;/list 1-2 s3&quot;,
556                         s -&gt; {
557                             assertTrue(Pattern.matches(&quot;.*aardvark.*\\R.*weevil.*\\R.*s3.*import.*&quot;, s.trim()),
558                                     &quot;No match: &quot; + s);
559                         }),
560                 a -&gt; assertCommandOutputStartsWith(a, &quot;/list &quot; + arg,
561                         &quot;|  No such snippet: &quot; + arg)
562         );
563     }
564 
565     @Test
566     public void testVarsArgs() {
567         String arg = &quot;qqqq&quot;;
568         List&lt;String&gt; startVarList = new ArrayList&lt;&gt;();
569         test(
570                 a -&gt; assertCommandCheckOutput(a, &quot;/vars -all&quot;,
571                         s -&gt; checkLineToList(s, startVarList)),
572                 a -&gt; assertCommand(a, &quot;/vars &quot; + arg,
573                         &quot;|  No such snippet: &quot; + arg),
574                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;aardvark&quot;),
575                 a -&gt; assertMethod(a, &quot;int f() { return 0; }&quot;, &quot;()int&quot;, &quot;f&quot;),
576                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
577                 a -&gt; assertVariable(a, &quot;double&quot;, &quot;a&quot;, &quot;1&quot;, &quot;1.0&quot;),
578                 a -&gt; assertCommandOutputStartsWith(a, &quot;/vars aardvark&quot;,
579                         &quot;|    int aardvark = 0&quot;),
580                 a -&gt; assertCommandCheckOutput(a, &quot;/vars -start&quot;,
581                         s -&gt; checkLineToList(s, startVarList)),
582                 a -&gt; assertCommandOutputStartsWith(a, &quot;/vars -all&quot;,
583                         &quot;|    int aardvark = 0\n|    int a = &quot;),
584                 a -&gt; assertCommandOutputStartsWith(a, &quot;/vars 1-4&quot;,
585                         &quot;|    int aardvark = 0\n|    int a = &quot;),
586                 a -&gt; assertCommandOutputStartsWith(a, &quot;/vars f&quot;,
587                         &quot;|  This command does not accept the snippet &#39;f&#39;&quot;),
588                 a -&gt; assertCommand(a, &quot;/var &quot; + arg,
589                         &quot;|  No such snippet: &quot; + arg)
590         );
591     }
592 
593     @Test
594     public void testMethodsArgs() {
595         String arg = &quot;qqqq&quot;;
596         List&lt;String&gt; printingMethodList = new ArrayList&lt;&gt;(PRINTING_CMD_METHOD);
597         test(new String[]{&quot;--startup&quot;, &quot;PRINTING&quot;},
598                 a -&gt; assertCommandCheckOutput(a, &quot;/methods -all&quot;,
599                         s -&gt; checkLineToList(s, printingMethodList)),
600                 a -&gt; assertCommandCheckOutput(a, &quot;/methods -start&quot;,
601                         s -&gt; checkLineToList(s, printingMethodList)),
602                 a -&gt; assertCommandCheckOutput(a, &quot;/methods print println printf&quot;,
603                         s -&gt; checkLineToList(s, printingMethodList)),
604                 a -&gt; assertCommandCheckOutput(a, &quot;/methods println&quot;,
605                         s -&gt; assertEquals(s.trim().split(&quot;\n&quot;).length, 10)),
606                 a -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;,
607                         s -&gt; checkLineToList(s, printingMethodList)),
608                 a -&gt; assertCommandOutputStartsWith(a, &quot;/methods &quot; + arg,
609                         &quot;|  No such snippet: &quot; + arg),
610                 a -&gt; assertMethod(a, &quot;int f() { return 0; }&quot;, &quot;()int&quot;, &quot;f&quot;),
611                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;aardvark&quot;),
612                 a -&gt; assertMethod(a, &quot;void f(int a) { g(); }&quot;, &quot;(int)void&quot;, &quot;f&quot;),
613                 a -&gt; assertMethod(a, &quot;void g() {}&quot;, &quot;()void&quot;, &quot;g&quot;),
614                 a -&gt; assertCommandOutputStartsWith(a, &quot;/methods &quot; + arg,
615                         &quot;|  No such snippet: &quot; + arg),
616                 a -&gt; assertCommandOutputStartsWith(a, &quot;/methods aardvark&quot;,
617                         &quot;|  This command does not accept the snippet &#39;aardvark&#39; : int aardvark&quot;),
618                 a -&gt; assertCommandCheckOutput(a, &quot;/methods -start&quot;,
619                         s -&gt; checkLineToList(s, printingMethodList)),
620                 a -&gt; assertCommandCheckOutput(a, &quot;/methods print println printf&quot;,
621                         s -&gt; checkLineToList(s, printingMethodList)),
622                 a -&gt; assertCommandOutputStartsWith(a, &quot;/methods g&quot;,
623                         &quot;|    void g()&quot;),
624                 a -&gt; assertCommandOutputStartsWith(a, &quot;/methods f&quot;,
625                         &quot;|    int f()\n&quot; +
626                         &quot;|    void f(int)&quot;)
627         );
628     }
629 
630     @Test
631     public void testMethodsWithErrors() {
632         test(new String[]{&quot;--no-startup&quot;},
633                 a -&gt; assertCommand(a, &quot;double m(int x) { return x; }&quot;,
634                         &quot;|  created method m(int)&quot;),
635                 a -&gt; assertCommand(a, &quot;GARBAGE junk() { return TRASH; }&quot;,
636                         &quot;|  created method junk(), however, it cannot be referenced until class GARBAGE, and variable TRASH are declared&quot;),
637                 a -&gt; assertCommand(a, &quot;int w = 5;&quot;,
638                         &quot;w ==&gt; 5&quot;),
639                 a -&gt; assertCommand(a, &quot;int tyer() { return w; }&quot;,
640                         &quot;|  created method tyer()&quot;),
641                 a -&gt; assertCommand(a, &quot;String w = \&quot;hi\&quot;;&quot;,
642                         &quot;w ==&gt; \&quot;hi\&quot;&quot;),
643                 a -&gt; assertCommand(a, &quot;/methods&quot;,
644                         &quot;|    double m(int)\n&quot; +
645                         &quot;|    GARBAGE junk()\n&quot; +
646                         &quot;|       which cannot be referenced until class GARBAGE, and variable TRASH are declared\n&quot; +
647                         &quot;|    int tyer()\n&quot; +
648                         &quot;|       which cannot be invoked until this error is corrected: \n&quot; +
649                         &quot;|          incompatible types: java.lang.String cannot be converted to int\n&quot; +
650                         &quot;|          int tyer() { return w; }\n&quot; +
651                         &quot;|                              ^\n&quot;)
652         );
653     }
654 
655     @Test
656     public void testTypesWithErrors() {
657         test(new String[]{&quot;--no-startup&quot;},
658                 a -&gt; assertCommand(a, &quot;class C extends NONE { int x; }&quot;,
659                         &quot;|  created class C, however, it cannot be referenced until class NONE is declared&quot;),
660                 a -&gt; assertCommand(a, &quot;class D { void m() { System.out.println(nada); } }&quot;,
661                         &quot;|  created class D, however, it cannot be instantiated or its methods invoked until variable nada is declared&quot;),
662                 a -&gt; assertCommand(a, &quot;/types&quot;,
663                         &quot;|    class C\n&quot; +
664                         &quot;|       which cannot be referenced until class NONE is declared\n&quot; +
665                         &quot;|    class D\n&quot; +
666                         &quot;|       which cannot be instantiated or its methods invoked until variable nada is declared\n&quot;)
667         );
668     }
669 
670     @Test
671     public void testTypesArgs() {
672         String arg = &quot;qqqq&quot;;
673         List&lt;String&gt; startTypeList = new ArrayList&lt;&gt;();
674         test(
675                 a -&gt; assertCommandCheckOutput(a, &quot;/types -all&quot;,
676                         s -&gt; checkLineToList(s, startTypeList)),
677                 a -&gt; assertCommandCheckOutput(a, &quot;/types -start&quot;,
678                         s -&gt; checkLineToList(s, startTypeList)),
679                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types &quot; + arg,
680                         &quot;|  No such snippet: &quot; + arg),
681                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;aardvark&quot;),
682                 (a) -&gt; assertClass(a, &quot;class A { }&quot;, &quot;class&quot;, &quot;A&quot;),
683                 (a) -&gt; assertClass(a, &quot;interface A { }&quot;, &quot;interface&quot;, &quot;A&quot;),
684                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types -all&quot;,
685                         &quot;|    class A\n&quot; +
686                         &quot;|    interface A&quot;),
687                 (a) -&gt; assertClass(a, &quot;enum E { }&quot;, &quot;enum&quot;, &quot;E&quot;),
688                 (a) -&gt; assertClass(a, &quot;@interface B { }&quot;, &quot;@interface&quot;, &quot;B&quot;),
689                 a -&gt; assertCommand(a, &quot;/types aardvark&quot;,
690                         &quot;|  This command does not accept the snippet &#39;aardvark&#39; : int aardvark;&quot;),
691                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types A&quot;,
692                         &quot;|    interface A&quot;),
693                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types E&quot;,
694                         &quot;|    enum E&quot;),
695                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types B&quot;,
696                         &quot;|    @interface B&quot;),
697                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types &quot; + arg,
698                         &quot;|  No such snippet: &quot; + arg),
699                 a -&gt; assertCommandCheckOutput(a, &quot;/types -start&quot;,
700                         s -&gt; checkLineToList(s, startTypeList))
701         );
702     }
703 
704     @Test
705     public void testBlankLinesInSnippetContinuation() {
706         test(Locale.ROOT, false, new String[]{&quot;--no-startup&quot;}, &quot;&quot;,
707                 a -&gt; assertCommand(a, &quot;class C {&quot;,
708                         &quot;&quot;),
709                 a -&gt; assertCommand(a, &quot;&quot;,
710                         &quot;&quot;),
711                 a -&gt; assertCommand(a, &quot;&quot;,
712                         &quot;&quot;),
713                 a -&gt; assertCommand(a, &quot;  int x;&quot;,
714                         &quot;&quot;),
715                 a -&gt; assertCommand(a, &quot;&quot;,
716                         &quot;&quot;),
717                 a -&gt; assertCommand(a, &quot;&quot;,
718                         &quot;&quot;),
719                 a -&gt; assertCommand(a, &quot;}&quot;,
720                         &quot;|  created class C&quot;),
721                 a -&gt; assertCommand(a, &quot;/list&quot;,
722                         &quot;\n&quot; +
723                         &quot;   1 : class C {\n&quot; +
724                         &quot;       \n&quot; +
725                         &quot;       \n&quot; +
726                         &quot;         int x;\n&quot; +
727                         &quot;       \n&quot; +
728                         &quot;       \n&quot; +
729                         &quot;       }&quot;)
730         );
731     }
732 
733     @Test
734     public void testCompoundStart() {
735         test(new String[]{&quot;--startup&quot;, &quot;DEFAULT&quot;, &quot;--startup&quot;, &quot;PRINTING&quot;},
736                 (a) -&gt; assertCommand(a, &quot;printf(\&quot;%4.2f\&quot;, Math.PI)&quot;,
737                         &quot;&quot;, &quot;&quot;, null, &quot;3.14&quot;, &quot;&quot;)
738         );
739     }
740 
741     @Test
742     public void testJavaSeStart() {
743         test(new String[]{&quot;--startup&quot;, &quot;JAVASE&quot;},
744                 (a) -&gt; assertCommand(a, &quot;ZoneOffsetTransitionRule.TimeDefinition.WALL&quot;,
745                         &quot;$1 ==&gt; WALL&quot;)
746         );
747     }
748 
749     @Test
750     public void testJavaSeSetStart() {
751         test(
752                 (a) -&gt; assertCommand(a, &quot;/set sta JAVASE&quot;, &quot;&quot;),
753                 (a) -&gt; assertCommand(a, &quot;/reset&quot;, &quot;|  Resetting state.&quot;),
754                 (a) -&gt; assertCommandCheckOutput(a, &quot;/li -a&quot;,
755                             s -&gt; assertTrue(s.split(&quot;import &quot;).length &gt; 160,
756                             &quot;not enough imports for JAVASE:\n&quot; + s))
757         );
758     }
759 
760     @Test
761     public void defineClasses() {
762         test(
763                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
764                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
765                 (a) -&gt; assertClass(a, &quot;class A { }&quot;, &quot;class&quot;, &quot;A&quot;),
766                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
767                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
768                 (a) -&gt; assertClass(a, &quot;interface A { }&quot;, &quot;interface&quot;, &quot;A&quot;),
769                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
770                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
771                 (a) -&gt; assertClass(a, &quot;enum A { }&quot;, &quot;enum&quot;, &quot;A&quot;),
772                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
773                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
774                 (a) -&gt; assertClass(a, &quot;@interface A { }&quot;, &quot;@interface&quot;, &quot;A&quot;),
775                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
776                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses())
777         );
778     }
779 
780     @Test
781     public void testCommandPrefix() {
782         test(a -&gt; assertCommandCheckOutput(a, &quot;/s&quot;,
783                       assertStartsWith(&quot;|  Command: &#39;/s&#39; is ambiguous: /save, /set&quot;)),
784              a -&gt; assertCommand(a, &quot;int var&quot;, &quot;var ==&gt; 0&quot;),
785              a -&gt; assertCommandCheckOutput(a, &quot;/va&quot;,
786                       assertStartsWith(&quot;|    int var = 0&quot;)),
787              a -&gt; assertCommandCheckOutput(a, &quot;/save&quot;,
788                       assertStartsWith(&quot;|  &#39;/save&#39; requires a filename argument.&quot;)));
789     }
790 
791     @Test
792     public void testOptionQ() {
793         test(Locale.ROOT, false, new String[]{&quot;-q&quot;, &quot;--no-startup&quot;}, &quot;&quot;,
794                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;$1 ==&gt; 2&quot;),
795                 (a) -&gt; assertCommand(a, &quot;int x = 5&quot;, &quot;&quot;)
796         );
797     }
798 
799     @Test
800     public void testOptionS() {
801         test(Locale.ROOT, false, new String[]{&quot;-s&quot;, &quot;--no-startup&quot;}, &quot;&quot;,
802                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;&quot;)
803         );
804     }
805 
806     @Test
807     public void testOptionV() {
808         test(new String[]{&quot;-v&quot;, &quot;--no-startup&quot;},
809                 (a) -&gt; assertCommand(a, &quot;1+1&quot;,
810                         &quot;$1 ==&gt; 2\n&quot; +
811                         &quot;|  created scratch variable $1 : int&quot;)
812         );
813     }
814 
815     @Test
816     public void testOptionFeedback() {
817         test(Locale.ROOT, false, new String[]{&quot;--feedback&quot;, &quot;concise&quot;, &quot;--no-startup&quot;}, &quot;&quot;,
818                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;$1 ==&gt; 2&quot;),
819                 (a) -&gt; assertCommand(a, &quot;int x = 5&quot;, &quot;&quot;)
820         );
821     }
822 
823     @Test
824     public void testCompoundOptions() {
825         Consumer&lt;String&gt; confirmNoStartup = s -&gt; {
826                     assertEquals(0, Stream.of(s.split(&quot;\n&quot;))
827                             .filter(l -&gt; !l.isEmpty())
828                             .count(), &quot;Expected no lines: &quot; + s);
829                 };
830         test(Locale.ROOT, false, new String[]{&quot;-nq&quot;}, &quot;&quot;,
831                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list -all&quot;, confirmNoStartup),
832                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;$1 ==&gt; 2&quot;),
833                 (a) -&gt; assertCommand(a, &quot;int x = 5&quot;, &quot;&quot;)
834         );
835         test(Locale.ROOT, false, new String[]{&quot;-qn&quot;}, &quot;&quot;,
836                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list -all&quot;, confirmNoStartup),
837                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;$1 ==&gt; 2&quot;),
838                 (a) -&gt; assertCommand(a, &quot;int x = 5&quot;, &quot;&quot;)
839         );
840         test(Locale.ROOT, false, new String[]{&quot;-ns&quot;}, &quot;&quot;,
841                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list -all&quot;, confirmNoStartup),
842                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;&quot;)
843         );
844     }
845 
846     @Test
847     public void testOptionR() {
848         test(new String[]{&quot;-R-Dthe.sound=blorp&quot;, &quot;--no-startup&quot;},
849                 (a) -&gt; assertCommand(a, &quot;System.getProperty(\&quot;the.sound\&quot;)&quot;,
850                         &quot;$1 ==&gt; \&quot;blorp\&quot;&quot;)
851         );
852     }
853 
854     @Test
855     public void testWrapSourceHandlerDiagCrash() {
856         test(new String[]{&quot;--add-exports&quot;, &quot;jdk.javadoc/ALL-UNNAMED&quot;},
857                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;$1 ==&gt; 2&quot;)
858          );
859     }
860 
861     @Test
862     public void test8156910() {
863         test(
864                 (a) -&gt; assertCommandOutputContains(a, &quot;System.out.println(\&quot;%5d\&quot;, 10);&quot;, &quot;%5d&quot;),
865                 (a) -&gt; assertCommandOutputContains(a, &quot;1234&quot;, &quot;==&gt; 1234&quot;)
866         );
867     }
868 
869     @Test
870     public void testIntersection() {
871         test(
872                 (a) -&gt; assertCommandOutputContains(a, &quot;&lt;Z extends Runnable&amp;CharSequence&gt; Z get1() { return null; }&quot;, &quot;get1()&quot;),
873                 (a) -&gt; assertCommandOutputContains(a, &quot;var g1 = get1()&quot;, &quot;g1&quot;),
874                 (a) -&gt; assertCommand(a, &quot;/vars g1&quot;, &quot;|    CharSequence&amp;Runnable g1 = null&quot;),
875                 (a) -&gt; assertCommandOutputContains(a, &quot;&lt;Z extends Number&amp;CharSequence&gt; Z get2() { return null; }&quot;, &quot;get2()&quot;),
876                 (a) -&gt; assertCommandOutputContains(a, &quot;var g2 = get2()&quot;, &quot;g2&quot;),
877                 (a) -&gt; assertCommand(a, &quot;/vars g2&quot;, &quot;|    Number&amp;CharSequence g2 = null&quot;)
878         );
879     }
880 
881     @Test
882     public void testAnonymous() {
883         test(
884                 (a) -&gt; assertCommandOutputContains(a, &quot;var r1 = new Object() {}&quot;, &quot;r1&quot;),
885                 (a) -&gt; assertCommandOutputContains(a, &quot;/vars r1&quot;, &quot;|    &lt;anonymous class extending Object&gt; r1 = &quot;),
886                 (a) -&gt; assertCommandOutputContains(a, &quot;var r2 = new Runnable() { public void run() { } }&quot;, &quot;r2&quot;),
887                 (a) -&gt; assertCommandOutputContains(a, &quot;/vars r2&quot;, &quot;|    &lt;anonymous class implementing Runnable&gt; r2 = &quot;),
888                 (a) -&gt; assertCommandOutputContains(a, &quot;import java.util.stream.*;&quot;, &quot;&quot;),
889                 (a) -&gt; assertCommandOutputContains(a, &quot;var list = Stream.of(1, 2, 3).map(j -&gt; new Object() { int i = j; }).collect(Collectors.toList());&quot;,
890                                                       &quot;list&quot;),
891                 (a) -&gt; assertCommandOutputContains(a, &quot;/vars list&quot;, &quot;|    List&lt;&lt;anonymous class extending Object&gt;&gt; list = &quot;)
892         );
893     }
894 
895     // This is mainly interesting in the TestLocalSimpleTest case (8198573)
896     @Test
897     public void testUpdateFalsePositive() {
898         test(
899                 a -&gt; assertClass(a, &quot;class A { int a() { int error = 0; return error; } }&quot;, &quot;class&quot;, &quot;A&quot;),
900                 a -&gt; assertVariable(a, &quot;A&quot;, &quot;a&quot;, &quot;new A()&quot;, &quot;A@.+&quot;),
901                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;error&quot;, &quot;4711&quot;, &quot;4711&quot;),
902                 a -&gt; assertCommandOutputContains(a, &quot;a&quot;, &quot;A@&quot;)
903         );
904     }
905 
906     @Test
907     public void testRecords() {
908         test(new String[] {&quot;--enable-preview&quot;},
909                 (a) -&gt; assertCommandOutputContains(a, &quot;record R(int i) { public int g() { return j; } }&quot;,
910                         &quot;|  created record R, however, it cannot be instantiated or its methods invoked until variable j is declared&quot;),
911                 (a) -&gt; assertCommandOutputContains(a, &quot;new R(0)&quot;,
912                         &quot;|  attempted to use record R which cannot be instantiated or its methods invoked until variable j is declared&quot;)
913         );
914     }
915 }
    </pre>
  </body>
</html>