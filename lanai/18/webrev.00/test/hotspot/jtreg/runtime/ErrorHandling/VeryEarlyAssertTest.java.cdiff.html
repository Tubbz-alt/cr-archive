<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/hotspot/jtreg/runtime/ErrorHandling/VeryEarlyAssertTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../EnclosingMethodAttr/EnclMethodAttr.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../LocalVariableTable/TestLVT.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/runtime/ErrorHandling/VeryEarlyAssertTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2013, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * Copyright (c) 2018, SAP. All rights reserved.
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2013, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * Copyright (c) 2018, SAP. All rights reserved.
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
</pre>
<hr />
<pre>
<span class="line-old-header">*** 47,12 ***</span>
  
    public static void main(String[] args) throws Exception {
  
  
      ProcessBuilder pb = ProcessTools.createJavaProcessBuilder(
<span class="line-removed">-             &quot;-Xmx64M&quot;,</span>
<span class="line-removed">-             &quot;-XX:-CreateCoredumpOnCrash&quot;,</span>
              &quot;-version&quot;);
      Map&lt;String, String&gt; env = pb.environment();
      env.put(&quot;HOTSPOT_FATAL_ERROR_DURING_DYNAMIC_INITIALIZATION&quot;, &quot;1&quot;);
  
      OutputAnalyzer output_detail = new OutputAnalyzer(pb.start());
<span class="line-new-header">--- 47,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 85,34 ***</span>
      Pattern[] pattern = new Pattern[]{
              Pattern.compile(&quot;.*HOTSPOT_FATAL_ERROR_DURING_DYNAMIC_INITIALIZATION.*&quot;)
      };
      int currentPattern = 0;
  
<span class="line-modified">!     String lastLine = null;</span>
      while ((line = br.readLine()) != null) {
        if (currentPattern &lt; pattern.length) {
          if (pattern[currentPattern].matcher(line).matches()) {
            System.out.println(&quot;Found: &quot; + line + &quot;.&quot;);
            currentPattern++;
          }
        }
<span class="line-modified">!       lastLine = line;</span>
      }
      br.close();
  
      if (currentPattern &lt; pattern.length) {
        throw new RuntimeException(&quot;hs-err file incomplete (first missing pattern: &quot; + currentPattern + &quot;)&quot;);
      }
  
<span class="line-modified">!     if (!lastLine.equals(&quot;END.&quot;)) {</span>
        throw new RuntimeException(&quot;hs-err file incomplete (missing END marker.)&quot;);
      } else {
        System.out.println(&quot;End marker found.&quot;);
      }
  
      System.out.println(&quot;OK.&quot;);
  
    }
  
  }
<span class="line-removed">- </span>
<span class="line-removed">- </span>
<span class="line-new-header">--- 83,35 ---</span>
      Pattern[] pattern = new Pattern[]{
              Pattern.compile(&quot;.*HOTSPOT_FATAL_ERROR_DURING_DYNAMIC_INITIALIZATION.*&quot;)
      };
      int currentPattern = 0;
  
<span class="line-modified">!     boolean endMarkerFound = false;</span>
      while ((line = br.readLine()) != null) {
        if (currentPattern &lt; pattern.length) {
          if (pattern[currentPattern].matcher(line).matches()) {
            System.out.println(&quot;Found: &quot; + line + &quot;.&quot;);
            currentPattern++;
          }
        }
<span class="line-modified">!       if (line.equals(&quot;END.&quot;)) {</span>
<span class="line-added">+         endMarkerFound = true;</span>
<span class="line-added">+         break;</span>
<span class="line-added">+       }</span>
      }
      br.close();
  
      if (currentPattern &lt; pattern.length) {
        throw new RuntimeException(&quot;hs-err file incomplete (first missing pattern: &quot; + currentPattern + &quot;)&quot;);
      }
  
<span class="line-modified">!     if (!endMarkerFound) {</span>
        throw new RuntimeException(&quot;hs-err file incomplete (missing END marker.)&quot;);
      } else {
        System.out.println(&quot;End marker found.&quot;);
      }
  
      System.out.println(&quot;OK.&quot;);
  
    }
  
  }
</pre>
<center><a href="../EnclosingMethodAttr/EnclMethodAttr.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../LocalVariableTable/TestLVT.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>