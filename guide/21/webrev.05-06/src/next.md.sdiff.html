<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/next.md</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../index.html" target="_top">index</a> next &gt;</center>    <h2>src/next.md</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  8 for example a bug might be filed or a backport could be requested.
  9 
 10 * [Requesting a Backport](#requesting-a-backport)
 11 * [Filing a Bug](#filing-a-bug)
 12 * [ProblemListing or `@ignore`-ing a Test](#problemlisting-or-ignore-ing-a-test)
 13 * [Backing Out a Change](#backing-out-a-change)
 14 
 15 ## Requesting a Backport
 16 
 17 TBD
 18 
 19 ## Filing a Bug
 20 
 21 When a new failure is found in the JDK a bug should be filed to describe and track the issue. Depending on your role in the OpenJDK you can either use the [Bug Report Tool](https://bugreport.java.com/) or, if you are Author in an OpenJDK Project, report the bug directly in the [JDK Bug System](https://bugs.openjdk.java.net/). Try to make the bug report as complete as possible to make it easier to triage and investigate the bug. It&#39;s not the reporter&#39;s responsibility to set a correct priority, but a qualified guess is always better than a default value. To help with setting the right priority consider things like how the bug impacts the product and our testing, how likely is it that the bug triggers, how difficult is it to work around the bug if it&#39;s not fixed soon, and whether it&#39;s a recent regression, since that may break existing applications. Regressions are often higher priority than long standing bugs and may block a release if not fixed.
 22 
 23 A few things to keep in mind when filing a new bug:
 24 
 25 * Before filing a bug, verify that there isn&#39;t already a bug filed for this issue.
 26 * Add relevant labels like `intermittent`, `regression`, `noreg-self` etc.
 27 * Set affects version to the JDK version(s) where the failure was seen.

 28 * In the description, always include (if possible):
 29   * full name of the failing tests
 30   * error messages
 31   * assert messages
 32   * stack trace
 33   * command line information
 34   * relevant information from the logs

 35 * Only set CPU and/or OS fields if the bug **ONLY** happens on that particular platform.
 36 * Always file separate bugs for different issues.
 37   * If two crashes looks related but not similar enough to for sure be the same, it is easier to close a bug as a duplicate than it is to extract the relevant info from a bug to create a new one later.
 38 
<span class="line-modified"> 39 ## ProblemListing or `@ignore`-ing a Test</span>
 40 
 41 Sometimes tests break. It could be e.g. due to bugs in the test itself, due to changed functionality in the code that the test is testing, or changes in the environment where the test is executed. While working on a fix, it can be useful to stop the test from being executed in everyone else&#39;s testing to reduce noise, especially if the test is expected to fail for more than a day. There are two ways to stop a test from being run in standard test runs: ProblemListing and using the `@ignore` keyword. Removing tests isn&#39;t the standard way to remove a failure. A failing test is often a regression and should ideally be handled with high urgency.
 42 
 43 I&#39;ll say it right away so that it&#39;s not forgotten at the end: Remember to remove the JBS id from the ProblemList or the test when the bug is closed. This is especially easy to forget if a bug is closed as a duplicate or &#39;Will Not Fix&#39;.
 44 
 45 ### ProblemListing jtreg tests
 46 
 47 ProblemListing should be used for a short term exclusion while a test is being fixed, and for the exclusion of intermittently failing tests that cause too much noise, but can still be useful to run on an ad-hoc basis. ProblemListing is done in the file `ProblemList.txt`. There are actually several ProblemList files to choose from. Their location and name hint about what area or feature each file belongs to. Each file has sections for different components. All ProblemList files complement each other to build the total set of tests to exclude in JTReg runs.
 48 
 49 ~~~
 50 test/hotspot/jtreg/ProblemList.txt
 51 test/hotspot/jtreg/ProblemList-aot.txt
 52 test/hotspot/jtreg/ProblemList-graal.txt
 53 test/hotspot/jtreg/ProblemList-non-cds-mode.txt
 54 test/hotspot/jtreg/ProblemList-Xcomp.txt
 55 test/hotspot/jtreg/ProblemList-zgc.txt
 56 test/jaxp/ProblemList.txt
 57 test/jdk/ProblemList.txt
 58 test/jdk/ProblemList-aot.txt
 59 test/jdk/ProblemList-graal.txt
</pre>
<hr />
<pre>
103 A ProblemList entry that excludes the first, second, and third test case would look like this:
104 
105 ~~~
106 foo/bar/MyTest.java#id0          4720  generic-all
107 foo/bar/MyTest.java#fancy_name   4721  generic-all
108 foo/bar/MyTest.java#id2          4722  generic-all
109 ~~~
110 
111 Due to an issue described in [CODETOOLS-7902712](https://bugs.openjdk.java.net/browse/CODETOOLS-7902712) tests that contains more than one `@test` must actually use this way to specify all test cases if all of them should be ProblemListed. Specifying just the test name will not work.
112 
113 #### Running ProblemListed tests
114 
115 To run ad-hoc runs of ProblemListed tests use `RUN_PROBLEM_LISTS=true`.
116 
117 ~~~
118 make test TEST=... JTREG=RUN_PROBLEM_LISTS=true
119 ~~~
120 
121 ### Exclude jtreg tests using `@ignore`
122 
<span class="line-modified">123 The `@ignore` keyword is used in the test source code. This is mainly used for tests that are so broken that they may be harmful or useless. Examples can be tests that don&#39;t compile because something changed in the platform; or a test which might remove your `/etc/shadow`. Use `@ignore` with a bug reference in the test case to prevent the test from being run.</span>
124 
125 ~~~java
126 /**
127  *  @test
128  *  @ignore 4711
129  *
130 ~~~
131 
132 In this example, `MyTest.java` is excluded, tracked by bug `JDK-4711`. `@ignore` should always be placed directly before the first `@run` line in the test.
133 
134 ### Dealing with JBS bugs for test exclusion
135 
136 ProblemListing and `@ignore`-ing are done in the JDK source tree, that means a check-in into the repository is needed. This in turn means that a unique JBS issue and a code review are needed. This is a good thing since it makes test problems visible.
137 
138 * **Code review**: This is considered a [trivial](glossary.html#trivial) change.
139 * **JBS issue**: A JBS issue is obviously created for the bug that caused the failure, we call this the _main issue_. To exclude the test, create a subtask to the main issue. Also add the label `problemlist` to the main issue.
140 
141 The fix for the main issue should remove the test from the ProblemList or remove the `@ignore` keyword from the test.
142 
143 #### Triage excluded issues
</pre>
</td>
<td>
<hr />
<pre>
  8 for example a bug might be filed or a backport could be requested.
  9 
 10 * [Requesting a Backport](#requesting-a-backport)
 11 * [Filing a Bug](#filing-a-bug)
 12 * [ProblemListing or `@ignore`-ing a Test](#problemlisting-or-ignore-ing-a-test)
 13 * [Backing Out a Change](#backing-out-a-change)
 14 
 15 ## Requesting a Backport
 16 
 17 TBD
 18 
 19 ## Filing a Bug
 20 
 21 When a new failure is found in the JDK a bug should be filed to describe and track the issue. Depending on your role in the OpenJDK you can either use the [Bug Report Tool](https://bugreport.java.com/) or, if you are Author in an OpenJDK Project, report the bug directly in the [JDK Bug System](https://bugs.openjdk.java.net/). Try to make the bug report as complete as possible to make it easier to triage and investigate the bug. It&#39;s not the reporter&#39;s responsibility to set a correct priority, but a qualified guess is always better than a default value. To help with setting the right priority consider things like how the bug impacts the product and our testing, how likely is it that the bug triggers, how difficult is it to work around the bug if it&#39;s not fixed soon, and whether it&#39;s a recent regression, since that may break existing applications. Regressions are often higher priority than long standing bugs and may block a release if not fixed.
 22 
 23 A few things to keep in mind when filing a new bug:
 24 
 25 * Before filing a bug, verify that there isn&#39;t already a bug filed for this issue.
 26 * Add relevant labels like `intermittent`, `regression`, `noreg-self` etc.
 27 * Set affects version to the JDK version(s) where the failure was seen.
<span class="line-added"> 28   * If the failure is found in an update train of the JDK (e.g. 11.0.x), please make an effort to see if the bug is also present in [mainline](https://hg.openjdk.java.net/jdk/jdk/).</span>
 29 * In the description, always include (if possible):
 30   * full name of the failing tests
 31   * error messages
 32   * assert messages
 33   * stack trace
 34   * command line information
 35   * relevant information from the logs
<span class="line-added"> 36 * If the failure is not reproducible with an existing OpenJDK test, attach a reproducer if possible.</span>
 37 * Only set CPU and/or OS fields if the bug **ONLY** happens on that particular platform.
 38 * Always file separate bugs for different issues.
 39   * If two crashes looks related but not similar enough to for sure be the same, it is easier to close a bug as a duplicate than it is to extract the relevant info from a bug to create a new one later.
 40 
<span class="line-modified"> 41 ## Excluding a Test</span>
 42 
 43 Sometimes tests break. It could be e.g. due to bugs in the test itself, due to changed functionality in the code that the test is testing, or changes in the environment where the test is executed. While working on a fix, it can be useful to stop the test from being executed in everyone else&#39;s testing to reduce noise, especially if the test is expected to fail for more than a day. There are two ways to stop a test from being run in standard test runs: ProblemListing and using the `@ignore` keyword. Removing tests isn&#39;t the standard way to remove a failure. A failing test is often a regression and should ideally be handled with high urgency.
 44 
 45 I&#39;ll say it right away so that it&#39;s not forgotten at the end: Remember to remove the JBS id from the ProblemList or the test when the bug is closed. This is especially easy to forget if a bug is closed as a duplicate or &#39;Will Not Fix&#39;.
 46 
 47 ### ProblemListing jtreg tests
 48 
 49 ProblemListing should be used for a short term exclusion while a test is being fixed, and for the exclusion of intermittently failing tests that cause too much noise, but can still be useful to run on an ad-hoc basis. ProblemListing is done in the file `ProblemList.txt`. There are actually several ProblemList files to choose from. Their location and name hint about what area or feature each file belongs to. Each file has sections for different components. All ProblemList files complement each other to build the total set of tests to exclude in JTReg runs.
 50 
 51 ~~~
 52 test/hotspot/jtreg/ProblemList.txt
 53 test/hotspot/jtreg/ProblemList-aot.txt
 54 test/hotspot/jtreg/ProblemList-graal.txt
 55 test/hotspot/jtreg/ProblemList-non-cds-mode.txt
 56 test/hotspot/jtreg/ProblemList-Xcomp.txt
 57 test/hotspot/jtreg/ProblemList-zgc.txt
 58 test/jaxp/ProblemList.txt
 59 test/jdk/ProblemList.txt
 60 test/jdk/ProblemList-aot.txt
 61 test/jdk/ProblemList-graal.txt
</pre>
<hr />
<pre>
105 A ProblemList entry that excludes the first, second, and third test case would look like this:
106 
107 ~~~
108 foo/bar/MyTest.java#id0          4720  generic-all
109 foo/bar/MyTest.java#fancy_name   4721  generic-all
110 foo/bar/MyTest.java#id2          4722  generic-all
111 ~~~
112 
113 Due to an issue described in [CODETOOLS-7902712](https://bugs.openjdk.java.net/browse/CODETOOLS-7902712) tests that contains more than one `@test` must actually use this way to specify all test cases if all of them should be ProblemListed. Specifying just the test name will not work.
114 
115 #### Running ProblemListed tests
116 
117 To run ad-hoc runs of ProblemListed tests use `RUN_PROBLEM_LISTS=true`.
118 
119 ~~~
120 make test TEST=... JTREG=RUN_PROBLEM_LISTS=true
121 ~~~
122 
123 ### Exclude jtreg tests using `@ignore`
124 
<span class="line-modified">125 The `@ignore` keyword is used in the test source code. This is mainly used for tests that are so broken that they may be harmful or useless, and is less common than ProblemListing. Examples can be tests that don&#39;t compile because something changed in the platform; or a test which might remove your `/etc/shadow`. Use `@ignore` with a bug reference in the test case to prevent the test from being run.</span>
126 
127 ~~~java
128 /**
129  *  @test
130  *  @ignore 4711
131  *
132 ~~~
133 
134 In this example, `MyTest.java` is excluded, tracked by bug `JDK-4711`. `@ignore` should always be placed directly before the first `@run` line in the test.
135 
136 ### Dealing with JBS bugs for test exclusion
137 
138 ProblemListing and `@ignore`-ing are done in the JDK source tree, that means a check-in into the repository is needed. This in turn means that a unique JBS issue and a code review are needed. This is a good thing since it makes test problems visible.
139 
140 * **Code review**: This is considered a [trivial](glossary.html#trivial) change.
141 * **JBS issue**: A JBS issue is obviously created for the bug that caused the failure, we call this the _main issue_. To exclude the test, create a subtask to the main issue. Also add the label `problemlist` to the main issue.
142 
143 The fix for the main issue should remove the test from the ProblemList or remove the `@ignore` keyword from the test.
144 
145 #### Triage excluded issues
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>