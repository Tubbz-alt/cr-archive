<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/tools/javac/patterns/SimpleDeconstructionPattern.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="DeconstructionPatternErrors.out.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../platform/PlatformProviderTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/patterns/SimpleDeconstructionPattern.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /**
  2  * @test

  3  * @compile --enable-preview -source ${jdk.version} SimpleDeconstructionPattern.java
  4  * @run main/othervm --enable-preview SimpleDeconstructionPattern
  5  */
  6 





  7 public class SimpleDeconstructionPattern {
  8 
  9     public static void main(String... args) throws Throwable {
 10 //        if (!test1(new P(42))) {
 11 //            throw new IllegalStateException();
 12 //        }
 13 //        if (test1(new P(41))) {
 14 //            throw new IllegalStateException();
 15 //        }
 16         if (!test2(new P(42))) {
 17             throw new IllegalStateException();
 18         }
 19         if (test2(new P(41))) {
 20             throw new IllegalStateException();
 21         }






 22 //        if (!test3(new P2(new P(42), &quot;&quot;))) {
 23 //            throw new IllegalStateException();
 24 //        }
 25 //        if (test3(new P2(new P(41), &quot;&quot;))) {
 26 //            throw new IllegalStateException();
 27 //        }
 28 //        if (test3(new P2(new P(42), &quot;a&quot;))) {
 29 //            throw new IllegalStateException();
 30 //        }
 31         if (!test4(new P2(new P(42), &quot;&quot;))) {
 32             throw new IllegalStateException();
 33         }
 34         if (test4(new P2(new P(41), &quot;&quot;))) {
 35             throw new IllegalStateException();
 36         }
 37         if (test4(new P2(new P(42), &quot;a&quot;))) {
 38             throw new IllegalStateException();
 39         }
 40         if (!test5(new P(42))) {
 41             throw new IllegalStateException();
 42         }
 43         if (test5(new P(41))) {
 44             throw new IllegalStateException();
 45         }
<span class="line-modified"> 46         if (!test6(new P(42))) {</span>
<span class="line-modified"> 47             throw new IllegalStateException();</span>
<span class="line-modified"> 48         }</span>
<span class="line-modified"> 49         if (!test6(new P(41))) {</span>
<span class="line-modified"> 50             throw new IllegalStateException();</span>
<span class="line-modified"> 51         }</span>
 52 //        if (!((new BaseUse(new BaseSubclass(0))) instanceof BaseUse(BaseSubclass(0)))) {
 53 //            throw new IllegalStateException();
 54 //        }
 55         if (!test7(new P3(&quot;&quot;))) {
 56             throw new IllegalStateException();
 57         }
 58         if (test7(new P3(&quot;a&quot;))) {
 59             throw new IllegalStateException();
 60         }






 61         if (test8(new P4(&quot;&quot;))) {
 62             throw new IllegalStateException();
 63         }
 64         if (!test8(new P4(new P3(&quot;&quot;)))) {
 65             throw new IllegalStateException();
 66         }



 67         if (test8(new P4(new P3(&quot;a&quot;)))) {
 68             throw new IllegalStateException();
 69         }



















































 70     }
 71 
 72 //    private static boolean test1(Object o) throws Throwable {
 73 //        return o instanceof P(42);
 74 //    }
 75 //
 76     private static void exp(Object o) throws Throwable {
 77         if (o instanceof P(var i)) {
 78             System.err.println(&quot;i=&quot; + i);
 79         }
 80     }
 81 
 82     private static boolean test2(Object o) throws Throwable {
 83         return o instanceof P(var i) &amp;&amp; i == 42;
 84     }
 85 




 86 //    private static boolean test3(Object o) throws Throwable {
 87 //        return o instanceof P2(P(42), &quot;&quot;);
 88 //    }
 89 //
 90     private static boolean test4(Object o) throws Throwable {
 91         return o instanceof P2(P(var i), var s) &amp;&amp; i == 42 &amp;&amp; &quot;&quot;.equals(s);
 92     }
 93 
 94     private static boolean test5(Object o) throws Throwable {
 95         return o instanceof P(var i) &amp;&amp; i == 42;
 96     }
 97 
<span class="line-modified"> 98     private static boolean test6(Object o) throws Throwable {</span>
<span class="line-modified"> 99         return o instanceof P(_);</span>
<span class="line-modified">100     }</span>
101 
102     private static boolean test7(Object o) throws Throwable {
103         return o instanceof P3(var s) &amp;&amp; &quot;&quot;.equals(s);
104     }
105 




106     private static boolean test8(Object o) throws Throwable {
107         return o instanceof P4(P3(var s)) &amp;&amp; &quot;&quot;.equals(s);
108     }
109 




































110     public record P(int i) {
111     }
112 
113     public record P2(P p, String s) {
114     }
115 
116     public record P3(String s) {
117     }
118 
119     public record P4(Object o) {}
120 



121     public interface Base {}
122     public record BaseUse(Base b) {}
123     public record BaseSubclass(int i) implements Base {}
<span class="line-modified">124 }</span>



</pre>
</td>
<td>
<hr />
<pre>
  1 /**
  2  * @test
<span class="line-added">  3  * @compile/fail/ref=SimpleDeconstructionPatternNoPreview.out -XDrawDiagnostics SimpleDeconstructionPattern.java</span>
  4  * @compile --enable-preview -source ${jdk.version} SimpleDeconstructionPattern.java
  5  * @run main/othervm --enable-preview SimpleDeconstructionPattern
  6  */
  7 
<span class="line-added">  8 import java.util.ArrayList;</span>
<span class="line-added">  9 import java.util.Arrays;</span>
<span class="line-added"> 10 import java.util.LinkedList;</span>
<span class="line-added"> 11 import java.util.List;</span>
<span class="line-added"> 12 </span>
 13 public class SimpleDeconstructionPattern {
 14 
 15     public static void main(String... args) throws Throwable {
 16 //        if (!test1(new P(42))) {
 17 //            throw new IllegalStateException();
 18 //        }
 19 //        if (test1(new P(41))) {
 20 //            throw new IllegalStateException();
 21 //        }
 22         if (!test2(new P(42))) {
 23             throw new IllegalStateException();
 24         }
 25         if (test2(new P(41))) {
 26             throw new IllegalStateException();
 27         }
<span class="line-added"> 28         if (!test2a(new P(42))) {</span>
<span class="line-added"> 29             throw new IllegalStateException();</span>
<span class="line-added"> 30         }</span>
<span class="line-added"> 31         if (test2a(new P(41))) {</span>
<span class="line-added"> 32             throw new IllegalStateException();</span>
<span class="line-added"> 33         }</span>
 34 //        if (!test3(new P2(new P(42), &quot;&quot;))) {
 35 //            throw new IllegalStateException();
 36 //        }
 37 //        if (test3(new P2(new P(41), &quot;&quot;))) {
 38 //            throw new IllegalStateException();
 39 //        }
 40 //        if (test3(new P2(new P(42), &quot;a&quot;))) {
 41 //            throw new IllegalStateException();
 42 //        }
 43         if (!test4(new P2(new P(42), &quot;&quot;))) {
 44             throw new IllegalStateException();
 45         }
 46         if (test4(new P2(new P(41), &quot;&quot;))) {
 47             throw new IllegalStateException();
 48         }
 49         if (test4(new P2(new P(42), &quot;a&quot;))) {
 50             throw new IllegalStateException();
 51         }
 52         if (!test5(new P(42))) {
 53             throw new IllegalStateException();
 54         }
 55         if (test5(new P(41))) {
 56             throw new IllegalStateException();
 57         }
<span class="line-modified"> 58 //        if (!test6(new P(42))) {</span>
<span class="line-modified"> 59 //            throw new IllegalStateException();</span>
<span class="line-modified"> 60 //        }</span>
<span class="line-modified"> 61 //        if (!test6(new P(41))) {</span>
<span class="line-modified"> 62 //            throw new IllegalStateException();</span>
<span class="line-modified"> 63 //        }</span>
 64 //        if (!((new BaseUse(new BaseSubclass(0))) instanceof BaseUse(BaseSubclass(0)))) {
 65 //            throw new IllegalStateException();
 66 //        }
 67         if (!test7(new P3(&quot;&quot;))) {
 68             throw new IllegalStateException();
 69         }
 70         if (test7(new P3(&quot;a&quot;))) {
 71             throw new IllegalStateException();
 72         }
<span class="line-added"> 73         if (!test7a(new P3(&quot;&quot;))) {</span>
<span class="line-added"> 74             throw new IllegalStateException();</span>
<span class="line-added"> 75         }</span>
<span class="line-added"> 76         if (test7a(new P3(&quot;a&quot;))) {</span>
<span class="line-added"> 77             throw new IllegalStateException();</span>
<span class="line-added"> 78         }</span>
 79         if (test8(new P4(&quot;&quot;))) {
 80             throw new IllegalStateException();
 81         }
 82         if (!test8(new P4(new P3(&quot;&quot;)))) {
 83             throw new IllegalStateException();
 84         }
<span class="line-added"> 85         if (!test8a(new P4(new P3(&quot;&quot;)))) {</span>
<span class="line-added"> 86             throw new IllegalStateException();</span>
<span class="line-added"> 87         }</span>
 88         if (test8(new P4(new P3(&quot;a&quot;)))) {
 89             throw new IllegalStateException();
 90         }
<span class="line-added"> 91         if (test8a(new P4(new P3(&quot;a&quot;)))) {</span>
<span class="line-added"> 92             throw new IllegalStateException();</span>
<span class="line-added"> 93         }</span>
<span class="line-added"> 94         if (!test9(new P5(new ArrayList&lt;String&gt;(Arrays.asList(&quot;&quot;))))) {</span>
<span class="line-added"> 95             throw new IllegalStateException();</span>
<span class="line-added"> 96         }</span>
<span class="line-added"> 97         if (test9(new P5(new LinkedList&lt;String&gt;(Arrays.asList(&quot;&quot;))))) {</span>
<span class="line-added"> 98             throw new IllegalStateException();</span>
<span class="line-added"> 99         }</span>
<span class="line-added">100         if (testA(new P6(null))) {</span>
<span class="line-added">101             throw new IllegalStateException();</span>
<span class="line-added">102         }</span>
<span class="line-added">103         if (testA(new P6(new P3(null)))) {</span>
<span class="line-added">104             throw new IllegalStateException();</span>
<span class="line-added">105         }</span>
<span class="line-added">106         if (testB(new P6(null))) {</span>
<span class="line-added">107             throw new IllegalStateException();</span>
<span class="line-added">108         }</span>
<span class="line-added">109         if (testB(new P6(new P3(null)))) {</span>
<span class="line-added">110             throw new IllegalStateException();</span>
<span class="line-added">111         }</span>
<span class="line-added">112         if (testC(new P6(null))) {</span>
<span class="line-added">113             throw new IllegalStateException();</span>
<span class="line-added">114         }</span>
<span class="line-added">115         if (testC(new P6(new P3(null)))) {</span>
<span class="line-added">116             throw new IllegalStateException();</span>
<span class="line-added">117         }</span>
<span class="line-added">118         if (!testC(new P6(new P3(&quot;&quot;)))) {</span>
<span class="line-added">119             throw new IllegalStateException();</span>
<span class="line-added">120         }</span>
<span class="line-added">121         if (!testGen1(new GenRecord1&lt;&gt;(1L, &quot;&quot;))) {</span>
<span class="line-added">122             throw new IllegalStateException();</span>
<span class="line-added">123         }</span>
<span class="line-added">124         if (testGen1(new GenRecord1&lt;&gt;(1L, &quot;a&quot;))) {</span>
<span class="line-added">125             throw new IllegalStateException();</span>
<span class="line-added">126         }</span>
<span class="line-added">127         if (testGen2(new GenRecord1&lt;&gt;(3L, &quot;&quot;))) {</span>
<span class="line-added">128             throw new IllegalStateException();</span>
<span class="line-added">129         }</span>
<span class="line-added">130         if (!testGen2(new GenRecord1&lt;&gt;(3, &quot;&quot;))) {</span>
<span class="line-added">131             throw new IllegalStateException();</span>
<span class="line-added">132         }</span>
<span class="line-added">133         if (testGen3(new GenRecord1&lt;&gt;(3L, &quot;&quot;))) {</span>
<span class="line-added">134             throw new IllegalStateException();</span>
<span class="line-added">135         }</span>
<span class="line-added">136         if (!testGen3(new GenRecord1&lt;&gt;(3, &quot;&quot;))) {</span>
<span class="line-added">137             throw new IllegalStateException();</span>
<span class="line-added">138         }</span>
<span class="line-added">139         if (!testGen3(new GenRecord1&lt;&gt;(3, &quot;&quot;))) {</span>
<span class="line-added">140             throw new IllegalStateException();</span>
<span class="line-added">141         }</span>
142     }
143 
144 //    private static boolean test1(Object o) throws Throwable {
145 //        return o instanceof P(42);
146 //    }
147 //
148     private static void exp(Object o) throws Throwable {
149         if (o instanceof P(var i)) {
150             System.err.println(&quot;i=&quot; + i);
151         }
152     }
153 
154     private static boolean test2(Object o) throws Throwable {
155         return o instanceof P(var i) &amp;&amp; i == 42;
156     }
157 
<span class="line-added">158     private static boolean test2a(Object o) throws Throwable {</span>
<span class="line-added">159         return o instanceof P(int i) &amp;&amp; i == 42;</span>
<span class="line-added">160     }</span>
<span class="line-added">161 </span>
162 //    private static boolean test3(Object o) throws Throwable {
163 //        return o instanceof P2(P(42), &quot;&quot;);
164 //    }
165 //
166     private static boolean test4(Object o) throws Throwable {
167         return o instanceof P2(P(var i), var s) &amp;&amp; i == 42 &amp;&amp; &quot;&quot;.equals(s);
168     }
169 
170     private static boolean test5(Object o) throws Throwable {
171         return o instanceof P(var i) &amp;&amp; i == 42;
172     }
173 
<span class="line-modified">174 //    private static boolean test6(Object o) throws Throwable {</span>
<span class="line-modified">175 //        return o instanceof P(_);</span>
<span class="line-modified">176 //    }</span>
177 
178     private static boolean test7(Object o) throws Throwable {
179         return o instanceof P3(var s) &amp;&amp; &quot;&quot;.equals(s);
180     }
181 
<span class="line-added">182     private static boolean test7a(Object o) throws Throwable {</span>
<span class="line-added">183         return o instanceof P3(String s) &amp;&amp; &quot;&quot;.equals(s);</span>
<span class="line-added">184     }</span>
<span class="line-added">185 </span>
186     private static boolean test8(Object o) throws Throwable {
187         return o instanceof P4(P3(var s)) &amp;&amp; &quot;&quot;.equals(s);
188     }
189 
<span class="line-added">190     private static boolean test8a(Object o) throws Throwable {</span>
<span class="line-added">191         return o instanceof P4(P3(String s)) &amp;&amp; &quot;&quot;.equals(s);</span>
<span class="line-added">192     }</span>
<span class="line-added">193 </span>
<span class="line-added">194     private static boolean test9(Object o) throws Throwable {</span>
<span class="line-added">195         return o instanceof P5(ArrayList&lt;String&gt; l) &amp;&amp; !l.isEmpty();</span>
<span class="line-added">196     }</span>
<span class="line-added">197 </span>
<span class="line-added">198     private static boolean testA(Object o) throws Throwable {</span>
<span class="line-added">199         return o instanceof P6(P3(var s));</span>
<span class="line-added">200     }</span>
<span class="line-added">201 </span>
<span class="line-added">202     private static boolean testB(Object o) throws Throwable {</span>
<span class="line-added">203         return o instanceof P6(P3(String s));</span>
<span class="line-added">204     }</span>
<span class="line-added">205 </span>
<span class="line-added">206     private static boolean testC(Object o) throws Throwable {</span>
<span class="line-added">207         return o instanceof P6(P3(String s)) &amp;&amp; s.isEmpty();</span>
<span class="line-added">208     }</span>
<span class="line-added">209 </span>
<span class="line-added">210     private static boolean testGen1(Object o) throws Throwable {</span>
<span class="line-added">211         return o instanceof GenRecord1(var i, var s) &amp;&amp; s.length() == 0;</span>
<span class="line-added">212     }</span>
<span class="line-added">213 </span>
<span class="line-added">214     private static boolean testGen2(Object o) throws Throwable {</span>
<span class="line-added">215         return o instanceof GenRecord1(Integer i, var s) &amp;&amp; i.intValue() == 3 &amp;&amp; s.length() == 0;</span>
<span class="line-added">216     }</span>
<span class="line-added">217 </span>
<span class="line-added">218     private static boolean testGen3(Object o) throws Throwable {</span>
<span class="line-added">219         return o instanceof GenRecord1&lt;?, ?&gt;(Integer i, var s) &amp;&amp; i.intValue() == 3 &amp;&amp; s.length() == 0;</span>
<span class="line-added">220     }</span>
<span class="line-added">221 </span>
<span class="line-added">222     private static boolean testGen4(GenBase&lt;Integer, String&gt; o) throws Throwable {</span>
<span class="line-added">223         return o instanceof GenRecord1&lt;Integer, String&gt;(var i, var s) &amp;&amp; i.intValue() == 3 &amp;&amp; s.length() == 0;</span>
<span class="line-added">224     }</span>
<span class="line-added">225 </span>
226     public record P(int i) {
227     }
228 
229     public record P2(P p, String s) {
230     }
231 
232     public record P3(String s) {
233     }
234 
235     public record P4(Object o) {}
236 
<span class="line-added">237     public record P5(List&lt;String&gt; l) {}</span>
<span class="line-added">238     public record P6(P3 p) {}</span>
<span class="line-added">239 </span>
240     public interface Base {}
241     public record BaseUse(Base b) {}
242     public record BaseSubclass(int i) implements Base {}
<span class="line-modified">243 </span>
<span class="line-added">244     public interface GenBase&lt;T1, T2 extends CharSequence&gt; {}</span>
<span class="line-added">245     public record GenRecord1&lt;T1, T2 extends CharSequence&gt; (T1 i, T2 s) implements GenBase&lt;T1, T2&gt; {}</span>
<span class="line-added">246 }</span>
</pre>
</td>
</tr>
</table>
<center><a href="DeconstructionPatternErrors.out.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../platform/PlatformProviderTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>