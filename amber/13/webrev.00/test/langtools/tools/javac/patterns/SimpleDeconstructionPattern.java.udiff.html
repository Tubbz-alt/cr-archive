<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/langtools/tools/javac/patterns/SimpleDeconstructionPattern.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="DeconstructionPatternErrors.out.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../platform/PlatformProviderTest.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/patterns/SimpleDeconstructionPattern.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,11 +1,17 @@</span>
  /**
   * @test
<span class="udiff-line-added">+  * @compile/fail/ref=SimpleDeconstructionPatternNoPreview.out -XDrawDiagnostics SimpleDeconstructionPattern.java</span>
   * @compile --enable-preview -source ${jdk.version} SimpleDeconstructionPattern.java
   * @run main/othervm --enable-preview SimpleDeconstructionPattern
   */
  
<span class="udiff-line-added">+ import java.util.ArrayList;</span>
<span class="udiff-line-added">+ import java.util.Arrays;</span>
<span class="udiff-line-added">+ import java.util.LinkedList;</span>
<span class="udiff-line-added">+ import java.util.List;</span>
<span class="udiff-line-added">+ </span>
  public class SimpleDeconstructionPattern {
  
      public static void main(String... args) throws Throwable {
  //        if (!test1(new P(42))) {
  //            throw new IllegalStateException();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -17,10 +23,16 @@</span>
              throw new IllegalStateException();
          }
          if (test2(new P(41))) {
              throw new IllegalStateException();
          }
<span class="udiff-line-added">+         if (!test2a(new P(42))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (test2a(new P(41))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
  //        if (!test3(new P2(new P(42), &quot;&quot;))) {
  //            throw new IllegalStateException();
  //        }
  //        if (test3(new P2(new P(41), &quot;&quot;))) {
  //            throw new IllegalStateException();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -41,34 +53,94 @@</span>
              throw new IllegalStateException();
          }
          if (test5(new P(41))) {
              throw new IllegalStateException();
          }
<span class="udiff-line-modified-removed">-         if (!test6(new P(42))) {</span>
<span class="udiff-line-modified-removed">-             throw new IllegalStateException();</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-removed">-         if (!test6(new P(41))) {</span>
<span class="udiff-line-modified-removed">-             throw new IllegalStateException();</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-added">+ //        if (!test6(new P(42))) {</span>
<span class="udiff-line-modified-added">+ //            throw new IllegalStateException();</span>
<span class="udiff-line-modified-added">+ //        }</span>
<span class="udiff-line-modified-added">+ //        if (!test6(new P(41))) {</span>
<span class="udiff-line-modified-added">+ //            throw new IllegalStateException();</span>
<span class="udiff-line-modified-added">+ //        }</span>
  //        if (!((new BaseUse(new BaseSubclass(0))) instanceof BaseUse(BaseSubclass(0)))) {
  //            throw new IllegalStateException();
  //        }
          if (!test7(new P3(&quot;&quot;))) {
              throw new IllegalStateException();
          }
          if (test7(new P3(&quot;a&quot;))) {
              throw new IllegalStateException();
          }
<span class="udiff-line-added">+         if (!test7a(new P3(&quot;&quot;))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (test7a(new P3(&quot;a&quot;))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
          if (test8(new P4(&quot;&quot;))) {
              throw new IllegalStateException();
          }
          if (!test8(new P4(new P3(&quot;&quot;)))) {
              throw new IllegalStateException();
          }
<span class="udiff-line-added">+         if (!test8a(new P4(new P3(&quot;&quot;)))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
          if (test8(new P4(new P3(&quot;a&quot;)))) {
              throw new IllegalStateException();
          }
<span class="udiff-line-added">+         if (test8a(new P4(new P3(&quot;a&quot;)))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (!test9(new P5(new ArrayList&lt;String&gt;(Arrays.asList(&quot;&quot;))))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (test9(new P5(new LinkedList&lt;String&gt;(Arrays.asList(&quot;&quot;))))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (testA(new P6(null))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (testA(new P6(new P3(null)))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (testB(new P6(null))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (testB(new P6(new P3(null)))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (testC(new P6(null))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (testC(new P6(new P3(null)))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (!testC(new P6(new P3(&quot;&quot;)))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (!testGen1(new GenRecord1&lt;&gt;(1L, &quot;&quot;))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (testGen1(new GenRecord1&lt;&gt;(1L, &quot;a&quot;))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (testGen2(new GenRecord1&lt;&gt;(3L, &quot;&quot;))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (!testGen2(new GenRecord1&lt;&gt;(3, &quot;&quot;))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (testGen3(new GenRecord1&lt;&gt;(3L, &quot;&quot;))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (!testGen3(new GenRecord1&lt;&gt;(3, &quot;&quot;))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (!testGen3(new GenRecord1&lt;&gt;(3, &quot;&quot;))) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException();</span>
<span class="udiff-line-added">+         }</span>
      }
  
  //    private static boolean test1(Object o) throws Throwable {
  //        return o instanceof P(42);
  //    }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -81,10 +153,14 @@</span>
  
      private static boolean test2(Object o) throws Throwable {
          return o instanceof P(var i) &amp;&amp; i == 42;
      }
  
<span class="udiff-line-added">+     private static boolean test2a(Object o) throws Throwable {</span>
<span class="udiff-line-added">+         return o instanceof P(int i) &amp;&amp; i == 42;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
  //    private static boolean test3(Object o) throws Throwable {
  //        return o instanceof P2(P(42), &quot;&quot;);
  //    }
  //
      private static boolean test4(Object o) throws Throwable {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -93,22 +169,62 @@</span>
  
      private static boolean test5(Object o) throws Throwable {
          return o instanceof P(var i) &amp;&amp; i == 42;
      }
  
<span class="udiff-line-modified-removed">-     private static boolean test6(Object o) throws Throwable {</span>
<span class="udiff-line-modified-removed">-         return o instanceof P(_);</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+ //    private static boolean test6(Object o) throws Throwable {</span>
<span class="udiff-line-modified-added">+ //        return o instanceof P(_);</span>
<span class="udiff-line-modified-added">+ //    }</span>
  
      private static boolean test7(Object o) throws Throwable {
          return o instanceof P3(var s) &amp;&amp; &quot;&quot;.equals(s);
      }
  
<span class="udiff-line-added">+     private static boolean test7a(Object o) throws Throwable {</span>
<span class="udiff-line-added">+         return o instanceof P3(String s) &amp;&amp; &quot;&quot;.equals(s);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      private static boolean test8(Object o) throws Throwable {
          return o instanceof P4(P3(var s)) &amp;&amp; &quot;&quot;.equals(s);
      }
  
<span class="udiff-line-added">+     private static boolean test8a(Object o) throws Throwable {</span>
<span class="udiff-line-added">+         return o instanceof P4(P3(String s)) &amp;&amp; &quot;&quot;.equals(s);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private static boolean test9(Object o) throws Throwable {</span>
<span class="udiff-line-added">+         return o instanceof P5(ArrayList&lt;String&gt; l) &amp;&amp; !l.isEmpty();</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private static boolean testA(Object o) throws Throwable {</span>
<span class="udiff-line-added">+         return o instanceof P6(P3(var s));</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private static boolean testB(Object o) throws Throwable {</span>
<span class="udiff-line-added">+         return o instanceof P6(P3(String s));</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private static boolean testC(Object o) throws Throwable {</span>
<span class="udiff-line-added">+         return o instanceof P6(P3(String s)) &amp;&amp; s.isEmpty();</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private static boolean testGen1(Object o) throws Throwable {</span>
<span class="udiff-line-added">+         return o instanceof GenRecord1(var i, var s) &amp;&amp; s.length() == 0;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private static boolean testGen2(Object o) throws Throwable {</span>
<span class="udiff-line-added">+         return o instanceof GenRecord1(Integer i, var s) &amp;&amp; i.intValue() == 3 &amp;&amp; s.length() == 0;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private static boolean testGen3(Object o) throws Throwable {</span>
<span class="udiff-line-added">+         return o instanceof GenRecord1&lt;?, ?&gt;(Integer i, var s) &amp;&amp; i.intValue() == 3 &amp;&amp; s.length() == 0;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private static boolean testGen4(GenBase&lt;Integer, String&gt; o) throws Throwable {</span>
<span class="udiff-line-added">+         return o instanceof GenRecord1&lt;Integer, String&gt;(var i, var s) &amp;&amp; i.intValue() == 3 &amp;&amp; s.length() == 0;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      public record P(int i) {
      }
  
      public record P2(P p, String s) {
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -116,9 +232,15 @@</span>
      public record P3(String s) {
      }
  
      public record P4(Object o) {}
  
<span class="udiff-line-added">+     public record P5(List&lt;String&gt; l) {}</span>
<span class="udiff-line-added">+     public record P6(P3 p) {}</span>
<span class="udiff-line-added">+ </span>
      public interface Base {}
      public record BaseUse(Base b) {}
      public record BaseSubclass(int i) implements Base {}
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+     public interface GenBase&lt;T1, T2 extends CharSequence&gt; {}</span>
<span class="udiff-line-added">+     public record GenRecord1&lt;T1, T2 extends CharSequence&gt; (T1 i, T2 s) implements GenBase&lt;T1, T2&gt; {}</span>
<span class="udiff-line-added">+ }</span>
</pre>
<center><a href="DeconstructionPatternErrors.out.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../platform/PlatformProviderTest.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>