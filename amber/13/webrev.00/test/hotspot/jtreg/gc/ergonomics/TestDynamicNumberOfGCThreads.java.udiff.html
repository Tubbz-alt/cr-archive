<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/hotspot/jtreg/gc/ergonomics/TestDynamicNumberOfGCThreads.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../arguments/TestG1HeapRegionSize.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../logging/TestMetaSpaceLog.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/gc/ergonomics/TestDynamicNumberOfGCThreads.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2015, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -68,25 +68,17 @@</span>
      output.shouldHaveExitValue(0); // test should run succesfully
      output.shouldContain(&quot;new_active_workers&quot;);
    }
  
    private static void testDynamicNumberOfGCThreads(String gcFlag) throws Exception {
<span class="udiff-line-modified-removed">-     // UseDynamicNumberOfGCThreads and TraceDynamicGCThreads enabled</span>
<span class="udiff-line-modified-added">+     // UseDynamicNumberOfGCThreads enabled</span>
      String[] baseArgs = {&quot;-XX:+UnlockExperimentalVMOptions&quot;, &quot;-XX:+&quot; + gcFlag, &quot;-Xmx10M&quot;, &quot;-XX:+UseDynamicNumberOfGCThreads&quot;, &quot;-Xlog:gc+task=trace&quot;, GCTest.class.getName()};
  
      // Base test with gc and +UseDynamicNumberOfGCThreads:
      ProcessBuilder pb_enabled = ProcessTools.createJavaProcessBuilder(baseArgs);
      verifyDynamicNumberOfGCThreads(new OutputAnalyzer(pb_enabled.start()));
  
<span class="udiff-line-removed">-     // Ensure it also works on uniprocessors or if user specifies -XX:ParallelGCThreads=1:</span>
<span class="udiff-line-removed">-     String[] extraArgs = {&quot;-XX:+UnlockDiagnosticVMOptions&quot;, &quot;-XX:+ForceDynamicNumberOfGCThreads&quot;, &quot;-XX:ParallelGCThreads=1&quot;};</span>
<span class="udiff-line-removed">-     String[] finalArgs = new String[baseArgs.length + extraArgs.length];</span>
<span class="udiff-line-removed">-     System.arraycopy(extraArgs, 0, finalArgs, 0,                extraArgs.length);</span>
<span class="udiff-line-removed">-     System.arraycopy(baseArgs,  0, finalArgs, extraArgs.length, baseArgs.length);</span>
<span class="udiff-line-removed">-     pb_enabled = ProcessTools.createJavaProcessBuilder(finalArgs);</span>
<span class="udiff-line-removed">-     verifyDynamicNumberOfGCThreads(new OutputAnalyzer(pb_enabled.start()));</span>
<span class="udiff-line-removed">- </span>
      // Turn on parallel reference processing
      String[] parRefProcArg = {&quot;-XX:+ParallelRefProcEnabled&quot;, &quot;-XX:-ShowMessageBoxOnError&quot;};
      String[] parRefArgs = new String[baseArgs.length + parRefProcArg.length];
      System.arraycopy(parRefProcArg, 0, parRefArgs, 0,                parRefProcArg.length);
      System.arraycopy(baseArgs,  0, parRefArgs, parRefProcArg.length, baseArgs.length);
</pre>
<center><a href="../arguments/TestG1HeapRegionSize.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../logging/TestMetaSpaceLog.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>