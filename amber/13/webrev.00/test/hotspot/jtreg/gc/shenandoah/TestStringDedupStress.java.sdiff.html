<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/gc/shenandoah/TestStringDedupStress.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="TestStringDedup.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestStringInternCleanup.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/gc/shenandoah/TestStringDedupStress.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 55  *
 56  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication
 57  *      -XX:+UseShenandoahGC
 58  *      -DtargetStrings=3000000
 59  *      TestStringDedupStress
 60  *
 61  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication
 62  *      -XX:+UseShenandoahGC -XX:ShenandoahGCHeuristics=aggressive
 63  *      -DtargetStrings=2000000
 64  *      TestStringDedupStress
 65  *
 66  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication
 67  *      -XX:+UseShenandoahGC -XX:ShenandoahGCHeuristics=aggressive
 68  *      -XX:+ShenandoahOOMDuringEvacALot
 69  *      -DtargetStrings=2000000
 70  *      TestStringDedupStress
 71  *
 72  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication
 73  *      -XX:+UseShenandoahGC -XX:ShenandoahGCHeuristics=compact
 74  *      TestStringDedupStress
<span class="line-removed"> 75  *</span>
<span class="line-removed"> 76  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication</span>
<span class="line-removed"> 77  *      -XX:+UseShenandoahGC</span>
<span class="line-removed"> 78  *      -XX:ShenandoahUpdateRefsEarly=off</span>
<span class="line-removed"> 79  *      -DtargetStrings=3000000</span>
<span class="line-removed"> 80  *      TestStringDedupStress</span>
<span class="line-removed"> 81  *</span>
<span class="line-removed"> 82  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication</span>
<span class="line-removed"> 83  *      -XX:+UseShenandoahGC -XX:ShenandoahGCHeuristics=compact</span>
<span class="line-removed"> 84  *      -XX:ShenandoahUpdateRefsEarly=off</span>
<span class="line-removed"> 85  *      -DtargetStrings=2000000</span>
<span class="line-removed"> 86  *      TestStringDedupStress</span>
<span class="line-removed"> 87  *</span>
<span class="line-removed"> 88  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication</span>
<span class="line-removed"> 89  *      -XX:+UseShenandoahGC -XX:ShenandoahGCHeuristics=aggressive</span>
<span class="line-removed"> 90  *      -XX:ShenandoahUpdateRefsEarly=off</span>
<span class="line-removed"> 91  *      -DtargetStrings=2000000</span>
<span class="line-removed"> 92  *      TestStringDedupStress</span>
<span class="line-removed"> 93  *</span>
<span class="line-removed"> 94  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication</span>
<span class="line-removed"> 95  *      -XX:+UseShenandoahGC -XX:ShenandoahGCHeuristics=aggressive</span>
<span class="line-removed"> 96  *      -XX:ShenandoahUpdateRefsEarly=off -XX:+ShenandoahOOMDuringEvacALot</span>
<span class="line-removed"> 97  *      -DtargetStrings=2000000</span>
<span class="line-removed"> 98  *      TestStringDedupStress</span>
 99  */
100 
101  /*
102  * @test TestStringDedupStress
103  * @summary Test Shenandoah string deduplication implementation
104  * @key gc
105  * @requires vm.gc.Shenandoah &amp; !vm.graal.enabled
106  * @library /test/lib
107  * @modules java.base/jdk.internal.misc:open
108  * @modules java.base/java.lang:open
109  *          java.management
110  *
111  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication
<span class="line-modified">112  *      -XX:+UseShenandoahGC -XX:ShenandoahGCMode=traversal</span>
113  *      TestStringDedupStress
114  *
115  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication
<span class="line-modified">116  *      -XX:+UseShenandoahGC -XX:ShenandoahGCMode=traversal -XX:ShenandoahGCHeuristics=aggressive</span>
117  *      -DtargetStrings=2000000
118  *      TestStringDedupStress
119  *
120  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication
<span class="line-modified">121  *      -XX:+UseShenandoahGC -XX:ShenandoahGCMode=traversal</span>
122  *      -XX:+ShenandoahOOMDuringEvacALot
123  *      -DtargetStrings=2000000
124  *      TestStringDedupStress
125  *
126  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication
<span class="line-modified">127  *      -XX:+UseShenandoahGC -XX:ShenandoahGCMode=traversal -XX:ShenandoahGCHeuristics=aggressive</span>
128  *      -XX:+ShenandoahOOMDuringEvacALot
129  *      -DtargetStrings=2000000
130  *      TestStringDedupStress
131  */
132 
133 import java.lang.management.*;
134 import java.lang.reflect.*;
135 import java.util.*;
136 
137 import sun.misc.*;
138 
139 public class TestStringDedupStress {
140     private static Field valueField;
141     private static Unsafe unsafe;
142 
143     private static final int TARGET_STRINGS = Integer.getInteger(&quot;targetStrings&quot;, 2_500_000);
144     private static final long MAX_REWRITE_GC_CYCLES = 6;
145     private static final long MAX_REWRITE_TIME = 30*1000; // ms
146 
147     private static final int UNIQUE_STRINGS = 20;
</pre>
</td>
<td>
<hr />
<pre>
 55  *
 56  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication
 57  *      -XX:+UseShenandoahGC
 58  *      -DtargetStrings=3000000
 59  *      TestStringDedupStress
 60  *
 61  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication
 62  *      -XX:+UseShenandoahGC -XX:ShenandoahGCHeuristics=aggressive
 63  *      -DtargetStrings=2000000
 64  *      TestStringDedupStress
 65  *
 66  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication
 67  *      -XX:+UseShenandoahGC -XX:ShenandoahGCHeuristics=aggressive
 68  *      -XX:+ShenandoahOOMDuringEvacALot
 69  *      -DtargetStrings=2000000
 70  *      TestStringDedupStress
 71  *
 72  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication
 73  *      -XX:+UseShenandoahGC -XX:ShenandoahGCHeuristics=compact
 74  *      TestStringDedupStress
























 75  */
 76 
 77  /*
 78  * @test TestStringDedupStress
 79  * @summary Test Shenandoah string deduplication implementation
 80  * @key gc
 81  * @requires vm.gc.Shenandoah &amp; !vm.graal.enabled
 82  * @library /test/lib
 83  * @modules java.base/jdk.internal.misc:open
 84  * @modules java.base/java.lang:open
 85  *          java.management
 86  *
 87  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication
<span class="line-modified"> 88  *      -XX:+UseShenandoahGC -XX:ShenandoahGCMode=iu</span>
 89  *      TestStringDedupStress
 90  *
 91  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication
<span class="line-modified"> 92  *      -XX:+UseShenandoahGC -XX:ShenandoahGCMode=iu -XX:ShenandoahGCHeuristics=aggressive</span>
 93  *      -DtargetStrings=2000000
 94  *      TestStringDedupStress
 95  *
 96  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication
<span class="line-modified"> 97  *      -XX:+UseShenandoahGC -XX:ShenandoahGCMode=iu</span>
 98  *      -XX:+ShenandoahOOMDuringEvacALot
 99  *      -DtargetStrings=2000000
100  *      TestStringDedupStress
101  *
102  * @run main/othervm -Xmx1g -Xlog:gc+stats -Xlog:gc -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+UseStringDeduplication
<span class="line-modified">103  *      -XX:+UseShenandoahGC -XX:ShenandoahGCMode=iu -XX:ShenandoahGCHeuristics=aggressive</span>
104  *      -XX:+ShenandoahOOMDuringEvacALot
105  *      -DtargetStrings=2000000
106  *      TestStringDedupStress
107  */
108 
109 import java.lang.management.*;
110 import java.lang.reflect.*;
111 import java.util.*;
112 
113 import sun.misc.*;
114 
115 public class TestStringDedupStress {
116     private static Field valueField;
117     private static Unsafe unsafe;
118 
119     private static final int TARGET_STRINGS = Integer.getInteger(&quot;targetStrings&quot;, 2_500_000);
120     private static final long MAX_REWRITE_GC_CYCLES = 6;
121     private static final long MAX_REWRITE_TIME = 30*1000; // ms
122 
123     private static final int UNIQUE_STRINGS = 20;
</pre>
</td>
</tr>
</table>
<center><a href="TestStringDedup.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestStringInternCleanup.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>