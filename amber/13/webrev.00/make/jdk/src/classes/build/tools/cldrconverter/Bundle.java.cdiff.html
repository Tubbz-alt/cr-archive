<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff make/jdk/src/classes/build/tools/cldrconverter/Bundle.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../netbeans/jmx/build.xml.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="CLDRConverter.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>make/jdk/src/classes/build/tools/cldrconverter/Bundle.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 189,10 ***</span>
<span class="line-new-header">--- 189,11 ---</span>
          }
  
          String[] cldrBundles = getCLDRPath().split(&quot;,&quot;);
  
          // myMap contains resources for id.
<span class="line-added">+         @SuppressWarnings(&quot;unchecked&quot;)</span>
          Map&lt;String, Object&gt; myMap = new HashMap&lt;&gt;();
          int index;
          for (index = 0; index &lt; cldrBundles.length; index++) {
              if (cldrBundles[index].equals(id)) {
                  myMap.putAll(CLDRConverter.getCLDRBundle(cldrBundles[index]));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 228,14 ***</span>
<span class="line-new-header">--- 229,16 ---</span>
                          createNumberArray(myMap, parentsMap, NUMBER_ELEMENT_KEYS, script));
              }
          }
  
          for (String k : COMPACT_NUMBER_PATTERN_KEYS) {
<span class="line-added">+             @SuppressWarnings(&quot;unchecked&quot;)</span>
              List&lt;String&gt; patterns = (List&lt;String&gt;) myMap.remove(k);
              if (patterns != null) {
                  // Convert the map value from List&lt;String&gt; to String[], replacing any missing
                  // entry from the parents map, if any.
<span class="line-added">+                 @SuppressWarnings(&quot;unchecked&quot;)</span>
                  final List&lt;String&gt; pList = (List&lt;String&gt;)parentsMap.get(k);
                  int size = patterns.size();
                  int psize = pList != null ? pList.size() : 0;
                  String[] arrPatterns = IntStream.range(0, Math.max(size, psize))
                      .mapToObj(i -&gt; {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 284,11 ***</span>
              handleMultipleInheritance(myMap, parentsMap, calendarPrefix + &quot;abbreviated.AmPmMarkers&quot;);
              handleMultipleInheritance(myMap, parentsMap, calendarPrefix + &quot;QuarterNames&quot;);
              handleMultipleInheritance(myMap, parentsMap, calendarPrefix + &quot;QuarterAbbreviations&quot;);
              handleMultipleInheritance(myMap, parentsMap, calendarPrefix + &quot;QuarterNarrows&quot;);
  
<span class="line-modified">!             adjustEraNames(myMap, calendarType);</span>
  
              handleDateTimeFormatPatterns(TIME_PATTERN_KEYS, myMap, parentsMap, calendarType, &quot;TimePatterns&quot;);
              handleDateTimeFormatPatterns(DATE_PATTERN_KEYS, myMap, parentsMap, calendarType, &quot;DatePatterns&quot;);
              handleDateTimeFormatPatterns(DATETIME_PATTERN_KEYS, myMap, parentsMap, calendarType, &quot;DateTimePatterns&quot;);
          }
<span class="line-new-header">--- 287,11 ---</span>
              handleMultipleInheritance(myMap, parentsMap, calendarPrefix + &quot;abbreviated.AmPmMarkers&quot;);
              handleMultipleInheritance(myMap, parentsMap, calendarPrefix + &quot;QuarterNames&quot;);
              handleMultipleInheritance(myMap, parentsMap, calendarPrefix + &quot;QuarterAbbreviations&quot;);
              handleMultipleInheritance(myMap, parentsMap, calendarPrefix + &quot;QuarterNarrows&quot;);
  
<span class="line-modified">!             adjustEraNames(myMap, parentsMap, calendarType);</span>
  
              handleDateTimeFormatPatterns(TIME_PATTERN_KEYS, myMap, parentsMap, calendarType, &quot;TimePatterns&quot;);
              handleDateTimeFormatPatterns(DATE_PATTERN_KEYS, myMap, parentsMap, calendarType, &quot;DatePatterns&quot;);
              handleDateTimeFormatPatterns(DATETIME_PATTERN_KEYS, myMap, parentsMap, calendarType, &quot;DateTimePatterns&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 408,12 ***</span>
              }
          }
      }
  
      /**
<span class="line-modified">!      * Fills in any empty elements with its parent element. Returns true if the resulting array is</span>
<span class="line-modified">!      * identical to its parent array.</span>
       *
       * @param parents
       * @param key
       * @param value
       * @return true if the resulting array is identical to its parent array.
<span class="line-new-header">--- 411,13 ---</span>
              }
          }
      }
  
      /**
<span class="line-modified">!      * Fills in any empty elements with its parent element, falling back to</span>
<span class="line-modified">!      * aliased one if parent element is not found. Returns true if the resulting</span>
<span class="line-added">+      * array is identical to its parent array.</span>
       *
       * @param parents
       * @param key
       * @param value
       * @return true if the resulting array is identical to its parent array.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 421,11 ***</span>
      private boolean fillInElements(Map&lt;String, Object&gt; parents, String key, Object value) {
          if (parents == null) {
              return false;
          }
          if (value instanceof String[]) {
<span class="line-modified">!             Object pvalue = parents.get(key);</span>
              if (pvalue != null &amp;&amp; pvalue instanceof String[]) {
                  String[] strings = (String[]) value;
                  String[] pstrings = (String[]) pvalue;
                  for (int i = 0; i &lt; strings.length; i++) {
                      if (strings[i] == null || strings[i].length() == 0) {
<span class="line-new-header">--- 425,11 ---</span>
      private boolean fillInElements(Map&lt;String, Object&gt; parents, String key, Object value) {
          if (parents == null) {
              return false;
          }
          if (value instanceof String[]) {
<span class="line-modified">!             Object pvalue = parents.getOrDefault(key, parents.get(CLDRConverter.aliases.get(key)));</span>
              if (pvalue != null &amp;&amp; pvalue instanceof String[]) {
                  String[] strings = (String[]) value;
                  String[] pstrings = (String[]) pvalue;
                  for (int i = 0; i &lt; strings.length; i++) {
                      if (strings[i] == null || strings[i].length() == 0) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 440,18 ***</span>
  
      /*
       * Adjusts String[] for era names because JRE&#39;s Calendars use different
       * ERA value indexes in the Buddhist, Japanese Imperial, and Islamic calendars.
       */
<span class="line-modified">!     private void adjustEraNames(Map&lt;String, Object&gt; map, CalendarType type) {</span>
          String[][] eraNames = new String[ERA_KEYS.length][];
          String[] realKeys = new String[ERA_KEYS.length];
          int index = 0;
          for (String key : ERA_KEYS) {
              String realKey = type.keyElementName() + key;
              String[] value = (String[]) map.get(realKey);
              if (value != null) {
                  switch (type) {
                  case GREGORIAN:
                      break;
  
                  case JAPANESE:
<span class="line-new-header">--- 444,21 ---</span>
  
      /*
       * Adjusts String[] for era names because JRE&#39;s Calendars use different
       * ERA value indexes in the Buddhist, Japanese Imperial, and Islamic calendars.
       */
<span class="line-modified">!     private void adjustEraNames(Map&lt;String, Object&gt; map, Map&lt;String, Object&gt; pMap, CalendarType type) {</span>
          String[][] eraNames = new String[ERA_KEYS.length][];
          String[] realKeys = new String[ERA_KEYS.length];
          int index = 0;
          for (String key : ERA_KEYS) {
              String realKey = type.keyElementName() + key;
              String[] value = (String[]) map.get(realKey);
              if (value != null) {
<span class="line-added">+                 // first fill in missing elements from parents map.</span>
<span class="line-added">+                 fillInElements(pMap, realKey, value);</span>
<span class="line-added">+ </span>
                  switch (type) {
                  case GREGORIAN:
                      break;
  
                  case JAPANESE:
</pre>
<center><a href="../../../../../netbeans/jmx/build.xml.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="CLDRConverter.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>