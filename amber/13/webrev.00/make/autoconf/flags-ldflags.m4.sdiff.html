<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/flags-ldflags.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="flags-cflags.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="hotspot.m4.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/flags-ldflags.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 52   FLAGS_SETUP_LDFLAGS_CPU_DEP([BUILD], [OPENJDK_BUILD_])
 53 
 54   LDFLAGS_TESTEXE=&quot;${TARGET_LDFLAGS_JDK_LIBPATH}&quot;
 55   AC_SUBST(LDFLAGS_TESTEXE)
 56 ])
 57 
 58 ################################################################################
 59 
 60 # CPU independent LDFLAGS setup, used for both target and build toolchain.
 61 AC_DEFUN([FLAGS_SETUP_LDFLAGS_HELPER],
 62 [
 63   # Setup basic LDFLAGS
 64   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
 65     # If this is a --hash-style=gnu system, use --hash-style=both, why?
 66     # We have previously set HAS_GNU_HASH if this is the case
 67     if test -n &quot;$HAS_GNU_HASH&quot;; then
 68       BASIC_LDFLAGS=&quot;-Wl,--hash-style=both&quot;
 69       LIBJSIG_HASHSTYLE_LDFLAGS=&quot;-Wl,--hash-style=both&quot;
 70     fi
 71 
<span class="line-modified"> 72     # Add -z defs, to forbid undefined symbols in object files.</span>
<span class="line-modified"> 73     # add relro (mark relocations read only) for all libs</span>
<span class="line-modified"> 74     BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -Wl,-z,defs -Wl,-z,relro&quot;</span>

 75     # Linux : remove unused code+data in link step
 76     if test &quot;x$ENABLE_LINKTIME_GC&quot; = xtrue; then
 77       if test &quot;x$OPENJDK_TARGET_CPU&quot; = xs390x; then
 78         BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -Wl,--gc-sections -Wl,--print-gc-sections&quot;
 79       else
 80         BASIC_LDFLAGS_JDK_ONLY=&quot;$BASIC_LDFLAGS_JDK_ONLY -Wl,--gc-sections&quot;
 81       fi
 82     fi
 83 
 84     BASIC_LDFLAGS_JVM_ONLY=&quot;-Wl,-O1&quot;
 85 
 86   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
 87     BASIC_LDFLAGS_JVM_ONLY=&quot;-mno-omit-leaf-frame-pointer -mstack-alignment=16 \
 88         -fPIC&quot;
 89 
 90   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
 91     BASIC_LDFLAGS=&quot;-Wl,-z,defs&quot;
 92     BASIC_LDFLAGS_ONLYCXX=&quot;-norunpath&quot;
 93     BASIC_LDFLAGS_ONLYCXX_JDK_ONLY=&quot;-xnolib&quot;
 94 
</pre>
<hr />
<pre>
112       BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -Wl,-z,noexecstack&quot;
113     fi
114   fi
115 
116   # Setup OS-dependent LDFLAGS
117   if test &quot;x$TOOLCHAIN_TYPE&quot; = xclang || test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
118     if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
119       # Assume clang or gcc.
120       # FIXME: We should really generalize SET_SHARED_LIBRARY_ORIGIN instead.
121       OS_LDFLAGS_JVM_ONLY=&quot;-Wl,-rpath,@loader_path/. -Wl,-rpath,@loader_path/..&quot;
122       OS_LDFLAGS_JDK_ONLY=&quot;-mmacosx-version-min=$MACOSX_VERSION_MIN&quot;
123     fi
124   fi
125 
126   # Setup debug level-dependent LDFLAGS
127   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
128     if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
129       if test x$DEBUG_LEVEL = xrelease; then
130         DEBUGLEVEL_LDFLAGS_JDK_ONLY=&quot;$DEBUGLEVEL_LDFLAGS_JDK_ONLY -Wl,-O1&quot;
131       fi
<span class="line-removed">132       if test x$DEBUG_LEVEL = xslowdebug; then</span>
<span class="line-removed">133         # do relocations at load</span>
<span class="line-removed">134         DEBUGLEVEL_LDFLAGS=&quot;-Wl,-z,now&quot;</span>
<span class="line-removed">135       fi</span>
136     fi
137 
138   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
139     # We need &#39;-qminimaltoc&#39; or &#39;-qpic=large -bbigtoc&#39; if the TOC overflows.
140     # Hotspot now overflows its 64K TOC (currently only for debug),
141     # so we build with &#39;-qpic=large -bbigtoc&#39;.
142     if test &quot;x$DEBUG_LEVEL&quot; != xrelease; then
143       DEBUGLEVEL_LDFLAGS_JVM_ONLY=&quot;$DEBUGLEVEL_LDFLAGS_JVM_ONLY -bbigtoc&quot;
144     fi
145   fi
146 
147   # Setup warning flags
148   if test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
149     LDFLAGS_WARNINGS_ARE_ERRORS=&quot;-Wl,-z,fatal-warnings&quot;
150   else
151     LDFLAGS_WARNINGS_ARE_ERRORS=&quot;&quot;
152   fi
153   AC_SUBST(LDFLAGS_WARNINGS_ARE_ERRORS)
154 
155   # Setup LDFLAGS for linking executables
</pre>
</td>
<td>
<hr />
<pre>
 52   FLAGS_SETUP_LDFLAGS_CPU_DEP([BUILD], [OPENJDK_BUILD_])
 53 
 54   LDFLAGS_TESTEXE=&quot;${TARGET_LDFLAGS_JDK_LIBPATH}&quot;
 55   AC_SUBST(LDFLAGS_TESTEXE)
 56 ])
 57 
 58 ################################################################################
 59 
 60 # CPU independent LDFLAGS setup, used for both target and build toolchain.
 61 AC_DEFUN([FLAGS_SETUP_LDFLAGS_HELPER],
 62 [
 63   # Setup basic LDFLAGS
 64   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
 65     # If this is a --hash-style=gnu system, use --hash-style=both, why?
 66     # We have previously set HAS_GNU_HASH if this is the case
 67     if test -n &quot;$HAS_GNU_HASH&quot;; then
 68       BASIC_LDFLAGS=&quot;-Wl,--hash-style=both&quot;
 69       LIBJSIG_HASHSTYLE_LDFLAGS=&quot;-Wl,--hash-style=both&quot;
 70     fi
 71 
<span class="line-modified"> 72     # Add -z,defs, to forbid undefined symbols in object files.</span>
<span class="line-modified"> 73     # add -z,relro (mark relocations read only) for all libs</span>
<span class="line-modified"> 74     # add -z,now (&quot;full relro&quot; - more of the Global Offset Table GOT is marked read only)</span>
<span class="line-added"> 75     BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -Wl,-z,defs -Wl,-z,relro -Wl,-z,now&quot;</span>
 76     # Linux : remove unused code+data in link step
 77     if test &quot;x$ENABLE_LINKTIME_GC&quot; = xtrue; then
 78       if test &quot;x$OPENJDK_TARGET_CPU&quot; = xs390x; then
 79         BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -Wl,--gc-sections -Wl,--print-gc-sections&quot;
 80       else
 81         BASIC_LDFLAGS_JDK_ONLY=&quot;$BASIC_LDFLAGS_JDK_ONLY -Wl,--gc-sections&quot;
 82       fi
 83     fi
 84 
 85     BASIC_LDFLAGS_JVM_ONLY=&quot;-Wl,-O1&quot;
 86 
 87   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
 88     BASIC_LDFLAGS_JVM_ONLY=&quot;-mno-omit-leaf-frame-pointer -mstack-alignment=16 \
 89         -fPIC&quot;
 90 
 91   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
 92     BASIC_LDFLAGS=&quot;-Wl,-z,defs&quot;
 93     BASIC_LDFLAGS_ONLYCXX=&quot;-norunpath&quot;
 94     BASIC_LDFLAGS_ONLYCXX_JDK_ONLY=&quot;-xnolib&quot;
 95 
</pre>
<hr />
<pre>
113       BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -Wl,-z,noexecstack&quot;
114     fi
115   fi
116 
117   # Setup OS-dependent LDFLAGS
118   if test &quot;x$TOOLCHAIN_TYPE&quot; = xclang || test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
119     if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
120       # Assume clang or gcc.
121       # FIXME: We should really generalize SET_SHARED_LIBRARY_ORIGIN instead.
122       OS_LDFLAGS_JVM_ONLY=&quot;-Wl,-rpath,@loader_path/. -Wl,-rpath,@loader_path/..&quot;
123       OS_LDFLAGS_JDK_ONLY=&quot;-mmacosx-version-min=$MACOSX_VERSION_MIN&quot;
124     fi
125   fi
126 
127   # Setup debug level-dependent LDFLAGS
128   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
129     if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
130       if test x$DEBUG_LEVEL = xrelease; then
131         DEBUGLEVEL_LDFLAGS_JDK_ONLY=&quot;$DEBUGLEVEL_LDFLAGS_JDK_ONLY -Wl,-O1&quot;
132       fi




133     fi
134 
135   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
136     # We need &#39;-qminimaltoc&#39; or &#39;-qpic=large -bbigtoc&#39; if the TOC overflows.
137     # Hotspot now overflows its 64K TOC (currently only for debug),
138     # so we build with &#39;-qpic=large -bbigtoc&#39;.
139     if test &quot;x$DEBUG_LEVEL&quot; != xrelease; then
140       DEBUGLEVEL_LDFLAGS_JVM_ONLY=&quot;$DEBUGLEVEL_LDFLAGS_JVM_ONLY -bbigtoc&quot;
141     fi
142   fi
143 
144   # Setup warning flags
145   if test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
146     LDFLAGS_WARNINGS_ARE_ERRORS=&quot;-Wl,-z,fatal-warnings&quot;
147   else
148     LDFLAGS_WARNINGS_ARE_ERRORS=&quot;&quot;
149   fi
150   AC_SUBST(LDFLAGS_WARNINGS_ARE_ERRORS)
151 
152   # Setup LDFLAGS for linking executables
</pre>
</td>
</tr>
</table>
<center><a href="flags-cflags.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="hotspot.m4.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>