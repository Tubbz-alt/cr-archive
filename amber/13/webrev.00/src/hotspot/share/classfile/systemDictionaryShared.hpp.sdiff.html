<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/classfile/systemDictionaryShared.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="systemDictionaryShared.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="vmSymbols.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/classfile/systemDictionaryShared.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
115     FROM_FIELD_IS_PROTECTED = 1 &lt;&lt; 0,
116     FROM_IS_ARRAY           = 1 &lt;&lt; 1,
117     FROM_IS_OBJECT          = 1 &lt;&lt; 2
118   };
119 
120 private:
121   // These _shared_xxxs arrays are used to initialize the java.lang.Package and
122   // java.security.ProtectionDomain objects associated with each shared class.
123   //
124   // See SystemDictionaryShared::init_security_info for more info.
125   static objArrayOop _shared_protection_domains;
126   static objArrayOop _shared_jar_urls;
127   static objArrayOop _shared_jar_manifests;
128 
129   static InstanceKlass* load_shared_class_for_builtin_loader(
130                                                Symbol* class_name,
131                                                Handle class_loader,
132                                                TRAPS);
133   static Handle get_package_name(Symbol*  class_name, TRAPS);
134 


135 
136   // Package handling:
137   //
138   // 1. For named modules in the runtime image
139   //    BOOT classes: Reuses the existing JVM_GetSystemPackage(s) interfaces
140   //                  to get packages in named modules for shared classes.
141   //                  Package for non-shared classes in named module is also
142   //                  handled using JVM_GetSystemPackage(s).
143   //
144   //    APP  classes: VM calls ClassLoaders.AppClassLoader::definePackage(String, Module)
145   //                  to define package for shared app classes from named
146   //                  modules.
147   //
148   //    PLATFORM  classes: VM calls ClassLoaders.PlatformClassLoader::definePackage(String, Module)
149   //                  to define package for shared platform classes from named
150   //                  modules.
151   //
152   // 2. For unnamed modules
153   //    BOOT classes: Reuses the existing JVM_GetSystemPackage(s) interfaces to
154   //                  get packages for shared boot classes in unnamed modules.
</pre>
<hr />
<pre>
163   static void define_shared_package(Symbol*  class_name,
164                                     Handle class_loader,
165                                     Handle manifest,
166                                     Handle url,
167                                     TRAPS);
168   static void define_shared_package(Symbol* class_name,
169                                     Handle class_loader,
170                                     ModuleEntry* mod_entry,
171                                     TRAPS);
172 
173   static Handle get_shared_jar_manifest(int shared_path_index, TRAPS);
174   static Handle get_shared_jar_url(int shared_path_index, TRAPS);
175   static Handle get_protection_domain_from_classloader(Handle class_loader,
176                                                        Handle url, TRAPS);
177   static Handle get_shared_protection_domain(Handle class_loader,
178                                              int shared_path_index,
179                                              Handle url,
180                                              TRAPS);
181   static Handle get_shared_protection_domain(Handle class_loader,
182                                              ModuleEntry* mod, TRAPS);
<span class="line-modified">183   static Handle init_security_info(Handle class_loader, InstanceKlass* ik, TRAPS);</span>
184 
185   static void atomic_set_array_index(objArrayOop array, int index, oop o) {
186     // Benign race condition:  array.obj_at(index) may already be filled in.
187     // The important thing here is that all threads pick up the same result.
188     // It doesn&#39;t matter which racing thread wins, as long as only one
189     // result is used by all threads, and all future queries.
190     array-&gt;atomic_compare_exchange_oop(index, o, NULL);
191   }
192 
193   static oop shared_protection_domain(int index);
194   static void atomic_set_shared_protection_domain(int index, oop pd) {
195     atomic_set_array_index(_shared_protection_domains, index, pd);
196   }
197   static void allocate_shared_protection_domain_array(int size, TRAPS);
198   static oop shared_jar_url(int index);
199   static void atomic_set_shared_jar_url(int index, oop url) {
200     atomic_set_array_index(_shared_jar_urls, index, url);
201   }
202   static void allocate_shared_jar_url_array(int size, TRAPS);
203   static oop shared_jar_manifest(int index);
</pre>
<hr />
<pre>
229 
230   static bool has_platform_or_app_classes();
231 
232   // Called by PLATFORM/APP loader only
233   static InstanceKlass* find_or_load_shared_class(Symbol* class_name,
234                                                Handle class_loader,
235                                                TRAPS);
236 
237 
238   static void allocate_shared_data_arrays(int size, TRAPS);
239   static void oops_do(OopClosure* f);
240 
241   // Check if sharing is supported for the class loader.
242   static bool is_sharing_possible(ClassLoaderData* loader_data);
243   static bool is_shared_class_visible_for_classloader(InstanceKlass* ik,
244                                                       Handle class_loader,
245                                                       Symbol* pkg_name,
246                                                       PackageEntry* pkg_entry,
247                                                       ModuleEntry* mod_entry,
248                                                       TRAPS);
<span class="line-removed">249   static PackageEntry* get_package_entry(Symbol* pkg,</span>
<span class="line-removed">250                                          ClassLoaderData *loader_data) {</span>
<span class="line-removed">251     if (loader_data != NULL) {</span>
<span class="line-removed">252       PackageEntryTable* pkgEntryTable = loader_data-&gt;packages();</span>
<span class="line-removed">253       return pkgEntryTable-&gt;lookup_only(pkg);</span>
<span class="line-removed">254     }</span>
<span class="line-removed">255     return NULL;</span>
<span class="line-removed">256   }</span>
257 
258   static bool add_unregistered_class(InstanceKlass* k, TRAPS);
259   static InstanceKlass* dump_time_resolve_super_or_fail(Symbol* child_name,
260                                                 Symbol* class_name,
261                                                 Handle class_loader,
262                                                 Handle protection_domain,
263                                                 bool is_superclass,
264                                                 TRAPS);
265 
266   static void init_dumptime_info(InstanceKlass* k) NOT_CDS_RETURN;
267   static void remove_dumptime_info(InstanceKlass* k) NOT_CDS_RETURN;
268 
269   static Dictionary* boot_loader_dictionary() {
270     return ClassLoaderData::the_null_class_loader_data()-&gt;dictionary();
271   }
272 
273   static void update_shared_entry(InstanceKlass* klass, int id);
274   static void set_shared_class_misc_info(InstanceKlass* k, ClassFileStream* cfs);
275 
276   static InstanceKlass* lookup_from_stream(Symbol* class_name,
</pre>
</td>
<td>
<hr />
<pre>
115     FROM_FIELD_IS_PROTECTED = 1 &lt;&lt; 0,
116     FROM_IS_ARRAY           = 1 &lt;&lt; 1,
117     FROM_IS_OBJECT          = 1 &lt;&lt; 2
118   };
119 
120 private:
121   // These _shared_xxxs arrays are used to initialize the java.lang.Package and
122   // java.security.ProtectionDomain objects associated with each shared class.
123   //
124   // See SystemDictionaryShared::init_security_info for more info.
125   static objArrayOop _shared_protection_domains;
126   static objArrayOop _shared_jar_urls;
127   static objArrayOop _shared_jar_manifests;
128 
129   static InstanceKlass* load_shared_class_for_builtin_loader(
130                                                Symbol* class_name,
131                                                Handle class_loader,
132                                                TRAPS);
133   static Handle get_package_name(Symbol*  class_name, TRAPS);
134 
<span class="line-added">135   static PackageEntry* get_package_entry_from_class_name(Handle class_loader, Symbol* class_name);</span>
<span class="line-added">136 </span>
137 
138   // Package handling:
139   //
140   // 1. For named modules in the runtime image
141   //    BOOT classes: Reuses the existing JVM_GetSystemPackage(s) interfaces
142   //                  to get packages in named modules for shared classes.
143   //                  Package for non-shared classes in named module is also
144   //                  handled using JVM_GetSystemPackage(s).
145   //
146   //    APP  classes: VM calls ClassLoaders.AppClassLoader::definePackage(String, Module)
147   //                  to define package for shared app classes from named
148   //                  modules.
149   //
150   //    PLATFORM  classes: VM calls ClassLoaders.PlatformClassLoader::definePackage(String, Module)
151   //                  to define package for shared platform classes from named
152   //                  modules.
153   //
154   // 2. For unnamed modules
155   //    BOOT classes: Reuses the existing JVM_GetSystemPackage(s) interfaces to
156   //                  get packages for shared boot classes in unnamed modules.
</pre>
<hr />
<pre>
165   static void define_shared_package(Symbol*  class_name,
166                                     Handle class_loader,
167                                     Handle manifest,
168                                     Handle url,
169                                     TRAPS);
170   static void define_shared_package(Symbol* class_name,
171                                     Handle class_loader,
172                                     ModuleEntry* mod_entry,
173                                     TRAPS);
174 
175   static Handle get_shared_jar_manifest(int shared_path_index, TRAPS);
176   static Handle get_shared_jar_url(int shared_path_index, TRAPS);
177   static Handle get_protection_domain_from_classloader(Handle class_loader,
178                                                        Handle url, TRAPS);
179   static Handle get_shared_protection_domain(Handle class_loader,
180                                              int shared_path_index,
181                                              Handle url,
182                                              TRAPS);
183   static Handle get_shared_protection_domain(Handle class_loader,
184                                              ModuleEntry* mod, TRAPS);
<span class="line-modified">185   static Handle init_security_info(Handle class_loader, InstanceKlass* ik, PackageEntry* pkg_entry, TRAPS);</span>
186 
187   static void atomic_set_array_index(objArrayOop array, int index, oop o) {
188     // Benign race condition:  array.obj_at(index) may already be filled in.
189     // The important thing here is that all threads pick up the same result.
190     // It doesn&#39;t matter which racing thread wins, as long as only one
191     // result is used by all threads, and all future queries.
192     array-&gt;atomic_compare_exchange_oop(index, o, NULL);
193   }
194 
195   static oop shared_protection_domain(int index);
196   static void atomic_set_shared_protection_domain(int index, oop pd) {
197     atomic_set_array_index(_shared_protection_domains, index, pd);
198   }
199   static void allocate_shared_protection_domain_array(int size, TRAPS);
200   static oop shared_jar_url(int index);
201   static void atomic_set_shared_jar_url(int index, oop url) {
202     atomic_set_array_index(_shared_jar_urls, index, url);
203   }
204   static void allocate_shared_jar_url_array(int size, TRAPS);
205   static oop shared_jar_manifest(int index);
</pre>
<hr />
<pre>
231 
232   static bool has_platform_or_app_classes();
233 
234   // Called by PLATFORM/APP loader only
235   static InstanceKlass* find_or_load_shared_class(Symbol* class_name,
236                                                Handle class_loader,
237                                                TRAPS);
238 
239 
240   static void allocate_shared_data_arrays(int size, TRAPS);
241   static void oops_do(OopClosure* f);
242 
243   // Check if sharing is supported for the class loader.
244   static bool is_sharing_possible(ClassLoaderData* loader_data);
245   static bool is_shared_class_visible_for_classloader(InstanceKlass* ik,
246                                                       Handle class_loader,
247                                                       Symbol* pkg_name,
248                                                       PackageEntry* pkg_entry,
249                                                       ModuleEntry* mod_entry,
250                                                       TRAPS);








251 
252   static bool add_unregistered_class(InstanceKlass* k, TRAPS);
253   static InstanceKlass* dump_time_resolve_super_or_fail(Symbol* child_name,
254                                                 Symbol* class_name,
255                                                 Handle class_loader,
256                                                 Handle protection_domain,
257                                                 bool is_superclass,
258                                                 TRAPS);
259 
260   static void init_dumptime_info(InstanceKlass* k) NOT_CDS_RETURN;
261   static void remove_dumptime_info(InstanceKlass* k) NOT_CDS_RETURN;
262 
263   static Dictionary* boot_loader_dictionary() {
264     return ClassLoaderData::the_null_class_loader_data()-&gt;dictionary();
265   }
266 
267   static void update_shared_entry(InstanceKlass* klass, int id);
268   static void set_shared_class_misc_info(InstanceKlass* k, ClassFileStream* cfs);
269 
270   static InstanceKlass* lookup_from_stream(Symbol* class_name,
</pre>
</td>
</tr>
</table>
<center><a href="systemDictionaryShared.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="vmSymbols.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>