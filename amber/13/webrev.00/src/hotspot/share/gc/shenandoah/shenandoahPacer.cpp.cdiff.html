<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/gc/shenandoah/shenandoahPacer.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahOopClosures.inline.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahPacer.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/shenandoahPacer.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 126,37 ***</span>
                       byte_size_in_proper_unit(free),        proper_unit_for_byte_size(free),
                       byte_size_in_proper_unit(non_taxable), proper_unit_for_byte_size(non_taxable),
                       tax);
  }
  
<span class="line-removed">- /*</span>
<span class="line-removed">-  * Traversal walks the entire heap once, and therefore we have to make assumptions about its</span>
<span class="line-removed">-  * liveness, like concurrent mark does.</span>
<span class="line-removed">-  */</span>
<span class="line-removed">- </span>
<span class="line-removed">- void ShenandoahPacer::setup_for_traversal() {</span>
<span class="line-removed">-   assert(ShenandoahPacing, &quot;Only be here when pacing is enabled&quot;);</span>
<span class="line-removed">- </span>
<span class="line-removed">-   size_t live = update_and_get_progress_history();</span>
<span class="line-removed">-   size_t free = _heap-&gt;free_set()-&gt;available();</span>
<span class="line-removed">- </span>
<span class="line-removed">-   size_t non_taxable = free * ShenandoahPacingCycleSlack / 100;</span>
<span class="line-removed">-   size_t taxable = free - non_taxable;</span>
<span class="line-removed">- </span>
<span class="line-removed">-   double tax = 1.0 * live / taxable; // base tax for available free space</span>
<span class="line-removed">-   tax *= ShenandoahPacingSurcharge;  // additional surcharge to help unclutter heap</span>
<span class="line-removed">- </span>
<span class="line-removed">-   restart_with(non_taxable, tax);</span>
<span class="line-removed">- </span>
<span class="line-removed">-   log_info(gc, ergo)(&quot;Pacer for Traversal. Expected Live: &quot; SIZE_FORMAT &quot;%s, Free: &quot; SIZE_FORMAT &quot;%s, &quot;</span>
<span class="line-removed">-                      &quot;Non-Taxable: &quot; SIZE_FORMAT &quot;%s, Alloc Tax Rate: %.1fx&quot;,</span>
<span class="line-removed">-                      byte_size_in_proper_unit(live),        proper_unit_for_byte_size(live),</span>
<span class="line-removed">-                      byte_size_in_proper_unit(free),        proper_unit_for_byte_size(free),</span>
<span class="line-removed">-                      byte_size_in_proper_unit(non_taxable), proper_unit_for_byte_size(non_taxable),</span>
<span class="line-removed">-                      tax);</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
  /*
   * In idle phase, we have to pace the application to let control thread react with GC start.
   *
   * Here, we have rendezvous with concurrent thread that adds up the budget as it acknowledges
   * it had seen recent allocations. It will naturally pace the allocations if control thread is
<span class="line-new-header">--- 126,10 ---</span>
</pre>
<center><a href="shenandoahOopClosures.inline.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahPacer.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>