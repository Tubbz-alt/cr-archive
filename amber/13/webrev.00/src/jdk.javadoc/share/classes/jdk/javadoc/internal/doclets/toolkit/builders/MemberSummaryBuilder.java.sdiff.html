<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/builders/MemberSummaryBuilder.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="FieldBuilder.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="MethodBuilder.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/builders/MemberSummaryBuilder.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.javadoc.internal.doclets.toolkit.builders;
 27 
 28 import java.text.MessageFormat;
 29 import java.util.*;
 30 import java.util.stream.Collectors;
 31 
 32 import javax.lang.model.element.Element;
 33 import javax.lang.model.element.ExecutableElement;
 34 import javax.lang.model.element.TypeElement;
 35 import javax.lang.model.element.VariableElement;
 36 import javax.lang.model.util.ElementFilter;
 37 
 38 import com.sun.source.doctree.DocCommentTree;
 39 import com.sun.source.doctree.DocTree;
 40 import com.sun.source.doctree.DocTree.Kind;
 41 import com.sun.source.doctree.UnknownBlockTagTree;
<span class="line-removed"> 42 import jdk.javadoc.internal.doclets.toolkit.AnnotationTypeWriter;</span>
 43 import jdk.javadoc.internal.doclets.toolkit.ClassWriter;
 44 import jdk.javadoc.internal.doclets.toolkit.Content;
 45 import jdk.javadoc.internal.doclets.toolkit.MemberSummaryWriter;
 46 import jdk.javadoc.internal.doclets.toolkit.WriterFactory;
 47 import jdk.javadoc.internal.doclets.toolkit.util.CommentHelper;
 48 import jdk.javadoc.internal.doclets.toolkit.util.DocFinder;
 49 import jdk.javadoc.internal.doclets.toolkit.util.VisibleMemberTable;
 50 import jdk.javadoc.internal.doclets.toolkit.CommentUtils;
 51 
 52 import static jdk.javadoc.internal.doclets.toolkit.util.VisibleMemberTable.Kind.*;
 53 
 54 /**
 55  * Builds the member summary.
 56  * There are two anonymous subtype variants of this builder, created
 57  * in the {@link #getInstance} methods. One is for general types;
 58  * the other is for annotation types.
 59  *
 60  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
 61  *  If you write code that depends on this, you do so at your own risk.
 62  *  This code and its internal interfaces are subject to change or
</pre>
<hr />
<pre>
 68      * Comparator used to sort the members in the summary.
 69      */
 70     private final Comparator&lt;Element&gt; comparator;
 71 
 72     /**
 73      * The member summary writers for the given class.
 74      */
 75     private final EnumMap&lt;VisibleMemberTable.Kind, MemberSummaryWriter&gt; memberSummaryWriters;
 76 
 77     final PropertyHelper pHelper;
 78 
 79     /**
 80      * Construct a new MemberSummaryBuilder.
 81      *
 82      * @param context       the build context.
 83      * @param typeElement   the type element.
 84      */
 85     private MemberSummaryBuilder(Context context, TypeElement typeElement) {
 86         super(context, typeElement);
 87         memberSummaryWriters = new EnumMap&lt;&gt;(VisibleMemberTable.Kind.class);
<span class="line-modified"> 88         comparator = utils.makeIndexUseComparator();</span>
 89         pHelper = new PropertyHelper(this);
 90     }
 91 
 92     /**
 93      * Construct a new MemberSummaryBuilder for a general type.
 94      *
 95      * @param classWriter   the writer for the class whose members are being
 96      *                      summarized.
 97      * @param context       the build context.
 98      * @return              the instance
 99      */
100     public static MemberSummaryBuilder getInstance(
101             ClassWriter classWriter, Context context) {
102         MemberSummaryBuilder builder = new MemberSummaryBuilder(context, classWriter.getTypeElement()) {
103             @Override
104             public void build(Content contentTree) {
105                 buildPropertiesSummary(contentTree);
106                 buildNestedClassesSummary(contentTree);
107                 buildEnumConstantsSummary(contentTree);


108                 buildFieldsSummary(contentTree);
109                 buildConstructorsSummary(contentTree);
110                 buildMethodsSummary(contentTree);
111             }
112 
113             @Override
114             public boolean hasMembersToDocument() {
115                 return visibleMemberTable.hasVisibleMembers();
116             }
117         };
118         WriterFactory wf = context.configuration.getWriterFactory();
119         for (VisibleMemberTable.Kind kind : VisibleMemberTable.Kind.values()) {
120             MemberSummaryWriter msw = builder.getVisibleMemberTable().hasVisibleMembers(kind)
121                     ? wf.getMemberSummaryWriter(classWriter, kind)
122                     : null;
123             builder.memberSummaryWriters.put(kind, msw);
124         }
125         return builder;
126     }
127 
<span class="line-removed">128     /**</span>
<span class="line-removed">129      * Construct a new MemberSummaryBuilder for an annotation type.</span>
<span class="line-removed">130      *</span>
<span class="line-removed">131      * @param annotationTypeWriter the writer for the class whose members are</span>
<span class="line-removed">132      *                             being summarized.</span>
<span class="line-removed">133      * @param context       the build context.</span>
<span class="line-removed">134      * @return              the instance</span>
<span class="line-removed">135      */</span>
<span class="line-removed">136     public static MemberSummaryBuilder getInstance(</span>
<span class="line-removed">137             AnnotationTypeWriter annotationTypeWriter, Context context) {</span>
<span class="line-removed">138         MemberSummaryBuilder builder = new MemberSummaryBuilder(context,</span>
<span class="line-removed">139                 annotationTypeWriter.getAnnotationTypeElement()) {</span>
<span class="line-removed">140             @Override</span>
<span class="line-removed">141             public void build(Content contentTree) {</span>
<span class="line-removed">142                 buildAnnotationTypeFieldsSummary(contentTree);</span>
<span class="line-removed">143                 buildAnnotationTypeRequiredMemberSummary(contentTree);</span>
<span class="line-removed">144                 buildAnnotationTypeOptionalMemberSummary(contentTree);</span>
<span class="line-removed">145             }</span>
<span class="line-removed">146 </span>
<span class="line-removed">147             @Override</span>
<span class="line-removed">148             public boolean hasMembersToDocument() {</span>
<span class="line-removed">149                 return !utils.getAnnotationMembers(typeElement).isEmpty();</span>
<span class="line-removed">150             }</span>
<span class="line-removed">151         };</span>
<span class="line-removed">152         WriterFactory wf = context.configuration.getWriterFactory();</span>
<span class="line-removed">153         for (VisibleMemberTable.Kind kind : VisibleMemberTable.Kind.values()) {</span>
<span class="line-removed">154             MemberSummaryWriter msw = builder.getVisibleMemberTable().hasVisibleMembers(kind)</span>
<span class="line-removed">155                     ? wf.getMemberSummaryWriter(annotationTypeWriter, kind)</span>
<span class="line-removed">156                     : null;</span>
<span class="line-removed">157             builder.memberSummaryWriters.put(kind, msw);</span>
<span class="line-removed">158         }</span>
<span class="line-removed">159         return builder;</span>
<span class="line-removed">160     }</span>
<span class="line-removed">161 </span>
162     /**
163      * Return the specified visible member map.
164      *
165      * @return the specified visible member map.
166      * @throws ArrayIndexOutOfBoundsException when the type is invalid.
167      * @see VisibleMemberTable
168      */
169     public VisibleMemberTable getVisibleMemberTable() {
170         return visibleMemberTable;
171     }
172 
173     /**.
174      * Return the specified member summary writer.
175      *
176      * @param kind the kind of member summary writer to return.
177      * @return the specified member summary writer.
178      * @throws ArrayIndexOutOfBoundsException when the type is invalid.
179      * @see VisibleMemberTable
180      */
181     public MemberSummaryWriter getMemberSummaryWriter(VisibleMemberTable.Kind kind) {
</pre>
<hr />
<pre>
205     public boolean hasMembers(VisibleMemberTable.Kind kind) {
206         return !getVisibleMembers(kind).isEmpty();
207     }
208 
209     /**
210      * Build the summary for the enum constants.
211      *
212      * @param memberSummaryTree the content tree to which the documentation will be added
213      */
214     protected void buildEnumConstantsSummary(Content memberSummaryTree) {
215         MemberSummaryWriter writer = memberSummaryWriters.get(ENUM_CONSTANTS);
216         addSummary(writer, ENUM_CONSTANTS, false, memberSummaryTree);
217     }
218 
219     /**
220      * Build the summary for fields.
221      *
222      * @param memberSummaryTree the content tree to which the documentation will be added
223      */
224     protected void buildAnnotationTypeFieldsSummary(Content memberSummaryTree) {
<span class="line-modified">225         MemberSummaryWriter writer = memberSummaryWriters.get(ANNOTATION_TYPE_FIELDS);</span>
<span class="line-modified">226         addSummary(writer, ANNOTATION_TYPE_FIELDS, false, memberSummaryTree);</span>
227     }
228 
229     /**
230      * Build the summary for the optional members.
231      *
232      * @param memberSummaryTree the content tree to which the documentation will be added
233      */
234     protected void buildAnnotationTypeOptionalMemberSummary(Content memberSummaryTree) {
235         MemberSummaryWriter writer = memberSummaryWriters.get(ANNOTATION_TYPE_MEMBER_OPTIONAL);
236         addSummary(writer, ANNOTATION_TYPE_MEMBER_OPTIONAL, false, memberSummaryTree);
237     }
238 
239     /**
240      * Build the summary for the optional members.
241      *
242      * @param memberSummaryTree the content tree to which the documentation will be added
243      */
244     protected void buildAnnotationTypeRequiredMemberSummary(Content memberSummaryTree) {
245         MemberSummaryWriter writer = memberSummaryWriters.get(ANNOTATION_TYPE_MEMBER_REQUIRED);
246         addSummary(writer, ANNOTATION_TYPE_MEMBER_REQUIRED, false, memberSummaryTree);
</pre>
</td>
<td>
<hr />
<pre>
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.javadoc.internal.doclets.toolkit.builders;
 27 
 28 import java.text.MessageFormat;
 29 import java.util.*;
 30 import java.util.stream.Collectors;
 31 
 32 import javax.lang.model.element.Element;
 33 import javax.lang.model.element.ExecutableElement;
 34 import javax.lang.model.element.TypeElement;
 35 import javax.lang.model.element.VariableElement;
 36 import javax.lang.model.util.ElementFilter;
 37 
 38 import com.sun.source.doctree.DocCommentTree;
 39 import com.sun.source.doctree.DocTree;
 40 import com.sun.source.doctree.DocTree.Kind;
 41 import com.sun.source.doctree.UnknownBlockTagTree;

 42 import jdk.javadoc.internal.doclets.toolkit.ClassWriter;
 43 import jdk.javadoc.internal.doclets.toolkit.Content;
 44 import jdk.javadoc.internal.doclets.toolkit.MemberSummaryWriter;
 45 import jdk.javadoc.internal.doclets.toolkit.WriterFactory;
 46 import jdk.javadoc.internal.doclets.toolkit.util.CommentHelper;
 47 import jdk.javadoc.internal.doclets.toolkit.util.DocFinder;
 48 import jdk.javadoc.internal.doclets.toolkit.util.VisibleMemberTable;
 49 import jdk.javadoc.internal.doclets.toolkit.CommentUtils;
 50 
 51 import static jdk.javadoc.internal.doclets.toolkit.util.VisibleMemberTable.Kind.*;
 52 
 53 /**
 54  * Builds the member summary.
 55  * There are two anonymous subtype variants of this builder, created
 56  * in the {@link #getInstance} methods. One is for general types;
 57  * the other is for annotation types.
 58  *
 59  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
 60  *  If you write code that depends on this, you do so at your own risk.
 61  *  This code and its internal interfaces are subject to change or
</pre>
<hr />
<pre>
 67      * Comparator used to sort the members in the summary.
 68      */
 69     private final Comparator&lt;Element&gt; comparator;
 70 
 71     /**
 72      * The member summary writers for the given class.
 73      */
 74     private final EnumMap&lt;VisibleMemberTable.Kind, MemberSummaryWriter&gt; memberSummaryWriters;
 75 
 76     final PropertyHelper pHelper;
 77 
 78     /**
 79      * Construct a new MemberSummaryBuilder.
 80      *
 81      * @param context       the build context.
 82      * @param typeElement   the type element.
 83      */
 84     private MemberSummaryBuilder(Context context, TypeElement typeElement) {
 85         super(context, typeElement);
 86         memberSummaryWriters = new EnumMap&lt;&gt;(VisibleMemberTable.Kind.class);
<span class="line-modified"> 87         comparator = utils.comparators.makeIndexElementComparator();</span>
 88         pHelper = new PropertyHelper(this);
 89     }
 90 
 91     /**
 92      * Construct a new MemberSummaryBuilder for a general type.
 93      *
 94      * @param classWriter   the writer for the class whose members are being
 95      *                      summarized.
 96      * @param context       the build context.
 97      * @return              the instance
 98      */
 99     public static MemberSummaryBuilder getInstance(
100             ClassWriter classWriter, Context context) {
101         MemberSummaryBuilder builder = new MemberSummaryBuilder(context, classWriter.getTypeElement()) {
102             @Override
103             public void build(Content contentTree) {
104                 buildPropertiesSummary(contentTree);
105                 buildNestedClassesSummary(contentTree);
106                 buildEnumConstantsSummary(contentTree);
<span class="line-added">107                 buildAnnotationTypeRequiredMemberSummary(contentTree);</span>
<span class="line-added">108                 buildAnnotationTypeOptionalMemberSummary(contentTree);</span>
109                 buildFieldsSummary(contentTree);
110                 buildConstructorsSummary(contentTree);
111                 buildMethodsSummary(contentTree);
112             }
113 
114             @Override
115             public boolean hasMembersToDocument() {
116                 return visibleMemberTable.hasVisibleMembers();
117             }
118         };
119         WriterFactory wf = context.configuration.getWriterFactory();
120         for (VisibleMemberTable.Kind kind : VisibleMemberTable.Kind.values()) {
121             MemberSummaryWriter msw = builder.getVisibleMemberTable().hasVisibleMembers(kind)
122                     ? wf.getMemberSummaryWriter(classWriter, kind)
123                     : null;
124             builder.memberSummaryWriters.put(kind, msw);
125         }
126         return builder;
127     }
128 


































129     /**
130      * Return the specified visible member map.
131      *
132      * @return the specified visible member map.
133      * @throws ArrayIndexOutOfBoundsException when the type is invalid.
134      * @see VisibleMemberTable
135      */
136     public VisibleMemberTable getVisibleMemberTable() {
137         return visibleMemberTable;
138     }
139 
140     /**.
141      * Return the specified member summary writer.
142      *
143      * @param kind the kind of member summary writer to return.
144      * @return the specified member summary writer.
145      * @throws ArrayIndexOutOfBoundsException when the type is invalid.
146      * @see VisibleMemberTable
147      */
148     public MemberSummaryWriter getMemberSummaryWriter(VisibleMemberTable.Kind kind) {
</pre>
<hr />
<pre>
172     public boolean hasMembers(VisibleMemberTable.Kind kind) {
173         return !getVisibleMembers(kind).isEmpty();
174     }
175 
176     /**
177      * Build the summary for the enum constants.
178      *
179      * @param memberSummaryTree the content tree to which the documentation will be added
180      */
181     protected void buildEnumConstantsSummary(Content memberSummaryTree) {
182         MemberSummaryWriter writer = memberSummaryWriters.get(ENUM_CONSTANTS);
183         addSummary(writer, ENUM_CONSTANTS, false, memberSummaryTree);
184     }
185 
186     /**
187      * Build the summary for fields.
188      *
189      * @param memberSummaryTree the content tree to which the documentation will be added
190      */
191     protected void buildAnnotationTypeFieldsSummary(Content memberSummaryTree) {
<span class="line-modified">192         MemberSummaryWriter writer = memberSummaryWriters.get(FIELDS);</span>
<span class="line-modified">193         addSummary(writer, FIELDS, false, memberSummaryTree);</span>
194     }
195 
196     /**
197      * Build the summary for the optional members.
198      *
199      * @param memberSummaryTree the content tree to which the documentation will be added
200      */
201     protected void buildAnnotationTypeOptionalMemberSummary(Content memberSummaryTree) {
202         MemberSummaryWriter writer = memberSummaryWriters.get(ANNOTATION_TYPE_MEMBER_OPTIONAL);
203         addSummary(writer, ANNOTATION_TYPE_MEMBER_OPTIONAL, false, memberSummaryTree);
204     }
205 
206     /**
207      * Build the summary for the optional members.
208      *
209      * @param memberSummaryTree the content tree to which the documentation will be added
210      */
211     protected void buildAnnotationTypeRequiredMemberSummary(Content memberSummaryTree) {
212         MemberSummaryWriter writer = memberSummaryWriters.get(ANNOTATION_TYPE_MEMBER_REQUIRED);
213         addSummary(writer, ANNOTATION_TYPE_MEMBER_REQUIRED, false, memberSummaryTree);
</pre>
</td>
</tr>
</table>
<center><a href="FieldBuilder.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="MethodBuilder.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>