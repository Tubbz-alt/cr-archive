<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/AbstractIndexWriter.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AbstractExecutableMemberWriter.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="AbstractMemberWriter.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/AbstractIndexWriter.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -25,37 +25,38 @@</span>
  
  package jdk.javadoc.internal.doclets.formats.html;
  
  import java.io.IOException;
  import java.io.Writer;
<span class="udiff-line-modified-removed">- import java.util.ArrayList;</span>
<span class="udiff-line-removed">- import java.util.Collection;</span>
<span class="udiff-line-removed">- import java.util.HashMap;</span>
<span class="udiff-line-modified-added">+ import java.util.Iterator;</span>
  import java.util.List;
  import java.util.Map;
<span class="udiff-line-added">+ import java.util.stream.Collectors;</span>
<span class="udiff-line-added">+ import java.util.stream.Stream;</span>
  
  import javax.lang.model.element.Element;
<span class="udiff-line-added">+ import javax.lang.model.element.ElementKind;</span>
  import javax.lang.model.element.ExecutableElement;
  import javax.lang.model.element.ModuleElement;
  import javax.lang.model.element.PackageElement;
  import javax.lang.model.element.TypeElement;
<span class="udiff-line-removed">- import javax.lang.model.util.SimpleElementVisitor14;</span>
  
  import com.sun.source.doctree.DocTree;
<span class="udiff-line-added">+ import jdk.javadoc.internal.doclets.formats.html.SearchIndexItem.Category;</span>
  import jdk.javadoc.internal.doclets.formats.html.markup.Entity;
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlStyle;
<span class="udiff-line-modified-removed">- import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTag;</span>
<span class="udiff-line-modified-added">+ import jdk.javadoc.internal.doclets.formats.html.markup.TagName;</span>
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTree;
<span class="udiff-line-modified-removed">- import jdk.javadoc.internal.doclets.formats.html.markup.Navigation;</span>
<span class="udiff-line-removed">- import jdk.javadoc.internal.doclets.formats.html.markup.Navigation.PageMode;</span>
<span class="udiff-line-modified-added">+ import jdk.javadoc.internal.doclets.formats.html.Navigation.PageMode;</span>
  import jdk.javadoc.internal.doclets.formats.html.markup.StringContent;
  import jdk.javadoc.internal.doclets.toolkit.Content;
  import jdk.javadoc.internal.doclets.toolkit.util.DocFile;
  import jdk.javadoc.internal.doclets.toolkit.util.DocFileIOException;
  import jdk.javadoc.internal.doclets.toolkit.util.DocPath;
  import jdk.javadoc.internal.doclets.toolkit.util.DocPaths;
  import jdk.javadoc.internal.doclets.toolkit.util.IndexBuilder;
<span class="udiff-line-added">+ import jdk.javadoc.internal.doclets.toolkit.util.IndexItem;</span>
  
  /**
   * Generate Index for all the Member Names with Indexing in
   * Unicode Order. This class is a base class for {@link SingleIndexWriter} and
   * {@link SplitIndexWriter}. It uses the functionality from
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -91,201 +92,108 @@</span>
                                    DocPath path,
                                    IndexBuilder indexBuilder) {
          super(configuration, path);
          this.indexBuilder = indexBuilder;
          this.navBar = new Navigation(null, configuration, PageMode.INDEX, path);
<span class="udiff-line-modified-removed">-         Collection&lt;SearchIndexItem&gt; items =</span>
<span class="udiff-line-modified-removed">-                 searchItems.get(SearchIndexItem.Category.SEARCH_TAGS);</span>
<span class="udiff-line-modified-added">+         Stream&lt;SearchIndexItem&gt; items =</span>
<span class="udiff-line-modified-added">+                 searchItems.itemsOfCategories(Category.INDEX, Category.SYSTEM_PROPERTY)</span>
<span class="udiff-line-added">+                         .sorted(comparators.makeGenericSearchIndexComparator());</span>
          this.tagSearchIndexMap = buildSearchTagIndex(items);
      }
  
<span class="udiff-line-modified-removed">-     /**</span>
<span class="udiff-line-removed">-      * Add the member information for the unicode character along with the</span>
<span class="udiff-line-removed">-      * list of the members.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @param uc Unicode for which member list information to be generated</span>
<span class="udiff-line-removed">-      * @param memberlist List of members for the unicode character</span>
<span class="udiff-line-removed">-      * @param contentTree the content tree to which the information will be added</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     protected void addContents(Character uc, Collection&lt;? extends Element&gt; memberlist,</span>
<span class="udiff-line-modified-added">+     protected void addContents(Character uc, List&lt;IndexItem&gt; memberlist,</span>
              Content contentTree) {
          addHeading(uc, contentTree);
<span class="udiff-line-removed">-         // Display the list only if there are elements to be displayed.</span>
<span class="udiff-line-removed">-         if (!memberlist.isEmpty()) {</span>
<span class="udiff-line-removed">-             HtmlTree dl = HtmlTree.DL(HtmlStyle.index);</span>
<span class="udiff-line-removed">-             for (Element element : memberlist) {</span>
<span class="udiff-line-removed">-                 addDescription(dl, element);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             contentTree.add(dl);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-     }</span>
  
<span class="udiff-line-removed">-     protected void addSearchContents(Character uc, List&lt;SearchIndexItem&gt; searchList,</span>
<span class="udiff-line-removed">-             Content contentTree) {</span>
<span class="udiff-line-removed">-         addHeading(uc, contentTree);</span>
<span class="udiff-line-removed">-         // Display the list only if there are elements to be displayed.</span>
<span class="udiff-line-removed">-         if (!searchList.isEmpty()) {</span>
<span class="udiff-line-removed">-             HtmlTree dl = HtmlTree.DL(HtmlStyle.index);</span>
<span class="udiff-line-removed">-             for (SearchIndexItem sii : searchList) {</span>
<span class="udiff-line-removed">-                 addDescription(sii, dl);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             contentTree.add(dl);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     protected void addContents(Character uc, List&lt;? extends Element&gt; memberlist,</span>
<span class="udiff-line-removed">-             List&lt;SearchIndexItem&gt; searchList, Content contentTree) {</span>
<span class="udiff-line-removed">-         addHeading(uc, contentTree);</span>
<span class="udiff-line-removed">-         int memberListSize = memberlist.size();</span>
<span class="udiff-line-removed">-         int searchListSize = searchList.size();</span>
<span class="udiff-line-removed">-         int i = 0;</span>
<span class="udiff-line-removed">-         int j = 0;</span>
          HtmlTree dl = HtmlTree.DL(HtmlStyle.index);
<span class="udiff-line-modified-removed">-         while (i &lt; memberListSize &amp;&amp; j &lt; searchListSize) {</span>
<span class="udiff-line-modified-removed">-             Element elem = memberlist.get(i);</span>
<span class="udiff-line-removed">-             String name = (utils.isModule(elem))</span>
<span class="udiff-line-removed">-                     ? utils.getFullyQualifiedName(elem) : utils.getSimpleName(elem);</span>
<span class="udiff-line-removed">-             if (name.compareTo(searchList.get(j).getLabel()) &lt; 0) {</span>
<span class="udiff-line-removed">-                 addDescription(dl, memberlist.get(i));</span>
<span class="udiff-line-removed">-                 i++;</span>
<span class="udiff-line-removed">-             } else if (name.compareTo(searchList.get(j).getLabel()) &gt; 0) {</span>
<span class="udiff-line-removed">-                 addDescription(searchList.get(j), dl);</span>
<span class="udiff-line-removed">-                 j++;</span>
<span class="udiff-line-removed">-             } else {</span>
<span class="udiff-line-removed">-                 addDescription(dl, memberlist.get(i));</span>
<span class="udiff-line-removed">-                 addDescription(searchList.get(j), dl);</span>
<span class="udiff-line-removed">-                 j++;</span>
<span class="udiff-line-removed">-                 i++;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         if (i &gt;= memberListSize) {</span>
<span class="udiff-line-removed">-             while (j &lt; searchListSize) {</span>
<span class="udiff-line-removed">-                 addDescription(searchList.get(j), dl);</span>
<span class="udiff-line-removed">-                 j++;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         if (j &gt;= searchListSize) {</span>
<span class="udiff-line-removed">-             while (i &lt; memberListSize) {</span>
<span class="udiff-line-removed">-                 addDescription(dl, memberlist.get(i));</span>
<span class="udiff-line-removed">-                 i++;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-modified-added">+         for (IndexItem indexItem : memberlist) {</span>
<span class="udiff-line-modified-added">+             addDescription(indexItem, dl);</span>
          }
          contentTree.add(dl);
      }
  
      protected void addHeading(Character uc, Content contentTree) {
          String unicode = uc.toString();
          Content headContent = new StringContent(unicode);
<span class="udiff-line-modified-removed">-         HtmlTree heading = HtmlTree.HEADING(Headings.CONTENT_HEADING, false,</span>
<span class="udiff-line-modified-added">+         HtmlTree heading = HtmlTree.HEADING(Headings.CONTENT_HEADING,</span>
                  HtmlStyle.title, headContent);
          heading.setId(getNameForIndex(unicode));
          contentTree.add(heading);
      }
  
<span class="udiff-line-modified-removed">-     @SuppressWarnings(&quot;preview&quot;)</span>
<span class="udiff-line-modified-removed">-     protected void addDescription(Content dl, Element element) {</span>
<span class="udiff-line-modified-removed">-         SearchIndexItem si = new SearchIndexItem();</span>
<span class="udiff-line-modified-removed">-         new SimpleElementVisitor14&lt;Void, Void&gt;() {</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-             @Override</span>
<span class="udiff-line-modified-removed">-             public Void visitModule(ModuleElement e, Void p) {</span>
<span class="udiff-line-modified-removed">-                 if (configuration.showModules) {</span>
<span class="udiff-line-modified-removed">-                     addDescription(e, dl, si);</span>
<span class="udiff-line-modified-removed">-                     searchItems.add(si);</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-                 return null;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             @Override</span>
<span class="udiff-line-removed">-             public Void visitPackage(PackageElement e, Void p) {</span>
<span class="udiff-line-removed">-                 addDescription(e, dl, si);</span>
<span class="udiff-line-removed">-                 searchItems.add(si);</span>
<span class="udiff-line-removed">-                 return null;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             @Override</span>
<span class="udiff-line-removed">-             public Void visitType(TypeElement e, Void p) {</span>
<span class="udiff-line-removed">-                 addDescription(e, dl, si);</span>
<span class="udiff-line-removed">-                 searchItems.add(si);</span>
<span class="udiff-line-removed">-                 return null;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             @Override</span>
<span class="udiff-line-removed">-             protected Void defaultAction(Element e, Void p) {</span>
<span class="udiff-line-removed">-                 addDescription(e, dl, si);</span>
<span class="udiff-line-removed">-                 searchItems.add(si);</span>
<span class="udiff-line-removed">-                 return null;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         }.visit(element);</span>
<span class="udiff-line-modified-added">+     protected void addDescription(IndexItem indexItem, Content dl) {</span>
<span class="udiff-line-modified-added">+         SearchIndexItem si = indexItem.getSearchTag();</span>
<span class="udiff-line-modified-added">+         if (si != null) {</span>
<span class="udiff-line-modified-added">+             addDescription(si, dl);</span>
<span class="udiff-line-modified-added">+         } else {</span>
<span class="udiff-line-modified-added">+             si = new SearchIndexItem();</span>
<span class="udiff-line-modified-added">+             si.setLabel(indexItem.getLabel());</span>
<span class="udiff-line-modified-added">+             addElementDescription(indexItem, dl, si);</span>
<span class="udiff-line-modified-added">+             searchItems.add(si);</span>
<span class="udiff-line-modified-added">+         }</span>
      }
  
      /**
<span class="udiff-line-modified-removed">-      * Add one line summary comment for the module.</span>
<span class="udiff-line-modified-added">+      * Add one line summary comment for the element.</span>
       *
<span class="udiff-line-modified-removed">-      * @param mdle the module to be documented</span>
<span class="udiff-line-modified-added">+      * @param indexItem the element to be documented</span>
       * @param dlTree the content tree to which the description will be added
       * @param si the search index item
       */
<span class="udiff-line-modified-removed">-     protected void addDescription(ModuleElement mdle, Content dlTree, SearchIndexItem si) {</span>
<span class="udiff-line-modified-removed">-         String moduleName = utils.getFullyQualifiedName(mdle);</span>
<span class="udiff-line-modified-removed">-         Content link = getModuleLink(mdle, new StringContent(moduleName));</span>
<span class="udiff-line-modified-removed">-         si.setLabel(moduleName);</span>
<span class="udiff-line-modified-removed">-         si.setCategory(SearchIndexItem.Category.MODULES);</span>
<span class="udiff-line-modified-removed">-         Content dt = HtmlTree.DT(link);</span>
<span class="udiff-line-modified-removed">-         dt.add(&quot; - &quot;);</span>
<span class="udiff-line-modified-removed">-         dt.add(contents.module_);</span>
<span class="udiff-line-modified-removed">-         dt.add(&quot; &quot; + moduleName);</span>
<span class="udiff-line-modified-removed">-         dlTree.add(dt);</span>
<span class="udiff-line-modified-removed">-         Content dd = new HtmlTree(HtmlTag.DD);</span>
<span class="udiff-line-modified-removed">-         addSummaryComment(mdle, dd);</span>
<span class="udiff-line-modified-removed">-         dlTree.add(dd);</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-     /**</span>
<span class="udiff-line-modified-removed">-      * Add one line summary comment for the package.</span>
<span class="udiff-line-modified-removed">-      *</span>
<span class="udiff-line-modified-removed">-      * @param pkg the package to be documented</span>
<span class="udiff-line-modified-removed">-      * @param dlTree the content tree to which the description will be added</span>
<span class="udiff-line-modified-removed">-      * @param si the search index item to be updated</span>
<span class="udiff-line-modified-removed">-      */</span>
<span class="udiff-line-modified-removed">-     protected void addDescription(PackageElement pkg, Content dlTree, SearchIndexItem si) {</span>
<span class="udiff-line-modified-removed">-         Content link = getPackageLink(pkg, new StringContent(utils.getPackageName(pkg)));</span>
<span class="udiff-line-modified-removed">-         if (configuration.showModules) {</span>
<span class="udiff-line-modified-removed">-             si.setContainingModule(utils.getFullyQualifiedName(utils.containingModule(pkg)));</span>
<span class="udiff-line-modified-added">+     protected void addElementDescription(IndexItem indexItem, Content dlTree, SearchIndexItem si) {</span>
<span class="udiff-line-modified-added">+         Content dt;</span>
<span class="udiff-line-modified-added">+         Element element = indexItem.getElement();</span>
<span class="udiff-line-modified-added">+         String label = indexItem.getLabel();</span>
<span class="udiff-line-modified-added">+         switch (element.getKind()) {</span>
<span class="udiff-line-modified-added">+             case MODULE:</span>
<span class="udiff-line-modified-added">+                 dt = HtmlTree.DT(getModuleLink((ModuleElement)element, new StringContent(label)));</span>
<span class="udiff-line-modified-added">+                 si.setCategory(Category.MODULES);</span>
<span class="udiff-line-modified-added">+                 dt.add(&quot; - &quot;).add(contents.module_).add(&quot; &quot; + label);</span>
<span class="udiff-line-modified-added">+                 break;</span>
<span class="udiff-line-modified-added">+             case PACKAGE:</span>
<span class="udiff-line-modified-added">+                 dt = HtmlTree.DT(getPackageLink((PackageElement)element, new StringContent(label)));</span>
<span class="udiff-line-modified-added">+                 if (configuration.showModules) {</span>
<span class="udiff-line-modified-added">+                     si.setContainingModule(utils.getFullyQualifiedName(utils.containingModule(element)));</span>
<span class="udiff-line-modified-added">+                 }</span>
<span class="udiff-line-modified-added">+                 si.setCategory(Category.PACKAGES);</span>
<span class="udiff-line-modified-added">+                 dt.add(&quot; - &quot;).add(contents.package_).add(&quot; &quot; + label);</span>
<span class="udiff-line-modified-added">+                 break;</span>
<span class="udiff-line-modified-added">+             case CLASS:</span>
<span class="udiff-line-modified-added">+             case ENUM:</span>
<span class="udiff-line-modified-added">+             case ANNOTATION_TYPE:</span>
<span class="udiff-line-modified-added">+             case INTERFACE:</span>
<span class="udiff-line-modified-added">+                 dt = HtmlTree.DT(getLink(new LinkInfoImpl(configuration,</span>
<span class="udiff-line-modified-added">+                         LinkInfoImpl.Kind.INDEX, (TypeElement)element).strong(true)));</span>
<span class="udiff-line-modified-added">+                 si.setContainingPackage(utils.getPackageName(utils.containingPackage(element)));</span>
<span class="udiff-line-modified-added">+                 si.setCategory(Category.TYPES);</span>
<span class="udiff-line-added">+                 dt.add(&quot; - &quot;);</span>
<span class="udiff-line-added">+                 addClassInfo((TypeElement)element, dt);</span>
<span class="udiff-line-added">+                 break;</span>
<span class="udiff-line-added">+             default:</span>
<span class="udiff-line-added">+                 TypeElement containingType = indexItem.getTypeElement();</span>
<span class="udiff-line-added">+                 dt = HtmlTree.DT(HtmlTree.SPAN(HtmlStyle.memberNameLink,</span>
<span class="udiff-line-added">+                         getDocLink(LinkInfoImpl.Kind.INDEX, containingType, element, new StringContent(label))));</span>
<span class="udiff-line-added">+                 si.setContainingPackage(utils.getPackageName(utils.containingPackage(element)));</span>
<span class="udiff-line-added">+                 si.setContainingClass(utils.getSimpleName(containingType));</span>
<span class="udiff-line-added">+                 if (utils.isExecutableElement(element)) {</span>
<span class="udiff-line-added">+                     String url = HtmlTree.encodeURL(links.getName(getAnchor((ExecutableElement)element)));</span>
<span class="udiff-line-added">+                     if (!label.equals(url)) {</span>
<span class="udiff-line-added">+                         si.setUrl(url);</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 si.setCategory(Category.MEMBERS);</span>
<span class="udiff-line-added">+                 dt.add(&quot; - &quot;);</span>
<span class="udiff-line-added">+                 addMemberDesc(element, containingType, dt);</span>
<span class="udiff-line-added">+                 break;</span>
          }
<span class="udiff-line-removed">-         si.setLabel(utils.getPackageName(pkg));</span>
<span class="udiff-line-removed">-         si.setCategory(SearchIndexItem.Category.PACKAGES);</span>
<span class="udiff-line-removed">-         Content dt = HtmlTree.DT(link);</span>
<span class="udiff-line-removed">-         dt.add(&quot; - &quot;);</span>
<span class="udiff-line-removed">-         dt.add(contents.package_);</span>
<span class="udiff-line-removed">-         dt.add(&quot; &quot; + utils.getPackageName(pkg));</span>
<span class="udiff-line-removed">-         dlTree.add(dt);</span>
<span class="udiff-line-removed">-         Content dd = new HtmlTree(HtmlTag.DD);</span>
<span class="udiff-line-removed">-         addSummaryComment(pkg, dd);</span>
<span class="udiff-line-removed">-         dlTree.add(dd);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Add one line summary comment for the class.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @param typeElement the class being documented</span>
<span class="udiff-line-removed">-      * @param dlTree the content tree to which the description will be added</span>
<span class="udiff-line-removed">-      * @param si the search index item to be updated</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     protected void addDescription(TypeElement typeElement, Content dlTree, SearchIndexItem si) {</span>
<span class="udiff-line-removed">-         Content link = getLink(new LinkInfoImpl(configuration,</span>
<span class="udiff-line-removed">-                         LinkInfoImpl.Kind.INDEX, typeElement).strong(true));</span>
<span class="udiff-line-removed">-         si.setContainingPackage(utils.getPackageName(utils.containingPackage(typeElement)));</span>
<span class="udiff-line-removed">-         si.setLabel(utils.getSimpleName(typeElement));</span>
<span class="udiff-line-removed">-         si.setCategory(SearchIndexItem.Category.TYPES);</span>
<span class="udiff-line-removed">-         Content dt = HtmlTree.DT(link);</span>
<span class="udiff-line-removed">-         dt.add(&quot; - &quot;);</span>
<span class="udiff-line-removed">-         addClassInfo(typeElement, dt);</span>
          dlTree.add(dt);
<span class="udiff-line-modified-removed">-         Content dd = new HtmlTree(HtmlTag.DD);</span>
<span class="udiff-line-modified-removed">-         addComment(typeElement, dd);</span>
<span class="udiff-line-modified-added">+         Content dd = new HtmlTree(TagName.DD);</span>
<span class="udiff-line-modified-added">+         if (element.getKind() == ElementKind.MODULE || element.getKind() == ElementKind.PACKAGE) {</span>
<span class="udiff-line-added">+             addSummaryComment(element, dd);</span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+             addComment(element, dd);</span>
<span class="udiff-line-added">+         }</span>
          dlTree.add(dd);
      }
  
      /**
       * Add the classkind (class, interface, exception), error of the class
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -300,54 +208,19 @@</span>
                  getPackageLink(utils.containingPackage(te),
                      utils.getPackageName(utils.containingPackage(te)))
                  ));
      }
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Add description for Class, Field, Method or Constructor.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @param member the member of the Class Kind</span>
<span class="udiff-line-removed">-      * @param dlTree the content tree to which the description will be added</span>
<span class="udiff-line-removed">-      * @param si search index item</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     protected void addDescription(Element member, Content dlTree, SearchIndexItem si) {</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         si.setContainingPackage(utils.getPackageName(utils.containingPackage(member)));</span>
<span class="udiff-line-removed">-         si.setContainingClass(utils.getSimpleName(utils.getEnclosingTypeElement(member)));</span>
<span class="udiff-line-removed">-         String name = utils.getSimpleName(member);</span>
<span class="udiff-line-removed">-         if (utils.isExecutableElement(member)) {</span>
<span class="udiff-line-removed">-             ExecutableElement ee = (ExecutableElement)member;</span>
<span class="udiff-line-removed">-             name = name + utils.flatSignature(ee);</span>
<span class="udiff-line-removed">-             si.setLabel(name);</span>
<span class="udiff-line-removed">-             String url = HtmlTree.encodeURL(links.getName(getAnchor(ee)));</span>
<span class="udiff-line-removed">-             if (!name.equals(url)) {</span>
<span class="udiff-line-removed">-                 si.setUrl(url);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         }  else {</span>
<span class="udiff-line-removed">-             si.setLabel(name);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         si.setCategory(SearchIndexItem.Category.MEMBERS);</span>
<span class="udiff-line-removed">-         Content span = HtmlTree.SPAN(HtmlStyle.memberNameLink,</span>
<span class="udiff-line-removed">-                 getDocLink(LinkInfoImpl.Kind.INDEX, member, name));</span>
<span class="udiff-line-removed">-         Content dt = HtmlTree.DT(span);</span>
<span class="udiff-line-removed">-         dt.add(&quot; - &quot;);</span>
<span class="udiff-line-removed">-         addMemberDesc(member, dt);</span>
<span class="udiff-line-removed">-         dlTree.add(dt);</span>
<span class="udiff-line-removed">-         Content dd = new HtmlTree(HtmlTag.DD);</span>
<span class="udiff-line-removed">-         addComment(member, dd);</span>
<span class="udiff-line-removed">-         dlTree.add(dd);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
      protected void addDescription(SearchIndexItem sii, Content dlTree) {
          String siiPath = pathToRoot.isEmpty() ? &quot;&quot; : pathToRoot.getPath() + &quot;/&quot;;
          siiPath += sii.getUrl();
          HtmlTree labelLink = HtmlTree.A(siiPath, new StringContent(sii.getLabel()));
          Content dt = HtmlTree.DT(HtmlTree.SPAN(HtmlStyle.searchTagLink, labelLink));
          dt.add(&quot; - &quot;);
          dt.add(contents.getContent(&quot;doclet.Search_tag_in&quot;, sii.getHolder()));
          dlTree.add(dt);
<span class="udiff-line-modified-removed">-         Content dd = new HtmlTree(HtmlTag.DD);</span>
<span class="udiff-line-modified-added">+         Content dd = new HtmlTree(TagName.DD);</span>
          if (sii.getDescription().isEmpty()) {
              dd.add(Entity.NO_BREAK_SPACE);
          } else {
              dd.add(sii.getDescription());
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -364,11 +237,11 @@</span>
       * @param contentTree the content tree to which the comment will be added
       */
      protected void addComment(Element element, Content contentTree) {
          List&lt;? extends DocTree&gt; tags;
          Content span = HtmlTree.SPAN(HtmlStyle.deprecatedLabel, getDeprecatedPhrase(element));
<span class="udiff-line-modified-removed">-         HtmlTree div = new HtmlTree(HtmlTag.DIV);</span>
<span class="udiff-line-modified-added">+         HtmlTree div = new HtmlTree(TagName.DIV);</span>
          div.setStyle(HtmlStyle.deprecationBlock);
          if (utils.isDeprecated(element)) {
              div.add(span);
              tags = utils.getBlockTags(element, DocTree.Kind.DEPRECATED);
              if (!tags.isEmpty())
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -390,16 +263,16 @@</span>
  
      /**
       * Add description about the Static Variable/Method/Constructor for a
       * member.
       *
<span class="udiff-line-modified-removed">-      * @param member MemberDoc for the member within the Class Kind</span>
<span class="udiff-line-modified-added">+      * @param member element for the member</span>
<span class="udiff-line-added">+      * @param enclosing the enclosing type element</span>
       * @param contentTree the content tree to which the member description will be added
       */
<span class="udiff-line-modified-removed">-     protected void addMemberDesc(Element member, Content contentTree) {</span>
<span class="udiff-line-modified-removed">-         TypeElement containing = utils.getEnclosingTypeElement(member);</span>
<span class="udiff-line-removed">-         String classdesc = utils.getTypeElementName(containing, true) + &quot; &quot;;</span>
<span class="udiff-line-modified-added">+     protected void addMemberDesc(Element member, TypeElement enclosing, Content contentTree) {</span>
<span class="udiff-line-modified-added">+         String classdesc = utils.getTypeElementName(enclosing, true) + &quot; &quot;;</span>
          if (utils.isField(member)) {
              Content resource = contents.getContent(utils.isStatic(member)
                      ? &quot;doclet.Static_variable_in&quot;
                      : &quot;doclet.Variable_in&quot;, classdesc);
              contentTree.add(resource);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -410,11 +283,11 @@</span>
              Content resource = contents.getContent(utils.isStatic(member)
                      ? &quot;doclet.Static_method_in&quot;
                      : &quot;doclet.Method_in&quot;, classdesc);
              contentTree.add(resource);
          }
<span class="udiff-line-modified-removed">-         addPreQualifiedClassLink(LinkInfoImpl.Kind.INDEX, containing,</span>
<span class="udiff-line-modified-added">+         addPreQualifiedClassLink(LinkInfoImpl.Kind.INDEX, enclosing,</span>
                  false, contentTree);
      }
  
      /**
       * Generate a valid HTML name for member index page.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -430,36 +303,36 @@</span>
       * @throws DocFileIOException if there is a problem creating any of the search index files
       */
      protected void createSearchIndexFiles() throws DocFileIOException {
          if (configuration.showModules) {
              createSearchIndexFile(DocPaths.MODULE_SEARCH_INDEX_JS,
<span class="udiff-line-modified-removed">-                                   searchItems.get(SearchIndexItem.Category.MODULES),</span>
<span class="udiff-line-modified-added">+                                   searchItems.itemsOfCategories(Category.MODULES),</span>
                                    &quot;moduleSearchIndex&quot;);
          }
          if (!configuration.packages.isEmpty()) {
              SearchIndexItem si = new SearchIndexItem();
<span class="udiff-line-modified-removed">-             si.setCategory(SearchIndexItem.Category.PACKAGES);</span>
<span class="udiff-line-modified-added">+             si.setCategory(Category.PACKAGES);</span>
              si.setLabel(resources.getText(&quot;doclet.All_Packages&quot;));
              si.setUrl(DocPaths.ALLPACKAGES_INDEX.getPath());
              searchItems.add(si);
          }
          createSearchIndexFile(DocPaths.PACKAGE_SEARCH_INDEX_JS,
<span class="udiff-line-modified-removed">-                               searchItems.get(SearchIndexItem.Category.PACKAGES),</span>
<span class="udiff-line-modified-added">+                               searchItems.itemsOfCategories(Category.PACKAGES),</span>
                                &quot;packageSearchIndex&quot;);
          SearchIndexItem si = new SearchIndexItem();
<span class="udiff-line-modified-removed">-         si.setCategory(SearchIndexItem.Category.TYPES);</span>
<span class="udiff-line-modified-added">+         si.setCategory(Category.TYPES);</span>
          si.setLabel(resources.getText(&quot;doclet.All_Classes&quot;));
          si.setUrl(DocPaths.ALLCLASSES_INDEX.getPath());
          searchItems.add(si);
          createSearchIndexFile(DocPaths.TYPE_SEARCH_INDEX_JS,
<span class="udiff-line-modified-removed">-                               searchItems.get(SearchIndexItem.Category.TYPES),</span>
<span class="udiff-line-modified-added">+                               searchItems.itemsOfCategories(Category.TYPES),</span>
                                &quot;typeSearchIndex&quot;);
          createSearchIndexFile(DocPaths.MEMBER_SEARCH_INDEX_JS,
<span class="udiff-line-modified-removed">-                               searchItems.get(SearchIndexItem.Category.MEMBERS),</span>
<span class="udiff-line-modified-added">+                               searchItems.itemsOfCategories(Category.MEMBERS),</span>
                                &quot;memberSearchIndex&quot;);
          createSearchIndexFile(DocPaths.TAG_SEARCH_INDEX_JS,
<span class="udiff-line-modified-removed">-                               searchItems.get(SearchIndexItem.Category.SEARCH_TAGS),</span>
<span class="udiff-line-modified-added">+                               searchItems.itemsOfCategories(Category.INDEX, Category.SYSTEM_PROPERTY),</span>
                                &quot;tagSearchIndex&quot;);
      }
  
      /**
       * Creates a search index file.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -468,20 +341,22 @@</span>
       * @param searchIndex       the search index items
       * @param varName           the variable name to write in the JavaScript file
       * @throws DocFileIOException if there is a problem creating the search index file
       */
      protected void createSearchIndexFile(DocPath searchIndexJS,
<span class="udiff-line-modified-removed">-                                          Collection&lt;SearchIndexItem&gt; searchIndex,</span>
<span class="udiff-line-modified-added">+                                          Stream&lt;SearchIndexItem&gt; searchIndex,</span>
                                           String varName)
              throws DocFileIOException
      {
          // The file needs to be created even if there are no searchIndex items
          // File could be written straight-through, without an intermediate StringBuilder
<span class="udiff-line-modified-removed">-         if (!searchIndex.isEmpty()) {</span>
<span class="udiff-line-modified-added">+         Iterator&lt;SearchIndexItem&gt; index = searchIndex.iterator();</span>
<span class="udiff-line-added">+         if (index.hasNext()) {</span>
              StringBuilder searchVar = new StringBuilder(&quot;[&quot;);
              boolean first = true;
<span class="udiff-line-modified-removed">-             for (SearchIndexItem item : searchIndex) {</span>
<span class="udiff-line-modified-added">+             while (index.hasNext()) {</span>
<span class="udiff-line-added">+                 SearchIndexItem item = index.next();</span>
                  if (first) {
                      searchVar.append(item.toString());
                      first = false;
                  } else {
                      searchVar.append(&quot;,&quot;).append(item.toString());
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -497,19 +372,15 @@</span>
                  throw new DocFileIOException(jsFile, DocFileIOException.Mode.WRITE, ie);
              }
          }
      }
  
<span class="udiff-line-modified-removed">-     protected static Map&lt;Character, List&lt;SearchIndexItem&gt;&gt; buildSearchTagIndex(</span>
<span class="udiff-line-modified-removed">-             Collection&lt;? extends SearchIndexItem&gt; searchItems)</span>
<span class="udiff-line-modified-added">+     private static Map&lt;Character, List&lt;SearchIndexItem&gt;&gt; buildSearchTagIndex(</span>
<span class="udiff-line-modified-added">+             Stream&lt;? extends SearchIndexItem&gt; searchItems)</span>
      {
<span class="udiff-line-modified-removed">-         Map&lt;Character, List&lt;SearchIndexItem&gt;&gt; map = new HashMap&lt;&gt;();</span>
<span class="udiff-line-modified-removed">-         for (SearchIndexItem sii : searchItems) {</span>
<span class="udiff-line-modified-removed">-             String tagLabel = sii.getLabel();</span>
<span class="udiff-line-modified-removed">-             Character unicode = (tagLabel.length() == 0)</span>
<span class="udiff-line-modified-removed">-                     ? &#39;*&#39;</span>
<span class="udiff-line-removed">-                     : Character.toUpperCase(tagLabel.charAt(0));</span>
<span class="udiff-line-removed">-             map.computeIfAbsent(unicode, k -&gt; new ArrayList&lt;&gt;()).add(sii);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         return map;</span>
<span class="udiff-line-modified-added">+         return searchItems.collect(Collectors.groupingBy(i -&gt; keyCharacter(i.getLabel())));</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     protected static Character keyCharacter(String s) {</span>
<span class="udiff-line-modified-added">+         return s.isEmpty() ? &#39;*&#39; : Character.toUpperCase(s.charAt(0));</span>
      }
  }
</pre>
<center><a href="AbstractExecutableMemberWriter.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="AbstractMemberWriter.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>