<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.internal.le/share/classes/jdk/internal/org/jline/terminal/impl/AbstractTerminal.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AbstractPty.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="AbstractWindowsTerminal.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.le/share/classes/jdk/internal/org/jline/terminal/impl/AbstractTerminal.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 26 import jdk.internal.org.jline.terminal.Attributes.LocalFlag;
 27 import jdk.internal.org.jline.terminal.Cursor;
 28 import jdk.internal.org.jline.terminal.MouseEvent;
 29 import jdk.internal.org.jline.terminal.Terminal;
 30 import jdk.internal.org.jline.utils.Curses;
 31 import jdk.internal.org.jline.utils.InfoCmp;
 32 import jdk.internal.org.jline.utils.InfoCmp.Capability;
 33 import jdk.internal.org.jline.utils.Log;
 34 import jdk.internal.org.jline.utils.Status;
 35 
 36 public abstract class AbstractTerminal implements Terminal {
 37 
 38     protected final String name;
 39     protected final String type;
 40     protected final Charset encoding;
 41     protected final Map&lt;Signal, SignalHandler&gt; handlers = new HashMap&lt;&gt;();
 42     protected final Set&lt;Capability&gt; bools = new HashSet&lt;&gt;();
 43     protected final Map&lt;Capability, Integer&gt; ints = new HashMap&lt;&gt;();
 44     protected final Map&lt;Capability, String&gt; strings = new HashMap&lt;&gt;();
 45     protected Status status;

 46 
 47     public AbstractTerminal(String name, String type) throws IOException {
 48         this(name, type, null, SignalHandler.SIG_DFL);
 49     }
 50 
 51     public AbstractTerminal(String name, String type, Charset encoding, SignalHandler signalHandler) throws IOException {
 52         this.name = name;
 53         this.type = type;
 54         this.encoding = encoding != null ? encoding : Charset.defaultCharset();
 55         for (Signal signal : Signal.values()) {
 56             handlers.put(signal, signalHandler);
 57         }
 58     }
 59 




 60     public Status getStatus() {
 61         return getStatus(true);
 62     }
 63 
 64     public Status getStatus(boolean create) {
 65         if (status == null &amp;&amp; create) {
 66             status = new Status(this);
 67         }
 68         return status;
 69     }
 70 
 71     public SignalHandler handle(Signal signal, SignalHandler handler) {
 72         Objects.requireNonNull(signal);
 73         Objects.requireNonNull(handler);
 74         return handlers.put(signal, handler);
 75     }
 76 
 77     public void raise(Signal signal) {
 78         Objects.requireNonNull(signal);
 79         SignalHandler handler = handlers.get(signal);
 80         if (handler != SignalHandler.SIG_DFL &amp;&amp; handler != SignalHandler.SIG_IGN) {
 81             handler.handle(signal);
 82         }
 83         if (status != null &amp;&amp; signal == Signal.WINCH) {
 84             status.resize();
 85         }
 86     }
 87 
<span class="line-modified"> 88     public void close() throws IOException {</span>










 89         if (status != null) {
 90             status.update(null);
 91             flush();
 92         }
 93     }
 94 
 95     protected void echoSignal(Signal signal) {
 96         ControlChar cc = null;
 97         switch (signal) {
 98             case INT:
 99                 cc = ControlChar.VINTR;
100                 break;
101             case QUIT:
102                 cc = ControlChar.VQUIT;
103                 break;
104             case TSTP:
105                 cc = ControlChar.VSUSP;
106                 break;
107         }
108         if (cc != null) {
</pre>
</td>
<td>
<hr />
<pre>
 26 import jdk.internal.org.jline.terminal.Attributes.LocalFlag;
 27 import jdk.internal.org.jline.terminal.Cursor;
 28 import jdk.internal.org.jline.terminal.MouseEvent;
 29 import jdk.internal.org.jline.terminal.Terminal;
 30 import jdk.internal.org.jline.utils.Curses;
 31 import jdk.internal.org.jline.utils.InfoCmp;
 32 import jdk.internal.org.jline.utils.InfoCmp.Capability;
 33 import jdk.internal.org.jline.utils.Log;
 34 import jdk.internal.org.jline.utils.Status;
 35 
 36 public abstract class AbstractTerminal implements Terminal {
 37 
 38     protected final String name;
 39     protected final String type;
 40     protected final Charset encoding;
 41     protected final Map&lt;Signal, SignalHandler&gt; handlers = new HashMap&lt;&gt;();
 42     protected final Set&lt;Capability&gt; bools = new HashSet&lt;&gt;();
 43     protected final Map&lt;Capability, Integer&gt; ints = new HashMap&lt;&gt;();
 44     protected final Map&lt;Capability, String&gt; strings = new HashMap&lt;&gt;();
 45     protected Status status;
<span class="line-added"> 46     protected Runnable onClose;</span>
 47 
 48     public AbstractTerminal(String name, String type) throws IOException {
 49         this(name, type, null, SignalHandler.SIG_DFL);
 50     }
 51 
 52     public AbstractTerminal(String name, String type, Charset encoding, SignalHandler signalHandler) throws IOException {
 53         this.name = name;
 54         this.type = type;
 55         this.encoding = encoding != null ? encoding : Charset.defaultCharset();
 56         for (Signal signal : Signal.values()) {
 57             handlers.put(signal, signalHandler);
 58         }
 59     }
 60 
<span class="line-added"> 61     public void setOnClose(Runnable onClose) {</span>
<span class="line-added"> 62         this.onClose = onClose;</span>
<span class="line-added"> 63     }</span>
<span class="line-added"> 64 </span>
 65     public Status getStatus() {
 66         return getStatus(true);
 67     }
 68 
 69     public Status getStatus(boolean create) {
 70         if (status == null &amp;&amp; create) {
 71             status = new Status(this);
 72         }
 73         return status;
 74     }
 75 
 76     public SignalHandler handle(Signal signal, SignalHandler handler) {
 77         Objects.requireNonNull(signal);
 78         Objects.requireNonNull(handler);
 79         return handlers.put(signal, handler);
 80     }
 81 
 82     public void raise(Signal signal) {
 83         Objects.requireNonNull(signal);
 84         SignalHandler handler = handlers.get(signal);
 85         if (handler != SignalHandler.SIG_DFL &amp;&amp; handler != SignalHandler.SIG_IGN) {
 86             handler.handle(signal);
 87         }
 88         if (status != null &amp;&amp; signal == Signal.WINCH) {
 89             status.resize();
 90         }
 91     }
 92 
<span class="line-modified"> 93     public final void close() throws IOException {</span>
<span class="line-added"> 94         try {</span>
<span class="line-added"> 95             doClose();</span>
<span class="line-added"> 96         } finally {</span>
<span class="line-added"> 97             if (onClose != null) {</span>
<span class="line-added"> 98                 onClose.run();</span>
<span class="line-added"> 99             }</span>
<span class="line-added">100         }</span>
<span class="line-added">101     }</span>
<span class="line-added">102 </span>
<span class="line-added">103     protected void doClose() throws IOException {</span>
104         if (status != null) {
105             status.update(null);
106             flush();
107         }
108     }
109 
110     protected void echoSignal(Signal signal) {
111         ControlChar cc = null;
112         switch (signal) {
113             case INT:
114                 cc = ControlChar.VINTR;
115                 break;
116             case QUIT:
117                 cc = ControlChar.VQUIT;
118                 break;
119             case TSTP:
120                 cc = ControlChar.VSUSP;
121                 break;
122         }
123         if (cc != null) {
</pre>
</td>
</tr>
</table>
<center><a href="AbstractPty.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="AbstractWindowsTerminal.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>