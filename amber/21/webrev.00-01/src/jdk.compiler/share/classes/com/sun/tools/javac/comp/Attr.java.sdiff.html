<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.compiler/share/classes/com/sun/tools/javac/comp/Attr.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../test/langtools/jdk/jshell/SealedClassesTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.compiler/share/classes/com/sun/tools/javac/comp/Attr.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
5074                     } else if (!isTypeVar) {
5075                         boolean thisIsASuper = types.directSupertypes(subTypeSym.type)
5076                                                     .stream()
5077                                                     .anyMatch(d -&gt; d.tsym == c);
5078                         if (!thisIsASuper) {
5079                             log.error(TreeInfo.diagnosticPositionFor(subTypeSym, env.tree),
5080                                     Errors.InvalidPermitsClause(Fragments.DoesntExtendSealed(subTypeSym.type)));
5081                         }
5082                     }
5083                 }
5084             }
5085 
5086             List&lt;ClassSymbol&gt; sealedSupers = types.directSupertypes(c.type)
5087                                                   .stream()
5088                                                   .filter(s -&gt; s.tsym.isSealed())
5089                                                   .map(s -&gt; (ClassSymbol) s.tsym)
5090                                                   .collect(List.collector());
5091 
5092             if (sealedSupers.isEmpty()) {
5093                 if ((c.flags_field &amp; Flags.NON_SEALED) != 0) {
<span class="line-modified">5094                     log.error(TreeInfo.diagnosticPositionFor(c, env.tree), Errors.NonSealedWithNoSealedSupertype(c));</span>





5095                 }
5096             } else {
5097                 if (c.isLocal() &amp;&amp; !c.isEnum()) {
5098                     log.error(TreeInfo.diagnosticPositionFor(c, env.tree), Errors.LocalClassesCantExtendSealed);
5099                 }
5100 
5101                 for (ClassSymbol supertypeSym : sealedSupers) {
5102                     if (!supertypeSym.permitted.contains(c.type.tsym)) {
5103                         log.error(TreeInfo.diagnosticPositionFor(c.type.tsym, env.tree), Errors.CantInheritFromSealed(supertypeSym));
5104                     }
5105                 }
5106                 if (!c.isNonSealed() &amp;&amp; !c.isFinal() &amp;&amp; !c.isSealed()) {
5107                     log.error(TreeInfo.diagnosticPositionFor(c, env.tree), Errors.NonSealedSealedOrFinalExpected);
5108                 }
5109             }
5110 
5111             // The info.lint field in the envs stored in typeEnvs is deliberately uninitialized,
5112             // because the annotations were not available at the time the env was created. Therefore,
5113             // we look up the environment chain for the first enclosing environment for which the
5114             // lint value is set. Typically, this is the parent env, but might be further if there
</pre>
</td>
<td>
<hr />
<pre>
5074                     } else if (!isTypeVar) {
5075                         boolean thisIsASuper = types.directSupertypes(subTypeSym.type)
5076                                                     .stream()
5077                                                     .anyMatch(d -&gt; d.tsym == c);
5078                         if (!thisIsASuper) {
5079                             log.error(TreeInfo.diagnosticPositionFor(subTypeSym, env.tree),
5080                                     Errors.InvalidPermitsClause(Fragments.DoesntExtendSealed(subTypeSym.type)));
5081                         }
5082                     }
5083                 }
5084             }
5085 
5086             List&lt;ClassSymbol&gt; sealedSupers = types.directSupertypes(c.type)
5087                                                   .stream()
5088                                                   .filter(s -&gt; s.tsym.isSealed())
5089                                                   .map(s -&gt; (ClassSymbol) s.tsym)
5090                                                   .collect(List.collector());
5091 
5092             if (sealedSupers.isEmpty()) {
5093                 if ((c.flags_field &amp; Flags.NON_SEALED) != 0) {
<span class="line-modified">5094                     boolean hasErrorSuper = types.directSupertypes(c.type)</span>
<span class="line-added">5095                                                  .stream()</span>
<span class="line-added">5096                                                  .anyMatch(s -&gt; s.tsym.kind == Kind.ERR);</span>
<span class="line-added">5097                     if (!hasErrorSuper) {</span>
<span class="line-added">5098                         log.error(TreeInfo.diagnosticPositionFor(c, env.tree), Errors.NonSealedWithNoSealedSupertype(c));</span>
<span class="line-added">5099                     }</span>
5100                 }
5101             } else {
5102                 if (c.isLocal() &amp;&amp; !c.isEnum()) {
5103                     log.error(TreeInfo.diagnosticPositionFor(c, env.tree), Errors.LocalClassesCantExtendSealed);
5104                 }
5105 
5106                 for (ClassSymbol supertypeSym : sealedSupers) {
5107                     if (!supertypeSym.permitted.contains(c.type.tsym)) {
5108                         log.error(TreeInfo.diagnosticPositionFor(c.type.tsym, env.tree), Errors.CantInheritFromSealed(supertypeSym));
5109                     }
5110                 }
5111                 if (!c.isNonSealed() &amp;&amp; !c.isFinal() &amp;&amp; !c.isSealed()) {
5112                     log.error(TreeInfo.diagnosticPositionFor(c, env.tree), Errors.NonSealedSealedOrFinalExpected);
5113                 }
5114             }
5115 
5116             // The info.lint field in the envs stored in typeEnvs is deliberately uninitialized,
5117             // because the annotations were not available at the time the env was created. Therefore,
5118             // we look up the environment chain for the first enclosing environment for which the
5119             // lint value is set. Typically, this is the parent env, but might be further if there
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../test/langtools/jdk/jshell/SealedClassesTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>