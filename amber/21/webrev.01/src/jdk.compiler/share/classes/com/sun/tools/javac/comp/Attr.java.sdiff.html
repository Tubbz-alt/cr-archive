<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.compiler/share/classes/com/sun/tools/javac/comp/Attr.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../jdk.jshell/share/classes/jdk/jshell/Eval.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.compiler/share/classes/com/sun/tools/javac/comp/Attr.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
5054                     } else if (!isTypeVar) {
5055                         boolean thisIsASuper = types.directSupertypes(subTypeSym.type)
5056                                                     .stream()
5057                                                     .anyMatch(d -&gt; d.tsym == c);
5058                         if (!thisIsASuper) {
5059                             log.error(TreeInfo.diagnosticPositionFor(subTypeSym, env.tree),
5060                                     Errors.InvalidPermitsClause(Fragments.DoesntExtendSealed(subTypeSym.type)));
5061                         }
5062                     }
5063                 }
5064             }
5065 
5066             List&lt;ClassSymbol&gt; sealedSupers = types.directSupertypes(c.type)
5067                                                   .stream()
5068                                                   .filter(s -&gt; s.tsym.isSealed())
5069                                                   .map(s -&gt; (ClassSymbol) s.tsym)
5070                                                   .collect(List.collector());
5071 
5072             if (sealedSupers.isEmpty()) {
5073                 if ((c.flags_field &amp; Flags.NON_SEALED) != 0) {
<span class="line-modified">5074                     log.error(TreeInfo.diagnosticPositionFor(c, env.tree), Errors.NonSealedWithNoSealedSupertype);</span>





5075                 }
5076             } else {
5077                 if (c.isLocal() &amp;&amp; !c.isEnum()) {
5078                     log.error(TreeInfo.diagnosticPositionFor(c, env.tree), Errors.LocalClassesCantExtendSealed);
5079                 }
5080 
5081                 for (ClassSymbol supertypeSym : sealedSupers) {
5082                     if (!supertypeSym.permitted.contains(c.type.tsym)) {
5083                         log.error(TreeInfo.diagnosticPositionFor(c.type.tsym, env.tree), Errors.CantInheritFromSealed(supertypeSym));
5084                     }
5085                 }
5086                 if (!c.isNonSealed() &amp;&amp; !c.isFinal() &amp;&amp; !c.isSealed()) {
5087                     log.error(TreeInfo.diagnosticPositionFor(c, env.tree), Errors.NonSealedSealedOrFinalExpected);
5088                 }
5089             }
5090 
5091             // The info.lint field in the envs stored in typeEnvs is deliberately uninitialized,
5092             // because the annotations were not available at the time the env was created. Therefore,
5093             // we look up the environment chain for the first enclosing environment for which the
5094             // lint value is set. Typically, this is the parent env, but might be further if there
</pre>
</td>
<td>
<hr />
<pre>
5054                     } else if (!isTypeVar) {
5055                         boolean thisIsASuper = types.directSupertypes(subTypeSym.type)
5056                                                     .stream()
5057                                                     .anyMatch(d -&gt; d.tsym == c);
5058                         if (!thisIsASuper) {
5059                             log.error(TreeInfo.diagnosticPositionFor(subTypeSym, env.tree),
5060                                     Errors.InvalidPermitsClause(Fragments.DoesntExtendSealed(subTypeSym.type)));
5061                         }
5062                     }
5063                 }
5064             }
5065 
5066             List&lt;ClassSymbol&gt; sealedSupers = types.directSupertypes(c.type)
5067                                                   .stream()
5068                                                   .filter(s -&gt; s.tsym.isSealed())
5069                                                   .map(s -&gt; (ClassSymbol) s.tsym)
5070                                                   .collect(List.collector());
5071 
5072             if (sealedSupers.isEmpty()) {
5073                 if ((c.flags_field &amp; Flags.NON_SEALED) != 0) {
<span class="line-modified">5074                     boolean hasErrorSuper = types.directSupertypes(c.type)</span>
<span class="line-added">5075                                                  .stream()</span>
<span class="line-added">5076                                                  .anyMatch(s -&gt; s.tsym.kind == Kind.ERR);</span>
<span class="line-added">5077                     if (!hasErrorSuper) {</span>
<span class="line-added">5078                         log.error(TreeInfo.diagnosticPositionFor(c, env.tree), Errors.NonSealedWithNoSealedSupertype);</span>
<span class="line-added">5079                     }</span>
5080                 }
5081             } else {
5082                 if (c.isLocal() &amp;&amp; !c.isEnum()) {
5083                     log.error(TreeInfo.diagnosticPositionFor(c, env.tree), Errors.LocalClassesCantExtendSealed);
5084                 }
5085 
5086                 for (ClassSymbol supertypeSym : sealedSupers) {
5087                     if (!supertypeSym.permitted.contains(c.type.tsym)) {
5088                         log.error(TreeInfo.diagnosticPositionFor(c.type.tsym, env.tree), Errors.CantInheritFromSealed(supertypeSym));
5089                     }
5090                 }
5091                 if (!c.isNonSealed() &amp;&amp; !c.isFinal() &amp;&amp; !c.isSealed()) {
5092                     log.error(TreeInfo.diagnosticPositionFor(c, env.tree), Errors.NonSealedSealedOrFinalExpected);
5093                 }
5094             }
5095 
5096             // The info.lint field in the envs stored in typeEnvs is deliberately uninitialized,
5097             // because the annotations were not available at the time the env was created. Therefore,
5098             // we look up the environment chain for the first enclosing environment for which the
5099             // lint value is set. Typically, this is the parent env, but might be further if there
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../jdk.jshell/share/classes/jdk/jshell/Eval.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>