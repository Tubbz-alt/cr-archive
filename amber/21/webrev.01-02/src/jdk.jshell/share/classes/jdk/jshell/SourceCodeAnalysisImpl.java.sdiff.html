<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jshell/share/classes/jdk/jshell/SourceCodeAnalysisImpl.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="MaskCommentsAndModifiers.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../../../test/langtools/jdk/jshell/ClassesTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jshell/share/classes/jdk/jshell/SourceCodeAnalysisImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 152     private final JShell proc;
 153     private final CompletenessAnalyzer ca;
 154     private final List&lt;AutoCloseable&gt; closeables = new ArrayList&lt;&gt;();
 155     private final Map&lt;Path, ClassIndex&gt; currentIndexes = new HashMap&lt;&gt;();
 156     private int indexVersion;
 157     private int classpathVersion;
 158     private final Object suspendLock = new Object();
 159     private int suspend;
 160 
 161     SourceCodeAnalysisImpl(JShell proc) {
 162         this.proc = proc;
 163         this.ca = new CompletenessAnalyzer(proc);
 164 
 165         int cpVersion = classpathVersion = 1;
 166 
 167         INDEXER.submit(() -&gt; refreshIndexes(cpVersion));
 168     }
 169 
 170     @Override
 171     public CompletionInfo analyzeCompletion(String srcInput) {
<span class="line-modified"> 172         MaskCommentsAndModifiers mcm = new MaskCommentsAndModifiers(srcInput, false);</span>
 173         if (mcm.endsWithOpenToken()) {
 174             proc.debug(DBG_COMPA, &quot;Incomplete (open comment): %s\n&quot;, srcInput);
 175             return new CompletionInfoImpl(DEFINITELY_INCOMPLETE, null, srcInput + &#39;\n&#39;);
 176         }
 177         String cleared = mcm.cleared();
 178         String trimmedInput = Util.trimEnd(cleared);
 179         if (trimmedInput.isEmpty()) {
 180             // Just comment or empty
 181             return new CompletionInfoImpl(Completeness.EMPTY, srcInput, &quot;&quot;);
 182         }
 183         CaInfo info = ca.scan(trimmedInput);
 184         Completeness status = info.status;
 185         int unitEndPos = info.unitEndPos;
 186         if (unitEndPos &gt; srcInput.length()) {
 187             unitEndPos = srcInput.length();
 188         }
 189         int nonCommentNonWhiteLength = trimmedInput.length();
 190         String src = srcInput.substring(0, unitEndPos);
 191         switch (status) {
 192             case COMPLETE: {
</pre>
</td>
<td>
<hr />
<pre>
 152     private final JShell proc;
 153     private final CompletenessAnalyzer ca;
 154     private final List&lt;AutoCloseable&gt; closeables = new ArrayList&lt;&gt;();
 155     private final Map&lt;Path, ClassIndex&gt; currentIndexes = new HashMap&lt;&gt;();
 156     private int indexVersion;
 157     private int classpathVersion;
 158     private final Object suspendLock = new Object();
 159     private int suspend;
 160 
 161     SourceCodeAnalysisImpl(JShell proc) {
 162         this.proc = proc;
 163         this.ca = new CompletenessAnalyzer(proc);
 164 
 165         int cpVersion = classpathVersion = 1;
 166 
 167         INDEXER.submit(() -&gt; refreshIndexes(cpVersion));
 168     }
 169 
 170     @Override
 171     public CompletionInfo analyzeCompletion(String srcInput) {
<span class="line-modified"> 172         MaskCommentsAndModifiers mcm = new MaskCommentsAndModifiers(srcInput, false, false);</span>
 173         if (mcm.endsWithOpenToken()) {
 174             proc.debug(DBG_COMPA, &quot;Incomplete (open comment): %s\n&quot;, srcInput);
 175             return new CompletionInfoImpl(DEFINITELY_INCOMPLETE, null, srcInput + &#39;\n&#39;);
 176         }
 177         String cleared = mcm.cleared();
 178         String trimmedInput = Util.trimEnd(cleared);
 179         if (trimmedInput.isEmpty()) {
 180             // Just comment or empty
 181             return new CompletionInfoImpl(Completeness.EMPTY, srcInput, &quot;&quot;);
 182         }
 183         CaInfo info = ca.scan(trimmedInput);
 184         Completeness status = info.status;
 185         int unitEndPos = info.unitEndPos;
 186         if (unitEndPos &gt; srcInput.length()) {
 187             unitEndPos = srcInput.length();
 188         }
 189         int nonCommentNonWhiteLength = trimmedInput.length();
 190         String src = srcInput.substring(0, unitEndPos);
 191         switch (status) {
 192             case COMPLETE: {
</pre>
</td>
</tr>
</table>
<center><a href="MaskCommentsAndModifiers.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../../../test/langtools/jdk/jshell/ClassesTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>