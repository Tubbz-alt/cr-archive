<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/RunTests.gmk</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="Main.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="RunTestsPrebuiltSpec.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/RunTests.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 663     ifneq ($3, )
 664       $1_$2 := $3
 665     endif
 666   endif
 667 endef
 668 
 669 SetupRunMicroTest = $(NamedParamsMacroTemplate)
 670 define SetupRunMicroTestBody
 671   $1_TEST_RESULTS_DIR := $$(TEST_RESULTS_DIR)/$1
 672   $1_TEST_SUPPORT_DIR := $$(TEST_SUPPORT_DIR)/$1
 673   $1_EXITCODE := $$($1_TEST_RESULTS_DIR)/exitcode.txt
 674 
 675   $1_TEST_NAME := $$(strip $$(patsubst micro:%, %, $$($1_TEST)))
 676 
 677   $$(eval $$(call SetMicroValue,$1,MICRO_BENCHMARKS_JAR,$$(TEST_IMAGE_DIR)/micro/benchmarks.jar))
 678   $$(eval $$(call SetMicroValue,$1,MICRO_TEST_JDK,$$(JDK_UNDER_TEST)))
 679   $$(eval $$(call SetMicroValue,$1,MICRO_JAVA_OPTIONS))
 680 
 681   # Current tests needs to open java.io
 682   $1_MICRO_JAVA_OPTIONS += --add-opens=java.base/java.io=ALL-UNNAMED
<span class="line-removed"> 683   # Set library path for native dependencies</span>
<span class="line-removed"> 684   $1_MICRO_JAVA_OPTIONS += -Djava.library.path=$$(TEST_IMAGE_DIR)/micro/native</span>
 685 
 686   # Save output as JSON or CSV file
 687   ifneq ($$(MICRO_RESULTS_FORMAT), )
 688     $1_MICRO_BASIC_OPTIONS += -rf $$(MICRO_RESULTS_FORMAT)
 689     $1_MICRO_BASIC_OPTIONS += -rff $$($1_TEST_RESULTS_DIR)/jmh-result.$(MICRO_RESULTS_FORMAT)
 690   endif
 691 
 692   ifneq ($$(MICRO_VM_OPTIONS)$$(MICRO_JAVA_OPTIONS), )
 693     JMH_JVM_ARGS := $$(MICRO_VM_OPTIONS) $$(MICRO_JAVA_OPTIONS)


 694     $1_MICRO_VM_OPTIONS := -jvmArgs $(call ShellQuote,$$(JMH_JVM_ARGS))
 695   endif
 696 
 697   ifneq ($$(MICRO_ITER), )
 698     $1_MICRO_ITER := -i $$(MICRO_ITER)
 699   endif
 700   ifneq ($$(MICRO_FORK), )
 701     $1_MICRO_FORK := -f $$(MICRO_FORK)
 702   endif
 703   ifneq ($$(MICRO_TIME), )
 704     $1_MICRO_TIME := -r $$(MICRO_TIME)
 705   endif
 706   ifneq ($$(MICRO_WARMUP_ITER), )
 707     $1_MICRO_WARMUP_ITER := -wi $$(MICRO_WARMUP_ITER)
 708   endif
 709   ifneq ($$(MICRO_WARMUP_TIME), )
 710     $1_MICRO_WARMUP_TIME := -w $$(MICRO_WARMUP_TIME)
 711   endif
 712 
 713   run-test-$1: pre-run-test
</pre>
</td>
<td>
<hr />
<pre>
 663     ifneq ($3, )
 664       $1_$2 := $3
 665     endif
 666   endif
 667 endef
 668 
 669 SetupRunMicroTest = $(NamedParamsMacroTemplate)
 670 define SetupRunMicroTestBody
 671   $1_TEST_RESULTS_DIR := $$(TEST_RESULTS_DIR)/$1
 672   $1_TEST_SUPPORT_DIR := $$(TEST_SUPPORT_DIR)/$1
 673   $1_EXITCODE := $$($1_TEST_RESULTS_DIR)/exitcode.txt
 674 
 675   $1_TEST_NAME := $$(strip $$(patsubst micro:%, %, $$($1_TEST)))
 676 
 677   $$(eval $$(call SetMicroValue,$1,MICRO_BENCHMARKS_JAR,$$(TEST_IMAGE_DIR)/micro/benchmarks.jar))
 678   $$(eval $$(call SetMicroValue,$1,MICRO_TEST_JDK,$$(JDK_UNDER_TEST)))
 679   $$(eval $$(call SetMicroValue,$1,MICRO_JAVA_OPTIONS))
 680 
 681   # Current tests needs to open java.io
 682   $1_MICRO_JAVA_OPTIONS += --add-opens=java.base/java.io=ALL-UNNAMED


 683 
 684   # Save output as JSON or CSV file
 685   ifneq ($$(MICRO_RESULTS_FORMAT), )
 686     $1_MICRO_BASIC_OPTIONS += -rf $$(MICRO_RESULTS_FORMAT)
 687     $1_MICRO_BASIC_OPTIONS += -rff $$($1_TEST_RESULTS_DIR)/jmh-result.$(MICRO_RESULTS_FORMAT)
 688   endif
 689 
 690   ifneq ($$(MICRO_VM_OPTIONS)$$(MICRO_JAVA_OPTIONS), )
 691     JMH_JVM_ARGS := $$(MICRO_VM_OPTIONS) $$(MICRO_JAVA_OPTIONS)
<span class="line-added"> 692     # Set library path for native dependencies</span>
<span class="line-added"> 693     JMH_JVM_ARGS += -Djava.library.path=$$(TEST_IMAGE_DIR)/micro/native</span>
 694     $1_MICRO_VM_OPTIONS := -jvmArgs $(call ShellQuote,$$(JMH_JVM_ARGS))
 695   endif
 696 
 697   ifneq ($$(MICRO_ITER), )
 698     $1_MICRO_ITER := -i $$(MICRO_ITER)
 699   endif
 700   ifneq ($$(MICRO_FORK), )
 701     $1_MICRO_FORK := -f $$(MICRO_FORK)
 702   endif
 703   ifneq ($$(MICRO_TIME), )
 704     $1_MICRO_TIME := -r $$(MICRO_TIME)
 705   endif
 706   ifneq ($$(MICRO_WARMUP_ITER), )
 707     $1_MICRO_WARMUP_ITER := -wi $$(MICRO_WARMUP_ITER)
 708   endif
 709   ifneq ($$(MICRO_WARMUP_TIME), )
 710     $1_MICRO_WARMUP_TIME := -w $$(MICRO_WARMUP_TIME)
 711   endif
 712 
 713   run-test-$1: pre-run-test
</pre>
</td>
</tr>
</table>
<center><a href="Main.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="RunTestsPrebuiltSpec.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>