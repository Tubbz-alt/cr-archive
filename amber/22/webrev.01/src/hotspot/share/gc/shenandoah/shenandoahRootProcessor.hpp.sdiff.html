<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/shenandoah/shenandoahRootProcessor.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahRootProcessor.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahRootProcessor.inline.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/shenandoahRootProcessor.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
195 };
196 
197 class ShenandoahStringDedupRoots {
198 private:
199   ShenandoahPhaseTimings::Phase _phase;
200 public:
201   ShenandoahStringDedupRoots(ShenandoahPhaseTimings::Phase phase);
202   ~ShenandoahStringDedupRoots();
203 
204   void oops_do(BoolObjectClosure* is_alive, OopClosure* keep_alive, uint worker_id);
205 };
206 
207 class ShenandoahConcurrentStringDedupRoots {
208 public:
209   ShenandoahConcurrentStringDedupRoots();
210   ~ShenandoahConcurrentStringDedupRoots();
211 
212   void oops_do(BoolObjectClosure* is_alive, OopClosure* keep_alive, uint worker_id);
213 };
214 
<span class="line-removed">215 template &lt;typename ITR&gt;</span>
216 class ShenandoahCodeCacheRoots {
217 private:
218   ShenandoahPhaseTimings::Phase _phase;
<span class="line-modified">219   ITR _coderoots_iterator;</span>
220 public:
221   ShenandoahCodeCacheRoots(ShenandoahPhaseTimings::Phase phase);
222   ~ShenandoahCodeCacheRoots();
223 
224   void code_blobs_do(CodeBlobClosure* blob_cl, uint worker_id);
225 };
226 
227 template &lt;bool CONCURRENT, bool SINGLE_THREADED&gt;
228 class ShenandoahClassLoaderDataRoots {
229 private:
230   ShenandoahPhaseTimings::Phase _phase;
231 public:
232   ShenandoahClassLoaderDataRoots(ShenandoahPhaseTimings::Phase phase);
233   ~ShenandoahClassLoaderDataRoots();
234 
235   void always_strong_cld_do(CLDClosure* clds, uint worker_id);
236   void cld_do(CLDClosure* clds, uint worker_id);
237 };
238 
239 class ShenandoahRootProcessor : public StackObj {
240 private:
241   ShenandoahHeap* const               _heap;
242   const ShenandoahPhaseTimings::Phase _phase;
243   const ShenandoahGCWorkerPhase       _worker_phase;
244 public:
245   ShenandoahRootProcessor(ShenandoahPhaseTimings::Phase phase);
246 
247   ShenandoahHeap* heap() const { return _heap; }
248 };
249 
<span class="line-removed">250 template &lt;typename ITR&gt;</span>
251 class ShenandoahRootScanner : public ShenandoahRootProcessor {
252 private:
253   ShenandoahSerialRoots                                     _serial_roots;
254   ShenandoahThreadRoots                                     _thread_roots;
<span class="line-modified">255   ShenandoahCodeCacheRoots&lt;ITR&gt;                             _code_roots;</span>
256   ShenandoahVMRoots&lt;false /*concurrent*/ &gt;                  _vm_roots;
257   ShenandoahStringDedupRoots                                _dedup_roots;
258   ShenandoahClassLoaderDataRoots&lt;false /*concurrent*/, false /*single threaded*/&gt;
259                                                             _cld_roots;
260 public:
261   ShenandoahRootScanner(uint n_workers, ShenandoahPhaseTimings::Phase phase);
262 
263   // Apply oops, clds and blobs to all strongly reachable roots in the system,
264   // during class unloading cycle
265   void strong_roots_do(uint worker_id, OopClosure* cl);
266   void strong_roots_do(uint worker_id, OopClosure* oops, CLDClosure* clds, CodeBlobClosure* code, ThreadClosure* tc = NULL);
267 
268   // Apply oops, clds and blobs to all strongly reachable roots and weakly reachable
269   // roots when class unloading is disabled during this cycle
270   void roots_do(uint worker_id, OopClosure* cl);
271   void roots_do(uint worker_id, OopClosure* oops, CLDClosure* clds, CodeBlobClosure* code, ThreadClosure* tc = NULL);
272 };
273 
<span class="line-removed">274 typedef ShenandoahRootScanner&lt;ShenandoahAllCodeRootsIterator&gt; ShenandoahAllRootScanner;</span>
<span class="line-removed">275 typedef ShenandoahRootScanner&lt;ShenandoahCsetCodeRootsIterator&gt; ShenandoahCSetRootScanner;</span>
<span class="line-removed">276 </span>
277 // This scanner is only for SH::object_iteration() and only supports single-threaded
278 // root scanning
279 class ShenandoahHeapIterationRootScanner : public ShenandoahRootProcessor {
280 private:
281   ShenandoahSerialRoots                                    _serial_roots;
282   ShenandoahThreadRoots                                    _thread_roots;
283   ShenandoahVMRoots&lt;false /*concurrent*/&gt;                  _vm_roots;
284   ShenandoahClassLoaderDataRoots&lt;false /*concurrent*/, true /*single threaded*/&gt;
285                                                            _cld_roots;
286   ShenandoahSerialWeakRoots                                _serial_weak_roots;
287   ShenandoahWeakRoots&lt;false /*concurrent*/&gt;                _weak_roots;
288   ShenandoahConcurrentStringDedupRoots                     _dedup_roots;
<span class="line-modified">289   ShenandoahCodeCacheRoots&lt;ShenandoahAllCodeRootsIterator&gt; _code_roots;</span>
290 
291 public:
292   ShenandoahHeapIterationRootScanner();
293 
294   void roots_do(OopClosure* cl);
295 };
296 
297 // Evacuate all roots at a safepoint
298 class ShenandoahRootEvacuator : public ShenandoahRootProcessor {
299 private:
300   ShenandoahSerialRoots                                     _serial_roots;
301   ShenandoahVMRoots&lt;false /*concurrent*/&gt;                   _vm_roots;
302   ShenandoahClassLoaderDataRoots&lt;false /*concurrent*/, false /*single threaded*/&gt;
303                                                             _cld_roots;
304   ShenandoahThreadRoots                                     _thread_roots;
305   ShenandoahSerialWeakRoots                                 _serial_weak_roots;
306   ShenandoahWeakRoots&lt;false /*concurrent*/&gt;                 _weak_roots;
307   ShenandoahStringDedupRoots                                _dedup_roots;
<span class="line-modified">308   ShenandoahCodeCacheRoots&lt;ShenandoahAllCodeRootsIterator&gt;  _code_roots;</span>
309   bool                                                      _stw_roots_processing;
310   bool                                                      _stw_class_unloading;
311 public:
312   ShenandoahRootEvacuator(uint n_workers, ShenandoahPhaseTimings::Phase phase,
313                           bool stw_roots_processing, bool stw_class_unloading);
314 
315   void roots_do(uint worker_id, OopClosure* oops);
316 };
317 
318 // Update all roots at a safepoint
319 class ShenandoahRootUpdater : public ShenandoahRootProcessor {
320 private:
321   ShenandoahSerialRoots                                     _serial_roots;
322   ShenandoahVMRoots&lt;false /*concurrent*/&gt;                   _vm_roots;
323   ShenandoahClassLoaderDataRoots&lt;false /*concurrent*/, false /*single threaded*/&gt;
324                                                             _cld_roots;
325   ShenandoahThreadRoots                                     _thread_roots;
326   ShenandoahSerialWeakRoots                                 _serial_weak_roots;
327   ShenandoahWeakRoots&lt;false /*concurrent*/&gt;                 _weak_roots;
328   ShenandoahStringDedupRoots                                _dedup_roots;
<span class="line-modified">329   ShenandoahCodeCacheRoots&lt;ShenandoahAllCodeRootsIterator&gt;  _code_roots;</span>
330 
331 public:
332   ShenandoahRootUpdater(uint n_workers, ShenandoahPhaseTimings::Phase phase);
333 
334   template&lt;typename IsAlive, typename KeepAlive&gt;
335   void roots_do(uint worker_id, IsAlive* is_alive, KeepAlive* keep_alive);
336 };
337 
338 // Adjuster all roots at a safepoint during full gc
339 class ShenandoahRootAdjuster : public ShenandoahRootProcessor {
340 private:
341   ShenandoahSerialRoots                                     _serial_roots;
342   ShenandoahVMRoots&lt;false /*concurrent*/&gt;                   _vm_roots;
343   ShenandoahClassLoaderDataRoots&lt;false /*concurrent*/, false /*single threaded*/&gt;
344                                                             _cld_roots;
345   ShenandoahThreadRoots                                     _thread_roots;
346   ShenandoahSerialWeakRoots                                 _serial_weak_roots;
347   ShenandoahWeakRoots&lt;false /*concurrent*/&gt;                 _weak_roots;
348   ShenandoahStringDedupRoots                                _dedup_roots;
<span class="line-modified">349   ShenandoahCodeCacheRoots&lt;ShenandoahAllCodeRootsIterator&gt;  _code_roots;</span>
350 
351 public:
352   ShenandoahRootAdjuster(uint n_workers, ShenandoahPhaseTimings::Phase phase);
353 
354   void roots_do(uint worker_id, OopClosure* oops);
355 };
356 
357 #endif // SHARE_GC_SHENANDOAH_SHENANDOAHROOTPROCESSOR_HPP
</pre>
</td>
<td>
<hr />
<pre>
195 };
196 
197 class ShenandoahStringDedupRoots {
198 private:
199   ShenandoahPhaseTimings::Phase _phase;
200 public:
201   ShenandoahStringDedupRoots(ShenandoahPhaseTimings::Phase phase);
202   ~ShenandoahStringDedupRoots();
203 
204   void oops_do(BoolObjectClosure* is_alive, OopClosure* keep_alive, uint worker_id);
205 };
206 
207 class ShenandoahConcurrentStringDedupRoots {
208 public:
209   ShenandoahConcurrentStringDedupRoots();
210   ~ShenandoahConcurrentStringDedupRoots();
211 
212   void oops_do(BoolObjectClosure* is_alive, OopClosure* keep_alive, uint worker_id);
213 };
214 

215 class ShenandoahCodeCacheRoots {
216 private:
217   ShenandoahPhaseTimings::Phase _phase;
<span class="line-modified">218   ShenandoahCodeRootsIterator   _coderoots_iterator;</span>
219 public:
220   ShenandoahCodeCacheRoots(ShenandoahPhaseTimings::Phase phase);
221   ~ShenandoahCodeCacheRoots();
222 
223   void code_blobs_do(CodeBlobClosure* blob_cl, uint worker_id);
224 };
225 
226 template &lt;bool CONCURRENT, bool SINGLE_THREADED&gt;
227 class ShenandoahClassLoaderDataRoots {
228 private:
229   ShenandoahPhaseTimings::Phase _phase;
230 public:
231   ShenandoahClassLoaderDataRoots(ShenandoahPhaseTimings::Phase phase);
232   ~ShenandoahClassLoaderDataRoots();
233 
234   void always_strong_cld_do(CLDClosure* clds, uint worker_id);
235   void cld_do(CLDClosure* clds, uint worker_id);
236 };
237 
238 class ShenandoahRootProcessor : public StackObj {
239 private:
240   ShenandoahHeap* const               _heap;
241   const ShenandoahPhaseTimings::Phase _phase;
242   const ShenandoahGCWorkerPhase       _worker_phase;
243 public:
244   ShenandoahRootProcessor(ShenandoahPhaseTimings::Phase phase);
245 
246   ShenandoahHeap* heap() const { return _heap; }
247 };
248 

249 class ShenandoahRootScanner : public ShenandoahRootProcessor {
250 private:
251   ShenandoahSerialRoots                                     _serial_roots;
252   ShenandoahThreadRoots                                     _thread_roots;
<span class="line-modified">253   ShenandoahCodeCacheRoots                                  _code_roots;</span>
254   ShenandoahVMRoots&lt;false /*concurrent*/ &gt;                  _vm_roots;
255   ShenandoahStringDedupRoots                                _dedup_roots;
256   ShenandoahClassLoaderDataRoots&lt;false /*concurrent*/, false /*single threaded*/&gt;
257                                                             _cld_roots;
258 public:
259   ShenandoahRootScanner(uint n_workers, ShenandoahPhaseTimings::Phase phase);
260 
261   // Apply oops, clds and blobs to all strongly reachable roots in the system,
262   // during class unloading cycle
263   void strong_roots_do(uint worker_id, OopClosure* cl);
264   void strong_roots_do(uint worker_id, OopClosure* oops, CLDClosure* clds, CodeBlobClosure* code, ThreadClosure* tc = NULL);
265 
266   // Apply oops, clds and blobs to all strongly reachable roots and weakly reachable
267   // roots when class unloading is disabled during this cycle
268   void roots_do(uint worker_id, OopClosure* cl);
269   void roots_do(uint worker_id, OopClosure* oops, CLDClosure* clds, CodeBlobClosure* code, ThreadClosure* tc = NULL);
270 };
271 



272 // This scanner is only for SH::object_iteration() and only supports single-threaded
273 // root scanning
274 class ShenandoahHeapIterationRootScanner : public ShenandoahRootProcessor {
275 private:
276   ShenandoahSerialRoots                                    _serial_roots;
277   ShenandoahThreadRoots                                    _thread_roots;
278   ShenandoahVMRoots&lt;false /*concurrent*/&gt;                  _vm_roots;
279   ShenandoahClassLoaderDataRoots&lt;false /*concurrent*/, true /*single threaded*/&gt;
280                                                            _cld_roots;
281   ShenandoahSerialWeakRoots                                _serial_weak_roots;
282   ShenandoahWeakRoots&lt;false /*concurrent*/&gt;                _weak_roots;
283   ShenandoahConcurrentStringDedupRoots                     _dedup_roots;
<span class="line-modified">284   ShenandoahCodeCacheRoots                                 _code_roots;</span>
285 
286 public:
287   ShenandoahHeapIterationRootScanner();
288 
289   void roots_do(OopClosure* cl);
290 };
291 
292 // Evacuate all roots at a safepoint
293 class ShenandoahRootEvacuator : public ShenandoahRootProcessor {
294 private:
295   ShenandoahSerialRoots                                     _serial_roots;
296   ShenandoahVMRoots&lt;false /*concurrent*/&gt;                   _vm_roots;
297   ShenandoahClassLoaderDataRoots&lt;false /*concurrent*/, false /*single threaded*/&gt;
298                                                             _cld_roots;
299   ShenandoahThreadRoots                                     _thread_roots;
300   ShenandoahSerialWeakRoots                                 _serial_weak_roots;
301   ShenandoahWeakRoots&lt;false /*concurrent*/&gt;                 _weak_roots;
302   ShenandoahStringDedupRoots                                _dedup_roots;
<span class="line-modified">303   ShenandoahCodeCacheRoots                                  _code_roots;</span>
304   bool                                                      _stw_roots_processing;
305   bool                                                      _stw_class_unloading;
306 public:
307   ShenandoahRootEvacuator(uint n_workers, ShenandoahPhaseTimings::Phase phase,
308                           bool stw_roots_processing, bool stw_class_unloading);
309 
310   void roots_do(uint worker_id, OopClosure* oops);
311 };
312 
313 // Update all roots at a safepoint
314 class ShenandoahRootUpdater : public ShenandoahRootProcessor {
315 private:
316   ShenandoahSerialRoots                                     _serial_roots;
317   ShenandoahVMRoots&lt;false /*concurrent*/&gt;                   _vm_roots;
318   ShenandoahClassLoaderDataRoots&lt;false /*concurrent*/, false /*single threaded*/&gt;
319                                                             _cld_roots;
320   ShenandoahThreadRoots                                     _thread_roots;
321   ShenandoahSerialWeakRoots                                 _serial_weak_roots;
322   ShenandoahWeakRoots&lt;false /*concurrent*/&gt;                 _weak_roots;
323   ShenandoahStringDedupRoots                                _dedup_roots;
<span class="line-modified">324   ShenandoahCodeCacheRoots                                  _code_roots;</span>
325 
326 public:
327   ShenandoahRootUpdater(uint n_workers, ShenandoahPhaseTimings::Phase phase);
328 
329   template&lt;typename IsAlive, typename KeepAlive&gt;
330   void roots_do(uint worker_id, IsAlive* is_alive, KeepAlive* keep_alive);
331 };
332 
333 // Adjuster all roots at a safepoint during full gc
334 class ShenandoahRootAdjuster : public ShenandoahRootProcessor {
335 private:
336   ShenandoahSerialRoots                                     _serial_roots;
337   ShenandoahVMRoots&lt;false /*concurrent*/&gt;                   _vm_roots;
338   ShenandoahClassLoaderDataRoots&lt;false /*concurrent*/, false /*single threaded*/&gt;
339                                                             _cld_roots;
340   ShenandoahThreadRoots                                     _thread_roots;
341   ShenandoahSerialWeakRoots                                 _serial_weak_roots;
342   ShenandoahWeakRoots&lt;false /*concurrent*/&gt;                 _weak_roots;
343   ShenandoahStringDedupRoots                                _dedup_roots;
<span class="line-modified">344   ShenandoahCodeCacheRoots                                  _code_roots;</span>
345 
346 public:
347   ShenandoahRootAdjuster(uint n_workers, ShenandoahPhaseTimings::Phase phase);
348 
349   void roots_do(uint worker_id, OopClosure* oops);
350 };
351 
352 #endif // SHARE_GC_SHENANDOAH_SHENANDOAHROOTPROCESSOR_HPP
</pre>
</td>
</tr>
</table>
<center><a href="shenandoahRootProcessor.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahRootProcessor.inline.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>