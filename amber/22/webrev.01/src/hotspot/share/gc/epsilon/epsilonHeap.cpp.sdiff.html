<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/epsilon/epsilonHeap.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="epsilonArguments.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../g1/g1Analytics.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/epsilon/epsilonHeap.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #include &quot;precompiled.hpp&quot;
 26 #include &quot;gc/epsilon/epsilonHeap.hpp&quot;

 27 #include &quot;gc/epsilon/epsilonMemoryPool.hpp&quot;
 28 #include &quot;gc/epsilon/epsilonThreadLocalData.hpp&quot;
 29 #include &quot;gc/shared/gcArguments.hpp&quot;
 30 #include &quot;gc/shared/locationPrinter.inline.hpp&quot;
 31 #include &quot;memory/allocation.hpp&quot;
 32 #include &quot;memory/allocation.inline.hpp&quot;
 33 #include &quot;memory/resourceArea.hpp&quot;
 34 #include &quot;memory/universe.hpp&quot;
 35 #include &quot;runtime/atomic.hpp&quot;
 36 #include &quot;runtime/globals.hpp&quot;
 37 
 38 jint EpsilonHeap::initialize() {
 39   size_t align = HeapAlignment;
 40   size_t init_byte_size = align_up(InitialHeapSize, align);
 41   size_t max_byte_size  = align_up(MaxHeapSize, align);
 42 
 43   // Initialize backing storage
 44   ReservedHeapSpace heap_rs = Universe::reserve_heap(max_byte_size, align);
 45   _virtual_space.initialize(heap_rs, init_byte_size);
 46 
</pre>
<hr />
<pre>
 50   initialize_reserved_region(heap_rs);
 51 
 52   _space = new ContiguousSpace();
 53   _space-&gt;initialize(committed_region, /* clear_space = */ true, /* mangle_space = */ true);
 54 
 55   // Precompute hot fields
 56   _max_tlab_size = MIN2(CollectedHeap::max_tlab_size(), align_object_size(EpsilonMaxTLABSize / HeapWordSize));
 57   _step_counter_update = MIN2&lt;size_t&gt;(max_byte_size / 16, EpsilonUpdateCountersStep);
 58   _step_heap_print = (EpsilonPrintHeapSteps == 0) ? SIZE_MAX : (max_byte_size / EpsilonPrintHeapSteps);
 59   _decay_time_ns = (int64_t) EpsilonTLABDecayTime * NANOSECS_PER_MILLISEC;
 60 
 61   // Enable monitoring
 62   _monitoring_support = new EpsilonMonitoringSupport(this);
 63   _last_counter_update = 0;
 64   _last_heap_print = 0;
 65 
 66   // Install barrier set
 67   BarrierSet::set_barrier_set(new EpsilonBarrierSet());
 68 
 69   // All done, print out the configuration
<span class="line-modified"> 70   if (init_byte_size != max_byte_size) {</span>
<span class="line-removed"> 71     log_info(gc)(&quot;Resizeable heap; starting at &quot; SIZE_FORMAT &quot;M, max: &quot; SIZE_FORMAT &quot;M, step: &quot; SIZE_FORMAT &quot;M&quot;,</span>
<span class="line-removed"> 72                  init_byte_size / M, max_byte_size / M, EpsilonMinHeapExpand / M);</span>
<span class="line-removed"> 73   } else {</span>
<span class="line-removed"> 74     log_info(gc)(&quot;Non-resizeable heap; start/max: &quot; SIZE_FORMAT &quot;M&quot;, init_byte_size / M);</span>
<span class="line-removed"> 75   }</span>
<span class="line-removed"> 76 </span>
<span class="line-removed"> 77   if (UseTLAB) {</span>
<span class="line-removed"> 78     log_info(gc)(&quot;Using TLAB allocation; max: &quot; SIZE_FORMAT &quot;K&quot;, _max_tlab_size * HeapWordSize / K);</span>
<span class="line-removed"> 79     if (EpsilonElasticTLAB) {</span>
<span class="line-removed"> 80       log_info(gc)(&quot;Elastic TLABs enabled; elasticity: %.2fx&quot;, EpsilonTLABElasticity);</span>
<span class="line-removed"> 81     }</span>
<span class="line-removed"> 82     if (EpsilonElasticTLABDecay) {</span>
<span class="line-removed"> 83       log_info(gc)(&quot;Elastic TLABs decay enabled; decay time: &quot; SIZE_FORMAT &quot;ms&quot;, EpsilonTLABDecayTime);</span>
<span class="line-removed"> 84     }</span>
<span class="line-removed"> 85   } else {</span>
<span class="line-removed"> 86     log_info(gc)(&quot;Not using TLAB allocation&quot;);</span>
<span class="line-removed"> 87   }</span>
 88 
 89   return JNI_OK;
 90 }
 91 
 92 void EpsilonHeap::post_initialize() {
 93   CollectedHeap::post_initialize();
 94 }
 95 
 96 void EpsilonHeap::initialize_serviceability() {
 97   _pool = new EpsilonMemoryPool(this);
 98   _memory_manager.add_pool(_pool);
 99 }
100 
101 GrowableArray&lt;GCMemoryManager*&gt; EpsilonHeap::memory_managers() {
102   GrowableArray&lt;GCMemoryManager*&gt; memory_managers(1);
103   memory_managers.append(&amp;_memory_manager);
104   return memory_managers;
105 }
106 
107 GrowableArray&lt;MemoryPool*&gt; EpsilonHeap::memory_pools() {
</pre>
</td>
<td>
<hr />
<pre>
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #include &quot;precompiled.hpp&quot;
 26 #include &quot;gc/epsilon/epsilonHeap.hpp&quot;
<span class="line-added"> 27 #include &quot;gc/epsilon/epsilonInitLogger.hpp&quot;</span>
 28 #include &quot;gc/epsilon/epsilonMemoryPool.hpp&quot;
 29 #include &quot;gc/epsilon/epsilonThreadLocalData.hpp&quot;
 30 #include &quot;gc/shared/gcArguments.hpp&quot;
 31 #include &quot;gc/shared/locationPrinter.inline.hpp&quot;
 32 #include &quot;memory/allocation.hpp&quot;
 33 #include &quot;memory/allocation.inline.hpp&quot;
 34 #include &quot;memory/resourceArea.hpp&quot;
 35 #include &quot;memory/universe.hpp&quot;
 36 #include &quot;runtime/atomic.hpp&quot;
 37 #include &quot;runtime/globals.hpp&quot;
 38 
 39 jint EpsilonHeap::initialize() {
 40   size_t align = HeapAlignment;
 41   size_t init_byte_size = align_up(InitialHeapSize, align);
 42   size_t max_byte_size  = align_up(MaxHeapSize, align);
 43 
 44   // Initialize backing storage
 45   ReservedHeapSpace heap_rs = Universe::reserve_heap(max_byte_size, align);
 46   _virtual_space.initialize(heap_rs, init_byte_size);
 47 
</pre>
<hr />
<pre>
 51   initialize_reserved_region(heap_rs);
 52 
 53   _space = new ContiguousSpace();
 54   _space-&gt;initialize(committed_region, /* clear_space = */ true, /* mangle_space = */ true);
 55 
 56   // Precompute hot fields
 57   _max_tlab_size = MIN2(CollectedHeap::max_tlab_size(), align_object_size(EpsilonMaxTLABSize / HeapWordSize));
 58   _step_counter_update = MIN2&lt;size_t&gt;(max_byte_size / 16, EpsilonUpdateCountersStep);
 59   _step_heap_print = (EpsilonPrintHeapSteps == 0) ? SIZE_MAX : (max_byte_size / EpsilonPrintHeapSteps);
 60   _decay_time_ns = (int64_t) EpsilonTLABDecayTime * NANOSECS_PER_MILLISEC;
 61 
 62   // Enable monitoring
 63   _monitoring_support = new EpsilonMonitoringSupport(this);
 64   _last_counter_update = 0;
 65   _last_heap_print = 0;
 66 
 67   // Install barrier set
 68   BarrierSet::set_barrier_set(new EpsilonBarrierSet());
 69 
 70   // All done, print out the configuration
<span class="line-modified"> 71   EpsilonInitLogger::print();</span>

















 72 
 73   return JNI_OK;
 74 }
 75 
 76 void EpsilonHeap::post_initialize() {
 77   CollectedHeap::post_initialize();
 78 }
 79 
 80 void EpsilonHeap::initialize_serviceability() {
 81   _pool = new EpsilonMemoryPool(this);
 82   _memory_manager.add_pool(_pool);
 83 }
 84 
 85 GrowableArray&lt;GCMemoryManager*&gt; EpsilonHeap::memory_managers() {
 86   GrowableArray&lt;GCMemoryManager*&gt; memory_managers(1);
 87   memory_managers.append(&amp;_memory_manager);
 88   return memory_managers;
 89 }
 90 
 91 GrowableArray&lt;MemoryPool*&gt; EpsilonHeap::memory_pools() {
</pre>
</td>
</tr>
</table>
<center><a href="epsilonArguments.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../g1/g1Analytics.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>