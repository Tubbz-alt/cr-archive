<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/oops/compressedOops.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="compressedOops.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="instanceKlass.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/oops/compressedOops.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -131,28 +131,50 @@</span>
  class CompressedKlassPointers : public AllStatic {
    friend class VMStructs;
  
    static NarrowPtrStruct _narrow_klass;
  
<span class="udiff-line-modified-removed">-   // CompressedClassSpaceSize set to 1GB, but appear 3GB away from _narrow_ptrs_base during CDS dump.</span>
<span class="udiff-line-modified-removed">-   static uint64_t _narrow_klass_range;</span>
<span class="udiff-line-modified-added">+   // Together with base, this defines the address range within which Klass</span>
<span class="udiff-line-modified-added">+   //  structures will be located: [base, base+range). While the maximal</span>
<span class="udiff-line-added">+   //  possible encoding range is 4|32G for shift 0|3, if we know beforehand</span>
<span class="udiff-line-added">+   //  the expected range of Klass* pointers will be smaller, a platform</span>
<span class="udiff-line-added">+   //  could use this info to optimize encoding.</span>
<span class="udiff-line-added">+   static size_t _range;</span>
  
<span class="udiff-line-removed">- public:</span>
    static void set_base(address base);
<span class="udiff-line-added">+   static void set_range(size_t range);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ public:</span>
<span class="udiff-line-added">+ </span>
    static void set_shift(int shift);
<span class="udiff-line-modified-removed">-   static void set_range(uint64_t range);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   // Given an address p, return true if p can be used as an encoding base.</span>
<span class="udiff-line-added">+   //  (Some platforms have restrictions of what constitutes a valid base</span>
<span class="udiff-line-added">+   //   address).</span>
<span class="udiff-line-added">+   static bool is_valid_base(address p);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   // Given an address range [addr, addr+len) which the encoding is supposed to</span>
<span class="udiff-line-added">+   //  cover, choose base, shift and range.</span>
<span class="udiff-line-added">+   //  The address range is the expected range of uncompressed Klass pointers we</span>
<span class="udiff-line-added">+   //  will encounter (and the implicit promise that there will be no Klass</span>
<span class="udiff-line-added">+   //  structures outside this range).</span>
<span class="udiff-line-added">+   static void initialize(address addr, size_t len);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   static void     print_mode(outputStream* st);</span>
  
    static address  base()               { return  _narrow_klass._base; }
<span class="udiff-line-modified-removed">-   static uint64_t range()              { return  _narrow_klass_range; }</span>
<span class="udiff-line-modified-added">+   static size_t   range()              { return  _range; }</span>
    static int      shift()              { return  _narrow_klass._shift; }
  
    static bool is_null(Klass* v)      { return v == NULL; }
    static bool is_null(narrowKlass v) { return v == 0; }
  
    static inline Klass* decode_raw(narrowKlass v);
    static inline Klass* decode_not_null(narrowKlass v);
    static inline Klass* decode(narrowKlass v);
    static inline narrowKlass encode_not_null(Klass* v);
    static inline narrowKlass encode(Klass* v);
<span class="udiff-line-added">+ </span>
  };
  
  #endif // SHARE_OOPS_COMPRESSEDOOPS_HPP
</pre>
<center><a href="compressedOops.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="instanceKlass.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>