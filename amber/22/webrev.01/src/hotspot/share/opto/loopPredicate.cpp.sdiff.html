<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/opto/loopPredicate.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="generateOptoStub.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="loopnode.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/opto/loopPredicate.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  27 #include &quot;opto/addnode.hpp&quot;
  28 #include &quot;opto/callnode.hpp&quot;
  29 #include &quot;opto/connode.hpp&quot;
  30 #include &quot;opto/convertnode.hpp&quot;
  31 #include &quot;opto/loopnode.hpp&quot;
  32 #include &quot;opto/matcher.hpp&quot;
  33 #include &quot;opto/mulnode.hpp&quot;
  34 #include &quot;opto/opaquenode.hpp&quot;
  35 #include &quot;opto/rootnode.hpp&quot;
  36 #include &quot;opto/subnode.hpp&quot;
  37 #include &lt;fenv.h&gt;
  38 #include &lt;math.h&gt;
  39 
  40 /*
  41  * The general idea of Loop Predication is to insert a predicate on the entry
  42  * path to a loop, and raise a uncommon trap if the check of the condition fails.
  43  * The condition checks are promoted from inside the loop body, and thus
  44  * the checks inside the loop could be eliminated. Currently, loop predication
  45  * optimization has been applied to remove array range check and loop invariant
  46  * checks (such as null checks).









  47 */
  48 
  49 //-------------------------------register_control-------------------------
<span class="line-modified">  50 void PhaseIdealLoop::register_control(Node* n, IdealLoopTree *loop, Node* pred) {</span>
<span class="line-modified">  51   assert(n-&gt;is_CFG(), &quot;must be control node&quot;);</span>
  52   _igvn.register_new_node_with_optimizer(n);
<span class="line-modified">  53   loop-&gt;_body.push(n);</span>


  54   set_loop(n, loop);
  55   // When called from beautify_loops() idom is not constructed yet.
  56   if (_idom != NULL) {
  57     set_idom(n, pred, dom_depth(pred));
  58   }
  59 }
  60 
  61 //------------------------------create_new_if_for_predicate------------------------
  62 // create a new if above the uct_if_pattern for the predicate to be promoted.
  63 //
  64 //          before                                after
  65 //        ----------                           ----------
  66 //           ctrl                                 ctrl
  67 //            |                                     |
  68 //            |                                     |
  69 //            v                                     v
  70 //           iff                                 new_iff
  71 //          /    \                                /      \
  72 //         /      \                              /        \
  73 //        v        v                            v          v
</pre>
</td>
<td>
<hr />
<pre>
  27 #include &quot;opto/addnode.hpp&quot;
  28 #include &quot;opto/callnode.hpp&quot;
  29 #include &quot;opto/connode.hpp&quot;
  30 #include &quot;opto/convertnode.hpp&quot;
  31 #include &quot;opto/loopnode.hpp&quot;
  32 #include &quot;opto/matcher.hpp&quot;
  33 #include &quot;opto/mulnode.hpp&quot;
  34 #include &quot;opto/opaquenode.hpp&quot;
  35 #include &quot;opto/rootnode.hpp&quot;
  36 #include &quot;opto/subnode.hpp&quot;
  37 #include &lt;fenv.h&gt;
  38 #include &lt;math.h&gt;
  39 
  40 /*
  41  * The general idea of Loop Predication is to insert a predicate on the entry
  42  * path to a loop, and raise a uncommon trap if the check of the condition fails.
  43  * The condition checks are promoted from inside the loop body, and thus
  44  * the checks inside the loop could be eliminated. Currently, loop predication
  45  * optimization has been applied to remove array range check and loop invariant
  46  * checks (such as null checks).
<span class="line-added">  47  *</span>
<span class="line-added">  48  * There are at least 3 kinds of predicates: a place holder inserted</span>
<span class="line-added">  49  * at parse time, the tests added by predication above the place</span>
<span class="line-added">  50  * holder (referred to as concrete predicates), skeleton predicates</span>
<span class="line-added">  51  * that are added between main loop and pre loop to protect C2 from</span>
<span class="line-added">  52  * inconsistencies in some rare cases of over unrolling. Skeleton</span>
<span class="line-added">  53  * predicates themselves are expanded and updated as unrolling</span>
<span class="line-added">  54  * proceeds. They don&#39;t compile to any code.</span>
<span class="line-added">  55  *</span>
  56 */
  57 
  58 //-------------------------------register_control-------------------------
<span class="line-modified">  59 void PhaseIdealLoop::register_control(Node* n, IdealLoopTree *loop, Node* pred, bool update_body) {</span>
<span class="line-modified">  60   assert(n-&gt;is_CFG(), &quot;msust be control node&quot;);</span>
  61   _igvn.register_new_node_with_optimizer(n);
<span class="line-modified">  62   if (update_body) {</span>
<span class="line-added">  63     loop-&gt;_body.push(n);</span>
<span class="line-added">  64   }</span>
  65   set_loop(n, loop);
  66   // When called from beautify_loops() idom is not constructed yet.
  67   if (_idom != NULL) {
  68     set_idom(n, pred, dom_depth(pred));
  69   }
  70 }
  71 
  72 //------------------------------create_new_if_for_predicate------------------------
  73 // create a new if above the uct_if_pattern for the predicate to be promoted.
  74 //
  75 //          before                                after
  76 //        ----------                           ----------
  77 //           ctrl                                 ctrl
  78 //            |                                     |
  79 //            |                                     |
  80 //            v                                     v
  81 //           iff                                 new_iff
  82 //          /    \                                /      \
  83 //         /      \                              /        \
  84 //        v        v                            v          v
</pre>
</td>
</tr>
</table>
<center><a href="generateOptoStub.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="loopnode.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>