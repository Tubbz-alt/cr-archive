<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/compiler/c2/aarch64/TestVolatiles.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../Test7177917.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../ciReplay/TestSAClient.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/compiler/c2/aarch64/TestVolatiles.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  22  */
  23 
  24 /*
  25  * common code to run and validate tests of code generation for
  26  * volatile ops on AArch64
  27  *
  28  * incoming args are &lt;testclass&gt; &lt;testtype&gt;
  29  *
  30  * where &lt;testclass&gt; in {TestVolatileLoad,
  31  *                       TestVolatileStore,
  32  *                       TestUnsafeVolatileLoad,
  33  *                       TestUnsafeVolatileStore,
  34  *                       TestUnsafeVolatileCAS,
  35  *                       TestUnsafeVolatileWeakCAS,
  36  *                       TestUnsafeVolatileCAE,
  37  *                       TestUnsafeVolatileGAS}
  38  * and &lt;testtype&gt; in {G1,
  39  *                    Serial,
  40  *                    Parallel,
  41  *                    Shenandoah,
<span class="line-modified">  42  *                    ShenandoahTraversal}</span>
  43  */
  44 
  45 
  46 package compiler.c2.aarch64;
  47 
  48 import java.util.List;
  49 import java.util.ListIterator;
  50 import java.util.Iterator;
  51 import java.util.regex.Pattern;
  52 import java.io.*;
  53 
  54 import jdk.test.lib.Asserts;
  55 import jdk.test.lib.compiler.InMemoryJavaCompiler;
  56 import jdk.test.lib.process.OutputAnalyzer;
  57 import jdk.test.lib.process.ProcessTools;
  58 import sun.hotspot.WhiteBox;
  59 
  60 // runner class that spawns a new JVM to exercises a combination of
  61 // volatile MemOp and GC. The ops are compiled with the dmb --&gt;
  62 // ldar/stlr transforms either enabled or disabled. this runner parses
</pre>
<hr />
<pre>
  77             argcount = 9;
  78             procArgs = new String[argcount];
  79             procArgs[argcount - 2] = &quot;-XX:+UseG1GC&quot;;
  80             break;
  81         case &quot;Parallel&quot;:
  82             argcount = 9;
  83             procArgs = new String[argcount];
  84             procArgs[argcount - 2] = &quot;-XX:+UseParallelGC&quot;;
  85             break;
  86         case &quot;Serial&quot;:
  87             argcount = 9;
  88             procArgs = new String[argcount];
  89             procArgs[argcount - 2] = &quot;-XX:+UseSerialGC&quot;;
  90             break;
  91         case &quot;Shenandoah&quot;:
  92             argcount = 10;
  93             procArgs = new String[argcount];
  94             procArgs[argcount - 3] = &quot;-XX:+UnlockExperimentalVMOptions&quot;;
  95             procArgs[argcount - 2] = &quot;-XX:+UseShenandoahGC&quot;;
  96             break;
<span class="line-modified">  97         case &quot;ShenandoahTraversal&quot;:</span>
  98             argcount = 11;
  99             procArgs = new String[argcount];
 100             procArgs[argcount - 4] = &quot;-XX:+UnlockExperimentalVMOptions&quot;;
 101             procArgs[argcount - 3] = &quot;-XX:+UseShenandoahGC&quot;;
<span class="line-modified"> 102             procArgs[argcount - 2] = &quot;-XX:ShenandoahGCMode=traversal&quot;;</span>
 103             break;
 104         default:
 105             throw new RuntimeException(&quot;unexpected test type &quot; + testType);
 106         }
 107 
 108         // fill in arguments common to all cases
 109 
 110         // the first round of test enables transform of barriers to
 111         // use acquiring loads and releasing stores by setting arg
 112         // zero appropriately. this arg is reset in the second run to
 113         // disable the transform.
 114 
 115         procArgs[0] = &quot;-XX:-UseBarriersForVolatile&quot;;
 116         procArgs[1] = &quot;-XX:+UseCompressedOops&quot;;
 117 
 118         procArgs[2] = &quot;-XX:-TieredCompilation&quot;;
 119         procArgs[3] = &quot;-XX:+PrintOptoAssembly&quot;;
 120         procArgs[4] = &quot;-XX:CompileCommand=compileonly,&quot; + fullclassname + &quot;::&quot; + &quot;test*&quot;;
 121         procArgs[5] = &quot;--add-exports&quot;;
 122         procArgs[6] = &quot;java.base/jdk.internal.misc=ALL-UNNAMED&quot;;
</pre>
<hr />
<pre>
 314                 };
 315                 break;
 316             case &quot;G1&quot;:
 317                 // a card mark volatile barrier should be generated
 318                 // before the card mark strb
 319                 //
 320                 // following the fix for 8225776 the G1 barrier is now
 321                 // scheduled out of line after the membar volatile and
 322                 // and subsequent return
 323                 matches = new String[] {
 324                     &quot;membar_release \\(elided\\)&quot;,
 325                     useCompressedOops ? &quot;stlrw?&quot; : &quot;stlr&quot;,
 326                     &quot;membar_volatile \\(elided\\)&quot;,
 327                     &quot;ret&quot;,
 328                     &quot;membar_volatile&quot;,
 329                     &quot;dmb ish&quot;,
 330                     &quot;strb&quot;
 331                 };
 332                 break;
 333             case &quot;Shenandoah&quot;:
<span class="line-modified"> 334             case &quot;ShenandoahTraversal&quot;:</span>
 335                  // Shenandoah generates normal object graphs for
 336                  // volatile stores
 337                 matches = new String[] {
 338                     &quot;membar_release \\(elided\\)&quot;,
 339                     useCompressedOops ? &quot;stlrw?&quot; : &quot;stlr&quot;,
 340                     &quot;membar_volatile \\(elided\\)&quot;,
 341                     &quot;ret&quot;
 342                 };
 343                 break;
 344             }
 345         } else {
 346             switch (testType) {
 347             default:
 348                 // this is the basic sequence of instructions
 349                 matches = new String[] {
 350                     &quot;membar_release&quot;,
 351                     &quot;dmb ish&quot;,
 352                     useCompressedOops ? &quot;strw?&quot; : &quot;str&quot;,
 353                     &quot;membar_volatile&quot;,
 354                     &quot;dmb ish&quot;,
</pre>
<hr />
<pre>
 393                 break;
 394             case &quot;CMS&quot;:
 395                 // a volatile card mark membar should not be generated
 396                 // before the card mark strb from the StoreCM and the
 397                 // storestore barrier from the StoreCM should be generated
 398                 // as &quot;dmb ishst&quot;
 399                 matches = new String[] {
 400                     &quot;membar_release&quot;,
 401                     &quot;dmb ish&quot;,
 402                     useCompressedOops ? &quot;strw?&quot; : &quot;str&quot;,
 403                     &quot;storestore&quot;,
 404                     &quot;dmb ishst&quot;,
 405                     &quot;strb&quot;,
 406                     &quot;membar_volatile&quot;,
 407                     &quot;dmb ish&quot;,
 408                     &quot;ret&quot;
 409                 };
 410                 break;
 411 
 412             case &quot;Shenandoah&quot;:
<span class="line-modified"> 413             case &quot;ShenandoahTraversal&quot;:</span>
 414                  // Shenandoah generates normal object graphs for
 415                  // volatile stores
 416                 matches = new String[] {
 417                     &quot;membar_release&quot;,
 418                     &quot;dmb ish&quot;,
 419                     useCompressedOops ? &quot;strw?&quot; : &quot;str&quot;,
 420                     &quot;membar_volatile&quot;,
 421                     &quot;dmb ish&quot;,
 422                     &quot;ret&quot;
 423                 };
 424                 break;
 425             }
 426         }
 427 
 428         checkCompile(iter, &quot;testObj&quot;, matches, output, true);
 429     }
 430 
 431     // check for expected asm output from a volatile cas
 432 
 433     private void checkcas(OutputAnalyzer output, String testType, boolean useBarriersForVolatile, boolean useCompressedOops) throws Throwable
</pre>
<hr />
<pre>
 483                 };
 484                 break;
 485             case &quot;G1&quot;:
 486                 // a card mark volatile barrier should be generated
 487                 // before the card mark strb
 488                 //
 489                 // following the fix for 8225776 the G1 barrier is now
 490                 // scheduled out of line after the membar acquire and
 491                 // and subsequent return
 492                 matches = new String[] {
 493                     &quot;membar_release \\(elided\\)&quot;,
 494                     useCompressedOops ? &quot;cmpxchgw?_acq&quot; : &quot;cmpxchg_acq&quot;,
 495                     &quot;membar_acquire \\(elided\\)&quot;,
 496                     &quot;ret&quot;,
 497                     &quot;membar_volatile&quot;,
 498                     &quot;dmb ish&quot;,
 499                     &quot;strb&quot;
 500                 };
 501                 break;
 502             case &quot;Shenandoah&quot;:
<span class="line-modified"> 503             case &quot;ShenandoahTraversal&quot;:</span>
 504                 // For volatile CAS, Shenanodoah generates normal
 505                 // graphs with a shenandoah-specific cmpxchg
 506                 matches = new String[] {
 507                     &quot;membar_release \\(elided\\)&quot;,
 508                     useCompressedOops ? &quot;cmpxchgw?_acq_shenandoah&quot; : &quot;cmpxchg_acq_shenandoah&quot;,
 509                     &quot;membar_acquire \\(elided\\)&quot;,
 510                     &quot;ret&quot;
 511                 };
 512                 break;
 513             }
 514         } else {
 515             switch (testType) {
 516             default:
 517                 // this is the basic sequence of instructions
 518                 matches = new String[] {
 519                     &quot;membar_release&quot;,
 520                     &quot;dmb ish&quot;,
 521                     useCompressedOops ? &quot;cmpxchgw? &quot; : &quot;cmpxchg &quot;,
 522                     &quot;membar_acquire&quot;,
 523                     &quot;dmb ish&quot;,
</pre>
<hr />
<pre>
 561                 };
 562                 break;
 563             case &quot;CMS&quot;:
 564                 // a volatile card mark membar should not be generated
 565                 // before the card mark strb from the StoreCM and the
 566                 // storestore barrier from the StoreCM should be generated
 567                 // as &quot;dmb ishst&quot;
 568                 matches = new String[] {
 569                     &quot;membar_release&quot;,
 570                     &quot;dmb ish&quot;,
 571                     useCompressedOops ? &quot;cmpxchgw? &quot; : &quot;cmpxchg &quot;,
 572                     &quot;storestore&quot;,
 573                     &quot;dmb ishst&quot;,
 574                     &quot;strb&quot;,
 575                     &quot;membar_acquire&quot;,
 576                     &quot;dmb ish&quot;,
 577                     &quot;ret&quot;
 578                 };
 579                 break;
 580             case &quot;Shenandoah&quot;:
<span class="line-modified"> 581             case &quot;ShenandoahTraversal&quot;:</span>
 582                 // For volatile CAS, Shenanodoah generates normal
 583                 // graphs with a shenandoah-specific cmpxchg
 584                 matches = new String[] {
 585                     &quot;membar_release&quot;,
 586                     &quot;dmb ish&quot;,
 587                     useCompressedOops ? &quot;cmpxchgw?_shenandoah&quot; : &quot;cmpxchg_shenandoah&quot;,
 588                     &quot;membar_acquire&quot;,
 589                     &quot;dmb ish&quot;,
 590                     &quot;ret&quot;
 591                 };
 592                 break;
 593             }
 594         }
 595 
 596         checkCompile(iter, &quot;testObj&quot;, matches, output, true);
 597     }
 598 
 599     private void checkcae(OutputAnalyzer output, String testType, boolean useBarriersForVolatile, boolean useCompressedOops) throws Throwable
 600     {
 601         ListIterator&lt;String&gt; iter = output.asLines().listIterator();
</pre>
<hr />
<pre>
 667                 return;
 668 
 669             case &quot;G1&quot;:
 670                 // a card mark volatile barrier should be generated
 671                 // before the card mark strb
 672                 //
 673                 // following the fix for 8225776 the G1 barrier is now
 674                 // scheduled out of line after the membar acquire and
 675                 // and subsequent return
 676                 matches = new String[] {
 677                     &quot;membar_release \\(elided\\)&quot;,
 678                     useCompressedOops ? &quot;cmpxchgw?_acq&quot; : &quot;cmpxchg_acq&quot;,
 679                     &quot;membar_acquire \\(elided\\)&quot;,
 680                     &quot;ret&quot;,
 681                     &quot;membar_volatile&quot;,
 682                     &quot;dmb ish&quot;,
 683                     &quot;strb&quot;
 684                 };
 685                 break;
 686             case &quot;Shenandoah&quot;:
<span class="line-modified"> 687             case &quot;ShenandoahTraversal&quot;:</span>
 688                 // For volatile CAS, Shenanodoah generates normal
 689                 // graphs with a shenandoah-specific cmpxchg
 690                 matches = new String[] {
 691                     &quot;membar_release \\(elided\\)&quot;,
 692                     useCompressedOops ? &quot;cmpxchgw?_acq_shenandoah&quot; : &quot;cmpxchg_acq_shenandoah&quot;,
 693                     &quot;membar_acquire \\(elided\\)&quot;,
 694                     &quot;ret&quot;
 695                 };
 696                 break;
 697             }
 698         } else {
 699             switch (testType) {
 700             default:
 701                 // this is the basic sequence of instructions
 702                 matches = new String[] {
 703                     &quot;membar_release&quot;,
 704                     &quot;dmb ish&quot;,
 705                     useCompressedOops ? &quot;cmpxchgw? &quot; : &quot;cmpxchg &quot;,
 706                     &quot;membar_acquire&quot;,
 707                     &quot;dmb ish&quot;,
</pre>
<hr />
<pre>
 745                 };
 746                 break;
 747             case &quot;CMS&quot;:
 748                 // a volatile card mark membar should not be generated
 749                 // before the card mark strb from the StoreCM and the
 750                 // storestore barrier from the StoreCM should be generated
 751                 // as &quot;dmb ishst&quot;
 752                 matches = new String[] {
 753                     &quot;membar_release&quot;,
 754                     &quot;dmb ish&quot;,
 755                     useCompressedOops ? &quot;cmpxchgw? &quot; : &quot;cmpxchg &quot;,
 756                     &quot;storestore&quot;,
 757                     &quot;dmb ishst&quot;,
 758                     &quot;strb&quot;,
 759                     &quot;membar_acquire&quot;,
 760                     &quot;dmb ish&quot;,
 761                     &quot;ret&quot;
 762                 };
 763                 break;
 764             case &quot;Shenandoah&quot;:
<span class="line-modified"> 765             case &quot;ShenandoahTraversal&quot;:</span>
 766                 // For volatile CAS, Shenanodoah generates normal
 767                 // graphs with a shenandoah-specific cmpxchg
 768                 matches = new String[] {
 769                     &quot;membar_release&quot;,
 770                     &quot;dmb ish&quot;,
 771                     useCompressedOops ? &quot;cmpxchgw?_shenandoah&quot; : &quot;cmpxchg_shenandoah&quot;,
 772                     &quot;membar_acquire&quot;,
 773                     &quot;dmb ish&quot;,
 774                     &quot;ret&quot;
 775                 };
 776                 break;
 777             }
 778         }
 779 
 780         checkCompile(iter, &quot;testObj&quot;, matches, output, true);
 781     }
 782 
 783     private void checkgas(OutputAnalyzer output, String testType, boolean useBarriersForVolatile, boolean useCompressedOops) throws Throwable
 784     {
 785         Iterator&lt;String&gt; iter = output.asLines().listIterator();
</pre>
<hr />
<pre>
 831                 };
 832                 break;
 833             case &quot;G1&quot;:
 834                 // a card mark volatile barrier should be generated
 835                 // before the card mark strb
 836                 //
 837                 // following the fix for 8225776 the G1 barrier is now
 838                 // scheduled out of line after the membar acquire and
 839                 // and subsequent return
 840                 matches = new String[] {
 841                     &quot;membar_release \\(elided\\)&quot;,
 842                     useCompressedOops ? &quot;atomic_xchgw?_acq&quot; : &quot;atomic_xchg_acq&quot;,
 843                     &quot;membar_acquire \\(elided\\)&quot;,
 844                     &quot;ret&quot;,
 845                     &quot;membar_volatile&quot;,
 846                     &quot;dmb ish&quot;,
 847                     &quot;strb&quot;
 848                 };
 849                 break;
 850             case &quot;Shenandoah&quot;:
<span class="line-modified"> 851             case &quot;ShenandoahTraversal&quot;:</span>
 852                 matches = new String[] {
 853                     &quot;membar_release \\(elided\\)&quot;,
 854                     useCompressedOops ? &quot;atomic_xchgw?_acq&quot; : &quot;atomic_xchg_acq&quot;,
 855                     &quot;membar_acquire \\(elided\\)&quot;,
 856                     &quot;ret&quot;
 857                 };
 858                 break;
 859             }
 860         } else {
 861             switch (testType) {
 862             default:
 863                 // this is the basic sequence of instructions
 864                 matches = new String[] {
 865                     &quot;membar_release&quot;,
 866                     &quot;dmb ish&quot;,
 867                     useCompressedOops ? &quot;atomic_xchgw? &quot; : &quot;atomic_xchg &quot;,
 868                     &quot;membar_acquire&quot;,
 869                     &quot;dmb ish&quot;,
 870                     &quot;ret&quot;
 871                 };
</pre>
<hr />
<pre>
 907                 };
 908                 break;
 909             case &quot;CMS&quot;:
 910                 // a volatile card mark membar should not be generated
 911                 // before the card mark strb from the StoreCM and the
 912                 // storestore barrier from the StoreCM should be generated
 913                 // as &quot;dmb ishst&quot;
 914                 matches = new String[] {
 915                     &quot;membar_release&quot;,
 916                     &quot;dmb ish&quot;,
 917                     useCompressedOops ? &quot;atomic_xchgw? &quot; : &quot;atomic_xchg &quot;,
 918                     &quot;storestore&quot;,
 919                     &quot;dmb ishst&quot;,
 920                     &quot;strb&quot;,
 921                     &quot;membar_acquire&quot;,
 922                     &quot;dmb ish&quot;,
 923                     &quot;ret&quot;
 924                 };
 925                 break;
 926             case &quot;Shenandoah&quot;:
<span class="line-modified"> 927             case &quot;ShenandoahTraversal&quot;:</span>
 928                 matches = new String[] {
 929                     &quot;membar_release&quot;,
 930                     &quot;dmb ish&quot;,
 931                     useCompressedOops ? &quot;atomic_xchgw? &quot; : &quot;atomic_xchg &quot;,
 932                     &quot;membar_acquire&quot;,
 933                     &quot;dmb ish&quot;,
 934                     &quot;ret&quot;
 935                 };
 936                 break;
 937             }
 938         }
 939 
 940         checkCompile(iter, &quot;testObj&quot;, matches, output, true);
 941     }
 942 
 943     private void checkgaa(OutputAnalyzer output, String testType, boolean useBarriersForVolatile) throws Throwable
 944     {
 945         Iterator&lt;String&gt; iter = output.asLines().listIterator();
 946 
 947         String[] matches;
</pre>
</td>
<td>
<hr />
<pre>
  22  */
  23 
  24 /*
  25  * common code to run and validate tests of code generation for
  26  * volatile ops on AArch64
  27  *
  28  * incoming args are &lt;testclass&gt; &lt;testtype&gt;
  29  *
  30  * where &lt;testclass&gt; in {TestVolatileLoad,
  31  *                       TestVolatileStore,
  32  *                       TestUnsafeVolatileLoad,
  33  *                       TestUnsafeVolatileStore,
  34  *                       TestUnsafeVolatileCAS,
  35  *                       TestUnsafeVolatileWeakCAS,
  36  *                       TestUnsafeVolatileCAE,
  37  *                       TestUnsafeVolatileGAS}
  38  * and &lt;testtype&gt; in {G1,
  39  *                    Serial,
  40  *                    Parallel,
  41  *                    Shenandoah,
<span class="line-modified">  42  *                    ShenandoahIU}</span>
  43  */
  44 
  45 
  46 package compiler.c2.aarch64;
  47 
  48 import java.util.List;
  49 import java.util.ListIterator;
  50 import java.util.Iterator;
  51 import java.util.regex.Pattern;
  52 import java.io.*;
  53 
  54 import jdk.test.lib.Asserts;
  55 import jdk.test.lib.compiler.InMemoryJavaCompiler;
  56 import jdk.test.lib.process.OutputAnalyzer;
  57 import jdk.test.lib.process.ProcessTools;
  58 import sun.hotspot.WhiteBox;
  59 
  60 // runner class that spawns a new JVM to exercises a combination of
  61 // volatile MemOp and GC. The ops are compiled with the dmb --&gt;
  62 // ldar/stlr transforms either enabled or disabled. this runner parses
</pre>
<hr />
<pre>
  77             argcount = 9;
  78             procArgs = new String[argcount];
  79             procArgs[argcount - 2] = &quot;-XX:+UseG1GC&quot;;
  80             break;
  81         case &quot;Parallel&quot;:
  82             argcount = 9;
  83             procArgs = new String[argcount];
  84             procArgs[argcount - 2] = &quot;-XX:+UseParallelGC&quot;;
  85             break;
  86         case &quot;Serial&quot;:
  87             argcount = 9;
  88             procArgs = new String[argcount];
  89             procArgs[argcount - 2] = &quot;-XX:+UseSerialGC&quot;;
  90             break;
  91         case &quot;Shenandoah&quot;:
  92             argcount = 10;
  93             procArgs = new String[argcount];
  94             procArgs[argcount - 3] = &quot;-XX:+UnlockExperimentalVMOptions&quot;;
  95             procArgs[argcount - 2] = &quot;-XX:+UseShenandoahGC&quot;;
  96             break;
<span class="line-modified">  97         case &quot;ShenandoahIU&quot;:</span>
  98             argcount = 11;
  99             procArgs = new String[argcount];
 100             procArgs[argcount - 4] = &quot;-XX:+UnlockExperimentalVMOptions&quot;;
 101             procArgs[argcount - 3] = &quot;-XX:+UseShenandoahGC&quot;;
<span class="line-modified"> 102             procArgs[argcount - 2] = &quot;-XX:ShenandoahGCMode=iu&quot;;</span>
 103             break;
 104         default:
 105             throw new RuntimeException(&quot;unexpected test type &quot; + testType);
 106         }
 107 
 108         // fill in arguments common to all cases
 109 
 110         // the first round of test enables transform of barriers to
 111         // use acquiring loads and releasing stores by setting arg
 112         // zero appropriately. this arg is reset in the second run to
 113         // disable the transform.
 114 
 115         procArgs[0] = &quot;-XX:-UseBarriersForVolatile&quot;;
 116         procArgs[1] = &quot;-XX:+UseCompressedOops&quot;;
 117 
 118         procArgs[2] = &quot;-XX:-TieredCompilation&quot;;
 119         procArgs[3] = &quot;-XX:+PrintOptoAssembly&quot;;
 120         procArgs[4] = &quot;-XX:CompileCommand=compileonly,&quot; + fullclassname + &quot;::&quot; + &quot;test*&quot;;
 121         procArgs[5] = &quot;--add-exports&quot;;
 122         procArgs[6] = &quot;java.base/jdk.internal.misc=ALL-UNNAMED&quot;;
</pre>
<hr />
<pre>
 314                 };
 315                 break;
 316             case &quot;G1&quot;:
 317                 // a card mark volatile barrier should be generated
 318                 // before the card mark strb
 319                 //
 320                 // following the fix for 8225776 the G1 barrier is now
 321                 // scheduled out of line after the membar volatile and
 322                 // and subsequent return
 323                 matches = new String[] {
 324                     &quot;membar_release \\(elided\\)&quot;,
 325                     useCompressedOops ? &quot;stlrw?&quot; : &quot;stlr&quot;,
 326                     &quot;membar_volatile \\(elided\\)&quot;,
 327                     &quot;ret&quot;,
 328                     &quot;membar_volatile&quot;,
 329                     &quot;dmb ish&quot;,
 330                     &quot;strb&quot;
 331                 };
 332                 break;
 333             case &quot;Shenandoah&quot;:
<span class="line-modified"> 334             case &quot;ShenandoahIU&quot;:</span>
 335                  // Shenandoah generates normal object graphs for
 336                  // volatile stores
 337                 matches = new String[] {
 338                     &quot;membar_release \\(elided\\)&quot;,
 339                     useCompressedOops ? &quot;stlrw?&quot; : &quot;stlr&quot;,
 340                     &quot;membar_volatile \\(elided\\)&quot;,
 341                     &quot;ret&quot;
 342                 };
 343                 break;
 344             }
 345         } else {
 346             switch (testType) {
 347             default:
 348                 // this is the basic sequence of instructions
 349                 matches = new String[] {
 350                     &quot;membar_release&quot;,
 351                     &quot;dmb ish&quot;,
 352                     useCompressedOops ? &quot;strw?&quot; : &quot;str&quot;,
 353                     &quot;membar_volatile&quot;,
 354                     &quot;dmb ish&quot;,
</pre>
<hr />
<pre>
 393                 break;
 394             case &quot;CMS&quot;:
 395                 // a volatile card mark membar should not be generated
 396                 // before the card mark strb from the StoreCM and the
 397                 // storestore barrier from the StoreCM should be generated
 398                 // as &quot;dmb ishst&quot;
 399                 matches = new String[] {
 400                     &quot;membar_release&quot;,
 401                     &quot;dmb ish&quot;,
 402                     useCompressedOops ? &quot;strw?&quot; : &quot;str&quot;,
 403                     &quot;storestore&quot;,
 404                     &quot;dmb ishst&quot;,
 405                     &quot;strb&quot;,
 406                     &quot;membar_volatile&quot;,
 407                     &quot;dmb ish&quot;,
 408                     &quot;ret&quot;
 409                 };
 410                 break;
 411 
 412             case &quot;Shenandoah&quot;:
<span class="line-modified"> 413             case &quot;ShenandoahIU&quot;:</span>
 414                  // Shenandoah generates normal object graphs for
 415                  // volatile stores
 416                 matches = new String[] {
 417                     &quot;membar_release&quot;,
 418                     &quot;dmb ish&quot;,
 419                     useCompressedOops ? &quot;strw?&quot; : &quot;str&quot;,
 420                     &quot;membar_volatile&quot;,
 421                     &quot;dmb ish&quot;,
 422                     &quot;ret&quot;
 423                 };
 424                 break;
 425             }
 426         }
 427 
 428         checkCompile(iter, &quot;testObj&quot;, matches, output, true);
 429     }
 430 
 431     // check for expected asm output from a volatile cas
 432 
 433     private void checkcas(OutputAnalyzer output, String testType, boolean useBarriersForVolatile, boolean useCompressedOops) throws Throwable
</pre>
<hr />
<pre>
 483                 };
 484                 break;
 485             case &quot;G1&quot;:
 486                 // a card mark volatile barrier should be generated
 487                 // before the card mark strb
 488                 //
 489                 // following the fix for 8225776 the G1 barrier is now
 490                 // scheduled out of line after the membar acquire and
 491                 // and subsequent return
 492                 matches = new String[] {
 493                     &quot;membar_release \\(elided\\)&quot;,
 494                     useCompressedOops ? &quot;cmpxchgw?_acq&quot; : &quot;cmpxchg_acq&quot;,
 495                     &quot;membar_acquire \\(elided\\)&quot;,
 496                     &quot;ret&quot;,
 497                     &quot;membar_volatile&quot;,
 498                     &quot;dmb ish&quot;,
 499                     &quot;strb&quot;
 500                 };
 501                 break;
 502             case &quot;Shenandoah&quot;:
<span class="line-modified"> 503             case &quot;ShenandoahIU&quot;:</span>
 504                 // For volatile CAS, Shenanodoah generates normal
 505                 // graphs with a shenandoah-specific cmpxchg
 506                 matches = new String[] {
 507                     &quot;membar_release \\(elided\\)&quot;,
 508                     useCompressedOops ? &quot;cmpxchgw?_acq_shenandoah&quot; : &quot;cmpxchg_acq_shenandoah&quot;,
 509                     &quot;membar_acquire \\(elided\\)&quot;,
 510                     &quot;ret&quot;
 511                 };
 512                 break;
 513             }
 514         } else {
 515             switch (testType) {
 516             default:
 517                 // this is the basic sequence of instructions
 518                 matches = new String[] {
 519                     &quot;membar_release&quot;,
 520                     &quot;dmb ish&quot;,
 521                     useCompressedOops ? &quot;cmpxchgw? &quot; : &quot;cmpxchg &quot;,
 522                     &quot;membar_acquire&quot;,
 523                     &quot;dmb ish&quot;,
</pre>
<hr />
<pre>
 561                 };
 562                 break;
 563             case &quot;CMS&quot;:
 564                 // a volatile card mark membar should not be generated
 565                 // before the card mark strb from the StoreCM and the
 566                 // storestore barrier from the StoreCM should be generated
 567                 // as &quot;dmb ishst&quot;
 568                 matches = new String[] {
 569                     &quot;membar_release&quot;,
 570                     &quot;dmb ish&quot;,
 571                     useCompressedOops ? &quot;cmpxchgw? &quot; : &quot;cmpxchg &quot;,
 572                     &quot;storestore&quot;,
 573                     &quot;dmb ishst&quot;,
 574                     &quot;strb&quot;,
 575                     &quot;membar_acquire&quot;,
 576                     &quot;dmb ish&quot;,
 577                     &quot;ret&quot;
 578                 };
 579                 break;
 580             case &quot;Shenandoah&quot;:
<span class="line-modified"> 581             case &quot;ShenandoahIU&quot;:</span>
 582                 // For volatile CAS, Shenanodoah generates normal
 583                 // graphs with a shenandoah-specific cmpxchg
 584                 matches = new String[] {
 585                     &quot;membar_release&quot;,
 586                     &quot;dmb ish&quot;,
 587                     useCompressedOops ? &quot;cmpxchgw?_shenandoah&quot; : &quot;cmpxchg_shenandoah&quot;,
 588                     &quot;membar_acquire&quot;,
 589                     &quot;dmb ish&quot;,
 590                     &quot;ret&quot;
 591                 };
 592                 break;
 593             }
 594         }
 595 
 596         checkCompile(iter, &quot;testObj&quot;, matches, output, true);
 597     }
 598 
 599     private void checkcae(OutputAnalyzer output, String testType, boolean useBarriersForVolatile, boolean useCompressedOops) throws Throwable
 600     {
 601         ListIterator&lt;String&gt; iter = output.asLines().listIterator();
</pre>
<hr />
<pre>
 667                 return;
 668 
 669             case &quot;G1&quot;:
 670                 // a card mark volatile barrier should be generated
 671                 // before the card mark strb
 672                 //
 673                 // following the fix for 8225776 the G1 barrier is now
 674                 // scheduled out of line after the membar acquire and
 675                 // and subsequent return
 676                 matches = new String[] {
 677                     &quot;membar_release \\(elided\\)&quot;,
 678                     useCompressedOops ? &quot;cmpxchgw?_acq&quot; : &quot;cmpxchg_acq&quot;,
 679                     &quot;membar_acquire \\(elided\\)&quot;,
 680                     &quot;ret&quot;,
 681                     &quot;membar_volatile&quot;,
 682                     &quot;dmb ish&quot;,
 683                     &quot;strb&quot;
 684                 };
 685                 break;
 686             case &quot;Shenandoah&quot;:
<span class="line-modified"> 687             case &quot;ShenandoahIU&quot;:</span>
 688                 // For volatile CAS, Shenanodoah generates normal
 689                 // graphs with a shenandoah-specific cmpxchg
 690                 matches = new String[] {
 691                     &quot;membar_release \\(elided\\)&quot;,
 692                     useCompressedOops ? &quot;cmpxchgw?_acq_shenandoah&quot; : &quot;cmpxchg_acq_shenandoah&quot;,
 693                     &quot;membar_acquire \\(elided\\)&quot;,
 694                     &quot;ret&quot;
 695                 };
 696                 break;
 697             }
 698         } else {
 699             switch (testType) {
 700             default:
 701                 // this is the basic sequence of instructions
 702                 matches = new String[] {
 703                     &quot;membar_release&quot;,
 704                     &quot;dmb ish&quot;,
 705                     useCompressedOops ? &quot;cmpxchgw? &quot; : &quot;cmpxchg &quot;,
 706                     &quot;membar_acquire&quot;,
 707                     &quot;dmb ish&quot;,
</pre>
<hr />
<pre>
 745                 };
 746                 break;
 747             case &quot;CMS&quot;:
 748                 // a volatile card mark membar should not be generated
 749                 // before the card mark strb from the StoreCM and the
 750                 // storestore barrier from the StoreCM should be generated
 751                 // as &quot;dmb ishst&quot;
 752                 matches = new String[] {
 753                     &quot;membar_release&quot;,
 754                     &quot;dmb ish&quot;,
 755                     useCompressedOops ? &quot;cmpxchgw? &quot; : &quot;cmpxchg &quot;,
 756                     &quot;storestore&quot;,
 757                     &quot;dmb ishst&quot;,
 758                     &quot;strb&quot;,
 759                     &quot;membar_acquire&quot;,
 760                     &quot;dmb ish&quot;,
 761                     &quot;ret&quot;
 762                 };
 763                 break;
 764             case &quot;Shenandoah&quot;:
<span class="line-modified"> 765             case &quot;ShenandoahIU&quot;:</span>
 766                 // For volatile CAS, Shenanodoah generates normal
 767                 // graphs with a shenandoah-specific cmpxchg
 768                 matches = new String[] {
 769                     &quot;membar_release&quot;,
 770                     &quot;dmb ish&quot;,
 771                     useCompressedOops ? &quot;cmpxchgw?_shenandoah&quot; : &quot;cmpxchg_shenandoah&quot;,
 772                     &quot;membar_acquire&quot;,
 773                     &quot;dmb ish&quot;,
 774                     &quot;ret&quot;
 775                 };
 776                 break;
 777             }
 778         }
 779 
 780         checkCompile(iter, &quot;testObj&quot;, matches, output, true);
 781     }
 782 
 783     private void checkgas(OutputAnalyzer output, String testType, boolean useBarriersForVolatile, boolean useCompressedOops) throws Throwable
 784     {
 785         Iterator&lt;String&gt; iter = output.asLines().listIterator();
</pre>
<hr />
<pre>
 831                 };
 832                 break;
 833             case &quot;G1&quot;:
 834                 // a card mark volatile barrier should be generated
 835                 // before the card mark strb
 836                 //
 837                 // following the fix for 8225776 the G1 barrier is now
 838                 // scheduled out of line after the membar acquire and
 839                 // and subsequent return
 840                 matches = new String[] {
 841                     &quot;membar_release \\(elided\\)&quot;,
 842                     useCompressedOops ? &quot;atomic_xchgw?_acq&quot; : &quot;atomic_xchg_acq&quot;,
 843                     &quot;membar_acquire \\(elided\\)&quot;,
 844                     &quot;ret&quot;,
 845                     &quot;membar_volatile&quot;,
 846                     &quot;dmb ish&quot;,
 847                     &quot;strb&quot;
 848                 };
 849                 break;
 850             case &quot;Shenandoah&quot;:
<span class="line-modified"> 851             case &quot;ShenandoahIU&quot;:</span>
 852                 matches = new String[] {
 853                     &quot;membar_release \\(elided\\)&quot;,
 854                     useCompressedOops ? &quot;atomic_xchgw?_acq&quot; : &quot;atomic_xchg_acq&quot;,
 855                     &quot;membar_acquire \\(elided\\)&quot;,
 856                     &quot;ret&quot;
 857                 };
 858                 break;
 859             }
 860         } else {
 861             switch (testType) {
 862             default:
 863                 // this is the basic sequence of instructions
 864                 matches = new String[] {
 865                     &quot;membar_release&quot;,
 866                     &quot;dmb ish&quot;,
 867                     useCompressedOops ? &quot;atomic_xchgw? &quot; : &quot;atomic_xchg &quot;,
 868                     &quot;membar_acquire&quot;,
 869                     &quot;dmb ish&quot;,
 870                     &quot;ret&quot;
 871                 };
</pre>
<hr />
<pre>
 907                 };
 908                 break;
 909             case &quot;CMS&quot;:
 910                 // a volatile card mark membar should not be generated
 911                 // before the card mark strb from the StoreCM and the
 912                 // storestore barrier from the StoreCM should be generated
 913                 // as &quot;dmb ishst&quot;
 914                 matches = new String[] {
 915                     &quot;membar_release&quot;,
 916                     &quot;dmb ish&quot;,
 917                     useCompressedOops ? &quot;atomic_xchgw? &quot; : &quot;atomic_xchg &quot;,
 918                     &quot;storestore&quot;,
 919                     &quot;dmb ishst&quot;,
 920                     &quot;strb&quot;,
 921                     &quot;membar_acquire&quot;,
 922                     &quot;dmb ish&quot;,
 923                     &quot;ret&quot;
 924                 };
 925                 break;
 926             case &quot;Shenandoah&quot;:
<span class="line-modified"> 927             case &quot;ShenandoahIU&quot;:</span>
 928                 matches = new String[] {
 929                     &quot;membar_release&quot;,
 930                     &quot;dmb ish&quot;,
 931                     useCompressedOops ? &quot;atomic_xchgw? &quot; : &quot;atomic_xchg &quot;,
 932                     &quot;membar_acquire&quot;,
 933                     &quot;dmb ish&quot;,
 934                     &quot;ret&quot;
 935                 };
 936                 break;
 937             }
 938         }
 939 
 940         checkCompile(iter, &quot;testObj&quot;, matches, output, true);
 941     }
 942 
 943     private void checkgaa(OutputAnalyzer output, String testType, boolean useBarriersForVolatile) throws Throwable
 944     {
 945         Iterator&lt;String&gt; iter = output.asLines().listIterator();
 946 
 947         String[] matches;
</pre>
</td>
</tr>
</table>
<center><a href="../Test7177917.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../ciReplay/TestSAClient.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>