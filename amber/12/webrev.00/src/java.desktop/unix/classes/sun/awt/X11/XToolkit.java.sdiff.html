<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/unix/classes/sun/awt/X11/XToolkit.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="XRobotPeer.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../windows/classes/sun/awt/windows/WRobotPeer.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/unix/classes/sun/awt/X11/XToolkit.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2002, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  41 import java.awt.EventQueue;
  42 import java.awt.FileDialog;
  43 import java.awt.Frame;
  44 import java.awt.GraphicsConfiguration;
  45 import java.awt.GraphicsDevice;
  46 import java.awt.GraphicsEnvironment;
  47 import java.awt.HeadlessException;
  48 import java.awt.Image;
  49 import java.awt.Insets;
  50 import java.awt.JobAttributes;
  51 import java.awt.Label;
  52 import java.awt.Menu;
  53 import java.awt.MenuBar;
  54 import java.awt.MenuItem;
  55 import java.awt.PageAttributes;
  56 import java.awt.Panel;
  57 import java.awt.Point;
  58 import java.awt.PopupMenu;
  59 import java.awt.PrintJob;
  60 import java.awt.Rectangle;
<span class="line-removed">  61 import java.awt.Robot;</span>
  62 import java.awt.ScrollPane;
  63 import java.awt.Scrollbar;
  64 import java.awt.SystemColor;
  65 import java.awt.SystemTray;
  66 import java.awt.Taskbar;
  67 import java.awt.TextArea;
  68 import java.awt.TextField;
  69 import java.awt.Toolkit;
  70 import java.awt.TrayIcon;
  71 import java.awt.Window;
  72 import java.awt.datatransfer.Clipboard;
  73 import java.awt.dnd.DragGestureEvent;
  74 import java.awt.dnd.DragGestureListener;
  75 import java.awt.dnd.DragGestureRecognizer;
  76 import java.awt.dnd.DragSource;
  77 import java.awt.dnd.InvalidDnDOperationException;
  78 import java.awt.dnd.MouseDragGestureRecognizer;
  79 import java.awt.dnd.peer.DragSourceContextPeer;
  80 import java.awt.event.InputEvent;
  81 import java.awt.event.KeyEvent;
</pre>
<hr />
<pre>
 841      * &lt;p&gt;
 842      * Note that _NET_WORKAREA is a rectangular area and it does not work
 843      * well in the Xinerama mode.
 844      * &lt;p&gt;
 845      * We will trust the part of this rectangular area only if it starts at the
 846      * requested graphics configuration. Below is an example when the
 847      * _NET_WORKAREA intersects with the requested graphics configuration but
 848      * produces wrong result.
 849      *
 850      *         //&lt;-x1,y1///////
 851      *         //            // ////////////////
 852      *         //  SCREEN1   // // SCREEN2    //
 853      *         // ********** // //     x2,y2-&gt;//
 854      *         //////////////// //            //
 855      *                          ////////////////
 856      *
 857      * When two screens overlap and the first contains a dock(*****), then
 858      * _NET_WORKAREA may start at point x1,y1 and end at point x2,y2.
 859      */
 860     @Override
<span class="line-modified"> 861     public Insets getScreenInsets(GraphicsConfiguration gc)</span>
<span class="line-modified"> 862     {</span>
<span class="line-modified"> 863         XNETProtocol netProto = XWM.getWM().getNETProtocol();</span>
<span class="line-modified"> 864         if ((netProto == null) || !netProto.active())</span>
<span class="line-removed"> 865         {</span>
 866             return super.getScreenInsets(gc);
 867         }
 868 
 869         XToolkit.awtLock();
 870         try
 871         {
 872             X11GraphicsEnvironment x11ge = (X11GraphicsEnvironment)
 873                     GraphicsEnvironment.getLocalGraphicsEnvironment();
 874             X11GraphicsConfig x11gc = (X11GraphicsConfig) gc;
 875             long root = XlibUtil.getRootWindow(x11gc.getDevice().getScreen());
 876             int scale = x11gc.getScale();
 877             if (x11ge.runningXinerama() &amp;&amp; checkSTRUT()) {
 878                 // implementation based on _NET_WM_STRUT/_NET_WM_STRUT_PARTIAL
 879                 Rectangle rootBounds = XlibUtil.getWindowGeometry(root, scale);
 880                 Insets insets = getScreenInsetsManually(root, rootBounds,
 881                                                         gc.getBounds(), scale);
 882                 if ((insets.left | insets.top | insets.bottom | insets.right) != 0
 883                         || rootBounds == null) {
 884                     return insets;
 885                 }
</pre>
<hr />
<pre>
1060     }
1061     */
1062 
1063     // Need this for XMenuItemPeer.
1064     protected static Object targetToPeer(Object target) {
1065         Object p=null;
1066         if (target != null &amp;&amp; !GraphicsEnvironment.isHeadless()) {
1067             p = specialPeerMap.get(target);
1068         }
1069         if (p != null) return p;
1070         else
1071             return SunToolkit.targetToPeer(target);
1072     }
1073 
1074     // Need this for XMenuItemPeer.
1075     protected static void targetDisposedPeer(Object target, Object peer) {
1076         SunToolkit.targetDisposedPeer(target, peer);
1077     }
1078 
1079     @Override
<span class="line-modified">1080     public RobotPeer createRobot(Robot target, GraphicsDevice screen) {</span>
<span class="line-modified">1081         return new XRobotPeer(screen.getDefaultConfiguration());</span>



1082     }
1083 
<span class="line-removed">1084 </span>
1085   /*
1086      * On X, support for dynamic layout on resizing is governed by the
1087      * window manager.  If the window manager supports it, it happens
1088      * automatically.  The setter method for this property is
1089      * irrelevant on X.
1090      */
1091     @Override
1092     public void setDynamicLayout(boolean b) {
1093         dynamicLayoutSetting = b;
1094     }
1095 
1096     @Override
1097     protected boolean isDynamicLayoutSet() {
1098         return dynamicLayoutSetting;
1099     }
1100 
1101     /* Called from isDynamicLayoutActive() and from
1102      * lazilyLoadDynamicLayoutSupportedProperty()
1103      */
1104     protected boolean isDynamicLayoutSupported() {
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2002, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  41 import java.awt.EventQueue;
  42 import java.awt.FileDialog;
  43 import java.awt.Frame;
  44 import java.awt.GraphicsConfiguration;
  45 import java.awt.GraphicsDevice;
  46 import java.awt.GraphicsEnvironment;
  47 import java.awt.HeadlessException;
  48 import java.awt.Image;
  49 import java.awt.Insets;
  50 import java.awt.JobAttributes;
  51 import java.awt.Label;
  52 import java.awt.Menu;
  53 import java.awt.MenuBar;
  54 import java.awt.MenuItem;
  55 import java.awt.PageAttributes;
  56 import java.awt.Panel;
  57 import java.awt.Point;
  58 import java.awt.PopupMenu;
  59 import java.awt.PrintJob;
  60 import java.awt.Rectangle;

  61 import java.awt.ScrollPane;
  62 import java.awt.Scrollbar;
  63 import java.awt.SystemColor;
  64 import java.awt.SystemTray;
  65 import java.awt.Taskbar;
  66 import java.awt.TextArea;
  67 import java.awt.TextField;
  68 import java.awt.Toolkit;
  69 import java.awt.TrayIcon;
  70 import java.awt.Window;
  71 import java.awt.datatransfer.Clipboard;
  72 import java.awt.dnd.DragGestureEvent;
  73 import java.awt.dnd.DragGestureListener;
  74 import java.awt.dnd.DragGestureRecognizer;
  75 import java.awt.dnd.DragSource;
  76 import java.awt.dnd.InvalidDnDOperationException;
  77 import java.awt.dnd.MouseDragGestureRecognizer;
  78 import java.awt.dnd.peer.DragSourceContextPeer;
  79 import java.awt.event.InputEvent;
  80 import java.awt.event.KeyEvent;
</pre>
<hr />
<pre>
 840      * &lt;p&gt;
 841      * Note that _NET_WORKAREA is a rectangular area and it does not work
 842      * well in the Xinerama mode.
 843      * &lt;p&gt;
 844      * We will trust the part of this rectangular area only if it starts at the
 845      * requested graphics configuration. Below is an example when the
 846      * _NET_WORKAREA intersects with the requested graphics configuration but
 847      * produces wrong result.
 848      *
 849      *         //&lt;-x1,y1///////
 850      *         //            // ////////////////
 851      *         //  SCREEN1   // // SCREEN2    //
 852      *         // ********** // //     x2,y2-&gt;//
 853      *         //////////////// //            //
 854      *                          ////////////////
 855      *
 856      * When two screens overlap and the first contains a dock(*****), then
 857      * _NET_WORKAREA may start at point x1,y1 and end at point x2,y2.
 858      */
 859     @Override
<span class="line-modified"> 860     public Insets getScreenInsets(final GraphicsConfiguration gc) {</span>
<span class="line-modified"> 861         GraphicsDevice gd = gc.getDevice();</span>
<span class="line-modified"> 862         XNETProtocol np = XWM.getWM().getNETProtocol();</span>
<span class="line-modified"> 863         if (np == null || !(gd instanceof X11GraphicsDevice) || !np.active()) {</span>

 864             return super.getScreenInsets(gc);
 865         }
 866 
 867         XToolkit.awtLock();
 868         try
 869         {
 870             X11GraphicsEnvironment x11ge = (X11GraphicsEnvironment)
 871                     GraphicsEnvironment.getLocalGraphicsEnvironment();
 872             X11GraphicsConfig x11gc = (X11GraphicsConfig) gc;
 873             long root = XlibUtil.getRootWindow(x11gc.getDevice().getScreen());
 874             int scale = x11gc.getScale();
 875             if (x11ge.runningXinerama() &amp;&amp; checkSTRUT()) {
 876                 // implementation based on _NET_WM_STRUT/_NET_WM_STRUT_PARTIAL
 877                 Rectangle rootBounds = XlibUtil.getWindowGeometry(root, scale);
 878                 Insets insets = getScreenInsetsManually(root, rootBounds,
 879                                                         gc.getBounds(), scale);
 880                 if ((insets.left | insets.top | insets.bottom | insets.right) != 0
 881                         || rootBounds == null) {
 882                     return insets;
 883                 }
</pre>
<hr />
<pre>
1058     }
1059     */
1060 
1061     // Need this for XMenuItemPeer.
1062     protected static Object targetToPeer(Object target) {
1063         Object p=null;
1064         if (target != null &amp;&amp; !GraphicsEnvironment.isHeadless()) {
1065             p = specialPeerMap.get(target);
1066         }
1067         if (p != null) return p;
1068         else
1069             return SunToolkit.targetToPeer(target);
1070     }
1071 
1072     // Need this for XMenuItemPeer.
1073     protected static void targetDisposedPeer(Object target, Object peer) {
1074         SunToolkit.targetDisposedPeer(target, peer);
1075     }
1076 
1077     @Override
<span class="line-modified">1078     public RobotPeer createRobot(GraphicsDevice screen) throws AWTException {</span>
<span class="line-modified">1079         if (screen instanceof X11GraphicsDevice) {</span>
<span class="line-added">1080             return new XRobotPeer((X11GraphicsDevice) screen);</span>
<span class="line-added">1081         }</span>
<span class="line-added">1082         return super.createRobot(screen);</span>
1083     }
1084 

1085   /*
1086      * On X, support for dynamic layout on resizing is governed by the
1087      * window manager.  If the window manager supports it, it happens
1088      * automatically.  The setter method for this property is
1089      * irrelevant on X.
1090      */
1091     @Override
1092     public void setDynamicLayout(boolean b) {
1093         dynamicLayoutSetting = b;
1094     }
1095 
1096     @Override
1097     protected boolean isDynamicLayoutSet() {
1098         return dynamicLayoutSetting;
1099     }
1100 
1101     /* Called from isDynamicLayoutActive() and from
1102      * lazilyLoadDynamicLayoutSupportedProperty()
1103      */
1104     protected boolean isDynamicLayoutSupported() {
</pre>
</td>
</tr>
</table>
<center><a href="XRobotPeer.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../windows/classes/sun/awt/windows/WRobotPeer.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>