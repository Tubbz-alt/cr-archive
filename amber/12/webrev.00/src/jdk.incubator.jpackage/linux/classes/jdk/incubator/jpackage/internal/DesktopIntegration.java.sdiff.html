<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.incubator.jpackage/linux/classes/jdk/incubator/jpackage/internal/DesktopIntegration.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../jdk.hotspot.agent/windows/native/libsaproc/sawindbg.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../macosx/classes/jdk/incubator/jpackage/internal/MacAppImageBuilder.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.incubator.jpackage/linux/classes/jdk/incubator/jpackage/internal/DesktopIntegration.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 67         boolean withDesktopFile = !associations.isEmpty() || SHORTCUT_HINT.fetchFrom(params);
 68 
 69         var curIconResource = LinuxAppImageBuilder.createIconResource(DEFAULT_ICON,
 70                 ICON_PNG, params, mainParams);
 71         if (curIconResource == null) {
 72             // This is additional launcher with explicit `no icon` configuration.
 73             withDesktopFile = false;
 74         } else {
 75             final Path nullPath = null;
 76             if (curIconResource.saveToFile(nullPath)
 77                     != OverridableResource.Source.DefaultResource) {
 78                 // This launcher has custom icon configured.
 79                 withDesktopFile = true;
 80             }
 81         }
 82 
 83         desktopFileResource = createResource(&quot;template.desktop&quot;, params)
 84                 .setCategory(I18N.getString(&quot;resource.menu-shortcut-descriptor&quot;))
 85                 .setPublicName(APP_NAME.fetchFrom(params) + &quot;.desktop&quot;);
 86 


 87         // XDG recommends to use vendor prefix in desktop file names as xdg
 88         // commands copy files to system directories.
 89         // Package name should be a good prefix.
 90         final String desktopFileName = String.format(&quot;%s-%s.desktop&quot;,
<span class="line-modified"> 91                     thePackage.name(), APP_NAME.fetchFrom(params));</span>
 92         final String mimeInfoFileName = String.format(&quot;%s-%s-MimeInfo.xml&quot;,
<span class="line-modified"> 93                     thePackage.name(), APP_NAME.fetchFrom(params));</span>
 94 
 95         mimeInfoFile = new DesktopFile(mimeInfoFileName);
 96 
 97         if (withDesktopFile) {
 98             desktopFile = new DesktopFile(desktopFileName);
<span class="line-modified"> 99             iconFile = new DesktopFile(APP_NAME.fetchFrom(params)</span>
100                     + IOUtils.getSuffix(Path.of(DEFAULT_ICON)));
101 
102             if (curIconResource == null) {
103                 // Create default icon.
104                 curIconResource = LinuxAppImageBuilder.createIconResource(
105                         DEFAULT_ICON, ICON_PNG, mainParams, null);
106             }
107         } else {
108             desktopFile = null;
109             iconFile = null;
110         }
111 
112         iconResource = curIconResource;
113 
114         desktopFileData = Collections.unmodifiableMap(
115                 createDataForDesktopFile(params));
116 
117         nestedIntegrations = new ArrayList&lt;&gt;();
118         for (var launcherParams : launchers) {
119             launcherParams = AddLauncherArguments.merge(params, launcherParams,
</pre>
</td>
<td>
<hr />
<pre>
 67         boolean withDesktopFile = !associations.isEmpty() || SHORTCUT_HINT.fetchFrom(params);
 68 
 69         var curIconResource = LinuxAppImageBuilder.createIconResource(DEFAULT_ICON,
 70                 ICON_PNG, params, mainParams);
 71         if (curIconResource == null) {
 72             // This is additional launcher with explicit `no icon` configuration.
 73             withDesktopFile = false;
 74         } else {
 75             final Path nullPath = null;
 76             if (curIconResource.saveToFile(nullPath)
 77                     != OverridableResource.Source.DefaultResource) {
 78                 // This launcher has custom icon configured.
 79                 withDesktopFile = true;
 80             }
 81         }
 82 
 83         desktopFileResource = createResource(&quot;template.desktop&quot;, params)
 84                 .setCategory(I18N.getString(&quot;resource.menu-shortcut-descriptor&quot;))
 85                 .setPublicName(APP_NAME.fetchFrom(params) + &quot;.desktop&quot;);
 86 
<span class="line-added"> 87         final String escapedAppFileName = APP_NAME.fetchFrom(params).replaceAll(&quot;\\s+&quot;, &quot;_&quot;);</span>
<span class="line-added"> 88 </span>
 89         // XDG recommends to use vendor prefix in desktop file names as xdg
 90         // commands copy files to system directories.
 91         // Package name should be a good prefix.
 92         final String desktopFileName = String.format(&quot;%s-%s.desktop&quot;,
<span class="line-modified"> 93                     thePackage.name(), escapedAppFileName);</span>
 94         final String mimeInfoFileName = String.format(&quot;%s-%s-MimeInfo.xml&quot;,
<span class="line-modified"> 95                     thePackage.name(), escapedAppFileName);</span>
 96 
 97         mimeInfoFile = new DesktopFile(mimeInfoFileName);
 98 
 99         if (withDesktopFile) {
100             desktopFile = new DesktopFile(desktopFileName);
<span class="line-modified">101             iconFile = new DesktopFile(escapedAppFileName</span>
102                     + IOUtils.getSuffix(Path.of(DEFAULT_ICON)));
103 
104             if (curIconResource == null) {
105                 // Create default icon.
106                 curIconResource = LinuxAppImageBuilder.createIconResource(
107                         DEFAULT_ICON, ICON_PNG, mainParams, null);
108             }
109         } else {
110             desktopFile = null;
111             iconFile = null;
112         }
113 
114         iconResource = curIconResource;
115 
116         desktopFileData = Collections.unmodifiableMap(
117                 createDataForDesktopFile(params));
118 
119         nestedIntegrations = new ArrayList&lt;&gt;();
120         for (var launcherParams : launchers) {
121             launcherParams = AddLauncherArguments.merge(params, launcherParams,
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../jdk.hotspot.agent/windows/native/libsaproc/sawindbg.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../macosx/classes/jdk/incubator/jpackage/internal/MacAppImageBuilder.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>