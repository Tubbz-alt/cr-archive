<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/shenandoah/heuristics/shenandoahCompactHeuristics.cpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahAggressiveHeuristics.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="shenandoahPassiveHeuristics.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/heuristics/shenandoahCompactHeuristics.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #include &quot;precompiled.hpp&quot;
 26 
 27 #include &quot;gc/shenandoah/shenandoahCollectionSet.hpp&quot;
 28 #include &quot;gc/shenandoah/heuristics/shenandoahCompactHeuristics.hpp&quot;
 29 #include &quot;gc/shenandoah/shenandoahFreeSet.hpp&quot;
<span class="line-modified"> 30 #include &quot;gc/shenandoah/shenandoahHeapRegion.hpp&quot;</span>
 31 #include &quot;logging/log.hpp&quot;
 32 #include &quot;logging/logTag.hpp&quot;
 33 
 34 ShenandoahCompactHeuristics::ShenandoahCompactHeuristics() : ShenandoahHeuristics() {
 35   SHENANDOAH_ERGO_ENABLE_FLAG(ExplicitGCInvokesConcurrent);
 36   SHENANDOAH_ERGO_ENABLE_FLAG(ShenandoahImplicitGCInvokesConcurrent);
 37   SHENANDOAH_ERGO_ENABLE_FLAG(ShenandoahUncommit);
 38   SHENANDOAH_ERGO_ENABLE_FLAG(ShenandoahAlwaysClearSoftRefs);
 39   SHENANDOAH_ERGO_OVERRIDE_DEFAULT(ShenandoahAllocationThreshold,  10);
 40   SHENANDOAH_ERGO_OVERRIDE_DEFAULT(ShenandoahImmediateThreshold,   100);
 41   SHENANDOAH_ERGO_OVERRIDE_DEFAULT(ShenandoahUncommitDelay,        1000);
 42   SHENANDOAH_ERGO_OVERRIDE_DEFAULT(ShenandoahGuaranteedGCInterval, 30000);
 43   SHENANDOAH_ERGO_OVERRIDE_DEFAULT(ShenandoahGarbageThreshold,     10);
<span class="line-removed"> 44 </span>
<span class="line-removed"> 45   // Final configuration checks</span>
<span class="line-removed"> 46   SHENANDOAH_CHECK_FLAG_SET(ShenandoahLoadRefBarrier);</span>
<span class="line-removed"> 47   SHENANDOAH_CHECK_FLAG_SET(ShenandoahSATBBarrier);</span>
<span class="line-removed"> 48   SHENANDOAH_CHECK_FLAG_SET(ShenandoahKeepAliveBarrier);</span>
<span class="line-removed"> 49   SHENANDOAH_CHECK_FLAG_SET(ShenandoahCASBarrier);</span>
<span class="line-removed"> 50   SHENANDOAH_CHECK_FLAG_SET(ShenandoahCloneBarrier);</span>
 51 }
 52 
 53 bool ShenandoahCompactHeuristics::should_start_gc() const {
 54   ShenandoahHeap* heap = ShenandoahHeap::heap();
 55 
 56   size_t capacity = heap-&gt;max_capacity();
 57   size_t available = heap-&gt;free_set()-&gt;available();
 58 
 59   size_t threshold_bytes_allocated = capacity / 100 * ShenandoahAllocationThreshold;
 60   size_t min_threshold = capacity / 100 * ShenandoahMinFreeThreshold;
 61 
 62   if (available &lt; min_threshold) {
 63     log_info(gc)(&quot;Trigger: Free (&quot; SIZE_FORMAT &quot;%s) is below minimum threshold (&quot; SIZE_FORMAT &quot;%s)&quot;,
 64                  byte_size_in_proper_unit(available),     proper_unit_for_byte_size(available),
 65                  byte_size_in_proper_unit(min_threshold), proper_unit_for_byte_size(min_threshold));
 66     return true;
 67   }
 68 
 69   size_t bytes_allocated = heap-&gt;bytes_allocated_since_gc_start();
 70   if (bytes_allocated &gt; threshold_bytes_allocated) {
</pre>
</td>
<td>
<hr />
<pre>
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #include &quot;precompiled.hpp&quot;
 26 
 27 #include &quot;gc/shenandoah/shenandoahCollectionSet.hpp&quot;
 28 #include &quot;gc/shenandoah/heuristics/shenandoahCompactHeuristics.hpp&quot;
 29 #include &quot;gc/shenandoah/shenandoahFreeSet.hpp&quot;
<span class="line-modified"> 30 #include &quot;gc/shenandoah/shenandoahHeapRegion.inline.hpp&quot;</span>
 31 #include &quot;logging/log.hpp&quot;
 32 #include &quot;logging/logTag.hpp&quot;
 33 
 34 ShenandoahCompactHeuristics::ShenandoahCompactHeuristics() : ShenandoahHeuristics() {
 35   SHENANDOAH_ERGO_ENABLE_FLAG(ExplicitGCInvokesConcurrent);
 36   SHENANDOAH_ERGO_ENABLE_FLAG(ShenandoahImplicitGCInvokesConcurrent);
 37   SHENANDOAH_ERGO_ENABLE_FLAG(ShenandoahUncommit);
 38   SHENANDOAH_ERGO_ENABLE_FLAG(ShenandoahAlwaysClearSoftRefs);
 39   SHENANDOAH_ERGO_OVERRIDE_DEFAULT(ShenandoahAllocationThreshold,  10);
 40   SHENANDOAH_ERGO_OVERRIDE_DEFAULT(ShenandoahImmediateThreshold,   100);
 41   SHENANDOAH_ERGO_OVERRIDE_DEFAULT(ShenandoahUncommitDelay,        1000);
 42   SHENANDOAH_ERGO_OVERRIDE_DEFAULT(ShenandoahGuaranteedGCInterval, 30000);
 43   SHENANDOAH_ERGO_OVERRIDE_DEFAULT(ShenandoahGarbageThreshold,     10);







 44 }
 45 
 46 bool ShenandoahCompactHeuristics::should_start_gc() const {
 47   ShenandoahHeap* heap = ShenandoahHeap::heap();
 48 
 49   size_t capacity = heap-&gt;max_capacity();
 50   size_t available = heap-&gt;free_set()-&gt;available();
 51 
 52   size_t threshold_bytes_allocated = capacity / 100 * ShenandoahAllocationThreshold;
 53   size_t min_threshold = capacity / 100 * ShenandoahMinFreeThreshold;
 54 
 55   if (available &lt; min_threshold) {
 56     log_info(gc)(&quot;Trigger: Free (&quot; SIZE_FORMAT &quot;%s) is below minimum threshold (&quot; SIZE_FORMAT &quot;%s)&quot;,
 57                  byte_size_in_proper_unit(available),     proper_unit_for_byte_size(available),
 58                  byte_size_in_proper_unit(min_threshold), proper_unit_for_byte_size(min_threshold));
 59     return true;
 60   }
 61 
 62   size_t bytes_allocated = heap-&gt;bytes_allocated_since_gc_start();
 63   if (bytes_allocated &gt; threshold_bytes_allocated) {
</pre>
</td>
</tr>
</table>
<center><a href="shenandoahAggressiveHeuristics.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="shenandoahPassiveHeuristics.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>