<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/runtime/vmStructs.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="vmOperations.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="vmStructs.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/runtime/vmStructs.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  89 #include &quot;runtime/java.hpp&quot;
  90 #include &quot;runtime/javaCalls.hpp&quot;
  91 #include &quot;runtime/notificationThread.hpp&quot;
  92 #include &quot;runtime/os.hpp&quot;
  93 #include &quot;runtime/perfMemory.hpp&quot;
  94 #include &quot;runtime/serviceThread.hpp&quot;
  95 #include &quot;runtime/sharedRuntime.hpp&quot;
  96 #include &quot;runtime/stubRoutines.hpp&quot;
  97 #include &quot;runtime/thread.inline.hpp&quot;
  98 #include &quot;runtime/threadSMR.hpp&quot;
  99 #include &quot;runtime/vframeArray.hpp&quot;
 100 #include &quot;runtime/vmStructs.hpp&quot;
 101 #include &quot;utilities/globalDefinitions.hpp&quot;
 102 #include &quot;utilities/hashtable.hpp&quot;
 103 #include &quot;utilities/macros.hpp&quot;
 104 
 105 #include CPU_HEADER(vmStructs)
 106 #include OS_HEADER(vmStructs)
 107 #include OS_CPU_HEADER(vmStructs)
 108 
<span class="line-removed"> 109 #if INCLUDE_JVMCI</span>
<span class="line-removed"> 110 # include &quot;jvmci/vmStructs_jvmci.hpp&quot;</span>
<span class="line-removed"> 111 #endif</span>
<span class="line-removed"> 112 </span>
<span class="line-removed"> 113 </span>
 114 #ifdef COMPILER2
 115 #include &quot;opto/addnode.hpp&quot;
 116 #include &quot;opto/block.hpp&quot;
 117 #include &quot;opto/callnode.hpp&quot;
 118 #include &quot;opto/castnode.hpp&quot;
 119 #include &quot;opto/cfgnode.hpp&quot;
 120 #include &quot;opto/chaitin.hpp&quot;
 121 #include &quot;opto/convertnode.hpp&quot;
 122 #include &quot;opto/divnode.hpp&quot;
 123 #include &quot;opto/intrinsicnode.hpp&quot;
 124 #include &quot;opto/locknode.hpp&quot;
 125 #include &quot;opto/loopnode.hpp&quot;
 126 #include &quot;opto/machnode.hpp&quot;
 127 #include &quot;opto/matcher.hpp&quot;
 128 #include &quot;opto/mathexactnode.hpp&quot;
 129 #include &quot;opto/movenode.hpp&quot;
 130 #include &quot;opto/mulnode.hpp&quot;
 131 #include &quot;opto/narrowptrnode.hpp&quot;
 132 #include &quot;opto/opaquenode.hpp&quot;
 133 #include &quot;opto/optoreg.hpp&quot;
</pre>
<hr />
<pre>
 505   nonstatic_field(BasicHashtableEntry&lt;mtInternal&gt;, _hash,                                     unsigned int)                          \
 506   nonstatic_field(IntptrHashtableEntry,            _literal,                                  intptr_t)                              \
 507                                                                                                                                      \
 508   /*************/                                                                                                                    \
 509   /* Hashtable */                                                                                                                    \
 510   /*************/                                                                                                                    \
 511                                                                                                                                      \
 512   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _table_size,                                   int)                                   \
 513   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _buckets,                                      HashtableBucket&lt;mtInternal&gt;*)          \
 514   volatile_nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _free_list,                           BasicHashtableEntry&lt;mtInternal&gt;*)      \
 515   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _first_free_entry,                             char*)                                 \
 516   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _end_block,                                    char*)                                 \
 517   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _entry_size,                                   int)                                   \
 518                                                                                                                                      \
 519   /*******************/                                                                                                              \
 520   /* ClassLoaderData */                                                                                                              \
 521   /*******************/                                                                                                              \
 522   nonstatic_field(ClassLoaderData,             _class_loader,                                 OopHandle)                             \
 523   nonstatic_field(ClassLoaderData,             _next,                                         ClassLoaderData*)                      \
 524   volatile_nonstatic_field(ClassLoaderData,    _klasses,                                      Klass*)                                \
<span class="line-removed"> 525   nonstatic_field(ClassLoaderData,             _is_unsafe_anonymous,                          bool)                                  \</span>
 526   volatile_nonstatic_field(ClassLoaderData,    _dictionary,                                   Dictionary*)                           \
 527                                                                                                                                      \
 528   static_ptr_volatile_field(ClassLoaderDataGraph, _head,                                      ClassLoaderData*)                      \
 529                                                                                                                                      \
 530   /**********/                                                                                                                       \
 531   /* Arrays */                                                                                                                       \
 532   /**********/                                                                                                                       \
 533                                                                                                                                      \
 534   nonstatic_field(Array&lt;Klass*&gt;,               _length,                                       int)                                   \
 535   nonstatic_field(Array&lt;Klass*&gt;,               _data[0],                                      Klass*)                                \
 536                                                                                                                                      \
 537   /*******************/                                                                                                              \
 538   /* GrowableArrays  */                                                                                                              \
 539   /*******************/                                                                                                              \
 540                                                                                                                                      \
 541   nonstatic_field(GenericGrowableArray,        _len,                                          int)                                   \
 542   nonstatic_field(GenericGrowableArray,        _max,                                          int)                                   \
 543   nonstatic_field(GenericGrowableArray,        _arena,                                        Arena*)                                \
 544   nonstatic_field(GrowableArray&lt;int&gt;,          _data,                                         int*)                                  \
 545                                                                                                                                      \
</pre>
<hr />
<pre>
1804   declare_c2_type(FmaVFNode, VectorNode)                                  \
1805   declare_c2_type(CMoveVFNode, VectorNode)                                \
1806   declare_c2_type(CMoveVDNode, VectorNode)                                \
1807   declare_c2_type(MulReductionVDNode, ReductionNode)                      \
1808   declare_c2_type(DivVFNode, VectorNode)                                  \
1809   declare_c2_type(DivVDNode, VectorNode)                                  \
1810   declare_c2_type(PopCountVINode, VectorNode)                             \
1811   declare_c2_type(LShiftVBNode, VectorNode)                               \
1812   declare_c2_type(LShiftVSNode, VectorNode)                               \
1813   declare_c2_type(LShiftVINode, VectorNode)                               \
1814   declare_c2_type(LShiftVLNode, VectorNode)                               \
1815   declare_c2_type(RShiftVBNode, VectorNode)                               \
1816   declare_c2_type(RShiftVSNode, VectorNode)                               \
1817   declare_c2_type(RShiftVINode, VectorNode)                               \
1818   declare_c2_type(RShiftVLNode, VectorNode)                               \
1819   declare_c2_type(URShiftVBNode, VectorNode)                              \
1820   declare_c2_type(URShiftVSNode, VectorNode)                              \
1821   declare_c2_type(URShiftVINode, VectorNode)                              \
1822   declare_c2_type(URShiftVLNode, VectorNode)                              \
1823   declare_c2_type(AndVNode, VectorNode)                                   \

1824   declare_c2_type(OrVNode, VectorNode)                                    \

1825   declare_c2_type(XorVNode, VectorNode)                                   \

1826   declare_c2_type(MaxVNode, VectorNode)                                   \
1827   declare_c2_type(MinVNode, VectorNode)                                   \
1828   declare_c2_type(MaxReductionVNode, ReductionNode)                       \
1829   declare_c2_type(MinReductionVNode, ReductionNode)                       \
1830   declare_c2_type(LoadVectorNode, LoadNode)                               \
1831   declare_c2_type(StoreVectorNode, StoreNode)                             \
1832   declare_c2_type(ReplicateBNode, VectorNode)                             \
1833   declare_c2_type(ReplicateSNode, VectorNode)                             \
1834   declare_c2_type(ReplicateINode, VectorNode)                             \
1835   declare_c2_type(ReplicateLNode, VectorNode)                             \
1836   declare_c2_type(ReplicateFNode, VectorNode)                             \
1837   declare_c2_type(ReplicateDNode, VectorNode)                             \
1838   declare_c2_type(PackNode, VectorNode)                                   \
1839   declare_c2_type(PackBNode, PackNode)                                    \
1840   declare_c2_type(PackSNode, PackNode)                                    \
1841   declare_c2_type(PackINode, PackNode)                                    \
1842   declare_c2_type(PackLNode, PackNode)                                    \
1843   declare_c2_type(PackFNode, PackNode)                                    \
1844   declare_c2_type(PackDNode, PackNode)                                    \
1845   declare_c2_type(Pack2LNode, PackNode)                                   \
</pre>
<hr />
<pre>
2663   declare_constant(markWord::biased_lock_pattern)                         \
2664                                                                           \
2665   declare_constant(markWord::no_hash)                                     \
2666   declare_constant(markWord::no_hash_in_place)                            \
2667   declare_constant(markWord::no_lock_in_place)                            \
2668   declare_constant(markWord::max_age)                                     \
2669                                                                           \
2670   /* InvocationCounter constants */                                       \
2671   declare_constant(InvocationCounter::count_increment)                    \
2672   declare_constant(InvocationCounter::count_shift)
2673 
2674 
2675 //--------------------------------------------------------------------------------
2676 //
2677 
2678 // Generate and check a nonstatic field in non-product builds
2679 #ifndef PRODUCT
2680 # define GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c) GENERATE_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2681 # define CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)    CHECK_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2682 # define ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT(a, b, c)          ENSURE_FIELD_TYPE_PRESENT(a, b, c)
<span class="line-removed">2683 # define GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c) GENERATE_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)</span>
<span class="line-removed">2684 # define CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)    CHECK_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)</span>
<span class="line-removed">2685 # define ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT(a, b, c)          ENSURE_FIELD_TYPE_PRESENT(a, b, c)</span>
2686 #else
2687 # define GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2688 # define CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2689 # define ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT(a, b, c)
<span class="line-removed">2690 # define GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)</span>
<span class="line-removed">2691 # define CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)</span>
<span class="line-removed">2692 # define ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT(a, b, c)</span>
2693 #endif /* PRODUCT */
2694 
2695 // Generate and check a nonstatic field in C1 builds
2696 #ifdef COMPILER1
2697 # define GENERATE_C1_NONSTATIC_VM_STRUCT_ENTRY(a, b, c) GENERATE_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2698 # define CHECK_C1_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)    CHECK_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2699 # define ENSURE_C1_FIELD_TYPE_PRESENT(a, b, c)          ENSURE_FIELD_TYPE_PRESENT(a, b, c)
2700 #else
2701 # define GENERATE_C1_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2702 # define CHECK_C1_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2703 # define ENSURE_C1_FIELD_TYPE_PRESENT(a, b, c)
2704 #endif /* COMPILER1 */
2705 // Generate and check a nonstatic field in C2 builds
2706 #ifdef COMPILER2
2707 # define GENERATE_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c) GENERATE_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2708 # define CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)    CHECK_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2709 # define ENSURE_C2_FIELD_TYPE_PRESENT(a, b, c)          ENSURE_FIELD_TYPE_PRESENT(a, b, c)
2710 #else
2711 # define GENERATE_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2712 # define CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
</pre>
<hr />
<pre>
2944 
2945   VM_LONG_CONSTANTS_CPU(GENERATE_VM_LONG_CONSTANT_ENTRY,
2946                         GENERATE_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY,
2947                         GENERATE_C1_VM_LONG_CONSTANT_ENTRY,
2948                         GENERATE_C2_VM_LONG_CONSTANT_ENTRY,
2949                         GENERATE_C2_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY)
2950 
2951   VM_LONG_CONSTANTS_OS_CPU(GENERATE_VM_LONG_CONSTANT_ENTRY,
2952                            GENERATE_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY,
2953                            GENERATE_C1_VM_LONG_CONSTANT_ENTRY,
2954                            GENERATE_C2_VM_LONG_CONSTANT_ENTRY,
2955                            GENERATE_C2_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY)
2956 
2957   GENERATE_VM_LONG_CONSTANT_LAST_ENTRY()
2958 };
2959 
2960 size_t VMStructs::localHotSpotVMLongConstantsLength() {
2961   return sizeof(localHotSpotVMLongConstants) / sizeof(VMLongConstantEntry);
2962 }
2963 
<span class="line-modified">2964 // This is used both to check the types of referenced fields and, in</span>
<span class="line-modified">2965 // debug builds, to ensure that all of the field types are present.</span>
<span class="line-modified">2966 void</span>
<span class="line-modified">2967 VMStructs::init() {</span>

































2968   VM_STRUCTS(CHECK_NONSTATIC_VM_STRUCT_ENTRY,
2969              CHECK_STATIC_VM_STRUCT_ENTRY,
2970              CHECK_STATIC_PTR_VOLATILE_VM_STRUCT_ENTRY,
2971              CHECK_NO_OP,
2972              CHECK_VOLATILE_NONSTATIC_VM_STRUCT_ENTRY,
2973              CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY,
2974              CHECK_C1_NONSTATIC_VM_STRUCT_ENTRY,
2975              CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY,
2976              CHECK_NO_OP,
2977              CHECK_NO_OP);
2978 
2979 
2980   VM_STRUCTS_CPU(CHECK_NONSTATIC_VM_STRUCT_ENTRY,
2981                  CHECK_STATIC_VM_STRUCT_ENTRY,
2982                  CHECK_NO_OP,
2983                  CHECK_VOLATILE_NONSTATIC_VM_STRUCT_ENTRY,
2984                  CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY,
2985                  CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY,
2986                  CHECK_NO_OP,
2987                  CHECK_NO_OP);
</pre>
<hr />
<pre>
3023                   CHECK_C2_VM_TYPE_ENTRY,
3024                   CHECK_C2_TOPLEVEL_VM_TYPE_ENTRY);
3025 
3026   //
3027   // Split VM_STRUCTS() invocation into two parts to allow MS VC++ 6.0
3028   // to build with the source mounted over SNC3.2. Symptom was that
3029   // debug build failed with an internal compiler error. Has been seen
3030   // mounting sources from Solaris 2.6 and 2.7 hosts, but so far not
3031   // 2.8 hosts. Appears to occur because line is too long.
3032   //
3033   // If an assertion failure is triggered here it means that an entry
3034   // in VMStructs::localHotSpotVMStructs[] was not found in
3035   // VMStructs::localHotSpotVMTypes[]. (The assertion itself had to be
3036   // made less descriptive because of this above bug -- see the
3037   // definition of ENSURE_FIELD_TYPE_PRESENT.)
3038   //
3039   // NOTE: taken out because this was just not working on everyone&#39;s
3040   // Solstice NFS setup. If everyone switches to local workspaces on
3041   // Win32, we can put this back in.
3042 #ifndef _WINDOWS
<span class="line-modified">3043   debug_only(VM_STRUCTS(ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-modified">3044                         CHECK_NO_OP,</span>
<span class="line-modified">3045                         CHECK_NO_OP,</span>
<span class="line-modified">3046                         CHECK_NO_OP,</span>
<span class="line-modified">3047                         CHECK_NO_OP,</span>
<span class="line-modified">3048                         CHECK_NO_OP,</span>
<span class="line-modified">3049                         CHECK_NO_OP,</span>
<span class="line-modified">3050                         CHECK_NO_OP,</span>
<span class="line-modified">3051                         CHECK_NO_OP,</span>
<span class="line-modified">3052                         CHECK_NO_OP));</span>
<span class="line-removed">3053   debug_only(VM_STRUCTS(CHECK_NO_OP,</span>
<span class="line-removed">3054                         ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3055                         ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3056                         CHECK_NO_OP,</span>
<span class="line-removed">3057                         ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3058                         ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3059                         ENSURE_C1_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3060                         ENSURE_C2_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3061                         CHECK_NO_OP,</span>
<span class="line-removed">3062                         CHECK_NO_OP));</span>
<span class="line-removed">3063 </span>
<span class="line-removed">3064   debug_only(VM_STRUCTS_CPU(ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3065                             ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3066                             CHECK_NO_OP,</span>
<span class="line-removed">3067                             ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3068                             ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3069                             ENSURE_C2_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3070                             CHECK_NO_OP,</span>
<span class="line-removed">3071                             CHECK_NO_OP));</span>
<span class="line-removed">3072   debug_only(VM_STRUCTS_OS_CPU(ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3073                                ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3074                                CHECK_NO_OP,</span>
<span class="line-removed">3075                                ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3076                                ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3077                                ENSURE_C2_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3078                                CHECK_NO_OP,</span>
<span class="line-removed">3079                                CHECK_NO_OP));</span>
<span class="line-removed">3080 #endif</span>
<span class="line-removed">3081 }</span>
<span class="line-removed">3082 </span>
<span class="line-removed">3083 extern &quot;C&quot; {</span>
<span class="line-removed">3084 </span>
<span class="line-removed">3085 #define STRIDE(array) ((char*)&amp;array[1] - (char*)&amp;array[0])</span>
<span class="line-removed">3086 </span>
<span class="line-removed">3087 JNIEXPORT VMStructEntry* gHotSpotVMStructs = VMStructs::localHotSpotVMStructs;</span>
<span class="line-removed">3088 JNIEXPORT uint64_t gHotSpotVMStructEntryTypeNameOffset = offset_of(VMStructEntry, typeName);</span>
<span class="line-removed">3089 JNIEXPORT uint64_t gHotSpotVMStructEntryFieldNameOffset = offset_of(VMStructEntry, fieldName);</span>
<span class="line-removed">3090 JNIEXPORT uint64_t gHotSpotVMStructEntryTypeStringOffset = offset_of(VMStructEntry, typeString);</span>
<span class="line-removed">3091 JNIEXPORT uint64_t gHotSpotVMStructEntryIsStaticOffset = offset_of(VMStructEntry, isStatic);</span>
<span class="line-removed">3092 JNIEXPORT uint64_t gHotSpotVMStructEntryOffsetOffset = offset_of(VMStructEntry, offset);</span>
<span class="line-removed">3093 JNIEXPORT uint64_t gHotSpotVMStructEntryAddressOffset = offset_of(VMStructEntry, address);</span>
<span class="line-removed">3094 JNIEXPORT uint64_t gHotSpotVMStructEntryArrayStride = STRIDE(gHotSpotVMStructs);</span>
<span class="line-removed">3095 </span>
<span class="line-removed">3096 JNIEXPORT VMTypeEntry* gHotSpotVMTypes = VMStructs::localHotSpotVMTypes;</span>
<span class="line-removed">3097 JNIEXPORT uint64_t gHotSpotVMTypeEntryTypeNameOffset = offset_of(VMTypeEntry, typeName);</span>
<span class="line-removed">3098 JNIEXPORT uint64_t gHotSpotVMTypeEntrySuperclassNameOffset = offset_of(VMTypeEntry, superclassName);</span>
<span class="line-removed">3099 JNIEXPORT uint64_t gHotSpotVMTypeEntryIsOopTypeOffset = offset_of(VMTypeEntry, isOopType);</span>
<span class="line-removed">3100 JNIEXPORT uint64_t gHotSpotVMTypeEntryIsIntegerTypeOffset = offset_of(VMTypeEntry, isIntegerType);</span>
<span class="line-removed">3101 JNIEXPORT uint64_t gHotSpotVMTypeEntryIsUnsignedOffset = offset_of(VMTypeEntry, isUnsigned);</span>
<span class="line-removed">3102 JNIEXPORT uint64_t gHotSpotVMTypeEntrySizeOffset = offset_of(VMTypeEntry, size);</span>
<span class="line-removed">3103 JNIEXPORT uint64_t gHotSpotVMTypeEntryArrayStride = STRIDE(gHotSpotVMTypes);</span>
3104 
<span class="line-modified">3105 JNIEXPORT VMIntConstantEntry* gHotSpotVMIntConstants = VMStructs::localHotSpotVMIntConstants;</span>
<span class="line-modified">3106 JNIEXPORT uint64_t gHotSpotVMIntConstantEntryNameOffset = offset_of(VMIntConstantEntry, name);</span>
<span class="line-modified">3107 JNIEXPORT uint64_t gHotSpotVMIntConstantEntryValueOffset = offset_of(VMIntConstantEntry, value);</span>
<span class="line-modified">3108 JNIEXPORT uint64_t gHotSpotVMIntConstantEntryArrayStride = STRIDE(gHotSpotVMIntConstants);</span>






3109 
<span class="line-modified">3110 JNIEXPORT VMLongConstantEntry* gHotSpotVMLongConstants = VMStructs::localHotSpotVMLongConstants;</span>
<span class="line-modified">3111 JNIEXPORT uint64_t gHotSpotVMLongConstantEntryNameOffset = offset_of(VMLongConstantEntry, name);</span>
<span class="line-modified">3112 JNIEXPORT uint64_t gHotSpotVMLongConstantEntryValueOffset = offset_of(VMLongConstantEntry, value);</span>
<span class="line-modified">3113 JNIEXPORT uint64_t gHotSpotVMLongConstantEntryArrayStride = STRIDE(gHotSpotVMLongConstants);</span>













3114 }
3115 
<span class="line-removed">3116 #ifdef ASSERT</span>
3117 static int recursiveFindType(VMTypeEntry* origtypes, const char* typeName, bool isRecurse) {
3118   {
3119     VMTypeEntry* types = origtypes;
3120     while (types-&gt;typeName != NULL) {
3121       if (strcmp(typeName, types-&gt;typeName) == 0) {
3122         // Found it
3123         return 1;
3124       }
3125       ++types;
3126     }
3127   }
3128   // Search for the base type by peeling off const and *
3129   size_t len = strlen(typeName);
3130   if (typeName[len-1] == &#39;*&#39;) {
3131     char * s = NEW_C_HEAP_ARRAY(char, len, mtInternal);
3132     strncpy(s, typeName, len - 1);
3133     s[len-1] = &#39;\0&#39;;
3134     // tty-&gt;print_cr(&quot;checking \&quot;%s\&quot; for \&quot;%s\&quot;&quot;, s, typeName);
3135     if (recursiveFindType(origtypes, s, true) == 1) {
3136       FREE_C_HEAP_ARRAY(char, s);
</pre>
<hr />
<pre>
3163     if (recursiveFindType(origtypes, s, true) == 1) {
3164       return 1;
3165     }
3166   }
3167   if (strstr(typeName, &quot; const&quot;) == typeName + len - 6) {
3168     char * s = os::strdup_check_oom(typeName);
3169     s[len - 6] = &#39;\0&#39;;
3170     // tty-&gt;print_cr(&quot;checking \&quot;%s\&quot; for \&quot;%s\&quot;&quot;, s, typeName);
3171     if (recursiveFindType(origtypes, s, true) == 1) {
3172       os::free(s);
3173       return 1;
3174     }
3175     os::free(s);
3176   }
3177   if (!isRecurse) {
3178     tty-&gt;print_cr(&quot;type \&quot;%s\&quot; not found&quot;, typeName);
3179   }
3180   return 0;
3181 }
3182 
<span class="line-modified">3183 </span>
<span class="line-removed">3184 int</span>
<span class="line-removed">3185 VMStructs::findType(const char* typeName) {</span>
3186   VMTypeEntry* types = gHotSpotVMTypes;
3187 
3188   return recursiveFindType(types, typeName, false);
3189 }
<span class="line-removed">3190 #endif</span>
3191 
3192 void vmStructs_init() {
<span class="line-modified">3193   debug_only(VMStructs::init());</span>
3194 }

</pre>
</td>
<td>
<hr />
<pre>
  89 #include &quot;runtime/java.hpp&quot;
  90 #include &quot;runtime/javaCalls.hpp&quot;
  91 #include &quot;runtime/notificationThread.hpp&quot;
  92 #include &quot;runtime/os.hpp&quot;
  93 #include &quot;runtime/perfMemory.hpp&quot;
  94 #include &quot;runtime/serviceThread.hpp&quot;
  95 #include &quot;runtime/sharedRuntime.hpp&quot;
  96 #include &quot;runtime/stubRoutines.hpp&quot;
  97 #include &quot;runtime/thread.inline.hpp&quot;
  98 #include &quot;runtime/threadSMR.hpp&quot;
  99 #include &quot;runtime/vframeArray.hpp&quot;
 100 #include &quot;runtime/vmStructs.hpp&quot;
 101 #include &quot;utilities/globalDefinitions.hpp&quot;
 102 #include &quot;utilities/hashtable.hpp&quot;
 103 #include &quot;utilities/macros.hpp&quot;
 104 
 105 #include CPU_HEADER(vmStructs)
 106 #include OS_HEADER(vmStructs)
 107 #include OS_CPU_HEADER(vmStructs)
 108 





 109 #ifdef COMPILER2
 110 #include &quot;opto/addnode.hpp&quot;
 111 #include &quot;opto/block.hpp&quot;
 112 #include &quot;opto/callnode.hpp&quot;
 113 #include &quot;opto/castnode.hpp&quot;
 114 #include &quot;opto/cfgnode.hpp&quot;
 115 #include &quot;opto/chaitin.hpp&quot;
 116 #include &quot;opto/convertnode.hpp&quot;
 117 #include &quot;opto/divnode.hpp&quot;
 118 #include &quot;opto/intrinsicnode.hpp&quot;
 119 #include &quot;opto/locknode.hpp&quot;
 120 #include &quot;opto/loopnode.hpp&quot;
 121 #include &quot;opto/machnode.hpp&quot;
 122 #include &quot;opto/matcher.hpp&quot;
 123 #include &quot;opto/mathexactnode.hpp&quot;
 124 #include &quot;opto/movenode.hpp&quot;
 125 #include &quot;opto/mulnode.hpp&quot;
 126 #include &quot;opto/narrowptrnode.hpp&quot;
 127 #include &quot;opto/opaquenode.hpp&quot;
 128 #include &quot;opto/optoreg.hpp&quot;
</pre>
<hr />
<pre>
 500   nonstatic_field(BasicHashtableEntry&lt;mtInternal&gt;, _hash,                                     unsigned int)                          \
 501   nonstatic_field(IntptrHashtableEntry,            _literal,                                  intptr_t)                              \
 502                                                                                                                                      \
 503   /*************/                                                                                                                    \
 504   /* Hashtable */                                                                                                                    \
 505   /*************/                                                                                                                    \
 506                                                                                                                                      \
 507   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _table_size,                                   int)                                   \
 508   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _buckets,                                      HashtableBucket&lt;mtInternal&gt;*)          \
 509   volatile_nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _free_list,                           BasicHashtableEntry&lt;mtInternal&gt;*)      \
 510   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _first_free_entry,                             char*)                                 \
 511   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _end_block,                                    char*)                                 \
 512   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _entry_size,                                   int)                                   \
 513                                                                                                                                      \
 514   /*******************/                                                                                                              \
 515   /* ClassLoaderData */                                                                                                              \
 516   /*******************/                                                                                                              \
 517   nonstatic_field(ClassLoaderData,             _class_loader,                                 OopHandle)                             \
 518   nonstatic_field(ClassLoaderData,             _next,                                         ClassLoaderData*)                      \
 519   volatile_nonstatic_field(ClassLoaderData,    _klasses,                                      Klass*)                                \

 520   volatile_nonstatic_field(ClassLoaderData,    _dictionary,                                   Dictionary*)                           \
 521                                                                                                                                      \
 522   static_ptr_volatile_field(ClassLoaderDataGraph, _head,                                      ClassLoaderData*)                      \
 523                                                                                                                                      \
 524   /**********/                                                                                                                       \
 525   /* Arrays */                                                                                                                       \
 526   /**********/                                                                                                                       \
 527                                                                                                                                      \
 528   nonstatic_field(Array&lt;Klass*&gt;,               _length,                                       int)                                   \
 529   nonstatic_field(Array&lt;Klass*&gt;,               _data[0],                                      Klass*)                                \
 530                                                                                                                                      \
 531   /*******************/                                                                                                              \
 532   /* GrowableArrays  */                                                                                                              \
 533   /*******************/                                                                                                              \
 534                                                                                                                                      \
 535   nonstatic_field(GenericGrowableArray,        _len,                                          int)                                   \
 536   nonstatic_field(GenericGrowableArray,        _max,                                          int)                                   \
 537   nonstatic_field(GenericGrowableArray,        _arena,                                        Arena*)                                \
 538   nonstatic_field(GrowableArray&lt;int&gt;,          _data,                                         int*)                                  \
 539                                                                                                                                      \
</pre>
<hr />
<pre>
1798   declare_c2_type(FmaVFNode, VectorNode)                                  \
1799   declare_c2_type(CMoveVFNode, VectorNode)                                \
1800   declare_c2_type(CMoveVDNode, VectorNode)                                \
1801   declare_c2_type(MulReductionVDNode, ReductionNode)                      \
1802   declare_c2_type(DivVFNode, VectorNode)                                  \
1803   declare_c2_type(DivVDNode, VectorNode)                                  \
1804   declare_c2_type(PopCountVINode, VectorNode)                             \
1805   declare_c2_type(LShiftVBNode, VectorNode)                               \
1806   declare_c2_type(LShiftVSNode, VectorNode)                               \
1807   declare_c2_type(LShiftVINode, VectorNode)                               \
1808   declare_c2_type(LShiftVLNode, VectorNode)                               \
1809   declare_c2_type(RShiftVBNode, VectorNode)                               \
1810   declare_c2_type(RShiftVSNode, VectorNode)                               \
1811   declare_c2_type(RShiftVINode, VectorNode)                               \
1812   declare_c2_type(RShiftVLNode, VectorNode)                               \
1813   declare_c2_type(URShiftVBNode, VectorNode)                              \
1814   declare_c2_type(URShiftVSNode, VectorNode)                              \
1815   declare_c2_type(URShiftVINode, VectorNode)                              \
1816   declare_c2_type(URShiftVLNode, VectorNode)                              \
1817   declare_c2_type(AndVNode, VectorNode)                                   \
<span class="line-added">1818   declare_c2_type(AndReductionVNode, ReductionNode)                       \</span>
1819   declare_c2_type(OrVNode, VectorNode)                                    \
<span class="line-added">1820   declare_c2_type(OrReductionVNode, ReductionNode)                        \</span>
1821   declare_c2_type(XorVNode, VectorNode)                                   \
<span class="line-added">1822   declare_c2_type(XorReductionVNode, ReductionNode)                       \</span>
1823   declare_c2_type(MaxVNode, VectorNode)                                   \
1824   declare_c2_type(MinVNode, VectorNode)                                   \
1825   declare_c2_type(MaxReductionVNode, ReductionNode)                       \
1826   declare_c2_type(MinReductionVNode, ReductionNode)                       \
1827   declare_c2_type(LoadVectorNode, LoadNode)                               \
1828   declare_c2_type(StoreVectorNode, StoreNode)                             \
1829   declare_c2_type(ReplicateBNode, VectorNode)                             \
1830   declare_c2_type(ReplicateSNode, VectorNode)                             \
1831   declare_c2_type(ReplicateINode, VectorNode)                             \
1832   declare_c2_type(ReplicateLNode, VectorNode)                             \
1833   declare_c2_type(ReplicateFNode, VectorNode)                             \
1834   declare_c2_type(ReplicateDNode, VectorNode)                             \
1835   declare_c2_type(PackNode, VectorNode)                                   \
1836   declare_c2_type(PackBNode, PackNode)                                    \
1837   declare_c2_type(PackSNode, PackNode)                                    \
1838   declare_c2_type(PackINode, PackNode)                                    \
1839   declare_c2_type(PackLNode, PackNode)                                    \
1840   declare_c2_type(PackFNode, PackNode)                                    \
1841   declare_c2_type(PackDNode, PackNode)                                    \
1842   declare_c2_type(Pack2LNode, PackNode)                                   \
</pre>
<hr />
<pre>
2660   declare_constant(markWord::biased_lock_pattern)                         \
2661                                                                           \
2662   declare_constant(markWord::no_hash)                                     \
2663   declare_constant(markWord::no_hash_in_place)                            \
2664   declare_constant(markWord::no_lock_in_place)                            \
2665   declare_constant(markWord::max_age)                                     \
2666                                                                           \
2667   /* InvocationCounter constants */                                       \
2668   declare_constant(InvocationCounter::count_increment)                    \
2669   declare_constant(InvocationCounter::count_shift)
2670 
2671 
2672 //--------------------------------------------------------------------------------
2673 //
2674 
2675 // Generate and check a nonstatic field in non-product builds
2676 #ifndef PRODUCT
2677 # define GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c) GENERATE_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2678 # define CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)    CHECK_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2679 # define ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT(a, b, c)          ENSURE_FIELD_TYPE_PRESENT(a, b, c)



2680 #else
2681 # define GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2682 # define CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2683 # define ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT(a, b, c)



2684 #endif /* PRODUCT */
2685 
2686 // Generate and check a nonstatic field in C1 builds
2687 #ifdef COMPILER1
2688 # define GENERATE_C1_NONSTATIC_VM_STRUCT_ENTRY(a, b, c) GENERATE_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2689 # define CHECK_C1_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)    CHECK_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2690 # define ENSURE_C1_FIELD_TYPE_PRESENT(a, b, c)          ENSURE_FIELD_TYPE_PRESENT(a, b, c)
2691 #else
2692 # define GENERATE_C1_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2693 # define CHECK_C1_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2694 # define ENSURE_C1_FIELD_TYPE_PRESENT(a, b, c)
2695 #endif /* COMPILER1 */
2696 // Generate and check a nonstatic field in C2 builds
2697 #ifdef COMPILER2
2698 # define GENERATE_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c) GENERATE_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2699 # define CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)    CHECK_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2700 # define ENSURE_C2_FIELD_TYPE_PRESENT(a, b, c)          ENSURE_FIELD_TYPE_PRESENT(a, b, c)
2701 #else
2702 # define GENERATE_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2703 # define CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
</pre>
<hr />
<pre>
2935 
2936   VM_LONG_CONSTANTS_CPU(GENERATE_VM_LONG_CONSTANT_ENTRY,
2937                         GENERATE_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY,
2938                         GENERATE_C1_VM_LONG_CONSTANT_ENTRY,
2939                         GENERATE_C2_VM_LONG_CONSTANT_ENTRY,
2940                         GENERATE_C2_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY)
2941 
2942   VM_LONG_CONSTANTS_OS_CPU(GENERATE_VM_LONG_CONSTANT_ENTRY,
2943                            GENERATE_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY,
2944                            GENERATE_C1_VM_LONG_CONSTANT_ENTRY,
2945                            GENERATE_C2_VM_LONG_CONSTANT_ENTRY,
2946                            GENERATE_C2_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY)
2947 
2948   GENERATE_VM_LONG_CONSTANT_LAST_ENTRY()
2949 };
2950 
2951 size_t VMStructs::localHotSpotVMLongConstantsLength() {
2952   return sizeof(localHotSpotVMLongConstants) / sizeof(VMLongConstantEntry);
2953 }
2954 
<span class="line-modified">2955 extern &quot;C&quot; {</span>
<span class="line-modified">2956 </span>
<span class="line-modified">2957 #define STRIDE(array) ((char*)&amp;array[1] - (char*)&amp;array[0])</span>
<span class="line-modified">2958 </span>
<span class="line-added">2959 JNIEXPORT VMStructEntry* gHotSpotVMStructs = VMStructs::localHotSpotVMStructs;</span>
<span class="line-added">2960 JNIEXPORT uint64_t gHotSpotVMStructEntryTypeNameOffset = offset_of(VMStructEntry, typeName);</span>
<span class="line-added">2961 JNIEXPORT uint64_t gHotSpotVMStructEntryFieldNameOffset = offset_of(VMStructEntry, fieldName);</span>
<span class="line-added">2962 JNIEXPORT uint64_t gHotSpotVMStructEntryTypeStringOffset = offset_of(VMStructEntry, typeString);</span>
<span class="line-added">2963 JNIEXPORT uint64_t gHotSpotVMStructEntryIsStaticOffset = offset_of(VMStructEntry, isStatic);</span>
<span class="line-added">2964 JNIEXPORT uint64_t gHotSpotVMStructEntryOffsetOffset = offset_of(VMStructEntry, offset);</span>
<span class="line-added">2965 JNIEXPORT uint64_t gHotSpotVMStructEntryAddressOffset = offset_of(VMStructEntry, address);</span>
<span class="line-added">2966 JNIEXPORT uint64_t gHotSpotVMStructEntryArrayStride = STRIDE(gHotSpotVMStructs);</span>
<span class="line-added">2967 </span>
<span class="line-added">2968 JNIEXPORT VMTypeEntry* gHotSpotVMTypes = VMStructs::localHotSpotVMTypes;</span>
<span class="line-added">2969 JNIEXPORT uint64_t gHotSpotVMTypeEntryTypeNameOffset = offset_of(VMTypeEntry, typeName);</span>
<span class="line-added">2970 JNIEXPORT uint64_t gHotSpotVMTypeEntrySuperclassNameOffset = offset_of(VMTypeEntry, superclassName);</span>
<span class="line-added">2971 JNIEXPORT uint64_t gHotSpotVMTypeEntryIsOopTypeOffset = offset_of(VMTypeEntry, isOopType);</span>
<span class="line-added">2972 JNIEXPORT uint64_t gHotSpotVMTypeEntryIsIntegerTypeOffset = offset_of(VMTypeEntry, isIntegerType);</span>
<span class="line-added">2973 JNIEXPORT uint64_t gHotSpotVMTypeEntryIsUnsignedOffset = offset_of(VMTypeEntry, isUnsigned);</span>
<span class="line-added">2974 JNIEXPORT uint64_t gHotSpotVMTypeEntrySizeOffset = offset_of(VMTypeEntry, size);</span>
<span class="line-added">2975 JNIEXPORT uint64_t gHotSpotVMTypeEntryArrayStride = STRIDE(gHotSpotVMTypes);</span>
<span class="line-added">2976 </span>
<span class="line-added">2977 JNIEXPORT VMIntConstantEntry* gHotSpotVMIntConstants = VMStructs::localHotSpotVMIntConstants;</span>
<span class="line-added">2978 JNIEXPORT uint64_t gHotSpotVMIntConstantEntryNameOffset = offset_of(VMIntConstantEntry, name);</span>
<span class="line-added">2979 JNIEXPORT uint64_t gHotSpotVMIntConstantEntryValueOffset = offset_of(VMIntConstantEntry, value);</span>
<span class="line-added">2980 JNIEXPORT uint64_t gHotSpotVMIntConstantEntryArrayStride = STRIDE(gHotSpotVMIntConstants);</span>
<span class="line-added">2981 </span>
<span class="line-added">2982 JNIEXPORT VMLongConstantEntry* gHotSpotVMLongConstants = VMStructs::localHotSpotVMLongConstants;</span>
<span class="line-added">2983 JNIEXPORT uint64_t gHotSpotVMLongConstantEntryNameOffset = offset_of(VMLongConstantEntry, name);</span>
<span class="line-added">2984 JNIEXPORT uint64_t gHotSpotVMLongConstantEntryValueOffset = offset_of(VMLongConstantEntry, value);</span>
<span class="line-added">2985 JNIEXPORT uint64_t gHotSpotVMLongConstantEntryArrayStride = STRIDE(gHotSpotVMLongConstants);</span>
<span class="line-added">2986 } // &quot;C&quot;</span>
<span class="line-added">2987 </span>
<span class="line-added">2988 #ifdef ASSERT</span>
<span class="line-added">2989 // This is used both to check the types of referenced fields and</span>
<span class="line-added">2990 // to ensure that all of the field types are present.</span>
<span class="line-added">2991 void VMStructs::init() {</span>
2992   VM_STRUCTS(CHECK_NONSTATIC_VM_STRUCT_ENTRY,
2993              CHECK_STATIC_VM_STRUCT_ENTRY,
2994              CHECK_STATIC_PTR_VOLATILE_VM_STRUCT_ENTRY,
2995              CHECK_NO_OP,
2996              CHECK_VOLATILE_NONSTATIC_VM_STRUCT_ENTRY,
2997              CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY,
2998              CHECK_C1_NONSTATIC_VM_STRUCT_ENTRY,
2999              CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY,
3000              CHECK_NO_OP,
3001              CHECK_NO_OP);
3002 
3003 
3004   VM_STRUCTS_CPU(CHECK_NONSTATIC_VM_STRUCT_ENTRY,
3005                  CHECK_STATIC_VM_STRUCT_ENTRY,
3006                  CHECK_NO_OP,
3007                  CHECK_VOLATILE_NONSTATIC_VM_STRUCT_ENTRY,
3008                  CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY,
3009                  CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY,
3010                  CHECK_NO_OP,
3011                  CHECK_NO_OP);
</pre>
<hr />
<pre>
3047                   CHECK_C2_VM_TYPE_ENTRY,
3048                   CHECK_C2_TOPLEVEL_VM_TYPE_ENTRY);
3049 
3050   //
3051   // Split VM_STRUCTS() invocation into two parts to allow MS VC++ 6.0
3052   // to build with the source mounted over SNC3.2. Symptom was that
3053   // debug build failed with an internal compiler error. Has been seen
3054   // mounting sources from Solaris 2.6 and 2.7 hosts, but so far not
3055   // 2.8 hosts. Appears to occur because line is too long.
3056   //
3057   // If an assertion failure is triggered here it means that an entry
3058   // in VMStructs::localHotSpotVMStructs[] was not found in
3059   // VMStructs::localHotSpotVMTypes[]. (The assertion itself had to be
3060   // made less descriptive because of this above bug -- see the
3061   // definition of ENSURE_FIELD_TYPE_PRESENT.)
3062   //
3063   // NOTE: taken out because this was just not working on everyone&#39;s
3064   // Solstice NFS setup. If everyone switches to local workspaces on
3065   // Win32, we can put this back in.
3066 #ifndef _WINDOWS
<span class="line-modified">3067   VM_STRUCTS(ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-modified">3068              CHECK_NO_OP,</span>
<span class="line-modified">3069              CHECK_NO_OP,</span>
<span class="line-modified">3070              CHECK_NO_OP,</span>
<span class="line-modified">3071              CHECK_NO_OP,</span>
<span class="line-modified">3072              CHECK_NO_OP,</span>
<span class="line-modified">3073              CHECK_NO_OP,</span>
<span class="line-modified">3074              CHECK_NO_OP,</span>
<span class="line-modified">3075              CHECK_NO_OP,</span>
<span class="line-modified">3076              CHECK_NO_OP);</span>



















































3077 
<span class="line-modified">3078   VM_STRUCTS(CHECK_NO_OP,</span>
<span class="line-modified">3079              ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-modified">3080              ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-modified">3081              CHECK_NO_OP,</span>
<span class="line-added">3082              ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3083              ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3084              ENSURE_C1_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3085              ENSURE_C2_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3086              CHECK_NO_OP,</span>
<span class="line-added">3087              CHECK_NO_OP);</span>
3088 
<span class="line-modified">3089   VM_STRUCTS_CPU(ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-modified">3090                  ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-modified">3091                  CHECK_NO_OP,</span>
<span class="line-modified">3092                  ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3093                  ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3094                  ENSURE_C2_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3095                  CHECK_NO_OP,</span>
<span class="line-added">3096                  CHECK_NO_OP);</span>
<span class="line-added">3097   VM_STRUCTS_OS_CPU(ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3098                     ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3099                     CHECK_NO_OP,</span>
<span class="line-added">3100                     ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3101                     ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3102                     ENSURE_C2_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3103                     CHECK_NO_OP,</span>
<span class="line-added">3104                     CHECK_NO_OP);</span>
<span class="line-added">3105 #endif // !_WINDOWS</span>
3106 }
3107 

3108 static int recursiveFindType(VMTypeEntry* origtypes, const char* typeName, bool isRecurse) {
3109   {
3110     VMTypeEntry* types = origtypes;
3111     while (types-&gt;typeName != NULL) {
3112       if (strcmp(typeName, types-&gt;typeName) == 0) {
3113         // Found it
3114         return 1;
3115       }
3116       ++types;
3117     }
3118   }
3119   // Search for the base type by peeling off const and *
3120   size_t len = strlen(typeName);
3121   if (typeName[len-1] == &#39;*&#39;) {
3122     char * s = NEW_C_HEAP_ARRAY(char, len, mtInternal);
3123     strncpy(s, typeName, len - 1);
3124     s[len-1] = &#39;\0&#39;;
3125     // tty-&gt;print_cr(&quot;checking \&quot;%s\&quot; for \&quot;%s\&quot;&quot;, s, typeName);
3126     if (recursiveFindType(origtypes, s, true) == 1) {
3127       FREE_C_HEAP_ARRAY(char, s);
</pre>
<hr />
<pre>
3154     if (recursiveFindType(origtypes, s, true) == 1) {
3155       return 1;
3156     }
3157   }
3158   if (strstr(typeName, &quot; const&quot;) == typeName + len - 6) {
3159     char * s = os::strdup_check_oom(typeName);
3160     s[len - 6] = &#39;\0&#39;;
3161     // tty-&gt;print_cr(&quot;checking \&quot;%s\&quot; for \&quot;%s\&quot;&quot;, s, typeName);
3162     if (recursiveFindType(origtypes, s, true) == 1) {
3163       os::free(s);
3164       return 1;
3165     }
3166     os::free(s);
3167   }
3168   if (!isRecurse) {
3169     tty-&gt;print_cr(&quot;type \&quot;%s\&quot; not found&quot;, typeName);
3170   }
3171   return 0;
3172 }
3173 
<span class="line-modified">3174 int VMStructs::findType(const char* typeName) {</span>


3175   VMTypeEntry* types = gHotSpotVMTypes;
3176 
3177   return recursiveFindType(types, typeName, false);
3178 }

3179 
3180 void vmStructs_init() {
<span class="line-modified">3181   VMStructs::init();</span>
3182 }
<span class="line-added">3183 #endif // ASSERT</span>
</pre>
</td>
</tr>
</table>
<center><a href="vmOperations.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="vmStructs.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>