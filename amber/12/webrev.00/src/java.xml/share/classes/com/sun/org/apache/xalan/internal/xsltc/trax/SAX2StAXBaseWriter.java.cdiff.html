<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.xml/share/classes/com/sun/org/apache/xalan/internal/xsltc/trax/SAX2StAXBaseWriter.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../bcel/internal/classfile/ConstantLong.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="SAX2StAXEventWriter.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/xalan/internal/xsltc/trax/SAX2StAXBaseWriter.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,8 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2005, 2017, Oracle and/or its affiliates. All rights reserved.</span>
<span class="line-removed">-  * @LastModified: Oct 2017</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2005, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 34,215 ***</span>
  import org.xml.sax.Attributes;
  import org.xml.sax.Locator;
  import org.xml.sax.SAXException;
  import org.xml.sax.SAXParseException;
  import org.xml.sax.ext.LexicalHandler;
  import org.xml.sax.helpers.DefaultHandler;
  
<span class="line-removed">- </span>
  public abstract class SAX2StAXBaseWriter extends DefaultHandler
<span class="line-modified">!                 implements</span>
<span class="line-modified">!                         LexicalHandler {</span>
<span class="line-removed">- </span>
  
<span class="line-modified">!         protected boolean isCDATA;</span>
  
<span class="line-modified">!         protected StringBuffer CDATABuffer;</span>
  
<span class="line-modified">!         protected List&lt;String&gt; namespaces;</span>
  
<span class="line-modified">!         protected Locator docLocator;</span>
  
<span class="line-modified">!         protected XMLReporter reporter;</span>
  
<span class="line-modified">!         public SAX2StAXBaseWriter() {</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
<span class="line-removed">-         public SAX2StAXBaseWriter(XMLReporter reporter) {</span>
<span class="line-removed">-                 this.reporter = reporter;</span>
<span class="line-removed">-         }</span>
  
<span class="line-modified">!         public void setXMLReporter(XMLReporter reporter) {</span>
<span class="line-modified">!                 this.reporter = reporter;</span>
<span class="line-removed">-         }</span>
  
<span class="line-modified">!         public void setDocumentLocator(Locator locator) {</span>
<span class="line-modified">!                 this.docLocator = locator;</span>
<span class="line-modified">!         }</span>
  
  
<span class="line-modified">!         public Location getCurrentLocation() {</span>
<span class="line-modified">!                 if (docLocator != null) {</span>
<span class="line-modified">!                         return new SAXLocation(docLocator);</span>
<span class="line-removed">-                 } else {</span>
<span class="line-removed">-                         return null;</span>
<span class="line-removed">-                 }</span>
  
          }
  
<span class="line-modified">!         public void error(SAXParseException e) throws SAXException {</span>
<span class="line-modified">!                 reportException(&quot;ERROR&quot;, e);</span>
<span class="line-modified">!         }</span>
  
<span class="line-modified">!         public void fatalError(SAXParseException e) throws SAXException {</span>
<span class="line-modified">!                 reportException(&quot;FATAL&quot;, e);</span>
<span class="line-modified">!         }</span>
  
<span class="line-modified">!         public void warning(SAXParseException e) throws SAXException {</span>
<span class="line-modified">!                 reportException(&quot;WARNING&quot;, e);</span>
<span class="line-modified">!         }</span>
  
<span class="line-modified">!         public void startDocument() throws SAXException {</span>
<span class="line-modified">!                     namespaces = new ArrayList&lt;&gt;(2);</span>
          }
  
<span class="line-modified">!         public void endDocument() throws SAXException {</span>
<span class="line-modified">!                 namespaces = null;</span>
<span class="line-modified">!         }</span>
  
<span class="line-modified">!         public void startElement(String uri, String localName, String qName,</span>
<span class="line-modified">!                         Attributes attributes) throws SAXException {</span>
<span class="line-modified">!                         namespaces = null;</span>
<span class="line-removed">-         }</span>
  
<span class="line-modified">!         public void endElement(String uri, String localName, String qName)</span>
<span class="line-modified">!                         throws SAXException {</span>
<span class="line-modified">!                 namespaces = null;</span>
<span class="line-removed">-         }</span>
  
<span class="line-modified">!         public void startPrefixMapping(String prefix, String uri)</span>
<span class="line-modified">!                         throws SAXException {</span>
  
<span class="line-modified">!                 if (prefix == null) {</span>
<span class="line-modified">!                         prefix = &quot;&quot;;</span>
<span class="line-modified">!                 } else if (prefix.equals(&quot;xml&quot;)) {</span>
<span class="line-removed">-                         return;</span>
<span class="line-removed">-                 }</span>
  
<span class="line-modified">!                 if (namespaces == null) {</span>
<span class="line-modified">!                     namespaces = new ArrayList&lt;&gt;(2);</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 namespaces.add(prefix);</span>
<span class="line-removed">-                 namespaces.add(uri);</span>
<span class="line-removed">-         }</span>
  
  
<span class="line-modified">!         public void endPrefixMapping(String prefix) throws SAXException {</span>
<span class="line-modified">!         }</span>
  
<span class="line-modified">!         public void startCDATA() throws SAXException {</span>
<span class="line-modified">!                 isCDATA = true;</span>
<span class="line-modified">!                 if (CDATABuffer == null) {</span>
<span class="line-modified">!                         CDATABuffer = new StringBuffer();</span>
<span class="line-removed">-                 } else {</span>
<span class="line-removed">-                         CDATABuffer.setLength(0);</span>
<span class="line-removed">-                 }</span>
          }
  
<span class="line-modified">!         public void characters(char[] ch, int start, int length)</span>
<span class="line-modified">!                         throws SAXException {</span>
<span class="line-removed">-                 if (isCDATA) {</span>
<span class="line-removed">-                         CDATABuffer.append(ch, start, length);</span>
<span class="line-removed">-                 }</span>
          }
<span class="line-modified">! </span>
<span class="line-modified">!         public void endCDATA() throws SAXException {</span>
<span class="line-modified">!                 isCDATA = false;</span>
<span class="line-modified">!                 CDATABuffer.setLength(0);</span>
          }
  
<span class="line-modified">!         public void comment(char[] ch, int start, int length) throws SAXException {</span>
          }
<span class="line-modified">! </span>
<span class="line-modified">!         public void endDTD() throws SAXException {</span>
          }
<span class="line-modified">! </span>
<span class="line-modified">!         public void endEntity(String name) throws SAXException {</span>
          }
  
<span class="line-modified">!         public void startDTD(String name, String publicId, String systemId)</span>
<span class="line-modified">!                         throws SAXException {</span>
          }
  
<span class="line-modified">!         public void startEntity(String name) throws SAXException {</span>
          }
  
<span class="line-modified">!         /**</span>
<span class="line-modified">!          * Used to report a {@link SAXException}to the {@link XMLReporter}</span>
<span class="line-removed">-          * registered with this handler.</span>
<span class="line-removed">-          */</span>
<span class="line-removed">-         protected void reportException(String type, SAXException e)</span>
<span class="line-removed">-                         throws SAXException {</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 if (reporter != null) {</span>
<span class="line-removed">-                         try {</span>
<span class="line-removed">-                                 reporter.report(e.getMessage(), type, e, getCurrentLocation());</span>
<span class="line-removed">-                         } catch (XMLStreamException e1) {</span>
<span class="line-removed">-                                 throw new SAXException(e1);</span>
<span class="line-removed">-                         }</span>
<span class="line-removed">-                 }</span>
          }
  
<span class="line-modified">!         /**</span>
<span class="line-modified">!          * Parses an XML qualified name, and places the resulting prefix and local</span>
<span class="line-removed">-          * name in the provided String array.</span>
<span class="line-removed">-          *</span>
<span class="line-removed">-          * @param qName The qualified name to parse.</span>
<span class="line-removed">-          * @param results An array where parse results will be placed. The prefix</span>
<span class="line-removed">-          *            will be placed at &lt;code&gt;results[0]&lt;/code&gt;, and the local</span>
<span class="line-removed">-          *            part at &lt;code&gt;results[1]&lt;/code&gt;</span>
<span class="line-removed">-          */</span>
<span class="line-removed">-         public static final void parseQName(String qName, String[] results) {</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 String prefix, local;</span>
<span class="line-removed">-                 int idx = qName.indexOf(&#39;:&#39;);</span>
<span class="line-removed">-                 if (idx &gt;= 0) {</span>
<span class="line-removed">-                         prefix = qName.substring(0, idx);</span>
<span class="line-removed">-                         local = qName.substring(idx + 1);</span>
<span class="line-removed">-                 } else {</span>
<span class="line-removed">-                         prefix = &quot;&quot;;</span>
<span class="line-removed">-                         local = qName;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-                 results[0] = prefix;</span>
<span class="line-removed">-                 results[1] = local;</span>
          }
  
<span class="line-modified">!         /**</span>
<span class="line-modified">!          * {@Link Location}implementation used to expose details from a SAX</span>
<span class="line-removed">-          * {@link Locator}.</span>
<span class="line-removed">-          *</span>
<span class="line-removed">-          * @author christian</span>
<span class="line-removed">-          */</span>
<span class="line-removed">-         private static final class SAXLocation implements Location {</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 private int lineNumber;</span>
<span class="line-removed">-                 private int columnNumber;</span>
<span class="line-removed">-                 private String publicId;</span>
<span class="line-removed">-                 private String systemId;</span>
<span class="line-removed">-                 private SAXLocation(Locator locator) {</span>
<span class="line-removed">-                         lineNumber = locator.getLineNumber();</span>
<span class="line-removed">-                         columnNumber = locator.getColumnNumber();</span>
<span class="line-removed">-                         publicId = locator.getPublicId();</span>
<span class="line-removed">-                         systemId = locator.getSystemId();</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 public int getLineNumber() {</span>
<span class="line-removed">-                         return lineNumber;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 public int getColumnNumber() {</span>
<span class="line-removed">-                         return columnNumber;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 public int getCharacterOffset() {</span>
<span class="line-removed">-                         return -1;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 public String getPublicId() {</span>
<span class="line-removed">-                         return publicId;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 public String getSystemId() {</span>
<span class="line-removed">-                         return systemId;</span>
<span class="line-removed">-                 }</span>
          }
  }
<span class="line-new-header">--- 33,233 ---</span>
  import org.xml.sax.Attributes;
  import org.xml.sax.Locator;
  import org.xml.sax.SAXException;
  import org.xml.sax.SAXParseException;
  import org.xml.sax.ext.LexicalHandler;
<span class="line-added">+ import org.xml.sax.ext.Locator2;</span>
  import org.xml.sax.helpers.DefaultHandler;
  
  public abstract class SAX2StAXBaseWriter extends DefaultHandler
<span class="line-modified">!         implements</span>
<span class="line-modified">!         LexicalHandler {</span>
  
<span class="line-modified">!     protected boolean isCDATA;</span>
  
<span class="line-modified">!     protected StringBuffer CDATABuffer;</span>
  
<span class="line-modified">!     protected List&lt;String&gt; namespaces;</span>
  
<span class="line-modified">!     protected Locator docLocator;</span>
  
<span class="line-modified">!     protected XMLReporter reporter;</span>
  
<span class="line-modified">!     String xmlVersion = null, encoding = null;</span>
  
<span class="line-modified">!     public SAX2StAXBaseWriter() {</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     public SAX2StAXBaseWriter(XMLReporter reporter) {</span>
<span class="line-modified">!         this.reporter = reporter;</span>
<span class="line-modified">!     }</span>
  
<span class="line-added">+     public void setXMLReporter(XMLReporter reporter) {</span>
<span class="line-added">+         this.reporter = reporter;</span>
<span class="line-added">+     }</span>
  
<span class="line-modified">!     public void setDocumentLocator(Locator locator) {</span>
<span class="line-modified">!         this.docLocator = locator;</span>
<span class="line-modified">!     }</span>
  
<span class="line-added">+     private void updateVersionAndEncoding() {</span>
<span class="line-added">+         if (docLocator instanceof Locator2) {</span>
<span class="line-added">+             Locator2 l2 = (Locator2) docLocator;</span>
<span class="line-added">+             xmlVersion = l2.getXMLVersion();</span>
<span class="line-added">+             encoding = l2.getEncoding();</span>
          }
<span class="line-added">+     }</span>
  
<span class="line-modified">!     public void setXmlVersion(String version) {</span>
<span class="line-modified">!         this.xmlVersion = version;</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     public void setEncoding(String encoding) {</span>
<span class="line-modified">!         this.encoding = encoding;</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     void writeStartDocument() throws SAXException {</span>
<span class="line-modified">!         updateVersionAndEncoding();</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     public Location getCurrentLocation() {</span>
<span class="line-modified">!         if (docLocator != null) {</span>
<span class="line-added">+             return new SAXLocation(docLocator);</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             return null;</span>
          }
<span class="line-added">+     }</span>
  
<span class="line-modified">!     public void error(SAXParseException e) throws SAXException {</span>
<span class="line-modified">!         reportException(&quot;ERROR&quot;, e);</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     public void fatalError(SAXParseException e) throws SAXException {</span>
<span class="line-modified">!         reportException(&quot;FATAL&quot;, e);</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     public void warning(SAXParseException e) throws SAXException {</span>
<span class="line-modified">!         reportException(&quot;WARNING&quot;, e);</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     public void startDocument() throws SAXException {</span>
<span class="line-modified">!         namespaces = new ArrayList&lt;&gt;(2);</span>
<span class="line-added">+     }</span>
  
<span class="line-modified">!     public void endDocument() throws SAXException {</span>
<span class="line-modified">!         namespaces = null;</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     public void startElement(String uri, String localName, String qName,</span>
<span class="line-modified">!             Attributes attributes) throws SAXException {</span>
<span class="line-modified">!         namespaces = null;</span>
<span class="line-modified">!     }</span>
  
<span class="line-added">+     public void endElement(String uri, String localName, String qName)</span>
<span class="line-added">+             throws SAXException {</span>
<span class="line-added">+         namespaces = null;</span>
<span class="line-added">+     }</span>
  
<span class="line-modified">!     public void startPrefixMapping(String prefix, String uri)</span>
<span class="line-modified">!             throws SAXException {</span>
  
<span class="line-modified">!         if (prefix == null) {</span>
<span class="line-modified">!             prefix = &quot;&quot;;</span>
<span class="line-modified">!         } else if (prefix.equals(&quot;xml&quot;)) {</span>
<span class="line-modified">!             return;</span>
          }
  
<span class="line-modified">!         if (namespaces == null) {</span>
<span class="line-modified">!             namespaces = new ArrayList&lt;&gt;(2);</span>
          }
<span class="line-modified">!         namespaces.add(prefix);</span>
<span class="line-modified">!         namespaces.add(uri);</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-added">+     public void endPrefixMapping(String prefix) throws SAXException {</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     public void startCDATA() throws SAXException {</span>
<span class="line-added">+         isCDATA = true;</span>
<span class="line-added">+         if (CDATABuffer == null) {</span>
<span class="line-added">+             CDATABuffer = new StringBuffer();</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             CDATABuffer.setLength(0);</span>
          }
<span class="line-added">+     }</span>
  
<span class="line-modified">!     public void characters(char[] ch, int start, int length)</span>
<span class="line-added">+             throws SAXException {</span>
<span class="line-added">+         if (isCDATA) {</span>
<span class="line-added">+             CDATABuffer.append(ch, start, length);</span>
          }
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-added">+     public void endCDATA() throws SAXException {</span>
<span class="line-added">+         isCDATA = false;</span>
<span class="line-added">+         CDATABuffer.setLength(0);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     public void comment(char[] ch, int start, int length) throws SAXException {</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     public void endDTD() throws SAXException {</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     public void endEntity(String name) throws SAXException {</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     public void startDTD(String name, String publicId, String systemId)</span>
<span class="line-added">+             throws SAXException {</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     public void startEntity(String name) throws SAXException {</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * Used to report a {@link SAXException}to the {@link XMLReporter}</span>
<span class="line-added">+      * registered with this handler.</span>
<span class="line-added">+      */</span>
<span class="line-added">+     protected void reportException(String type, SAXException e)</span>
<span class="line-added">+             throws SAXException {</span>
<span class="line-added">+ </span>
<span class="line-added">+         if (reporter != null) {</span>
<span class="line-added">+             try {</span>
<span class="line-added">+                 reporter.report(e.getMessage(), type, e, getCurrentLocation());</span>
<span class="line-added">+             } catch (XMLStreamException e1) {</span>
<span class="line-added">+                 throw new SAXException(e1);</span>
<span class="line-added">+             }</span>
          }
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * Parses an XML qualified name, and places the resulting prefix and local</span>
<span class="line-added">+      * name in the provided String array.</span>
<span class="line-added">+      *</span>
<span class="line-added">+      * @param qName The qualified name to parse.</span>
<span class="line-added">+      * @param results An array where parse results will be placed. The prefix</span>
<span class="line-added">+      *            will be placed at &lt;code&gt;results[0]&lt;/code&gt;, and the local</span>
<span class="line-added">+      *            part at &lt;code&gt;results[1]&lt;/code&gt;</span>
<span class="line-added">+      */</span>
<span class="line-added">+     public static final void parseQName(String qName, String[] results) {</span>
<span class="line-added">+ </span>
<span class="line-added">+         String prefix, local;</span>
<span class="line-added">+         int idx = qName.indexOf(&#39;:&#39;);</span>
<span class="line-added">+         if (idx &gt;= 0) {</span>
<span class="line-added">+             prefix = qName.substring(0, idx);</span>
<span class="line-added">+             local = qName.substring(idx + 1);</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             prefix = &quot;&quot;;</span>
<span class="line-added">+             local = qName;</span>
<span class="line-added">+         }</span>
<span class="line-added">+         results[0] = prefix;</span>
<span class="line-added">+         results[1] = local;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * {@Link Location}implementation used to expose details from a SAX</span>
<span class="line-added">+      * {@link Locator}.</span>
<span class="line-added">+      *</span>
<span class="line-added">+      * @author christian</span>
<span class="line-added">+      */</span>
<span class="line-added">+     private static final class SAXLocation implements Location {</span>
<span class="line-added">+ </span>
<span class="line-added">+         private int lineNumber;</span>
<span class="line-added">+         private int columnNumber;</span>
<span class="line-added">+         private String publicId;</span>
<span class="line-added">+         private String systemId;</span>
<span class="line-added">+         private SAXLocation(Locator locator) {</span>
<span class="line-added">+             lineNumber = locator.getLineNumber();</span>
<span class="line-added">+             columnNumber = locator.getColumnNumber();</span>
<span class="line-added">+             publicId = locator.getPublicId();</span>
<span class="line-added">+             systemId = locator.getSystemId();</span>
          }
  
<span class="line-modified">!         public int getLineNumber() {</span>
<span class="line-modified">!             return lineNumber;</span>
          }
  
<span class="line-modified">!         public int getColumnNumber() {</span>
<span class="line-added">+             return columnNumber;</span>
          }
  
<span class="line-modified">!         public int getCharacterOffset() {</span>
<span class="line-modified">!             return -1;</span>
          }
  
<span class="line-modified">!         public String getPublicId() {</span>
<span class="line-modified">!             return publicId;</span>
          }
  
<span class="line-modified">!         public String getSystemId() {</span>
<span class="line-modified">!             return systemId;</span>
          }
<span class="line-added">+     }</span>
  }
</pre>
<center><a href="../../../../bcel/internal/classfile/ConstantLong.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="SAX2StAXEventWriter.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>