<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.compiler/share/classes/com/sun/tools/javac/parser/JavaTokenizer.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../main/JavaCompiler.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="JavacParser.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.compiler/share/classes/com/sun/tools/javac/parser/JavaTokenizer.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 231,12 ***</span>
                  case &#39;\n&#39;:
                  case &#39;\r&#39;:
                      if (!multiline) {
                          lexError(reader.bp, Errors.IllegalEscChar);
                      } else {
<span class="line-removed">-                         int start = reader.bp;</span>
                          checkSourceLevel(reader.bp, Feature.TEXT_BLOCKS);
                          if (reader.ch == &#39;\r&#39; &amp;&amp; reader.peekChar() == &#39;\n&#39;) {
                             reader.nextChar(translateEscapesNow);
                          }
                          reader.nextChar(translateEscapesNow);
                          processLineTerminator(start, reader.bp);
<span class="line-new-header">--- 231,12 ---</span>
                  case &#39;\n&#39;:
                  case &#39;\r&#39;:
                      if (!multiline) {
                          lexError(reader.bp, Errors.IllegalEscChar);
                      } else {
                          checkSourceLevel(reader.bp, Feature.TEXT_BLOCKS);
<span class="line-added">+                         int start = reader.bp;</span>
                          if (reader.ch == &#39;\r&#39; &amp;&amp; reader.peekChar() == &#39;\n&#39;) {
                             reader.nextChar(translateEscapesNow);
                          }
                          reader.nextChar(translateEscapesNow);
                          processLineTerminator(start, reader.bp);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 400,10 ***</span>
<span class="line-new-header">--- 400,21 ---</span>
              reader.scanChar();
          }
          return count;
      }
  
<span class="line-added">+     /** Skip and process a line terminator.</span>
<span class="line-added">+      */</span>
<span class="line-added">+     private void skipLineTerminator() {</span>
<span class="line-added">+         int start = reader.bp;</span>
<span class="line-added">+         if (isCRLF()) {</span>
<span class="line-added">+             reader.scanChar();</span>
<span class="line-added">+         }</span>
<span class="line-added">+         reader.scanChar();</span>
<span class="line-added">+         processLineTerminator(start, reader.bp);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      /** Scan a string literal or text block.
       */
      private void scanString(int pos) {
          // Clear flags.
          isTextBlock = false;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 423,30 ***</span>
          case 3: // Starting a text block.
              // Check if preview feature is enabled for text blocks.
              checkSourceLevel(pos, Feature.TEXT_BLOCKS);
              isTextBlock = true;
              // Verify the open delimiter sequence.
<span class="line-modified">!             boolean hasOpenEOLN = false;</span>
<span class="line-modified">!             while (reader.bp &lt; reader.buflen &amp;&amp; Character.isWhitespace(reader.ch)) {</span>
<span class="line-modified">!                 hasOpenEOLN = isEOLN();</span>
<span class="line-removed">-                 if (hasOpenEOLN) {</span>
                      break;
                  }
                  reader.scanChar();
              }
<span class="line-modified">!             // Error if the open delimiter sequence not is &quot;&quot;&quot;&lt;Whitespace&gt;*&lt;LineTerminator&gt;.</span>
<span class="line-modified">!             if (!hasOpenEOLN) {</span>
                  lexError(reader.bp, Errors.IllegalTextBlockOpen);
                  return;
              }
<span class="line-removed">-             // Skip line terminator.</span>
<span class="line-removed">-             int start = reader.bp;</span>
<span class="line-removed">-             if (isCRLF()) {</span>
<span class="line-removed">-                 reader.scanChar();</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             reader.scanChar();</span>
<span class="line-removed">-             processLineTerminator(start, reader.bp);</span>
              break;
          }
          // While characters are available.
          while (reader.bp &lt; reader.buflen) {
              // If possible close delimiter sequence.
<span class="line-new-header">--- 434,25 ---</span>
          case 3: // Starting a text block.
              // Check if preview feature is enabled for text blocks.
              checkSourceLevel(pos, Feature.TEXT_BLOCKS);
              isTextBlock = true;
              // Verify the open delimiter sequence.
<span class="line-modified">!             while (reader.bp &lt; reader.buflen) {</span>
<span class="line-modified">!                 char ch = reader.ch;</span>
<span class="line-modified">!                 if (ch != &#39; &#39; &amp;&amp; ch != &#39;\t&#39; &amp;&amp; ch != FF) {</span>
                      break;
                  }
                  reader.scanChar();
              }
<span class="line-modified">!             if (isEOLN()) {</span>
<span class="line-modified">!                 skipLineTerminator();</span>
<span class="line-added">+             } else {</span>
<span class="line-added">+                 // Error if the open delimiter sequence is not</span>
<span class="line-added">+                 //     &quot;&quot;&quot;&lt;white space&gt;*&lt;LineTerminator&gt;.</span>
                  lexError(reader.bp, Errors.IllegalTextBlockOpen);
                  return;
              }
              break;
          }
          // While characters are available.
          while (reader.bp &lt; reader.buflen) {
              // If possible close delimiter sequence.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 464,17 ***</span>
                  // Line terminator in string literal is an error.
                  // Fall out to unclosed string literal error.
                  if (openCount == 1) {
                      break;
                  }
<span class="line-modified">!                  // Add line terminator to string buffer.</span>
<span class="line-modified">!                 int start = reader.bp;</span>
<span class="line-modified">!                 if (isCRLF()) {</span>
<span class="line-removed">-                     reader.scanChar();</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-                 reader.putChar(&#39;\n&#39;, true);</span>
<span class="line-removed">-                 processLineTerminator(start, reader.bp);</span>
                  // Record first line terminator for error recovery.
                  if (firstEOLN == -1) {
                      firstEOLN = reader.bp;
                  }
              } else if (reader.ch == &#39;\\&#39;) {
<span class="line-new-header">--- 470,13 ---</span>
                  // Line terminator in string literal is an error.
                  // Fall out to unclosed string literal error.
                  if (openCount == 1) {
                      break;
                  }
<span class="line-modified">!                 skipLineTerminator();</span>
<span class="line-modified">!                 // Add line terminator to string buffer.</span>
<span class="line-modified">!                 reader.putChar(&#39;\n&#39;, false);</span>
                  // Record first line terminator for error recovery.
                  if (firstEOLN == -1) {
                      firstEOLN = reader.bp;
                  }
              } else if (reader.ch == &#39;\\&#39;) {
</pre>
<center><a href="../main/JavaCompiler.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="JavacParser.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>