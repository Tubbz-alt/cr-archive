<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/util/Utils.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="TypeElementCatalog.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="VisibleMemberTable.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/util/Utils.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -35,11 +35,10 @@</span>
  import java.util.ArrayDeque;
  import java.util.ArrayList;
  import java.util.Arrays;
  import java.util.Collection;
  import java.util.Collections;
<span class="udiff-line-removed">- import java.util.Comparator;</span>
  import java.util.Deque;
  import java.util.EnumSet;
  import java.util.HashMap;
  import java.util.HashSet;
  import java.util.Iterator;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -93,24 +92,24 @@</span>
  import javax.tools.StandardLocation;
  
  import com.sun.source.doctree.DocCommentTree;
  import com.sun.source.doctree.DocTree;
  import com.sun.source.doctree.DocTree.Kind;
<span class="udiff-line-added">+ import com.sun.source.doctree.EndElementTree;</span>
  import com.sun.source.doctree.ParamTree;
<span class="udiff-line-modified-removed">- import com.sun.source.doctree.SerialFieldTree;</span>
<span class="udiff-line-modified-added">+ import com.sun.source.doctree.StartElementTree;</span>
<span class="udiff-line-added">+ import com.sun.source.doctree.TextTree;</span>
  import com.sun.source.doctree.UnknownBlockTagTree;
  import com.sun.source.tree.CompilationUnitTree;
  import com.sun.source.tree.LineMap;
  import com.sun.source.util.DocSourcePositions;
  import com.sun.source.util.DocTrees;
  import com.sun.source.util.TreePath;
  import com.sun.tools.javac.model.JavacTypes;
<span class="udiff-line-removed">- import jdk.javadoc.internal.doclets.formats.html.SearchIndexItem;</span>
  import jdk.javadoc.internal.doclets.toolkit.BaseConfiguration;
  import jdk.javadoc.internal.doclets.toolkit.BaseOptions;
  import jdk.javadoc.internal.doclets.toolkit.CommentUtils.DocCommentDuo;
<span class="udiff-line-removed">- import jdk.javadoc.internal.doclets.toolkit.Messages;</span>
  import jdk.javadoc.internal.doclets.toolkit.Resources;
  import jdk.javadoc.internal.doclets.toolkit.WorkArounds;
  import jdk.javadoc.internal.doclets.toolkit.taglets.BaseTaglet;
  import jdk.javadoc.internal.doclets.toolkit.taglets.Taglet;
  import jdk.javadoc.internal.tool.DocEnvImpl;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -131,26 +130,26 @@</span>
   *  deletion without notice.&lt;/b&gt;
   */
  public class Utils {
      public final BaseConfiguration configuration;
      private final BaseOptions options;
<span class="udiff-line-removed">-     private final Messages messages;</span>
      private final Resources resources;
      public final DocTrees docTrees;
      public final Elements elementUtils;
      public final Types typeUtils;
<span class="udiff-line-added">+     public final Comparators comparators;</span>
      private final JavaScriptScanner javaScriptScanner;
  
      public Utils(BaseConfiguration c) {
          configuration = c;
          options = configuration.getOptions();
<span class="udiff-line-removed">-         messages = configuration.getMessages();</span>
          resources = configuration.getDocResources();
          elementUtils = c.docEnv.getElementUtils();
          typeUtils = c.docEnv.getTypeUtils();
          docTrees = c.docEnv.getDocTrees();
          javaScriptScanner = c.isAllowScriptInComments() ? null : new JavaScriptScanner();
<span class="udiff-line-added">+         comparators = new Comparators(this);</span>
      }
  
      // our own little symbol table
      private HashMap&lt;String, TypeMirror&gt; symtab = new HashMap&lt;&gt;();
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -214,11 +213,11 @@</span>
       *                    documentation is getting generated.
       */
      public List&lt;Element&gt; excludeDeprecatedMembers(List&lt;? extends Element&gt; members) {
          return members.stream()
                        .filter(member -&gt; !isDeprecated(member))
<span class="udiff-line-modified-removed">-                       .sorted(makeGeneralPurposeComparator())</span>
<span class="udiff-line-modified-added">+                       .sorted(comparators.makeGeneralPurposeComparator())</span>
                        .collect(Collectors.toCollection(ArrayList::new));
      }
  
      /**
       * Search for the given method in the given class.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -659,43 +658,48 @@</span>
                  return false;
          }
      }
  
      /**
<span class="udiff-line-modified-removed">-      * Get the signature. It is the parameter list, type is qualified.</span>
<span class="udiff-line-modified-added">+      * Get the signature of an executable element with qualified parameter types</span>
<span class="udiff-line-added">+      * in the context of type element {@code site}.</span>
       * For instance, for a method {@code mymethod(String x, int y)},
       * it will return {@code (java.lang.String,int)}.
       *
<span class="udiff-line-modified-removed">-      * @param e</span>
<span class="udiff-line-modified-removed">-      * @return String</span>
<span class="udiff-line-modified-added">+      * @param e the executable element</span>
<span class="udiff-line-modified-added">+      * @param site the contextual site</span>
<span class="udiff-line-added">+      * @return String signature with qualified parameter types</span>
       */
<span class="udiff-line-modified-removed">-     public String signature(ExecutableElement e) {</span>
<span class="udiff-line-modified-removed">-         return makeSignature(e, true);</span>
<span class="udiff-line-modified-added">+     public String signature(ExecutableElement e, TypeElement site) {</span>
<span class="udiff-line-modified-added">+         return makeSignature(e, site, true);</span>
      }
  
      /**
<span class="udiff-line-modified-removed">-      * Get flat signature.  All types are not qualified.</span>
<span class="udiff-line-modified-removed">-      * Return a String, which is the flat signature of this member.</span>
<span class="udiff-line-removed">-      * It is the parameter list, type is not qualified.</span>
<span class="udiff-line-modified-added">+      * Get the flat signature of an executable element with simple (unqualified)</span>
<span class="udiff-line-modified-added">+      * parameter types in the context of type element {@code site}.</span>
       * For instance, for a method {@code mymethod(String x, int y)},
       * it will return {@code (String, int)}.
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * @param e the executable element</span>
<span class="udiff-line-added">+      * @param site the contextual site</span>
<span class="udiff-line-added">+      * @return String signature with simple (unqualified) parameter types</span>
       */
<span class="udiff-line-modified-removed">-     public String flatSignature(ExecutableElement e) {</span>
<span class="udiff-line-modified-removed">-         return makeSignature(e, false);</span>
<span class="udiff-line-modified-added">+     public String flatSignature(ExecutableElement e, TypeElement site) {</span>
<span class="udiff-line-modified-added">+         return makeSignature(e, site, false);</span>
      }
  
<span class="udiff-line-modified-removed">-     public String makeSignature(ExecutableElement e, boolean full) {</span>
<span class="udiff-line-modified-removed">-         return makeSignature(e, full, false);</span>
<span class="udiff-line-modified-added">+     public String makeSignature(ExecutableElement e, TypeElement site, boolean full) {</span>
<span class="udiff-line-modified-added">+         return makeSignature(e, site, full, false);</span>
      }
  
<span class="udiff-line-modified-removed">-     public String makeSignature(ExecutableElement e, boolean full, boolean ignoreTypeParameters) {</span>
<span class="udiff-line-modified-added">+     public String makeSignature(ExecutableElement e, TypeElement site, boolean full, boolean ignoreTypeParameters) {</span>
          StringBuilder result = new StringBuilder();
          result.append(&quot;(&quot;);
<span class="udiff-line-modified-removed">-         Iterator&lt;? extends VariableElement&gt; iterator = e.getParameters().iterator();</span>
<span class="udiff-line-modified-added">+         ExecutableType executableType = asInstantiatedMethodType(site, e);</span>
<span class="udiff-line-added">+         Iterator&lt;? extends TypeMirror&gt; iterator = executableType.getParameterTypes().iterator();</span>
          while (iterator.hasNext()) {
<span class="udiff-line-modified-removed">-             VariableElement next = iterator.next();</span>
<span class="udiff-line-removed">-             TypeMirror type = next.asType();</span>
<span class="udiff-line-modified-added">+             TypeMirror type = iterator.next();</span>
              result.append(getTypeSignature(type, full, ignoreTypeParameters));
              if (iterator.hasNext()) {
                  result.append(&quot;, &quot;);
              }
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -924,11 +928,11 @@</span>
          }
          return null;
      }
  
      public SortedSet&lt;TypeElement&gt; getTypeElementsAsSortedSet(Iterable&lt;TypeElement&gt; typeElements) {
<span class="udiff-line-modified-removed">-         SortedSet&lt;TypeElement&gt; set = new TreeSet&lt;&gt;(makeGeneralPurposeComparator());</span>
<span class="udiff-line-modified-added">+         SortedSet&lt;TypeElement&gt; set = new TreeSet&lt;&gt;(comparators.makeGeneralPurposeComparator());</span>
          typeElements.forEach(set::add);
          return set;
      }
  
      public List&lt;? extends DocTree&gt; getSerialDataTrees(ExecutableElement member) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1572,11 +1576,11 @@</span>
       * @return list of filtered classes.
       */
      public SortedSet&lt;TypeElement&gt; filterOutPrivateClasses(Iterable&lt;TypeElement&gt; classlist,
              boolean javafx) {
          SortedSet&lt;TypeElement&gt; filteredOutClasses =
<span class="udiff-line-modified-removed">-                 new TreeSet&lt;&gt;(makeGeneralPurposeComparator());</span>
<span class="udiff-line-modified-added">+                 new TreeSet&lt;&gt;(comparators.makeGeneralPurposeComparator());</span>
          if (!javafx) {
              for (Element te : classlist) {
                  if (!hasHiddenTag(te)) {
                      filteredOutClasses.add((TypeElement)te);
                  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1639,11 +1643,11 @@</span>
      }
  
      private DocCollator tertiaryCollator = null;
      private DocCollator secondaryCollator = null;
  
<span class="udiff-line-modified-removed">-     private int compareStrings(boolean caseSensitive, String s1, String s2) {</span>
<span class="udiff-line-modified-added">+     int compareStrings(boolean caseSensitive, String s1, String s2) {</span>
          if (caseSensitive) {
              if (tertiaryCollator == null) {
                  tertiaryCollator = new DocCollator(configuration.locale, Collator.TERTIARY);
              }
              return tertiaryCollator.compare(s1, s2);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1652,10 +1656,44 @@</span>
              secondaryCollator = new DocCollator(configuration.locale, Collator.SECONDARY);
          }
          return secondaryCollator.compare(s1, s2);
      }
  
<span class="udiff-line-added">+     public String getHTMLTitle(Element element) {</span>
<span class="udiff-line-added">+         List&lt;? extends DocTree&gt; preamble = getPreamble(element);</span>
<span class="udiff-line-added">+         StringBuilder sb = new StringBuilder();</span>
<span class="udiff-line-added">+         boolean titleFound = false;</span>
<span class="udiff-line-added">+         loop:</span>
<span class="udiff-line-added">+         for (DocTree dt : preamble) {</span>
<span class="udiff-line-added">+             switch (dt.getKind()) {</span>
<span class="udiff-line-added">+                 case START_ELEMENT:</span>
<span class="udiff-line-added">+                     StartElementTree nodeStart = (StartElementTree)dt;</span>
<span class="udiff-line-added">+                     if (Utils.toLowerCase(nodeStart.getName().toString()).equals(&quot;title&quot;)) {</span>
<span class="udiff-line-added">+                         titleFound = true;</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                     break;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                 case END_ELEMENT:</span>
<span class="udiff-line-added">+                     EndElementTree nodeEnd = (EndElementTree)dt;</span>
<span class="udiff-line-added">+                     if (Utils.toLowerCase(nodeEnd.getName().toString()).equals(&quot;title&quot;)) {</span>
<span class="udiff-line-added">+                         break loop;</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                     break;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                 case TEXT:</span>
<span class="udiff-line-added">+                     TextTree nodeText = (TextTree)dt;</span>
<span class="udiff-line-added">+                     if (titleFound)</span>
<span class="udiff-line-added">+                         sb.append(nodeText.getBody());</span>
<span class="udiff-line-added">+                     break;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                 default:</span>
<span class="udiff-line-added">+                     // do nothing</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         return sb.toString().trim();</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      private static class DocCollator {
          private final Map&lt;String, CollationKey&gt; keys;
          private final Collator instance;
          private final int MAX_SIZE = 1000;
          private DocCollator(Locale locale, int strength) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1693,249 +1731,10 @@</span>
              }
              return baseCollator;
          }
      }
  
<span class="udiff-line-removed">-     private Comparator&lt;Element&gt; moduleComparator = null;</span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Comparator for ModuleElements, simply compares the fully qualified names</span>
<span class="udiff-line-removed">-      * @return a Comparator</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     public Comparator&lt;Element&gt; makeModuleComparator() {</span>
<span class="udiff-line-removed">-         if (moduleComparator == null) {</span>
<span class="udiff-line-removed">-             moduleComparator = new Utils.ElementComparator() {</span>
<span class="udiff-line-removed">-                 @Override</span>
<span class="udiff-line-removed">-                 public int compare(Element mod1, Element mod2) {</span>
<span class="udiff-line-removed">-                     return compareFullyQualifiedNames(mod1, mod2);</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             };</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         return moduleComparator;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     private Comparator&lt;Element&gt; allClassesComparator = null;</span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Returns a Comparator for all classes, compares the simple names of</span>
<span class="udiff-line-removed">-      * TypeElement, if equal then the fully qualified names.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @return Comparator</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     public Comparator&lt;Element&gt; makeAllClassesComparator() {</span>
<span class="udiff-line-removed">-         if (allClassesComparator == null) {</span>
<span class="udiff-line-removed">-             allClassesComparator = new Utils.ElementComparator() {</span>
<span class="udiff-line-removed">-                 @Override</span>
<span class="udiff-line-removed">-                 public int compare(Element e1, Element e2) {</span>
<span class="udiff-line-removed">-                     int result = compareNames(e1, e2);</span>
<span class="udiff-line-removed">-                     if (result == 0)</span>
<span class="udiff-line-removed">-                         result = compareFullyQualifiedNames(e1, e2);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                     return result;</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             };</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         return allClassesComparator;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     private Comparator&lt;Element&gt; packageComparator = null;</span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Returns a Comparator for packages, by comparing the fully qualified names.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @return a Comparator</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     public Comparator&lt;Element&gt; makePackageComparator() {</span>
<span class="udiff-line-removed">-         if (packageComparator == null) {</span>
<span class="udiff-line-removed">-             packageComparator = new Utils.ElementComparator() {</span>
<span class="udiff-line-removed">-                 @Override</span>
<span class="udiff-line-removed">-                 public int compare(Element pkg1, Element pkg2) {</span>
<span class="udiff-line-removed">-                     return compareFullyQualifiedNames(pkg1, pkg2);</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             };</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         return packageComparator;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     private Comparator&lt;Element&gt; deprecatedComparator = null;</span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Returns a Comparator for deprecated items listed on deprecated list page, by comparing the</span>
<span class="udiff-line-removed">-      * fully qualified names.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @return a Comparator</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     public Comparator&lt;Element&gt; makeDeprecatedComparator() {</span>
<span class="udiff-line-removed">-         if (deprecatedComparator == null) {</span>
<span class="udiff-line-removed">-             deprecatedComparator = new Utils.ElementComparator() {</span>
<span class="udiff-line-removed">-                 @Override</span>
<span class="udiff-line-removed">-                 public int compare(Element e1, Element e2) {</span>
<span class="udiff-line-removed">-                     return compareFullyQualifiedNames(e1, e2);</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             };</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         return deprecatedComparator;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     private Comparator&lt;SerialFieldTree&gt; serialFieldTreeComparator = null;</span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Returns a Comparator for SerialFieldTree.</span>
<span class="udiff-line-removed">-      * @return a Comparator</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     public Comparator&lt;SerialFieldTree&gt; makeSerialFieldTreeComparator() {</span>
<span class="udiff-line-removed">-         if (serialFieldTreeComparator == null) {</span>
<span class="udiff-line-removed">-             serialFieldTreeComparator = (SerialFieldTree o1, SerialFieldTree o2) -&gt; {</span>
<span class="udiff-line-removed">-                 String s1 = o1.getName().toString();</span>
<span class="udiff-line-removed">-                 String s2 = o2.getName().toString();</span>
<span class="udiff-line-removed">-                 return s1.compareTo(s2);</span>
<span class="udiff-line-removed">-             };</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         return serialFieldTreeComparator;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Returns a general purpose comparator.</span>
<span class="udiff-line-removed">-      * @return a Comparator</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     public Comparator&lt;Element&gt; makeGeneralPurposeComparator() {</span>
<span class="udiff-line-removed">-         return makeClassUseComparator();</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     private Comparator&lt;Element&gt; overrideUseComparator = null;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Returns a Comparator for overrides and implements,</span>
<span class="udiff-line-removed">-      * used primarily on methods, compares the name first,</span>
<span class="udiff-line-removed">-      * then compares the simple names of the enclosing</span>
<span class="udiff-line-removed">-      * TypeElement and the fully qualified name of the enclosing TypeElement.</span>
<span class="udiff-line-removed">-      * @return a Comparator</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     public Comparator&lt;Element&gt; makeOverrideUseComparator() {</span>
<span class="udiff-line-removed">-         if (overrideUseComparator == null) {</span>
<span class="udiff-line-removed">-             overrideUseComparator = new Utils.ElementComparator() {</span>
<span class="udiff-line-removed">-                 @Override</span>
<span class="udiff-line-removed">-                 public int compare(Element o1, Element o2) {</span>
<span class="udiff-line-removed">-                     int result = compareStrings(getSimpleName(o1), getSimpleName(o2));</span>
<span class="udiff-line-removed">-                     if (result != 0) {</span>
<span class="udiff-line-removed">-                         return result;</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     if (!isTypeElement(o1) &amp;&amp; !isTypeElement(o2) &amp;&amp; !isPackage(o1) &amp;&amp; !isPackage(o2)) {</span>
<span class="udiff-line-removed">-                         TypeElement t1 = getEnclosingTypeElement(o1);</span>
<span class="udiff-line-removed">-                         TypeElement t2 = getEnclosingTypeElement(o2);</span>
<span class="udiff-line-removed">-                         result = compareStrings(getSimpleName(t1), getSimpleName(t2));</span>
<span class="udiff-line-removed">-                         if (result != 0)</span>
<span class="udiff-line-removed">-                             return result;</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     result = compareStrings(getFullyQualifiedName(o1), getFullyQualifiedName(o2));</span>
<span class="udiff-line-removed">-                     if (result != 0)</span>
<span class="udiff-line-removed">-                         return result;</span>
<span class="udiff-line-removed">-                     return compareElementKinds(o1, o2);</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             };</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         return overrideUseComparator;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     private Comparator&lt;Element&gt; indexUseComparator = null;</span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      *  Returns a Comparator for index file presentations, and are sorted as follows.</span>
<span class="udiff-line-removed">-      *  If comparing modules and/or packages then simply compare the qualified names,</span>
<span class="udiff-line-removed">-      *  if comparing a module or a package with a type/member then compare the</span>
<span class="udiff-line-removed">-      *  FullyQualifiedName of the module or a package with the SimpleName of the entity,</span>
<span class="udiff-line-removed">-      *  otherwise:</span>
<span class="udiff-line-removed">-      *  1. compare the ElementKind ex: Module, Package, Interface etc.</span>
<span class="udiff-line-removed">-      *  2a. if equal and if the type is of ExecutableElement(Constructor, Methods),</span>
<span class="udiff-line-removed">-      *      a case insensitive comparison of parameter the type signatures</span>
<span class="udiff-line-removed">-      *  2b. if equal, case sensitive comparison of the type signatures</span>
<span class="udiff-line-removed">-      *  3. finally, if equal, compare the FQNs of the entities</span>
<span class="udiff-line-removed">-      * @return a comparator for index file use</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     public Comparator&lt;Element&gt; makeIndexUseComparator() {</span>
<span class="udiff-line-removed">-         if (indexUseComparator == null) {</span>
<span class="udiff-line-removed">-             indexUseComparator = new Utils.ElementComparator() {</span>
<span class="udiff-line-removed">-                 /**</span>
<span class="udiff-line-removed">-                  * Compares two elements.</span>
<span class="udiff-line-removed">-                  *</span>
<span class="udiff-line-removed">-                  * @param e1 - an element.</span>
<span class="udiff-line-removed">-                  * @param e2 - an element.</span>
<span class="udiff-line-removed">-                  * @return a negative integer, zero, or a positive integer as the first</span>
<span class="udiff-line-removed">-                  * argument is less than, equal to, or greater than the second.</span>
<span class="udiff-line-removed">-                  */</span>
<span class="udiff-line-removed">-                 @Override</span>
<span class="udiff-line-removed">-                 public int compare(Element e1, Element e2) {</span>
<span class="udiff-line-removed">-                     int result;</span>
<span class="udiff-line-removed">-                     // first, compare names as appropriate</span>
<span class="udiff-line-removed">-                     if ((isModule(e1) || isPackage(e1)) &amp;&amp; (isModule(e2) || isPackage(e2))) {</span>
<span class="udiff-line-removed">-                         result = compareFullyQualifiedNames(e1, e2);</span>
<span class="udiff-line-removed">-                     } else if (isModule(e1) || isPackage(e1)) {</span>
<span class="udiff-line-removed">-                         result = compareStrings(getFullyQualifiedName(e1), getSimpleName(e2));</span>
<span class="udiff-line-removed">-                     } else if (isModule(e2) || isPackage(e2)) {</span>
<span class="udiff-line-removed">-                         result = compareStrings(getSimpleName(e1), getFullyQualifiedName(e2));</span>
<span class="udiff-line-removed">-                     } else {</span>
<span class="udiff-line-removed">-                         result = compareNames(e1, e2);</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     if (result != 0) {</span>
<span class="udiff-line-removed">-                         return result;</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     // if names are the same, compare element kinds</span>
<span class="udiff-line-removed">-                     result = compareElementKinds(e1, e2);</span>
<span class="udiff-line-removed">-                     if (result != 0) {</span>
<span class="udiff-line-removed">-                         return result;</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     // if element kinds are the same, and are methods,</span>
<span class="udiff-line-removed">-                     // compare the method parameters</span>
<span class="udiff-line-removed">-                     if (hasParameters(e1)) {</span>
<span class="udiff-line-removed">-                         List&lt;? extends VariableElement&gt; parameters1 = ((ExecutableElement)e1).getParameters();</span>
<span class="udiff-line-removed">-                         List&lt;? extends VariableElement&gt; parameters2 = ((ExecutableElement)e2).getParameters();</span>
<span class="udiff-line-removed">-                         result = compareParameters(false, parameters1, parameters2);</span>
<span class="udiff-line-removed">-                         if (result != 0) {</span>
<span class="udiff-line-removed">-                             return result;</span>
<span class="udiff-line-removed">-                         }</span>
<span class="udiff-line-removed">-                         result = compareParameters(true, parameters1, parameters2);</span>
<span class="udiff-line-removed">-                         if (result != 0) {</span>
<span class="udiff-line-removed">-                             return result;</span>
<span class="udiff-line-removed">-                         }</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     // else fall back on fully qualified names</span>
<span class="udiff-line-removed">-                     return compareFullyQualifiedNames(e1, e2);</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             };</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         return indexUseComparator;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     private Comparator&lt;TypeMirror&gt; typeMirrorClassUseComparator = null;</span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Compares the FullyQualifiedNames of two TypeMirrors</span>
<span class="udiff-line-removed">-      * @return</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     public Comparator&lt;TypeMirror&gt; makeTypeMirrorClassUseComparator() {</span>
<span class="udiff-line-removed">-         if (typeMirrorClassUseComparator == null) {</span>
<span class="udiff-line-removed">-             typeMirrorClassUseComparator = (TypeMirror type1, TypeMirror type2) -&gt; {</span>
<span class="udiff-line-removed">-                 String s1 = getQualifiedTypeName(type1);</span>
<span class="udiff-line-removed">-                 String s2 = getQualifiedTypeName(type2);</span>
<span class="udiff-line-removed">-                 return compareStrings(s1, s2);</span>
<span class="udiff-line-removed">-             };</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         return typeMirrorClassUseComparator;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     private Comparator&lt;TypeMirror&gt; typeMirrorIndexUseComparator = null;</span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Compares the SimpleNames of TypeMirrors if equal then the</span>
<span class="udiff-line-removed">-      * FullyQualifiedNames of TypeMirrors.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @return</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     public Comparator&lt;TypeMirror&gt; makeTypeMirrorIndexUseComparator() {</span>
<span class="udiff-line-removed">-         if (typeMirrorIndexUseComparator == null) {</span>
<span class="udiff-line-removed">-             typeMirrorIndexUseComparator = (TypeMirror t1, TypeMirror t2) -&gt; {</span>
<span class="udiff-line-removed">-                 int result = compareStrings(getTypeName(t1, false), getTypeName(t2, false));</span>
<span class="udiff-line-removed">-                 if (result != 0)</span>
<span class="udiff-line-removed">-                     return result;</span>
<span class="udiff-line-removed">-                 return compareStrings(getQualifiedTypeName(t1), getQualifiedTypeName(t2));</span>
<span class="udiff-line-removed">-             };</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         return typeMirrorIndexUseComparator;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
      /**
       * Get the qualified type name of a TypeMirror compatible with the Element&#39;s
       * getQualified name, returns  the qualified name of the Reference type
       * otherwise the primitive name.
       * @param t the type whose name is to be obtained.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2004,256 +1803,10 @@</span>
                  return outer ? visit(e.getEnclosingElement()) : e.getSimpleName().toString();
              }
          }.visit(e);
      }
  
<span class="udiff-line-removed">-     private Comparator&lt;Element&gt; classUseComparator = null;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Comparator for ClassUse presentations, and sorts as follows:</span>
<span class="udiff-line-removed">-      * 1. member names</span>
<span class="udiff-line-removed">-      * 2. then fully qualified member names</span>
<span class="udiff-line-removed">-      * 3. then parameter types if applicable</span>
<span class="udiff-line-removed">-      * 4. finally the element kinds ie. package, class, interface etc.</span>
<span class="udiff-line-removed">-      * @return a comparator to sort classes and members for class use</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     public Comparator&lt;Element&gt; makeClassUseComparator() {</span>
<span class="udiff-line-removed">-         if (classUseComparator == null) {</span>
<span class="udiff-line-removed">-             classUseComparator = new Utils.ElementComparator() {</span>
<span class="udiff-line-removed">-                 /**</span>
<span class="udiff-line-removed">-                  * Compares two Elements.</span>
<span class="udiff-line-removed">-                  *</span>
<span class="udiff-line-removed">-                  * @param e1 - an element.</span>
<span class="udiff-line-removed">-                  * @param e2 - an element.</span>
<span class="udiff-line-removed">-                  * @return a negative integer, zero, or a positive integer as the first</span>
<span class="udiff-line-removed">-                  * argument is less than, equal to, or greater than the second.</span>
<span class="udiff-line-removed">-                  */</span>
<span class="udiff-line-removed">-                 @Override</span>
<span class="udiff-line-removed">-                 public int compare(Element e1, Element e2) {</span>
<span class="udiff-line-removed">-                     int result = compareNames(e1, e2);</span>
<span class="udiff-line-removed">-                     if (result != 0) {</span>
<span class="udiff-line-removed">-                         return result;</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     result = compareFullyQualifiedNames(e1, e2);</span>
<span class="udiff-line-removed">-                     if (result != 0) {</span>
<span class="udiff-line-removed">-                         return result;</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     if (hasParameters(e1) &amp;&amp; hasParameters(e2)) {</span>
<span class="udiff-line-removed">-                         List&lt;? extends VariableElement&gt; parameters1 = ((ExecutableElement)e1).getParameters();</span>
<span class="udiff-line-removed">-                         List&lt;? extends VariableElement&gt; parameters2 = ((ExecutableElement)e2).getParameters();</span>
<span class="udiff-line-removed">-                         result = compareParameters(false, parameters1, parameters2);</span>
<span class="udiff-line-removed">-                         if (result != 0) {</span>
<span class="udiff-line-removed">-                             return result;</span>
<span class="udiff-line-removed">-                         }</span>
<span class="udiff-line-removed">-                         result = compareParameters(true, parameters1, parameters2);</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     if (result != 0) {</span>
<span class="udiff-line-removed">-                         return result;</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     return compareElementKinds(e1, e2);</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             };</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         return classUseComparator;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * A general purpose comparator to sort Element entities, basically provides the building blocks</span>
<span class="udiff-line-removed">-      * for creating specific comparators for an use-case.</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     private abstract class ElementComparator implements Comparator&lt;Element&gt; {</span>
<span class="udiff-line-removed">-         public ElementComparator() { }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         /**</span>
<span class="udiff-line-removed">-          * compares two parameter arrays by first comparing the length of the arrays, and</span>
<span class="udiff-line-removed">-          * then each Type of the parameter in the array.</span>
<span class="udiff-line-removed">-          * @param params1 the first parameter array.</span>
<span class="udiff-line-removed">-          * @param params2 the first parameter array.</span>
<span class="udiff-line-removed">-          * @return a negative integer, zero, or a positive integer as the first</span>
<span class="udiff-line-removed">-          *         argument is less than, equal to, or greater than the second.</span>
<span class="udiff-line-removed">-          */</span>
<span class="udiff-line-removed">-         protected int compareParameters(boolean caseSensitive, List&lt;? extends VariableElement&gt; params1,</span>
<span class="udiff-line-removed">-                                                                List&lt;? extends VariableElement&gt; params2) {</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             return compareStrings(caseSensitive, getParametersAsString(params1),</span>
<span class="udiff-line-removed">-                                                  getParametersAsString(params2));</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         String getParametersAsString(List&lt;? extends VariableElement&gt; params) {</span>
<span class="udiff-line-removed">-             StringBuilder sb = new StringBuilder();</span>
<span class="udiff-line-removed">-             for (VariableElement param : params) {</span>
<span class="udiff-line-removed">-                 TypeMirror t = param.asType();</span>
<span class="udiff-line-removed">-                 // prefix P for primitive and R for reference types, thus items will</span>
<span class="udiff-line-removed">-                 // be ordered lexically and correctly.</span>
<span class="udiff-line-removed">-                 sb.append(getTypeCode(t)).append(&quot;-&quot;).append(t).append(&quot;-&quot;);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             return sb.toString();</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         private String getTypeCode(TypeMirror t) {</span>
<span class="udiff-line-removed">-             return new SimpleTypeVisitor9&lt;String, Void&gt;() {</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 @Override</span>
<span class="udiff-line-removed">-                 public String visitPrimitive(PrimitiveType t, Void p) {</span>
<span class="udiff-line-removed">-                     return &quot;P&quot;;</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-                 @Override</span>
<span class="udiff-line-removed">-                 public String visitArray(ArrayType t, Void p) {</span>
<span class="udiff-line-removed">-                     return visit(t.getComponentType());</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-                 @Override</span>
<span class="udiff-line-removed">-                 protected String defaultAction(TypeMirror e, Void p) {</span>
<span class="udiff-line-removed">-                     return &quot;R&quot;;</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             }.visit(t);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         /**</span>
<span class="udiff-line-removed">-          * Compares two Elements, typically the name of a method,</span>
<span class="udiff-line-removed">-          * field or constructor.</span>
<span class="udiff-line-removed">-          * @param e1 the first Element.</span>
<span class="udiff-line-removed">-          * @param e2 the second Element.</span>
<span class="udiff-line-removed">-          * @return a negative integer, zero, or a positive integer as the first</span>
<span class="udiff-line-removed">-          *         argument is less than, equal to, or greater than the second.</span>
<span class="udiff-line-removed">-          */</span>
<span class="udiff-line-removed">-         protected int compareNames(Element e1, Element e2) {</span>
<span class="udiff-line-removed">-             return compareStrings(getSimpleName(e1), getSimpleName(e2));</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         /**</span>
<span class="udiff-line-removed">-          * Compares the fully qualified names of the entities</span>
<span class="udiff-line-removed">-          * @param e1 the first Element.</span>
<span class="udiff-line-removed">-          * @param e2 the first Element.</span>
<span class="udiff-line-removed">-          * @return a negative integer, zero, or a positive integer as the first</span>
<span class="udiff-line-removed">-          *         argument is less than, equal to, or greater than the second.</span>
<span class="udiff-line-removed">-          */</span>
<span class="udiff-line-removed">-         protected int compareFullyQualifiedNames(Element e1, Element e2) {</span>
<span class="udiff-line-removed">-             // add simplename to be compatible</span>
<span class="udiff-line-removed">-             String thisElement = getFullyQualifiedName(e1);</span>
<span class="udiff-line-removed">-             String thatElement = getFullyQualifiedName(e2);</span>
<span class="udiff-line-removed">-             return compareStrings(thisElement, thatElement);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         protected int compareElementKinds(Element e1, Element e2) {</span>
<span class="udiff-line-removed">-             return Integer.compare(getKindIndex(e1), getKindIndex(e2));</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         private int getKindIndex(Element e) {</span>
<span class="udiff-line-removed">-             switch (e.getKind()) {</span>
<span class="udiff-line-removed">-                 case MODULE:            return 0;</span>
<span class="udiff-line-removed">-                 case PACKAGE:           return 1;</span>
<span class="udiff-line-removed">-                 case CLASS:             return 2;</span>
<span class="udiff-line-removed">-                 case ENUM:              return 3;</span>
<span class="udiff-line-removed">-                 case ENUM_CONSTANT:     return 4;</span>
<span class="udiff-line-removed">-                 case RECORD:            return 5;</span>
<span class="udiff-line-removed">-                 case INTERFACE:         return 6;</span>
<span class="udiff-line-removed">-                 case ANNOTATION_TYPE:   return 7;</span>
<span class="udiff-line-removed">-                 case FIELD:             return 8;</span>
<span class="udiff-line-removed">-                 case CONSTRUCTOR:       return 9;</span>
<span class="udiff-line-removed">-                 case METHOD:            return 10;</span>
<span class="udiff-line-removed">-                 default: throw new IllegalArgumentException(e.getKind().toString());</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         @SuppressWarnings(&quot;preview&quot;)</span>
<span class="udiff-line-removed">-         boolean hasParameters(Element e) {</span>
<span class="udiff-line-removed">-             return new SimpleElementVisitor14&lt;Boolean, Void&gt;() {</span>
<span class="udiff-line-removed">-                 @Override</span>
<span class="udiff-line-removed">-                 public Boolean visitExecutable(ExecutableElement e, Void p) {</span>
<span class="udiff-line-removed">-                     return true;</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 @Override</span>
<span class="udiff-line-removed">-                 protected Boolean defaultAction(Element e, Void p) {</span>
<span class="udiff-line-removed">-                     return false;</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             }.visit(e);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         /**</span>
<span class="udiff-line-removed">-          * The fully qualified names of the entities, used solely by the comparator.</span>
<span class="udiff-line-removed">-          *</span>
<span class="udiff-line-removed">-          * @return a negative integer, zero, or a positive integer as the first argument is less</span>
<span class="udiff-line-removed">-          * than, equal to, or greater than the second.</span>
<span class="udiff-line-removed">-          */</span>
<span class="udiff-line-removed">-         @SuppressWarnings(&quot;preview&quot;)</span>
<span class="udiff-line-removed">-         private String getFullyQualifiedName(Element e) {</span>
<span class="udiff-line-removed">-             return new SimpleElementVisitor14&lt;String, Void&gt;() {</span>
<span class="udiff-line-removed">-                 @Override</span>
<span class="udiff-line-removed">-                 public String visitModule(ModuleElement e, Void p) {</span>
<span class="udiff-line-removed">-                     return e.getQualifiedName().toString();</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 @Override</span>
<span class="udiff-line-removed">-                 public String visitPackage(PackageElement e, Void p) {</span>
<span class="udiff-line-removed">-                     return e.getQualifiedName().toString();</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 @Override</span>
<span class="udiff-line-removed">-                 public String visitExecutable(ExecutableElement e, Void p) {</span>
<span class="udiff-line-removed">-                     // For backward compatibility</span>
<span class="udiff-line-removed">-                     return getFullyQualifiedName(e.getEnclosingElement())</span>
<span class="udiff-line-removed">-                             + &quot;.&quot; + e.getSimpleName().toString();</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 @Override</span>
<span class="udiff-line-removed">-                 public String visitType(TypeElement e, Void p) {</span>
<span class="udiff-line-removed">-                     return e.getQualifiedName().toString();</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 @Override</span>
<span class="udiff-line-removed">-                 protected String defaultAction(Element e, Void p) {</span>
<span class="udiff-line-removed">-                     return getEnclosingTypeElement(e).getQualifiedName().toString()</span>
<span class="udiff-line-removed">-                             + &quot;.&quot; + e.getSimpleName().toString();</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             }.visit(e);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Returns a Comparator for SearchIndexItems representing types. Items are</span>
<span class="udiff-line-removed">-      * compared by short name, or full string representation if names are equal.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @return a Comparator</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     public Comparator&lt;SearchIndexItem&gt; makeTypeSearchIndexComparator() {</span>
<span class="udiff-line-removed">-         return (SearchIndexItem sii1, SearchIndexItem sii2) -&gt; {</span>
<span class="udiff-line-removed">-             int result = compareStrings(sii1.getSimpleName(), sii2.getSimpleName());</span>
<span class="udiff-line-removed">-             if (result == 0) {</span>
<span class="udiff-line-removed">-                 // TreeSet needs this to be consistent with equal so we do</span>
<span class="udiff-line-removed">-                 // a plain comparison of string representations as fallback.</span>
<span class="udiff-line-removed">-                 result = sii1.toString().compareTo(sii2.toString());</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             return result;</span>
<span class="udiff-line-removed">-         };</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     private Comparator&lt;SearchIndexItem&gt; genericSearchIndexComparator = null;</span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Returns a Comparator for SearchIndexItems representing modules, packages, or members.</span>
<span class="udiff-line-removed">-      * Items are compared by label (member name plus signature for members, package name for</span>
<span class="udiff-line-removed">-      * packages, and module name for modules). If labels are equal then full string</span>
<span class="udiff-line-removed">-      * representation is compared.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @return a Comparator</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     public Comparator&lt;SearchIndexItem&gt; makeGenericSearchIndexComparator() {</span>
<span class="udiff-line-removed">-         if (genericSearchIndexComparator == null) {</span>
<span class="udiff-line-removed">-             genericSearchIndexComparator = (SearchIndexItem sii1, SearchIndexItem sii2) -&gt; {</span>
<span class="udiff-line-removed">-                 int result = compareStrings(sii1.getLabel(), sii2.getLabel());</span>
<span class="udiff-line-removed">-                 if (result == 0) {</span>
<span class="udiff-line-removed">-                     // TreeSet needs this to be consistent with equal so we do</span>
<span class="udiff-line-removed">-                     // a plain comparison of string representations as fallback.</span>
<span class="udiff-line-removed">-                     result = sii1.toString().compareTo(sii2.toString());</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-                 return result;</span>
<span class="udiff-line-removed">-             };</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         return genericSearchIndexComparator;</span>
<span class="udiff-line-removed">-     }</span>
  
      public Iterable&lt;TypeElement&gt; getEnclosedTypeElements(PackageElement pkg) {
          List&lt;TypeElement&gt; out = getInterfaces(pkg);
          out.addAll(getClasses(pkg));
          out.addAll(getEnums(pkg));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2346,11 +1899,11 @@</span>
          }
          return modulePackageMap;
      }
  
      public Map&lt;ModuleElement, String&gt; getDependentModules(ModuleElement mdle) {
<span class="udiff-line-modified-removed">-         Map&lt;ModuleElement, String&gt; result = new TreeMap&lt;&gt;(makeModuleComparator());</span>
<span class="udiff-line-modified-added">+         Map&lt;ModuleElement, String&gt; result = new TreeMap&lt;&gt;(comparators.makeModuleComparator());</span>
          Deque&lt;ModuleElement&gt; queue = new ArrayDeque&lt;&gt;();
          // get all the requires for the element in question
          for (RequiresDirective rd : ElementFilter.requiresIn(mdle.getDirectives())) {
              ModuleElement dep = rd.getDependency();
              // add the dependency to work queue
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2452,11 +2005,11 @@</span>
      public SortedSet&lt;TypeElement&gt; getAllClassesUnfiltered(Element e) {
          List&lt;TypeElement&gt; clist = getClassesUnfiltered(e);
          clist.addAll(getInterfacesUnfiltered(e));
          clist.addAll(getAnnotationTypesUnfiltered(e));
          clist.addAll(getRecordsUnfiltered(e));
<span class="udiff-line-modified-removed">-         SortedSet&lt;TypeElement&gt; oset = new TreeSet&lt;&gt;(makeGeneralPurposeComparator());</span>
<span class="udiff-line-modified-added">+         SortedSet&lt;TypeElement&gt; oset = new TreeSet&lt;&gt;(comparators.makeGeneralPurposeComparator());</span>
          oset.addAll(clist);
          return oset;
      }
  
      private final HashMap&lt;Element, SortedSet&lt;TypeElement&gt;&gt; cachedClasses = new HashMap&lt;&gt;();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2473,11 +2026,11 @@</span>
          List&lt;TypeElement&gt; clist = getClasses(e);
          clist.addAll(getInterfaces(e));
          clist.addAll(getAnnotationTypes(e));
          clist.addAll(getEnums(e));
          clist.addAll(getRecords(e));
<span class="udiff-line-modified-removed">-         oset = new TreeSet&lt;&gt;(makeGeneralPurposeComparator());</span>
<span class="udiff-line-modified-added">+         oset = new TreeSet&lt;&gt;(comparators.makeGeneralPurposeComparator());</span>
          oset.addAll(clist);
          cachedClasses.put(e, oset);
          return oset;
      }
  
</pre>
<center><a href="TypeElementCatalog.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="VisibleMemberTable.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>