<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/builders/ClassBuilder.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="BuilderFactory.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="ConstantsSummaryBuilder.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/builders/ClassBuilder.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 49 /**
 50  * Builds the summary for a given class.
 51  *
 52  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
 53  *  If you write code that depends on this, you do so at your own risk.
 54  *  This code and its internal interfaces are subject to change or
 55  *  deletion without notice.&lt;/b&gt;
 56  */
 57 public class ClassBuilder extends AbstractBuilder {
 58 
 59     /**
 60      * The class being documented.
 61      */
 62     private final TypeElement typeElement;
 63 
 64     /**
 65      * The doclet specific writer.
 66      */
 67     private final ClassWriter writer;
 68 
<span class="line-removed"> 69     /**</span>
<span class="line-removed"> 70      * Keep track of whether or not this typeElement is an interface.</span>
<span class="line-removed"> 71      */</span>
<span class="line-removed"> 72     private final boolean isInterface;</span>
<span class="line-removed"> 73 </span>
<span class="line-removed"> 74     /**</span>
<span class="line-removed"> 75      * Keep track of whether or not this typeElement is an enum.</span>
<span class="line-removed"> 76      */</span>
<span class="line-removed"> 77     private final boolean isEnum;</span>
<span class="line-removed"> 78 </span>
<span class="line-removed"> 79     /**</span>
<span class="line-removed"> 80      * Keep track of whether or not this typeElement is a record.</span>
<span class="line-removed"> 81      */</span>
<span class="line-removed"> 82     private final boolean isRecord;</span>
<span class="line-removed"> 83 </span>
 84     /**
 85      * The content tree for the class documentation.
 86      */
 87     private Content contentTree;
 88 
 89     private final Utils utils;
 90 
 91     /**
 92      * Construct a new ClassBuilder.
 93      *
 94      * @param context  the build context
 95      * @param typeElement the class being documented.
 96      * @param writer the doclet specific writer.
 97      */
 98     private ClassBuilder(Context context, TypeElement typeElement, ClassWriter writer) {
 99         super(context);
100         this.typeElement = typeElement;
101         this.writer = writer;
102         this.utils = configuration.utils;
<span class="line-modified">103         if (utils.isInterface(typeElement)) {</span>
<span class="line-modified">104             isInterface = true;</span>
<span class="line-modified">105             isEnum = false;</span>
<span class="line-modified">106             isRecord = false;</span>
<span class="line-modified">107         } else if (utils.isEnum(typeElement)) {</span>
<span class="line-modified">108             isInterface = false;</span>
<span class="line-modified">109             isEnum = true;</span>
<span class="line-modified">110             isRecord = false;</span>
<span class="line-removed">111             setEnumDocumentation(typeElement);</span>
<span class="line-removed">112         } else if (utils.isRecord(typeElement)) {</span>
<span class="line-removed">113             isInterface = false;</span>
<span class="line-removed">114             isEnum = false;</span>
<span class="line-removed">115             isRecord = true;</span>
<span class="line-removed">116             setRecordDocumentation(typeElement);</span>
<span class="line-removed">117         } else {</span>
<span class="line-removed">118             isInterface = false;</span>
<span class="line-removed">119             isEnum = false;</span>
<span class="line-removed">120             isRecord = false;</span>
121         }
122     }
123 
124     /**
125      * Constructs a new ClassBuilder.
126      *
127      * @param context  the build context
128      * @param typeElement the class being documented.
129      * @param writer the doclet specific writer.
130      * @return the new ClassBuilder
131      */
132     public static ClassBuilder getInstance(Context context, TypeElement typeElement, ClassWriter writer) {
133         return new ClassBuilder(context, typeElement, writer);
134     }
135 
136     @Override
137     public void build() throws DocletException {
138         buildClassDoc();
139     }
140 
141      /**
142       * Handles the {@literal &lt;TypeElement&gt;} tag.
143       *
144       * @throws DocletException if there is a problem while building the documentation
145       */
146      protected void buildClassDoc() throws DocletException {
147         String key;
<span class="line-modified">148         if (isInterface) {</span>
<span class="line-modified">149             key = &quot;doclet.Interface&quot;;</span>
<span class="line-modified">150         } else if (isEnum) {</span>
<span class="line-modified">151             key = &quot;doclet.Enum&quot;;</span>
<span class="line-modified">152         } else if (isRecord) {</span>
<span class="line-modified">153             key = &quot;doclet.Record&quot;;</span>
<span class="line-modified">154         } else {</span>
<span class="line-modified">155             key = &quot;doclet.Class&quot;;</span>
<span class="line-modified">156         }</span>










157         Content contentTree = writer.getHeader(resources.getText(key) + &quot; &quot;
158                 + utils.getSimpleName(typeElement));
159         Content classContentTree = writer.getClassContentHeader();
160 
161         buildClassTree(classContentTree);
162         buildClassInfo(classContentTree);
163         buildMemberSummary(classContentTree);
164         buildMemberDetails(classContentTree);
165 
166         writer.addClassContentTree(classContentTree);
167         writer.addFooter();
168         writer.printDocument(contentTree);
169         copyDocFiles();
170     }
171 
172      /**
173       * Build the class tree documentation.
174       *
175       * @param classContentTree the content tree to which the documentation will be added
176       */
</pre>
<hr />
<pre>
333 
334     /**
335      * Build the member summary contents of the page.
336      *
337      * @param classContentTree the content tree to which the documentation will be added
338      * @throws DocletException if there is a problem while building the documentation
339      */
340     protected void buildMemberSummary(Content classContentTree) throws DocletException {
341         Content memberSummaryTree = writer.getMemberTreeHeader();
342         builderFactory.getMemberSummaryBuilder(writer).build(memberSummaryTree);
343         classContentTree.add(writer.getMemberSummaryTree(memberSummaryTree));
344     }
345 
346     /**
347      * Build the member details contents of the page.
348      *
349      * @param classContentTree the content tree to which the documentation will be added
350      * @throws DocletException if there is a problem while building the documentation
351      */
352     protected void buildMemberDetails(Content classContentTree) throws DocletException {
<span class="line-modified">353         Content memberDetailsTree = writer.getMemberTreeHeader();</span>
354 
<span class="line-modified">355         buildEnumConstantsDetails(memberDetailsTree);</span>
<span class="line-modified">356         buildPropertyDetails(memberDetailsTree);</span>
<span class="line-modified">357         buildFieldDetails(memberDetailsTree);</span>
<span class="line-modified">358         buildConstructorDetails(memberDetailsTree);</span>
<span class="line-modified">359         buildMethodDetails(memberDetailsTree);</span>


360 
<span class="line-modified">361         classContentTree.add(writer.getMemberDetailsTree(memberDetailsTree));</span>
362     }
363 
364     /**
365      * Build the enum constants documentation.
366      *
<span class="line-modified">367      * @param memberDetailsTree the content tree to which the documentation will be added</span>
368      * @throws DocletException if there is a problem while building the documentation
369      */
<span class="line-modified">370     protected void buildEnumConstantsDetails(Content memberDetailsTree) throws DocletException {</span>
<span class="line-modified">371         builderFactory.getEnumConstantsBuilder(writer).build(memberDetailsTree);</span>
372     }
373 
374     /**
375      * Build the field documentation.
376      *
<span class="line-modified">377      * @param memberDetailsTree the content tree to which the documentation will be added</span>
378      * @throws DocletException if there is a problem while building the documentation
379      */
<span class="line-modified">380     protected void buildFieldDetails(Content memberDetailsTree) throws DocletException {</span>
<span class="line-modified">381         builderFactory.getFieldBuilder(writer).build(memberDetailsTree);</span>
382     }
383 
384     /**
385      * Build the property documentation.
386      *
<span class="line-modified">387      * @param memberDetailsTree the content tree to which the documentation will be added</span>
388      * @throws DocletException if there is a problem while building the documentation
389      */
<span class="line-modified">390     public void buildPropertyDetails( Content memberDetailsTree) throws DocletException {</span>
<span class="line-modified">391         builderFactory.getPropertyBuilder(writer).build(memberDetailsTree);</span>
392     }
393 
394     /**
395      * Build the constructor documentation.
396      *
<span class="line-modified">397      * @param memberDetailsTree the content tree to which the documentation will be added</span>
398      * @throws DocletException if there is a problem while building the documentation
399      */
<span class="line-modified">400     protected void buildConstructorDetails(Content memberDetailsTree) throws DocletException {</span>
<span class="line-modified">401         builderFactory.getConstructorBuilder(writer).build(memberDetailsTree);</span>
402     }
403 
404     /**
405      * Build the method documentation.
406      *
<span class="line-modified">407      * @param memberDetailsTree the content tree to which the documentation will be added</span>
408      * @throws DocletException if there is a problem while building the documentation
409      */
<span class="line-modified">410     protected void buildMethodDetails(Content memberDetailsTree) throws DocletException {</span>
<span class="line-modified">411         builderFactory.getMethodBuilder(writer).build(memberDetailsTree);</span>






















412     }
413 
414     /**
415      * The documentation for values() and valueOf() in Enums are set by the
416      * doclet only iff the user or overridden methods are missing.
417      * @param elem the enum element
418      */
419     private void setEnumDocumentation(TypeElement elem) {
420         CommentUtils cmtUtils = configuration.cmtUtils;
421         for (ExecutableElement ee : utils.getMethods(elem)) {
422             if (!utils.getFullBody(ee).isEmpty()) // ignore if already set
423                 continue;
424             Name name = ee.getSimpleName();
425             if (name.contentEquals(&quot;values&quot;) &amp;&amp; ee.getParameters().isEmpty()) {
426                 utils.removeCommentHelper(ee); // purge previous entry
427                 cmtUtils.setEnumValuesTree(ee);
428             } else if (name.contentEquals(&quot;valueOf&quot;) &amp;&amp; ee.getParameters().size() == 1) {
429                 // TODO: check parameter type
430                 utils.removeCommentHelper(ee); // purge previous entry
431                 cmtUtils.setEnumValueOfTree(ee);
</pre>
</td>
<td>
<hr />
<pre>
 49 /**
 50  * Builds the summary for a given class.
 51  *
 52  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
 53  *  If you write code that depends on this, you do so at your own risk.
 54  *  This code and its internal interfaces are subject to change or
 55  *  deletion without notice.&lt;/b&gt;
 56  */
 57 public class ClassBuilder extends AbstractBuilder {
 58 
 59     /**
 60      * The class being documented.
 61      */
 62     private final TypeElement typeElement;
 63 
 64     /**
 65      * The doclet specific writer.
 66      */
 67     private final ClassWriter writer;
 68 















 69     /**
 70      * The content tree for the class documentation.
 71      */
 72     private Content contentTree;
 73 
 74     private final Utils utils;
 75 
 76     /**
 77      * Construct a new ClassBuilder.
 78      *
 79      * @param context  the build context
 80      * @param typeElement the class being documented.
 81      * @param writer the doclet specific writer.
 82      */
 83     private ClassBuilder(Context context, TypeElement typeElement, ClassWriter writer) {
 84         super(context);
 85         this.typeElement = typeElement;
 86         this.writer = writer;
 87         this.utils = configuration.utils;
<span class="line-modified"> 88         switch (typeElement.getKind()) {</span>
<span class="line-modified"> 89             case ENUM:</span>
<span class="line-modified"> 90                 setEnumDocumentation(typeElement);</span>
<span class="line-modified"> 91                 break;</span>
<span class="line-modified"> 92 </span>
<span class="line-modified"> 93             case RECORD:</span>
<span class="line-modified"> 94                 setRecordDocumentation(typeElement);</span>
<span class="line-modified"> 95                 break;</span>










 96         }
 97     }
 98 
 99     /**
100      * Constructs a new ClassBuilder.
101      *
102      * @param context  the build context
103      * @param typeElement the class being documented.
104      * @param writer the doclet specific writer.
105      * @return the new ClassBuilder
106      */
107     public static ClassBuilder getInstance(Context context, TypeElement typeElement, ClassWriter writer) {
108         return new ClassBuilder(context, typeElement, writer);
109     }
110 
111     @Override
112     public void build() throws DocletException {
113         buildClassDoc();
114     }
115 
116      /**
117       * Handles the {@literal &lt;TypeElement&gt;} tag.
118       *
119       * @throws DocletException if there is a problem while building the documentation
120       */
121      protected void buildClassDoc() throws DocletException {
122         String key;
<span class="line-modified">123          switch (typeElement.getKind()) {</span>
<span class="line-modified">124              case INTERFACE:</span>
<span class="line-modified">125                  key = &quot;doclet.Interface&quot;;</span>
<span class="line-modified">126                  break;</span>
<span class="line-modified">127              case ENUM:</span>
<span class="line-modified">128                  key = &quot;doclet.Enum&quot;;</span>
<span class="line-modified">129                  break;</span>
<span class="line-modified">130              case RECORD:</span>
<span class="line-modified">131                  key = &quot;doclet.Record&quot;;</span>
<span class="line-added">132                  break;</span>
<span class="line-added">133              case ANNOTATION_TYPE:</span>
<span class="line-added">134                  key = &quot;doclet.AnnotationType&quot;;</span>
<span class="line-added">135                  break;</span>
<span class="line-added">136              case CLASS:</span>
<span class="line-added">137                  key = &quot;doclet.Class&quot;;</span>
<span class="line-added">138                  break;</span>
<span class="line-added">139              default:</span>
<span class="line-added">140                  throw new IllegalStateException(typeElement.getKind() + &quot; &quot; + typeElement);</span>
<span class="line-added">141          }</span>
142         Content contentTree = writer.getHeader(resources.getText(key) + &quot; &quot;
143                 + utils.getSimpleName(typeElement));
144         Content classContentTree = writer.getClassContentHeader();
145 
146         buildClassTree(classContentTree);
147         buildClassInfo(classContentTree);
148         buildMemberSummary(classContentTree);
149         buildMemberDetails(classContentTree);
150 
151         writer.addClassContentTree(classContentTree);
152         writer.addFooter();
153         writer.printDocument(contentTree);
154         copyDocFiles();
155     }
156 
157      /**
158       * Build the class tree documentation.
159       *
160       * @param classContentTree the content tree to which the documentation will be added
161       */
</pre>
<hr />
<pre>
318 
319     /**
320      * Build the member summary contents of the page.
321      *
322      * @param classContentTree the content tree to which the documentation will be added
323      * @throws DocletException if there is a problem while building the documentation
324      */
325     protected void buildMemberSummary(Content classContentTree) throws DocletException {
326         Content memberSummaryTree = writer.getMemberTreeHeader();
327         builderFactory.getMemberSummaryBuilder(writer).build(memberSummaryTree);
328         classContentTree.add(writer.getMemberSummaryTree(memberSummaryTree));
329     }
330 
331     /**
332      * Build the member details contents of the page.
333      *
334      * @param classContentTree the content tree to which the documentation will be added
335      * @throws DocletException if there is a problem while building the documentation
336      */
337     protected void buildMemberDetails(Content classContentTree) throws DocletException {
<span class="line-modified">338         Content detailsList = writer.getDetailsList();</span>
339 
<span class="line-modified">340         buildEnumConstantsDetails(detailsList);</span>
<span class="line-modified">341         buildPropertyDetails(detailsList);</span>
<span class="line-modified">342         buildFieldDetails(detailsList);</span>
<span class="line-modified">343         buildConstructorDetails(detailsList);</span>
<span class="line-modified">344         buildAnnotationTypeRequiredMemberDetails(detailsList);</span>
<span class="line-added">345         buildAnnotationTypeOptionalMemberDetails(detailsList);</span>
<span class="line-added">346         buildMethodDetails(detailsList);</span>
347 
<span class="line-modified">348         classContentTree.add(writer.getMemberDetailsTree(detailsList));</span>
349     }
350 
351     /**
352      * Build the enum constants documentation.
353      *
<span class="line-modified">354      * @param detailsList the content tree to which the documentation will be added</span>
355      * @throws DocletException if there is a problem while building the documentation
356      */
<span class="line-modified">357     protected void buildEnumConstantsDetails(Content detailsList) throws DocletException {</span>
<span class="line-modified">358         builderFactory.getEnumConstantsBuilder(writer).build(detailsList);</span>
359     }
360 
361     /**
362      * Build the field documentation.
363      *
<span class="line-modified">364      * @param detailsList the content tree to which the documentation will be added</span>
365      * @throws DocletException if there is a problem while building the documentation
366      */
<span class="line-modified">367     protected void buildFieldDetails(Content detailsList) throws DocletException {</span>
<span class="line-modified">368         builderFactory.getFieldBuilder(writer).build(detailsList);</span>
369     }
370 
371     /**
372      * Build the property documentation.
373      *
<span class="line-modified">374      * @param detailsList the content tree to which the documentation will be added</span>
375      * @throws DocletException if there is a problem while building the documentation
376      */
<span class="line-modified">377     public void buildPropertyDetails( Content detailsList) throws DocletException {</span>
<span class="line-modified">378         builderFactory.getPropertyBuilder(writer).build(detailsList);</span>
379     }
380 
381     /**
382      * Build the constructor documentation.
383      *
<span class="line-modified">384      * @param detailsList the content tree to which the documentation will be added</span>
385      * @throws DocletException if there is a problem while building the documentation
386      */
<span class="line-modified">387     protected void buildConstructorDetails(Content detailsList) throws DocletException {</span>
<span class="line-modified">388         builderFactory.getConstructorBuilder(writer).build(detailsList);</span>
389     }
390 
391     /**
392      * Build the method documentation.
393      *
<span class="line-modified">394      * @param detailsList the content tree to which the documentation will be added</span>
395      * @throws DocletException if there is a problem while building the documentation
396      */
<span class="line-modified">397     protected void buildMethodDetails(Content detailsList) throws DocletException {</span>
<span class="line-modified">398         builderFactory.getMethodBuilder(writer).build(detailsList);</span>
<span class="line-added">399     }</span>
<span class="line-added">400 </span>
<span class="line-added">401     /**</span>
<span class="line-added">402      * Build the annotation type optional member documentation.</span>
<span class="line-added">403      *</span>
<span class="line-added">404      * @param memberDetailsTree the content tree to which the documentation will be added</span>
<span class="line-added">405      * @throws DocletException if there is a problem building the documentation</span>
<span class="line-added">406      */</span>
<span class="line-added">407     protected void buildAnnotationTypeOptionalMemberDetails(Content memberDetailsTree)</span>
<span class="line-added">408             throws DocletException {</span>
<span class="line-added">409         builderFactory.getAnnotationTypeOptionalMemberBuilder(writer).build(memberDetailsTree);</span>
<span class="line-added">410     }</span>
<span class="line-added">411 </span>
<span class="line-added">412     /**</span>
<span class="line-added">413      * Build the annotation type required member documentation.</span>
<span class="line-added">414      *</span>
<span class="line-added">415      * @param memberDetailsTree the content tree to which the documentation will be added</span>
<span class="line-added">416      * @throws DocletException if there is a problem building the documentation</span>
<span class="line-added">417      */</span>
<span class="line-added">418     protected void buildAnnotationTypeRequiredMemberDetails(Content memberDetailsTree)</span>
<span class="line-added">419             throws DocletException {</span>
<span class="line-added">420         builderFactory.getAnnotationTypeRequiredMemberBuilder(writer).build(memberDetailsTree);</span>
421     }
422 
423     /**
424      * The documentation for values() and valueOf() in Enums are set by the
425      * doclet only iff the user or overridden methods are missing.
426      * @param elem the enum element
427      */
428     private void setEnumDocumentation(TypeElement elem) {
429         CommentUtils cmtUtils = configuration.cmtUtils;
430         for (ExecutableElement ee : utils.getMethods(elem)) {
431             if (!utils.getFullBody(ee).isEmpty()) // ignore if already set
432                 continue;
433             Name name = ee.getSimpleName();
434             if (name.contentEquals(&quot;values&quot;) &amp;&amp; ee.getParameters().isEmpty()) {
435                 utils.removeCommentHelper(ee); // purge previous entry
436                 cmtUtils.setEnumValuesTree(ee);
437             } else if (name.contentEquals(&quot;valueOf&quot;) &amp;&amp; ee.getParameters().size() == 1) {
438                 // TODO: check parameter type
439                 utils.removeCommentHelper(ee); // purge previous entry
440                 cmtUtils.setEnumValueOfTree(ee);
</pre>
</td>
</tr>
</table>
<center><a href="BuilderFactory.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="ConstantsSummaryBuilder.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>