<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/opto/output.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../../cpu/x86/x86_64.ad.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>src/hotspot/share/opto/output.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
1588 
1589       // Verify that there is sufficient space remaining
1590       cb-&gt;insts()-&gt;maybe_expand_to_ensure_remaining(MAX_inst_size);
1591       if ((cb-&gt;blob() == NULL) || (!CompileBroker::should_compile_new_jobs())) {
1592         C-&gt;record_failure(&quot;CodeCache is full&quot;);
1593         return;
1594       }
1595 
1596       // Save the offset for the listing
1597 #if defined(SUPPORT_OPTO_ASSEMBLY)
1598       if ((node_offsets != NULL) &amp;&amp; (n-&gt;_idx &lt; node_offset_limit)) {
1599         node_offsets[n-&gt;_idx] = cb-&gt;insts_size();
1600       }
1601 #endif
1602 
1603       // &quot;Normal&quot; instruction case
1604       DEBUG_ONLY( uint instr_offset = cb-&gt;insts_size(); )
1605       n-&gt;emit(*cb, C-&gt;regalloc());
1606       current_offset  = cb-&gt;insts_size();
1607 


1608       // Above we only verified that there is enough space in the instruction section.
1609       // However, the instruction may emit stubs that cause code buffer expansion.
1610       // Bail out here if expansion failed due to a lack of code cache space.
1611       if (C-&gt;failing()) {
1612         return;
1613       }
1614 
1615 #ifdef ASSERT
1616       uint n_size = n-&gt;size(C-&gt;regalloc());
1617       if (n_size &lt; (current_offset-instr_offset)) {
1618         MachNode* mach = n-&gt;as_Mach();
1619         n-&gt;dump();
1620         mach-&gt;dump_format(C-&gt;regalloc(), tty);
1621         tty-&gt;print_cr(&quot; n_size (%d), current_offset (%d), instr_offset (%d)&quot;, n_size, current_offset, instr_offset);
1622         Disassembler::decode(cb-&gt;insts_begin() + instr_offset, cb-&gt;insts_begin() + current_offset + 1, tty);
1623         tty-&gt;print_cr(&quot; ------------------- &quot;);
1624         BufferBlob* blob = this-&gt;scratch_buffer_blob();
1625         address blob_begin = blob-&gt;content_begin();
1626         Disassembler::decode(blob_begin, blob_begin + n_size + 1, tty);
1627         assert(false, &quot;wrong size of mach node&quot;);
</pre>
</td>
<td>
<hr />
<pre>
1588 
1589       // Verify that there is sufficient space remaining
1590       cb-&gt;insts()-&gt;maybe_expand_to_ensure_remaining(MAX_inst_size);
1591       if ((cb-&gt;blob() == NULL) || (!CompileBroker::should_compile_new_jobs())) {
1592         C-&gt;record_failure(&quot;CodeCache is full&quot;);
1593         return;
1594       }
1595 
1596       // Save the offset for the listing
1597 #if defined(SUPPORT_OPTO_ASSEMBLY)
1598       if ((node_offsets != NULL) &amp;&amp; (n-&gt;_idx &lt; node_offset_limit)) {
1599         node_offsets[n-&gt;_idx] = cb-&gt;insts_size();
1600       }
1601 #endif
1602 
1603       // &quot;Normal&quot; instruction case
1604       DEBUG_ONLY( uint instr_offset = cb-&gt;insts_size(); )
1605       n-&gt;emit(*cb, C-&gt;regalloc());
1606       current_offset  = cb-&gt;insts_size();
1607 
<span class="line-added">1608       assert(!is_mcall || (call_returns[block-&gt;_pre_order] == current_offset), &quot;ret_addr_offset() did not match size of emitted code&quot;);</span>
<span class="line-added">1609 </span>
1610       // Above we only verified that there is enough space in the instruction section.
1611       // However, the instruction may emit stubs that cause code buffer expansion.
1612       // Bail out here if expansion failed due to a lack of code cache space.
1613       if (C-&gt;failing()) {
1614         return;
1615       }
1616 
1617 #ifdef ASSERT
1618       uint n_size = n-&gt;size(C-&gt;regalloc());
1619       if (n_size &lt; (current_offset-instr_offset)) {
1620         MachNode* mach = n-&gt;as_Mach();
1621         n-&gt;dump();
1622         mach-&gt;dump_format(C-&gt;regalloc(), tty);
1623         tty-&gt;print_cr(&quot; n_size (%d), current_offset (%d), instr_offset (%d)&quot;, n_size, current_offset, instr_offset);
1624         Disassembler::decode(cb-&gt;insts_begin() + instr_offset, cb-&gt;insts_begin() + current_offset + 1, tty);
1625         tty-&gt;print_cr(&quot; ------------------- &quot;);
1626         BufferBlob* blob = this-&gt;scratch_buffer_blob();
1627         address blob_begin = blob-&gt;content_begin();
1628         Disassembler::decode(blob_begin, blob_begin + n_size + 1, tty);
1629         assert(false, &quot;wrong size of mach node&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="../../cpu/x86/x86_64.ad.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>