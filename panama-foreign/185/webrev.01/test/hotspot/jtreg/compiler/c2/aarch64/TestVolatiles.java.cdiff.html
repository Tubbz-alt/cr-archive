<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/hotspot/jtreg/compiler/c2/aarch64/TestVolatiles.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../ProblemList.txt.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../jvmci/events/JvmciNotifyBootstrapFinishedEventTest.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/compiler/c2/aarch64/TestVolatiles.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2018, Red Hat, Inc. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2018, 2020, Red Hat, Inc. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 72,32 ***</span>
          int argcount;
          // add one or two extra arguments according to test type
          // i.e. GC type plus GC conifg
          switch(testType) {
          case &quot;G1&quot;:
<span class="line-modified">!             argcount = 9;</span>
              procArgs = new String[argcount];
              procArgs[argcount - 2] = &quot;-XX:+UseG1GC&quot;;
              break;
          case &quot;Parallel&quot;:
<span class="line-modified">!             argcount = 9;</span>
              procArgs = new String[argcount];
              procArgs[argcount - 2] = &quot;-XX:+UseParallelGC&quot;;
              break;
          case &quot;Serial&quot;:
<span class="line-modified">!             argcount = 9;</span>
              procArgs = new String[argcount];
              procArgs[argcount - 2] = &quot;-XX:+UseSerialGC&quot;;
              break;
          case &quot;Shenandoah&quot;:
<span class="line-modified">!             argcount = 10;</span>
              procArgs = new String[argcount];
              procArgs[argcount - 3] = &quot;-XX:+UnlockExperimentalVMOptions&quot;;
              procArgs[argcount - 2] = &quot;-XX:+UseShenandoahGC&quot;;
              break;
          case &quot;ShenandoahIU&quot;:
<span class="line-modified">!             argcount = 11;</span>
              procArgs = new String[argcount];
              procArgs[argcount - 4] = &quot;-XX:+UnlockExperimentalVMOptions&quot;;
              procArgs[argcount - 3] = &quot;-XX:+UseShenandoahGC&quot;;
              procArgs[argcount - 2] = &quot;-XX:ShenandoahGCMode=iu&quot;;
              break;
<span class="line-new-header">--- 72,32 ---</span>
          int argcount;
          // add one or two extra arguments according to test type
          // i.e. GC type plus GC conifg
          switch(testType) {
          case &quot;G1&quot;:
<span class="line-modified">!             argcount = 8;</span>
              procArgs = new String[argcount];
              procArgs[argcount - 2] = &quot;-XX:+UseG1GC&quot;;
              break;
          case &quot;Parallel&quot;:
<span class="line-modified">!             argcount = 8;</span>
              procArgs = new String[argcount];
              procArgs[argcount - 2] = &quot;-XX:+UseParallelGC&quot;;
              break;
          case &quot;Serial&quot;:
<span class="line-modified">!             argcount = 8;</span>
              procArgs = new String[argcount];
              procArgs[argcount - 2] = &quot;-XX:+UseSerialGC&quot;;
              break;
          case &quot;Shenandoah&quot;:
<span class="line-modified">!             argcount = 9;</span>
              procArgs = new String[argcount];
              procArgs[argcount - 3] = &quot;-XX:+UnlockExperimentalVMOptions&quot;;
              procArgs[argcount - 2] = &quot;-XX:+UseShenandoahGC&quot;;
              break;
          case &quot;ShenandoahIU&quot;:
<span class="line-modified">!             argcount = 10;</span>
              procArgs = new String[argcount];
              procArgs[argcount - 4] = &quot;-XX:+UnlockExperimentalVMOptions&quot;;
              procArgs[argcount - 3] = &quot;-XX:+UseShenandoahGC&quot;;
              procArgs[argcount - 2] = &quot;-XX:ShenandoahGCMode=iu&quot;;
              break;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 110,39 ***</span>
          // the first round of test enables transform of barriers to
          // use acquiring loads and releasing stores by setting arg
          // zero appropriately. this arg is reset in the second run to
          // disable the transform.
  
<span class="line-modified">!         procArgs[0] = &quot;-XX:-UseBarriersForVolatile&quot;;</span>
<span class="line-modified">!         procArgs[1] = &quot;-XX:+UseCompressedOops&quot;;</span>
<span class="line-modified">! </span>
<span class="line-modified">!         procArgs[2] = &quot;-XX:-TieredCompilation&quot;;</span>
<span class="line-modified">!         procArgs[3] = &quot;-XX:+PrintOptoAssembly&quot;;</span>
<span class="line-modified">!         procArgs[4] = &quot;-XX:CompileCommand=compileonly,&quot; + fullclassname + &quot;::&quot; + &quot;test*&quot;;</span>
<span class="line-removed">-         procArgs[5] = &quot;--add-exports&quot;;</span>
<span class="line-removed">-         procArgs[6] = &quot;java.base/jdk.internal.misc=ALL-UNNAMED&quot;;</span>
          procArgs[argcount - 1] = fullclassname;
  
<span class="line-modified">!         runtest(classname, testType, false, true, procArgs);</span>
<span class="line-removed">-         // rerun the test class without the transform applied and</span>
<span class="line-removed">-         // check the alternative generation is as expected</span>
<span class="line-removed">- </span>
<span class="line-removed">-         procArgs[0] = &quot;-XX:+UseBarriersForVolatile&quot;;</span>
<span class="line-removed">-         runtest(classname, testType, true, true, procArgs);</span>
  
          if (!classname.equals(&quot;TestUnsafeVolatileGAA&quot;)) {
<span class="line-modified">!             procArgs[0] = &quot;-XX:-UseBarriersForVolatile&quot;;</span>
<span class="line-modified">!             procArgs[1] = &quot;-XX:-UseCompressedOops&quot;;</span>
<span class="line-removed">-             runtest(classname, testType, false, false, procArgs);</span>
<span class="line-removed">- </span>
<span class="line-removed">-             procArgs[0] = &quot;-XX:+UseBarriersForVolatile&quot;;</span>
<span class="line-removed">-             runtest(classname, testType, true, false, procArgs);</span>
          }
      }
  
  
<span class="line-modified">!     public void runtest(String classname, String testType, boolean useBarriersForVolatile, boolean useCompressedOops, String[] procArgs) throws Throwable {</span>
          ProcessBuilder pb = ProcessTools.createJavaProcessBuilder(procArgs);
          OutputAnalyzer output = new OutputAnalyzer(pb.start());
  
          output.stderrShouldBeEmptyIgnoreVMWarnings();
          output.stdoutShouldNotBeEmpty();
<span class="line-new-header">--- 110,28 ---</span>
          // the first round of test enables transform of barriers to
          // use acquiring loads and releasing stores by setting arg
          // zero appropriately. this arg is reset in the second run to
          // disable the transform.
  
<span class="line-modified">!         procArgs[0] = &quot;-XX:+UseCompressedOops&quot;;</span>
<span class="line-modified">!         procArgs[1] = &quot;-XX:-TieredCompilation&quot;;</span>
<span class="line-modified">!         procArgs[2] = &quot;-XX:+PrintOptoAssembly&quot;;</span>
<span class="line-modified">!         procArgs[3] = &quot;-XX:CompileCommand=compileonly,&quot; + fullclassname + &quot;::&quot; + &quot;test*&quot;;</span>
<span class="line-modified">!         procArgs[4] = &quot;--add-exports&quot;;</span>
<span class="line-modified">!         procArgs[5] = &quot;java.base/jdk.internal.misc=ALL-UNNAMED&quot;;</span>
          procArgs[argcount - 1] = fullclassname;
  
<span class="line-modified">!         runtest(classname, testType, true, procArgs);</span>
  
          if (!classname.equals(&quot;TestUnsafeVolatileGAA&quot;)) {
<span class="line-modified">!             procArgs[0] = &quot;-XX:-UseCompressedOops&quot;;</span>
<span class="line-modified">!             runtest(classname, testType, false, procArgs);</span>
          }
      }
  
  
<span class="line-modified">!     public void runtest(String classname, String testType, boolean useCompressedOops, String[] procArgs) throws Throwable {</span>
          ProcessBuilder pb = ProcessTools.createJavaProcessBuilder(procArgs);
          OutputAnalyzer output = new OutputAnalyzer(pb.start());
  
          output.stderrShouldBeEmptyIgnoreVMWarnings();
          output.stdoutShouldNotBeEmpty();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 150,11 ***</span>
  
          // check the output for the correct asm sequence as
          // appropriate to test class, test type and whether transform
          // was applied
  
<span class="line-modified">!         checkoutput(output, classname, testType, useBarriersForVolatile, useCompressedOops);</span>
      }
  
      // skip through output returning a line containing the desireed
      // substring or null
      private String skipTo(Iterator&lt;String&gt; iter, String substring)
<span class="line-new-header">--- 139,11 ---</span>
  
          // check the output for the correct asm sequence as
          // appropriate to test class, test type and whether transform
          // was applied
  
<span class="line-modified">!         checkoutput(output, classname, testType, useCompressedOops);</span>
      }
  
      // skip through output returning a line containing the desireed
      // substring or null
      private String skipTo(Iterator&lt;String&gt; iter, String substring)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 221,218 ***</span>
          return true;
      }
  
      // check for expected asm output from a volatile load
  
<span class="line-modified">!     private void checkload(OutputAnalyzer output, String testType, boolean useBarriersForVolatile, boolean useCompressedOops) throws Throwable</span>
      {
          Iterator&lt;String&gt; iter = output.asLines().listIterator();
  
          // we shoud see this same sequence for normal or unsafe volatile load
          // for both int and Object fields
  
          String[] matches;
<span class="line-modified">! </span>
<span class="line-modified">!         if (!useBarriersForVolatile) {</span>
<span class="line-modified">!             matches = new String[] {</span>
<span class="line-modified">!                 &quot;ldarw&quot;,</span>
<span class="line-modified">!                 &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-removed">-                 &quot;ret&quot;</span>
<span class="line-removed">-             };</span>
<span class="line-removed">-         } else {</span>
<span class="line-removed">-             matches = new String[] {</span>
<span class="line-removed">-                 &quot;ldrw&quot;,</span>
<span class="line-removed">-                 &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                 &quot;dmb ish&quot;,</span>
<span class="line-removed">-                 &quot;ret&quot;</span>
<span class="line-removed">-             };</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
          checkCompile(iter, &quot;testInt&quot;, matches, output, true);
  
<span class="line-modified">!         if (!useBarriersForVolatile) {</span>
<span class="line-modified">!             matches = new String[] {</span>
<span class="line-modified">!                 useCompressedOops ? &quot;ldarw?&quot; : &quot;ldar&quot;,</span>
<span class="line-modified">!                 &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                 &quot;ret&quot;</span>
<span class="line-removed">-             };</span>
<span class="line-removed">-         } else {</span>
<span class="line-removed">-             matches = new String[] {</span>
<span class="line-removed">-                 useCompressedOops ? &quot;ldrw?&quot; : &quot;ldr&quot;,</span>
<span class="line-removed">-                 &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                 &quot;dmb ish&quot;,</span>
<span class="line-removed">-                 &quot;ret&quot;</span>
<span class="line-removed">-             };</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
          checkCompile(iter, &quot;testObj&quot;, matches, output, true);
  
      }
  
      // check for expected asm output from a volatile store
  
<span class="line-modified">!     private void checkstore(OutputAnalyzer output, String testType, boolean useBarriersForVolatile, boolean useCompressedOops) throws Throwable</span>
      {
          Iterator&lt;String&gt; iter = output.asLines().listIterator();
  
          String[] matches;
  
          // non object stores are straightforward
<span class="line-modified">!         if (!useBarriersForVolatile) {</span>
<span class="line-modified">!             // this is the sequence of instructions for all cases</span>
              matches = new String[] {
                  &quot;membar_release \\(elided\\)&quot;,
<span class="line-modified">!                 &quot;stlrw&quot;,</span>
                  &quot;membar_volatile \\(elided\\)&quot;,
                  &quot;ret&quot;
              };
<span class="line-modified">!         } else {</span>
<span class="line-modified">!             // this is the alternative sequence of instructions</span>
              matches = new String[] {
<span class="line-modified">!                 &quot;membar_release&quot;,</span>
<span class="line-modified">!                 &quot;dmb ish&quot;,</span>
<span class="line-modified">!                 &quot;strw&quot;,</span>
                  &quot;membar_volatile&quot;,
                  &quot;dmb ish&quot;,
                  &quot;ret&quot;
              };
<span class="line-modified">!         }</span>
<span class="line-removed">- </span>
<span class="line-removed">-         checkCompile(iter, &quot;testInt&quot;, matches, output, true);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         // object stores will be as above except for when the GC</span>
<span class="line-removed">-         // introduces barriers for card marking</span>
<span class="line-removed">- </span>
<span class="line-removed">-         if (!useBarriersForVolatile) {</span>
<span class="line-removed">-             switch (testType) {</span>
<span class="line-removed">-             default:</span>
<span class="line-removed">-                 // this is the basic sequence of instructions</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;stlrw?&quot; : &quot;stlr&quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile \\(elided\\)&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;G1&quot;:</span>
<span class="line-removed">-                 // a card mark volatile barrier should be generated</span>
<span class="line-removed">-                 // before the card mark strb</span>
<span class="line-removed">-                 //</span>
<span class="line-removed">-                 // following the fix for 8225776 the G1 barrier is now</span>
<span class="line-removed">-                 // scheduled out of line after the membar volatile and</span>
<span class="line-removed">-                 // and subsequent return</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;stlrw?&quot; : &quot;stlr&quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile \\(elided\\)&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;strb&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;Shenandoah&quot;:</span>
<span class="line-removed">-             case &quot;ShenandoahIU&quot;:</span>
<span class="line-removed">-                  // Shenandoah generates normal object graphs for</span>
<span class="line-removed">-                  // volatile stores</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;stlrw?&quot; : &quot;stlr&quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile \\(elided\\)&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         } else {</span>
<span class="line-removed">-             switch (testType) {</span>
<span class="line-removed">-             default:</span>
<span class="line-removed">-                 // this is the basic sequence of instructions</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;strw?&quot; : &quot;str&quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;G1&quot;:</span>
<span class="line-removed">-                 // a card mark volatile barrier should be generated</span>
<span class="line-removed">-                 // before the card mark strb</span>
<span class="line-removed">-                 //</span>
<span class="line-removed">-                 // following the fix for 8225776 the G1 barrier is now</span>
<span class="line-removed">-                 // scheduled out of line after the membar volatile and</span>
<span class="line-removed">-                 // and subsequent return</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;strw?&quot; : &quot;str&quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;strb&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;CMSCondMark&quot;:</span>
<span class="line-removed">-                 // a card mark volatile barrier should be generated</span>
<span class="line-removed">-                 // before the card mark strb from the StoreCM and the</span>
<span class="line-removed">-                 // storestore barrier from the StoreCM should be elided</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;strw?&quot; : &quot;str&quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;storestore \\(elided\\)&quot;,</span>
<span class="line-removed">-                     &quot;strb&quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;CMS&quot;:</span>
<span class="line-removed">-                 // a volatile card mark membar should not be generated</span>
<span class="line-removed">-                 // before the card mark strb from the StoreCM and the</span>
<span class="line-removed">-                 // storestore barrier from the StoreCM should be generated</span>
<span class="line-removed">-                 // as &quot;dmb ishst&quot;</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;strw?&quot; : &quot;str&quot;,</span>
<span class="line-removed">-                     &quot;storestore&quot;,</span>
<span class="line-removed">-                     &quot;dmb ishst&quot;,</span>
<span class="line-removed">-                     &quot;strb&quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-             case &quot;Shenandoah&quot;:</span>
<span class="line-removed">-             case &quot;ShenandoahIU&quot;:</span>
<span class="line-removed">-                  // Shenandoah generates normal object graphs for</span>
<span class="line-removed">-                  // volatile stores</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;strw?&quot; : &quot;str&quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             }</span>
          }
  
          checkCompile(iter, &quot;testObj&quot;, matches, output, true);
      }
  
      // check for expected asm output from a volatile cas
  
<span class="line-modified">!     private void checkcas(OutputAnalyzer output, String testType, boolean useBarriersForVolatile, boolean useCompressedOops) throws Throwable</span>
      {
          Iterator&lt;String&gt; iter = output.asLines().listIterator();
  
          String[] matches;
          String[][] tests = {
<span class="line-new-header">--- 210,100 ---</span>
          return true;
      }
  
      // check for expected asm output from a volatile load
  
<span class="line-modified">!     private void checkload(OutputAnalyzer output, String testType, boolean useCompressedOops) throws Throwable</span>
      {
          Iterator&lt;String&gt; iter = output.asLines().listIterator();
  
          // we shoud see this same sequence for normal or unsafe volatile load
          // for both int and Object fields
  
          String[] matches;
<span class="line-modified">!         matches = new String[] {</span>
<span class="line-modified">!             &quot;ldarw&quot;,</span>
<span class="line-modified">!             &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!             &quot;ret&quot;</span>
<span class="line-modified">!         };</span>
          checkCompile(iter, &quot;testInt&quot;, matches, output, true);
  
<span class="line-modified">!         matches = new String[] {</span>
<span class="line-modified">!             useCompressedOops ? &quot;ldarw?&quot; : &quot;ldar&quot;,</span>
<span class="line-modified">!             &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!             &quot;ret&quot;</span>
<span class="line-modified">!         };</span>
          checkCompile(iter, &quot;testObj&quot;, matches, output, true);
  
      }
  
      // check for expected asm output from a volatile store
  
<span class="line-modified">!     private void checkstore(OutputAnalyzer output, String testType, boolean useCompressedOops) throws Throwable</span>
      {
          Iterator&lt;String&gt; iter = output.asLines().listIterator();
  
          String[] matches;
  
          // non object stores are straightforward
<span class="line-modified">!         // this is the sequence of instructions for all cases</span>
<span class="line-modified">!         matches = new String[] {</span>
<span class="line-added">+             &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-added">+             &quot;stlrw&quot;,</span>
<span class="line-added">+             &quot;membar_volatile \\(elided\\)&quot;,</span>
<span class="line-added">+             &quot;ret&quot;</span>
<span class="line-added">+         };</span>
<span class="line-added">+         checkCompile(iter, &quot;testInt&quot;, matches, output, true);</span>
<span class="line-added">+ </span>
<span class="line-added">+         // object stores will be as above except for when the GC</span>
<span class="line-added">+         // introduces barriers for card marking</span>
<span class="line-added">+         switch (testType) {</span>
<span class="line-added">+         default:</span>
<span class="line-added">+             // this is the basic sequence of instructions</span>
              matches = new String[] {
                  &quot;membar_release \\(elided\\)&quot;,
<span class="line-modified">!                 useCompressedOops ? &quot;stlrw?&quot; : &quot;stlr&quot;,</span>
                  &quot;membar_volatile \\(elided\\)&quot;,
                  &quot;ret&quot;
              };
<span class="line-modified">!             break;</span>
<span class="line-modified">!         case &quot;G1&quot;:</span>
<span class="line-added">+             // a card mark volatile barrier should be generated</span>
<span class="line-added">+             // before the card mark strb</span>
<span class="line-added">+             //</span>
<span class="line-added">+             // following the fix for 8225776 the G1 barrier is now</span>
<span class="line-added">+             // scheduled out of line after the membar volatile and</span>
<span class="line-added">+             // and subsequent return</span>
              matches = new String[] {
<span class="line-modified">!                 &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                 useCompressedOops ? &quot;stlrw?&quot; : &quot;stlr&quot;,</span>
<span class="line-modified">!                 &quot;membar_volatile \\(elided\\)&quot;,</span>
<span class="line-added">+                 &quot;ret&quot;,</span>
                  &quot;membar_volatile&quot;,
                  &quot;dmb ish&quot;,
<span class="line-added">+                 &quot;strb&quot;</span>
<span class="line-added">+             };</span>
<span class="line-added">+             break;</span>
<span class="line-added">+         case &quot;Shenandoah&quot;:</span>
<span class="line-added">+         case &quot;ShenandoahIU&quot;:</span>
<span class="line-added">+              // Shenandoah generates normal object graphs for</span>
<span class="line-added">+              // volatile stores</span>
<span class="line-added">+             matches = new String[] {</span>
<span class="line-added">+                 &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-added">+                 useCompressedOops ? &quot;stlrw?&quot; : &quot;stlr&quot;,</span>
<span class="line-added">+                 &quot;membar_volatile \\(elided\\)&quot;,</span>
                  &quot;ret&quot;
              };
<span class="line-modified">!             break;</span>
          }
  
          checkCompile(iter, &quot;testObj&quot;, matches, output, true);
      }
  
      // check for expected asm output from a volatile cas
  
<span class="line-modified">!     private void checkcas(OutputAnalyzer output, String testType, boolean useCompressedOops) throws Throwable</span>
      {
          Iterator&lt;String&gt; iter = output.asLines().listIterator();
  
          String[] matches;
          String[][] tests = {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 442,163 ***</span>
              { &quot;testShort&quot;, &quot;cmpxchgs&quot; },
          };
  
          for (String[] test : tests) {
              // non object stores are straightforward
<span class="line-modified">!             if (!useBarriersForVolatile) {</span>
<span class="line-modified">!                 // this is the sequence of instructions for all cases</span>
<span class="line-modified">!                 matches = new String[] {</span>
<span class="line-modified">!                     &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                     test[1] + &quot;_acq&quot;,</span>
<span class="line-modified">!                     &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-             } else {</span>
<span class="line-removed">-                 // this is the alternative sequence of instructions</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     test[1] + &quot; &quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-             }</span>
<span class="line-removed">- </span>
              checkCompile(iter, test[0], matches, output, true);
          }
  
          // object stores will be as above except for when the GC
          // introduces barriers for card marking
<span class="line-modified">! </span>
<span class="line-modified">!         if (!useBarriersForVolatile) {</span>
<span class="line-modified">!             switch (testType) {</span>
<span class="line-modified">!             default:</span>
<span class="line-modified">!                 // this is the basic sequence of instructions</span>
<span class="line-modified">!                 matches = new String[] {</span>
<span class="line-modified">!                     &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                     useCompressedOops ? &quot;cmpxchgw?_acq&quot; : &quot;cmpxchg_acq&quot;,</span>
<span class="line-modified">!                     &quot;strb&quot;,</span>
<span class="line-modified">!                     &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                     &quot;ret&quot;</span>
<span class="line-modified">!                 };</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!             case &quot;G1&quot;:</span>
<span class="line-modified">!                 // a card mark volatile barrier should be generated</span>
<span class="line-modified">!                 // before the card mark strb</span>
<span class="line-modified">!                 //</span>
<span class="line-modified">!                 // following the fix for 8225776 the G1 barrier is now</span>
<span class="line-modified">!                 // scheduled out of line after the membar acquire and</span>
<span class="line-modified">!                 // and subsequent return</span>
<span class="line-modified">!                 matches = new String[] {</span>
<span class="line-modified">!                     &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                     useCompressedOops ? &quot;cmpxchgw?_acq&quot; : &quot;cmpxchg_acq&quot;,</span>
<span class="line-modified">!                     &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                     &quot;ret&quot;,</span>
<span class="line-modified">!                     &quot;membar_volatile&quot;,</span>
<span class="line-modified">!                     &quot;dmb ish&quot;,</span>
<span class="line-modified">!                     &quot;strb&quot;</span>
<span class="line-modified">!                 };</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!             case &quot;Shenandoah&quot;:</span>
<span class="line-modified">!             case &quot;ShenandoahIU&quot;:</span>
<span class="line-modified">!                 // For volatile CAS, Shenanodoah generates normal</span>
<span class="line-modified">!                 // graphs with a shenandoah-specific cmpxchg</span>
<span class="line-modified">!                 matches = new String[] {</span>
<span class="line-modified">!                     &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                     useCompressedOops ? &quot;cmpxchgw?_acq_shenandoah&quot; : &quot;cmpxchg_acq_shenandoah&quot;,</span>
<span class="line-modified">!                     &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         } else {</span>
<span class="line-removed">-             switch (testType) {</span>
<span class="line-removed">-             default:</span>
<span class="line-removed">-                 // this is the basic sequence of instructions</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;cmpxchgw? &quot; : &quot;cmpxchg &quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;G1&quot;:</span>
<span class="line-removed">-                 // a card mark volatile barrier should be generated</span>
<span class="line-removed">-                 // before the card mark strb</span>
<span class="line-removed">-                 //</span>
<span class="line-removed">-                 // following the fix for 8225776 the G1 barrier is now</span>
<span class="line-removed">-                 // scheduled out of line after the membar acquire and</span>
<span class="line-removed">-                 // and subsequent return</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;cmpxchgw? &quot; : &quot;cmpxchg &quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;strb&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;CMSCondMark&quot;:</span>
<span class="line-removed">-                 // a card mark volatile barrier should be generated</span>
<span class="line-removed">-                 // before the card mark strb from the StoreCM and the</span>
<span class="line-removed">-                 // storestore barrier from the StoreCM should be elided</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;cmpxchgw? &quot; : &quot;cmpxchg &quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;storestore \\(elided\\)&quot;,</span>
<span class="line-removed">-                     &quot;strb&quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;CMS&quot;:</span>
<span class="line-removed">-                 // a volatile card mark membar should not be generated</span>
<span class="line-removed">-                 // before the card mark strb from the StoreCM and the</span>
<span class="line-removed">-                 // storestore barrier from the StoreCM should be generated</span>
<span class="line-removed">-                 // as &quot;dmb ishst&quot;</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;cmpxchgw? &quot; : &quot;cmpxchg &quot;,</span>
<span class="line-removed">-                     &quot;storestore&quot;,</span>
<span class="line-removed">-                     &quot;dmb ishst&quot;,</span>
<span class="line-removed">-                     &quot;strb&quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;Shenandoah&quot;:</span>
<span class="line-removed">-             case &quot;ShenandoahIU&quot;:</span>
<span class="line-removed">-                 // For volatile CAS, Shenanodoah generates normal</span>
<span class="line-removed">-                 // graphs with a shenandoah-specific cmpxchg</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;cmpxchgw?_shenandoah&quot; : &quot;cmpxchg_shenandoah&quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             }</span>
          }
<span class="line-removed">- </span>
          checkCompile(iter, &quot;testObj&quot;, matches, output, true);
      }
  
<span class="line-modified">!     private void checkcae(OutputAnalyzer output, String testType, boolean useBarriersForVolatile, boolean useCompressedOops) throws Throwable</span>
      {
          ListIterator&lt;String&gt; iter = output.asLines().listIterator();
  
          String[] matches;
          String[][] tests = {
<span class="line-new-header">--- 313,66 ---</span>
              { &quot;testShort&quot;, &quot;cmpxchgs&quot; },
          };
  
          for (String[] test : tests) {
              // non object stores are straightforward
<span class="line-modified">!             // this is the sequence of instructions for all cases</span>
<span class="line-modified">!             matches = new String[] {</span>
<span class="line-modified">!                 &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                 test[1] + &quot;_acq&quot;,</span>
<span class="line-modified">!                 &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                 &quot;ret&quot;</span>
<span class="line-modified">!             };</span>
              checkCompile(iter, test[0], matches, output, true);
          }
  
          // object stores will be as above except for when the GC
          // introduces barriers for card marking
<span class="line-modified">!         switch (testType) {</span>
<span class="line-modified">!         default:</span>
<span class="line-modified">!             // this is the basic sequence of instructions</span>
<span class="line-modified">!             matches = new String[] {</span>
<span class="line-modified">!                 &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                 useCompressedOops ? &quot;cmpxchgw?_acq&quot; : &quot;cmpxchg_acq&quot;,</span>
<span class="line-modified">!                 &quot;strb&quot;,</span>
<span class="line-modified">!                 &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                 &quot;ret&quot;</span>
<span class="line-modified">!             };</span>
<span class="line-modified">!             break;</span>
<span class="line-modified">!         case &quot;G1&quot;:</span>
<span class="line-modified">!             // a card mark volatile barrier should be generated</span>
<span class="line-modified">!             // before the card mark strb</span>
<span class="line-modified">!             //</span>
<span class="line-modified">!             // following the fix for 8225776 the G1 barrier is now</span>
<span class="line-modified">!             // scheduled out of line after the membar acquire and</span>
<span class="line-modified">!             // and subsequent return</span>
<span class="line-modified">!             matches = new String[] {</span>
<span class="line-modified">!                 &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                 useCompressedOops ? &quot;cmpxchgw?_acq&quot; : &quot;cmpxchg_acq&quot;,</span>
<span class="line-modified">!                 &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                 &quot;ret&quot;,</span>
<span class="line-modified">!                 &quot;membar_volatile&quot;,</span>
<span class="line-modified">!                 &quot;dmb ish&quot;,</span>
<span class="line-modified">!                 &quot;strb&quot;</span>
<span class="line-modified">!             };</span>
<span class="line-modified">!             break;</span>
<span class="line-modified">!         case &quot;Shenandoah&quot;:</span>
<span class="line-modified">!         case &quot;ShenandoahIU&quot;:</span>
<span class="line-modified">!             // For volatile CAS, Shenanodoah generates normal</span>
<span class="line-modified">!             // graphs with a shenandoah-specific cmpxchg</span>
<span class="line-modified">!             matches = new String[] {</span>
<span class="line-modified">!                 &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                 useCompressedOops ? &quot;cmpxchgw?_acq_shenandoah&quot; : &quot;cmpxchg_acq_shenandoah&quot;,</span>
<span class="line-modified">!                 &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                 &quot;ret&quot;</span>
<span class="line-modified">!             };</span>
<span class="line-modified">!             break;</span>
          }
          checkCompile(iter, &quot;testObj&quot;, matches, output, true);
      }
  
<span class="line-modified">!     private void checkcae(OutputAnalyzer output, String testType, boolean useCompressedOops) throws Throwable</span>
      {
          ListIterator&lt;String&gt; iter = output.asLines().listIterator();
  
          String[] matches;
          String[][] tests = {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 608,181 ***</span>
              { &quot;testShort&quot;, &quot;cmpxchgs&quot; },
          };
  
          for (String[] test : tests) {
              // non object stores are straightforward
<span class="line-modified">!             if (!useBarriersForVolatile) {</span>
<span class="line-modified">!                 // this is the sequence of instructions for all cases</span>
<span class="line-modified">!                 matches = new String[] {</span>
<span class="line-modified">!                     &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                     test[1] + &quot;_acq&quot;,</span>
<span class="line-modified">!                     &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-             } else {</span>
<span class="line-removed">-                 // this is the alternative sequence of instructions</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     test[1] + &quot; &quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-             }</span>
<span class="line-removed">- </span>
              checkCompile(iter, test[0], matches, output, true);
          }
  
          // object stores will be as above except for when the GC
          // introduces barriers for card marking
  
<span class="line-modified">!         if (!useBarriersForVolatile) {</span>
<span class="line-modified">!             switch (testType) {</span>
<span class="line-modified">!             default:</span>
<span class="line-modified">!                 // this is the basic sequence of instructions</span>
<span class="line-modified">!                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-removed">-                     &quot;strb&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;cmpxchgw?_acq&quot; : &quot;cmpxchg_acq&quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
  
<span class="line-removed">-                 // card marking store may be scheduled before or after</span>
<span class="line-removed">-                 // the cmpxchg so try both sequences.</span>
<span class="line-removed">-                 int idx = iter.nextIndex();</span>
<span class="line-removed">-                 if (!checkCompile(iter, &quot;testObj&quot;, matches, output, false)) {</span>
<span class="line-removed">-                     iter = output.asLines().listIterator(idx);</span>
<span class="line-removed">- </span>
<span class="line-removed">-                     matches = new String[] {</span>
<span class="line-removed">-                         &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-removed">-                         useCompressedOops ? &quot;cmpxchgw?_acq&quot; : &quot;cmpxchg_acq&quot;,</span>
<span class="line-removed">-                         &quot;strb&quot;,</span>
<span class="line-removed">-                         &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-removed">-                         &quot;ret&quot;</span>
<span class="line-removed">-                     };</span>
<span class="line-removed">- </span>
<span class="line-removed">-                     checkCompile(iter, &quot;testObj&quot;, matches, output, true);</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-                 return;</span>
<span class="line-removed">- </span>
<span class="line-removed">-             case &quot;G1&quot;:</span>
<span class="line-removed">-                 // a card mark volatile barrier should be generated</span>
<span class="line-removed">-                 // before the card mark strb</span>
<span class="line-removed">-                 //</span>
<span class="line-removed">-                 // following the fix for 8225776 the G1 barrier is now</span>
<span class="line-removed">-                 // scheduled out of line after the membar acquire and</span>
<span class="line-removed">-                 // and subsequent return</span>
                  matches = new String[] {
                      &quot;membar_release \\(elided\\)&quot;,
                      useCompressedOops ? &quot;cmpxchgw?_acq&quot; : &quot;cmpxchg_acq&quot;,
<span class="line-removed">-                     &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;strb&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;Shenandoah&quot;:</span>
<span class="line-removed">-             case &quot;ShenandoahIU&quot;:</span>
<span class="line-removed">-                 // For volatile CAS, Shenanodoah generates normal</span>
<span class="line-removed">-                 // graphs with a shenandoah-specific cmpxchg</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;cmpxchgw?_acq_shenandoah&quot; : &quot;cmpxchg_acq_shenandoah&quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         } else {</span>
<span class="line-removed">-             switch (testType) {</span>
<span class="line-removed">-             default:</span>
<span class="line-removed">-                 // this is the basic sequence of instructions</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;cmpxchgw? &quot; : &quot;cmpxchg &quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;G1&quot;:</span>
<span class="line-removed">-                 // a card mark volatile barrier should be generated</span>
<span class="line-removed">-                 // before the card mark strb</span>
<span class="line-removed">-                 //</span>
<span class="line-removed">-                 // following the fix for 8225776 the G1 barrier is now</span>
<span class="line-removed">-                 // scheduled out of line after the membar acquire and</span>
<span class="line-removed">-                 // and subsequent return</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;cmpxchgw? &quot; : &quot;cmpxchg &quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;strb&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;CMSCondMark&quot;:</span>
<span class="line-removed">-                 // a card mark volatile barrier should be generated</span>
<span class="line-removed">-                 // before the card mark strb from the StoreCM and the</span>
<span class="line-removed">-                 // storestore barrier from the StoreCM should be elided</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;cmpxchgw? &quot; : &quot;cmpxchg &quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;storestore \\(elided\\)&quot;,</span>
                      &quot;strb&quot;,
<span class="line-modified">!                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;CMS&quot;:</span>
<span class="line-removed">-                 // a volatile card mark membar should not be generated</span>
<span class="line-removed">-                 // before the card mark strb from the StoreCM and the</span>
<span class="line-removed">-                 // storestore barrier from the StoreCM should be generated</span>
<span class="line-removed">-                 // as &quot;dmb ishst&quot;</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;cmpxchgw? &quot; : &quot;cmpxchg &quot;,</span>
<span class="line-removed">-                     &quot;storestore&quot;,</span>
<span class="line-removed">-                     &quot;dmb ishst&quot;,</span>
<span class="line-removed">-                     &quot;strb&quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;Shenandoah&quot;:</span>
<span class="line-removed">-             case &quot;ShenandoahIU&quot;:</span>
<span class="line-removed">-                 // For volatile CAS, Shenanodoah generates normal</span>
<span class="line-removed">-                 // graphs with a shenandoah-specific cmpxchg</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;cmpxchgw?_shenandoah&quot; : &quot;cmpxchg_shenandoah&quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
                      &quot;ret&quot;
                  };
<span class="line-modified">!                 break;</span>
              }
<span class="line-modified">!         }</span>
  
          checkCompile(iter, &quot;testObj&quot;, matches, output, true);
      }
  
<span class="line-modified">!     private void checkgas(OutputAnalyzer output, String testType, boolean useBarriersForVolatile, boolean useCompressedOops) throws Throwable</span>
      {
          Iterator&lt;String&gt; iter = output.asLines().listIterator();
  
          String[] matches;
          String[][] tests = {
<span class="line-new-header">--- 382,84 ---</span>
              { &quot;testShort&quot;, &quot;cmpxchgs&quot; },
          };
  
          for (String[] test : tests) {
              // non object stores are straightforward
<span class="line-modified">!             // this is the sequence of instructions for all cases</span>
<span class="line-modified">!             matches = new String[] {</span>
<span class="line-modified">!                 &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                 test[1] + &quot;_acq&quot;,</span>
<span class="line-modified">!                 &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                 &quot;ret&quot;</span>
<span class="line-modified">!             };</span>
              checkCompile(iter, test[0], matches, output, true);
          }
  
          // object stores will be as above except for when the GC
          // introduces barriers for card marking
<span class="line-added">+         switch (testType) {</span>
<span class="line-added">+         default:</span>
<span class="line-added">+             // this is the basic sequence of instructions</span>
<span class="line-added">+             matches = new String[] {</span>
<span class="line-added">+                 &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-added">+                 &quot;strb&quot;,</span>
<span class="line-added">+                 useCompressedOops ? &quot;cmpxchgw?_acq&quot; : &quot;cmpxchg_acq&quot;,</span>
<span class="line-added">+                 &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-added">+                 &quot;ret&quot;</span>
<span class="line-added">+             };</span>
  
<span class="line-modified">!             // card marking store may be scheduled before or after</span>
<span class="line-modified">!             // the cmpxchg so try both sequences.</span>
<span class="line-modified">!             int idx = iter.nextIndex();</span>
<span class="line-modified">!             if (!checkCompile(iter, &quot;testObj&quot;, matches, output, false)) {</span>
<span class="line-modified">!                 iter = output.asLines().listIterator(idx);</span>
  
                  matches = new String[] {
                      &quot;membar_release \\(elided\\)&quot;,
                      useCompressedOops ? &quot;cmpxchgw?_acq&quot; : &quot;cmpxchg_acq&quot;,
                      &quot;strb&quot;,
<span class="line-modified">!                     &quot;membar_acquire \\(elided\\)&quot;,</span>
                      &quot;ret&quot;
                  };
<span class="line-modified">! </span>
<span class="line-added">+                 checkCompile(iter, &quot;testObj&quot;, matches, output, true);</span>
              }
<span class="line-modified">!             return;</span>
  
<span class="line-added">+         case &quot;G1&quot;:</span>
<span class="line-added">+             // a card mark volatile barrier should be generated</span>
<span class="line-added">+             // before the card mark strb</span>
<span class="line-added">+             //</span>
<span class="line-added">+             // following the fix for 8225776 the G1 barrier is now</span>
<span class="line-added">+             // scheduled out of line after the membar acquire and</span>
<span class="line-added">+             // and subsequent return</span>
<span class="line-added">+             matches = new String[] {</span>
<span class="line-added">+                 &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-added">+                 useCompressedOops ? &quot;cmpxchgw?_acq&quot; : &quot;cmpxchg_acq&quot;,</span>
<span class="line-added">+                 &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-added">+                 &quot;ret&quot;,</span>
<span class="line-added">+                 &quot;membar_volatile&quot;,</span>
<span class="line-added">+                 &quot;dmb ish&quot;,</span>
<span class="line-added">+                 &quot;strb&quot;</span>
<span class="line-added">+             };</span>
<span class="line-added">+             break;</span>
<span class="line-added">+         case &quot;Shenandoah&quot;:</span>
<span class="line-added">+         case &quot;ShenandoahIU&quot;:</span>
<span class="line-added">+             // For volatile CAS, Shenanodoah generates normal</span>
<span class="line-added">+             // graphs with a shenandoah-specific cmpxchg</span>
<span class="line-added">+             matches = new String[] {</span>
<span class="line-added">+                 &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-added">+                 useCompressedOops ? &quot;cmpxchgw?_acq_shenandoah&quot; : &quot;cmpxchg_acq_shenandoah&quot;,</span>
<span class="line-added">+                 &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-added">+                 &quot;ret&quot;</span>
<span class="line-added">+             };</span>
<span class="line-added">+             break;</span>
<span class="line-added">+         }</span>
          checkCompile(iter, &quot;testObj&quot;, matches, output, true);
      }
  
<span class="line-modified">!     private void checkgas(OutputAnalyzer output, String testType, boolean useCompressedOops) throws Throwable</span>
      {
          Iterator&lt;String&gt; iter = output.asLines().listIterator();
  
          String[] matches;
          String[][] tests = {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 790,159 ***</span>
              { &quot;testLong&quot;, &quot;atomic_xchg&quot; },
          };
  
          for (String[] test : tests) {
              // non object stores are straightforward
<span class="line-modified">!             if (!useBarriersForVolatile) {</span>
<span class="line-modified">!                 // this is the sequence of instructions for all cases</span>
<span class="line-modified">!                 matches = new String[] {</span>
<span class="line-modified">!                     &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                     test[1] + &quot;_acq&quot;,</span>
<span class="line-modified">!                     &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-             } else {</span>
<span class="line-removed">-                 // this is the alternative sequence of instructions</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     test[1] + &quot; &quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-             }</span>
<span class="line-removed">- </span>
              checkCompile(iter, test[0], matches, output, true);
          }
  
          // object stores will be as above except for when the GC
          // introduces barriers for card marking
<span class="line-modified">! </span>
<span class="line-modified">!         if (!useBarriersForVolatile) {</span>
<span class="line-modified">!             switch (testType) {</span>
<span class="line-modified">!             default:</span>
<span class="line-modified">!                 // this is the basic sequence of instructions</span>
<span class="line-modified">!                 matches = new String[] {</span>
<span class="line-modified">!                     &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                     useCompressedOops ? &quot;atomic_xchgw?_acq&quot; : &quot;atomic_xchg_acq&quot;,</span>
<span class="line-modified">!                     &quot;strb&quot;,</span>
<span class="line-modified">!                     &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                     &quot;ret&quot;</span>
<span class="line-modified">!                 };</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!             case &quot;G1&quot;:</span>
<span class="line-modified">!                 // a card mark volatile barrier should be generated</span>
<span class="line-modified">!                 // before the card mark strb</span>
<span class="line-modified">!                 //</span>
<span class="line-modified">!                 // following the fix for 8225776 the G1 barrier is now</span>
<span class="line-modified">!                 // scheduled out of line after the membar acquire and</span>
<span class="line-modified">!                 // and subsequent return</span>
<span class="line-modified">!                 matches = new String[] {</span>
<span class="line-modified">!                     &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                     useCompressedOops ? &quot;atomic_xchgw?_acq&quot; : &quot;atomic_xchg_acq&quot;,</span>
<span class="line-modified">!                     &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                     &quot;ret&quot;,</span>
<span class="line-modified">!                     &quot;membar_volatile&quot;,</span>
<span class="line-modified">!                     &quot;dmb ish&quot;,</span>
<span class="line-modified">!                     &quot;strb&quot;</span>
<span class="line-modified">!                 };</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!             case &quot;Shenandoah&quot;:</span>
<span class="line-modified">!             case &quot;ShenandoahIU&quot;:</span>
<span class="line-modified">!                 matches = new String[] {</span>
<span class="line-modified">!                     &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                     useCompressedOops ? &quot;atomic_xchgw?_acq&quot; : &quot;atomic_xchg_acq&quot;,</span>
<span class="line-modified">!                     &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         } else {</span>
<span class="line-removed">-             switch (testType) {</span>
<span class="line-removed">-             default:</span>
<span class="line-removed">-                 // this is the basic sequence of instructions</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;atomic_xchgw? &quot; : &quot;atomic_xchg &quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;G1&quot;:</span>
<span class="line-removed">-                 // a card mark volatile barrier should be generated</span>
<span class="line-removed">-                 // before the card mark strb</span>
<span class="line-removed">-                 //</span>
<span class="line-removed">-                 // following the fix for 8225776 the G1 barrier is now</span>
<span class="line-removed">-                 // scheduled out of line after the membar acquire and</span>
<span class="line-removed">-                 // and subsequent return</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;atomic_xchgw? &quot; : &quot;atomic_xchg &quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;strb&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;CMSCondMark&quot;:</span>
<span class="line-removed">-                 // a card mark volatile barrier should be generated</span>
<span class="line-removed">-                 // before the card mark strb from the StoreCM and the</span>
<span class="line-removed">-                 // storestore barrier from the StoreCM should be elided</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;atomic_xchgw? &quot; : &quot;atomic_xchg &quot;,</span>
<span class="line-removed">-                     &quot;membar_volatile&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;storestore \\(elided\\)&quot;,</span>
<span class="line-removed">-                     &quot;strb&quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;CMS&quot;:</span>
<span class="line-removed">-                 // a volatile card mark membar should not be generated</span>
<span class="line-removed">-                 // before the card mark strb from the StoreCM and the</span>
<span class="line-removed">-                 // storestore barrier from the StoreCM should be generated</span>
<span class="line-removed">-                 // as &quot;dmb ishst&quot;</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;atomic_xchgw? &quot; : &quot;atomic_xchg &quot;,</span>
<span class="line-removed">-                     &quot;storestore&quot;,</span>
<span class="line-removed">-                     &quot;dmb ishst&quot;,</span>
<span class="line-removed">-                     &quot;strb&quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             case &quot;Shenandoah&quot;:</span>
<span class="line-removed">-             case &quot;ShenandoahIU&quot;:</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     useCompressedOops ? &quot;atomic_xchgw? &quot; : &quot;atomic_xchg &quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             }</span>
          }
  
          checkCompile(iter, &quot;testObj&quot;, matches, output, true);
      }
  
<span class="line-modified">!     private void checkgaa(OutputAnalyzer output, String testType, boolean useBarriersForVolatile) throws Throwable</span>
      {
          Iterator&lt;String&gt; iter = output.asLines().listIterator();
  
          String[] matches;
          String[][] tests = {
<span class="line-new-header">--- 467,65 ---</span>
              { &quot;testLong&quot;, &quot;atomic_xchg&quot; },
          };
  
          for (String[] test : tests) {
              // non object stores are straightforward
<span class="line-modified">!             // this is the sequence of instructions for all cases</span>
<span class="line-modified">!             matches = new String[] {</span>
<span class="line-modified">!                 &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                 test[1] + &quot;_acq&quot;,</span>
<span class="line-modified">!                 &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                 &quot;ret&quot;</span>
<span class="line-modified">!             };</span>
              checkCompile(iter, test[0], matches, output, true);
          }
  
          // object stores will be as above except for when the GC
          // introduces barriers for card marking
<span class="line-modified">!         switch (testType) {</span>
<span class="line-modified">!         default:</span>
<span class="line-modified">!             // this is the basic sequence of instructions</span>
<span class="line-modified">!             matches = new String[] {</span>
<span class="line-modified">!                 &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                 useCompressedOops ? &quot;atomic_xchgw?_acq&quot; : &quot;atomic_xchg_acq&quot;,</span>
<span class="line-modified">!                 &quot;strb&quot;,</span>
<span class="line-modified">!                 &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                 &quot;ret&quot;</span>
<span class="line-modified">!             };</span>
<span class="line-modified">!             break;</span>
<span class="line-modified">!         case &quot;G1&quot;:</span>
<span class="line-modified">!             // a card mark volatile barrier should be generated</span>
<span class="line-modified">!             // before the card mark strb</span>
<span class="line-modified">!             //</span>
<span class="line-modified">!             // following the fix for 8225776 the G1 barrier is now</span>
<span class="line-modified">!             // scheduled out of line after the membar acquire and</span>
<span class="line-modified">!             // and subsequent return</span>
<span class="line-modified">!             matches = new String[] {</span>
<span class="line-modified">!                 &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                 useCompressedOops ? &quot;atomic_xchgw?_acq&quot; : &quot;atomic_xchg_acq&quot;,</span>
<span class="line-modified">!                 &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                 &quot;ret&quot;,</span>
<span class="line-modified">!                 &quot;membar_volatile&quot;,</span>
<span class="line-modified">!                 &quot;dmb ish&quot;,</span>
<span class="line-modified">!                 &quot;strb&quot;</span>
<span class="line-modified">!             };</span>
<span class="line-modified">!             break;</span>
<span class="line-modified">!         case &quot;Shenandoah&quot;:</span>
<span class="line-modified">!         case &quot;ShenandoahIU&quot;:</span>
<span class="line-modified">!             matches = new String[] {</span>
<span class="line-modified">!                 &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                 useCompressedOops ? &quot;atomic_xchgw?_acq&quot; : &quot;atomic_xchg_acq&quot;,</span>
<span class="line-modified">!                 &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                 &quot;ret&quot;</span>
<span class="line-modified">!             };</span>
<span class="line-modified">!             break;</span>
          }
  
          checkCompile(iter, &quot;testObj&quot;, matches, output, true);
      }
  
<span class="line-modified">!     private void checkgaa(OutputAnalyzer output, String testType) throws Throwable</span>
      {
          Iterator&lt;String&gt; iter = output.asLines().listIterator();
  
          String[] matches;
          String[][] tests = {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 950,70 ***</span>
              { &quot;testLong&quot;, &quot;get_and_addL&quot; },
          };
  
          for (String[] test : tests) {
              // non object stores are straightforward
<span class="line-modified">!             if (!useBarriersForVolatile) {</span>
<span class="line-modified">!                 // this is the sequence of instructions for all cases</span>
<span class="line-modified">!                 matches = new String[] {</span>
<span class="line-modified">!                     &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                     test[1] + &quot;_acq&quot;,</span>
<span class="line-modified">!                     &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-             } else {</span>
<span class="line-removed">-                 // this is the alternative sequence of instructions</span>
<span class="line-removed">-                 matches = new String[] {</span>
<span class="line-removed">-                     &quot;membar_release&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     test[1] + &quot; &quot;,</span>
<span class="line-removed">-                     &quot;membar_acquire&quot;,</span>
<span class="line-removed">-                     &quot;dmb ish&quot;,</span>
<span class="line-removed">-                     &quot;ret&quot;</span>
<span class="line-removed">-                 };</span>
<span class="line-removed">-             }</span>
<span class="line-removed">- </span>
              checkCompile(iter, test[0], matches, output, true);
          }
  
      }
  
      // perform a check appropriate to the classname
  
<span class="line-modified">!     private void checkoutput(OutputAnalyzer output, String classname, String testType, boolean useBarriersForVolatile, boolean useCompressedOops) throws Throwable</span>
      {
          // trace call to allow eyeball check of what is being checked
          System.out.println(&quot;checkoutput(&quot; +
                             classname + &quot;, &quot; +
<span class="line-modified">!                            testType + &quot;, &quot; +</span>
<span class="line-removed">-                            useBarriersForVolatile + &quot;)\n&quot; +</span>
                             output.getOutput());
  
          switch (classname) {
          case &quot;TestVolatileLoad&quot;:
<span class="line-modified">!             checkload(output, testType, useBarriersForVolatile, useCompressedOops);</span>
              break;
          case &quot;TestVolatileStore&quot;:
<span class="line-modified">!             checkstore(output, testType, useBarriersForVolatile, useCompressedOops);</span>
              break;
          case &quot;TestUnsafeVolatileLoad&quot;:
<span class="line-modified">!             checkload(output, testType, useBarriersForVolatile, useCompressedOops);</span>
              break;
          case &quot;TestUnsafeVolatileStore&quot;:
<span class="line-modified">!             checkstore(output, testType, useBarriersForVolatile, useCompressedOops);</span>
              break;
          case &quot;TestUnsafeVolatileCAS&quot;:
          case &quot;TestUnsafeVolatileWeakCAS&quot;:
<span class="line-modified">!             checkcas(output, testType, useBarriersForVolatile, useCompressedOops);</span>
              break;
          case &quot;TestUnsafeVolatileCAE&quot;:
<span class="line-modified">!             checkcae(output, testType, useBarriersForVolatile, useCompressedOops);</span>
              break;
          case &quot;TestUnsafeVolatileGAS&quot;:
<span class="line-modified">!             checkgas(output, testType, useBarriersForVolatile, useCompressedOops);</span>
              break;
          case &quot;TestUnsafeVolatileGAA&quot;:
<span class="line-modified">!             checkgaa(output, testType, useBarriersForVolatile);</span>
              break;
          }
      }
  }
<span class="line-new-header">--- 533,56 ---</span>
              { &quot;testLong&quot;, &quot;get_and_addL&quot; },
          };
  
          for (String[] test : tests) {
              // non object stores are straightforward
<span class="line-modified">!             // this is the sequence of instructions for all cases</span>
<span class="line-modified">!             matches = new String[] {</span>
<span class="line-modified">!                 &quot;membar_release \\(elided\\)&quot;,</span>
<span class="line-modified">!                 test[1] + &quot;_acq&quot;,</span>
<span class="line-modified">!                 &quot;membar_acquire \\(elided\\)&quot;,</span>
<span class="line-modified">!                 &quot;ret&quot;</span>
<span class="line-modified">!             };</span>
              checkCompile(iter, test[0], matches, output, true);
          }
  
      }
  
      // perform a check appropriate to the classname
  
<span class="line-modified">!     private void checkoutput(OutputAnalyzer output, String classname, String testType, boolean useCompressedOops) throws Throwable</span>
      {
          // trace call to allow eyeball check of what is being checked
          System.out.println(&quot;checkoutput(&quot; +
                             classname + &quot;, &quot; +
<span class="line-modified">!                            testType + &quot;)\n&quot; +</span>
                             output.getOutput());
  
          switch (classname) {
          case &quot;TestVolatileLoad&quot;:
<span class="line-modified">!             checkload(output, testType, useCompressedOops);</span>
              break;
          case &quot;TestVolatileStore&quot;:
<span class="line-modified">!             checkstore(output, testType, useCompressedOops);</span>
              break;
          case &quot;TestUnsafeVolatileLoad&quot;:
<span class="line-modified">!             checkload(output, testType, useCompressedOops);</span>
              break;
          case &quot;TestUnsafeVolatileStore&quot;:
<span class="line-modified">!             checkstore(output, testType, useCompressedOops);</span>
              break;
          case &quot;TestUnsafeVolatileCAS&quot;:
          case &quot;TestUnsafeVolatileWeakCAS&quot;:
<span class="line-modified">!             checkcas(output, testType, useCompressedOops);</span>
              break;
          case &quot;TestUnsafeVolatileCAE&quot;:
<span class="line-modified">!             checkcae(output, testType, useCompressedOops);</span>
              break;
          case &quot;TestUnsafeVolatileGAS&quot;:
<span class="line-modified">!             checkgas(output, testType, useCompressedOops);</span>
              break;
          case &quot;TestUnsafeVolatileGAA&quot;:
<span class="line-modified">!             checkgaa(output, testType);</span>
              break;
          }
      }
  }
</pre>
<center><a href="../../../ProblemList.txt.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../jvmci/events/JvmciNotifyBootstrapFinishedEventTest.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>