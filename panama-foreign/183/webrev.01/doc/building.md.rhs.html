<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames doc/building.md</title>
    <link rel="stylesheet" href="../style.css" />
    <script type="text/javascript" src="../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 % Building the JDK
   2 
   3 ## TL;DR (Instructions for the Impatient)
   4 
   5 If you are eager to try out building the JDK, these simple steps works most of
   6 the time. They assume that you have installed Mercurial (and Cygwin if running
   7 on Windows) and cloned the top-level JDK repository that you want to build.
   8 
   9  1. [Get the complete source code](#getting-the-source-code): \
  10     `hg clone http://hg.openjdk.java.net/jdk/jdk`
  11 
  12  2. [Run configure](#running-configure): \
  13     `bash configure`
  14 
  15     If `configure` fails due to missing dependencies (to either the
  16     [toolchain](#native-compiler-toolchain-requirements), [build tools](
  17     #build-tools-requirements), [external libraries](
  18     #external-library-requirements) or the [boot JDK](#boot-jdk-requirements)),
  19     most of the time it prints a suggestion on how to resolve the situation on
  20     your platform. Follow the instructions, and try running `bash configure`
  21     again.
  22 
  23  3. [Run make](#running-make): \
  24     `make images`
  25 
  26  4. Verify your newly built JDK: \
  27     `./build/*/images/jdk/bin/java -version`
  28 
  29  5. [Run basic tests](##running-tests): \
  30     `make run-test-tier1`
  31 
  32 If any of these steps failed, or if you want to know more about build
  33 requirements or build functionality, please continue reading this document.
  34 
  35 ## Introduction
  36 
  37 The JDK is a complex software project. Building it requires a certain amount of
  38 technical expertise, a fair number of dependencies on external software, and
  39 reasonably powerful hardware.
  40 
  41 If you just want to use the JDK and not build it yourself, this document is not
  42 for you. See for instance [OpenJDK installation](
  43 http://openjdk.java.net/install) for some methods of installing a prebuilt
  44 JDK.
  45 
  46 ## Getting the Source Code
  47 
  48 Make sure you are getting the correct version. As of JDK 10, the source is no
  49 longer split into separate repositories so you only need to clone one single
  50 repository. At the [OpenJDK Mercurial server](http://hg.openjdk.java.net/) you
  51 can see a list of all available repositories. If you want to build an older version,
  52 e.g. JDK 8, it is recommended that you get the `jdk8u` forest, which contains
  53 incremental updates, instead of the `jdk8` forest, which was frozen at JDK 8 GA.
  54 
  55 If you are new to Mercurial, a good place to start is the [Mercurial Beginner&#39;s
  56 Guide](http://www.mercurial-scm.org/guide). The rest of this document assumes a
  57 working knowledge of Mercurial.
  58 
  59 ### Special Considerations
  60 
  61 For a smooth building experience, it is recommended that you follow these rules
  62 on where and how to check out the source code.
  63 
  64   * Do not check out the source code in a path which contains spaces. Chances
  65     are the build will not work. This is most likely to be an issue on Windows
  66     systems.
  67 
  68   * Do not check out the source code in a path which has a very long name or is
  69     nested many levels deep. Chances are you will hit an OS limitation during
  70     the build.
  71 
  72   * Put the source code on a local disk, not a network share. If possible, use
  73     an SSD. The build process is very disk intensive, and having slow disk
  74     access will significantly increase build times. If you need to use a
  75     network share for the source code, see below for suggestions on how to keep
  76     the build artifacts on a local disk.
  77 
  78   * On Windows, if using [Cygwin](#cygwin), extra care must be taken to make sure
  79     the environment is consistent. It is recommended that you follow this
  80     procedure:
  81 
  82       * Create the directory that is going to contain the top directory of the
  83         JDK clone by using the `mkdir` command in the Cygwin bash shell.
  84         That is, do *not* create it using Windows Explorer. This will ensure
  85         that it will have proper Cygwin attributes, and that it&#39;s children will
  86         inherit those attributes.
  87 
  88       * Do not put the JDK clone in a path under your Cygwin home
  89         directory. This is especially important if your user name contains
  90         spaces and/or mixed upper and lower case letters.
  91 
  92       * Clone the JDK repository using the Cygwin command line `hg` client
  93         as instructed in this document. That is, do *not* use another Mercurial
  94         client such as TortoiseHg.
  95 
  96     Failure to follow this procedure might result in hard-to-debug build
  97     problems.
  98 
  99 ## Build Hardware Requirements
 100 
 101 The JDK is a massive project, and require machines ranging from decent to
 102 powerful to be able to build in a reasonable amount of time, or to be able to
 103 complete a build at all.
 104 
 105 We *strongly* recommend usage of an SSD disk for the build, since disk speed is
 106 one of the limiting factors for build performance.
 107 
 108 ### Building on x86
 109 
 110 At a minimum, a machine with 2-4 cores is advisable, as well as 2-4 GB of RAM.
 111 (The more cores to use, the more memory you need.) At least 6 GB of free disk
 112 space is required.
 113 
 114 Even for 32-bit builds, it is recommended to use a 64-bit build machine, and
 115 instead create a 32-bit target using `--with-target-bits=32`.
 116 
 117 ### Building on aarch64
 118 
 119 At a minimum, a machine with 8 cores is advisable, as well as 8 GB of RAM.
 120 (The more cores to use, the more memory you need.) At least 6 GB of free disk
 121 space is required.
 122 
 123 If you do not have access to sufficiently powerful hardware, it is also
 124 possible to use [cross-compiling](#cross-compiling).
 125 
 126 ### Building on 32-bit arm
 127 
 128 This is not recommended. Instead, see the section on [Cross-compiling](
 129 #cross-compiling).
 130 
 131 ## Operating System Requirements
 132 
 133 The mainline JDK project supports Linux, macOS, AIX and Windows.
 134 Support for other operating system, e.g. BSD, exists in separate &quot;port&quot;
 135 projects.
 136 
 137 In general, the JDK can be built on a wide range of versions of these operating
 138 systems, but the further you deviate from what is tested on a daily basis, the
 139 more likely you are to run into problems.
 140 
 141 This table lists the OS versions used by Oracle when building the JDK. Such
 142 information is always subject to change, but this table is up to date at the
 143 time of writing.
 144 
 145  Operating system   Vendor/version used
 146  -----------------  -------------------------------------------------------
 147  Linux              Oracle Enterprise Linux 6.4 / 7.6
 148  macOS              Mac OS X 10.13 (High Sierra)
 149  Windows            Windows Server 2012 R2
 150 
 151 The double version numbers for Linux are due to the hybrid model
 152 used at Oracle, where header files and external libraries from an older version
 153 are used when building on a more modern version of the OS.
 154 
 155 The Build Group has a wiki page with [Supported Build Platforms](
 156 https://wiki.openjdk.java.net/display/Build/Supported+Build+Platforms). From
 157 time to time, this is updated by contributors to list successes or failures of
 158 building on different platforms.
 159 
 160 ### Windows
 161 
 162 Windows XP is not a supported platform, but all newer Windows should be able to
 163 build the JDK.
 164 
 165 On Windows, it is important that you pay attention to the instructions in the
 166 [Special Considerations](#special-considerations).
 167 
 168 Windows is the only non-POSIX OS supported by the JDK, and as such, requires
 169 some extra care. A POSIX support layer is required to build on Windows.
 170 Currently, the only supported such layers are Cygwin and Windows Subsystem for
 171 Linux (WSL). (Msys is no longer supported due to a too old bash; msys2 would
 172 likely be possible to support in a future version but that would require effort
 173 to implement.)
 174 
 175 Internally in the build system, all paths are represented as Unix-style paths,
 176 e.g. `/cygdrive/c/hg/jdk9/Makefile` rather than `C:\hg\jdk9\Makefile`. This
 177 rule also applies to input to the build system, e.g. in arguments to
 178 `configure`. So, use `--with-msvcr-dll=/cygdrive/c/msvcr100.dll` rather than
 179 `--with-msvcr-dll=c:\msvcr100.dll`. For details on this conversion, see the section
 180 on [Fixpath](#fixpath).
 181 
 182 #### Cygwin
 183 
 184 A functioning [Cygwin](http://www.cygwin.com/) environment is required for
 185 building the JDK on Windows. If you have a 64-bit OS, we strongly recommend
 186 using the 64-bit version of Cygwin.
 187 
 188 **Note:** Cygwin has a model of continuously updating all packages without any
 189 easy way to install or revert to a specific version of a package. This means
 190 that whenever you add or update a package in Cygwin, you might (inadvertently)
 191 update tools that are used by the JDK build process, and that can cause
 192 unexpected build problems.
 193 
 194 The JDK requires GNU Make 4.0 or greater in Cygwin. This is usually not a
 195 problem, since Cygwin currently only distributes GNU Make at a version above
 196 4.0.
 197 
 198 Apart from the basic Cygwin installation, the following packages must also be
 199 installed:
 200 
 201   * `autoconf`
 202   * `make`
 203   * `zip`
 204   * `unzip`
 205 
 206 Often, you can install these packages using the following command line:
 207 ```
 208 &lt;path to Cygwin setup&gt;/setup-x86_64 -q -P autoconf -P make -P unzip -P zip
 209 ```
 210 
 211 Unfortunately, Cygwin can be unreliable in certain circumstances. If you
 212 experience build tool crashes or strange issues when building on Windows,
 213 please check the Cygwin FAQ on the [&quot;BLODA&quot; list](
 214 https://cygwin.com/faq/faq.html#faq.using.bloda) and the section on [fork()
 215 failures](https://cygwin.com/faq/faq.html#faq.using.fixing-fork-failures).
 216 
 217 #### Windows Subsystem for Linux (WSL)
 218 
 219 Windows 10 1809 or newer is supported due to a dependency on the wslpath utility
 220 and support for environment variable sharing through WSLENV. Version 1803 can
 221 work but intermittent build failures have been observed.
 222 
 223 It&#39;s possible to build both Windows and Linux binaries from WSL. To build
 224 Windows binaries, you must use a Windows boot JDK (located in a
 225 Windows-accessible directory). To build Linux binaries, you must use a Linux
 226 boot JDK. The default behavior is to build for Windows. To build for Linux, pass
 227 `--build=x86_64-unknown-linux-gnu --host=x86_64-unknown-linux-gnu` to
 228 `configure`.
 229 
 230 If building Windows binaries, the source code must be located in a Windows-
 231 accessible directory. This is because Windows executables (such as Visual Studio
 232 and the boot JDK) must be able to access the source code. Also, the drive where
 233 the source is stored must be mounted as case-insensitive by changing either
 234 /etc/fstab or /etc/wsl.conf in WSL. Individual directories may be corrected
 235 using the fsutil tool in case the source was cloned before changing the mount
 236 options.
 237 
 238 Note that while it&#39;s possible to build on WSL, testing is still not fully
 239 supported.
 240 
 241 ### macOS
 242 
 243 Apple is using a quite aggressive scheme of pushing OS updates, and coupling
 244 these updates with required updates of Xcode. Unfortunately, this makes it
 245 difficult for a project such as the JDK to keep pace with a continuously updated
 246 machine running macOS. See the section on [Apple Xcode](#apple-xcode) on some
 247 strategies to deal with this.
 248 
 249 It is recommended that you use at least Mac OS X 10.13 (High Sierra). At the time
 250 of writing, the JDK has been successfully compiled on macOS 10.12 (Sierra).
 251 
 252 The standard macOS environment contains the basic tooling needed to build, but
 253 for external libraries a package manager is recommended. The JDK uses
 254 [homebrew](https://brew.sh/) in the examples, but feel free to use whatever
 255 manager you want (or none).
 256 
 257 ### Linux
 258 
 259 It is often not much problem to build the JDK on Linux. The only general advice
 260 is to try to use the compilers, external libraries and header files as provided
 261 by your distribution.
 262 
 263 The basic tooling is provided as part of the core operating system, but you
 264 will most likely need to install developer packages.
 265 
 266 For apt-based distributions (Debian, Ubuntu, etc), try this:
 267 ```
 268 sudo apt-get install build-essential
 269 ```
 270 
 271 For rpm-based distributions (Fedora, Red Hat, etc), try this:
 272 ```
 273 sudo yum groupinstall &quot;Development Tools&quot;
 274 ```
 275 
 276 ### AIX
 277 
 278 Please consult the AIX section of the [Supported Build Platforms](
 279 https://wiki.openjdk.java.net/display/Build/Supported+Build+Platforms) OpenJDK
 280 Build Wiki page for details about which versions of AIX are supported.
 281 
 282 ## Native Compiler (Toolchain) Requirements
 283 
 284 Large portions of the JDK consists of native code, that needs to be compiled to
 285 be able to run on the target platform. In theory, toolchain and operating
 286 system should be independent factors, but in practice there&#39;s more or less a
 287 one-to-one correlation between target operating system and toolchain.
 288 
 289  Operating system   Supported toolchain
 290  ------------------ -------------------------
 291  Linux              gcc, clang
 292  macOS              Apple Xcode (using clang)
 293  AIX                IBM XL C/C++
 294  Windows            Microsoft Visual Studio
 295 
 296 Please see the individual sections on the toolchains for version
 297 recommendations. As a reference, these versions of the toolchains are used, at
 298 the time of writing, by Oracle for the daily builds of the JDK. It should be
 299 possible to compile the JDK with both older and newer versions, but the closer
 300 you stay to this list, the more likely you are to compile successfully without
 301 issues.
 302 
 303  Operating system   Toolchain version
 304  ------------------ -------------------------------------------------------
 305  Linux              gcc 9.2.0
 306  macOS              Apple Xcode 10.1 (using clang 10.0.0)
 307  Windows            Microsoft Visual Studio 2019 update 16.5.3
 308 
 309 All compilers are expected to be able to compile to the C99 language standard,
 310 as some C99 features are used in the source code. Microsoft Visual Studio
 311 doesn&#39;t fully support C99 so in practice shared code is limited to using C99
 312 features that it does support.
 313 
 314 ### gcc
 315 
 316 The minimum accepted version of gcc is 5.0. Older versions will generate a warning
 317 by `configure` and are unlikely to work.
 318 
 319 The JDK is currently known to be able to compile with at least version 9.2 of
 320 gcc.
 321 
 322 In general, any version between these two should be usable.
 323 
 324 ### clang
 325 
 326 The minimum accepted version of clang is 3.2. Older versions will not be
 327 accepted by `configure`.
 328 
 329 To use clang instead of gcc on Linux, use `--with-toolchain-type=clang`.
 330 
 331 ### Apple Xcode
 332 
 333 The oldest supported version of Xcode is 8.
 334 
 335 You will need the Xcode command lines developers tools to be able to build
 336 the JDK. (Actually, *only* the command lines tools are needed, not the IDE.)
 337 The simplest way to install these is to run:
 338 ```
 339 xcode-select --install
 340 ```
 341 
 342 It is advisable to keep an older version of Xcode for building the JDK when
 343 updating Xcode. This [blog page](
 344 http://iosdevelopertips.com/xcode/install-multiple-versions-of-xcode.html) has
 345 good suggestions on managing multiple Xcode versions. To use a specific version
 346 of Xcode, use `xcode-select -s` before running `configure`, or use
 347 `--with-toolchain-path` to point to the version of Xcode to use, e.g.
 348 `configure --with-toolchain-path=/Applications/Xcode8.app/Contents/Developer/usr/bin`
 349 
 350 If you have recently (inadvertently) updated your OS and/or Xcode version, and
 351 the JDK can no longer be built, please see the section on [Problems with the
 352 Build Environment](#problems-with-the-build-environment), and [Getting
 353 Help](#getting-help) to find out if there are any recent, non-merged patches
 354 available for this update.
 355 
 356 ### Microsoft Visual Studio
 357 
 358 The minimum accepted version of Visual Studio is 2010. Older versions will not
 359 be accepted by `configure`. The maximum accepted version of Visual Studio is
 360 2019. Versions older than 2017 are unlikely to continue working for long.
 361 
 362 If you have multiple versions of Visual Studio installed, `configure` will by
 363 default pick the latest. You can request a specific version to be used by
 364 setting `--with-toolchain-version`, e.g. `--with-toolchain-version=2015`.
 365 
 366 If you get `LINK: fatal error LNK1123: failure during conversion to COFF: file
 367 invalid` when building using Visual Studio 2010, you have encountered
 368 [KB2757355](http://support.microsoft.com/kb/2757355), a bug triggered by a
 369 specific installation order. However, the solution suggested by the KB article
 370 does not always resolve the problem. See [this stackoverflow discussion](
 371 https://stackoverflow.com/questions/10888391) for other suggestions.
 372 
 373 ### IBM XL C/C++
 374 
 375 Please consult the AIX section of the [Supported Build Platforms](
 376 https://wiki.openjdk.java.net/display/Build/Supported+Build+Platforms) OpenJDK
 377 Build Wiki page for details about which versions of XLC are supported.
 378 
 379 
 380 ## Boot JDK Requirements
 381 
 382 Paradoxically, building the JDK requires a pre-existing JDK. This is called the
 383 &quot;boot JDK&quot;. The boot JDK does not, however, have to be a JDK built directly from
 384 the source code available in the OpenJDK Community.  If you are porting the JDK
 385 to a new platform, chances are that there already exists another JDK for that
 386 platform that is usable as boot JDK.
 387 
 388 The rule of thumb is that the boot JDK for building JDK major version *N*
 389 should be a JDK of major version *N-1*, so for building JDK 9 a JDK 8 would be
 390 suitable as boot JDK. However, the JDK should be able to &quot;build itself&quot;, so an
 391 up-to-date build of the current JDK source is an acceptable alternative. If
 392 you are following the *N-1* rule, make sure you&#39;ve got the latest update
 393 version, since JDK 8 GA might not be able to build JDK 9 on all platforms.
 394 
 395 Early in the release cycle, version *N-1* may not yet have been released. In
 396 that case, the preferred boot JDK will be version *N-2* until version *N-1*
 397 is available.
 398 
 399 If the boot JDK is not automatically detected, or the wrong JDK is picked, use
 400 `--with-boot-jdk` to point to the JDK to use.
 401 
 402 ### Getting JDK binaries
 403 
 404 JDK binaries for Linux, Windows and macOS can be downloaded from
 405 [jdk.java.net](http://jdk.java.net). An alternative is to download the
 406 [Oracle JDK](http://www.oracle.com/technetwork/java/javase/downloads). Another
 407 is the [Adopt OpenJDK Project](https://adoptopenjdk.net/), which publishes
 408 experimental prebuilt binaries for various platforms.
 409 
 410 On Linux you can also get a JDK from the Linux distribution. On apt-based
 411 distros (like Debian and Ubuntu), `sudo apt-get install openjdk-&lt;VERSION&gt;-jdk`
 412 is typically enough to install a JDK \&lt;VERSION\&gt;. On rpm-based distros (like
 413 Fedora and Red Hat), try `sudo yum install java-&lt;VERSION&gt;-openjdk-devel`.
 414 
 415 ## External Library Requirements
 416 
 417 Different platforms require different external libraries. In general, libraries
 418 are not optional - that is, they are either required or not used.
 419 
 420 If a required library is not detected by `configure`, you need to provide the
 421 path to it. There are two forms of the `configure` arguments to point to an
 422 external library: `--with-&lt;LIB&gt;=&lt;path&gt;` or `--with-&lt;LIB&gt;-include=&lt;path to
 423 include&gt; --with-&lt;LIB&gt;-lib=&lt;path to lib&gt;`. The first variant is more concise,
 424 but require the include files and library files to reside in a default
 425 hierarchy under this directory. In most cases, it works fine.
 426 
 427 As a fallback, the second version allows you to point to the include directory
 428 and the lib directory separately.
 429 
 430 ### FreeType
 431 
 432 FreeType2 from [The FreeType Project](http://www.freetype.org/) is not required
 433 on any platform. The exception is on Unix-based platforms when configuring such
 434 that the build artifacts will reference a system installed library,
 435 rather than bundling the JDK&#39;s own copy.
 436 
 437   * To install on an apt-based Linux, try running `sudo apt-get install
 438     libfreetype6-dev`.
 439   * To install on an rpm-based Linux, try running `sudo yum install
 440     freetype-devel`.
 441 
 442 Use `--with-freetype-include=&lt;path&gt;` and `--with-freetype-lib=&lt;path&gt;`
 443 if `configure` does not automatically locate the platform FreeType files.
 444 
 445 ### CUPS
 446 
 447 CUPS, [Common UNIX Printing System](http://www.cups.org) header files are
 448 required on all platforms, except Windows. Often these files are provided by
 449 your operating system.
 450 
 451   * To install on an apt-based Linux, try running `sudo apt-get install
 452     libcups2-dev`.
 453   * To install on an rpm-based Linux, try running `sudo yum install
 454     cups-devel`.
 455 
 456 Use `--with-cups=&lt;path&gt;` if `configure` does not properly locate your CUPS
 457 files.
 458 
 459 ### X11
 460 
 461 Certain [X11](http://www.x.org/) libraries and include files are required on
 462 Linux.
 463 
 464   * To install on an apt-based Linux, try running `sudo apt-get install
 465     libx11-dev libxext-dev libxrender-dev libxrandr-dev libxtst-dev libxt-dev`.
 466   * To install on an rpm-based Linux, try running `sudo yum install
 467     libXtst-devel libXt-devel libXrender-devel libXrandr-devel libXi-devel`.
 468 
 469 Use `--with-x=&lt;path&gt;` if `configure` does not properly locate your X11 files.
 470 
 471 ### ALSA
 472 
 473 ALSA, [Advanced Linux Sound Architecture](https://www.alsa-project.org/) is
 474 required on Linux. At least version 0.9.1 of ALSA is required.
 475 
 476   * To install on an apt-based Linux, try running `sudo apt-get install
 477     libasound2-dev`.
 478   * To install on an rpm-based Linux, try running `sudo yum install
 479     alsa-lib-devel`.
 480 
 481 Use `--with-alsa=&lt;path&gt;` if `configure` does not properly locate your ALSA
 482 files.
 483 
 484 ### libffi
 485 
 486 libffi, the [Portable Foreign Function Interface Library](
 487 http://sourceware.org/libffi) is required when building the Zero version of
 488 Hotspot.
 489 
 490   * To install on an apt-based Linux, try running `sudo apt-get install
 491     libffi-dev`.
 492   * To install on an rpm-based Linux, try running `sudo yum install
 493     libffi-devel`.
 494 
 495 Use `--with-libffi=&lt;path&gt;` if `configure` does not properly locate your libffi
 496 files.
 497 
 498 ## Build Tools Requirements
 499 
 500 ### Autoconf
 501 
 502 The JDK requires [Autoconf](http://www.gnu.org/software/autoconf) on all
 503 platforms. At least version 2.69 is required.
 504 
 505   * To install on an apt-based Linux, try running `sudo apt-get install
 506     autoconf`.
 507   * To install on an rpm-based Linux, try running `sudo yum install
 508     autoconf`.
 509   * To install on macOS, try running `brew install autoconf`.
 510   * To install on Windows, try running `&lt;path to Cygwin setup&gt;/setup-x86_64 -q
 511     -P autoconf`.
 512 
 513 If `configure` has problems locating your installation of autoconf, you can
 514 specify it using the `AUTOCONF` environment variable, like this:
 515 
 516 ```
 517 AUTOCONF=&lt;path to autoconf&gt; configure ...
 518 ```
 519 
 520 ### GNU Make
 521 
 522 The JDK requires [GNU Make](http://www.gnu.org/software/make). No other flavors
 523 of make are supported.
 524 
 525 At least version 3.81 of GNU Make must be used. For distributions supporting
 526 GNU Make 4.0 or above, we strongly recommend it. GNU Make 4.0 contains useful
 527 functionality to handle parallel building (supported by `--with-output-sync`)
 528 and speed and stability improvements.
 529 
 530 Note that `configure` locates and verifies a properly functioning version of
 531 `make` and stores the path to this `make` binary in the configuration. If you
 532 start a build using `make` on the command line, you will be using the version
 533 of make found first in your `PATH`, and not necessarily the one stored in the
 534 configuration. This initial make will be used as &quot;bootstrap make&quot;, and in a
 535 second stage, the make located by `configure` will be called. Normally, this
 536 will present no issues, but if you have a very old `make`, or a non-GNU Make
 537 `make` in your path, this might cause issues.
 538 
 539 If you want to override the default make found by `configure`, use the `MAKE`
 540 configure variable, e.g. `configure MAKE=/opt/gnu/make`.
 541 
 542 ### GNU Bash
 543 
 544 The JDK requires [GNU Bash](http://www.gnu.org/software/bash). No other shells
 545 are supported.
 546 
 547 At least version 3.2 of GNU Bash must be used.
 548 
 549 ## Running Configure
 550 
 551 To build the JDK, you need a &quot;configuration&quot;, which consists of a directory
 552 where to store the build output, coupled with information about the platform,
 553 the specific build machine, and choices that affect how the JDK is built.
 554 
 555 The configuration is created by the `configure` script. The basic invocation of
 556 the `configure` script looks like this:
 557 
 558 ```
 559 bash configure [options]
 560 ```
 561 
 562 This will create an output directory containing the configuration and setup an
 563 area for the build result. This directory typically looks like
 564 `build/linux-x64-server-release`, but the actual name depends on your specific
 565 configuration. (It can also be set directly, see [Using Multiple
 566 Configurations](#using-multiple-configurations)). This directory is referred to
 567 as `$BUILD` in this documentation.
 568 
 569 `configure` will try to figure out what system you are running on and where all
 570 necessary build components are. If you have all prerequisites for building
 571 installed, it should find everything. If it fails to detect any component
 572 automatically, it will exit and inform you about the problem.
 573 
 574 Some command line examples:
 575 
 576   * Create a 32-bit build for Windows with FreeType2 in `C:\freetype-i586`:
 577     ```
 578     bash configure --with-freetype=/cygdrive/c/freetype-i586 --with-target-bits=32
 579     ```
 580 
 581   * Create a debug build with the `server` JVM and DTrace enabled:
 582     ```
 583     bash configure --enable-debug --with-jvm-variants=server --enable-dtrace
 584     ```
 585 
 586 ### Common Configure Arguments
 587 
 588 Here follows some of the most common and important `configure` argument.
 589 
 590 To get up-to-date information on *all* available `configure` argument, please
 591 run:
 592 ```
 593 bash configure --help
 594 ```
 595 
 596 (Note that this help text also include general autoconf options, like
 597 `--dvidir`, that is not relevant to the JDK. To list only JDK-specific
 598 features, use `bash configure --help=short` instead.)
 599 
 600 #### Configure Arguments for Tailoring the Build
 601 
 602   * `--enable-debug` - Set the debug level to `fastdebug` (this is a shorthand
 603     for `--with-debug-level=fastdebug`)
 604   * `--with-debug-level=&lt;level&gt;` - Set the debug level, which can be `release`,
 605     `fastdebug`, `slowdebug` or `optimized`. Default is `release`. `optimized`
 606     is variant of `release` with additional Hotspot debug code.
 607   * `--with-native-debug-symbols=&lt;method&gt;` - Specify if and how native debug
 608     symbols should be built. Available methods are `none`, `internal`,
 609     `external`, `zipped`. Default behavior depends on platform. See [Native
 610     Debug Symbols](#native-debug-symbols) for more details.
 611   * `--with-version-string=&lt;string&gt;` - Specify the version string this build
 612     will be identified with.
 613   * `--with-version-&lt;part&gt;=&lt;value&gt;` - A group of options, where `&lt;part&gt;` can be
 614     any of `pre`, `opt`, `build`, `major`, `minor`, `security` or `patch`. Use
 615     these options to modify just the corresponding part of the version string
 616     from the default, or the value provided by `--with-version-string`.
 617   * `--with-jvm-variants=&lt;variant&gt;[,&lt;variant&gt;...]` - Build the specified variant
 618     (or variants) of Hotspot. Valid variants are: `server`, `client`,
 619     `minimal`, `core`, `zero`, `custom`. Note that not all
 620     variants are possible to combine in a single build.
 621   * `--enable-jvm-feature-&lt;feature&gt;` or `--disable-jvm-feature-&lt;feature&gt;` -
 622     Include (or exclude) `&lt;feature&gt;` as a JVM feature in Hotspot. You can also
 623     specify a list of features to be enabled, separated by space or comma, as
 624     `--with-jvm-features=&lt;feature&gt;[,&lt;feature&gt;...]`. If you prefix `&lt;feature&gt;`
 625     with a `-`, it will be disabled. These options will modify the default list
 626     of features for the JVM variant(s) you are building. For the `custom` JVM
 627     variant, the default list is empty. A complete list of valid JVM features
 628     can be found using `bash configure --help`.
 629   * `--with-target-bits=&lt;bits&gt;` - Create a target binary suitable for running
 630     on a `&lt;bits&gt;` platform. Use this to create 32-bit output on a 64-bit build
 631     platform, instead of doing a full cross-compile. (This is known as a
 632     *reduced* build.)
 633 
 634 On Linux, BSD and AIX, it is possible to override where Java by default
 635 searches for runtime/JNI libraries. This can be useful in situations where
 636 there is a special shared directory for system JNI libraries. This setting
 637 can in turn be overriden at runtime by setting the `java.library.path` property.
 638 
 639   * `--with-jni-libpath=&lt;path&gt;` - Use the specified path as a default
 640   when searching for runtime libraries.
 641 
 642 #### Configure Arguments for Native Compilation
 643 
 644   * `--with-devkit=&lt;path&gt;` - Use this devkit for compilers, tools and resources
 645   * `--with-sysroot=&lt;path&gt;` - Use this directory as sysroot
 646   * `--with-extra-path=&lt;path&gt;[;&lt;path&gt;]` - Prepend these directories to the
 647     default path when searching for all kinds of binaries
 648   * `--with-toolchain-path=&lt;path&gt;[;&lt;path&gt;]` - Prepend these directories when
 649     searching for toolchain binaries (compilers etc)
 650   * `--with-extra-cflags=&lt;flags&gt;` - Append these flags when compiling JDK C
 651     files
 652   * `--with-extra-cxxflags=&lt;flags&gt;` - Append these flags when compiling JDK C++
 653     files
 654   * `--with-extra-ldflags=&lt;flags&gt;` - Append these flags when linking JDK
 655     libraries
 656 
 657 #### Configure Arguments for External Dependencies
 658 
 659   * `--with-boot-jdk=&lt;path&gt;` - Set the path to the [Boot JDK](
 660     #boot-jdk-requirements)
 661   * `--with-freetype=&lt;path&gt;` - Set the path to [FreeType](#freetype)
 662   * `--with-cups=&lt;path&gt;` - Set the path to [CUPS](#cups)
 663   * `--with-x=&lt;path&gt;` - Set the path to [X11](#x11)
 664   * `--with-alsa=&lt;path&gt;` - Set the path to [ALSA](#alsa)
 665   * `--with-libffi=&lt;path&gt;` - Set the path to [libffi](#libffi)
 666   * `--with-jtreg=&lt;path&gt;` - Set the path to JTReg. See [Running Tests](
 667     #running-tests)
 668 
 669 Certain third-party libraries used by the JDK (libjpeg, giflib, libpng, lcms
 670 and zlib) are included in the JDK repository. The default behavior of the
 671 JDK build is to use the included (&quot;bundled&quot;) versions of libjpeg, giflib,
 672 libpng and lcms.
 673 For zlib, the system lib (if present) is used except on Windows and AIX.
 674 However the bundled libraries may be replaced by an external version.
 675 To do so, specify `system` as the `&lt;source&gt;` option in these arguments.
 676 (The default is `bundled`).
 677 
 678   * `--with-libjpeg=&lt;source&gt;` - Use the specified source for libjpeg
 679   * `--with-giflib=&lt;source&gt;` - Use the specified source for giflib
 680   * `--with-libpng=&lt;source&gt;` - Use the specified source for libpng
 681   * `--with-lcms=&lt;source&gt;` - Use the specified source for lcms
 682   * `--with-zlib=&lt;source&gt;` - Use the specified source for zlib
 683 
 684 On Linux, it is possible to select either static or dynamic linking of the C++
 685 runtime. The default is static linking, with dynamic linking as fallback if the
 686 static library is not found.
 687 
 688   * `--with-stdc++lib=&lt;method&gt;` - Use the specified method (`static`, `dynamic`
 689     or `default`) for linking the C++ runtime.
 690 
 691 ### Configure Control Variables
 692 
 693 It is possible to control certain aspects of `configure` by overriding the
 694 value of `configure` variables, either on the command line or in the
 695 environment.
 696 
 697 Normally, this is **not recommended**. If used improperly, it can lead to a
 698 broken configuration. Unless you&#39;re well versed in the build system, this is
 699 hard to use properly. Therefore, `configure` will print a warning if this is
 700 detected.
 701 
 702 However, there are a few `configure` variables, known as *control variables*
 703 that are supposed to be overriden on the command line. These are variables that
 704 describe the location of tools needed by the build, like `MAKE` or `GREP`. If
 705 any such variable is specified, `configure` will use that value instead of
 706 trying to autodetect the tool. For instance, `bash configure
 707 MAKE=/opt/gnumake4.0/bin/make`.
 708 
 709 If a configure argument exists, use that instead, e.g. use `--with-jtreg`
 710 instead of setting `JTREGEXE`.
 711 
 712 Also note that, despite what autoconf claims, setting `CFLAGS` will not
 713 accomplish anything. Instead use `--with-extra-cflags` (and similar for
 714 `cxxflags` and `ldflags`).
 715 
 716 ## Running Make
 717 
 718 When you have a proper configuration, all you need to do to build the JDK is to
 719 run `make`. (But see the warning at [GNU Make](#gnu-make) about running the
 720 correct version of make.)
 721 
 722 When running `make` without any arguments, the default target is used, which is
 723 the same as running `make default` or `make jdk`. This will build a minimal (or
 724 roughly minimal) set of compiled output (known as an &quot;exploded image&quot;) needed
 725 for a developer to actually execute the newly built JDK. The idea is that in an
 726 incremental development fashion, when doing a normal make, you should only
 727 spend time recompiling what&#39;s changed (making it purely incremental) and only
 728 do the work that&#39;s needed to actually run and test your code.
 729 
 730 The output of the exploded image resides in `$BUILD/jdk`. You can test the
 731 newly built JDK like this: `$BUILD/jdk/bin/java -version`.
 732 
 733 ### Common Make Targets
 734 
 735 Apart from the default target, here are some common make targets:
 736 
 737   * `hotspot` - Build all of hotspot (but only hotspot)
 738   * `hotspot-&lt;variant&gt;` - Build just the specified jvm variant
 739   * `images` or `product-images` - Build the JDK image
 740   * `docs` or `docs-image` - Build the documentation image
 741   * `test-image` - Build the test image
 742   * `all` or `all-images` - Build all images (product, docs and test)
 743   * `bootcycle-images` - Build images twice, second time with newly built JDK
 744     (good for testing)
 745   * `clean` - Remove all files generated by make, but not those generated by
 746     configure
 747   * `dist-clean` - Remove all files, including configuration
 748 
 749 Run `make help` to get an up-to-date list of important make targets and make
 750 control variables.
 751 
 752 It is possible to build just a single module, a single phase, or a single phase
 753 of a single module, by creating make targets according to these followin
 754 patterns. A phase can be either of `gensrc`, `gendata`, `copy`, `java`,
 755 `launchers`, or `libs`. See [Using Fine-Grained Make Targets](
 756 #using-fine-grained-make-targets) for more details about this functionality.
 757 
 758   * `&lt;phase&gt;` - Build the specified phase and everything it depends on
 759   * `&lt;module&gt;` - Build the specified module and everything it depends on
 760   * `&lt;module&gt;-&lt;phase&gt;` - Compile the specified phase for the specified module
 761     and everything it depends on
 762 
 763 Similarly, it is possible to clean just a part of the build by creating make
 764 targets according to these patterns:
 765 
 766   * `clean-&lt;outputdir&gt;` - Remove the subdir in the output dir with the name
 767   * `clean-&lt;phase&gt;` - Remove all build results related to a certain build
 768     phase
 769   * `clean-&lt;module&gt;` - Remove all build results related to a certain module
 770   * `clean-&lt;module&gt;-&lt;phase&gt;` - Remove all build results related to a certain
 771     module and phase
 772 
 773 ### Make Control Variables
 774 
 775 It is possible to control `make` behavior by overriding the value of `make`
 776 variables, either on the command line or in the environment.
 777 
 778 Normally, this is **not recommended**. If used improperly, it can lead to a
 779 broken build. Unless you&#39;re well versed in the build system, this is hard to
 780 use properly. Therefore, `make` will print a warning if this is detected.
 781 
 782 However, there are a few `make` variables, known as *control variables* that
 783 are supposed to be overriden on the command line. These make up the &quot;make time&quot;
 784 configuration, as opposed to the &quot;configure time&quot; configuration.
 785 
 786 #### General Make Control Variables
 787 
 788   * `JOBS` - Specify the number of jobs to build with. See [Build
 789     Performance](#build-performance).
 790   * `LOG` - Specify the logging level and functionality. See [Checking the
 791     Build Log File](#checking-the-build-log-file)
 792   * `CONF` and `CONF_NAME` - Selecting the configuration(s) to use. See [Using
 793     Multiple Configurations](#using-multiple-configurations)
 794 
 795 #### Test Make Control Variables
 796 
 797 These make control variables only make sense when running tests. Please see
 798 [Testing the JDK](testing.html) for details.
 799 
 800   * `TEST`
 801   * `TEST_JOBS`
 802   * `JTREG`
 803   * `GTEST`
 804 
 805 #### Advanced Make Control Variables
 806 
 807 These advanced make control variables can be potentially unsafe. See [Hints and
 808 Suggestions for Advanced Users](#hints-and-suggestions-for-advanced-users) and
 809 [Understanding the Build System](#understanding-the-build-system) for details.
 810 
 811   * `SPEC`
 812   * `CONF_CHECK`
 813   * `COMPARE_BUILD`
 814   * `JDK_FILTER`
 815   * `SPEC_FILTER`
 816 
 817 ## Running Tests
 818 
 819 Most of the JDK tests are using the [JTReg](http://openjdk.java.net/jtreg)
 820 test framework. Make sure that your configuration knows where to find your
 821 installation of JTReg. If this is not picked up automatically, use the
 822 `--with-jtreg=&lt;path to jtreg home&gt;` option to point to the JTReg framework.
 823 Note that this option should point to the JTReg home, i.e. the top directory,
 824 containing `lib/jtreg.jar` etc.
 825 
 826 The [Adoption Group](https://wiki.openjdk.java.net/display/Adoption) provides
 827 recent builds of jtreg [here](
 828 https://ci.adoptopenjdk.net/view/Dependencies/job/jtreg/lastSuccessfulBuild/artifact).
 829 Download the latest `.tar.gz` file, unpack it, and point `--with-jtreg` to the
 830 `jtreg` directory that you just unpacked.
 831 
<a name="1" id="anc1"></a><span class="line-added"> 832 Building of Hotspot Gtest suite requires the source code of Google Test framework.</span>
<span class="line-added"> 833 The top directory, which contains both `googletest` and `googlemock`</span>
<span class="line-added"> 834 directories, should be specified via `--with-gtest`.</span>
<span class="line-added"> 835 The supported version of Google Test is 1.8.1, whose source code can be obtained:</span>
<span class="line-added"> 836 </span>
<span class="line-added"> 837  * by downloading and unpacking the source bundle from [here](https://github.com/google/googletest/releases/tag/release-1.8.1)</span>
<span class="line-added"> 838  * or by checking out `release-1.8.1` tag of `googletest` project: `git clone -b release-1.8.1 https://github.com/google/googletest`</span>
<span class="line-added"> 839 </span>
 840 To execute the most basic tests (tier 1), use:
 841 ```
 842 make run-test-tier1
 843 ```
 844 
 845 For more details on how to run tests, please see the [Testing
 846 the JDK](testing.html) document.
 847 
 848 ## Cross-compiling
 849 
 850 Cross-compiling means using one platform (the *build* platform) to generate
 851 output that can ran on another platform (the *target* platform).
 852 
 853 The typical reason for cross-compiling is that the build is performed on a more
 854 powerful desktop computer, but the resulting binaries will be able to run on a
 855 different, typically low-performing system. Most of the complications that
 856 arise when building for embedded is due to this separation of *build* and
 857 *target* systems.
 858 
 859 This requires a more complex setup and build procedure. This section assumes
 860 you are familiar with cross-compiling in general, and will only deal with the
 861 particularities of cross-compiling the JDK. If you are new to cross-compiling,
 862 please see the [external links at Wikipedia](
 863 https://en.wikipedia.org/wiki/Cross_compiler#External_links) for a good start
 864 on reading materials.
 865 
 866 Cross-compiling the JDK requires you to be able to build both for the build
 867 platform and for the target platform. The reason for the former is that we need
 868 to build and execute tools during the build process, both native tools and Java
 869 tools.
 870 
 871 If all you want to do is to compile a 32-bit version, for the same OS, on a
 872 64-bit machine, consider using `--with-target-bits=32` instead of doing a
 873 full-blown cross-compilation. (While this surely is possible, it&#39;s a lot more
 874 work and will take much longer to build.)
 875 
 876 ### Cross compiling the easy way with OpenJDK devkits
 877 
 878 The OpenJDK build system provides out-of-the box support for creating and using
 879 so called devkits. A `devkit` is basically a collection of a cross-compiling
 880 toolchain and a sysroot environment which can easily be used together with the
 881 `--with-devkit` configure option to cross compile the OpenJDK. On Linux/x86_64,
 882 the following command:
 883 ```
 884 bash configure --with-devkit=&lt;devkit-path&gt; --openjdk-target=ppc64-linux-gnu &amp;&amp; make
 885 ```
 886 
 887 will configure and build OpenJDK for Linux/ppc64 assuming that `&lt;devkit-path&gt;`
 888 points to a Linux/x86_64 to Linux/ppc64 devkit.
 889 
 890 Devkits can be created from the `make/devkit` directory by executing:
 891 ```
 892 make [ TARGETS=&quot;&lt;TARGET_TRIPLET&gt;+&quot; ] [ BASE_OS=&lt;OS&gt; ] [ BASE_OS_VERSION=&lt;VER&gt; ]
 893 ```
 894 
 895 where `TARGETS` contains one or more `TARGET_TRIPLET`s of the form
 896 described in [section 3.4 of the GNU Autobook](
 897 https://sourceware.org/autobook/autobook/autobook_17.html). If no
 898 targets are given, a native toolchain for the current platform will be
 899 created. Currently, at least the following targets are known to work:
 900 
 901  Supported devkit targets
 902  -------------------------
 903  x86_64-linux-gnu
 904  aarch64-linux-gnu
 905  arm-linux-gnueabihf
 906  ppc64-linux-gnu
 907  ppc64le-linux-gnu
 908  s390x-linux-gnu
 909 
 910 `BASE_OS` must be one of &quot;OEL6&quot; for Oracle Enterprise Linux 6 or
 911 &quot;Fedora&quot; (if not specified &quot;OEL6&quot; will be the default). If the base OS
 912 is &quot;Fedora&quot; the corresponding Fedora release can be specified with the
 913 help of the `BASE_OS_VERSION` option (with &quot;27&quot; as default version).
 914 If the build is successful, the new devkits can be found in the
 915 `build/devkit/result` subdirectory:
 916 ```
 917 cd make/devkit
 918 make TARGETS=&quot;ppc64le-linux-gnu aarch64-linux-gnu&quot; BASE_OS=Fedora BASE_OS_VERSION=21
 919 ls -1 ../../build/devkit/result/
 920 x86_64-linux-gnu-to-aarch64-linux-gnu
 921 x86_64-linux-gnu-to-ppc64le-linux-gnu
 922 ```
 923 
 924 Notice that devkits are not only useful for targeting different build
 925 platforms. Because they contain the full build dependencies for a
 926 system (i.e. compiler and root file system), they can easily be used
 927 to build well-known, reliable and reproducible build environments. You
 928 can for example create and use a devkit with GCC 7.3 and a Fedora 12
 929 sysroot environment (with glibc 2.11) on Ubuntu 14.04 (which doesn&#39;t
 930 have GCC 7.3 by default) to produce OpenJDK binaries which will run on
 931 all Linux systems with runtime libraries newer than the ones from
 932 Fedora 12 (e.g. Ubuntu 16.04, SLES 11 or RHEL 6).
 933 
 934 ### Boot JDK and Build JDK
 935 
 936 When cross-compiling, make sure you use a boot JDK that runs on the *build*
 937 system, and not on the *target* system.
 938 
 939 To be able to build, we need a &quot;Build JDK&quot;, which is a JDK built from the
 940 current sources (that is, the same as the end result of the entire build
 941 process), but able to run on the *build* system, and not the *target* system.
 942 (In contrast, the Boot JDK should be from an older release, e.g. JDK 8 when
 943 building JDK 9.)
 944 
 945 The build process will create a minimal Build JDK for you, as part of building.
 946 To speed up the build, you can use `--with-build-jdk` to `configure` to point
 947 to a pre-built Build JDK. Please note that the build result is unpredictable,
 948 and can possibly break in subtle ways, if the Build JDK does not **exactly**
 949 match the current sources.
 950 
 951 ### Specifying the Target Platform
 952 
 953 You *must* specify the target platform when cross-compiling. Doing so will also
 954 automatically turn the build into a cross-compiling mode. The simplest way to
 955 do this is to use the `--openjdk-target` argument, e.g.
 956 `--openjdk-target=arm-linux-gnueabihf`. or `--openjdk-target=aarch64-oe-linux`.
 957 This will automatically set the `--build`, `--host` and `--target` options for
 958 autoconf, which can otherwise be confusing. (In autoconf terminology, the
 959 &quot;target&quot; is known as &quot;host&quot;, and &quot;target&quot; is used for building a Canadian
 960 cross-compiler.)
 961 
 962 ### Toolchain Considerations
 963 
 964 You will need two copies of your toolchain, one which generates output that can
 965 run on the target system (the normal, or *target*, toolchain), and one that
 966 generates output that can run on the build system (the *build* toolchain). Note
 967 that cross-compiling is only supported for gcc at the time being. The gcc
 968 standard is to prefix cross-compiling toolchains with the target denominator.
 969 If you follow this standard, `configure` is likely to pick up the toolchain
 970 correctly.
 971 
 972 The *build* toolchain will be autodetected just the same way the normal
 973 *build*/*target* toolchain will be autodetected when not cross-compiling. If
 974 this is not what you want, or if the autodetection fails, you can specify a
 975 devkit containing the *build* toolchain using `--with-build-devkit` to
 976 `configure`, or by giving `BUILD_CC` and `BUILD_CXX` arguments.
 977 
 978 It is often helpful to locate the cross-compilation tools, headers and
 979 libraries in a separate directory, outside the normal path, and point out that
 980 directory to `configure`. Do this by setting the sysroot (`--with-sysroot`) and
 981 appending the directory when searching for cross-compilations tools
 982 (`--with-toolchain-path`). As a compact form, you can also use `--with-devkit`
 983 to point to a single directory, if it is correctly setup. (See `basics.m4` for
 984 details.)
 985 
 986 ### Native Libraries
 987 
 988 You will need copies of external native libraries for the *target* system,
 989 present on the *build* machine while building.
 990 
 991 Take care not to replace the *build* system&#39;s version of these libraries by
 992 mistake, since that can render the *build* machine unusable.
 993 
 994 Make sure that the libraries you point to (ALSA, X11, etc) are for the
 995 *target*, not the *build*, platform.
 996 
 997 #### ALSA
 998 
 999 You will need alsa libraries suitable for your *target* system. For most cases,
1000 using Debian&#39;s pre-built libraries work fine.
1001 
1002 Note that alsa is needed even if you only want to build a headless JDK.
1003 
1004   * Go to [Debian Package Search](https://www.debian.org/distrib/packages) and
1005     search for the `libasound2` and `libasound2-dev` packages for your *target*
1006     system. Download them to /tmp.
1007 
1008   * Install the libraries into the cross-compilation toolchain. For instance:
1009 ```
1010 cd /tools/gcc-linaro-arm-linux-gnueabihf-raspbian-2012.09-20120921_linux/arm-linux-gnueabihf/libc
1011 dpkg-deb -x /tmp/libasound2_1.0.25-4_armhf.deb .
1012 dpkg-deb -x /tmp/libasound2-dev_1.0.25-4_armhf.deb .
1013 ```
1014 
1015   * If alsa is not properly detected by `configure`, you can point it out by
1016     `--with-alsa`.
1017 
1018 #### X11
1019 
1020 You will need X11 libraries suitable for your *target* system. For most cases,
1021 using Debian&#39;s pre-built libraries work fine.
1022 
1023 Note that X11 is needed even if you only want to build a headless JDK.
1024 
1025   * Go to [Debian Package Search](https://www.debian.org/distrib/packages),
1026     search for the following packages for your *target* system, and download them
1027     to /tmp/target-x11:
1028       * libxi
1029       * libxi-dev
1030       * x11proto-core-dev
1031       * x11proto-input-dev
1032       * x11proto-kb-dev
1033       * x11proto-render-dev
1034       * x11proto-xext-dev
1035       * libice-dev
1036       * libxrender
1037       * libxrender-dev
1038       * libxrandr-dev
1039       * libsm-dev
1040       * libxt-dev
1041       * libx11
1042       * libx11-dev
1043       * libxtst
1044       * libxtst-dev
1045       * libxext
1046       * libxext-dev
1047 
1048   * Install the libraries into the cross-compilation toolchain. For instance:
1049     ```
1050     cd /tools/gcc-linaro-arm-linux-gnueabihf-raspbian-2012.09-20120921_linux/arm-linux-gnueabihf/libc/usr
1051     mkdir X11R6
1052     cd X11R6
1053     for deb in /tmp/target-x11/*.deb ; do dpkg-deb -x $deb . ; done
1054     mv usr/* .
1055     cd lib
1056     cp arm-linux-gnueabihf/* .
1057     ```
1058 
1059     You can ignore the following messages. These libraries are not needed to
1060     successfully complete a full JDK build.
1061     ```
1062     cp: cannot stat `arm-linux-gnueabihf/libICE.so&#39;: No such file or directory
1063     cp: cannot stat `arm-linux-gnueabihf/libSM.so&#39;: No such file or directory
1064     cp: cannot stat `arm-linux-gnueabihf/libXt.so&#39;: No such file or directory
1065     ```
1066 
1067   * If the X11 libraries are not properly detected by `configure`, you can
1068     point them out by `--with-x`.
1069 
1070 ### Creating And Using Sysroots With qemu-deboostrap
1071 
1072 Fortunately, you can create sysroots for foreign architectures with tools
1073 provided by your OS. On Debian/Ubuntu systems, one could use `qemu-deboostrap` to
1074 create the *target* system chroot, which would have the native libraries and headers
1075 specific to that *target* system. After that, we can use the cross-compiler on the *build*
1076 system, pointing into chroot to get the build dependencies right. This allows building
1077 for foreign architectures with native compilation speed.
1078 
1079 For example, cross-compiling to AArch64 from x86_64 could be done like this:
1080 
1081   * Install cross-compiler on the *build* system:
1082 ```
1083 apt install g++-aarch64-linux-gnu gcc-aarch64-linux-gnu
1084 ```
1085 
1086   * Create chroot on the *build* system, configuring it for *target* system:
1087 ```
1088 sudo qemu-debootstrap --arch=arm64 --verbose \
1089        --include=fakeroot,build-essential,libx11-dev,libxext-dev,libxrender-dev,libxrandr-dev,libxtst-dev,libxt-dev,libcups2-dev,libfontconfig1-dev,libasound2-dev,libfreetype6-dev,libpng12-dev \
1090        --resolve-deps jessie /chroots/arm64 http://httpredir.debian.org/debian/
1091 ```
1092 
1093   * Configure and build with newly created chroot as sysroot/toolchain-path:
1094 ```
1095 CC=aarch64-linux-gnu-gcc CXX=aarch64-linux-gnu-g++ sh ./configure --openjdk-target=aarch64-linux-gnu --with-sysroot=/chroots/arm64/ --with-toolchain-path=/chroots/arm64/
1096 make images
1097 ls build/linux-aarch64-normal-server-release/
1098 ```
1099 
1100 The build does not create new files in that chroot, so it can be reused for multiple builds
1101 without additional cleanup.
1102 
1103 Architectures that are known to successfully cross-compile like this are:
1104 
1105   Target        `CC`                      `CXX`                       `--arch=...`  `--openjdk-target=...`
1106   ------------  ------------------------- --------------------------- ------------- -----------------------
1107   x86           default                   default                     i386          i386-linux-gnu
1108   armhf         gcc-arm-linux-gnueabihf   g++-arm-linux-gnueabihf     armhf         arm-linux-gnueabihf
1109   aarch64       gcc-aarch64-linux-gnu     g++-aarch64-linux-gnu       arm64         aarch64-linux-gnu
1110   ppc64el       gcc-powerpc64le-linux-gnu g++-powerpc64le-linux-gnu   ppc64el       powerpc64le-linux-gnu
1111   s390x         gcc-s390x-linux-gnu       g++-s390x-linux-gnu         s390x         s390x-linux-gnu
1112 
1113 Additional architectures might be supported by Debian/Ubuntu Ports.
1114 
1115 ### Building for ARM/aarch64
1116 
1117 A common cross-compilation target is the ARM CPU. When building for ARM, it is
1118 useful to set the ABI profile. A number of pre-defined ABI profiles are
1119 available using `--with-abi-profile`: arm-vfp-sflt, arm-vfp-hflt, arm-sflt,
1120 armv5-vfp-sflt, armv6-vfp-hflt. Note that soft-float ABIs are no longer
1121 properly supported by the JDK.
1122 
1123 ### Verifying the Build
1124 
1125 The build will end up in a directory named like
1126 `build/linux-arm-normal-server-release`.
1127 
1128 Inside this build output directory, the `images/jdk` will contain the newly
1129 built JDK, for your *target* system.
1130 
1131 Copy these folders to your *target* system. Then you can run e.g.
1132 `images/jdk/bin/java -version`.
1133 
1134 ## Build Performance
1135 
1136 Building the JDK requires a lot of horsepower. Some of the build tools can be
1137 adjusted to utilize more or less of resources such as parallel threads and
1138 memory. The `configure` script analyzes your system and selects reasonable
1139 values for such options based on your hardware. If you encounter resource
1140 problems, such as out of memory conditions, you can modify the detected values
1141 with:
1142 
1143   * `--with-num-cores` -- number of cores in the build system, e.g.
1144     `--with-num-cores=8`.
1145 
1146   * `--with-memory-size` -- memory (in MB) available in the build system, e.g.
1147     `--with-memory-size=1024`
1148 
1149 You can also specify directly the number of build jobs to use with
1150 `--with-jobs=N` to `configure`, or `JOBS=N` to `make`. Do not use the `-j` flag
1151 to `make`. In most cases it will be ignored by the makefiles, but it can cause
1152 problems for some make targets.
1153 
1154 It might also be necessary to specify the JVM arguments passed to the Boot JDK,
1155 using e.g. `--with-boot-jdk-jvmargs=&quot;-Xmx8G&quot;`. Doing so will override the
1156 default JVM arguments passed to the Boot JDK.
1157 
1158 At the end of a successful execution of `configure`, you will get a performance
1159 summary, indicating how well the build will perform. Here you will also get
1160 performance hints. If you want to build fast, pay attention to those!
1161 
1162 If you want to tweak build performance, run with `make LOG=info` to get a build
1163 time summary at the end of the build process.
1164 
1165 ### Disk Speed
1166 
1167 If you are using network shares, e.g. via NFS, for your source code, make sure
1168 the build directory is situated on local disk (e.g. by `ln -s
1169 /localdisk/jdk-build $JDK-SHARE/build`). The performance penalty is extremely
1170 high for building on a network share; close to unusable.
1171 
1172 Also, make sure that your build tools (including Boot JDK and toolchain) is
1173 located on a local disk and not a network share.
1174 
1175 As has been stressed elsewhere, do use SSD for source code and build directory,
1176 as well as (if possible) the build tools.
1177 
1178 ### Virus Checking
1179 
1180 The use of virus checking software, especially on Windows, can *significantly*
1181 slow down building of the JDK. If possible, turn off such software, or exclude
1182 the directory containing the JDK source code from on-the-fly checking.
1183 
1184 ### Ccache
1185 
1186 The JDK build supports building with ccache when using gcc or clang. Using
1187 ccache can radically speed up compilation of native code if you often rebuild
1188 the same sources. Your milage may vary however, so we recommend evaluating it
1189 for yourself. To enable it, make sure it&#39;s on the path and configure with
1190 `--enable-ccache`.
1191 
1192 ### Precompiled Headers
1193 
1194 By default, the Hotspot build uses preccompiled headers (PCH) on the toolchains
1195 were it is properly supported (clang, gcc, and Visual Studio). Normally, this
1196 speeds up the build process, but in some circumstances, it can actually slow
1197 things down.
1198 
1199 You can experiment by disabling precompiled headers using
1200 `--disable-precompiled-headers`.
1201 
1202 ### Icecc / icecream
1203 
1204 [icecc/icecream](http://github.com/icecc/icecream) is a simple way to setup a
1205 distributed compiler network. If you have multiple machines available for
1206 building the JDK, you can drastically cut individual build times by utilizing
1207 it.
1208 
1209 To use, setup an icecc network, and install icecc on the build machine. Then
1210 run `configure` using `--enable-icecc`.
1211 
1212 ### Using sjavac
1213 
1214 To speed up Java compilation, especially incremental compilations, you can try
1215 the experimental sjavac compiler by using `--enable-sjavac`.
1216 
1217 ### Building the Right Target
1218 
1219 Selecting the proper target to build can have dramatic impact on build time.
1220 For normal usage, `jdk` or the default target is just fine. You only need to
1221 build `images` for shipping, or if your tests require it.
1222 
1223 See also [Using Fine-Grained Make Targets](#using-fine-grained-make-targets) on
1224 how to build an even smaller subset of the product.
1225 
1226 ## Troubleshooting
1227 
1228 If your build fails, it can sometimes be difficult to pinpoint the problem or
1229 find a proper solution.
1230 
1231 ### Locating the Source of the Error
1232 
1233 When a build fails, it can be hard to pinpoint the actual cause of the error.
1234 In a typical build process, different parts of the product build in parallel,
1235 with the output interlaced.
1236 
1237 #### Build Failure Summary
1238 
1239 To help you, the build system will print a failure summary at the end. It looks
1240 like this:
1241 
1242 ```
1243 ERROR: Build failed for target &#39;hotspot&#39; in configuration &#39;linux-x64&#39; (exit code 2)
1244 
1245 === Output from failing command(s) repeated here ===
1246 * For target hotspot_variant-server_libjvm_objs_psMemoryPool.o:
1247 /localhome/hg/jdk9-sandbox/hotspot/src/share/vm/services/psMemoryPool.cpp:1:1: error: &#39;failhere&#39; does not name a type
1248    ... (rest of output omitted)
1249 
1250 * All command lines available in /localhome/hg/jdk9-sandbox/build/linux-x64/make-support/failure-logs.
1251 === End of repeated output ===
1252 
1253 === Make failed targets repeated here ===
1254 lib/CompileJvm.gmk:207: recipe for target &#39;/localhome/hg/jdk9-sandbox/build/linux-x64/hotspot/variant-server/libjvm/objs/psMemoryPool.o&#39; failed
1255 make/Main.gmk:263: recipe for target &#39;hotspot-server-libs&#39; failed
1256 === End of repeated output ===
1257 
1258 Hint: Try searching the build log for the name of the first failed target.
1259 Hint: If caused by a warning, try configure --disable-warnings-as-errors.
1260 ```
1261 
1262 Let&#39;s break it down! First, the selected configuration, and the top-level
1263 target you entered on the command line that caused the failure is printed.
1264 
1265 Then, between the `Output from failing command(s) repeated here` and `End of
1266 repeated output` the first lines of output (stdout and stderr) from the actual
1267 failing command is repeated. In most cases, this is the error message that
1268 caused the build to fail. If multiple commands were failing (this can happen in
1269 a parallel build), output from all failed commands will be printed here.
1270 
1271 The path to the `failure-logs` directory is printed. In this file you will find
1272 a `&lt;target&gt;.log` file that contains the output from this command in its
1273 entirety, and also a `&lt;target&gt;.cmd`, which contain the complete command line
1274 used for running this command. You can re-run the failing command by executing
1275 `. &lt;path to failure-logs&gt;/&lt;target&gt;.cmd` in your shell.
1276 
1277 Another way to trace the failure is to follow the chain of make targets, from
1278 top-level targets to individual file targets. Between `Make failed targets
1279 repeated here` and `End of repeated output` the output from make showing this
1280 chain is repeated. The first failed recipe will typically contain the full path
1281 to the file in question that failed to compile. Following lines will show a
1282 trace of make targets why we ended up trying to compile that file.
1283 
1284 Finally, some hints are given on how to locate the error in the complete log.
1285 In this example, we would try searching the log file for &quot;`psMemoryPool.o`&quot;.
1286 Another way to quickly locate make errors in the log is to search for &quot;`]
1287 Error`&quot; or &quot;`***`&quot;.
1288 
1289 Note that the build failure summary will only help you if the issue was a
1290 compilation failure or similar. If the problem is more esoteric, or is due to
1291 errors in the build machinery, you will likely get empty output logs, and `No
1292 indication of failed target found` instead of the make target chain.
1293 
1294 #### Checking the Build Log File
1295 
1296 The output (stdout and stderr) from the latest build is always stored in
1297 `$BUILD/build.log`. The previous build log is stored as `build.log.old`. This
1298 means that it is not necessary to redirect the build output yourself if you
1299 want to process it.
1300 
1301 You can increase the verbosity of the log file, by the `LOG` control variable
1302 to `make`. If you want to see the command lines used in compilations, use
1303 `LOG=cmdlines`. To increase the general verbosity, use `LOG=info`, `LOG=debug`
1304 or `LOG=trace`. Both of these can be combined with `cmdlines`, e.g.
1305 `LOG=info,cmdlines`. The `debug` log level will show most shell commands
1306 executed by make, and `trace` will show all. Beware that both these log levels
1307 will produce a massive build log!
1308 
1309 ### Fixing Unexpected Build Failures
1310 
1311 Most of the time, the build will fail due to incorrect changes in the source
1312 code.
1313 
1314 Sometimes the build can fail with no apparent changes that have caused the
1315 failure. If this is the first time you are building the JDK on this particular
1316 computer, and the build fails, the problem is likely with your build
1317 environment. But even if you have previously built the JDK with success, and it
1318 now fails, your build environment might have changed (perhaps due to OS
1319 upgrades or similar). But most likely, such failures are due to problems with
1320 the incremental rebuild.
1321 
1322 #### Problems with the Build Environment
1323 
1324 Make sure your configuration is correct. Re-run `configure`, and look for any
1325 warnings. Warnings that appear in the middle of the `configure` output is also
1326 repeated at the end, after the summary. The entire log is stored in
1327 `$BUILD/configure.log`.
1328 
1329 Verify that the summary at the end looks correct. Are you indeed using the Boot
1330 JDK and native toolchain that you expect?
1331 
1332 By default, the JDK has a strict approach where warnings from the compiler is
1333 considered errors which fail the build. For very new or very old compiler
1334 versions, this can trigger new classes of warnings, which thus fails the build.
1335 Run `configure` with `--disable-warnings-as-errors` to turn of this behavior.
1336 (The warnings will still show, but not make the build fail.)
1337 
1338 #### Problems with Incremental Rebuilds
1339 
1340 Incremental rebuilds mean that when you modify part of the product, only the
1341 affected parts get rebuilt. While this works great in most cases, and
1342 significantly speed up the development process, from time to time complex
1343 interdependencies will result in an incorrect build result. This is the most
1344 common cause for unexpected build problems.
1345 
1346 Here are a suggested list of things to try if you are having unexpected build
1347 problems. Each step requires more time than the one before, so try them in
1348 order. Most issues will be solved at step 1 or 2.
1349 
1350  1. Make sure your repository is up-to-date
1351 
1352     Run `hg pull -u` to make sure you have the latest changes.
1353 
1354  2. Clean build results
1355 
1356     The simplest way to fix incremental rebuild issues is to run `make clean`.
1357     This will remove all build results, but not the configuration or any build
1358     system support artifacts. In most cases, this will solve build errors
1359     resulting from incremental build mismatches.
1360 
1361  3. Completely clean the build directory.
1362 
1363     If this does not work, the next step is to run `make dist-clean`, or
1364     removing the build output directory (`$BUILD`). This will clean all
1365     generated output, including your configuration. You will need to re-run
1366     `configure` after this step. A good idea is to run `make
1367     print-configuration` before running `make dist-clean`, as this will print
1368     your current `configure` command line. Here&#39;s a way to do this:
1369 
1370     ```
1371     make print-configuration &gt; current-configuration
1372     make dist-clean
1373     bash configure $(cat current-configuration)
1374     make
1375     ```
1376 
1377  4. Re-clone the Mercurial repository
1378 
1379     Sometimes the Mercurial repository gets in a state that causes the product
1380     to be un-buildable. In such a case, the simplest solution is often the
1381     &quot;sledgehammer approach&quot;: delete the entire repository, and re-clone it.
1382     If you have local changes, save them first to a different location using
1383     `hg export`.
1384 
1385 ### Specific Build Issues
1386 
1387 #### Clock Skew
1388 
1389 If you get an error message like this:
1390 ```
1391 File &#39;xxx&#39; has modification time in the future.
1392 Clock skew detected. Your build may be incomplete.
1393 ```
1394 then the clock on your build machine is out of sync with the timestamps on the
1395 source files. Other errors, apparently unrelated but in fact caused by the
1396 clock skew, can occur along with the clock skew warnings. These secondary
1397 errors may tend to obscure the fact that the true root cause of the problem is
1398 an out-of-sync clock.
1399 
1400 If you see these warnings, reset the clock on the build machine, run `make
1401 clean` and restart the build.
1402 
1403 #### Out of Memory Errors
1404 
1405 On Windows, you might get error messages like this:
1406 ```
1407 fatal error - couldn&#39;t allocate heap
1408 cannot create ... Permission denied
1409 spawn failed
1410 ```
1411 This can be a sign of a Cygwin problem. See the information about solving
1412 problems in the [Cygwin](#cygwin) section. Rebooting the computer might help
1413 temporarily.
1414 
1415 ### Getting Help
1416 
1417 If none of the suggestions in this document helps you, or if you find what you
1418 believe is a bug in the build system, please contact the Build Group by sending
1419 a mail to [build-dev@openjdk.java.net](mailto:build-dev@openjdk.java.net).
1420 Please include the relevant parts of the configure and/or build log.
1421 
1422 If you need general help or advice about developing for the JDK, you can also
1423 contact the Adoption Group. See the section on [Contributing to OpenJDK](
1424 #contributing-to-openjdk) for more information.
1425 
1426 ## Hints and Suggestions for Advanced Users
1427 
1428 ### Setting Up a Repository for Pushing Changes (defpath)
1429 
1430 To help you prepare a proper push path for a Mercurial repository, there exists
1431 a useful tool known as [defpath](
1432 http://openjdk.java.net/projects/code-tools/defpath). It will help you setup a
1433 proper push path for pushing changes to the JDK.
1434 
1435 Install the extension by cloning
1436 `http://hg.openjdk.java.net/code-tools/defpath` and updating your `.hgrc` file.
1437 Here&#39;s one way to do this:
1438 
1439 ```
1440 cd ~
1441 mkdir hg-ext
1442 cd hg-ext
1443 hg clone http://hg.openjdk.java.net/code-tools/defpath
1444 cat &lt;&lt; EOT &gt;&gt; ~/.hgrc
1445 [extensions]
1446 defpath=~/hg-ext/defpath/defpath.py
1447 EOT
1448 ```
1449 
1450 You can now setup a proper push path using:
1451 ```
1452 hg defpath -d -u &lt;your OpenJDK username&gt;
1453 ```
1454 
1455 ### Bash Completion
1456 
1457 The `configure` and `make` commands tries to play nice with bash command-line
1458 completion (using `&lt;tab&gt;` or `&lt;tab&gt;&lt;tab&gt;`). To use this functionality, make
1459 sure you enable completion in your `~/.bashrc` (see instructions for bash in
1460 your operating system).
1461 
1462 Make completion will work out of the box, and will complete valid make targets.
1463 For instance, typing `make jdk-i&lt;tab&gt;` will complete to `make jdk-image`.
1464 
1465 The `configure` script can get completion for options, but for this to work you
1466 need to help `bash` on the way. The standard way of running the script, `bash
1467 configure`, will not be understood by bash completion. You need `configure` to
1468 be the command to run. One way to achieve this is to add a simple helper script
1469 to your path:
1470 
1471 ```
1472 cat &lt;&lt; EOT &gt; /tmp/configure
1473 #!/bin/bash
1474 if [ \$(pwd) = \$(cd \$(dirname \$0); pwd) ] ; then
1475   echo &gt;&amp;2 &quot;Abort: Trying to call configure helper recursively&quot;
1476   exit 1
1477 fi
1478 
1479 bash \$PWD/configure &quot;\$@&quot;
1480 EOT
1481 chmod +x /tmp/configure
1482 sudo mv /tmp/configure /usr/local/bin
1483 ```
1484 
1485 Now `configure --en&lt;tab&gt;-dt&lt;tab&gt;` will result in `configure --enable-dtrace`.
1486 
1487 ### Using Multiple Configurations
1488 
1489 You can have multiple configurations for a single source repository. When you
1490 create a new configuration, run `configure --with-conf-name=&lt;name&gt;` to create a
1491 configuration with the name `&lt;name&gt;`. Alternatively, you can create a directory
1492 under `build` and run `configure` from there, e.g. `mkdir build/&lt;name&gt; &amp;&amp; cd
1493 build/&lt;name&gt; &amp;&amp; bash ../../configure`.
1494 
1495 Then you can build that configuration using `make CONF_NAME=&lt;name&gt;` or `make
1496 CONF=&lt;pattern&gt;`, where `&lt;pattern&gt;` is a substring matching one or several
1497 configurations, e.g. `CONF=debug`. The special empty pattern (`CONF=`) will
1498 match *all* available configuration, so `make CONF= hotspot` will build the
1499 `hotspot` target for all configurations. Alternatively, you can execute `make`
1500 in the configuration directory, e.g. `cd build/&lt;name&gt; &amp;&amp; make`.
1501 
1502 ### Handling Reconfigurations
1503 
1504 If you update the repository and part of the configure script has changed, the
1505 build system will force you to re-run `configure`.
1506 
1507 Most of the time, you will be fine by running `configure` again with the same
1508 arguments as the last time, which can easily be performed by `make
1509 reconfigure`. To simplify this, you can use the `CONF_CHECK` make control
1510 variable, either as `make CONF_CHECK=auto`, or by setting an environment
1511 variable. For instance, if you add `export CONF_CHECK=auto` to your `.bashrc`
1512 file, `make` will always run `reconfigure` automatically whenever the configure
1513 script has changed.
1514 
1515 You can also use `CONF_CHECK=ignore` to skip the check for a needed configure
1516 update. This might speed up the build, but comes at the risk of an incorrect
1517 build result. This is only recommended if you know what you&#39;re doing.
1518 
1519 From time to time, you will also need to modify the command line to `configure`
1520 due to changes. Use `make print-configure` to show the command line used for
1521 your current configuration.
1522 
1523 ### Using Fine-Grained Make Targets
1524 
1525 The default behavior for make is to create consistent and correct output, at
1526 the expense of build speed, if necessary.
1527 
1528 If you are prepared to take some risk of an incorrect build, and know enough of
1529 the system to understand how things build and interact, you can speed up the
1530 build process considerably by instructing make to only build a portion of the
1531 product.
1532 
1533 #### Building Individual Modules
1534 
1535 The safe way to use fine-grained make targets is to use the module specific
1536 make targets. All source code in the JDK is organized so it belongs to a
1537 module, e.g. `java.base` or `jdk.jdwp.agent`. You can build only a specific
1538 module, by giving it as make target: `make jdk.jdwp.agent`. If the specified
1539 module depends on other modules (e.g. `java.base`), those modules will be built
1540 first.
1541 
1542 You can also specify a set of modules, just as you can always specify a set of
1543 make targets: `make jdk.crypto.cryptoki jdk.crypto.ec jdk.crypto.mscapi`
1544 
1545 #### Building Individual Module Phases
1546 
1547 The build process for each module is divided into separate phases. Not all
1548 modules need all phases. Which are needed depends on what kind of source code
1549 and other artifact the module consists of. The phases are:
1550 
1551   * `gensrc` (Generate source code to compile)
1552   * `gendata` (Generate non-source code artifacts)
1553   * `copy` (Copy resource artifacts)
1554   * `java` (Compile Java code)
1555   * `launchers` (Compile native executables)
1556   * `libs` (Compile native libraries)
1557 
1558 You can build only a single phase for a module by using the notation
1559 `$MODULE-$PHASE`. For instance, to build the `gensrc` phase for `java.base`,
1560 use `make java.base-gensrc`.
1561 
1562 Note that some phases may depend on others, e.g. `java` depends on `gensrc` (if
1563 present). Make will build all needed prerequisites before building the
1564 requested phase.
1565 
1566 #### Skipping the Dependency Check
1567 
1568 When using an iterative development style with frequent quick rebuilds, the
1569 dependency check made by make can take up a significant portion of the time
1570 spent on the rebuild. In such cases, it can be useful to bypass the dependency
1571 check in make.
1572 
1573 &gt; **Note that if used incorrectly, this can lead to a broken build!**
1574 
1575 To achieve this, append `-only` to the build target. For instance, `make
1576 jdk.jdwp.agent-java-only` will *only* build the `java` phase of the
1577 `jdk.jdwp.agent` module. If the required dependencies are not present, the
1578 build can fail. On the other hand, the execution time measures in milliseconds.
1579 
1580 A useful pattern is to build the first time normally (e.g. `make
1581 jdk.jdwp.agent`) and then on subsequent builds, use the `-only` make target.
1582 
1583 #### Rebuilding Part of java.base (JDK\_FILTER)
1584 
1585 If you are modifying files in `java.base`, which is the by far largest module
1586 in the JDK, then you need to rebuild all those files whenever a single file has
1587 changed. (This inefficiency will hopefully be addressed in JDK 10.)
1588 
1589 As a hack, you can use the make control variable `JDK_FILTER` to specify a
1590 pattern that will be used to limit the set of files being recompiled. For
1591 instance, `make java.base JDK_FILTER=javax/crypto` (or, to combine methods,
1592 `make java.base-java-only JDK_FILTER=javax/crypto`) will limit the compilation
1593 to files in the `javax.crypto` package.
1594 
1595 ### Learn About Mercurial
1596 
1597 To become an efficient JDK developer, it is recommended that you invest in
1598 learning Mercurial properly. Here are some links that can get you started:
1599 
1600   * [Mercurial for git users](http://www.mercurial-scm.org/wiki/GitConcepts)
1601   * [The official Mercurial tutorial](http://www.mercurial-scm.org/wiki/Tutorial)
1602   * [hg init](http://hginit.com/)
1603   * [Mercurial: The Definitive Guide](http://hgbook.red-bean.com/read/)
1604 
1605 ## Understanding the Build System
1606 
1607 This section will give you a more technical description on the details of the
1608 build system.
1609 
1610 ### Configurations
1611 
1612 The build system expects to find one or more configuration. These are
1613 technically defined by the `spec.gmk` in a subdirectory to the `build`
1614 subdirectory. The `spec.gmk` file is generated by `configure`, and contains in
1615 principle the configuration (directly or by files included by `spec.gmk`).
1616 
1617 You can, in fact, select a configuration to build by pointing to the `spec.gmk`
1618 file with the `SPEC` make control variable, e.g. `make SPEC=$BUILD/spec.gmk`.
1619 While this is not the recommended way to call `make` as a user, it is what is
1620 used under the hood by the build system.
1621 
1622 ### Build Output Structure
1623 
1624 The build output for a configuration will end up in `build/&lt;configuration
1625 name&gt;`, which we refer to as `$BUILD` in this document. The `$BUILD` directory
1626 contains the following important directories:
1627 
1628 ```
1629 buildtools/
1630 configure-support/
1631 hotspot/
1632 images/
1633 jdk/
1634 make-support/
1635 support/
1636 test-results/
1637 test-support/
1638 ```
1639 
1640 This is what they are used for:
1641 
1642   * `images`: This is the directory were the output of the `*-image` make
1643     targets end up. For instance, `make jdk-image` ends up in `images/jdk`.
1644 
1645   * `jdk`: This is the &quot;exploded image&quot;. After `make jdk`, you will be able to
1646     launch the newly built JDK by running `$BUILD/jdk/bin/java`.
1647 
1648   * `test-results`: This directory contains the results from running tests.
1649 
1650   * `support`: This is an area for intermediate files needed during the build,
1651     e.g. generated source code, object files and class files. Some noteworthy
1652     directories in `support` is `gensrc`, which contains the generated source
1653     code, and the `modules_*` directories, which contains the files in a
1654     per-module hierarchy that will later be collapsed into the `jdk` directory
1655     of the exploded image.
1656 
1657   * `buildtools`: This is an area for tools compiled for the build platform
1658     that are used during the rest of the build.
1659 
1660   * `hotspot`: This is an area for intermediate files needed when building
1661     hotspot.
1662 
1663   * `configure-support`, `make-support` and `test-support`: These directories
1664     contain files that are needed by the build system for `configure`, `make`
1665     and for running tests.
1666 
1667 ### Fixpath
1668 
1669 Windows path typically look like `C:\User\foo`, while Unix paths look like
1670 `/home/foo`. Tools with roots from Unix often experience issues related to this
1671 mismatch when running on Windows.
1672 
1673 In the JDK build, we always use Unix paths internally, and only just before
1674 calling a tool that does not understand Unix paths do we convert them to
1675 Windows paths.
1676 
1677 This conversion is done by the `fixpath` tool, which is a small wrapper that
1678 modifies unix-style paths to Windows-style paths in command lines. Fixpath is
1679 compiled automatically by `configure`.
1680 
1681 ### Native Debug Symbols
1682 
1683 Native libraries and executables can have debug symbol (and other debug
1684 information) associated with them. How this works is very much platform
1685 dependent, but a common problem is that debug symbol information takes a lot of
1686 disk space, but is rarely needed by the end user.
1687 
1688 The JDK supports different methods on how to handle debug symbols. The
1689 method used is selected by `--with-native-debug-symbols`, and available methods
1690 are `none`, `internal`, `external`, `zipped`.
1691 
1692   * `none` means that no debug symbols will be generated during the build.
1693 
1694   * `internal` means that debug symbols will be generated during the build, and
1695     they will be stored in the generated binary.
1696 
1697   * `external` means that debug symbols will be generated during the build, and
1698     after the compilation, they will be moved into a separate `.debuginfo` file.
1699     (This was previously known as FDS, Full Debug Symbols).
1700 
1701   * `zipped` is like `external`, but the .debuginfo file will also be zipped
1702     into a `.diz` file.
1703 
1704 When building for distribution, `zipped` is a good solution. Binaries built
1705 with `internal` is suitable for use by developers, since they facilitate
1706 debugging, but should be stripped before distributed to end users.
1707 
1708 ### Autoconf Details
1709 
1710 The `configure` script is based on the autoconf framework, but in some details
1711 deviate from a normal autoconf `configure` script.
1712 
1713 The `configure` script in the top level directory of the JDK is just a thin
1714 wrapper that calls `make/autoconf/configure`. This in turn will run `autoconf`
1715 to create the runnable (generated) configure script, as
1716 `.build/generated-configure.sh`. Apart from being responsible for the
1717 generation of the runnable script, the `configure` script also provides
1718 functionality that is not easily expressed in the normal Autoconf framework. As
1719 part of this functionality, the generated script is called.
1720 
1721 The build system will detect if the Autoconf source files have changed, and
1722 will trigger a regeneration of the generated script if needed. You can also
1723 manually request such an update by `bash configure autogen`.
1724 
1725 In previous versions of the JDK, the generated script was checked in at
1726 `make/autoconf/generated-configure.sh`. This is no longer the case.
1727 
1728 ### Developing the Build System Itself
1729 
1730 This section contains a few remarks about how to develop for the build system
1731 itself. It is not relevant if you are only making changes in the product source
1732 code.
1733 
1734 While technically using `make`, the make source files of the JDK does not
1735 resemble most other Makefiles. Instead of listing specific targets and actions
1736 (perhaps using patterns), the basic modus operandi is to call a high-level
1737 function (or properly, macro) from the API in `make/common`. For instance, to
1738 compile all classes in the `jdk.internal.foo` package in the `jdk.foo` module,
1739 a call like this would be made:
1740 
1741 ```
1742 $(eval $(call SetupJavaCompilation, BUILD_FOO_CLASSES, \
1743     SETUP := GENERATE_OLDBYTECODE, \
1744     SRC := $(TOPDIR)/src/jkd.foo/share/classes, \
1745     INCLUDES := jdk/internal/foo, \
1746     BIN := $(SUPPORT_OUTPUTDIR)/foo_classes, \
1747 ))
1748 ```
1749 
1750 By encapsulating and expressing the high-level knowledge of *what* should be
1751 done, rather than *how* it should be done (as is normal in Makefiles), we can
1752 build a much more powerful and flexible build system.
1753 
1754 Correct dependency tracking is paramount. Sloppy dependency tracking will lead
1755 to improper parallelization, or worse, race conditions.
1756 
1757 To test for/debug race conditions, try running `make JOBS=1` and `make
1758 JOBS=100` and see if it makes any difference. (It shouldn&#39;t).
1759 
1760 To compare the output of two different builds and see if, and how, they differ,
1761 run `$BUILD1/compare.sh -o $BUILD2`, where `$BUILD1` and `$BUILD2` are the two
1762 builds you want to compare.
1763 
1764 To automatically build two consecutive versions and compare them, use
1765 `COMPARE_BUILD`. The value of `COMPARE_BUILD` is a set of variable=value
1766 assignments, like this:
1767 ```
1768 make COMPARE_BUILD=CONF=--enable-new-hotspot-feature:MAKE=hotspot
1769 ```
1770 See `make/InitSupport.gmk` for details on how to use `COMPARE_BUILD`.
1771 
1772 To analyze build performance, run with `LOG=trace` and check `$BUILD/build-trace-time.log`.
1773 Use `JOBS=1` to avoid parallelism.
1774 
1775 Please check that you adhere to the [Code Conventions for the Build System](
1776 http://openjdk.java.net/groups/build/doc/code-conventions.html) before
1777 submitting patches.
1778 
1779 ## Contributing to the JDK
1780 
1781 So, now you&#39;ve built your JDK, and made your first patch, and want to
1782 contribute it back to the OpenJDK Community.
1783 
1784 First of all: Thank you! We gladly welcome your contribution.
1785 However, please bear in mind that the JDK is a massive project, and we must ask
1786 you to follow our rules and guidelines to be able to accept your contribution.
1787 
1788 The official place to start is the [&#39;How to contribute&#39; page](
1789 http://openjdk.java.net/contribute/). There is also an official (but somewhat
1790 outdated and skimpy on details) [Developer&#39;s Guide](
1791 http://openjdk.java.net/guide/).
1792 
1793 If this seems overwhelming to you, the Adoption Group is there to help you! A
1794 good place to start is their [&#39;New Contributor&#39; page](
1795 https://wiki.openjdk.java.net/display/Adoption/New+Contributor), or start
1796 reading the comprehensive [Getting Started Kit](
1797 https://adoptopenjdk.gitbooks.io/adoptopenjdk-getting-started-kit/en/). The
1798 Adoption Group will also happily answer any questions you have about
1799 contributing. Contact them by [mail](
1800 http://mail.openjdk.java.net/mailman/listinfo/adoption-discuss) or [IRC](
1801 http://openjdk.java.net/irc/).
1802 
1803 ---
1804 # Override styles from the base CSS file that are not ideal for this document.
1805 header-includes:
1806  - &#39;&lt;style type=&quot;text/css&quot;&gt;pre, code, tt { color: #1d6ae5; }&lt;/style&gt;&#39;
1807 ---
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>