<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.incubator.foreign/share/classes/jdk/incubator/foreign/AllocationScope.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>src/jdk.incubator.foreign/share/classes/jdk/incubator/foreign/AllocationScope.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 19  *  Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  *   Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  *  or visit www.oracle.com if you need additional information or have any
 23  *  questions.
 24  *
 25  */
 26 
 27 package jdk.incubator.foreign;
 28 
 29 import jdk.internal.foreign.BoundedAllocationScope;
 30 import jdk.internal.foreign.UnboundedAllocationScope;
 31 
 32 import java.lang.invoke.VarHandle;
 33 import java.util.OptionalLong;
 34 
 35 /**
 36  * This class provides a scope of given size, within which several allocations can be performed. An allocation scope can be backed
 37  * either by heap, or off-heap memory. Allocation scopes can be either &lt;em&gt;bounded&lt;/em&gt; or &lt;em&gt;unbounded&lt;/em&gt;, depending on whether the size
 38  * of the allocation scope is known statically. If an application knows before-hand how much memory it needs to allocate the values it needs,
<span class="line-modified"> 39  * using a &lt;em&gt;bound&lt;/em&gt; allocation scope will typically provide better performances than independently allocating the memory</span>
 40  * for each value (e.g. using {@link MemorySegment#allocateNative(long)}), or using an &lt;em&gt;unbounded&lt;/em&gt; allocation scope.
<span class="line-modified"> 41  * For this reason, using a bound allocation scope is recommended in cases where programs might need to emulate native stack allocation.</span>
 42  */
 43 public abstract class AllocationScope implements AutoCloseable {
 44 
 45     /**
<span class="line-modified"> 46      * If this allocation scope is bound, returns the size, in bytes, of this allocation scope.</span>
 47      * @return the size, in bytes, of this allocation scope (if available).
 48      */
 49     public abstract OptionalLong byteSize();
 50 
 51     /**
 52      * Returns the number of allocated bytes in this allocation scope.
 53      * @return the number of allocated bytes in this allocation scope.
 54      */
 55     public abstract long allocatedBytes();
 56 
 57     /**
 58      * Allocate a block of memory in this allocation scope with given layout and initialize it with given byte value.
 59      * The address returned by this method is associated with a segment which cannot be closed. Moreover, the returned
 60      * address must conform to the layout alignment constraints.
 61      * @param layout the layout of the block of memory to be allocated.
 62      * @param value the value to be set on the newly allocated memory block.
 63      * @return an address which points to the newly allocated memory block.
 64      * @throws OutOfMemoryError if there is not enough space left in this allocation scope, that is, if
 65      * {@code limit() - size() &lt; layout.byteSize()}.
 66      * @throws IllegalArgumentException if {@code layout.byteSize()) does not conform to the size of a byte value.
</pre>
</td>
<td>
<hr />
<pre>
 19  *  Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  *   Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  *  or visit www.oracle.com if you need additional information or have any
 23  *  questions.
 24  *
 25  */
 26 
 27 package jdk.incubator.foreign;
 28 
 29 import jdk.internal.foreign.BoundedAllocationScope;
 30 import jdk.internal.foreign.UnboundedAllocationScope;
 31 
 32 import java.lang.invoke.VarHandle;
 33 import java.util.OptionalLong;
 34 
 35 /**
 36  * This class provides a scope of given size, within which several allocations can be performed. An allocation scope can be backed
 37  * either by heap, or off-heap memory. Allocation scopes can be either &lt;em&gt;bounded&lt;/em&gt; or &lt;em&gt;unbounded&lt;/em&gt;, depending on whether the size
 38  * of the allocation scope is known statically. If an application knows before-hand how much memory it needs to allocate the values it needs,
<span class="line-modified"> 39  * using a &lt;em&gt;bounded&lt;/em&gt; allocation scope will typically provide better performances than independently allocating the memory</span>
 40  * for each value (e.g. using {@link MemorySegment#allocateNative(long)}), or using an &lt;em&gt;unbounded&lt;/em&gt; allocation scope.
<span class="line-modified"> 41  * For this reason, using a bounded allocation scope is recommended in cases where programs might need to emulate native stack allocation.</span>
 42  */
 43 public abstract class AllocationScope implements AutoCloseable {
 44 
 45     /**
<span class="line-modified"> 46      * If this allocation scope is bounded, returns the size, in bytes, of this allocation scope.</span>
 47      * @return the size, in bytes, of this allocation scope (if available).
 48      */
 49     public abstract OptionalLong byteSize();
 50 
 51     /**
 52      * Returns the number of allocated bytes in this allocation scope.
 53      * @return the number of allocated bytes in this allocation scope.
 54      */
 55     public abstract long allocatedBytes();
 56 
 57     /**
 58      * Allocate a block of memory in this allocation scope with given layout and initialize it with given byte value.
 59      * The address returned by this method is associated with a segment which cannot be closed. Moreover, the returned
 60      * address must conform to the layout alignment constraints.
 61      * @param layout the layout of the block of memory to be allocated.
 62      * @param value the value to be set on the newly allocated memory block.
 63      * @return an address which points to the newly allocated memory block.
 64      * @throws OutOfMemoryError if there is not enough space left in this allocation scope, that is, if
 65      * {@code limit() - size() &lt; layout.byteSize()}.
 66      * @throws IllegalArgumentException if {@code layout.byteSize()) does not conform to the size of a byte value.
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>