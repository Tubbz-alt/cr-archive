<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.incubator.jpackage/share/classes/jdk/incubator/jpackage/internal/AddLauncherArguments.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2018, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.incubator.jpackage.internal;
 27 
<a name="2" id="anc2"></a>
 28 import java.util.HashMap;
 29 import java.util.Map;
 30 import java.io.File;
 31 import java.util.List;
 32 import jdk.incubator.jpackage.internal.Arguments.CLIOptions;
 33 
 34 /*
 35  * AddLauncherArguments
 36  *
 37  * Processes a add-launcher properties file to create the Map of
 38  * bundle params applicable to the add-launcher:
 39  *
 40  * BundlerParams p = (new AddLauncherArguments(file)).getLauncherMap();
 41  *
 42  * A add-launcher is another executable program generated by either the
 43  * create-app-image mode or the create-installer mode.
 44  * The add-launcher may be the same program with different configuration,
 45  * or a completely different program created from the same files.
 46  *
 47  * There may be multiple add-launchers, each created by using the
 48  * command line arg &quot;--add-launcher &lt;file path&gt;
 49  *
 50  * The add-launcher properties file may have any of:
 51  *
 52  * appVersion
 53  * module
 54  * main-jar
 55  * main-class
 56  * icon
 57  * arguments
 58  * java-options
 59  * win-console
 60  * linux-app-category
 61  *
 62  */
 63 class AddLauncherArguments {
 64 
 65     private final String name;
 66     private final String filename;
 67     private Map&lt;String, String&gt; allArgs;
 68     private Map&lt;String, ? super Object&gt; bundleParams;
 69 
 70     AddLauncherArguments(String name, String filename) {
 71         this.name = name;
 72         this.filename = filename;
 73     }
 74 
 75     private void initLauncherMap() {
 76         if (bundleParams != null) {
 77             return;
 78         }
 79 
 80         allArgs = Arguments.getPropertiesFromFile(filename);
 81         allArgs.put(CLIOptions.NAME.getId(), name);
 82 
 83         bundleParams = new HashMap&lt;&gt;();
 84         String mainJar = getOptionValue(CLIOptions.MAIN_JAR);
 85         String mainClass = getOptionValue(CLIOptions.APPCLASS);
 86         String module = getOptionValue(CLIOptions.MODULE);
 87 
 88         if (module != null &amp;&amp; mainClass != null) {
 89             Arguments.putUnlessNull(bundleParams, CLIOptions.MODULE.getId(),
 90                     module + &quot;/&quot; + mainClass);
 91         } else if (module != null) {
 92             Arguments.putUnlessNull(bundleParams, CLIOptions.MODULE.getId(),
 93                     module);
 94         } else {
 95             Arguments.putUnlessNull(bundleParams, CLIOptions.MAIN_JAR.getId(),
 96                     mainJar);
 97             Arguments.putUnlessNull(bundleParams, CLIOptions.APPCLASS.getId(),
 98                     mainClass);
 99         }
100 
101         Arguments.putUnlessNull(bundleParams, CLIOptions.NAME.getId(),
102                 getOptionValue(CLIOptions.NAME));
103 
104         Arguments.putUnlessNull(bundleParams, CLIOptions.VERSION.getId(),
105                 getOptionValue(CLIOptions.VERSION));
106 
107         Arguments.putUnlessNull(bundleParams, CLIOptions.RELEASE.getId(),
108                 getOptionValue(CLIOptions.RELEASE));
109 
110         Arguments.putUnlessNull(bundleParams, CLIOptions.LINUX_CATEGORY.getId(),
111                 getOptionValue(CLIOptions.LINUX_CATEGORY));
112 
113         Arguments.putUnlessNull(bundleParams,
114                 CLIOptions.WIN_CONSOLE_HINT.getId(),
115                 getOptionValue(CLIOptions.WIN_CONSOLE_HINT));
116 
117         String value = getOptionValue(CLIOptions.ICON);
118         Arguments.putUnlessNull(bundleParams, CLIOptions.ICON.getId(),
119                 (value == null) ? null : new File(value));
120 
121         // &quot;arguments&quot; and &quot;java-options&quot; even if value is null:
122         if (allArgs.containsKey(CLIOptions.ARGUMENTS.getId())) {
123             String argumentStr = getOptionValue(CLIOptions.ARGUMENTS);
124             bundleParams.put(CLIOptions.ARGUMENTS.getId(),
125                     Arguments.getArgumentList(argumentStr));
126         }
127 
128         if (allArgs.containsKey(CLIOptions.JAVA_OPTIONS.getId())) {
129             String jvmargsStr = getOptionValue(CLIOptions.JAVA_OPTIONS);
130             bundleParams.put(CLIOptions.JAVA_OPTIONS.getId(),
131                     Arguments.getArgumentList(jvmargsStr));
132         }
133     }
134 
135     private String getOptionValue(CLIOptions option) {
136         if (option == null || allArgs == null) {
137             return null;
138         }
139 
140         String id = option.getId();
141 
142         if (allArgs.containsKey(id)) {
143             return allArgs.get(id);
144         }
145 
146         return null;
147     }
148 
149     Map&lt;String, ? super Object&gt; getLauncherMap() {
150         initLauncherMap();
151         return bundleParams;
152     }
153 
154     static Map&lt;String, ? super Object&gt; merge(
155             Map&lt;String, ? super Object&gt; original,
156             Map&lt;String, ? super Object&gt; additional, String... exclude) {
157         Map&lt;String, ? super Object&gt; tmp = new HashMap&lt;&gt;(original);
158         List.of(exclude).forEach(tmp::remove);
159 
160         if (additional.containsKey(CLIOptions.MODULE.getId())) {
161             tmp.remove(CLIOptions.MAIN_JAR.getId());
162             tmp.remove(CLIOptions.APPCLASS.getId());
163         } else if (additional.containsKey(CLIOptions.MAIN_JAR.getId())) {
164             tmp.remove(CLIOptions.MODULE.getId());
165         }
166         if (additional.containsKey(CLIOptions.ARGUMENTS.getId())) {
167             // if add launcher properties file contains &quot;arguments&quot;, even with
168             // null value, disregard the &quot;arguments&quot; from command line
169             tmp.remove(CLIOptions.ARGUMENTS.getId());
170         }
171         if (additional.containsKey(CLIOptions.JAVA_OPTIONS.getId())) {
172             // same thing for java-options
173             tmp.remove(CLIOptions.JAVA_OPTIONS.getId());
174         }
175         tmp.putAll(additional);
176         return tmp;
177     }
178 
179 }
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>