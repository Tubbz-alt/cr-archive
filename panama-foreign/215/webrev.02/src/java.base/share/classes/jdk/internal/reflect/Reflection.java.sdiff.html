<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/jdk/internal/reflect/Reflection.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../module/ServicesCatalog.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ReflectionFactory.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/jdk/internal/reflect/Reflection.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.internal.reflect;
 27 
 28 import java.lang.reflect.*;
 29 import java.util.HashMap;
 30 import java.util.Map;
 31 import java.util.Objects;
 32 import java.util.Set;
 33 import jdk.internal.HotSpotIntrinsicCandidate;

 34 import jdk.internal.misc.VM;
 35 
 36 /** Common utility routines used by both java.lang and
 37     java.lang.reflect */
 38 
 39 public class Reflection {
 40 
 41     /** Used to filter out fields and methods from certain classes from public
 42         view, where they are sensitive or they may contain VM-internal objects.
 43         These Maps are updated very rarely. Rather than synchronize on
 44         each access, we use copy-on-write */
 45     private static volatile Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; fieldFilterMap;
 46     private static volatile Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; methodFilterMap;
 47     private static final String WILDCARD = &quot;*&quot;;
 48     public static final Set&lt;String&gt; ALL_MEMBERS = Set.of(WILDCARD);
 49 
 50     static {
 51         fieldFilterMap = Map.of(
 52             Reflection.class, ALL_MEMBERS,
 53             AccessibleObject.class, ALL_MEMBERS,
</pre>
<hr />
<pre>
319         for (Member member : members) {
320             if (!filteredNames.contains(member.getName())) {
321                 newMembers[destIdx++] = member;
322             }
323         }
324         return newMembers;
325     }
326 
327     /**
328      * Tests if the given method is caller-sensitive and the declaring class
329      * is defined by either the bootstrap class loader or platform class loader.
330      */
331     public static boolean isCallerSensitive(Method m) {
332         final ClassLoader loader = m.getDeclaringClass().getClassLoader();
333         if (VM.isSystemDomainLoader(loader)) {
334             return m.isAnnotationPresent(CallerSensitive.class);
335         }
336         return false;
337     }
338 








339     /**
340      * Returns an IllegalAccessException with an exception message based on
341      * the access that is denied.
342      */
343     public static IllegalAccessException newIllegalAccessException(Class&lt;?&gt; currentClass,
344                                                                    Class&lt;?&gt; memberClass,
345                                                                    Class&lt;?&gt; targetClass,
346                                                                    int modifiers)
347     {
348         if (currentClass == null)
349             return newIllegalAccessException(memberClass, modifiers);
350 
351         String currentSuffix = &quot;&quot;;
352         String memberSuffix = &quot;&quot;;
353         Module m1 = currentClass.getModule();
354         if (m1.isNamed())
355             currentSuffix = &quot; (in &quot; + m1 + &quot;)&quot;;
356         Module m2 = memberClass.getModule();
357         if (m2.isNamed())
358             memberSuffix = &quot; (in &quot; + m2 + &quot;)&quot;;
</pre>
</td>
<td>
<hr />
<pre>
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.internal.reflect;
 27 
 28 import java.lang.reflect.*;
 29 import java.util.HashMap;
 30 import java.util.Map;
 31 import java.util.Objects;
 32 import java.util.Set;
 33 import jdk.internal.HotSpotIntrinsicCandidate;
<span class="line-added"> 34 import jdk.internal.access.SharedSecrets;</span>
 35 import jdk.internal.misc.VM;
 36 
 37 /** Common utility routines used by both java.lang and
 38     java.lang.reflect */
 39 
 40 public class Reflection {
 41 
 42     /** Used to filter out fields and methods from certain classes from public
 43         view, where they are sensitive or they may contain VM-internal objects.
 44         These Maps are updated very rarely. Rather than synchronize on
 45         each access, we use copy-on-write */
 46     private static volatile Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; fieldFilterMap;
 47     private static volatile Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; methodFilterMap;
 48     private static final String WILDCARD = &quot;*&quot;;
 49     public static final Set&lt;String&gt; ALL_MEMBERS = Set.of(WILDCARD);
 50 
 51     static {
 52         fieldFilterMap = Map.of(
 53             Reflection.class, ALL_MEMBERS,
 54             AccessibleObject.class, ALL_MEMBERS,
</pre>
<hr />
<pre>
320         for (Member member : members) {
321             if (!filteredNames.contains(member.getName())) {
322                 newMembers[destIdx++] = member;
323             }
324         }
325         return newMembers;
326     }
327 
328     /**
329      * Tests if the given method is caller-sensitive and the declaring class
330      * is defined by either the bootstrap class loader or platform class loader.
331      */
332     public static boolean isCallerSensitive(Method m) {
333         final ClassLoader loader = m.getDeclaringClass().getClassLoader();
334         if (VM.isSystemDomainLoader(loader)) {
335             return m.isAnnotationPresent(CallerSensitive.class);
336         }
337         return false;
338     }
339 
<span class="line-added">340     /*</span>
<span class="line-added">341      * Tests if the given Field is a trusted final field and it cannot be</span>
<span class="line-added">342      * modified reflectively regardless of the value of its accessible flag.</span>
<span class="line-added">343      */</span>
<span class="line-added">344     public static boolean isTrustedFinalField(Field field) {</span>
<span class="line-added">345         return SharedSecrets.getJavaLangReflectAccess().isTrustedFinalField(field);</span>
<span class="line-added">346     }</span>
<span class="line-added">347 </span>
348     /**
349      * Returns an IllegalAccessException with an exception message based on
350      * the access that is denied.
351      */
352     public static IllegalAccessException newIllegalAccessException(Class&lt;?&gt; currentClass,
353                                                                    Class&lt;?&gt; memberClass,
354                                                                    Class&lt;?&gt; targetClass,
355                                                                    int modifiers)
356     {
357         if (currentClass == null)
358             return newIllegalAccessException(memberClass, modifiers);
359 
360         String currentSuffix = &quot;&quot;;
361         String memberSuffix = &quot;&quot;;
362         Module m1 = currentClass.getModule();
363         if (m1.isNamed())
364             currentSuffix = &quot; (in &quot; + m1 + &quot;)&quot;;
365         Module m2 = memberClass.getModule();
366         if (m2.isNamed())
367             memberSuffix = &quot; (in &quot; + m2 + &quot;)&quot;;
</pre>
</td>
</tr>
</table>
<center><a href="../module/ServicesCatalog.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ReflectionFactory.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>