<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/compiler/compilerDirectives.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="compilerDirectives.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="compilerOracle.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/compiler/compilerDirectives.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -28,10 +28,11 @@</span>
  #include &quot;ci/ciMetadata.hpp&quot;
  #include &quot;ci/ciMethod.hpp&quot;
  #include &quot;compiler/methodMatcher.hpp&quot;
  #include &quot;compiler/compilerOracle.hpp&quot;
  #include &quot;utilities/exceptions.hpp&quot;
<span class="udiff-line-added">+ #include &quot;utilities/tribool.hpp&quot;</span>
  
    //      Directives flag name,    type, default value, compile command name
    #define compilerdirectives_common_flags(cflags) \
      cflags(Enable,                  bool, false, X) \
      cflags(Exclude,                 bool, false, X) \
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -44,11 +45,12 @@</span>
      cflags(BackgroundCompilation,   bool, BackgroundCompilation, BackgroundCompilation) \
      cflags(ReplayInline,            bool, false, ReplayInline) \
      cflags(DumpReplay,              bool, false, DumpReplay) \
      cflags(DumpInline,              bool, false, DumpInline) \
      cflags(CompilerDirectivesIgnoreCompileCommands, bool, CompilerDirectivesIgnoreCompileCommands, X) \
<span class="udiff-line-modified-removed">-     cflags(DisableIntrinsic,        ccstrlist, DisableIntrinsic, DisableIntrinsic)</span>
<span class="udiff-line-modified-added">+     cflags(DisableIntrinsic,        ccstrlist, DisableIntrinsic, DisableIntrinsic) \</span>
<span class="udiff-line-added">+     cflags(ControlIntrinsic,        ccstrlist, ControlIntrinsic, ControlIntrinsic)</span>
  
  #ifdef COMPILER1
    #define compilerdirectives_c1_flags(cflags)
  #else
    #define compilerdirectives_c1_flags(cflags)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -97,15 +99,16 @@</span>
  
  class DirectiveSet : public CHeapObj&lt;mtCompiler&gt; {
  private:
    InlineMatcher* _inlinematchers;
    CompilerDirectives* _directive;
<span class="udiff-line-added">+   TriBoolArray&lt;vmIntrinsics::ID_LIMIT, int&gt; _intrinsic_control_words;</span>
  
  public:
    DirectiveSet(CompilerDirectives* directive);
    ~DirectiveSet();
<span class="udiff-line-modified-removed">-   void init_disableintrinsic();</span>
<span class="udiff-line-modified-added">+   void init_control_intrinsic();</span>
    CompilerDirectives* directive();
    bool parse_and_add_inline(char* str, const char*&amp; error_msg);
    void append_inline(InlineMatcher* m);
    bool should_inline(ciMethod* inlinee);
    bool should_not_inline(ciMethod* inlinee);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -113,23 +116,25 @@</span>
    DirectiveSet* compilecommand_compatibility_init(const methodHandle&amp; method);
    bool is_exclusive_copy() { return _directive == NULL; }
    bool matches_inline(const methodHandle&amp; method, int inline_action);
    static DirectiveSet* clone(DirectiveSet const* src);
    bool is_intrinsic_disabled(const methodHandle&amp; method);
<span class="udiff-line-modified-removed">-   static ccstrlist canonicalize_disableintrinsic(ccstrlist option_value);</span>
<span class="udiff-line-modified-added">+   static ccstrlist canonicalize_control_intrinsic(ccstrlist option_value);</span>
    void finalize(outputStream* st);
  
    typedef enum {
  #define enum_of_flags(name, type, dvalue, cc_flag) name##Index,
      compilerdirectives_common_flags(enum_of_flags)
      compilerdirectives_c2_flags(enum_of_flags)
      compilerdirectives_c1_flags(enum_of_flags)
      number_of_flags
    } flags;
  
<span class="udiff-line-added">+  private:</span>
    bool _modified[number_of_flags]; // Records what options where set by a directive
  
<span class="udiff-line-added">+  public:</span>
  #define flag_store_definition(name, type, dvalue, cc_flag) type name##Option;
    compilerdirectives_common_flags(flag_store_definition)
    compilerdirectives_c2_flags(flag_store_definition)
    compilerdirectives_c1_flags(flag_store_definition)
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -155,10 +160,32 @@</span>
      compilerdirectives_c1_flags(print_function_definition)
      st-&gt;cr();
    }
  };
  
<span class="udiff-line-added">+ // Iterator of ControlIntrinsic</span>
<span class="udiff-line-added">+ // if disable_all is true, it accepts DisableIntrinsic(deprecated) and all intrinsics</span>
<span class="udiff-line-added">+ // appear in the list are to disable</span>
<span class="udiff-line-added">+ class ControlIntrinsicIter {</span>
<span class="udiff-line-added">+  private:</span>
<span class="udiff-line-added">+   bool _enabled;</span>
<span class="udiff-line-added">+   char* _token;</span>
<span class="udiff-line-added">+   char* _saved_ptr;</span>
<span class="udiff-line-added">+   char* _list;</span>
<span class="udiff-line-added">+   const bool _disableIntrinsic;</span>
<span class="udiff-line-added">+   void next_token();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+  public:</span>
<span class="udiff-line-added">+   ControlIntrinsicIter(ccstrlist option, bool disable_all = false);</span>
<span class="udiff-line-added">+   ~ControlIntrinsicIter();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   bool is_enabled() const { return _enabled; }</span>
<span class="udiff-line-added">+   const char* operator*() const { return _token; }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   ControlIntrinsicIter&amp; operator++();</span>
<span class="udiff-line-added">+ };</span>
<span class="udiff-line-added">+ </span>
  class CompilerDirectives : public CHeapObj&lt;mtCompiler&gt; {
  private:
    CompilerDirectives* _next;
    BasicMatcher* _match;
    int _ref_count;
</pre>
<center><a href="compilerDirectives.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="compilerOracle.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>