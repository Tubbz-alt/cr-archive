<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/classfile/protectionDomainCache.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="protectionDomainCache.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="stringTable.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/classfile/protectionDomainCache.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #ifndef SHARE_CLASSFILE_PROTECTIONDOMAINCACHE_HPP
 26 #define SHARE_CLASSFILE_PROTECTIONDOMAINCACHE_HPP
 27 
 28 #include &quot;oops/oop.hpp&quot;
 29 #include &quot;oops/weakHandle.hpp&quot;
 30 #include &quot;memory/iterator.hpp&quot;
 31 #include &quot;utilities/hashtable.hpp&quot;
 32 
 33 // This class caches the approved protection domains that can access loaded classes.
 34 // Dictionary entry pd_set point to entries in this hashtable.   Please refer
 35 // to dictionary.hpp pd_set for more information about how protection domain entries
 36 // are used.
 37 // This table is walked during GC, rather than the class loader data graph dictionaries.
<span class="line-modified"> 38 class ProtectionDomainCacheEntry : public HashtableEntry&lt;WeakHandle&lt;vm_weak_data&gt;, mtClass&gt; {</span>
 39   friend class VMStructs;
 40  public:
 41   oop object();
 42   oop object_no_keepalive();
 43 
 44   ProtectionDomainCacheEntry* next() {
<span class="line-modified"> 45     return (ProtectionDomainCacheEntry*)HashtableEntry&lt;WeakHandle&lt;vm_weak_data&gt;, mtClass&gt;::next();</span>
 46   }
 47 
 48   ProtectionDomainCacheEntry** next_addr() {
<span class="line-modified"> 49     return (ProtectionDomainCacheEntry**)HashtableEntry&lt;WeakHandle&lt;vm_weak_data&gt;, mtClass&gt;::next_addr();</span>
 50   }
 51 
 52   void verify();
 53 };
 54 
 55 // The ProtectionDomainCacheTable contains all protection domain oops. The
 56 // dictionary entries reference its entries instead of having references to oops
 57 // directly.
 58 // This is used to speed up system dictionary iteration: the oops in the
 59 // protection domain are the only ones referring the Java heap. So when there is
 60 // need to update these, instead of going over every entry of the system dictionary,
 61 // we only need to iterate over this set.
 62 // The amount of different protection domains used is typically magnitudes smaller
 63 // than the number of system dictionary entries (loaded classes).
<span class="line-modified"> 64 class ProtectionDomainCacheTable : public Hashtable&lt;WeakHandle&lt;vm_weak_data&gt;, mtClass&gt; {</span>
 65   friend class VMStructs;
 66 private:
 67   ProtectionDomainCacheEntry* bucket(int i) const {
<span class="line-modified"> 68     return (ProtectionDomainCacheEntry*) Hashtable&lt;WeakHandle&lt;vm_weak_data&gt;, mtClass&gt;::bucket(i);</span>
 69   }
 70 
 71   // The following method is not MT-safe and must be done under lock.
 72   ProtectionDomainCacheEntry** bucket_addr(int i) {
<span class="line-modified"> 73     return (ProtectionDomainCacheEntry**) Hashtable&lt;WeakHandle&lt;vm_weak_data&gt;, mtClass&gt;::bucket_addr(i);</span>
 74   }
 75 
<span class="line-modified"> 76   ProtectionDomainCacheEntry* new_entry(unsigned int hash, WeakHandle&lt;vm_weak_data&gt; protection_domain) {</span>
 77     ProtectionDomainCacheEntry* entry = (ProtectionDomainCacheEntry*)
<span class="line-modified"> 78       Hashtable&lt;WeakHandle&lt;vm_weak_data&gt;, mtClass&gt;::new_entry(hash, protection_domain);</span>
 79     return entry;
 80   }
 81 
 82   static unsigned int compute_hash(Handle protection_domain);
 83 
 84   int index_for(Handle protection_domain);
 85   ProtectionDomainCacheEntry* add_entry(int index, unsigned int hash, Handle protection_domain);
 86   ProtectionDomainCacheEntry* find_entry(int index, Handle protection_domain);
 87 
 88   bool _dead_entries;
 89   int _total_oops_removed;
 90 
 91 public:
 92   ProtectionDomainCacheTable(int table_size);
 93   ProtectionDomainCacheEntry* get(Handle protection_domain);
 94 
 95   void unlink();
 96 
 97   void print_on(outputStream* st) const;
 98   void verify();
</pre>
</td>
<td>
<hr />
<pre>
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #ifndef SHARE_CLASSFILE_PROTECTIONDOMAINCACHE_HPP
 26 #define SHARE_CLASSFILE_PROTECTIONDOMAINCACHE_HPP
 27 
 28 #include &quot;oops/oop.hpp&quot;
 29 #include &quot;oops/weakHandle.hpp&quot;
 30 #include &quot;memory/iterator.hpp&quot;
 31 #include &quot;utilities/hashtable.hpp&quot;
 32 
 33 // This class caches the approved protection domains that can access loaded classes.
 34 // Dictionary entry pd_set point to entries in this hashtable.   Please refer
 35 // to dictionary.hpp pd_set for more information about how protection domain entries
 36 // are used.
 37 // This table is walked during GC, rather than the class loader data graph dictionaries.
<span class="line-modified"> 38 class ProtectionDomainCacheEntry : public HashtableEntry&lt;WeakHandle, mtClass&gt; {</span>
 39   friend class VMStructs;
 40  public:
 41   oop object();
 42   oop object_no_keepalive();
 43 
 44   ProtectionDomainCacheEntry* next() {
<span class="line-modified"> 45     return (ProtectionDomainCacheEntry*)HashtableEntry&lt;WeakHandle, mtClass&gt;::next();</span>
 46   }
 47 
 48   ProtectionDomainCacheEntry** next_addr() {
<span class="line-modified"> 49     return (ProtectionDomainCacheEntry**)HashtableEntry&lt;WeakHandle, mtClass&gt;::next_addr();</span>
 50   }
 51 
 52   void verify();
 53 };
 54 
 55 // The ProtectionDomainCacheTable contains all protection domain oops. The
 56 // dictionary entries reference its entries instead of having references to oops
 57 // directly.
 58 // This is used to speed up system dictionary iteration: the oops in the
 59 // protection domain are the only ones referring the Java heap. So when there is
 60 // need to update these, instead of going over every entry of the system dictionary,
 61 // we only need to iterate over this set.
 62 // The amount of different protection domains used is typically magnitudes smaller
 63 // than the number of system dictionary entries (loaded classes).
<span class="line-modified"> 64 class ProtectionDomainCacheTable : public Hashtable&lt;WeakHandle, mtClass&gt; {</span>
 65   friend class VMStructs;
 66 private:
 67   ProtectionDomainCacheEntry* bucket(int i) const {
<span class="line-modified"> 68     return (ProtectionDomainCacheEntry*) Hashtable&lt;WeakHandle, mtClass&gt;::bucket(i);</span>
 69   }
 70 
 71   // The following method is not MT-safe and must be done under lock.
 72   ProtectionDomainCacheEntry** bucket_addr(int i) {
<span class="line-modified"> 73     return (ProtectionDomainCacheEntry**) Hashtable&lt;WeakHandle, mtClass&gt;::bucket_addr(i);</span>
 74   }
 75 
<span class="line-modified"> 76   ProtectionDomainCacheEntry* new_entry(unsigned int hash, WeakHandle protection_domain) {</span>
 77     ProtectionDomainCacheEntry* entry = (ProtectionDomainCacheEntry*)
<span class="line-modified"> 78       Hashtable&lt;WeakHandle, mtClass&gt;::new_entry(hash, protection_domain);</span>
 79     return entry;
 80   }
 81 
 82   static unsigned int compute_hash(Handle protection_domain);
 83 
 84   int index_for(Handle protection_domain);
 85   ProtectionDomainCacheEntry* add_entry(int index, unsigned int hash, Handle protection_domain);
 86   ProtectionDomainCacheEntry* find_entry(int index, Handle protection_domain);
 87 
 88   bool _dead_entries;
 89   int _total_oops_removed;
 90 
 91 public:
 92   ProtectionDomainCacheTable(int table_size);
 93   ProtectionDomainCacheEntry* get(Handle protection_domain);
 94 
 95   void unlink();
 96 
 97   void print_on(outputStream* st) const;
 98   void verify();
</pre>
</td>
</tr>
</table>
<center><a href="protectionDomainCache.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="stringTable.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>