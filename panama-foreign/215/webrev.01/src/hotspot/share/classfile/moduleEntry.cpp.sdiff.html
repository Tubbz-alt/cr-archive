<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/classfile/moduleEntry.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="javaClasses.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="moduleEntry.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/classfile/moduleEntry.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #include &quot;precompiled.hpp&quot;
 26 #include &quot;jni.h&quot;
 27 #include &quot;classfile/classLoader.hpp&quot;
 28 #include &quot;classfile/classLoaderData.inline.hpp&quot;
 29 #include &quot;classfile/javaClasses.inline.hpp&quot;
 30 #include &quot;classfile/moduleEntry.hpp&quot;
 31 #include &quot;logging/log.hpp&quot;

 32 #include &quot;memory/resourceArea.hpp&quot;
 33 #include &quot;memory/universe.hpp&quot;
 34 #include &quot;oops/oopHandle.inline.hpp&quot;
 35 #include &quot;oops/symbol.hpp&quot;
 36 #include &quot;runtime/handles.inline.hpp&quot;
 37 #include &quot;runtime/safepoint.hpp&quot;
 38 #include &quot;utilities/events.hpp&quot;
 39 #include &quot;utilities/growableArray.hpp&quot;
 40 #include &quot;utilities/hashtable.inline.hpp&quot;
 41 #include &quot;utilities/ostream.hpp&quot;
 42 
 43 ModuleEntry* ModuleEntryTable::_javabase_module = NULL;
 44 
 45 oop ModuleEntry::module() const { return _module.resolve(); }
 46 
 47 void ModuleEntry::set_location(Symbol* location) {
 48   if (_location != NULL) {
 49     // _location symbol&#39;s refcounts are managed by ModuleEntry,
 50     // must decrement the old one before updating.
 51     _location-&gt;decrement_refcount();
 52   }
 53 
 54   _location = location;
 55 
 56   if (location != NULL) {
 57     location-&gt;increment_refcount();



 58   }
 59 }
 60 
 61 // Return true if the module&#39;s version should be displayed in error messages,
 62 // logging, etc.
 63 // Return false if the module&#39;s version is null, if it is unnamed, or if the
 64 // module is not an upgradeable module.
 65 // Detect if the module is not upgradeable by checking:
 66 //     1. Module location is &quot;jrt:/java.&quot; and its loader is boot or platform
 67 //     2. Module location is &quot;jrt:/jdk.&quot;, its loader is one of the builtin loaders
 68 //        and its version is the same as module java.base&#39;s version
 69 // The above check is imprecise but should work in almost all cases.
 70 bool ModuleEntry::should_show_version() {
 71   if (version() == NULL || !is_named()) return false;
 72 
 73   if (location() != NULL) {
 74     ResourceMark rm;
 75     const char* loc = location()-&gt;as_C_string();
 76     ClassLoaderData* cld = loader_data();
 77 
</pre>
</td>
<td>
<hr />
<pre>
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #include &quot;precompiled.hpp&quot;
 26 #include &quot;jni.h&quot;
 27 #include &quot;classfile/classLoader.hpp&quot;
 28 #include &quot;classfile/classLoaderData.inline.hpp&quot;
 29 #include &quot;classfile/javaClasses.inline.hpp&quot;
 30 #include &quot;classfile/moduleEntry.hpp&quot;
 31 #include &quot;logging/log.hpp&quot;
<span class="line-added"> 32 #include &quot;memory/filemap.hpp&quot;</span>
 33 #include &quot;memory/resourceArea.hpp&quot;
 34 #include &quot;memory/universe.hpp&quot;
 35 #include &quot;oops/oopHandle.inline.hpp&quot;
 36 #include &quot;oops/symbol.hpp&quot;
 37 #include &quot;runtime/handles.inline.hpp&quot;
 38 #include &quot;runtime/safepoint.hpp&quot;
 39 #include &quot;utilities/events.hpp&quot;
 40 #include &quot;utilities/growableArray.hpp&quot;
 41 #include &quot;utilities/hashtable.inline.hpp&quot;
 42 #include &quot;utilities/ostream.hpp&quot;
 43 
 44 ModuleEntry* ModuleEntryTable::_javabase_module = NULL;
 45 
 46 oop ModuleEntry::module() const { return _module.resolve(); }
 47 
 48 void ModuleEntry::set_location(Symbol* location) {
 49   if (_location != NULL) {
 50     // _location symbol&#39;s refcounts are managed by ModuleEntry,
 51     // must decrement the old one before updating.
 52     _location-&gt;decrement_refcount();
 53   }
 54 
 55   _location = location;
 56 
 57   if (location != NULL) {
 58     location-&gt;increment_refcount();
<span class="line-added"> 59     CDS_ONLY(if (UseSharedSpaces) {</span>
<span class="line-added"> 60         _shared_path_index = FileMapInfo::get_module_shared_path_index(location);</span>
<span class="line-added"> 61       });</span>
 62   }
 63 }
 64 
 65 // Return true if the module&#39;s version should be displayed in error messages,
 66 // logging, etc.
 67 // Return false if the module&#39;s version is null, if it is unnamed, or if the
 68 // module is not an upgradeable module.
 69 // Detect if the module is not upgradeable by checking:
 70 //     1. Module location is &quot;jrt:/java.&quot; and its loader is boot or platform
 71 //     2. Module location is &quot;jrt:/jdk.&quot;, its loader is one of the builtin loaders
 72 //        and its version is the same as module java.base&#39;s version
 73 // The above check is imprecise but should work in almost all cases.
 74 bool ModuleEntry::should_show_version() {
 75   if (version() == NULL || !is_named()) return false;
 76 
 77   if (location() != NULL) {
 78     ResourceMark rm;
 79     const char* loc = location()-&gt;as_C_string();
 80     ClassLoaderData* cld = loader_data();
 81 
</pre>
</td>
</tr>
</table>
<center><a href="javaClasses.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="moduleEntry.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>