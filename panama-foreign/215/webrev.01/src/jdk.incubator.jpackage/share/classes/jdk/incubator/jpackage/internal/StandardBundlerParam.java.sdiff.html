<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.incubator.jpackage/share/classes/jdk/incubator/jpackage/internal/StandardBundlerParam.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="PathGroup.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ValidOptions.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.incubator.jpackage/share/classes/jdk/incubator/jpackage/internal/StandardBundlerParam.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.incubator.jpackage.internal;
 27 
 28 import java.io.File;
 29 import java.io.IOException;
<span class="line-removed"> 30 import java.lang.module.ModuleDescriptor;</span>
<span class="line-removed"> 31 import java.lang.module.ModuleDescriptor.Version;</span>
 32 import java.nio.file.Files;
 33 import java.nio.file.Path;
<span class="line-removed"> 34 import java.nio.file.Paths;</span>
 35 import java.text.MessageFormat;
 36 import java.util.ArrayList;
 37 import java.util.Arrays;
 38 import java.util.Collections;
 39 import java.util.Date;
 40 import java.util.LinkedHashSet;
 41 import java.util.List;
 42 import java.util.Map;
<span class="line-removed"> 43 import java.util.Optional;</span>
<span class="line-removed"> 44 import java.util.ResourceBundle;</span>
 45 import java.util.Set;
<span class="line-removed"> 46 import java.util.HashSet;</span>
 47 import java.util.function.BiFunction;
 48 import java.util.function.Function;
<span class="line-removed"> 49 import java.util.jar.Attributes;</span>
<span class="line-removed"> 50 import java.util.jar.JarFile;</span>
<span class="line-removed"> 51 import java.util.jar.Manifest;</span>
 52 import java.util.stream.Collectors;
 53 import java.util.stream.Stream;
 54 
 55 /**
 56  * StandardBundlerParam
 57  *
 58  * A parameter to a bundler.
 59  *
 60  * Also contains static definitions of all of the common bundler parameters.
 61  * (additional platform specific and mode specific bundler parameters
 62  * are defined in each of the specific bundlers)
 63  *
 64  * Also contains static methods that operate on maps of parameters.
 65  */
 66 class StandardBundlerParam&lt;T&gt; extends BundlerParamInfo&lt;T&gt; {
 67 
 68     private static final String JAVABASEJMOD = &quot;java.base.jmod&quot;;
 69     private final static String DEFAULT_VERSION = &quot;1.0&quot;;
 70     private final static String DEFAULT_RELEASE = &quot;1&quot;;
 71     private final static String[] DEFAULT_JLINK_OPTIONS = {
</pre>
<hr />
<pre>
483                     &quot;message.runtime-image-dir-does-not-exist.advice&quot;),
484                     PREDEFINED_RUNTIME_IMAGE.getID()));
485         }
486 
487         if (Platform.isMac()) {
488             // On Mac topImage can be runtime root or runtime home.
489             Path runtimeHome = topImage.toPath().resolve(&quot;Contents/Home&quot;);
490             if (Files.isDirectory(runtimeHome)) {
491                 // topImage references runtime root, adjust it to pick data from
492                 // runtime home
493                 topImage = runtimeHome.toFile();
494             }
495         }
496 
497         // copy whole runtime, need to skip jmods and src.zip
498         final List&lt;String&gt; excludes = Arrays.asList(&quot;jmods&quot;, &quot;src.zip&quot;);
499         IOUtils.copyRecursive(topImage.toPath(),
500                 appLayout.runtimeHomeDirectory(), excludes);
501 
502         // if module-path given - copy modules to appDir/mods
<span class="line-modified">503         List&lt;Path&gt; modulePath =</span>
<span class="line-removed">504                 StandardBundlerParam.MODULE_PATH.fetchFrom(params);</span>
505         List&lt;Path&gt; defaultModulePath = getDefaultModulePath();
506         Path dest = appLayout.appModsDirectory();
507 
508         if (dest != null) {
509             for (Path mp : modulePath) {
510                 if (!defaultModulePath.contains(mp)) {
511                     Files.createDirectories(dest);
512                     IOUtils.copyRecursive(mp, dest);
513                 }
514             }
515         }
516     }
517 
518     private static List&lt;Path&gt; getDefaultModulePath() {
519         return List.of(
520                 Path.of(System.getProperty(&quot;java.home&quot;), &quot;jmods&quot;).toAbsolutePath());
521     }
522 
523     private static String getDefaultAppVersion(Map&lt;String, ? super Object&gt; params) {
524         String appVersion = DEFAULT_VERSION;
</pre>
</td>
<td>
<hr />
<pre>
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.incubator.jpackage.internal;
 27 
 28 import java.io.File;
 29 import java.io.IOException;


 30 import java.nio.file.Files;
 31 import java.nio.file.Path;

 32 import java.text.MessageFormat;
 33 import java.util.ArrayList;
 34 import java.util.Arrays;
 35 import java.util.Collections;
 36 import java.util.Date;
 37 import java.util.LinkedHashSet;
 38 import java.util.List;
 39 import java.util.Map;


 40 import java.util.Set;

 41 import java.util.function.BiFunction;
 42 import java.util.function.Function;



 43 import java.util.stream.Collectors;
 44 import java.util.stream.Stream;
 45 
 46 /**
 47  * StandardBundlerParam
 48  *
 49  * A parameter to a bundler.
 50  *
 51  * Also contains static definitions of all of the common bundler parameters.
 52  * (additional platform specific and mode specific bundler parameters
 53  * are defined in each of the specific bundlers)
 54  *
 55  * Also contains static methods that operate on maps of parameters.
 56  */
 57 class StandardBundlerParam&lt;T&gt; extends BundlerParamInfo&lt;T&gt; {
 58 
 59     private static final String JAVABASEJMOD = &quot;java.base.jmod&quot;;
 60     private final static String DEFAULT_VERSION = &quot;1.0&quot;;
 61     private final static String DEFAULT_RELEASE = &quot;1&quot;;
 62     private final static String[] DEFAULT_JLINK_OPTIONS = {
</pre>
<hr />
<pre>
474                     &quot;message.runtime-image-dir-does-not-exist.advice&quot;),
475                     PREDEFINED_RUNTIME_IMAGE.getID()));
476         }
477 
478         if (Platform.isMac()) {
479             // On Mac topImage can be runtime root or runtime home.
480             Path runtimeHome = topImage.toPath().resolve(&quot;Contents/Home&quot;);
481             if (Files.isDirectory(runtimeHome)) {
482                 // topImage references runtime root, adjust it to pick data from
483                 // runtime home
484                 topImage = runtimeHome.toFile();
485             }
486         }
487 
488         // copy whole runtime, need to skip jmods and src.zip
489         final List&lt;String&gt; excludes = Arrays.asList(&quot;jmods&quot;, &quot;src.zip&quot;);
490         IOUtils.copyRecursive(topImage.toPath(),
491                 appLayout.runtimeHomeDirectory(), excludes);
492 
493         // if module-path given - copy modules to appDir/mods
<span class="line-modified">494         List&lt;Path&gt; modulePath = MODULE_PATH.fetchFrom(params);</span>

495         List&lt;Path&gt; defaultModulePath = getDefaultModulePath();
496         Path dest = appLayout.appModsDirectory();
497 
498         if (dest != null) {
499             for (Path mp : modulePath) {
500                 if (!defaultModulePath.contains(mp)) {
501                     Files.createDirectories(dest);
502                     IOUtils.copyRecursive(mp, dest);
503                 }
504             }
505         }
506     }
507 
508     private static List&lt;Path&gt; getDefaultModulePath() {
509         return List.of(
510                 Path.of(System.getProperty(&quot;java.home&quot;), &quot;jmods&quot;).toAbsolutePath());
511     }
512 
513     private static String getDefaultAppVersion(Map&lt;String, ? super Object&gt; params) {
514         String appVersion = DEFAULT_VERSION;
</pre>
</td>
</tr>
</table>
<center><a href="PathGroup.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ValidOptions.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>