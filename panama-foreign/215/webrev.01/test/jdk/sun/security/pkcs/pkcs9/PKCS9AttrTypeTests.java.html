<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/sun/security/pkcs/pkcs9/PKCS9AttrTypeTests.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 8239950
 27  * @summary Update PKCS9 Attributes to PKCS#9 v2.0 Encodings
 28  * @library /test/lib
 29  * @modules java.base/sun.security.pkcs
 30             java.base/sun.security.util
 31  */
 32 
 33 import java.io.IOException;
 34 import java.util.*;
 35 import sun.security.pkcs.PKCS9Attribute;
 36 import sun.security.util.DerValue;
 37 import jdk.test.lib.Utils;
 38 
 39 public class PKCS9AttrTypeTests {
 40 
 41     static final Map&lt;String, String&gt; TEST_INPUT_GOOD =
 42             new LinkedHashMap&lt;String, String&gt;() {{
 43 
 44                 // Challenge Password
 45                 put(&quot;challengePasssword as TeletexString&quot;,
 46                     &quot;301e06092a864886f70d010907311114&quot; +
 47                     &quot;0f5468697349734150617373776f7264&quot;);
 48                 put(&quot;challengePasssword as PrintableString&quot;,
 49                     &quot;301e06092a864886f70d010907311113&quot; +
 50                     &quot;0f5468697349734150617373776f7264&quot;);
 51                 put(&quot;challengePasssword as UniversalString&quot;,
 52                     &quot;304b06092a864886f70d010907313e1c&quot; +
 53                     &quot;3c000000540000006800000069000000&quot; +
 54                     &quot;73000000490000007300000041000000&quot; +
 55                     &quot;50000000610000007300000073000000&quot; +
 56                     &quot;770000006f0000007200000064&quot;);
 57                 put(&quot;challengePasssword as UTF8String&quot;,
 58                     &quot;301e06092a864886f70d01090731110c&quot; +
 59                     &quot;0f5468697349734150617373776f7264&quot;);
 60                 put(&quot;challengePasssword as BMPString&quot;,
 61                     &quot;302d06092a864886f70d01090731201e&quot; +
 62                     &quot;1e005400680069007300490073004100&quot; +
 63                     &quot;500061007300730077006f00720064&quot;);
 64 
 65                 // Unstructured Name
 66                 put(&quot;unstructuredName as IA5String&quot;,
 67                     &quot;301b06092a864886f70d010902310e16&quot; +
 68                     &quot;0c5468697349734d794e616d65&quot;);
 69                 put(&quot;unstructuredName as TeletexString&quot;,
 70                     &quot;301b06092a864886f70d010902310e14&quot; +
 71                     &quot;0c5468697349734d794e616d65&quot;);
 72                 put(&quot;unstructuredName as PrintableString&quot;,
 73                     &quot;301b06092a864886f70d010902310e13&quot; +
 74                     &quot;0c5468697349734d794e616d65&quot;);
 75                 put(&quot;unstructuredName as UniversalString&quot;,
 76                     &quot;303f06092a864886f70d01090231321c&quot; +
 77                     &quot;30000000540000006800000069000000&quot; +
 78                     &quot;7300000049000000730000004d000000&quot; +
 79                     &quot;790000004e000000610000006d000000&quot; +
 80                     &quot;65&quot;);
 81                 put(&quot;unstructuredName as UTF8String&quot;,
 82                     &quot;301b06092a864886f70d010902310e0c&quot; +
 83                     &quot;0c5468697349734d794e616d65&quot;);
 84                 put(&quot;unstructuredName as BMPString&quot;,
 85                     &quot;302706092a864886f70d010902311a1e&quot; +
 86                     &quot;18005400680069007300490073004d00&quot; +
 87                     &quot;79004e0061006d0065&quot;);
 88                 put(&quot;unstructuredName as Multi-Valued&quot;,
 89                     &quot;302d06092a864886f70d010902312013&quot; +
 90                     &quot;10546869734973416c736f4d794e616d&quot; +
 91                     &quot;65160c5468697349734d794e616d65&quot;);
 92 
 93                 // Unstructured Address
 94                 put(&quot;unstructuredAddress as TeletexString&quot;,
 95                     &quot;301e06092a864886f70d010908311114&quot; +
 96                     &quot;0f5468697349734d7941646472657373&quot;);
 97                 put(&quot;unstructuredAddress as PrintableString&quot;,
 98                     &quot;301e06092a864886f70d010908311113&quot; +
 99                     &quot;0f5468697349734d7941646472657373&quot;);
100                 put(&quot;unstructuredAddress as UniversalString&quot;,
101                     &quot;304b06092a864886f70d010908313e1c&quot; +
102                     &quot;3c000000540000006800000069000000&quot; +
103                     &quot;7300000049000000730000004d000000&quot; +
104                     &quot;79000000410000006400000064000000&quot; +
105                     &quot;72000000650000007300000073&quot;);
106                 put(&quot;unstructuredAddress as UTF8String&quot;,
107                     &quot;301e06092a864886f70d01090831110c&quot; +
108                     &quot;0f5468697349734d7941646472657373&quot;);
109                 put(&quot;unstructuredAddress as BMPString&quot;,
110                     &quot;302d06092a864886f70d01090831201e&quot; +
111                     &quot;1e005400680069007300490073004d00&quot; +
112                     &quot;790041006400640072006500730073&quot;);
113                 put(&quot;unstructuredAddress as Multi-Valued&quot;,
114                     &quot;303306092a864886f70d01090831260c&quot; +
115                     &quot;13546869734973416c736f4d79416464&quot; +
116                     &quot;72657373130f5468697349734d794164&quot; +
117                     &quot;6472657373&quot;);
118 
119                 // Signing Time
120                 put(&quot;signingTime as UTCTime&quot;,
121                     &quot;301c06092a864886f70d010905310f17&quot; +
122                     &quot;0d3635303533313132303030305a&quot;);
123                 put(&quot;signingTime as GeneralizedTime&quot;,
124                     &quot;301e06092a864886f70d010905311118&quot; +
125                     &quot;0f32303530303533313132303030305a&quot;);
126             }};
127 
128     static final Map&lt;String, String&gt; TEST_INPUT_BAD =
129             new LinkedHashMap&lt;String, String&gt;() {{
130 
131                 // Challenge Password
132                 put(&quot;challengePasssword as IA5String&quot;,
133                     &quot;301e06092a864886f70d010907311116&quot; +
134                     &quot;0f5468697349734150617373776f7264&quot;);
135                 put(&quot;challengePassword as Multi-Valued&quot;,
136                     &quot;303306092a864886f70d01090731260c&quot; +
137                     &quot;13546869734973416c736f4150617373&quot; +
138                     &quot;776f7264130f54686973497341506173&quot; +
139                     &quot;73776f7264&quot;);
140 
141                 // Unstructured Name
142                 put(&quot;unstructuredName as UTCTime&quot;,
143                     &quot;301c06092a864886f70d010902310f17&quot; +
144                     &quot;0d3635303533313132303030305a&quot;);
145 
146                 // Unstructured Address
147                 put(&quot;unstructuredAddress as IA5String&quot;,
148                     &quot;301e06092a864886f70d010908311116&quot; +
149                     &quot;0f5468697349734d7941646472657373&quot;);
150 
151                 // Signing Time
152                 put(&quot;signingTime as Multi-Valued&quot;,
153                     &quot;302b06092a864886f70d010905311e17&quot; +
154                     &quot;0d3230303432383035303030305a170d&quot; +
155                     &quot;3635303533313132303030305a&quot;);              // DKN
156             }};
157 
158     public static void main(String[] args) throws Exception {
159         int failedTests = 0;
160 
161         for (Map.Entry&lt;String, String&gt; entry : TEST_INPUT_GOOD.entrySet()) {
162             try {
163                 System.out.print(&quot;Test - &quot; + entry.getKey() + &quot;: &quot;);
164 
165                 // Decode each Base64 test vector into DER and place into
166                 // a DerValue object to be consumed by PKCS9Attribute.
167                 PKCS9Attribute p9Attr = new PKCS9Attribute(
168                         new DerValue(Utils.toByteArray(entry.getValue())));
169                 System.out.println(&quot;PASS&quot;);
170                 System.out.println(&quot;---------------&quot;);
171                 System.out.println(p9Attr);
172                 System.out.println(&quot;---------------&quot;);
173             } catch (IOException ioe) {
174                 failedTests++;
175                 System.out.println(&quot;FAIL:&quot;);
176                 ioe.printStackTrace(System.out);
177                 System.out.println();
178             }
179         }
180 
181         for (Map.Entry&lt;String, String&gt; entry : TEST_INPUT_BAD.entrySet()) {
182             try {
183                 System.out.print(&quot;Test - &quot; + entry.getKey() + &quot;: &quot;);
184 
185                 // Decode each Base64 test vector into DER and place into
186                 // a DerValue object to be consumed by PKCS9Attribute.
187                 PKCS9Attribute p9Attr = new PKCS9Attribute(
188                         new DerValue(
189                             Base64.getMimeDecoder().decode(entry.getValue())));
190                 failedTests++;
191                 System.out.println(&quot;FAIL: Expected IOException did not occur&quot;);
192             } catch (IOException ioe) {
193                 System.out.println(&quot;PASS\n&quot; + ioe);
194             }
195 
196         }
197 
198         if (failedTests &gt; 0) {
199             throw new RuntimeException(
200                     &quot;One or more test cases failed, see output&quot;);
201         }
202     }
203 }
    </pre>
  </body>
</html>