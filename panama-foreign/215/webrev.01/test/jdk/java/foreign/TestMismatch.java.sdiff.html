<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/foreign/TestMismatch.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../../ProblemList.txt.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../lang/invoke/unreflect/Fields.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/foreign/TestMismatch.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
100 
101     @Test
102     public void testEmpty() {
103         var s1 = MemorySegment.ofArray(new byte[0]);
104         assertEquals(s1.mismatch(s1), -1);
105         try (var nativeSegment = MemorySegment.allocateNative(4)) {
106             var s2 = nativeSegment.asSlice(0, 0);
107             assertEquals(s1.mismatch(s2), -1);
108             assertEquals(s2.mismatch(s1), -1);
109         }
110     }
111 
112     @Test
113     public void testLarge() {
114         try (var s1 = MemorySegment.allocateNative((long)Integer.MAX_VALUE + 10L);
115              var s2 = MemorySegment.allocateNative((long)Integer.MAX_VALUE + 10L)) {
116             assertEquals(s1.mismatch(s1), -1);
117             assertEquals(s1.mismatch(s2), -1);
118             assertEquals(s2.mismatch(s1), -1);
119 
<span class="line-modified">120             for (long i = s2.byteSize() -1 ; i &gt;= Integer.MAX_VALUE - 10L; i--) {</span>
<span class="line-modified">121                 BYTE_HANDLE.set(s2.baseAddress().addOffset(i), (byte) 0xFF);</span>
<span class="line-modified">122                 long expectedMismatchOffset = i;</span>
<span class="line-modified">123                 assertEquals(s1.mismatch(s2), expectedMismatchOffset);</span>
<span class="line-modified">124                 assertEquals(s2.mismatch(s1), expectedMismatchOffset);</span>
<span class="line-modified">125             }</span>
















126         }
127     }
128 
129     static final Class&lt;IllegalStateException&gt; ISE = IllegalStateException.class;
130     static final Class&lt;UnsupportedOperationException&gt; UOE = UnsupportedOperationException.class;
131 
132     @Test
133     public void testClosed() {
134         var s1 = MemorySegment.ofArray(new byte[4]);
135         var s2 = MemorySegment.ofArray(new byte[4]);
136         s1.close();
137         assertThrows(ISE, () -&gt; s1.mismatch(s1));
138         assertThrows(ISE, () -&gt; s1.mismatch(s2));
139         assertThrows(ISE, () -&gt; s2.mismatch(s1));
140     }
141 
142     @Test
143     public void testInsufficientAccessModes() {
144         var s1 = MemorySegment.ofArray(new byte[4]);
145         var s2 = MemorySegment.ofArray(new byte[4]);
</pre>
</td>
<td>
<hr />
<pre>
100 
101     @Test
102     public void testEmpty() {
103         var s1 = MemorySegment.ofArray(new byte[0]);
104         assertEquals(s1.mismatch(s1), -1);
105         try (var nativeSegment = MemorySegment.allocateNative(4)) {
106             var s2 = nativeSegment.asSlice(0, 0);
107             assertEquals(s1.mismatch(s2), -1);
108             assertEquals(s2.mismatch(s1), -1);
109         }
110     }
111 
112     @Test
113     public void testLarge() {
114         try (var s1 = MemorySegment.allocateNative((long)Integer.MAX_VALUE + 10L);
115              var s2 = MemorySegment.allocateNative((long)Integer.MAX_VALUE + 10L)) {
116             assertEquals(s1.mismatch(s1), -1);
117             assertEquals(s1.mismatch(s2), -1);
118             assertEquals(s2.mismatch(s1), -1);
119 
<span class="line-modified">120             testLargeAcrossMaxBoundary(s1, s2);</span>
<span class="line-modified">121 </span>
<span class="line-modified">122             testLargeMismatchAcrossMaxBoundary(s1, s2);</span>
<span class="line-modified">123         }</span>
<span class="line-modified">124     }</span>
<span class="line-modified">125 </span>
<span class="line-added">126     private void testLargeAcrossMaxBoundary(MemorySegment s1, MemorySegment s2) {</span>
<span class="line-added">127         for (long i = s2.byteSize() -1 ; i &gt;= Integer.MAX_VALUE - 10L; i--) {</span>
<span class="line-added">128             var s3 = s1.asSlice(0, i);</span>
<span class="line-added">129             var s4 = s2.asSlice(0, i);</span>
<span class="line-added">130             assertEquals(s3.mismatch(s3), -1);</span>
<span class="line-added">131             assertEquals(s3.mismatch(s4), -1);</span>
<span class="line-added">132             assertEquals(s4.mismatch(s3), -1);</span>
<span class="line-added">133         }</span>
<span class="line-added">134     }</span>
<span class="line-added">135 </span>
<span class="line-added">136     private void testLargeMismatchAcrossMaxBoundary(MemorySegment s1, MemorySegment s2) {</span>
<span class="line-added">137         for (long i = s2.byteSize() -1 ; i &gt;= Integer.MAX_VALUE - 10L; i--) {</span>
<span class="line-added">138             BYTE_HANDLE.set(s2.baseAddress().addOffset(i), (byte) 0xFF);</span>
<span class="line-added">139             long expectedMismatchOffset = i;</span>
<span class="line-added">140             assertEquals(s1.mismatch(s2), expectedMismatchOffset);</span>
<span class="line-added">141             assertEquals(s2.mismatch(s1), expectedMismatchOffset);</span>
142         }
143     }
144 
145     static final Class&lt;IllegalStateException&gt; ISE = IllegalStateException.class;
146     static final Class&lt;UnsupportedOperationException&gt; UOE = UnsupportedOperationException.class;
147 
148     @Test
149     public void testClosed() {
150         var s1 = MemorySegment.ofArray(new byte[4]);
151         var s2 = MemorySegment.ofArray(new byte[4]);
152         s1.close();
153         assertThrows(ISE, () -&gt; s1.mismatch(s1));
154         assertThrows(ISE, () -&gt; s1.mismatch(s2));
155         assertThrows(ISE, () -&gt; s2.mismatch(s1));
156     }
157 
158     @Test
159     public void testInsufficientAccessModes() {
160         var s1 = MemorySegment.ofArray(new byte[4]);
161         var s2 = MemorySegment.ofArray(new byte[4]);
</pre>
</td>
</tr>
</table>
<center><a href="../../ProblemList.txt.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../lang/invoke/unreflect/Fields.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>