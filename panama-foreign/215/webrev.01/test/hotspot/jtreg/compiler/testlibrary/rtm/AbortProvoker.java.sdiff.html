<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/compiler/testlibrary/rtm/AbortProvoker.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../jvmci/jdk.vm.ci.runtime.test/src/jdk/vm/ci/runtime/test/TestResolvedJavaType.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../containers/docker/CheckOperatingSystemMXBean.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/compiler/testlibrary/rtm/AbortProvoker.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2015, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 81         }
 82         verifyMonitorState(monitor, true /* inflated */);
 83         return monitor;
 84     }
 85 
 86     /**
 87      * Verifies that {@code monitor} is a stack-lock or inflated lock depending
 88      * on {@code shouldBeInflated} value. If {@code monitor} is inflated while
 89      * it is expected that it should be a stack-lock, then this method attempts
 90      * to deflate it by forcing a safepoint and then verifies the state once
 91      * again.
 92      *
 93      * @param monitor monitor to be verified.
 94      * @param shouldBeInflated flag indicating whether or not monitor is
 95      *                         expected to be inflated.
 96      * @throws RuntimeException if the {@code monitor} in a wrong state.
 97      */
 98     public static void verifyMonitorState(Object monitor,
 99             boolean shouldBeInflated) {
100         if (!shouldBeInflated &amp;&amp; WHITE_BOX.isMonitorInflated(monitor)) {
<span class="line-modified">101             WHITE_BOX.forceSafepoint();</span>


102         }
103         Asserts.assertEQ(WHITE_BOX.isMonitorInflated(monitor), shouldBeInflated,
104                 &quot;Monitor in a wrong state.&quot;);
105     }
106     /**
107      * Verifies that monitor used by the {@code provoker} is a stack-lock or
108      * inflated lock depending on {@code shouldBeInflated} value. If such
109      * monitor is inflated while it is expected that it should be a stack-lock,
110      * then this method attempts to deflate it by forcing a safepoint and then
111      * verifies the state once again.
112      *
113      * @param provoker AbortProvoker whose monitor&#39;s state should be verified.
114      * @param shouldBeInflated flag indicating whether or not monitor is
115      *                         expected to be inflated.
116      * @throws RuntimeException if the {@code monitor} in a wrong state.
117      */
118     public static void verifyMonitorState(AbortProvoker provoker,
119             boolean shouldBeInflated) {
120         verifyMonitorState(provoker.monitor, shouldBeInflated);
121     }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 81         }
 82         verifyMonitorState(monitor, true /* inflated */);
 83         return monitor;
 84     }
 85 
 86     /**
 87      * Verifies that {@code monitor} is a stack-lock or inflated lock depending
 88      * on {@code shouldBeInflated} value. If {@code monitor} is inflated while
 89      * it is expected that it should be a stack-lock, then this method attempts
 90      * to deflate it by forcing a safepoint and then verifies the state once
 91      * again.
 92      *
 93      * @param monitor monitor to be verified.
 94      * @param shouldBeInflated flag indicating whether or not monitor is
 95      *                         expected to be inflated.
 96      * @throws RuntimeException if the {@code monitor} in a wrong state.
 97      */
 98     public static void verifyMonitorState(Object monitor,
 99             boolean shouldBeInflated) {
100         if (!shouldBeInflated &amp;&amp; WHITE_BOX.isMonitorInflated(monitor)) {
<span class="line-modified">101             boolean did_deflation = WHITE_BOX.deflateIdleMonitors();</span>
<span class="line-added">102             Asserts.assertEQ(did_deflation, true,</span>
<span class="line-added">103                              &quot;deflateIdleMonitors() should have worked.&quot;);</span>
104         }
105         Asserts.assertEQ(WHITE_BOX.isMonitorInflated(monitor), shouldBeInflated,
106                 &quot;Monitor in a wrong state.&quot;);
107     }
108     /**
109      * Verifies that monitor used by the {@code provoker} is a stack-lock or
110      * inflated lock depending on {@code shouldBeInflated} value. If such
111      * monitor is inflated while it is expected that it should be a stack-lock,
112      * then this method attempts to deflate it by forcing a safepoint and then
113      * verifies the state once again.
114      *
115      * @param provoker AbortProvoker whose monitor&#39;s state should be verified.
116      * @param shouldBeInflated flag indicating whether or not monitor is
117      *                         expected to be inflated.
118      * @throws RuntimeException if the {@code monitor} in a wrong state.
119      */
120     public static void verifyMonitorState(AbortProvoker provoker,
121             boolean shouldBeInflated) {
122         verifyMonitorState(provoker.monitor, shouldBeInflated);
123     }
</pre>
</td>
</tr>
</table>
<center><a href="../../jvmci/jdk.vm.ci.runtime.test/src/jdk/vm/ci/runtime/test/TestResolvedJavaType.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../containers/docker/CheckOperatingSystemMXBean.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>