<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff doc/panama_jextract.md</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="panama_jextract.html.udiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="../src/jdk.incubator.jextract/share/classes/jdk/incubator/jextract/tool/HandleSourceFactory.java.udiff.html" target="_top">next &gt;</a></center>    <h2>doc/panama_jextract.md</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -228,5 +228,125 @@</span>
  # run this shell script by passing a URL as first argument
  java -Djdk.incubator.foreign.Foreign=permit --add-modules \
      jdk.incubator.foreign -Djava.library.path=/usr/lib CurlMain.java $*
  
  ```
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ## Using BLAS library</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ BLAS is a popular library that allows fast matrix and vector computation: [http://www.netlib.org/blas/](http://www.netlib.org/blas/).</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ### Installing OpenBLAS (Mac OS)</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ On Mac, blas is available as part of the OpenBLAS library: [https://github.com/xianyi/OpenBLAS/wiki](https://github.com/xianyi/OpenBLAS/wiki)</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ OpenBLAS is an optimized BLAS library based on GotoBLAS2 1.13 BSD version.</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ You can install openblas using HomeBrew</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ```sh</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ brew install openblas</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ```</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ It installs include and lib directories under /usr/local/opt/openblas</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ### jextracting cblas.h (MacOS)</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ The following command can be used to extract cblas.h on MacOs</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ```sh</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ jextract -C &quot;-D FORCE_OPENBLAS_COMPLEX_STRUCT&quot; \</span>
<span class="udiff-line-added">+   -I /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include \</span>
<span class="udiff-line-added">+   --filter cblas.h \</span>
<span class="udiff-line-added">+   -l openblas -t blas /usr/local/opt/openblas/include/cblas.h</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ```</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ### Java sample code that uses cblas library</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ```java</span>
<span class="udiff-line-added">+ import jdk.incubator.foreign.AllocationScope;</span>
<span class="udiff-line-added">+ import blas.*;</span>
<span class="udiff-line-added">+ import static blas.RuntimeHelper.*;</span>
<span class="udiff-line-added">+ import static blas.cblas_h.*;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ public class TestBlas {</span>
<span class="udiff-line-added">+     public static void main(String[] args) {</span>
<span class="udiff-line-added">+         int Layout;</span>
<span class="udiff-line-added">+         int transa;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         double alpha, beta;</span>
<span class="udiff-line-added">+         int m, n, lda, incx, incy, i;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         Layout = CblasColMajor;</span>
<span class="udiff-line-added">+         transa = CblasNoTrans;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         m = 4; /* Size of Column ( the number of rows ) */</span>
<span class="udiff-line-added">+         n = 4; /* Size of Row ( the number of columns ) */</span>
<span class="udiff-line-added">+         lda = 4; /* Leading dimension of 5 * 4 matrix is 5 */</span>
<span class="udiff-line-added">+         incx = 1;</span>
<span class="udiff-line-added">+         incy = 1;</span>
<span class="udiff-line-added">+         alpha = 1;</span>
<span class="udiff-line-added">+         beta = 0;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         double[] a = new double[m*n];</span>
<span class="udiff-line-added">+         double[] x = new double[n];</span>
<span class="udiff-line-added">+         double[] y = new double[n];</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         /* The elements of the first column */</span>
<span class="udiff-line-added">+         a[0] = 1.0;</span>
<span class="udiff-line-added">+         a[1] = 2.0;</span>
<span class="udiff-line-added">+         a[2] = 3.0;</span>
<span class="udiff-line-added">+         a[3] = 4.0;</span>
<span class="udiff-line-added">+         /* The elements of the second column */</span>
<span class="udiff-line-added">+         a[m] = 1.0;</span>
<span class="udiff-line-added">+         a[m + 1] = 1.0;</span>
<span class="udiff-line-added">+         a[m + 2] = 1.0;</span>
<span class="udiff-line-added">+         a[m + 3] = 1.0;</span>
<span class="udiff-line-added">+         /* The elements of the third column */</span>
<span class="udiff-line-added">+         a[m * 2] = 3.0;</span>
<span class="udiff-line-added">+         a[m * 2 + 1] = 4.0;</span>
<span class="udiff-line-added">+         a[m * 2 + 2] = 5.0;</span>
<span class="udiff-line-added">+         a[m * 2 + 3] = 6.0;</span>
<span class="udiff-line-added">+         /* The elements of the fourth column */</span>
<span class="udiff-line-added">+         a[m * 3] = 5.0;</span>
<span class="udiff-line-added">+         a[m * 3 + 1] = 6.0;</span>
<span class="udiff-line-added">+         a[m * 3 + 2] = 7.0;</span>
<span class="udiff-line-added">+         a[m * 3 + 3] = 8.0;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         /* The elemetns of x and y */</span>
<span class="udiff-line-added">+         x[0] = 1.0;</span>
<span class="udiff-line-added">+         x[1] = 2.0;</span>
<span class="udiff-line-added">+         x[2] = 1.0;</span>
<span class="udiff-line-added">+         x[3] = 1.0;</span>
<span class="udiff-line-added">+         y[0] = 0.0;</span>
<span class="udiff-line-added">+         y[1] = 0.0;</span>
<span class="udiff-line-added">+         y[2] = 0.0;</span>
<span class="udiff-line-added">+         y[3] = 0.0;</span>
<span class="udiff-line-added">+         try (AllocationScope scope = AllocationScope.unboundedNativeScope()) {</span>
<span class="udiff-line-added">+             var aPtr = Cdouble.allocateArray(a, scope);</span>
<span class="udiff-line-added">+             var xPtr = Cdouble.allocateArray(x, scope);</span>
<span class="udiff-line-added">+             var yPtr = Cdouble.allocateArray(y, scope);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             cblas_dgemv(Layout, transa, m, n, alpha, aPtr, lda, xPtr, incx, beta, yPtr, incy);</span>
<span class="udiff-line-added">+             /* Print y */</span>
<span class="udiff-line-added">+             for (i = 0; i &lt; n; i++) {</span>
<span class="udiff-line-added">+                 System.out.print(String.format(&quot; y%d = %f\n&quot;, i, Cdouble.get(yPtr, (long)i)));</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ```</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ### Compiling and running the above LAPACK sample</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ```sh</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ java -Djdk.incubator.foreign.Foreign=permit --add-modules jdk.incubator.foreign \</span>
<span class="udiff-line-added">+     -Djava.library.path=/usr/local/opt/openblas/lib \</span>
<span class="udiff-line-added">+     TestBlas.java</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ```</span>
</pre>
<center><a href="panama_jextract.html.udiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="../src/jdk.incubator.jextract/share/classes/jdk/incubator/jextract/tool/HandleSourceFactory.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>