<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/foreign/TestByteBuffer.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../../../../src/jdk.incubator.foreign/share/classes/jdk/internal/foreign/Utils.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>test/jdk/java/foreign/TestByteBuffer.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
380             MemoryAddress first = segment.baseAddress();
381             initializer.accept(first);
382             MemoryAddress second = MemorySegment.ofByteBuffer(segment.asByteBuffer()).baseAddress();
383             checker.accept(second);
384         }
385     }
386 
387     @Test(expectedExceptions = IllegalStateException.class)
388     public void testBufferOnClosedScope() {
389         MemorySegment leaked;
390         try (MemorySegment segment = MemorySegment.allocateNative(bytes)) {
391             leaked = segment;
392         }
393         ByteBuffer byteBuffer = leaked.asByteBuffer(); // ok
394         byteBuffer.get(); // should throw
395     }
396 
397     @Test(expectedExceptions = { UnsupportedOperationException.class,
398                                  IllegalArgumentException.class })
399     public void testTooBigForByteBuffer() {
<span class="line-modified">400         MemorySegment.allocateNative((long) Integer.MAX_VALUE * 2).asByteBuffer();</span>


401     }
402 
403     @Test(dataProvider=&quot;resizeOps&quot;)
404     public void testCopyHeapToNative(Consumer&lt;MemoryAddress&gt; checker, Consumer&lt;MemoryAddress&gt; initializer, SequenceLayout seq) {
405         checkByteArrayAlignment(seq.elementLayout());
406         int bytes = (int)seq.byteSize();
407         try (MemorySegment nativeArray = MemorySegment.allocateNative(bytes);
408              MemorySegment heapArray = MemorySegment.ofArray(new byte[bytes])) {
409             initializer.accept(heapArray.baseAddress());
410             MemoryAddress.copy(heapArray.baseAddress(), nativeArray.baseAddress(), bytes);
411             checker.accept(nativeArray.baseAddress());
412         }
413     }
414 
415     @Test(dataProvider=&quot;resizeOps&quot;)
416     public void testCopyNativeToHeap(Consumer&lt;MemoryAddress&gt; checker, Consumer&lt;MemoryAddress&gt; initializer, SequenceLayout seq) {
417         checkByteArrayAlignment(seq.elementLayout());
418         int bytes = (int)seq.byteSize();
419         try (MemorySegment nativeArray = MemorySegment.allocateNative(seq);
420              MemorySegment heapArray = MemorySegment.ofArray(new byte[bytes])) {
</pre>
</td>
<td>
<hr />
<pre>
380             MemoryAddress first = segment.baseAddress();
381             initializer.accept(first);
382             MemoryAddress second = MemorySegment.ofByteBuffer(segment.asByteBuffer()).baseAddress();
383             checker.accept(second);
384         }
385     }
386 
387     @Test(expectedExceptions = IllegalStateException.class)
388     public void testBufferOnClosedScope() {
389         MemorySegment leaked;
390         try (MemorySegment segment = MemorySegment.allocateNative(bytes)) {
391             leaked = segment;
392         }
393         ByteBuffer byteBuffer = leaked.asByteBuffer(); // ok
394         byteBuffer.get(); // should throw
395     }
396 
397     @Test(expectedExceptions = { UnsupportedOperationException.class,
398                                  IllegalArgumentException.class })
399     public void testTooBigForByteBuffer() {
<span class="line-modified">400         try (MemorySegment segment = MemorySegment.allocateNative((long)Integer.MAX_VALUE + 10L)) {</span>
<span class="line-added">401             segment.asByteBuffer();</span>
<span class="line-added">402         }</span>
403     }
404 
405     @Test(dataProvider=&quot;resizeOps&quot;)
406     public void testCopyHeapToNative(Consumer&lt;MemoryAddress&gt; checker, Consumer&lt;MemoryAddress&gt; initializer, SequenceLayout seq) {
407         checkByteArrayAlignment(seq.elementLayout());
408         int bytes = (int)seq.byteSize();
409         try (MemorySegment nativeArray = MemorySegment.allocateNative(bytes);
410              MemorySegment heapArray = MemorySegment.ofArray(new byte[bytes])) {
411             initializer.accept(heapArray.baseAddress());
412             MemoryAddress.copy(heapArray.baseAddress(), nativeArray.baseAddress(), bytes);
413             checker.accept(nativeArray.baseAddress());
414         }
415     }
416 
417     @Test(dataProvider=&quot;resizeOps&quot;)
418     public void testCopyNativeToHeap(Consumer&lt;MemoryAddress&gt; checker, Consumer&lt;MemoryAddress&gt; initializer, SequenceLayout seq) {
419         checkByteArrayAlignment(seq.elementLayout());
420         int bytes = (int)seq.byteSize();
421         try (MemorySegment nativeArray = MemorySegment.allocateNative(seq);
422              MemorySegment heapArray = MemorySegment.ofArray(new byte[bytes])) {
</pre>
</td>
</tr>
</table>
<center><a href="../../../../src/jdk.incubator.foreign/share/classes/jdk/internal/foreign/Utils.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>