<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/foreign/StdLibTest.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../../../../src/jdk.incubator.foreign/share/classes/jdk/internal/foreign/abi/x64/windows/Windowsx64ABI.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>test/jdk/java/foreign/StdLibTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
183                 strcmp = abi.downcallHandle(lookup.lookup(&quot;strcmp&quot;),
184                         MethodType.methodType(int.class, MemoryAddress.class, MemoryAddress.class),
185                         FunctionDescriptor.of(C_INT, C_POINTER, C_POINTER));
186 
187                 puts = abi.downcallHandle(lookup.lookup(&quot;puts&quot;),
188                         MethodType.methodType(int.class, MemoryAddress.class),
189                         FunctionDescriptor.of(C_INT, C_POINTER));
190 
191                 strlen = abi.downcallHandle(lookup.lookup(&quot;strlen&quot;),
192                         MethodType.methodType(int.class, MemoryAddress.class),
193                         FunctionDescriptor.of(C_INT, C_POINTER));
194 
195                 gmtime = abi.downcallHandle(lookup.lookup(&quot;gmtime&quot;),
196                         MethodType.methodType(MemoryAddress.class, MemoryAddress.class),
197                         FunctionDescriptor.of(C_POINTER, C_POINTER));
198 
199                 qsortComparFunction = FunctionDescriptor.of(C_INT, C_POINTER, C_POINTER);
200 
201                 qsort = abi.downcallHandle(lookup.lookup(&quot;qsort&quot;),
202                         MethodType.methodType(void.class, MemoryAddress.class, long.class, long.class, MemoryAddress.class),
<span class="line-modified">203                         FunctionDescriptor.ofVoid(C_POINTER, C_LONG, C_LONG, C_POINTER));</span>
204 
205                 //qsort upcall handle
206                 qsortCompar = MethodHandles.lookup().findStatic(StdLibTest.StdLibHelper.class, &quot;qsortCompare&quot;,
207                         MethodType.methodType(int.class, MemorySegment.class, MemoryAddress.class, MemoryAddress.class));
208 
209                 rand = abi.downcallHandle(lookup.lookup(&quot;rand&quot;),
210                         MethodType.methodType(int.class),
211                         FunctionDescriptor.of(C_INT));
212 
213                 printfAddr = lookup.lookup(&quot;printf&quot;);
214 
215                 printfBase = FunctionDescriptor.of(C_INT, C_POINTER);
216             } catch (Throwable ex) {
217                 throw new IllegalStateException(ex);
218             }
219         }
220 
221         String strcat(String s1, String s2) throws Throwable {
222             try (MemorySegment buf = MemorySegment.allocateNative(s1.length() + s2.length() + 1) ;
223                  MemorySegment other = toCString(s2)) {
</pre>
<hr />
<pre>
387         }
388         return instants;
389     }
390 
391     @DataProvider
392     public static Object[][] printfArgs() {
393         ArrayList&lt;List&lt;PrintfArg&gt;&gt; res = new ArrayList&lt;&gt;();
394         List&lt;List&lt;PrintfArg&gt;&gt; perms = new ArrayList&lt;&gt;(perms(0, PrintfArg.values()));
395         for (int i = 0 ; i &lt; 100 ; i++) {
396             Collections.shuffle(perms);
397             res.addAll(perms);
398         }
399         return res.stream()
400                 .map(l -&gt; new Object[] { l })
401                 .toArray(Object[][]::new);
402     }
403 
404     enum PrintfArg {
405         INTEGRAL(int.class, asVarArg(C_INT), &quot;%d&quot;, 42, 42),
406         STRING(MemoryAddress.class, asVarArg(C_POINTER), &quot;%s&quot;, toCString(&quot;str&quot;).baseAddress(), &quot;str&quot;),
<span class="line-modified">407         CHAR(char.class, asVarArg(C_CHAR), &quot;%c&quot;, &#39;h&#39;, &#39;h&#39;),</span>
408         DOUBLE(double.class, asVarArg(C_DOUBLE), &quot;%.4f&quot;, 1.2345d, 1.2345d);
409 
410         final Class&lt;?&gt; carrier;
411         final MemoryLayout layout;
412         final String format;
413         final Object nativeValue;
414         final Object javaValue;
415 
416         PrintfArg(Class&lt;?&gt; carrier, MemoryLayout layout, String format, Object nativeValue, Object javaValue) {
417             this.carrier = carrier;
418             this.layout = layout;
419             this.format = format;
420             this.nativeValue = nativeValue;
421             this.javaValue = javaValue;
422         }
423     }
424 
425     static &lt;Z&gt; Set&lt;List&lt;Z&gt;&gt; perms(int count, Z[] arr) {
426         if (count == arr.length) {
427             return Set.of(List.of());
</pre>
</td>
<td>
<hr />
<pre>
183                 strcmp = abi.downcallHandle(lookup.lookup(&quot;strcmp&quot;),
184                         MethodType.methodType(int.class, MemoryAddress.class, MemoryAddress.class),
185                         FunctionDescriptor.of(C_INT, C_POINTER, C_POINTER));
186 
187                 puts = abi.downcallHandle(lookup.lookup(&quot;puts&quot;),
188                         MethodType.methodType(int.class, MemoryAddress.class),
189                         FunctionDescriptor.of(C_INT, C_POINTER));
190 
191                 strlen = abi.downcallHandle(lookup.lookup(&quot;strlen&quot;),
192                         MethodType.methodType(int.class, MemoryAddress.class),
193                         FunctionDescriptor.of(C_INT, C_POINTER));
194 
195                 gmtime = abi.downcallHandle(lookup.lookup(&quot;gmtime&quot;),
196                         MethodType.methodType(MemoryAddress.class, MemoryAddress.class),
197                         FunctionDescriptor.of(C_POINTER, C_POINTER));
198 
199                 qsortComparFunction = FunctionDescriptor.of(C_INT, C_POINTER, C_POINTER);
200 
201                 qsort = abi.downcallHandle(lookup.lookup(&quot;qsort&quot;),
202                         MethodType.methodType(void.class, MemoryAddress.class, long.class, long.class, MemoryAddress.class),
<span class="line-modified">203                         FunctionDescriptor.ofVoid(C_POINTER, C_LONGLONG, C_LONGLONG, C_POINTER));</span>
204 
205                 //qsort upcall handle
206                 qsortCompar = MethodHandles.lookup().findStatic(StdLibTest.StdLibHelper.class, &quot;qsortCompare&quot;,
207                         MethodType.methodType(int.class, MemorySegment.class, MemoryAddress.class, MemoryAddress.class));
208 
209                 rand = abi.downcallHandle(lookup.lookup(&quot;rand&quot;),
210                         MethodType.methodType(int.class),
211                         FunctionDescriptor.of(C_INT));
212 
213                 printfAddr = lookup.lookup(&quot;printf&quot;);
214 
215                 printfBase = FunctionDescriptor.of(C_INT, C_POINTER);
216             } catch (Throwable ex) {
217                 throw new IllegalStateException(ex);
218             }
219         }
220 
221         String strcat(String s1, String s2) throws Throwable {
222             try (MemorySegment buf = MemorySegment.allocateNative(s1.length() + s2.length() + 1) ;
223                  MemorySegment other = toCString(s2)) {
</pre>
<hr />
<pre>
387         }
388         return instants;
389     }
390 
391     @DataProvider
392     public static Object[][] printfArgs() {
393         ArrayList&lt;List&lt;PrintfArg&gt;&gt; res = new ArrayList&lt;&gt;();
394         List&lt;List&lt;PrintfArg&gt;&gt; perms = new ArrayList&lt;&gt;(perms(0, PrintfArg.values()));
395         for (int i = 0 ; i &lt; 100 ; i++) {
396             Collections.shuffle(perms);
397             res.addAll(perms);
398         }
399         return res.stream()
400                 .map(l -&gt; new Object[] { l })
401                 .toArray(Object[][]::new);
402     }
403 
404     enum PrintfArg {
405         INTEGRAL(int.class, asVarArg(C_INT), &quot;%d&quot;, 42, 42),
406         STRING(MemoryAddress.class, asVarArg(C_POINTER), &quot;%s&quot;, toCString(&quot;str&quot;).baseAddress(), &quot;str&quot;),
<span class="line-modified">407         CHAR(byte.class, asVarArg(C_CHAR), &quot;%c&quot;, (byte) &#39;h&#39;, &#39;h&#39;),</span>
408         DOUBLE(double.class, asVarArg(C_DOUBLE), &quot;%.4f&quot;, 1.2345d, 1.2345d);
409 
410         final Class&lt;?&gt; carrier;
411         final MemoryLayout layout;
412         final String format;
413         final Object nativeValue;
414         final Object javaValue;
415 
416         PrintfArg(Class&lt;?&gt; carrier, MemoryLayout layout, String format, Object nativeValue, Object javaValue) {
417             this.carrier = carrier;
418             this.layout = layout;
419             this.format = format;
420             this.nativeValue = nativeValue;
421             this.javaValue = javaValue;
422         }
423     }
424 
425     static &lt;Z&gt; Set&lt;List&lt;Z&gt;&gt; perms(int count, Z[] arr) {
426         if (count == arr.length) {
427             return Set.of(List.of());
</pre>
</td>
</tr>
</table>
<center><a href="../../../../src/jdk.incubator.foreign/share/classes/jdk/internal/foreign/abi/x64/windows/Windowsx64ABI.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>