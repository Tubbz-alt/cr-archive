<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff doc/panama_jextract.md</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="panama_jextract.html.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> next &gt;</center>    <h2>doc/panama_jextract.md</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  63 ```java
  64 
  65 import static org.hello.helloworld_h.*;
  66 
  67 public class HelloWorld {
  68     public static void main(String[] args) {
  69         helloworld();
  70     }
  71 }
  72 
  73 ```
  74 
  75 ### Running the Java code that invokes helloworld
  76 
  77 ```sh
  78 
  79 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign HelloWorld.java
  80 
  81 ```
  82 
<span class="line-modified">  83 ## Embedding Python interpreter in your Java program (Mac OS)</span>
  84 
<span class="line-modified">  85 ### jextract Python.h</span>
  86 
  87 ```sh
  88 
  89 jextract \
  90   -l python2.7 \
  91   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
  92   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/python2.7/ \
  93   -t org.python \
  94    /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/python2.7/Python.h
  95 
  96 ```
  97 










































  98 ### Java program that uses extracted Python interface
  99 
 100 ```java
 101 
 102 
 103 import static jdk.incubator.foreign.CSupport.*;
 104 import static jdk.incubator.foreign.MemoryAddress.NULL;
 105 // import jextracted python &#39;header&#39; class
 106 import static org.python.RuntimeHelper.*;
 107 import static org.python.Python_h.*;
 108 
 109 public class PythonMain {
 110     public static void main(String[] args) {
 111         String script = &quot;print(sum([33, 55, 66])); print(&#39;Hello from Python!&#39;)\n&quot;;
 112 
 113         Py_Initialize();
 114         try (var s = toCString(script)) {
 115             var str = s.baseAddress();
 116             PyRun_SimpleStringFlags(str, NULL);
 117             Py_Finalize();
 118         }
 119     }
 120 }
 121 
 122 ```
 123 
<span class="line-modified"> 124 ### Running the Java code that calls Python interpreter</span>
 125 
 126 ```sh
 127 
 128 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
 129     -Djava.library.path=/System/Library/Frameworks/Python.framework/Versions/2.7/lib \
 130     PythonMain.java
 131 
 132 ```
 133 
<span class="line-modified"> 134 ## Using readline library from Java code (Mac OS)</span>











 135 
<span class="line-modified"> 136 ### jextract readline.h</span>






 137 
 138 ```sh
 139 
 140 jextract \
 141   -l readline -t org.unix \
 142   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
 143    /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/readline/readline.h
 144 
 145 ```
 146 
 147 ### Java code that uses readline
 148 
 149 ```java
 150 
 151 import static org.unix.RuntimeHelper.*;
 152 import static org.unix.readline_h.*;
 153 import static jdk.incubator.foreign.CSupport.*;
 154 
 155 public class Readline {
 156     public static void main(String[] args) {
 157         try (var s = toCString(&quot;name? &quot;)) {
 158             var pstr = s.baseAddress();
 159             // call &quot;readline&quot; API
 160             var p = readline(pstr);
 161 
 162             // print char* as is
 163             System.out.println(p);
 164             // convert char* ptr from readline as Java String &amp; print it
 165             System.out.println(&quot;Hello, &quot; + toJavaStringRestricted(p));
 166         }
 167     }
 168 }
 169 
 170 ```
 171 
<span class="line-modified"> 172 ### Running the java code that uses readline</span>
 173 
 174 ```
 175 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
 176     -Djava.library.path=/usr/local/opt/readline/lib/ Readline.java
 177 
 178 ```
 179 
<span class="line-modified"> 180 ## Using libcurl from Java (Mac OS)</span>
 181 
<span class="line-modified"> 182 ### jextract curl.h</span>
 183 
 184 ```sh
 185 
<span class="line-modified"> 186 jextract -t org.unix -lcurl \</span>
 187   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/ \
 188   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/curl/ \
 189   /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/curl/curl.h
 190 
 191 ```
 192 

















 193 ### Java code that uses libcurl
 194 
 195 ```java
 196 
 197 
 198 import static jdk.incubator.foreign.MemoryAddress.NULL;
<span class="line-modified"> 199 import static org.unix.RuntimeHelper.*;</span>
<span class="line-modified"> 200 import static org.unix.curl_h.*;</span>
 201 import static jdk.incubator.foreign.CSupport.*;
 202 
 203 public class CurlMain {
 204    public static void main(String[] args) {
 205        var urlStr = args[0];
 206        curl_global_init(CURL_GLOBAL_DEFAULT());
 207        var curl = curl_easy_init();
 208        if(!curl.equals(NULL)) {
 209            try (var s = toCString(urlStr)) {
 210                var url = s.baseAddress();
 211                curl_easy_setopt(curl, CURLOPT_URL(), url);
 212                int res = curl_easy_perform(curl);
 213                if (res != CURLE_OK()) {
 214                    curl_easy_cleanup(curl);
 215                }
 216            }
 217        }
 218        curl_global_cleanup();
 219    }
 220 }
 221 
 222 ```
 223 
<span class="line-modified"> 224 ### Running the java code that uses libcurl</span>
 225 
 226 ```sh
 227 
 228 # run this shell script by passing a URL as first argument
 229 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
 230     -Djava.library.path=/usr/lib CurlMain.java $*
 231 
 232 ```
 233 



















 234 ## Using BLAS library
 235 
 236 BLAS is a popular library that allows fast matrix and vector computation: [http://www.netlib.org/blas/](http://www.netlib.org/blas/).
 237 
 238 ### Installing OpenBLAS (Mac OS)
 239 
 240 On Mac, blas is available as part of the OpenBLAS library: [https://github.com/xianyi/OpenBLAS/wiki](https://github.com/xianyi/OpenBLAS/wiki)
 241 
 242 OpenBLAS is an optimized BLAS library based on GotoBLAS2 1.13 BSD version.
 243 
 244 You can install openblas using HomeBrew
 245 
 246 ```sh
 247 
 248 brew install openblas
 249 
 250 ```
 251 
 252 It installs include and lib directories under /usr/local/opt/openblas
 253 
<span class="line-modified"> 254 ### jextracting cblas.h (MacOS)</span>
 255 
 256 The following command can be used to extract cblas.h on MacOs
 257 
 258 ```sh
 259 
 260 jextract -C &quot;-D FORCE_OPENBLAS_COMPLEX_STRUCT&quot; \
 261   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
 262   -l openblas -t blas /usr/local/opt/openblas/include/cblas.h
 263 
 264 ```
 265 

















 266 ### Java sample code that uses cblas library
 267 
 268 ```java
 269 
 270 import jdk.incubator.foreign.MemoryAddress;
 271 import jdk.incubator.foreign.MemoryAccess;
 272 import jdk.incubator.foreign.NativeScope;
 273 import blas.*;
 274 import static blas.RuntimeHelper.*;
 275 import static blas.cblas_h.*;
 276 import static jdk.incubator.foreign.CSupport.*;
 277 
 278 public class TestBlas {
 279     public static void main(String[] args) {
 280         int Layout;
 281         int transa;
 282 
 283         double alpha, beta;
 284         int m, n, lda, incx, incy, i;
 285 
</pre>
<hr />
<pre>
 299                 1.0, 2.0, 3.0, 4.0,
 300                 1.0, 1.0, 1.0, 1.0,
 301                 3.0, 4.0, 5.0, 6.0,
 302                 5.0, 6.0, 7.0, 8.0
 303             });
 304             var x = scope.allocateArray(C_DOUBLE, new double[] {
 305                 1.0, 2.0, 1.0, 1.0
 306             });
 307             var y = scope.allocateArray(C_DOUBLE, n);
 308 
 309             cblas_dgemv(Layout, transa, m, n, alpha, a, lda, x, incx, beta, y, incy);
 310             /* Print y */
 311             for (i = 0; i &lt; n; i++) {
 312                 System.out.print(String.format(&quot; y%d = %f\n&quot;, i, MemoryAccess.getDoubleAtIndex(y, i)));
 313             }
 314         }
 315     }
 316 }
 317 ```
 318 
<span class="line-modified"> 319 ### Compiling and running the above BLAS sample</span>
 320 
 321 ```sh
 322 
<span class="line-modified"> 323 jextract \</span>
<span class="line-modified"> 324   -C &quot;-D FORCE_OPENBLAS_COMPLEX_STRUCT&quot; \</span>
<span class="line-modified"> 325   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \</span>
<span class="line-modified"> 326   -l openblas -t blas /usr/local/opt/openblas/include/cblas.h</span>




















 327 
 328 ```
 329 
<span class="line-modified"> 330 ## Using LAPACK library (Mac OS)</span>
 331 
 332 On Mac OS, lapack is installed under /usr/local/opt/lapack directory.
 333 
<span class="line-modified"> 334 ### jextracting lapacke.h</span>
 335 
 336 ```sh
 337 
 338 jextract \
 339    -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
 340    -l lapacke -t lapack \
 341    --filter lapacke.h \
 342    /usr/local/opt/lapack/include/lapacke.h
 343 
 344 ```
 345 

















 346 ### Java sample code that uses LAPACK library
 347 
 348 ```java
 349 
 350 import jdk.incubator.foreign.MemoryAccess;
 351 import jdk.incubator.foreign.MemoryAddress;
 352 import jdk.incubator.foreign.NativeScope;
 353 import lapack.*;
 354 import static lapack.lapacke_h.*;
 355 import static jdk.incubator.foreign.CSupport.*;
 356 
 357 public class TestLapack {
 358     public static void main(String[] args) {
 359 
 360         /* Locals */
 361         try (var scope = NativeScope.unboundedScope()) {
 362             var A = scope.allocateArray(C_DOUBLE, new double[]{
 363                     1, 2, 3, 4, 5, 1, 3, 5, 2, 4, 1, 4, 2, 5, 3
 364             });
 365             var b = scope.allocateArray(C_DOUBLE, new double[]{
</pre>
<hr />
<pre>
 388             /* Print Solution */
 389             print_matrix_colmajor(&quot;Solution&quot;, n, nrhs, b, ldb );
 390             System.out.println();
 391             System.exit(info);
 392         }
 393     }
 394 
 395     static void print_matrix_colmajor(String msg, int m, int n, MemoryAddress mat, int ldm) {
 396         int i, j;
 397         System.out.printf(&quot;\n %s\n&quot;, msg);
 398 
 399         for( i = 0; i &lt; m; i++ ) {
 400             for( j = 0; j &lt; n; j++ ) System.out.printf(&quot; %6.2f&quot;, MemoryAccess.getDoubleAtIndex(mat, i+j*ldm));
 401             System.out.printf( &quot;\n&quot; );
 402         }
 403     }
 404 }
 405 
 406 ```
 407 
<span class="line-modified"> 408 ### Compiling and running the above LAPACK sample</span>
 409 
 410 ```sh
 411 
 412 java -Dforeign.restricted=permit \
 413     --add-modules jdk.incubator.foreign \
 414     -Djava.library.path=/usr/local/opt/lapack/lib \
 415     TestLapack.java
 416 
 417 ```
<span class="line-removed"> 418 ## Using libproc library to list processes from Java (Mac OS)</span>
 419 
<span class="line-modified"> 420 ### jextract libproc.h</span>
























 421 
 422 ```sh
 423 
 424 jextract \
 425   -t org.unix \
 426   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
 427   --filter libproc.h \
 428   /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/libproc.h
 429 
 430 ```
 431 
 432 ### Java program that uses libproc to list processes
 433 
 434 ```java
 435 
 436 import jdk.incubator.foreign.CSupport;
 437 import jdk.incubator.foreign.MemorySegment;
 438 import jdk.incubator.foreign.NativeScope;
 439 import org.unix.*;
 440 import static jdk.incubator.foreign.MemoryAddress.NULL;
</pre>
<hr />
<pre>
 452             // list all the pids into the native array
 453             proc_listallpids(pids, numPids);
 454             // convert native array to java array
 455             int[] jpids = pids.segment().toIntArray();
 456             // buffer for process name
 457             var nameBuf = scope.allocateArray(CSupport.C_CHAR, NAME_BUF_MAX);
 458             for (int i = 0; i &lt; jpids.length; i++) {
 459                 int pid = jpids[i];
 460                 // get the process name
 461                 proc_name(pid, nameBuf, NAME_BUF_MAX);
 462                 String procName = CSupport.toJavaString(nameBuf);
 463                 // print pid and process name
 464                 System.out.printf(&quot;%d %s\n&quot;, pid, procName);
 465             }
 466         }
 467     }
 468 }
 469 
 470 ```
 471 
<span class="line-modified"> 472 ### Compiling and running the libproc sample</span>
 473 
 474 ```sh
 475 
 476 java -Dforeign.restricted=permit \
 477     --add-modules jdk.incubator.foreign \
 478     -Djava.library.path=/usr/lib LibprocMain.java
 479 
 480 ```
 481 
<span class="line-modified"> 482 ## Using libgit2 from Java (Mac OS)</span>
 483 
<span class="line-modified"> 484 ### Getting and building libgit2</span>
 485 
 486 * Download libgit2 v1.0.0 source from https://github.com/libgit2/libgit2/releases
 487 * Use cmake to build from libgit2
 488 * Let ${LIBGIT2_HOME} be the directory where you expanded libgit2 sources.
 489 * Let ${LIBGIT2_HOME}/build be the build directory where libgit2.dylib is built.
 490 
<span class="line-modified"> 491 ### jextract git2.h</span>
 492 
 493 ```sh
 494 
 495 jextract \
 496   -t com.github -lgit2 \
 497   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/ \
 498   -I ${LIBGIT2_HOME}/include/ \
 499   -I ${LIBGIT2_HOME}/include/git2 \
 500   ${LIBGIT2_HOME}/include/git2.h
 501 
 502 ```
 503 

















 504 ### Java program that uses libgit2 to clone github repo
 505 
 506 ```java
 507 
 508 import jdk.incubator.foreign.MemoryAddress;
 509 import jdk.incubator.foreign.NativeScope;
 510 import static com.github.git2_h.*;
 511 import static jdk.incubator.foreign.CSupport.*;
 512 import static jdk.incubator.foreign.MemoryAddress.NULL;
 513 
 514 public class GitClone {
 515     public static void main(String[] args) {
 516           if (args.length != 2) {
 517               System.err.println(&quot;java GitClone &lt;url&gt; &lt;path&gt;&quot;);
 518               System.exit(1);
 519           }
 520           git_libgit2_init();
 521           try (var scope = NativeScope.unboundedScope()) {
 522               var repo = scope.allocate(C_POINTER);
 523               var url = toCString(args[0], scope);
 524               var path = toCString(args[1], scope);
 525               System.out.println(git_clone(repo, url, path, NULL));
 526           }
 527           git_libgit2_shutdown();
 528     }
 529 }
 530 
 531 ```
 532 
<span class="line-modified"> 533 ### Compiling and running the libgit2 sample</span>
 534 
 535 ```sh
 536 
 537 # file run.sh
 538 
 539 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
 540     -Djava.library.path=${LIBGIT2_HOME}/build/ \
 541     GitClone.java $*
 542 ```
 543 





















 544 ### Cloning a github repo using the above run.sh command
 545 
 546 ```sh
 547 
 548 sh run.sh https://github.com/libgit2/libgit2.git libgit2
 549 
 550 ```
 551 
<span class="line-modified"> 552 ## Using sqlite3 library from Java (Mac OS)</span>
 553 
<span class="line-modified"> 554 </span>
<span class="line-removed"> 555 ### jextract sqlite3.h</span>
 556 
 557 ```sh
 558 
 559 jextract \
 560   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
 561   /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/sqlite3.h \
 562   -t org.sqlite -lsqlite3
 563 
 564 ```
 565 ### Java program that uses sqlite3
 566 
 567 ```java
 568 
 569 import jdk.incubator.foreign.MemoryAddress;
 570 import jdk.incubator.foreign.MemoryAccess;
 571 import jdk.incubator.foreign.NativeScope;
 572 import static jdk.incubator.foreign.MemoryAddress.NULL;
 573 import static org.sqlite.sqlite3_h.*;
 574 import static org.sqlite.RuntimeHelper.*;
 575 import static jdk.incubator.foreign.CSupport.*;
</pre>
<hr />
<pre>
 645 
 646             // select query
 647             sql = toCString(&quot;SELECT * FROM EMPLOYEE&quot;, scope);
 648             rc = sqlite3_exec(dbPtr, sql, callback, NULL, errMsgPtrPtr);
 649 
 650             if (rc != 0) {
 651                 System.err.println(&quot;sqlite3_exec failed: &quot; + rc);
 652                 System.err.println(&quot;SQL error: &quot; + toJavaStringRestricted(MemoryAccess.getAddress(errMsgPtrPtr)));
 653                 sqlite3_free(MemoryAccess.getAddress(errMsgPtrPtr));
 654             } else {
 655                 System.out.println(&quot;done&quot;);
 656             }
 657 
 658             sqlite3_close(dbPtr);
 659         }
 660     }
 661 }
 662 
 663 ```
 664 
<span class="line-modified"> 665 ### Compiling and running the sqlite3 sample</span>
 666 
 667 ```sh
 668 
 669 java -Dforeign.restricted=permit \
 670    --add-modules jdk.incubator.foreign \
 671    -Djava.library.path=/usr/lib SqliteMain.java
 672 
 673 ```
























































































































</pre>
</td>
<td>
<hr />
<pre>
  63 ```java
  64 
  65 import static org.hello.helloworld_h.*;
  66 
  67 public class HelloWorld {
  68     public static void main(String[] args) {
  69         helloworld();
  70     }
  71 }
  72 
  73 ```
  74 
  75 ### Running the Java code that invokes helloworld
  76 
  77 ```sh
  78 
  79 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign HelloWorld.java
  80 
  81 ```
  82 
<span class="line-modified">  83 ## Embedding Python interpreter in your Java program</span>
  84 
<span class="line-modified">  85 ### jextract Python.h (Mac OS)</span>
  86 
  87 ```sh
  88 
  89 jextract \
  90   -l python2.7 \
  91   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
  92   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/python2.7/ \
  93   -t org.python \
  94    /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/python2.7/Python.h
  95 
  96 ```
  97 
<span class="line-added">  98 ### Shared Windows Utility script (used in all samples - shared_windows.ps1)</span>
<span class="line-added">  99 </span>
<span class="line-added"> 100 ```powershell</span>
<span class="line-added"> 101 </span>
<span class="line-added"> 102 $jdk = $Env:JAVA_HOME</span>
<span class="line-added"> 103 </span>
<span class="line-added"> 104 function find-tool($tool) {</span>
<span class="line-added"> 105   if (Test-Path &quot;$jdk\bin\$tool.exe&quot;) {</span>
<span class="line-added"> 106     $func = {</span>
<span class="line-added"> 107       &amp; &quot;$jdk\bin\$tool.exe&quot; $args;</span>
<span class="line-added"> 108       if ($LASTEXITCODE -ne 0) {</span>
<span class="line-added"> 109         Write-Host &quot;ERROR: $tool exited with non-zero exit code: $LASTEXITCODE&quot;</span>
<span class="line-added"> 110         exit</span>
<span class="line-added"> 111       }</span>
<span class="line-added"> 112     }.GetNewClosure()</span>
<span class="line-added"> 113     &amp; $func.Module Set-Variable jdk $jdk</span>
<span class="line-added"> 114     return $func</span>
<span class="line-added"> 115   } else {</span>
<span class="line-added"> 116     Write-Host &quot;ERROR: Could not find $tool executable in %JAVA_HOME%\bin.&quot;</span>
<span class="line-added"> 117     exit</span>
<span class="line-added"> 118   }</span>
<span class="line-added"> 119 }</span>
<span class="line-added"> 120 </span>
<span class="line-added"> 121 ```</span>
<span class="line-added"> 122 </span>
<span class="line-added"> 123 ### jextract Python.h (Windows)</span>
<span class="line-added"> 124 </span>
<span class="line-added"> 125 ```powershell</span>
<span class="line-added"> 126 </span>
<span class="line-added"> 127 param(</span>
<span class="line-added"> 128   [Parameter(Mandatory=$true, HelpMessage=&quot;The path python install&quot;)]</span>
<span class="line-added"> 129   [string]$pythonPath</span>
<span class="line-added"> 130 )</span>
<span class="line-added"> 131 </span>
<span class="line-added"> 132 . ./shared_windows.ps1</span>
<span class="line-added"> 133 </span>
<span class="line-added"> 134 $jextract = find-tool(&quot;jextract&quot;)</span>
<span class="line-added"> 135 </span>
<span class="line-added"> 136 &amp; $jextract -I &quot;$pythonPath\include&quot; &quot;-l&quot; python3 &quot;-t&quot; &quot;org.python&quot; -J-Xmx2G -J&quot;-Djextract.log=true&quot; -J&quot;-Djextract.debug=true&quot; &quot;--&quot; &quot;$pythonPath\include\Python.h&quot;</span>
<span class="line-added"> 137 </span>
<span class="line-added"> 138 ```</span>
<span class="line-added"> 139 </span>
 140 ### Java program that uses extracted Python interface
 141 
 142 ```java
 143 
 144 
 145 import static jdk.incubator.foreign.CSupport.*;
 146 import static jdk.incubator.foreign.MemoryAddress.NULL;
 147 // import jextracted python &#39;header&#39; class
 148 import static org.python.RuntimeHelper.*;
 149 import static org.python.Python_h.*;
 150 
 151 public class PythonMain {
 152     public static void main(String[] args) {
 153         String script = &quot;print(sum([33, 55, 66])); print(&#39;Hello from Python!&#39;)\n&quot;;
 154 
 155         Py_Initialize();
 156         try (var s = toCString(script)) {
 157             var str = s.baseAddress();
 158             PyRun_SimpleStringFlags(str, NULL);
 159             Py_Finalize();
 160         }
 161     }
 162 }
 163 
 164 ```
 165 
<span class="line-modified"> 166 ### Running the Java code that calls Python interpreter (Mac OS)</span>
 167 
 168 ```sh
 169 
 170 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
 171     -Djava.library.path=/System/Library/Frameworks/Python.framework/Versions/2.7/lib \
 172     PythonMain.java
 173 
 174 ```
 175 
<span class="line-modified"> 176 ### Running the Java code that calls Python interpreter (Windows)</span>
<span class="line-added"> 177 </span>
<span class="line-added"> 178 ```powershell</span>
<span class="line-added"> 179 </span>
<span class="line-added"> 180 param(</span>
<span class="line-added"> 181   [Parameter(Mandatory=$true, HelpMessage=&quot;The path python install&quot;)]</span>
<span class="line-added"> 182   [string]$pythonPath</span>
<span class="line-added"> 183 )</span>
<span class="line-added"> 184 </span>
<span class="line-added"> 185 . ./shared_windows.ps1</span>
<span class="line-added"> 186 </span>
<span class="line-added"> 187 $java = find-tool(&quot;java&quot;)</span>
 188 
<span class="line-modified"> 189 &amp; $java -D&quot;foreign.restricted=permit&quot; --add-modules jdk.incubator.foreign -D&quot;java.library.path=$pythonPath&quot; PythonMain.java</span>
<span class="line-added"> 190 </span>
<span class="line-added"> 191 ```</span>
<span class="line-added"> 192 </span>
<span class="line-added"> 193 ## Using readline library from Java code</span>
<span class="line-added"> 194 </span>
<span class="line-added"> 195 ### jextract readline.h (Mac OS)</span>
 196 
 197 ```sh
 198 
 199 jextract \
 200   -l readline -t org.unix \
 201   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
 202    /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/readline/readline.h
 203 
 204 ```
 205 
 206 ### Java code that uses readline
 207 
 208 ```java
 209 
 210 import static org.unix.RuntimeHelper.*;
 211 import static org.unix.readline_h.*;
 212 import static jdk.incubator.foreign.CSupport.*;
 213 
 214 public class Readline {
 215     public static void main(String[] args) {
 216         try (var s = toCString(&quot;name? &quot;)) {
 217             var pstr = s.baseAddress();
 218             // call &quot;readline&quot; API
 219             var p = readline(pstr);
 220 
 221             // print char* as is
 222             System.out.println(p);
 223             // convert char* ptr from readline as Java String &amp; print it
 224             System.out.println(&quot;Hello, &quot; + toJavaStringRestricted(p));
 225         }
 226     }
 227 }
 228 
 229 ```
 230 
<span class="line-modified"> 231 ### Running the java code that uses readline (Mac OS)</span>
 232 
 233 ```
 234 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
 235     -Djava.library.path=/usr/local/opt/readline/lib/ Readline.java
 236 
 237 ```
 238 
<span class="line-modified"> 239 ## Using libcurl from Java</span>
 240 
<span class="line-modified"> 241 ### jextract curl.h (Mac OS)</span>
 242 
 243 ```sh
 244 
<span class="line-modified"> 245 jextract -t org.jextract -lcurl \</span>
 246   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/ \
 247   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/curl/ \
 248   /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/curl/curl.h
 249 
 250 ```
 251 
<span class="line-added"> 252 ### jextract curl.h (Windows)</span>
<span class="line-added"> 253 </span>
<span class="line-added"> 254 ```powershell</span>
<span class="line-added"> 255 </span>
<span class="line-added"> 256 param(</span>
<span class="line-added"> 257   [Parameter(Mandatory=$true, HelpMessage=&quot;The path to the lib curl installation&quot;)]</span>
<span class="line-added"> 258   [string]$curlpath</span>
<span class="line-added"> 259 )</span>
<span class="line-added"> 260 </span>
<span class="line-added"> 261 . ./shared_windows.ps1</span>
<span class="line-added"> 262 </span>
<span class="line-added"> 263 $jextract = find-tool(&quot;jextract&quot;)</span>
<span class="line-added"> 264 </span>
<span class="line-added"> 265 &amp; $jextract -t org.jextract -I &quot;$curlpath\include&quot; -I &quot;$curlpath\include\curl&quot; -J-Xmx2G -llibcurl --filter &#39;curl&#39; -- &quot;$curlpath\include\curl\curl.h&quot;</span>
<span class="line-added"> 266 </span>
<span class="line-added"> 267 ```</span>
<span class="line-added"> 268 </span>
 269 ### Java code that uses libcurl
 270 
 271 ```java
 272 
 273 
 274 import static jdk.incubator.foreign.MemoryAddress.NULL;
<span class="line-modified"> 275 import static org.jextract.RuntimeHelper.*;</span>
<span class="line-modified"> 276 import static org.jextract.curl_h.*;</span>
 277 import static jdk.incubator.foreign.CSupport.*;
 278 
 279 public class CurlMain {
 280    public static void main(String[] args) {
 281        var urlStr = args[0];
 282        curl_global_init(CURL_GLOBAL_DEFAULT());
 283        var curl = curl_easy_init();
 284        if(!curl.equals(NULL)) {
 285            try (var s = toCString(urlStr)) {
 286                var url = s.baseAddress();
 287                curl_easy_setopt(curl, CURLOPT_URL(), url);
 288                int res = curl_easy_perform(curl);
 289                if (res != CURLE_OK()) {
 290                    curl_easy_cleanup(curl);
 291                }
 292            }
 293        }
 294        curl_global_cleanup();
 295    }
 296 }
 297 
 298 ```
 299 
<span class="line-modified"> 300 ### Running the java code that uses libcurl (Mac OS)</span>
 301 
 302 ```sh
 303 
 304 # run this shell script by passing a URL as first argument
 305 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
 306     -Djava.library.path=/usr/lib CurlMain.java $*
 307 
 308 ```
 309 
<span class="line-added"> 310 ### Running the java code that uses libcurl (Windows)</span>
<span class="line-added"> 311 </span>
<span class="line-added"> 312 ```powershell</span>
<span class="line-added"> 313 </span>
<span class="line-added"> 314 param(</span>
<span class="line-added"> 315   [Parameter(Mandatory=$true, HelpMessage=&quot;The path to the lib curl installation&quot;)]</span>
<span class="line-added"> 316   [string]$curlpath,</span>
<span class="line-added"> 317   [Parameter(Mandatory=$true, HelpMessage=&quot;URL to get&quot;)]</span>
<span class="line-added"> 318   [string]$url</span>
<span class="line-added"> 319 )</span>
<span class="line-added"> 320 </span>
<span class="line-added"> 321 . ./shared_windows.ps1</span>
<span class="line-added"> 322 </span>
<span class="line-added"> 323 $java = find-tool(&quot;java&quot;)</span>
<span class="line-added"> 324 </span>
<span class="line-added"> 325 &amp; $java -D&quot;foreign.restricted=permit&quot; --add-modules jdk.incubator.foreign -D&quot;java.library.path=$curlpath\bin&quot; CurlMain.java $url</span>
<span class="line-added"> 326 </span>
<span class="line-added"> 327 ```</span>
<span class="line-added"> 328 </span>
 329 ## Using BLAS library
 330 
 331 BLAS is a popular library that allows fast matrix and vector computation: [http://www.netlib.org/blas/](http://www.netlib.org/blas/).
 332 
 333 ### Installing OpenBLAS (Mac OS)
 334 
 335 On Mac, blas is available as part of the OpenBLAS library: [https://github.com/xianyi/OpenBLAS/wiki](https://github.com/xianyi/OpenBLAS/wiki)
 336 
 337 OpenBLAS is an optimized BLAS library based on GotoBLAS2 1.13 BSD version.
 338 
 339 You can install openblas using HomeBrew
 340 
 341 ```sh
 342 
 343 brew install openblas
 344 
 345 ```
 346 
 347 It installs include and lib directories under /usr/local/opt/openblas
 348 
<span class="line-modified"> 349 ### jextracting cblas.h (Mac OS)</span>
 350 
 351 The following command can be used to extract cblas.h on MacOs
 352 
 353 ```sh
 354 
 355 jextract -C &quot;-D FORCE_OPENBLAS_COMPLEX_STRUCT&quot; \
 356   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
 357   -l openblas -t blas /usr/local/opt/openblas/include/cblas.h
 358 
 359 ```
 360 
<span class="line-added"> 361 ### jextracting cblas.h (Windows)</span>
<span class="line-added"> 362 </span>
<span class="line-added"> 363 ```powershell</span>
<span class="line-added"> 364 </span>
<span class="line-added"> 365 param(</span>
<span class="line-added"> 366   [Parameter(Mandatory=$true, HelpMessage=&quot;The path to the lapack installation which include/cblas.h and dependent headers&quot;)]</span>
<span class="line-added"> 367   [string]$blasPath</span>
<span class="line-added"> 368 )</span>
<span class="line-added"> 369 </span>
<span class="line-added"> 370 . ./shared_windows.ps1</span>
<span class="line-added"> 371 </span>
<span class="line-added"> 372 $jextract = find-tool(&quot;jextract&quot;)</span>
<span class="line-added"> 373 </span>
<span class="line-added"> 374 &amp; $jextract -t blas -I &quot;$blasPath\include&quot; -l libcblas -J-Xmx2G --filter &#39;cblas.h&#39; -- &quot;$blasPath\include\cblas.h&quot;</span>
<span class="line-added"> 375 </span>
<span class="line-added"> 376 ```</span>
<span class="line-added"> 377 </span>
 378 ### Java sample code that uses cblas library
 379 
 380 ```java
 381 
 382 import jdk.incubator.foreign.MemoryAddress;
 383 import jdk.incubator.foreign.MemoryAccess;
 384 import jdk.incubator.foreign.NativeScope;
 385 import blas.*;
 386 import static blas.RuntimeHelper.*;
 387 import static blas.cblas_h.*;
 388 import static jdk.incubator.foreign.CSupport.*;
 389 
 390 public class TestBlas {
 391     public static void main(String[] args) {
 392         int Layout;
 393         int transa;
 394 
 395         double alpha, beta;
 396         int m, n, lda, incx, incy, i;
 397 
</pre>
<hr />
<pre>
 411                 1.0, 2.0, 3.0, 4.0,
 412                 1.0, 1.0, 1.0, 1.0,
 413                 3.0, 4.0, 5.0, 6.0,
 414                 5.0, 6.0, 7.0, 8.0
 415             });
 416             var x = scope.allocateArray(C_DOUBLE, new double[] {
 417                 1.0, 2.0, 1.0, 1.0
 418             });
 419             var y = scope.allocateArray(C_DOUBLE, n);
 420 
 421             cblas_dgemv(Layout, transa, m, n, alpha, a, lda, x, incx, beta, y, incy);
 422             /* Print y */
 423             for (i = 0; i &lt; n; i++) {
 424                 System.out.print(String.format(&quot; y%d = %f\n&quot;, i, MemoryAccess.getDoubleAtIndex(y, i)));
 425             }
 426         }
 427     }
 428 }
 429 ```
 430 
<span class="line-modified"> 431 ### Compiling and running the above BLAS sample (Mac OS)</span>
 432 
 433 ```sh
 434 
<span class="line-modified"> 435 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \</span>
<span class="line-modified"> 436     -Djava.library.path=/usr/local/opt/openblas/lib \</span>
<span class="line-modified"> 437     TestBlas.java</span>
<span class="line-modified"> 438 ```</span>
<span class="line-added"> 439 </span>
<span class="line-added"> 440 ### Compiling and running the above BLAS sample (Windows)</span>
<span class="line-added"> 441 </span>
<span class="line-added"> 442 ```powershell</span>
<span class="line-added"> 443 </span>
<span class="line-added"> 444 param(</span>
<span class="line-added"> 445   [Parameter(Mandatory=$true, HelpMessage=&quot;The path to the lib curl installation, which contains bin/liblapacke.dll&quot;)]</span>
<span class="line-added"> 446   [string]$blasPath,</span>
<span class="line-added"> 447   [Parameter(Mandatory=$true, HelpMessage=&quot;The path to the mingw bin directory which contains libgcc_s_seh-1.dll and libquadmath-0.dll&quot;)]</span>
<span class="line-added"> 448   [string]$mingwBinPath</span>
<span class="line-added"> 449 )</span>
<span class="line-added"> 450 </span>
<span class="line-added"> 451 . ./shared_windows.ps1</span>
<span class="line-added"> 452 </span>
<span class="line-added"> 453 $java = find-tool(&quot;java&quot;)</span>
<span class="line-added"> 454 </span>
<span class="line-added"> 455 $Env:path+=&quot;`;$blasPath\bin&quot; # libblas.dll</span>
<span class="line-added"> 456 $Env:path+=&quot;`;$mingwBinPath&quot; # mingw runtime dlls</span>
<span class="line-added"> 457 </span>
<span class="line-added"> 458 &amp; $java -D&quot;foreign.restricted=permit&quot; --add-modules jdk.incubator.foreign -D&quot;java.library.path=$blasPath\bin&quot; TestBlas.java</span>
 459 
 460 ```
 461 
<span class="line-modified"> 462 ## Using LAPACK library</span>
 463 
 464 On Mac OS, lapack is installed under /usr/local/opt/lapack directory.
 465 
<span class="line-modified"> 466 ### jextracting lapacke.h (Mac OS)</span>
 467 
 468 ```sh
 469 
 470 jextract \
 471    -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
 472    -l lapacke -t lapack \
 473    --filter lapacke.h \
 474    /usr/local/opt/lapack/include/lapacke.h
 475 
 476 ```
 477 
<span class="line-added"> 478 ### jextracting lapacke.h (Windows)</span>
<span class="line-added"> 479 </span>
<span class="line-added"> 480 ```powershell</span>
<span class="line-added"> 481 </span>
<span class="line-added"> 482 param(</span>
<span class="line-added"> 483   [Parameter(Mandatory=$true, HelpMessage=&quot;The path to the lapack installation which include/lapacke.h and dependent headers&quot;)]</span>
<span class="line-added"> 484   [string]$lapackPath</span>
<span class="line-added"> 485 )</span>
<span class="line-added"> 486 </span>
<span class="line-added"> 487 . ./shared_windows.ps1</span>
<span class="line-added"> 488 </span>
<span class="line-added"> 489 $jextract = find-tool(&quot;jextract&quot;)</span>
<span class="line-added"> 490 </span>
<span class="line-added"> 491 &amp; $jextract -t lapack -I &quot;$lapackPath\include&quot; -l liblapacke -J-Xmx2G --filter &#39;lapacke.h&#39; -- &quot;$lapackPath\include\lapacke.h&quot;</span>
<span class="line-added"> 492 </span>
<span class="line-added"> 493 ```</span>
<span class="line-added"> 494 </span>
 495 ### Java sample code that uses LAPACK library
 496 
 497 ```java
 498 
 499 import jdk.incubator.foreign.MemoryAccess;
 500 import jdk.incubator.foreign.MemoryAddress;
 501 import jdk.incubator.foreign.NativeScope;
 502 import lapack.*;
 503 import static lapack.lapacke_h.*;
 504 import static jdk.incubator.foreign.CSupport.*;
 505 
 506 public class TestLapack {
 507     public static void main(String[] args) {
 508 
 509         /* Locals */
 510         try (var scope = NativeScope.unboundedScope()) {
 511             var A = scope.allocateArray(C_DOUBLE, new double[]{
 512                     1, 2, 3, 4, 5, 1, 3, 5, 2, 4, 1, 4, 2, 5, 3
 513             });
 514             var b = scope.allocateArray(C_DOUBLE, new double[]{
</pre>
<hr />
<pre>
 537             /* Print Solution */
 538             print_matrix_colmajor(&quot;Solution&quot;, n, nrhs, b, ldb );
 539             System.out.println();
 540             System.exit(info);
 541         }
 542     }
 543 
 544     static void print_matrix_colmajor(String msg, int m, int n, MemoryAddress mat, int ldm) {
 545         int i, j;
 546         System.out.printf(&quot;\n %s\n&quot;, msg);
 547 
 548         for( i = 0; i &lt; m; i++ ) {
 549             for( j = 0; j &lt; n; j++ ) System.out.printf(&quot; %6.2f&quot;, MemoryAccess.getDoubleAtIndex(mat, i+j*ldm));
 550             System.out.printf( &quot;\n&quot; );
 551         }
 552     }
 553 }
 554 
 555 ```
 556 
<span class="line-modified"> 557 ### Compiling and running the above LAPACK sample (Mac OS)</span>
 558 
 559 ```sh
 560 
 561 java -Dforeign.restricted=permit \
 562     --add-modules jdk.incubator.foreign \
 563     -Djava.library.path=/usr/local/opt/lapack/lib \
 564     TestLapack.java
 565 
 566 ```

 567 
<span class="line-modified"> 568 ### Compiling and running the above LAPACK sample (Windows)</span>
<span class="line-added"> 569 </span>
<span class="line-added"> 570 ```powershell</span>
<span class="line-added"> 571 </span>
<span class="line-added"> 572 param(</span>
<span class="line-added"> 573   [Parameter(Mandatory=$true, HelpMessage=&quot;The path to the lib curl installation, which contains bin/liblapacke.dll&quot;)]</span>
<span class="line-added"> 574   [string]$lapackPath,</span>
<span class="line-added"> 575   [Parameter(Mandatory=$true, HelpMessage=&quot;The path to the mingw bin directory which contains libgcc_s_seh-1.dll and libquadmath-0.dll&quot;)]</span>
<span class="line-added"> 576   [string]$mingwBinPath</span>
<span class="line-added"> 577 )</span>
<span class="line-added"> 578 </span>
<span class="line-added"> 579 . ./shared_windows.ps1</span>
<span class="line-added"> 580 </span>
<span class="line-added"> 581 $java = find-tool(&quot;java&quot;)</span>
<span class="line-added"> 582 </span>
<span class="line-added"> 583 $Env:path+=&quot;`;$lapackPath\bin&quot; # libblas.dll</span>
<span class="line-added"> 584 $Env:path+=&quot;`;$mingwBinPath&quot; # mingw runtime dlls</span>
<span class="line-added"> 585 </span>
<span class="line-added"> 586 &amp; $java -D&quot;foreign.restricted=permit&quot; --add-modules jdk.incubator.foreign -D&quot;java.library.path=$lapackPath\bin&quot; TestLapack.java</span>
<span class="line-added"> 587 </span>
<span class="line-added"> 588 ```</span>
<span class="line-added"> 589 </span>
<span class="line-added"> 590 ## Using libproc library to list processes from Java</span>
<span class="line-added"> 591 </span>
<span class="line-added"> 592 ### jextract libproc.h (Mac OS)</span>
 593 
 594 ```sh
 595 
 596 jextract \
 597   -t org.unix \
 598   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
 599   --filter libproc.h \
 600   /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/libproc.h
 601 
 602 ```
 603 
 604 ### Java program that uses libproc to list processes
 605 
 606 ```java
 607 
 608 import jdk.incubator.foreign.CSupport;
 609 import jdk.incubator.foreign.MemorySegment;
 610 import jdk.incubator.foreign.NativeScope;
 611 import org.unix.*;
 612 import static jdk.incubator.foreign.MemoryAddress.NULL;
</pre>
<hr />
<pre>
 624             // list all the pids into the native array
 625             proc_listallpids(pids, numPids);
 626             // convert native array to java array
 627             int[] jpids = pids.segment().toIntArray();
 628             // buffer for process name
 629             var nameBuf = scope.allocateArray(CSupport.C_CHAR, NAME_BUF_MAX);
 630             for (int i = 0; i &lt; jpids.length; i++) {
 631                 int pid = jpids[i];
 632                 // get the process name
 633                 proc_name(pid, nameBuf, NAME_BUF_MAX);
 634                 String procName = CSupport.toJavaString(nameBuf);
 635                 // print pid and process name
 636                 System.out.printf(&quot;%d %s\n&quot;, pid, procName);
 637             }
 638         }
 639     }
 640 }
 641 
 642 ```
 643 
<span class="line-modified"> 644 ### Compiling and running the libproc sample (Mac OS)</span>
 645 
 646 ```sh
 647 
 648 java -Dforeign.restricted=permit \
 649     --add-modules jdk.incubator.foreign \
 650     -Djava.library.path=/usr/lib LibprocMain.java
 651 
 652 ```
 653 
<span class="line-modified"> 654 ## Using libgit2 from Java</span>
 655 
<span class="line-modified"> 656 ### Getting and building libgit2 (Mac OS)</span>
 657 
 658 * Download libgit2 v1.0.0 source from https://github.com/libgit2/libgit2/releases
 659 * Use cmake to build from libgit2
 660 * Let ${LIBGIT2_HOME} be the directory where you expanded libgit2 sources.
 661 * Let ${LIBGIT2_HOME}/build be the build directory where libgit2.dylib is built.
 662 
<span class="line-modified"> 663 ### jextract git2.h (Mac OS)</span>
 664 
 665 ```sh
 666 
 667 jextract \
 668   -t com.github -lgit2 \
 669   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/ \
 670   -I ${LIBGIT2_HOME}/include/ \
 671   -I ${LIBGIT2_HOME}/include/git2 \
 672   ${LIBGIT2_HOME}/include/git2.h
 673 
 674 ```
 675 
<span class="line-added"> 676 ### jextract git2.h (Windows)</span>
<span class="line-added"> 677 </span>
<span class="line-added"> 678 ```powershell</span>
<span class="line-added"> 679 </span>
<span class="line-added"> 680 param(</span>
<span class="line-added"> 681   [Parameter(Mandatory=$true, HelpMessage=&quot;The path to the libgit2 installation&quot;)]</span>
<span class="line-added"> 682   [string]$libgit2path</span>
<span class="line-added"> 683 )</span>
<span class="line-added"> 684 </span>
<span class="line-added"> 685 . ./shared_windows.ps1</span>
<span class="line-added"> 686 </span>
<span class="line-added"> 687 $jextract = find-tool(&quot;jextract&quot;)</span>
<span class="line-added"> 688 </span>
<span class="line-added"> 689 &amp; $jextract -t com.github -I &quot;$libgit2path\include&quot; -J-Xmx2G -l git2 -- &quot;$libgit2path\include\git2.h&quot;</span>
<span class="line-added"> 690 </span>
<span class="line-added"> 691 ```</span>
<span class="line-added"> 692 </span>
 693 ### Java program that uses libgit2 to clone github repo
 694 
 695 ```java
 696 
 697 import jdk.incubator.foreign.MemoryAddress;
 698 import jdk.incubator.foreign.NativeScope;
 699 import static com.github.git2_h.*;
 700 import static jdk.incubator.foreign.CSupport.*;
 701 import static jdk.incubator.foreign.MemoryAddress.NULL;
 702 
 703 public class GitClone {
 704     public static void main(String[] args) {
 705           if (args.length != 2) {
 706               System.err.println(&quot;java GitClone &lt;url&gt; &lt;path&gt;&quot;);
 707               System.exit(1);
 708           }
 709           git_libgit2_init();
 710           try (var scope = NativeScope.unboundedScope()) {
 711               var repo = scope.allocate(C_POINTER);
 712               var url = toCString(args[0], scope);
 713               var path = toCString(args[1], scope);
 714               System.out.println(git_clone(repo, url, path, NULL));
 715           }
 716           git_libgit2_shutdown();
 717     }
 718 }
 719 
 720 ```
 721 
<span class="line-modified"> 722 ### Compiling and running the libgit2 sample (Mac OS)</span>
 723 
 724 ```sh
 725 
 726 # file run.sh
 727 
 728 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
 729     -Djava.library.path=${LIBGIT2_HOME}/build/ \
 730     GitClone.java $*
 731 ```
 732 
<span class="line-added"> 733 ### Compiling and running the libgit2 sample (Windows)</span>
<span class="line-added"> 734 </span>
<span class="line-added"> 735 ```powershell</span>
<span class="line-added"> 736 </span>
<span class="line-added"> 737 param(</span>
<span class="line-added"> 738   [Parameter(Mandatory=$true, HelpMessage=&quot;The path to the libgit2 installation&quot;)]</span>
<span class="line-added"> 739   [string]$libgit2path,</span>
<span class="line-added"> 740   [Parameter(Mandatory=$true, HelpMessage=&quot;URL to clone from&quot;)]</span>
<span class="line-added"> 741   [string]$url,</span>
<span class="line-added"> 742   [Parameter(Mandatory=$true, HelpMessage=&quot;Path to clone into&quot;)]</span>
<span class="line-added"> 743   [string]$path</span>
<span class="line-added"> 744 )</span>
<span class="line-added"> 745 </span>
<span class="line-added"> 746 . ./shared_windows.ps1</span>
<span class="line-added"> 747 </span>
<span class="line-added"> 748 $java = find-tool(&quot;java&quot;)</span>
<span class="line-added"> 749 </span>
<span class="line-added"> 750 &amp; $java -D&quot;foreign.restricted=permit&quot; --add-modules jdk.incubator.foreign -D&quot;java.library.path=$libgit2path\bin&quot; GitClone.java $url $path</span>
<span class="line-added"> 751 </span>
<span class="line-added"> 752 ```</span>
<span class="line-added"> 753 </span>
 754 ### Cloning a github repo using the above run.sh command
 755 
 756 ```sh
 757 
 758 sh run.sh https://github.com/libgit2/libgit2.git libgit2
 759 
 760 ```
 761 
<span class="line-modified"> 762 ## Using sqlite3 library from Java</span>
 763 
<span class="line-modified"> 764 ### jextract sqlite3.h (Mac OS)</span>

 765 
 766 ```sh
 767 
 768 jextract \
 769   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
 770   /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/sqlite3.h \
 771   -t org.sqlite -lsqlite3
 772 
 773 ```
 774 ### Java program that uses sqlite3
 775 
 776 ```java
 777 
 778 import jdk.incubator.foreign.MemoryAddress;
 779 import jdk.incubator.foreign.MemoryAccess;
 780 import jdk.incubator.foreign.NativeScope;
 781 import static jdk.incubator.foreign.MemoryAddress.NULL;
 782 import static org.sqlite.sqlite3_h.*;
 783 import static org.sqlite.RuntimeHelper.*;
 784 import static jdk.incubator.foreign.CSupport.*;
</pre>
<hr />
<pre>
 854 
 855             // select query
 856             sql = toCString(&quot;SELECT * FROM EMPLOYEE&quot;, scope);
 857             rc = sqlite3_exec(dbPtr, sql, callback, NULL, errMsgPtrPtr);
 858 
 859             if (rc != 0) {
 860                 System.err.println(&quot;sqlite3_exec failed: &quot; + rc);
 861                 System.err.println(&quot;SQL error: &quot; + toJavaStringRestricted(MemoryAccess.getAddress(errMsgPtrPtr)));
 862                 sqlite3_free(MemoryAccess.getAddress(errMsgPtrPtr));
 863             } else {
 864                 System.out.println(&quot;done&quot;);
 865             }
 866 
 867             sqlite3_close(dbPtr);
 868         }
 869     }
 870 }
 871 
 872 ```
 873 
<span class="line-modified"> 874 ### Compiling and running the sqlite3 sample (Mac OS)</span>
 875 
 876 ```sh
 877 
 878 java -Dforeign.restricted=permit \
 879    --add-modules jdk.incubator.foreign \
 880    -Djava.library.path=/usr/lib SqliteMain.java
 881 
 882 ```
<span class="line-added"> 883 </span>
<span class="line-added"> 884 ## Using OpenGL library from Java</span>
<span class="line-added"> 885 </span>
<span class="line-added"> 886 ### jextract glut.h (Mac OS)</span>
<span class="line-added"> 887 </span>
<span class="line-added"> 888 ```sh</span>
<span class="line-added"> 889 </span>
<span class="line-added"> 890 jextract -t opengl -lGL -l/System/Library/Frameworks/GLUT.framework/Versions/Current/GLUT \</span>
<span class="line-added"> 891   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/ \</span>
<span class="line-added"> 892   -C-F/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/System/Library/Frameworks \</span>
<span class="line-added"> 893   /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/System/Library/Frameworks/GLUT.framework/Headers/glut.h</span>
<span class="line-added"> 894 </span>
<span class="line-added"> 895 ```</span>
<span class="line-added"> 896 </span>
<span class="line-added"> 897 ### jextract glut.h (Windows)</span>
<span class="line-added"> 898 </span>
<span class="line-added"> 899 ```powershell</span>
<span class="line-added"> 900 </span>
<span class="line-added"> 901 param(</span>
<span class="line-added"> 902   [Parameter(Mandatory=$true, HelpMessage=&quot;The path to the freeglut installation&quot;)]</span>
<span class="line-added"> 903   [string]$freeglutPath</span>
<span class="line-added"> 904 )</span>
<span class="line-added"> 905 </span>
<span class="line-added"> 906 . ./shared_windows.ps1</span>
<span class="line-added"> 907 </span>
<span class="line-added"> 908 $jextract = find-tool(&quot;jextract&quot;)</span>
<span class="line-added"> 909 </span>
<span class="line-added"> 910 &amp; $jextract -I &quot;$freeglutPath\include&quot; &quot;-l&quot; opengl32 &quot;-l&quot; glu32 &quot;-l&quot; freeglut &quot;-t&quot; &quot;opengl&quot; -J-Xmx2G --filter &#39;GL&#39; --filter &#39;GLU&#39; &quot;--&quot; &quot;$freeglutPath\include\GL\glut.h&quot;</span>
<span class="line-added"> 911 </span>
<span class="line-added"> 912 ```</span>
<span class="line-added"> 913 </span>
<span class="line-added"> 914 ### Java program that uses OpenGL</span>
<span class="line-added"> 915 </span>
<span class="line-added"> 916 ```java</span>
<span class="line-added"> 917 </span>
<span class="line-added"> 918 import jdk.incubator.foreign.CSupport;</span>
<span class="line-added"> 919 import static jdk.incubator.foreign.CSupport.*;</span>
<span class="line-added"> 920 import jdk.incubator.foreign.NativeScope;</span>
<span class="line-added"> 921 import static opengl.glut_h.*;</span>
<span class="line-added"> 922 </span>
<span class="line-added"> 923 public class Teapot {</span>
<span class="line-added"> 924     private float rot = 0;</span>
<span class="line-added"> 925 </span>
<span class="line-added"> 926     Teapot(NativeScope scope) {</span>
<span class="line-added"> 927         // Reset Background</span>
<span class="line-added"> 928         glClearColor(0f, 0f, 0f, 0f);</span>
<span class="line-added"> 929         // Setup Lighting</span>
<span class="line-added"> 930         glShadeModel(GL_SMOOTH());</span>
<span class="line-added"> 931         var pos = scope.allocateArray(C_FLOAT, new float[] {0.0f, 15.0f, -15.0f, 0});</span>
<span class="line-added"> 932         glLightfv(GL_LIGHT0(), GL_POSITION(), pos);</span>
<span class="line-added"> 933         var spec = scope.allocateArray(C_FLOAT, new float[] {1, 1, 1, 0});</span>
<span class="line-added"> 934         glLightfv(GL_LIGHT0(), GL_AMBIENT(), spec);</span>
<span class="line-added"> 935         glLightfv(GL_LIGHT0(), GL_DIFFUSE(), spec);</span>
<span class="line-added"> 936         glLightfv(GL_LIGHT0(), GL_SPECULAR(), spec);</span>
<span class="line-added"> 937         var shini = scope.allocate(C_FLOAT, 113);</span>
<span class="line-added"> 938         glMaterialfv(GL_FRONT(), GL_SHININESS(), shini);</span>
<span class="line-added"> 939         glEnable(GL_LIGHTING());</span>
<span class="line-added"> 940         glEnable(GL_LIGHT0());</span>
<span class="line-added"> 941         glEnable(GL_DEPTH_TEST());</span>
<span class="line-added"> 942     }</span>
<span class="line-added"> 943 </span>
<span class="line-added"> 944     void display() {</span>
<span class="line-added"> 945         glClear(GL_COLOR_BUFFER_BIT() | GL_DEPTH_BUFFER_BIT());</span>
<span class="line-added"> 946         glPushMatrix();</span>
<span class="line-added"> 947         glRotatef(-20f, 1f, 1f, 0f);</span>
<span class="line-added"> 948         glRotatef(rot, 0f, 1f, 0f);</span>
<span class="line-added"> 949         glutSolidTeapot(0.5d);</span>
<span class="line-added"> 950         glPopMatrix();</span>
<span class="line-added"> 951         glutSwapBuffers();</span>
<span class="line-added"> 952     }</span>
<span class="line-added"> 953 </span>
<span class="line-added"> 954     void onIdle() {</span>
<span class="line-added"> 955         rot += 0.1;</span>
<span class="line-added"> 956         glutPostRedisplay();</span>
<span class="line-added"> 957     }</span>
<span class="line-added"> 958 </span>
<span class="line-added"> 959     public static void main(String[] args) {</span>
<span class="line-added"> 960         try (var scope = NativeScope.unboundedScope()) {</span>
<span class="line-added"> 961             var argc = scope.allocate(C_INT, 0);</span>
<span class="line-added"> 962             glutInit(argc, argc);</span>
<span class="line-added"> 963             glutInitDisplayMode(GLUT_DOUBLE() | GLUT_RGB() | GLUT_DEPTH());</span>
<span class="line-added"> 964             glutInitWindowSize(500, 500);</span>
<span class="line-added"> 965             glutCreateWindow(CSupport.toCString(&quot;Hello Panama!&quot;, scope));</span>
<span class="line-added"> 966             var teapot = new Teapot(scope);</span>
<span class="line-added"> 967             var displayStub = glutDisplayFunc$func.allocate(teapot::display, scope);</span>
<span class="line-added"> 968             var idleStub = glutIdleFunc$func.allocate(teapot::onIdle, scope);</span>
<span class="line-added"> 969             glutDisplayFunc(displayStub);</span>
<span class="line-added"> 970             glutIdleFunc(idleStub);</span>
<span class="line-added"> 971             glutMainLoop();</span>
<span class="line-added"> 972         }</span>
<span class="line-added"> 973     }</span>
<span class="line-added"> 974 }</span>
<span class="line-added"> 975 </span>
<span class="line-added"> 976 ```</span>
<span class="line-added"> 977 </span>
<span class="line-added"> 978 ### Compiling and running the OpenGL sample (Mac OS)</span>
<span class="line-added"> 979 </span>
<span class="line-added"> 980 ```sh</span>
<span class="line-added"> 981 </span>
<span class="line-added"> 982 java -XstartOnFirstThread -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \</span>
<span class="line-added"> 983     -Djava.library.path=.:/System/Library/Frameworks/OpenGL.framework/Versions/Current/Libraries/ Teapot.java $*</span>
<span class="line-added"> 984 </span>
<span class="line-added"> 985 ```</span>
<span class="line-added"> 986 </span>
<span class="line-added"> 987 ### Compiling and running the OpenGL sample (Windows)</span>
<span class="line-added"> 988 </span>
<span class="line-added"> 989 ```powershell</span>
<span class="line-added"> 990 </span>
<span class="line-added"> 991 param(</span>
<span class="line-added"> 992   [Parameter(Mandatory=$true, HelpMessage=&quot;The path to the freeglut installation&quot;)]</span>
<span class="line-added"> 993   [string]$freeglutPath</span>
<span class="line-added"> 994 )</span>
<span class="line-added"> 995 </span>
<span class="line-added"> 996 . ./shared_windows.ps1</span>
<span class="line-added"> 997 </span>
<span class="line-added"> 998 $java = find-tool(&quot;java&quot;)</span>
<span class="line-added"> 999 </span>
<span class="line-added">1000 &amp; $java -D&quot;foreign.restricted=permit&quot; --add-modules jdk.incubator.foreign -D&quot;java.library.path=C:\Windows\System32`;$freeglutPath\bin\x64&quot; Teapot.java</span>
<span class="line-added">1001 </span>
<span class="line-added">1002 ```</span>
</pre>
</td>
</tr>
</table>
<center><a href="panama_jextract.html.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>