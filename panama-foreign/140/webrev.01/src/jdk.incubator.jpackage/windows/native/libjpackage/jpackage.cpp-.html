<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/jdk.incubator.jpackage/windows/native/libjpackage/jpackage.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #include &lt;stdio.h&gt;
 27 #include &lt;stdlib.h&gt;
 28 #include &lt;string&gt;
 29 #include &lt;windows.h&gt;
 30 
 31 #include &quot;ResourceEditor.h&quot;
 32 #include &quot;WinErrorHandling.h&quot;
 33 #include &quot;IconSwap.h&quot;
 34 #include &quot;VersionInfoSwap.h&quot;
 35 #include &quot;Utils.h&quot;
 36 
 37 using namespace std;
 38 
 39 #ifdef __cplusplus
 40 extern &quot;C&quot; {
 41 #endif
 42 
 43     /*
 44      * Class:     jdk_incubator_jpackage_internal_WindowsAppImageBuilder
 45      * Method:    iconSwap
 46      * Signature: (Ljava/lang/String;Ljava/lang/String;)I
 47      */
 48     JNIEXPORT jint JNICALL
 49             Java_jdk_incubator_jpackage_internal_WindowsAppImageBuilder_iconSwap(
 50             JNIEnv *pEnv, jclass c, jstring jIconTarget, jstring jLauncher) {
 51         wstring iconTarget = GetStringFromJString(pEnv, jIconTarget);
 52         wstring launcher = GetStringFromJString(pEnv, jLauncher);
 53 
 54         if (ChangeIcon(iconTarget, launcher)) {
 55             return 0;
 56         }
 57 
 58         return 1;
 59     }
 60 
 61     /*
 62      * Class:     jdk_incubator_jpackage_internal_WindowsAppImageBuilder
 63      * Method:    versionSwap
 64      * Signature: (Ljava/lang/String;Ljava/lang/String;)I
 65      */
 66     JNIEXPORT jint JNICALL
 67             Java_jdk_incubator_jpackage_internal_WindowsAppImageBuilder_versionSwap(
 68             JNIEnv *pEnv, jclass c, jstring jExecutableProperties,
 69             jstring jLauncher) {
 70 
 71         wstring executableProperties = GetStringFromJString(pEnv,
 72                 jExecutableProperties);
 73         wstring launcher = GetStringFromJString(pEnv, jLauncher);
 74 
 75         VersionInfoSwap vs(executableProperties, launcher);
 76         if (vs.PatchExecutable()) {
 77             return 0;
 78         }
 79 
 80         return 1;
 81     }
 82 
 83     /*
 84      * Class:     jdk_incubator_jpackage_internal_WinExeBundler
 85      * Method:    embedMSI
 86      * Signature: (Ljava/lang/String;Ljava/lang/String;)I
 87      */
 88     JNIEXPORT jint JNICALL Java_jdk_incubator_jpackage_internal_WinExeBundler_embedMSI(
 89             JNIEnv *pEnv, jclass c, jstring jexePath, jstring jmsiPath) {
 90 
 91         const wstring exePath = GetStringFromJString(pEnv, jexePath);
 92         const wstring msiPath = GetStringFromJString(pEnv, jmsiPath);
 93 
 94         JP_TRY;
 95 
 96         ResourceEditor()
 97             .id(L&quot;msi&quot;)
 98             .type(RT_RCDATA)
 99             .apply(ResourceEditor::FileLock(exePath), msiPath);
100 
101         return 0;
102 
103         JP_CATCH_ALL;
104 
105         return 1;
106     }
107 
108 #ifdef __cplusplus
109 }
110 #endif
    </pre>
  </body>
</html>