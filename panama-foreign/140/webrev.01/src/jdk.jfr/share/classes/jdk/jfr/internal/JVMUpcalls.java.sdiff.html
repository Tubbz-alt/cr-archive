<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jfr/share/classes/jdk/jfr/internal/JVMUpcalls.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="JVM.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="MetadataHandler.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jfr/share/classes/jdk/jfr/internal/JVMUpcalls.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 64                 byte[] bytes = ei.buildInstrumented();
 65                 ASMToolkit.logASM(clazz.getName(), bytes);
 66                 return bytes;
 67             }
 68             return JDKEvents.retransformCallback(clazz, oldBytes);
 69         } catch (Throwable t) {
 70             Logger.log(LogTag.JFR_SYSTEM, LogLevel.WARN, &quot;Unexpected error when adding instrumentation to event class &quot; + clazz.getName());
 71         }
 72         return oldBytes;
 73 
 74     }
 75 
 76     /**
 77      * Called by the JVM when requested to do an &quot;eager&quot; instrumentation. Would
 78      * normally happen when JVMTI retransform capabilities are not available.
 79      *
 80      * @param traceId
 81      *            Id of the class
 82      * @param forceInstrumentation
 83      *            add instrumentation regardless if event is enabled or not.
<span class="line-modified"> 84      * @param superClazz</span>
 85      *            the super class of the class being processed
 86      * @param oldBytes
 87      *            byte code
 88      * @return byte code to use
 89      * @throws Throwable
 90      */
 91     static byte[] bytesForEagerInstrumentation(long traceId, boolean forceInstrumentation, Class&lt;?&gt; superClass, byte[] oldBytes) throws Throwable {
 92         if (JVMSupport.isNotAvailable()) {
 93             return oldBytes;
 94         }
 95         String eventName = &quot;&lt;Unknown&gt;&quot;;
 96         try {
 97             EventInstrumentation ei = new EventInstrumentation(superClass, oldBytes, traceId);
 98             eventName = ei.getEventName();
 99             if (!forceInstrumentation) {
100                 // Assume we are recording
101                 MetadataRepository mr = MetadataRepository.getInstance();
102                 // No need to generate bytecode if:
103                 // 1) Event class is disabled, and there is not an external configuration that overrides.
104                 // 2) Event class has @Registered(false)
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 64                 byte[] bytes = ei.buildInstrumented();
 65                 ASMToolkit.logASM(clazz.getName(), bytes);
 66                 return bytes;
 67             }
 68             return JDKEvents.retransformCallback(clazz, oldBytes);
 69         } catch (Throwable t) {
 70             Logger.log(LogTag.JFR_SYSTEM, LogLevel.WARN, &quot;Unexpected error when adding instrumentation to event class &quot; + clazz.getName());
 71         }
 72         return oldBytes;
 73 
 74     }
 75 
 76     /**
 77      * Called by the JVM when requested to do an &quot;eager&quot; instrumentation. Would
 78      * normally happen when JVMTI retransform capabilities are not available.
 79      *
 80      * @param traceId
 81      *            Id of the class
 82      * @param forceInstrumentation
 83      *            add instrumentation regardless if event is enabled or not.
<span class="line-modified"> 84      * @param superClass</span>
 85      *            the super class of the class being processed
 86      * @param oldBytes
 87      *            byte code
 88      * @return byte code to use
 89      * @throws Throwable
 90      */
 91     static byte[] bytesForEagerInstrumentation(long traceId, boolean forceInstrumentation, Class&lt;?&gt; superClass, byte[] oldBytes) throws Throwable {
 92         if (JVMSupport.isNotAvailable()) {
 93             return oldBytes;
 94         }
 95         String eventName = &quot;&lt;Unknown&gt;&quot;;
 96         try {
 97             EventInstrumentation ei = new EventInstrumentation(superClass, oldBytes, traceId);
 98             eventName = ei.getEventName();
 99             if (!forceInstrumentation) {
100                 // Assume we are recording
101                 MetadataRepository mr = MetadataRepository.getInstance();
102                 // No need to generate bytecode if:
103                 // 1) Event class is disabled, and there is not an external configuration that overrides.
104                 // 2) Event class has @Registered(false)
</pre>
</td>
</tr>
</table>
<center><a href="JVM.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="MetadataHandler.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>