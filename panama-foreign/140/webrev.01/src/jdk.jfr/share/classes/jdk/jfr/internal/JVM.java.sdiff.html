<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jfr/share/classes/jdk/jfr/internal/JVM.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="EventInstrumentation.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="JVMUpcalls.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jfr/share/classes/jdk/jfr/internal/JVM.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.jfr.internal;
 27 
<span class="line-removed"> 28 import java.io.IOException;</span>
 29 import java.util.List;
 30 
 31 import jdk.internal.HotSpotIntrinsicCandidate;
 32 import jdk.jfr.Event;
 33 import jdk.jfr.internal.handlers.EventHandler;
 34 
 35 /**
 36  * Interface against the JVM.
 37  *
 38  */
 39 public final class JVM {
 40     private static final JVM jvm = new JVM();
 41 
 42     // JVM signals file changes by doing Object#notify on this object
 43     static final Object FILE_DELTA_CHANGE = new Object();
 44 
 45     static final long RESERVED_CLASS_ID_LIMIT = 500;
 46 
 47     private volatile boolean nativeOK;
 48 
</pre>
<hr />
<pre>
266      *
267      * Requires that JFR has been started with {@link #createNativeJFR()}
268      *
269      * &lt;pre&gt;
270      * Recording  Previous  Current  Action
271      * ==============================================
272      *    true     null      null     Ignore, keep recording in-memory
273      *    true     null      file1    Start disk recording
274      *    true     file      null     Copy out metadata to disk and continue in-memory recording
275      *    true     file1     file2    Copy out metadata and start with new File (file2)
276      *    false     *        null     Ignore, but start recording to memory with {@link #beginRecording()}
277      *    false     *        file     Ignore, but start recording to disk with {@link #beginRecording()}
278      *
279      * &lt;/pre&gt;
280      *
281      * recording can be set to true/false with {@link #beginRecording()}
282      * {@link #endRecording()}
283      *
284      * @param file the file where data should be written, or null if it should
285      *        not be copied out (in memory).
<span class="line-removed">286      * @throws IOException</span>
287      */
288     public native void setOutput(String file);
289 
290     /**
291      * Controls if a class deriving from jdk.jfr.Event should
292      * always be instrumented on class load.
293      *
294      * @param force, true to force initialization, false otherwise
295      */
296     public native void setForceInstrumentation(boolean force);
297 
298     /**
299      * Turn on/off thread sampling.
300      *
301      * @param sampleThreads true if threads should be sampled, false otherwise.
302      *
303      * @throws IllegalStateException if state can&#39;t be changed.
304      */
305     public native void setSampleThreads(boolean sampleThreads) throws IllegalStateException;
306 
</pre>
<hr />
<pre>
345 
346     /**
347      * Set threshold for event,
348      *
349      * Long.MAXIMUM_VALUE = no limit
350      *
351      * @param eventTypeId the id of the event type
352      * @param ticks threshold in ticks,
353      * @return true, if it could be set
354      */
355     public native boolean setThreshold(long eventTypeId, long ticks);
356 
357     /**
358      * Store the metadata descriptor that is to be written at the end of a
359      * chunk, data should be written after GMT offset and size of metadata event
360      * should be adjusted
361      *
362      * Requires that JFR has been started with {@link #createNativeJFR()}
363      *
364      * @param bytes binary representation of metadata descriptor
<span class="line-removed">365      *</span>
<span class="line-removed">366      * @param binary representation of descriptor</span>
367      */
368     public native void storeMetadataDescriptor(byte[] bytes);
369 
370     /**
371      * If the JVM supports JVM TI and retransformation has not been disabled this
372      * method will return true. This flag can not change during the lifetime of
373      * the JVM.
374      *
375      * @return if transform is allowed
376      */
377     public native boolean getAllowedToDoEventRetransforms();
378 
379     /**
380      * Set up native resources, data structures, threads etc. for JFR
381      *
382      * @param simulateFailure simulate a initialization failure and rollback in
383      *        native, used for testing purposes
384      *
385      * @throws IllegalStateException if native part of JFR could not be created.
386      *
</pre>
<hr />
<pre>
411         return result;
412     }
413 
414     public boolean hasNativeJFR() {
415         return nativeOK;
416     }
417 
418     /**
419      * Cheap test to check if JFR functionality is available.
420      *
421      * @return
422      */
423     public native boolean isAvailable();
424 
425     /**
426      * To convert ticks to wall clock time.
427      */
428     public native double getTimeConversionFactor();
429 
430     /**
<span class="line-modified">431      * Return a unique identifier for a class. Compared to {@link #getClassId()}</span>
<span class="line-modified">432      * , this method does not tag the class as being &quot;in-use&quot;.</span>
433      *
434      * @param clazz class
435      *
436      * @return a unique class identifier
437      */
438     public native long getTypeId(Class&lt;?&gt; clazz);
439 
440     /**
441      * Fast path fetching the EventWriter using VM intrinsics
442      *
443      * @return thread local EventWriter
444      */
445     @HotSpotIntrinsicCandidate
446     public static native Object getEventWriter();
447 
448     /**
449      * Create a new EventWriter
450      *
451      * @return thread local EventWriter
452      */
</pre>
</td>
<td>
<hr />
<pre>
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.jfr.internal;
 27 

 28 import java.util.List;
 29 
 30 import jdk.internal.HotSpotIntrinsicCandidate;
 31 import jdk.jfr.Event;
 32 import jdk.jfr.internal.handlers.EventHandler;
 33 
 34 /**
 35  * Interface against the JVM.
 36  *
 37  */
 38 public final class JVM {
 39     private static final JVM jvm = new JVM();
 40 
 41     // JVM signals file changes by doing Object#notify on this object
 42     static final Object FILE_DELTA_CHANGE = new Object();
 43 
 44     static final long RESERVED_CLASS_ID_LIMIT = 500;
 45 
 46     private volatile boolean nativeOK;
 47 
</pre>
<hr />
<pre>
265      *
266      * Requires that JFR has been started with {@link #createNativeJFR()}
267      *
268      * &lt;pre&gt;
269      * Recording  Previous  Current  Action
270      * ==============================================
271      *    true     null      null     Ignore, keep recording in-memory
272      *    true     null      file1    Start disk recording
273      *    true     file      null     Copy out metadata to disk and continue in-memory recording
274      *    true     file1     file2    Copy out metadata and start with new File (file2)
275      *    false     *        null     Ignore, but start recording to memory with {@link #beginRecording()}
276      *    false     *        file     Ignore, but start recording to disk with {@link #beginRecording()}
277      *
278      * &lt;/pre&gt;
279      *
280      * recording can be set to true/false with {@link #beginRecording()}
281      * {@link #endRecording()}
282      *
283      * @param file the file where data should be written, or null if it should
284      *        not be copied out (in memory).

285      */
286     public native void setOutput(String file);
287 
288     /**
289      * Controls if a class deriving from jdk.jfr.Event should
290      * always be instrumented on class load.
291      *
292      * @param force, true to force initialization, false otherwise
293      */
294     public native void setForceInstrumentation(boolean force);
295 
296     /**
297      * Turn on/off thread sampling.
298      *
299      * @param sampleThreads true if threads should be sampled, false otherwise.
300      *
301      * @throws IllegalStateException if state can&#39;t be changed.
302      */
303     public native void setSampleThreads(boolean sampleThreads) throws IllegalStateException;
304 
</pre>
<hr />
<pre>
343 
344     /**
345      * Set threshold for event,
346      *
347      * Long.MAXIMUM_VALUE = no limit
348      *
349      * @param eventTypeId the id of the event type
350      * @param ticks threshold in ticks,
351      * @return true, if it could be set
352      */
353     public native boolean setThreshold(long eventTypeId, long ticks);
354 
355     /**
356      * Store the metadata descriptor that is to be written at the end of a
357      * chunk, data should be written after GMT offset and size of metadata event
358      * should be adjusted
359      *
360      * Requires that JFR has been started with {@link #createNativeJFR()}
361      *
362      * @param bytes binary representation of metadata descriptor


363      */
364     public native void storeMetadataDescriptor(byte[] bytes);
365 
366     /**
367      * If the JVM supports JVM TI and retransformation has not been disabled this
368      * method will return true. This flag can not change during the lifetime of
369      * the JVM.
370      *
371      * @return if transform is allowed
372      */
373     public native boolean getAllowedToDoEventRetransforms();
374 
375     /**
376      * Set up native resources, data structures, threads etc. for JFR
377      *
378      * @param simulateFailure simulate a initialization failure and rollback in
379      *        native, used for testing purposes
380      *
381      * @throws IllegalStateException if native part of JFR could not be created.
382      *
</pre>
<hr />
<pre>
407         return result;
408     }
409 
410     public boolean hasNativeJFR() {
411         return nativeOK;
412     }
413 
414     /**
415      * Cheap test to check if JFR functionality is available.
416      *
417      * @return
418      */
419     public native boolean isAvailable();
420 
421     /**
422      * To convert ticks to wall clock time.
423      */
424     public native double getTimeConversionFactor();
425 
426     /**
<span class="line-modified">427      * Return a unique identifier for a class. Compared to {@link #getClassId(Class)},</span>
<span class="line-modified">428      * this method does not tag the class as being &quot;in-use&quot;.</span>
429      *
430      * @param clazz class
431      *
432      * @return a unique class identifier
433      */
434     public native long getTypeId(Class&lt;?&gt; clazz);
435 
436     /**
437      * Fast path fetching the EventWriter using VM intrinsics
438      *
439      * @return thread local EventWriter
440      */
441     @HotSpotIntrinsicCandidate
442     public static native Object getEventWriter();
443 
444     /**
445      * Create a new EventWriter
446      *
447      * @return thread local EventWriter
448      */
</pre>
</td>
</tr>
</table>
<center><a href="EventInstrumentation.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="JVMUpcalls.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>