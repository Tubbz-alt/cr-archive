<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jfr/share/classes/jdk/jfr/internal/PlatformEventType.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="MetadataRepository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="PlatformRecorder.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jfr/share/classes/jdk/jfr/internal/PlatformEventType.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 44     private final List&lt;SettingDescriptor&gt; settings = new ArrayList&lt;&gt;(5);
 45     private final boolean dynamicSettings;
 46     private final int stackTraceOffset;
 47 
 48     // default values
 49     private boolean enabled = false;
 50     private boolean stackTraceEnabled = true;
 51     private long thresholdTicks = 0;
 52     private long period = 0;
 53     private boolean hasHook;
 54 
 55     private boolean beginChunk;
 56     private boolean endChunk;
 57     private boolean hasStackTrace = true;
 58     private boolean hasDuration = true;
 59     private boolean hasPeriod = true;
 60     private boolean hasCutoff = false;
 61     private boolean isInstrumented;
 62     private boolean markForInstrumentation;
 63     private boolean registered = true;
<span class="line-modified"> 64     private boolean commitable = enabled &amp;&amp; registered;</span>
 65 
 66 
 67     // package private
 68     PlatformEventType(String name, long id, boolean isJDK, boolean dynamicSettings) {
 69         super(name, Type.SUPER_TYPE_EVENT, id);
 70         this.dynamicSettings = dynamicSettings;
 71         this.isJVM = Type.isDefinedByJVM(id);
 72         this.isMethodSampling = isJVM &amp;&amp; (name.equals(Type.EVENT_NAME_PREFIX + &quot;ExecutionSample&quot;) || name.equals(Type.EVENT_NAME_PREFIX + &quot;NativeMethodSample&quot;));
 73         this.isJDK = isJDK;
 74         this.stackTraceOffset = stackTraceOffset(name, isJDK);
 75     }
 76 
 77     private static int stackTraceOffset(String name, boolean isJDK) {
 78         if (isJDK) {
 79             if (name.equals(Type.EVENT_NAME_PREFIX + &quot;JavaExceptionThrow&quot;)) {
 80                 return 5;
 81             }
 82             if (name.equals(Type.EVENT_NAME_PREFIX + &quot;JavaErrorThrow&quot;)) {
 83                 return 5;
 84             }
</pre>
<hr />
<pre>
144     }
145 
146     public boolean hasCutoff() {
147         return this.hasCutoff;
148     }
149 
150     public boolean isEnabled() {
151         return enabled;
152     }
153 
154     public boolean isJVM() {
155         return isJVM;
156     }
157 
158     public boolean isJDK() {
159         return isJDK;
160     }
161 
162     public void setEnabled(boolean enabled) {
163         this.enabled = enabled;
<span class="line-modified">164         updateCommitable();</span>
165         if (isJVM) {
166             if (isMethodSampling) {
167                 long p = enabled ? period : 0;
168                 JVM.getJVM().setMethodSamplingInterval(getId(), p);
169             } else {
170                 JVM.getJVM().setEnabled(getId(), enabled);
171             }
172         }
173     }
174 
175     public void setPeriod(long periodMillis, boolean beginChunk, boolean endChunk) {
176         if (isMethodSampling) {
177             long p = enabled ? periodMillis : 0;
178             JVM.getJVM().setMethodSamplingInterval(getId(), p);
179         }
180         this.beginChunk = beginChunk;
181         this.endChunk = endChunk;
182         this.period = periodMillis;
183     }
184 
</pre>
<hr />
<pre>
230 
231     public boolean isInstrumented() {
232         return isInstrumented;
233     }
234 
235     public void setInstrumented() {
236         isInstrumented = true;
237     }
238 
239     public void markForInstrumentation(boolean markForInstrumentation) {
240         this.markForInstrumentation = markForInstrumentation;
241     }
242 
243     public boolean isMarkedForInstrumentation() {
244         return markForInstrumentation;
245     }
246 
247     public boolean setRegistered(boolean registered) {
248         if (this.registered != registered) {
249             this.registered = registered;
<span class="line-modified">250             updateCommitable();</span>
251             LogTag logTag = isJVM() || isJDK() ? LogTag.JFR_SYSTEM_EVENT : LogTag.JFR_EVENT;
252             if (registered) {
253                 Logger.log(logTag, LogLevel.INFO, &quot;Registered &quot; + getLogName());
254             } else {
255                 Logger.log(logTag, LogLevel.INFO, &quot;Unregistered &quot; + getLogName());
256             }
257             if (!registered) {
258                 MetadataRepository.getInstance().setUnregistered();
259             }
260             return true;
261         }
262         return false;
263     }
264 
<span class="line-modified">265     private void updateCommitable() {</span>
<span class="line-modified">266         this.commitable = enabled &amp;&amp; registered;</span>
267     }
268 
269     public final boolean isRegistered() {
270         return registered;
271     }
272 
273     // Efficient check of enabled &amp;&amp; registered
<span class="line-modified">274     public boolean isCommitable() {</span>
<span class="line-modified">275         return commitable;</span>
276     }
277 
278     public int getStackTraceOffset() {
279         return stackTraceOffset;
280     }
281 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2017, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 44     private final List&lt;SettingDescriptor&gt; settings = new ArrayList&lt;&gt;(5);
 45     private final boolean dynamicSettings;
 46     private final int stackTraceOffset;
 47 
 48     // default values
 49     private boolean enabled = false;
 50     private boolean stackTraceEnabled = true;
 51     private long thresholdTicks = 0;
 52     private long period = 0;
 53     private boolean hasHook;
 54 
 55     private boolean beginChunk;
 56     private boolean endChunk;
 57     private boolean hasStackTrace = true;
 58     private boolean hasDuration = true;
 59     private boolean hasPeriod = true;
 60     private boolean hasCutoff = false;
 61     private boolean isInstrumented;
 62     private boolean markForInstrumentation;
 63     private boolean registered = true;
<span class="line-modified"> 64     private boolean committable = enabled &amp;&amp; registered;</span>
 65 
 66 
 67     // package private
 68     PlatformEventType(String name, long id, boolean isJDK, boolean dynamicSettings) {
 69         super(name, Type.SUPER_TYPE_EVENT, id);
 70         this.dynamicSettings = dynamicSettings;
 71         this.isJVM = Type.isDefinedByJVM(id);
 72         this.isMethodSampling = isJVM &amp;&amp; (name.equals(Type.EVENT_NAME_PREFIX + &quot;ExecutionSample&quot;) || name.equals(Type.EVENT_NAME_PREFIX + &quot;NativeMethodSample&quot;));
 73         this.isJDK = isJDK;
 74         this.stackTraceOffset = stackTraceOffset(name, isJDK);
 75     }
 76 
 77     private static int stackTraceOffset(String name, boolean isJDK) {
 78         if (isJDK) {
 79             if (name.equals(Type.EVENT_NAME_PREFIX + &quot;JavaExceptionThrow&quot;)) {
 80                 return 5;
 81             }
 82             if (name.equals(Type.EVENT_NAME_PREFIX + &quot;JavaErrorThrow&quot;)) {
 83                 return 5;
 84             }
</pre>
<hr />
<pre>
144     }
145 
146     public boolean hasCutoff() {
147         return this.hasCutoff;
148     }
149 
150     public boolean isEnabled() {
151         return enabled;
152     }
153 
154     public boolean isJVM() {
155         return isJVM;
156     }
157 
158     public boolean isJDK() {
159         return isJDK;
160     }
161 
162     public void setEnabled(boolean enabled) {
163         this.enabled = enabled;
<span class="line-modified">164         updateCommittable();</span>
165         if (isJVM) {
166             if (isMethodSampling) {
167                 long p = enabled ? period : 0;
168                 JVM.getJVM().setMethodSamplingInterval(getId(), p);
169             } else {
170                 JVM.getJVM().setEnabled(getId(), enabled);
171             }
172         }
173     }
174 
175     public void setPeriod(long periodMillis, boolean beginChunk, boolean endChunk) {
176         if (isMethodSampling) {
177             long p = enabled ? periodMillis : 0;
178             JVM.getJVM().setMethodSamplingInterval(getId(), p);
179         }
180         this.beginChunk = beginChunk;
181         this.endChunk = endChunk;
182         this.period = periodMillis;
183     }
184 
</pre>
<hr />
<pre>
230 
231     public boolean isInstrumented() {
232         return isInstrumented;
233     }
234 
235     public void setInstrumented() {
236         isInstrumented = true;
237     }
238 
239     public void markForInstrumentation(boolean markForInstrumentation) {
240         this.markForInstrumentation = markForInstrumentation;
241     }
242 
243     public boolean isMarkedForInstrumentation() {
244         return markForInstrumentation;
245     }
246 
247     public boolean setRegistered(boolean registered) {
248         if (this.registered != registered) {
249             this.registered = registered;
<span class="line-modified">250             updateCommittable();</span>
251             LogTag logTag = isJVM() || isJDK() ? LogTag.JFR_SYSTEM_EVENT : LogTag.JFR_EVENT;
252             if (registered) {
253                 Logger.log(logTag, LogLevel.INFO, &quot;Registered &quot; + getLogName());
254             } else {
255                 Logger.log(logTag, LogLevel.INFO, &quot;Unregistered &quot; + getLogName());
256             }
257             if (!registered) {
258                 MetadataRepository.getInstance().setUnregistered();
259             }
260             return true;
261         }
262         return false;
263     }
264 
<span class="line-modified">265     private void updateCommittable() {</span>
<span class="line-modified">266         this.committable = enabled &amp;&amp; registered;</span>
267     }
268 
269     public final boolean isRegistered() {
270         return registered;
271     }
272 
273     // Efficient check of enabled &amp;&amp; registered
<span class="line-modified">274     public boolean isCommittable() {</span>
<span class="line-modified">275         return committable;</span>
276     }
277 
278     public int getStackTraceOffset() {
279         return stackTraceOffset;
280     }
281 }
</pre>
</td>
</tr>
</table>
<center><a href="MetadataRepository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="PlatformRecorder.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>