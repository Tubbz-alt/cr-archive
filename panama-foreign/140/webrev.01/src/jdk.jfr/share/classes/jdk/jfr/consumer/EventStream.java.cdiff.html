<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.jfr/share/classes/jdk/jfr/consumer/EventStream.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../Timespan.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="RecordedClass.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jfr/share/classes/jdk/jfr/consumer/EventStream.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 85,19 ***</span>
   * these occasions, use the {@link #onClose(Runnable)} method to register an
   * action.
   * &lt;p&gt;
   * If an unexpected exception occurs in an action, it is possible to catch the
   * exception in an error handler. An error handler can be registered using the
<span class="line-modified">!  * {@link #onError(Runnable)} method. If no error handler is registered, the</span>
   * default behavior is to print the exception and its backtrace to the standard
   * error stream.
   * &lt;p&gt;
   * The following example shows how an {@code EventStream} can be used to listen
   * to events on a JVM running Flight Recorder
   *
<span class="line-modified">!  * &lt;pre&gt;</span>
<span class="line-removed">-  * &lt;code&gt;</span>
   * try (var es = EventStream.openRepository()) {
   *   es.onEvent(&quot;jdk.CPULoad&quot;, event -&gt; {
   *     System.out.println(&quot;CPU Load &quot; + event.getEndTime());
   *     System.out.println(&quot; Machine total: &quot; + 100 * event.getFloat(&quot;machineTotal&quot;) + &quot;%&quot;);
   *     System.out.println(&quot; JVM User: &quot; + 100 * event.getFloat(&quot;jvmUser&quot;) + &quot;%&quot;);
<span class="line-new-header">--- 85,18 ---</span>
   * these occasions, use the {@link #onClose(Runnable)} method to register an
   * action.
   * &lt;p&gt;
   * If an unexpected exception occurs in an action, it is possible to catch the
   * exception in an error handler. An error handler can be registered using the
<span class="line-modified">!  * {@link #onError(Consumer)} method. If no error handler is registered, the</span>
   * default behavior is to print the exception and its backtrace to the standard
   * error stream.
   * &lt;p&gt;
   * The following example shows how an {@code EventStream} can be used to listen
   * to events on a JVM running Flight Recorder
   *
<span class="line-modified">!  * &lt;pre&gt;{@literal</span>
   * try (var es = EventStream.openRepository()) {
   *   es.onEvent(&quot;jdk.CPULoad&quot;, event -&gt; {
   *     System.out.println(&quot;CPU Load &quot; + event.getEndTime());
   *     System.out.println(&quot; Machine total: &quot; + 100 * event.getFloat(&quot;machineTotal&quot;) + &quot;%&quot;);
   *     System.out.println(&quot; JVM User: &quot; + 100 * event.getFloat(&quot;jvmUser&quot;) + &quot;%&quot;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 111,12 ***</span>
   *     System.out.println(&quot; Longest pause: &quot; + event.getDuration(&quot;longestPause&quot;));
   *     System.out.println();
   *   });
   *   es.start();
   * }
<span class="line-modified">!  * &lt;/code&gt;</span>
<span class="line-removed">-  * &lt;/pre&gt;</span>
   * &lt;p&gt;
   * To start recording together with the stream, see {@link RecordingStream}.
   *
   * @since 14
   */
<span class="line-new-header">--- 110,11 ---</span>
   *     System.out.println(&quot; Longest pause: &quot; + event.getDuration(&quot;longestPause&quot;));
   *     System.out.println();
   *   });
   *   es.start();
   * }
<span class="line-modified">!  * }&lt;/pre&gt;</span>
   * &lt;p&gt;
   * To start recording together with the stream, see {@link RecordingStream}.
   *
   * @since 14
   */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 137,11 ***</span>
       *         does not have
       *         {@code FlightRecorderPermission(&quot;accessFlightRecorder&quot;)}
       */
      public static EventStream openRepository() throws IOException {
          Utils.checkAccessFlightRecorder();
<span class="line-modified">!         return new EventDirectoryStream(AccessController.getContext(), null, SecuritySupport.PRIVILIGED, null);</span>
      }
  
      /**
       * Creates an event stream from a disk repository.
       * &lt;p&gt;
<span class="line-new-header">--- 135,11 ---</span>
       *         does not have
       *         {@code FlightRecorderPermission(&quot;accessFlightRecorder&quot;)}
       */
      public static EventStream openRepository() throws IOException {
          Utils.checkAccessFlightRecorder();
<span class="line-modified">!         return new EventDirectoryStream(AccessController.getContext(), null, SecuritySupport.PRIVILEGED, null);</span>
      }
  
      /**
       * Creates an event stream from a disk repository.
       * &lt;p&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 160,11 ***</span>
       *         files in the directory.
       */
      public static EventStream openRepository(Path directory) throws IOException {
          Objects.nonNull(directory);
          AccessControlContext acc = AccessController.getContext();
<span class="line-modified">!         return new EventDirectoryStream(acc, directory, FileAccess.UNPRIVILIGED, null);</span>
      }
  
      /**
       * Creates an event stream from a file.
       * &lt;p&gt;
<span class="line-new-header">--- 158,11 ---</span>
       *         files in the directory.
       */
      public static EventStream openRepository(Path directory) throws IOException {
          Objects.nonNull(directory);
          AccessControlContext acc = AccessController.getContext();
<span class="line-modified">!         return new EventDirectoryStream(acc, directory, FileAccess.UNPRIVILEGED, null);</span>
      }
  
      /**
       * Creates an event stream from a file.
       * &lt;p&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 211,11 ***</span>
      void onFlush(Runnable action);
  
      /**
       * Registers an action to perform if an exception occurs.
       * &lt;p&gt;
<span class="line-modified">!      * if an action is not registered, an exception stack trace is printed to</span>
       * standard error.
       * &lt;p&gt;
       * Registering an action overrides the default behavior. If multiple actions
       * have been registered, they are performed in the order of registration.
       * &lt;p&gt;
<span class="line-new-header">--- 209,11 ---</span>
      void onFlush(Runnable action);
  
      /**
       * Registers an action to perform if an exception occurs.
       * &lt;p&gt;
<span class="line-modified">!      * If an action is not registered, an exception stack trace is printed to</span>
       * standard error.
       * &lt;p&gt;
       * Registering an action overrides the default behavior. If multiple actions
       * have been registered, they are performed in the order of registration.
       * &lt;p&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 271,11 ***</span>
  
      /**
       * Specifies that the event object in an {@link #onEvent(Consumer)} action
       * can be reused.
       * &lt;p&gt;
<span class="line-modified">!      * If reuse is set to {@code true), an action should not keep a reference</span>
       * to the event object after the action has completed.
       *
       * @param reuse {@code true} if an event object can be reused, {@code false}
       * otherwise
       */
<span class="line-new-header">--- 269,11 ---</span>
  
      /**
       * Specifies that the event object in an {@link #onEvent(Consumer)} action
       * can be reused.
       * &lt;p&gt;
<span class="line-modified">!      * If reuse is set to {@code true}, an action should not keep a reference</span>
       * to the event object after the action has completed.
       *
       * @param reuse {@code true} if an event object can be reused, {@code false}
       * otherwise
       */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 284,11 ***</span>
      /**
       * Specifies that events arrives in chronological order, sorted by the time
       * they were committed to the stream.
       *
       * @param ordered if event objects arrive in chronological order to
<span class="line-modified">!      *        {@code #onEvent(Consumer)}</span>
       */
      void setOrdered(boolean ordered);
  
      /**
       * Specifies the start time of the stream.
<span class="line-new-header">--- 282,11 ---</span>
      /**
       * Specifies that events arrives in chronological order, sorted by the time
       * they were committed to the stream.
       *
       * @param ordered if event objects arrive in chronological order to
<span class="line-modified">!      *        {@link #onEvent(Consumer)}</span>
       */
      void setOrdered(boolean ordered);
  
      /**
       * Specifies the start time of the stream.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 319,26 ***</span>
       * @see #startAsync()
       */
      void setEndTime(Instant endTime);
  
      /**
<span class="line-modified">!      * Start processing of actions.</span>
       * &lt;p&gt;
       * Actions are performed in the current thread.
       * &lt;p&gt;
<span class="line-modified">!      * To stop the stream, use the {@code #close()} method.</span>
       *
       * @throws IllegalStateException if the stream is already started or closed
       */
      void start();
  
      /**
<span class="line-modified">!      * Start asynchronous processing of actions.</span>
       * &lt;p&gt;
       * Actions are performed in a single separate thread.
       * &lt;p&gt;
<span class="line-modified">!      * To stop the stream, use the {@code #close()} method.</span>
       *
       * @throws IllegalStateException if the stream is already started or closed
       */
      void startAsync();
  
<span class="line-new-header">--- 317,26 ---</span>
       * @see #startAsync()
       */
      void setEndTime(Instant endTime);
  
      /**
<span class="line-modified">!      * Starts processing of actions.</span>
       * &lt;p&gt;
       * Actions are performed in the current thread.
       * &lt;p&gt;
<span class="line-modified">!      * To stop the stream, use the {@link #close()} method.</span>
       *
       * @throws IllegalStateException if the stream is already started or closed
       */
      void start();
  
      /**
<span class="line-modified">!      * Starts asynchronous processing of actions.</span>
       * &lt;p&gt;
       * Actions are performed in a single separate thread.
       * &lt;p&gt;
<span class="line-modified">!      * To stop the stream, use the {@link #close()} method.</span>
       *
       * @throws IllegalStateException if the stream is already started or closed
       */
      void startAsync();
  
</pre>
<center><a href="../Timespan.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="RecordedClass.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>