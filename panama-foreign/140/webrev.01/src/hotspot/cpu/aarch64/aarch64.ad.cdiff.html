<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/cpu/aarch64/aarch64.ad</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../../../../make/test/JtregGraalUnit.gmk.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="c1_MacroAssembler_aarch64.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/aarch64/aarch64.ad</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1633,10 ***</span>
<span class="line-new-header">--- 1633,24 ---</span>
      st-&gt;print(&quot;stp  lr, rfp, [sp, #%d]!\n\t&quot;, -(2 * wordSize));
      if (PreserveFramePointer) st-&gt;print(&quot;mov  rfp, sp\n\t&quot;);
      st-&gt;print(&quot;mov  rscratch1, #%d\n\t&quot;, framesize - 2 * wordSize);
      st-&gt;print(&quot;sub  sp, sp, rscratch1&quot;);
    }
<span class="line-added">+   if (C-&gt;stub_function() == NULL &amp;&amp; BarrierSet::barrier_set()-&gt;barrier_set_nmethod() != NULL) {</span>
<span class="line-added">+     st-&gt;print(&quot;\n\t&quot;);</span>
<span class="line-added">+     st-&gt;print(&quot;ldr  rscratch1, [guard]\n\t&quot;);</span>
<span class="line-added">+     st-&gt;print(&quot;dmb ishld\n\t&quot;);</span>
<span class="line-added">+     st-&gt;print(&quot;ldr  rscratch2, [rthread, #thread_disarmed_offset]\n\t&quot;);</span>
<span class="line-added">+     st-&gt;print(&quot;cmp  rscratch1, rscratch2\n\t&quot;);</span>
<span class="line-added">+     st-&gt;print(&quot;b.eq skip&quot;);</span>
<span class="line-added">+     st-&gt;print(&quot;\n\t&quot;);</span>
<span class="line-added">+     st-&gt;print(&quot;blr #nmethod_entry_barrier_stub\n\t&quot;);</span>
<span class="line-added">+     st-&gt;print(&quot;b skip\n\t&quot;);</span>
<span class="line-added">+     st-&gt;print(&quot;guard: int\n\t&quot;);</span>
<span class="line-added">+     st-&gt;print(&quot;\n\t&quot;);</span>
<span class="line-added">+     st-&gt;print(&quot;skip:\n\t&quot;);</span>
<span class="line-added">+   }</span>
  }
  #endif
  
  void MachPrologNode::emit(CodeBuffer &amp;cbuf, PhaseRegAlloc *ra_) const {
    Compile* C = ra_-&gt;C;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1665,10 ***</span>
<span class="line-new-header">--- 1679,15 ---</span>
    if (C-&gt;output()-&gt;need_stack_bang(bangsize) &amp;&amp; UseStackBanging)
      __ generate_stack_overflow_check(bangsize);
  
    __ build_frame(framesize);
  
<span class="line-added">+   if (C-&gt;stub_function() == NULL) {</span>
<span class="line-added">+     BarrierSetAssembler* bs = BarrierSet::barrier_set()-&gt;barrier_set_assembler();</span>
<span class="line-added">+     bs-&gt;nmethod_entry_barrier(&amp;_masm);</span>
<span class="line-added">+   }</span>
<span class="line-added">+ </span>
    if (VerifyStackAtCalls) {
      Unimplemented();
    }
  
    C-&gt;output()-&gt;set_frame_complete(cbuf.insts_size());
</pre>
<hr />
<pre>
<span class="line-old-header">*** 13206,11 ***</span>
  
    ins_pipe(fp_div_s);
  %}
  
  instruct sqrtF_reg(vRegF dst, vRegF src) %{
<span class="line-modified">!   match(Set dst (ConvD2F (SqrtD (ConvF2D src))));</span>
  
    ins_cost(INSN_COST * 50);
    format %{ &quot;fsqrts  $dst, $src&quot; %}
    ins_encode %{
      __ fsqrts(as_FloatRegister($dst$$reg),
<span class="line-new-header">--- 13225,11 ---</span>
  
    ins_pipe(fp_div_s);
  %}
  
  instruct sqrtF_reg(vRegF dst, vRegF src) %{
<span class="line-modified">!   match(Set dst (SqrtF src));</span>
  
    ins_cost(INSN_COST * 50);
    format %{ &quot;fsqrts  $dst, $src&quot; %}
    ins_encode %{
      __ fsqrts(as_FloatRegister($dst$$reg),
</pre>
<hr />
<pre>
<span class="line-old-header">*** 17020,10 ***</span>
<span class="line-new-header">--- 17039,32 ---</span>
    ins_pipe(vmuldiv_fp128);
  %}
  
  // --------------------------------- SQRT -------------------------------------
  
<span class="line-added">+ instruct vsqrt2F(vecD dst, vecD src)</span>
<span class="line-added">+ %{</span>
<span class="line-added">+   predicate(n-&gt;as_Vector()-&gt;length() == 2);</span>
<span class="line-added">+   match(Set dst (SqrtVF src));</span>
<span class="line-added">+   format %{ &quot;fsqrt  $dst, $src\t# vector (2F)&quot; %}</span>
<span class="line-added">+   ins_encode %{</span>
<span class="line-added">+     __ fsqrt(as_FloatRegister($dst$$reg), __ T2S, as_FloatRegister($src$$reg));</span>
<span class="line-added">+   %}</span>
<span class="line-added">+   ins_pipe(vunop_fp64);</span>
<span class="line-added">+ %}</span>
<span class="line-added">+ </span>
<span class="line-added">+ instruct vsqrt4F(vecX dst, vecX src)</span>
<span class="line-added">+ %{</span>
<span class="line-added">+   predicate(n-&gt;as_Vector()-&gt;length() == 4);</span>
<span class="line-added">+   match(Set dst (SqrtVF src));</span>
<span class="line-added">+   format %{ &quot;fsqrt  $dst, $src\t# vector (4F)&quot; %}</span>
<span class="line-added">+   ins_encode %{</span>
<span class="line-added">+     __ fsqrt(as_FloatRegister($dst$$reg), __ T4S, as_FloatRegister($src$$reg));</span>
<span class="line-added">+   %}</span>
<span class="line-added">+   ins_pipe(vsqrt_fp128);</span>
<span class="line-added">+ %}</span>
<span class="line-added">+ </span>
  instruct vsqrt2D(vecX dst, vecX src)
  %{
    predicate(n-&gt;as_Vector()-&gt;length() == 2);
    match(Set dst (SqrtVD src));
    format %{ &quot;fsqrt  $dst, $src\t# vector (2D)&quot; %}
</pre>
<center><a href="../../../../make/test/JtregGraalUnit.gmk.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="c1_MacroAssembler_aarch64.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>