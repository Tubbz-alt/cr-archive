<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/classfile/systemDictionaryShared.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="classLoaderStats.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="systemDictionaryShared.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/classfile/systemDictionaryShared.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -478,41 +478,10 @@</span>
                              &amp;args,
                              CHECK);
    }
  }
  
<span class="udiff-line-removed">- // Define Package for shared app/platform classes from named module</span>
<span class="udiff-line-removed">- void SystemDictionaryShared::define_shared_package(Symbol* class_name,</span>
<span class="udiff-line-removed">-                                                    Handle class_loader,</span>
<span class="udiff-line-removed">-                                                    ModuleEntry* mod_entry,</span>
<span class="udiff-line-removed">-                                                    TRAPS) {</span>
<span class="udiff-line-removed">-   assert(mod_entry != NULL, &quot;module_entry should not be NULL&quot;);</span>
<span class="udiff-line-removed">-   Handle module_handle(THREAD, mod_entry-&gt;module());</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   Handle pkg_name = get_package_name(class_name, CHECK);</span>
<span class="udiff-line-removed">-   assert(pkg_name.not_null(), &quot;Package should not be null for class in named module&quot;);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   Klass* classLoader_klass;</span>
<span class="udiff-line-removed">-   if (SystemDictionary::is_system_class_loader(class_loader())) {</span>
<span class="udiff-line-removed">-     classLoader_klass = SystemDictionary::jdk_internal_loader_ClassLoaders_AppClassLoader_klass();</span>
<span class="udiff-line-removed">-   } else {</span>
<span class="udiff-line-removed">-     assert(SystemDictionary::is_platform_class_loader(class_loader()), &quot;unexpected classloader&quot;);</span>
<span class="udiff-line-removed">-     classLoader_klass = SystemDictionary::jdk_internal_loader_ClassLoaders_PlatformClassLoader_klass();</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   JavaValue result(T_OBJECT);</span>
<span class="udiff-line-removed">-   JavaCallArguments args(2);</span>
<span class="udiff-line-removed">-   args.set_receiver(class_loader);</span>
<span class="udiff-line-removed">-   args.push_oop(pkg_name);</span>
<span class="udiff-line-removed">-   args.push_oop(module_handle);</span>
<span class="udiff-line-removed">-   JavaCalls::call_virtual(&amp;result, classLoader_klass,</span>
<span class="udiff-line-removed">-                           vmSymbols::definePackage_name(),</span>
<span class="udiff-line-removed">-                           vmSymbols::definePackage_signature(),</span>
<span class="udiff-line-removed">-                           &amp;args,</span>
<span class="udiff-line-removed">-                           CHECK);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  // Get the ProtectionDomain associated with the CodeSource from the classloader.
  Handle SystemDictionaryShared::get_protection_domain_from_classloader(Handle class_loader,
                                                                        Handle url, TRAPS) {
    // CodeSource cs = new CodeSource(url, null);
    Handle cs = JavaCalls::construct_new_instance(SystemDictionary::CodeSource_klass(),
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -597,15 +566,15 @@</span>
  
      if (ent-&gt;is_modules_image()) {
        // For shared app/platform classes originated from the run-time image:
        //   The ProtectionDomains are cached in the corresponding ModuleEntries
        //   for fast access by the VM.
<span class="udiff-line-modified-removed">-       if (pkg_entry != NULL) {</span>
<span class="udiff-line-modified-removed">-         ModuleEntry* mod_entry = pkg_entry-&gt;module();</span>
<span class="udiff-line-modified-removed">-         pd = get_shared_protection_domain(class_loader, mod_entry, THREAD);</span>
<span class="udiff-line-modified-removed">-         define_shared_package(class_name, class_loader, mod_entry, CHECK_(pd));</span>
<span class="udiff-line-modified-removed">-       }</span>
<span class="udiff-line-modified-added">+       // all packages from module image are already created during VM bootstrap in</span>
<span class="udiff-line-modified-added">+       // Modules::define_module().</span>
<span class="udiff-line-modified-added">+       assert(pkg_entry != NULL, &quot;archived class in module image cannot be from unnamed package&quot;);</span>
<span class="udiff-line-modified-added">+       ModuleEntry* mod_entry = pkg_entry-&gt;module();</span>
<span class="udiff-line-modified-added">+       pd = get_shared_protection_domain(class_loader, mod_entry, THREAD);</span>
      } else {
        // For shared app/platform classes originated from JAR files on the class path:
        //   Each of the 3 SystemDictionaryShared::_shared_xxx arrays has the same length
        //   as the shared classpath table in the shared archive (see
        //   FileMap::_shared_path_table in filemap.hpp for details).
</pre>
<center><a href="classLoaderStats.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="systemDictionaryShared.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>