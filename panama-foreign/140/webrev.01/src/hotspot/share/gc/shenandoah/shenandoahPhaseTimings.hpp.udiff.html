<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/gc/shenandoah/shenandoahPhaseTimings.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahPhaseTimings.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahRootProcessor.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/shenandoahPhaseTimings.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -31,11 +31,11 @@</span>
  #include &quot;memory/allocation.hpp&quot;
  
  class ShenandoahCollectorPolicy;
  class outputStream;
  
<span class="udiff-line-modified-removed">- #define SHENANDOAH_GC_PAR_PHASE_DO(CNT_PREFIX, DESC_PREFIX, f)                         \</span>
<span class="udiff-line-modified-added">+ #define SHENANDOAH_PAR_PHASE_DO(CNT_PREFIX, DESC_PREFIX, f)                            \</span>
    f(CNT_PREFIX ## TotalWork,                DESC_PREFIX &quot;&lt;total&gt;&quot;)                     \
    f(CNT_PREFIX ## ThreadRoots,              DESC_PREFIX &quot;Thread Roots&quot;)                \
    f(CNT_PREFIX ## CodeCacheRoots,           DESC_PREFIX &quot;Code Cache Roots&quot;)            \
    f(CNT_PREFIX ## UniverseRoots,            DESC_PREFIX &quot;Universe Roots&quot;)              \
    f(CNT_PREFIX ## JNIRoots,                 DESC_PREFIX &quot;JNI Handles Roots&quot;)           \
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -54,48 +54,50 @@</span>
    f(CNT_PREFIX ## StringDedupTableRoots,    DESC_PREFIX &quot;Dedup Table Roots&quot;)           \
    f(CNT_PREFIX ## StringDedupQueueRoots,    DESC_PREFIX &quot;Dedup Queue Roots&quot;)           \
    f(CNT_PREFIX ## FinishQueues,             DESC_PREFIX &quot;Finish Queues&quot;)               \
    // end
  
<span class="udiff-line-modified-removed">- #define SHENANDOAH_GC_PHASE_DO(f)                                                      \</span>
<span class="udiff-line-modified-added">+ #define SHENANDOAH_PHASE_DO(f)                                                         \</span>
    f(conc_reset,                                     &quot;Concurrent Reset&quot;)                \
                                                                                         \
    f(init_mark_gross,                                &quot;Pause Init Mark (G)&quot;)             \
    f(init_mark,                                      &quot;Pause Init Mark (N)&quot;)             \
    f(make_parsable,                                  &quot;  Make Parsable&quot;)                 \
    f(init_update_region_states,                      &quot;  Update Region States&quot;)          \
    f(scan_roots,                                     &quot;  Scan Roots&quot;)                    \
<span class="udiff-line-modified-removed">-   SHENANDOAH_GC_PAR_PHASE_DO(scan_,                 &quot;    S: &quot;, f)                      \</span>
<span class="udiff-line-modified-added">+   SHENANDOAH_PAR_PHASE_DO(scan_,                    &quot;    S: &quot;, f)                      \</span>
    f(resize_tlabs,                                   &quot;  Resize TLABs&quot;)                  \
                                                                                         \
    f(conc_mark,                                      &quot;Concurrent Marking&quot;)              \
    f(conc_preclean,                                  &quot;Concurrent Precleaning&quot;)          \
                                                                                         \
    f(final_mark_gross,                               &quot;Pause Final Mark (G)&quot;)            \
    f(final_mark,                                     &quot;Pause Final Mark (N)&quot;)            \
    f(update_roots,                                   &quot;  Update Roots&quot;)                  \
<span class="udiff-line-modified-removed">-   SHENANDOAH_GC_PAR_PHASE_DO(update_,               &quot;    U: &quot;, f)                      \</span>
<span class="udiff-line-modified-added">+   SHENANDOAH_PAR_PHASE_DO(update_,                  &quot;    U: &quot;, f)                      \</span>
    f(finish_queues,                                  &quot;  Finish Queues&quot;)                 \
    f(weakrefs,                                       &quot;  Weak References&quot;)               \
    f(weakrefs_process,                               &quot;    Process&quot;)                     \
    f(purge,                                          &quot;  System Purge&quot;)                  \
    f(purge_class_unload,                             &quot;    Unload Classes&quot;)              \
<span class="udiff-line-modified-removed">-   SHENANDOAH_GC_PAR_PHASE_DO(purge_cu_par_,         &quot;      CU: &quot;, f)                   \</span>
<span class="udiff-line-modified-added">+   SHENANDOAH_PAR_PHASE_DO(purge_cu_par_,            &quot;      CU: &quot;, f)                   \</span>
    f(purge_weak_par,                                 &quot;    Weak Roots&quot;)                  \
<span class="udiff-line-modified-removed">-   SHENANDOAH_GC_PAR_PHASE_DO(purge_weak_par_,       &quot;      WR: &quot;, f)                   \</span>
<span class="udiff-line-modified-added">+   SHENANDOAH_PAR_PHASE_DO(purge_weak_par_,          &quot;      WR: &quot;, f)                   \</span>
    f(purge_cldg,                                     &quot;    CLDG&quot;)                        \
    f(final_update_region_states,                     &quot;  Update Region States&quot;)          \
    f(retire_tlabs,                                   &quot;  Retire TLABs&quot;)                  \
    f(choose_cset,                                    &quot;  Choose Collection Set&quot;)         \
    f(final_rebuild_freeset,                          &quot;  Rebuild Free Set&quot;)              \
    f(init_evac,                                      &quot;  Initial Evacuation&quot;)            \
<span class="udiff-line-modified-removed">-   SHENANDOAH_GC_PAR_PHASE_DO(evac_,                 &quot;    E: &quot;, f)                      \</span>
<span class="udiff-line-modified-added">+   SHENANDOAH_PAR_PHASE_DO(evac_,                    &quot;    E: &quot;, f)                      \</span>
                                                                                         \
    f(conc_weak_roots,                                &quot;Concurrent Weak Roots&quot;)           \
<span class="udiff-line-added">+   SHENANDOAH_PAR_PHASE_DO(conc_weak_roots_,         &quot;  CWR: &quot;, f)                      \</span>
    f(conc_cleanup_early,                             &quot;Concurrent Cleanup&quot;)              \
    f(conc_class_unloading,                           &quot;Concurrent Class Unloading&quot;)      \
    f(conc_strong_roots,                              &quot;Concurrent Strong Roots&quot;)         \
<span class="udiff-line-added">+   SHENANDOAH_PAR_PHASE_DO(conc_strong_roots_,       &quot;  CSR: &quot;, f)                      \</span>
    f(conc_evac,                                      &quot;Concurrent Evacuation&quot;)           \
                                                                                         \
    f(init_update_refs_gross,                         &quot;Pause Init  Update Refs (G)&quot;)     \
    f(init_update_refs,                               &quot;Pause Init  Update Refs (N)&quot;)     \
    f(init_update_refs_retire_gclabs,                 &quot;  Retire GCLABs&quot;)                 \
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -104,46 +106,46 @@</span>
                                                                                         \
    f(final_update_refs_gross,                        &quot;Pause Final Update Refs (G)&quot;)     \
    f(final_update_refs,                              &quot;Pause Final Update Refs (N)&quot;)     \
    f(final_update_refs_finish_work,                  &quot;  Finish Work&quot;)                   \
    f(final_update_refs_roots,                        &quot;  Update Roots&quot;)                  \
<span class="udiff-line-modified-removed">-   SHENANDOAH_GC_PAR_PHASE_DO(final_update_,         &quot;    UR: &quot;, f)                     \</span>
<span class="udiff-line-modified-added">+   SHENANDOAH_PAR_PHASE_DO(final_update_,            &quot;    UR: &quot;, f)                     \</span>
    f(final_update_refs_update_region_states,         &quot;  Update Region States&quot;)          \
    f(final_update_refs_trash_cset,                   &quot;  Trash Collection Set&quot;)          \
    f(final_update_refs_rebuild_freeset,              &quot;  Rebuild Free Set&quot;)              \
                                                                                         \
    f(conc_cleanup_complete,                          &quot;Concurrent Cleanup&quot;)              \
                                                                                         \
    f(degen_gc_gross,                                 &quot;Pause Degenerated GC (G)&quot;)        \
    f(degen_gc,                                       &quot;Pause Degenerated GC (N)&quot;)        \
    f(degen_gc_update_roots,                          &quot;  Degen Update Roots&quot;)            \
<span class="udiff-line-modified-removed">-   SHENANDOAH_GC_PAR_PHASE_DO(degen_gc_update_,      &quot;    DU: &quot;, f)                     \</span>
<span class="udiff-line-modified-added">+   SHENANDOAH_PAR_PHASE_DO(degen_gc_update_,         &quot;    DU: &quot;, f)                     \</span>
                                                                                         \
    f(full_gc_gross,                                  &quot;Pause Full GC (G)&quot;)               \
    f(full_gc,                                        &quot;Pause Full GC (N)&quot;)               \
    f(full_gc_heapdump_pre,                           &quot;  Pre Heap Dump&quot;)                 \
    f(full_gc_prepare,                                &quot;  Prepare&quot;)                       \
    f(full_gc_scan_roots,                             &quot;  Scan Roots&quot;)                    \
<span class="udiff-line-modified-removed">-   SHENANDOAH_GC_PAR_PHASE_DO(full_gc_scan_roots_,   &quot;    FS: &quot;, f)                     \</span>
<span class="udiff-line-modified-added">+   SHENANDOAH_PAR_PHASE_DO(full_gc_scan_roots_,      &quot;    FS: &quot;, f)                     \</span>
    f(full_gc_update_roots,                           &quot;  Update Roots&quot;)                  \
<span class="udiff-line-modified-removed">-   SHENANDOAH_GC_PAR_PHASE_DO(full_gc_update_roots_, &quot;    FU: &quot;, f)                     \</span>
<span class="udiff-line-modified-added">+   SHENANDOAH_PAR_PHASE_DO(full_gc_update_roots_,    &quot;    FU: &quot;, f)                     \</span>
    f(full_gc_mark,                                   &quot;  Mark&quot;)                          \
    f(full_gc_mark_finish_queues,                     &quot;    Finish Queues&quot;)               \
    f(full_gc_weakrefs,                               &quot;    Weak References&quot;)             \
    f(full_gc_weakrefs_process,                       &quot;      Process&quot;)                   \
    f(full_gc_purge,                                  &quot;    System Purge&quot;)                \
    f(full_gc_purge_class_unload,                     &quot;      Unload Classes&quot;)            \
<span class="udiff-line-modified-removed">-   SHENANDOAH_GC_PAR_PHASE_DO(full_gc_purge_cu_par_, &quot;        CU: &quot;, f)                 \</span>
<span class="udiff-line-modified-added">+   SHENANDOAH_PAR_PHASE_DO(full_gc_purge_cu_par_,    &quot;        CU: &quot;, f)                 \</span>
    f(full_gc_purge_weak_par,                         &quot;      Weak Roots&quot;)                \
<span class="udiff-line-modified-removed">-   SHENANDOAH_GC_PAR_PHASE_DO(full_gc_purge_weak_p_, &quot;        WR: &quot;, f)                 \</span>
<span class="udiff-line-modified-added">+   SHENANDOAH_PAR_PHASE_DO(full_gc_purge_weak_p_,    &quot;        WR: &quot;, f)                 \</span>
    f(full_gc_purge_cldg,                             &quot;      CLDG&quot;)                      \
    f(full_gc_calculate_addresses,                    &quot;  Calculate Addresses&quot;)           \
    f(full_gc_calculate_addresses_regular,            &quot;    Regular Objects&quot;)             \
    f(full_gc_calculate_addresses_humong,             &quot;    Humongous Objects&quot;)           \
    f(full_gc_adjust_pointers,                        &quot;  Adjust Pointers&quot;)               \
    f(full_gc_adjust_roots,                           &quot;  Adjust Roots&quot;)                  \
<span class="udiff-line-modified-removed">-   SHENANDOAH_GC_PAR_PHASE_DO(full_gc_adjust_roots_, &quot;    FA: &quot;, f)                     \</span>
<span class="udiff-line-modified-added">+   SHENANDOAH_PAR_PHASE_DO(full_gc_adjust_roots_,    &quot;    FA: &quot;, f)                     \</span>
    f(full_gc_copy_objects,                           &quot;  Copy Objects&quot;)                  \
    f(full_gc_copy_objects_regular,                   &quot;    Regular Objects&quot;)             \
    f(full_gc_copy_objects_humong,                    &quot;    Humongous Objects&quot;)           \
    f(full_gc_copy_objects_reset_complete,            &quot;    Reset Complete Bitmap&quot;)       \
    f(full_gc_copy_objects_rebuild,                   &quot;    Rebuild Region Sets&quot;)         \
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -151,54 +153,53 @@</span>
    f(full_gc_heapdump_post,                          &quot;  Post Heap Dump&quot;)                \
                                                                                         \
    f(conc_uncommit,                                  &quot;Concurrent Uncommit&quot;)             \
                                                                                         \
    f(heap_iteration_roots,                           &quot;Heap Iteration&quot;)                  \
<span class="udiff-line-modified-removed">-   SHENANDOAH_GC_PAR_PHASE_DO(heap_iteration_roots_, &quot;  HI: &quot;, f)                       \</span>
<span class="udiff-line-modified-added">+   SHENANDOAH_PAR_PHASE_DO(heap_iteration_roots_,    &quot;  HI: &quot;, f)                       \</span>
    // end
  
  typedef WorkerDataArray&lt;double&gt; ShenandoahWorkerData;
  
  class ShenandoahPhaseTimings : public CHeapObj&lt;mtGC&gt; {
    friend class ShenandoahGCPhase;
    friend class ShenandoahWorkerTimingsTracker;
  public:
<span class="udiff-line-modified-removed">- #define GC_PHASE_DECLARE_ENUM(type, title)   type,</span>
<span class="udiff-line-modified-added">+ #define SHENANDOAH_PHASE_DECLARE_ENUM(type, title)   type,</span>
  
    enum Phase {
<span class="udiff-line-modified-removed">-     SHENANDOAH_GC_PHASE_DO(GC_PHASE_DECLARE_ENUM)</span>
<span class="udiff-line-modified-added">+     SHENANDOAH_PHASE_DO(SHENANDOAH_PHASE_DECLARE_ENUM)</span>
      _num_phases,
      _invalid_phase = _num_phases
    };
  
<span class="udiff-line-modified-removed">-   enum GCParPhases {</span>
<span class="udiff-line-modified-removed">-     SHENANDOAH_GC_PAR_PHASE_DO(,, GC_PHASE_DECLARE_ENUM)</span>
<span class="udiff-line-modified-removed">-     GCParPhasesSentinel</span>
<span class="udiff-line-modified-added">+   enum ParPhase {</span>
<span class="udiff-line-modified-added">+     SHENANDOAH_PAR_PHASE_DO(,, SHENANDOAH_PHASE_DECLARE_ENUM)</span>
<span class="udiff-line-modified-added">+     _num_par_phases</span>
    };
  
<span class="udiff-line-modified-removed">- #undef GC_PHASE_DECLARE_ENUM</span>
<span class="udiff-line-modified-added">+ #undef SHENANDOAH_PHASE_DECLARE_ENUM</span>
  
  private:
<span class="udiff-line-modified-removed">-   size_t              _max_workers;</span>
<span class="udiff-line-modified-added">+   uint                _max_workers;</span>
    double              _cycle_data[_num_phases];
    HdrSeq              _global_data[_num_phases];
    static const char*  _phase_names[_num_phases];
  
<span class="udiff-line-removed">-   Phase                 _current_worker_phase;</span>
    ShenandoahWorkerData* _worker_data[_num_phases];
    ShenandoahCollectorPolicy* _policy;
  
    static bool is_worker_phase(Phase phase);
<span class="udiff-line-modified-removed">-   Phase current_worker_phase() { return _current_worker_phase; }</span>
<span class="udiff-line-modified-added">+   static bool is_root_work_phase(Phase phase);</span>
  
<span class="udiff-line-modified-removed">-   ShenandoahWorkerData* worker_data(Phase phase, GCParPhases par_phase);</span>
<span class="udiff-line-modified-removed">-   Phase worker_par_phase(Phase phase, GCParPhases par_phase);</span>
<span class="udiff-line-modified-added">+   ShenandoahWorkerData* worker_data(Phase phase, ParPhase par_phase);</span>
<span class="udiff-line-modified-added">+   Phase worker_par_phase(Phase phase, ParPhase par_phase);</span>
  
    void set_cycle_data(Phase phase, double time);
  
  public:
<span class="udiff-line-modified-removed">-   ShenandoahPhaseTimings();</span>
<span class="udiff-line-modified-added">+   ShenandoahPhaseTimings(uint _max_workers);</span>
  
    void record_phase_time(Phase phase, double time);
  
    void record_workers_start(Phase phase);
    void record_workers_end(Phase phase);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -215,18 +216,18 @@</span>
    void print_global_on(outputStream* out) const;
  };
  
  class ShenandoahWorkerTimingsTracker : public StackObj {
  private:
<span class="udiff-line-modified-removed">-   ShenandoahPhaseTimings*             const _timings;</span>
<span class="udiff-line-modified-removed">-   ShenandoahPhaseTimings::Phase       const _phase;</span>
<span class="udiff-line-modified-removed">-   ShenandoahPhaseTimings::GCParPhases const _par_phase;</span>
<span class="udiff-line-modified-added">+   ShenandoahPhaseTimings*          const _timings;</span>
<span class="udiff-line-modified-added">+   ShenandoahPhaseTimings::Phase    const _phase;</span>
<span class="udiff-line-modified-added">+   ShenandoahPhaseTimings::ParPhase const _par_phase;</span>
    uint const _worker_id;
  
    double _start_time;
    EventGCPhaseParallel _event;
  public:
<span class="udiff-line-modified-removed">-   ShenandoahWorkerTimingsTracker(ShenandoahPhaseTimings::GCParPhases par_phase, uint worker_id);</span>
<span class="udiff-line-modified-added">+   ShenandoahWorkerTimingsTracker(ShenandoahPhaseTimings::Phase phase, ShenandoahPhaseTimings::ParPhase par_phase, uint worker_id);</span>
    ~ShenandoahWorkerTimingsTracker();
  };
  
  #endif // SHARE_GC_SHENANDOAH_SHENANDOAHPHASETIMINGS_HPP
</pre>
<center><a href="shenandoahPhaseTimings.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahRootProcessor.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>