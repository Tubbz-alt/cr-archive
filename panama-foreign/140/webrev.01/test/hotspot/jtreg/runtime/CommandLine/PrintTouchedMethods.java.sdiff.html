<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/runtime/CommandLine/PrintTouchedMethods.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="OptionsValidation/common/optionsvalidation/JVMOptionsUtils.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestHexArguments.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/runtime/CommandLine/PrintTouchedMethods.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 23 
 24 /*
 25  * @test
 26  * @bug 8025692
 27  * @modules java.base/jdk.internal.misc
 28  *          java.management
 29  * @library /test/lib
 30  * @compile TestLogTouchedMethods.java PrintTouchedMethods.java
 31  * @run main/othervm -XX:+UnlockDiagnosticVMOptions -XX:+LogTouchedMethods PrintTouchedMethods
 32  */
 33 
 34 import java.io.File;
 35 import java.util.List;
 36 import jdk.test.lib.process.ProcessTools;
 37 import jdk.test.lib.process.OutputAnalyzer;
 38 import jdk.test.lib.JDKToolFinder;
 39 
 40 public class PrintTouchedMethods {
 41 
 42     public static void main(String args[]) throws Exception {
<span class="line-modified"> 43       String[] javaArgs1 = {&quot;-XX:-UnlockDiagnosticVMOptions&quot;, &quot;-XX:+LogTouchedMethods&quot;, &quot;-XX:+PrintTouchedMethodsAtExit&quot;, &quot;TestLogTouchedMethods&quot;};</span>
<span class="line-modified"> 44       ProcessBuilder pb = ProcessTools.createJavaProcessBuilder(javaArgs1);</span>



 45 
 46       // UnlockDiagnostic turned off, should fail
 47       OutputAnalyzer output = new OutputAnalyzer(pb.start());
 48       output.shouldContain(&quot;Error: VM option &#39;LogTouchedMethods&#39; is diagnostic and must be enabled via -XX:+UnlockDiagnosticVMOptions.&quot;);
 49       output.shouldContain(&quot;Error: Could not create the Java Virtual Machine.&quot;);
 50 
<span class="line-modified"> 51       String[] javaArgs2 = {&quot;-XX:+UnlockDiagnosticVMOptions&quot;, &quot;-XX:+LogTouchedMethods&quot;, &quot;-XX:+PrintTouchedMethodsAtExit&quot;, &quot;TestLogTouchedMethods&quot;};</span>
<span class="line-modified"> 52       pb = ProcessTools.createJavaProcessBuilder(javaArgs2);</span>



 53       output = new OutputAnalyzer(pb.start());
 54       // check order:
 55       // 1 &quot;# Method::print_touched_methods version 1&quot; is the first in first line
 56       // 2 should contain TestLogMethods.methodA:()V
 57       // 3 should not contain TestLogMethods.methodB:()V
 58       // Repeat above for another run with -Xint
 59       List&lt;String&gt; lines = output.asLines();
 60 
 61       if (lines.size() &lt; 1) {
 62         throw new Exception(&quot;Empty output&quot;);
 63       }
 64 
 65       String first = lines.get(0);
 66       if (!first.equals(&quot;# Method::print_touched_methods version 1&quot;)) {
 67         throw new Exception(&quot;First line mismatch&quot;);
 68       }
 69 
 70       output.shouldContain(&quot;TestLogTouchedMethods.methodA:()V&quot;);
 71       output.shouldNotContain(&quot;TestLogTouchedMethods.methodB:()V&quot;);
 72       output.shouldHaveExitValue(0);
 73 
<span class="line-modified"> 74       String[] javaArgs3 = {&quot;-XX:+UnlockDiagnosticVMOptions&quot;, &quot;-Xint&quot;, &quot;-XX:+LogTouchedMethods&quot;, &quot;-XX:+PrintTouchedMethodsAtExit&quot;, &quot;TestLogTouchedMethods&quot;};</span>
<span class="line-modified"> 75       pb = ProcessTools.createJavaProcessBuilder(javaArgs3);</span>




 76       output = new OutputAnalyzer(pb.start());
 77       lines = output.asLines();
 78 
 79       if (lines.size() &lt; 1) {
 80         throw new Exception(&quot;Empty output&quot;);
 81       }
 82 
 83       first = lines.get(0);
 84       if (!first.equals(&quot;# Method::print_touched_methods version 1&quot;)) {
 85         throw new Exception(&quot;First line mismatch&quot;);
 86       }
 87 
 88       output.shouldContain(&quot;TestLogTouchedMethods.methodA:()V&quot;);
 89       output.shouldNotContain(&quot;TestLogTouchedMethods.methodB:()V&quot;);
 90       output.shouldHaveExitValue(0);
 91 
<span class="line-modified"> 92       String[] javaArgs4 = {&quot;-XX:+UnlockDiagnosticVMOptions&quot;, &quot;-Xint&quot;, &quot;-XX:+LogTouchedMethods&quot;, &quot;-XX:+PrintTouchedMethodsAtExit&quot;, &quot;-XX:-TieredCompilation&quot;, &quot;TestLogTouchedMethods&quot;};</span>
<span class="line-modified"> 93       pb = ProcessTools.createJavaProcessBuilder(javaArgs4);</span>





 94       output = new OutputAnalyzer(pb.start());
 95       lines = output.asLines();
 96 
 97       if (lines.size() &lt; 1) {
 98         throw new Exception(&quot;Empty output&quot;);
 99       }
100 
101       first = lines.get(0);
102       if (!first.equals(&quot;# Method::print_touched_methods version 1&quot;)) {
103         throw new Exception(&quot;First line mismatch&quot;);
104       }
105 
106       output.shouldContain(&quot;TestLogTouchedMethods.methodA:()V&quot;);
107       output.shouldNotContain(&quot;TestLogTouchedMethods.methodB:()V&quot;);
108       output.shouldHaveExitValue(0);
109 
110       // Test jcmd PrintTouchedMethods VM.print_touched_methods
111       String pid = Long.toString(ProcessTools.getProcessId());
112       pb = new ProcessBuilder();
113       pb.command(new String[] {JDKToolFinder.getJDKTool(&quot;jcmd&quot;), pid, &quot;VM.print_touched_methods&quot;});
</pre>
</td>
<td>
<hr />
<pre>
 23 
 24 /*
 25  * @test
 26  * @bug 8025692
 27  * @modules java.base/jdk.internal.misc
 28  *          java.management
 29  * @library /test/lib
 30  * @compile TestLogTouchedMethods.java PrintTouchedMethods.java
 31  * @run main/othervm -XX:+UnlockDiagnosticVMOptions -XX:+LogTouchedMethods PrintTouchedMethods
 32  */
 33 
 34 import java.io.File;
 35 import java.util.List;
 36 import jdk.test.lib.process.ProcessTools;
 37 import jdk.test.lib.process.OutputAnalyzer;
 38 import jdk.test.lib.JDKToolFinder;
 39 
 40 public class PrintTouchedMethods {
 41 
 42     public static void main(String args[]) throws Exception {
<span class="line-modified"> 43       ProcessBuilder pb = ProcessTools.createJavaProcessBuilder(</span>
<span class="line-modified"> 44           &quot;-XX:-UnlockDiagnosticVMOptions&quot;,</span>
<span class="line-added"> 45           &quot;-XX:+LogTouchedMethods&quot;,</span>
<span class="line-added"> 46           &quot;-XX:+PrintTouchedMethodsAtExit&quot;,</span>
<span class="line-added"> 47           &quot;TestLogTouchedMethods&quot;);</span>
 48 
 49       // UnlockDiagnostic turned off, should fail
 50       OutputAnalyzer output = new OutputAnalyzer(pb.start());
 51       output.shouldContain(&quot;Error: VM option &#39;LogTouchedMethods&#39; is diagnostic and must be enabled via -XX:+UnlockDiagnosticVMOptions.&quot;);
 52       output.shouldContain(&quot;Error: Could not create the Java Virtual Machine.&quot;);
 53 
<span class="line-modified"> 54       pb = ProcessTools.createJavaProcessBuilder(</span>
<span class="line-modified"> 55           &quot;-XX:+UnlockDiagnosticVMOptions&quot;,</span>
<span class="line-added"> 56           &quot;-XX:+LogTouchedMethods&quot;,</span>
<span class="line-added"> 57           &quot;-XX:+PrintTouchedMethodsAtExit&quot;,</span>
<span class="line-added"> 58           &quot;TestLogTouchedMethods&quot;);</span>
 59       output = new OutputAnalyzer(pb.start());
 60       // check order:
 61       // 1 &quot;# Method::print_touched_methods version 1&quot; is the first in first line
 62       // 2 should contain TestLogMethods.methodA:()V
 63       // 3 should not contain TestLogMethods.methodB:()V
 64       // Repeat above for another run with -Xint
 65       List&lt;String&gt; lines = output.asLines();
 66 
 67       if (lines.size() &lt; 1) {
 68         throw new Exception(&quot;Empty output&quot;);
 69       }
 70 
 71       String first = lines.get(0);
 72       if (!first.equals(&quot;# Method::print_touched_methods version 1&quot;)) {
 73         throw new Exception(&quot;First line mismatch&quot;);
 74       }
 75 
 76       output.shouldContain(&quot;TestLogTouchedMethods.methodA:()V&quot;);
 77       output.shouldNotContain(&quot;TestLogTouchedMethods.methodB:()V&quot;);
 78       output.shouldHaveExitValue(0);
 79 
<span class="line-modified"> 80       pb = ProcessTools.createJavaProcessBuilder(</span>
<span class="line-modified"> 81           &quot;-XX:+UnlockDiagnosticVMOptions&quot;,</span>
<span class="line-added"> 82           &quot;-Xint&quot;,</span>
<span class="line-added"> 83           &quot;-XX:+LogTouchedMethods&quot;,</span>
<span class="line-added"> 84           &quot;-XX:+PrintTouchedMethodsAtExit&quot;,</span>
<span class="line-added"> 85           &quot;TestLogTouchedMethods&quot;);</span>
 86       output = new OutputAnalyzer(pb.start());
 87       lines = output.asLines();
 88 
 89       if (lines.size() &lt; 1) {
 90         throw new Exception(&quot;Empty output&quot;);
 91       }
 92 
 93       first = lines.get(0);
 94       if (!first.equals(&quot;# Method::print_touched_methods version 1&quot;)) {
 95         throw new Exception(&quot;First line mismatch&quot;);
 96       }
 97 
 98       output.shouldContain(&quot;TestLogTouchedMethods.methodA:()V&quot;);
 99       output.shouldNotContain(&quot;TestLogTouchedMethods.methodB:()V&quot;);
100       output.shouldHaveExitValue(0);
101 
<span class="line-modified">102       pb = ProcessTools.createJavaProcessBuilder(</span>
<span class="line-modified">103           &quot;-XX:+UnlockDiagnosticVMOptions&quot;,</span>
<span class="line-added">104           &quot;-Xint&quot;,</span>
<span class="line-added">105           &quot;-XX:+LogTouchedMethods&quot;,</span>
<span class="line-added">106           &quot;-XX:+PrintTouchedMethodsAtExit&quot;,</span>
<span class="line-added">107           &quot;-XX:-TieredCompilation&quot;,</span>
<span class="line-added">108           &quot;TestLogTouchedMethods&quot;);</span>
109       output = new OutputAnalyzer(pb.start());
110       lines = output.asLines();
111 
112       if (lines.size() &lt; 1) {
113         throw new Exception(&quot;Empty output&quot;);
114       }
115 
116       first = lines.get(0);
117       if (!first.equals(&quot;# Method::print_touched_methods version 1&quot;)) {
118         throw new Exception(&quot;First line mismatch&quot;);
119       }
120 
121       output.shouldContain(&quot;TestLogTouchedMethods.methodA:()V&quot;);
122       output.shouldNotContain(&quot;TestLogTouchedMethods.methodB:()V&quot;);
123       output.shouldHaveExitValue(0);
124 
125       // Test jcmd PrintTouchedMethods VM.print_touched_methods
126       String pid = Long.toString(ProcessTools.getProcessId());
127       pb = new ProcessBuilder();
128       pb.command(new String[] {JDKToolFinder.getJDKTool(&quot;jcmd&quot;), pid, &quot;VM.print_touched_methods&quot;});
</pre>
</td>
</tr>
</table>
<center><a href="OptionsValidation/common/optionsvalidation/JVMOptionsUtils.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestHexArguments.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>