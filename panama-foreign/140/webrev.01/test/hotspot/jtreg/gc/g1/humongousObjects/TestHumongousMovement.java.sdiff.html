<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/gc/g1/humongousObjects/TestHumongousMovement.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="TestHumongousClassLoader.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TestHumongousNonArrayAllocation.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/gc/g1/humongousObjects/TestHumongousMovement.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 28 import jdk.test.lib.Utils;
 29 import sun.hotspot.WhiteBox;
 30 
 31 import java.io.PrintStream;
 32 import java.math.BigInteger;
 33 import java.util.ArrayList;
 34 import java.util.List;
 35 import java.util.Random;
 36 import java.util.stream.Collectors;
 37 
 38 /**
 39  * @test TestHumongousMovement
 40  * @key randomness
 41  * @summary Checks that Humongous objects are not moved during GC
 42  * @requires vm.gc.G1
 43  * @library /test/lib /
 44  * @modules java.base/jdk.internal.misc
 45  * @modules java.management
 46  * @build sun.hotspot.WhiteBox
 47  * @run driver ClassFileInstaller sun.hotspot.WhiteBox
<span class="line-removed"> 48  *      sun.hotspot.WhiteBox$WhiteBoxPermission</span>
 49  * @run main/othervm -XX:+UseG1GC -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbootclasspath/a:.
 50  *                   -XX:G1HeapRegionSize=1M -Xms200m -Xmx200m -XX:InitiatingHeapOccupancyPercent=100
 51  *                   -Xlog:gc=info:file=TestHumongousMovement.log
 52  *                   gc.g1.humongousObjects.TestHumongousMovement
 53  */
 54 
 55 public class TestHumongousMovement {
 56 
 57     private static class AllocationData {
 58         private final byte[] allocation;
 59         public final BigInteger objectAddress;
 60 
 61         public AllocationData(byte[] byteArray) {
 62             allocation = byteArray;
 63             objectAddress = new BigInteger(Long.toUnsignedString((WB.getObjectAddress(allocation))));
 64         }
 65 
 66         public boolean isAddressChanged() {
 67             return !new BigInteger(Long.toUnsignedString((WB.getObjectAddress(allocation)))).equals(objectAddress);
 68         }
</pre>
</td>
<td>
<hr />
<pre>
 28 import jdk.test.lib.Utils;
 29 import sun.hotspot.WhiteBox;
 30 
 31 import java.io.PrintStream;
 32 import java.math.BigInteger;
 33 import java.util.ArrayList;
 34 import java.util.List;
 35 import java.util.Random;
 36 import java.util.stream.Collectors;
 37 
 38 /**
 39  * @test TestHumongousMovement
 40  * @key randomness
 41  * @summary Checks that Humongous objects are not moved during GC
 42  * @requires vm.gc.G1
 43  * @library /test/lib /
 44  * @modules java.base/jdk.internal.misc
 45  * @modules java.management
 46  * @build sun.hotspot.WhiteBox
 47  * @run driver ClassFileInstaller sun.hotspot.WhiteBox

 48  * @run main/othervm -XX:+UseG1GC -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbootclasspath/a:.
 49  *                   -XX:G1HeapRegionSize=1M -Xms200m -Xmx200m -XX:InitiatingHeapOccupancyPercent=100
 50  *                   -Xlog:gc=info:file=TestHumongousMovement.log
 51  *                   gc.g1.humongousObjects.TestHumongousMovement
 52  */
 53 
 54 public class TestHumongousMovement {
 55 
 56     private static class AllocationData {
 57         private final byte[] allocation;
 58         public final BigInteger objectAddress;
 59 
 60         public AllocationData(byte[] byteArray) {
 61             allocation = byteArray;
 62             objectAddress = new BigInteger(Long.toUnsignedString((WB.getObjectAddress(allocation))));
 63         }
 64 
 65         public boolean isAddressChanged() {
 66             return !new BigInteger(Long.toUnsignedString((WB.getObjectAddress(allocation)))).equals(objectAddress);
 67         }
</pre>
</td>
</tr>
</table>
<center><a href="TestHumongousClassLoader.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TestHumongousNonArrayAllocation.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>