<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/hotspot/jtreg/vmTestbase/vm/jit/LongTransitions/JniArmHFTestGenerator.java.txt</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2012, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /* This code generate an LTTest.java and LTTest.c files with corresponding *.cfg files which containt test defenition
 25  * for JNI testing.
 26  *
 27  */
 28 import java.io.File;
 29 import java.io.FileWriter;
 30 import java.io.IOException;
 31 import java.util.ArrayList;
 32 import java.util.Arrays;
 33 import java.util.Random;
 34 
 35 //Java and C file generator for JNI tests
 36 public class JniArmHFTestGenerator {
 37 
 38     private final String JAVA_CLASS_NAME = &quot;LTTest&quot;;
 39     private final String C_FNC_NAME_PREFIX = &quot;Java_vm_jit_LongTransitions_&quot; + JAVA_CLASS_NAME + &quot;_&quot;;
 40     private final String JAVA_PACKAGE_NAME = &quot;vm.jit.LongTransitions&quot;;
 41     private final String TEST_LIST_PREFIX = &quot;vm/jit/LongTransitions&quot;;
 42     private final String TEST_LIST_NAME = &quot;vm.jit.long.testlist&quot;;
 43     //Maximal line length for some SRC generation function
 44     private final int LINE_LENGTH = 70;
 45     //127 is maximal value for JAVA parameters list
 46     private final int PARAMS_COUNTER = 127;
 47     StringBuilder javaFileSrc;
 48     StringBuilder cFileSrc;
 49     //StringBuilder cfgFileSrc;
 50     private String javaTxtFileName;
 51     private String cTxtFileName;
 52     private File outputDir;
 53     private ArrayList&lt;String&gt; javaFncNames = new ArrayList&lt;String&gt;();
 54 
 55     public static void main(String[] args) throws IOException {
 56         new JniArmHFTestGenerator().makeSomeTest();
 57     }
 58 
 59     public void makeSomeTest() throws IOException {
 60 
 61         makeJavaIntro(JAVA_CLASS_NAME);
 62         makeCIntro();
 63         int cnt = PARAMS_COUNTER;
 64 
 65         makeOneTest(cnt, ParamType.EASY_F, TestType.RANDOM, &quot;nativeFnc1&quot;);
 66         makeOneTest(cnt, ParamType.EASY_D, TestType.RANDOM, &quot;nativeFnc2&quot;);
 67         makeOneTest(cnt, ParamType.MIXED_FI1, TestType.RANDOM, &quot;nativeFnc3&quot;);
 68         makeOneTest(cnt, ParamType.MIXED_FB1, TestType.RANDOM, &quot;nativeFnc4&quot;);
 69         makeOneTest(cnt, ParamType.MIXED_FBI1, TestType.RANDOM, &quot;nativeFnc5&quot;);
 70         makeOneTest(cnt, ParamType.MIXED_DI1, TestType.RANDOM, &quot;nativeFnc6&quot;);
 71         makeOneTest(cnt, ParamType.MIXED_DB1, TestType.RANDOM, &quot;nativeFnc7&quot;);
 72         makeOneTest(cnt, ParamType.MIXED_DBI1, TestType.RANDOM, &quot;nativeFnc8&quot;);
 73         makeOneTest(cnt, ParamType.MIXED_DFBI1, TestType.RANDOM, &quot;nativeFnc9&quot;);
 74         makeOneTest(cnt, ParamType.MIXED_DF1, TestType.RANDOM, &quot;nativeFnc10&quot;);
 75         makeOneTest(cnt, ParamType.MIXED_DFI1, TestType.RANDOM, &quot;nativeFnc11&quot;);
 76         makeOneTest(cnt, ParamType.MIXED_DFB1, TestType.RANDOM, &quot;nativeFnc12&quot;);
 77 
 78         makeOneTest(cnt, ParamType.MIXED_FI2, TestType.RANDOM, &quot;nativeFnc13&quot;);
 79         makeOneTest(cnt, ParamType.MIXED_FB2, TestType.RANDOM, &quot;nativeFnc14&quot;);
 80         makeOneTest(cnt, ParamType.MIXED_FBI2, TestType.RANDOM, &quot;nativeFnc15&quot;);
 81         makeOneTest(cnt, ParamType.MIXED_DI2, TestType.RANDOM, &quot;nativeFnc16&quot;);
 82         makeOneTest(cnt, ParamType.MIXED_DB2, TestType.RANDOM, &quot;nativeFnc17&quot;);
 83         makeOneTest(cnt, ParamType.MIXED_DBI2, TestType.RANDOM, &quot;nativeFnc18&quot;);
 84         makeOneTest(cnt, ParamType.MIXED_DFBI2, TestType.RANDOM, &quot;nativeFnc19&quot;);
 85         makeOneTest(cnt, ParamType.MIXED_DF2, TestType.RANDOM, &quot;nativeFnc20&quot;);
 86         makeOneTest(cnt, ParamType.MIXED_DFI2, TestType.RANDOM, &quot;nativeFnc21&quot;);
 87         makeOneTest(cnt, ParamType.MIXED_DFB2, TestType.RANDOM, &quot;nativeFnc22&quot;);
 88 
 89         makeOneTest(cnt, ParamType.MIXED_FI3, TestType.RANDOM, &quot;nativeFnc23&quot;);
 90         makeOneTest(cnt, ParamType.MIXED_FB3, TestType.RANDOM, &quot;nativeFnc24&quot;);
 91         makeOneTest(cnt, ParamType.MIXED_FBI3, TestType.RANDOM, &quot;nativeFnc25&quot;);
 92         makeOneTest(cnt, ParamType.MIXED_DI3, TestType.RANDOM, &quot;nativeFnc26&quot;);
 93         makeOneTest(cnt, ParamType.MIXED_DB3, TestType.RANDOM, &quot;nativeFnc27&quot;);
 94         makeOneTest(cnt, ParamType.MIXED_DBI3, TestType.RANDOM, &quot;nativeFnc28&quot;);
 95         makeOneTest(cnt, ParamType.MIXED_DFBI3, TestType.RANDOM, &quot;nativeFnc29&quot;);
 96         makeOneTest(cnt, ParamType.MIXED_DF3, TestType.RANDOM, &quot;nativeFnc30&quot;);
 97         makeOneTest(cnt, ParamType.MIXED_DFI3, TestType.RANDOM, &quot;nativeFnc31&quot;);
 98         makeOneTest(cnt, ParamType.MIXED_DFB3, TestType.RANDOM, &quot;nativeFnc32&quot;);
 99 
100         makeOneTest(cnt, ParamType.MIXED_FI4, TestType.RANDOM, &quot;nativeFnc33&quot;);
101         makeOneTest(cnt, ParamType.MIXED_FB4, TestType.RANDOM, &quot;nativeFnc34&quot;);
102         makeOneTest(cnt, ParamType.MIXED_FBI4, TestType.RANDOM, &quot;nativeFnc35&quot;);
103         makeOneTest(cnt, ParamType.MIXED_DI4, TestType.RANDOM, &quot;nativeFnc36&quot;);
104         makeOneTest(cnt, ParamType.MIXED_DB4, TestType.RANDOM, &quot;nativeFnc37&quot;);
105         makeOneTest(cnt, ParamType.MIXED_DBI4, TestType.RANDOM, &quot;nativeFnc38&quot;);
106         makeOneTest(cnt, ParamType.MIXED_DFBI4, TestType.RANDOM, &quot;nativeFnc39&quot;);
107         makeOneTest(cnt, ParamType.MIXED_DF4, TestType.RANDOM, &quot;nativeFnc40&quot;);
108         makeOneTest(cnt, ParamType.MIXED_DFI4, TestType.RANDOM, &quot;nativeFnc41&quot;);
109         makeOneTest(cnt, ParamType.MIXED_DFB4, TestType.RANDOM, &quot;nativeFnc42&quot;);
110 
111         makeOneTest(cnt, ParamType.MIXED_FI5, TestType.RANDOM, &quot;nativeFnc43&quot;);
112         makeOneTest(cnt, ParamType.MIXED_FB5, TestType.RANDOM, &quot;nativeFnc44&quot;);
113         makeOneTest(cnt, ParamType.MIXED_FBI5, TestType.RANDOM, &quot;nativeFnc45&quot;);
114         makeOneTest(cnt, ParamType.MIXED_DI5, TestType.RANDOM, &quot;nativeFnc46&quot;);
115         makeOneTest(cnt, ParamType.MIXED_DB5, TestType.RANDOM, &quot;nativeFnc47&quot;);
116         makeOneTest(cnt, ParamType.MIXED_DBI5, TestType.RANDOM, &quot;nativeFnc48&quot;);
117         makeOneTest(cnt, ParamType.MIXED_DFBI5, TestType.RANDOM, &quot;nativeFnc49&quot;);
118         makeOneTest(cnt, ParamType.MIXED_DF5, TestType.RANDOM, &quot;nativeFnc50&quot;);
119         makeOneTest(cnt, ParamType.MIXED_DFI5, TestType.RANDOM, &quot;nativeFnc51&quot;);
120         makeOneTest(cnt, ParamType.MIXED_DFB5, TestType.RANDOM, &quot;nativeFnc52&quot;);
121         makeJavaInvoke();
122         makeJavaOutro();
123 
124         writeToJavaFile(JAVA_CLASS_NAME);
125         writeToCFile(JAVA_CLASS_NAME);
126         //writeCmpFile();
127 
128         writeTestListFile();
129         writeCfgFile();
130     }
131 
132     private void makeJavaInvoke() {
133         appendToJava(&quot;    public static void main(String[] args) throws Exception&quot;);
134         appendToJava(&quot;    {&quot;);
135         appendToJava(&quot;        if ( System.getProperty(\&quot;os.name\&quot;).matches(\&quot;.*[Ww][Ii][Nn].*\&quot;) )&quot;);
136         appendToJava(&quot;        {&quot;);
137         appendToJava(&quot;            System.out.println(\&quot;TEST PASSED! Dummy execution on Windows* OS!\&quot;);&quot;);
138         appendToJava(&quot;            return;&quot;);
139         appendToJava(&quot;        }&quot;);
140 
141         appendToJava(&quot;        deleteFiles();&quot;);
142         appendToJavaN(&quot;        PrintStream ps=new PrintStream(new File(\&quot;&quot;);
143         appendToJavaN(javaTxtFileName);
144         appendToJava(&quot;\&quot;));&quot;);
145 
146         appendToJava(&quot;    if (args.length&gt;0)&quot;);
147         appendToJava(&quot;        switch(args[0])&quot;);
148         appendToJava(&quot;        {&quot;);
149 
150         for (String s : javaFncNames) {
151             appendToJava(&quot;        case \&quot;&quot; + s + &quot;\&quot;:&quot;);
152             appendToJavaN(&quot;            &quot;);
153             appendToJavaN(s);
154             appendToJava(&quot;_invoke(ps);&quot;);
155             appendToJava(&quot;            break;&quot;);
156 
157         }
158         appendToJava(&quot;        default:&quot;);
159         appendToJava(&quot;            throw new Exception(\&quot;FAIL: invalid args!\&quot;);&quot;);
160         appendToJava(&quot;        }&quot;);
161         appendToJava(&quot;        else&quot;);
162         appendToJava(&quot;        {&quot;);
163         appendToJava(&quot;            throw new Exception(\&quot;FAIL: invalid args!\&quot;);&quot;);
164         appendToJava(&quot;        }&quot;);
165 
166 
167     }
168 
169     private void makeCIntro() {
170         //appendToC(&quot; //------------------------C----------------------------&quot;);
171         //appendToC(&quot;#include \&quot;&quot;+className+&quot;.h\&quot;&quot;);
172         appendToC(&quot;#include &lt;jni.h&gt;&quot;);
173         appendToC(&quot;#include &lt;stdio.h&gt;&quot;);
174     }
175 
176     private void makeJavaIntro(String className) {
177 
178         cFileSrc = new StringBuilder();
179         javaFileSrc = new StringBuilder();
180 
181 
182         File outputDirL1 = new File(&quot;vm&quot; + File.separatorChar + &quot;jit&quot; + File.separatorChar + &quot;LongTransitions&quot;);
183         //outputDir=new File(outputDirL1,className);
184         outputDir = outputDirL1;
185         outputDir.mkdirs();
186 
187         javaTxtFileName = className + &quot;_java.txt&quot;;
188         cTxtFileName = className + &quot;_c.txt&quot;;
189 
190         appendToJava(&quot;package &quot; + JAVA_PACKAGE_NAME + &quot;;&quot;);
191         appendToJava(&quot;import java.io.*;&quot;);
192         appendToJava(&quot;import java.util.Random;&quot;);
<a name="2" id="anc2"></a>
193         appendToJava(&quot;public class &quot; + className);
194         appendToJava(&quot;{&quot;);
195         appendToJava(&quot;    public static boolean flag = false;&quot;);
196         appendToJava(&quot;    static Random rnd;&quot;);
197         appendToJava(&quot;    static{&quot;);
<a name="3" id="anc3"></a><span class="line-modified">198         appendToJava(&quot;        rnd=new Random();&quot;);</span>
199         appendToJava(&quot;        System.loadLibrary(\&quot;&quot; + className + &quot;\&quot;);&quot;);
200         appendToJava(&quot;    }&quot;);
201         //Different randoms
202         appendToJava(&quot;    public static int getRndInt(){return rnd.nextInt(Integer.MAX_VALUE);}&quot;);
203         appendToJava(&quot;    public static float getRndFloat(){return rnd.nextFloat()*Float.MAX_VALUE;}&quot;);
204         appendToJava(&quot;    public static double getRndDouble(){return rnd.nextDouble()*Double.MAX_VALUE;}&quot;);
205         appendToJava(&quot;    public static byte getRndByte(){return (byte)rnd.nextInt(Byte.MAX_VALUE);}&quot;);
206 
207         //deleteFiles method
208         appendToJava(&quot;    private static void deleteFiles()&quot;);
209         appendToJava(&quot;    {&quot;);
210         appendToJavaN(&quot;        File f=new File(\&quot;&quot;);
211         appendToJavaN(javaTxtFileName);
212         appendToJava(&quot;\&quot;);&quot;);
213         appendToJava(&quot;        if ( f.exists())&quot;);
214         appendToJava(&quot;        f.delete();&quot;);
215         appendToJavaN(&quot;        f=new File(\&quot;&quot;);
216         appendToJavaN(cTxtFileName);
217         appendToJava(&quot;\&quot;);&quot;);
218         appendToJava(&quot;        if ( f.exists())&quot;);
219         appendToJava(&quot;         f.delete();&quot;);
220         appendToJava(&quot;    }&quot;);
221     }
222 
223     private void makeJavaOutro() {
224         appendToJava(&quot;        flag=chkFile();&quot;);
225         appendToJava(&quot;        if(!flag)&quot;);
226         appendToJava(&quot;            throw new Exception(\&quot;FAIL:Tests failed!\&quot;); &quot;);
227         appendToJava(&quot;    }&quot;);
228         appendToJava(&quot;    private static boolean chkFile()&quot;);
229         appendToJava(&quot;    {&quot;);
230         appendToJava(&quot;        File javaFile=new File(\&quot;&quot; + javaTxtFileName + &quot;\&quot;);&quot;);
231         appendToJava(&quot;        if (! javaFile.exists())&quot;);
232         appendToJava(&quot;        {&quot;);
233         appendToJava(&quot;            System.out.println(\&quot;FAIL:Failed to open file &quot; + javaTxtFileName + &quot; - file not exists!\&quot;);&quot;);
234         appendToJava(&quot;            return false;&quot;);
235         appendToJava(&quot;        }&quot;);
236         appendToJava(&quot;        File cFile=new File(\&quot;&quot; + cTxtFileName + &quot;\&quot;);&quot;);
237         appendToJava(&quot;        if (! cFile.exists())&quot;);
238         appendToJava(&quot;        {&quot;);
239         appendToJava(&quot;                System.out.println(\&quot;FAIL:Failed to open file &quot; + cTxtFileName + &quot; - file not exists!\&quot;);&quot;);
240         appendToJava(&quot;                return false;&quot;);
241         appendToJava(&quot;        }&quot;);
242         appendToJava(&quot;        if ( cFile.length()!=javaFile.length() )&quot;);
243         appendToJava(&quot;        {&quot;);
244         appendToJava(&quot;            System.out.println(\&quot;FAIL:File length not equal!\&quot;);&quot;);
245         appendToJava(&quot;            return false;&quot;);
246         appendToJava(&quot;        }&quot;);
247         appendToJava(&quot;        long byteCount=cFile.length();&quot;);
248 
249 
250         appendToJava(&quot;        try{&quot;);
251         appendToJava(&quot;            FileInputStream fisC=new FileInputStream(cFile);&quot;);
252         appendToJava(&quot;            FileInputStream fisJava=new FileInputStream(javaFile);&quot;);
253         appendToJava(&quot;            byte[] cData=new byte[fisC.available()];&quot;);
254         appendToJava(&quot;            fisC.read(cData);&quot;);
255         appendToJava(&quot;            byte[] javaData=new byte[fisJava.available()];&quot;);
256         appendToJava(&quot;            fisJava.read(javaData);&quot;);
257 
258         appendToJava(&quot;            for ( int cnt=0;cnt&lt;byteCount;++cnt)&quot;);
259         appendToJava(&quot;            {&quot;);
260         appendToJava(&quot;                if ( cData[cnt]!=javaData[cnt] )&quot;);
261         appendToJava(&quot;                {&quot;);
262         appendToJava(&quot;                    System.out.println(\&quot;FAIL:Test failed! \&quot;+cnt+\&quot; byte are wrong! C file - \&quot; + cData[cnt] + \&quot; Java file - \&quot;+javaData[cnt] );&quot;);
263         appendToJava(&quot;                    return false;&quot;);
264         appendToJava(&quot;                }&quot;);
265         appendToJava(&quot;            }&quot;);
266         appendToJava(&quot;        }&quot;);
267         appendToJava(&quot;        catch (FileNotFoundException ex)&quot;);
268         appendToJava(&quot;        {&quot;);
269         appendToJava(&quot;            System.out.println(\&quot;FAIL:Some of files not found!\&quot;);&quot;);
270         appendToJava(&quot;            return false;&quot;);
271         appendToJava(&quot;        }&quot;);
272         appendToJava(&quot;        catch (IOException ex)&quot;);
273         appendToJava(&quot;        {&quot;);
274         appendToJava(&quot;            System.out.println(\&quot;FAIL:Failed to read files!\&quot;);&quot;);
275         appendToJava(&quot;            return false;&quot;);
276         appendToJava(&quot;        }&quot;);
277         appendToJava(&quot;        System.out.println(\&quot;PASS: all data passed correctly!\&quot;);&quot;);
278         appendToJava(&quot;        return true;&quot;);
279 
280 
281 
282         appendToJava(&quot;    }&quot;);
283 
284         appendToJava(&quot;}&quot;);
285 
286 
287     }
288 
289     private void makeOneTest(int paramCounter, ParamType paramType, TestType testType, String fncName) throws IOException {
290 
291         javaFncNames.add(fncName);
292         SrcGenerator gen = new SrcGenerator(paramCounter, 1, paramType, testType, fncName, LINE_LENGTH);
293         generateJava(gen);
294         generateCpp(gen);
295 
296 
297     }
298 
299     /*
300      * Create Java file containing code to call C native method. Method
301      * arguments list generated randomly.
302      *
303      */
304     private void generateJava(SrcGenerator srcGen) throws IOException {
305 
306         //native method
307         appendToJavaN(&quot;    native public static void &quot; + srcGen.getFncName() + &quot;(&quot;);
308         //appendToJavaN(srcGen.getJParm().toString());
309         appendToJavaN(srcGen.getJParm().toFormatString(&quot;        &quot;, LINE_LENGTH));
310         appendToJava(&quot;    );&quot;);
311         //main
312         //appendToJava(srcGen.getJExecVarCreation());
313         appendToJava(&quot;    private static void &quot; + srcGen.getFncName() + &quot;_invoke(PrintStream ps)&quot;);
314         appendToJava(srcGen.getJExec(&quot;        &quot;));
315     }
316 
317     private void writeToJavaFile(String className) throws IOException {
318 
319         File javaFile = new File(outputDir, className + &quot;.java&quot;);
320         try (FileWriter javaFileWriter = new FileWriter(javaFile)) {
321             javaFileWriter.write(javaFileSrc.toString());
322         }
323     }
324 
325     private void writeToCFile(String className) throws IOException {
326 
327         File cFile = new File(outputDir, className + &quot;.c&quot;);
328         try (FileWriter cFileWriter = new FileWriter(cFile)) {
329             cFileWriter.write(cFileSrc.toString());
330         }
331     }
332 
333     private void writeTestListFile() {
334 
335         StringBuilder cfg = new StringBuilder();
336 
337         for (String fncName : javaFncNames) {
338             cfg.append(TEST_LIST_PREFIX).append(&quot;/&quot;).append(fncName);
339             cfg.append(&quot; &quot;).append(&quot;execute_positive\n&quot;);
340         }
341 
342         File cfgFile = new File(outputDir, TEST_LIST_NAME);
343         try (FileWriter fw = new FileWriter(cfgFile)) {
344             fw.write(cfg.toString());
345         } catch (Exception e) {
346         }
347 
348     }
349 
350     private void writeCfgFile() {
351 
352         for (String fncName : javaFncNames) {
353 
354             StringBuilder cfg = new StringBuilder();
355 
356             cfg.append(&quot;LD_LIBRARY_PATH=${COMMON_LIBS_LOCATION}/lib/${ARCH}/vm/jit/LongTransitions${PS}$LD_LIBRARY_PATH\n&quot;);
357             cfg.append(&quot;export LD_LIBRARY_PATH\n&quot;);
358             cfg.append(&quot;JAVA_OPTS=${JAVA_OPTS} ${JIT_OPTS}\n&quot;);
359             cfg.append(&quot;export JAVA_OPTS\n&quot;);
360             cfg.append(&quot;EXECUTE_CLASS=&quot; + JAVA_PACKAGE_NAME + &quot;.&quot; + JAVA_CLASS_NAME + &quot;\n&quot;);
361             cfg.append(&quot;TEST_ARGS=&quot; + fncName);
362 
363             File tdir = new File(outputDir, fncName);
364             tdir.mkdirs();
365             File cfgFile = new File(tdir, fncName + &quot;.cfg&quot;);
366             try (FileWriter fw = new FileWriter(cfgFile)) {
367                 fw.write(cfg.toString());
368             } catch (Exception e) {
369             }
370         }
371     }
372 
373     /*
374      * Generate C file. This file containing instructions to put passed
375      * arguments into output file for further comparsion with java output *
376      */
377     private void generateCpp(SrcGenerator srcGen) throws IOException {
378 
379         appendToC(&quot;JNIEXPORT void JNICALL &quot; + C_FNC_NAME_PREFIX + srcGen.getFncName() + &quot;(JNIEnv *e, jclass c&quot;);
380         appendToCN(srcGen.getCParm().toFormatString(&quot;    &quot;, LINE_LENGTH));
381         appendToCN(&quot;)&quot;);
382         appendToC(&quot;\n{&quot;);
383 
384         appendToCN(&quot;    FILE *file=fopen(\&quot;&quot;);
385         appendToCN(cTxtFileName);
386         appendToCN(&quot;\&quot;,\&quot;a\&quot;);&quot;);
387 
388         appendToC(srcGen.getCExec(LINE_LENGTH,&quot;    &quot;));
389         appendToC(&quot;    fclose(file);&quot;);
390         appendToC(&quot;}&quot;);
391     }
392 
393     private void appendToJava(String s) {
394         javaFileSrc.append(s);
395         javaFileSrc.append(&quot;\n&quot;);
396         System.out.println(s);
397     }
398 
399     private void appendToJavaN(String s) {
400         javaFileSrc.append(s);
401         System.out.print(s);
402     }
403 
404     private void appendToC(String s) {
405         cFileSrc.append(s);
406         cFileSrc.append(&quot;\n&quot;);
407         System.out.println(s);
408     }
409 
410     private void appendToCN(String s) {
411         cFileSrc.append(s);
412         System.out.print(s);
413 
414     }
415 }
416 
417 enum NumberType {
418 
419     INT(&quot;int &quot;, &quot;getRndInt()&quot;, &quot;jint &quot;, &quot;%d&quot;, &quot;%d&quot;),
420     DOUBLE(&quot;double &quot;, &quot;getRndDouble()&quot;, &quot;jdouble &quot;, &quot;%e&quot;, &quot;%e&quot;),
421     FLOAT(&quot;float &quot;, &quot;getRndFloat()&quot;, &quot;jfloat &quot;, &quot;%e&quot;, &quot;%e&quot;),
422     BYTE(&quot;byte &quot;, &quot;getRndByte()&quot;, &quot;jbyte &quot;, &quot;%d&quot;, &quot;%d&quot;);
423     private String cType;
424     private String jType;
425     private String cConv;
426     private String jConv;
427     private String rndFnc;
428 
429     NumberType(String jType, String rndFnc, String cType, String jConv, String cConv) {
430         this.cType = cType;
431         this.jType = jType;
432         this.cConv = cConv;
433         this.jConv = jConv;
434         this.rndFnc = rndFnc;
435     }
436 
437     public String getСType() {
438         return cType;
439     }
440 
441     public String getJType() {
442         return jType;
443     }
444 
445     public String getСConv() {
446         return cConv;
447     }
448 
449     public String getJConv() {
450         return jConv;
451     }
452 
453     public String getFnc() {
454         return rndFnc;
455     }
456 }
457 
458 //Types for testing
459 enum ParamType {
460     //DFBI
461 
462     MIXED_DFBI1(NumberType.DOUBLE, NumberType.FLOAT, NumberType.BYTE, NumberType.INT),
463     MIXED_DFBI2(NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.BYTE, NumberType.INT),
464     MIXED_DFBI3(NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.BYTE, NumberType.INT),
465     MIXED_DFBI4(NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.BYTE, NumberType.INT),
466     MIXED_DFBI5(NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.BYTE, NumberType.INT),
467     //DFB
468     MIXED_DFB1(NumberType.DOUBLE, NumberType.FLOAT, NumberType.BYTE),
469     MIXED_DFB2(NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.BYTE),
470     MIXED_DFB3(NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.BYTE),
471     MIXED_DFB4(NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.BYTE),
472     MIXED_DFB5(NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.BYTE),
473     //DFI
474     MIXED_DFI1(NumberType.DOUBLE, NumberType.FLOAT, NumberType.INT),
475     MIXED_DFI2(NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.INT),
476     MIXED_DFI3(NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.INT),
477     MIXED_DFI4(NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.INT),
478     MIXED_DFI5(NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.DOUBLE, NumberType.FLOAT, NumberType.INT),
479     //
480     MIXED_DF1(NumberType.DOUBLE, NumberType.FLOAT),
481     MIXED_DF2(NumberType.DOUBLE, NumberType.FLOAT, NumberType.FLOAT),
482     MIXED_DF3(NumberType.DOUBLE, NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT),
483     MIXED_DF4(NumberType.DOUBLE, NumberType.DOUBLE, NumberType.FLOAT),
484     MIXED_DF5(NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.FLOAT),
485     //
486     EASY_D(NumberType.DOUBLE),
487     EASY_F(NumberType.FLOAT),
488     //Not needed
489     EASY_I(NumberType.INT),
490     EASY_B(NumberType.BYTE),
491     MIXED_IB(NumberType.INT, NumberType.BYTE),
492     //
493     MIXED_FBI1(NumberType.FLOAT, NumberType.BYTE, NumberType.INT),
494     MIXED_FBI2(NumberType.FLOAT, NumberType.FLOAT, NumberType.BYTE, NumberType.INT),
495     MIXED_FBI3(NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.BYTE, NumberType.INT),
496     MIXED_FBI4(NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.BYTE, NumberType.INT),
497     MIXED_FBI5(NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.BYTE, NumberType.INT),
498     //
499     MIXED_FB1(NumberType.FLOAT, NumberType.BYTE),
500     MIXED_FB2(NumberType.FLOAT, NumberType.FLOAT, NumberType.BYTE),
501     MIXED_FB3(NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.BYTE),
502     MIXED_FB4(NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.BYTE),
503     MIXED_FB5(NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.BYTE),
504     //
505     MIXED_DBI1(NumberType.DOUBLE, NumberType.BYTE, NumberType.INT),
506     MIXED_DBI2(NumberType.DOUBLE, NumberType.DOUBLE, NumberType.BYTE, NumberType.INT),
507     MIXED_DBI3(NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.BYTE, NumberType.INT),
508     MIXED_DBI4(NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.BYTE, NumberType.INT),
509     MIXED_DBI5(NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.BYTE, NumberType.INT),
510     //
511     MIXED_DB1(NumberType.DOUBLE, NumberType.BYTE),
512     MIXED_DB2(NumberType.DOUBLE, NumberType.DOUBLE, NumberType.BYTE),
513     MIXED_DB3(NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.BYTE),
514     MIXED_DB4(NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.BYTE),
515     MIXED_DB5(NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.BYTE),
516     //
517     MIXED_FI1(NumberType.FLOAT, NumberType.INT),
518     MIXED_FI2(NumberType.FLOAT, NumberType.FLOAT, NumberType.INT),
519     MIXED_FI3(NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.INT),
520     MIXED_FI4(NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.INT),
521     MIXED_FI5(NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.FLOAT, NumberType.INT),
522     //
523     MIXED_DI1(NumberType.DOUBLE, NumberType.INT),
524     MIXED_DI2(NumberType.DOUBLE, NumberType.DOUBLE, NumberType.INT),
525     MIXED_DI3(NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.INT),
526     MIXED_DI4(NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.INT),
527     MIXED_DI5(NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.DOUBLE, NumberType.INT);
528     ArrayList&lt;NumberType&gt; value = new ArrayList();
529 
530     ParamType(NumberType... type) {
531         value.addAll(Arrays.asList(type));
532     }
533 
534     public ArrayList&lt;NumberType&gt; getValue() {
535         return value;
536     }
537 }
538 
539 class GeneratorLogic {
540 
541     public String generateJava(String fncName, ParameterList parmOut, ParameterList parmType, int maxLength, String prefix) {
542         StringBuilder sb = new StringBuilder();
543 
544         sb.append(&quot;    {\n&quot;).append(prefix);
545         int lineLength = 0;
546         for (ParameterItem p : parmType.getList()) {
547             sb.append(p.value1);
548             sb.append(&quot; &quot;);
549             sb.append(p.value2);
550             sb.append(&quot;=&quot;);
551             sb.append(p.value3);
552             sb.append(&quot;;&quot;);
553             if (sb.length() - lineLength &gt; maxLength) {
554                 sb.append(&quot;\n&quot;).append(prefix);
555                 lineLength = sb.length();
556             }
557         }
558 
559         sb.append(&quot;\n&quot;);
560         sb.append(prefix);
561         for (ParameterItem p : parmOut.getList()) {
562             sb.append(&quot;ps.format(\&quot;&quot;);
563             sb.append(p.value2);
564             sb.append(&quot;=&quot;);
565             sb.append(p.value1);
566             sb.append(&quot;\\n\&quot;,&quot;);
567 
568 
569             sb.append(p.value2);
570             sb.append(&quot;);&quot;);
571             if (sb.length() - lineLength &gt; maxLength) {
572                 sb.append(&quot;\n&quot;).append(prefix);
573                 lineLength = sb.length();
574             }
575 
576         }
577 
578         sb.append(&quot;\n&quot;).append(prefix);
579 
580         sb.append(fncName);
581         sb.append(&quot;(&quot;);
582         for (ParameterItem p : parmOut.getList()) {
583             sb.append(p.getDelim());
584             sb.append(p.value2);
585             if (sb.length() - lineLength &gt; maxLength) {
586                 sb.append(&quot;\n&quot;).append(prefix);
587                 lineLength = sb.length();
588             }
589         }
590         sb.append(&quot;);\n}\n&quot;);
591 
592         return sb.toString();
593     }
594 }
595 
596 //Test types
597 enum TestType {
598 
599     RANDOM(new GeneratorLogic());
600     private GeneratorLogic genLogic;
601 
602     TestType(GeneratorLogic genLogic) {
603         this.genLogic = genLogic;
604     }
605 
606     public GeneratorLogic getLogic() {
607         return genLogic;
608     }
609 }
610 
611 //One item for ParameterList (delimiter and value to build strings)
612 class ParameterItem {
613 
614     private String delimiter;
615     String value1;
616     String value2;
617     String value3;
618     //private String endVal=&quot;&quot;;
619 
620     public ParameterItem(String delimiter, String value) {
621         this.delimiter = delimiter;
622         this.value1 = value;
623         value2 = &quot;&quot;;
624         value3 = &quot;&quot;;
625     }
626 
627     public ParameterItem(String delimiter, String value1, String value2) {
628         this.delimiter = delimiter;
629         this.value1 = value1;
630         this.value2 = value2;
631         value3 = &quot;&quot;;
632     }
633 
634     public ParameterItem(String delimiter, String value1, String value2, String value3) {
635         this.delimiter = delimiter;
636         this.value1 = value1;
637         this.value2 = value2;
638         this.value3 = value3;
639     }
640 
641     public String toString() {
642         return delimiter + value1 + value2 + value3;
643     }
644 
645     public String getDelim() {
646         return delimiter;
647     }
648 }
649 //Delimiters and values to generate calls, etc.
650 class ParameterList {
651 
652     ArrayList&lt;ParameterItem&gt; list = new ArrayList();
653     private String initDelim;
654     private String delim;
655     boolean lineBreak;
656 
657     public ParameterList(String initialDelimiter, String delimiter, boolean lineBreak) {
658         initDelim = initialDelimiter;
659         delim = delimiter;
660         this.lineBreak = lineBreak;
661     }
662 
663     public ArrayList&lt;ParameterItem&gt; getList() {
664         return list;
665     }
666 
667     public void add(String value) {
668         list.add(new ParameterItem(initDelim, value));
669         initDelim = delim;
670     }
671 
672     public void add(String value1, String value2) {
673         list.add(new ParameterItem(initDelim, value1, value2));
674         initDelim = delim;
675     }
676 
677     public void add(String value1, String value2, String value3) {
678         list.add(new ParameterItem(initDelim, value1, value2, value3));
679         initDelim = delim;
680     }
681 
682     public ParameterItem get(int id) {
683         return list.get(id);
684     }
685 
686     public String toString() {
687         StringBuilder sb = new StringBuilder();
688         for (ParameterItem p : list) {
689             sb.append(p.toString());
690             if (lineBreak) {
691                 sb.append(&quot;\n&quot;);
692             }
693 
694         }
695         return sb.toString();
696     }
697 
698     public String toFormatString(String prefix, int maxLength) {
699         StringBuilder sb = new StringBuilder();
700         int charCount = 0;
701         for (ParameterItem p : list) {
702             sb.append(p.toString());
703             if (sb.length() - charCount &gt; maxLength) {
704                 sb.append(&quot;\n&quot;).append(prefix);
705                 charCount = sb.length();
706             }
707         }
708         return sb.toString();
709     }
710 
711     public int size() {
712         return list.size();
713     }
714 
715     public String getAllItemExclude(int excludeId) {
716         StringBuilder sb = new StringBuilder();
717         int cnt = list.size();
718 
719         for (int id = 0; id &lt; cnt; ++id) {
720             ParameterItem p = list.get(id);
721             if (id == excludeId) {
722                 sb.append(p.getDelim());
723                 sb.append(&quot;0&quot;);
724             } else {
725                 sb.append(p.toString());
726 
727             }
728         }
729 
730         return sb.toString();
731 
732     }
733 
734     public String getAllItemExcludeNot(int excludeId) {
735         StringBuilder sb = new StringBuilder();
736         int cnt = list.size();
737 
738         for (int id = 0; id &lt; cnt; ++id) {
739             ParameterItem p = list.get(id);
740             if (id != excludeId) {
741                 sb.append(p.getDelim());
742                 sb.append(&quot;0&quot;);
743 //                sb.append(p.getEnd());
744             } else {
745                 sb.append(p.toString());
746 
747             }
748         }
749 
750         return sb.toString();
751     }
752 }
753 
754 class ParameterListGenerator {
755 
756     private ArrayList&lt;NumberType&gt; list = new ArrayList();
757     private Random random;
758     private int typeCnt;
759     ParameterList cParms = new ParameterList(&quot;,&quot;, &quot;,&quot;, true);
760     ParameterList rParms = new ParameterList(&quot;&quot;, &quot;,&quot;, true);
761     ParameterList jParms = new ParameterList(&quot;&quot;, &quot;,&quot;, true);
762     ParameterList cExec = new ParameterList(&quot;&quot;, &quot;&quot;, true);
763     ParameterList jExecParm = new ParameterList(&quot;&quot;, &quot;,&quot;, true);
764     ParameterList jExecOut = new ParameterList(&quot;&quot;, &quot;,&quot;, true);
765 
766     public ParameterListGenerator(int length, ParamType paramType) {
767         generateRndTest(paramType, length);
768     }
769 
770     private void add(ParameterList list, String s1) {
771         list.add(s1);
772     }
773 
774     private void add(ParameterList list, String s1, String s2) {
775         list.add(s1, s2);
776     }
777 
778     private void add(ParameterList list, String s1, String s2, String s3) {
779         list.add(s1, s2, s3);
780     }
781 
782     private void generateRndTest(ParamType paramType, int length) {
783         generateTypeList(paramType);
784 
785         typeCnt = list.size();
786         random = new Random();
787         random.setSeed(System.currentTimeMillis());
788 
789         for (int cnt = 0; cnt &lt; length; ++cnt) {
790             int type = random.nextInt(typeCnt);
791 
792             String randomVal = list.get(type).getFnc();
793 
794             String ctype = list.get(type).getСType();
795             String jtype = list.get(type).getJType();
796             String cconv = list.get(type).getСConv();
797             String jconv = list.get(type).getJConv();
798 
799             String varName = &quot;p&quot; + cnt;
800             add(jParms, jtype, varName);
801             //jParmGen.add(jtype + varName);
802 
803             //cParms.add(ctype + varName);
804             add(cParms, ctype, varName);
805 
806 
807             //rParms.add(varName);
808             add(rParms, varName);
809 
810             add(cExec, varName, cconv);
811 
812             add(jExecParm, jtype, varName, randomVal);
813             //jExecOut.add(new PairString(jconv,varName,jtype));
814             add(jExecOut, jconv, varName, jtype);
815         }
816 
817     }
818 
819     public ParameterList getCExec() {
820         return cExec;
821     }
822 
823     public ParameterList getCParm() {
824         return cParms;
825     }
826 
827     //Return generated java text
828     public ParameterList getJExecParameters() {
829         return jExecParm;
830     }
831 
832     public ParameterList getJExecOut() {
833         return jExecOut;
834     }
835 
836     /*
837      * Return string containing parameters for Java
838      */
839     public ParameterList getJParm() {
840         return jParms;
841     }
842 
843     public ParameterList getRParm() {
844         return rParms;
845     }
846 
847     private void generateTypeList(ParamType paramType) {
848         list.addAll(paramType.getValue());
849     }
850 }
851 
852 class SrcGenerator {
853 
854     ParameterListGenerator parmListGen;
855     GeneratorLogic genLogic;
856     int iterationCounter;
857     int parametersCounter;
858     ParamType paramType;
859     TestType testType;
860     String fncName;
861     //SrcGenerator g1=new SrcGenerator(3,1,ParamType.MIXED_DFIB,TestType.RANDOM,&quot;callRandom&quot;);
862     int maxLength;
863 
864     public SrcGenerator(int parmCounter, int iterCounter, ParamType parType, TestType testType, String fncName, int maxLength) {
865         this.maxLength = maxLength;
866         parametersCounter = parmCounter;
867         iterationCounter = iterCounter;
868         paramType = parType;
869         this.testType = testType;
870         this.fncName = fncName;
871         parmListGen = new ParameterListGenerator(parametersCounter, paramType);
872         genLogic = testType.getLogic();
873 
874     }
875 
876     public String getFncName() {
877         return fncName;
878     }
879 
880     public ParameterList getJParm() {
881         return parmListGen.getJParm();
882     }
883 
884     public ParameterList getCParm() {
885         return parmListGen.getCParm();
886     }
887 
888     public String getCExec() {
889 
890         StringBuilder sb = new StringBuilder();
891         for (ParameterItem p : parmListGen.getCExec().getList()) {
892             sb.append(&quot;fprintf(file,\&quot;&quot;);
893             sb.append(p.value1);
894             sb.append(&quot;=&quot;);
895             sb.append(p.value2);
896             sb.append(&quot;\\n\&quot;,&quot;);
897             sb.append(p.value1);
898             sb.append(&quot;);\n&quot;);
899         }
900         return sb.toString();
901     }
902 
903     public String getCExec(int maxLength,String prefix) {
904 
905         int lineLength = 0;
906         StringBuilder sb = new StringBuilder();
907         for (ParameterItem p : parmListGen.getCExec().getList()) {
908             sb.append(&quot;fprintf(file,\&quot;&quot;);
909             sb.append(p.value1);
910             sb.append(&quot;=&quot;);
911             sb.append(p.value2);
912             sb.append(&quot;\\n\&quot;,&quot;);
913             sb.append(p.value1);
914             sb.append(&quot;);&quot;);
915             if (sb.length() - lineLength &gt; maxLength) {
916                 lineLength = sb.length();
917                 sb.append(&quot;\n&quot;).append(prefix);
918             }
919         }
920         return sb.toString();
921     }
922 
923     public String getJExec(String prefix) {
924         return genLogic.generateJava(fncName, parmListGen.getJExecOut(), parmListGen.getJExecParameters(), maxLength, prefix);
925 
926     }
927 }
<a name="4" id="anc4"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="4" type="hidden" />
</body>
</html>