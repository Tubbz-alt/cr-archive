<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/vm/mlvm/share/Env.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../meth/stress/java/sequences/Test.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="MlvmTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/vm/mlvm/share/Env.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 package vm.mlvm.share;
 25 
 26 import java.util.Random;

 27 
 28 import nsk.share.ArgumentParser;
 29 import nsk.share.Log;
 30 import nsk.share.Log.TraceLevel;
 31 import nsk.share.test.LazyFormatString;
 32 
 33 public class Env {
 34 
 35     private static class StaticHolder {
 36         public static ArgumentParser argParser;
 37         public static Log log;
 38         static {
 39             init(new String[0]);
 40         }
 41 
 42         public static void init(String... args) {
 43             init(new IgnoreUnknownArgumentParser(args));
 44         }
 45 
 46         public static void init(ArgumentParser ap) {
</pre>
<hr />
<pre>
 52     public static ArgumentParser getArgParser() {
 53         return StaticHolder.argParser;
 54     }
 55 
 56     public static Log getLog() {
 57         return StaticHolder.log;
 58     }
 59 
 60     public static void init(String... args) {
 61         StaticHolder.init(args);
 62     }
 63 
 64     public static void init(ArgumentParser ap) {
 65         StaticHolder.init(ap);
 66     }
 67 
 68     //
 69     // RNG
 70     //
 71 
<span class="line-modified"> 72     private static long _seed = new Random().nextLong();</span>
<span class="line-removed"> 73 </span>
<span class="line-removed"> 74     public static void setRNGSeed(long seed) {</span>
<span class="line-removed"> 75         _seed = seed;</span>
<span class="line-removed"> 76     }</span>
 77 
 78     private static volatile boolean _wasSeedPrinted = false;
 79 
 80     // Thread local variable containing each thread&#39;s ID
 81     private static final ThreadLocal&lt;Random&gt; _threadRNG =
 82         new ThreadLocal&lt;Random&gt;() {
 83             @Override protected Random initialValue() {
 84                 if ( ! _wasSeedPrinted ) {
 85                     _wasSeedPrinted = true;
 86                     traceImportant(&quot;RNG seed = &quot; + _seed + &quot; (0x&quot; + Long.toHexString(_seed) + &quot;)&quot;);


 87                 }
 88 
 89                 long seed = _seed;
 90                 String name = Thread.currentThread().getName();
 91                 for ( int n = 0; n &lt; name.length(); n++ )
 92                     seed ^= name.charAt(n) &lt;&lt; ((n % 7) * 8);
 93 
 94                 traceVerbose(Thread.currentThread() + &quot; RNG seed = &quot; + seed + &quot; (0x&quot; + Long.toHexString(seed) + &quot;)&quot;);
 95 
 96                 return new Random(seed);
 97             }
 98         };
 99 
100     public static Random getRNG() {
101         return _threadRNG.get();
102     }
103 
104     //
105     // Syntactic sugar
106     //
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 package vm.mlvm.share;
 25 
 26 import java.util.Random;
<span class="line-added"> 27 import jdk.test.lib.Utils;</span>
 28 
 29 import nsk.share.ArgumentParser;
 30 import nsk.share.Log;
 31 import nsk.share.Log.TraceLevel;
 32 import nsk.share.test.LazyFormatString;
 33 
 34 public class Env {
 35 
 36     private static class StaticHolder {
 37         public static ArgumentParser argParser;
 38         public static Log log;
 39         static {
 40             init(new String[0]);
 41         }
 42 
 43         public static void init(String... args) {
 44             init(new IgnoreUnknownArgumentParser(args));
 45         }
 46 
 47         public static void init(ArgumentParser ap) {
</pre>
<hr />
<pre>
 53     public static ArgumentParser getArgParser() {
 54         return StaticHolder.argParser;
 55     }
 56 
 57     public static Log getLog() {
 58         return StaticHolder.log;
 59     }
 60 
 61     public static void init(String... args) {
 62         StaticHolder.init(args);
 63     }
 64 
 65     public static void init(ArgumentParser ap) {
 66         StaticHolder.init(ap);
 67     }
 68 
 69     //
 70     // RNG
 71     //
 72 
<span class="line-modified"> 73     private static long _seed = Utils.SEED;</span>




 74 
 75     private static volatile boolean _wasSeedPrinted = false;
 76 
 77     // Thread local variable containing each thread&#39;s ID
 78     private static final ThreadLocal&lt;Random&gt; _threadRNG =
 79         new ThreadLocal&lt;Random&gt;() {
 80             @Override protected Random initialValue() {
 81                 if ( ! _wasSeedPrinted ) {
 82                     _wasSeedPrinted = true;
 83                     traceImportant(&quot;RNG seed = &quot; + _seed + &quot; (0x&quot; + Long.toHexString(_seed) + &quot;)&quot;);
<span class="line-added"> 84                     // ensure we also print out how to change seed</span>
<span class="line-added"> 85                     Utils.getRandomInstance();</span>
 86                 }
 87 
 88                 long seed = _seed;
 89                 String name = Thread.currentThread().getName();
 90                 for ( int n = 0; n &lt; name.length(); n++ )
 91                     seed ^= name.charAt(n) &lt;&lt; ((n % 7) * 8);
 92 
 93                 traceVerbose(Thread.currentThread() + &quot; RNG seed = &quot; + seed + &quot; (0x&quot; + Long.toHexString(seed) + &quot;)&quot;);
 94 
 95                 return new Random(seed);
 96             }
 97         };
 98 
 99     public static Random getRNG() {
100         return _threadRNG.get();
101     }
102 
103     //
104     // Syntactic sugar
105     //
</pre>
</td>
</tr>
</table>
<center><a href="../meth/stress/java/sequences/Test.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="MlvmTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>