<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/nsk/share/test/LocalRandom.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../runner/RunParams.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../sysdict/share/SysDictTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/share/test/LocalRandom.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2007, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 package nsk.share.test;
 25 
<span class="line-modified"> 26 import java.util.concurrent.ThreadLocalRandom;</span>

 27 import nsk.share.TestFailure;
 28 
 29 /**
 30  * Utility class which encapsulates all useful static methods.
 31  */
 32 public class LocalRandom {












 33     private static int minPauseTime = 3000;
 34     private static int maxPauseTime = 5000;
 35     private static int maxRandomCount = 65536;
 36 









 37     /*
 38      * Return next random double number.
 39      *
 40      * @return random double
 41      */
 42     public static double random() {
<span class="line-modified"> 43         return ThreadLocalRandom.current().nextDouble();</span>
 44     }
 45 
 46     public static double nextDouble() {
<span class="line-modified"> 47         return ThreadLocalRandom.current().nextDouble();</span>
 48     }
 49 
 50     public static byte nextByte() {
 51         return (byte) nextInt(Byte.MIN_VALUE, Byte.MAX_VALUE);
 52     }
 53 
 54     public static char nextChar() {
 55         return (char) nextInt(Character.MIN_VALUE, Character.MAX_VALUE);
 56     }
 57 
 58     public static short nextShort() {
 59         return (short) nextInt(Short.MIN_VALUE, Short.MAX_VALUE);
 60     }
 61 
 62     public static boolean nextBoolean() {
<span class="line-modified"> 63         return ThreadLocalRandom.current().nextBoolean();</span>
 64     }
 65 
 66     public static void nextBytes(byte[] arr) {
 67         if (arr.length == 0) {
 68             return;
 69         }
 70         int k = Math.max(1, arr.length / maxRandomCount);
 71         byte hash = 0;
 72         byte b;
 73         for (int i = 0; i &lt; arr.length - k; i += k) {
 74             b = nextByte();
 75             arr[i] = b;
 76             hash ^= b;
 77         }
 78         arr[arr.length - k] = hash;
 79     }
 80 
 81     public static void validate(byte[] arr) {
 82         int k = Math.max(1, arr.length / maxRandomCount);
 83         byte hash = 0;
</pre>
<hr />
<pre>
235         }
236     }
237 
238     public static void validate(float[] arr) {
239     }
240 
241     public static void nextDoubles(double[] arr) {
242         if (arr.length == 0) {
243             return;
244         }
245         int k = Math.max(1, arr.length / maxRandomCount);
246         for (int i = 0; i &lt; arr.length - k; i += k) {
247             arr[i] = nextDouble();
248         }
249     }
250 
251     public static void validate(double[] arr) {
252     }
253 
254     public static int nextInt() {
<span class="line-modified">255         return ThreadLocalRandom.current().nextInt();</span>
256     }
257 
258     /**
259      * Return next integer value from 0..n range.
260      *
261      * @param n maximum value
262      * @return random integer
263      */
264     public static int nextInt(int n) {
<span class="line-modified">265         return ThreadLocalRandom.current().nextInt(n);</span>
266     }
267 
268     public static long nextLong() {
<span class="line-modified">269         return ThreadLocalRandom.current().nextLong();</span>
270     }
271 
272     /**
273      * Return next random integer from min..max range.
274      *
275      * @param min minimum value
276      * @param max maximum value
277      * @return random integer
278      */
279     public static int nextInt(int min, int max) {
280         return min + nextInt(max - min);
281     }
282 
283     /**
284      * Return next random float number.
285      *
286      * @return random double
287      */
288     public static float nextFloat() {
<span class="line-modified">289         return ThreadLocalRandom.current().nextFloat();</span>
290     }
291 
292     /**
293      * Return random pause time.
294      */
295     public static long randomPauseTime() {
296         return nextInt(minPauseTime, maxPauseTime);
297     }
298 
299     /**
300      * Set minimum pause time.
301      *
302      * @param minPauseTime minimum pause time
303      */
304     public static void setMinPauseTime(int minPauseTime) {
305         LocalRandom.minPauseTime = minPauseTime;
306     }
307 
308     /**
309      * Set maximum pause time.
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2007, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 package nsk.share.test;
 25 
<span class="line-modified"> 26 import java.util.Random;</span>
<span class="line-added"> 27 import jdk.test.lib.Utils;</span>
 28 import nsk.share.TestFailure;
 29 
 30 /**
 31  * Utility class which encapsulates all useful static methods.
 32  */
 33 public class LocalRandom {
<span class="line-added"> 34     static {</span>
<span class="line-added"> 35         // ensure seed got printed out</span>
<span class="line-added"> 36         Utils.getRandomInstance();</span>
<span class="line-added"> 37     }</span>
<span class="line-added"> 38     private final static ThreadLocal&lt;Random&gt; random = new ThreadLocal&lt;&gt;() {</span>
<span class="line-added"> 39         protected Random initialValue() {</span>
<span class="line-added"> 40             // each thread gets its own seed independendly on the order they</span>
<span class="line-added"> 41             // use LocalRandom, yet it depends on the order threads are created.</span>
<span class="line-added"> 42             // main thread uses original seed</span>
<span class="line-added"> 43             return new Random(Utils.SEED ^ (Thread.currentThread().getId() - 1));</span>
<span class="line-added"> 44         }</span>
<span class="line-added"> 45     };</span>
 46     private static int minPauseTime = 3000;
 47     private static int maxPauseTime = 5000;
 48     private static int maxRandomCount = 65536;
 49 
<span class="line-added"> 50 </span>
<span class="line-added"> 51     /*</span>
<span class="line-added"> 52      * Initializes a thread-local instance to ensure that there is enough memory.</span>
<span class="line-added"> 53      * Useful for tests that exhaust memory.</span>
<span class="line-added"> 54      */</span>
<span class="line-added"> 55     public static void init() {</span>
<span class="line-added"> 56         random.get();</span>
<span class="line-added"> 57     }</span>
<span class="line-added"> 58 </span>
 59     /*
 60      * Return next random double number.
 61      *
 62      * @return random double
 63      */
 64     public static double random() {
<span class="line-modified"> 65         return random.get().nextDouble();</span>
 66     }
 67 
 68     public static double nextDouble() {
<span class="line-modified"> 69         return random.get().nextDouble();</span>
 70     }
 71 
 72     public static byte nextByte() {
 73         return (byte) nextInt(Byte.MIN_VALUE, Byte.MAX_VALUE);
 74     }
 75 
 76     public static char nextChar() {
 77         return (char) nextInt(Character.MIN_VALUE, Character.MAX_VALUE);
 78     }
 79 
 80     public static short nextShort() {
 81         return (short) nextInt(Short.MIN_VALUE, Short.MAX_VALUE);
 82     }
 83 
 84     public static boolean nextBoolean() {
<span class="line-modified"> 85         return random.get().nextBoolean();</span>
 86     }
 87 
 88     public static void nextBytes(byte[] arr) {
 89         if (arr.length == 0) {
 90             return;
 91         }
 92         int k = Math.max(1, arr.length / maxRandomCount);
 93         byte hash = 0;
 94         byte b;
 95         for (int i = 0; i &lt; arr.length - k; i += k) {
 96             b = nextByte();
 97             arr[i] = b;
 98             hash ^= b;
 99         }
100         arr[arr.length - k] = hash;
101     }
102 
103     public static void validate(byte[] arr) {
104         int k = Math.max(1, arr.length / maxRandomCount);
105         byte hash = 0;
</pre>
<hr />
<pre>
257         }
258     }
259 
260     public static void validate(float[] arr) {
261     }
262 
263     public static void nextDoubles(double[] arr) {
264         if (arr.length == 0) {
265             return;
266         }
267         int k = Math.max(1, arr.length / maxRandomCount);
268         for (int i = 0; i &lt; arr.length - k; i += k) {
269             arr[i] = nextDouble();
270         }
271     }
272 
273     public static void validate(double[] arr) {
274     }
275 
276     public static int nextInt() {
<span class="line-modified">277         return random.get().nextInt();</span>
278     }
279 
280     /**
281      * Return next integer value from 0..n range.
282      *
283      * @param n maximum value
284      * @return random integer
285      */
286     public static int nextInt(int n) {
<span class="line-modified">287         return random.get().nextInt(n);</span>
288     }
289 
290     public static long nextLong() {
<span class="line-modified">291         return random.get().nextLong();</span>
292     }
293 
294     /**
295      * Return next random integer from min..max range.
296      *
297      * @param min minimum value
298      * @param max maximum value
299      * @return random integer
300      */
301     public static int nextInt(int min, int max) {
302         return min + nextInt(max - min);
303     }
304 
305     /**
306      * Return next random float number.
307      *
308      * @return random double
309      */
310     public static float nextFloat() {
<span class="line-modified">311         return random.get().nextFloat();</span>
312     }
313 
314     /**
315      * Return random pause time.
316      */
317     public static long randomPauseTime() {
318         return nextInt(minPauseTime, maxPauseTime);
319     }
320 
321     /**
322      * Set minimum pause time.
323      *
324      * @param minPauseTime minimum pause time
325      */
326     public static void setMinPauseTime(int minPauseTime) {
327         LocalRandom.minPauseTime = minPauseTime;
328     }
329 
330     /**
331      * Set maximum pause time.
</pre>
</td>
</tr>
</table>
<center><a href="../runner/RunParams.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../sysdict/share/SysDictTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>