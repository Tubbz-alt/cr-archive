<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/hotspot/jtreg/serviceability/dcmd/vm/ClassLoaderStatsTest.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../gc/RunFinalizationTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../jvmti/CanGenerateAllClassHook/CanGenerateAllClassHook.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/serviceability/dcmd/vm/ClassLoaderStatsTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 59,20 ***</span>
  public class ClassLoaderStatsTest {
  
    // Expected output from VM.classloader_stats:
      // ClassLoader         Parent              CLD*               Classes   ChunkSz   BlockSz  Type
      // 0x0000000800bd3830  0x000000080037f468  0x00007f001c2ea170       1     10240      4672  ClassLoaderStatsTest$DummyClassLoader
<span class="line-modified">!     //                                                                  1      2048      1080   + unsafe anonymous classes</span>
<span class="line-removed">-     //                                                                  1      2048      1088   + hidden classes</span>
      // 0x0000000000000000  0x0000000000000000  0x00007f00e852d190    1607   4628480   3931216  &lt;boot class loader&gt;
      //                                                                 38    124928     85856   + hidden classes
      // 0x00000008003b5508  0x0000000000000000  0x00007f001c2d4760       1      6144      4040  jdk.internal.reflect.DelegatingClassLoader
      // 0x000000080037f468  0x000000080037ee80  0x00007f00e868e3f0     228   1368064   1286672  jdk.internal.loader.ClassLoaders$AppClassLoader
      // ...
  
      static Pattern clLine = Pattern.compile(&quot;0x\\p{XDigit}*\\s*0x\\p{XDigit}*\\s*0x\\p{XDigit}*\\s*(\\d*)\\s*(\\d*)\\s*(\\d*)\\s*(.*)&quot;);
<span class="line-modified">!     static Pattern anonLine = Pattern.compile(&quot;\\s*(\\d*)\\s*(\\d*)\\s*(\\d*)\\s*.*&quot;);</span>
  
      public static DummyClassLoader dummyloader;
  
      public void run(CommandExecutor executor) throws ClassNotFoundException {
  
<span class="line-new-header">--- 59,19 ---</span>
  public class ClassLoaderStatsTest {
  
    // Expected output from VM.classloader_stats:
      // ClassLoader         Parent              CLD*               Classes   ChunkSz   BlockSz  Type
      // 0x0000000800bd3830  0x000000080037f468  0x00007f001c2ea170       1     10240      4672  ClassLoaderStatsTest$DummyClassLoader
<span class="line-modified">!     //                                                                  2      2048      1088   + hidden classes</span>
      // 0x0000000000000000  0x0000000000000000  0x00007f00e852d190    1607   4628480   3931216  &lt;boot class loader&gt;
      //                                                                 38    124928     85856   + hidden classes
      // 0x00000008003b5508  0x0000000000000000  0x00007f001c2d4760       1      6144      4040  jdk.internal.reflect.DelegatingClassLoader
      // 0x000000080037f468  0x000000080037ee80  0x00007f00e868e3f0     228   1368064   1286672  jdk.internal.loader.ClassLoaders$AppClassLoader
      // ...
  
      static Pattern clLine = Pattern.compile(&quot;0x\\p{XDigit}*\\s*0x\\p{XDigit}*\\s*0x\\p{XDigit}*\\s*(\\d*)\\s*(\\d*)\\s*(\\d*)\\s*(.*)&quot;);
<span class="line-modified">!     static Pattern hiddenLine = Pattern.compile(&quot;\\s*(\\d*)\\s*(\\d*)\\s*(\\d*)\\s*.*&quot;);</span>
  
      public static DummyClassLoader dummyloader;
  
      public void run(CommandExecutor executor) throws ClassNotFoundException {
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 87,41 ***</span>
          Iterator&lt;String&gt; lines = output.asLines().iterator();
          while (lines.hasNext()) {
              String line = lines.next();
              Matcher m = clLine.matcher(line);
              if (m.matches()) {
<span class="line-modified">!                 // verify that DummyClassLoader has loaded 1 class, 1 anonymous class, and 1 hidden class</span>
                  if (m.group(4).equals(&quot;ClassLoaderStatsTest$DummyClassLoader&quot;)) {
                      System.out.println(&quot;DummyClassLoader line: &quot; + line);
                      if (!m.group(1).equals(&quot;1&quot;)) {
                          Assert.fail(&quot;Should have loaded 1 class: &quot; + line);
                      }
                      checkPositiveInt(m.group(2));
                      checkPositiveInt(m.group(3));
  
                      String next = lines.next();
                      System.out.println(&quot;DummyClassLoader next: &quot; + next);
<span class="line-removed">-                     if (!next.contains(&quot;unsafe anonymous classes&quot;)) {</span>
<span class="line-removed">-                         Assert.fail(&quot;Should have an anonymous class&quot;);</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     Matcher m1 = anonLine.matcher(next);</span>
<span class="line-removed">-                     m1.matches();</span>
<span class="line-removed">-                     if (!m1.group(1).equals(&quot;1&quot;)) {</span>
<span class="line-removed">-                         Assert.fail(&quot;Should have loaded 1 anonymous class, but found : &quot; + m1.group(1));</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     checkPositiveInt(m1.group(2));</span>
<span class="line-removed">-                     checkPositiveInt(m1.group(3));</span>
<span class="line-removed">- </span>
<span class="line-removed">-                     next = lines.next();</span>
<span class="line-removed">-                     System.out.println(&quot;DummyClassLoader next: &quot; + next);</span>
                      if (!next.contains(&quot;hidden classes&quot;)) {
                          Assert.fail(&quot;Should have a hidden class&quot;);
                      }
<span class="line-modified">!                     Matcher m2 = anonLine.matcher(next);</span>
                      m2.matches();
<span class="line-modified">!                     if (!m2.group(1).equals(&quot;1&quot;)) {</span>
<span class="line-modified">!                         Assert.fail(&quot;Should have loaded 1 hidden class, but found : &quot; + m2.group(1));</span>
                      }
                      checkPositiveInt(m2.group(2));
                      checkPositiveInt(m2.group(3));
                  }
              }
<span class="line-new-header">--- 86,29 ---</span>
          Iterator&lt;String&gt; lines = output.asLines().iterator();
          while (lines.hasNext()) {
              String line = lines.next();
              Matcher m = clLine.matcher(line);
              if (m.matches()) {
<span class="line-modified">!                 // verify that DummyClassLoader has loaded 1 regular class and 2 hidden classes</span>
                  if (m.group(4).equals(&quot;ClassLoaderStatsTest$DummyClassLoader&quot;)) {
                      System.out.println(&quot;DummyClassLoader line: &quot; + line);
                      if (!m.group(1).equals(&quot;1&quot;)) {
                          Assert.fail(&quot;Should have loaded 1 class: &quot; + line);
                      }
                      checkPositiveInt(m.group(2));
                      checkPositiveInt(m.group(3));
  
                      String next = lines.next();
                      System.out.println(&quot;DummyClassLoader next: &quot; + next);
                      if (!next.contains(&quot;hidden classes&quot;)) {
                          Assert.fail(&quot;Should have a hidden class&quot;);
                      }
<span class="line-modified">!                     Matcher m2 = hiddenLine.matcher(next);</span>
                      m2.matches();
<span class="line-modified">!                     if (!m2.group(1).equals(&quot;2&quot;)) {</span>
<span class="line-modified">!                         // anonymous classes are included in the hidden classes count.</span>
<span class="line-added">+                         Assert.fail(&quot;Should have loaded 2 hidden classes, but found : &quot; + m2.group(1));</span>
                      }
                      checkPositiveInt(m2.group(2));
                      checkPositiveInt(m2.group(3));
                  }
              }
</pre>
<center><a href="../gc/RunFinalizationTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../jvmti/CanGenerateAllClassHook/CanGenerateAllClassHook.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>