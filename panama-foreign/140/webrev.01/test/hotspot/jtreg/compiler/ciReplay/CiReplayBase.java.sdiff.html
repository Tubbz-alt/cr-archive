<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/compiler/ciReplay/CiReplayBase.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../cha/StrengthReduceInterfaceCall.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestClientVM.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/compiler/ciReplay/CiReplayBase.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
129         removeFromCurrentDirectoryStartingWith(&quot;replay&quot;);
130         removeFromCurrentDirectoryStartingWith(HS_ERR_NAME);
131         remove(TEST_CORE_FILE_NAME);
132         remove(REPLAY_FILE_NAME);
133     }
134 
135     public boolean generateReplay(boolean needCoreDump, String... vmopts) {
136         OutputAnalyzer crashOut;
137         String crashOutputString;
138         try {
139             List&lt;String&gt; options = new ArrayList&lt;&gt;();
140             options.addAll(Arrays.asList(REPLAY_GENERATION_OPTIONS));
141             options.addAll(Arrays.asList(vmopts));
142             options.add(needCoreDump ? ENABLE_COREDUMP_ON_CRASH : DISABLE_COREDUMP_ON_CRASH);
143             options.add(EmptyMain.class.getName());
144             if (needCoreDump) {
145                 crashOut = ProcessTools.executeProcess(getTestJavaCommandlineWithPrefix(
146                         RUN_SHELL_NO_LIMIT, options.toArray(new String[0])));
147             } else {
148                 crashOut = ProcessTools.executeProcess(ProcessTools.createJavaProcessBuilder(true,
<span class="line-modified">149                         options.toArray(new String[0])));</span>
150             }
151             crashOutputString = crashOut.getOutput();
152             Asserts.assertNotEquals(crashOut.getExitValue(), 0, &quot;Crash JVM exits gracefully&quot;);
153             Files.write(Paths.get(&quot;crash.out&quot;), crashOutputString.getBytes(),
154                     StandardOpenOption.CREATE, StandardOpenOption.WRITE,
155                     StandardOpenOption.TRUNCATE_EXISTING);
156         } catch (Throwable t) {
157             throw new Error(&quot;Can&#39;t create replay: &quot; + t, t);
158         }
159         if (needCoreDump) {
160             String coreFileLocation = getCoreFileLocation(crashOutputString);
161             if (coreFileLocation == null) {
162                 if (Platform.isOSX()) {
163                     File coresDir = new File(&quot;/cores&quot;);
164                     if (!coresDir.isDirectory() || !coresDir.canWrite()) {
165                         return false;
166                     }
167                 }
168                 throw new Error(&quot;Couldn&#39;t find core file location in: &#39;&quot; + crashOutputString + &quot;&#39;&quot;);
169             }
</pre>
</td>
<td>
<hr />
<pre>
129         removeFromCurrentDirectoryStartingWith(&quot;replay&quot;);
130         removeFromCurrentDirectoryStartingWith(HS_ERR_NAME);
131         remove(TEST_CORE_FILE_NAME);
132         remove(REPLAY_FILE_NAME);
133     }
134 
135     public boolean generateReplay(boolean needCoreDump, String... vmopts) {
136         OutputAnalyzer crashOut;
137         String crashOutputString;
138         try {
139             List&lt;String&gt; options = new ArrayList&lt;&gt;();
140             options.addAll(Arrays.asList(REPLAY_GENERATION_OPTIONS));
141             options.addAll(Arrays.asList(vmopts));
142             options.add(needCoreDump ? ENABLE_COREDUMP_ON_CRASH : DISABLE_COREDUMP_ON_CRASH);
143             options.add(EmptyMain.class.getName());
144             if (needCoreDump) {
145                 crashOut = ProcessTools.executeProcess(getTestJavaCommandlineWithPrefix(
146                         RUN_SHELL_NO_LIMIT, options.toArray(new String[0])));
147             } else {
148                 crashOut = ProcessTools.executeProcess(ProcessTools.createJavaProcessBuilder(true,
<span class="line-modified">149                         options));</span>
150             }
151             crashOutputString = crashOut.getOutput();
152             Asserts.assertNotEquals(crashOut.getExitValue(), 0, &quot;Crash JVM exits gracefully&quot;);
153             Files.write(Paths.get(&quot;crash.out&quot;), crashOutputString.getBytes(),
154                     StandardOpenOption.CREATE, StandardOpenOption.WRITE,
155                     StandardOpenOption.TRUNCATE_EXISTING);
156         } catch (Throwable t) {
157             throw new Error(&quot;Can&#39;t create replay: &quot; + t, t);
158         }
159         if (needCoreDump) {
160             String coreFileLocation = getCoreFileLocation(crashOutputString);
161             if (coreFileLocation == null) {
162                 if (Platform.isOSX()) {
163                     File coresDir = new File(&quot;/cores&quot;);
164                     if (!coresDir.isDirectory() || !coresDir.canWrite()) {
165                         return false;
166                     }
167                 }
168                 throw new Error(&quot;Couldn&#39;t find core file location in: &#39;&quot; + crashOutputString + &quot;&#39;&quot;);
169             }
</pre>
</td>
</tr>
</table>
<center><a href="../cha/StrengthReduceInterfaceCall.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestClientVM.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>