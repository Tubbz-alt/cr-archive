<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/compiler/c2/cr6340864/TestFloatVect.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="TestDoubleVect.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../cr6589834/Test_ia32.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/compiler/c2/cr6340864/TestFloatVect.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 70       test_sum(a1);
 71       test_addc(a0, a1);
 72       test_addv(a0, a1, VALUE);
 73       test_adda(a0, a1, a2);
 74       test_subc(a0, a1);
 75       test_subv(a0, a1, VALUE);
 76       test_suba(a0, a1, a2);
 77       test_mulc(a0, a1);
 78       test_mulv(a0, a1, VALUE);
 79       test_mula(a0, a1, a2);
 80       test_divc(a0, a1);
 81       test_divv(a0, a1, VALUE);
 82       test_diva(a0, a1, a2);
 83       test_mulc_n(a0, a1);
 84       test_mulv(a0, a1, -VALUE);
 85       test_mula(a0, a1, a3);
 86       test_divc_n(a0, a1);
 87       test_divv(a0, a1, -VALUE);
 88       test_diva(a0, a1, a3);
 89       test_negc(a0, a1);

 90     }
 91     // Test and verify results
 92     System.out.println(&quot;Verification&quot;);
 93     int errn = 0;
 94     {
 95       float sum = test_sum(a1);
 96       if (sum != gold_sum) {
 97         System.err.println(&quot;test_sum:  &quot; + sum + &quot; != &quot; + gold_sum);
 98         errn++;
 99       }
100       // Overwrite with NaN values
101       a1[0] = Float.NaN;
102       a1[1] = Float.POSITIVE_INFINITY;
103       a1[2] = Float.NEGATIVE_INFINITY;
104       a1[3] = Float.MAX_VALUE;
105       a1[4] = Float.MIN_VALUE;
106       a1[5] = Float.MIN_NORMAL;
107 
108       a2[6] = a1[0];
109       a2[7] = a1[1];
</pre>
<hr />
<pre>
335       errn += verify(&quot;test_diva_n: &quot;, 7, a0[7], ((ADD_INIT+7)/(-Float.POSITIVE_INFINITY)));
336       errn += verify(&quot;test_diva_n: &quot;, 8, a0[8], ((ADD_INIT+8)/(-Float.NEGATIVE_INFINITY)));
337       errn += verify(&quot;test_diva_n: &quot;, 9, a0[9], ((ADD_INIT+9)/(-Float.MAX_VALUE)));
338       errn += verify(&quot;test_diva_n: &quot;, 10, a0[10], ((ADD_INIT+10)/(-Float.MIN_VALUE)));
339       errn += verify(&quot;test_diva_n: &quot;, 11, a0[11], ((ADD_INIT+11)/(-Float.MIN_NORMAL)));
340       for (int i=12; i&lt;ARRLEN; i++) {
341         errn += verify(&quot;test_diva_n: &quot;, i, a0[i], ((ADD_INIT+i)/(-VALUE)));
342       }
343 
344       test_negc(a0, a1);
345       errn += verify(&quot;test_negc: &quot;, 0, a0[0], (Float.NaN));
346       errn += verify(&quot;test_negc: &quot;, 1, a0[1], (Float.NEGATIVE_INFINITY));
347       errn += verify(&quot;test_negc: &quot;, 2, a0[2], (Float.POSITIVE_INFINITY));
348       errn += verify(&quot;test_negc: &quot;, 3, a0[3], (float)(-Float.MAX_VALUE));
349       errn += verify(&quot;test_negc: &quot;, 4, a0[4], (float)(-Float.MIN_VALUE));
350       errn += verify(&quot;test_negc: &quot;, 5, a0[5], (float)(-Float.MIN_NORMAL));
351       for (int i=6; i&lt;ARRLEN; i++) {
352         errn += verify(&quot;test_negc: &quot;, i, a0[i], (float)(-((float)(ADD_INIT+i))));
353       }
354 
















355     }
356 
357     if (errn &gt; 0)
358       return errn;
359 
360     System.out.println(&quot;Time&quot;);
361     long start, end;
362 
363     start = System.currentTimeMillis();
364     for (int i=0; i&lt;ITERS; i++) {
365       test_sum(a1);
366     }
367     end = System.currentTimeMillis();
368     System.out.println(&quot;test_sum: &quot; + (end - start));
369 
370     start = System.currentTimeMillis();
371     for (int i=0; i&lt;ITERS; i++) {
372       test_addc(a0, a1);
373     }
374     end = System.currentTimeMillis();
</pre>
<hr />
<pre>
471     start = System.currentTimeMillis();
472     for (int i=0; i&lt;ITERS; i++) {
473       test_divv(a0, a1, -VALUE);
474     }
475     end = System.currentTimeMillis();
476     System.out.println(&quot;test_divv_n: &quot; + (end - start));
477     start = System.currentTimeMillis();
478     for (int i=0; i&lt;ITERS; i++) {
479       test_diva(a0, a1, a3);
480     }
481     end = System.currentTimeMillis();
482     System.out.println(&quot;test_diva_n: &quot; + (end - start));
483 
484     start = System.currentTimeMillis();
485     for (int i=0; i&lt;ITERS; i++) {
486       test_negc(a0, a1);
487     }
488     end = System.currentTimeMillis();
489     System.out.println(&quot;test_negc_n: &quot; + (end - start));
490 







491     return errn;
492   }
493 
494   static float test_sum(float[] a1) {
495     float sum = 0;
496     for (int i = 0; i &lt; a1.length; i+=1) {
497       sum += a1[i];
498     }
499     return sum;
500   }
501 
502   static void test_addc(float[] a0, float[] a1) {
503     for (int i = 0; i &lt; a0.length; i+=1) {
504       a0[i] = (a1[i]+VALUE);
505     }
506   }
507   static void test_addv(float[] a0, float[] a1, float b) {
508     for (int i = 0; i &lt; a0.length; i+=1) {
509       a0[i] = (a1[i]+b);
510     }
</pre>
<hr />
<pre>
562       a0[i] = (a1[i]/(-VALUE));
563     }
564   }
565   static void test_divv(float[] a0, float[] a1, float b) {
566     for (int i = 0; i &lt; a0.length; i+=1) {
567       a0[i] = (a1[i]/b);
568     }
569   }
570   static void test_diva(float[] a0, float[] a1, float[] a2) {
571     for (int i = 0; i &lt; a0.length; i+=1) {
572       a0[i] = (a1[i]/a2[i]);
573     }
574   }
575 
576   static void test_negc(float[] a0, float[] a1) {
577     for (int i = 0; i &lt; a0.length; i+=1) {
578       a0[i] = (float)(-((float)a1[i]));
579     }
580   }
581 






582   static int verify(String text, int i, float elem, float val) {
583     if (elem != val &amp;&amp; !(Float.isNaN(elem) &amp;&amp; Float.isNaN(val))) {
584       System.err.println(text + &quot;[&quot; + i + &quot;] = &quot; + elem + &quot; != &quot; + val);
585       return 1;
586     }
587     return 0;
588   }
589 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 70       test_sum(a1);
 71       test_addc(a0, a1);
 72       test_addv(a0, a1, VALUE);
 73       test_adda(a0, a1, a2);
 74       test_subc(a0, a1);
 75       test_subv(a0, a1, VALUE);
 76       test_suba(a0, a1, a2);
 77       test_mulc(a0, a1);
 78       test_mulv(a0, a1, VALUE);
 79       test_mula(a0, a1, a2);
 80       test_divc(a0, a1);
 81       test_divv(a0, a1, VALUE);
 82       test_diva(a0, a1, a2);
 83       test_mulc_n(a0, a1);
 84       test_mulv(a0, a1, -VALUE);
 85       test_mula(a0, a1, a3);
 86       test_divc_n(a0, a1);
 87       test_divv(a0, a1, -VALUE);
 88       test_diva(a0, a1, a3);
 89       test_negc(a0, a1);
<span class="line-added"> 90       test_sqrt(a0, a1);</span>
 91     }
 92     // Test and verify results
 93     System.out.println(&quot;Verification&quot;);
 94     int errn = 0;
 95     {
 96       float sum = test_sum(a1);
 97       if (sum != gold_sum) {
 98         System.err.println(&quot;test_sum:  &quot; + sum + &quot; != &quot; + gold_sum);
 99         errn++;
100       }
101       // Overwrite with NaN values
102       a1[0] = Float.NaN;
103       a1[1] = Float.POSITIVE_INFINITY;
104       a1[2] = Float.NEGATIVE_INFINITY;
105       a1[3] = Float.MAX_VALUE;
106       a1[4] = Float.MIN_VALUE;
107       a1[5] = Float.MIN_NORMAL;
108 
109       a2[6] = a1[0];
110       a2[7] = a1[1];
</pre>
<hr />
<pre>
336       errn += verify(&quot;test_diva_n: &quot;, 7, a0[7], ((ADD_INIT+7)/(-Float.POSITIVE_INFINITY)));
337       errn += verify(&quot;test_diva_n: &quot;, 8, a0[8], ((ADD_INIT+8)/(-Float.NEGATIVE_INFINITY)));
338       errn += verify(&quot;test_diva_n: &quot;, 9, a0[9], ((ADD_INIT+9)/(-Float.MAX_VALUE)));
339       errn += verify(&quot;test_diva_n: &quot;, 10, a0[10], ((ADD_INIT+10)/(-Float.MIN_VALUE)));
340       errn += verify(&quot;test_diva_n: &quot;, 11, a0[11], ((ADD_INIT+11)/(-Float.MIN_NORMAL)));
341       for (int i=12; i&lt;ARRLEN; i++) {
342         errn += verify(&quot;test_diva_n: &quot;, i, a0[i], ((ADD_INIT+i)/(-VALUE)));
343       }
344 
345       test_negc(a0, a1);
346       errn += verify(&quot;test_negc: &quot;, 0, a0[0], (Float.NaN));
347       errn += verify(&quot;test_negc: &quot;, 1, a0[1], (Float.NEGATIVE_INFINITY));
348       errn += verify(&quot;test_negc: &quot;, 2, a0[2], (Float.POSITIVE_INFINITY));
349       errn += verify(&quot;test_negc: &quot;, 3, a0[3], (float)(-Float.MAX_VALUE));
350       errn += verify(&quot;test_negc: &quot;, 4, a0[4], (float)(-Float.MIN_VALUE));
351       errn += verify(&quot;test_negc: &quot;, 5, a0[5], (float)(-Float.MIN_NORMAL));
352       for (int i=6; i&lt;ARRLEN; i++) {
353         errn += verify(&quot;test_negc: &quot;, i, a0[i], (float)(-((float)(ADD_INIT+i))));
354       }
355 
<span class="line-added">356       // Overwrite with +0.0/-0.0 values</span>
<span class="line-added">357       a1[6] = (float)0.0;</span>
<span class="line-added">358       a1[7] = (float)-0.0;</span>
<span class="line-added">359       test_sqrt(a0, a1);</span>
<span class="line-added">360       errn += verify(&quot;test_sqrt: &quot;, 0, a0[0], (Float.NaN));</span>
<span class="line-added">361       errn += verify(&quot;test_sqrt: &quot;, 1, a0[1], (Float.POSITIVE_INFINITY));</span>
<span class="line-added">362       errn += verify(&quot;test_sqrt: &quot;, 2, a0[2], (Float.NaN));</span>
<span class="line-added">363       errn += verify(&quot;test_sqrt: &quot;, 3, a0[3], (float)(Math.sqrt((double)Float.MAX_VALUE)));</span>
<span class="line-added">364       errn += verify(&quot;test_sqrt: &quot;, 4, a0[4], (float)(Math.sqrt((double)Float.MIN_VALUE)));</span>
<span class="line-added">365       errn += verify(&quot;test_sqrt: &quot;, 5, a0[5], (float)(Math.sqrt((double)Float.MIN_NORMAL)));</span>
<span class="line-added">366       errn += verify(&quot;test_sqrt: &quot;, 6, a0[6], (float)0.0);</span>
<span class="line-added">367       errn += verify(&quot;test_sqrt: &quot;, 7, a0[7], (float)-0.0);</span>
<span class="line-added">368       for (int i=8; i&lt;ARRLEN; i++) {</span>
<span class="line-added">369         errn += verify(&quot;test_sqrt: &quot;, i, a0[i], (float)(Math.sqrt((double)(ADD_INIT+i))));</span>
<span class="line-added">370       }</span>
<span class="line-added">371 </span>
372     }
373 
374     if (errn &gt; 0)
375       return errn;
376 
377     System.out.println(&quot;Time&quot;);
378     long start, end;
379 
380     start = System.currentTimeMillis();
381     for (int i=0; i&lt;ITERS; i++) {
382       test_sum(a1);
383     }
384     end = System.currentTimeMillis();
385     System.out.println(&quot;test_sum: &quot; + (end - start));
386 
387     start = System.currentTimeMillis();
388     for (int i=0; i&lt;ITERS; i++) {
389       test_addc(a0, a1);
390     }
391     end = System.currentTimeMillis();
</pre>
<hr />
<pre>
488     start = System.currentTimeMillis();
489     for (int i=0; i&lt;ITERS; i++) {
490       test_divv(a0, a1, -VALUE);
491     }
492     end = System.currentTimeMillis();
493     System.out.println(&quot;test_divv_n: &quot; + (end - start));
494     start = System.currentTimeMillis();
495     for (int i=0; i&lt;ITERS; i++) {
496       test_diva(a0, a1, a3);
497     }
498     end = System.currentTimeMillis();
499     System.out.println(&quot;test_diva_n: &quot; + (end - start));
500 
501     start = System.currentTimeMillis();
502     for (int i=0; i&lt;ITERS; i++) {
503       test_negc(a0, a1);
504     }
505     end = System.currentTimeMillis();
506     System.out.println(&quot;test_negc_n: &quot; + (end - start));
507 
<span class="line-added">508     start = System.currentTimeMillis();</span>
<span class="line-added">509     for (int i=0; i&lt;ITERS; i++) {</span>
<span class="line-added">510       test_sqrt(a0, a1);</span>
<span class="line-added">511     }</span>
<span class="line-added">512     end = System.currentTimeMillis();</span>
<span class="line-added">513     System.out.println(&quot;test_sqrt_n: &quot; + (end - start));</span>
<span class="line-added">514 </span>
515     return errn;
516   }
517 
518   static float test_sum(float[] a1) {
519     float sum = 0;
520     for (int i = 0; i &lt; a1.length; i+=1) {
521       sum += a1[i];
522     }
523     return sum;
524   }
525 
526   static void test_addc(float[] a0, float[] a1) {
527     for (int i = 0; i &lt; a0.length; i+=1) {
528       a0[i] = (a1[i]+VALUE);
529     }
530   }
531   static void test_addv(float[] a0, float[] a1, float b) {
532     for (int i = 0; i &lt; a0.length; i+=1) {
533       a0[i] = (a1[i]+b);
534     }
</pre>
<hr />
<pre>
586       a0[i] = (a1[i]/(-VALUE));
587     }
588   }
589   static void test_divv(float[] a0, float[] a1, float b) {
590     for (int i = 0; i &lt; a0.length; i+=1) {
591       a0[i] = (a1[i]/b);
592     }
593   }
594   static void test_diva(float[] a0, float[] a1, float[] a2) {
595     for (int i = 0; i &lt; a0.length; i+=1) {
596       a0[i] = (a1[i]/a2[i]);
597     }
598   }
599 
600   static void test_negc(float[] a0, float[] a1) {
601     for (int i = 0; i &lt; a0.length; i+=1) {
602       a0[i] = (float)(-((float)a1[i]));
603     }
604   }
605 
<span class="line-added">606   static void test_sqrt(float[] a0, float[] a1) {</span>
<span class="line-added">607     for (int i = 0; i &lt; a0.length; i+=1) {</span>
<span class="line-added">608       a0[i] = (float)(Math.sqrt((double)a1[i]));</span>
<span class="line-added">609     }</span>
<span class="line-added">610   }</span>
<span class="line-added">611 </span>
612   static int verify(String text, int i, float elem, float val) {
613     if (elem != val &amp;&amp; !(Float.isNaN(elem) &amp;&amp; Float.isNaN(val))) {
614       System.err.println(text + &quot;[&quot; + i + &quot;] = &quot; + elem + &quot; != &quot; + val);
615       return 1;
616     }
617     return 0;
618   }
619 }
</pre>
</td>
</tr>
</table>
<center><a href="TestDoubleVect.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../cr6589834/Test_ia32.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>