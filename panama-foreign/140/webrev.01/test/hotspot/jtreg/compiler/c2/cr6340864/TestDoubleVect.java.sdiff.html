<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/compiler/c2/cr6340864/TestDoubleVect.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../TestUseOptoBiasInliningWithoutEliminateLocks.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TestFloatVect.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/compiler/c2/cr6340864/TestDoubleVect.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 73       test_adda(a0, a1, a2);
 74       test_subc(a0, a1);
 75       test_subv(a0, a1, VALUE);
 76       test_suba(a0, a1, a2);
 77       test_mulc(a0, a1);
 78       test_mulv(a0, a1, VALUE);
 79       test_mula(a0, a1, a2);
 80       test_divc(a0, a1);
 81       test_divv(a0, a1, VALUE);
 82       test_diva(a0, a1, a2);
 83       test_mulc_n(a0, a1);
 84       test_mulv(a0, a1, -VALUE);
 85       test_mula(a0, a1, a3);
 86       test_divc_n(a0, a1);
 87       test_divv(a0, a1, -VALUE);
 88       test_diva(a0, a1, a3);
 89       test_negc(a0, a1);
 90       test_rint(a0, a1);
 91       test_ceil(a0, a1);
 92       test_floor(a0, a1);

 93     }
 94     // Test and verify results
 95     System.out.println(&quot;Verification&quot;);
 96     int errn = 0;
 97     {
 98       double sum = test_sum(a1);
 99       if (sum != gold_sum) {
100         System.err.println(&quot;test_sum:  &quot; + sum + &quot; != &quot; + gold_sum);
101         errn++;
102       }
103       // Overwrite with NaN values
104       a1[0] = Double.NaN;
105       a1[1] = Double.POSITIVE_INFINITY;
106       a1[2] = Double.NEGATIVE_INFINITY;
107       a1[3] = Double.MAX_VALUE;
108       a1[4] = Double.MIN_VALUE;
109       a1[5] = Double.MIN_NORMAL;
110 
111       a2[6] = a1[0];
112       a2[7] = a1[1];
</pre>
<hr />
<pre>
387       errn += verify(&quot;test_ceil_cc: &quot;, 1, other_corner_cases_res[1], 0.0);
388       errn += verify(&quot;test_ceil_cc: &quot;, 2, other_corner_cases_res[2], 9.007199254740992E15);
389 
390       test_rint(a0, a1);
391       errn += verify(&quot;test_rint: &quot;, 0, a0[0], Double.NaN);
392       errn += verify(&quot;test_rint: &quot;, 1, a0[1], Double.POSITIVE_INFINITY);
393       errn += verify(&quot;test_rint: &quot;, 2, a0[2], Double.NEGATIVE_INFINITY);
394       errn += verify(&quot;test_rint: &quot;, 3, a0[3], Double.MAX_VALUE);
395       errn += verify(&quot;test_rint: &quot;, 4, a0[4], 0.0);
396       errn += verify(&quot;test_rint: &quot;, 5, a0[5], 0.0);
397       for (int i=6; i&lt;ARRLEN; i++) {
398         if ( i &lt;= 500 )
399            errn += verify(&quot;test_rint: &quot;, i, a0[i], ((double)(ADD_INIT+i)));
400         else
401            errn += verify(&quot;test_rint: &quot;, i, a0[i], ((double)(ADD_INIT+i+1.0)));
402       }
403       test_rint_cc(other_corner_cases_res, other_corner_cases);
404       errn += verify(&quot;test_rint_cc: &quot;, 0, other_corner_cases_res[0], -0.0);
405       errn += verify(&quot;test_rint_cc: &quot;, 1, other_corner_cases_res[1], 0.0);
406       errn += verify(&quot;test_rint_cc: &quot;, 2, other_corner_cases_res[2], 9.007199254740992E15);
















407     }
408 
409     if (errn &gt; 0)
410       return errn;
411 
412     System.out.println(&quot;Time&quot;);
413     long start, end;
414 
415     start = System.currentTimeMillis();
416     for (int i=0; i&lt;ITERS; i++) {
417       test_sum(a1);
418     }
419     end = System.currentTimeMillis();
420     System.out.println(&quot;test_sum: &quot; + (end - start));
421 
422     start = System.currentTimeMillis();
423     for (int i=0; i&lt;ITERS; i++) {
424       test_addc(a0, a1);
425     }
426     end = System.currentTimeMillis();
</pre>
<hr />
<pre>
523     start = System.currentTimeMillis();
524     for (int i=0; i&lt;ITERS; i++) {
525       test_divv(a0, a1, -VALUE);
526     }
527     end = System.currentTimeMillis();
528     System.out.println(&quot;test_divv_n: &quot; + (end - start));
529     start = System.currentTimeMillis();
530     for (int i=0; i&lt;ITERS; i++) {
531       test_diva(a0, a1, a3);
532     }
533     end = System.currentTimeMillis();
534     System.out.println(&quot;test_diva_n: &quot; + (end - start));
535 
536     start = System.currentTimeMillis();
537     for (int i=0; i&lt;ITERS; i++) {
538       test_negc(a0, a1);
539     }
540     end = System.currentTimeMillis();
541     System.out.println(&quot;test_negc_n: &quot; + (end - start));
542 







543     return errn;
544   }
545 
546   static double test_sum(double[] a1) {
547     double sum = 0;
548     for (int i = 0; i &lt; a1.length; i+=1) {
549       sum += a1[i];
550     }
551     return sum;
552   }
553 
554   static void test_addc(double[] a0, double[] a1) {
555     for (int i = 0; i &lt; a0.length; i+=1) {
556       a0[i] = (a1[i]+VALUE);
557     }
558   }
559   static void test_addv(double[] a0, double[] a1, double b) {
560     for (int i = 0; i &lt; a0.length; i+=1) {
561       a0[i] = (a1[i]+b);
562     }
</pre>
<hr />
<pre>
644     for (int i = 0; i &lt; a0.length; i+=1) {
645       a0[i] = Math.floor(a1[i] + ((double)(i))/1000);
646     }
647   }
648   static void test_rint_cc(double[] a0, double[] a1) {
649     for (int i = 0; i &lt; a0.length; i+=1) {
650       a0[i] = Math.rint(a1[i]);
651     }
652   }
653   static void test_ceil_cc(double[] a0, double[] a1) {
654     for (int i = 0; i &lt; a0.length; i+=1) {
655       a0[i] = Math.ceil(a1[i]);
656     }
657   }
658   static void test_floor_cc(double[] a0, double[] a1) {
659     for (int i = 0; i &lt; a0.length; i+=1) {
660       a0[i] = Math.floor(a1[i]);
661     }
662   }
663 






664   static int verify(String text, int i, double elem, double val) {
665     if (elem != val &amp;&amp; !(Double.isNaN(elem) &amp;&amp; Double.isNaN(val))) {
666       System.err.println(text + &quot;[&quot; + i + &quot;] = &quot; + elem + &quot; != &quot; + val);
667       return 1;
668     }
669     return 0;
670   }
671 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 73       test_adda(a0, a1, a2);
 74       test_subc(a0, a1);
 75       test_subv(a0, a1, VALUE);
 76       test_suba(a0, a1, a2);
 77       test_mulc(a0, a1);
 78       test_mulv(a0, a1, VALUE);
 79       test_mula(a0, a1, a2);
 80       test_divc(a0, a1);
 81       test_divv(a0, a1, VALUE);
 82       test_diva(a0, a1, a2);
 83       test_mulc_n(a0, a1);
 84       test_mulv(a0, a1, -VALUE);
 85       test_mula(a0, a1, a3);
 86       test_divc_n(a0, a1);
 87       test_divv(a0, a1, -VALUE);
 88       test_diva(a0, a1, a3);
 89       test_negc(a0, a1);
 90       test_rint(a0, a1);
 91       test_ceil(a0, a1);
 92       test_floor(a0, a1);
<span class="line-added"> 93       test_sqrt(a0, a1);</span>
 94     }
 95     // Test and verify results
 96     System.out.println(&quot;Verification&quot;);
 97     int errn = 0;
 98     {
 99       double sum = test_sum(a1);
100       if (sum != gold_sum) {
101         System.err.println(&quot;test_sum:  &quot; + sum + &quot; != &quot; + gold_sum);
102         errn++;
103       }
104       // Overwrite with NaN values
105       a1[0] = Double.NaN;
106       a1[1] = Double.POSITIVE_INFINITY;
107       a1[2] = Double.NEGATIVE_INFINITY;
108       a1[3] = Double.MAX_VALUE;
109       a1[4] = Double.MIN_VALUE;
110       a1[5] = Double.MIN_NORMAL;
111 
112       a2[6] = a1[0];
113       a2[7] = a1[1];
</pre>
<hr />
<pre>
388       errn += verify(&quot;test_ceil_cc: &quot;, 1, other_corner_cases_res[1], 0.0);
389       errn += verify(&quot;test_ceil_cc: &quot;, 2, other_corner_cases_res[2], 9.007199254740992E15);
390 
391       test_rint(a0, a1);
392       errn += verify(&quot;test_rint: &quot;, 0, a0[0], Double.NaN);
393       errn += verify(&quot;test_rint: &quot;, 1, a0[1], Double.POSITIVE_INFINITY);
394       errn += verify(&quot;test_rint: &quot;, 2, a0[2], Double.NEGATIVE_INFINITY);
395       errn += verify(&quot;test_rint: &quot;, 3, a0[3], Double.MAX_VALUE);
396       errn += verify(&quot;test_rint: &quot;, 4, a0[4], 0.0);
397       errn += verify(&quot;test_rint: &quot;, 5, a0[5], 0.0);
398       for (int i=6; i&lt;ARRLEN; i++) {
399         if ( i &lt;= 500 )
400            errn += verify(&quot;test_rint: &quot;, i, a0[i], ((double)(ADD_INIT+i)));
401         else
402            errn += verify(&quot;test_rint: &quot;, i, a0[i], ((double)(ADD_INIT+i+1.0)));
403       }
404       test_rint_cc(other_corner_cases_res, other_corner_cases);
405       errn += verify(&quot;test_rint_cc: &quot;, 0, other_corner_cases_res[0], -0.0);
406       errn += verify(&quot;test_rint_cc: &quot;, 1, other_corner_cases_res[1], 0.0);
407       errn += verify(&quot;test_rint_cc: &quot;, 2, other_corner_cases_res[2], 9.007199254740992E15);
<span class="line-added">408 </span>
<span class="line-added">409       // Overwrite with +0.0/-0.0 values</span>
<span class="line-added">410       a1[6] = (double)0.0;</span>
<span class="line-added">411       a1[7] = (double)-0.0;</span>
<span class="line-added">412       test_sqrt(a0, a1);</span>
<span class="line-added">413       errn += verify(&quot;test_sqrt: &quot;, 0, a0[0], (Double.NaN));</span>
<span class="line-added">414       errn += verify(&quot;test_sqrt: &quot;, 1, a0[1], (Double.POSITIVE_INFINITY));</span>
<span class="line-added">415       errn += verify(&quot;test_sqrt: &quot;, 2, a0[2], (Double.NaN));</span>
<span class="line-added">416       errn += verify(&quot;test_sqrt: &quot;, 3, a0[3], Math.sqrt(Double.MAX_VALUE));</span>
<span class="line-added">417       errn += verify(&quot;test_sqrt: &quot;, 4, a0[4], Math.sqrt(Double.MIN_VALUE));</span>
<span class="line-added">418       errn += verify(&quot;test_sqrt: &quot;, 5, a0[5], Math.sqrt(Double.MIN_NORMAL));</span>
<span class="line-added">419       errn += verify(&quot;test_sqrt: &quot;, 6, a0[6], (double)0.0);</span>
<span class="line-added">420       errn += verify(&quot;test_sqrt: &quot;, 7, a0[7], (double)-0.0);</span>
<span class="line-added">421       for (int i=8; i&lt;ARRLEN; i++) {</span>
<span class="line-added">422         errn += verify(&quot;test_sqrt: &quot;, i, a0[i], Math.sqrt((double)(ADD_INIT+i)));</span>
<span class="line-added">423       }</span>
424     }
425 
426     if (errn &gt; 0)
427       return errn;
428 
429     System.out.println(&quot;Time&quot;);
430     long start, end;
431 
432     start = System.currentTimeMillis();
433     for (int i=0; i&lt;ITERS; i++) {
434       test_sum(a1);
435     }
436     end = System.currentTimeMillis();
437     System.out.println(&quot;test_sum: &quot; + (end - start));
438 
439     start = System.currentTimeMillis();
440     for (int i=0; i&lt;ITERS; i++) {
441       test_addc(a0, a1);
442     }
443     end = System.currentTimeMillis();
</pre>
<hr />
<pre>
540     start = System.currentTimeMillis();
541     for (int i=0; i&lt;ITERS; i++) {
542       test_divv(a0, a1, -VALUE);
543     }
544     end = System.currentTimeMillis();
545     System.out.println(&quot;test_divv_n: &quot; + (end - start));
546     start = System.currentTimeMillis();
547     for (int i=0; i&lt;ITERS; i++) {
548       test_diva(a0, a1, a3);
549     }
550     end = System.currentTimeMillis();
551     System.out.println(&quot;test_diva_n: &quot; + (end - start));
552 
553     start = System.currentTimeMillis();
554     for (int i=0; i&lt;ITERS; i++) {
555       test_negc(a0, a1);
556     }
557     end = System.currentTimeMillis();
558     System.out.println(&quot;test_negc_n: &quot; + (end - start));
559 
<span class="line-added">560     start = System.currentTimeMillis();</span>
<span class="line-added">561     for (int i=0; i&lt;ITERS; i++) {</span>
<span class="line-added">562       test_sqrt(a0, a1);</span>
<span class="line-added">563     }</span>
<span class="line-added">564     end = System.currentTimeMillis();</span>
<span class="line-added">565     System.out.println(&quot;test_sqrt_n: &quot; + (end - start));</span>
<span class="line-added">566 </span>
567     return errn;
568   }
569 
570   static double test_sum(double[] a1) {
571     double sum = 0;
572     for (int i = 0; i &lt; a1.length; i+=1) {
573       sum += a1[i];
574     }
575     return sum;
576   }
577 
578   static void test_addc(double[] a0, double[] a1) {
579     for (int i = 0; i &lt; a0.length; i+=1) {
580       a0[i] = (a1[i]+VALUE);
581     }
582   }
583   static void test_addv(double[] a0, double[] a1, double b) {
584     for (int i = 0; i &lt; a0.length; i+=1) {
585       a0[i] = (a1[i]+b);
586     }
</pre>
<hr />
<pre>
668     for (int i = 0; i &lt; a0.length; i+=1) {
669       a0[i] = Math.floor(a1[i] + ((double)(i))/1000);
670     }
671   }
672   static void test_rint_cc(double[] a0, double[] a1) {
673     for (int i = 0; i &lt; a0.length; i+=1) {
674       a0[i] = Math.rint(a1[i]);
675     }
676   }
677   static void test_ceil_cc(double[] a0, double[] a1) {
678     for (int i = 0; i &lt; a0.length; i+=1) {
679       a0[i] = Math.ceil(a1[i]);
680     }
681   }
682   static void test_floor_cc(double[] a0, double[] a1) {
683     for (int i = 0; i &lt; a0.length; i+=1) {
684       a0[i] = Math.floor(a1[i]);
685     }
686   }
687 
<span class="line-added">688   static void test_sqrt(double[] a0, double[] a1) {</span>
<span class="line-added">689     for (int i = 0; i &lt; a0.length; i+=1) {</span>
<span class="line-added">690       a0[i] = (double)(Math.sqrt((double)a1[i]));</span>
<span class="line-added">691     }</span>
<span class="line-added">692   }</span>
<span class="line-added">693 </span>
694   static int verify(String text, int i, double elem, double val) {
695     if (elem != val &amp;&amp; !(Double.isNaN(elem) &amp;&amp; Double.isNaN(val))) {
696       System.err.println(text + &quot;[&quot; + i + &quot;] = &quot; + elem + &quot; != &quot; + val);
697       return 1;
698     }
699     return 0;
700   }
701 }
</pre>
</td>
</tr>
</table>
<center><a href="../TestUseOptoBiasInliningWithoutEliminateLocks.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TestFloatVect.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>