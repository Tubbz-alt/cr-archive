<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/jdk/jfr/event/runtime/TestClassLoaderStatsEvent.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../gc/heapsummary/TestHeapSummaryCommittedSize.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TestSafepointEvents.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/jdk/jfr/event/runtime/TestClassLoaderStatsEvent.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 65         Recording recording = new Recording();
 66         recording.enable(EVENT_NAME);
 67         recording.start();
 68         recording.stop();
 69         List&lt;RecordedEvent&gt; consumer = Events.fromRecording(recording);
 70         Events.hasEvents(consumer);
 71 
 72         boolean isAnyFound = false;
 73         for (RecordedEvent event : consumer) {
 74             System.out.println(&quot;Event:&quot; + event);
 75             if (Events.assertField(event, &quot;classLoader&quot;).getValue() == null) {
 76                 continue;
 77             }
 78             RecordedClassLoader recordedClassLoader = event.getValue(&quot;classLoader&quot;);
 79             if (CLASSLOADER_TYPE_NAME.equals(recordedClassLoader.getType().getName())) {
 80                 Asserts.assertEquals(CLASS_LOADER_NAME, recordedClassLoader.getName(),
 81                     &quot;Expected class loader name &quot; + CLASS_LOADER_NAME + &quot;, got name &quot; + recordedClassLoader.getName());
 82                 Events.assertField(event, &quot;classCount&quot;).equal(2L);
 83                 Events.assertField(event, &quot;chunkSize&quot;).above(1L);
 84                 Events.assertField(event, &quot;blockSize&quot;).above(1L);
<span class="line-modified"> 85                 Events.assertField(event, &quot;unsafeAnonymousClassCount&quot;).equal(2L);</span>
<span class="line-modified"> 86                 Events.assertField(event, &quot;unsafeAnonymousChunkSize&quot;).above(0L);</span>
<span class="line-removed"> 87                 Events.assertField(event, &quot;unsafeAnonymousBlockSize&quot;).above(0L);</span>
<span class="line-removed"> 88                 Events.assertField(event, &quot;hiddenClassCount&quot;).equal(2L);</span>
 89                 Events.assertField(event, &quot;hiddenChunkSize&quot;).above(0L);
 90                 Events.assertField(event, &quot;hiddenBlockSize&quot;).above(0L);
 91                 isAnyFound = true;
 92             }
 93         }
 94         Asserts.assertTrue(isAnyFound, &quot;No events found&quot;);
 95     }
 96 
 97     private static void createDummyClassLoader(String name) throws Throwable {
 98         dummyloader = new DummyClassLoader(name);
 99         Class&lt;?&gt; c = Class.forName(TestClass.class.getName(), true, dummyloader);
100         if (c.getClassLoader() != dummyloader) {
101             throw new RuntimeException(&quot;TestClass defined by wrong classloader: &quot; + c.getClassLoader());
102         }
103 
104         // Compile a class for method createNonFindableClasses() to use to create both a
105         // weak hidden class and an anonymous class.
106         byte klassbuf[] = InMemoryJavaCompiler.compile(&quot;jdk.jfr.event.runtime.TestClass&quot;,
107             &quot;package jdk.jfr.event.runtime; &quot; +
108             &quot;public class TestClass { &quot; +
</pre>
</td>
<td>
<hr />
<pre>
 65         Recording recording = new Recording();
 66         recording.enable(EVENT_NAME);
 67         recording.start();
 68         recording.stop();
 69         List&lt;RecordedEvent&gt; consumer = Events.fromRecording(recording);
 70         Events.hasEvents(consumer);
 71 
 72         boolean isAnyFound = false;
 73         for (RecordedEvent event : consumer) {
 74             System.out.println(&quot;Event:&quot; + event);
 75             if (Events.assertField(event, &quot;classLoader&quot;).getValue() == null) {
 76                 continue;
 77             }
 78             RecordedClassLoader recordedClassLoader = event.getValue(&quot;classLoader&quot;);
 79             if (CLASSLOADER_TYPE_NAME.equals(recordedClassLoader.getType().getName())) {
 80                 Asserts.assertEquals(CLASS_LOADER_NAME, recordedClassLoader.getName(),
 81                     &quot;Expected class loader name &quot; + CLASS_LOADER_NAME + &quot;, got name &quot; + recordedClassLoader.getName());
 82                 Events.assertField(event, &quot;classCount&quot;).equal(2L);
 83                 Events.assertField(event, &quot;chunkSize&quot;).above(1L);
 84                 Events.assertField(event, &quot;blockSize&quot;).above(1L);
<span class="line-modified"> 85                 // Hidden classes stats include both hidden and unsafe anonymous classes.</span>
<span class="line-modified"> 86                 Events.assertField(event, &quot;hiddenClassCount&quot;).equal(4L);</span>


 87                 Events.assertField(event, &quot;hiddenChunkSize&quot;).above(0L);
 88                 Events.assertField(event, &quot;hiddenBlockSize&quot;).above(0L);
 89                 isAnyFound = true;
 90             }
 91         }
 92         Asserts.assertTrue(isAnyFound, &quot;No events found&quot;);
 93     }
 94 
 95     private static void createDummyClassLoader(String name) throws Throwable {
 96         dummyloader = new DummyClassLoader(name);
 97         Class&lt;?&gt; c = Class.forName(TestClass.class.getName(), true, dummyloader);
 98         if (c.getClassLoader() != dummyloader) {
 99             throw new RuntimeException(&quot;TestClass defined by wrong classloader: &quot; + c.getClassLoader());
100         }
101 
102         // Compile a class for method createNonFindableClasses() to use to create both a
103         // weak hidden class and an anonymous class.
104         byte klassbuf[] = InMemoryJavaCompiler.compile(&quot;jdk.jfr.event.runtime.TestClass&quot;,
105             &quot;package jdk.jfr.event.runtime; &quot; +
106             &quot;public class TestClass { &quot; +
</pre>
</td>
</tr>
</table>
<center><a href="../gc/heapsummary/TestHeapSummaryCommittedSize.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TestSafepointEvents.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>