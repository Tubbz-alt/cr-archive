<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff doc/testing.md</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="testing.html.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="../make/CompileDemos.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>doc/testing.md</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  6 built a JDK locally and want to test it. Running common test targets is simple,
  7 and more complex ad-hoc combination of tests is possible. The user interface is
  8 forgiving, and clearly report errors it cannot resolve.
  9 
 10 The main target `test` uses the jdk-image as the tested product. There is
 11 also an alternate target `exploded-test` that uses the exploded image
 12 instead. Not all tests will run successfully on the exploded image, but using
 13 this target can greatly improve rebuild times for certain workflows.
 14 
 15 Previously, `make test` was used to invoke an old system for running tests, and
 16 `make run-test` was used for the new test framework. For backward compatibility
 17 with scripts and muscle memory, `run-test` (and variants like
 18 `exploded-run-test` or `run-test-tier1`) are kept as aliases.
 19 
 20 Some example command-lines:
 21 
 22     $ make test-tier1
 23     $ make test-jdk_lang JTREG=&quot;JOBS=8&quot;
 24     $ make test TEST=jdk_lang
 25     $ make test-only TEST=&quot;gtest:LogTagSet gtest:LogTagSetDescriptions&quot; GTEST=&quot;REPEAT=-1&quot;
<span class="line-modified"> 26     $ make test TEST=&quot;hotspot:hotspot_gc&quot; JTREG=&quot;JOBS=1;TIMEOUT_FACTOR=8;VM_OPTIONS=-XshowSettings -Xlog:gc+ref=debug&quot;</span>
 27     $ make test TEST=&quot;jtreg:test/hotspot:hotspot_gc test/hotspot/jtreg/native_sanity/JniVersion.java&quot;
 28     $ make test TEST=&quot;micro:java.lang.reflect&quot; MICRO=&quot;FORK=1;WARMUP_ITER=2&quot;
 29     $ make exploded-test TEST=tier2
 30 
 31 ### Configuration
 32 
 33 To be able to run JTReg tests, `configure` needs to know where to find the
 34 JTReg test framework. If it is not picked up automatically by configure, use
 35 the `--with-jtreg=&lt;path to jtreg home&gt;` option to point to the JTReg framework.
 36 Note that this option should point to the JTReg home, i.e. the top directory,
 37 containing `lib/jtreg.jar` etc. (An alternative is to set the `JT_HOME`
 38 environment variable to point to the JTReg home before running `configure`.)
 39 
 40 To be able to run microbenchmarks, `configure` needs to know where to find
 41 the JMH dependency. Use `--with-jmh=&lt;path to JMH jars&gt;` to point to a directory
 42 containing the core JMH and transitive dependencies. The recommended dependencies
 43 can be retrieved by running `sh make/devkit/createJMHBundle.sh`, after which
 44 `--with-jmh=build/jmh/jars` should work.
 45 
 46 ## Test selection
</pre>
<hr />
<pre>
173 Additional work data is stored in `build/$BUILD/test-support/$TEST_ID`. For
174 some frameworks, this directory might contain information that is useful in
175 determining the cause of a failed test.
176 
177 ## Test suite control
178 
179 It is possible to control various aspects of the test suites using make control
180 variables.
181 
182 These variables use a keyword=value approach to allow multiple values to be
183 set. So, for instance, `JTREG=&quot;JOBS=1;TIMEOUT_FACTOR=8&quot;` will set the JTReg
184 concurrency level to 1 and the timeout factor to 8. This is equivalent to
185 setting `JTREG_JOBS=1 JTREG_TIMEOUT_FACTOR=8`, but using the keyword format means that
186 the `JTREG` variable is parsed and verified for correctness, so
187 `JTREG=&quot;TMIEOUT_FACTOR=8&quot;` would give an error, while `JTREG_TMIEOUT_FACTOR=8` would just
188 pass unnoticed.
189 
190 To separate multiple keyword=value pairs, use `;` (semicolon). Since the shell
191 normally eats `;`, the recommended usage is to write the assignment inside
192 qoutes, e.g. `JTREG=&quot;...;...&quot;`. This will also make sure spaces are preserved,
<span class="line-modified">193 as in `JTREG=&quot;VM_OPTIONS=-XshowSettings -Xlog:gc+ref=debug&quot;`.</span>
194 
195 (Other ways are possible, e.g. using backslash: `JTREG=JOBS=1\;TIMEOUT_FACTOR=8`.
196 Also, as a special technique, the string `%20` will be replaced with space for
<span class="line-modified">197 certain options, e.g. `JTREG=VM_OPTIONS=-XshowSettings%20-Xlog:gc+ref=debug`.</span>
198 This can be useful if you have layers of scripts and have trouble getting
199 proper quoting of command line arguments through.)
200 
201 As far as possible, the names of the keywords have been standardized between
202 test suites.
203 
204 ### General keywords (TEST_OPTS)
205 
206 Some keywords are valid across different test suites. If you want to run
207 tests from multiple test suites, or just don&#39;t want to care which test suite specific
208 control variable to use, then you can use the general TEST_OPTS control variable.
209 
210 There are also some keywords that applies globally to the test runner system,
211 not to any specific test suites. These are also available as TEST_OPTS keywords.
212 
213 #### JOBS
214 
215 Currently only applies to JTReg.
216 
217 #### TIMEOUT_FACTOR
218 
219 Currently only applies to JTReg.
220 
<span class="line-modified">221 #### VM_OPTIONS</span>
222 
223 Applies to JTReg, GTest and Micro.
224 
<span class="line-modified">225 #### JAVA_OPTIONS</span>
226 
227 Applies to JTReg, GTest and Micro.
228 
229 #### AOT_MODULES
230 
231 Applies to JTReg and GTest.
232 
233 #### JCOV
234 
235 This keywords applies globally to the test runner system. If set to `true`, it
236 enables JCov coverage reporting for all tests run. To be useful, the JDK under
237 test must be run with a JDK built with JCov instrumentation (`configure
238 --with-jcov=&lt;path to directory containing lib/jcov.jar&gt;`, `make jcov-image`).
239 
240 The simplest way to run tests with JCov coverage report is to use the special
241 target `jcov-test` instead of `test`, e.g. `make jcov-test TEST=jdk_lang`. This
242 will make sure the JCov image is built, and that JCov reporting is enabled.
243 
244 The JCov report is stored in `build/$BUILD/test-results/jcov-output/report`.
245 
246 Please note that running with JCov reporting can be very memory intensive.
247 
248 #### JCOV_DIFF_CHANGESET
249 
250 While collecting code coverage with JCov, it is also possible to find coverage
251 for only recently changed code. JCOV_DIFF_CHANGESET specifies a source
252 revision. A textual report will be generated showing coverage of the diff
<span class="line-modified">253 between the specified revision and the repository tip. </span>
254 
255 The report is stored in `build/$BUILD/test-results/jcov-output/diff_coverage_report`
256 file.
257 
258 ### JTReg keywords
259 
260 #### JOBS
261 The test concurrency (`-concurrency`).
262 
263 Defaults to TEST_JOBS (if set by `--with-test-jobs=`), otherwise it defaults to
264 JOBS, except for Hotspot, where the default is *number of CPU cores/2* (for
265 sparc, if more than 16 cpus, then *number of CPU cores/5*, otherwise *number of
266 CPU cores/4*), but never more than *memory size in GB/2*.
267 
268 #### TIMEOUT_FACTOR
269 The timeout factor (`-timeoutFactor`).
270 
271 Defaults to 4.
272 
273 #### TEST_MODE
</pre>
<hr />
<pre>
314 help avoid quoting issues, the special value `%20`).
315 
316 The file names should be either absolute, or relative to the JTReg test root of
317 the tests to be run.
318 
319 #### RUN_PROBLEM_LISTS
320 
321 Use the problem lists to select tests instead of excluding them.
322 
323 Set to `true` or `false`.
324 If `true`, JTReg will use `-match:` option, otherwise `-exclude:` will be used.
325 Default is `false`.
326 
327 
328 #### OPTIONS
329 Additional options to the JTReg test framework.
330 
331 Use `JTREG=&quot;OPTIONS=--help all&quot;` to see all available JTReg options.
332 
333 #### JAVA_OPTIONS
<span class="line-modified">334 Additional Java options to JTReg (`-javaoption`).</span>

335 
336 #### VM_OPTIONS
<span class="line-modified">337 Additional VM options to JTReg (`-vmoption`).</span>




338 
339 #### AOT_MODULES
340 
341 Generate AOT modules before testing for the specified module, or set of
342 modules. If multiple modules are specified, they should be separated by space
343 (or, to help avoid quoting issues, the special value `%20`).
344 
345 #### RETRY_COUNT
346 
347 Retry failed tests up to a set number of times. Defaults to 0.
348 
349 ### Gtest keywords
350 
351 #### REPEAT
352 The number of times to repeat the tests (`--gtest_repeat`).
353 
354 Default is 1. Set to -1 to repeat indefinitely. This can be especially useful
355 combined with `OPTIONS=--gtest_break_on_failure` to reproduce an intermittent
356 problem.
357 
</pre>
</td>
<td>
<hr />
<pre>
  6 built a JDK locally and want to test it. Running common test targets is simple,
  7 and more complex ad-hoc combination of tests is possible. The user interface is
  8 forgiving, and clearly report errors it cannot resolve.
  9 
 10 The main target `test` uses the jdk-image as the tested product. There is
 11 also an alternate target `exploded-test` that uses the exploded image
 12 instead. Not all tests will run successfully on the exploded image, but using
 13 this target can greatly improve rebuild times for certain workflows.
 14 
 15 Previously, `make test` was used to invoke an old system for running tests, and
 16 `make run-test` was used for the new test framework. For backward compatibility
 17 with scripts and muscle memory, `run-test` (and variants like
 18 `exploded-run-test` or `run-test-tier1`) are kept as aliases.
 19 
 20 Some example command-lines:
 21 
 22     $ make test-tier1
 23     $ make test-jdk_lang JTREG=&quot;JOBS=8&quot;
 24     $ make test TEST=jdk_lang
 25     $ make test-only TEST=&quot;gtest:LogTagSet gtest:LogTagSetDescriptions&quot; GTEST=&quot;REPEAT=-1&quot;
<span class="line-modified"> 26     $ make test TEST=&quot;hotspot:hotspot_gc&quot; JTREG=&quot;JOBS=1;TIMEOUT_FACTOR=8;JAVA_OPTIONS=-XshowSettings -Xlog:gc+ref=debug&quot;</span>
 27     $ make test TEST=&quot;jtreg:test/hotspot:hotspot_gc test/hotspot/jtreg/native_sanity/JniVersion.java&quot;
 28     $ make test TEST=&quot;micro:java.lang.reflect&quot; MICRO=&quot;FORK=1;WARMUP_ITER=2&quot;
 29     $ make exploded-test TEST=tier2
 30 
 31 ### Configuration
 32 
 33 To be able to run JTReg tests, `configure` needs to know where to find the
 34 JTReg test framework. If it is not picked up automatically by configure, use
 35 the `--with-jtreg=&lt;path to jtreg home&gt;` option to point to the JTReg framework.
 36 Note that this option should point to the JTReg home, i.e. the top directory,
 37 containing `lib/jtreg.jar` etc. (An alternative is to set the `JT_HOME`
 38 environment variable to point to the JTReg home before running `configure`.)
 39 
 40 To be able to run microbenchmarks, `configure` needs to know where to find
 41 the JMH dependency. Use `--with-jmh=&lt;path to JMH jars&gt;` to point to a directory
 42 containing the core JMH and transitive dependencies. The recommended dependencies
 43 can be retrieved by running `sh make/devkit/createJMHBundle.sh`, after which
 44 `--with-jmh=build/jmh/jars` should work.
 45 
 46 ## Test selection
</pre>
<hr />
<pre>
173 Additional work data is stored in `build/$BUILD/test-support/$TEST_ID`. For
174 some frameworks, this directory might contain information that is useful in
175 determining the cause of a failed test.
176 
177 ## Test suite control
178 
179 It is possible to control various aspects of the test suites using make control
180 variables.
181 
182 These variables use a keyword=value approach to allow multiple values to be
183 set. So, for instance, `JTREG=&quot;JOBS=1;TIMEOUT_FACTOR=8&quot;` will set the JTReg
184 concurrency level to 1 and the timeout factor to 8. This is equivalent to
185 setting `JTREG_JOBS=1 JTREG_TIMEOUT_FACTOR=8`, but using the keyword format means that
186 the `JTREG` variable is parsed and verified for correctness, so
187 `JTREG=&quot;TMIEOUT_FACTOR=8&quot;` would give an error, while `JTREG_TMIEOUT_FACTOR=8` would just
188 pass unnoticed.
189 
190 To separate multiple keyword=value pairs, use `;` (semicolon). Since the shell
191 normally eats `;`, the recommended usage is to write the assignment inside
192 qoutes, e.g. `JTREG=&quot;...;...&quot;`. This will also make sure spaces are preserved,
<span class="line-modified">193 as in `JTREG=&quot;JAVA_OPTIONS=-XshowSettings -Xlog:gc+ref=debug&quot;`.</span>
194 
195 (Other ways are possible, e.g. using backslash: `JTREG=JOBS=1\;TIMEOUT_FACTOR=8`.
196 Also, as a special technique, the string `%20` will be replaced with space for
<span class="line-modified">197 certain options, e.g. `JTREG=JAVA_OPTIONS=-XshowSettings%20-Xlog:gc+ref=debug`.</span>
198 This can be useful if you have layers of scripts and have trouble getting
199 proper quoting of command line arguments through.)
200 
201 As far as possible, the names of the keywords have been standardized between
202 test suites.
203 
204 ### General keywords (TEST_OPTS)
205 
206 Some keywords are valid across different test suites. If you want to run
207 tests from multiple test suites, or just don&#39;t want to care which test suite specific
208 control variable to use, then you can use the general TEST_OPTS control variable.
209 
210 There are also some keywords that applies globally to the test runner system,
211 not to any specific test suites. These are also available as TEST_OPTS keywords.
212 
213 #### JOBS
214 
215 Currently only applies to JTReg.
216 
217 #### TIMEOUT_FACTOR
218 
219 Currently only applies to JTReg.
220 
<span class="line-modified">221 #### JAVA_OPTIONS</span>
222 
223 Applies to JTReg, GTest and Micro.
224 
<span class="line-modified">225 #### VM_OPTIONS</span>
226 
227 Applies to JTReg, GTest and Micro.
228 
229 #### AOT_MODULES
230 
231 Applies to JTReg and GTest.
232 
233 #### JCOV
234 
235 This keywords applies globally to the test runner system. If set to `true`, it
236 enables JCov coverage reporting for all tests run. To be useful, the JDK under
237 test must be run with a JDK built with JCov instrumentation (`configure
238 --with-jcov=&lt;path to directory containing lib/jcov.jar&gt;`, `make jcov-image`).
239 
240 The simplest way to run tests with JCov coverage report is to use the special
241 target `jcov-test` instead of `test`, e.g. `make jcov-test TEST=jdk_lang`. This
242 will make sure the JCov image is built, and that JCov reporting is enabled.
243 
244 The JCov report is stored in `build/$BUILD/test-results/jcov-output/report`.
245 
246 Please note that running with JCov reporting can be very memory intensive.
247 
248 #### JCOV_DIFF_CHANGESET
249 
250 While collecting code coverage with JCov, it is also possible to find coverage
251 for only recently changed code. JCOV_DIFF_CHANGESET specifies a source
252 revision. A textual report will be generated showing coverage of the diff
<span class="line-modified">253 between the specified revision and the repository tip.</span>
254 
255 The report is stored in `build/$BUILD/test-results/jcov-output/diff_coverage_report`
256 file.
257 
258 ### JTReg keywords
259 
260 #### JOBS
261 The test concurrency (`-concurrency`).
262 
263 Defaults to TEST_JOBS (if set by `--with-test-jobs=`), otherwise it defaults to
264 JOBS, except for Hotspot, where the default is *number of CPU cores/2* (for
265 sparc, if more than 16 cpus, then *number of CPU cores/5*, otherwise *number of
266 CPU cores/4*), but never more than *memory size in GB/2*.
267 
268 #### TIMEOUT_FACTOR
269 The timeout factor (`-timeoutFactor`).
270 
271 Defaults to 4.
272 
273 #### TEST_MODE
</pre>
<hr />
<pre>
314 help avoid quoting issues, the special value `%20`).
315 
316 The file names should be either absolute, or relative to the JTReg test root of
317 the tests to be run.
318 
319 #### RUN_PROBLEM_LISTS
320 
321 Use the problem lists to select tests instead of excluding them.
322 
323 Set to `true` or `false`.
324 If `true`, JTReg will use `-match:` option, otherwise `-exclude:` will be used.
325 Default is `false`.
326 
327 
328 #### OPTIONS
329 Additional options to the JTReg test framework.
330 
331 Use `JTREG=&quot;OPTIONS=--help all&quot;` to see all available JTReg options.
332 
333 #### JAVA_OPTIONS
<span class="line-modified">334 Additional Java options for running test classes (sent to JTReg as</span>
<span class="line-added">335 `-javaoption`).</span>
336 
337 #### VM_OPTIONS
<span class="line-modified">338 Additional Java options to be used when compiling and running classes (sent to</span>
<span class="line-added">339 JTReg as `-vmoption`).</span>
<span class="line-added">340 </span>
<span class="line-added">341 This option is only needed in special circumstances. To pass Java options to</span>
<span class="line-added">342 your test classes, use `JAVA_OPTIONS`.</span>
343 
344 #### AOT_MODULES
345 
346 Generate AOT modules before testing for the specified module, or set of
347 modules. If multiple modules are specified, they should be separated by space
348 (or, to help avoid quoting issues, the special value `%20`).
349 
350 #### RETRY_COUNT
351 
352 Retry failed tests up to a set number of times. Defaults to 0.
353 
354 ### Gtest keywords
355 
356 #### REPEAT
357 The number of times to repeat the tests (`--gtest_repeat`).
358 
359 Default is 1. Set to -1 to repeat indefinitely. This can be especially useful
360 combined with `OPTIONS=--gtest_break_on_failure` to reproduce an intermittent
361 problem.
362 
</pre>
</td>
</tr>
</table>
<center><a href="testing.html.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="../make/CompileDemos.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>