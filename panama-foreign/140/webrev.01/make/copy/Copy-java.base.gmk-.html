<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old make/copy/Copy-java.base.gmk</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
  <body>
    <pre>
  1 #
  2 # Copyright (c) 2014, 2019, Oracle and/or its affiliates. All rights reserved.
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 include CopyCommon.gmk
 27 include Modules.gmk
 28 include TextFileProcessing.gmk
 29 
 30 $(eval $(call IncludeCustomExtension, copy/Copy-java.base.gmk))
 31 
 32 ################################################################################
 33 
 34 ifeq ($(call isTargetOs, aix), true)
 35 
 36   TZMAPPINGS_SRC := $(TOPDIR)/src/java.base/$(OPENJDK_TARGET_OS)/conf
 37 
 38   $(LIB_DST_DIR)/tzmappings: $(TZMAPPINGS_SRC)/tzmappings
 39 	$(call install-file)
 40 
 41   TARGETS += $(LIB_DST_DIR)/tzmappings
 42 
 43 endif
 44 
 45 ################################################################################
 46 # Copy the microsoft runtime libraries on windows
 47 ifeq ($(call isTargetOs, windows), true)
 48 
 49   # Chmod to avoid permission issues if bundles are unpacked on unix platforms.
 50   define copy-and-chmod
 51 	$(install-file)
 52 	$(CHMOD) a+rx $@
 53   endef
 54 
 55   # Use separate macro calls in case the source files are not in the same
 56   # directory.
 57   $(eval $(call SetupCopyFiles,COPY_MSVCR, \
 58       DEST := $(LIB_DST_DIR), \
 59       FILES := $(MSVCR_DLL), \
 60       MACRO := copy-and-chmod))
 61 
 62   $(eval $(call SetupCopyFiles,COPY_VCRUNTIME_1, \
 63       DEST := $(LIB_DST_DIR), \
 64       FILES := $(VCRUNTIME_1_DLL), \
 65       MACRO := copy-and-chmod))
 66 
 67   $(eval $(call SetupCopyFiles,COPY_MSVCP, \
 68       DEST := $(LIB_DST_DIR), \
 69       FILES := $(MSVCP_DLL), \
 70       MACRO := copy-and-chmod))
 71 
 72   TARGETS += $(COPY_MSVCR) $(COPY_VCRUNTIME_1) $(COPY_MSVCP)
 73 
 74   ifneq ($(UCRT_DLL_DIR), )
 75     $(eval $(call SetupCopyFiles, COPY_UCRT_DLLS, \
 76         DEST := $(LIB_DST_DIR), \
 77         SRC := $(UCRT_DLL_DIR), \
 78         FILES := $(wildcard $(UCRT_DLL_DIR)/*.dll), \
 79         MACRO := copy-and-chmod, \
 80     ))
 81 
 82     TARGETS += $(COPY_UCRT_DLLS)
 83   endif
 84 endif
 85 
 86 ################################################################################
 87 # In jvm.cfg, the first listed KNOWN variant is the default. On most build
 88 # configurations, that is the server variant.
 89 ifeq ($(call And, $(call isTargetOs, windows) $(call isTargetCpu, x86)), true)
 90   DEFAULT_CFG_VARIANT ?= client
 91 endif
 92 DEFAULT_CFG_VARIANT ?= server
 93 
 94 # Any variant other than server, client or minimal is represented as server in
 95 # the cfg file.
 96 VALID_CFG_VARIANTS := server client minimal
 97 CFG_VARIANTS := $(filter $(VALID_CFG_VARIANTS), $(JVM_VARIANTS)) \
 98     $(if $(filter-out $(VALID_CFG_VARIANTS), $(JVM_VARIANTS)), server)
 99 
100 # Change the order to put the default variant first if present.
101 ORDERED_CFG_VARIANTS := \
102     $(if $(filter $(DEFAULT_CFG_VARIANT), $(CFG_VARIANTS)), $(DEFAULT_CFG_VARIANT)) \
103     $(filter-out $(DEFAULT_CFG_VARIANT), $(CFG_VARIANTS))
104 
105 JVMCFG := $(LIB_DST_DIR)/jvm.cfg
106 
107 define print-cfg-line
108 	$(call LogInfo, Adding -$1 $2 to jvm.cfg)
109 	$(PRINTF) -- &quot;-$1 $2\n&quot; &gt;&gt; $@ $(NEWLINE)
110 endef
111 
112 $(JVMCFG): $(call DependOnVariable, ORDERED_CFG_VARIANTS)
113 	$(call MakeTargetDir)
114 	$(RM) $@
115 	$(foreach v, $(ORDERED_CFG_VARIANTS), \
116 	  $(call print-cfg-line,$v,KNOWN) \
117 	)
118         # If either of server or client aren&#39;t present, add IGNORE lines for
119         # them.
120 	$(foreach v, server client, \
121 	  $(if $(filter $v, $(ORDERED_CFG_VARIANTS)), , \
122 	    $(call print-cfg-line,$v,IGNORE) \
123 	  ) \
124 	)
125 
126 TARGETS += $(JVMCFG)
127 
128 ################################################################################
129 
130 POLICY_SRC := $(TOPDIR)/src/java.base/share/conf/security/java.policy
131 POLICY_DST := $(CONF_DST_DIR)/security/java.policy
132 
133 POLICY_SRC_LIST := $(POLICY_SRC)
134 
135 $(POLICY_DST): $(POLICY_SRC_LIST)
136 	$(call MakeTargetDir)
137 	$(RM) $@ $@.tmp
138 	$(foreach f,$(POLICY_SRC_LIST),$(CAT) $(f) &gt;&gt; $@.tmp;)
139 	$(MV) $@.tmp $@
140 
141 TARGETS += $(POLICY_DST)
142 
143 ################################################################################
144 
145 DEF_POLICY_SRC := $(TOPDIR)/src/java.base/share/lib/security/default.policy
146 DEF_POLICY_DST := $(LIB_DST_DIR)/security/default.policy
147 
148 DEF_POLICY_SRC_LIST := $(DEF_POLICY_SRC)
149 DEF_POLICY_SRC_LIST += $(CUSTOM_POLICY_SRC_LIST)
150 
151 ifeq ($(call isTargetOs, windows solaris), true)
152   DEF_POLICY_SRC_LIST += $(TOPDIR)/src/java.base/$(OPENJDK_TARGET_OS)/lib/security/default.policy
153 endif
154 
155 # Allow imported modules to modify the java.policy
156 ifneq ($(IMPORT_MODULES_CONF), )
157   DEF_POLICY_SRC_LIST += $(wildcard $(IMPORT_MODULES_CONF)/java.base/security/java.policy.extra)
158 endif
159 
160 $(DEF_POLICY_DST): $(DEF_POLICY_SRC_LIST)
161 	$(call MakeTargetDir)
162 	$(RM) $@ $@.tmp
163 	$(foreach f,$(DEF_POLICY_SRC_LIST),$(CAT) $(f) &gt;&gt; $@.tmp;)
164 	$(MV) $@.tmp $@
165 
166 TARGETS += $(DEF_POLICY_DST)
167 
168 ################################################################################
169 
170 # CACERTS_FILE is optionally set in configure to override the default cacerts
171 # which is otherwise generated in Gendata-java.base.gmk
172 CACERTS_DST := $(LIB_DST_DIR)/security/cacerts
173 
174 $(CACERTS_DST): $(CACERTS_FILE)
175 	$(call LogInfo, Copying $(patsubst $(OUTPUTDIR)/%, %, $@))
176 	$(call install-file)
177 
178 ifneq ($(CACERTS_FILE), )
179   TARGETS += $(CACERTS_DST)
180 endif
181 
182 ################################################################################
183 
184 $(eval $(call SetupCopyFiles, COPY_NET_PROPERTIES, \
185     FILES := $(TOPDIR)/src/java.base/share/conf/net.properties, \
186     DEST := $(CONF_DST_DIR), \
187 ))
188 
189 TARGETS += $(COPY_NET_PROPERTIES)
190 
191 ifeq ($(call isTargetOs, solaris linux), true)
192   $(eval $(call SetupCopyFiles, COPY_SDP_CONF, \
193       FILES := $(TOPDIR)/src/java.base/$(OPENJDK_TARGET_OS_TYPE)/conf/sdp/sdp.conf.template, \
194       DEST := $(CONF_DST_DIR)/sdp, \
195   ))
196 
197   TARGETS += $(COPY_SDP_CONF)
198 endif
199 
200 ################################################################################
201 
202 # JDK license and assembly exception files to be packaged in JMOD
203 
204 # The license files may not be present if the source has been obtained using a
205 # different license.
206 JDK_LICENSE ?= $(wildcard $(TOPDIR)/LICENSE)
207 JDK_NOTICE  ?= $(wildcard $(TOPDIR)/ASSEMBLY_EXCEPTION)
208 JDK_ADDITIONAL_LICENSE_INFO  ?= $(wildcard $(TOPDIR)/ADDITIONAL_LICENSE_INFO)
209 
210 $(eval $(call SetupCopyFiles, COPY_JDK_NOTICES, \
211     FILES := $(JDK_LICENSE) $(JDK_NOTICE) $(JDK_ADDITIONAL_LICENSE_INFO), \
212     DEST := $(COMMON_LEGAL_DST_DIR), \
213     FLATTEN := true, \
214 ))
215 
216 TARGETS += $(COPY_JDK_NOTICES)
217 
218 ################################################################################
219 #
220 # Copy and filter the legal files depending on what 3rd party components are
221 # bundled or linked from the OS.
222 #
223 ifeq ($(USE_EXTERNAL_LIBZ), true)
224   LEGAL_EXCLUDES += zlib.md
225 endif
226 
227 $(eval $(call SetupCopyLegalFiles, COPY_LEGAL, \
228     EXCLUDES := $(LEGAL_EXCLUDES), \
229 ))
230 
231 TARGETS += $(COPY_LEGAL)
232 
233 ################################################################################
234 # Optionally copy libffi.so.? into the the image
235 
236 ifeq ($(ENABLE_LIBFFI_BUNDLING), true)
237   $(eval $(call SetupCopyFiles, COPY_LIBFFI, \
238       FILES := $(LIBFFI_LIB_FILE), \
239       DEST := $(call FindLibDirForModule, $(MODULE)), \
240       FLATTEN := true, \
241       MACRO := install-file-nolink, \
242   ))
243 
244   TARGETS += $(COPY_LIBFFI)
245 endif
246 
247 ################################################################################
248 # Generate classfile_constants.h
249 
250 $(eval $(call SetupTextFileProcessing, CREATE_CLASSFILE_CONSTANTS_H, \
251     SOURCE_FILES := $(TOPDIR)/src/java.base/share/native/include/classfile_constants.h.template, \
252     OUTPUT_FILE := $(SUPPORT_OUTPUTDIR)/modules_include/java.base/classfile_constants.h, \
253     REPLACEMENTS := \
254         @@VERSION_CLASSFILE_MAJOR@@ =&gt; $(VERSION_CLASSFILE_MAJOR) ; \
255         @@VERSION_CLASSFILE_MINOR@@ =&gt; $(VERSION_CLASSFILE_MINOR) ; , \
256 ))
257 
258 TARGETS += $(CREATE_CLASSFILE_CONSTANTS_H)
259 
260 ################################################################################
    </pre>
  </body>
</html>