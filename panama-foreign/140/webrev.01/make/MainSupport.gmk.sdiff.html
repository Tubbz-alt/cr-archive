<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/MainSupport.gmk</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="Main.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="ModuleTools.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/MainSupport.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
112 endef
113 
114 
115 ################################################################################
116 
117 PHASE_MAKEDIRS := $(TOPDIR)/make
118 
119 # Helper macro for DeclareRecipesForPhase
120 # Declare a recipe for calling the module and phase specific makefile.
121 # If there are multiple makefiles to call, create a rule for each topdir
122 # that contains a makefile with the target $module-$suffix-$repodir,
123 # (i.e: java.base-gensrc-src)
124 # Normally there is only one makefile, and the target will just be
125 # $module-$suffix
126 # Param 1: Name of list to add targets to
127 # Param 2: Module name
128 define DeclareRecipeForModuleMakefile
129   $2-$$($1_TARGET_SUFFIX):
130         ifeq ($$($1_USE_WRAPPER), true)
131 	  +($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) \
<span class="line-modified">132 	      -f ModuleWrapper.gmk \</span>
133 	      $$(addprefix -I, $$(PHASE_MAKEDIRS) \
<span class="line-modified">134 	          $$(addsuffix /$$($1_MAKE_SUBDIR), $$(PHASE_MAKEDIRS)) \</span>
135 	      ) \
136 	      MODULE=$2 MAKEFILE_PREFIX=$$($1_FILE_PREFIX) $$($1_EXTRA_ARGS))
137         else
<span class="line-modified">138 	  +($(CD) $$(dir $$(firstword $$(wildcard $$(addsuffix \</span>
<span class="line-removed">139 	      /$$($1_MAKE_SUBDIR)/$$($1_FILE_PREFIX)-$2.gmk, $$(PHASE_MAKEDIRS))))) \</span>
140 	  &amp;&amp; $(MAKE) $(MAKE_ARGS) \
<span class="line-modified">141 	      -f $$($1_FILE_PREFIX)-$2.gmk \</span>
142 	      $$(addprefix -I, $$(PHASE_MAKEDIRS) \
<span class="line-modified">143 	          $$(addsuffix /$$($1_MAKE_SUBDIR), $$(PHASE_MAKEDIRS)) \</span>
144 	      ) \
145 	      MODULE=$2 $$($1_EXTRA_ARGS) \
146 	  )
147         endif
148 
149 endef
150 
151 # Helper macro for DeclareRecipesForPhase
152 # Param 1: Name of list to add targets to
153 # Param 2: Module name
154 define DeclareRecipesForPhaseAndModule
155   $1_$2_MAKEFILES := $$(strip $$(wildcard \
<span class="line-modified">156       $$(addsuffix /$$($1_MAKE_SUBDIR)/$$($1_FILE_PREFIX)-$2.gmk, $$(PHASE_MAKEDIRS))))</span>
157 
158   # Only declare recipes if there are makefiles to call
159   ifneq ($$($1_$2_MAKEFILES), )
160     # Add the top dir specific target to target list regardless of if recipe
161     # generation is disabled.
162     ifeq ($$($1_MULTIPLE_MAKEFILES), true)
163       $$(foreach d, $$($1_$2_TOPDIRS), \
164         $$(eval $1 += $2-$$($1_TARGET_SUFFIX)-$$(notdir $$d)))
165     endif
166     ifeq ($(NO_RECIPES),)
167       $$(eval $$(call DeclareRecipeForModuleMakefile,$1,$2))
168     endif
169     $1 += $2-$$($1_TARGET_SUFFIX)
170     $1_MODULES += $2
171   endif
172 endef
173 
174 # Declare recipes for a specific module and build phase if there are makefiles
175 # present for the specific combination.
176 # Param 1: Name of list to add targets to
</pre>
</td>
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
112 endef
113 
114 
115 ################################################################################
116 
117 PHASE_MAKEDIRS := $(TOPDIR)/make
118 
119 # Helper macro for DeclareRecipesForPhase
120 # Declare a recipe for calling the module and phase specific makefile.
121 # If there are multiple makefiles to call, create a rule for each topdir
122 # that contains a makefile with the target $module-$suffix-$repodir,
123 # (i.e: java.base-gensrc-src)
124 # Normally there is only one makefile, and the target will just be
125 # $module-$suffix
126 # Param 1: Name of list to add targets to
127 # Param 2: Module name
128 define DeclareRecipeForModuleMakefile
129   $2-$$($1_TARGET_SUFFIX):
130         ifeq ($$($1_USE_WRAPPER), true)
131 	  +($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) \
<span class="line-modified">132 	      -f ModuleWrapper.gmk -I $$(TOPDIR)/make/common/modules  \</span>
133 	      $$(addprefix -I, $$(PHASE_MAKEDIRS) \
<span class="line-modified">134 	          $$(addsuffix /modules/$2, $$(PHASE_MAKEDIRS)) \</span>
135 	      ) \
136 	      MODULE=$2 MAKEFILE_PREFIX=$$($1_FILE_PREFIX) $$($1_EXTRA_ARGS))
137         else
<span class="line-modified">138 	  +($(CD) $$(TOPDIR)/make \</span>

139 	  &amp;&amp; $(MAKE) $(MAKE_ARGS) \
<span class="line-modified">140 	      -f modules/$2/$$($1_FILE_PREFIX).gmk -I $$(TOPDIR)/make/common/modules \</span>
141 	      $$(addprefix -I, $$(PHASE_MAKEDIRS) \
<span class="line-modified">142 	          $$(addsuffix /modules/$2, $$(PHASE_MAKEDIRS)) \</span>
143 	      ) \
144 	      MODULE=$2 $$($1_EXTRA_ARGS) \
145 	  )
146         endif
147 
148 endef
149 
150 # Helper macro for DeclareRecipesForPhase
151 # Param 1: Name of list to add targets to
152 # Param 2: Module name
153 define DeclareRecipesForPhaseAndModule
154   $1_$2_MAKEFILES := $$(strip $$(wildcard \
<span class="line-modified">155       $$(addsuffix /modules/$2/$$($1_FILE_PREFIX).gmk, $$(PHASE_MAKEDIRS))))</span>
156 
157   # Only declare recipes if there are makefiles to call
158   ifneq ($$($1_$2_MAKEFILES), )
159     # Add the top dir specific target to target list regardless of if recipe
160     # generation is disabled.
161     ifeq ($$($1_MULTIPLE_MAKEFILES), true)
162       $$(foreach d, $$($1_$2_TOPDIRS), \
163         $$(eval $1 += $2-$$($1_TARGET_SUFFIX)-$$(notdir $$d)))
164     endif
165     ifeq ($(NO_RECIPES),)
166       $$(eval $$(call DeclareRecipeForModuleMakefile,$1,$2))
167     endif
168     $1 += $2-$$($1_TARGET_SUFFIX)
169     $1_MODULES += $2
170   endif
171 endef
172 
173 # Declare recipes for a specific module and build phase if there are makefiles
174 # present for the specific combination.
175 # Param 1: Name of list to add targets to
</pre>
</td>
</tr>
</table>
<center><a href="Main.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="ModuleTools.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>