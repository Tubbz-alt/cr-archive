<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/build-performance.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="bootcycle-spec.gmk.in.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="configure.ac.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/build-performance.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
376     echo &quot;int alfa();&quot; &gt; conftest.h
377     $CXX -x c++-header conftest.h -o conftest.hpp.gch 2&gt;&amp;AS_MESSAGE_LOG_FD &gt;&amp;AS_MESSAGE_LOG_FD
378     if test ! -f conftest.hpp.gch; then
379       PRECOMPILED_HEADERS_AVAILABLE=false
380       AC_MSG_RESULT([no, gcc fails to compile properly with -x c++-header])
381     else
382       AC_MSG_RESULT([yes])
383     fi
384     $RM conftest.h conftest.hpp.gch
385   else
386     AC_MSG_RESULT([yes])
387   fi
388 
389   UTIL_ARG_ENABLE(NAME: precompiled-headers, DEFAULT: auto,
390       RESULT: USE_PRECOMPILED_HEADER, AVAILABLE: $PRECOMPILED_HEADERS_AVAILABLE,
391       DESC: [enable using precompiled headers when compiling C++])
392   AC_SUBST(USE_PRECOMPILED_HEADER)
393 ])
394 
395 
<span class="line-modified">396 AC_DEFUN_ONCE([BPERF_SETUP_SMART_JAVAC],</span>
397 [
<span class="line-modified">398   AC_ARG_WITH(sjavac-server-java, [AS_HELP_STRING([--with-sjavac-server-java],</span>
<span class="line-modified">399       [use this java binary for running the sjavac background server @&lt;:@Boot JDK java@:&gt;@])])</span>
<span class="line-removed">400 </span>
<span class="line-removed">401   if test &quot;x$with_sjavac_server_java&quot; != x; then</span>
<span class="line-removed">402     SJAVAC_SERVER_JAVA=&quot;$with_sjavac_server_java&quot;</span>
<span class="line-removed">403     FOUND_VERSION=`$SJAVAC_SERVER_JAVA -version 2&gt;&amp;1 | grep &quot; version \&quot;&quot;`</span>
<span class="line-removed">404     if test &quot;x$FOUND_VERSION&quot; = x; then</span>
<span class="line-removed">405       AC_MSG_ERROR([Could not execute server java: $SJAVAC_SERVER_JAVA])</span>
<span class="line-removed">406     fi</span>
<span class="line-removed">407   else</span>
<span class="line-removed">408     SJAVAC_SERVER_JAVA=&quot;$JAVA&quot;</span>
<span class="line-removed">409   fi</span>
<span class="line-removed">410   AC_SUBST(SJAVAC_SERVER_JAVA)</span>
<span class="line-removed">411 </span>
<span class="line-removed">412   if test &quot;$MEMORY_SIZE&quot; -gt &quot;3000&quot;; then</span>
<span class="line-removed">413     if &quot;$JAVA&quot; -version 2&gt;&amp;1 | $GREP -q &quot;64-Bit&quot;; then</span>
<span class="line-removed">414       JVM_64BIT=true</span>
<span class="line-removed">415     fi</span>
<span class="line-removed">416   fi</span>
<span class="line-removed">417 </span>
<span class="line-removed">418   MX_VALUE=`expr $MEMORY_SIZE / 2`</span>
<span class="line-removed">419   if test &quot;$JVM_64BIT&quot; = true; then</span>
<span class="line-removed">420     # Set ms lower than mx since more than one instance of the server might</span>
<span class="line-removed">421     # get launched at the same time before they figure out which instance won.</span>
<span class="line-removed">422     MS_VALUE=512</span>
<span class="line-removed">423     if test &quot;$MX_VALUE&quot; -gt &quot;2048&quot;; then</span>
<span class="line-removed">424       MX_VALUE=2048</span>
<span class="line-removed">425     fi</span>
<span class="line-removed">426   else</span>
<span class="line-removed">427     MS_VALUE=256</span>
<span class="line-removed">428     if test &quot;$MX_VALUE&quot; -gt &quot;1500&quot;; then</span>
<span class="line-removed">429       MX_VALUE=1500</span>
<span class="line-removed">430     fi</span>
<span class="line-removed">431   fi</span>
<span class="line-removed">432   if test &quot;$MX_VALUE&quot; -lt &quot;512&quot;; then</span>
<span class="line-removed">433     MX_VALUE=512</span>
<span class="line-removed">434   fi</span>
<span class="line-removed">435 </span>
<span class="line-removed">436   JAVAC_SERVER_AVAILABLE=true</span>
<span class="line-removed">437   SJAVAC_MEMORY_OPT=&quot;-Xms${MS_VALUE}M -Xmx${MX_VALUE}M&quot;</span>
<span class="line-removed">438   UTIL_ADD_JVM_ARG_IF_OK([$SJAVAC_MEMORY_OPT],SJAVAC_SERVER_JAVA_FLAGS,[$SJAVAC_SERVER_JAVA])</span>
<span class="line-removed">439   if test &quot;x$JVM_ARG_OK&quot; = &quot;xfalse&quot;; then</span>
<span class="line-removed">440     AC_MSG_WARN([Could not set &#39;$SJAVAC_MEMORY_OPT&#39; on bootjdk, disabling sjavac and javac server])</span>
<span class="line-removed">441     JAVAC_SERVER_AVAILABLE=false</span>
<span class="line-removed">442   fi</span>
<span class="line-removed">443   AC_SUBST(SJAVAC_SERVER_JAVA_FLAGS)</span>
<span class="line-removed">444 </span>
<span class="line-removed">445   UTIL_ARG_ENABLE(NAME: sjavac, DEFAULT: false, AVAILABLE: $JAVAC_SERVER_AVAILABLE,</span>
<span class="line-removed">446       DESC: [use sjavac to do fast incremental compiles],</span>
<span class="line-removed">447       CHECKING_MSG: [whether to use sjavac],</span>
<span class="line-removed">448       IF_ENABLED: [ ENABLE_SJAVAC=&quot;yes&quot; ],</span>
<span class="line-removed">449       IF_DISABLED: [ ENABLE_SJAVAC=&quot;no&quot; ])</span>
<span class="line-removed">450   AC_SUBST(ENABLE_SJAVAC)</span>
<span class="line-removed">451 </span>
<span class="line-removed">452   UTIL_ARG_ENABLE(NAME: javac-server, DEFAULT: true, AVAILABLE: $JAVAC_SERVER_AVAILABLE,</span>
453       DESC: [enable javac server],
<span class="line-modified">454       CHECKING_MSG: [whether to use javac server],</span>
<span class="line-removed">455       IF_ENABLED: [ ENABLE_JAVAC_SERVER=&quot;yes&quot; ],</span>
<span class="line-removed">456       IF_DISABLED: [ ENABLE_JAVAC_SERVER=&quot;no&quot; ])</span>
457   AC_SUBST(ENABLE_JAVAC_SERVER)
<span class="line-removed">458 </span>
<span class="line-removed">459   if test &quot;x$ENABLE_JAVAC_SERVER&quot; = &quot;xyes&quot; || test &quot;x$ENABLE_SJAVAC&quot; = &quot;xyes&quot;; then</span>
<span class="line-removed">460     # When using a server javac, the small client instances do not need much</span>
<span class="line-removed">461     # resources.</span>
<span class="line-removed">462     JAVA_FLAGS_JAVAC=&quot;$JAVA_FLAGS_SMALL&quot;</span>
<span class="line-removed">463   fi</span>
464 ])
</pre>
</td>
<td>
<hr />
<pre>
376     echo &quot;int alfa();&quot; &gt; conftest.h
377     $CXX -x c++-header conftest.h -o conftest.hpp.gch 2&gt;&amp;AS_MESSAGE_LOG_FD &gt;&amp;AS_MESSAGE_LOG_FD
378     if test ! -f conftest.hpp.gch; then
379       PRECOMPILED_HEADERS_AVAILABLE=false
380       AC_MSG_RESULT([no, gcc fails to compile properly with -x c++-header])
381     else
382       AC_MSG_RESULT([yes])
383     fi
384     $RM conftest.h conftest.hpp.gch
385   else
386     AC_MSG_RESULT([yes])
387   fi
388 
389   UTIL_ARG_ENABLE(NAME: precompiled-headers, DEFAULT: auto,
390       RESULT: USE_PRECOMPILED_HEADER, AVAILABLE: $PRECOMPILED_HEADERS_AVAILABLE,
391       DESC: [enable using precompiled headers when compiling C++])
392   AC_SUBST(USE_PRECOMPILED_HEADER)
393 ])
394 
395 
<span class="line-modified">396 AC_DEFUN_ONCE([BPERF_SETUP_JAVAC_SERVER],</span>
397 [
<span class="line-modified">398   UTIL_ARG_ENABLE(NAME: javac-server, DEFAULT: true,</span>
<span class="line-modified">399       RESULT: ENABLE_JAVAC_SERVER,</span>





















































400       DESC: [enable javac server],
<span class="line-modified">401       CHECKING_MSG: [whether to use javac server])</span>


402   AC_SUBST(ENABLE_JAVAC_SERVER)






403 ])
</pre>
</td>
</tr>
</table>
<center><a href="bootcycle-spec.gmk.in.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="configure.ac.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>