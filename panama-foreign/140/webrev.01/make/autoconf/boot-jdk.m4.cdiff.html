<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff make/autoconf/boot-jdk.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="../ToolsLangtools.gmk.cdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="bootcycle-spec.gmk.in.cdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/boot-jdk.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 345,15 ***</span>
  
    # When compiling code to be executed by the Boot JDK, force compatibility with the
    # oldest supported bootjdk.
    OLDEST_BOOT_JDK=`$ECHO $DEFAULT_ACCEPTABLE_BOOT_VERSIONS \
        | $TR &quot; &quot; &quot;\n&quot; | $SORT -n | $HEAD -n1`
<span class="line-modified">!   BOOT_JDK_SOURCETARGET=&quot;-source $OLDEST_BOOT_JDK -target $OLDEST_BOOT_JDK&quot;</span>
    AC_SUBST(BOOT_JDK_SOURCETARGET)
  
<span class="line-removed">-   AC_SUBST(JAVAC_FLAGS)</span>
<span class="line-removed">- </span>
    # Check if the boot jdk is 32 or 64 bit
    if &quot;$JAVA&quot; -version 2&gt;&amp;1 | $GREP -q &quot;64-Bit&quot;; then
      BOOT_JDK_BITS=&quot;64&quot;
    else
      BOOT_JDK_BITS=&quot;32&quot;
<span class="line-new-header">--- 345,14 ---</span>
  
    # When compiling code to be executed by the Boot JDK, force compatibility with the
    # oldest supported bootjdk.
    OLDEST_BOOT_JDK=`$ECHO $DEFAULT_ACCEPTABLE_BOOT_VERSIONS \
        | $TR &quot; &quot; &quot;\n&quot; | $SORT -n | $HEAD -n1`
<span class="line-modified">!   # -Xlint:-options is added to avoid &quot;warning: [options] system modules path not set in conjunction with -source&quot;</span>
<span class="line-added">+   BOOT_JDK_SOURCETARGET=&quot;-source $OLDEST_BOOT_JDK -target $OLDEST_BOOT_JDK -Xlint:-options&quot;</span>
    AC_SUBST(BOOT_JDK_SOURCETARGET)
  
    # Check if the boot jdk is 32 or 64 bit
    if &quot;$JAVA&quot; -version 2&gt;&amp;1 | $GREP -q &quot;64-Bit&quot;; then
      BOOT_JDK_BITS=&quot;64&quot;
    else
      BOOT_JDK_BITS=&quot;32&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 431,16 ***</span>
  
    # Starting amount of heap memory.
    UTIL_ADD_JVM_ARG_IF_OK([-Xms64M],boot_jdk_jvmargs_big,[$JAVA])
    BOOTCYCLE_JVM_ARGS_BIG=-Xms64M
  
<span class="line-modified">!   # Maximum amount of heap memory and stack size.</span>
    JVM_HEAP_LIMIT_32=&quot;768&quot;
    # Running a 64 bit JVM allows for and requires a bigger heap
    JVM_HEAP_LIMIT_64=&quot;1600&quot;
<span class="line-removed">-   STACK_SIZE_32=768</span>
<span class="line-removed">-   STACK_SIZE_64=1536</span>
    JVM_HEAP_LIMIT_GLOBAL=`expr $MEMORY_SIZE / 2`
    if test &quot;$JVM_HEAP_LIMIT_GLOBAL&quot; -lt &quot;$JVM_HEAP_LIMIT_32&quot;; then
      JVM_HEAP_LIMIT_32=$JVM_HEAP_LIMIT_GLOBAL
    fi
    if test &quot;$JVM_HEAP_LIMIT_GLOBAL&quot; -lt &quot;$JVM_HEAP_LIMIT_64&quot;; then
<span class="line-new-header">--- 430,14 ---</span>
  
    # Starting amount of heap memory.
    UTIL_ADD_JVM_ARG_IF_OK([-Xms64M],boot_jdk_jvmargs_big,[$JAVA])
    BOOTCYCLE_JVM_ARGS_BIG=-Xms64M
  
<span class="line-modified">!   # Maximum amount of heap memory.</span>
    JVM_HEAP_LIMIT_32=&quot;768&quot;
    # Running a 64 bit JVM allows for and requires a bigger heap
    JVM_HEAP_LIMIT_64=&quot;1600&quot;
    JVM_HEAP_LIMIT_GLOBAL=`expr $MEMORY_SIZE / 2`
    if test &quot;$JVM_HEAP_LIMIT_GLOBAL&quot; -lt &quot;$JVM_HEAP_LIMIT_32&quot;; then
      JVM_HEAP_LIMIT_32=$JVM_HEAP_LIMIT_GLOBAL
    fi
    if test &quot;$JVM_HEAP_LIMIT_GLOBAL&quot; -lt &quot;$JVM_HEAP_LIMIT_64&quot;; then
</pre>
<hr />
<pre>
<span class="line-old-header">*** 450,41 ***</span>
      JVM_HEAP_LIMIT_32=512
      JVM_HEAP_LIMIT_64=512
    fi
  
    if test &quot;x$BOOT_JDK_BITS&quot; = &quot;x32&quot;; then
<span class="line-removed">-     STACK_SIZE=$STACK_SIZE_32</span>
      JVM_MAX_HEAP=$JVM_HEAP_LIMIT_32
    else
<span class="line-removed">-     STACK_SIZE=$STACK_SIZE_64</span>
      JVM_MAX_HEAP=$JVM_HEAP_LIMIT_64
    fi
    UTIL_ADD_JVM_ARG_IF_OK([-Xmx${JVM_MAX_HEAP}M],boot_jdk_jvmargs_big,[$JAVA])
<span class="line-removed">-   UTIL_ADD_JVM_ARG_IF_OK([-XX:ThreadStackSize=$STACK_SIZE],boot_jdk_jvmargs_big,[$JAVA])</span>
  
    AC_MSG_RESULT([$boot_jdk_jvmargs_big])
  
    JAVA_FLAGS_BIG=$boot_jdk_jvmargs_big
    AC_SUBST(JAVA_FLAGS_BIG)
  
    if test &quot;x$OPENJDK_TARGET_CPU_BITS&quot; = &quot;x32&quot;; then
      BOOTCYCLE_MAX_HEAP=$JVM_HEAP_LIMIT_32
<span class="line-removed">-     BOOTCYCLE_STACK_SIZE=$STACK_SIZE_32</span>
    else
      BOOTCYCLE_MAX_HEAP=$JVM_HEAP_LIMIT_64
<span class="line-removed">-     BOOTCYCLE_STACK_SIZE=$STACK_SIZE_64</span>
    fi
    BOOTCYCLE_JVM_ARGS_BIG=&quot;$BOOTCYCLE_JVM_ARGS_BIG -Xmx${BOOTCYCLE_MAX_HEAP}M&quot;
<span class="line-removed">-   BOOTCYCLE_JVM_ARGS_BIG=&quot;$BOOTCYCLE_JVM_ARGS_BIG -XX:ThreadStackSize=$BOOTCYCLE_STACK_SIZE&quot;</span>
    AC_MSG_CHECKING([flags for bootcycle boot jdk java command for big workloads])
    AC_MSG_RESULT([$BOOTCYCLE_JVM_ARGS_BIG])
    AC_SUBST(BOOTCYCLE_JVM_ARGS_BIG)
  
<span class="line-removed">-   # By default, the main javac compilations use big</span>
<span class="line-removed">-   JAVA_FLAGS_JAVAC=&quot;$JAVA_FLAGS_BIG&quot;</span>
<span class="line-removed">-   AC_SUBST(JAVA_FLAGS_JAVAC)</span>
<span class="line-removed">- </span>
    AC_MSG_CHECKING([flags for boot jdk java command for small workloads])
  
    # Use serial gc for small short lived tools if possible
    UTIL_ADD_JVM_ARG_IF_OK([-XX:+UseSerialGC],boot_jdk_jvmargs_small,[$JAVA])
    UTIL_ADD_JVM_ARG_IF_OK([-Xms32M],boot_jdk_jvmargs_small,[$JAVA])
<span class="line-new-header">--- 447,31 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 494,10 ***</span>
<span class="line-new-header">--- 481,15 ---</span>
    AC_MSG_RESULT([$boot_jdk_jvmargs_small])
  
    JAVA_FLAGS_SMALL=$boot_jdk_jvmargs_small
    AC_SUBST(JAVA_FLAGS_SMALL)
  
<span class="line-added">+   # Don&#39;t presuppose SerialGC is present in the buildjdk. Also, we cannot test</span>
<span class="line-added">+   # the buildjdk, but on the other hand we know what it will support.</span>
<span class="line-added">+   BUILDJDK_JAVA_FLAGS_SMALL=&quot;-Xms32M -Xmx512M -XX:TieredStopAtLevel=1&quot;</span>
<span class="line-added">+   AC_SUBST(BUILDJDK_JAVA_FLAGS_SMALL)</span>
<span class="line-added">+ </span>
    JAVA_TOOL_FLAGS_SMALL=&quot;&quot;
    for f in $JAVA_FLAGS_SMALL; do
      JAVA_TOOL_FLAGS_SMALL=&quot;$JAVA_TOOL_FLAGS_SMALL -J$f&quot;
    done
    AC_SUBST(JAVA_TOOL_FLAGS_SMALL)
</pre>
<center><a href="../ToolsLangtools.gmk.cdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="bootcycle-spec.gmk.in.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>