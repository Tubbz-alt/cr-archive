<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.incubator.foreign/share/classes/jdk/incubator/foreign/MemorySegment.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>src/jdk.incubator.foreign/share/classes/jdk/incubator/foreign/MemorySegment.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
261      * for the life-time of the segment.
262      *
263      * @param bb the byte buffer backing the buffer memory segment.
264      * @return a new memory segment. The memory source of the returned segment depends on the characteristics of {@code bb}. More specifically,
265      * if {@code bb} has been created with the {@link ByteBuffer#allocateDirect(int)} method, the resulting segment will be
266      * backed by a native memory source; if {@code bb} has been created with the {@link ByteBuffer#allocate(int)} method,
267      * the resulting sement will be backed by a heap memory source; finally, if {@code bb} has been created with the
268      * {@link FileChannel#map(FileChannel.MapMode, long, long)} method, the resulting segment  will be backed by a mapped memory source.
269      */
270     static MemorySegment ofByteBuffer(ByteBuffer bb) {
271         return Utils.makeBufferSegment(bb);
272     }
273 
274     /**
275      * Creates a new memory segment view of the memory associated with a given heap-allocated byte array.
276      * &lt;p&gt;
277      * The resulting memory segment keeps a reference to the backing array, to ensure it remains &lt;em&gt;reachable&lt;/em&gt;
278      * for the life-time of the segment.
279      *
280      * @param arr the primitive array backing the array memory segment.
<span class="line-modified">281      * @return a new memory segment backed by an heap memory source.</span>
282      */
283     static MemorySegment ofArray(byte[] arr) {
284         return Utils.makeArraySegment(arr);
285     }
286 
287     /**
288      * Creates a new memory segment view of the memory associated with a given heap-allocated char array.
289      * &lt;p&gt;
290      * The resulting memory segment keeps a reference to the backing array, to ensure it remains &lt;em&gt;reachable&lt;/em&gt;
291      * for the life-time of the segment.
292      *
293      * @param arr the primitive array backing the array memory segment.
294      * @return a new memory segment backed by an heap memory source.
295      */
296     static MemorySegment ofArray(char[] arr) {
297         return Utils.makeArraySegment(arr);
298     }
299 
300     /**
301      * Creates a new memory segment view of the memory associated with a given heap-allocated short array.
302      * &lt;p&gt;
303      * The resulting memory segment keeps a reference to the backing array, to ensure it remains &lt;em&gt;reachable&lt;/em&gt;
304      * for the life-time of the segment.
305      *
306      * @param arr the primitive array backing the array memory segment.
<span class="line-modified">307      * @return a new memory segment backed by an heap memory source.</span>
308      */
309     static MemorySegment ofArray(short[] arr) {
310         return Utils.makeArraySegment(arr);
311     }
312 
313     /**
314      * Creates a new memory segment view of the memory associated with a given heap-allocated int array.
315      * &lt;p&gt;
316      * The resulting memory segment keeps a reference to the backing array, to ensure it remains &lt;em&gt;reachable&lt;/em&gt;
317      * for the life-time of the segment.
318      *
319      * @param arr the primitive array backing the array memory segment.
320      * @return a new memory segment backed by an heap memory source.
321      */
322     static MemorySegment ofArray(int[] arr) {
323         return Utils.makeArraySegment(arr);
324     }
325 
326     /**
327      * Creates a new memory segment view of the memory associated with a given heap-allocated float array.
328      * &lt;p&gt;
329      * The resulting memory segment keeps a reference to the backing array, to ensure it remains &lt;em&gt;reachable&lt;/em&gt;
330      * for the life-time of the segment.
331      *
332      * @param arr the primitive array backing the array memory segment.
<span class="line-modified">333      * @return a new memory segment backed by an heap memory source.</span>
334      */
335     static MemorySegment ofArray(float[] arr) {
336         return Utils.makeArraySegment(arr);
337     }
338 
339     /**
340      * Creates a new memory segment view of the memory associated with a given heap-allocated long array.
341      * &lt;p&gt;
342      * The resulting memory segment keeps a reference to the backing array, to ensure it remains &lt;em&gt;reachable&lt;/em&gt;
343      * for the life-time of the segment.
344      *
345      * @param arr the primitive array backing the array memory segment.
346      * @return a new memory segment backed by an heap memory source.
347      */
348     static MemorySegment ofArray(long[] arr) {
349         return Utils.makeArraySegment(arr);
350     }
351 
352     /**
353      * Creates a new memory segment view of the memory associated with a given heap-allocated double array.
354      * &lt;p&gt;
355      * The resulting memory segment keeps a reference to the backing array, to ensure it remains &lt;em&gt;reachable&lt;/em&gt;
356      * for the life-time of the segment.
357      *
358      * @param arr the primitive array backing the array memory segment.
<span class="line-modified">359      * @return a new memory segment backed by an heap memory source.</span>
360      */
361     static MemorySegment ofArray(double[] arr) {
362         return Utils.makeArraySegment(arr);
363     }
364 
365     /**
366      * Creates a new native memory segment that models a newly allocated block of off-heap memory with given layout.
367      * &lt;p&gt;
368      * This is equivalent to the following code:
369      * &lt;blockquote&gt;&lt;pre&gt;{@code
370     allocateNative(layout.bytesSize(), layout.bytesAlignment());
371      * }&lt;/pre&gt;&lt;/blockquote&gt;
372      *
373      * @implNote The block of off-heap memory associated with the returned native memory segment is initialized to zero.
374      * Moreover, a client is responsible to call the {@link MemorySegment#close()} on a native memory segment,
375      * to make sure the backing off-heap memory block is deallocated accordingly. Failure to do so will result in off-heap memory leaks.
376      *
377      * @param layout the layout of the off-heap memory block backing the native memory segment.
378      * @return a new memory segment backed by a native memory source.
379      * @throws IllegalArgumentException if the specified layout has illegal size or alignment constraint.
</pre>
</td>
<td>
<hr />
<pre>
261      * for the life-time of the segment.
262      *
263      * @param bb the byte buffer backing the buffer memory segment.
264      * @return a new memory segment. The memory source of the returned segment depends on the characteristics of {@code bb}. More specifically,
265      * if {@code bb} has been created with the {@link ByteBuffer#allocateDirect(int)} method, the resulting segment will be
266      * backed by a native memory source; if {@code bb} has been created with the {@link ByteBuffer#allocate(int)} method,
267      * the resulting sement will be backed by a heap memory source; finally, if {@code bb} has been created with the
268      * {@link FileChannel#map(FileChannel.MapMode, long, long)} method, the resulting segment  will be backed by a mapped memory source.
269      */
270     static MemorySegment ofByteBuffer(ByteBuffer bb) {
271         return Utils.makeBufferSegment(bb);
272     }
273 
274     /**
275      * Creates a new memory segment view of the memory associated with a given heap-allocated byte array.
276      * &lt;p&gt;
277      * The resulting memory segment keeps a reference to the backing array, to ensure it remains &lt;em&gt;reachable&lt;/em&gt;
278      * for the life-time of the segment.
279      *
280      * @param arr the primitive array backing the array memory segment.
<span class="line-modified">281      * @return a new memory segment backed by a heap memory source.</span>
282      */
283     static MemorySegment ofArray(byte[] arr) {
284         return Utils.makeArraySegment(arr);
285     }
286 
287     /**
288      * Creates a new memory segment view of the memory associated with a given heap-allocated char array.
289      * &lt;p&gt;
290      * The resulting memory segment keeps a reference to the backing array, to ensure it remains &lt;em&gt;reachable&lt;/em&gt;
291      * for the life-time of the segment.
292      *
293      * @param arr the primitive array backing the array memory segment.
294      * @return a new memory segment backed by an heap memory source.
295      */
296     static MemorySegment ofArray(char[] arr) {
297         return Utils.makeArraySegment(arr);
298     }
299 
300     /**
301      * Creates a new memory segment view of the memory associated with a given heap-allocated short array.
302      * &lt;p&gt;
303      * The resulting memory segment keeps a reference to the backing array, to ensure it remains &lt;em&gt;reachable&lt;/em&gt;
304      * for the life-time of the segment.
305      *
306      * @param arr the primitive array backing the array memory segment.
<span class="line-modified">307      * @return a new memory segment backed by a heap memory source.</span>
308      */
309     static MemorySegment ofArray(short[] arr) {
310         return Utils.makeArraySegment(arr);
311     }
312 
313     /**
314      * Creates a new memory segment view of the memory associated with a given heap-allocated int array.
315      * &lt;p&gt;
316      * The resulting memory segment keeps a reference to the backing array, to ensure it remains &lt;em&gt;reachable&lt;/em&gt;
317      * for the life-time of the segment.
318      *
319      * @param arr the primitive array backing the array memory segment.
320      * @return a new memory segment backed by an heap memory source.
321      */
322     static MemorySegment ofArray(int[] arr) {
323         return Utils.makeArraySegment(arr);
324     }
325 
326     /**
327      * Creates a new memory segment view of the memory associated with a given heap-allocated float array.
328      * &lt;p&gt;
329      * The resulting memory segment keeps a reference to the backing array, to ensure it remains &lt;em&gt;reachable&lt;/em&gt;
330      * for the life-time of the segment.
331      *
332      * @param arr the primitive array backing the array memory segment.
<span class="line-modified">333      * @return a new memory segment backed by a heap memory source.</span>
334      */
335     static MemorySegment ofArray(float[] arr) {
336         return Utils.makeArraySegment(arr);
337     }
338 
339     /**
340      * Creates a new memory segment view of the memory associated with a given heap-allocated long array.
341      * &lt;p&gt;
342      * The resulting memory segment keeps a reference to the backing array, to ensure it remains &lt;em&gt;reachable&lt;/em&gt;
343      * for the life-time of the segment.
344      *
345      * @param arr the primitive array backing the array memory segment.
346      * @return a new memory segment backed by an heap memory source.
347      */
348     static MemorySegment ofArray(long[] arr) {
349         return Utils.makeArraySegment(arr);
350     }
351 
352     /**
353      * Creates a new memory segment view of the memory associated with a given heap-allocated double array.
354      * &lt;p&gt;
355      * The resulting memory segment keeps a reference to the backing array, to ensure it remains &lt;em&gt;reachable&lt;/em&gt;
356      * for the life-time of the segment.
357      *
358      * @param arr the primitive array backing the array memory segment.
<span class="line-modified">359      * @return a new memory segment backed by a heap memory source.</span>
360      */
361     static MemorySegment ofArray(double[] arr) {
362         return Utils.makeArraySegment(arr);
363     }
364 
365     /**
366      * Creates a new native memory segment that models a newly allocated block of off-heap memory with given layout.
367      * &lt;p&gt;
368      * This is equivalent to the following code:
369      * &lt;blockquote&gt;&lt;pre&gt;{@code
370     allocateNative(layout.bytesSize(), layout.bytesAlignment());
371      * }&lt;/pre&gt;&lt;/blockquote&gt;
372      *
373      * @implNote The block of off-heap memory associated with the returned native memory segment is initialized to zero.
374      * Moreover, a client is responsible to call the {@link MemorySegment#close()} on a native memory segment,
375      * to make sure the backing off-heap memory block is deallocated accordingly. Failure to do so will result in off-heap memory leaks.
376      *
377      * @param layout the layout of the off-heap memory block backing the native memory segment.
378      * @return a new memory segment backed by a native memory source.
379      * @throws IllegalArgumentException if the specified layout has illegal size or alignment constraint.
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>