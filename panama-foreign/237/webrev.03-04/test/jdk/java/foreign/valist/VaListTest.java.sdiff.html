<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/foreign/valist/VaListTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../src/jdk.incubator.foreign/share/classes/jdk/internal/foreign/abi/x64/windows/WinVaList.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>test/jdk/java/foreign/valist/VaListTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
301         try (NativeScope scope = NativeScope.unboundedScope()) {
302             try (MemorySegment pointIn = MemorySegment.allocateNative(Point_LAYOUT)) {
303                 VH_Point_x.set(pointIn.baseAddress(), 3);
304                 VH_Point_y.set(pointIn.baseAddress(), 6);
305                 try (VaList list = CSupport.VaList.make(b -&gt; b.vargFromSegment(Point_LAYOUT, pointIn))) {
306                     pointOut = list.vargAsSegment(Point_LAYOUT, scope);
307                     assertEquals((int) VH_Point_x.get(pointOut.baseAddress()), 3);
308                     assertEquals((int) VH_Point_y.get(pointOut.baseAddress()), 6);
309                 }
310                 assertTrue(pointOut.isAlive()); // after VaList freed
311             }
312             assertTrue(pointOut.isAlive()); // after input MS freed
313         }
314         assertFalse(pointOut.isAlive()); // after scope freed
315     }
316 
317     @Test
318     public void testScopedCopy() {
319         try (VaList list = VaList.make(b -&gt; b.vargFromInt(C_INT, 4)
320                                              .vargFromInt(C_INT, 8))) {

321             try (NativeScope scope = NativeScope.unboundedScope()) {
<span class="line-modified">322                 VaList copy = list.copy(scope);</span>
323 
324                 assertEquals(copy.vargAsInt(C_INT), 4);
325                 assertEquals(copy.vargAsInt(C_INT), 8);
326             }


327             assertEquals(list.vargAsInt(C_INT), 4);
328             assertEquals(list.vargAsInt(C_INT), 8);
329         }
330     }
331 
332     @Test(expectedExceptions = IllegalStateException.class)
333     public void testCopyUnusableAfterOriginalClosed() {
334         VaList list = VaList.make(b -&gt; b.vargFromInt(C_INT, 4)
335                                         .vargFromInt(C_INT, 8));
336         try (VaList copy = list.copy()) {
337             list.close();
338 
339             copy.vargAsInt(C_INT); // should throw
340         }
341     }
342 
343     @Test(expectedExceptions = IllegalStateException.class)
344     public void testCopyUnusableAfterOriginalClosedScope() {
345         VaList list = VaList.make(b -&gt; b.vargFromInt(C_INT, 4)
346                                         .vargFromInt(C_INT, 8));
</pre>
</td>
<td>
<hr />
<pre>
301         try (NativeScope scope = NativeScope.unboundedScope()) {
302             try (MemorySegment pointIn = MemorySegment.allocateNative(Point_LAYOUT)) {
303                 VH_Point_x.set(pointIn.baseAddress(), 3);
304                 VH_Point_y.set(pointIn.baseAddress(), 6);
305                 try (VaList list = CSupport.VaList.make(b -&gt; b.vargFromSegment(Point_LAYOUT, pointIn))) {
306                     pointOut = list.vargAsSegment(Point_LAYOUT, scope);
307                     assertEquals((int) VH_Point_x.get(pointOut.baseAddress()), 3);
308                     assertEquals((int) VH_Point_y.get(pointOut.baseAddress()), 6);
309                 }
310                 assertTrue(pointOut.isAlive()); // after VaList freed
311             }
312             assertTrue(pointOut.isAlive()); // after input MS freed
313         }
314         assertFalse(pointOut.isAlive()); // after scope freed
315     }
316 
317     @Test
318     public void testScopedCopy() {
319         try (VaList list = VaList.make(b -&gt; b.vargFromInt(C_INT, 4)
320                                              .vargFromInt(C_INT, 8))) {
<span class="line-added">321             VaList copy;</span>
322             try (NativeScope scope = NativeScope.unboundedScope()) {
<span class="line-modified">323                 copy = list.copy(scope);</span>
324 
325                 assertEquals(copy.vargAsInt(C_INT), 4);
326                 assertEquals(copy.vargAsInt(C_INT), 8);
327             }
<span class="line-added">328             assertFalse(copy.isAlive());</span>
<span class="line-added">329 </span>
330             assertEquals(list.vargAsInt(C_INT), 4);
331             assertEquals(list.vargAsInt(C_INT), 8);
332         }
333     }
334 
335     @Test(expectedExceptions = IllegalStateException.class)
336     public void testCopyUnusableAfterOriginalClosed() {
337         VaList list = VaList.make(b -&gt; b.vargFromInt(C_INT, 4)
338                                         .vargFromInt(C_INT, 8));
339         try (VaList copy = list.copy()) {
340             list.close();
341 
342             copy.vargAsInt(C_INT); // should throw
343         }
344     }
345 
346     @Test(expectedExceptions = IllegalStateException.class)
347     public void testCopyUnusableAfterOriginalClosedScope() {
348         VaList list = VaList.make(b -&gt; b.vargFromInt(C_INT, 4)
349                                         .vargFromInt(C_INT, 8));
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../src/jdk.incubator.foreign/share/classes/jdk/internal/foreign/abi/x64/windows/WinVaList.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>