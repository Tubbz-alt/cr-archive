<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/foreign/valist/VaListTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>test/jdk/java/foreign/valist/VaListTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
297 
298     @Test
299     public void testScopeMSRead() {
300         MemorySegment pointOut;
301         try (NativeScope scope = NativeScope.unboundedScope()) {
302             try (MemorySegment pointIn = MemorySegment.allocateNative(Point_LAYOUT)) {
303                 VH_Point_x.set(pointIn.baseAddress(), 3);
304                 VH_Point_y.set(pointIn.baseAddress(), 6);
305                 try (VaList list = CSupport.VaList.make(b -&gt; b.vargFromSegment(Point_LAYOUT, pointIn))) {
306                     pointOut = list.vargAsSegment(Point_LAYOUT, scope);
307                     assertEquals((int) VH_Point_x.get(pointOut.baseAddress()), 3);
308                     assertEquals((int) VH_Point_y.get(pointOut.baseAddress()), 6);
309                 }
310                 assertTrue(pointOut.isAlive()); // after VaList freed
311             }
312             assertTrue(pointOut.isAlive()); // after input MS freed
313         }
314         assertFalse(pointOut.isAlive()); // after scope freed
315     }
316 
















317     @Test
318     public void testScopedCopy() {
319         try (VaList list = VaList.make(b -&gt; b.vargFromInt(C_INT, 4)
320                                              .vargFromInt(C_INT, 8))) {
321             VaList copy;
322             try (NativeScope scope = NativeScope.unboundedScope()) {
323                 copy = list.copy(scope);
324 
325                 assertEquals(copy.vargAsInt(C_INT), 4);
326                 assertEquals(copy.vargAsInt(C_INT), 8);
327             }
328             assertFalse(copy.isAlive());
329 
330             assertEquals(list.vargAsInt(C_INT), 4);
331             assertEquals(list.vargAsInt(C_INT), 8);
332         }
333     }
334 
335     @Test(expectedExceptions = IllegalStateException.class)
336     public void testCopyUnusableAfterOriginalClosed() {
</pre>
</td>
<td>
<hr />
<pre>
297 
298     @Test
299     public void testScopeMSRead() {
300         MemorySegment pointOut;
301         try (NativeScope scope = NativeScope.unboundedScope()) {
302             try (MemorySegment pointIn = MemorySegment.allocateNative(Point_LAYOUT)) {
303                 VH_Point_x.set(pointIn.baseAddress(), 3);
304                 VH_Point_y.set(pointIn.baseAddress(), 6);
305                 try (VaList list = CSupport.VaList.make(b -&gt; b.vargFromSegment(Point_LAYOUT, pointIn))) {
306                     pointOut = list.vargAsSegment(Point_LAYOUT, scope);
307                     assertEquals((int) VH_Point_x.get(pointOut.baseAddress()), 3);
308                     assertEquals((int) VH_Point_y.get(pointOut.baseAddress()), 6);
309                 }
310                 assertTrue(pointOut.isAlive()); // after VaList freed
311             }
312             assertTrue(pointOut.isAlive()); // after input MS freed
313         }
314         assertFalse(pointOut.isAlive()); // after scope freed
315     }
316 
<span class="line-added">317     @Test</span>
<span class="line-added">318     public void testCopy() {</span>
<span class="line-added">319         try (VaList list = VaList.make(b -&gt; b.vargFromInt(C_INT, 4)</span>
<span class="line-added">320                                              .vargFromInt(C_INT, 8))) {</span>
<span class="line-added">321             VaList  copy = list.copy();</span>
<span class="line-added">322             assertEquals(copy.vargAsInt(C_INT), 4);</span>
<span class="line-added">323             assertEquals(copy.vargAsInt(C_INT), 8);</span>
<span class="line-added">324             copy.close();</span>
<span class="line-added">325 </span>
<span class="line-added">326             assertFalse(copy.isAlive());</span>
<span class="line-added">327 </span>
<span class="line-added">328             assertEquals(list.vargAsInt(C_INT), 4);</span>
<span class="line-added">329             assertEquals(list.vargAsInt(C_INT), 8);</span>
<span class="line-added">330         }</span>
<span class="line-added">331     }</span>
<span class="line-added">332 </span>
333     @Test
334     public void testScopedCopy() {
335         try (VaList list = VaList.make(b -&gt; b.vargFromInt(C_INT, 4)
336                                              .vargFromInt(C_INT, 8))) {
337             VaList copy;
338             try (NativeScope scope = NativeScope.unboundedScope()) {
339                 copy = list.copy(scope);
340 
341                 assertEquals(copy.vargAsInt(C_INT), 4);
342                 assertEquals(copy.vargAsInt(C_INT), 8);
343             }
344             assertFalse(copy.isAlive());
345 
346             assertEquals(list.vargAsInt(C_INT), 4);
347             assertEquals(list.vargAsInt(C_INT), 8);
348         }
349     }
350 
351     @Test(expectedExceptions = IllegalStateException.class)
352     public void testCopyUnusableAfterOriginalClosed() {
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>