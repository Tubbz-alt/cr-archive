<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/hotspot/jtreg/gc/metaspace/TestSizeTransitions.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../compiler/compilercontrol/share/scenario/Scenario.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../shenandoah/TestObjItrWithHeapDump.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/gc/metaspace/TestSizeTransitions.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 77,17 ***</span>
    // matches a size transition
    //   e.g., 177K(4864K)-&gt;177K(4864K)
    private static final String SIZE_TRANSITION_REGEX = &quot;\\d+K\\(\\d+K\\)-&gt;\\d+K\\(\\d+K\\)&quot;;
  
    // matches -coops metaspace size transitions
<span class="line-modified">!   private static final String NO_COOPS_REGEX =</span>
      String.format(&quot;^%s.* Metaspace: %s$&quot;,
                    LOG_TAGS_REGEX,
                    SIZE_TRANSITION_REGEX);
  
    // matches +coops metaspace size transitions
<span class="line-modified">!   private static final String COOPS_REGEX =</span>
      String.format(&quot;^%s.* Metaspace: %s NonClass: %s Class: %s$&quot;,
                    LOG_TAGS_REGEX,
                    SIZE_TRANSITION_REGEX,
                    SIZE_TRANSITION_REGEX,
                    SIZE_TRANSITION_REGEX);
<span class="line-new-header">--- 77,17 ---</span>
    // matches a size transition
    //   e.g., 177K(4864K)-&gt;177K(4864K)
    private static final String SIZE_TRANSITION_REGEX = &quot;\\d+K\\(\\d+K\\)-&gt;\\d+K\\(\\d+K\\)&quot;;
  
    // matches -coops metaspace size transitions
<span class="line-modified">!   private static final String NO_COMPRESSED_KLASS_POINTERS_REGEX =</span>
      String.format(&quot;^%s.* Metaspace: %s$&quot;,
                    LOG_TAGS_REGEX,
                    SIZE_TRANSITION_REGEX);
  
    // matches +coops metaspace size transitions
<span class="line-modified">!   private static final String COMPRESSED_KLASS_POINTERS_REGEX =</span>
      String.format(&quot;^%s.* Metaspace: %s NonClass: %s Class: %s$&quot;,
                    LOG_TAGS_REGEX,
                    SIZE_TRANSITION_REGEX,
                    SIZE_TRANSITION_REGEX,
                    SIZE_TRANSITION_REGEX);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 96,23 ***</span>
      // args: &lt;use-coops&gt; &lt;gc-arg&gt;
      if (args.length != 2) {
        throw new RuntimeException(&quot;wrong number of args: &quot; + args.length);
      }
  
<span class="line-modified">!     final boolean hasCoops = Platform.is64bit();</span>
<span class="line-modified">!     final boolean useCoops = Boolean.parseBoolean(args[0]);</span>
      final String gcArg = args[1];
  
<span class="line-modified">!     if (!hasCoops &amp;&amp; useCoops) {</span>
         // No need to run this configuration.
         System.out.println(&quot;Skipping test.&quot;);
         return;
      }
  
      List&lt;String&gt; jvmArgs = new ArrayList&lt;&gt;();
<span class="line-modified">!     if (hasCoops) {</span>
<span class="line-modified">!       jvmArgs.add(useCoops ? &quot;-XX:+UseCompressedOops&quot; : &quot;-XX:-UseCompressedOops&quot;);</span>
      }
      jvmArgs.add(gcArg);
      jvmArgs.add(&quot;-Xmx256m&quot;);
      jvmArgs.add(&quot;-Xlog:gc,gc+metaspace=info&quot;);
      jvmArgs.add(TestSizeTransitions.Run.class.getName());
<span class="line-new-header">--- 96,23 ---</span>
      // args: &lt;use-coops&gt; &lt;gc-arg&gt;
      if (args.length != 2) {
        throw new RuntimeException(&quot;wrong number of args: &quot; + args.length);
      }
  
<span class="line-modified">!     final boolean hasCompressedKlassPointers = Platform.is64bit();</span>
<span class="line-modified">!     final boolean useCompressedKlassPointers = Boolean.parseBoolean(args[0]);</span>
      final String gcArg = args[1];
  
<span class="line-modified">!     if (!hasCompressedKlassPointers &amp;&amp; useCompressedKlassPointers) {</span>
         // No need to run this configuration.
         System.out.println(&quot;Skipping test.&quot;);
         return;
      }
  
      List&lt;String&gt; jvmArgs = new ArrayList&lt;&gt;();
<span class="line-modified">!     if (hasCompressedKlassPointers) {</span>
<span class="line-modified">!       jvmArgs.add(useCompressedKlassPointers ? &quot;-XX:+UseCompressedClassPointers&quot; : &quot;-XX:-UseCompressedClassPointers&quot;);</span>
      }
      jvmArgs.add(gcArg);
      jvmArgs.add(&quot;-Xmx256m&quot;);
      jvmArgs.add(&quot;-Xlog:gc,gc+metaspace=info&quot;);
      jvmArgs.add(TestSizeTransitions.Run.class.getName());
</pre>
<hr />
<pre>
<span class="line-old-header">*** 125,14 ***</span>
      final ProcessBuilder pb = ProcessTools.createJavaProcessBuilder(jvmArgs);
      final OutputAnalyzer output = new OutputAnalyzer(pb.start());
      System.out.println(output.getStdout());
      output.shouldHaveExitValue(0);
  
<span class="line-modified">!     if (useCoops) {</span>
<span class="line-modified">!       output.stdoutShouldMatch(COOPS_REGEX);</span>
<span class="line-modified">!       output.stdoutShouldNotMatch(NO_COOPS_REGEX);</span>
      } else {
<span class="line-modified">!       output.stdoutShouldMatch(NO_COOPS_REGEX);</span>
<span class="line-modified">!       output.stdoutShouldNotMatch(COOPS_REGEX);</span>
      }
    }
  }
<span class="line-new-header">--- 125,14 ---</span>
      final ProcessBuilder pb = ProcessTools.createJavaProcessBuilder(jvmArgs);
      final OutputAnalyzer output = new OutputAnalyzer(pb.start());
      System.out.println(output.getStdout());
      output.shouldHaveExitValue(0);
  
<span class="line-modified">!     if (useCompressedKlassPointers) {</span>
<span class="line-modified">!       output.stdoutShouldMatch(COMPRESSED_KLASS_POINTERS_REGEX);</span>
<span class="line-modified">!       output.stdoutShouldNotMatch(NO_COMPRESSED_KLASS_POINTERS_REGEX);</span>
      } else {
<span class="line-modified">!       output.stdoutShouldMatch(NO_COMPRESSED_KLASS_POINTERS_REGEX);</span>
<span class="line-modified">!       output.stdoutShouldNotMatch(COMPRESSED_KLASS_POINTERS_REGEX);</span>
      }
    }
  }
</pre>
<center><a href="../../compiler/compilercontrol/share/scenario/Scenario.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../shenandoah/TestObjItrWithHeapDump.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>