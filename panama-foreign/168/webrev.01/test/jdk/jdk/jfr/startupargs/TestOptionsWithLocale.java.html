<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/jdk/jfr/startupargs/TestOptionsWithLocale.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
 1 package jdk.jfr.startupargs;
 2 
 3 import java.io.IOException;
 4 import java.text.DateFormat;
 5 import java.util.Calendar;
 6 import java.util.GregorianCalendar;
 7 
 8 import jdk.test.lib.process.OutputAnalyzer;
 9 import jdk.test.lib.process.ProcessTools;
10 
11 /**
12  * @test
13  * @summary Checks that locale is respected when using -XX:FlightRecorderOptions
14  *          See JDK-8244508
15  * @key jfr
16  * @requires vm.hasJFR
17  * @modules jdk.jfr
18  * @library /test/lib
19  * @run main/othervm jdk.jfr.startupargs.TestOptionsWithLocale
20  */
21 public class TestOptionsWithLocale {
22 
23     public static class PrintDate {
24         public static void main(String... args) {
25             GregorianCalendar date = new GregorianCalendar(2020, Calendar.JANUARY, 1);
26             DateFormat formatter = DateFormat.getDateTimeInstance();
27             System.out.println(formatter.format(date.getTime()));
28         }
29     }
30 
31     public static void main(String... args) throws IOException {
32         // Can only run test if jdk.localedata is available.
33         // Can&#39;t specify @module jdk.jfr jdk.localedata, because
34         // --limit-modules jdk.jfr,jdk.localedata prevents the product issue.
35         if (ModuleLayer.boot().findModule(&quot;jdk.localedata&quot;).isEmpty()) {
36             return;
37         }
38 
39         ProcessBuilder pb = ProcessTools.createTestJvm(
40                 &quot;-Duser.country=DE&quot;,
41                 &quot;-Duser.language=de&quot;,
42                 &quot;-XX:FlightRecorderOptions:stackdepth=128&quot;,
43                 PrintDate.class.getName());
44         OutputAnalyzer output = new OutputAnalyzer(pb.start());
45         output.shouldContain(&quot;01.01.2020, 00:00:00&quot;);
46     }
47 }
    </pre>
  </body>
</html>