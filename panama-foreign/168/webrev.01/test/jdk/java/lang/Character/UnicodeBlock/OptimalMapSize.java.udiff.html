<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/java/lang/Character/UnicodeBlock/OptimalMapSize.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../ProblemList.txt.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../text/Normalizer/ConformanceTest.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/lang/Character/UnicodeBlock/OptimalMapSize.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2015, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -21,11 +21,11 @@</span>
   * questions.
   */
  
  /**
   * @test
<span class="udiff-line-modified-removed">-  * @bug 8080535 8191410 8215194 8221431</span>
<span class="udiff-line-modified-added">+  * @bug 8080535 8191410 8215194 8221431 8239383</span>
   * @summary Expected size of Character.UnicodeBlock.map is not optimal
   * @library /test/lib
   * @modules java.base/java.lang:open
   *          java.base/java.util:open
   * @build jdk.test.lib.util.OptimalCapacity
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -45,26 +45,27 @@</span>
  // After implementing support of Unicode 9 and 10 in Java, there will
  // be 638 entries in Character.UnicodeBlock.map.
  //
  // As of Unicode 11, 667 entries are expected.
  // As of Unicode 12.1, 676 entries are expected.
<span class="udiff-line-added">+ // As of Unicode 13.0, 684 entries are expected.</span>
  //
  // Initialization of the map and this test will have to be adjusted
  // accordingly then.
  //
  // Note that HashMap&#39;s implementation aligns the initial capacity to
  // a power of two size, so it will end up 1024 (and thus succeed) in
<span class="udiff-line-modified-removed">- // cases, such as 638, 667, and 676.</span>
<span class="udiff-line-modified-added">+ // cases, such as 638, 667, 676, and 684.</span>
  
  public class OptimalMapSize {
      public static void main(String[] args) throws Throwable {
          // The initial size of Character.UnicodeBlock.map.
          // See src/java.base/share/classes/java/lang/Character.java
          Field f = Character.UnicodeBlock.class.getDeclaredField(&quot;NUM_ENTITIES&quot;);
          f.setAccessible(true);
          int num_entities = f.getInt(null);
<span class="udiff-line-modified-removed">-         assert num_entities == 676;</span>
<span class="udiff-line-modified-added">+         assert num_entities == 684;</span>
          int initialCapacity = (int)(num_entities / 0.75f + 1.0f);
  
          OptimalCapacity.ofHashMap(Character.UnicodeBlock.class,
                  &quot;map&quot;, initialCapacity);
      }
</pre>
<center><a href="../../../../ProblemList.txt.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../text/Normalizer/ConformanceTest.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>