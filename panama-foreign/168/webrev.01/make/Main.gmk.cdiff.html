<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff make/Main.gmk</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="Images.gmk.cdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="MainSupport.gmk.cdiff.html" target="_top">next &gt;</a></center>    <h2>make/Main.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 36,17 ***</span>
  endif
  
  # Now load the spec
  include $(SPEC)
  
<span class="line-removed">- include $(TOPDIR)/make/MainSupport.gmk</span>
<span class="line-removed">- </span>
  # Load the vital tools for all the makefiles.
  include $(TOPDIR)/make/common/MakeBase.gmk
  include $(TOPDIR)/make/common/Modules.gmk
  include $(TOPDIR)/make/common/FindTests.gmk
  
  # Declare ALL_TARGETS as an immediate variable. This variable is a list of all
  # valid top level targets. It&#39;s used to declare them all as PHONY and to
  # generate the -only targets.
  ALL_TARGETS :=
  
<span class="line-new-header">--- 36,22 ---</span>
  endif
  
  # Now load the spec
  include $(SPEC)
  
  # Load the vital tools for all the makefiles.
  include $(TOPDIR)/make/common/MakeBase.gmk
  include $(TOPDIR)/make/common/Modules.gmk
  include $(TOPDIR)/make/common/FindTests.gmk
  
<span class="line-added">+ include $(TOPDIR)/make/MainSupport.gmk</span>
<span class="line-added">+ </span>
<span class="line-added">+ # Are we requested to ignore dependencies?</span>
<span class="line-added">+ ifneq ($(findstring -only, $(MAKECMDGOALS)), )</span>
<span class="line-added">+   DEPS := none</span>
<span class="line-added">+ endif</span>
<span class="line-added">+ </span>
  # Declare ALL_TARGETS as an immediate variable. This variable is a list of all
  # valid top level targets. It&#39;s used to declare them all as PHONY and to
  # generate the -only targets.
  ALL_TARGETS :=
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 64,40 ***</span>
  ################################################################################
  
  ################################################################################
  # Interim/build tools targets, compiling tools used during the build
  
<span class="line-modified">! buildtools-langtools:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ToolsLangtools.gmk)</span>
<span class="line-modified">! </span>
<span class="line-removed">- interim-langtools:</span>
<span class="line-removed">- 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileInterimLangtools.gmk)</span>
<span class="line-removed">- </span>
<span class="line-removed">- interim-tzdb:</span>
<span class="line-removed">- 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CopyInterimTZDB.gmk)</span>
  
  
<span class="line-modified">! buildtools-jdk:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileToolsJdk.gmk)</span>
  
<span class="line-modified">! buildtools-modules:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileModuleTools.gmk)</span>
  
<span class="line-modified">! buildtools-hotspot:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileToolsHotspot.gmk)</span>
  
<span class="line-modified">! ALL_TARGETS += buildtools-langtools interim-langtools \</span>
<span class="line-modified">!     interim-tzdb buildtools-jdk buildtools-modules \</span>
<span class="line-modified">!     buildtools-hotspot</span>
  
  ################################################################################
  # Special targets for certain modules
  
<span class="line-modified">! generate-exported-symbols:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f BuildStatic.gmk)</span>
<span class="line-modified">! </span>
<span class="line-modified">! ALL_TARGETS += generate-exported-symbols</span>
  
  ################################################################################
  # Gensrc targets, generating source before java compilation can be done
  #
  $(eval $(call DeclareRecipesForPhase, GENSRC, \
<span class="line-new-header">--- 69,44 ---</span>
  ################################################################################
  
  ################################################################################
  # Interim/build tools targets, compiling tools used during the build
  
<span class="line-modified">! $(eval $(call SetupTarget, buildtools-langtools, \</span>
<span class="line-modified">!     MAKEFILE := ToolsLangtools, \</span>
<span class="line-modified">! ))</span>
  
<span class="line-added">+ $(eval $(call SetupTarget, interim-langtools, \</span>
<span class="line-added">+     MAKEFILE := CompileInterimLangtools, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, interim-tzdb, \</span>
<span class="line-modified">!     MAKEFILE := CopyInterimTZDB, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, buildtools-jdk, \</span>
<span class="line-modified">!     MAKEFILE := CompileToolsJdk, \</span>
<span class="line-added">+     DEPS := interim-langtools interim-tzdb, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, buildtools-modules, \</span>
<span class="line-modified">!     MAKEFILE := CompileModuleTools, \</span>
<span class="line-added">+     DEPS := exploded-image-base, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, buildtools-hotspot, \</span>
<span class="line-modified">!     MAKEFILE := CompileToolsHotspot, \</span>
<span class="line-modified">!     DEPS := interim-langtools, \</span>
<span class="line-added">+ ))</span>
  
  ################################################################################
  # Special targets for certain modules
  
<span class="line-modified">! $(eval $(call SetupTarget, generate-exported-symbols, \</span>
<span class="line-modified">!     MAKEFILE := BuildStatic, \</span>
<span class="line-modified">!     DEPS := java.base-libs jdk.jdwp.agent-libs, \</span>
<span class="line-modified">! ))</span>
  
  ################################################################################
  # Gensrc targets, generating source before java compilation can be done
  #
  $(eval $(call DeclareRecipesForPhase, GENSRC, \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 249,15 ***</span>
  	    JVM_VARIANT=$1)
  endef
  
  $(foreach v, $(JVM_VARIANTS), $(eval $(call DeclareHotspotLibsRecipe,$v)))
  
<span class="line-modified">! hotspot-ide-project:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make/hotspot &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ide/CreateVSProject.gmk)</span>
  
  ALL_TARGETS += $(HOTSPOT_VARIANT_TARGETS) $(HOTSPOT_VARIANT_GENSRC_TARGETS) \
<span class="line-modified">!     $(HOTSPOT_VARIANT_LIBS_TARGETS) hotspot-ide-project</span>
  
  ################################################################################
  # Generate libs and launcher targets for creating compile_commands.json fragments
  define DeclareCompileCommandsRecipe
    $1-compile-commands:
<span class="line-new-header">--- 258,17 ---</span>
  	    JVM_VARIANT=$1)
  endef
  
  $(foreach v, $(JVM_VARIANTS), $(eval $(call DeclareHotspotLibsRecipe,$v)))
  
<span class="line-modified">! $(eval $(call SetupTarget, hotspot-ide-project, \</span>
<span class="line-modified">!     MAKEFILE := hotspot/ide/CreateVSProject, \</span>
<span class="line-added">+     DEPS := hotspot exploded-image, \</span>
<span class="line-added">+ ))</span>
  
  ALL_TARGETS += $(HOTSPOT_VARIANT_TARGETS) $(HOTSPOT_VARIANT_GENSRC_TARGETS) \
<span class="line-modified">!     $(HOTSPOT_VARIANT_LIBS_TARGETS)</span>
  
  ################################################################################
  # Generate libs and launcher targets for creating compile_commands.json fragments
  define DeclareCompileCommandsRecipe
    $1-compile-commands:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 274,55 ***</span>
  
  $(foreach t, $(LIBS_TARGETS) $(LAUNCHER_TARGETS), \
    $(eval $(call DeclareCompileCommandsRecipe,$t,JDK)) \
  )
  
<span class="line-modified">! compile-commands compile-commands-hotspot:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileCommands.gmk)</span>
  
  ALL_TARGETS += $(COMPILE_COMMANDS_TARGETS_HOTSPOT) $(COMPILE_COMMANDS_TARGETS_JDK)
<span class="line-removed">- ALL_TARGETS += compile-commands compile-commands-hotspot</span>
  
  ################################################################################
  # VS Code projects
<span class="line-removed">- vscode-project:</span>
<span class="line-removed">- 	+($(CD) $(TOPDIR)/make/vscode &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateVSCodeProject.gmk \</span>
<span class="line-removed">-       VSCODE_INDEXER=cpptools)</span>
  
<span class="line-modified">! vscode-project-clangd:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make/vscode &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateVSCodeProject.gmk \</span>
<span class="line-modified">!       VSCODE_INDEXER=clangd)</span>
  
<span class="line-modified">! vscode-project-rtags:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make/vscode &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateVSCodeProject.gmk \</span>
<span class="line-modified">!       VSCODE_INDEXER=rtags)</span>
  
<span class="line-modified">! vscode-project-ccls:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make/vscode &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateVSCodeProject.gmk \</span>
<span class="line-modified">!       VSCODE_INDEXER=ccls)</span>
  
<span class="line-modified">! ALL_TARGETS += vscode-project vscode-project-clangd vscode-project-rtags \</span>
<span class="line-modified">!   vscode-project-ccls</span>
  
  ################################################################################
  # Build demos targets
  
<span class="line-modified">! demos-jdk:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileDemos.gmk)</span>
<span class="line-modified">! </span>
<span class="line-modified">! test-image-demos-jdk:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileDemos.gmk images)</span>
  
<span class="line-modified">! ALL_TARGETS += demos-jdk test-image-demos-jdk</span>
  
  ################################################################################
  # Jigsaw specific data and analysis targets.
  
<span class="line-modified">! generate-summary:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GenerateModuleSummary.gmk)</span>
<span class="line-modified">! </span>
<span class="line-modified">! ALL_TARGETS += generate-summary</span>
  
  ################################################################################
  # Jmod targets
  
  JMOD_MODULES := $(ALL_MODULES)
<span class="line-new-header">--- 285,71 ---</span>
  
  $(foreach t, $(LIBS_TARGETS) $(LAUNCHER_TARGETS), \
    $(eval $(call DeclareCompileCommandsRecipe,$t,JDK)) \
  )
  
<span class="line-modified">! $(eval $(call SetupTarget, compile-commands, \</span>
<span class="line-modified">!     MAKEFILE := CompileCommands, \</span>
<span class="line-added">+ ))</span>
<span class="line-added">+ </span>
<span class="line-added">+ $(eval $(call SetupTarget, compile-commands-hotspot, \</span>
<span class="line-added">+     MAKEFILE := CompileCommands, \</span>
<span class="line-added">+ ))</span>
  
  ALL_TARGETS += $(COMPILE_COMMANDS_TARGETS_HOTSPOT) $(COMPILE_COMMANDS_TARGETS_JDK)
  
  ################################################################################
  # VS Code projects
  
<span class="line-modified">! $(eval $(call SetupTarget, vscode-project, \</span>
<span class="line-modified">!     MAKEFILE := CreateVSCodeProject, \</span>
<span class="line-modified">!     ARGS := VSCODE_INDEXER=cpptools, \</span>
<span class="line-added">+     DEPS := compile-commands, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, vscode-project-clangd, \</span>
<span class="line-modified">!     MAKEFILE := CreateVSCodeProject, \</span>
<span class="line-modified">!     ARGS := VSCODE_INDEXER=clangd, \</span>
<span class="line-added">+     DEPS := compile-commands, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, vscode-project-rtags, \</span>
<span class="line-modified">!     MAKEFILE := CreateVSCodeProject, \</span>
<span class="line-modified">!     ARGS := VSCODE_INDEXER=rtags, \</span>
<span class="line-added">+     DEPS := compile-commands, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, vscode-project-ccls, \</span>
<span class="line-modified">!     MAKEFILE := CreateVSCodeProject, \</span>
<span class="line-added">+     ARGS := VSCODE_INDEXER=ccls, \</span>
<span class="line-added">+     DEPS := compile-commands, \</span>
<span class="line-added">+ ))</span>
  
  ################################################################################
  # Build demos targets
  
<span class="line-modified">! # The demos are currently linking to libjvm and libjava, just like all other</span>
<span class="line-modified">! # jdk libs, even though they don&#39;t need to. To avoid warnings, make sure they</span>
<span class="line-modified">! # aren&#39;t built until after libjava and libjvm are available to link to.</span>
<span class="line-modified">! $(eval $(call SetupTarget, demos-jdk, \</span>
<span class="line-modified">!     MAKEFILE := CompileDemos, \</span>
<span class="line-added">+     DEPS := java.base-libs exploded-image, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, test-image-demos-jdk, \</span>
<span class="line-added">+     MAKEFILE := CompileDemos, \</span>
<span class="line-added">+     TARGET := images, \</span>
<span class="line-added">+     DEPS := demos-jdk, \</span>
<span class="line-added">+ ))</span>
  
  ################################################################################
  # Jigsaw specific data and analysis targets.
  
<span class="line-modified">! $(eval $(call SetupTarget, generate-summary, \</span>
<span class="line-modified">!     MAKEFILE := GenerateModuleSummary, \</span>
<span class="line-modified">!     DEPS := jmods buildtools-modules, \</span>
<span class="line-modified">! ))</span>
  
  ################################################################################
  # Jmod targets
  
  JMOD_MODULES := $(ALL_MODULES)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 339,15 ***</span>
  ALL_TARGETS += $(JMOD_TARGETS)
  
  ################################################################################
  # Images targets
  
<span class="line-modified">! store-source-revision:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f SourceRevision.gmk store-source-revision)</span>
  
<span class="line-modified">! create-source-revision-tracker:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f SourceRevision.gmk create-source-revision-tracker)</span>
  
  BOOTCYCLE_TARGET := product-images
  bootcycle-images:
          ifneq ($(COMPILE_TYPE), cross)
  	  $(call LogWarn, Boot cycle build step 2: Building a new JDK image using previously built image)
<span class="line-new-header">--- 366,19 ---</span>
  ALL_TARGETS += $(JMOD_TARGETS)
  
  ################################################################################
  # Images targets
  
<span class="line-modified">! $(eval $(call SetupTarget, store-source-revision, \</span>
<span class="line-modified">!     MAKEFILE := SourceRevision, \</span>
<span class="line-added">+     TARGET := store-source-revision, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, create-source-revision-tracker, \</span>
<span class="line-modified">!     MAKEFILE := SourceRevision, \</span>
<span class="line-added">+     TARGET := create-source-revision-tracker, \</span>
<span class="line-added">+ ))</span>
  
  BOOTCYCLE_TARGET := product-images
  bootcycle-images:
          ifneq ($(COMPILE_TYPE), cross)
  	  $(call LogWarn, Boot cycle build step 2: Building a new JDK image using previously built image)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 356,101 ***</span>
  	      LOG_PREFIX=&quot;[bootcycle] &quot; JOBS= SPEC=$(dir $(SPEC))bootcycle-spec.gmk main
          else
  	  $(call LogWarn, Boot cycle build disabled when cross compiling)
          endif
  
<span class="line-modified">! zip-security:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ZipSecurity.gmk)</span>
  
<span class="line-modified">! zip-source:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ZipSource.gmk)</span>
  
<span class="line-modified">! jrtfs-jar:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JrtfsJar.gmk)</span>
  
<span class="line-modified">! jdk-image:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk jdk)</span>
  
<span class="line-modified">! legacy-jre-image:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk jre)</span>
  
<span class="line-modified">! symbols-image:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk symbols)</span>
  
<span class="line-modified">! static-libs-image:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f StaticLibsImage.gmk)</span>
  
<span class="line-modified">! mac-jdk-bundle:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f MacBundles.gmk jdk-bundle)</span>
  
<span class="line-modified">! mac-legacy-jre-bundle:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f MacBundles.gmk jre-bundle)</span>
  
<span class="line-modified">! release-file:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ReleaseFile.gmk)</span>
  
<span class="line-modified">! exploded-image-optimize:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ExplodedImageOptimize.gmk)</span>
  
<span class="line-modified">! graal-builder-image:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GraalBuilderImage.gmk)</span>
  
  ifeq ($(JCOV_ENABLED), true)
<span class="line-modified">!   jcov-image:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Coverage.gmk jcov-image)</span>
  endif
  
<span class="line-modified">! ALL_TARGETS += store-source-revision create-source-revision-tracker bootcycle-images zip-security \</span>
<span class="line-removed">-     zip-source jrtfs-jar jdk-image legacy-jre-image \</span>
<span class="line-removed">-     symbols-image static-libs-image mac-jdk-bundle mac-legacy-jre-bundle \</span>
<span class="line-removed">-     release-file exploded-image-optimize graal-builder-image jcov-image</span>
  
  ################################################################################
  # Docs targets
  
  # If building full docs, to complete docs-*-api we need both the javadoc and
  # modulegraph targets.
<span class="line-modified">! docs-jdk-api-javadoc:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-api-javadoc)</span>
<span class="line-modified">! </span>
<span class="line-modified">! docs-jdk-api-modulegraph:</span>
<span class="line-removed">- 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-api-modulegraph)</span>
  
<span class="line-modified">! docs-javase-api-javadoc:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-javase-api-javadoc)</span>
  
<span class="line-modified">! docs-javase-api-modulegraph:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-javase-api-modulegraph)</span>
  
<span class="line-modified">! docs-reference-api-javadoc:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-reference-api-javadoc)</span>
  
<span class="line-modified">! docs-reference-api-modulegraph:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-reference-api-modulegraph)</span>
  
<span class="line-modified">! docs-jdk-specs:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-specs)</span>
  
<span class="line-modified">! docs-jdk-index:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-index)</span>
  
<span class="line-modified">! docs-zip:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-zip)</span>
  
<span class="line-modified">! docs-specs-zip:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-specs-zip)</span>
  
<span class="line-modified">! update-build-docs:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f UpdateBuildDocs.gmk)</span>
  
<span class="line-modified">! update-x11wrappers:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f UpdateX11Wrappers.gmk)</span>
  
<span class="line-modified">! ALL_TARGETS += docs-jdk-api-javadoc docs-jdk-api-modulegraph \</span>
<span class="line-modified">!     docs-javase-api-javadoc docs-javase-api-modulegraph \</span>
<span class="line-modified">!     docs-reference-api-javadoc docs-reference-api-modulegraph docs-jdk-specs \</span>
<span class="line-modified">!     docs-jdk-index docs-zip docs-specs-zip update-build-docs update-x11wrappers</span>
  
  ################################################################################
  # Cross compilation support
  
  ifeq ($(CREATING_BUILDJDK), true)
<span class="line-new-header">--- 387,154 ---</span>
  	      LOG_PREFIX=&quot;[bootcycle] &quot; JOBS= SPEC=$(dir $(SPEC))bootcycle-spec.gmk main
          else
  	  $(call LogWarn, Boot cycle build disabled when cross compiling)
          endif
  
<span class="line-modified">! $(eval $(call SetupTarget, zip-security, \</span>
<span class="line-modified">!     MAKEFILE := ZipSecurity, \</span>
<span class="line-added">+     DEPS := java.base-java java.security.jgss-java java.security.jgss-libs, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, zip-source, \</span>
<span class="line-modified">!     MAKEFILE := ZipSource, \</span>
<span class="line-added">+     DEPS := gensrc, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, jrtfs-jar, \</span>
<span class="line-modified">!     MAKEFILE := JrtfsJar, \</span>
<span class="line-added">+     DEPS := interim-langtools, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, jdk-image, \</span>
<span class="line-modified">!     MAKEFILE := Images, \</span>
<span class="line-added">+     TARGET := jdk, \</span>
<span class="line-added">+     DEPS := jmods zip-source demos release-file, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, legacy-jre-image, \</span>
<span class="line-modified">!     MAKEFILE := Images, \</span>
<span class="line-added">+     TARGET := jre, \</span>
<span class="line-added">+     DEPS := jmods release-file, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, symbols-image, \</span>
<span class="line-modified">!     MAKEFILE := Images, \</span>
<span class="line-added">+     TARGET := symbols, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, static-libs-image, \</span>
<span class="line-modified">!     MAKEFILE := StaticLibsImage, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, mac-jdk-bundle, \</span>
<span class="line-modified">!     MAKEFILE := MacBundles, \</span>
<span class="line-added">+     TARGET := jdk-bundle, \</span>
<span class="line-added">+     DEPS := jdk-image, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, mac-legacy-jre-bundle, \</span>
<span class="line-modified">!     MAKEFILE := MacBundles, \</span>
<span class="line-added">+     TARGET := jre-bundle, \</span>
<span class="line-added">+     DEPS := legacy-jre-image, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, release-file, \</span>
<span class="line-modified">!     MAKEFILE := ReleaseFile, \</span>
<span class="line-added">+     DEPS := create-source-revision-tracker, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, exploded-image-optimize, \</span>
<span class="line-modified">!     MAKEFILE := ExplodedImageOptimize, \</span>
<span class="line-added">+     DEPS := java copy gendata java.base-libs java.base-launchers \</span>
<span class="line-added">+         buildtools-modules, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, graal-builder-image, \</span>
<span class="line-modified">!     MAKEFILE := GraalBuilderImage, \</span>
<span class="line-added">+     DEPS := jdk-image static-libs-image, \</span>
<span class="line-added">+ ))</span>
  
  ifeq ($(JCOV_ENABLED), true)
<span class="line-modified">!   $(eval $(call SetupTarget, jcov-image, \</span>
<span class="line-modified">!       MAKEFILE := Coverage, \</span>
<span class="line-added">+       TARGET := jcov-image, \</span>
<span class="line-added">+       DEPS := jdk-image, \</span>
<span class="line-added">+   ))</span>
  endif
  
<span class="line-modified">! ALL_TARGETS += bootcycle-images</span>
  
  ################################################################################
  # Docs targets
  
  # If building full docs, to complete docs-*-api we need both the javadoc and
  # modulegraph targets.
<span class="line-modified">! $(eval $(call SetupTarget, docs-jdk-api-javadoc, \</span>
<span class="line-modified">!     MAKEFILE := Docs, \</span>
<span class="line-modified">!     TARGET := docs-jdk-api-javadoc, \</span>
<span class="line-modified">! ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, docs-jdk-api-modulegraph, \</span>
<span class="line-modified">!     MAKEFILE := Docs, \</span>
<span class="line-added">+     TARGET := docs-jdk-api-modulegraph, \</span>
<span class="line-added">+     DEPS := exploded-image buildtools-modules, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, docs-javase-api-javadoc, \</span>
<span class="line-modified">!     MAKEFILE := Docs, \</span>
<span class="line-added">+     TARGET := docs-javase-api-javadoc, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, docs-javase-api-modulegraph, \</span>
<span class="line-modified">!     MAKEFILE := Docs, \</span>
<span class="line-added">+     TARGET := docs-javase-api-modulegraph, \</span>
<span class="line-added">+     DEPS := exploded-image buildtools-modules, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, docs-reference-api-javadoc, \</span>
<span class="line-modified">!     MAKEFILE := Docs, \</span>
<span class="line-added">+     TARGET := docs-reference-api-javadoc, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, docs-reference-api-modulegraph, \</span>
<span class="line-modified">!     MAKEFILE := Docs, \</span>
<span class="line-added">+     TARGET := docs-reference-api-modulegraph, \</span>
<span class="line-added">+     DEPS := exploded-image buildtools-modules, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! # The gensrc steps for jdk.jdi create html spec files.</span>
<span class="line-modified">! $(eval $(call SetupTarget, docs-jdk-specs, \</span>
<span class="line-added">+     MAKEFILE := Docs, \</span>
<span class="line-added">+     TARGET := docs-jdk-specs, \</span>
<span class="line-added">+     DEPS := buildtools-jdk jdk.jdi-gensrc docs-jdk-index, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, docs-jdk-index, \</span>
<span class="line-modified">!     MAKEFILE := Docs, \</span>
<span class="line-added">+     TARGET := docs-jdk-index, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, docs-zip, \</span>
<span class="line-modified">!     MAKEFILE := Docs, \</span>
<span class="line-added">+     TARGET := docs-zip, \</span>
<span class="line-added">+     DEPS :=  docs-jdk, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, docs-specs-zip, \</span>
<span class="line-modified">!     MAKEFILE := Docs, \</span>
<span class="line-added">+     TARGET := docs-specs-zip, \</span>
<span class="line-added">+     DEPS := docs-jdk-specs, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, update-build-docs, \</span>
<span class="line-modified">!     MAKEFILE := UpdateBuildDocs, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, update-x11wrappers, \</span>
<span class="line-modified">!     MAKEFILE := UpdateX11Wrappers, \</span>
<span class="line-modified">!     DEPS := java.base-copy buildtools-jdk, \</span>
<span class="line-modified">! ))</span>
  
  ################################################################################
  # Cross compilation support
  
  ifeq ($(CREATING_BUILDJDK), true)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 460,21 ***</span>
  endif
  
  BUILDJDK_MODULES := $(sort $(foreach m, jdk.jlink $(INTERIM_IMAGE_MODULES), \
      $(call FindTransitiveDepsForModule, $m) $m))
  
<span class="line-modified">! create-buildjdk-interim-image:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Main.gmk \</span>
<span class="line-modified">! 	    $@-helper \</span>
<span class="line-modified">! 	    SPEC=$(dir $(SPEC))buildjdk-spec.gmk \</span>
<span class="line-modified">! 	    HOTSPOT_SPEC=$(dir $(SPEC))buildjdk-spec.gmk \</span>
<span class="line-modified">! 	    CREATING_BUILDJDK=true \</span>
<span class="line-modified">! 	    LOG_PREFIX=&quot;[buildjdk] &quot; \</span>
<span class="line-modified">! 	    JAVA_MODULES=&quot;$(BUILDJDK_MODULES)&quot; \</span>
<span class="line-modified">! 	)</span>
<span class="line-removed">- </span>
<span class="line-removed">- ALL_TARGETS += create-buildjdk-copy create-buildjdk-interim-image</span>
  
  ################################################################################
  # The interim-image is a small jlinked image that is used to generate artifacts
  # at build time for use when linking the real images.
  
<span class="line-new-header">--- 544,19 ---</span>
  endif
  
  BUILDJDK_MODULES := $(sort $(foreach m, jdk.jlink $(INTERIM_IMAGE_MODULES), \
      $(call FindTransitiveDepsForModule, $m) $m))
  
<span class="line-modified">! $(eval $(call SetupTarget, create-buildjdk-interim-image, \</span>
<span class="line-modified">!     MAKEFILE := Main, \</span>
<span class="line-modified">!     TARGET := create-buildjdk-interim-image-helper, \</span>
<span class="line-modified">!     ARGS := SPEC=$(dir $(SPEC))buildjdk-spec.gmk \</span>
<span class="line-modified">!         HOTSPOT_SPEC=$(dir $(SPEC))buildjdk-spec.gmk \</span>
<span class="line-modified">!         CREATING_BUILDJDK=true \</span>
<span class="line-modified">!         LOG_PREFIX=&quot;[buildjdk] &quot; \</span>
<span class="line-modified">!         JAVA_MODULES=&quot;$(BUILDJDK_MODULES)&quot;, \</span>
<span class="line-modified">! ))</span>
  
  ################################################################################
  # The interim-image is a small jlinked image that is used to generate artifacts
  # at build time for use when linking the real images.
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 490,20 ***</span>
  	)
  endef
  
  $(foreach m, $(INTERIM_IMAGE_MODULES), $(eval $(call DeclareInterimJmodRecipe,$m)))
  
<span class="line-modified">! interim-image:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f InterimImage.gmk)</span>
  
  ifeq ($(ENABLE_GENERATE_CLASSLIST), true)
<span class="line-modified">!   generate-link-opt-data:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GenerateLinkOptData.gmk)</span>
  endif
  
<span class="line-removed">- ALL_TARGETS += $(INTERIM_JMOD_TARGETS) interim-image generate-link-opt-data</span>
<span class="line-removed">- </span>
  ################################################################################
  # Generate test names for all JTReg test groups
  #
  
  define DeclareRunTestRecipe
<span class="line-new-header">--- 572,20 ---</span>
  	)
  endef
  
  $(foreach m, $(INTERIM_IMAGE_MODULES), $(eval $(call DeclareInterimJmodRecipe,$m)))
  
<span class="line-modified">! $(eval $(call SetupTarget, interim-image, \</span>
<span class="line-modified">!     MAKEFILE := InterimImage, \</span>
<span class="line-added">+ ))</span>
  
  ifeq ($(ENABLE_GENERATE_CLASSLIST), true)
<span class="line-modified">!   $(eval $(call SetupTarget, generate-link-opt-data, \</span>
<span class="line-modified">!       MAKEFILE := GenerateLinkOptData, \</span>
<span class="line-added">+   ))</span>
  endif
  
  ################################################################################
  # Generate test names for all JTReg test groups
  #
  
  define DeclareRunTestRecipe
</pre>
<hr />
<pre>
<span class="line-old-header">*** 528,117 ***</span>
  
  ################################################################################
  # Build tests and microbenchmarks
  #
  
<span class="line-modified">! prepare-test-image:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f TestImage.gmk prepare-test-image)</span>
  
<span class="line-modified">! build-test-hotspot-jtreg-native:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregNativeHotspot.gmk \</span>
<span class="line-modified">! 	    build-test-hotspot-jtreg-native)</span>
  
<span class="line-modified">! test-image-hotspot-jtreg-native:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregNativeHotspot.gmk \</span>
<span class="line-modified">! 	    test-image-hotspot-jtreg-native)</span>
  
<span class="line-modified">! build-test-jdk-jtreg-native:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregNativeJdk.gmk \</span>
<span class="line-modified">! 	    build-test-jdk-jtreg-native)</span>
  
<span class="line-modified">! test-image-jdk-jtreg-native:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregNativeJdk.gmk \</span>
<span class="line-modified">! 	    test-image-jdk-jtreg-native)</span>
  
<span class="line-modified">! build-test-hotspot-jtreg-graal:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregGraalUnit.gmk \</span>
<span class="line-modified">! 	     build-test-hotspot-jtreg-graal)</span>
  
<span class="line-modified">! test-image-hotspot-jtreg-graal:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregGraalUnit.gmk \</span>
<span class="line-modified">! 	     test-image-hotspot-jtreg-graal)</span>
  
  ifeq ($(BUILD_GTEST), true)
<span class="line-modified">!   test-image-hotspot-gtest:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make/hotspot/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GtestImage.gmk)</span>
  endif
  
<span class="line-modified">! build-test-lib:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f BuildTestLib.gmk)</span>
  
  ifeq ($(BUILD_FAILURE_HANDLER), true)
    # Builds the failure handler jtreg extension
<span class="line-modified">!   build-test-failure-handler:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) \</span>
<span class="line-modified">! 	    -f BuildFailureHandler.gmk build)</span>
  
    # Copies the failure handler jtreg extension into the test image
<span class="line-modified">!   test-image-failure-handler:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) \</span>
<span class="line-modified">! 	     -f BuildFailureHandler.gmk images)</span>
  endif
  
<span class="line-modified">! build-microbenchmark:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f test/BuildMicrobenchmark.gmk)</span>
<span class="line-modified">! </span>
<span class="line-modified">! ALL_TARGETS += prepare-test-image build-test-hotspot-jtreg-native \</span>
<span class="line-removed">-     test-image-hotspot-jtreg-native build-test-jdk-jtreg-native \</span>
<span class="line-removed">-     test-image-jdk-jtreg-native build-test-lib build-test-failure-handler \</span>
<span class="line-removed">-     test-failure-handler test-image-failure-handler test-image-hotspot-gtest \</span>
<span class="line-removed">-     test-image-hotspot-jtreg-graal build-test-hotspot-jtreg-graal \</span>
<span class="line-removed">-     build-microbenchmark</span>
  
  ################################################################################
  # Run tests
  
<span class="line-modified">! test:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \</span>
<span class="line-modified">! 	    TEST=&quot;$(TEST)&quot;)</span>
<span class="line-modified">! </span>
<span class="line-modified">! exploded-test:</span>
<span class="line-removed">- 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \</span>
<span class="line-removed">- 	    TEST=&quot;$(TEST)&quot; JDK_IMAGE_DIR=$(JDK_OUTPUTDIR))</span>
  
<span class="line-modified">! jcov-test:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \</span>
<span class="line-modified">! 	    TEST=&quot;$(TEST)&quot; TEST_OPTS_JCOV=true)</span>
  
<span class="line-modified">! ALL_TARGETS += test exploded-test jcov-test</span>
  
  ################################################################################
  # Bundles
  
<span class="line-modified">! product-bundles:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk product-bundles)</span>
  
<span class="line-modified">! legacy-bundles:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk legacy-bundles)</span>
  
<span class="line-modified">! test-bundles:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk test-bundles)</span>
  
<span class="line-modified">! docs-bundles:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk docs-bundles)</span>
  
<span class="line-modified">! static-libs-bundles:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk static-libs-bundles)</span>
  
  ifeq ($(JCOV_ENABLED), true)
<span class="line-modified">!   jcov-bundles:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk jcov-bundles)</span>
  endif
  
<span class="line-removed">- ALL_TARGETS += product-bundles legacy-bundles test-bundles docs-bundles \</span>
<span class="line-removed">-     static-libs-bundles jcov-bundles</span>
<span class="line-removed">- </span>
  ################################################################################
  # Install targets
  
<span class="line-modified">! install:</span>
<span class="line-modified">! 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Install.gmk)</span>
<span class="line-modified">! </span>
<span class="line-modified">! ALL_TARGETS += install</span>
  
  ################################################################################
  #
  # Dependency declarations between targets.
  #
<span class="line-new-header">--- 610,155 ---</span>
  
  ################################################################################
  # Build tests and microbenchmarks
  #
  
<span class="line-modified">! $(eval $(call SetupTarget, prepare-test-image, \</span>
<span class="line-modified">!     MAKEFILE := TestImage, \</span>
<span class="line-added">+     TARGET := prepare-test-image, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, build-test-hotspot-jtreg-native, \</span>
<span class="line-modified">!     MAKEFILE := test/JtregNativeHotspot, \</span>
<span class="line-modified">!     TARGET := build-test-hotspot-jtreg-native, \</span>
<span class="line-added">+     DEPS := buildtools-jdk, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, test-image-hotspot-jtreg-native, \</span>
<span class="line-modified">!     MAKEFILE := test/JtregNativeHotspot, \</span>
<span class="line-modified">!     TARGET := test-image-hotspot-jtreg-native, \</span>
<span class="line-added">+     DEPS := build-test-hotspot-jtreg-native, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, build-test-jdk-jtreg-native, \</span>
<span class="line-modified">!     MAKEFILE := test/JtregNativeJdk, \</span>
<span class="line-modified">!     TARGET := build-test-jdk-jtreg-native, \</span>
<span class="line-added">+     DEPS := buildtools-jdk java.base-libs, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, test-image-jdk-jtreg-native, \</span>
<span class="line-modified">!     MAKEFILE := test/JtregNativeJdk, \</span>
<span class="line-modified">!     TARGET := test-image-jdk-jtreg-native, \</span>
<span class="line-added">+     DEPS := build-test-jdk-jtreg-native, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, build-test-hotspot-jtreg-graal, \</span>
<span class="line-modified">!     MAKEFILE := test/JtregGraalUnit, \</span>
<span class="line-modified">!     TARGET := build-test-hotspot-jtreg-graal, \</span>
<span class="line-added">+     DEPS := exploded-image, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, test-image-hotspot-jtreg-graal, \</span>
<span class="line-modified">!     MAKEFILE := test/JtregGraalUnit, \</span>
<span class="line-modified">!     TARGET := test-image-hotspot-jtreg-graal, \</span>
<span class="line-added">+     DEPS := build-test-hotspot-jtreg-graal, \</span>
<span class="line-added">+ ))</span>
  
  ifeq ($(BUILD_GTEST), true)
<span class="line-modified">!   $(eval $(call SetupTarget, test-image-hotspot-gtest, \</span>
<span class="line-modified">!       MAKEFILE := hotspot/test/GtestImage, \</span>
<span class="line-added">+       DEPS := hotspot, \</span>
<span class="line-added">+   ))</span>
  endif
  
<span class="line-modified">! $(eval $(call SetupTarget, build-test-lib, \</span>
<span class="line-modified">!     MAKEFILE := test/BuildTestLib, \</span>
<span class="line-added">+     DEPS := exploded-image, \</span>
<span class="line-added">+ ))</span>
  
  ifeq ($(BUILD_FAILURE_HANDLER), true)
    # Builds the failure handler jtreg extension
<span class="line-modified">!   $(eval $(call SetupTarget, build-test-failure-handler, \</span>
<span class="line-modified">!       MAKEFILE := test/BuildFailureHandler, \</span>
<span class="line-modified">!       TARGET := build, \</span>
<span class="line-added">+       DEPS := interim-langtools, \</span>
<span class="line-added">+   ))</span>
  
    # Copies the failure handler jtreg extension into the test image
<span class="line-modified">!   $(eval $(call SetupTarget, test-image-failure-handler, \</span>
<span class="line-modified">!       MAKEFILE := test/BuildFailureHandler, \</span>
<span class="line-modified">!       TARGET := images, \</span>
<span class="line-added">+       DEPS := build-test-failure-handler, \</span>
<span class="line-added">+   ))</span>
  endif
  
<span class="line-modified">! $(eval $(call SetupTarget, build-microbenchmark, \</span>
<span class="line-modified">!     MAKEFILE := test/BuildMicrobenchmark, \</span>
<span class="line-modified">!     DEPS := interim-langtools exploded-image, \</span>
<span class="line-modified">! ))</span>
  
  ################################################################################
  # Run tests
  
<span class="line-modified">! $(eval $(call SetupTarget, test, \</span>
<span class="line-modified">!     MAKEFILE := RunTests, \</span>
<span class="line-modified">!     ARGS := TEST=&quot;$(TEST)&quot;, \</span>
<span class="line-modified">!     DEPS := jdk-image test-image, \</span>
<span class="line-modified">! ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, exploded-test, \</span>
<span class="line-modified">!     MAKEFILE := RunTests, \</span>
<span class="line-modified">!     ARGS := TEST=&quot;$(TEST)&quot; JDK_IMAGE_DIR=$(JDK_OUTPUTDIR), \</span>
<span class="line-added">+     DEPS := exploded-image test-image, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! ifeq ($(JCOV_ENABLED), true)</span>
<span class="line-added">+   $(eval $(call SetupTarget, jcov-test, \</span>
<span class="line-added">+       MAKEFILE := RunTests, \</span>
<span class="line-added">+       ARGS := TEST=&quot;$(TEST)&quot; TEST_OPTS_JCOV=true, \</span>
<span class="line-added">+       DEPS := jcov-image test-image, \</span>
<span class="line-added">+   ))</span>
<span class="line-added">+ endif</span>
  
  ################################################################################
  # Bundles
  
<span class="line-modified">! $(eval $(call SetupTarget, product-bundles, \</span>
<span class="line-modified">!     MAKEFILE := Bundles, \</span>
<span class="line-added">+     TARGET := product-bundles, \</span>
<span class="line-added">+     DEPS := product-images, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, legacy-bundles, \</span>
<span class="line-modified">!     MAKEFILE := Bundles, \</span>
<span class="line-added">+     TARGET := legacy-bundles, \</span>
<span class="line-added">+     DEPS := legacy-images, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, test-bundles, \</span>
<span class="line-modified">!     MAKEFILE := Bundles, \</span>
<span class="line-added">+     TARGET := test-bundles, \</span>
<span class="line-added">+     DEPS := test-image, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, docs-bundles, \</span>
<span class="line-modified">!     MAKEFILE := Bundles, \</span>
<span class="line-added">+     TARGET := docs-bundles, \</span>
<span class="line-added">+     DEPS := docs-image, \</span>
<span class="line-added">+ ))</span>
  
<span class="line-modified">! $(eval $(call SetupTarget, static-libs-bundles, \</span>
<span class="line-modified">!     MAKEFILE := Bundles, \</span>
<span class="line-added">+     TARGET := static-libs-bundles, \</span>
<span class="line-added">+     DEPS := static-libs-image, \</span>
<span class="line-added">+ ))</span>
  
  ifeq ($(JCOV_ENABLED), true)
<span class="line-modified">!   $(eval $(call SetupTarget, jcov-bundles, \</span>
<span class="line-modified">!       MAKEFILE := Bundles, \</span>
<span class="line-added">+       TARGET := jcov-bundles, \</span>
<span class="line-added">+       DEPS := jcov-image, \</span>
<span class="line-added">+   ))</span>
  endif
  
  ################################################################################
  # Install targets
  
<span class="line-modified">! $(eval $(call SetupTarget, install, \</span>
<span class="line-modified">!     MAKEFILE := Install, \</span>
<span class="line-modified">!     DEPS := product-images, \</span>
<span class="line-modified">! ))</span>
  
  ################################################################################
  #
  # Dependency declarations between targets.
  #
</pre>
<hr />
<pre>
<span class="line-old-header">*** 652,23 ***</span>
  
  # If running an *-only target, parallel execution and dependencies between
  # recipe targets are disabled. This makes it possible to run a select set of
  # recipe targets in order. It&#39;s the responsibility of the user to make sure
  # all prerequisites are fulfilled.
<span class="line-modified">! ifneq ($(findstring -only, $(MAKECMDGOALS)), )</span>
    .NOTPARALLEL:
  else
    $(LANGTOOLS_GENSRC_TARGETS): buildtools-langtools
  
    interim-langtools: $(INTERIM_LANGTOOLS_GENSRC_TARGETS)
  
<span class="line-removed">-   buildtools-jdk: interim-langtools interim-tzdb</span>
<span class="line-removed">- </span>
<span class="line-removed">-   buildtools-hotspot: interim-langtools</span>
<span class="line-removed">- </span>
<span class="line-removed">-   buildtools-modules: exploded-image-base</span>
<span class="line-removed">- </span>
    $(HOTSPOT_GENSRC_TARGETS): interim-langtools buildtools-hotspot
  
    $(JDK_GENSRC_TARGETS): interim-langtools buildtools-jdk
  
    $(GENSRC_MODULEINFO_TARGETS): buildtools-jdk
<span class="line-new-header">--- 772,17 ---</span>
  
  # If running an *-only target, parallel execution and dependencies between
  # recipe targets are disabled. This makes it possible to run a select set of
  # recipe targets in order. It&#39;s the responsibility of the user to make sure
  # all prerequisites are fulfilled.
<span class="line-modified">! ifeq ($(DEPS), none)</span>
    .NOTPARALLEL:
  else
    $(LANGTOOLS_GENSRC_TARGETS): buildtools-langtools
  
    interim-langtools: $(INTERIM_LANGTOOLS_GENSRC_TARGETS)
  
    $(HOTSPOT_GENSRC_TARGETS): interim-langtools buildtools-hotspot
  
    $(JDK_GENSRC_TARGETS): interim-langtools buildtools-jdk
  
    $(GENSRC_MODULEINFO_TARGETS): buildtools-jdk
</pre>
<hr />
<pre>
<span class="line-old-header">*** 681,14 ***</span>
    $(foreach v, $(JVM_VARIANTS), \
        $(eval hotspot-$v-gensrc: java.base-copy) \
        $(eval hotspot-$v-libs: hotspot-$v-gensrc java.base-copy) \
    )
  
<span class="line-removed">-   hotspot-ide-project: hotspot exploded-image</span>
<span class="line-removed">- </span>
<span class="line-removed">-   generate-exported-symbols: java.base-libs jdk.jdwp.agent-libs</span>
<span class="line-removed">- </span>
    # If not already set, set the JVM variant target so that the JVM will be built.
    JVM_MAIN_LIB_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-libs
  
    # Building one JVM variant is enough to start building the other libs
    $(LIBS_TARGETS): $(JVM_MAIN_LIB_TARGETS)
<span class="line-new-header">--- 795,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 697,16 ***</span>
  
    ifeq ($(STATIC_BUILD), true)
      $(LAUNCHER_TARGETS): generate-exported-symbols
    endif
  
<span class="line-removed">-   # The demos are currently linking to libjvm and libjava, just like all other</span>
<span class="line-removed">-   # jdk libs, even though they don&#39;t need to. To avoid warnings, make sure they</span>
<span class="line-removed">-   # aren&#39;t built until after libjava and libjvm are available to link to.</span>
<span class="line-removed">-   demos-jdk: java.base-libs exploded-image</span>
<span class="line-removed">-   test-image-demos-jdk: demos-jdk</span>
<span class="line-removed">- </span>
    # Declare dependency from &lt;module&gt;-java to &lt;module&gt;-gensrc
    $(foreach m, $(GENSRC_MODULES), $(eval $m-java: $m-gensrc))
  
    # Declare dependencies between java modules
    $(foreach m, $(JAVA_MODULES), \
<span class="line-new-header">--- 807,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 790,15 ***</span>
    $(COMPILE_COMMANDS_TARGETS_HOTSPOT): clean-compile-commands
    $(COMPILE_COMMANDS_TARGETS_JDK): clean-compile-commands
    compile-commands-hotspot: $(COMPILE_COMMANDS_TARGETS_HOTSPOT)
    compile-commands: $(COMPILE_COMMANDS_TARGETS_HOTSPOT) $(COMPILE_COMMANDS_TARGETS_JDK)
  
<span class="line-removed">-   vscode-project: compile-commands</span>
<span class="line-removed">-   vscode-project-clangd: compile-commands</span>
<span class="line-removed">-   vscode-project-rtags: compile-commands</span>
<span class="line-removed">-   vscode-project-ccls: compile-commands</span>
<span class="line-removed">- </span>
    # The -static-libs targets depend on -java as well as java.base-copy.
    $(foreach m, $(filter $(JAVA_MODULES), $(STATIC_LIBS_MODULES)), \
      $(eval $m-static-libs: $m-java java.base-copy))
  
    # Jmods cannot be created until we have the jmod tool ready to run. During
<span class="line-new-header">--- 894,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 830,18 ***</span>
    endif
  
    # All modules include the main license files from java.base.
    $(JMOD_TARGETS): java.base-copy
  
<span class="line-modified">!   zip-security: java.base-java java.security.jgss-java java.security.jgss-libs \</span>
<span class="line-removed">-       $(filter jdk.crypto%, $(JAVA_TARGETS))</span>
<span class="line-removed">- </span>
<span class="line-removed">-   zip-source: gensrc</span>
<span class="line-removed">- </span>
<span class="line-removed">-   jrtfs-jar: interim-langtools</span>
<span class="line-removed">- </span>
<span class="line-removed">-   build-microbenchmark: interim-langtools exploded-image</span>
  
    ifeq ($(ENABLE_GENERATE_CLASSLIST), true)
      ifeq ($(CREATE_BUILDJDK), true)
        # If creating a buildjdk, the interim image needs to be based on that.
        generate-link-opt-data: create-buildjdk
<span class="line-new-header">--- 929,11 ---</span>
    endif
  
    # All modules include the main license files from java.base.
    $(JMOD_TARGETS): java.base-copy
  
<span class="line-modified">!   zip-security: $(filter jdk.crypto%, $(JAVA_TARGETS))</span>
  
    ifeq ($(ENABLE_GENERATE_CLASSLIST), true)
      ifeq ($(CREATE_BUILDJDK), true)
        # If creating a buildjdk, the interim image needs to be based on that.
        generate-link-opt-data: create-buildjdk
</pre>
<hr />
<pre>
<span class="line-old-header">*** 855,113 ***</span>
  
      # The generated classlist needs to go into java.base-jmod.
      java.base-jmod jdk.jlink-jmod jdk-image legacy-jre-image: generate-link-opt-data
    endif
  
<span class="line-removed">-   release-file: create-source-revision-tracker</span>
<span class="line-removed">- </span>
<span class="line-removed">-   jdk-image: jmods zip-source demos release-file</span>
<span class="line-removed">-   legacy-jre-image: jmods release-file</span>
    symbols-image: $(LIBS_TARGETS) $(LAUNCHER_TARGETS)
  
    static-libs-image: $(STATIC_LIBS_TARGETS)
  
<span class="line-removed">-   graal-builder-image: jdk-image static-libs-image</span>
<span class="line-removed">- </span>
<span class="line-removed">-   mac-jdk-bundle: jdk-image</span>
<span class="line-removed">-   mac-legacy-jre-bundle: legacy-jre-image</span>
<span class="line-removed">- </span>
<span class="line-removed">-   ifeq ($(JCOV_INPUT_JDK), )</span>
<span class="line-removed">-     jcov-image: jdk-image</span>
<span class="line-removed">-   endif</span>
<span class="line-removed">- </span>
<span class="line-removed">-   # The optimize target can run as soon as the modules dir has been completely</span>
<span class="line-removed">-   # populated (java, copy and gendata targets) and the basic libs and launchers</span>
<span class="line-removed">-   # have been built.</span>
<span class="line-removed">-   exploded-image-optimize: java copy gendata java.base-libs java.base-launchers \</span>
<span class="line-removed">-       buildtools-modules</span>
<span class="line-removed">- </span>
    bootcycle-images: jdk-image
  
    docs-jdk-api-javadoc: $(GENSRC_TARGETS)
  
    docs-javase-api-javadoc: $(GENSRC_TARGETS)
  
    docs-reference-api-javadoc: $(GENSRC_TARGETS)
  
<span class="line-removed">-   docs-jdk-api-modulegraph: exploded-image buildtools-modules</span>
<span class="line-removed">- </span>
<span class="line-removed">-   docs-javase-api-modulegraph: exploded-image buildtools-modules</span>
<span class="line-removed">- </span>
<span class="line-removed">-   docs-reference-api-modulegraph: exploded-image buildtools-modules</span>
<span class="line-removed">- </span>
    # If not already set, then set the JVM specific docs targets
    JVM_DOCS_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-gensrc
  
<span class="line-modified">!   # The gensrc steps for hotspot and jdk.jdi create html spec files.</span>
<span class="line-modified">!   docs-jdk-specs: buildtools-jdk $(JVM_DOCS_TARGETS) jdk.jdi-gensrc \</span>
<span class="line-removed">-       docs-jdk-index</span>
<span class="line-removed">- </span>
<span class="line-removed">-   docs-zip: docs-jdk</span>
<span class="line-removed">- </span>
<span class="line-removed">-   docs-specs-zip: docs-jdk-specs</span>
  
    # Tests
<span class="line-removed">-   test: jdk-image test-image</span>
<span class="line-removed">- </span>
<span class="line-removed">-   exploded-test: exploded-image test-image</span>
<span class="line-removed">- </span>
<span class="line-removed">-   jcov-test: jcov-image test-image</span>
<span class="line-removed">- </span>
    test-make: clean-test-make compile-commands
  
    test-make-compile-commands: compile-commands
  
    # Declare dependency for all generated test targets
    $(foreach t, $(filter-out test-make%, $(ALL_TEST_TARGETS)), $(eval $t: jdk-image test-image))
    $(foreach t, $(ALL_EXPLODED_TEST_TARGETS), $(eval $t: exploded-image test-image))
  
    interim-image: $(INTERIM_JMOD_TARGETS)
  
<span class="line-modified">!   build-test-lib: exploded-image</span>
<span class="line-removed">- </span>
<span class="line-removed">-   build-test-failure-handler: interim-langtools</span>
<span class="line-removed">- </span>
<span class="line-removed">-   test-image-failure-handler: build-test-failure-handler</span>
<span class="line-removed">- </span>
<span class="line-removed">-   build-test-hotspot-jtreg-native: buildtools-jdk \</span>
<span class="line-removed">-       hotspot-$(JVM_VARIANT_MAIN)-libs</span>
<span class="line-removed">- </span>
<span class="line-removed">-   build-test-jdk-jtreg-native: buildtools-jdk java.base-libs</span>
<span class="line-removed">- </span>
<span class="line-removed">-   build-test-hotspot-jtreg-graal: exploded-image</span>
<span class="line-removed">- </span>
<span class="line-removed">-   test-image-hotspot-jtreg-native: build-test-hotspot-jtreg-native</span>
<span class="line-removed">- </span>
<span class="line-removed">-   test-image-jdk-jtreg-native: build-test-jdk-jtreg-native</span>
<span class="line-removed">- </span>
<span class="line-removed">-   test-image-hotspot-jtreg-graal: build-test-hotspot-jtreg-graal</span>
<span class="line-removed">- </span>
<span class="line-removed">-   test-image-hotspot-gtest: hotspot</span>
<span class="line-removed">- </span>
<span class="line-removed">-   install: product-images</span>
<span class="line-removed">- </span>
<span class="line-removed">-   product-bundles: product-images</span>
<span class="line-removed">- </span>
<span class="line-removed">-   legacy-bundles: legacy-images</span>
<span class="line-removed">- </span>
<span class="line-removed">-   test-bundles: test-image</span>
<span class="line-removed">- </span>
<span class="line-removed">-   docs-bundles: docs-image</span>
<span class="line-removed">- </span>
<span class="line-removed">-   jcov-bundles: jcov-image</span>
<span class="line-removed">- </span>
<span class="line-removed">-   static-libs-bundles: static-libs-image</span>
<span class="line-removed">- </span>
<span class="line-removed">-   generate-summary: jmods buildtools-modules</span>
<span class="line-removed">- </span>
<span class="line-removed">-   update-x11wrappers: java.base-copy buildtools-jdk</span>
  
  endif
  
  ################################################################################
  # Virtual targets without recipes
<span class="line-new-header">--- 947,40 ---</span>
  
      # The generated classlist needs to go into java.base-jmod.
      java.base-jmod jdk.jlink-jmod jdk-image legacy-jre-image: generate-link-opt-data
    endif
  
    symbols-image: $(LIBS_TARGETS) $(LAUNCHER_TARGETS)
  
    static-libs-image: $(STATIC_LIBS_TARGETS)
  
    bootcycle-images: jdk-image
  
    docs-jdk-api-javadoc: $(GENSRC_TARGETS)
  
    docs-javase-api-javadoc: $(GENSRC_TARGETS)
  
    docs-reference-api-javadoc: $(GENSRC_TARGETS)
  
    # If not already set, then set the JVM specific docs targets
    JVM_DOCS_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-gensrc
  
<span class="line-modified">!   # The gensrc steps for hotspot create html spec files.</span>
<span class="line-modified">!   docs-jdk-specs: $(JVM_DOCS_TARGETS)</span>
  
    # Tests
    test-make: clean-test-make compile-commands
  
    test-make-compile-commands: compile-commands
  
    # Declare dependency for all generated test targets
    $(foreach t, $(filter-out test-make%, $(ALL_TEST_TARGETS)), $(eval $t: jdk-image test-image))
    $(foreach t, $(ALL_EXPLODED_TEST_TARGETS), $(eval $t: exploded-image test-image))
  
    interim-image: $(INTERIM_JMOD_TARGETS)
  
<span class="line-modified">!   build-test-hotspot-jtreg-native: hotspot-$(JVM_VARIANT_MAIN)-libs</span>
  
  endif
  
  ################################################################################
  # Virtual targets without recipes
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1088,14 ***</span>
  ifeq ($(INCLUDE_GRAAL), true)
    JVM_TEST_IMAGE_TARGETS += test-image-hotspot-jtreg-graal
  endif
  
  # This target builds the test image
<span class="line-modified">! test-image: prepare-test-image \</span>
<span class="line-removed">-     test-image-jdk-jtreg-native test-image-failure-handler \</span>
      test-image-demos-jdk $(JVM_TEST_IMAGE_TARGETS)
  
  ifneq ($(JMH_CORE_JAR), )
    test-image: build-microbenchmark
  endif
  
  ################################################################################
<span class="line-new-header">--- 1107,17 ---</span>
  ifeq ($(INCLUDE_GRAAL), true)
    JVM_TEST_IMAGE_TARGETS += test-image-hotspot-jtreg-graal
  endif
  
  # This target builds the test image
<span class="line-modified">! test-image: prepare-test-image test-image-jdk-jtreg-native \</span>
      test-image-demos-jdk $(JVM_TEST_IMAGE_TARGETS)
  
<span class="line-added">+ ifeq ($(BUILD_FAILURE_HANDLER), true)</span>
<span class="line-added">+   test-image: test-image-failure-handler</span>
<span class="line-added">+ endif</span>
<span class="line-added">+ </span>
  ifneq ($(JMH_CORE_JAR), )
    test-image: build-microbenchmark
  endif
  
  ################################################################################
</pre>
<center><a href="Images.gmk.cdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="MainSupport.gmk.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>