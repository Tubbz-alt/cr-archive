<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/util_windows.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="util.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="../common/JavaCompilation.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/util_windows.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2016, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
110   fi
111 ])
112 
113 # Helper function which possibly converts a path using DOS-style short mode.
114 # If so, the updated path is stored in $new_path.
115 # $1: The path to check
116 AC_DEFUN([UTIL_MAKE_WINDOWS_SPACE_SAFE_WSL],
117 [
118   input_path=&quot;$1&quot;
119   # Check if we need to convert this using DOS-style short mode. If the path
120   # contains just simple characters, use it. Otherwise (spaces, weird characters),
121   # take no chances and rewrite it.
122   # Note: m4 eats our [], so we need to use @&lt;:@ and @:&gt;@ instead.
123   has_forbidden_chars=`$ECHO &quot;$input_path&quot; | $GREP [[^-_/:a-zA-Z0-9\\.]]`
124   if test &quot;x$has_forbidden_chars&quot; != x; then
125     # Now convert it to mixed DOS-style, short mode (no spaces, and / instead of \)
126     TOPDIR_windows=&quot;$TOPDIR&quot;
127     UTIL_REWRITE_AS_WINDOWS_MIXED_PATH([TOPDIR_windows])
128     # First convert to Windows path to make input valid for cmd
129     UTIL_REWRITE_AS_WINDOWS_MIXED_PATH([input_path])




130     new_path=`$CMD /c $TOPDIR_windows/make/scripts/windowsShortName.bat &quot;$input_path&quot; \
131         | $SED -e &#39;s|\r||g&#39; \
132         | $TR \\\\\\\\ / | $TR &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39; &#39;abcdefghijklmnopqrstuvwxyz&#39;`
133     # Rewrite back to unix style

134     UTIL_REWRITE_AS_UNIX_PATH([new_path])
135   fi
136 ])
137 
138 # FIXME: The UTIL_FIXUP_*_CYGWIN/MSYS is most likely too convoluted
139 # and could probably be heavily simplified. However, all changes in this
140 # area tend to need lot of testing in different scenarios, and in lack of
141 # proper unit testing, cleaning this up has not been deemed worth the effort
142 # at the moment.
143 
144 AC_DEFUN([UTIL_FIXUP_PATH_CYGWIN],
145 [
146   # Input might be given as Windows format, start by converting to
147   # unix format.
148   path=&quot;[$]$1&quot;
149   new_path=`$CYGPATH -u &quot;$path&quot;`
150 
151   UTIL_ABSOLUTE_PATH(new_path)
152 
153   # Cygwin tries to hide some aspects of the Windows file system, such that binaries are
</pre>
</td>
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
110   fi
111 ])
112 
113 # Helper function which possibly converts a path using DOS-style short mode.
114 # If so, the updated path is stored in $new_path.
115 # $1: The path to check
116 AC_DEFUN([UTIL_MAKE_WINDOWS_SPACE_SAFE_WSL],
117 [
118   input_path=&quot;$1&quot;
119   # Check if we need to convert this using DOS-style short mode. If the path
120   # contains just simple characters, use it. Otherwise (spaces, weird characters),
121   # take no chances and rewrite it.
122   # Note: m4 eats our [], so we need to use @&lt;:@ and @:&gt;@ instead.
123   has_forbidden_chars=`$ECHO &quot;$input_path&quot; | $GREP [[^-_/:a-zA-Z0-9\\.]]`
124   if test &quot;x$has_forbidden_chars&quot; != x; then
125     # Now convert it to mixed DOS-style, short mode (no spaces, and / instead of \)
126     TOPDIR_windows=&quot;$TOPDIR&quot;
127     UTIL_REWRITE_AS_WINDOWS_MIXED_PATH([TOPDIR_windows])
128     # First convert to Windows path to make input valid for cmd
129     UTIL_REWRITE_AS_WINDOWS_MIXED_PATH([input_path])
<span class="line-added">130     # Reset PATH since it can contain a mix of WSL/linux paths and Windows paths from VS,</span>
<span class="line-added">131     # which, in combination with WSLENV, will make the WSL layer complain</span>
<span class="line-added">132     old_path=&quot;$PATH&quot;</span>
<span class="line-added">133     PATH=</span>
134     new_path=`$CMD /c $TOPDIR_windows/make/scripts/windowsShortName.bat &quot;$input_path&quot; \
135         | $SED -e &#39;s|\r||g&#39; \
136         | $TR \\\\\\\\ / | $TR &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39; &#39;abcdefghijklmnopqrstuvwxyz&#39;`
137     # Rewrite back to unix style
<span class="line-added">138     PATH=&quot;$old_path&quot;</span>
139     UTIL_REWRITE_AS_UNIX_PATH([new_path])
140   fi
141 ])
142 
143 # FIXME: The UTIL_FIXUP_*_CYGWIN/MSYS is most likely too convoluted
144 # and could probably be heavily simplified. However, all changes in this
145 # area tend to need lot of testing in different scenarios, and in lack of
146 # proper unit testing, cleaning this up has not been deemed worth the effort
147 # at the moment.
148 
149 AC_DEFUN([UTIL_FIXUP_PATH_CYGWIN],
150 [
151   # Input might be given as Windows format, start by converting to
152   # unix format.
153   path=&quot;[$]$1&quot;
154   new_path=`$CYGPATH -u &quot;$path&quot;`
155 
156   UTIL_ABSOLUTE_PATH(new_path)
157 
158   # Cygwin tries to hide some aspects of the Windows file system, such that binaries are
</pre>
</td>
</tr>
</table>
<center><a href="util.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="../common/JavaCompilation.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>