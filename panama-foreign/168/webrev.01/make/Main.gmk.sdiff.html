<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/Main.gmk</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="Images.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="MainSupport.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/Main.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22 # or visit www.oracle.com if you need additional information or have any
  23 # questions.
  24 #
  25 
  26 ################################################################################
  27 # This is the main makefile containing most actual top level targets. It needs
  28 # to be called with a SPEC file defined.
  29 ################################################################################
  30 
  31 # Declare default target
  32 default:
  33 
  34 ifeq ($(wildcard $(SPEC)),)
  35   $(error Main.gmk needs SPEC set to a proper spec.gmk)
  36 endif
  37 
  38 # Now load the spec
  39 include $(SPEC)
  40 
<span class="line-removed">  41 include $(TOPDIR)/make/MainSupport.gmk</span>
<span class="line-removed">  42 </span>
  43 # Load the vital tools for all the makefiles.
  44 include $(TOPDIR)/make/common/MakeBase.gmk
  45 include $(TOPDIR)/make/common/Modules.gmk
  46 include $(TOPDIR)/make/common/FindTests.gmk
  47 







  48 # Declare ALL_TARGETS as an immediate variable. This variable is a list of all
  49 # valid top level targets. It&#39;s used to declare them all as PHONY and to
  50 # generate the -only targets.
  51 ALL_TARGETS :=
  52 
  53 # Hook to include the corresponding custom file, if present.
  54 $(eval $(call IncludeCustomExtension, Main.gmk))
  55 
  56 # All modules for the current target platform.
  57 ALL_MODULES := $(call FindAllModules)
  58 
  59 ################################################################################
  60 ################################################################################
  61 #
  62 # Recipes for all targets. Only recipes, dependencies are declared later.
  63 #
  64 ################################################################################
  65 
  66 ################################################################################
  67 # Interim/build tools targets, compiling tools used during the build
  68 
<span class="line-modified">  69 buildtools-langtools:</span>
<span class="line-modified">  70 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ToolsLangtools.gmk)</span>
<span class="line-modified">  71 </span>
<span class="line-removed">  72 interim-langtools:</span>
<span class="line-removed">  73 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileInterimLangtools.gmk)</span>
<span class="line-removed">  74 </span>
<span class="line-removed">  75 interim-tzdb:</span>
<span class="line-removed">  76 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CopyInterimTZDB.gmk)</span>
  77 



  78 
<span class="line-modified">  79 buildtools-jdk:</span>
<span class="line-modified">  80 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileToolsJdk.gmk)</span>

  81 
<span class="line-modified">  82 buildtools-modules:</span>
<span class="line-modified">  83 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileModuleTools.gmk)</span>


  84 
<span class="line-modified">  85 buildtools-hotspot:</span>
<span class="line-modified">  86 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileToolsHotspot.gmk)</span>


  87 
<span class="line-modified">  88 ALL_TARGETS += buildtools-langtools interim-langtools \</span>
<span class="line-modified">  89     interim-tzdb buildtools-jdk buildtools-modules \</span>
<span class="line-modified">  90     buildtools-hotspot</span>

  91 
  92 ################################################################################
  93 # Special targets for certain modules
  94 
<span class="line-modified">  95 generate-exported-symbols:</span>
<span class="line-modified">  96 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f BuildStatic.gmk)</span>
<span class="line-modified">  97 </span>
<span class="line-modified">  98 ALL_TARGETS += generate-exported-symbols</span>
  99 
 100 ################################################################################
 101 # Gensrc targets, generating source before java compilation can be done
 102 #
 103 $(eval $(call DeclareRecipesForPhase, GENSRC, \
 104     TARGET_SUFFIX := gensrc-src, \
 105     FILE_PREFIX := Gensrc, \
 106     MAKE_SUBDIR := gensrc, \
 107     CHECK_MODULES := $(ALL_MODULES), \
 108 ))
 109 
 110 $(foreach m, $(GENSRC_MODULES), $(eval $m-gensrc: $m-gensrc-src))
 111 
 112 LANGTOOLS_GENSRC_TARGETS := $(filter $(addsuffix -%, $(LANGTOOLS_MODULES)), $(GENSRC_TARGETS))
 113 INTERIM_LANGTOOLS_GENSRC_TARGETS := $(filter $(addsuffix -%, \
 114     $(INTERIM_LANGTOOLS_BASE_MODULES)), $(GENSRC_TARGETS))
 115 HOTSPOT_GENSRC_TARGETS := $(filter $(addsuffix -%, $(HOTSPOT_MODULES)), $(GENSRC_TARGETS))
 116 JDK_GENSRC_TARGETS := $(filter-out $(LANGTOOLS_GENSRC_TARGETS) \
 117     $(HOTSPOT_GENSRC_TARGETS), $(GENSRC_TARGETS))
 118 
</pre>
<hr />
<pre>
 234 HOTSPOT_VARIANT_GENSRC_TARGETS := $(addsuffix -gensrc, $(HOTSPOT_VARIANT_TARGETS))
 235 HOTSPOT_VARIANT_LIBS_TARGETS := $(addsuffix -libs, $(HOTSPOT_VARIANT_TARGETS))
 236 
 237 define DeclareHotspotGensrcRecipe
 238   hotspot-$1-gensrc:
 239 	$$(call LogInfo, Building JVM variant &#39;$1&#39; with features &#39;$(JVM_FEATURES_$1)&#39;)
 240 	+($(CD) $(TOPDIR)/make/hotspot &amp;&amp; $(MAKE) $(MAKE_ARGS) -f gensrc/GenerateSources.gmk \
 241 	    JVM_VARIANT=$1)
 242 endef
 243 
 244 $(foreach v, $(JVM_VARIANTS), $(eval $(call DeclareHotspotGensrcRecipe,$v)))
 245 
 246 define DeclareHotspotLibsRecipe
 247   hotspot-$1-libs:
 248 	+($(CD) $(TOPDIR)/make/hotspot &amp;&amp; $(MAKE) $(MAKE_ARGS) -f lib/CompileLibraries.gmk \
 249 	    JVM_VARIANT=$1)
 250 endef
 251 
 252 $(foreach v, $(JVM_VARIANTS), $(eval $(call DeclareHotspotLibsRecipe,$v)))
 253 
<span class="line-modified"> 254 hotspot-ide-project:</span>
<span class="line-modified"> 255 	+($(CD) $(TOPDIR)/make/hotspot &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ide/CreateVSProject.gmk)</span>


 256 
 257 ALL_TARGETS += $(HOTSPOT_VARIANT_TARGETS) $(HOTSPOT_VARIANT_GENSRC_TARGETS) \
<span class="line-modified"> 258     $(HOTSPOT_VARIANT_LIBS_TARGETS) hotspot-ide-project</span>
 259 
 260 ################################################################################
 261 # Generate libs and launcher targets for creating compile_commands.json fragments
 262 define DeclareCompileCommandsRecipe
 263   $1-compile-commands:
 264 	$$(call LogInfo, Generating compile_commands.json fragments for $1)
 265 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Main.gmk $1-only \
 266 	    GENERATE_COMPILE_COMMANDS_ONLY=true)
 267 
 268   COMPILE_COMMANDS_TARGETS_$2 += $1-compile-commands
 269 endef
 270 
 271 $(foreach t, $(HOTSPOT_VARIANT_LIBS_TARGETS), \
 272   $(eval $(call DeclareCompileCommandsRecipe,$t,HOTSPOT)) \
 273 )
 274 
 275 $(foreach t, $(LIBS_TARGETS) $(LAUNCHER_TARGETS), \
 276   $(eval $(call DeclareCompileCommandsRecipe,$t,JDK)) \
 277 )
 278 
<span class="line-modified"> 279 compile-commands compile-commands-hotspot:</span>
<span class="line-modified"> 280 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileCommands.gmk)</span>





 281 
 282 ALL_TARGETS += $(COMPILE_COMMANDS_TARGETS_HOTSPOT) $(COMPILE_COMMANDS_TARGETS_JDK)
<span class="line-removed"> 283 ALL_TARGETS += compile-commands compile-commands-hotspot</span>
 284 
 285 ################################################################################
 286 # VS Code projects
<span class="line-removed"> 287 vscode-project:</span>
<span class="line-removed"> 288 	+($(CD) $(TOPDIR)/make/vscode &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateVSCodeProject.gmk \</span>
<span class="line-removed"> 289       VSCODE_INDEXER=cpptools)</span>
 290 
<span class="line-modified"> 291 vscode-project-clangd:</span>
<span class="line-modified"> 292 	+($(CD) $(TOPDIR)/make/vscode &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateVSCodeProject.gmk \</span>
<span class="line-modified"> 293       VSCODE_INDEXER=clangd)</span>


 294 
<span class="line-modified"> 295 vscode-project-rtags:</span>
<span class="line-modified"> 296 	+($(CD) $(TOPDIR)/make/vscode &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateVSCodeProject.gmk \</span>
<span class="line-modified"> 297       VSCODE_INDEXER=rtags)</span>


 298 
<span class="line-modified"> 299 vscode-project-ccls:</span>
<span class="line-modified"> 300 	+($(CD) $(TOPDIR)/make/vscode &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateVSCodeProject.gmk \</span>
<span class="line-modified"> 301       VSCODE_INDEXER=ccls)</span>


 302 
<span class="line-modified"> 303 ALL_TARGETS += vscode-project vscode-project-clangd vscode-project-rtags \</span>
<span class="line-modified"> 304   vscode-project-ccls</span>



 305 
 306 ################################################################################
 307 # Build demos targets
 308 
<span class="line-modified"> 309 demos-jdk:</span>
<span class="line-modified"> 310 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileDemos.gmk)</span>
<span class="line-modified"> 311 </span>
<span class="line-modified"> 312 test-image-demos-jdk:</span>
<span class="line-modified"> 313 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileDemos.gmk images)</span>


 314 
<span class="line-modified"> 315 ALL_TARGETS += demos-jdk test-image-demos-jdk</span>




 316 
 317 ################################################################################
 318 # Jigsaw specific data and analysis targets.
 319 
<span class="line-modified"> 320 generate-summary:</span>
<span class="line-modified"> 321 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GenerateModuleSummary.gmk)</span>
<span class="line-modified"> 322 </span>
<span class="line-modified"> 323 ALL_TARGETS += generate-summary</span>
 324 
 325 ################################################################################
 326 # Jmod targets
 327 
 328 JMOD_MODULES := $(ALL_MODULES)
 329 JMOD_TARGETS := $(addsuffix -jmod, $(JMOD_MODULES))
 330 
 331 define DeclareJmodRecipe
 332   $1-jmod:
 333 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateJmods.gmk \
 334 	    MODULE=$1)
 335 endef
 336 
 337 $(foreach m, $(JMOD_MODULES), $(eval $(call DeclareJmodRecipe,$m)))
 338 
 339 ALL_TARGETS += $(JMOD_TARGETS)
 340 
 341 ################################################################################
 342 # Images targets
 343 
<span class="line-modified"> 344 store-source-revision:</span>
<span class="line-modified"> 345 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f SourceRevision.gmk store-source-revision)</span>


 346 
<span class="line-modified"> 347 create-source-revision-tracker:</span>
<span class="line-modified"> 348 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f SourceRevision.gmk create-source-revision-tracker)</span>


 349 
 350 BOOTCYCLE_TARGET := product-images
 351 bootcycle-images:
 352         ifneq ($(COMPILE_TYPE), cross)
 353 	  $(call LogWarn, Boot cycle build step 2: Building a new JDK image using previously built image)
 354 	  $(call MakeDir, $(OUTPUTDIR)/bootcycle-build)
 355 	  +$(MAKE) $(MAKE_ARGS) -f $(TOPDIR)/make/Init.gmk PARALLEL_TARGETS=$(BOOTCYCLE_TARGET) \
 356 	      LOG_PREFIX=&quot;[bootcycle] &quot; JOBS= SPEC=$(dir $(SPEC))bootcycle-spec.gmk main
 357         else
 358 	  $(call LogWarn, Boot cycle build disabled when cross compiling)
 359         endif
 360 
<span class="line-modified"> 361 zip-security:</span>
<span class="line-modified"> 362 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ZipSecurity.gmk)</span>


 363 
<span class="line-modified"> 364 zip-source:</span>
<span class="line-modified"> 365 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ZipSource.gmk)</span>


 366 
<span class="line-modified"> 367 jrtfs-jar:</span>
<span class="line-modified"> 368 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JrtfsJar.gmk)</span>


 369 
<span class="line-modified"> 370 jdk-image:</span>
<span class="line-modified"> 371 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk jdk)</span>



 372 
<span class="line-modified"> 373 legacy-jre-image:</span>
<span class="line-modified"> 374 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk jre)</span>



 375 
<span class="line-modified"> 376 symbols-image:</span>
<span class="line-modified"> 377 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk symbols)</span>


 378 
<span class="line-modified"> 379 static-libs-image:</span>
<span class="line-modified"> 380 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f StaticLibsImage.gmk)</span>

 381 
<span class="line-modified"> 382 mac-jdk-bundle:</span>
<span class="line-modified"> 383 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f MacBundles.gmk jdk-bundle)</span>



 384 
<span class="line-modified"> 385 mac-legacy-jre-bundle:</span>
<span class="line-modified"> 386 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f MacBundles.gmk jre-bundle)</span>



 387 
<span class="line-modified"> 388 release-file:</span>
<span class="line-modified"> 389 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ReleaseFile.gmk)</span>


 390 
<span class="line-modified"> 391 exploded-image-optimize:</span>
<span class="line-modified"> 392 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ExplodedImageOptimize.gmk)</span>



 393 
<span class="line-modified"> 394 graal-builder-image:</span>
<span class="line-modified"> 395 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GraalBuilderImage.gmk)</span>


 396 
 397 ifeq ($(JCOV_ENABLED), true)
<span class="line-modified"> 398   jcov-image:</span>
<span class="line-modified"> 399 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Coverage.gmk jcov-image)</span>



 400 endif
 401 
<span class="line-modified"> 402 ALL_TARGETS += store-source-revision create-source-revision-tracker bootcycle-images zip-security \</span>
<span class="line-removed"> 403     zip-source jrtfs-jar jdk-image legacy-jre-image \</span>
<span class="line-removed"> 404     symbols-image static-libs-image mac-jdk-bundle mac-legacy-jre-bundle \</span>
<span class="line-removed"> 405     release-file exploded-image-optimize graal-builder-image jcov-image</span>
 406 
 407 ################################################################################
 408 # Docs targets
 409 
 410 # If building full docs, to complete docs-*-api we need both the javadoc and
 411 # modulegraph targets.
<span class="line-modified"> 412 docs-jdk-api-javadoc:</span>
<span class="line-modified"> 413 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-api-javadoc)</span>
<span class="line-modified"> 414 </span>
<span class="line-modified"> 415 docs-jdk-api-modulegraph:</span>
<span class="line-removed"> 416 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-api-modulegraph)</span>
 417 
<span class="line-modified"> 418 docs-javase-api-javadoc:</span>
<span class="line-modified"> 419 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-javase-api-javadoc)</span>



 420 
<span class="line-modified"> 421 docs-javase-api-modulegraph:</span>
<span class="line-modified"> 422 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-javase-api-modulegraph)</span>


 423 
<span class="line-modified"> 424 docs-reference-api-javadoc:</span>
<span class="line-modified"> 425 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-reference-api-javadoc)</span>



 426 
<span class="line-modified"> 427 docs-reference-api-modulegraph:</span>
<span class="line-modified"> 428 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-reference-api-modulegraph)</span>


 429 
<span class="line-modified"> 430 docs-jdk-specs:</span>
<span class="line-modified"> 431 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-specs)</span>



 432 
<span class="line-modified"> 433 docs-jdk-index:</span>
<span class="line-modified"> 434 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-index)</span>




 435 
<span class="line-modified"> 436 docs-zip:</span>
<span class="line-modified"> 437 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-zip)</span>


 438 
<span class="line-modified"> 439 docs-specs-zip:</span>
<span class="line-modified"> 440 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-specs-zip)</span>



 441 
<span class="line-modified"> 442 update-build-docs:</span>
<span class="line-modified"> 443 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f UpdateBuildDocs.gmk)</span>



 444 
<span class="line-modified"> 445 update-x11wrappers:</span>
<span class="line-modified"> 446 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f UpdateX11Wrappers.gmk)</span>

 447 
<span class="line-modified"> 448 ALL_TARGETS += docs-jdk-api-javadoc docs-jdk-api-modulegraph \</span>
<span class="line-modified"> 449     docs-javase-api-javadoc docs-javase-api-modulegraph \</span>
<span class="line-modified"> 450     docs-reference-api-javadoc docs-reference-api-modulegraph docs-jdk-specs \</span>
<span class="line-modified"> 451     docs-jdk-index docs-zip docs-specs-zip update-build-docs update-x11wrappers</span>
 452 
 453 ################################################################################
 454 # Cross compilation support
 455 
 456 ifeq ($(CREATING_BUILDJDK), true)
 457   # This target is only called by the recursive call below.
 458   create-buildjdk-interim-image-helper: interim-image jdk.jlink-launchers \
 459       java.base-copy jdk.jdeps-launchers
 460 endif
 461 
 462 BUILDJDK_MODULES := $(sort $(foreach m, jdk.jlink $(INTERIM_IMAGE_MODULES), \
 463     $(call FindTransitiveDepsForModule, $m) $m))
 464 
<span class="line-modified"> 465 create-buildjdk-interim-image:</span>
<span class="line-modified"> 466 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Main.gmk \</span>
<span class="line-modified"> 467 	    $@-helper \</span>
<span class="line-modified"> 468 	    SPEC=$(dir $(SPEC))buildjdk-spec.gmk \</span>
<span class="line-modified"> 469 	    HOTSPOT_SPEC=$(dir $(SPEC))buildjdk-spec.gmk \</span>
<span class="line-modified"> 470 	    CREATING_BUILDJDK=true \</span>
<span class="line-modified"> 471 	    LOG_PREFIX=&quot;[buildjdk] &quot; \</span>
<span class="line-modified"> 472 	    JAVA_MODULES=&quot;$(BUILDJDK_MODULES)&quot; \</span>
<span class="line-modified"> 473 	)</span>
<span class="line-removed"> 474 </span>
<span class="line-removed"> 475 ALL_TARGETS += create-buildjdk-copy create-buildjdk-interim-image</span>
 476 
 477 ################################################################################
 478 # The interim-image is a small jlinked image that is used to generate artifacts
 479 # at build time for use when linking the real images.
 480 
 481 INTERIM_JMOD_TARGETS := $(addsuffix -interim-jmod, $(INTERIM_IMAGE_MODULES))
 482 
 483 define DeclareInterimJmodRecipe
 484   $1-interim-jmod:
 485 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateJmods.gmk \
 486 	    MODULE=$1 \
 487 	    JMODS_DIR=$(INTERIM_JMODS_DIR) \
 488 	    JMODS_SUPPORT_DIR=$(INTERIM_JMODS_DIR)/support \
 489 	    INTERIM_JMOD=true \
 490 	)
 491 endef
 492 
 493 $(foreach m, $(INTERIM_IMAGE_MODULES), $(eval $(call DeclareInterimJmodRecipe,$m)))
 494 
<span class="line-modified"> 495 interim-image:</span>
<span class="line-modified"> 496 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f InterimImage.gmk)</span>

 497 
 498 ifeq ($(ENABLE_GENERATE_CLASSLIST), true)
<span class="line-modified"> 499   generate-link-opt-data:</span>
<span class="line-modified"> 500 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GenerateLinkOptData.gmk)</span>

 501 endif
 502 
<span class="line-removed"> 503 ALL_TARGETS += $(INTERIM_JMOD_TARGETS) interim-image generate-link-opt-data</span>
<span class="line-removed"> 504 </span>
 505 ################################################################################
 506 # Generate test names for all JTReg test groups
 507 #
 508 
 509 define DeclareRunTestRecipe
 510   test-$1:
 511 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \
 512 	    TEST=&quot;$1&quot;)
 513 
 514   exploded-test-$1:
 515 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \
 516 	    TEST=&quot;$1&quot; JDK_IMAGE_DIR=$(JDK_OUTPUTDIR))
 517 endef
 518 
 519 # ALL_NAMED_TESTS is defined in FindTests.gmk
 520 $(foreach t, $(ALL_NAMED_TESTS), $(eval $(call DeclareRunTestRecipe,$t)))
 521 ALL_TEST_TARGETS := $(addprefix test-, $(ALL_NAMED_TESTS))
 522 
 523 # We only support the &quot;exploded-test-gtest&quot; shortcut
 524 ALL_EXPLODED_TESTS := gtest
 525 ALL_EXPLODED_TEST_TARGETS := $(addprefix exploded-test-, $(ALL_EXPLODED_TESTS))
 526 
 527 ALL_TARGETS += $(ALL_TEST_TARGETS) $(ALL_EXPLODED_TEST_TARGETS)
 528 
 529 ################################################################################
 530 # Build tests and microbenchmarks
 531 #
 532 
<span class="line-modified"> 533 prepare-test-image:</span>
<span class="line-modified"> 534 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f TestImage.gmk prepare-test-image)</span>


 535 
<span class="line-modified"> 536 build-test-hotspot-jtreg-native:</span>
<span class="line-modified"> 537 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregNativeHotspot.gmk \</span>
<span class="line-modified"> 538 	    build-test-hotspot-jtreg-native)</span>


 539 
<span class="line-modified"> 540 test-image-hotspot-jtreg-native:</span>
<span class="line-modified"> 541 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregNativeHotspot.gmk \</span>
<span class="line-modified"> 542 	    test-image-hotspot-jtreg-native)</span>


 543 
<span class="line-modified"> 544 build-test-jdk-jtreg-native:</span>
<span class="line-modified"> 545 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregNativeJdk.gmk \</span>
<span class="line-modified"> 546 	    build-test-jdk-jtreg-native)</span>


 547 
<span class="line-modified"> 548 test-image-jdk-jtreg-native:</span>
<span class="line-modified"> 549 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregNativeJdk.gmk \</span>
<span class="line-modified"> 550 	    test-image-jdk-jtreg-native)</span>


 551 
<span class="line-modified"> 552 build-test-hotspot-jtreg-graal:</span>
<span class="line-modified"> 553 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregGraalUnit.gmk \</span>
<span class="line-modified"> 554 	     build-test-hotspot-jtreg-graal)</span>


 555 
<span class="line-modified"> 556 test-image-hotspot-jtreg-graal:</span>
<span class="line-modified"> 557 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregGraalUnit.gmk \</span>
<span class="line-modified"> 558 	     test-image-hotspot-jtreg-graal)</span>


 559 
 560 ifeq ($(BUILD_GTEST), true)
<span class="line-modified"> 561   test-image-hotspot-gtest:</span>
<span class="line-modified"> 562 	+($(CD) $(TOPDIR)/make/hotspot/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GtestImage.gmk)</span>


 563 endif
 564 
<span class="line-modified"> 565 build-test-lib:</span>
<span class="line-modified"> 566 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f BuildTestLib.gmk)</span>


 567 
 568 ifeq ($(BUILD_FAILURE_HANDLER), true)
 569   # Builds the failure handler jtreg extension
<span class="line-modified"> 570   build-test-failure-handler:</span>
<span class="line-modified"> 571 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) \</span>
<span class="line-modified"> 572 	    -f BuildFailureHandler.gmk build)</span>


 573 
 574   # Copies the failure handler jtreg extension into the test image
<span class="line-modified"> 575   test-image-failure-handler:</span>
<span class="line-modified"> 576 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) \</span>
<span class="line-modified"> 577 	     -f BuildFailureHandler.gmk images)</span>


 578 endif
 579 
<span class="line-modified"> 580 build-microbenchmark:</span>
<span class="line-modified"> 581 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f test/BuildMicrobenchmark.gmk)</span>
<span class="line-modified"> 582 </span>
<span class="line-modified"> 583 ALL_TARGETS += prepare-test-image build-test-hotspot-jtreg-native \</span>
<span class="line-removed"> 584     test-image-hotspot-jtreg-native build-test-jdk-jtreg-native \</span>
<span class="line-removed"> 585     test-image-jdk-jtreg-native build-test-lib build-test-failure-handler \</span>
<span class="line-removed"> 586     test-failure-handler test-image-failure-handler test-image-hotspot-gtest \</span>
<span class="line-removed"> 587     test-image-hotspot-jtreg-graal build-test-hotspot-jtreg-graal \</span>
<span class="line-removed"> 588     build-microbenchmark</span>
 589 
 590 ################################################################################
 591 # Run tests
 592 
<span class="line-modified"> 593 test:</span>
<span class="line-modified"> 594 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \</span>
<span class="line-modified"> 595 	    TEST=&quot;$(TEST)&quot;)</span>
<span class="line-modified"> 596 </span>
<span class="line-modified"> 597 exploded-test:</span>
<span class="line-removed"> 598 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \</span>
<span class="line-removed"> 599 	    TEST=&quot;$(TEST)&quot; JDK_IMAGE_DIR=$(JDK_OUTPUTDIR))</span>
 600 
<span class="line-modified"> 601 jcov-test:</span>
<span class="line-modified"> 602 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \</span>
<span class="line-modified"> 603 	    TEST=&quot;$(TEST)&quot; TEST_OPTS_JCOV=true)</span>


 604 
<span class="line-modified"> 605 ALL_TARGETS += test exploded-test jcov-test</span>






 606 
 607 ################################################################################
 608 # Bundles
 609 
<span class="line-modified"> 610 product-bundles:</span>
<span class="line-modified"> 611 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk product-bundles)</span>



 612 
<span class="line-modified"> 613 legacy-bundles:</span>
<span class="line-modified"> 614 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk legacy-bundles)</span>



 615 
<span class="line-modified"> 616 test-bundles:</span>
<span class="line-modified"> 617 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk test-bundles)</span>



 618 
<span class="line-modified"> 619 docs-bundles:</span>
<span class="line-modified"> 620 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk docs-bundles)</span>



 621 
<span class="line-modified"> 622 static-libs-bundles:</span>
<span class="line-modified"> 623 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk static-libs-bundles)</span>



 624 
 625 ifeq ($(JCOV_ENABLED), true)
<span class="line-modified"> 626   jcov-bundles:</span>
<span class="line-modified"> 627 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk jcov-bundles)</span>



 628 endif
 629 
<span class="line-removed"> 630 ALL_TARGETS += product-bundles legacy-bundles test-bundles docs-bundles \</span>
<span class="line-removed"> 631     static-libs-bundles jcov-bundles</span>
<span class="line-removed"> 632 </span>
 633 ################################################################################
 634 # Install targets
 635 
<span class="line-modified"> 636 install:</span>
<span class="line-modified"> 637 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Install.gmk)</span>
<span class="line-modified"> 638 </span>
<span class="line-modified"> 639 ALL_TARGETS += install</span>
 640 
 641 ################################################################################
 642 #
 643 # Dependency declarations between targets.
 644 #
 645 # These are declared in two groups. First all dependencies between targets that
 646 # have recipes above as these dependencies may be disabled. Then the aggregator
 647 # targets that do not have recipes of their own, which will never have their
 648 # dependencies disabled.
 649 #
 650 ################################################################################
 651 # Targets with recipes above
 652 
 653 # If running an *-only target, parallel execution and dependencies between
 654 # recipe targets are disabled. This makes it possible to run a select set of
 655 # recipe targets in order. It&#39;s the responsibility of the user to make sure
 656 # all prerequisites are fulfilled.
<span class="line-modified"> 657 ifneq ($(findstring -only, $(MAKECMDGOALS)), )</span>
 658   .NOTPARALLEL:
 659 else
 660   $(LANGTOOLS_GENSRC_TARGETS): buildtools-langtools
 661 
 662   interim-langtools: $(INTERIM_LANGTOOLS_GENSRC_TARGETS)
 663 
<span class="line-removed"> 664   buildtools-jdk: interim-langtools interim-tzdb</span>
<span class="line-removed"> 665 </span>
<span class="line-removed"> 666   buildtools-hotspot: interim-langtools</span>
<span class="line-removed"> 667 </span>
<span class="line-removed"> 668   buildtools-modules: exploded-image-base</span>
<span class="line-removed"> 669 </span>
 670   $(HOTSPOT_GENSRC_TARGETS): interim-langtools buildtools-hotspot
 671 
 672   $(JDK_GENSRC_TARGETS): interim-langtools buildtools-jdk
 673 
 674   $(GENSRC_MODULEINFO_TARGETS): buildtools-jdk
 675 
 676   $(GENDATA_TARGETS): interim-langtools buildtools-jdk
 677 
 678   $(JAVA_TARGETS): interim-langtools
 679 
 680   # Declare dependencies between hotspot-&lt;variant&gt;* targets
 681   $(foreach v, $(JVM_VARIANTS), \
 682       $(eval hotspot-$v-gensrc: java.base-copy) \
 683       $(eval hotspot-$v-libs: hotspot-$v-gensrc java.base-copy) \
 684   )
 685 
<span class="line-removed"> 686   hotspot-ide-project: hotspot exploded-image</span>
<span class="line-removed"> 687 </span>
<span class="line-removed"> 688   generate-exported-symbols: java.base-libs jdk.jdwp.agent-libs</span>
<span class="line-removed"> 689 </span>
 690   # If not already set, set the JVM variant target so that the JVM will be built.
 691   JVM_MAIN_LIB_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-libs
 692 
 693   # Building one JVM variant is enough to start building the other libs
 694   $(LIBS_TARGETS): $(JVM_MAIN_LIB_TARGETS)
 695 
 696   $(LAUNCHER_TARGETS): java.base-libs
 697 
 698   ifeq ($(STATIC_BUILD), true)
 699     $(LAUNCHER_TARGETS): generate-exported-symbols
 700   endif
 701 
<span class="line-removed"> 702   # The demos are currently linking to libjvm and libjava, just like all other</span>
<span class="line-removed"> 703   # jdk libs, even though they don&#39;t need to. To avoid warnings, make sure they</span>
<span class="line-removed"> 704   # aren&#39;t built until after libjava and libjvm are available to link to.</span>
<span class="line-removed"> 705   demos-jdk: java.base-libs exploded-image</span>
<span class="line-removed"> 706   test-image-demos-jdk: demos-jdk</span>
<span class="line-removed"> 707 </span>
 708   # Declare dependency from &lt;module&gt;-java to &lt;module&gt;-gensrc
 709   $(foreach m, $(GENSRC_MODULES), $(eval $m-java: $m-gensrc))
 710 
 711   # Declare dependencies between java modules
 712   $(foreach m, $(JAVA_MODULES), \
 713       $(eval $m-java: $(addsuffix -java, $(filter $(JAVA_MODULES), \
 714       $(call FindDepsForModule,$m)))))
 715   # Declare dependencies between the module meta targets
 716   $(foreach m, $(ALL_MODULES), $(eval $m: $(call FindDepsForModule,$m)))
 717 
 718   # Declare dependencies from &lt;module&gt;-lib to &lt;module&gt;-java
 719   # Skip modules that do not have java source.
 720   $(foreach m, $(filter $(JAVA_MODULES), $(LIBS_MODULES)), $(eval $m-libs: $m-java))
 721 
 722   # Declare dependencies from all other &lt;module&gt;-lib to java.base-lib
 723   $(foreach t, $(filter-out java.base-libs, $(LIBS_TARGETS)), \
 724       $(eval $t: java.base-libs))
 725 
 726   # jdk.accessibility depends on java.desktop
 727   jdk.accessibility-libs: java.desktop-libs
</pre>
<hr />
<pre>
 775   $(foreach m, $(COPY_MODULES), $(eval $m_JMOD_DEPS += $m-copy))
 776   $(foreach m, $(ALL_MODULES), $(eval $m-jmod: $($(m)_JMOD_DEPS)))
 777   $(foreach m, $(INTERIM_IMAGE_MODULES), $(eval $m-interim-jmod: $($(m)_JMOD_DEPS)))
 778 
 779   # Setup the minimal set of generated native source dependencies for hotspot
 780   $(foreach v, $(JVM_VARIANTS), \
 781     $(eval hotspot-$v-libs-compile-commands: hotspot-$v-gensrc) \
 782     $(foreach m, $(filter java.desktop jdk.hotspot.agent, $(GENSRC_MODULES)), \
 783       $(eval hotspot-$v-libs-compile-commands: $m-gensrc)) \
 784   )
 785 
 786   # For the full JDK compile commands, create all possible generated sources
 787   $(foreach m, $(GENSRC_MODULES), $(eval $m-libs-compile-commands: $m-gensrc))
 788   $(foreach m, $(filter $(JAVA_MODULES), $(LIBS_MODULES)), $(eval $m-libs-compile-commands: $m-java))
 789 
 790   $(COMPILE_COMMANDS_TARGETS_HOTSPOT): clean-compile-commands
 791   $(COMPILE_COMMANDS_TARGETS_JDK): clean-compile-commands
 792   compile-commands-hotspot: $(COMPILE_COMMANDS_TARGETS_HOTSPOT)
 793   compile-commands: $(COMPILE_COMMANDS_TARGETS_HOTSPOT) $(COMPILE_COMMANDS_TARGETS_JDK)
 794 
<span class="line-removed"> 795   vscode-project: compile-commands</span>
<span class="line-removed"> 796   vscode-project-clangd: compile-commands</span>
<span class="line-removed"> 797   vscode-project-rtags: compile-commands</span>
<span class="line-removed"> 798   vscode-project-ccls: compile-commands</span>
<span class="line-removed"> 799 </span>
 800   # The -static-libs targets depend on -java as well as java.base-copy.
 801   $(foreach m, $(filter $(JAVA_MODULES), $(STATIC_LIBS_MODULES)), \
 802     $(eval $m-static-libs: $m-java java.base-copy))
 803 
 804   # Jmods cannot be created until we have the jmod tool ready to run. During
 805   # a normal build we run it from the exploded image, but when cross compiling
 806   # it&#39;s run from the buildjdk, which is either created at build time or user
 807   # supplied.
 808   ifeq ($(CREATE_BUILDJDK), true)
 809     ifneq ($(CREATING_BUILDJDK), true)
 810       # When cross compiling and buildjdk is to be created, simply depend on
 811       # creating the buildjdk.
 812       $(JMOD_TARGETS): create-buildjdk
 813       buildtools-modules: create-buildjdk
 814     else
 815       # While actually creating the buildjdk, we need to list the bare
 816       # minimum dependencies needed before running jmod, to avoid building
 817       # more than necessary. This includes:
 818       # * all java modules
 819       # * jdk.jlink-launchers
 820       # * copy jvm.cfg (done in java.base-copy)
 821       # * tzdb.dat (done in java.base-gendata)
 822       # Without all of these jimage, jlink and jmod won&#39;t start.
 823       $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): java.base-libs java.base-copy \
 824           java.base-gendata jdk.jlink-launchers java
 825     endif
 826   else
 827     # The normal non cross compilation case uses needs to wait for the full
 828     # exploded-image to avoid a race with the optimize target.
 829     $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): exploded-image
 830   endif
 831 
 832   # All modules include the main license files from java.base.
 833   $(JMOD_TARGETS): java.base-copy
 834 
<span class="line-modified"> 835   zip-security: java.base-java java.security.jgss-java java.security.jgss-libs \</span>
<span class="line-removed"> 836       $(filter jdk.crypto%, $(JAVA_TARGETS))</span>
<span class="line-removed"> 837 </span>
<span class="line-removed"> 838   zip-source: gensrc</span>
<span class="line-removed"> 839 </span>
<span class="line-removed"> 840   jrtfs-jar: interim-langtools</span>
<span class="line-removed"> 841 </span>
<span class="line-removed"> 842   build-microbenchmark: interim-langtools exploded-image</span>
 843 
 844   ifeq ($(ENABLE_GENERATE_CLASSLIST), true)
 845     ifeq ($(CREATE_BUILDJDK), true)
 846       # If creating a buildjdk, the interim image needs to be based on that.
 847       generate-link-opt-data: create-buildjdk
 848     else ifeq ($(EXTERNAL_BUILDJDK), false)
 849       # If an external buildjdk has been provided, we skip generating an
 850       # interim-image and just use the external buildjdk for generating
 851       # classlist.
 852       generate-link-opt-data: interim-image
 853     endif
 854     generate-link-opt-data: buildtools-jdk
 855 
 856     # The generated classlist needs to go into java.base-jmod.
 857     java.base-jmod jdk.jlink-jmod jdk-image legacy-jre-image: generate-link-opt-data
 858   endif
 859 
<span class="line-removed"> 860   release-file: create-source-revision-tracker</span>
<span class="line-removed"> 861 </span>
<span class="line-removed"> 862   jdk-image: jmods zip-source demos release-file</span>
<span class="line-removed"> 863   legacy-jre-image: jmods release-file</span>
 864   symbols-image: $(LIBS_TARGETS) $(LAUNCHER_TARGETS)
 865 
 866   static-libs-image: $(STATIC_LIBS_TARGETS)
 867 
<span class="line-removed"> 868   graal-builder-image: jdk-image static-libs-image</span>
<span class="line-removed"> 869 </span>
<span class="line-removed"> 870   mac-jdk-bundle: jdk-image</span>
<span class="line-removed"> 871   mac-legacy-jre-bundle: legacy-jre-image</span>
<span class="line-removed"> 872 </span>
<span class="line-removed"> 873   ifeq ($(JCOV_INPUT_JDK), )</span>
<span class="line-removed"> 874     jcov-image: jdk-image</span>
<span class="line-removed"> 875   endif</span>
<span class="line-removed"> 876 </span>
<span class="line-removed"> 877   # The optimize target can run as soon as the modules dir has been completely</span>
<span class="line-removed"> 878   # populated (java, copy and gendata targets) and the basic libs and launchers</span>
<span class="line-removed"> 879   # have been built.</span>
<span class="line-removed"> 880   exploded-image-optimize: java copy gendata java.base-libs java.base-launchers \</span>
<span class="line-removed"> 881       buildtools-modules</span>
<span class="line-removed"> 882 </span>
 883   bootcycle-images: jdk-image
 884 
 885   docs-jdk-api-javadoc: $(GENSRC_TARGETS)
 886 
 887   docs-javase-api-javadoc: $(GENSRC_TARGETS)
 888 
 889   docs-reference-api-javadoc: $(GENSRC_TARGETS)
 890 
<span class="line-removed"> 891   docs-jdk-api-modulegraph: exploded-image buildtools-modules</span>
<span class="line-removed"> 892 </span>
<span class="line-removed"> 893   docs-javase-api-modulegraph: exploded-image buildtools-modules</span>
<span class="line-removed"> 894 </span>
<span class="line-removed"> 895   docs-reference-api-modulegraph: exploded-image buildtools-modules</span>
<span class="line-removed"> 896 </span>
 897   # If not already set, then set the JVM specific docs targets
 898   JVM_DOCS_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-gensrc
 899 
<span class="line-modified"> 900   # The gensrc steps for hotspot and jdk.jdi create html spec files.</span>
<span class="line-modified"> 901   docs-jdk-specs: buildtools-jdk $(JVM_DOCS_TARGETS) jdk.jdi-gensrc \</span>
<span class="line-removed"> 902       docs-jdk-index</span>
<span class="line-removed"> 903 </span>
<span class="line-removed"> 904   docs-zip: docs-jdk</span>
<span class="line-removed"> 905 </span>
<span class="line-removed"> 906   docs-specs-zip: docs-jdk-specs</span>
 907 
 908   # Tests
<span class="line-removed"> 909   test: jdk-image test-image</span>
<span class="line-removed"> 910 </span>
<span class="line-removed"> 911   exploded-test: exploded-image test-image</span>
<span class="line-removed"> 912 </span>
<span class="line-removed"> 913   jcov-test: jcov-image test-image</span>
<span class="line-removed"> 914 </span>
 915   test-make: clean-test-make compile-commands
 916 
 917   test-make-compile-commands: compile-commands
 918 
 919   # Declare dependency for all generated test targets
 920   $(foreach t, $(filter-out test-make%, $(ALL_TEST_TARGETS)), $(eval $t: jdk-image test-image))
 921   $(foreach t, $(ALL_EXPLODED_TEST_TARGETS), $(eval $t: exploded-image test-image))
 922 
 923   interim-image: $(INTERIM_JMOD_TARGETS)
 924 
<span class="line-modified"> 925   build-test-lib: exploded-image</span>
<span class="line-removed"> 926 </span>
<span class="line-removed"> 927   build-test-failure-handler: interim-langtools</span>
<span class="line-removed"> 928 </span>
<span class="line-removed"> 929   test-image-failure-handler: build-test-failure-handler</span>
<span class="line-removed"> 930 </span>
<span class="line-removed"> 931   build-test-hotspot-jtreg-native: buildtools-jdk \</span>
<span class="line-removed"> 932       hotspot-$(JVM_VARIANT_MAIN)-libs</span>
<span class="line-removed"> 933 </span>
<span class="line-removed"> 934   build-test-jdk-jtreg-native: buildtools-jdk java.base-libs</span>
<span class="line-removed"> 935 </span>
<span class="line-removed"> 936   build-test-hotspot-jtreg-graal: exploded-image</span>
<span class="line-removed"> 937 </span>
<span class="line-removed"> 938   test-image-hotspot-jtreg-native: build-test-hotspot-jtreg-native</span>
<span class="line-removed"> 939 </span>
<span class="line-removed"> 940   test-image-jdk-jtreg-native: build-test-jdk-jtreg-native</span>
<span class="line-removed"> 941 </span>
<span class="line-removed"> 942   test-image-hotspot-jtreg-graal: build-test-hotspot-jtreg-graal</span>
<span class="line-removed"> 943 </span>
<span class="line-removed"> 944   test-image-hotspot-gtest: hotspot</span>
<span class="line-removed"> 945 </span>
<span class="line-removed"> 946   install: product-images</span>
<span class="line-removed"> 947 </span>
<span class="line-removed"> 948   product-bundles: product-images</span>
<span class="line-removed"> 949 </span>
<span class="line-removed"> 950   legacy-bundles: legacy-images</span>
<span class="line-removed"> 951 </span>
<span class="line-removed"> 952   test-bundles: test-image</span>
<span class="line-removed"> 953 </span>
<span class="line-removed"> 954   docs-bundles: docs-image</span>
<span class="line-removed"> 955 </span>
<span class="line-removed"> 956   jcov-bundles: jcov-image</span>
<span class="line-removed"> 957 </span>
<span class="line-removed"> 958   static-libs-bundles: static-libs-image</span>
<span class="line-removed"> 959 </span>
<span class="line-removed"> 960   generate-summary: jmods buildtools-modules</span>
<span class="line-removed"> 961 </span>
<span class="line-removed"> 962   update-x11wrappers: java.base-copy buildtools-jdk</span>
 963 
 964 endif
 965 
 966 ################################################################################
 967 # Virtual targets without recipes
 968 
 969 # If not already set, set the JVM specific tools targets
 970 JVM_TOOLS_TARGETS ?= buildtools-hotspot
 971 buildtools: buildtools-langtools interim-langtools \
 972     buildtools-jdk $(JVM_TOOLS_TARGETS)
 973 
 974 # Declare dependencies from hotspot-&lt;variant&gt; targets
 975 $(foreach v, $(JVM_VARIANTS), \
 976   $(eval hotspot-$v: hotspot-$v-gensrc hotspot-$v-libs) \
 977 )
 978 hotspot: $(HOTSPOT_VARIANT_TARGETS)
 979 
 980 # Create targets hotspot-libs and hotspot-gensrc.
 981 $(foreach v, $(JVM_VARIANTS), \
 982   $(eval hotspot-libs: hotspot-$v-libs) \
</pre>
<hr />
<pre>
1073   endif
1074 endif
1075 
1076 ifeq ($(call isTargetOs, macosx), true)
1077   product-images: mac-jdk-bundle
1078 
1079   legacy-images: mac-legacy-jre-bundle
1080 endif
1081 
1082 # This target builds the documentation image
1083 docs-image: docs-jdk
1084 
1085 # If not already set, set the JVM specific targets to build the test image
1086 JVM_TEST_IMAGE_TARGETS ?= test-image-hotspot-jtreg-native test-image-hotspot-gtest
1087 
1088 ifeq ($(INCLUDE_GRAAL), true)
1089   JVM_TEST_IMAGE_TARGETS += test-image-hotspot-jtreg-graal
1090 endif
1091 
1092 # This target builds the test image
<span class="line-modified">1093 test-image: prepare-test-image \</span>
<span class="line-removed">1094     test-image-jdk-jtreg-native test-image-failure-handler \</span>
1095     test-image-demos-jdk $(JVM_TEST_IMAGE_TARGETS)
1096 




1097 ifneq ($(JMH_CORE_JAR), )
1098   test-image: build-microbenchmark
1099 endif
1100 
1101 ################################################################################
1102 
1103 # all-images builds all our deliverables as images.
1104 all-images: product-images test-image docs-image
1105 
1106 # all-bundles packages all our deliverables as tar.gz bundles.
1107 all-bundles: product-bundles test-bundles docs-bundles static-libs-bundles
1108 
1109 ALL_TARGETS += buildtools hotspot hotspot-libs hotspot-gensrc gensrc gendata \
1110     copy java libs static-libs launchers jmods \
1111     jdk.jdwp.agent-gensrc $(ALL_MODULES) demos \
1112     exploded-image-base exploded-image \
1113     create-buildjdk docs-jdk-api docs-javase-api docs-reference-api docs-jdk \
1114     docs-javase docs-reference docs-javadoc mac-bundles product-images legacy-images \
1115     docs-image test-image all-images \
1116     all-bundles
</pre>
</td>
<td>
<hr />
<pre>
  21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22 # or visit www.oracle.com if you need additional information or have any
  23 # questions.
  24 #
  25 
  26 ################################################################################
  27 # This is the main makefile containing most actual top level targets. It needs
  28 # to be called with a SPEC file defined.
  29 ################################################################################
  30 
  31 # Declare default target
  32 default:
  33 
  34 ifeq ($(wildcard $(SPEC)),)
  35   $(error Main.gmk needs SPEC set to a proper spec.gmk)
  36 endif
  37 
  38 # Now load the spec
  39 include $(SPEC)
  40 


  41 # Load the vital tools for all the makefiles.
  42 include $(TOPDIR)/make/common/MakeBase.gmk
  43 include $(TOPDIR)/make/common/Modules.gmk
  44 include $(TOPDIR)/make/common/FindTests.gmk
  45 
<span class="line-added">  46 include $(TOPDIR)/make/MainSupport.gmk</span>
<span class="line-added">  47 </span>
<span class="line-added">  48 # Are we requested to ignore dependencies?</span>
<span class="line-added">  49 ifneq ($(findstring -only, $(MAKECMDGOALS)), )</span>
<span class="line-added">  50   DEPS := none</span>
<span class="line-added">  51 endif</span>
<span class="line-added">  52 </span>
  53 # Declare ALL_TARGETS as an immediate variable. This variable is a list of all
  54 # valid top level targets. It&#39;s used to declare them all as PHONY and to
  55 # generate the -only targets.
  56 ALL_TARGETS :=
  57 
  58 # Hook to include the corresponding custom file, if present.
  59 $(eval $(call IncludeCustomExtension, Main.gmk))
  60 
  61 # All modules for the current target platform.
  62 ALL_MODULES := $(call FindAllModules)
  63 
  64 ################################################################################
  65 ################################################################################
  66 #
  67 # Recipes for all targets. Only recipes, dependencies are declared later.
  68 #
  69 ################################################################################
  70 
  71 ################################################################################
  72 # Interim/build tools targets, compiling tools used during the build
  73 
<span class="line-modified">  74 $(eval $(call SetupTarget, buildtools-langtools, \</span>
<span class="line-modified">  75     MAKEFILE := ToolsLangtools, \</span>
<span class="line-modified">  76 ))</span>





  77 
<span class="line-added">  78 $(eval $(call SetupTarget, interim-langtools, \</span>
<span class="line-added">  79     MAKEFILE := CompileInterimLangtools, \</span>
<span class="line-added">  80 ))</span>
  81 
<span class="line-modified">  82 $(eval $(call SetupTarget, interim-tzdb, \</span>
<span class="line-modified">  83     MAKEFILE := CopyInterimTZDB, \</span>
<span class="line-added">  84 ))</span>
  85 
<span class="line-modified">  86 $(eval $(call SetupTarget, buildtools-jdk, \</span>
<span class="line-modified">  87     MAKEFILE := CompileToolsJdk, \</span>
<span class="line-added">  88     DEPS := interim-langtools interim-tzdb, \</span>
<span class="line-added">  89 ))</span>
  90 
<span class="line-modified">  91 $(eval $(call SetupTarget, buildtools-modules, \</span>
<span class="line-modified">  92     MAKEFILE := CompileModuleTools, \</span>
<span class="line-added">  93     DEPS := exploded-image-base, \</span>
<span class="line-added">  94 ))</span>
  95 
<span class="line-modified">  96 $(eval $(call SetupTarget, buildtools-hotspot, \</span>
<span class="line-modified">  97     MAKEFILE := CompileToolsHotspot, \</span>
<span class="line-modified">  98     DEPS := interim-langtools, \</span>
<span class="line-added">  99 ))</span>
 100 
 101 ################################################################################
 102 # Special targets for certain modules
 103 
<span class="line-modified"> 104 $(eval $(call SetupTarget, generate-exported-symbols, \</span>
<span class="line-modified"> 105     MAKEFILE := BuildStatic, \</span>
<span class="line-modified"> 106     DEPS := java.base-libs jdk.jdwp.agent-libs, \</span>
<span class="line-modified"> 107 ))</span>
 108 
 109 ################################################################################
 110 # Gensrc targets, generating source before java compilation can be done
 111 #
 112 $(eval $(call DeclareRecipesForPhase, GENSRC, \
 113     TARGET_SUFFIX := gensrc-src, \
 114     FILE_PREFIX := Gensrc, \
 115     MAKE_SUBDIR := gensrc, \
 116     CHECK_MODULES := $(ALL_MODULES), \
 117 ))
 118 
 119 $(foreach m, $(GENSRC_MODULES), $(eval $m-gensrc: $m-gensrc-src))
 120 
 121 LANGTOOLS_GENSRC_TARGETS := $(filter $(addsuffix -%, $(LANGTOOLS_MODULES)), $(GENSRC_TARGETS))
 122 INTERIM_LANGTOOLS_GENSRC_TARGETS := $(filter $(addsuffix -%, \
 123     $(INTERIM_LANGTOOLS_BASE_MODULES)), $(GENSRC_TARGETS))
 124 HOTSPOT_GENSRC_TARGETS := $(filter $(addsuffix -%, $(HOTSPOT_MODULES)), $(GENSRC_TARGETS))
 125 JDK_GENSRC_TARGETS := $(filter-out $(LANGTOOLS_GENSRC_TARGETS) \
 126     $(HOTSPOT_GENSRC_TARGETS), $(GENSRC_TARGETS))
 127 
</pre>
<hr />
<pre>
 243 HOTSPOT_VARIANT_GENSRC_TARGETS := $(addsuffix -gensrc, $(HOTSPOT_VARIANT_TARGETS))
 244 HOTSPOT_VARIANT_LIBS_TARGETS := $(addsuffix -libs, $(HOTSPOT_VARIANT_TARGETS))
 245 
 246 define DeclareHotspotGensrcRecipe
 247   hotspot-$1-gensrc:
 248 	$$(call LogInfo, Building JVM variant &#39;$1&#39; with features &#39;$(JVM_FEATURES_$1)&#39;)
 249 	+($(CD) $(TOPDIR)/make/hotspot &amp;&amp; $(MAKE) $(MAKE_ARGS) -f gensrc/GenerateSources.gmk \
 250 	    JVM_VARIANT=$1)
 251 endef
 252 
 253 $(foreach v, $(JVM_VARIANTS), $(eval $(call DeclareHotspotGensrcRecipe,$v)))
 254 
 255 define DeclareHotspotLibsRecipe
 256   hotspot-$1-libs:
 257 	+($(CD) $(TOPDIR)/make/hotspot &amp;&amp; $(MAKE) $(MAKE_ARGS) -f lib/CompileLibraries.gmk \
 258 	    JVM_VARIANT=$1)
 259 endef
 260 
 261 $(foreach v, $(JVM_VARIANTS), $(eval $(call DeclareHotspotLibsRecipe,$v)))
 262 
<span class="line-modified"> 263 $(eval $(call SetupTarget, hotspot-ide-project, \</span>
<span class="line-modified"> 264     MAKEFILE := hotspot/ide/CreateVSProject, \</span>
<span class="line-added"> 265     DEPS := hotspot exploded-image, \</span>
<span class="line-added"> 266 ))</span>
 267 
 268 ALL_TARGETS += $(HOTSPOT_VARIANT_TARGETS) $(HOTSPOT_VARIANT_GENSRC_TARGETS) \
<span class="line-modified"> 269     $(HOTSPOT_VARIANT_LIBS_TARGETS)</span>
 270 
 271 ################################################################################
 272 # Generate libs and launcher targets for creating compile_commands.json fragments
 273 define DeclareCompileCommandsRecipe
 274   $1-compile-commands:
 275 	$$(call LogInfo, Generating compile_commands.json fragments for $1)
 276 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Main.gmk $1-only \
 277 	    GENERATE_COMPILE_COMMANDS_ONLY=true)
 278 
 279   COMPILE_COMMANDS_TARGETS_$2 += $1-compile-commands
 280 endef
 281 
 282 $(foreach t, $(HOTSPOT_VARIANT_LIBS_TARGETS), \
 283   $(eval $(call DeclareCompileCommandsRecipe,$t,HOTSPOT)) \
 284 )
 285 
 286 $(foreach t, $(LIBS_TARGETS) $(LAUNCHER_TARGETS), \
 287   $(eval $(call DeclareCompileCommandsRecipe,$t,JDK)) \
 288 )
 289 
<span class="line-modified"> 290 $(eval $(call SetupTarget, compile-commands, \</span>
<span class="line-modified"> 291     MAKEFILE := CompileCommands, \</span>
<span class="line-added"> 292 ))</span>
<span class="line-added"> 293 </span>
<span class="line-added"> 294 $(eval $(call SetupTarget, compile-commands-hotspot, \</span>
<span class="line-added"> 295     MAKEFILE := CompileCommands, \</span>
<span class="line-added"> 296 ))</span>
 297 
 298 ALL_TARGETS += $(COMPILE_COMMANDS_TARGETS_HOTSPOT) $(COMPILE_COMMANDS_TARGETS_JDK)

 299 
 300 ################################################################################
 301 # VS Code projects



 302 
<span class="line-modified"> 303 $(eval $(call SetupTarget, vscode-project, \</span>
<span class="line-modified"> 304     MAKEFILE := CreateVSCodeProject, \</span>
<span class="line-modified"> 305     ARGS := VSCODE_INDEXER=cpptools, \</span>
<span class="line-added"> 306     DEPS := compile-commands, \</span>
<span class="line-added"> 307 ))</span>
 308 
<span class="line-modified"> 309 $(eval $(call SetupTarget, vscode-project-clangd, \</span>
<span class="line-modified"> 310     MAKEFILE := CreateVSCodeProject, \</span>
<span class="line-modified"> 311     ARGS := VSCODE_INDEXER=clangd, \</span>
<span class="line-added"> 312     DEPS := compile-commands, \</span>
<span class="line-added"> 313 ))</span>
 314 
<span class="line-modified"> 315 $(eval $(call SetupTarget, vscode-project-rtags, \</span>
<span class="line-modified"> 316     MAKEFILE := CreateVSCodeProject, \</span>
<span class="line-modified"> 317     ARGS := VSCODE_INDEXER=rtags, \</span>
<span class="line-added"> 318     DEPS := compile-commands, \</span>
<span class="line-added"> 319 ))</span>
 320 
<span class="line-modified"> 321 $(eval $(call SetupTarget, vscode-project-ccls, \</span>
<span class="line-modified"> 322     MAKEFILE := CreateVSCodeProject, \</span>
<span class="line-added"> 323     ARGS := VSCODE_INDEXER=ccls, \</span>
<span class="line-added"> 324     DEPS := compile-commands, \</span>
<span class="line-added"> 325 ))</span>
 326 
 327 ################################################################################
 328 # Build demos targets
 329 
<span class="line-modified"> 330 # The demos are currently linking to libjvm and libjava, just like all other</span>
<span class="line-modified"> 331 # jdk libs, even though they don&#39;t need to. To avoid warnings, make sure they</span>
<span class="line-modified"> 332 # aren&#39;t built until after libjava and libjvm are available to link to.</span>
<span class="line-modified"> 333 $(eval $(call SetupTarget, demos-jdk, \</span>
<span class="line-modified"> 334     MAKEFILE := CompileDemos, \</span>
<span class="line-added"> 335     DEPS := java.base-libs exploded-image, \</span>
<span class="line-added"> 336 ))</span>
 337 
<span class="line-modified"> 338 $(eval $(call SetupTarget, test-image-demos-jdk, \</span>
<span class="line-added"> 339     MAKEFILE := CompileDemos, \</span>
<span class="line-added"> 340     TARGET := images, \</span>
<span class="line-added"> 341     DEPS := demos-jdk, \</span>
<span class="line-added"> 342 ))</span>
 343 
 344 ################################################################################
 345 # Jigsaw specific data and analysis targets.
 346 
<span class="line-modified"> 347 $(eval $(call SetupTarget, generate-summary, \</span>
<span class="line-modified"> 348     MAKEFILE := GenerateModuleSummary, \</span>
<span class="line-modified"> 349     DEPS := jmods buildtools-modules, \</span>
<span class="line-modified"> 350 ))</span>
 351 
 352 ################################################################################
 353 # Jmod targets
 354 
 355 JMOD_MODULES := $(ALL_MODULES)
 356 JMOD_TARGETS := $(addsuffix -jmod, $(JMOD_MODULES))
 357 
 358 define DeclareJmodRecipe
 359   $1-jmod:
 360 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateJmods.gmk \
 361 	    MODULE=$1)
 362 endef
 363 
 364 $(foreach m, $(JMOD_MODULES), $(eval $(call DeclareJmodRecipe,$m)))
 365 
 366 ALL_TARGETS += $(JMOD_TARGETS)
 367 
 368 ################################################################################
 369 # Images targets
 370 
<span class="line-modified"> 371 $(eval $(call SetupTarget, store-source-revision, \</span>
<span class="line-modified"> 372     MAKEFILE := SourceRevision, \</span>
<span class="line-added"> 373     TARGET := store-source-revision, \</span>
<span class="line-added"> 374 ))</span>
 375 
<span class="line-modified"> 376 $(eval $(call SetupTarget, create-source-revision-tracker, \</span>
<span class="line-modified"> 377     MAKEFILE := SourceRevision, \</span>
<span class="line-added"> 378     TARGET := create-source-revision-tracker, \</span>
<span class="line-added"> 379 ))</span>
 380 
 381 BOOTCYCLE_TARGET := product-images
 382 bootcycle-images:
 383         ifneq ($(COMPILE_TYPE), cross)
 384 	  $(call LogWarn, Boot cycle build step 2: Building a new JDK image using previously built image)
 385 	  $(call MakeDir, $(OUTPUTDIR)/bootcycle-build)
 386 	  +$(MAKE) $(MAKE_ARGS) -f $(TOPDIR)/make/Init.gmk PARALLEL_TARGETS=$(BOOTCYCLE_TARGET) \
 387 	      LOG_PREFIX=&quot;[bootcycle] &quot; JOBS= SPEC=$(dir $(SPEC))bootcycle-spec.gmk main
 388         else
 389 	  $(call LogWarn, Boot cycle build disabled when cross compiling)
 390         endif
 391 
<span class="line-modified"> 392 $(eval $(call SetupTarget, zip-security, \</span>
<span class="line-modified"> 393     MAKEFILE := ZipSecurity, \</span>
<span class="line-added"> 394     DEPS := java.base-java java.security.jgss-java java.security.jgss-libs, \</span>
<span class="line-added"> 395 ))</span>
 396 
<span class="line-modified"> 397 $(eval $(call SetupTarget, zip-source, \</span>
<span class="line-modified"> 398     MAKEFILE := ZipSource, \</span>
<span class="line-added"> 399     DEPS := gensrc, \</span>
<span class="line-added"> 400 ))</span>
 401 
<span class="line-modified"> 402 $(eval $(call SetupTarget, jrtfs-jar, \</span>
<span class="line-modified"> 403     MAKEFILE := JrtfsJar, \</span>
<span class="line-added"> 404     DEPS := interim-langtools, \</span>
<span class="line-added"> 405 ))</span>
 406 
<span class="line-modified"> 407 $(eval $(call SetupTarget, jdk-image, \</span>
<span class="line-modified"> 408     MAKEFILE := Images, \</span>
<span class="line-added"> 409     TARGET := jdk, \</span>
<span class="line-added"> 410     DEPS := jmods zip-source demos release-file, \</span>
<span class="line-added"> 411 ))</span>
 412 
<span class="line-modified"> 413 $(eval $(call SetupTarget, legacy-jre-image, \</span>
<span class="line-modified"> 414     MAKEFILE := Images, \</span>
<span class="line-added"> 415     TARGET := jre, \</span>
<span class="line-added"> 416     DEPS := jmods release-file, \</span>
<span class="line-added"> 417 ))</span>
 418 
<span class="line-modified"> 419 $(eval $(call SetupTarget, symbols-image, \</span>
<span class="line-modified"> 420     MAKEFILE := Images, \</span>
<span class="line-added"> 421     TARGET := symbols, \</span>
<span class="line-added"> 422 ))</span>
 423 
<span class="line-modified"> 424 $(eval $(call SetupTarget, static-libs-image, \</span>
<span class="line-modified"> 425     MAKEFILE := StaticLibsImage, \</span>
<span class="line-added"> 426 ))</span>
 427 
<span class="line-modified"> 428 $(eval $(call SetupTarget, mac-jdk-bundle, \</span>
<span class="line-modified"> 429     MAKEFILE := MacBundles, \</span>
<span class="line-added"> 430     TARGET := jdk-bundle, \</span>
<span class="line-added"> 431     DEPS := jdk-image, \</span>
<span class="line-added"> 432 ))</span>
 433 
<span class="line-modified"> 434 $(eval $(call SetupTarget, mac-legacy-jre-bundle, \</span>
<span class="line-modified"> 435     MAKEFILE := MacBundles, \</span>
<span class="line-added"> 436     TARGET := jre-bundle, \</span>
<span class="line-added"> 437     DEPS := legacy-jre-image, \</span>
<span class="line-added"> 438 ))</span>
 439 
<span class="line-modified"> 440 $(eval $(call SetupTarget, release-file, \</span>
<span class="line-modified"> 441     MAKEFILE := ReleaseFile, \</span>
<span class="line-added"> 442     DEPS := create-source-revision-tracker, \</span>
<span class="line-added"> 443 ))</span>
 444 
<span class="line-modified"> 445 $(eval $(call SetupTarget, exploded-image-optimize, \</span>
<span class="line-modified"> 446     MAKEFILE := ExplodedImageOptimize, \</span>
<span class="line-added"> 447     DEPS := java copy gendata java.base-libs java.base-launchers \</span>
<span class="line-added"> 448         buildtools-modules, \</span>
<span class="line-added"> 449 ))</span>
 450 
<span class="line-modified"> 451 $(eval $(call SetupTarget, graal-builder-image, \</span>
<span class="line-modified"> 452     MAKEFILE := GraalBuilderImage, \</span>
<span class="line-added"> 453     DEPS := jdk-image static-libs-image, \</span>
<span class="line-added"> 454 ))</span>
 455 
 456 ifeq ($(JCOV_ENABLED), true)
<span class="line-modified"> 457   $(eval $(call SetupTarget, jcov-image, \</span>
<span class="line-modified"> 458       MAKEFILE := Coverage, \</span>
<span class="line-added"> 459       TARGET := jcov-image, \</span>
<span class="line-added"> 460       DEPS := jdk-image, \</span>
<span class="line-added"> 461   ))</span>
 462 endif
 463 
<span class="line-modified"> 464 ALL_TARGETS += bootcycle-images</span>



 465 
 466 ################################################################################
 467 # Docs targets
 468 
 469 # If building full docs, to complete docs-*-api we need both the javadoc and
 470 # modulegraph targets.
<span class="line-modified"> 471 $(eval $(call SetupTarget, docs-jdk-api-javadoc, \</span>
<span class="line-modified"> 472     MAKEFILE := Docs, \</span>
<span class="line-modified"> 473     TARGET := docs-jdk-api-javadoc, \</span>
<span class="line-modified"> 474 ))</span>

 475 
<span class="line-modified"> 476 $(eval $(call SetupTarget, docs-jdk-api-modulegraph, \</span>
<span class="line-modified"> 477     MAKEFILE := Docs, \</span>
<span class="line-added"> 478     TARGET := docs-jdk-api-modulegraph, \</span>
<span class="line-added"> 479     DEPS := exploded-image buildtools-modules, \</span>
<span class="line-added"> 480 ))</span>
 481 
<span class="line-modified"> 482 $(eval $(call SetupTarget, docs-javase-api-javadoc, \</span>
<span class="line-modified"> 483     MAKEFILE := Docs, \</span>
<span class="line-added"> 484     TARGET := docs-javase-api-javadoc, \</span>
<span class="line-added"> 485 ))</span>
 486 
<span class="line-modified"> 487 $(eval $(call SetupTarget, docs-javase-api-modulegraph, \</span>
<span class="line-modified"> 488     MAKEFILE := Docs, \</span>
<span class="line-added"> 489     TARGET := docs-javase-api-modulegraph, \</span>
<span class="line-added"> 490     DEPS := exploded-image buildtools-modules, \</span>
<span class="line-added"> 491 ))</span>
 492 
<span class="line-modified"> 493 $(eval $(call SetupTarget, docs-reference-api-javadoc, \</span>
<span class="line-modified"> 494     MAKEFILE := Docs, \</span>
<span class="line-added"> 495     TARGET := docs-reference-api-javadoc, \</span>
<span class="line-added"> 496 ))</span>
 497 
<span class="line-modified"> 498 $(eval $(call SetupTarget, docs-reference-api-modulegraph, \</span>
<span class="line-modified"> 499     MAKEFILE := Docs, \</span>
<span class="line-added"> 500     TARGET := docs-reference-api-modulegraph, \</span>
<span class="line-added"> 501     DEPS := exploded-image buildtools-modules, \</span>
<span class="line-added"> 502 ))</span>
 503 
<span class="line-modified"> 504 # The gensrc steps for jdk.jdi create html spec files.</span>
<span class="line-modified"> 505 $(eval $(call SetupTarget, docs-jdk-specs, \</span>
<span class="line-added"> 506     MAKEFILE := Docs, \</span>
<span class="line-added"> 507     TARGET := docs-jdk-specs, \</span>
<span class="line-added"> 508     DEPS := buildtools-jdk jdk.jdi-gensrc docs-jdk-index, \</span>
<span class="line-added"> 509 ))</span>
 510 
<span class="line-modified"> 511 $(eval $(call SetupTarget, docs-jdk-index, \</span>
<span class="line-modified"> 512     MAKEFILE := Docs, \</span>
<span class="line-added"> 513     TARGET := docs-jdk-index, \</span>
<span class="line-added"> 514 ))</span>
 515 
<span class="line-modified"> 516 $(eval $(call SetupTarget, docs-zip, \</span>
<span class="line-modified"> 517     MAKEFILE := Docs, \</span>
<span class="line-added"> 518     TARGET := docs-zip, \</span>
<span class="line-added"> 519     DEPS :=  docs-jdk, \</span>
<span class="line-added"> 520 ))</span>
 521 
<span class="line-modified"> 522 $(eval $(call SetupTarget, docs-specs-zip, \</span>
<span class="line-modified"> 523     MAKEFILE := Docs, \</span>
<span class="line-added"> 524     TARGET := docs-specs-zip, \</span>
<span class="line-added"> 525     DEPS := docs-jdk-specs, \</span>
<span class="line-added"> 526 ))</span>
 527 
<span class="line-modified"> 528 $(eval $(call SetupTarget, update-build-docs, \</span>
<span class="line-modified"> 529     MAKEFILE := UpdateBuildDocs, \</span>
<span class="line-added"> 530 ))</span>
 531 
<span class="line-modified"> 532 $(eval $(call SetupTarget, update-x11wrappers, \</span>
<span class="line-modified"> 533     MAKEFILE := UpdateX11Wrappers, \</span>
<span class="line-modified"> 534     DEPS := java.base-copy buildtools-jdk, \</span>
<span class="line-modified"> 535 ))</span>
 536 
 537 ################################################################################
 538 # Cross compilation support
 539 
 540 ifeq ($(CREATING_BUILDJDK), true)
 541   # This target is only called by the recursive call below.
 542   create-buildjdk-interim-image-helper: interim-image jdk.jlink-launchers \
 543       java.base-copy jdk.jdeps-launchers
 544 endif
 545 
 546 BUILDJDK_MODULES := $(sort $(foreach m, jdk.jlink $(INTERIM_IMAGE_MODULES), \
 547     $(call FindTransitiveDepsForModule, $m) $m))
 548 
<span class="line-modified"> 549 $(eval $(call SetupTarget, create-buildjdk-interim-image, \</span>
<span class="line-modified"> 550     MAKEFILE := Main, \</span>
<span class="line-modified"> 551     TARGET := create-buildjdk-interim-image-helper, \</span>
<span class="line-modified"> 552     ARGS := SPEC=$(dir $(SPEC))buildjdk-spec.gmk \</span>
<span class="line-modified"> 553         HOTSPOT_SPEC=$(dir $(SPEC))buildjdk-spec.gmk \</span>
<span class="line-modified"> 554         CREATING_BUILDJDK=true \</span>
<span class="line-modified"> 555         LOG_PREFIX=&quot;[buildjdk] &quot; \</span>
<span class="line-modified"> 556         JAVA_MODULES=&quot;$(BUILDJDK_MODULES)&quot;, \</span>
<span class="line-modified"> 557 ))</span>


 558 
 559 ################################################################################
 560 # The interim-image is a small jlinked image that is used to generate artifacts
 561 # at build time for use when linking the real images.
 562 
 563 INTERIM_JMOD_TARGETS := $(addsuffix -interim-jmod, $(INTERIM_IMAGE_MODULES))
 564 
 565 define DeclareInterimJmodRecipe
 566   $1-interim-jmod:
 567 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateJmods.gmk \
 568 	    MODULE=$1 \
 569 	    JMODS_DIR=$(INTERIM_JMODS_DIR) \
 570 	    JMODS_SUPPORT_DIR=$(INTERIM_JMODS_DIR)/support \
 571 	    INTERIM_JMOD=true \
 572 	)
 573 endef
 574 
 575 $(foreach m, $(INTERIM_IMAGE_MODULES), $(eval $(call DeclareInterimJmodRecipe,$m)))
 576 
<span class="line-modified"> 577 $(eval $(call SetupTarget, interim-image, \</span>
<span class="line-modified"> 578     MAKEFILE := InterimImage, \</span>
<span class="line-added"> 579 ))</span>
 580 
 581 ifeq ($(ENABLE_GENERATE_CLASSLIST), true)
<span class="line-modified"> 582   $(eval $(call SetupTarget, generate-link-opt-data, \</span>
<span class="line-modified"> 583       MAKEFILE := GenerateLinkOptData, \</span>
<span class="line-added"> 584   ))</span>
 585 endif
 586 


 587 ################################################################################
 588 # Generate test names for all JTReg test groups
 589 #
 590 
 591 define DeclareRunTestRecipe
 592   test-$1:
 593 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \
 594 	    TEST=&quot;$1&quot;)
 595 
 596   exploded-test-$1:
 597 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \
 598 	    TEST=&quot;$1&quot; JDK_IMAGE_DIR=$(JDK_OUTPUTDIR))
 599 endef
 600 
 601 # ALL_NAMED_TESTS is defined in FindTests.gmk
 602 $(foreach t, $(ALL_NAMED_TESTS), $(eval $(call DeclareRunTestRecipe,$t)))
 603 ALL_TEST_TARGETS := $(addprefix test-, $(ALL_NAMED_TESTS))
 604 
 605 # We only support the &quot;exploded-test-gtest&quot; shortcut
 606 ALL_EXPLODED_TESTS := gtest
 607 ALL_EXPLODED_TEST_TARGETS := $(addprefix exploded-test-, $(ALL_EXPLODED_TESTS))
 608 
 609 ALL_TARGETS += $(ALL_TEST_TARGETS) $(ALL_EXPLODED_TEST_TARGETS)
 610 
 611 ################################################################################
 612 # Build tests and microbenchmarks
 613 #
 614 
<span class="line-modified"> 615 $(eval $(call SetupTarget, prepare-test-image, \</span>
<span class="line-modified"> 616     MAKEFILE := TestImage, \</span>
<span class="line-added"> 617     TARGET := prepare-test-image, \</span>
<span class="line-added"> 618 ))</span>
 619 
<span class="line-modified"> 620 $(eval $(call SetupTarget, build-test-hotspot-jtreg-native, \</span>
<span class="line-modified"> 621     MAKEFILE := test/JtregNativeHotspot, \</span>
<span class="line-modified"> 622     TARGET := build-test-hotspot-jtreg-native, \</span>
<span class="line-added"> 623     DEPS := buildtools-jdk, \</span>
<span class="line-added"> 624 ))</span>
 625 
<span class="line-modified"> 626 $(eval $(call SetupTarget, test-image-hotspot-jtreg-native, \</span>
<span class="line-modified"> 627     MAKEFILE := test/JtregNativeHotspot, \</span>
<span class="line-modified"> 628     TARGET := test-image-hotspot-jtreg-native, \</span>
<span class="line-added"> 629     DEPS := build-test-hotspot-jtreg-native, \</span>
<span class="line-added"> 630 ))</span>
 631 
<span class="line-modified"> 632 $(eval $(call SetupTarget, build-test-jdk-jtreg-native, \</span>
<span class="line-modified"> 633     MAKEFILE := test/JtregNativeJdk, \</span>
<span class="line-modified"> 634     TARGET := build-test-jdk-jtreg-native, \</span>
<span class="line-added"> 635     DEPS := buildtools-jdk java.base-libs, \</span>
<span class="line-added"> 636 ))</span>
 637 
<span class="line-modified"> 638 $(eval $(call SetupTarget, test-image-jdk-jtreg-native, \</span>
<span class="line-modified"> 639     MAKEFILE := test/JtregNativeJdk, \</span>
<span class="line-modified"> 640     TARGET := test-image-jdk-jtreg-native, \</span>
<span class="line-added"> 641     DEPS := build-test-jdk-jtreg-native, \</span>
<span class="line-added"> 642 ))</span>
 643 
<span class="line-modified"> 644 $(eval $(call SetupTarget, build-test-hotspot-jtreg-graal, \</span>
<span class="line-modified"> 645     MAKEFILE := test/JtregGraalUnit, \</span>
<span class="line-modified"> 646     TARGET := build-test-hotspot-jtreg-graal, \</span>
<span class="line-added"> 647     DEPS := exploded-image, \</span>
<span class="line-added"> 648 ))</span>
 649 
<span class="line-modified"> 650 $(eval $(call SetupTarget, test-image-hotspot-jtreg-graal, \</span>
<span class="line-modified"> 651     MAKEFILE := test/JtregGraalUnit, \</span>
<span class="line-modified"> 652     TARGET := test-image-hotspot-jtreg-graal, \</span>
<span class="line-added"> 653     DEPS := build-test-hotspot-jtreg-graal, \</span>
<span class="line-added"> 654 ))</span>
 655 
 656 ifeq ($(BUILD_GTEST), true)
<span class="line-modified"> 657   $(eval $(call SetupTarget, test-image-hotspot-gtest, \</span>
<span class="line-modified"> 658       MAKEFILE := hotspot/test/GtestImage, \</span>
<span class="line-added"> 659       DEPS := hotspot, \</span>
<span class="line-added"> 660   ))</span>
 661 endif
 662 
<span class="line-modified"> 663 $(eval $(call SetupTarget, build-test-lib, \</span>
<span class="line-modified"> 664     MAKEFILE := test/BuildTestLib, \</span>
<span class="line-added"> 665     DEPS := exploded-image, \</span>
<span class="line-added"> 666 ))</span>
 667 
 668 ifeq ($(BUILD_FAILURE_HANDLER), true)
 669   # Builds the failure handler jtreg extension
<span class="line-modified"> 670   $(eval $(call SetupTarget, build-test-failure-handler, \</span>
<span class="line-modified"> 671       MAKEFILE := test/BuildFailureHandler, \</span>
<span class="line-modified"> 672       TARGET := build, \</span>
<span class="line-added"> 673       DEPS := interim-langtools, \</span>
<span class="line-added"> 674   ))</span>
 675 
 676   # Copies the failure handler jtreg extension into the test image
<span class="line-modified"> 677   $(eval $(call SetupTarget, test-image-failure-handler, \</span>
<span class="line-modified"> 678       MAKEFILE := test/BuildFailureHandler, \</span>
<span class="line-modified"> 679       TARGET := images, \</span>
<span class="line-added"> 680       DEPS := build-test-failure-handler, \</span>
<span class="line-added"> 681   ))</span>
 682 endif
 683 
<span class="line-modified"> 684 $(eval $(call SetupTarget, build-microbenchmark, \</span>
<span class="line-modified"> 685     MAKEFILE := test/BuildMicrobenchmark, \</span>
<span class="line-modified"> 686     DEPS := interim-langtools exploded-image, \</span>
<span class="line-modified"> 687 ))</span>





 688 
 689 ################################################################################
 690 # Run tests
 691 
<span class="line-modified"> 692 $(eval $(call SetupTarget, test, \</span>
<span class="line-modified"> 693     MAKEFILE := RunTests, \</span>
<span class="line-modified"> 694     ARGS := TEST=&quot;$(TEST)&quot;, \</span>
<span class="line-modified"> 695     DEPS := jdk-image test-image, \</span>
<span class="line-modified"> 696 ))</span>


 697 
<span class="line-modified"> 698 $(eval $(call SetupTarget, exploded-test, \</span>
<span class="line-modified"> 699     MAKEFILE := RunTests, \</span>
<span class="line-modified"> 700     ARGS := TEST=&quot;$(TEST)&quot; JDK_IMAGE_DIR=$(JDK_OUTPUTDIR), \</span>
<span class="line-added"> 701     DEPS := exploded-image test-image, \</span>
<span class="line-added"> 702 ))</span>
 703 
<span class="line-modified"> 704 ifeq ($(JCOV_ENABLED), true)</span>
<span class="line-added"> 705   $(eval $(call SetupTarget, jcov-test, \</span>
<span class="line-added"> 706       MAKEFILE := RunTests, \</span>
<span class="line-added"> 707       ARGS := TEST=&quot;$(TEST)&quot; TEST_OPTS_JCOV=true, \</span>
<span class="line-added"> 708       DEPS := jcov-image test-image, \</span>
<span class="line-added"> 709   ))</span>
<span class="line-added"> 710 endif</span>
 711 
 712 ################################################################################
 713 # Bundles
 714 
<span class="line-modified"> 715 $(eval $(call SetupTarget, product-bundles, \</span>
<span class="line-modified"> 716     MAKEFILE := Bundles, \</span>
<span class="line-added"> 717     TARGET := product-bundles, \</span>
<span class="line-added"> 718     DEPS := product-images, \</span>
<span class="line-added"> 719 ))</span>
 720 
<span class="line-modified"> 721 $(eval $(call SetupTarget, legacy-bundles, \</span>
<span class="line-modified"> 722     MAKEFILE := Bundles, \</span>
<span class="line-added"> 723     TARGET := legacy-bundles, \</span>
<span class="line-added"> 724     DEPS := legacy-images, \</span>
<span class="line-added"> 725 ))</span>
 726 
<span class="line-modified"> 727 $(eval $(call SetupTarget, test-bundles, \</span>
<span class="line-modified"> 728     MAKEFILE := Bundles, \</span>
<span class="line-added"> 729     TARGET := test-bundles, \</span>
<span class="line-added"> 730     DEPS := test-image, \</span>
<span class="line-added"> 731 ))</span>
 732 
<span class="line-modified"> 733 $(eval $(call SetupTarget, docs-bundles, \</span>
<span class="line-modified"> 734     MAKEFILE := Bundles, \</span>
<span class="line-added"> 735     TARGET := docs-bundles, \</span>
<span class="line-added"> 736     DEPS := docs-image, \</span>
<span class="line-added"> 737 ))</span>
 738 
<span class="line-modified"> 739 $(eval $(call SetupTarget, static-libs-bundles, \</span>
<span class="line-modified"> 740     MAKEFILE := Bundles, \</span>
<span class="line-added"> 741     TARGET := static-libs-bundles, \</span>
<span class="line-added"> 742     DEPS := static-libs-image, \</span>
<span class="line-added"> 743 ))</span>
 744 
 745 ifeq ($(JCOV_ENABLED), true)
<span class="line-modified"> 746   $(eval $(call SetupTarget, jcov-bundles, \</span>
<span class="line-modified"> 747       MAKEFILE := Bundles, \</span>
<span class="line-added"> 748       TARGET := jcov-bundles, \</span>
<span class="line-added"> 749       DEPS := jcov-image, \</span>
<span class="line-added"> 750   ))</span>
 751 endif
 752 



 753 ################################################################################
 754 # Install targets
 755 
<span class="line-modified"> 756 $(eval $(call SetupTarget, install, \</span>
<span class="line-modified"> 757     MAKEFILE := Install, \</span>
<span class="line-modified"> 758     DEPS := product-images, \</span>
<span class="line-modified"> 759 ))</span>
 760 
 761 ################################################################################
 762 #
 763 # Dependency declarations between targets.
 764 #
 765 # These are declared in two groups. First all dependencies between targets that
 766 # have recipes above as these dependencies may be disabled. Then the aggregator
 767 # targets that do not have recipes of their own, which will never have their
 768 # dependencies disabled.
 769 #
 770 ################################################################################
 771 # Targets with recipes above
 772 
 773 # If running an *-only target, parallel execution and dependencies between
 774 # recipe targets are disabled. This makes it possible to run a select set of
 775 # recipe targets in order. It&#39;s the responsibility of the user to make sure
 776 # all prerequisites are fulfilled.
<span class="line-modified"> 777 ifeq ($(DEPS), none)</span>
 778   .NOTPARALLEL:
 779 else
 780   $(LANGTOOLS_GENSRC_TARGETS): buildtools-langtools
 781 
 782   interim-langtools: $(INTERIM_LANGTOOLS_GENSRC_TARGETS)
 783 






 784   $(HOTSPOT_GENSRC_TARGETS): interim-langtools buildtools-hotspot
 785 
 786   $(JDK_GENSRC_TARGETS): interim-langtools buildtools-jdk
 787 
 788   $(GENSRC_MODULEINFO_TARGETS): buildtools-jdk
 789 
 790   $(GENDATA_TARGETS): interim-langtools buildtools-jdk
 791 
 792   $(JAVA_TARGETS): interim-langtools
 793 
 794   # Declare dependencies between hotspot-&lt;variant&gt;* targets
 795   $(foreach v, $(JVM_VARIANTS), \
 796       $(eval hotspot-$v-gensrc: java.base-copy) \
 797       $(eval hotspot-$v-libs: hotspot-$v-gensrc java.base-copy) \
 798   )
 799 




 800   # If not already set, set the JVM variant target so that the JVM will be built.
 801   JVM_MAIN_LIB_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-libs
 802 
 803   # Building one JVM variant is enough to start building the other libs
 804   $(LIBS_TARGETS): $(JVM_MAIN_LIB_TARGETS)
 805 
 806   $(LAUNCHER_TARGETS): java.base-libs
 807 
 808   ifeq ($(STATIC_BUILD), true)
 809     $(LAUNCHER_TARGETS): generate-exported-symbols
 810   endif
 811 






 812   # Declare dependency from &lt;module&gt;-java to &lt;module&gt;-gensrc
 813   $(foreach m, $(GENSRC_MODULES), $(eval $m-java: $m-gensrc))
 814 
 815   # Declare dependencies between java modules
 816   $(foreach m, $(JAVA_MODULES), \
 817       $(eval $m-java: $(addsuffix -java, $(filter $(JAVA_MODULES), \
 818       $(call FindDepsForModule,$m)))))
 819   # Declare dependencies between the module meta targets
 820   $(foreach m, $(ALL_MODULES), $(eval $m: $(call FindDepsForModule,$m)))
 821 
 822   # Declare dependencies from &lt;module&gt;-lib to &lt;module&gt;-java
 823   # Skip modules that do not have java source.
 824   $(foreach m, $(filter $(JAVA_MODULES), $(LIBS_MODULES)), $(eval $m-libs: $m-java))
 825 
 826   # Declare dependencies from all other &lt;module&gt;-lib to java.base-lib
 827   $(foreach t, $(filter-out java.base-libs, $(LIBS_TARGETS)), \
 828       $(eval $t: java.base-libs))
 829 
 830   # jdk.accessibility depends on java.desktop
 831   jdk.accessibility-libs: java.desktop-libs
</pre>
<hr />
<pre>
 879   $(foreach m, $(COPY_MODULES), $(eval $m_JMOD_DEPS += $m-copy))
 880   $(foreach m, $(ALL_MODULES), $(eval $m-jmod: $($(m)_JMOD_DEPS)))
 881   $(foreach m, $(INTERIM_IMAGE_MODULES), $(eval $m-interim-jmod: $($(m)_JMOD_DEPS)))
 882 
 883   # Setup the minimal set of generated native source dependencies for hotspot
 884   $(foreach v, $(JVM_VARIANTS), \
 885     $(eval hotspot-$v-libs-compile-commands: hotspot-$v-gensrc) \
 886     $(foreach m, $(filter java.desktop jdk.hotspot.agent, $(GENSRC_MODULES)), \
 887       $(eval hotspot-$v-libs-compile-commands: $m-gensrc)) \
 888   )
 889 
 890   # For the full JDK compile commands, create all possible generated sources
 891   $(foreach m, $(GENSRC_MODULES), $(eval $m-libs-compile-commands: $m-gensrc))
 892   $(foreach m, $(filter $(JAVA_MODULES), $(LIBS_MODULES)), $(eval $m-libs-compile-commands: $m-java))
 893 
 894   $(COMPILE_COMMANDS_TARGETS_HOTSPOT): clean-compile-commands
 895   $(COMPILE_COMMANDS_TARGETS_JDK): clean-compile-commands
 896   compile-commands-hotspot: $(COMPILE_COMMANDS_TARGETS_HOTSPOT)
 897   compile-commands: $(COMPILE_COMMANDS_TARGETS_HOTSPOT) $(COMPILE_COMMANDS_TARGETS_JDK)
 898 





 899   # The -static-libs targets depend on -java as well as java.base-copy.
 900   $(foreach m, $(filter $(JAVA_MODULES), $(STATIC_LIBS_MODULES)), \
 901     $(eval $m-static-libs: $m-java java.base-copy))
 902 
 903   # Jmods cannot be created until we have the jmod tool ready to run. During
 904   # a normal build we run it from the exploded image, but when cross compiling
 905   # it&#39;s run from the buildjdk, which is either created at build time or user
 906   # supplied.
 907   ifeq ($(CREATE_BUILDJDK), true)
 908     ifneq ($(CREATING_BUILDJDK), true)
 909       # When cross compiling and buildjdk is to be created, simply depend on
 910       # creating the buildjdk.
 911       $(JMOD_TARGETS): create-buildjdk
 912       buildtools-modules: create-buildjdk
 913     else
 914       # While actually creating the buildjdk, we need to list the bare
 915       # minimum dependencies needed before running jmod, to avoid building
 916       # more than necessary. This includes:
 917       # * all java modules
 918       # * jdk.jlink-launchers
 919       # * copy jvm.cfg (done in java.base-copy)
 920       # * tzdb.dat (done in java.base-gendata)
 921       # Without all of these jimage, jlink and jmod won&#39;t start.
 922       $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): java.base-libs java.base-copy \
 923           java.base-gendata jdk.jlink-launchers java
 924     endif
 925   else
 926     # The normal non cross compilation case uses needs to wait for the full
 927     # exploded-image to avoid a race with the optimize target.
 928     $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): exploded-image
 929   endif
 930 
 931   # All modules include the main license files from java.base.
 932   $(JMOD_TARGETS): java.base-copy
 933 
<span class="line-modified"> 934   zip-security: $(filter jdk.crypto%, $(JAVA_TARGETS))</span>







 935 
 936   ifeq ($(ENABLE_GENERATE_CLASSLIST), true)
 937     ifeq ($(CREATE_BUILDJDK), true)
 938       # If creating a buildjdk, the interim image needs to be based on that.
 939       generate-link-opt-data: create-buildjdk
 940     else ifeq ($(EXTERNAL_BUILDJDK), false)
 941       # If an external buildjdk has been provided, we skip generating an
 942       # interim-image and just use the external buildjdk for generating
 943       # classlist.
 944       generate-link-opt-data: interim-image
 945     endif
 946     generate-link-opt-data: buildtools-jdk
 947 
 948     # The generated classlist needs to go into java.base-jmod.
 949     java.base-jmod jdk.jlink-jmod jdk-image legacy-jre-image: generate-link-opt-data
 950   endif
 951 




 952   symbols-image: $(LIBS_TARGETS) $(LAUNCHER_TARGETS)
 953 
 954   static-libs-image: $(STATIC_LIBS_TARGETS)
 955 















 956   bootcycle-images: jdk-image
 957 
 958   docs-jdk-api-javadoc: $(GENSRC_TARGETS)
 959 
 960   docs-javase-api-javadoc: $(GENSRC_TARGETS)
 961 
 962   docs-reference-api-javadoc: $(GENSRC_TARGETS)
 963 






 964   # If not already set, then set the JVM specific docs targets
 965   JVM_DOCS_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-gensrc
 966 
<span class="line-modified"> 967   # The gensrc steps for hotspot create html spec files.</span>
<span class="line-modified"> 968   docs-jdk-specs: $(JVM_DOCS_TARGETS)</span>





 969 
 970   # Tests






 971   test-make: clean-test-make compile-commands
 972 
 973   test-make-compile-commands: compile-commands
 974 
 975   # Declare dependency for all generated test targets
 976   $(foreach t, $(filter-out test-make%, $(ALL_TEST_TARGETS)), $(eval $t: jdk-image test-image))
 977   $(foreach t, $(ALL_EXPLODED_TEST_TARGETS), $(eval $t: exploded-image test-image))
 978 
 979   interim-image: $(INTERIM_JMOD_TARGETS)
 980 
<span class="line-modified"> 981   build-test-hotspot-jtreg-native: hotspot-$(JVM_VARIANT_MAIN)-libs</span>





































 982 
 983 endif
 984 
 985 ################################################################################
 986 # Virtual targets without recipes
 987 
 988 # If not already set, set the JVM specific tools targets
 989 JVM_TOOLS_TARGETS ?= buildtools-hotspot
 990 buildtools: buildtools-langtools interim-langtools \
 991     buildtools-jdk $(JVM_TOOLS_TARGETS)
 992 
 993 # Declare dependencies from hotspot-&lt;variant&gt; targets
 994 $(foreach v, $(JVM_VARIANTS), \
 995   $(eval hotspot-$v: hotspot-$v-gensrc hotspot-$v-libs) \
 996 )
 997 hotspot: $(HOTSPOT_VARIANT_TARGETS)
 998 
 999 # Create targets hotspot-libs and hotspot-gensrc.
1000 $(foreach v, $(JVM_VARIANTS), \
1001   $(eval hotspot-libs: hotspot-$v-libs) \
</pre>
<hr />
<pre>
1092   endif
1093 endif
1094 
1095 ifeq ($(call isTargetOs, macosx), true)
1096   product-images: mac-jdk-bundle
1097 
1098   legacy-images: mac-legacy-jre-bundle
1099 endif
1100 
1101 # This target builds the documentation image
1102 docs-image: docs-jdk
1103 
1104 # If not already set, set the JVM specific targets to build the test image
1105 JVM_TEST_IMAGE_TARGETS ?= test-image-hotspot-jtreg-native test-image-hotspot-gtest
1106 
1107 ifeq ($(INCLUDE_GRAAL), true)
1108   JVM_TEST_IMAGE_TARGETS += test-image-hotspot-jtreg-graal
1109 endif
1110 
1111 # This target builds the test image
<span class="line-modified">1112 test-image: prepare-test-image test-image-jdk-jtreg-native \</span>

1113     test-image-demos-jdk $(JVM_TEST_IMAGE_TARGETS)
1114 
<span class="line-added">1115 ifeq ($(BUILD_FAILURE_HANDLER), true)</span>
<span class="line-added">1116   test-image: test-image-failure-handler</span>
<span class="line-added">1117 endif</span>
<span class="line-added">1118 </span>
1119 ifneq ($(JMH_CORE_JAR), )
1120   test-image: build-microbenchmark
1121 endif
1122 
1123 ################################################################################
1124 
1125 # all-images builds all our deliverables as images.
1126 all-images: product-images test-image docs-image
1127 
1128 # all-bundles packages all our deliverables as tar.gz bundles.
1129 all-bundles: product-bundles test-bundles docs-bundles static-libs-bundles
1130 
1131 ALL_TARGETS += buildtools hotspot hotspot-libs hotspot-gensrc gensrc gendata \
1132     copy java libs static-libs launchers jmods \
1133     jdk.jdwp.agent-gensrc $(ALL_MODULES) demos \
1134     exploded-image-base exploded-image \
1135     create-buildjdk docs-jdk-api docs-javase-api docs-reference-api docs-jdk \
1136     docs-javase docs-reference docs-javadoc mac-bundles product-images legacy-images \
1137     docs-image test-image all-images \
1138     all-bundles
</pre>
</td>
</tr>
</table>
<center><a href="Images.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="MainSupport.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>