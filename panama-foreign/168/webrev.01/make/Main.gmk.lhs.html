<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames make/Main.gmk</title>
    <link rel="stylesheet" href="../style.css" />
    <script type="text/javascript" src="../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 #
   2 # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.
   3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4 #
   5 # This code is free software; you can redistribute it and/or modify it
   6 # under the terms of the GNU General Public License version 2 only, as
   7 # published by the Free Software Foundation.  Oracle designates this
   8 # particular file as subject to the &quot;Classpath&quot; exception as provided
   9 # by Oracle in the LICENSE file that accompanied this code.
  10 #
  11 # This code is distributed in the hope that it will be useful, but WITHOUT
  12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14 # version 2 for more details (a copy is included in the LICENSE file that
  15 # accompanied this code).
  16 #
  17 # You should have received a copy of the GNU General Public License version
  18 # 2 along with this work; if not, write to the Free Software Foundation,
  19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20 #
  21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22 # or visit www.oracle.com if you need additional information or have any
  23 # questions.
  24 #
  25 
  26 ################################################################################
  27 # This is the main makefile containing most actual top level targets. It needs
  28 # to be called with a SPEC file defined.
  29 ################################################################################
  30 
  31 # Declare default target
  32 default:
  33 
  34 ifeq ($(wildcard $(SPEC)),)
  35   $(error Main.gmk needs SPEC set to a proper spec.gmk)
  36 endif
  37 
  38 # Now load the spec
  39 include $(SPEC)
  40 
<a name="1" id="anc1"></a><span class="line-removed">  41 include $(TOPDIR)/make/MainSupport.gmk</span>
<span class="line-removed">  42 </span>
  43 # Load the vital tools for all the makefiles.
  44 include $(TOPDIR)/make/common/MakeBase.gmk
  45 include $(TOPDIR)/make/common/Modules.gmk
  46 include $(TOPDIR)/make/common/FindTests.gmk
  47 
<a name="2" id="anc2"></a>






  48 # Declare ALL_TARGETS as an immediate variable. This variable is a list of all
  49 # valid top level targets. It&#39;s used to declare them all as PHONY and to
  50 # generate the -only targets.
  51 ALL_TARGETS :=
  52 
  53 # Hook to include the corresponding custom file, if present.
  54 $(eval $(call IncludeCustomExtension, Main.gmk))
  55 
  56 # All modules for the current target platform.
  57 ALL_MODULES := $(call FindAllModules)
  58 
  59 ################################################################################
  60 ################################################################################
  61 #
  62 # Recipes for all targets. Only recipes, dependencies are declared later.
  63 #
  64 ################################################################################
  65 
  66 ################################################################################
  67 # Interim/build tools targets, compiling tools used during the build
  68 
<a name="3" id="anc3"></a><span class="line-modified">  69 buildtools-langtools:</span>
<span class="line-modified">  70 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ToolsLangtools.gmk)</span>
<span class="line-modified">  71 </span>
<span class="line-removed">  72 interim-langtools:</span>
<span class="line-removed">  73 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileInterimLangtools.gmk)</span>
<span class="line-removed">  74 </span>
<span class="line-removed">  75 interim-tzdb:</span>
<span class="line-removed">  76 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CopyInterimTZDB.gmk)</span>
  77 
<a name="4" id="anc4"></a>


  78 
<a name="5" id="anc5"></a><span class="line-modified">  79 buildtools-jdk:</span>
<span class="line-modified">  80 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileToolsJdk.gmk)</span>

  81 
<a name="6" id="anc6"></a><span class="line-modified">  82 buildtools-modules:</span>
<span class="line-modified">  83 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileModuleTools.gmk)</span>


  84 
<a name="7" id="anc7"></a><span class="line-modified">  85 buildtools-hotspot:</span>
<span class="line-modified">  86 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileToolsHotspot.gmk)</span>


  87 
<a name="8" id="anc8"></a><span class="line-modified">  88 ALL_TARGETS += buildtools-langtools interim-langtools \</span>
<span class="line-modified">  89     interim-tzdb buildtools-jdk buildtools-modules \</span>
<span class="line-modified">  90     buildtools-hotspot</span>

  91 
  92 ################################################################################
  93 # Special targets for certain modules
  94 
<a name="9" id="anc9"></a><span class="line-modified">  95 generate-exported-symbols:</span>
<span class="line-modified">  96 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f BuildStatic.gmk)</span>
<span class="line-modified">  97 </span>
<span class="line-modified">  98 ALL_TARGETS += generate-exported-symbols</span>
  99 
 100 ################################################################################
 101 # Gensrc targets, generating source before java compilation can be done
 102 #
 103 $(eval $(call DeclareRecipesForPhase, GENSRC, \
 104     TARGET_SUFFIX := gensrc-src, \
 105     FILE_PREFIX := Gensrc, \
 106     MAKE_SUBDIR := gensrc, \
 107     CHECK_MODULES := $(ALL_MODULES), \
 108 ))
 109 
 110 $(foreach m, $(GENSRC_MODULES), $(eval $m-gensrc: $m-gensrc-src))
 111 
 112 LANGTOOLS_GENSRC_TARGETS := $(filter $(addsuffix -%, $(LANGTOOLS_MODULES)), $(GENSRC_TARGETS))
 113 INTERIM_LANGTOOLS_GENSRC_TARGETS := $(filter $(addsuffix -%, \
 114     $(INTERIM_LANGTOOLS_BASE_MODULES)), $(GENSRC_TARGETS))
 115 HOTSPOT_GENSRC_TARGETS := $(filter $(addsuffix -%, $(HOTSPOT_MODULES)), $(GENSRC_TARGETS))
 116 JDK_GENSRC_TARGETS := $(filter-out $(LANGTOOLS_GENSRC_TARGETS) \
 117     $(HOTSPOT_GENSRC_TARGETS), $(GENSRC_TARGETS))
 118 
 119 GENSRC_MODULEINFO_MODULES := $(ALL_MODULES)
 120 GENSRC_MODULEINFO_TARGETS := $(addsuffix -gensrc-moduleinfo, \
 121     $(GENSRC_MODULEINFO_MODULES))
 122 
 123 GENSRC_MODULES := $(GENSRC_MODULEINFO_MODULES)
 124 GENSRC_TARGETS += $(sort $(GENSRC_MODULEINFO_TARGETS) \
 125     $(addsuffix -gensrc, $(GENSRC_MODULES)))
 126 
 127 define DeclareModuleInfoRecipe
 128   $1-gensrc-moduleinfo:
 129 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) \
 130 	    -f common/modules/GensrcModuleInfo.gmk MODULE=$1)
 131 
 132   $1-gensrc: $1-gensrc-moduleinfo
 133 endef
 134 
 135 $(foreach m, $(GENSRC_MODULEINFO_MODULES), $(eval $(call DeclareModuleInfoRecipe,$m)))
 136 
 137 ALL_TARGETS += $(GENSRC_TARGETS)
 138 
 139 ################################################################################
 140 # Generate data targets
 141 $(eval $(call DeclareRecipesForPhase, GENDATA, \
 142     TARGET_SUFFIX := gendata, \
 143     FILE_PREFIX := Gendata, \
 144     MAKE_SUBDIR := gendata, \
 145     CHECK_MODULES := $(ALL_MODULES), \
 146     USE_WRAPPER := true))
 147 
 148 ALL_TARGETS += $(GENDATA_TARGETS)
 149 
 150 ################################################################################
 151 # Copy files targets
 152 $(eval $(call DeclareRecipesForPhase, COPY, \
 153     TARGET_SUFFIX := copy, \
 154     FILE_PREFIX := Copy, \
 155     MAKE_SUBDIR := copy, \
 156     CHECK_MODULES := $(ALL_MODULES), \
 157     USE_WRAPPER := true, \
 158 ))
 159 
 160 ALL_COPY_MODULES += $(COPY_MODULES)
 161 ALL_COPY_TARGETS += $(COPY_TARGETS)
 162 
 163 IMPORT_COPY_MODULES := $(call FindImportedModules)
 164 IMPORT_COPY_TARGETS := $(addsuffix -copy, $(IMPORT_COPY_MODULES))
 165 ALL_COPY_MODULES += $(IMPORT_COPY_MODULES)
 166 ALL_COPY_TARGETS += $(IMPORT_COPY_TARGETS)
 167 
 168 define DeclareImportCopyRecipe
 169   $1-copy:
 170 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) \
 171 	    -f CopyImportModules.gmk MODULE=$1)
 172 endef
 173 
 174 $(foreach m, $(IMPORT_COPY_MODULES), $(eval $(call DeclareImportCopyRecipe,$m)))
 175 
 176 ALL_TARGETS += $(ALL_COPY_TARGETS)
 177 
 178 ################################################################################
 179 # Targets for compiling all java modules.
 180 JAVA_MODULES := $(ALL_MODULES)
 181 JAVA_TARGETS := $(addsuffix -java, $(JAVA_MODULES))
 182 
 183 define DeclareCompileJavaRecipe
 184   $1-java:
 185 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) \
 186 	    -f CompileJavaModules.gmk MODULE=$1)
 187 endef
 188 
 189 $(foreach m, $(JAVA_MODULES), $(eval $(call DeclareCompileJavaRecipe,$m)))
 190 
 191 ALL_TARGETS += $(JAVA_TARGETS)
 192 
 193 ################################################################################
 194 # Targets for compiling native libraries
 195 $(eval $(call DeclareRecipesForPhase, LIBS, \
 196     TARGET_SUFFIX := libs, \
 197     FILE_PREFIX := Lib, \
 198     MAKE_SUBDIR := lib, \
 199     CHECK_MODULES := $(ALL_MODULES), \
 200     USE_WRAPPER := true))
 201 
 202 ALL_TARGETS += $(LIBS_TARGETS)
 203 
 204 ################################################################################
 205 # Targets for compiling static versions of certain native libraries. These do
 206 # not end up in the jmods or the normal JDK image, but are instead bundled into
 207 # a special deliverable.
 208 $(eval $(call DeclareRecipesForPhase, STATIC_LIBS, \
 209     TARGET_SUFFIX := static-libs, \
 210     FILE_PREFIX := Lib, \
 211     MAKE_SUBDIR := lib, \
 212     CHECK_MODULES := $(STATIC_LIBS_MODULES), \
 213     USE_WRAPPER := true, \
 214     EXTRA_ARGS := STATIC_LIBS=true, \
 215 ))
 216 
 217 ALL_TARGETS += $(STATIC_LIBS_TARGETS)
 218 
 219 ################################################################################
 220 # Targets for compiling native executables
 221 $(eval $(call DeclareRecipesForPhase, LAUNCHER, \
 222     TARGET_SUFFIX := launchers, \
 223     FILE_PREFIX := Launcher, \
 224     MAKE_SUBDIR := launcher, \
 225     CHECK_MODULES := $(ALL_MODULES), \
 226     USE_WRAPPER := true))
 227 
 228 ALL_TARGETS += $(LAUNCHER_TARGETS)
 229 
 230 ################################################################################
 231 # Build hotspot target
 232 
 233 HOTSPOT_VARIANT_TARGETS := $(addprefix hotspot-, $(JVM_VARIANTS))
 234 HOTSPOT_VARIANT_GENSRC_TARGETS := $(addsuffix -gensrc, $(HOTSPOT_VARIANT_TARGETS))
 235 HOTSPOT_VARIANT_LIBS_TARGETS := $(addsuffix -libs, $(HOTSPOT_VARIANT_TARGETS))
 236 
 237 define DeclareHotspotGensrcRecipe
 238   hotspot-$1-gensrc:
 239 	$$(call LogInfo, Building JVM variant &#39;$1&#39; with features &#39;$(JVM_FEATURES_$1)&#39;)
 240 	+($(CD) $(TOPDIR)/make/hotspot &amp;&amp; $(MAKE) $(MAKE_ARGS) -f gensrc/GenerateSources.gmk \
 241 	    JVM_VARIANT=$1)
 242 endef
 243 
 244 $(foreach v, $(JVM_VARIANTS), $(eval $(call DeclareHotspotGensrcRecipe,$v)))
 245 
 246 define DeclareHotspotLibsRecipe
 247   hotspot-$1-libs:
 248 	+($(CD) $(TOPDIR)/make/hotspot &amp;&amp; $(MAKE) $(MAKE_ARGS) -f lib/CompileLibraries.gmk \
 249 	    JVM_VARIANT=$1)
 250 endef
 251 
 252 $(foreach v, $(JVM_VARIANTS), $(eval $(call DeclareHotspotLibsRecipe,$v)))
 253 
<a name="10" id="anc10"></a><span class="line-modified"> 254 hotspot-ide-project:</span>
<span class="line-modified"> 255 	+($(CD) $(TOPDIR)/make/hotspot &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ide/CreateVSProject.gmk)</span>


 256 
 257 ALL_TARGETS += $(HOTSPOT_VARIANT_TARGETS) $(HOTSPOT_VARIANT_GENSRC_TARGETS) \
<a name="11" id="anc11"></a><span class="line-modified"> 258     $(HOTSPOT_VARIANT_LIBS_TARGETS) hotspot-ide-project</span>
 259 
 260 ################################################################################
 261 # Generate libs and launcher targets for creating compile_commands.json fragments
 262 define DeclareCompileCommandsRecipe
 263   $1-compile-commands:
 264 	$$(call LogInfo, Generating compile_commands.json fragments for $1)
 265 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Main.gmk $1-only \
 266 	    GENERATE_COMPILE_COMMANDS_ONLY=true)
 267 
 268   COMPILE_COMMANDS_TARGETS_$2 += $1-compile-commands
 269 endef
 270 
 271 $(foreach t, $(HOTSPOT_VARIANT_LIBS_TARGETS), \
 272   $(eval $(call DeclareCompileCommandsRecipe,$t,HOTSPOT)) \
 273 )
 274 
 275 $(foreach t, $(LIBS_TARGETS) $(LAUNCHER_TARGETS), \
 276   $(eval $(call DeclareCompileCommandsRecipe,$t,JDK)) \
 277 )
 278 
<a name="12" id="anc12"></a><span class="line-modified"> 279 compile-commands compile-commands-hotspot:</span>
<span class="line-modified"> 280 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileCommands.gmk)</span>





 281 
 282 ALL_TARGETS += $(COMPILE_COMMANDS_TARGETS_HOTSPOT) $(COMPILE_COMMANDS_TARGETS_JDK)
<a name="13" id="anc13"></a><span class="line-removed"> 283 ALL_TARGETS += compile-commands compile-commands-hotspot</span>
 284 
 285 ################################################################################
 286 # VS Code projects
<a name="14" id="anc14"></a><span class="line-removed"> 287 vscode-project:</span>
<span class="line-removed"> 288 	+($(CD) $(TOPDIR)/make/vscode &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateVSCodeProject.gmk \</span>
<span class="line-removed"> 289       VSCODE_INDEXER=cpptools)</span>
 290 
<a name="15" id="anc15"></a><span class="line-modified"> 291 vscode-project-clangd:</span>
<span class="line-modified"> 292 	+($(CD) $(TOPDIR)/make/vscode &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateVSCodeProject.gmk \</span>
<span class="line-modified"> 293       VSCODE_INDEXER=clangd)</span>


 294 
<a name="16" id="anc16"></a><span class="line-modified"> 295 vscode-project-rtags:</span>
<span class="line-modified"> 296 	+($(CD) $(TOPDIR)/make/vscode &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateVSCodeProject.gmk \</span>
<span class="line-modified"> 297       VSCODE_INDEXER=rtags)</span>


 298 
<a name="17" id="anc17"></a><span class="line-modified"> 299 vscode-project-ccls:</span>
<span class="line-modified"> 300 	+($(CD) $(TOPDIR)/make/vscode &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateVSCodeProject.gmk \</span>
<span class="line-modified"> 301       VSCODE_INDEXER=ccls)</span>


 302 
<a name="18" id="anc18"></a><span class="line-modified"> 303 ALL_TARGETS += vscode-project vscode-project-clangd vscode-project-rtags \</span>
<span class="line-modified"> 304   vscode-project-ccls</span>



 305 
 306 ################################################################################
 307 # Build demos targets
 308 
<a name="19" id="anc19"></a><span class="line-modified"> 309 demos-jdk:</span>
<span class="line-modified"> 310 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileDemos.gmk)</span>
<span class="line-modified"> 311 </span>
<span class="line-modified"> 312 test-image-demos-jdk:</span>
<span class="line-modified"> 313 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileDemos.gmk images)</span>


 314 
<a name="20" id="anc20"></a><span class="line-modified"> 315 ALL_TARGETS += demos-jdk test-image-demos-jdk</span>




 316 
 317 ################################################################################
 318 # Jigsaw specific data and analysis targets.
 319 
<a name="21" id="anc21"></a><span class="line-modified"> 320 generate-summary:</span>
<span class="line-modified"> 321 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GenerateModuleSummary.gmk)</span>
<span class="line-modified"> 322 </span>
<span class="line-modified"> 323 ALL_TARGETS += generate-summary</span>
 324 
 325 ################################################################################
 326 # Jmod targets
 327 
 328 JMOD_MODULES := $(ALL_MODULES)
 329 JMOD_TARGETS := $(addsuffix -jmod, $(JMOD_MODULES))
 330 
 331 define DeclareJmodRecipe
 332   $1-jmod:
 333 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateJmods.gmk \
 334 	    MODULE=$1)
 335 endef
 336 
 337 $(foreach m, $(JMOD_MODULES), $(eval $(call DeclareJmodRecipe,$m)))
 338 
 339 ALL_TARGETS += $(JMOD_TARGETS)
 340 
 341 ################################################################################
 342 # Images targets
 343 
<a name="22" id="anc22"></a><span class="line-modified"> 344 store-source-revision:</span>
<span class="line-modified"> 345 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f SourceRevision.gmk store-source-revision)</span>


 346 
<a name="23" id="anc23"></a><span class="line-modified"> 347 create-source-revision-tracker:</span>
<span class="line-modified"> 348 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f SourceRevision.gmk create-source-revision-tracker)</span>


 349 
 350 BOOTCYCLE_TARGET := product-images
 351 bootcycle-images:
 352         ifneq ($(COMPILE_TYPE), cross)
 353 	  $(call LogWarn, Boot cycle build step 2: Building a new JDK image using previously built image)
 354 	  $(call MakeDir, $(OUTPUTDIR)/bootcycle-build)
 355 	  +$(MAKE) $(MAKE_ARGS) -f $(TOPDIR)/make/Init.gmk PARALLEL_TARGETS=$(BOOTCYCLE_TARGET) \
 356 	      LOG_PREFIX=&quot;[bootcycle] &quot; JOBS= SPEC=$(dir $(SPEC))bootcycle-spec.gmk main
 357         else
 358 	  $(call LogWarn, Boot cycle build disabled when cross compiling)
 359         endif
 360 
<a name="24" id="anc24"></a><span class="line-modified"> 361 zip-security:</span>
<span class="line-modified"> 362 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ZipSecurity.gmk)</span>


 363 
<a name="25" id="anc25"></a><span class="line-modified"> 364 zip-source:</span>
<span class="line-modified"> 365 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ZipSource.gmk)</span>


 366 
<a name="26" id="anc26"></a><span class="line-modified"> 367 jrtfs-jar:</span>
<span class="line-modified"> 368 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JrtfsJar.gmk)</span>


 369 
<a name="27" id="anc27"></a><span class="line-modified"> 370 jdk-image:</span>
<span class="line-modified"> 371 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk jdk)</span>



 372 
<a name="28" id="anc28"></a><span class="line-modified"> 373 legacy-jre-image:</span>
<span class="line-modified"> 374 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk jre)</span>



 375 
<a name="29" id="anc29"></a><span class="line-modified"> 376 symbols-image:</span>
<span class="line-modified"> 377 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk symbols)</span>


 378 
<a name="30" id="anc30"></a><span class="line-modified"> 379 static-libs-image:</span>
<span class="line-modified"> 380 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f StaticLibsImage.gmk)</span>

 381 
<a name="31" id="anc31"></a><span class="line-modified"> 382 mac-jdk-bundle:</span>
<span class="line-modified"> 383 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f MacBundles.gmk jdk-bundle)</span>



 384 
<a name="32" id="anc32"></a><span class="line-modified"> 385 mac-legacy-jre-bundle:</span>
<span class="line-modified"> 386 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f MacBundles.gmk jre-bundle)</span>



 387 
<a name="33" id="anc33"></a><span class="line-modified"> 388 release-file:</span>
<span class="line-modified"> 389 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ReleaseFile.gmk)</span>


 390 
<a name="34" id="anc34"></a><span class="line-modified"> 391 exploded-image-optimize:</span>
<span class="line-modified"> 392 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ExplodedImageOptimize.gmk)</span>



 393 
<a name="35" id="anc35"></a><span class="line-modified"> 394 graal-builder-image:</span>
<span class="line-modified"> 395 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GraalBuilderImage.gmk)</span>


 396 
 397 ifeq ($(JCOV_ENABLED), true)
<a name="36" id="anc36"></a><span class="line-modified"> 398   jcov-image:</span>
<span class="line-modified"> 399 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Coverage.gmk jcov-image)</span>



 400 endif
 401 
<a name="37" id="anc37"></a><span class="line-modified"> 402 ALL_TARGETS += store-source-revision create-source-revision-tracker bootcycle-images zip-security \</span>
<span class="line-removed"> 403     zip-source jrtfs-jar jdk-image legacy-jre-image \</span>
<span class="line-removed"> 404     symbols-image static-libs-image mac-jdk-bundle mac-legacy-jre-bundle \</span>
<span class="line-removed"> 405     release-file exploded-image-optimize graal-builder-image jcov-image</span>
 406 
 407 ################################################################################
 408 # Docs targets
 409 
 410 # If building full docs, to complete docs-*-api we need both the javadoc and
 411 # modulegraph targets.
<a name="38" id="anc38"></a><span class="line-modified"> 412 docs-jdk-api-javadoc:</span>
<span class="line-modified"> 413 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-api-javadoc)</span>
<span class="line-modified"> 414 </span>
<span class="line-modified"> 415 docs-jdk-api-modulegraph:</span>
<span class="line-removed"> 416 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-api-modulegraph)</span>
 417 
<a name="39" id="anc39"></a><span class="line-modified"> 418 docs-javase-api-javadoc:</span>
<span class="line-modified"> 419 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-javase-api-javadoc)</span>



 420 
<a name="40" id="anc40"></a><span class="line-modified"> 421 docs-javase-api-modulegraph:</span>
<span class="line-modified"> 422 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-javase-api-modulegraph)</span>


 423 
<a name="41" id="anc41"></a><span class="line-modified"> 424 docs-reference-api-javadoc:</span>
<span class="line-modified"> 425 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-reference-api-javadoc)</span>



 426 
<a name="42" id="anc42"></a><span class="line-modified"> 427 docs-reference-api-modulegraph:</span>
<span class="line-modified"> 428 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-reference-api-modulegraph)</span>


 429 
<a name="43" id="anc43"></a><span class="line-modified"> 430 docs-jdk-specs:</span>
<span class="line-modified"> 431 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-specs)</span>



 432 
<a name="44" id="anc44"></a><span class="line-modified"> 433 docs-jdk-index:</span>
<span class="line-modified"> 434 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-index)</span>




 435 
<a name="45" id="anc45"></a><span class="line-modified"> 436 docs-zip:</span>
<span class="line-modified"> 437 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-zip)</span>


 438 
<a name="46" id="anc46"></a><span class="line-modified"> 439 docs-specs-zip:</span>
<span class="line-modified"> 440 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-specs-zip)</span>



 441 
<a name="47" id="anc47"></a><span class="line-modified"> 442 update-build-docs:</span>
<span class="line-modified"> 443 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f UpdateBuildDocs.gmk)</span>



 444 
<a name="48" id="anc48"></a><span class="line-modified"> 445 update-x11wrappers:</span>
<span class="line-modified"> 446 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f UpdateX11Wrappers.gmk)</span>

 447 
<a name="49" id="anc49"></a><span class="line-modified"> 448 ALL_TARGETS += docs-jdk-api-javadoc docs-jdk-api-modulegraph \</span>
<span class="line-modified"> 449     docs-javase-api-javadoc docs-javase-api-modulegraph \</span>
<span class="line-modified"> 450     docs-reference-api-javadoc docs-reference-api-modulegraph docs-jdk-specs \</span>
<span class="line-modified"> 451     docs-jdk-index docs-zip docs-specs-zip update-build-docs update-x11wrappers</span>
 452 
 453 ################################################################################
 454 # Cross compilation support
 455 
 456 ifeq ($(CREATING_BUILDJDK), true)
 457   # This target is only called by the recursive call below.
 458   create-buildjdk-interim-image-helper: interim-image jdk.jlink-launchers \
 459       java.base-copy jdk.jdeps-launchers
 460 endif
 461 
 462 BUILDJDK_MODULES := $(sort $(foreach m, jdk.jlink $(INTERIM_IMAGE_MODULES), \
 463     $(call FindTransitiveDepsForModule, $m) $m))
 464 
<a name="50" id="anc50"></a><span class="line-modified"> 465 create-buildjdk-interim-image:</span>
<span class="line-modified"> 466 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Main.gmk \</span>
<span class="line-modified"> 467 	    $@-helper \</span>
<span class="line-modified"> 468 	    SPEC=$(dir $(SPEC))buildjdk-spec.gmk \</span>
<span class="line-modified"> 469 	    HOTSPOT_SPEC=$(dir $(SPEC))buildjdk-spec.gmk \</span>
<span class="line-modified"> 470 	    CREATING_BUILDJDK=true \</span>
<span class="line-modified"> 471 	    LOG_PREFIX=&quot;[buildjdk] &quot; \</span>
<span class="line-modified"> 472 	    JAVA_MODULES=&quot;$(BUILDJDK_MODULES)&quot; \</span>
<span class="line-modified"> 473 	)</span>
<span class="line-removed"> 474 </span>
<span class="line-removed"> 475 ALL_TARGETS += create-buildjdk-copy create-buildjdk-interim-image</span>
 476 
 477 ################################################################################
 478 # The interim-image is a small jlinked image that is used to generate artifacts
 479 # at build time for use when linking the real images.
 480 
 481 INTERIM_JMOD_TARGETS := $(addsuffix -interim-jmod, $(INTERIM_IMAGE_MODULES))
 482 
 483 define DeclareInterimJmodRecipe
 484   $1-interim-jmod:
 485 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateJmods.gmk \
 486 	    MODULE=$1 \
 487 	    JMODS_DIR=$(INTERIM_JMODS_DIR) \
 488 	    JMODS_SUPPORT_DIR=$(INTERIM_JMODS_DIR)/support \
 489 	    INTERIM_JMOD=true \
 490 	)
 491 endef
 492 
 493 $(foreach m, $(INTERIM_IMAGE_MODULES), $(eval $(call DeclareInterimJmodRecipe,$m)))
 494 
<a name="51" id="anc51"></a><span class="line-modified"> 495 interim-image:</span>
<span class="line-modified"> 496 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f InterimImage.gmk)</span>

 497 
 498 ifeq ($(ENABLE_GENERATE_CLASSLIST), true)
<a name="52" id="anc52"></a><span class="line-modified"> 499   generate-link-opt-data:</span>
<span class="line-modified"> 500 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GenerateLinkOptData.gmk)</span>

 501 endif
 502 
<a name="53" id="anc53"></a><span class="line-removed"> 503 ALL_TARGETS += $(INTERIM_JMOD_TARGETS) interim-image generate-link-opt-data</span>
<span class="line-removed"> 504 </span>
 505 ################################################################################
 506 # Generate test names for all JTReg test groups
 507 #
 508 
 509 define DeclareRunTestRecipe
 510   test-$1:
 511 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \
 512 	    TEST=&quot;$1&quot;)
 513 
 514   exploded-test-$1:
 515 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \
 516 	    TEST=&quot;$1&quot; JDK_IMAGE_DIR=$(JDK_OUTPUTDIR))
 517 endef
 518 
 519 # ALL_NAMED_TESTS is defined in FindTests.gmk
 520 $(foreach t, $(ALL_NAMED_TESTS), $(eval $(call DeclareRunTestRecipe,$t)))
 521 ALL_TEST_TARGETS := $(addprefix test-, $(ALL_NAMED_TESTS))
 522 
 523 # We only support the &quot;exploded-test-gtest&quot; shortcut
 524 ALL_EXPLODED_TESTS := gtest
 525 ALL_EXPLODED_TEST_TARGETS := $(addprefix exploded-test-, $(ALL_EXPLODED_TESTS))
 526 
 527 ALL_TARGETS += $(ALL_TEST_TARGETS) $(ALL_EXPLODED_TEST_TARGETS)
 528 
 529 ################################################################################
 530 # Build tests and microbenchmarks
 531 #
 532 
<a name="54" id="anc54"></a><span class="line-modified"> 533 prepare-test-image:</span>
<span class="line-modified"> 534 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f TestImage.gmk prepare-test-image)</span>


 535 
<a name="55" id="anc55"></a><span class="line-modified"> 536 build-test-hotspot-jtreg-native:</span>
<span class="line-modified"> 537 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregNativeHotspot.gmk \</span>
<span class="line-modified"> 538 	    build-test-hotspot-jtreg-native)</span>


 539 
<a name="56" id="anc56"></a><span class="line-modified"> 540 test-image-hotspot-jtreg-native:</span>
<span class="line-modified"> 541 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregNativeHotspot.gmk \</span>
<span class="line-modified"> 542 	    test-image-hotspot-jtreg-native)</span>


 543 
<a name="57" id="anc57"></a><span class="line-modified"> 544 build-test-jdk-jtreg-native:</span>
<span class="line-modified"> 545 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregNativeJdk.gmk \</span>
<span class="line-modified"> 546 	    build-test-jdk-jtreg-native)</span>


 547 
<a name="58" id="anc58"></a><span class="line-modified"> 548 test-image-jdk-jtreg-native:</span>
<span class="line-modified"> 549 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregNativeJdk.gmk \</span>
<span class="line-modified"> 550 	    test-image-jdk-jtreg-native)</span>


 551 
<a name="59" id="anc59"></a><span class="line-modified"> 552 build-test-hotspot-jtreg-graal:</span>
<span class="line-modified"> 553 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregGraalUnit.gmk \</span>
<span class="line-modified"> 554 	     build-test-hotspot-jtreg-graal)</span>


 555 
<a name="60" id="anc60"></a><span class="line-modified"> 556 test-image-hotspot-jtreg-graal:</span>
<span class="line-modified"> 557 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregGraalUnit.gmk \</span>
<span class="line-modified"> 558 	     test-image-hotspot-jtreg-graal)</span>


 559 
 560 ifeq ($(BUILD_GTEST), true)
<a name="61" id="anc61"></a><span class="line-modified"> 561   test-image-hotspot-gtest:</span>
<span class="line-modified"> 562 	+($(CD) $(TOPDIR)/make/hotspot/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GtestImage.gmk)</span>


 563 endif
 564 
<a name="62" id="anc62"></a><span class="line-modified"> 565 build-test-lib:</span>
<span class="line-modified"> 566 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f BuildTestLib.gmk)</span>


 567 
 568 ifeq ($(BUILD_FAILURE_HANDLER), true)
 569   # Builds the failure handler jtreg extension
<a name="63" id="anc63"></a><span class="line-modified"> 570   build-test-failure-handler:</span>
<span class="line-modified"> 571 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) \</span>
<span class="line-modified"> 572 	    -f BuildFailureHandler.gmk build)</span>


 573 
 574   # Copies the failure handler jtreg extension into the test image
<a name="64" id="anc64"></a><span class="line-modified"> 575   test-image-failure-handler:</span>
<span class="line-modified"> 576 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) \</span>
<span class="line-modified"> 577 	     -f BuildFailureHandler.gmk images)</span>


 578 endif
 579 
<a name="65" id="anc65"></a><span class="line-modified"> 580 build-microbenchmark:</span>
<span class="line-modified"> 581 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f test/BuildMicrobenchmark.gmk)</span>
<span class="line-modified"> 582 </span>
<span class="line-modified"> 583 ALL_TARGETS += prepare-test-image build-test-hotspot-jtreg-native \</span>
<span class="line-removed"> 584     test-image-hotspot-jtreg-native build-test-jdk-jtreg-native \</span>
<span class="line-removed"> 585     test-image-jdk-jtreg-native build-test-lib build-test-failure-handler \</span>
<span class="line-removed"> 586     test-failure-handler test-image-failure-handler test-image-hotspot-gtest \</span>
<span class="line-removed"> 587     test-image-hotspot-jtreg-graal build-test-hotspot-jtreg-graal \</span>
<span class="line-removed"> 588     build-microbenchmark</span>
 589 
 590 ################################################################################
 591 # Run tests
 592 
<a name="66" id="anc66"></a><span class="line-modified"> 593 test:</span>
<span class="line-modified"> 594 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \</span>
<span class="line-modified"> 595 	    TEST=&quot;$(TEST)&quot;)</span>
<span class="line-modified"> 596 </span>
<span class="line-modified"> 597 exploded-test:</span>
<span class="line-removed"> 598 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \</span>
<span class="line-removed"> 599 	    TEST=&quot;$(TEST)&quot; JDK_IMAGE_DIR=$(JDK_OUTPUTDIR))</span>
 600 
<a name="67" id="anc67"></a><span class="line-modified"> 601 jcov-test:</span>
<span class="line-modified"> 602 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \</span>
<span class="line-modified"> 603 	    TEST=&quot;$(TEST)&quot; TEST_OPTS_JCOV=true)</span>


 604 
<a name="68" id="anc68"></a><span class="line-modified"> 605 ALL_TARGETS += test exploded-test jcov-test</span>






 606 
 607 ################################################################################
 608 # Bundles
 609 
<a name="69" id="anc69"></a><span class="line-modified"> 610 product-bundles:</span>
<span class="line-modified"> 611 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk product-bundles)</span>



 612 
<a name="70" id="anc70"></a><span class="line-modified"> 613 legacy-bundles:</span>
<span class="line-modified"> 614 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk legacy-bundles)</span>



 615 
<a name="71" id="anc71"></a><span class="line-modified"> 616 test-bundles:</span>
<span class="line-modified"> 617 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk test-bundles)</span>



 618 
<a name="72" id="anc72"></a><span class="line-modified"> 619 docs-bundles:</span>
<span class="line-modified"> 620 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk docs-bundles)</span>



 621 
<a name="73" id="anc73"></a><span class="line-modified"> 622 static-libs-bundles:</span>
<span class="line-modified"> 623 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk static-libs-bundles)</span>



 624 
 625 ifeq ($(JCOV_ENABLED), true)
<a name="74" id="anc74"></a><span class="line-modified"> 626   jcov-bundles:</span>
<span class="line-modified"> 627 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk jcov-bundles)</span>



 628 endif
 629 
<a name="75" id="anc75"></a><span class="line-removed"> 630 ALL_TARGETS += product-bundles legacy-bundles test-bundles docs-bundles \</span>
<span class="line-removed"> 631     static-libs-bundles jcov-bundles</span>
<span class="line-removed"> 632 </span>
 633 ################################################################################
 634 # Install targets
 635 
<a name="76" id="anc76"></a><span class="line-modified"> 636 install:</span>
<span class="line-modified"> 637 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Install.gmk)</span>
<span class="line-modified"> 638 </span>
<span class="line-modified"> 639 ALL_TARGETS += install</span>
 640 
 641 ################################################################################
 642 #
 643 # Dependency declarations between targets.
 644 #
 645 # These are declared in two groups. First all dependencies between targets that
 646 # have recipes above as these dependencies may be disabled. Then the aggregator
 647 # targets that do not have recipes of their own, which will never have their
 648 # dependencies disabled.
 649 #
 650 ################################################################################
 651 # Targets with recipes above
 652 
 653 # If running an *-only target, parallel execution and dependencies between
 654 # recipe targets are disabled. This makes it possible to run a select set of
 655 # recipe targets in order. It&#39;s the responsibility of the user to make sure
 656 # all prerequisites are fulfilled.
<a name="77" id="anc77"></a><span class="line-modified"> 657 ifneq ($(findstring -only, $(MAKECMDGOALS)), )</span>
 658   .NOTPARALLEL:
 659 else
 660   $(LANGTOOLS_GENSRC_TARGETS): buildtools-langtools
 661 
 662   interim-langtools: $(INTERIM_LANGTOOLS_GENSRC_TARGETS)
 663 
<a name="78" id="anc78"></a><span class="line-removed"> 664   buildtools-jdk: interim-langtools interim-tzdb</span>
<span class="line-removed"> 665 </span>
<span class="line-removed"> 666   buildtools-hotspot: interim-langtools</span>
<span class="line-removed"> 667 </span>
<span class="line-removed"> 668   buildtools-modules: exploded-image-base</span>
<span class="line-removed"> 669 </span>
 670   $(HOTSPOT_GENSRC_TARGETS): interim-langtools buildtools-hotspot
 671 
 672   $(JDK_GENSRC_TARGETS): interim-langtools buildtools-jdk
 673 
 674   $(GENSRC_MODULEINFO_TARGETS): buildtools-jdk
 675 
 676   $(GENDATA_TARGETS): interim-langtools buildtools-jdk
 677 
 678   $(JAVA_TARGETS): interim-langtools
 679 
 680   # Declare dependencies between hotspot-&lt;variant&gt;* targets
 681   $(foreach v, $(JVM_VARIANTS), \
 682       $(eval hotspot-$v-gensrc: java.base-copy) \
 683       $(eval hotspot-$v-libs: hotspot-$v-gensrc java.base-copy) \
 684   )
 685 
<a name="79" id="anc79"></a><span class="line-removed"> 686   hotspot-ide-project: hotspot exploded-image</span>
<span class="line-removed"> 687 </span>
<span class="line-removed"> 688   generate-exported-symbols: java.base-libs jdk.jdwp.agent-libs</span>
<span class="line-removed"> 689 </span>
 690   # If not already set, set the JVM variant target so that the JVM will be built.
 691   JVM_MAIN_LIB_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-libs
 692 
 693   # Building one JVM variant is enough to start building the other libs
 694   $(LIBS_TARGETS): $(JVM_MAIN_LIB_TARGETS)
 695 
 696   $(LAUNCHER_TARGETS): java.base-libs
 697 
 698   ifeq ($(STATIC_BUILD), true)
 699     $(LAUNCHER_TARGETS): generate-exported-symbols
 700   endif
 701 
<a name="80" id="anc80"></a><span class="line-removed"> 702   # The demos are currently linking to libjvm and libjava, just like all other</span>
<span class="line-removed"> 703   # jdk libs, even though they don&#39;t need to. To avoid warnings, make sure they</span>
<span class="line-removed"> 704   # aren&#39;t built until after libjava and libjvm are available to link to.</span>
<span class="line-removed"> 705   demos-jdk: java.base-libs exploded-image</span>
<span class="line-removed"> 706   test-image-demos-jdk: demos-jdk</span>
<span class="line-removed"> 707 </span>
 708   # Declare dependency from &lt;module&gt;-java to &lt;module&gt;-gensrc
 709   $(foreach m, $(GENSRC_MODULES), $(eval $m-java: $m-gensrc))
 710 
 711   # Declare dependencies between java modules
 712   $(foreach m, $(JAVA_MODULES), \
 713       $(eval $m-java: $(addsuffix -java, $(filter $(JAVA_MODULES), \
 714       $(call FindDepsForModule,$m)))))
 715   # Declare dependencies between the module meta targets
 716   $(foreach m, $(ALL_MODULES), $(eval $m: $(call FindDepsForModule,$m)))
 717 
 718   # Declare dependencies from &lt;module&gt;-lib to &lt;module&gt;-java
 719   # Skip modules that do not have java source.
 720   $(foreach m, $(filter $(JAVA_MODULES), $(LIBS_MODULES)), $(eval $m-libs: $m-java))
 721 
 722   # Declare dependencies from all other &lt;module&gt;-lib to java.base-lib
 723   $(foreach t, $(filter-out java.base-libs, $(LIBS_TARGETS)), \
 724       $(eval $t: java.base-libs))
 725 
 726   # jdk.accessibility depends on java.desktop
 727   jdk.accessibility-libs: java.desktop-libs
 728 
 729   # This dependency needs to be explicitly declared. jdk.jdi-gensrc generates a
 730   # header file used by jdk.jdwp.agent-libs. The jdk.jdwp.agent-gensrc is a
 731   # virtual target.
 732   jdk.jdwp.agent-libs: jdk.jdwp.agent-gensrc
 733 
 734   # The swing beans need to have java base properly generated to avoid errors
 735   # in javadoc. The X11 wrappers need the java.base include files to have been
 736   # copied and processed.
 737   java.desktop-gensrc-src: java.base-gensrc java.base-copy
 738 
 739   # The annotation processing for jdk.internal.vm.compiler
 740   # and jdk.internal.vm.compiler.management needs classes from the current JDK.
 741   jdk.internal.vm.compiler-gensrc-src: $(addsuffix -java, \
 742       $(call FindTransitiveDepsForModule, jdk.internal.vm.compiler))
 743   jdk.internal.vm.compiler.management-gensrc-src: $(addsuffix -java, \
 744       $(call FindTransitiveDepsForModule, jdk.internal.vm.compiler.management))
 745 
 746   # For these modules, the gensrc step is generating a module-info.java.extra
 747   # file to be processed by the gensrc-moduleinfo target.
 748   jdk.internal.vm.compiler-gensrc-moduleinfo: jdk.internal.vm.compiler-gensrc-src
 749   jdk.internal.vm.compiler.management-gensrc-moduleinfo: jdk.internal.vm.compiler.management-gensrc-src
 750 
 751   jdk.jdeps-gendata: java
 752 
 753   # The ct.sym generation uses all the moduleinfos as input
 754   jdk.compiler-gendata: $(GENSRC_MODULEINFO_TARGETS)
 755 
 756   # Declare dependencies between jmod targets.
 757   # java.base jmod needs jrt-fs.jar and access to the other jmods to be built.
 758   # When creating the BUILDJDK, we don&#39;t need to add hashes to java.base, thus
 759   # we don&#39;t need to depend on all other jmods
 760   ifneq ($(CREATING_BUILDJDK), true)
 761     java.base-jmod: jrtfs-jar $(filter-out java.base-jmod, $(JMOD_TARGETS))
 762   endif
 763 
 764   # If not already set, set the JVM target so that the JVM will be built.
 765   JVM_MAIN_TARGETS ?= hotspot
 766 
 767   # Building java.base-jmod requires all of VM (ie hotspot) to be built.
 768   java.base-jmod: $(JVM_MAIN_TARGETS)
 769 
 770   # Declare dependencies from &lt;module&gt;-jmod to all other module targets
 771   $(foreach m, $(JAVA_MODULES), $(eval $m_JMOD_DEPS += $m-java))
 772   $(foreach m, $(GENDATA_MODULES), $(eval $m_JMOD_DEPS += $m-gendata))
 773   $(foreach m, $(LIBS_MODULES), $(eval $m_JMOD_DEPS += $m-libs))
 774   $(foreach m, $(LAUNCHER_MODULES), $(eval $m_JMOD_DEPS += $m-launchers))
 775   $(foreach m, $(COPY_MODULES), $(eval $m_JMOD_DEPS += $m-copy))
 776   $(foreach m, $(ALL_MODULES), $(eval $m-jmod: $($(m)_JMOD_DEPS)))
 777   $(foreach m, $(INTERIM_IMAGE_MODULES), $(eval $m-interim-jmod: $($(m)_JMOD_DEPS)))
 778 
 779   # Setup the minimal set of generated native source dependencies for hotspot
 780   $(foreach v, $(JVM_VARIANTS), \
 781     $(eval hotspot-$v-libs-compile-commands: hotspot-$v-gensrc) \
 782     $(foreach m, $(filter java.desktop jdk.hotspot.agent, $(GENSRC_MODULES)), \
 783       $(eval hotspot-$v-libs-compile-commands: $m-gensrc)) \
 784   )
 785 
 786   # For the full JDK compile commands, create all possible generated sources
 787   $(foreach m, $(GENSRC_MODULES), $(eval $m-libs-compile-commands: $m-gensrc))
 788   $(foreach m, $(filter $(JAVA_MODULES), $(LIBS_MODULES)), $(eval $m-libs-compile-commands: $m-java))
 789 
 790   $(COMPILE_COMMANDS_TARGETS_HOTSPOT): clean-compile-commands
 791   $(COMPILE_COMMANDS_TARGETS_JDK): clean-compile-commands
 792   compile-commands-hotspot: $(COMPILE_COMMANDS_TARGETS_HOTSPOT)
 793   compile-commands: $(COMPILE_COMMANDS_TARGETS_HOTSPOT) $(COMPILE_COMMANDS_TARGETS_JDK)
 794 
<a name="81" id="anc81"></a><span class="line-removed"> 795   vscode-project: compile-commands</span>
<span class="line-removed"> 796   vscode-project-clangd: compile-commands</span>
<span class="line-removed"> 797   vscode-project-rtags: compile-commands</span>
<span class="line-removed"> 798   vscode-project-ccls: compile-commands</span>
<span class="line-removed"> 799 </span>
 800   # The -static-libs targets depend on -java as well as java.base-copy.
 801   $(foreach m, $(filter $(JAVA_MODULES), $(STATIC_LIBS_MODULES)), \
 802     $(eval $m-static-libs: $m-java java.base-copy))
 803 
 804   # Jmods cannot be created until we have the jmod tool ready to run. During
 805   # a normal build we run it from the exploded image, but when cross compiling
 806   # it&#39;s run from the buildjdk, which is either created at build time or user
 807   # supplied.
 808   ifeq ($(CREATE_BUILDJDK), true)
 809     ifneq ($(CREATING_BUILDJDK), true)
 810       # When cross compiling and buildjdk is to be created, simply depend on
 811       # creating the buildjdk.
 812       $(JMOD_TARGETS): create-buildjdk
 813       buildtools-modules: create-buildjdk
 814     else
 815       # While actually creating the buildjdk, we need to list the bare
 816       # minimum dependencies needed before running jmod, to avoid building
 817       # more than necessary. This includes:
 818       # * all java modules
 819       # * jdk.jlink-launchers
 820       # * copy jvm.cfg (done in java.base-copy)
 821       # * tzdb.dat (done in java.base-gendata)
 822       # Without all of these jimage, jlink and jmod won&#39;t start.
 823       $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): java.base-libs java.base-copy \
 824           java.base-gendata jdk.jlink-launchers java
 825     endif
 826   else
 827     # The normal non cross compilation case uses needs to wait for the full
 828     # exploded-image to avoid a race with the optimize target.
 829     $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): exploded-image
 830   endif
 831 
 832   # All modules include the main license files from java.base.
 833   $(JMOD_TARGETS): java.base-copy
 834 
<a name="82" id="anc82"></a><span class="line-modified"> 835   zip-security: java.base-java java.security.jgss-java java.security.jgss-libs \</span>
<span class="line-removed"> 836       $(filter jdk.crypto%, $(JAVA_TARGETS))</span>
<span class="line-removed"> 837 </span>
<span class="line-removed"> 838   zip-source: gensrc</span>
<span class="line-removed"> 839 </span>
<span class="line-removed"> 840   jrtfs-jar: interim-langtools</span>
<span class="line-removed"> 841 </span>
<span class="line-removed"> 842   build-microbenchmark: interim-langtools exploded-image</span>
 843 
 844   ifeq ($(ENABLE_GENERATE_CLASSLIST), true)
 845     ifeq ($(CREATE_BUILDJDK), true)
 846       # If creating a buildjdk, the interim image needs to be based on that.
 847       generate-link-opt-data: create-buildjdk
 848     else ifeq ($(EXTERNAL_BUILDJDK), false)
 849       # If an external buildjdk has been provided, we skip generating an
 850       # interim-image and just use the external buildjdk for generating
 851       # classlist.
 852       generate-link-opt-data: interim-image
 853     endif
 854     generate-link-opt-data: buildtools-jdk
 855 
 856     # The generated classlist needs to go into java.base-jmod.
 857     java.base-jmod jdk.jlink-jmod jdk-image legacy-jre-image: generate-link-opt-data
 858   endif
 859 
<a name="83" id="anc83"></a><span class="line-removed"> 860   release-file: create-source-revision-tracker</span>
<span class="line-removed"> 861 </span>
<span class="line-removed"> 862   jdk-image: jmods zip-source demos release-file</span>
<span class="line-removed"> 863   legacy-jre-image: jmods release-file</span>
 864   symbols-image: $(LIBS_TARGETS) $(LAUNCHER_TARGETS)
 865 
 866   static-libs-image: $(STATIC_LIBS_TARGETS)
 867 
<a name="84" id="anc84"></a><span class="line-removed"> 868   graal-builder-image: jdk-image static-libs-image</span>
<span class="line-removed"> 869 </span>
<span class="line-removed"> 870   mac-jdk-bundle: jdk-image</span>
<span class="line-removed"> 871   mac-legacy-jre-bundle: legacy-jre-image</span>
<span class="line-removed"> 872 </span>
<span class="line-removed"> 873   ifeq ($(JCOV_INPUT_JDK), )</span>
<span class="line-removed"> 874     jcov-image: jdk-image</span>
<span class="line-removed"> 875   endif</span>
<span class="line-removed"> 876 </span>
<span class="line-removed"> 877   # The optimize target can run as soon as the modules dir has been completely</span>
<span class="line-removed"> 878   # populated (java, copy and gendata targets) and the basic libs and launchers</span>
<span class="line-removed"> 879   # have been built.</span>
<span class="line-removed"> 880   exploded-image-optimize: java copy gendata java.base-libs java.base-launchers \</span>
<span class="line-removed"> 881       buildtools-modules</span>
<span class="line-removed"> 882 </span>
 883   bootcycle-images: jdk-image
 884 
 885   docs-jdk-api-javadoc: $(GENSRC_TARGETS)
 886 
 887   docs-javase-api-javadoc: $(GENSRC_TARGETS)
 888 
 889   docs-reference-api-javadoc: $(GENSRC_TARGETS)
 890 
<a name="85" id="anc85"></a><span class="line-removed"> 891   docs-jdk-api-modulegraph: exploded-image buildtools-modules</span>
<span class="line-removed"> 892 </span>
<span class="line-removed"> 893   docs-javase-api-modulegraph: exploded-image buildtools-modules</span>
<span class="line-removed"> 894 </span>
<span class="line-removed"> 895   docs-reference-api-modulegraph: exploded-image buildtools-modules</span>
<span class="line-removed"> 896 </span>
 897   # If not already set, then set the JVM specific docs targets
 898   JVM_DOCS_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-gensrc
 899 
<a name="86" id="anc86"></a><span class="line-modified"> 900   # The gensrc steps for hotspot and jdk.jdi create html spec files.</span>
<span class="line-modified"> 901   docs-jdk-specs: buildtools-jdk $(JVM_DOCS_TARGETS) jdk.jdi-gensrc \</span>
<span class="line-removed"> 902       docs-jdk-index</span>
<span class="line-removed"> 903 </span>
<span class="line-removed"> 904   docs-zip: docs-jdk</span>
<span class="line-removed"> 905 </span>
<span class="line-removed"> 906   docs-specs-zip: docs-jdk-specs</span>
 907 
 908   # Tests
<a name="87" id="anc87"></a><span class="line-removed"> 909   test: jdk-image test-image</span>
<span class="line-removed"> 910 </span>
<span class="line-removed"> 911   exploded-test: exploded-image test-image</span>
<span class="line-removed"> 912 </span>
<span class="line-removed"> 913   jcov-test: jcov-image test-image</span>
<span class="line-removed"> 914 </span>
 915   test-make: clean-test-make compile-commands
 916 
 917   test-make-compile-commands: compile-commands
 918 
 919   # Declare dependency for all generated test targets
 920   $(foreach t, $(filter-out test-make%, $(ALL_TEST_TARGETS)), $(eval $t: jdk-image test-image))
 921   $(foreach t, $(ALL_EXPLODED_TEST_TARGETS), $(eval $t: exploded-image test-image))
 922 
 923   interim-image: $(INTERIM_JMOD_TARGETS)
 924 
<a name="88" id="anc88"></a><span class="line-modified"> 925   build-test-lib: exploded-image</span>
<span class="line-removed"> 926 </span>
<span class="line-removed"> 927   build-test-failure-handler: interim-langtools</span>
<span class="line-removed"> 928 </span>
<span class="line-removed"> 929   test-image-failure-handler: build-test-failure-handler</span>
<span class="line-removed"> 930 </span>
<span class="line-removed"> 931   build-test-hotspot-jtreg-native: buildtools-jdk \</span>
<span class="line-removed"> 932       hotspot-$(JVM_VARIANT_MAIN)-libs</span>
<span class="line-removed"> 933 </span>
<span class="line-removed"> 934   build-test-jdk-jtreg-native: buildtools-jdk java.base-libs</span>
<span class="line-removed"> 935 </span>
<span class="line-removed"> 936   build-test-hotspot-jtreg-graal: exploded-image</span>
<span class="line-removed"> 937 </span>
<span class="line-removed"> 938   test-image-hotspot-jtreg-native: build-test-hotspot-jtreg-native</span>
<span class="line-removed"> 939 </span>
<span class="line-removed"> 940   test-image-jdk-jtreg-native: build-test-jdk-jtreg-native</span>
<span class="line-removed"> 941 </span>
<span class="line-removed"> 942   test-image-hotspot-jtreg-graal: build-test-hotspot-jtreg-graal</span>
<span class="line-removed"> 943 </span>
<span class="line-removed"> 944   test-image-hotspot-gtest: hotspot</span>
<span class="line-removed"> 945 </span>
<span class="line-removed"> 946   install: product-images</span>
<span class="line-removed"> 947 </span>
<span class="line-removed"> 948   product-bundles: product-images</span>
<span class="line-removed"> 949 </span>
<span class="line-removed"> 950   legacy-bundles: legacy-images</span>
<span class="line-removed"> 951 </span>
<span class="line-removed"> 952   test-bundles: test-image</span>
<span class="line-removed"> 953 </span>
<span class="line-removed"> 954   docs-bundles: docs-image</span>
<span class="line-removed"> 955 </span>
<span class="line-removed"> 956   jcov-bundles: jcov-image</span>
<span class="line-removed"> 957 </span>
<span class="line-removed"> 958   static-libs-bundles: static-libs-image</span>
<span class="line-removed"> 959 </span>
<span class="line-removed"> 960   generate-summary: jmods buildtools-modules</span>
<span class="line-removed"> 961 </span>
<span class="line-removed"> 962   update-x11wrappers: java.base-copy buildtools-jdk</span>
 963 
 964 endif
 965 
 966 ################################################################################
 967 # Virtual targets without recipes
 968 
 969 # If not already set, set the JVM specific tools targets
 970 JVM_TOOLS_TARGETS ?= buildtools-hotspot
 971 buildtools: buildtools-langtools interim-langtools \
 972     buildtools-jdk $(JVM_TOOLS_TARGETS)
 973 
 974 # Declare dependencies from hotspot-&lt;variant&gt; targets
 975 $(foreach v, $(JVM_VARIANTS), \
 976   $(eval hotspot-$v: hotspot-$v-gensrc hotspot-$v-libs) \
 977 )
 978 hotspot: $(HOTSPOT_VARIANT_TARGETS)
 979 
 980 # Create targets hotspot-libs and hotspot-gensrc.
 981 $(foreach v, $(JVM_VARIANTS), \
 982   $(eval hotspot-libs: hotspot-$v-libs) \
 983   $(eval hotspot-gensrc: hotspot-$v-gensrc) \
 984 )
 985 
 986 gensrc: $(GENSRC_TARGETS)
 987 
 988 gendata: $(GENDATA_TARGETS)
 989 
 990 copy: $(ALL_COPY_TARGETS)
 991 
 992 java: $(JAVA_TARGETS)
 993 
 994 libs: $(LIBS_TARGETS)
 995 
 996 static-libs: $(STATIC_LIBS_TARGETS)
 997 
 998 launchers: $(LAUNCHER_TARGETS)
 999 
1000 jmods: $(JMOD_TARGETS)
1001 
1002 # Explicitly declare dependency for virtual target jdk.jdwp.agent-gensrc which
1003 # is actually handled by jdk.jdi-gensrc
1004 jdk.jdwp.agent-gensrc: jdk.jdi-gensrc
1005 
1006 # Declare dependencies from &lt;module&gt; to all the individual targets specific
1007 # to that module &lt;module&gt;-*, that are needed for the exploded image.
1008 $(foreach m, $(GENSRC_MODULES), $(eval $m: $m-gensrc))
1009 $(foreach m, $(JAVA_MODULES), $(eval $m: $m-java))
1010 $(foreach m, $(GENDATA_MODULES), $(eval $m: $m-gendata))
1011 $(foreach m, $(LIBS_MODULES), $(eval $m: $m-libs))
1012 $(foreach m, $(LAUNCHER_MODULES), $(eval $m: $m-launchers))
1013 $(foreach m, $(ALL_COPY_MODULES), $(eval $m: $m-copy))
1014 
1015 # Building java.base includes building all of hotspot.
1016 java.base: $(JVM_MAIN_TARGETS)
1017 
1018 demos: demos-jdk
1019 
1020 # The &quot;exploded image&quot; is a locally runnable JDK in $(OUTPUTDIR)/jdk.
1021 exploded-image-base: $(ALL_MODULES)
1022 exploded-image: exploded-image-base release-file
1023 # When cross compiling, no need to optimize the exploded image since it won&#39;t
1024 # be runnable on the host platform anyway.
1025 ifneq ($(COMPILE_TYPE), cross)
1026   exploded-image: exploded-image-optimize
1027 endif
1028 
1029 create-buildjdk: create-buildjdk-interim-image
1030 
1031 docs-jdk-api: docs-jdk-api-javadoc
1032 docs-javase-api: docs-javase-api-javadoc
1033 docs-reference-api: docs-reference-api-javadoc
1034 
1035 # If we&#39;re building full docs, we must also generate the module graphs to
1036 # get non-broken api documentation.
1037 ifeq ($(ENABLE_FULL_DOCS), true)
1038   docs-jdk-api: docs-jdk-api-modulegraph
1039   docs-javase-api: docs-javase-api-modulegraph
1040   docs-reference-api: docs-reference-api-modulegraph
1041 endif
1042 
1043 docs-jdk: docs-jdk-api docs-jdk-specs docs-jdk-index
1044 docs-javase: docs-javase-api
1045 docs-reference: docs-reference-api
1046 
1047 # alias for backwards compatibility
1048 docs-javadoc: docs-jdk-api
1049 
1050 mac-bundles: mac-jdk-bundle
1051 
1052 # The $(OUTPUTDIR)/images directory contain the resulting deliverables,
1053 # and in line with this, our targets for creating these are named *-image[s].
1054 
1055 # This target builds the product images, e.g. the JDK image
1056 # (and possibly other, more specific versions)
1057 product-images: jdk-image symbols-image exploded-image
1058 
1059 # This target builds the legacy images, e.g. the legacy JRE image
1060 legacy-images: legacy-jre-image
1061 
1062 # zip-security is actually a bundle, but for now it needs to be considered
1063 # an image until this can be cleaned up properly.
1064 product-images: zip-security
1065 
1066 # The module summary cannot be run when:
1067 # * Cross compiling and building a partial BUILDJDK for the build host
1068 # * An external buildjdk has been supplied since it may not match the
1069 #   module selection of the target jdk
1070 ifneq ($(CREATE_BUILDJDK), true)
1071   ifeq ($(EXTERNAL_BUILDJDK), false)
1072     product-images: generate-summary
1073   endif
1074 endif
1075 
1076 ifeq ($(call isTargetOs, macosx), true)
1077   product-images: mac-jdk-bundle
1078 
1079   legacy-images: mac-legacy-jre-bundle
1080 endif
1081 
1082 # This target builds the documentation image
1083 docs-image: docs-jdk
1084 
1085 # If not already set, set the JVM specific targets to build the test image
1086 JVM_TEST_IMAGE_TARGETS ?= test-image-hotspot-jtreg-native test-image-hotspot-gtest
1087 
1088 ifeq ($(INCLUDE_GRAAL), true)
1089   JVM_TEST_IMAGE_TARGETS += test-image-hotspot-jtreg-graal
1090 endif
1091 
1092 # This target builds the test image
<a name="89" id="anc89"></a><span class="line-modified">1093 test-image: prepare-test-image \</span>
<span class="line-removed">1094     test-image-jdk-jtreg-native test-image-failure-handler \</span>
1095     test-image-demos-jdk $(JVM_TEST_IMAGE_TARGETS)
1096 
<a name="90" id="anc90"></a>



1097 ifneq ($(JMH_CORE_JAR), )
1098   test-image: build-microbenchmark
1099 endif
1100 
1101 ################################################################################
1102 
1103 # all-images builds all our deliverables as images.
1104 all-images: product-images test-image docs-image
1105 
1106 # all-bundles packages all our deliverables as tar.gz bundles.
1107 all-bundles: product-bundles test-bundles docs-bundles static-libs-bundles
1108 
1109 ALL_TARGETS += buildtools hotspot hotspot-libs hotspot-gensrc gensrc gendata \
1110     copy java libs static-libs launchers jmods \
1111     jdk.jdwp.agent-gensrc $(ALL_MODULES) demos \
1112     exploded-image-base exploded-image \
1113     create-buildjdk docs-jdk-api docs-javase-api docs-reference-api docs-jdk \
1114     docs-javase docs-reference docs-javadoc mac-bundles product-images legacy-images \
1115     docs-image test-image all-images \
1116     all-bundles
1117 
1118 ################################################################################
1119 
1120 # Traditional targets typically run by users.
1121 # These can be considered aliases for the targets now named by a more
1122 # &quot;modern&quot; naming scheme.
1123 default: $(DEFAULT_MAKE_TARGET)
1124 jdk: exploded-image
1125 images: product-images
1126 docs: docs-image
1127 bundles: all-bundles
1128 all: all-images
1129 
1130 ALL_TARGETS += default jdk images docs bundles all
1131 
1132 # Aliases used for running tests.
1133 
1134 # Let &quot;run-test&quot; be an alias for &quot;test&quot;
1135 $(foreach t, $(ALL_NAMED_TESTS), $(eval run-test-$t: test-$t))
1136 RUN_TEST_TARGETS := $(addprefix run-test-, $(ALL_NAMED_TESTS))
1137 
1138 run-test: test
1139 exploded-run-test: exploded-test
1140 
1141 # &quot;make check&quot; is a common idiom for running basic testing
1142 check: test-tier1
1143 
1144 # Keep some old names as aliases
1145 test-hotspot-jtreg: test-hotspot_all
1146 test-hotspot-jtreg-native: test-hotspot_native_sanity
1147 test-hotspot-gtest: exploded-test-gtest
1148 test-jdk-jtreg-native: test-jdk_native_sanity
1149 
1150 ALL_TARGETS += $(RUN_TEST_TARGETS) run-test exploded-run-test check \
1151     test-hotspot-jtreg test-hotspot-jtreg-native test-hotspot-gtest \
1152     test-jdk-jtreg-native
1153 
1154 ################################################################################
1155 ################################################################################
1156 #
1157 # Clean targets
1158 #
1159 ################################################################################
1160 # Clean targets are automatically run serially by the Makefile calling this
1161 # file.
1162 
1163 CLEAN_DIRS += hotspot jdk bootcycle-build test buildtools support \
1164     images make-support test-make bundles buildjdk test-results test-support \
1165     support/images
1166 CLEAN_DIR_TARGETS := $(addprefix clean-, $(CLEAN_DIRS))
1167 CLEAN_SUPPORT_DIRS += demos
1168 CLEAN_SUPPORT_DIR_TARGETS := $(addprefix clean-, $(CLEAN_SUPPORT_DIRS))
1169 CLEAN_TESTS += hotspot-jtreg-native jdk-jtreg-native lib
1170 CLEAN_TEST_TARGETS += $(addprefix clean-test-, $(CLEAN_TESTS))
1171 CLEAN_PHASES := gensrc java native include
1172 CLEAN_PHASE_TARGETS := $(addprefix clean-, $(CLEAN_PHASES))
1173 CLEAN_MODULE_TARGETS := $(addprefix clean-, $(ALL_MODULES))
1174 # Construct targets of the form clean-$module-$phase
1175 CLEAN_MODULE_PHASE_TARGETS := $(addprefix clean-, $(foreach m, $(ALL_MODULES), \
1176     $(addprefix $m-, $(CLEAN_PHASES))))
1177 
1178 # Remove everything, except the output from configure.
1179 clean: $(CLEAN_DIR_TARGETS)
1180 	($(CD) $(OUTPUTDIR) &amp;&amp; $(RM) -r build*.log* compile_commands.json)
1181 	$(ECHO) Cleaned all build artifacts.
1182 
1183 clean-docs:
1184 	$(call CleanDocs)
1185 
1186 clean-compile-commands:
1187 	$(call CleanMakeSupportDir,compile-commands)
1188 
1189 $(CLEAN_DIR_TARGETS):
1190 	$(call CleanDir,$(patsubst clean-%, %, $@))
1191 
1192 $(CLEAN_SUPPORT_DIR_TARGETS):
1193 	$(call CleanSupportDir,$(patsubst clean-%, %, $@))
1194 
1195 $(CLEAN_TEST_TARGETS):
1196 	$(call CleanTest,$(patsubst clean-test-%, %, $@))
1197 
1198 $(CLEAN_PHASE_TARGETS):
1199 	$(call Clean-$(patsubst clean-%,%, $@))
1200 
1201 $(CLEAN_MODULE_TARGETS):
1202 	$(call CleanModule,$(patsubst clean-%, %, $@))
1203 
1204 $(CLEAN_MODULE_PHASE_TARGETS):
1205 	$(call Clean-$(word 3, $(subst -,$(SPACE),$@)), \
1206 	    $(word 2, $(subst -,$(SPACE),$@)))
1207 
1208 # When removing the support dir, we must also remove jdk. Building classes has
1209 # the side effect of generating native headers. The headers end up in support
1210 # while classes and touch files end up in jdk.
1211 clean-support: clean-jdk
1212 
1213 clean-test: clean-test-results clean-test-support
1214 
1215 # When cleaning images, also clean the support/images directory.
1216 clean-images: clean-support/images
1217 
1218 # Remove everything, including configure configuration. If the output
1219 # directory was created by configure and now becomes empty, remove it as well.
1220 dist-clean: clean
1221 	($(CD) $(OUTPUTDIR) &amp;&amp; \
1222 	    $(RM) -r *spec.gmk $(CONFIGURESUPPORT_OUTPUTDIR) Makefile compare.sh ide \
1223 	    configure.log* build.log*)
1224 	$(if $(filter $(CONF_NAME),$(notdir $(OUTPUTDIR))), \
1225 	  if test &quot;x`$(LS) $(OUTPUTDIR)`&quot; != x; then \
1226 	    $(ECHO) &quot;Warning: Not removing non-empty configuration directory for &#39;$(CONF_NAME)&#39;&quot; ; \
1227 	  else \
1228 	    ($(CD) $(TOPDIR) &amp;&amp; $(ECHO) &quot;Removing configuration directory for &#39;$(CONF_NAME)&#39;&quot; \
1229 	        &amp;&amp; $(RM) -r $(OUTPUTDIR)) \
1230 	  fi \
1231 	)
1232 	$(ECHO) Cleaned everything, you will have to re-run configure.
1233 
1234 ALL_TARGETS += clean clean-docs clean-compile-commands dist-clean $(CLEAN_DIR_TARGETS) \
1235     $(CLEAN_SUPPORT_DIR_TARGETS) $(CLEAN_TEST_TARGETS) $(CLEAN_PHASE_TARGETS) \
1236     $(CLEAN_MODULE_TARGETS) $(CLEAN_MODULE_PHASE_TARGETS)
1237 
1238 ################################################################################
1239 # Declare *-only targets for each normal target
1240 $(foreach t, $(ALL_TARGETS), $(eval $(t)-only: $(t)))
1241 
1242 ALL_TARGETS += $(addsuffix -only, $(filter-out dist-clean clean%, $(ALL_TARGETS)))
1243 
1244 ################################################################################
1245 
1246 # The following targets are intentionally not added to ALL_TARGETS since they
1247 # are internal only, to support Init.gmk.
1248 
1249 print-targets:
1250 	  @$(ECHO) $(sort $(ALL_TARGETS))
1251 
1252 print-modules:
1253 	  @$(ECHO) $(sort $(ALL_MODULES))
1254 
1255 print-tests:
1256 	  @$(ECHO) $(sort $(ALL_NAMED_TESTS))
1257 
1258 create-main-targets-include:
1259 	  $(call LogInfo, Generating main target list)
1260 	  @$(ECHO) ALL_MAIN_TARGETS := $(sort $(ALL_TARGETS)) &gt; \
1261 	      $(MAKESUPPORT_OUTPUTDIR)/main-targets.gmk
1262 
1263 ################################################################################
1264 # Hook to include the corresponding custom file, if present.
1265 $(eval $(call IncludeCustomExtension, Main-post.gmk))
1266 
1267 .PHONY: $(ALL_TARGETS)
1268 
1269 FRC: # Force target
<a name="91" id="anc91"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="91" type="hidden" />
</body>
</html>