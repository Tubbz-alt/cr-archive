<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/runtime/arguments.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../prims/whitebox.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="arguments.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/runtime/arguments.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -523,10 +523,18 @@</span>
    { &quot;AllowRedefinitionToAddDeleteMethods&quot;, JDK_Version::jdk(13), JDK_Version::undefined(), JDK_Version::undefined() },
    { &quot;FlightRecorder&quot;,               JDK_Version::jdk(13), JDK_Version::undefined(), JDK_Version::undefined() },
    { &quot;PrintVMQWaitTime&quot;,             JDK_Version::jdk(15), JDK_Version::jdk(16), JDK_Version::jdk(17) },
    { &quot;UseNewFieldLayout&quot;,            JDK_Version::jdk(15), JDK_Version::jdk(16), JDK_Version::jdk(17) },
    { &quot;ForceNUMA&quot;,                    JDK_Version::jdk(15), JDK_Version::jdk(16), JDK_Version::jdk(17) },
<span class="udiff-line-added">+   { &quot;UseBiasedLocking&quot;,             JDK_Version::jdk(15), JDK_Version::jdk(16), JDK_Version::jdk(17) },</span>
<span class="udiff-line-added">+   { &quot;BiasedLockingStartupDelay&quot;,    JDK_Version::jdk(15), JDK_Version::jdk(16), JDK_Version::jdk(17) },</span>
<span class="udiff-line-added">+   { &quot;PrintBiasedLockingStatistics&quot;, JDK_Version::jdk(15), JDK_Version::jdk(16), JDK_Version::jdk(17) },</span>
<span class="udiff-line-added">+   { &quot;BiasedLockingBulkRebiasThreshold&quot;,    JDK_Version::jdk(15), JDK_Version::jdk(16), JDK_Version::jdk(17) },</span>
<span class="udiff-line-added">+   { &quot;BiasedLockingBulkRevokeThreshold&quot;,    JDK_Version::jdk(15), JDK_Version::jdk(16), JDK_Version::jdk(17) },</span>
<span class="udiff-line-added">+   { &quot;BiasedLockingDecayTime&quot;,              JDK_Version::jdk(15), JDK_Version::jdk(16), JDK_Version::jdk(17) },</span>
<span class="udiff-line-added">+   { &quot;UseOptoBiasInlining&quot;,                 JDK_Version::jdk(15), JDK_Version::jdk(16), JDK_Version::jdk(17) },</span>
<span class="udiff-line-added">+   { &quot;PrintPreciseBiasedLockingStatistics&quot;, JDK_Version::jdk(15), JDK_Version::jdk(16), JDK_Version::jdk(17) },</span>
  
    // --- Deprecated alias flags (see also aliased_jvm_flags) - sorted by obsolete_in then expired_in:
    { &quot;DefaultMaxRAMFraction&quot;,        JDK_Version::jdk(8),  JDK_Version::undefined(), JDK_Version::undefined() },
    { &quot;CreateMinidumpOnCrash&quot;,        JDK_Version::jdk(9),  JDK_Version::undefined(), JDK_Version::undefined() },
    { &quot;TLABStats&quot;,                    JDK_Version::jdk(12), JDK_Version::undefined(), JDK_Version::undefined() },
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1664,11 +1672,13 @@</span>
      }
    } else {
      if (UseCompressedOops &amp;&amp; !FLAG_IS_DEFAULT(UseCompressedOops)) {
        warning(&quot;Max heap size too large for Compressed Oops&quot;);
        FLAG_SET_DEFAULT(UseCompressedOops, false);
<span class="udiff-line-modified-removed">-       FLAG_SET_DEFAULT(UseCompressedClassPointers, false);</span>
<span class="udiff-line-modified-added">+       if (COMPRESSED_CLASS_POINTERS_DEPENDS_ON_COMPRESSED_OOPS) {</span>
<span class="udiff-line-added">+         FLAG_SET_DEFAULT(UseCompressedClassPointers, false);</span>
<span class="udiff-line-added">+       }</span>
      }
    }
  #endif // _LP64
  #endif // ZERO
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1677,12 +1687,18 @@</span>
  // NOTE: set_use_compressed_klass_ptrs() must be called after calling
  // set_use_compressed_oops().
  void Arguments::set_use_compressed_klass_ptrs() {
  #ifndef ZERO
  #ifdef _LP64
<span class="udiff-line-modified-removed">-   // UseCompressedOops must be on for UseCompressedClassPointers to be on.</span>
<span class="udiff-line-modified-removed">-   if (!UseCompressedOops) {</span>
<span class="udiff-line-modified-added">+   // On some architectures, the use of UseCompressedClassPointers implies the use of</span>
<span class="udiff-line-modified-added">+   // UseCompressedOops. The reason is that the rheap_base register of said platforms</span>
<span class="udiff-line-added">+   // is reused to perform some optimized spilling, in order to use rheap_base as a</span>
<span class="udiff-line-added">+   // temp register. But by treating it as any other temp register, spilling can typically</span>
<span class="udiff-line-added">+   // be completely avoided instead. So it is better not to perform this trick. And by</span>
<span class="udiff-line-added">+   // not having that reliance, large heaps, or heaps not supporting compressed oops,</span>
<span class="udiff-line-added">+   // can still use compressed class pointers.</span>
<span class="udiff-line-added">+   if (COMPRESSED_CLASS_POINTERS_DEPENDS_ON_COMPRESSED_OOPS &amp;&amp; !UseCompressedOops) {</span>
      if (UseCompressedClassPointers) {
        warning(&quot;UseCompressedClassPointers requires UseCompressedOops&quot;);
      }
      FLAG_SET_DEFAULT(UseCompressedClassPointers, false);
    } else {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1807,14 +1823,11 @@</span>
        // Limit the heap size to ErgoHeapSizeLimit
        reasonable_max = MIN2(reasonable_max, (julong)ErgoHeapSizeLimit);
      }
  
  #ifdef _LP64
<span class="udiff-line-modified-removed">-     if (UseCompressedOops) {</span>
<span class="udiff-line-removed">-       // Limit the heap size to the maximum possible when using compressed oops</span>
<span class="udiff-line-removed">-       julong max_coop_heap = (julong)max_heap_for_compressed_oops();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-modified-added">+     if (UseCompressedOops || UseCompressedClassPointers) {</span>
        // HeapBaseMinAddress can be greater than default but not less than.
        if (!FLAG_IS_DEFAULT(HeapBaseMinAddress)) {
          if (HeapBaseMinAddress &lt; DefaultHeapBaseMinAddress) {
            // matches compressed oops printing flags
            log_debug(gc, heap, coops)(&quot;HeapBaseMinAddress must be at least &quot; SIZE_FORMAT
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1823,10 +1836,14 @@</span>
                                       DefaultHeapBaseMinAddress/G,
                                       HeapBaseMinAddress);
            FLAG_SET_ERGO(HeapBaseMinAddress, DefaultHeapBaseMinAddress);
          }
        }
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     if (UseCompressedOops) {</span>
<span class="udiff-line-added">+       // Limit the heap size to the maximum possible when using compressed oops</span>
<span class="udiff-line-added">+       julong max_coop_heap = (julong)max_heap_for_compressed_oops();</span>
  
        if (HeapBaseMinAddress + MaxHeapSize &lt; max_coop_heap) {
          // Heap should be above HeapBaseMinAddress to get zero based compressed oops
          // but it should be not less than default MaxHeapSize.
          max_coop_heap -= HeapBaseMinAddress;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1841,11 +1858,13 @@</span>
            log_info(cds)(&quot;UseCompressedOops and UseCompressedClassPointers have been disabled due to&quot;
              &quot; max heap &quot; SIZE_FORMAT &quot; &gt; compressed oop heap &quot; SIZE_FORMAT &quot;. &quot;
              &quot;Please check the setting of MaxRAMPercentage %5.2f.&quot;
              ,(size_t)reasonable_max, (size_t)max_coop_heap, MaxRAMPercentage);
            FLAG_SET_ERGO(UseCompressedOops, false);
<span class="udiff-line-modified-removed">-           FLAG_SET_ERGO(UseCompressedClassPointers, false);</span>
<span class="udiff-line-modified-added">+           if (COMPRESSED_CLASS_POINTERS_DEPENDS_ON_COMPRESSED_OOPS) {</span>
<span class="udiff-line-added">+             FLAG_SET_ERGO(UseCompressedClassPointers, false);</span>
<span class="udiff-line-added">+           }</span>
          } else {
            reasonable_max = MIN2(reasonable_max, max_coop_heap);
          }
        }
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3498,17 +3517,25 @@</span>
  
    delete options;
    return status;
  }
  
<span class="udiff-line-modified-removed">- void Arguments::set_shared_spaces_flags() {</span>
<span class="udiff-line-modified-added">+ jint Arguments::set_shared_spaces_flags_and_archive_paths() {</span>
    if (DumpSharedSpaces) {
      if (RequireSharedSpaces) {
        warning(&quot;Cannot dump shared archive while using shared archive&quot;);
      }
      UseSharedSpaces = false;
    }
<span class="udiff-line-added">+ #if INCLUDE_CDS</span>
<span class="udiff-line-added">+   // Initialize shared archive paths which could include both base and dynamic archive paths</span>
<span class="udiff-line-added">+   // This must be after set_ergonomics_flags() called so flag UseCompressedOops is set properly.</span>
<span class="udiff-line-added">+   if (!init_shared_archive_paths()) {</span>
<span class="udiff-line-added">+     return JNI_ENOMEM;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ #endif  // INCLUDE_CDS</span>
<span class="udiff-line-added">+   return JNI_OK;</span>
  }
  
  #if INCLUDE_CDS
  // Sharing support
  // Construct the path to the archive
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3520,11 +3547,12 @@</span>
    if (end != NULL) *end = &#39;\0&#39;;
    size_t jvm_path_len = strlen(jvm_path);
    size_t file_sep_len = strlen(os::file_separator());
    const size_t len = jvm_path_len + file_sep_len + 20;
    default_archive_path = NEW_C_HEAP_ARRAY(char, len, mtArguments);
<span class="udiff-line-modified-removed">-   jio_snprintf(default_archive_path, len, &quot;%s%sclasses.jsa&quot;,</span>
<span class="udiff-line-modified-added">+   jio_snprintf(default_archive_path, len,</span>
<span class="udiff-line-added">+                UseCompressedOops ? &quot;%s%sclasses.jsa&quot;: &quot;%s%sclasses_nocoops.jsa&quot;,</span>
                 jvm_path, os::file_separator());
    return default_archive_path;
  }
  
  int Arguments::num_archives(const char* archive_path) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3965,17 +3993,10 @@</span>
  
    if (result != JNI_OK) {
      return result;
    }
  
<span class="udiff-line-removed">- #if INCLUDE_CDS</span>
<span class="udiff-line-removed">-   // Initialize shared archive paths which could include both base and dynamic archive paths</span>
<span class="udiff-line-removed">-   if (!init_shared_archive_paths()) {</span>
<span class="udiff-line-removed">-     return JNI_ENOMEM;</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">- </span>
    // Delay warning until here so that we&#39;ve had a chance to process
    // the -XX:-PrintWarnings flag
    if (needs_hotspotrc_warning) {
      warning(&quot;%s file is present but has been ignored.  &quot;
              &quot;Run with -XX:Flags=%s to load the file.&quot;,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4059,11 +4080,12 @@</span>
    // Set heap size based on available physical memory
    set_heap_size();
  
    GCConfig::arguments()-&gt;initialize();
  
<span class="udiff-line-modified-removed">-   set_shared_spaces_flags();</span>
<span class="udiff-line-modified-added">+   result = set_shared_spaces_flags_and_archive_paths();</span>
<span class="udiff-line-added">+   if (result != JNI_OK) return result;</span>
  
    // Initialize Metaspace flags and alignments
    Metaspace::ergo_initialize();
  
    // Set compiler flags after GC is selected and GC specific
</pre>
<center><a href="../prims/whitebox.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="arguments.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>