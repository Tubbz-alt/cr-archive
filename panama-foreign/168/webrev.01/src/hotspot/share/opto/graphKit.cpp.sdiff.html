<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/opto/graphKit.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="compile.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="idealGraphPrinter.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/opto/graphKit.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
2096   // Clear out dead values from the debug info.
2097   kill_dead_locals();
2098 
2099   // Now insert the uncommon trap subroutine call
2100   address call_addr = SharedRuntime::uncommon_trap_blob()-&gt;entry_point();
2101   const TypePtr* no_memory_effects = NULL;
2102   // Pass the index of the class to be loaded
2103   Node* call = make_runtime_call(RC_NO_LEAF | RC_UNCOMMON |
2104                                  (must_throw ? RC_MUST_THROW : 0),
2105                                  OptoRuntime::uncommon_trap_Type(),
2106                                  call_addr, &quot;uncommon_trap&quot;, no_memory_effects,
2107                                  intcon(trap_request));
2108   assert(call-&gt;as_CallStaticJava()-&gt;uncommon_trap_request() == trap_request,
2109          &quot;must extract request correctly from the graph&quot;);
2110   assert(trap_request != 0, &quot;zero value reserved by uncommon_trap_request&quot;);
2111 
2112   call-&gt;set_req(TypeFunc::ReturnAdr, returnadr());
2113   // The debug info is the only real input to this call.
2114 
2115   // Halt-and-catch fire here.  The above call should never return!
<span class="line-modified">2116   HaltNode* halt = new HaltNode(control(), frameptr(), &quot;uncommon trap returned which should never happen&quot;);</span>

2117   _gvn.set_type_bottom(halt);
2118   root()-&gt;add_req(halt);
2119 
2120   stop_and_kill_map();
2121 }
2122 
2123 
2124 //--------------------------just_allocated_object------------------------------
2125 // Report the object that was just allocated.
2126 // It must be the case that there are no intervening safepoints.
2127 // We use this to determine if an object is so &quot;fresh&quot; that
2128 // it does not require card marks.
2129 Node* GraphKit::just_allocated_object(Node* current_control) {
2130   Node* ctrl = current_control;
2131   // Object::&lt;init&gt; is invoked after allocation, most of invoke nodes
2132   // will be reduced, but a region node is kept in parse time, we check
2133   // the pattern and skip the region node if it degraded to a copy.
2134   if (ctrl != NULL &amp;&amp; ctrl-&gt;is_Region() &amp;&amp; ctrl-&gt;req() == 2 &amp;&amp;
2135       ctrl-&gt;as_Region()-&gt;is_copy()) {
2136     ctrl = ctrl-&gt;as_Region()-&gt;is_copy();
</pre>
</td>
<td>
<hr />
<pre>
2096   // Clear out dead values from the debug info.
2097   kill_dead_locals();
2098 
2099   // Now insert the uncommon trap subroutine call
2100   address call_addr = SharedRuntime::uncommon_trap_blob()-&gt;entry_point();
2101   const TypePtr* no_memory_effects = NULL;
2102   // Pass the index of the class to be loaded
2103   Node* call = make_runtime_call(RC_NO_LEAF | RC_UNCOMMON |
2104                                  (must_throw ? RC_MUST_THROW : 0),
2105                                  OptoRuntime::uncommon_trap_Type(),
2106                                  call_addr, &quot;uncommon_trap&quot;, no_memory_effects,
2107                                  intcon(trap_request));
2108   assert(call-&gt;as_CallStaticJava()-&gt;uncommon_trap_request() == trap_request,
2109          &quot;must extract request correctly from the graph&quot;);
2110   assert(trap_request != 0, &quot;zero value reserved by uncommon_trap_request&quot;);
2111 
2112   call-&gt;set_req(TypeFunc::ReturnAdr, returnadr());
2113   // The debug info is the only real input to this call.
2114 
2115   // Halt-and-catch fire here.  The above call should never return!
<span class="line-modified">2116   HaltNode* halt = new HaltNode(control(), frameptr(), &quot;uncommon trap returned which should never happen&quot;</span>
<span class="line-added">2117                                                        PRODUCT_ONLY(COMMA /*reachable*/false));</span>
2118   _gvn.set_type_bottom(halt);
2119   root()-&gt;add_req(halt);
2120 
2121   stop_and_kill_map();
2122 }
2123 
2124 
2125 //--------------------------just_allocated_object------------------------------
2126 // Report the object that was just allocated.
2127 // It must be the case that there are no intervening safepoints.
2128 // We use this to determine if an object is so &quot;fresh&quot; that
2129 // it does not require card marks.
2130 Node* GraphKit::just_allocated_object(Node* current_control) {
2131   Node* ctrl = current_control;
2132   // Object::&lt;init&gt; is invoked after allocation, most of invoke nodes
2133   // will be reduced, but a region node is kept in parse time, we check
2134   // the pattern and skip the region node if it degraded to a copy.
2135   if (ctrl != NULL &amp;&amp; ctrl-&gt;is_Region() &amp;&amp; ctrl-&gt;req() == 2 &amp;&amp;
2136       ctrl-&gt;as_Region()-&gt;is_copy()) {
2137     ctrl = ctrl-&gt;as_Region()-&gt;is_copy();
</pre>
</td>
</tr>
</table>
<center><a href="compile.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="idealGraphPrinter.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>