<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.incubator.jpackage/macosx/classes/jdk/incubator/jpackage/internal/MacDmgBundler.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MacBaseInstallerBundler.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MacPkgBundler.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.incubator.jpackage/macosx/classes/jdk/incubator/jpackage/internal/MacDmgBundler.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 29,10 ***</span>
<span class="line-new-header">--- 29,11 ---</span>
  import java.nio.file.Files;
  import java.nio.file.Path;
  import java.text.MessageFormat;
  import java.util.*;
  import static jdk.incubator.jpackage.internal.MacAppImageBuilder.ICON_ICNS;
<span class="line-added">+ import static jdk.incubator.jpackage.internal.MacAppImageBuilder.MAC_CF_BUNDLE_IDENTIFIER;</span>
  import static jdk.incubator.jpackage.internal.OverridableResource.createResource;
  
  import static jdk.incubator.jpackage.internal.StandardBundlerParam.*;
  
  public class MacDmgBundler extends MacBaseInstallerBundler {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 114,12 ***</span>
          data.put(&quot;DEPLOY_VOLUME_URL&quot;, volumeUrl);
          data.put(&quot;DEPLOY_BG_FILE&quot;, bgFile.toString());
          data.put(&quot;DEPLOY_VOLUME_PATH&quot;, volumePath.toString());
          data.put(&quot;DEPLOY_APPLICATION_NAME&quot;, APP_NAME.fetchFrom(params));
  
<span class="line-modified">!         data.put(&quot;DEPLOY_INSTALL_LOCATION&quot;, &quot;(path to applications folder)&quot;);</span>
<span class="line-modified">!         data.put(&quot;DEPLOY_INSTALL_NAME&quot;, &quot;Applications&quot;);</span>
  
          createResource(DEFAULT_DMG_SETUP_SCRIPT, params)
                  .setCategory(I18N.getString(&quot;resource.dmg-setup-script&quot;))
                  .setSubstitutionData(data)
                  .saveToFile(dmgSetup);
<span class="line-new-header">--- 115,12 ---</span>
          data.put(&quot;DEPLOY_VOLUME_URL&quot;, volumeUrl);
          data.put(&quot;DEPLOY_BG_FILE&quot;, bgFile.toString());
          data.put(&quot;DEPLOY_VOLUME_PATH&quot;, volumePath.toString());
          data.put(&quot;DEPLOY_APPLICATION_NAME&quot;, APP_NAME.fetchFrom(params));
  
<span class="line-modified">!         data.put(&quot;DEPLOY_INSTALL_LOCATION&quot;, MAC_INSTALL_DIR.fetchFrom(params));</span>
<span class="line-modified">!         data.put(&quot;DEPLOY_INSTALL_NAME&quot;, MAC_INSTALL_DIR.fetchFrom(params));</span>
  
          createResource(DEFAULT_DMG_SETUP_SCRIPT, params)
                  .setCategory(I18N.getString(&quot;resource.dmg-setup-script&quot;))
                  .setSubstitutionData(data)
                  .saveToFile(dmgSetup);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 307,23 ***</span>
                  &quot;-mountroot&quot;, imagesRoot.getAbsolutePath());
          IOUtils.exec(pb, false, null, true);
  
          File mountedRoot = new File(imagesRoot.getAbsolutePath(),
                      APP_NAME.fetchFrom(params));
<span class="line-removed">- </span>
          try {
<span class="line-removed">-             // volume icon</span>
<span class="line-removed">-             File volumeIconFile = new File(mountedRoot, &quot;.VolumeIcon.icns&quot;);</span>
<span class="line-removed">-             IOUtils.copyFile(getConfig_VolumeIcon(params),</span>
<span class="line-removed">-                     volumeIconFile);</span>
<span class="line-removed">- </span>
              // background image
              File bgdir = new File(mountedRoot, BACKGROUND_IMAGE_FOLDER);
              bgdir.mkdirs();
              IOUtils.copyFile(getConfig_VolumeBackground(params),
                      new File(bgdir, BACKGROUND_IMAGE));
  
              // Indicate that we want a custom icon
              // NB: attributes of the root directory are ignored
              // when creating the volume
              // Therefore we have to do this after we mount image
              String setFileUtility = findSetFileUtility();
<span class="line-new-header">--- 308,33 ---</span>
                  &quot;-mountroot&quot;, imagesRoot.getAbsolutePath());
          IOUtils.exec(pb, false, null, true);
  
          File mountedRoot = new File(imagesRoot.getAbsolutePath(),
                      APP_NAME.fetchFrom(params));
          try {
              // background image
              File bgdir = new File(mountedRoot, BACKGROUND_IMAGE_FOLDER);
              bgdir.mkdirs();
              IOUtils.copyFile(getConfig_VolumeBackground(params),
                      new File(bgdir, BACKGROUND_IMAGE));
  
<span class="line-added">+             // We will not consider setting background image and creating link</span>
<span class="line-added">+             // to install-dir in DMG as critical error, since it can fail in</span>
<span class="line-added">+             // headless enviroment.</span>
<span class="line-added">+             try {</span>
<span class="line-added">+                 pb = new ProcessBuilder(&quot;osascript&quot;,</span>
<span class="line-added">+                         getConfig_VolumeScript(params).getAbsolutePath());</span>
<span class="line-added">+                 IOUtils.exec(pb);</span>
<span class="line-added">+             } catch (IOException ex) {</span>
<span class="line-added">+                 Log.verbose(ex);</span>
<span class="line-added">+             }</span>
<span class="line-added">+ </span>
<span class="line-added">+             // volume icon</span>
<span class="line-added">+             File volumeIconFile = new File(mountedRoot, &quot;.VolumeIcon.icns&quot;);</span>
<span class="line-added">+             IOUtils.copyFile(getConfig_VolumeIcon(params),</span>
<span class="line-added">+                     volumeIconFile);</span>
<span class="line-added">+ </span>
              // Indicate that we want a custom icon
              // NB: attributes of the root directory are ignored
              // when creating the volume
              // Therefore we have to do this after we mount image
              String setFileUtility = findSetFileUtility();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 353,20 ***</span>
                  }
              } else {
                  Log.verbose(I18N.getString(&quot;message.setfile.dmg&quot;));
              }
  
<span class="line-removed">-             // We will not consider setting background image and creating link to</span>
<span class="line-removed">-             // /Application folder in DMG as critical error, since it can fail in</span>
<span class="line-removed">-             // headless enviroment.</span>
<span class="line-removed">-             try {</span>
<span class="line-removed">-                 pb = new ProcessBuilder(&quot;osascript&quot;,</span>
<span class="line-removed">-                         getConfig_VolumeScript(params).getAbsolutePath());</span>
<span class="line-removed">-                 IOUtils.exec(pb);</span>
<span class="line-removed">-             } catch (IOException ex) {</span>
<span class="line-removed">-                 Log.verbose(ex);</span>
<span class="line-removed">-             }</span>
          } finally {
              // Detach the temporary image
              pb = new ProcessBuilder(
                      hdiutil,
                      &quot;detach&quot;,
<span class="line-new-header">--- 364,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 490,7 ***</span>
  
      @Override
      public boolean isDefault() {
          return true;
      }
<span class="line-removed">- </span>
  }
<span class="line-new-header">--- 491,6 ---</span>
</pre>
<center><a href="MacBaseInstallerBundler.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MacPkgBundler.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>