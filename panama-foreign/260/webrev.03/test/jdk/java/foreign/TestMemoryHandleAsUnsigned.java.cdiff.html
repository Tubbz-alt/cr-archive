<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/jdk/java/foreign/TestMemoryHandleAsUnsigned.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="TestMemoryCopy.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TestMismatch.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/foreign/TestMemoryHandleAsUnsigned.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 57,14 ***</span>
          MemoryLayout layout = MemoryLayouts.BITS_8_BE;
          VarHandle byteHandle = layout.varHandle(byte.class);
          VarHandle intHandle = MemoryHandles.asUnsigned(byteHandle, int.class);
  
          try (MemorySegment segment = MemorySegment.allocateNative(layout)) {
<span class="line-modified">!             intHandle.set(segment.address(), intValue);</span>
              int expectedIntValue = Byte.toUnsignedInt(byteValue);
<span class="line-modified">!             assertEquals((int) intHandle.get(segment.address()), expectedIntValue);</span>
<span class="line-modified">!             assertEquals((byte) byteHandle.get(segment.address()), byteValue);</span>
          }
      }
  
      @DataProvider(name = &quot;unsignedLongToByteData&quot;)
      public Object[][] unsignedLongToByteData() {
<span class="line-new-header">--- 57,14 ---</span>
          MemoryLayout layout = MemoryLayouts.BITS_8_BE;
          VarHandle byteHandle = layout.varHandle(byte.class);
          VarHandle intHandle = MemoryHandles.asUnsigned(byteHandle, int.class);
  
          try (MemorySegment segment = MemorySegment.allocateNative(layout)) {
<span class="line-modified">!             intHandle.set(segment, intValue);</span>
              int expectedIntValue = Byte.toUnsignedInt(byteValue);
<span class="line-modified">!             assertEquals((int) intHandle.get(segment), expectedIntValue);</span>
<span class="line-modified">!             assertEquals((byte) byteHandle.get(segment), byteValue);</span>
          }
      }
  
      @DataProvider(name = &quot;unsignedLongToByteData&quot;)
      public Object[][] unsignedLongToByteData() {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 79,14 ***</span>
          MemoryLayout layout = MemoryLayouts.BITS_8_BE;
          VarHandle byteHandle = layout.varHandle(byte.class);
          VarHandle longHandle = MemoryHandles.asUnsigned(byteHandle, long.class);
  
          try (MemorySegment segment = MemorySegment.allocateNative(layout)) {
<span class="line-modified">!             longHandle.set(segment.address(), longValue);</span>
              long expectedLongValue = Byte.toUnsignedLong(byteValue);
<span class="line-modified">!             assertEquals((long) longHandle.get(segment.address()), expectedLongValue);</span>
<span class="line-modified">!             assertEquals((byte) byteHandle.get(segment.address()), byteValue);</span>
          }
      }
  
      @DataProvider(name = &quot;unsignedIntToShortData&quot;)
      public Object[][] unsignedIntToShortData() {
<span class="line-new-header">--- 79,14 ---</span>
          MemoryLayout layout = MemoryLayouts.BITS_8_BE;
          VarHandle byteHandle = layout.varHandle(byte.class);
          VarHandle longHandle = MemoryHandles.asUnsigned(byteHandle, long.class);
  
          try (MemorySegment segment = MemorySegment.allocateNative(layout)) {
<span class="line-modified">!             longHandle.set(segment, longValue);</span>
              long expectedLongValue = Byte.toUnsignedLong(byteValue);
<span class="line-modified">!             assertEquals((long) longHandle.get(segment), expectedLongValue);</span>
<span class="line-modified">!             assertEquals((byte) byteHandle.get(segment), byteValue);</span>
          }
      }
  
      @DataProvider(name = &quot;unsignedIntToShortData&quot;)
      public Object[][] unsignedIntToShortData() {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 101,14 ***</span>
          MemoryLayout layout = MemoryLayouts.BITS_16_BE;
          VarHandle shortHandle = layout.varHandle(short.class);
          VarHandle intHandle = MemoryHandles.asUnsigned(shortHandle, int.class);
  
          try (MemorySegment segment = MemorySegment.allocateNative(layout)) {
<span class="line-modified">!             intHandle.set(segment.address(), intValue);</span>
              int expectedIntValue = Short.toUnsignedInt(shortValue);
<span class="line-modified">!             assertEquals((int) intHandle.get(segment.address()), expectedIntValue);</span>
<span class="line-modified">!             assertEquals((short) shortHandle.get(segment.address()), shortValue);</span>
          }
      }
  
      @DataProvider(name = &quot;unsignedLongToShortData&quot;)
      public Object[][] unsignedLongToShortData() {
<span class="line-new-header">--- 101,14 ---</span>
          MemoryLayout layout = MemoryLayouts.BITS_16_BE;
          VarHandle shortHandle = layout.varHandle(short.class);
          VarHandle intHandle = MemoryHandles.asUnsigned(shortHandle, int.class);
  
          try (MemorySegment segment = MemorySegment.allocateNative(layout)) {
<span class="line-modified">!             intHandle.set(segment, intValue);</span>
              int expectedIntValue = Short.toUnsignedInt(shortValue);
<span class="line-modified">!             assertEquals((int) intHandle.get(segment), expectedIntValue);</span>
<span class="line-modified">!             assertEquals((short) shortHandle.get(segment), shortValue);</span>
          }
      }
  
      @DataProvider(name = &quot;unsignedLongToShortData&quot;)
      public Object[][] unsignedLongToShortData() {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 123,14 ***</span>
          MemoryLayout layout = MemoryLayouts.BITS_16_BE;
          VarHandle shortHandle = layout.varHandle(short.class);
          VarHandle longHandle = MemoryHandles.asUnsigned(shortHandle, long.class);
  
          try (MemorySegment segment = MemorySegment.allocateNative(layout)) {
<span class="line-modified">!             longHandle.set(segment.address(), longValue);</span>
              long expectedLongValue = Short.toUnsignedLong(shortValue);
<span class="line-modified">!             assertEquals((long) longHandle.get(segment.address()), expectedLongValue);</span>
<span class="line-modified">!             assertEquals((short) shortHandle.get(segment.address()), shortValue);</span>
          }
      }
  
      @DataProvider(name = &quot;unsignedLongToIntData&quot;)
      public Object[][] unsignedLongToIntData() {
<span class="line-new-header">--- 123,14 ---</span>
          MemoryLayout layout = MemoryLayouts.BITS_16_BE;
          VarHandle shortHandle = layout.varHandle(short.class);
          VarHandle longHandle = MemoryHandles.asUnsigned(shortHandle, long.class);
  
          try (MemorySegment segment = MemorySegment.allocateNative(layout)) {
<span class="line-modified">!             longHandle.set(segment, longValue);</span>
              long expectedLongValue = Short.toUnsignedLong(shortValue);
<span class="line-modified">!             assertEquals((long) longHandle.get(segment), expectedLongValue);</span>
<span class="line-modified">!             assertEquals((short) shortHandle.get(segment), shortValue);</span>
          }
      }
  
      @DataProvider(name = &quot;unsignedLongToIntData&quot;)
      public Object[][] unsignedLongToIntData() {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 149,48 ***</span>
          MemoryLayout layout = MemoryLayouts.BITS_32_BE;
          VarHandle intHandle = layout.varHandle(int.class);
          VarHandle longHandle = MemoryHandles.asUnsigned(intHandle, long.class);
  
          try (MemorySegment segment = MemorySegment.allocateNative(layout)) {
<span class="line-modified">!             longHandle.set(segment.address(), longValue);</span>
              long expectedLongValue = Integer.toUnsignedLong(intValue);
<span class="line-modified">!             assertEquals((long) longHandle.get(segment.address()), expectedLongValue);</span>
<span class="line-modified">!             assertEquals((int) intHandle.get(segment.address()), intValue);</span>
          }
      }
  
      @Test
      public void testCoordinatesSequenceLayout() {
          MemoryLayout layout = MemoryLayout.ofSequence(2, MemoryLayouts.BITS_8_BE);
          VarHandle byteHandle = layout.varHandle(byte.class, PathElement.sequenceElement());
          VarHandle intHandle = MemoryHandles.asUnsigned(byteHandle, int.class);
  
          try (MemorySegment segment = MemorySegment.allocateNative(layout)) {
<span class="line-modified">!             intHandle.set(segment.address(), 0L, (int) -1);</span>
<span class="line-modified">!             assertEquals((int) intHandle.get(segment.address(), 0L), 255);</span>
<span class="line-modified">!             intHandle.set(segment.address(), 1L, (int) 200);</span>
<span class="line-modified">!             assertEquals((int) intHandle.get(segment.address(), 1L), 200);</span>
          }
      }
  
      @Test
      public void testCoordinatesStride() {
          byte[] arr = { 0, 0, (byte) 129, 0 };
          MemorySegment segment = MemorySegment.ofArray(arr);
<span class="line-removed">-         MemoryAddress addr = segment.address();</span>
  
          {
<span class="line-modified">!             VarHandle byteHandle = MemoryHandles.varHandle(byte.class, ByteOrder.nativeOrder());</span>
              VarHandle intHandle = MemoryHandles.asUnsigned(byteHandle, int.class);
<span class="line-modified">!             VarHandle strideHandle = MemoryHandles.withStride(intHandle, 1);</span>
<span class="line-removed">-             assertEquals((int) strideHandle.get(addr, 2L), 129);</span>
          }
          {
<span class="line-modified">!             VarHandle byteHandle = MemoryHandles.varHandle(byte.class, ByteOrder.nativeOrder());</span>
<span class="line-modified">!             VarHandle strideHandle = MemoryHandles.withStride(byteHandle, 1);</span>
<span class="line-modified">!             VarHandle intHandle = MemoryHandles.asUnsigned(strideHandle, int.class);</span>
<span class="line-modified">!             assertEquals((int) intHandle.get(addr, 2L), 129);</span>
          }
      }
  
      static final Class&lt;NullPointerException&gt; NPE = NullPointerException.class;
  
<span class="line-new-header">--- 149,47 ---</span>
          MemoryLayout layout = MemoryLayouts.BITS_32_BE;
          VarHandle intHandle = layout.varHandle(int.class);
          VarHandle longHandle = MemoryHandles.asUnsigned(intHandle, long.class);
  
          try (MemorySegment segment = MemorySegment.allocateNative(layout)) {
<span class="line-modified">!             longHandle.set(segment, longValue);</span>
              long expectedLongValue = Integer.toUnsignedLong(intValue);
<span class="line-modified">!             assertEquals((long) longHandle.get(segment), expectedLongValue);</span>
<span class="line-modified">!             assertEquals((int) intHandle.get(segment), intValue);</span>
          }
      }
  
      @Test
      public void testCoordinatesSequenceLayout() {
          MemoryLayout layout = MemoryLayout.ofSequence(2, MemoryLayouts.BITS_8_BE);
          VarHandle byteHandle = layout.varHandle(byte.class, PathElement.sequenceElement());
          VarHandle intHandle = MemoryHandles.asUnsigned(byteHandle, int.class);
  
          try (MemorySegment segment = MemorySegment.allocateNative(layout)) {
<span class="line-modified">!             intHandle.set(segment, 0L, (int) -1);</span>
<span class="line-modified">!             assertEquals((int) intHandle.get(segment, 0L), 255);</span>
<span class="line-modified">!             intHandle.set(segment, 1L, (int) 200);</span>
<span class="line-modified">!             assertEquals((int) intHandle.get(segment, 1L), 200);</span>
          }
      }
  
      @Test
      public void testCoordinatesStride() {
          byte[] arr = { 0, 0, (byte) 129, 0 };
          MemorySegment segment = MemorySegment.ofArray(arr);
  
          {
<span class="line-modified">!             VarHandle byteHandle = MemoryLayout.ofSequence(MemoryLayouts.JAVA_BYTE)</span>
<span class="line-added">+                     .varHandle(byte.class, PathElement.sequenceElement());</span>
              VarHandle intHandle = MemoryHandles.asUnsigned(byteHandle, int.class);
<span class="line-modified">!             assertEquals((int) intHandle.get(segment, 2L), 129);</span>
          }
          {
<span class="line-modified">!             VarHandle byteHandle = MemoryLayout.ofSequence(MemoryLayouts.JAVA_BYTE)</span>
<span class="line-modified">!                     .varHandle(byte.class, PathElement.sequenceElement());</span>
<span class="line-modified">!             VarHandle intHandle = MemoryHandles.asUnsigned(byteHandle, int.class);</span>
<span class="line-modified">!             assertEquals((int) intHandle.get(segment, 2L), 129);</span>
          }
      }
  
      static final Class&lt;NullPointerException&gt; NPE = NullPointerException.class;
  
</pre>
<center><a href="TestMemoryCopy.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TestMismatch.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>