<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.incubator.foreign/share/classes/jdk/incubator/foreign/FunctionDescriptor.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="CSupport.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>src/jdk.incubator.foreign/share/classes/jdk/incubator/foreign/FunctionDescriptor.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 27 import java.lang.constant.ConstantDescs;
 28 import java.lang.constant.DynamicConstantDesc;
 29 import java.util.ArrayList;
 30 import java.util.Arrays;
 31 import java.util.Collections;
 32 import java.util.HashMap;
 33 import java.util.List;
 34 import java.util.Map;
 35 import java.util.Objects;
 36 import java.util.Optional;
 37 import java.util.stream.Collectors;
 38 import java.util.stream.Stream;
 39 
 40 /**
 41  * A function descriptor is made up of zero or more argument layouts and one return  A function descriptor
 42  * is used to model the signature of native functions.
 43  */
 44 public final class FunctionDescriptor implements Constable {
 45 
 46     /**
<span class="line-modified"> 47      * The name of the function descriptor attribute (see {@link #attributes()} used to mark variadic parameters. The</span>
 48      * attribute value must be a boolean.
 49      */
 50     public static final String TRIVIAL_ATTRIBUTE_NAME = &quot;abi/trivial&quot;;
 51     
 52     private final MemoryLayout resLayout;
 53     private final MemoryLayout[] argLayouts;
 54     private final Map&lt;String, Constable&gt; attributes;
 55 
 56     private FunctionDescriptor(MemoryLayout resLayout, Map&lt;String, Constable&gt; attributes, MemoryLayout... argLayouts) {
 57         this.resLayout = resLayout;
 58         this.attributes = Collections.unmodifiableMap(attributes);
 59         this.argLayouts = argLayouts;
 60     }
 61 
 62     /**
 63      * Returns the attribute with the given name (if it exists).
 64      *
 65      * @param name the attribute name
 66      * @return the attribute with the given name (if it exists).
 67      */
</pre>
<hr />
<pre>
187      */
188     @Override
189     public int hashCode() {
190         int hashCode = Arrays.hashCode(argLayouts);
191         return resLayout == null ? hashCode : resLayout.hashCode() ^ hashCode;
192     }
193 
194     @Override
195     public Optional&lt;DynamicConstantDesc&lt;FunctionDescriptor&gt;&gt; describeConstable() {
196         List&lt;ConstantDesc&gt; constants = new ArrayList&lt;&gt;();
197         constants.add(resLayout == null ? AbstractLayout.MH_VOID_FUNCTION : AbstractLayout.MH_FUNCTION);
198         if (resLayout != null) {
199             constants.add(resLayout.describeConstable().get());
200         }
201         for (MemoryLayout argLayout : argLayouts) {
202             constants.add(argLayout.describeConstable().get());
203         }
204         return Optional.of(DynamicConstantDesc.ofNamed(
205                     ConstantDescs.BSM_INVOKE, &quot;function&quot;, AbstractLayout.CD_FUNCTION_DESC, constants.toArray(new ConstantDesc[0])));
206     }
<span class="line-modified">207 }</span>
</pre>
</td>
<td>
<hr />
<pre>
 27 import java.lang.constant.ConstantDescs;
 28 import java.lang.constant.DynamicConstantDesc;
 29 import java.util.ArrayList;
 30 import java.util.Arrays;
 31 import java.util.Collections;
 32 import java.util.HashMap;
 33 import java.util.List;
 34 import java.util.Map;
 35 import java.util.Objects;
 36 import java.util.Optional;
 37 import java.util.stream.Collectors;
 38 import java.util.stream.Stream;
 39 
 40 /**
 41  * A function descriptor is made up of zero or more argument layouts and one return  A function descriptor
 42  * is used to model the signature of native functions.
 43  */
 44 public final class FunctionDescriptor implements Constable {
 45 
 46     /**
<span class="line-modified"> 47      * The name of the function descriptor attribute (see {@link #attributes()} used to mark trivial functions. The</span>
 48      * attribute value must be a boolean.
 49      */
 50     public static final String TRIVIAL_ATTRIBUTE_NAME = &quot;abi/trivial&quot;;
 51     
 52     private final MemoryLayout resLayout;
 53     private final MemoryLayout[] argLayouts;
 54     private final Map&lt;String, Constable&gt; attributes;
 55 
 56     private FunctionDescriptor(MemoryLayout resLayout, Map&lt;String, Constable&gt; attributes, MemoryLayout... argLayouts) {
 57         this.resLayout = resLayout;
 58         this.attributes = Collections.unmodifiableMap(attributes);
 59         this.argLayouts = argLayouts;
 60     }
 61 
 62     /**
 63      * Returns the attribute with the given name (if it exists).
 64      *
 65      * @param name the attribute name
 66      * @return the attribute with the given name (if it exists).
 67      */
</pre>
<hr />
<pre>
187      */
188     @Override
189     public int hashCode() {
190         int hashCode = Arrays.hashCode(argLayouts);
191         return resLayout == null ? hashCode : resLayout.hashCode() ^ hashCode;
192     }
193 
194     @Override
195     public Optional&lt;DynamicConstantDesc&lt;FunctionDescriptor&gt;&gt; describeConstable() {
196         List&lt;ConstantDesc&gt; constants = new ArrayList&lt;&gt;();
197         constants.add(resLayout == null ? AbstractLayout.MH_VOID_FUNCTION : AbstractLayout.MH_FUNCTION);
198         if (resLayout != null) {
199             constants.add(resLayout.describeConstable().get());
200         }
201         for (MemoryLayout argLayout : argLayouts) {
202             constants.add(argLayout.describeConstable().get());
203         }
204         return Optional.of(DynamicConstantDesc.ofNamed(
205                     ConstantDescs.BSM_INVOKE, &quot;function&quot;, AbstractLayout.CD_FUNCTION_DESC, constants.toArray(new ConstantDesc[0])));
206     }
<span class="line-modified">207 }</span>
</pre>
</td>
</tr>
</table>
<center><a href="CSupport.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>