<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.incubator.foreign/share/classes/jdk/internal/foreign/MemorySegmentImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../incubator/foreign/MemorySegment.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/jdk/java/foreign/TestMemoryAccess.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.incubator.foreign/share/classes/jdk/internal/foreign/MemorySegmentImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
138             }
139             _bb = nioAccess.newHeapByteBuffer((byte[]) base(), (int)min - BYTE_ARR_BASE, (int) length, this);
140         } else {
141             _bb = nioAccess.newDirectByteBuffer(min, (int) length, null, this);
142         }
143         if (!isSet(WRITE)) {
144             //scope is IMMUTABLE - obtain a RO byte buffer
145             _bb = _bb.asReadOnlyBuffer();
146         }
147         return _bb;
148     }
149 
150     @Override
151     public MemorySegment withAccessModes(int accessModes) {
152         if ((~this.mask &amp; accessModes) != 0) {
153             throw new UnsupportedOperationException(&quot;Cannot acquire more access modes&quot;);
154         }
155         return new MemorySegmentImpl(min, base, length, accessModes, owner, scope);
156     }
157 





158     @Override
159     public int accessModes() {
160         return mask;
161     }
162 
163     @Override
164     public byte[] toByteArray() {
165         checkIntSize(&quot;byte[]&quot;);
166         byte[] arr = new byte[(int)length];
167         MemorySegment arrSegment = MemorySegment.ofArray(arr);
168         MemoryAddress.copy(this.baseAddress(), arrSegment.baseAddress(), length);
169         return arr;
170     }
171 
172     // MemorySegmentProxy methods
173 
174     @Override
175     public final void checkValidState() {
176         if (owner != Thread.currentThread()) {
177             throw new IllegalStateException(&quot;Attempt to access segment outside owning thread&quot;);
</pre>
</td>
<td>
<hr />
<pre>
138             }
139             _bb = nioAccess.newHeapByteBuffer((byte[]) base(), (int)min - BYTE_ARR_BASE, (int) length, this);
140         } else {
141             _bb = nioAccess.newDirectByteBuffer(min, (int) length, null, this);
142         }
143         if (!isSet(WRITE)) {
144             //scope is IMMUTABLE - obtain a RO byte buffer
145             _bb = _bb.asReadOnlyBuffer();
146         }
147         return _bb;
148     }
149 
150     @Override
151     public MemorySegment withAccessModes(int accessModes) {
152         if ((~this.mask &amp; accessModes) != 0) {
153             throw new UnsupportedOperationException(&quot;Cannot acquire more access modes&quot;);
154         }
155         return new MemorySegmentImpl(min, base, length, accessModes, owner, scope);
156     }
157 
<span class="line-added">158     @Override</span>
<span class="line-added">159     public boolean hasAccessModes(int accessModes) {</span>
<span class="line-added">160         return (this.mask &amp; accessModes) == accessModes;</span>
<span class="line-added">161     }</span>
<span class="line-added">162 </span>
163     @Override
164     public int accessModes() {
165         return mask;
166     }
167 
168     @Override
169     public byte[] toByteArray() {
170         checkIntSize(&quot;byte[]&quot;);
171         byte[] arr = new byte[(int)length];
172         MemorySegment arrSegment = MemorySegment.ofArray(arr);
173         MemoryAddress.copy(this.baseAddress(), arrSegment.baseAddress(), length);
174         return arr;
175     }
176 
177     // MemorySegmentProxy methods
178 
179     @Override
180     public final void checkValidState() {
181         if (owner != Thread.currentThread()) {
182             throw new IllegalStateException(&quot;Attempt to access segment outside owning thread&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="../../incubator/foreign/MemorySegment.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/jdk/java/foreign/TestMemoryAccess.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>