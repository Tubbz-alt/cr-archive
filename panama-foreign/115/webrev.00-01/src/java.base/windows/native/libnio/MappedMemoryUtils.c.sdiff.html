<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/windows/native/libnio/MappedMemoryUtils.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../../unix/native/libnio/MappedMemoryUtils.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../jdk.incubator.foreign/share/classes/jdk/incubator/foreign/MappedMemorySegment.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/windows/native/libnio/MappedMemoryUtils.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 33 JNIEXPORT jboolean JNICALL
 34 Java_java_nio_MappedMemoryUtils_isLoaded0(JNIEnv *env, jobject obj, jlong address,
 35                                          jlong len, jint numPages)
 36 {
 37     jboolean loaded = JNI_FALSE;
 38     /* Information not available?
 39     MEMORY_BASIC_INFORMATION info;
 40     void *a = (void *) jlong_to_ptr(address);
 41     int result = VirtualQuery(a, &amp;info, (DWORD)len);
 42     */
 43     return loaded;
 44 }
 45 
 46 JNIEXPORT void JNICALL
 47 Java_java_nio_MappedMemoryUtils_load0(JNIEnv *env, jobject obj, jlong address,
 48                                      jlong len)
 49 {
 50     // no madvise available
 51 }
 52 







 53 JNIEXPORT void JNICALL
 54 Java_java_nio_MappedMemoryUtils_force0(JNIEnv *env, jobject obj, jobject fdo,
 55                                       jlong address, jlong len)
 56 {
 57     void *a = (void *) jlong_to_ptr(address);
 58     BOOL result;
 59     int retry;
 60 
 61     /*
 62      * FlushViewOfFile can fail with ERROR_LOCK_VIOLATION if the memory
 63      * system is writing dirty pages to disk. As there is no way to
 64      * synchronize the flushing then we retry a limited number of times.
 65      */
 66     retry = 0;
 67     do {
 68         result = FlushViewOfFile(a, (DWORD)len);
 69         if ((result != 0) || (GetLastError() != ERROR_LOCK_VIOLATION))
 70             break;
 71         retry++;
 72     } while (retry &lt; 3);
</pre>
</td>
<td>
<hr />
<pre>
 33 JNIEXPORT jboolean JNICALL
 34 Java_java_nio_MappedMemoryUtils_isLoaded0(JNIEnv *env, jobject obj, jlong address,
 35                                          jlong len, jint numPages)
 36 {
 37     jboolean loaded = JNI_FALSE;
 38     /* Information not available?
 39     MEMORY_BASIC_INFORMATION info;
 40     void *a = (void *) jlong_to_ptr(address);
 41     int result = VirtualQuery(a, &amp;info, (DWORD)len);
 42     */
 43     return loaded;
 44 }
 45 
 46 JNIEXPORT void JNICALL
 47 Java_java_nio_MappedMemoryUtils_load0(JNIEnv *env, jobject obj, jlong address,
 48                                      jlong len)
 49 {
 50     // no madvise available
 51 }
 52 
<span class="line-added"> 53 JNIEXPORT void JNICALL</span>
<span class="line-added"> 54 Java_java_nio_MappedMemoryUtils_unload0(JNIEnv *env, jobject obj, jlong address,</span>
<span class="line-added"> 55                                      jlong len)</span>
<span class="line-added"> 56 {</span>
<span class="line-added"> 57     // no madvise available</span>
<span class="line-added"> 58 }</span>
<span class="line-added"> 59 </span>
 60 JNIEXPORT void JNICALL
 61 Java_java_nio_MappedMemoryUtils_force0(JNIEnv *env, jobject obj, jobject fdo,
 62                                       jlong address, jlong len)
 63 {
 64     void *a = (void *) jlong_to_ptr(address);
 65     BOOL result;
 66     int retry;
 67 
 68     /*
 69      * FlushViewOfFile can fail with ERROR_LOCK_VIOLATION if the memory
 70      * system is writing dirty pages to disk. As there is no way to
 71      * synchronize the flushing then we retry a limited number of times.
 72      */
 73     retry = 0;
 74     do {
 75         result = FlushViewOfFile(a, (DWORD)len);
 76         if ((result != 0) || (GetLastError() != ERROR_LOCK_VIOLATION))
 77             break;
 78         retry++;
 79     } while (retry &lt; 3);
</pre>
</td>
</tr>
</table>
<center><a href="../../../unix/native/libnio/MappedMemoryUtils.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../jdk.incubator.foreign/share/classes/jdk/incubator/foreign/MappedMemorySegment.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>