<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/foreign/TestNativeScope.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="TestNative.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TestRebase.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/foreign/TestNativeScope.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 94                     assertTrue(isBound);
 95                 }
 96             }
 97             // addresses should be invalid now
 98             for (MemoryAddress address : addressList) {
 99                 assertFalse(address.segment().isAlive());
100             }
101         }
102     }
103 
104     static final int SIZE_256M = 1024 * 1024 * 256;
105 
106     @Test
107     public void testBigAllocationInUnboundedScope() {
108         try (NativeScope scope = NativeScope.unboundedScope()) {
109             for (int i = 8 ; i &lt; SIZE_256M ; i *= 8) {
110                 MemoryAddress address = scope.allocate(i);
111                 //check size
112                 assertEquals(address.segment().byteSize(), i);
113                 //check alignment
<span class="line-modified">114                 assertTrue(address.segment().baseAddress().toRawLongValue() % i == 0);</span>
115             }
116         }
117     }
118 
119     @Test
120     public void testAttachClose() {
121         MemorySegment s1 = MemorySegment.ofArray(new byte[1]);
122         MemorySegment s2 = MemorySegment.ofArray(new byte[1]);
123         MemorySegment s3 = MemorySegment.ofArray(new byte[1]);
124         assertTrue(s1.isAlive());
125         assertTrue(s2.isAlive());
126         assertTrue(s3.isAlive());
127         try (NativeScope scope = NativeScope.boundedScope(10)) {
128             MemorySegment ss1 = scope.register(s1);
129             assertFalse(s1.isAlive());
130             assertTrue(ss1.isAlive());
131             s1 = ss1;
132             MemorySegment ss2 = scope.register(s2);
133             assertFalse(s2.isAlive());
134             assertTrue(ss2.isAlive());
</pre>
</td>
<td>
<hr />
<pre>
 94                     assertTrue(isBound);
 95                 }
 96             }
 97             // addresses should be invalid now
 98             for (MemoryAddress address : addressList) {
 99                 assertFalse(address.segment().isAlive());
100             }
101         }
102     }
103 
104     static final int SIZE_256M = 1024 * 1024 * 256;
105 
106     @Test
107     public void testBigAllocationInUnboundedScope() {
108         try (NativeScope scope = NativeScope.unboundedScope()) {
109             for (int i = 8 ; i &lt; SIZE_256M ; i *= 8) {
110                 MemoryAddress address = scope.allocate(i);
111                 //check size
112                 assertEquals(address.segment().byteSize(), i);
113                 //check alignment
<span class="line-modified">114                 assertTrue(address.segment().address().toRawLongValue() % i == 0);</span>
115             }
116         }
117     }
118 
119     @Test
120     public void testAttachClose() {
121         MemorySegment s1 = MemorySegment.ofArray(new byte[1]);
122         MemorySegment s2 = MemorySegment.ofArray(new byte[1]);
123         MemorySegment s3 = MemorySegment.ofArray(new byte[1]);
124         assertTrue(s1.isAlive());
125         assertTrue(s2.isAlive());
126         assertTrue(s3.isAlive());
127         try (NativeScope scope = NativeScope.boundedScope(10)) {
128             MemorySegment ss1 = scope.register(s1);
129             assertFalse(s1.isAlive());
130             assertTrue(ss1.isAlive());
131             s1 = ss1;
132             MemorySegment ss2 = scope.register(s2);
133             assertFalse(s2.isAlive());
134             assertTrue(ss2.isAlive());
</pre>
</td>
</tr>
</table>
<center><a href="TestNative.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TestRebase.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>