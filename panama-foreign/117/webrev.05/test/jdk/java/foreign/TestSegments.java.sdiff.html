<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/foreign/TestSegments.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../../../../src/jdk.incubator.foreign/share/classes/jdk/internal/foreign/MemoryScope.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TestSharedAccess.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/foreign/TestSegments.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
215     static Object[][] segmentMembers() {
216         List&lt;SegmentMember&gt; members = new ArrayList&lt;&gt;();
217         for (Method m : MemorySegment.class.getDeclaredMethods()) {
218             //skip statics and method declared in j.l.Object
219             if (m.getDeclaringClass().equals(Object.class) ||
220                     (m.getModifiers() &amp; Modifier.STATIC) != 0) continue;
221             Object[] args = Stream.of(m.getParameterTypes())
222                     .map(TestSegments::defaultValue)
223                     .toArray();
224             members.add(new SegmentMember(m, args));
225         }
226         return members.stream().map(ms -&gt; new Object[] { ms }).toArray(Object[][]::new);
227     }
228 
229     static class SegmentMember {
230         final Method method;
231         final Object[] params;
232 
233         final static List&lt;String&gt; CONFINED_NAMES = List.of(
234                 &quot;close&quot;,
<span class="line-modified">235                 &quot;toByteArray&quot;</span>

236         );
237 
238         public SegmentMember(Method method, Object[] params) {
239             this.method = method;
240             this.params = params;
241         }
242 
243         boolean isConfined() {
244             return CONFINED_NAMES.contains(method.getName());
245         }
246 
247         @Override
248         public String toString() {
249             return method.getName();
250         }
251     }
252 
253     static Object defaultValue(Class&lt;?&gt; c) {
254         if (c.isPrimitive()) {
255             if (c == char.class) {
</pre>
<hr />
<pre>
313                 }
314             }
315         },
316         CLOSE(MemorySegment.CLOSE) {
317             @Override
318             void run(MemorySegment segment) {
319                 segment.close();
320             }
321         },
322         READ(MemorySegment.READ) {
323             @Override
324             void run(MemorySegment segment) {
325                 INT_HANDLE.get(segment.baseAddress());
326             }
327         },
328         WRITE(MemorySegment.WRITE) {
329             @Override
330             void run(MemorySegment segment) {
331                 INT_HANDLE.set(segment.baseAddress(), 42);
332             }






333         };
334 
335         final int accessMode;
336 
337         static VarHandle INT_HANDLE = MemoryLayouts.JAVA_INT.varHandle(int.class);
338 
339         AccessActions(int accessMode) {
340             this.accessMode = accessMode;
341         }
342 
343         abstract void run(MemorySegment segment);
344     }
345 }
</pre>
</td>
<td>
<hr />
<pre>
215     static Object[][] segmentMembers() {
216         List&lt;SegmentMember&gt; members = new ArrayList&lt;&gt;();
217         for (Method m : MemorySegment.class.getDeclaredMethods()) {
218             //skip statics and method declared in j.l.Object
219             if (m.getDeclaringClass().equals(Object.class) ||
220                     (m.getModifiers() &amp; Modifier.STATIC) != 0) continue;
221             Object[] args = Stream.of(m.getParameterTypes())
222                     .map(TestSegments::defaultValue)
223                     .toArray();
224             members.add(new SegmentMember(m, args));
225         }
226         return members.stream().map(ms -&gt; new Object[] { ms }).toArray(Object[][]::new);
227     }
228 
229     static class SegmentMember {
230         final Method method;
231         final Object[] params;
232 
233         final static List&lt;String&gt; CONFINED_NAMES = List.of(
234                 &quot;close&quot;,
<span class="line-modified">235                 &quot;toByteArray&quot;,</span>
<span class="line-added">236                 &quot;withOwnerThread&quot;</span>
237         );
238 
239         public SegmentMember(Method method, Object[] params) {
240             this.method = method;
241             this.params = params;
242         }
243 
244         boolean isConfined() {
245             return CONFINED_NAMES.contains(method.getName());
246         }
247 
248         @Override
249         public String toString() {
250             return method.getName();
251         }
252     }
253 
254     static Object defaultValue(Class&lt;?&gt; c) {
255         if (c.isPrimitive()) {
256             if (c == char.class) {
</pre>
<hr />
<pre>
314                 }
315             }
316         },
317         CLOSE(MemorySegment.CLOSE) {
318             @Override
319             void run(MemorySegment segment) {
320                 segment.close();
321             }
322         },
323         READ(MemorySegment.READ) {
324             @Override
325             void run(MemorySegment segment) {
326                 INT_HANDLE.get(segment.baseAddress());
327             }
328         },
329         WRITE(MemorySegment.WRITE) {
330             @Override
331             void run(MemorySegment segment) {
332                 INT_HANDLE.set(segment.baseAddress(), 42);
333             }
<span class="line-added">334         },</span>
<span class="line-added">335         HANDOFF(MemorySegment.HANDOFF) {</span>
<span class="line-added">336             @Override</span>
<span class="line-added">337             void run(MemorySegment segment) {</span>
<span class="line-added">338                 segment.withOwnerThread(new Thread());</span>
<span class="line-added">339             }</span>
340         };
341 
342         final int accessMode;
343 
344         static VarHandle INT_HANDLE = MemoryLayouts.JAVA_INT.varHandle(int.class);
345 
346         AccessActions(int accessMode) {
347             this.accessMode = accessMode;
348         }
349 
350         abstract void run(MemorySegment segment);
351     }
352 }
</pre>
</td>
</tr>
</table>
<center><a href="../../../../src/jdk.incubator.foreign/share/classes/jdk/internal/foreign/MemoryScope.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TestSharedAccess.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>