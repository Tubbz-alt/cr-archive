<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff doc/panama_jextract.md</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="panama_jextract.html.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="../src/jdk.incubator.jextract/share/classes/jdk/incubator/jextract/tool/HeaderBuilder.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>doc/panama_jextract.md</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 69         helloworld();
 70     }
 71 }
 72 
 73 ```
 74 
 75 ### Running the Java code that invokes helloworld
 76 
 77 ```sh
 78 
 79 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign HelloWorld.java
 80 
 81 ```
 82 
 83 ## Embedding Python interpreter in your Java program (Mac OS)
 84 
 85 ### jextract Python.h
 86 
 87 ```sh
 88 
<span class="line-modified"> 89 jextract -l python2.7 \</span>

 90   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
 91   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/python2.7/ \
 92   -t org.python \
 93    /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/python2.7/Python.h
 94 
 95 ```
 96 
 97 ### Java program that uses extracted Python interface
 98 
 99 ```java
100 
<span class="line-modified">101 import org.python.Cstring;</span>

102 import static jdk.incubator.foreign.MemoryAddress.NULL;
103 // import jextracted python &#39;header&#39; class
104 import static org.python.RuntimeHelper.*;
105 import static org.python.Python_h.*;
106 
107 public class PythonMain {
108     public static void main(String[] args) {
109         String script = &quot;print(sum([33, 55, 66])); print(&#39;Hello from Python!&#39;)\n&quot;;
110 
111         Py_Initialize();
<span class="line-modified">112         try (var s = Cstring.toCString(script)) {</span>
113             var str = s.baseAddress();
114             PyRun_SimpleStringFlags(str, NULL);
115             Py_Finalize();
116         }
117     }
118 }
119 
120 ```
121 
122 ### Running the Java code that calls Python interpreter
123 
124 ```sh
125 
126 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
127     -Djava.library.path=/System/Library/Frameworks/Python.framework/Versions/2.7/lib \
128     PythonMain.java
129 
130 ```
131 
132 ## Using readline library from Java code (Mac OS)
133 
134 ### jextract readline.h
135 
136 ```sh
137 
<span class="line-modified">138 jextract -l readline -t org.unix \</span>

139   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
140    /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/readline/readline.h
141 
<span class="line-removed">142 </span>
143 ```
144 
145 ### Java code that uses readline
146 
147 ```java
148 
<span class="line-removed">149 import org.unix.Cstring;</span>
150 import static org.unix.RuntimeHelper.*;
151 import static org.unix.readline_h.*;

152 
153 public class Readline {
154     public static void main(String[] args) {
<span class="line-modified">155         try (var s = Cstring.toCString(&quot;name? &quot;)) {</span>
156             var pstr = s.baseAddress();
157             // call &quot;readline&quot; API
158             var p = readline(pstr);
159 
160             // print char* as is
161             System.out.println(p);
162             // convert char* ptr from readline as Java String &amp; print it
<span class="line-modified">163             System.out.println(&quot;Hello, &quot; + Cstring.toJavaStringRestricted(p));</span>
164         }
165     }
166 }
167 
168 ```
169 
170 ### Running the java code that uses readline
171 
172 ```
173 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
174     -Djava.library.path=/usr/local/opt/readline/lib/ Readline.java
175 
176 ```
177 
178 ## Using libcurl from Java (Mac OS)
179 
180 ### jextract curl.h
181 
182 ```sh
183 
<span class="line-modified">184 jextract -t org.unix -lcurl \</span>
185   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/ \
186   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/curl/ \
187   /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/curl/curl.h
188 
189 ```
190 
191 ### Java code that uses libcurl
192 
193 ```java
194 
<span class="line-modified">195 import org.unix.Cstring;</span>
196 import static jdk.incubator.foreign.MemoryAddress.NULL;
197 import static org.unix.RuntimeHelper.*;
198 import static org.unix.curl_h.*;

199 
200 public class CurlMain {
201    public static void main(String[] args) {
202        var urlStr = args[0];
203        curl_global_init(CURL_GLOBAL_DEFAULT());
204        var curl = curl_easy_init();
205        if(!curl.equals(NULL)) {
<span class="line-modified">206            try (var s = Cstring.toCString(urlStr)) {</span>
207                var url = s.baseAddress();
208                curl_easy_setopt(curl, CURLOPT_URL(), url);
209                int res = curl_easy_perform(curl);
210                if (res != CURLE_OK()) {
211                    curl_easy_cleanup(curl);
212                }
213            }
214        }
215        curl_global_cleanup();
216    }
217 }
218 
219 ```
220 
221 ### Running the java code that uses libcurl
222 
223 ```sh
224 
225 # run this shell script by passing a URL as first argument
226 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
</pre>
<hr />
<pre>
247 ```
248 
249 It installs include and lib directories under /usr/local/opt/openblas
250 
251 ### jextracting cblas.h (MacOS)
252 
253 The following command can be used to extract cblas.h on MacOs
254 
255 ```sh
256 
257 jextract -C &quot;-D FORCE_OPENBLAS_COMPLEX_STRUCT&quot; \
258   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
259   -l openblas -t blas /usr/local/opt/openblas/include/cblas.h
260 
261 ```
262 
263 ### Java sample code that uses cblas library
264 
265 ```java
266 


267 import jdk.incubator.foreign.NativeScope;
268 import blas.*;
269 import static blas.RuntimeHelper.*;
270 import static blas.cblas_h.*;

271 
272 public class TestBlas {




273     public static void main(String[] args) {
274         int Layout;
275         int transa;
276 
277         double alpha, beta;
278         int m, n, lda, incx, incy, i;
279 
280         Layout = CblasColMajor();
281         transa = CblasNoTrans();
282 
283         m = 4; /* Size of Column ( the number of rows ) */
284         n = 4; /* Size of Row ( the number of columns ) */
285         lda = 4; /* Leading dimension of 5 * 4 matrix is 5 */
286         incx = 1;
287         incy = 1;
288         alpha = 1;
289         beta = 0;
290 
291         try (var scope = NativeScope.unboundedScope()) {
<span class="line-modified">292             var a = Cdouble.allocateArray(m*n, scope);</span>
<span class="line-modified">293             var x = Cdouble.allocateArray(n, scope);</span>
<span class="line-modified">294             var y = Cdouble.allocateArray(n, scope);</span>
<span class="line-modified">295 </span>
<span class="line-modified">296             /* The elements of the first column */</span>
<span class="line-modified">297             Cdouble.set(a, 0, 1.0);</span>
<span class="line-modified">298             Cdouble.set(a, 1, 2.0);</span>
<span class="line-modified">299             Cdouble.set(a, 2, 3.0);</span>
<span class="line-modified">300             Cdouble.set(a, 3, 4.0);</span>
<span class="line-modified">301             /* The elements of the second column */</span>
<span class="line-removed">302             Cdouble.set(a, m, 1.0);</span>
<span class="line-removed">303             Cdouble.set(a, m + 1, 1.0);</span>
<span class="line-removed">304             Cdouble.set(a, m + 2, 1.0);</span>
<span class="line-removed">305             Cdouble.set(a, m + 3, 1.0);</span>
<span class="line-removed">306             /* The elements of the third column */</span>
<span class="line-removed">307             Cdouble.set(a, m*2, 3.0);</span>
<span class="line-removed">308             Cdouble.set(a, m*2 + 1, 4.0);</span>
<span class="line-removed">309             Cdouble.set(a, m*2 + 2, 5.0);</span>
<span class="line-removed">310             Cdouble.set(a, m*2 + 3, 6.0);</span>
<span class="line-removed">311             /* The elements of the fourth column */</span>
<span class="line-removed">312             Cdouble.set(a, m*3, 5.0);</span>
<span class="line-removed">313             Cdouble.set(a, m*3 + 1, 6.0);</span>
<span class="line-removed">314             Cdouble.set(a, m*3 + 2, 7.0);</span>
<span class="line-removed">315             Cdouble.set(a, m*3 + 3, 8.0);</span>
<span class="line-removed">316             /* The elemetns of x and y */</span>
<span class="line-removed">317             Cdouble.set(x, 0, 1.0);</span>
<span class="line-removed">318             Cdouble.set(x, 1, 2.0);</span>
<span class="line-removed">319             Cdouble.set(x, 2, 1.0);</span>
<span class="line-removed">320             Cdouble.set(x, 3, 1.0);</span>
<span class="line-removed">321             Cdouble.set(y, 0, 0.0);</span>
<span class="line-removed">322             Cdouble.set(y, 1, 0.0);</span>
<span class="line-removed">323             Cdouble.set(y, 2, 0.0);</span>
<span class="line-removed">324             Cdouble.set(y, 3, 0.0);</span>
325 
326             cblas_dgemv(Layout, transa, m, n, alpha, a, lda, x, incx, beta, y, incy);
327             /* Print y */
328             for (i = 0; i &lt; n; i++) {
<span class="line-modified">329                 System.out.print(String.format(&quot; y%d = %f\n&quot;, i, Cdouble.get(y, (long)i)));</span>
330             }
331         }
332     }
333 }
334 
335 ```
336 
337 ### Compiling and running the above BLAS sample
338 
339 ```sh
340 
<span class="line-modified">341 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \</span>
<span class="line-modified">342     -Djava.library.path=/usr/local/opt/openblas/lib \</span>
<span class="line-modified">343     TestBlas.java</span>

344 
345 ```
346 
347 ## Using LAPACK library (Mac OS)
348 
349 On Mac OS, lapack is installed under /usr/local/opt/lapack directory.
350 
351 ### jextracting lapacke.h
352 
353 ```sh
354 
<span class="line-modified">355 jextract \</span>
356    -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
357    -l lapacke -t lapack \
358    --filter lapacke.h \
359    /usr/local/opt/lapack/include/lapacke.h
360 
361 ```
362 
363 ### Java sample code that uses LAPACK library
364 
365 ```java
366 

367 import jdk.incubator.foreign.MemoryAddress;
368 import jdk.incubator.foreign.NativeScope;
369 import lapack.*;
370 import static lapack.lapacke_h.*;

371 
372 public class TestLapack {
373     public static void main(String[] args) {
374 
375         /* Locals */
376         try (var scope = NativeScope.unboundedScope()) {
<span class="line-modified">377             var A = Cdouble.allocateArray(new double[]{</span>
378                     1, 2, 3, 4, 5, 1, 3, 5, 2, 4, 1, 4, 2, 5, 3
<span class="line-modified">379             }, scope);</span>
<span class="line-modified">380             var b = Cdouble.allocateArray(new double[]{</span>
381                     -10, 12, 14, 16, 18, -3, 14, 12, 16, 16
<span class="line-modified">382             }, scope);</span>
383             int info, m, n, lda, ldb, nrhs;
384 
385             /* Initialization */
386             m = 5;
387             n = 3;
388             nrhs = 2;
389             lda = 5;
390             ldb = 5;
391 
392             /* Print Entry Matrix */
393             print_matrix_colmajor(&quot;Entry Matrix A&quot;, m, n, A, lda );
394             /* Print Right Rand Side */
395             print_matrix_colmajor(&quot;Right Hand Side b&quot;, n, nrhs, b, ldb );
396             System.out.println();
397 
398             /* Executable statements */
399             //            printf( &quot;LAPACKE_dgels (col-major, high-level) Example Program Results\n&quot; );
400             /* Solve least squares problem*/
401             info = LAPACKE_dgels(LAPACK_COL_MAJOR(), (byte)&#39;N&#39;, m, n, nrhs, A, lda, b, ldb);
402 
403             /* Print Solution */
404             print_matrix_colmajor(&quot;Solution&quot;, n, nrhs, b, ldb );
405             System.out.println();
406             System.exit(info);
407         }
408     }
409 
410     static void print_matrix_colmajor(String msg, int m, int n, MemoryAddress mat, int ldm) {
411         int i, j;
412         System.out.printf(&quot;\n %s\n&quot;, msg);
413 
414         for( i = 0; i &lt; m; i++ ) {
<span class="line-modified">415             for( j = 0; j &lt; n; j++ ) System.out.printf(&quot; %6.2f&quot;, Cdouble.get(mat, i+j*ldm));</span>
416             System.out.printf( &quot;\n&quot; );
417         }
418     }
419 }
420 
421 ```
422 
423 ### Compiling and running the above LAPACK sample
424 
425 ```sh
426 
427 java -Dforeign.restricted=permit \
428     --add-modules jdk.incubator.foreign \
429     -Djava.library.path=/usr/local/opt/lapack/lib \
430     TestLapack.java
431 
432 ```
433 ## Using libproc library to list processes from Java (Mac OS)
434 
435 ### jextract libproc.h
436 
437 ```sh
438 
<span class="line-modified">439 jextract -t org.unix \</span>

440   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
441   --filter libproc.h \
442   /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/libproc.h
443 
444 ```
445 
446 ### Java program that uses libproc to list processes
447 
448 ```java
449 


450 import jdk.incubator.foreign.NativeScope;
451 import org.unix.*;
452 import static jdk.incubator.foreign.MemoryAddress.NULL;
453 import static org.unix.libproc_h.*;
454 
455 public class LibprocMain {
456     private static final int NAME_BUF_MAX = 256;
457 
458     public static void main(String[] args) {
459         try (var scope = NativeScope.unboundedScope()) {
460             // get the number of processes
461             int numPids = proc_listallpids(NULL, 0);
462             // allocate an array
<span class="line-modified">463             var pids = Cint.allocateArray(numPids, scope);</span>
464             // list all the pids into the native array
465             proc_listallpids(pids, numPids);
466             // convert native array to java array
<span class="line-modified">467             int[] jpids = Cint.toJavaArray(pids.segment());</span>
468             // buffer for process name
<span class="line-modified">469             var nameBuf = Cchar.allocateArray(NAME_BUF_MAX,scope);</span>
470             for (int i = 0; i &lt; jpids.length; i++) {
471                 int pid = jpids[i];
472                 // get the process name
473                 proc_name(pid, nameBuf, NAME_BUF_MAX);
<span class="line-modified">474                 String procName = Cstring.toJavaString(nameBuf);</span>
475                 // print pid and process name
476                 System.out.printf(&quot;%d %s\n&quot;, pid, procName);
477             }
478         }
479     }
480 }
481 
482 ```
483 
484 ### Compiling and running the libproc sample
485 
486 ```sh
487 
488 java -Dforeign.restricted=permit \
489     --add-modules jdk.incubator.foreign \
490     -Djava.library.path=/usr/lib LibprocMain.java
491 
492 ```
493 
494 ## Using libgit2 from Java (Mac OS)
495 
496 ### Getting and building libgit2
497 
498 * Download libgit2 v1.0.0 source from https://github.com/libgit2/libgit2/releases
499 * Use cmake to build from libgit2
500 * Let ${LIBGIT2_HOME} be the directory where you expanded libgit2 sources.
501 * Let ${LIBGIT2_HOME}/build be the build directory where libgit2.dylib is built.
502 
503 ### jextract git2.h
504 
505 ```sh
506 
<span class="line-modified">507 jextract -t com.github -lgit2 \</span>

508   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/ \
509   -I ${LIBGIT2_HOME}/include/ \
510   -I ${LIBGIT2_HOME}/include/git2 \
511   ${LIBGIT2_HOME}/include/git2.h
512 
513 ```
514 
515 ### Java program that uses libgit2 to clone github repo
516 
517 ```java
518 

519 import jdk.incubator.foreign.NativeScope;
520 import static com.github.git2_h.*;
521 import static jdk.incubator.foreign.CSupport.*;
522 import static jdk.incubator.foreign.MemoryAddress.NULL;
523 
524 public class GitClone {







525     public static void main(String[] args) {
526           if (args.length != 2) {
527               System.err.println(&quot;java GitClone &lt;url&gt; &lt;path&gt;&quot;);
528               System.exit(1);
529           }
530           git_libgit2_init();
531           try (var scope = NativeScope.unboundedScope()) {
<span class="line-modified">532               var repo = scope.allocate(C_POINTER, NULL);</span>
533               var url = toCString(args[0], scope);
534               var path = toCString(args[1], scope);
535               System.out.println(git_clone(repo, url, path, NULL));
536           }
537           git_libgit2_shutdown();
538     }
539 }

540 ```
541 
542 ### Compiling and running the libgit2 sample
543 
544 ```sh
545 
546 # file run.sh
547 
548 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
549     -Djava.library.path=${LIBGIT2_HOME}/build/ \
550     GitClone.java $*
551 ```
552 
553 ### Cloning a github repo using the above run.sh command
554 
555 ```sh
556 
557 sh run.sh https://github.com/libgit2/libgit2.git libgit2
558 
559 ```
560 
561 ## Using sqlite3 library from Java (Mac OS)
562 
563 
564 ### jextract sqlite3.h
565 
566 ```sh
567 
<span class="line-modified">568 jextract \</span>
569   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
570   /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/sqlite3.h \
<span class="line-modified">571   -t org.sqlite -lsqlite3</span>
572 
573 ```
574 ### Java program that uses sqlite3
575 
576 ```java
577 


578 import jdk.incubator.foreign.NativeScope;
<span class="line-removed">579 import org.sqlite.Cpointer;</span>
<span class="line-removed">580 import org.sqlite.Cstring;</span>
581 import static jdk.incubator.foreign.MemoryAddress.NULL;
582 import static org.sqlite.sqlite3_h.*;


583 
584 public class SqliteMain {















585    public static void main(String[] args) throws Exception {
586         try (var scope = NativeScope.unboundedScope()) {
587             // char** errMsgPtrPtr;
<span class="line-modified">588             var errMsgPtrPtr = Cpointer.allocate(NULL, scope);</span>
589 
590             // sqlite3** dbPtrPtr;
<span class="line-modified">591             var dbPtrPtr = Cpointer.allocate(NULL, scope);</span>
592 
<span class="line-modified">593             int rc = sqlite3_open(Cstring.toCString(&quot;employee.db&quot;,scope), dbPtrPtr);</span>
594             if (rc != 0) {
595                 System.err.println(&quot;sqlite3_open failed: &quot; + rc);
596                 return;
597             } else {
598                 System.out.println(&quot;employee db opened&quot;);
599             }
600 
601             // sqlite3* dbPtr;
<span class="line-modified">602             var dbPtr = Cpointer.get(dbPtrPtr);</span>
603 
604             // create a new table
<span class="line-modified">605             var sql = Cstring.toCString(</span>
606                 &quot;CREATE TABLE EMPLOYEE (&quot;  +
607                 &quot;  ID INT PRIMARY KEY NOT NULL,&quot; +
608                 &quot;  NAME TEXT NOT NULL,&quot;    +
609                 &quot;  SALARY REAL NOT NULL )&quot;, scope);
610 
611             rc = sqlite3_exec(dbPtr, sql, NULL, NULL, errMsgPtrPtr);
612 
613             if (rc != 0) {
614                 System.err.println(&quot;sqlite3_exec failed: &quot; + rc);
<span class="line-modified">615                 System.err.println(&quot;SQL error: &quot; + Cstring.toJavaStringRestricted(Cpointer.get(errMsgPtrPtr)));</span>
<span class="line-modified">616                 sqlite3_free(Cpointer.get(errMsgPtrPtr));</span>
617             } else {
618                 System.out.println(&quot;employee table created&quot;);
619             }
620 
621             // insert two rows
<span class="line-modified">622             sql = Cstring.toCString(</span>
623                 &quot;INSERT INTO EMPLOYEE (ID,NAME,SALARY) &quot; +
624                     &quot;VALUES (134, &#39;Xyz&#39;, 200000.0); &quot; +
625                 &quot;INSERT INTO EMPLOYEE (ID,NAME,SALARY) &quot; +
626                     &quot;VALUES (333, &#39;Abc&#39;, 100000.0);&quot;, scope
627             );
628             rc = sqlite3_exec(dbPtr, sql, NULL, NULL, errMsgPtrPtr);
629 
630             if (rc != 0) {
631                 System.err.println(&quot;sqlite3_exec failed: &quot; + rc);
<span class="line-modified">632                 System.err.println(&quot;SQL error: &quot; + Cstring.toJavaStringRestricted(Cpointer.get(errMsgPtrPtr)));</span>
<span class="line-modified">633                 sqlite3_free(Cpointer.get(errMsgPtrPtr));</span>
634             } else {
635                 System.out.println(&quot;rows inserted&quot;);
636             }
637 
638             int[] rowNum = new int[1];
639             // callback to print rows from SELECT query
640             var callback = sqlite3_exec$callback.allocate((a, argc, argv, columnNames) -&gt; {
641                 System.out.println(&quot;Row num: &quot; + rowNum[0]++);
642                 System.out.println(&quot;numColumns = &quot; + argc);
<span class="line-modified">643                 argv = Cpointer.asArrayRestricted(argv, argc);</span>
<span class="line-modified">644                 columnNames = Cpointer.asArrayRestricted(columnNames, argc);</span>
645                 for (int i = 0; i &lt; argc; i++) {
<span class="line-modified">646                      String name = Cstring.toJavaStringRestricted(Cpointer.get(columnNames, i));</span>
<span class="line-modified">647                      String value = Cstring.toJavaStringRestricted(Cpointer.get(argv, i));</span>
648                      System.out.printf(&quot;%s = %s\n&quot;, name, value);
649                 }
650                 return 0;
651             }, scope);
652 
653             // select query
<span class="line-modified">654             sql = Cstring.toCString(&quot;SELECT * FROM EMPLOYEE&quot;, scope);</span>
655             rc = sqlite3_exec(dbPtr, sql, callback, NULL, errMsgPtrPtr);
656 
657             if (rc != 0) {
658                 System.err.println(&quot;sqlite3_exec failed: &quot; + rc);
<span class="line-modified">659                 System.err.println(&quot;SQL error: &quot; + Cstring.toJavaStringRestricted(Cpointer.get(errMsgPtrPtr)));</span>
<span class="line-modified">660                 sqlite3_free(Cpointer.get(errMsgPtrPtr));</span>
661             } else {
662                 System.out.println(&quot;done&quot;);
663             }
664 
665             sqlite3_close(dbPtr);
666         }
667     }
668 }

669 ```
670 
671 ### Compiling and running the sqlite3 sample
672 
673 ```sh
674 
675 java -Dforeign.restricted=permit \
676    --add-modules jdk.incubator.foreign \
677    -Djava.library.path=/usr/lib SqliteMain.java
678 
679 ```
</pre>
</td>
<td>
<hr />
<pre>
 69         helloworld();
 70     }
 71 }
 72 
 73 ```
 74 
 75 ### Running the Java code that invokes helloworld
 76 
 77 ```sh
 78 
 79 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign HelloWorld.java
 80 
 81 ```
 82 
 83 ## Embedding Python interpreter in your Java program (Mac OS)
 84 
 85 ### jextract Python.h
 86 
 87 ```sh
 88 
<span class="line-modified"> 89 jextract -J-Djdk.internal.foreign.ProgrammableInvoker.NO_INTRINSICS=true \</span>
<span class="line-added"> 90   -l python2.7 \</span>
 91   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
 92   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/python2.7/ \
 93   -t org.python \
 94    /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/python2.7/Python.h
 95 
 96 ```
 97 
 98 ### Java program that uses extracted Python interface
 99 
100 ```java
101 
<span class="line-modified">102 </span>
<span class="line-added">103 import static jdk.incubator.foreign.CSupport.*;</span>
104 import static jdk.incubator.foreign.MemoryAddress.NULL;
105 // import jextracted python &#39;header&#39; class
106 import static org.python.RuntimeHelper.*;
107 import static org.python.Python_h.*;
108 
109 public class PythonMain {
110     public static void main(String[] args) {
111         String script = &quot;print(sum([33, 55, 66])); print(&#39;Hello from Python!&#39;)\n&quot;;
112 
113         Py_Initialize();
<span class="line-modified">114         try (var s = toCString(script)) {</span>
115             var str = s.baseAddress();
116             PyRun_SimpleStringFlags(str, NULL);
117             Py_Finalize();
118         }
119     }
120 }
121 
122 ```
123 
124 ### Running the Java code that calls Python interpreter
125 
126 ```sh
127 
128 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
129     -Djava.library.path=/System/Library/Frameworks/Python.framework/Versions/2.7/lib \
130     PythonMain.java
131 
132 ```
133 
134 ## Using readline library from Java code (Mac OS)
135 
136 ### jextract readline.h
137 
138 ```sh
139 
<span class="line-modified">140 jextract -J-Djdk.internal.foreign.ProgrammableInvoker.NO_INTRINSICS=true \</span>
<span class="line-added">141   -l readline -t org.unix \</span>
142   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
143    /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/readline/readline.h
144 

145 ```
146 
147 ### Java code that uses readline
148 
149 ```java
150 

151 import static org.unix.RuntimeHelper.*;
152 import static org.unix.readline_h.*;
<span class="line-added">153 import static jdk.incubator.foreign.CSupport.*;</span>
154 
155 public class Readline {
156     public static void main(String[] args) {
<span class="line-modified">157         try (var s = toCString(&quot;name? &quot;)) {</span>
158             var pstr = s.baseAddress();
159             // call &quot;readline&quot; API
160             var p = readline(pstr);
161 
162             // print char* as is
163             System.out.println(p);
164             // convert char* ptr from readline as Java String &amp; print it
<span class="line-modified">165             System.out.println(&quot;Hello, &quot; + toJavaStringRestricted(p));</span>
166         }
167     }
168 }
169 
170 ```
171 
172 ### Running the java code that uses readline
173 
174 ```
175 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
176     -Djava.library.path=/usr/local/opt/readline/lib/ Readline.java
177 
178 ```
179 
180 ## Using libcurl from Java (Mac OS)
181 
182 ### jextract curl.h
183 
184 ```sh
185 
<span class="line-modified">186 jextract -J-Djdk.internal.foreign.ProgrammableInvoker.NO_INTRINSICS=true -t org.unix -lcurl \</span>
187   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/ \
188   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/curl/ \
189   /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/curl/curl.h
190 
191 ```
192 
193 ### Java code that uses libcurl
194 
195 ```java
196 
<span class="line-modified">197 </span>
198 import static jdk.incubator.foreign.MemoryAddress.NULL;
199 import static org.unix.RuntimeHelper.*;
200 import static org.unix.curl_h.*;
<span class="line-added">201 import static jdk.incubator.foreign.CSupport.*;</span>
202 
203 public class CurlMain {
204    public static void main(String[] args) {
205        var urlStr = args[0];
206        curl_global_init(CURL_GLOBAL_DEFAULT());
207        var curl = curl_easy_init();
208        if(!curl.equals(NULL)) {
<span class="line-modified">209            try (var s = toCString(urlStr)) {</span>
210                var url = s.baseAddress();
211                curl_easy_setopt(curl, CURLOPT_URL(), url);
212                int res = curl_easy_perform(curl);
213                if (res != CURLE_OK()) {
214                    curl_easy_cleanup(curl);
215                }
216            }
217        }
218        curl_global_cleanup();
219    }
220 }
221 
222 ```
223 
224 ### Running the java code that uses libcurl
225 
226 ```sh
227 
228 # run this shell script by passing a URL as first argument
229 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
</pre>
<hr />
<pre>
250 ```
251 
252 It installs include and lib directories under /usr/local/opt/openblas
253 
254 ### jextracting cblas.h (MacOS)
255 
256 The following command can be used to extract cblas.h on MacOs
257 
258 ```sh
259 
260 jextract -C &quot;-D FORCE_OPENBLAS_COMPLEX_STRUCT&quot; \
261   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
262   -l openblas -t blas /usr/local/opt/openblas/include/cblas.h
263 
264 ```
265 
266 ### Java sample code that uses cblas library
267 
268 ```java
269 
<span class="line-added">270 import jdk.incubator.foreign.MemoryAddress;</span>
<span class="line-added">271 import jdk.incubator.foreign.MemoryAccess;</span>
272 import jdk.incubator.foreign.NativeScope;
273 import blas.*;
274 import static blas.RuntimeHelper.*;
275 import static blas.cblas_h.*;
<span class="line-added">276 import static jdk.incubator.foreign.CSupport.*;</span>
277 
278 public class TestBlas {
<span class="line-added">279     private static double getDouble(MemoryAddress addr, int element) {</span>
<span class="line-added">280         return MemoryAccess.getDouble(addr, element*C_DOUBLE.byteSize());</span>
<span class="line-added">281     }</span>
<span class="line-added">282 </span>
283     public static void main(String[] args) {
284         int Layout;
285         int transa;
286 
287         double alpha, beta;
288         int m, n, lda, incx, incy, i;
289 
290         Layout = CblasColMajor();
291         transa = CblasNoTrans();
292 
293         m = 4; /* Size of Column ( the number of rows ) */
294         n = 4; /* Size of Row ( the number of columns ) */
295         lda = 4; /* Leading dimension of 5 * 4 matrix is 5 */
296         incx = 1;
297         incy = 1;
298         alpha = 1;
299         beta = 0;
300 
301         try (var scope = NativeScope.unboundedScope()) {
<span class="line-modified">302             var a = scope.allocateArray(C_DOUBLE, new double[] {</span>
<span class="line-modified">303                 1.0, 2.0, 3.0, 4.0,</span>
<span class="line-modified">304                 1.0, 1.0, 1.0, 1.0,</span>
<span class="line-modified">305                 3.0, 4.0, 5.0, 6.0,</span>
<span class="line-modified">306                 5.0, 6.0, 7.0, 8.0</span>
<span class="line-modified">307             });</span>
<span class="line-modified">308             var x = scope.allocateArray(C_DOUBLE, new double[] {</span>
<span class="line-modified">309                 1.0, 2.0, 1.0, 1.0</span>
<span class="line-modified">310             });</span>
<span class="line-modified">311             var y = scope.allocateArray(C_DOUBLE, n);</span>























312 
313             cblas_dgemv(Layout, transa, m, n, alpha, a, lda, x, incx, beta, y, incy);
314             /* Print y */
315             for (i = 0; i &lt; n; i++) {
<span class="line-modified">316                 System.out.print(String.format(&quot; y%d = %f\n&quot;, i, getDouble(y, i)));</span>
317             }
318         }
319     }
320 }
321 
322 ```
323 
324 ### Compiling and running the above BLAS sample
325 
326 ```sh
327 
<span class="line-modified">328 jextract -J-Djdk.internal.foreign.ProgrammableInvoker.NO_INTRINSICS=true \</span>
<span class="line-modified">329   -C &quot;-D FORCE_OPENBLAS_COMPLEX_STRUCT&quot; \</span>
<span class="line-modified">330   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \</span>
<span class="line-added">331   -l openblas -t blas /usr/local/opt/openblas/include/cblas.h</span>
332 
333 ```
334 
335 ## Using LAPACK library (Mac OS)
336 
337 On Mac OS, lapack is installed under /usr/local/opt/lapack directory.
338 
339 ### jextracting lapacke.h
340 
341 ```sh
342 
<span class="line-modified">343 jextract -J-Djdk.internal.foreign.ProgrammableInvoker.NO_INTRINSICS=true \</span>
344    -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
345    -l lapacke -t lapack \
346    --filter lapacke.h \
347    /usr/local/opt/lapack/include/lapacke.h
348 
349 ```
350 
351 ### Java sample code that uses LAPACK library
352 
353 ```java
354 
<span class="line-added">355 import jdk.incubator.foreign.MemoryAccess;</span>
356 import jdk.incubator.foreign.MemoryAddress;
357 import jdk.incubator.foreign.NativeScope;
358 import lapack.*;
359 import static lapack.lapacke_h.*;
<span class="line-added">360 import static jdk.incubator.foreign.CSupport.*;</span>
361 
362 public class TestLapack {
363     public static void main(String[] args) {
364 
365         /* Locals */
366         try (var scope = NativeScope.unboundedScope()) {
<span class="line-modified">367             var A = scope.allocateArray(C_DOUBLE, new double[]{</span>
368                     1, 2, 3, 4, 5, 1, 3, 5, 2, 4, 1, 4, 2, 5, 3
<span class="line-modified">369             });</span>
<span class="line-modified">370             var b = scope.allocateArray(C_DOUBLE, new double[]{</span>
371                     -10, 12, 14, 16, 18, -3, 14, 12, 16, 16
<span class="line-modified">372             });</span>
373             int info, m, n, lda, ldb, nrhs;
374 
375             /* Initialization */
376             m = 5;
377             n = 3;
378             nrhs = 2;
379             lda = 5;
380             ldb = 5;
381 
382             /* Print Entry Matrix */
383             print_matrix_colmajor(&quot;Entry Matrix A&quot;, m, n, A, lda );
384             /* Print Right Rand Side */
385             print_matrix_colmajor(&quot;Right Hand Side b&quot;, n, nrhs, b, ldb );
386             System.out.println();
387 
388             /* Executable statements */
389             //            printf( &quot;LAPACKE_dgels (col-major, high-level) Example Program Results\n&quot; );
390             /* Solve least squares problem*/
391             info = LAPACKE_dgels(LAPACK_COL_MAJOR(), (byte)&#39;N&#39;, m, n, nrhs, A, lda, b, ldb);
392 
393             /* Print Solution */
394             print_matrix_colmajor(&quot;Solution&quot;, n, nrhs, b, ldb );
395             System.out.println();
396             System.exit(info);
397         }
398     }
399 
400     static void print_matrix_colmajor(String msg, int m, int n, MemoryAddress mat, int ldm) {
401         int i, j;
402         System.out.printf(&quot;\n %s\n&quot;, msg);
403 
404         for( i = 0; i &lt; m; i++ ) {
<span class="line-modified">405             for( j = 0; j &lt; n; j++ ) System.out.printf(&quot; %6.2f&quot;, MemoryAccess.getDouble(mat, C_DOUBLE.byteSize()*(i+j*ldm)));</span>
406             System.out.printf( &quot;\n&quot; );
407         }
408     }
409 }
410 
411 ```
412 
413 ### Compiling and running the above LAPACK sample
414 
415 ```sh
416 
417 java -Dforeign.restricted=permit \
418     --add-modules jdk.incubator.foreign \
419     -Djava.library.path=/usr/local/opt/lapack/lib \
420     TestLapack.java
421 
422 ```
423 ## Using libproc library to list processes from Java (Mac OS)
424 
425 ### jextract libproc.h
426 
427 ```sh
428 
<span class="line-modified">429 jextract -J-Djdk.internal.foreign.ProgrammableInvoker.NO_INTRINSICS=true \</span>
<span class="line-added">430   -t org.unix \</span>
431   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
432   --filter libproc.h \
433   /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/libproc.h
434 
435 ```
436 
437 ### Java program that uses libproc to list processes
438 
439 ```java
440 
<span class="line-added">441 import jdk.incubator.foreign.CSupport;</span>
<span class="line-added">442 import jdk.incubator.foreign.MemorySegment;</span>
443 import jdk.incubator.foreign.NativeScope;
444 import org.unix.*;
445 import static jdk.incubator.foreign.MemoryAddress.NULL;
446 import static org.unix.libproc_h.*;
447 
448 public class LibprocMain {
449     private static final int NAME_BUF_MAX = 256;
450 
451     public static void main(String[] args) {
452         try (var scope = NativeScope.unboundedScope()) {
453             // get the number of processes
454             int numPids = proc_listallpids(NULL, 0);
455             // allocate an array
<span class="line-modified">456             var pids = scope.allocateArray(CSupport.C_INT, numPids);</span>
457             // list all the pids into the native array
458             proc_listallpids(pids, numPids);
459             // convert native array to java array
<span class="line-modified">460             int[] jpids = pids.segment().toIntArray();</span>
461             // buffer for process name
<span class="line-modified">462             var nameBuf = scope.allocateArray(CSupport.C_CHAR, NAME_BUF_MAX);</span>
463             for (int i = 0; i &lt; jpids.length; i++) {
464                 int pid = jpids[i];
465                 // get the process name
466                 proc_name(pid, nameBuf, NAME_BUF_MAX);
<span class="line-modified">467                 String procName = CSupport.toJavaString(nameBuf);</span>
468                 // print pid and process name
469                 System.out.printf(&quot;%d %s\n&quot;, pid, procName);
470             }
471         }
472     }
473 }
474 
475 ```
476 
477 ### Compiling and running the libproc sample
478 
479 ```sh
480 
481 java -Dforeign.restricted=permit \
482     --add-modules jdk.incubator.foreign \
483     -Djava.library.path=/usr/lib LibprocMain.java
484 
485 ```
486 
487 ## Using libgit2 from Java (Mac OS)
488 
489 ### Getting and building libgit2
490 
491 * Download libgit2 v1.0.0 source from https://github.com/libgit2/libgit2/releases
492 * Use cmake to build from libgit2
493 * Let ${LIBGIT2_HOME} be the directory where you expanded libgit2 sources.
494 * Let ${LIBGIT2_HOME}/build be the build directory where libgit2.dylib is built.
495 
496 ### jextract git2.h
497 
498 ```sh
499 
<span class="line-modified">500 jextract -J-Djdk.internal.foreign.ProgrammableInvoker.NO_INTRINSICS=true \</span>
<span class="line-added">501   -t com.github -lgit2 \</span>
502   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/ \
503   -I ${LIBGIT2_HOME}/include/ \
504   -I ${LIBGIT2_HOME}/include/git2 \
505   ${LIBGIT2_HOME}/include/git2.h
506 
507 ```
508 
509 ### Java program that uses libgit2 to clone github repo
510 
511 ```java
512 
<span class="line-added">513 import jdk.incubator.foreign.MemoryAddress;</span>
514 import jdk.incubator.foreign.NativeScope;
515 import static com.github.git2_h.*;
516 import static jdk.incubator.foreign.CSupport.*;
517 import static jdk.incubator.foreign.MemoryAddress.NULL;
518 
519 public class GitClone {
<span class="line-added">520     private static MemoryAddress allocatePointer(MemoryAddress value, NativeScope scope) {</span>
<span class="line-added">521         var addr = scope.allocate(C_POINTER);</span>
<span class="line-added">522         var handle = C_POINTER.varHandle(long.class);</span>
<span class="line-added">523         handle.set(addr, value.toRawLongValue());</span>
<span class="line-added">524         return addr;</span>
<span class="line-added">525     }</span>
<span class="line-added">526 </span>
527     public static void main(String[] args) {
528           if (args.length != 2) {
529               System.err.println(&quot;java GitClone &lt;url&gt; &lt;path&gt;&quot;);
530               System.exit(1);
531           }
532           git_libgit2_init();
533           try (var scope = NativeScope.unboundedScope()) {
<span class="line-modified">534               var repo = allocatePointer(NULL, scope);</span>
535               var url = toCString(args[0], scope);
536               var path = toCString(args[1], scope);
537               System.out.println(git_clone(repo, url, path, NULL));
538           }
539           git_libgit2_shutdown();
540     }
541 }
<span class="line-added">542 </span>
543 ```
544 
545 ### Compiling and running the libgit2 sample
546 
547 ```sh
548 
549 # file run.sh
550 
551 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
552     -Djava.library.path=${LIBGIT2_HOME}/build/ \
553     GitClone.java $*
554 ```
555 
556 ### Cloning a github repo using the above run.sh command
557 
558 ```sh
559 
560 sh run.sh https://github.com/libgit2/libgit2.git libgit2
561 
562 ```
563 
564 ## Using sqlite3 library from Java (Mac OS)
565 
566 
567 ### jextract sqlite3.h
568 
569 ```sh
570 
<span class="line-modified">571 jextract -J-Djdk.internal.foreign.ProgrammableInvoker.NO_INTRINSICS=true \</span>
572   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
573   /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/sqlite3.h \
<span class="line-modified">574   -t org.sqlite -lsqlite3 </span>
575 
576 ```
577 ### Java program that uses sqlite3
578 
579 ```java
580 
<span class="line-added">581 import jdk.incubator.foreign.MemoryAddress;</span>
<span class="line-added">582 import jdk.incubator.foreign.MemoryAccess;</span>
583 import jdk.incubator.foreign.NativeScope;


584 import static jdk.incubator.foreign.MemoryAddress.NULL;
585 import static org.sqlite.sqlite3_h.*;
<span class="line-added">586 import static org.sqlite.RuntimeHelper.*;</span>
<span class="line-added">587 import static jdk.incubator.foreign.CSupport.*;</span>
588 
589 public class SqliteMain {
<span class="line-added">590    private static MemoryAddress allocatePointer(MemoryAddress value, NativeScope scope) {</span>
<span class="line-added">591         var addr = scope.allocate(C_POINTER);</span>
<span class="line-added">592         var handle = C_POINTER.varHandle(long.class);</span>
<span class="line-added">593         handle.set(addr, value.toRawLongValue());</span>
<span class="line-added">594         return addr;</span>
<span class="line-added">595    }</span>
<span class="line-added">596 </span>
<span class="line-added">597    private static MemoryAddress getPointer(MemoryAddress addr) {</span>
<span class="line-added">598        return getPointer(addr, 0);</span>
<span class="line-added">599    }</span>
<span class="line-added">600 </span>
<span class="line-added">601    private static MemoryAddress getPointer(MemoryAddress addr, int element) {</span>
<span class="line-added">602        return MemoryAccess.getAddress(addr, element*C_POINTER.byteSize());</span>
<span class="line-added">603    }</span>
<span class="line-added">604 </span>
605    public static void main(String[] args) throws Exception {
606         try (var scope = NativeScope.unboundedScope()) {
607             // char** errMsgPtrPtr;
<span class="line-modified">608             var errMsgPtrPtr = allocatePointer(NULL, scope);</span>
609 
610             // sqlite3** dbPtrPtr;
<span class="line-modified">611             var dbPtrPtr = allocatePointer(NULL, scope);</span>
612 
<span class="line-modified">613             int rc = sqlite3_open(toCString(&quot;employee.db&quot;,scope), dbPtrPtr);</span>
614             if (rc != 0) {
615                 System.err.println(&quot;sqlite3_open failed: &quot; + rc);
616                 return;
617             } else {
618                 System.out.println(&quot;employee db opened&quot;);
619             }
620 
621             // sqlite3* dbPtr;
<span class="line-modified">622             var dbPtr = getPointer(dbPtrPtr);</span>
623 
624             // create a new table
<span class="line-modified">625             var sql = toCString(</span>
626                 &quot;CREATE TABLE EMPLOYEE (&quot;  +
627                 &quot;  ID INT PRIMARY KEY NOT NULL,&quot; +
628                 &quot;  NAME TEXT NOT NULL,&quot;    +
629                 &quot;  SALARY REAL NOT NULL )&quot;, scope);
630 
631             rc = sqlite3_exec(dbPtr, sql, NULL, NULL, errMsgPtrPtr);
632 
633             if (rc != 0) {
634                 System.err.println(&quot;sqlite3_exec failed: &quot; + rc);
<span class="line-modified">635                 System.err.println(&quot;SQL error: &quot; + toJavaStringRestricted(getPointer(errMsgPtrPtr)));</span>
<span class="line-modified">636                 sqlite3_free(getPointer(errMsgPtrPtr));</span>
637             } else {
638                 System.out.println(&quot;employee table created&quot;);
639             }
640 
641             // insert two rows
<span class="line-modified">642             sql = toCString(</span>
643                 &quot;INSERT INTO EMPLOYEE (ID,NAME,SALARY) &quot; +
644                     &quot;VALUES (134, &#39;Xyz&#39;, 200000.0); &quot; +
645                 &quot;INSERT INTO EMPLOYEE (ID,NAME,SALARY) &quot; +
646                     &quot;VALUES (333, &#39;Abc&#39;, 100000.0);&quot;, scope
647             );
648             rc = sqlite3_exec(dbPtr, sql, NULL, NULL, errMsgPtrPtr);
649 
650             if (rc != 0) {
651                 System.err.println(&quot;sqlite3_exec failed: &quot; + rc);
<span class="line-modified">652                 System.err.println(&quot;SQL error: &quot; + toJavaStringRestricted(getPointer(errMsgPtrPtr)));</span>
<span class="line-modified">653                 sqlite3_free(getPointer(errMsgPtrPtr));</span>
654             } else {
655                 System.out.println(&quot;rows inserted&quot;);
656             }
657 
658             int[] rowNum = new int[1];
659             // callback to print rows from SELECT query
660             var callback = sqlite3_exec$callback.allocate((a, argc, argv, columnNames) -&gt; {
661                 System.out.println(&quot;Row num: &quot; + rowNum[0]++);
662                 System.out.println(&quot;numColumns = &quot; + argc);
<span class="line-modified">663                 argv = asArrayRestricted(argv, C_POINTER, argc);</span>
<span class="line-modified">664                 columnNames = asArrayRestricted(columnNames, C_POINTER, argc);</span>
665                 for (int i = 0; i &lt; argc; i++) {
<span class="line-modified">666                      String name = toJavaStringRestricted(getPointer(columnNames, i));</span>
<span class="line-modified">667                      String value = toJavaStringRestricted(getPointer(argv, i));</span>
668                      System.out.printf(&quot;%s = %s\n&quot;, name, value);
669                 }
670                 return 0;
671             }, scope);
672 
673             // select query
<span class="line-modified">674             sql = toCString(&quot;SELECT * FROM EMPLOYEE&quot;, scope);</span>
675             rc = sqlite3_exec(dbPtr, sql, callback, NULL, errMsgPtrPtr);
676 
677             if (rc != 0) {
678                 System.err.println(&quot;sqlite3_exec failed: &quot; + rc);
<span class="line-modified">679                 System.err.println(&quot;SQL error: &quot; + toJavaStringRestricted(getPointer(errMsgPtrPtr)));</span>
<span class="line-modified">680                 sqlite3_free(getPointer(errMsgPtrPtr));</span>
681             } else {
682                 System.out.println(&quot;done&quot;);
683             }
684 
685             sqlite3_close(dbPtr);
686         }
687     }
688 }
<span class="line-added">689 </span>
690 ```
691 
692 ### Compiling and running the sqlite3 sample
693 
694 ```sh
695 
696 java -Dforeign.restricted=permit \
697    --add-modules jdk.incubator.foreign \
698    -Djava.library.path=/usr/lib SqliteMain.java
699 
700 ```
</pre>
</td>
</tr>
</table>
<center><a href="panama_jextract.html.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="../src/jdk.incubator.jextract/share/classes/jdk/incubator/jextract/tool/HeaderBuilder.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>