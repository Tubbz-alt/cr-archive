<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff doc/panama_jextract.md</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="panama_jextract.html.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="../test/jdk/tools/jextract/test8246341/LibTest8246341Test.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>doc/panama_jextract.md</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
493 * Let ${LIBGIT2_HOME} be the directory where you expanded libgit2 sources.
494 * Let ${LIBGIT2_HOME}/build be the build directory where libgit2.dylib is built.
495 
496 ### jextract git2.h
497 
498 ```sh
499 
500 jextract \
501   -t com.github -lgit2 \
502   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/ \
503   -I ${LIBGIT2_HOME}/include/ \
504   -I ${LIBGIT2_HOME}/include/git2 \
505   ${LIBGIT2_HOME}/include/git2.h
506 
507 ```
508 
509 ### Java program that uses libgit2 to clone github repo
510 
511 ```java
512 

513 import jdk.incubator.foreign.MemoryAddress;
514 import jdk.incubator.foreign.NativeScope;
515 import static com.github.git2_h.*;
516 import static jdk.incubator.foreign.CSupport.*;
517 import static jdk.incubator.foreign.MemoryAddress.NULL;
518 
519 public class GitClone {
<span class="line-removed">520     private static MemoryAddress allocatePointer(MemoryAddress value, NativeScope scope) {</span>
<span class="line-removed">521         var addr = scope.allocate(C_POINTER);</span>
<span class="line-removed">522         var handle = C_POINTER.varHandle(long.class);</span>
<span class="line-removed">523         handle.set(addr, value.toRawLongValue());</span>
<span class="line-removed">524         return addr;</span>
<span class="line-removed">525     }</span>
<span class="line-removed">526 </span>
527     public static void main(String[] args) {
528           if (args.length != 2) {
529               System.err.println(&quot;java GitClone &lt;url&gt; &lt;path&gt;&quot;);
530               System.exit(1);
531           }
532           git_libgit2_init();
533           try (var scope = NativeScope.unboundedScope()) {
<span class="line-modified">534               var repo = allocatePointer(NULL, scope);</span>

535               var url = toCString(args[0], scope);
536               var path = toCString(args[1], scope);
537               System.out.println(git_clone(repo, url, path, NULL));
<span class="line-modified">538           }</span>
539           git_libgit2_shutdown();
540     }
541 }
<span class="line-removed">542 </span>
543 ```
544 
545 ### Compiling and running the libgit2 sample
546 
547 ```sh
548 
549 # file run.sh
550 
551 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
552     -Djava.library.path=${LIBGIT2_HOME}/build/ \
553     GitClone.java $*
554 ```
555 
556 ### Cloning a github repo using the above run.sh command
557 
558 ```sh
559 
560 sh run.sh https://github.com/libgit2/libgit2.git libgit2
561 
562 ```
</pre>
<hr />
<pre>
570 
571 jextract \
572   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
573   /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/sqlite3.h \
574   -t org.sqlite -lsqlite3 
575 
576 ```
577 ### Java program that uses sqlite3
578 
579 ```java
580 
581 import jdk.incubator.foreign.MemoryAddress;
582 import jdk.incubator.foreign.MemoryAccess;
583 import jdk.incubator.foreign.NativeScope;
584 import static jdk.incubator.foreign.MemoryAddress.NULL;
585 import static org.sqlite.sqlite3_h.*;
586 import static org.sqlite.RuntimeHelper.*;
587 import static jdk.incubator.foreign.CSupport.*;
588 
589 public class SqliteMain {
<span class="line-removed">590    private static MemoryAddress allocatePointer(MemoryAddress value, NativeScope scope) {</span>
<span class="line-removed">591         var addr = scope.allocate(C_POINTER);</span>
<span class="line-removed">592         var handle = C_POINTER.varHandle(long.class);</span>
<span class="line-removed">593         handle.set(addr, value.toRawLongValue());</span>
<span class="line-removed">594         return addr;</span>
<span class="line-removed">595    }</span>
<span class="line-removed">596 </span>
597    private static MemoryAddress getPointer(MemoryAddress addr) {
598        return getPointer(addr, 0);
599    }
600 
601    private static MemoryAddress getPointer(MemoryAddress addr, int element) {
602        return MemoryAccess.getAddress(addr, element*C_POINTER.byteSize());
603    }
604 
605    public static void main(String[] args) throws Exception {
606         try (var scope = NativeScope.unboundedScope()) {
607             // char** errMsgPtrPtr;
<span class="line-modified">608             var errMsgPtrPtr = allocatePointer(NULL, scope);</span>

609 
610             // sqlite3** dbPtrPtr;
<span class="line-modified">611             var dbPtrPtr = allocatePointer(NULL, scope);</span>

612 
613             int rc = sqlite3_open(toCString(&quot;employee.db&quot;,scope), dbPtrPtr);
614             if (rc != 0) {
615                 System.err.println(&quot;sqlite3_open failed: &quot; + rc);
616                 return;
617             } else {
618                 System.out.println(&quot;employee db opened&quot;);
619             }
620 
621             // sqlite3* dbPtr;
622             var dbPtr = getPointer(dbPtrPtr);
623 
624             // create a new table
625             var sql = toCString(
626                 &quot;CREATE TABLE EMPLOYEE (&quot;  +
627                 &quot;  ID INT PRIMARY KEY NOT NULL,&quot; +
628                 &quot;  NAME TEXT NOT NULL,&quot;    +
629                 &quot;  SALARY REAL NOT NULL )&quot;, scope);
630 
631             rc = sqlite3_exec(dbPtr, sql, NULL, NULL, errMsgPtrPtr);
</pre>
</td>
<td>
<hr />
<pre>
493 * Let ${LIBGIT2_HOME} be the directory where you expanded libgit2 sources.
494 * Let ${LIBGIT2_HOME}/build be the build directory where libgit2.dylib is built.
495 
496 ### jextract git2.h
497 
498 ```sh
499 
500 jextract \
501   -t com.github -lgit2 \
502   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/ \
503   -I ${LIBGIT2_HOME}/include/ \
504   -I ${LIBGIT2_HOME}/include/git2 \
505   ${LIBGIT2_HOME}/include/git2.h
506 
507 ```
508 
509 ### Java program that uses libgit2 to clone github repo
510 
511 ```java
512 
<span class="line-added">513 import jdk.incubator.foreign.MemoryAccess;</span>
514 import jdk.incubator.foreign.MemoryAddress;
515 import jdk.incubator.foreign.NativeScope;
516 import static com.github.git2_h.*;
517 import static jdk.incubator.foreign.CSupport.*;
518 import static jdk.incubator.foreign.MemoryAddress.NULL;
519 
520 public class GitClone {







521     public static void main(String[] args) {
522           if (args.length != 2) {
523               System.err.println(&quot;java GitClone &lt;url&gt; &lt;path&gt;&quot;);
524               System.exit(1);
525           }
526           git_libgit2_init();
527           try (var scope = NativeScope.unboundedScope()) {
<span class="line-modified">528               var repo = scope.allocate(C_POINTER);</span>
<span class="line-added">529               MemoryAccess.setAddress(repo, 0, NULL);</span>
530               var url = toCString(args[0], scope);
531               var path = toCString(args[1], scope);
532               System.out.println(git_clone(repo, url, path, NULL));
<span class="line-modified">533           }          </span>
534           git_libgit2_shutdown();
535     }
536 }

537 ```
538 
539 ### Compiling and running the libgit2 sample
540 
541 ```sh
542 
543 # file run.sh
544 
545 java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \
546     -Djava.library.path=${LIBGIT2_HOME}/build/ \
547     GitClone.java $*
548 ```
549 
550 ### Cloning a github repo using the above run.sh command
551 
552 ```sh
553 
554 sh run.sh https://github.com/libgit2/libgit2.git libgit2
555 
556 ```
</pre>
<hr />
<pre>
564 
565 jextract \
566   -I /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include \
567   /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/sqlite3.h \
568   -t org.sqlite -lsqlite3 
569 
570 ```
571 ### Java program that uses sqlite3
572 
573 ```java
574 
575 import jdk.incubator.foreign.MemoryAddress;
576 import jdk.incubator.foreign.MemoryAccess;
577 import jdk.incubator.foreign.NativeScope;
578 import static jdk.incubator.foreign.MemoryAddress.NULL;
579 import static org.sqlite.sqlite3_h.*;
580 import static org.sqlite.RuntimeHelper.*;
581 import static jdk.incubator.foreign.CSupport.*;
582 
583 public class SqliteMain {







584    private static MemoryAddress getPointer(MemoryAddress addr) {
585        return getPointer(addr, 0);
586    }
587 
588    private static MemoryAddress getPointer(MemoryAddress addr, int element) {
589        return MemoryAccess.getAddress(addr, element*C_POINTER.byteSize());
590    }
591 
592    public static void main(String[] args) throws Exception {
593         try (var scope = NativeScope.unboundedScope()) {
594             // char** errMsgPtrPtr;
<span class="line-modified">595             var errMsgPtrPtr = scope.allocate(C_POINTER);</span>
<span class="line-added">596             MemoryAccess.setAddress(errMsgPtrPtr, 0, NULL);</span>
597 
598             // sqlite3** dbPtrPtr;
<span class="line-modified">599             var dbPtrPtr = scope.allocate(C_POINTER);</span>
<span class="line-added">600             MemoryAccess.setAddress(dbPtrPtr, 0, NULL);</span>
601 
602             int rc = sqlite3_open(toCString(&quot;employee.db&quot;,scope), dbPtrPtr);
603             if (rc != 0) {
604                 System.err.println(&quot;sqlite3_open failed: &quot; + rc);
605                 return;
606             } else {
607                 System.out.println(&quot;employee db opened&quot;);
608             }
609 
610             // sqlite3* dbPtr;
611             var dbPtr = getPointer(dbPtrPtr);
612 
613             // create a new table
614             var sql = toCString(
615                 &quot;CREATE TABLE EMPLOYEE (&quot;  +
616                 &quot;  ID INT PRIMARY KEY NOT NULL,&quot; +
617                 &quot;  NAME TEXT NOT NULL,&quot;    +
618                 &quot;  SALARY REAL NOT NULL )&quot;, scope);
619 
620             rc = sqlite3_exec(dbPtr, sql, NULL, NULL, errMsgPtrPtr);
</pre>
</td>
</tr>
</table>
<center><a href="panama_jextract.html.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="../test/jdk/tools/jextract/test8246341/LibTest8246341Test.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>