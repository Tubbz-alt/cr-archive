<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.incubator.foreign/share/classes/jdk/incubator/foreign/MemorySegment.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="MemoryAddress.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../internal/foreign/InternalForeign.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.incubator.foreign/share/classes/jdk/incubator/foreign/MemorySegment.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 26,11 ***</span>
  
  package jdk.incubator.foreign;
  
  import java.nio.ByteBuffer;
  
<span class="line-modified">! import jdk.internal.foreign.Utils;</span>
  
  import java.io.IOException;
  import java.nio.channels.FileChannel;
  import java.nio.file.Path;
  import java.util.Spliterator;
<span class="line-new-header">--- 26,14 ---</span>
  
  package jdk.incubator.foreign;
  
  import java.nio.ByteBuffer;
  
<span class="line-modified">! import jdk.internal.foreign.AbstractMemorySegmentImpl;</span>
<span class="line-added">+ import jdk.internal.foreign.HeapMemorySegmentImpl;</span>
<span class="line-added">+ import jdk.internal.foreign.MappedMemorySegmentImpl;</span>
<span class="line-added">+ import jdk.internal.foreign.NativeMemorySegmentImpl;</span>
  
  import java.io.IOException;
  import java.nio.channels.FileChannel;
  import java.nio.file.Path;
  import java.util.Spliterator;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 289,11 ***</span>
       *
       * @param bb the byte buffer backing the buffer memory segment.
       * @return a new buffer memory segment.
       */
      static MemorySegment ofByteBuffer(ByteBuffer bb) {
<span class="line-modified">!         return Utils.makeBufferSegment(bb);</span>
      }
  
      /**
       * Creates a new array memory segment that models the memory associated with a given heap-allocated byte array.
       * &lt;p&gt;
<span class="line-new-header">--- 292,11 ---</span>
       *
       * @param bb the byte buffer backing the buffer memory segment.
       * @return a new buffer memory segment.
       */
      static MemorySegment ofByteBuffer(ByteBuffer bb) {
<span class="line-modified">!         return AbstractMemorySegmentImpl.ofBuffer(bb);</span>
      }
  
      /**
       * Creates a new array memory segment that models the memory associated with a given heap-allocated byte array.
       * &lt;p&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 302,11 ***</span>
       *
       * @param arr the primitive array backing the array memory segment.
       * @return a new array memory segment.
       */
      static MemorySegment ofArray(byte[] arr) {
<span class="line-modified">!         return Utils.makeArraySegment(arr);</span>
      }
  
      /**
       * Creates a new array memory segment that models the memory associated with a given heap-allocated char array.
       * &lt;p&gt;
<span class="line-new-header">--- 305,11 ---</span>
       *
       * @param arr the primitive array backing the array memory segment.
       * @return a new array memory segment.
       */
      static MemorySegment ofArray(byte[] arr) {
<span class="line-modified">!         return HeapMemorySegmentImpl.makeArraySegment(arr);</span>
      }
  
      /**
       * Creates a new array memory segment that models the memory associated with a given heap-allocated char array.
       * &lt;p&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 315,11 ***</span>
       *
       * @param arr the primitive array backing the array memory segment.
       * @return a new array memory segment.
       */
      static MemorySegment ofArray(char[] arr) {
<span class="line-modified">!         return Utils.makeArraySegment(arr);</span>
      }
  
      /**
       * Creates a new array memory segment that models the memory associated with a given heap-allocated short array.
       * &lt;p&gt;
<span class="line-new-header">--- 318,11 ---</span>
       *
       * @param arr the primitive array backing the array memory segment.
       * @return a new array memory segment.
       */
      static MemorySegment ofArray(char[] arr) {
<span class="line-modified">!         return HeapMemorySegmentImpl.makeArraySegment(arr);</span>
      }
  
      /**
       * Creates a new array memory segment that models the memory associated with a given heap-allocated short array.
       * &lt;p&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 328,11 ***</span>
       *
       * @param arr the primitive array backing the array memory segment.
       * @return a new array memory segment.
       */
      static MemorySegment ofArray(short[] arr) {
<span class="line-modified">!         return Utils.makeArraySegment(arr);</span>
      }
  
      /**
       * Creates a new array memory segment that models the memory associated with a given heap-allocated int array.
       * &lt;p&gt;
<span class="line-new-header">--- 331,11 ---</span>
       *
       * @param arr the primitive array backing the array memory segment.
       * @return a new array memory segment.
       */
      static MemorySegment ofArray(short[] arr) {
<span class="line-modified">!         return HeapMemorySegmentImpl.makeArraySegment(arr);</span>
      }
  
      /**
       * Creates a new array memory segment that models the memory associated with a given heap-allocated int array.
       * &lt;p&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 341,11 ***</span>
       *
       * @param arr the primitive array backing the array memory segment.
       * @return a new array memory segment.
       */
      static MemorySegment ofArray(int[] arr) {
<span class="line-modified">!         return Utils.makeArraySegment(arr);</span>
      }
  
      /**
       * Creates a new array memory segment that models the memory associated with a given heap-allocated float array.
       * &lt;p&gt;
<span class="line-new-header">--- 344,11 ---</span>
       *
       * @param arr the primitive array backing the array memory segment.
       * @return a new array memory segment.
       */
      static MemorySegment ofArray(int[] arr) {
<span class="line-modified">!         return HeapMemorySegmentImpl.makeArraySegment(arr);</span>
      }
  
      /**
       * Creates a new array memory segment that models the memory associated with a given heap-allocated float array.
       * &lt;p&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 354,11 ***</span>
       *
       * @param arr the primitive array backing the array memory segment.
       * @return a new array memory segment.
       */
      static MemorySegment ofArray(float[] arr) {
<span class="line-modified">!         return Utils.makeArraySegment(arr);</span>
      }
  
      /**
       * Creates a new array memory segment that models the memory associated with a given heap-allocated long array.
       * &lt;p&gt;
<span class="line-new-header">--- 357,11 ---</span>
       *
       * @param arr the primitive array backing the array memory segment.
       * @return a new array memory segment.
       */
      static MemorySegment ofArray(float[] arr) {
<span class="line-modified">!         return HeapMemorySegmentImpl.makeArraySegment(arr);</span>
      }
  
      /**
       * Creates a new array memory segment that models the memory associated with a given heap-allocated long array.
       * &lt;p&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 367,11 ***</span>
       *
       * @param arr the primitive array backing the array memory segment.
       * @return a new array memory segment.
       */
      static MemorySegment ofArray(long[] arr) {
<span class="line-modified">!         return Utils.makeArraySegment(arr);</span>
      }
  
      /**
       * Creates a new array memory segment that models the memory associated with a given heap-allocated double array.
       * &lt;p&gt;
<span class="line-new-header">--- 370,11 ---</span>
       *
       * @param arr the primitive array backing the array memory segment.
       * @return a new array memory segment.
       */
      static MemorySegment ofArray(long[] arr) {
<span class="line-modified">!         return HeapMemorySegmentImpl.makeArraySegment(arr);</span>
      }
  
      /**
       * Creates a new array memory segment that models the memory associated with a given heap-allocated double array.
       * &lt;p&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 380,11 ***</span>
       *
       * @param arr the primitive array backing the array memory segment.
       * @return a new array memory segment.
       */
      static MemorySegment ofArray(double[] arr) {
<span class="line-modified">!         return Utils.makeArraySegment(arr);</span>
      }
  
      /**
       * Creates a new native memory segment that models a newly allocated block of off-heap memory with given layout.
       * &lt;p&gt;
<span class="line-new-header">--- 383,11 ---</span>
       *
       * @param arr the primitive array backing the array memory segment.
       * @return a new array memory segment.
       */
      static MemorySegment ofArray(double[] arr) {
<span class="line-modified">!         return HeapMemorySegmentImpl.makeArraySegment(arr);</span>
      }
  
      /**
       * Creates a new native memory segment that models a newly allocated block of off-heap memory with given layout.
       * &lt;p&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 438,11 ***</span>
       * @throws IllegalArgumentException if {@code bytesSize &lt; 0}.
       * @throws UnsupportedOperationException if an unsupported map mode is specified.
       * @throws IOException if the specified path does not point to an existing file, or if some other I/O error occurs.
       */
      static MemorySegment mapFromPath(Path path, long bytesSize, FileChannel.MapMode mapMode) throws IOException {
<span class="line-modified">!         return Utils.makeMappedSegment(path, bytesSize, mapMode);</span>
      }
  
      /**
       * Creates a new native memory segment that models a newly allocated block of off-heap memory with given size and
       * alignment constraint (in bytes).
<span class="line-new-header">--- 441,11 ---</span>
       * @throws IllegalArgumentException if {@code bytesSize &lt; 0}.
       * @throws UnsupportedOperationException if an unsupported map mode is specified.
       * @throws IOException if the specified path does not point to an existing file, or if some other I/O error occurs.
       */
      static MemorySegment mapFromPath(Path path, long bytesSize, FileChannel.MapMode mapMode) throws IOException {
<span class="line-modified">!         return MappedMemorySegmentImpl.makeMappedSegment(path, bytesSize, mapMode);</span>
      }
  
      /**
       * Creates a new native memory segment that models a newly allocated block of off-heap memory with given size and
       * alignment constraint (in bytes).
</pre>
<hr />
<pre>
<span class="line-old-header">*** 465,11 ***</span>
          if (alignmentBytes &lt; 0 ||
                  ((alignmentBytes &amp; (alignmentBytes - 1)) != 0L)) {
              throw new IllegalArgumentException(&quot;Invalid alignment constraint : &quot; + alignmentBytes);
          }
  
<span class="line-modified">!         return Utils.makeNativeSegment(bytesSize, alignmentBytes);</span>
      }
  
      // access mode masks
  
      /**
<span class="line-new-header">--- 468,11 ---</span>
          if (alignmentBytes &lt; 0 ||
                  ((alignmentBytes &amp; (alignmentBytes - 1)) != 0L)) {
              throw new IllegalArgumentException(&quot;Invalid alignment constraint : &quot; + alignmentBytes);
          }
  
<span class="line-modified">!         return NativeMemorySegmentImpl.makeNativeSegment(bytesSize, alignmentBytes);</span>
      }
  
      // access mode masks
  
      /**
</pre>
<center><a href="MemoryAddress.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../internal/foreign/InternalForeign.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>