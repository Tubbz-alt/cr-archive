<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/tools/jextract/RepeatedDeclsTest.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="JextractToolRunner.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="repeatedDecls.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/tools/jextract/RepeatedDeclsTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 8  *
 9  * This code is distributed in the hope that it will be useful, but WITHOUT
10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
12  * version 2 for more details (a copy is included in the LICENSE file that
13  * accompanied this code).
14  *
15  * You should have received a copy of the GNU General Public License version
16  * 2 along with this work; if not, write to the Free Software Foundation,
17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
18  *
19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
20  * or visit www.oracle.com if you need additional information or have any
21  * questions.
22  */
23 
24 import org.testng.annotations.Test;
25 
26 import java.lang.reflect.Method;
27 import java.nio.file.Path;


28 import static org.testng.Assert.assertEquals;
29 import static org.testng.Assert.assertNotNull;
30 import static org.testng.Assert.assertTrue;
31 
32 /*
33  * @test
34  * @bug 8240300
35  * @summary jextract produces non compilable code with repeated declarations
36  * @modules jdk.incubator.jextract
37  * @build JextractToolRunner
38  * @run testng RepeatedDeclsTest
39  */
40 public class RepeatedDeclsTest extends JextractToolRunner {
41     @Test
42     public void repeatedDecls() {
43         Path repeatedDeclsOutput = getOutputFilePath(&quot;repeatedDeclsgen&quot;);
44         Path repeatedDeclsH = getInputFilePath(&quot;repeatedDecls.h&quot;);
45         run(&quot;-d&quot;, repeatedDeclsOutput.toString(), repeatedDeclsH.toString()).checkSuccess();
46         try(Loader loader = classLoader(repeatedDeclsOutput)) {
47             Class&lt;?&gt; cls = loader.loadClass(&quot;repeatedDecls_h&quot;);
48             // check a method for &quot;void func(int)&quot;
49             assertNotNull(findMethod(cls, &quot;func&quot;, int.class));
50 



51             // check a getter method for &quot;i&quot;
52             assertNotNull(findMethod(cls, &quot;i$get&quot;));
53 
54             // check a setter method for &quot;i&quot;
55             assertNotNull(findMethod(cls, &quot;i$set&quot;, int.class));





















56         } finally {
57             deleteDir(repeatedDeclsOutput);
58         }
59     }
60 }
</pre>
</td>
<td>
<hr />
<pre>
 8  *
 9  * This code is distributed in the hope that it will be useful, but WITHOUT
10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
12  * version 2 for more details (a copy is included in the LICENSE file that
13  * accompanied this code).
14  *
15  * You should have received a copy of the GNU General Public License version
16  * 2 along with this work; if not, write to the Free Software Foundation,
17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
18  *
19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
20  * or visit www.oracle.com if you need additional information or have any
21  * questions.
22  */
23 
24 import org.testng.annotations.Test;
25 
26 import java.lang.reflect.Method;
27 import java.nio.file.Path;
<span class="line-added">28 import jdk.incubator.foreign.MemoryLayout;</span>
<span class="line-added">29 import jdk.incubator.foreign.SystemABI.Type;</span>
30 import static org.testng.Assert.assertEquals;
31 import static org.testng.Assert.assertNotNull;
32 import static org.testng.Assert.assertTrue;
33 
34 /*
35  * @test
36  * @bug 8240300
37  * @summary jextract produces non compilable code with repeated declarations
38  * @modules jdk.incubator.jextract
39  * @build JextractToolRunner
40  * @run testng RepeatedDeclsTest
41  */
42 public class RepeatedDeclsTest extends JextractToolRunner {
43     @Test
44     public void repeatedDecls() {
45         Path repeatedDeclsOutput = getOutputFilePath(&quot;repeatedDeclsgen&quot;);
46         Path repeatedDeclsH = getInputFilePath(&quot;repeatedDecls.h&quot;);
47         run(&quot;-d&quot;, repeatedDeclsOutput.toString(), repeatedDeclsH.toString()).checkSuccess();
48         try(Loader loader = classLoader(repeatedDeclsOutput)) {
49             Class&lt;?&gt; cls = loader.loadClass(&quot;repeatedDecls_h&quot;);
50             // check a method for &quot;void func(int)&quot;
51             assertNotNull(findMethod(cls, &quot;func&quot;, int.class));
52 
<span class="line-added">53             // check a method for &quot;void func2(int)&quot;</span>
<span class="line-added">54             assertNotNull(findMethod(cls, &quot;func2&quot;, int.class));</span>
<span class="line-added">55 </span>
56             // check a getter method for &quot;i&quot;
57             assertNotNull(findMethod(cls, &quot;i$get&quot;));
58 
59             // check a setter method for &quot;i&quot;
60             assertNotNull(findMethod(cls, &quot;i$set&quot;, int.class));
<span class="line-added">61 </span>
<span class="line-added">62             // make sure that enum constants are generated fine</span>
<span class="line-added">63             checkIntField(cls, &quot;R&quot;, 0);</span>
<span class="line-added">64             checkIntField(cls, &quot;G&quot;, 1);</span>
<span class="line-added">65             checkIntField(cls, &quot;B&quot;, 2);</span>
<span class="line-added">66             checkIntField(cls, &quot;C&quot;, 0);</span>
<span class="line-added">67             checkIntField(cls, &quot;M&quot;, 1);</span>
<span class="line-added">68             checkIntField(cls, &quot;Y&quot;, 2);</span>
<span class="line-added">69 </span>
<span class="line-added">70             // check Point layout</span>
<span class="line-added">71             MemoryLayout pointLayout = findLayout(cls, &quot;Point&quot;);</span>
<span class="line-added">72             assertNotNull(pointLayout);</span>
<span class="line-added">73             checkFieldABIType(pointLayout, &quot;i&quot;,  Type.INT);</span>
<span class="line-added">74             checkFieldABIType(pointLayout, &quot;j&quot;,  Type.INT);</span>
<span class="line-added">75 </span>
<span class="line-added">76             // check Point3D layout</span>
<span class="line-added">77             MemoryLayout point3DLayout = findLayout(cls, &quot;Point3D&quot;);</span>
<span class="line-added">78             assertNotNull(point3DLayout);</span>
<span class="line-added">79             checkFieldABIType(point3DLayout, &quot;i&quot;,  Type.INT);</span>
<span class="line-added">80             checkFieldABIType(point3DLayout, &quot;j&quot;,  Type.INT);</span>
<span class="line-added">81             checkFieldABIType(point3DLayout, &quot;k&quot;,  Type.INT);</span>
82         } finally {
83             deleteDir(repeatedDeclsOutput);
84         }
85     }
86 }
</pre>
</td>
</tr>
</table>
<center><a href="JextractToolRunner.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="repeatedDecls.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>