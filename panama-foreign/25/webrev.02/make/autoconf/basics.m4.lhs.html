<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames make/autoconf/basics.m4</title>
    <link rel="stylesheet" href="../../style.css" />
    <script type="text/javascript" src="../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 #
<a name="1" id="anc1"></a><span class="line-modified">   2 # Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4 #
   5 # This code is free software; you can redistribute it and/or modify it
   6 # under the terms of the GNU General Public License version 2 only, as
   7 # published by the Free Software Foundation.  Oracle designates this
   8 # particular file as subject to the &quot;Classpath&quot; exception as provided
   9 # by Oracle in the LICENSE file that accompanied this code.
  10 #
  11 # This code is distributed in the hope that it will be useful, but WITHOUT
  12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14 # version 2 for more details (a copy is included in the LICENSE file that
  15 # accompanied this code).
  16 #
  17 # You should have received a copy of the GNU General Public License version
  18 # 2 along with this work; if not, write to the Free Software Foundation,
  19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20 #
  21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22 # or visit www.oracle.com if you need additional information or have any
  23 # questions.
  24 #
  25 
  26 ###############################################################################
  27 # Create a function/macro that takes a series of named arguments. The call is
  28 # similar to AC_DEFUN, but the setup of the function looks like this:
  29 # BASIC_DEFUN_NAMED([MYFUNC], [FOO *BAR], [$@], [
  30 # ... do something
  31 #   AC_MSG_NOTICE([Value of BAR is ARG_BAR])
  32 # ])
  33 # A star (*) in front of a named argument means that it is required and it&#39;s
  34 # presence will be verified. To pass e.g. the first value as a normal indexed
  35 # argument, use [m4_shift($@)] as the third argument instead of [$@]. These
  36 # arguments are referenced in the function by their name prefixed by ARG_, e.g.
  37 # &quot;ARG_FOO&quot;.
  38 #
  39 # The generated function can be called like this:
  40 # MYFUNC(FOO: [foo-val],
  41 #     BAR: [
  42 #         $ECHO hello world
  43 #     ])
  44 # Note that the argument value must start on the same line as the argument name.
  45 #
  46 # Argument 1: Name of the function to define
  47 # Argument 2: List of legal named arguments, with a * prefix for required arguments
  48 # Argument 3: Argument array to treat as named, typically $@
  49 # Argument 4: The main function body
  50 AC_DEFUN([BASIC_DEFUN_NAMED],
  51 [
  52   AC_DEFUN($1, [
  53     m4_foreach(arg, m4_split($2), [
  54       m4_if(m4_bregexp(arg, [^\*]), -1,
  55         [
  56           m4_set_add(legal_named_args, arg)
  57         ],
  58         [
  59           m4_set_add(legal_named_args, m4_substr(arg, 1))
  60           m4_set_add(required_named_args, m4_substr(arg, 1))
  61         ]
  62       )
  63     ])
  64 
  65     m4_foreach([arg], [$3], [
  66       m4_define(arg_name, m4_substr(arg, 0, m4_bregexp(arg, [: ])))
  67       m4_set_contains(legal_named_args, arg_name, [],[AC_MSG_ERROR([Internal error: arg_name is not a valid named argument to [$1]. Valid arguments are &#39;m4_set_contents(legal_named_args, [ ])&#39;.])])
  68       m4_set_remove(required_named_args, arg_name)
  69       m4_set_remove(legal_named_args, arg_name)
  70       m4_pushdef([ARG_][]arg_name, m4_substr(arg, m4_incr(m4_incr(m4_bregexp(arg, [: ])))))
  71       m4_set_add(defined_args, arg_name)
  72       m4_undefine([arg_name])
  73     ])
  74     m4_set_empty(required_named_args, [], [
  75       AC_MSG_ERROR([Internal error: Required named arguments are missing for [$1]. Missing arguments: &#39;m4_set_contents(required_named_args, [ ])&#39;])
  76     ])
  77     m4_foreach([arg], m4_indir([m4_dquote]m4_set_listc([legal_named_args])), [
  78       m4_pushdef([ARG_][]arg, [])
  79       m4_set_add(defined_args, arg)
  80     ])
  81     m4_set_delete(legal_named_args)
  82     m4_set_delete(required_named_args)
  83 
  84     # Execute function body
  85     $4
  86 
  87     m4_foreach([arg], m4_indir([m4_dquote]m4_set_listc([defined_args])), [
  88       m4_popdef([ARG_][]arg)
  89     ])
  90 
  91     m4_set_delete(defined_args)
  92   ])
  93 ])
  94 
  95 ###############################################################################
  96 # Check if a list of space-separated words are selected only from a list of
  97 # space-separated legal words. Typical use is to see if a user-specified
  98 # set of words is selected from a set of legal words.
  99 #
 100 # Sets the specified variable to list of non-matching (offending) words, or to
 101 # the empty string if all words are matching the legal set.
 102 #
 103 # $1: result variable name
 104 # $2: list of values to check
 105 # $3: list of legal values
 106 AC_DEFUN([BASIC_GET_NON_MATCHING_VALUES],
 107 [
 108   # grep filter function inspired by a comment to http://stackoverflow.com/a/1617326
 109   # Notice that the original variant fails on SLES 10 and 11
 110   # Some grep versions (at least bsd) behaves strangely on the base case with
 111   # no legal_values, so make it explicit.
 112   values_to_check=`$ECHO $2 | $TR &#39; &#39; &#39;\n&#39;`
 113   legal_values=`$ECHO $3 | $TR &#39; &#39; &#39;\n&#39;`
 114   if test -z &quot;$legal_values&quot;; then
 115     $1=&quot;$2&quot;
 116   else
 117     result=`$GREP -Fvx &quot;$legal_values&quot; &lt;&lt;&lt; &quot;$values_to_check&quot; | $GREP -v &#39;^$&#39;`
 118     $1=${result//$&#39;\n&#39;/ }
 119   fi
 120 ])
 121 
 122 ###############################################################################
 123 # Check if a list of space-separated words contains any word(s) from a list of
 124 # space-separated illegal words. Typical use is to see if a user-specified
 125 # set of words contains any from a set of illegal words.
 126 #
 127 # Sets the specified variable to list of matching illegal words, or to
 128 # the empty string if no words are matching the illegal set.
 129 #
 130 # $1: result variable name
 131 # $2: list of values to check
 132 # $3: list of illegal values
 133 AC_DEFUN([BASIC_GET_MATCHING_VALUES],
 134 [
 135   # grep filter function inspired by a comment to http://stackoverflow.com/a/1617326
 136   # Notice that the original variant fails on SLES 10 and 11
 137   # Some grep versions (at least bsd) behaves strangely on the base case with
 138   # no legal_values, so make it explicit.
 139   values_to_check=`$ECHO $2 | $TR &#39; &#39; &#39;\n&#39;`
 140   illegal_values=`$ECHO $3 | $TR &#39; &#39; &#39;\n&#39;`
 141   if test -z &quot;$illegal_values&quot;; then
 142     $1=&quot;&quot;
 143   else
 144     result=`$GREP -Fx &quot;$illegal_values&quot; &lt;&lt;&lt; &quot;$values_to_check&quot; | $GREP -v &#39;^$&#39;`
 145     $1=${result//$&#39;\n&#39;/ }
 146   fi
 147 ])
 148 
 149 ###############################################################################
 150 # Sort a space-separated list, and remove duplicates.
 151 #
 152 # Sets the specified variable to the resulting list.
 153 #
 154 # $1: result variable name
 155 # $2: list of values to sort
 156 AC_DEFUN([BASIC_SORT_LIST],
 157 [
 158   values_to_sort=`$ECHO $2 | $TR &#39; &#39; &#39;\n&#39;`
 159   result=`$SORT -u &lt;&lt;&lt; &quot;$values_to_sort&quot; | $GREP -v &#39;^$&#39;`
 160   $1=${result//$&#39;\n&#39;/ }
 161 ])
 162 
 163 ###############################################################################
 164 # Test if $1 is a valid argument to $3 (often is $JAVA passed as $3)
 165 # If so, then append $1 to $2 \
 166 # Also set JVM_ARG_OK to true/false depending on outcome.
 167 AC_DEFUN([ADD_JVM_ARG_IF_OK],
 168 [
 169   $ECHO &quot;Check if jvm arg is ok: $1&quot; &gt;&amp;AS_MESSAGE_LOG_FD
 170   $ECHO &quot;Command: $3 $1 -version&quot; &gt;&amp;AS_MESSAGE_LOG_FD
 171   OUTPUT=`$3 $1 $USER_BOOT_JDK_OPTIONS -version 2&gt;&amp;1`
 172   FOUND_WARN=`$ECHO &quot;$OUTPUT&quot; | $GREP -i warn`
 173   FOUND_VERSION=`$ECHO $OUTPUT | $GREP &quot; version \&quot;&quot;`
 174   if test &quot;x$FOUND_VERSION&quot; != x &amp;&amp; test &quot;x$FOUND_WARN&quot; = x; then
 175     $2=&quot;[$]$2 $1&quot;
 176     JVM_ARG_OK=true
 177   else
 178     $ECHO &quot;Arg failed:&quot; &gt;&amp;AS_MESSAGE_LOG_FD
 179     $ECHO &quot;$OUTPUT&quot; &gt;&amp;AS_MESSAGE_LOG_FD
 180     JVM_ARG_OK=false
 181   fi
 182 ])
 183 
 184 # Appends a string to a path variable, only adding the : when needed.
 185 AC_DEFUN([BASIC_APPEND_TO_PATH],
 186 [
 187   if test &quot;x$2&quot; != x; then
 188     if test &quot;x[$]$1&quot; = x; then
 189       $1=&quot;$2&quot;
 190     else
 191       $1=&quot;[$]$1:$2&quot;
 192     fi
 193   fi
 194 ])
 195 
 196 # Prepends a string to a path variable, only adding the : when needed.
 197 AC_DEFUN([BASIC_PREPEND_TO_PATH],
 198 [
 199   if test &quot;x$2&quot; != x; then
 200     if test &quot;x[$]$1&quot; = x; then
 201       $1=&quot;$2&quot;
 202     else
 203       $1=&quot;$2:[$]$1&quot;
 204     fi
 205   fi
 206 ])
 207 
 208 ################################################################################
 209 # This will make a path absolute. Assumes it&#39;s already a unix path. Also
 210 # resolves ~ to homedir.
 211 AC_DEFUN([BASIC_ABSOLUTE_PATH],
 212 [
 213   if test &quot;x[$]$1&quot; != x; then
 214     new_path=&quot;[$]$1&quot;
 215 
 216     # Use eval to expand a potential ~. This technique does not work if there
 217     # are spaces in the path (which is valid at this point on Windows), so only
 218     # try to apply it if there is an actual ~ first in the path.
 219     if [ [[ &quot;$new_path&quot; = &quot;~&quot;* ]] ]; then
 220       eval new_path=&quot;$new_path&quot;
 221       if test ! -f &quot;$new_path&quot; &amp;&amp; test ! -d &quot;$new_path&quot;; then
 222         AC_MSG_ERROR([The new_path of $1, which resolves as &quot;$new_path&quot;, is not found.])
 223       fi
 224     fi
 225 
 226     if test -d &quot;$new_path&quot;; then
 227       $1=&quot;`cd &quot;$new_path&quot;; $THEPWDCMD -L`&quot;
 228     else
 229       dir=&quot;`$DIRNAME &quot;$new_path&quot;`&quot;
 230       base=&quot;`$BASENAME &quot;$new_path&quot;`&quot;
 231       $1=&quot;`cd &quot;$dir&quot;; $THEPWDCMD -L`/$base&quot;
 232     fi
 233   fi
 234 ])
 235 
 236 ###############################################################################
 237 # This will make sure the given variable points to a full and proper
 238 # path. This means:
 239 # 1) There will be no spaces in the path. On unix platforms,
 240 #    spaces in the path will result in an error. On Windows,
 241 #    the path will be rewritten using short-style to be space-free.
 242 # 2) The path will be absolute, and it will be in unix-style (on
 243 #     cygwin).
 244 # $1: The name of the variable to fix
 245 AC_DEFUN([BASIC_FIXUP_PATH],
 246 [
 247   # Only process if variable expands to non-empty
 248   if test &quot;x[$]$1&quot; != x; then
 249     if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.cygwin&quot;; then
 250       BASIC_FIXUP_PATH_CYGWIN($1)
 251     elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.msys&quot;; then
 252       BASIC_FIXUP_PATH_MSYS($1)
 253     elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
 254       BASIC_FIXUP_PATH_WSL($1)
 255     else
 256       # We&#39;re on a unix platform. Hooray! :)
 257       path=&quot;[$]$1&quot;
 258       has_space=`$ECHO &quot;$path&quot; | $GREP &quot; &quot;`
 259       if test &quot;x$has_space&quot; != x; then
 260         AC_MSG_NOTICE([The path of $1, which resolves as &quot;$path&quot;, is invalid.])
 261         AC_MSG_ERROR([Spaces are not allowed in this path.])
 262       fi
 263 
 264       BASIC_ABSOLUTE_PATH(path)
 265       $1=&quot;$path&quot;
 266     fi
 267   fi
 268 ])
 269 
 270 ###############################################################################
 271 # This will make sure the given variable points to a executable
 272 # with a full and proper path. This means:
 273 # 1) There will be no spaces in the path. On unix platforms,
 274 #    spaces in the path will result in an error. On Windows,
 275 #    the path will be rewritten using short-style to be space-free.
 276 # 2) The path will be absolute, and it will be in unix-style (on
 277 #     cygwin).
 278 # Any arguments given to the executable is preserved.
 279 # If the input variable does not have a directory specification, then
 280 # it need to be in the PATH.
 281 # $1: The name of the variable to fix
 282 AC_DEFUN([BASIC_FIXUP_EXECUTABLE],
 283 [
 284   # Only process if variable expands to non-empty
 285 
 286   if test &quot;x[$]$1&quot; != x; then
 287     if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.cygwin&quot;; then
 288       BASIC_FIXUP_EXECUTABLE_CYGWIN($1)
 289     elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.msys&quot;; then
 290       BASIC_FIXUP_EXECUTABLE_MSYS($1)
 291     elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
 292       BASIC_FIXUP_EXECUTABLE_WSL($1)
 293     else
 294       # We&#39;re on a unix platform. Hooray! :)
 295       # First separate the path from the arguments. This will split at the first
 296       # space.
 297       complete=&quot;[$]$1&quot;
 298       path=&quot;${complete%% *}&quot;
 299       tmp=&quot;$complete EOL&quot;
 300       arguments=&quot;${tmp#* }&quot;
 301 
 302       # Cannot rely on the command &quot;which&quot; here since it doesn&#39;t always work.
 303       is_absolute_path=`$ECHO &quot;$path&quot; | $GREP ^/`
 304       if test -z &quot;$is_absolute_path&quot;; then
 305         # Path to executable is not absolute. Find it.
 306         IFS_save=&quot;$IFS&quot;
 307         IFS=:
 308         for p in $PATH; do
 309           if test -f &quot;$p/$path&quot; &amp;&amp; test -x &quot;$p/$path&quot;; then
 310             new_path=&quot;$p/$path&quot;
 311             break
 312           fi
 313         done
 314         IFS=&quot;$IFS_save&quot;
 315       else
 316         # This is an absolute path, we can use it without further modifications.
 317         new_path=&quot;$path&quot;
 318       fi
 319 
 320       if test &quot;x$new_path&quot; = x; then
 321         AC_MSG_NOTICE([The path of $1, which resolves as &quot;$complete&quot;, is not found.])
 322         has_space=`$ECHO &quot;$complete&quot; | $GREP &quot; &quot;`
 323         if test &quot;x$has_space&quot; != x; then
 324           AC_MSG_NOTICE([This might be caused by spaces in the path, which is not allowed.])
 325         fi
 326         AC_MSG_ERROR([Cannot locate the the path of $1])
 327       fi
 328     fi
 329 
 330     # Now join together the path and the arguments once again
 331     if test &quot;x$arguments&quot; != xEOL; then
 332       new_complete=&quot;$new_path ${arguments% *}&quot;
 333     else
 334       new_complete=&quot;$new_path&quot;
 335     fi
 336 
 337     if test &quot;x$complete&quot; != &quot;x$new_complete&quot;; then
 338       $1=&quot;$new_complete&quot;
 339       AC_MSG_NOTICE([Rewriting $1 to &quot;$new_complete&quot;])
 340     fi
 341   fi
 342 ])
 343 
 344 ###############################################################################
 345 AC_DEFUN([BASIC_REMOVE_SYMBOLIC_LINKS],
 346 [
 347   if test &quot;x$OPENJDK_BUILD_OS&quot; != xwindows; then
 348     # Follow a chain of symbolic links. Use readlink
 349     # where it exists, else fall back to horribly
 350     # complicated shell code.
 351     if test &quot;x$READLINK_TESTED&quot; != yes; then
 352       # On MacOSX there is a readlink tool with a different
 353       # purpose than the GNU readlink tool. Check the found readlink.
 354       READLINK_ISGNU=`$READLINK --version 2&gt;&amp;1 | $GREP GNU`
 355       # If READLINK_ISGNU is empty, then it&#39;s a non-GNU readlink. Don&#39;t use it.
 356       READLINK_TESTED=yes
 357     fi
 358 
 359     if test &quot;x$READLINK&quot; != x &amp;&amp; test &quot;x$READLINK_ISGNU&quot; != x; then
 360       $1=`$READLINK -f [$]$1`
 361     else
 362       # Save the current directory for restoring afterwards
 363       STARTDIR=$PWD
 364       COUNTER=0
 365       sym_link_dir=`$DIRNAME [$]$1`
 366       sym_link_file=`$BASENAME [$]$1`
 367       cd $sym_link_dir
 368       # Use -P flag to resolve symlinks in directories.
 369       cd `$THEPWDCMD -P`
 370       sym_link_dir=`$THEPWDCMD -P`
 371       # Resolve file symlinks
 372       while test $COUNTER -lt 20; do
 373         ISLINK=`$LS -l $sym_link_dir/$sym_link_file | $GREP &#39;\-&gt;&#39; | $SED -e &#39;s/.*-&gt; \(.*\)/\1/&#39;`
 374         if test &quot;x$ISLINK&quot; == x; then
 375           # This is not a symbolic link! We are done!
 376           break
 377         fi
 378         # Again resolve directory symlinks since the target of the just found
 379         # link could be in a different directory
 380         cd `$DIRNAME $ISLINK`
 381         sym_link_dir=`$THEPWDCMD -P`
 382         sym_link_file=`$BASENAME $ISLINK`
 383         let COUNTER=COUNTER+1
 384       done
 385       cd $STARTDIR
 386       $1=$sym_link_dir/$sym_link_file
 387     fi
 388   fi
 389 ])
 390 
 391 ###############################################################################
 392 # Register a --with argument but mark it as deprecated
 393 # $1: The name of the with argument to deprecate, not including --with-
 394 AC_DEFUN([BASIC_DEPRECATED_ARG_WITH],
 395 [
 396   AC_ARG_WITH($1, [AS_HELP_STRING([--with-$1],
 397       [Deprecated. Option is kept for backwards compatibility and is ignored])],
 398       [AC_MSG_WARN([Option --with-$1 is deprecated and will be ignored.])])
 399 ])
 400 
 401 ###############################################################################
 402 # Register a --enable argument but mark it as deprecated
 403 # $1: The name of the with argument to deprecate, not including --enable-
 404 # $2: The name of the argument to deprecate, in shell variable style (i.e. with _ instead of -)
 405 # $3: Messages to user.
 406 AC_DEFUN([BASIC_DEPRECATED_ARG_ENABLE],
 407 [
 408   AC_ARG_ENABLE($1, [AS_HELP_STRING([--enable-$1],
 409       [Deprecated. Option is kept for backwards compatibility and is ignored])])
 410   if test &quot;x$enable_$2&quot; != x; then
 411     AC_MSG_WARN([Option --enable-$1 is deprecated and will be ignored.])
 412 
 413     if test &quot;x$3&quot; != x; then
 414       AC_MSG_WARN([$3])
 415     fi
 416 
 417   fi
 418 ])
 419 
 420 ###############################################################################
<a name="2" id="anc2"></a>














 421 AC_DEFUN_ONCE([BASIC_INIT],
 422 [
 423   # Save the original command line. This is passed to us by the wrapper configure script.
 424   AC_SUBST(CONFIGURE_COMMAND_LINE)
 425   # AUTOCONF might be set in the environment by the user. Preserve for &quot;make reconfigure&quot;.
 426   AC_SUBST(AUTOCONF)
 427   # Save the path variable before it gets changed
 428   ORIGINAL_PATH=&quot;$PATH&quot;
 429   AC_SUBST(ORIGINAL_PATH)
 430   DATE_WHEN_CONFIGURED=`date`
 431   AC_SUBST(DATE_WHEN_CONFIGURED)
 432   AC_MSG_NOTICE([Configuration created at $DATE_WHEN_CONFIGURED.])
 433 ])
 434 
 435 ###############################################################################
 436 # Test that variable $1 denoting a program is not empty. If empty, exit with an error.
 437 # $1: variable to check
 438 AC_DEFUN([BASIC_CHECK_NONEMPTY],
 439 [
 440   if test &quot;x[$]$1&quot; = x; then
 441     AC_MSG_ERROR([Could not find required tool for $1])
 442   fi
 443 ])
 444 
 445 ###############################################################################
 446 # Check that there are no unprocessed overridden variables left.
 447 # If so, they are an incorrect argument and we will exit with an error.
 448 AC_DEFUN([BASIC_CHECK_LEFTOVER_OVERRIDDEN],
 449 [
 450   if test &quot;x$CONFIGURE_OVERRIDDEN_VARIABLES&quot; != x; then
 451     # Replace the separating ! with spaces before presenting for end user.
 452     unknown_variables=${CONFIGURE_OVERRIDDEN_VARIABLES//!/ }
 453     AC_MSG_WARN([The following variables might be unknown to configure: $unknown_variables])
 454   fi
 455 ])
 456 
 457 ###############################################################################
 458 # Setup a tool for the given variable. If correctly specified by the user,
 459 # use that value, otherwise search for the tool using the supplied code snippet.
 460 # $1: variable to set
 461 # $2: code snippet to call to look for the tool
 462 # $3: code snippet to call if variable was used to find tool
 463 AC_DEFUN([BASIC_SETUP_TOOL],
 464 [
 465   # Publish this variable in the help.
 466   AC_ARG_VAR($1, [Override default value for $1])
 467 
 468   if [[ -z &quot;${$1+x}&quot; ]]; then
 469     # The variable is not set by user, try to locate tool using the code snippet
 470     $2
 471   else
 472     # The variable is set, but is it from the command line or the environment?
 473 
 474     # Try to remove the string !$1! from our list.
 475     try_remove_var=${CONFIGURE_OVERRIDDEN_VARIABLES//!$1!/}
 476     if test &quot;x$try_remove_var&quot; = &quot;x$CONFIGURE_OVERRIDDEN_VARIABLES&quot;; then
 477       # If it failed, the variable was not from the command line. Ignore it,
 478       # but warn the user (except for BASH, which is always set by the calling BASH).
 479       if test &quot;x$1&quot; != xBASH; then
 480         AC_MSG_WARN([Ignoring value of $1 from the environment. Use command line variables instead.])
 481       fi
 482       # Try to locate tool using the code snippet
 483       $2
 484     else
 485       # If it succeeded, then it was overridden by the user. We will use it
 486       # for the tool.
 487 
 488       # First remove it from the list of overridden variables, so we can test
 489       # for unknown variables in the end.
 490       CONFIGURE_OVERRIDDEN_VARIABLES=&quot;$try_remove_var&quot;
 491 
 492       tool_override=[$]$1
 493       AC_MSG_NOTICE([User supplied override $1=&quot;$tool_override&quot;])
 494 
 495       # Check if we try to supply an empty value
 496       if test &quot;x$tool_override&quot; = x; then
 497         AC_MSG_CHECKING([for $1])
 498         AC_MSG_RESULT([disabled])
 499       else
 500         # Split up override in command part and argument part
 501         tool_and_args=($tool_override)
 502         [ tool_command=${tool_and_args[0]} ]
 503         [ unset &#39;tool_and_args[0]&#39; ]
 504         [ tool_args=${tool_and_args[@]} ]
 505 
 506         # Check if the provided tool contains a complete path.
 507         tool_basename=&quot;${tool_command##*/}&quot;
 508         if test &quot;x$tool_basename&quot; = &quot;x$tool_command&quot;; then
 509           # A command without a complete path is provided, search $PATH.
 510           AC_MSG_NOTICE([Will search for user supplied tool &quot;$tool_basename&quot;])
 511           AC_PATH_PROG($1, $tool_basename)
 512           if test &quot;x[$]$1&quot; = x; then
 513             AC_MSG_ERROR([User supplied tool $1=&quot;$tool_basename&quot; could not be found])
 514           fi
 515         else
 516           # Otherwise we believe it is a complete path. Use it as it is.
 517           AC_MSG_NOTICE([Will use user supplied tool &quot;$tool_command&quot;])
 518           AC_MSG_CHECKING([for $tool_command])
 519           if test ! -x &quot;$tool_command&quot;; then
 520             AC_MSG_RESULT([not found])
 521             AC_MSG_ERROR([User supplied tool $1=&quot;$tool_command&quot; does not exist or is not executable])
 522           fi
 523            $1=&quot;$tool_command&quot;
 524           AC_MSG_RESULT([found])
 525         fi
 526         if test &quot;x$tool_args&quot; != x; then
 527           # If we got arguments, re-append them to the command after the fixup.
 528           $1=&quot;[$]$1 $tool_args&quot;
 529         fi
 530       fi
 531     fi
 532     $3
 533   fi
 534 ])
 535 
 536 ###############################################################################
 537 # Call BASIC_SETUP_TOOL with AC_PATH_PROGS to locate the tool
 538 # $1: variable to set
 539 # $2: executable name (or list of names) to look for
 540 # $3: [path]
 541 AC_DEFUN([BASIC_PATH_PROGS],
 542 [
 543   BASIC_SETUP_TOOL($1, [AC_PATH_PROGS($1, $2, , $3)])
 544 ])
 545 
 546 ###############################################################################
 547 # Call BASIC_SETUP_TOOL with AC_CHECK_TOOLS to locate the tool
 548 # $1: variable to set
 549 # $2: executable name (or list of names) to look for
 550 AC_DEFUN([BASIC_CHECK_TOOLS],
 551 [
 552   BASIC_SETUP_TOOL($1, [AC_CHECK_TOOLS($1, $2)])
 553 ])
 554 
 555 ###############################################################################
 556 # Like BASIC_PATH_PROGS but fails if no tool was found.
 557 # $1: variable to set
 558 # $2: executable name (or list of names) to look for
 559 # $3: [path]
 560 AC_DEFUN([BASIC_REQUIRE_PROGS],
 561 [
 562   BASIC_PATH_PROGS($1, $2, , $3)
 563   BASIC_CHECK_NONEMPTY($1)
 564 ])
 565 
 566 ###############################################################################
 567 # Like BASIC_SETUP_TOOL but fails if no tool was found.
 568 # $1: variable to set
 569 # $2: autoconf macro to call to look for the special tool
 570 AC_DEFUN([BASIC_REQUIRE_SPECIAL],
 571 [
 572   BASIC_SETUP_TOOL($1, [$2])
 573   BASIC_CHECK_NONEMPTY($1)
 574 ])
 575 
 576 ###############################################################################
 577 # Like BASIC_REQUIRE_PROGS but also allows for bash built-ins
 578 # $1: variable to set
 579 # $2: executable name (or list of names) to look for
 580 # $3: [path]
 581 AC_DEFUN([BASIC_REQUIRE_BUILTIN_PROGS],
 582 [
 583   BASIC_SETUP_TOOL($1, [AC_PATH_PROGS($1, $2, , $3)])
 584   if test &quot;x[$]$1&quot; = x; then
 585     AC_MSG_NOTICE([Required tool $2 not found in PATH, checking built-in])
 586     if help $2 &gt; /dev/null 2&gt;&amp;1; then
 587       AC_MSG_NOTICE([Found $2 as shell built-in. Using it])
 588       $1=&quot;$2&quot;
 589     else
 590       AC_MSG_ERROR([Required tool $2 also not found as built-in.])
 591     fi
 592   fi
 593   BASIC_CHECK_NONEMPTY($1)
 594 ])
 595 
 596 ###############################################################################
 597 # Setup the most fundamental tools that relies on not much else to set up,
 598 # but is used by much of the early bootstrap code.
 599 AC_DEFUN_ONCE([BASIC_SETUP_FUNDAMENTAL_TOOLS],
 600 [
 601   # Start with tools that do not need have cross compilation support
 602   # and can be expected to be found in the default PATH. These tools are
 603   # used by configure.
 604 
 605   # First are all the simple required tools.
 606   BASIC_REQUIRE_PROGS(BASENAME, basename)
 607   BASIC_REQUIRE_PROGS(BASH, bash)
 608   BASIC_REQUIRE_PROGS(CAT, cat)
 609   BASIC_REQUIRE_PROGS(CHMOD, chmod)
 610   BASIC_REQUIRE_PROGS(CMP, cmp)
 611   BASIC_REQUIRE_PROGS(COMM, comm)
 612   BASIC_REQUIRE_PROGS(CP, cp)
 613   BASIC_REQUIRE_PROGS(CUT, cut)
 614   BASIC_REQUIRE_PROGS(DATE, date)
 615   BASIC_REQUIRE_PROGS(DIFF, [gdiff diff])
 616   BASIC_REQUIRE_PROGS(DIRNAME, dirname)
 617   BASIC_REQUIRE_PROGS(ECHO, echo)
 618   BASIC_REQUIRE_PROGS(EXPR, expr)
 619   BASIC_REQUIRE_PROGS(FILE, file)
 620   BASIC_REQUIRE_PROGS(FIND, find)
 621   BASIC_REQUIRE_PROGS(HEAD, head)
 622   BASIC_REQUIRE_PROGS(GUNZIP, gunzip)
 623   BASIC_REQUIRE_PROGS(GZIP, pigz gzip)
 624   BASIC_REQUIRE_PROGS(LN, ln)
 625   BASIC_REQUIRE_PROGS(LS, ls)
 626   # gmkdir is known to be safe for concurrent invocations with -p flag.
 627   BASIC_REQUIRE_PROGS(MKDIR, [gmkdir mkdir])
 628   BASIC_REQUIRE_PROGS(MKTEMP, mktemp)
 629   BASIC_REQUIRE_PROGS(MV, mv)
 630   BASIC_REQUIRE_PROGS(NAWK, [nawk gawk awk])
 631   BASIC_REQUIRE_PROGS(PRINTF, printf)
 632   BASIC_REQUIRE_PROGS(READLINK, [greadlink readlink])
 633   BASIC_REQUIRE_PROGS(RM, rm)
 634   BASIC_REQUIRE_PROGS(RMDIR, rmdir)
 635   BASIC_REQUIRE_PROGS(SH, sh)
 636   BASIC_REQUIRE_PROGS(SORT, sort)
 637   BASIC_REQUIRE_PROGS(TAIL, tail)
 638   BASIC_REQUIRE_PROGS(TAR, gtar tar)
 639   BASIC_REQUIRE_PROGS(TEE, tee)
 640   BASIC_REQUIRE_PROGS(TOUCH, touch)
 641   BASIC_REQUIRE_PROGS(TR, tr)
 642   BASIC_REQUIRE_PROGS(UNAME, uname)
 643   BASIC_REQUIRE_PROGS(UNIQ, uniq)
 644   BASIC_REQUIRE_PROGS(WC, wc)
 645   BASIC_REQUIRE_PROGS(WHICH, which)
 646   BASIC_REQUIRE_PROGS(XARGS, xargs)
 647 
 648   # Then required tools that require some special treatment.
 649   BASIC_REQUIRE_SPECIAL(AWK, [AC_PROG_AWK])
 650   BASIC_REQUIRE_SPECIAL(GREP, [AC_PROG_GREP])
 651   BASIC_REQUIRE_SPECIAL(EGREP, [AC_PROG_EGREP])
 652   BASIC_REQUIRE_SPECIAL(FGREP, [AC_PROG_FGREP])
 653   BASIC_REQUIRE_SPECIAL(SED, [AC_PROG_SED])
 654 
 655   # Always force rm.
 656   RM=&quot;$RM -f&quot;
 657 
 658   # pwd behaves differently on various platforms and some don&#39;t support the -L flag.
 659   # Always use the bash builtin pwd to get uniform behavior.
 660   THEPWDCMD=pwd
 661 
 662   # These are not required on all platforms
 663   BASIC_PATH_PROGS(CYGPATH, cygpath)
 664   BASIC_PATH_PROGS(WSLPATH, wslpath)
 665   BASIC_PATH_PROGS(DF, df)
 666   BASIC_PATH_PROGS(CPIO, [cpio bsdcpio])
 667   BASIC_PATH_PROGS(NICE, nice)
 668 
 669   BASIC_PATH_PROGS(LSB_RELEASE, lsb_release)
 670   BASIC_PATH_PROGS(CMD, [cmd.exe /mnt/c/Windows/System32/cmd.exe])
 671 ])
 672 
 673 ###############################################################################
 674 # Setup basic configuration paths, and platform-specific stuff related to PATHs.
 675 AC_DEFUN_ONCE([BASIC_SETUP_PATHS],
 676 [
 677   # Save the current directory this script was started from
 678   CONFIGURE_START_DIR=&quot;$PWD&quot;
 679 
 680   # We might need to rewrite ORIGINAL_PATH, if it includes &quot;#&quot;, to quote them
 681   # for make. We couldn&#39;t do this when we retrieved ORIGINAL_PATH, since SED
 682   # was not available at that time.
 683   REWRITTEN_PATH=`$ECHO &quot;$ORIGINAL_PATH&quot; | $SED -e &#39;s/#/\\\\#/g&#39;`
 684   if test &quot;x$REWRITTEN_PATH&quot; != &quot;x$ORIGINAL_PATH&quot;; then
 685     ORIGINAL_PATH=&quot;$REWRITTEN_PATH&quot;
 686     AC_MSG_NOTICE([Rewriting ORIGINAL_PATH to $REWRITTEN_PATH])
 687   fi
 688 
 689   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xwindows&quot;; then
 690     PATH_SEP=&quot;;&quot;
 691     EXE_SUFFIX=&quot;.exe&quot;
 692     BASIC_CHECK_PATHS_WINDOWS
 693   else
 694     PATH_SEP=&quot;:&quot;
 695     EXE_SUFFIX=&quot;&quot;
 696   fi
 697   AC_SUBST(PATH_SEP)
 698   AC_SUBST(EXE_SUFFIX)
 699 
 700   # We get the top-level directory from the supporting wrappers.
 701   AC_MSG_CHECKING([for top-level directory])
 702   AC_MSG_RESULT([$TOPDIR])
 703   AC_SUBST(TOPDIR)
 704   AC_SUBST(CONFIGURE_START_DIR)
 705 
 706   # We can only call BASIC_FIXUP_PATH after BASIC_CHECK_PATHS_WINDOWS.
 707   BASIC_FIXUP_PATH(CONFIGURE_START_DIR)
 708   BASIC_FIXUP_PATH(TOPDIR)
 709 
 710   # Locate the directory of this script.
 711   AUTOCONF_DIR=$TOPDIR/make/autoconf
 712 
 713   # Setup username (for use in adhoc version strings etc)
 714   # Outer [ ] to quote m4.
 715   [ USERNAME=`$ECHO &quot;$USER&quot; | $TR -d -c &#39;[a-z][A-Z][0-9]&#39;` ]
 716   AC_SUBST(USERNAME)
 717 ])
 718 
 719 ###############################################################################
 720 # Evaluates platform specific overrides for devkit variables.
 721 # $1: Name of variable
 722 AC_DEFUN([BASIC_EVAL_DEVKIT_VARIABLE],
 723 [
 724   if test &quot;x[$]$1&quot; = x; then
 725     eval $1=&quot;\${$1_${OPENJDK_TARGET_CPU}}&quot;
 726   fi
 727 ])
 728 
 729 ###############################################################################
 730 AC_DEFUN_ONCE([BASIC_SETUP_DEVKIT],
 731 [
 732   AC_ARG_WITH([devkit], [AS_HELP_STRING([--with-devkit],
 733       [use this devkit for compilers, tools and resources])])
 734 
 735   if test &quot;x$with_devkit&quot; = xyes; then
 736     AC_MSG_ERROR([--with-devkit must have a value])
 737   elif test &quot;x$with_devkit&quot; != x &amp;&amp; test &quot;x$with_devkit&quot; != xno; then
 738     BASIC_FIXUP_PATH([with_devkit])
 739     DEVKIT_ROOT=&quot;$with_devkit&quot;
 740     # Check for a meta data info file in the root of the devkit
 741     if test -f &quot;$DEVKIT_ROOT/devkit.info&quot;; then
 742       . $DEVKIT_ROOT/devkit.info
 743       # This potentially sets the following:
 744       # A descriptive name of the devkit
 745       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_NAME])
 746       # Corresponds to --with-extra-path
 747       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_EXTRA_PATH])
 748       # Corresponds to --with-toolchain-path
 749       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_TOOLCHAIN_PATH])
 750       # Corresponds to --with-sysroot
 751       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_SYSROOT])
 752 
 753       # Identifies the Visual Studio version in the devkit
 754       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_VS_VERSION])
 755       # The Visual Studio include environment variable
 756       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_VS_INCLUDE])
 757       # The Visual Studio lib environment variable
 758       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_VS_LIB])
 759       # Corresponds to --with-msvcr-dll
 760       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_MSVCR_DLL])
 761       # Corresponds to --with-msvcp-dll
 762       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_MSVCP_DLL])
 763       # Corresponds to --with-ucrt-dll-dir
 764       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_UCRT_DLL_DIR])
 765     fi
 766 
 767     AC_MSG_CHECKING([for devkit])
 768     if test &quot;x$DEVKIT_NAME&quot; != x; then
 769       AC_MSG_RESULT([$DEVKIT_NAME in $DEVKIT_ROOT])
 770     else
 771       AC_MSG_RESULT([$DEVKIT_ROOT])
 772     fi
 773 
 774     BASIC_PREPEND_TO_PATH([EXTRA_PATH],$DEVKIT_EXTRA_PATH)
 775 
 776     # Fallback default of just /bin if DEVKIT_PATH is not defined
 777     if test &quot;x$DEVKIT_TOOLCHAIN_PATH&quot; = x; then
 778       DEVKIT_TOOLCHAIN_PATH=&quot;$DEVKIT_ROOT/bin&quot;
 779     fi
 780     BASIC_PREPEND_TO_PATH([TOOLCHAIN_PATH],$DEVKIT_TOOLCHAIN_PATH)
 781 
 782     # If DEVKIT_SYSROOT is set, use that, otherwise try a couple of known
 783     # places for backwards compatiblity.
 784     if test &quot;x$DEVKIT_SYSROOT&quot; != x; then
 785       SYSROOT=&quot;$DEVKIT_SYSROOT&quot;
 786     elif test -d &quot;$DEVKIT_ROOT/$host_alias/libc&quot;; then
 787       SYSROOT=&quot;$DEVKIT_ROOT/$host_alias/libc&quot;
 788     elif test -d &quot;$DEVKIT_ROOT/$host/sys-root&quot;; then
 789       SYSROOT=&quot;$DEVKIT_ROOT/$host/sys-root&quot;
 790     fi
 791 
 792     if test &quot;x$DEVKIT_ROOT&quot; != x; then
 793       DEVKIT_LIB_DIR=&quot;$DEVKIT_ROOT/lib&quot;
 794       if test &quot;x$OPENJDK_TARGET_CPU_BITS&quot; = x64; then
 795         DEVKIT_LIB_DIR=&quot;$DEVKIT_ROOT/lib64&quot;
 796       fi
 797       AC_SUBST(DEVKIT_LIB_DIR)
 798     fi
 799   fi
 800 
 801   # You can force the sysroot if the sysroot encoded into the compiler tools
 802   # is not correct.
 803   AC_ARG_WITH(sys-root, [AS_HELP_STRING([--with-sys-root],
 804       [alias for --with-sysroot for backwards compatability])],
 805       [SYSROOT=$with_sys_root]
 806   )
 807 
 808   AC_ARG_WITH(sysroot, [AS_HELP_STRING([--with-sysroot],
 809       [use this directory as sysroot])],
 810       [SYSROOT=$with_sysroot]
 811   )
 812 
 813   AC_ARG_WITH([tools-dir], [AS_HELP_STRING([--with-tools-dir],
 814       [alias for --with-toolchain-path for backwards compatibility])],
 815       [BASIC_PREPEND_TO_PATH([TOOLCHAIN_PATH],$with_tools_dir)]
 816   )
 817 
 818   AC_ARG_WITH([toolchain-path], [AS_HELP_STRING([--with-toolchain-path],
 819       [prepend these directories when searching for toolchain binaries (compilers etc)])],
 820       [BASIC_PREPEND_TO_PATH([TOOLCHAIN_PATH],$with_toolchain_path)]
 821   )
 822 
 823   AC_ARG_WITH([extra-path], [AS_HELP_STRING([--with-extra-path],
 824       [prepend these directories to the default path])],
 825       [BASIC_PREPEND_TO_PATH([EXTRA_PATH],$with_extra_path)]
 826   )
 827 
 828   if test &quot;x$OPENJDK_BUILD_OS&quot; = &quot;xmacosx&quot;; then
 829     # If a devkit has been supplied, find xcodebuild in the toolchain_path.
 830     # If not, detect if Xcode is installed by running xcodebuild -version
 831     # if no Xcode installed, xcodebuild exits with 1
 832     # if Xcode is installed, even if xcode-select is misconfigured, then it exits with 0
 833     if test &quot;x$DEVKIT_ROOT&quot; != x || /usr/bin/xcodebuild -version &gt;/dev/null 2&gt;&amp;1; then
 834       # We need to use xcodebuild in the toolchain dir provided by the user, this will
 835       # fall back on the stub binary in /usr/bin/xcodebuild
 836       AC_PATH_PROG([XCODEBUILD], [xcodebuild], [/usr/bin/xcodebuild], [$TOOLCHAIN_PATH])
 837     else
 838       # this should result in SYSROOT being empty, unless --with-sysroot is provided
 839       # when only the command line tools are installed there are no SDKs, so headers
 840       # are copied into the system frameworks
 841       XCODEBUILD=
 842       AC_SUBST(XCODEBUILD)
 843     fi
 844 
 845     AC_MSG_CHECKING([for sdk name])
 846     AC_ARG_WITH([sdk-name], [AS_HELP_STRING([--with-sdk-name],
 847         [use the platform SDK of the given name. @&lt;:@macosx@:&gt;@])],
 848         [SDKNAME=$with_sdk_name]
 849     )
 850     AC_MSG_RESULT([$SDKNAME])
 851 
 852     # if toolchain path is specified then don&#39;t rely on system headers, they may not compile
 853     HAVE_SYSTEM_FRAMEWORK_HEADERS=0
 854     test -z &quot;$TOOLCHAIN_PATH&quot; &amp;&amp; \
 855       HAVE_SYSTEM_FRAMEWORK_HEADERS=`test ! -f /System/Library/Frameworks/Foundation.framework/Headers/Foundation.h; echo $?`
 856 
 857     if test -z &quot;$SYSROOT&quot;; then
 858       if test -n &quot;$XCODEBUILD&quot;; then
 859         # if we don&#39;t have system headers, use default SDK name (last resort)
 860         if test -z &quot;$SDKNAME&quot; -a $HAVE_SYSTEM_FRAMEWORK_HEADERS -eq 0; then
 861           SDKNAME=${SDKNAME:-macosx}
 862         fi
 863 
 864         if test -n &quot;$SDKNAME&quot;; then
 865           # Call xcodebuild to determine SYSROOT
 866           SYSROOT=`&quot;$XCODEBUILD&quot; -sdk $SDKNAME -version | $GREP &#39;^Path: &#39; | $SED &#39;s/Path: //&#39;`
 867         fi
 868       else
 869         if test $HAVE_SYSTEM_FRAMEWORK_HEADERS -eq 0; then
 870           AC_MSG_ERROR([No xcodebuild tool and no system framework headers found, use --with-sysroot or --with-sdk-name to provide a path to a valid SDK])
 871         fi
 872       fi
 873     else
 874       # warn user if --with-sdk-name was also set
 875       if test -n &quot;$with_sdk_name&quot;; then
 876         AC_MSG_WARN([Both SYSROOT and --with-sdk-name are set, only SYSROOT will be used])
 877       fi
 878     fi
 879 
 880     if test $HAVE_SYSTEM_FRAMEWORK_HEADERS -eq 0 -a -z &quot;$SYSROOT&quot;; then
 881       # If no system framework headers, then SYSROOT must be set, or we won&#39;t build
 882       AC_MSG_ERROR([Unable to determine SYSROOT and no headers found in /System/Library/Frameworks. Check Xcode configuration, --with-sysroot or --with-sdk-name arguments.])
 883     fi
 884 
 885     # Perform a basic sanity test
 886     if test ! -f &quot;$SYSROOT/System/Library/Frameworks/Foundation.framework/Headers/Foundation.h&quot;; then
 887       if test -z &quot;$SYSROOT&quot;; then
 888         AC_MSG_ERROR([Unable to find required framework headers, provide a path to an SDK via --with-sysroot or --with-sdk-name and be sure Xcode is installed properly])
 889       else
 890         AC_MSG_ERROR([Invalid SDK or SYSROOT path, dependent framework headers not found])
 891       fi
 892     fi
 893 
 894     # set SDKROOT too, Xcode tools will pick it up
 895     SDKROOT=&quot;$SYSROOT&quot;
 896     AC_SUBST(SDKROOT)
 897   fi
 898 
 899   # Prepend the extra path to the global path
 900   BASIC_PREPEND_TO_PATH([PATH],$EXTRA_PATH)
 901 
 902   AC_MSG_CHECKING([for sysroot])
 903   AC_MSG_RESULT([$SYSROOT])
 904   AC_MSG_CHECKING([for toolchain path])
 905   AC_MSG_RESULT([$TOOLCHAIN_PATH])
 906   AC_MSG_CHECKING([for extra path])
 907   AC_MSG_RESULT([$EXTRA_PATH])
 908 ])
 909 
 910 ###############################################################################
 911 AC_DEFUN_ONCE([BASIC_SETUP_OUTPUT_DIR],
 912 [
 913 
 914   AC_ARG_WITH(conf-name, [AS_HELP_STRING([--with-conf-name],
 915       [use this as the name of the configuration @&lt;:@generated from important configuration options@:&gt;@])],
 916       [ CONF_NAME=${with_conf_name} ])
 917 
 918   # Test from where we are running configure, in or outside of src root.
 919   AC_MSG_CHECKING([where to store configuration])
 920   if test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$TOPDIR&quot; \
 921       || test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$CUSTOM_ROOT&quot; \
 922       || test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$TOPDIR/make/autoconf&quot; \
 923       || test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$TOPDIR/make&quot; ; then
 924     # We are running configure from the src root.
 925     # Create a default ./build/target-variant-debuglevel output root.
 926     if test &quot;x${CONF_NAME}&quot; = x; then
 927       AC_MSG_RESULT([in default location])
 928       CONF_NAME=&quot;${OPENJDK_TARGET_OS}-${OPENJDK_TARGET_CPU}-${JVM_VARIANTS_WITH_AND}-${DEBUG_LEVEL}&quot;
 929     else
 930       AC_MSG_RESULT([in build directory with custom name])
 931     fi
 932 
 933     if test &quot;x$CUSTOM_ROOT&quot; != x; then
 934       WORKSPACE_ROOT=&quot;${CUSTOM_ROOT}&quot;
 935     else
 936       WORKSPACE_ROOT=&quot;${TOPDIR}&quot;
 937     fi
 938     OUTPUTDIR=&quot;${WORKSPACE_ROOT}/build/${CONF_NAME}&quot;
 939     $MKDIR -p &quot;$OUTPUTDIR&quot;
 940     if test ! -d &quot;$OUTPUTDIR&quot;; then
 941       AC_MSG_ERROR([Could not create build directory $OUTPUTDIR])
 942     fi
 943   else
 944     # We are running configure from outside of the src dir.
 945     # Then use the current directory as output dir!
 946     # If configuration is situated in normal build directory, just use the build
 947     # directory name as configuration name, otherwise use the complete path.
 948     if test &quot;x${CONF_NAME}&quot; = x; then
 949       CONF_NAME=`$ECHO $CONFIGURE_START_DIR | $SED -e &quot;s!^${TOPDIR}/build/!!&quot;`
 950     fi
 951     OUTPUTDIR=&quot;$CONFIGURE_START_DIR&quot;
 952     AC_MSG_RESULT([in current directory])
 953 
 954     # WARNING: This might be a bad thing to do. You need to be sure you want to
 955     # have a configuration in this directory. Do some sanity checks!
 956 
 957     if test ! -e &quot;$OUTPUTDIR/spec.gmk&quot;; then
 958       # If we have a spec.gmk, we have run here before and we are OK. Otherwise, check for
 959       # other files
 960       files_present=`$LS $OUTPUTDIR`
 961       # Configure has already touched config.log and confdefs.h in the current dir when this check
 962       # is performed.
 963       filtered_files=`$ECHO &quot;$files_present&quot; \
 964           | $SED -e &#39;s/config.log//g&#39; \
 965               -e &#39;s/configure.log//g&#39; \
 966               -e &#39;s/confdefs.h//g&#39; \
 967               -e &#39;s/configure-support//g&#39; \
 968               -e &#39;s/ //g&#39; \
 969           | $TR -d &#39;\n&#39;`
 970       if test &quot;x$filtered_files&quot; != x; then
 971         AC_MSG_NOTICE([Current directory is $CONFIGURE_START_DIR.])
 972         AC_MSG_NOTICE([Since this is not the source root, configure will output the configuration here])
 973         AC_MSG_NOTICE([(as opposed to creating a configuration in &lt;src_root&gt;/build/&lt;conf-name&gt;).])
 974         AC_MSG_NOTICE([However, this directory is not empty. This is not allowed, since it could])
 975         AC_MSG_NOTICE([seriously mess up just about everything.])
 976         AC_MSG_NOTICE([Try &#39;cd $TOPDIR&#39; and restart configure])
 977         AC_MSG_NOTICE([(or create a new empty directory and cd to it).])
 978         AC_MSG_ERROR([Will not continue creating configuration in $CONFIGURE_START_DIR])
 979       fi
 980     fi
 981   fi
 982   AC_MSG_CHECKING([what configuration name to use])
 983   AC_MSG_RESULT([$CONF_NAME])
 984 
 985   BASIC_FIXUP_PATH(OUTPUTDIR)
 986 
 987   CONFIGURESUPPORT_OUTPUTDIR=&quot;$OUTPUTDIR/configure-support&quot;
 988   $MKDIR -p &quot;$CONFIGURESUPPORT_OUTPUTDIR&quot;
 989 
 990   SPEC=&quot;$OUTPUTDIR/spec.gmk&quot;
 991   AC_SUBST(SPEC)
 992   AC_SUBST(CONF_NAME)
 993   AC_SUBST(OUTPUTDIR)
 994   AC_SUBST(WORKSPACE_ROOT)
 995   AC_SUBST(CONFIGURESUPPORT_OUTPUTDIR)
 996 
 997   # The spec.gmk file contains all variables for the make system.
 998   AC_CONFIG_FILES([$OUTPUTDIR/spec.gmk:$AUTOCONF_DIR/spec.gmk.in])
 999   # The bootcycle-spec.gmk file contains support for boot cycle builds.
1000   AC_CONFIG_FILES([$OUTPUTDIR/bootcycle-spec.gmk:$AUTOCONF_DIR/bootcycle-spec.gmk.in])
1001   # The buildjdk-spec.gmk file contains support for building a buildjdk when cross compiling.
1002   AC_CONFIG_FILES([$OUTPUTDIR/buildjdk-spec.gmk:$AUTOCONF_DIR/buildjdk-spec.gmk.in])
1003   # The compare.sh is used to compare the build output to other builds.
1004   AC_CONFIG_FILES([$OUTPUTDIR/compare.sh:$AUTOCONF_DIR/compare.sh.in])
1005   # The generated Makefile knows where the spec.gmk is and where the source is.
1006   # You can run make from the OUTPUTDIR, or from the top-level Makefile
1007   # which will look for generated configurations
1008   AC_CONFIG_FILES([$OUTPUTDIR/Makefile:$AUTOCONF_DIR/Makefile.in])
1009 ])
1010 
1011 #%%% Simple tools %%%
1012 
1013 ###############################################################################
1014 # Check if we have found a usable version of make
1015 # $1: the path to a potential make binary (or empty)
1016 # $2: the description on how we found this
1017 AC_DEFUN([BASIC_CHECK_MAKE_VERSION],
1018 [
1019   MAKE_CANDIDATE=&quot;$1&quot;
1020   DESCRIPTION=&quot;$2&quot;
1021 
1022   # On Cygwin, we require a newer version of make than on other platforms
1023   if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.cygwin&quot;; then
1024     MAKE_VERSION_EXPR=&quot;-e 4\.&quot;
1025     MAKE_REQUIRED_VERSION=&quot;4.0&quot;
1026    else
1027     MAKE_VERSION_EXPR=&quot;-e 3\.8[[12]] -e 4\.&quot;
1028     MAKE_REQUIRED_VERSION=&quot;3.81&quot;
1029   fi
1030 
1031   if test &quot;x$MAKE_CANDIDATE&quot; != x; then
1032     AC_MSG_NOTICE([Testing potential make at $MAKE_CANDIDATE, found using $DESCRIPTION])
1033     MAKE_VERSION_STRING=`$MAKE_CANDIDATE --version | $HEAD -n 1`
1034     IS_GNU_MAKE=`$ECHO $MAKE_VERSION_STRING | $GREP &#39;GNU Make&#39;`
1035     if test &quot;x$IS_GNU_MAKE&quot; = x; then
1036       AC_MSG_NOTICE([Found potential make at $MAKE_CANDIDATE, however, this is not GNU Make. Ignoring.])
1037     else
1038       IS_MODERN_MAKE=`$ECHO $MAKE_VERSION_STRING | $GREP $MAKE_VERSION_EXPR`
1039       if test &quot;x$IS_MODERN_MAKE&quot; = x; then
1040         AC_MSG_NOTICE([Found GNU make at $MAKE_CANDIDATE, however this is not version $MAKE_REQUIRED_VERSION or later. (it is: $MAKE_VERSION_STRING). Ignoring.])
1041       else
1042         if test &quot;x$OPENJDK_BUILD_OS&quot; = &quot;xwindows&quot;; then
1043           if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.cygwin&quot;; then
1044             MAKE_EXPECTED_ENV=&#39;cygwin&#39;
1045           elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.msys&quot;; then
1046             MAKE_EXPECTED_ENV=&#39;msys&#39;
1047           elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
1048             MAKE_EXPECTED_ENV=&#39;x86_64-.*-linux-gnu&#39;
1049           else
1050             AC_MSG_ERROR([Unknown Windows environment])
1051           fi
1052           MAKE_BUILT_FOR=`$MAKE_CANDIDATE --version | $GREP -i &#39;built for&#39;`
1053           IS_MAKE_CORRECT_ENV=`$ECHO $MAKE_BUILT_FOR | $GREP $MAKE_EXPECTED_ENV`
1054         else
1055           # Not relevant for non-Windows
1056           IS_MAKE_CORRECT_ENV=true
1057         fi
1058         if test &quot;x$IS_MAKE_CORRECT_ENV&quot; = x; then
1059           AC_MSG_NOTICE([Found GNU make version $MAKE_VERSION_STRING at $MAKE_CANDIDATE, but it is not for $MAKE_EXPECTED_ENV (it says: $MAKE_BUILT_FOR). Ignoring.])
1060         else
1061           FOUND_MAKE=$MAKE_CANDIDATE
1062           BASIC_FIXUP_EXECUTABLE(FOUND_MAKE)
1063         fi
1064       fi
1065     fi
1066   fi
1067 ])
1068 
1069 ###############################################################################
1070 AC_DEFUN([BASIC_CHECK_MAKE_OUTPUT_SYNC],
1071 [
1072   # Check if make supports the output sync option and if so, setup using it.
1073   AC_MSG_CHECKING([if make --output-sync is supported])
1074   if $MAKE --version -O &gt; /dev/null 2&gt;&amp;1; then
1075     OUTPUT_SYNC_SUPPORTED=true
1076     AC_MSG_RESULT([yes])
1077     AC_MSG_CHECKING([for output-sync value])
1078     AC_ARG_WITH([output-sync], [AS_HELP_STRING([--with-output-sync],
1079       [set make output sync type if supported by make. @&lt;:@recurse@:&gt;@])],
1080       [OUTPUT_SYNC=$with_output_sync])
1081     if test &quot;x$OUTPUT_SYNC&quot; = &quot;x&quot;; then
1082       OUTPUT_SYNC=none
1083     fi
1084     AC_MSG_RESULT([$OUTPUT_SYNC])
1085     if ! $MAKE --version -O$OUTPUT_SYNC &gt; /dev/null 2&gt;&amp;1; then
1086       AC_MSG_ERROR([Make did not the support the value $OUTPUT_SYNC as output sync type.])
1087     fi
1088   else
1089     OUTPUT_SYNC_SUPPORTED=false
1090     AC_MSG_RESULT([no])
1091   fi
1092   AC_SUBST(OUTPUT_SYNC_SUPPORTED)
1093   AC_SUBST(OUTPUT_SYNC)
1094 ])
1095 
1096 ###############################################################################
1097 # Goes looking for a usable version of GNU make.
1098 AC_DEFUN([BASIC_CHECK_GNU_MAKE],
1099 [
1100   BASIC_SETUP_TOOL([MAKE],
1101   [
1102     # Try our hardest to locate a correct version of GNU make
1103     AC_PATH_PROGS(CHECK_GMAKE, gmake)
1104     BASIC_CHECK_MAKE_VERSION(&quot;$CHECK_GMAKE&quot;, [gmake in PATH])
1105 
1106     if test &quot;x$FOUND_MAKE&quot; = x; then
1107       AC_PATH_PROGS(CHECK_MAKE, make)
1108       BASIC_CHECK_MAKE_VERSION(&quot;$CHECK_MAKE&quot;, [make in PATH])
1109     fi
1110 
1111     if test &quot;x$FOUND_MAKE&quot; = x; then
1112       if test &quot;x$TOOLCHAIN_PATH&quot; != x; then
1113         # We have a toolchain path, check that as well before giving up.
1114         OLD_PATH=$PATH
1115         PATH=$TOOLCHAIN_PATH:$PATH
1116         AC_PATH_PROGS(CHECK_TOOLSDIR_GMAKE, gmake)
1117         BASIC_CHECK_MAKE_VERSION(&quot;$CHECK_TOOLSDIR_GMAKE&quot;, [gmake in tools-dir])
1118         if test &quot;x$FOUND_MAKE&quot; = x; then
1119           AC_PATH_PROGS(CHECK_TOOLSDIR_MAKE, make)
1120           BASIC_CHECK_MAKE_VERSION(&quot;$CHECK_TOOLSDIR_MAKE&quot;, [make in tools-dir])
1121         fi
1122         PATH=$OLD_PATH
1123       fi
1124     fi
1125 
1126     if test &quot;x$FOUND_MAKE&quot; = x; then
1127       AC_MSG_ERROR([Cannot find GNU make $MAKE_REQUIRED_VERSION or newer! Please put it in the path, or add e.g. MAKE=/opt/gmake3.81/make as argument to configure.])
1128     fi
1129   ],[
1130     # If MAKE was set by user, verify the version
1131     BASIC_CHECK_MAKE_VERSION(&quot;$MAKE&quot;, [user supplied MAKE=$MAKE])
1132     if test &quot;x$FOUND_MAKE&quot; = x; then
1133       AC_MSG_ERROR([The specified make (by MAKE=$MAKE) is not GNU make $MAKE_REQUIRED_VERSION or newer.])
1134     fi
1135   ])
1136 
1137   MAKE=$FOUND_MAKE
1138   AC_SUBST(MAKE)
1139   AC_MSG_NOTICE([Using GNU make at $FOUND_MAKE (version: $MAKE_VERSION_STRING)])
1140 
1141   BASIC_CHECK_MAKE_OUTPUT_SYNC
1142 ])
1143 
1144 ###############################################################################
1145 AC_DEFUN([BASIC_CHECK_FIND_DELETE],
1146 [
1147   # Test if find supports -delete
1148   AC_MSG_CHECKING([if find supports -delete])
1149   FIND_DELETE=&quot;-delete&quot;
1150 
1151   DELETEDIR=`$MKTEMP -d tmp.XXXXXXXXXX` || (echo Could not create temporary directory!; exit $?)
1152 
1153   echo Hejsan &gt; $DELETEDIR/TestIfFindSupportsDelete
1154 
1155   TEST_DELETE=`$FIND &quot;$DELETEDIR&quot; -name TestIfFindSupportsDelete $FIND_DELETE 2&gt;&amp;1`
1156   if test -f $DELETEDIR/TestIfFindSupportsDelete; then
1157     # No, it does not.
1158     $RM $DELETEDIR/TestIfFindSupportsDelete
1159     if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xaix&quot;; then
1160       # AIX &#39;find&#39; is buggy if called with &#39;-exec {} \+&#39; and an empty file list
1161       FIND_DELETE=&quot;-print | $XARGS $RM&quot;
1162     else
1163       FIND_DELETE=&quot;-exec $RM \{\} \+&quot;
1164     fi
1165     AC_MSG_RESULT([no])
1166   else
1167     AC_MSG_RESULT([yes])
1168   fi
1169   $RMDIR $DELETEDIR
1170   AC_SUBST(FIND_DELETE)
1171 ])
1172 
1173 ###############################################################################
1174 AC_DEFUN([BASIC_CHECK_TAR],
1175 [
1176   # Test which kind of tar was found
1177   if test &quot;x$($TAR --version | $GREP &quot;GNU tar&quot;)&quot; != &quot;x&quot;; then
1178     TAR_TYPE=&quot;gnu&quot;
1179   elif test &quot;x$($TAR --version | $GREP &quot;bsdtar&quot;)&quot; != &quot;x&quot;; then
1180     TAR_TYPE=&quot;bsd&quot;
1181   elif test &quot;x$($TAR -v | $GREP &quot;bsdtar&quot;)&quot; != &quot;x&quot;; then
1182     TAR_TYPE=&quot;bsd&quot;
1183   elif test &quot;x$OPENJDK_BUILD_OS&quot; = &quot;xsolaris&quot;; then
1184     TAR_TYPE=&quot;solaris&quot;
1185   elif test &quot;x$OPENJDK_BUILD_OS&quot; = &quot;xaix&quot;; then
1186     TAR_TYPE=&quot;aix&quot;
1187   fi
1188   AC_MSG_CHECKING([what type of tar was found])
1189   AC_MSG_RESULT([$TAR_TYPE])
1190 
1191   TAR_CREATE_FILE_PARAM=&quot;&quot;
1192 
1193   if test &quot;x$TAR_TYPE&quot; = &quot;xgnu&quot;; then
1194     TAR_INCLUDE_PARAM=&quot;T&quot;
1195     TAR_SUPPORTS_TRANSFORM=&quot;true&quot;
1196     if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xsolaris&quot;; then
1197       # When using gnu tar for Solaris targets, need to use compatibility mode
1198       TAR_CREATE_EXTRA_PARAM=&quot;--format=ustar&quot;
1199     fi
1200   elif test &quot;x$TAR_TYPE&quot; = &quot;aix&quot;; then
1201     # -L InputList of aix tar: name of file listing the files and directories
1202     # that need to be   archived or extracted
1203     TAR_INCLUDE_PARAM=&quot;L&quot;
1204     TAR_SUPPORTS_TRANSFORM=&quot;false&quot;
1205   else
1206     TAR_INCLUDE_PARAM=&quot;I&quot;
1207     TAR_SUPPORTS_TRANSFORM=&quot;false&quot;
1208   fi
1209   AC_SUBST(TAR_TYPE)
1210   AC_SUBST(TAR_CREATE_EXTRA_PARAM)
1211   AC_SUBST(TAR_INCLUDE_PARAM)
1212   AC_SUBST(TAR_SUPPORTS_TRANSFORM)
1213 ])
1214 
1215 ###############################################################################
1216 AC_DEFUN([BASIC_CHECK_GREP],
1217 [
1218   # Test that grep supports -Fx with a list of pattern which includes null pattern.
1219   # This is a problem for the grep resident on AIX.
1220   AC_MSG_CHECKING([that grep ($GREP) -Fx handles empty lines in the pattern list correctly])
1221   # Multiple subsequent spaces..
1222   STACK_SPACES=&#39;aaa   bbb   ccc&#39;
1223   # ..converted to subsequent newlines, causes STACK_LIST to be a list with some empty
1224   # patterns in it.
1225   STACK_LIST=${STACK_SPACES// /$&#39;\n&#39;}
1226   NEEDLE_SPACES=&#39;ccc bbb aaa&#39;
1227   NEEDLE_LIST=${NEEDLE_SPACES// /$&#39;\n&#39;}
1228   RESULT=&quot;$($GREP -Fvx &quot;$STACK_LIST&quot; &lt;&lt;&lt; &quot;$NEEDLE_LIST&quot;)&quot;
1229   if test &quot;x$RESULT&quot; == &quot;x&quot;; then
1230     AC_MSG_RESULT([yes])
1231   else
1232     if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xaix&quot;; then
1233       ADDINFO=&quot;Please make sure you use GNU grep, usually found at /opt/freeware/bin.&quot;
1234     fi
1235     AC_MSG_ERROR([grep does not handle -Fx correctly. ${ADDINFO}])
1236   fi
1237 ])
1238 
1239 ###############################################################################
1240 AC_DEFUN_ONCE([BASIC_SETUP_COMPLEX_TOOLS],
1241 [
1242   BASIC_CHECK_GNU_MAKE
1243 
1244   BASIC_CHECK_FIND_DELETE
1245   BASIC_CHECK_TAR
1246   BASIC_CHECK_GREP
1247   BASIC_SETUP_PANDOC
1248 
1249   # These tools might not be installed by default,
1250   # need hint on how to install them.
1251   BASIC_REQUIRE_PROGS(UNZIP, unzip)
1252   # Since zip uses &quot;ZIP&quot; as a environment variable for passing options, we need
1253   # to name our variable differently, hence ZIPEXE.
1254   BASIC_REQUIRE_PROGS(ZIPEXE, zip)
1255 
1256   # Non-required basic tools
1257 
1258   BASIC_PATH_PROGS(LDD, ldd)
1259   if test &quot;x$LDD&quot; = &quot;x&quot;; then
1260     # List shared lib dependencies is used for
1261     # debug output and checking for forbidden dependencies.
1262     # We can build without it.
1263     LDD=&quot;true&quot;
1264   fi
1265   BASIC_PATH_PROGS(READELF, [greadelf readelf])
1266   BASIC_PATH_PROGS(DOT, dot)
1267   BASIC_PATH_PROGS(HG, hg)
1268   BASIC_PATH_PROGS(GIT, git)
1269   BASIC_PATH_PROGS(STAT, stat)
1270   BASIC_PATH_PROGS(TIME, time)
1271   BASIC_PATH_PROGS(FLOCK, flock)
1272   # Dtrace is usually found in /usr/sbin on Solaris, but that directory may not
1273   # be in the user path.
1274   BASIC_PATH_PROGS(DTRACE, dtrace, $PATH:/usr/sbin)
1275   BASIC_PATH_PROGS(PATCH, [gpatch patch])
1276   # Check if it&#39;s GNU time
1277   IS_GNU_TIME=`$TIME --version 2&gt;&amp;1 | $GREP &#39;GNU time&#39;`
1278   if test &quot;x$IS_GNU_TIME&quot; != x; then
1279     IS_GNU_TIME=yes
1280   else
1281     IS_GNU_TIME=no
1282   fi
1283   AC_SUBST(IS_GNU_TIME)
1284 
1285   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xmacosx&quot;; then
1286     BASIC_REQUIRE_PROGS(DSYMUTIL, dsymutil)
1287     BASIC_REQUIRE_PROGS(MIG, mig)
1288     BASIC_REQUIRE_PROGS(XATTR, xattr)
1289     BASIC_PATH_PROGS(CODESIGN, codesign)
1290 
1291     if test &quot;x$CODESIGN&quot; != &quot;x&quot;; then
1292       # Check for user provided code signing identity.
1293       # If no identity was provided, fall back to &quot;openjdk_codesign&quot;.
1294       AC_ARG_WITH([macosx-codesign-identity], [AS_HELP_STRING([--with-macosx-codesign-identity],
1295         [specify the code signing identity])],
1296         [MACOSX_CODESIGN_IDENTITY=$with_macosx_codesign_identity],
1297         [MACOSX_CODESIGN_IDENTITY=openjdk_codesign]
1298       )
1299 
1300       AC_SUBST(MACOSX_CODESIGN_IDENTITY)
1301 
1302       # Verify that the codesign certificate is present
1303       AC_MSG_CHECKING([if codesign certificate is present])
1304       $RM codesign-testfile
1305       $TOUCH codesign-testfile
1306       $CODESIGN -s &quot;$MACOSX_CODESIGN_IDENTITY&quot; codesign-testfile 2&gt;&amp;AS_MESSAGE_LOG_FD &gt;&amp;AS_MESSAGE_LOG_FD || CODESIGN=
1307       $RM codesign-testfile
1308       if test &quot;x$CODESIGN&quot; = x; then
1309         AC_MSG_RESULT([no])
1310       else
1311         AC_MSG_RESULT([yes])
1312       fi
1313     fi
1314     BASIC_REQUIRE_PROGS(SETFILE, SetFile)
1315   elif test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xsolaris&quot;; then
1316     BASIC_REQUIRE_PROGS(ELFEDIT, elfedit)
1317   fi
1318   if ! test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xwindows&quot;; then
1319     BASIC_REQUIRE_BUILTIN_PROGS(ULIMIT, ulimit)
1320   fi
1321 ])
1322 
1323 ###############################################################################
1324 # Check if build directory is on local disk. If not possible to determine,
1325 # we prefer to claim it&#39;s local.
1326 # Argument 1: directory to test
1327 # Argument 2: what to do if it is on local disk
1328 # Argument 3: what to do otherwise (remote disk or failure)
1329 AC_DEFUN([BASIC_CHECK_DIR_ON_LOCAL_DISK],
1330 [
1331   # df -l lists only local disks; if the given directory is not found then
1332   # a non-zero exit code is given
1333   if test &quot;x$DF&quot; = x; then
1334     if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.msys&quot;; then
1335       # msys does not have df; use Windows &quot;net use&quot; instead.
1336       IS_NETWORK_DISK=`net use | grep \`pwd -W | cut -d &quot;:&quot; -f 1 | tr a-z A-Z\`:`
1337       if test &quot;x$IS_NETWORK_DISK&quot; = x; then
1338         $2
1339       else
1340         $3
1341       fi
1342     else
1343       # No df here, say it&#39;s local
1344       $2
1345     fi
1346   else
1347     # JDK-8189619
1348     # df on AIX does not understand -l. On modern AIXes it understands &quot;-T local&quot; which
1349     # is the same. On older AIXes we just continue to live with a &quot;not local build&quot; warning.
1350     if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
1351       DF_LOCAL_ONLY_OPTION=&#39;-T local&#39;
1352     else
1353       DF_LOCAL_ONLY_OPTION=&#39;-l&#39;
1354     fi
1355     if $DF $DF_LOCAL_ONLY_OPTION $1 &gt; /dev/null 2&gt;&amp;1; then
1356       $2
1357     else
1358       # In WSL, local Windows drives are considered remote by df, but we are
1359       # required to build into a directory accessible from windows, so consider
1360       # them local here.
1361       if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
1362         if $DF $1 | $GREP -q &quot;^[[A-Z]]:&quot;; then
1363           $2
1364         else
1365           $3
1366         fi
1367       else
1368         $3
1369       fi
1370     fi
1371   fi
1372 ])
1373 
1374 ###############################################################################
1375 # Check that source files have basic read permissions set. This might
1376 # not be the case in cygwin in certain conditions.
1377 AC_DEFUN_ONCE([BASIC_CHECK_SRC_PERMS],
1378 [
1379   if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.cygwin&quot;; then
1380     file_to_test=&quot;$TOPDIR/LICENSE&quot;
1381     if test `$STAT -c &#39;%a&#39; &quot;$file_to_test&quot;` -lt 400; then
1382       AC_MSG_ERROR([Bad file permissions on src files. This is usually caused by cloning the repositories with a non cygwin hg in a directory not created in cygwin.])
1383     fi
1384   fi
1385 ])
1386 
1387 ###############################################################################
1388 AC_DEFUN_ONCE([BASIC_TEST_USABILITY_ISSUES],
1389 [
1390   AC_MSG_CHECKING([if build directory is on local disk])
1391   BASIC_CHECK_DIR_ON_LOCAL_DISK($OUTPUTDIR,
1392       [OUTPUT_DIR_IS_LOCAL=&quot;yes&quot;],
1393       [OUTPUT_DIR_IS_LOCAL=&quot;no&quot;])
1394   AC_MSG_RESULT($OUTPUT_DIR_IS_LOCAL)
1395 
1396   BASIC_CHECK_SRC_PERMS
1397 
1398   # Check if the user has any old-style ALT_ variables set.
1399   FOUND_ALT_VARIABLES=`env | grep ^ALT_`
1400 
1401   # Before generating output files, test if they exist. If they do, this is a reconfigure.
1402   # Since we can&#39;t properly handle the dependencies for this, warn the user about the situation
1403   if test -e $OUTPUTDIR/spec.gmk; then
1404     IS_RECONFIGURE=yes
1405   else
1406     IS_RECONFIGURE=no
1407   fi
1408 ])
1409 
1410 ###############################################################################
1411 # Check for support for specific options in bash
1412 AC_DEFUN_ONCE([BASIC_CHECK_BASH_OPTIONS],
1413 [
1414   # Check bash version
1415   # Extra [ ] to stop m4 mangling
1416   [ BASH_VER=`$BASH --version | $SED -n  -e &#39;s/^.*bash.*ersion *\([0-9.]*\).*$/\1/ p&#39;` ]
1417   AC_MSG_CHECKING([bash version])
1418   AC_MSG_RESULT([$BASH_VER])
1419 
1420   BASH_MAJOR=`$ECHO $BASH_VER | $CUT -d . -f 1`
1421   BASH_MINOR=`$ECHO $BASH_VER | $CUT -d . -f 2`
1422   if test $BASH_MAJOR -lt 3 || (test $BASH_MAJOR -eq 3 &amp;&amp; test $BASH_MINOR -lt 2); then
1423     AC_MSG_ERROR([bash version 3.2 or better is required])
1424   fi
1425 
1426   # Test if bash supports pipefail.
1427   AC_MSG_CHECKING([if bash supports pipefail])
1428   if ${BASH} -c &#39;set -o pipefail&#39;; then
1429     BASH_ARGS=&quot;$BASH_ARGS -o pipefail&quot;
1430     AC_MSG_RESULT([yes])
1431   else
1432     AC_MSG_RESULT([no])
1433   fi
1434 
1435   AC_MSG_CHECKING([if bash supports errexit (-e)])
1436   if ${BASH} -e -c &#39;true&#39;; then
1437     BASH_ARGS=&quot;$BASH_ARGS -e&quot;
1438     AC_MSG_RESULT([yes])
1439   else
1440     AC_MSG_RESULT([no])
1441   fi
1442 
1443   AC_SUBST(BASH_ARGS)
1444 ])
1445 
1446 ################################################################################
1447 #
1448 # Setup Pandoc
1449 #
1450 AC_DEFUN_ONCE([BASIC_SETUP_PANDOC],
1451 [
1452   BASIC_PATH_PROGS(PANDOC, pandoc)
1453 
1454   PANDOC_MARKDOWN_FLAG=&quot;markdown&quot;
1455   if test -n &quot;$PANDOC&quot;; then
1456     AC_MSG_CHECKING(if the pandoc smart extension needs to be disabled for markdown)
1457     if $PANDOC --list-extensions | $GREP -q &#39;\+smart&#39;; then
1458       AC_MSG_RESULT([yes])
1459       PANDOC_MARKDOWN_FLAG=&quot;markdown-smart&quot;
1460     else
1461       AC_MSG_RESULT([no])
1462     fi
1463   fi
1464 
1465   if test -n &quot;$PANDOC&quot;; then
1466     ENABLE_PANDOC=&quot;true&quot;
1467   else
1468     ENABLE_PANDOC=&quot;false&quot;
1469   fi
1470   AC_SUBST(ENABLE_PANDOC)
1471   AC_SUBST(PANDOC_MARKDOWN_FLAG)
1472 ])
1473 
1474 ################################################################################
1475 #
1476 # Default make target
1477 #
1478 AC_DEFUN_ONCE([BASIC_SETUP_DEFAULT_MAKE_TARGET],
1479 [
1480   AC_ARG_WITH(default-make-target, [AS_HELP_STRING([--with-default-make-target],
1481       [set the default make target @&lt;:@exploded-image@:&gt;@])])
1482   if test &quot;x$with_default_make_target&quot; = &quot;x&quot; \
1483       || test &quot;x$with_default_make_target&quot; = &quot;xyes&quot;; then
1484     DEFAULT_MAKE_TARGET=&quot;exploded-image&quot;
1485   elif test &quot;x$with_default_make_target&quot; = &quot;xno&quot;; then
1486     AC_MSG_ERROR([--without-default-make-target is not a valid option])
1487   else
1488     DEFAULT_MAKE_TARGET=&quot;$with_default_make_target&quot;
1489   fi
1490 
1491   AC_SUBST(DEFAULT_MAKE_TARGET)
1492 ])
1493 
1494 ###############################################################################
1495 # Setup the default value for LOG=
1496 #
1497 AC_DEFUN_ONCE([BASIC_SETUP_DEFAULT_LOG],
1498 [
1499   AC_ARG_WITH(log, [AS_HELP_STRING([--with-log],
1500       [[default vaue for make LOG argument [warn]]])])
1501   AC_MSG_CHECKING([for default LOG value])
1502   if test &quot;x$with_log&quot; = x; then
1503     DEFAULT_LOG=&quot;&quot;
1504   else
1505     # Syntax for valid LOG options is a bit too complex for it to be worth
1506     # implementing a test for correctness in configure. Just accept it.
1507     DEFAULT_LOG=$with_log
1508   fi
1509   AC_MSG_RESULT([$DEFAULT_LOG])
1510   AC_SUBST(DEFAULT_LOG)
1511 ])
1512 
1513 ###############################################################################
1514 # Code to run after AC_OUTPUT
1515 AC_DEFUN_ONCE([BASIC_POST_CONFIG_OUTPUT],
1516 [
1517   # Try to move config.log (generated by autoconf) to the configure-support directory.
1518   if test -e ./config.log; then
1519     $MV -f ./config.log &quot;$CONFIGURESUPPORT_OUTPUTDIR/config.log&quot; 2&gt; /dev/null
1520   fi
1521 
1522   # Rotate our log file (configure.log)
1523   if test -e &quot;$OUTPUTDIR/configure.log.old&quot;; then
1524     $RM -f &quot;$OUTPUTDIR/configure.log.old&quot;
1525   fi
1526   if test -e &quot;$OUTPUTDIR/configure.log&quot;; then
1527     $MV -f &quot;$OUTPUTDIR/configure.log&quot; &quot;$OUTPUTDIR/configure.log.old&quot; 2&gt; /dev/null
1528   fi
1529 
1530   # Move configure.log from current directory to the build output root
1531   if test -e ./configure.log; then
1532     $MV -f ./configure.log &quot;$OUTPUTDIR/configure.log&quot; 2&gt; /dev/null
1533   fi
1534 
1535   # Make the compare script executable
1536   $CHMOD +x $OUTPUTDIR/compare.sh
1537 ])
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>