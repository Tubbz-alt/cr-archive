<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/jdk/jfr/api/consumer/TestFieldAccess.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../internal/platform/docker/TestDockerMemoryMetrics.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TestGetStackTrace.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/jdk/jfr/api/consumer/TestFieldAccess.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 28 import java.util.List;
 29 
 30 import jdk.jfr.Event;
 31 import jdk.jfr.Recording;
 32 import jdk.jfr.consumer.RecordedClass;
 33 import jdk.jfr.consumer.RecordedEvent;
 34 import jdk.jfr.consumer.RecordedThread;
 35 import jdk.test.lib.Asserts;
 36 import jdk.test.lib.jfr.Events;
 37 
 38 /**
 39  * @test
 40  * @key jfr
 41  * @requires vm.hasJFR
 42  * @library /test/lib
 43  * @run main/othervm jdk.jfr.api.consumer.TestFieldAccess
 44  */
 45 public class TestFieldAccess {
 46 
 47     private static class MyEvent extends Event {


 48         String stringField = &quot;Hello&quot;;
 49         int intField = 4711;
 50         long longField = 4712L;
 51         short shortField = (short)67;
 52         double doubleField = Double.NaN;
 53         float floatField = Float.MIN_VALUE;
 54         boolean booleanField = false;
 55         Thread threadField = Thread.currentThread();
 56         Class&lt;?&gt; classField = MyEvent.class;
 57     }
 58 
 59     public static void main(String[] args) throws Throwable {
 60         try (Recording r = new Recording()) {
 61             r.enable(MyEvent.class);
 62             r.start();
 63             MyEvent myEvent = new MyEvent();
 64             myEvent.commit();
 65             r.stop();
 66             List&lt;RecordedEvent&gt; events = Events.fromRecording(r);
 67             Events.hasEvents(events);
 68             RecordedEvent event = events.get(0);
 69             testHasField(event);
 70             testGetField(event, myEvent);
 71         }
 72     }
 73 
 74     private static void testGetField(RecordedEvent event, MyEvent myEvent) {






 75         String stringField = event.getValue(&quot;stringField&quot;);
 76         Asserts.assertEquals(stringField, myEvent.stringField);
 77 
 78         int intField = event.getValue(&quot;intField&quot;);
 79         Asserts.assertEquals(intField, myEvent.intField);
 80 
 81         long longField = event.getValue(&quot;longField&quot;);
 82         Asserts.assertEquals(longField, myEvent.longField);
 83 
 84         short shortField = event.getValue(&quot;shortField&quot;);
 85         Asserts.assertEquals(shortField, myEvent.shortField);
 86 
 87         double doubleField = event.getValue(&quot;doubleField&quot;);
 88         Asserts.assertEquals(doubleField, myEvent.doubleField);
 89 
 90         float floatField = event.getValue(&quot;floatField&quot;);
 91         Asserts.assertEquals(floatField, myEvent.floatField);
 92 
 93         boolean booleanField = event.getValue(&quot;booleanField&quot;);
 94         Asserts.assertEquals(booleanField, myEvent.booleanField);
 95 
 96         RecordedThread threadField = event.getValue(&quot;eventThread&quot;);
 97         Asserts.assertEquals(threadField.getJavaName(), myEvent.threadField.getName());
 98         String threadGroupName = event.getValue(&quot;eventThread.group.name&quot;);
 99         Asserts.assertEquals(threadField.getThreadGroup().getName(), threadGroupName);
100 
101         RecordedClass  classField = event.getValue(&quot;classField&quot;);
102         Asserts.assertEquals(classField.getName(), myEvent.classField.getName());
103         String className = event.getValue(&quot;classField.name&quot;);
104         Asserts.assertEquals(classField.getName(), className.replace(&quot;/&quot;, &quot;.&quot;));
105 
<span class="line-removed">106 </span>
107         try {
108             event.getValue(&quot;doesnotexist&quot;);
109         } catch (IllegalArgumentException iae) {
110             // as expected
111         }
112 
113         try {
114             event.getValue(&quot;classField.doesnotexist&quot;);
115         } catch (IllegalArgumentException iae) {
116             // as expected
117         }
118 
119         try {
120             event.getValue(null);
121         } catch (NullPointerException npe) {
122             // as expected
123         }
124     }
125 
126     private static void testHasField(RecordedEvent event) {
127         System.out.println(event);


128         Asserts.assertTrue(event.hasField(&quot;stringField&quot;));
129         Asserts.assertTrue(event.hasField(&quot;intField&quot;));
130         Asserts.assertTrue(event.hasField(&quot;longField&quot;));
131         Asserts.assertTrue(event.hasField(&quot;shortField&quot;));
132         Asserts.assertTrue(event.hasField(&quot;doubleField&quot;));
133         Asserts.assertTrue(event.hasField(&quot;floatField&quot;));
134         Asserts.assertTrue(event.hasField(&quot;threadField&quot;));
135         Asserts.assertTrue(event.hasField(&quot;classField&quot;));
136         Asserts.assertTrue(event.hasField(&quot;classField.name&quot;));
137         Asserts.assertTrue(event.hasField(&quot;eventThread&quot;));
138         Asserts.assertTrue(event.hasField(&quot;eventThread.group.name&quot;));
139         Asserts.assertTrue(event.hasField(&quot;startTime&quot;));
140         Asserts.assertTrue(event.hasField(&quot;stackTrace&quot;));
141         Asserts.assertTrue(event.hasField(&quot;duration&quot;));
142         Asserts.assertFalse(event.hasField(&quot;doesNotExist&quot;));
143         Asserts.assertFalse(event.hasField(&quot;classField.doesNotExist&quot;));
144         Asserts.assertFalse(event.hasField(&quot;&quot;));
145         try {
146             event.hasField(null);
147         } catch (NullPointerException npe) {
</pre>
</td>
<td>
<hr />
<pre>
 28 import java.util.List;
 29 
 30 import jdk.jfr.Event;
 31 import jdk.jfr.Recording;
 32 import jdk.jfr.consumer.RecordedClass;
 33 import jdk.jfr.consumer.RecordedEvent;
 34 import jdk.jfr.consumer.RecordedThread;
 35 import jdk.test.lib.Asserts;
 36 import jdk.test.lib.jfr.Events;
 37 
 38 /**
 39  * @test
 40  * @key jfr
 41  * @requires vm.hasJFR
 42  * @library /test/lib
 43  * @run main/othervm jdk.jfr.api.consumer.TestFieldAccess
 44  */
 45 public class TestFieldAccess {
 46 
 47     private static class MyEvent extends Event {
<span class="line-added"> 48         byte byteField = 42;</span>
<span class="line-added"> 49         char charField = &#39;X&#39;;</span>
 50         String stringField = &quot;Hello&quot;;
 51         int intField = 4711;
 52         long longField = 4712L;
 53         short shortField = (short)67;
 54         double doubleField = Double.NaN;
 55         float floatField = Float.MIN_VALUE;
 56         boolean booleanField = false;
 57         Thread threadField = Thread.currentThread();
 58         Class&lt;?&gt; classField = MyEvent.class;
 59     }
 60 
 61     public static void main(String[] args) throws Throwable {
 62         try (Recording r = new Recording()) {
 63             r.enable(MyEvent.class);
 64             r.start();
 65             MyEvent myEvent = new MyEvent();
 66             myEvent.commit();
 67             r.stop();
 68             List&lt;RecordedEvent&gt; events = Events.fromRecording(r);
 69             Events.hasEvents(events);
 70             RecordedEvent event = events.get(0);
 71             testHasField(event);
 72             testGetField(event, myEvent);
 73         }
 74     }
 75 
 76     private static void testGetField(RecordedEvent event, MyEvent myEvent) {
<span class="line-added"> 77         char charField = event.getValue(&quot;charField&quot;);</span>
<span class="line-added"> 78         Asserts.assertEquals(charField, myEvent.charField);</span>
<span class="line-added"> 79 </span>
<span class="line-added"> 80         byte byteField = event.getValue(&quot;byteField&quot;);</span>
<span class="line-added"> 81         Asserts.assertEquals(byteField, myEvent.byteField);</span>
<span class="line-added"> 82 </span>
 83         String stringField = event.getValue(&quot;stringField&quot;);
 84         Asserts.assertEquals(stringField, myEvent.stringField);
 85 
 86         int intField = event.getValue(&quot;intField&quot;);
 87         Asserts.assertEquals(intField, myEvent.intField);
 88 
 89         long longField = event.getValue(&quot;longField&quot;);
 90         Asserts.assertEquals(longField, myEvent.longField);
 91 
 92         short shortField = event.getValue(&quot;shortField&quot;);
 93         Asserts.assertEquals(shortField, myEvent.shortField);
 94 
 95         double doubleField = event.getValue(&quot;doubleField&quot;);
 96         Asserts.assertEquals(doubleField, myEvent.doubleField);
 97 
 98         float floatField = event.getValue(&quot;floatField&quot;);
 99         Asserts.assertEquals(floatField, myEvent.floatField);
100 
101         boolean booleanField = event.getValue(&quot;booleanField&quot;);
102         Asserts.assertEquals(booleanField, myEvent.booleanField);
103 
104         RecordedThread threadField = event.getValue(&quot;eventThread&quot;);
105         Asserts.assertEquals(threadField.getJavaName(), myEvent.threadField.getName());
106         String threadGroupName = event.getValue(&quot;eventThread.group.name&quot;);
107         Asserts.assertEquals(threadField.getThreadGroup().getName(), threadGroupName);
108 
109         RecordedClass  classField = event.getValue(&quot;classField&quot;);
110         Asserts.assertEquals(classField.getName(), myEvent.classField.getName());
111         String className = event.getValue(&quot;classField.name&quot;);
112         Asserts.assertEquals(classField.getName(), className.replace(&quot;/&quot;, &quot;.&quot;));
113 

114         try {
115             event.getValue(&quot;doesnotexist&quot;);
116         } catch (IllegalArgumentException iae) {
117             // as expected
118         }
119 
120         try {
121             event.getValue(&quot;classField.doesnotexist&quot;);
122         } catch (IllegalArgumentException iae) {
123             // as expected
124         }
125 
126         try {
127             event.getValue(null);
128         } catch (NullPointerException npe) {
129             // as expected
130         }
131     }
132 
133     private static void testHasField(RecordedEvent event) {
134         System.out.println(event);
<span class="line-added">135         Asserts.assertTrue(event.hasField(&quot;charField&quot;));</span>
<span class="line-added">136         Asserts.assertTrue(event.hasField(&quot;byteField&quot;));</span>
137         Asserts.assertTrue(event.hasField(&quot;stringField&quot;));
138         Asserts.assertTrue(event.hasField(&quot;intField&quot;));
139         Asserts.assertTrue(event.hasField(&quot;longField&quot;));
140         Asserts.assertTrue(event.hasField(&quot;shortField&quot;));
141         Asserts.assertTrue(event.hasField(&quot;doubleField&quot;));
142         Asserts.assertTrue(event.hasField(&quot;floatField&quot;));
143         Asserts.assertTrue(event.hasField(&quot;threadField&quot;));
144         Asserts.assertTrue(event.hasField(&quot;classField&quot;));
145         Asserts.assertTrue(event.hasField(&quot;classField.name&quot;));
146         Asserts.assertTrue(event.hasField(&quot;eventThread&quot;));
147         Asserts.assertTrue(event.hasField(&quot;eventThread.group.name&quot;));
148         Asserts.assertTrue(event.hasField(&quot;startTime&quot;));
149         Asserts.assertTrue(event.hasField(&quot;stackTrace&quot;));
150         Asserts.assertTrue(event.hasField(&quot;duration&quot;));
151         Asserts.assertFalse(event.hasField(&quot;doesNotExist&quot;));
152         Asserts.assertFalse(event.hasField(&quot;classField.doesNotExist&quot;));
153         Asserts.assertFalse(event.hasField(&quot;&quot;));
154         try {
155             event.hasField(null);
156         } catch (NullPointerException npe) {
</pre>
</td>
</tr>
</table>
<center><a href="../../../internal/platform/docker/TestDockerMemoryMetrics.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TestGetStackTrace.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>