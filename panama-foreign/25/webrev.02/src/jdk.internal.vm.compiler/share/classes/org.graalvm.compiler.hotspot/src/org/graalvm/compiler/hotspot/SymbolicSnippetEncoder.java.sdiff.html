<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/SymbolicSnippetEncoder.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="HotSpotReferenceMapBuilder.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="meta/DefaultHotSpotLoweringProvider.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/SymbolicSnippetEncoder.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 458                 return result;
 459             } catch (Throwable t) {
 460                 throw debug.handle(t);
 461             }
 462         }
 463     }
 464 
 465     @SuppressWarnings(&quot;try&quot;)
 466     private boolean verifySnippetEncodeDecode(DebugContext debug, ResolvedJavaMethod method, ResolvedJavaMethod original, String originalMethodString, boolean trackNodeSourcePosition,
 467                     StructuredGraph graph) {
 468         // Verify the encoding and decoding process
 469         EncodedGraph encodedGraph = GraphEncoder.encodeSingleGraph(graph, HotSpotJVMCIRuntime.runtime().getHostJVMCIBackend().getTarget().arch);
 470 
 471         HotSpotProviders originalProvider = (HotSpotProviders) snippetReplacements.getProviders();
 472 
 473         SnippetReflectionProvider snippetReflection = originalProvider.getSnippetReflection();
 474         SymbolicSnippetEncoder.HotSpotSubstrateConstantReflectionProvider constantReflection = new SymbolicSnippetEncoder.HotSpotSubstrateConstantReflectionProvider(
 475                         originalProvider.getConstantReflection());
 476         HotSpotProviders newProviders = new HotSpotProviders(originalProvider.getMetaAccess(), originalProvider.getCodeCache(), constantReflection,
 477                         originalProvider.getConstantFieldProvider(), originalProvider.getForeignCalls(), originalProvider.getLowerer(), null, originalProvider.getSuites(),
<span class="line-modified"> 478                         originalProvider.getRegisters(), snippetReflection, originalProvider.getWordTypes(), originalProvider.getGraphBuilderPlugins(), originalProvider.getGC());</span>

 479         HotSpotSnippetReplacementsImpl filteringReplacements = new HotSpotSnippetReplacementsImpl(newProviders, snippetReflection,
 480                         originalProvider.getReplacements().getDefaultReplacementBytecodeProvider(), originalProvider.getCodeCache().getTarget());
 481         filteringReplacements.setGraphBuilderPlugins(originalProvider.getReplacements().getGraphBuilderPlugins());
 482         try (DebugContext.Scope scaope = debug.scope(&quot;VerifySnippetEncodeDecode&quot;, graph)) {
 483             for (int i = 0; i &lt; encodedGraph.getNumObjects(); i++) {
 484                 filterSnippetObject(encodedGraph.getObject(i));
 485             }
 486             StructuredGraph snippet = filteringReplacements.makeGraph(debug, filteringReplacements.getDefaultReplacementBytecodeProvider(), method, null, original,
 487                             trackNodeSourcePosition, null);
 488             SymbolicEncodedGraph symbolicGraph = new SymbolicEncodedGraph(encodedGraph, method.getDeclaringClass(), originalMethodString);
 489             StructuredGraph decodedSnippet = decodeSnippetGraph(symbolicGraph, original != null ? original : method, originalReplacements, null,
 490                             StructuredGraph.AllowAssumptions.ifNonNull(graph.getAssumptions()), graph.getOptions());
 491             String snippetString = getCanonicalGraphString(snippet, true, false);
 492             String decodedSnippetString = getCanonicalGraphString(decodedSnippet, true, false);
 493             if (snippetString.equals(decodedSnippetString)) {
 494                 debug.log(&quot;Snippet decode for %s produces exactly same graph&quot;, method);
 495                 debug.dump(DebugContext.VERBOSE_LEVEL, decodedSnippet, &quot;Decoded snippet graph for %s&quot;, method);
 496             } else {
 497                 debug.log(&quot;Snippet decode for %s produces different graph&quot;, method);
 498                 debug.log(&quot;%s&quot;, compareGraphStrings(snippet, snippetString, decodedSnippet, decodedSnippetString));
</pre>
</td>
<td>
<hr />
<pre>
 458                 return result;
 459             } catch (Throwable t) {
 460                 throw debug.handle(t);
 461             }
 462         }
 463     }
 464 
 465     @SuppressWarnings(&quot;try&quot;)
 466     private boolean verifySnippetEncodeDecode(DebugContext debug, ResolvedJavaMethod method, ResolvedJavaMethod original, String originalMethodString, boolean trackNodeSourcePosition,
 467                     StructuredGraph graph) {
 468         // Verify the encoding and decoding process
 469         EncodedGraph encodedGraph = GraphEncoder.encodeSingleGraph(graph, HotSpotJVMCIRuntime.runtime().getHostJVMCIBackend().getTarget().arch);
 470 
 471         HotSpotProviders originalProvider = (HotSpotProviders) snippetReplacements.getProviders();
 472 
 473         SnippetReflectionProvider snippetReflection = originalProvider.getSnippetReflection();
 474         SymbolicSnippetEncoder.HotSpotSubstrateConstantReflectionProvider constantReflection = new SymbolicSnippetEncoder.HotSpotSubstrateConstantReflectionProvider(
 475                         originalProvider.getConstantReflection());
 476         HotSpotProviders newProviders = new HotSpotProviders(originalProvider.getMetaAccess(), originalProvider.getCodeCache(), constantReflection,
 477                         originalProvider.getConstantFieldProvider(), originalProvider.getForeignCalls(), originalProvider.getLowerer(), null, originalProvider.getSuites(),
<span class="line-modified"> 478                         originalProvider.getRegisters(), snippetReflection, originalProvider.getWordTypes(), originalProvider.getGraphBuilderPlugins(),</span>
<span class="line-added"> 479                         originalProvider.getPlatformConfigurationProvider());</span>
 480         HotSpotSnippetReplacementsImpl filteringReplacements = new HotSpotSnippetReplacementsImpl(newProviders, snippetReflection,
 481                         originalProvider.getReplacements().getDefaultReplacementBytecodeProvider(), originalProvider.getCodeCache().getTarget());
 482         filteringReplacements.setGraphBuilderPlugins(originalProvider.getReplacements().getGraphBuilderPlugins());
 483         try (DebugContext.Scope scaope = debug.scope(&quot;VerifySnippetEncodeDecode&quot;, graph)) {
 484             for (int i = 0; i &lt; encodedGraph.getNumObjects(); i++) {
 485                 filterSnippetObject(encodedGraph.getObject(i));
 486             }
 487             StructuredGraph snippet = filteringReplacements.makeGraph(debug, filteringReplacements.getDefaultReplacementBytecodeProvider(), method, null, original,
 488                             trackNodeSourcePosition, null);
 489             SymbolicEncodedGraph symbolicGraph = new SymbolicEncodedGraph(encodedGraph, method.getDeclaringClass(), originalMethodString);
 490             StructuredGraph decodedSnippet = decodeSnippetGraph(symbolicGraph, original != null ? original : method, originalReplacements, null,
 491                             StructuredGraph.AllowAssumptions.ifNonNull(graph.getAssumptions()), graph.getOptions());
 492             String snippetString = getCanonicalGraphString(snippet, true, false);
 493             String decodedSnippetString = getCanonicalGraphString(decodedSnippet, true, false);
 494             if (snippetString.equals(decodedSnippetString)) {
 495                 debug.log(&quot;Snippet decode for %s produces exactly same graph&quot;, method);
 496                 debug.dump(DebugContext.VERBOSE_LEVEL, decodedSnippet, &quot;Decoded snippet graph for %s&quot;, method);
 497             } else {
 498                 debug.log(&quot;Snippet decode for %s produces different graph&quot;, method);
 499                 debug.log(&quot;%s&quot;, compareGraphStrings(snippet, snippetString, decodedSnippet, decodedSnippetString));
</pre>
</td>
</tr>
</table>
<center><a href="HotSpotReferenceMapBuilder.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="meta/DefaultHotSpotLoweringProvider.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>