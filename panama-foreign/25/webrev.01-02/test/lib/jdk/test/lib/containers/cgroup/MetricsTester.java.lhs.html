<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/lib/jdk/test/lib/containers/cgroup/MetricsTester.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
<a name="2" id="anc2"></a>
 24 package jdk.test.lib.containers.cgroup;
 25 
<a name="3" id="anc3"></a><span class="line-modified"> 26 import java.io.File;</span>
<span class="line-modified"> 27 import java.io.FileNotFoundException;</span>
<span class="line-removed"> 28 import java.io.IOException;</span>
<span class="line-removed"> 29 import java.math.BigInteger;</span>
<span class="line-removed"> 30 import java.nio.file.Files;</span>
<span class="line-removed"> 31 import java.nio.file.Path;</span>
<span class="line-removed"> 32 import java.nio.file.Paths;</span>
<span class="line-removed"> 33 import java.util.Arrays;</span>
<span class="line-removed"> 34 import java.util.HashMap;</span>
<span class="line-removed"> 35 import java.util.HashSet;</span>
<span class="line-removed"> 36 import java.util.Map;</span>
<span class="line-removed"> 37 import java.util.Scanner;</span>
<span class="line-removed"> 38 import java.util.Set;</span>
<span class="line-removed"> 39 import java.util.stream.Collectors;</span>
<span class="line-removed"> 40 import java.util.stream.IntStream;</span>
<span class="line-removed"> 41 import java.util.stream.LongStream;</span>
<span class="line-removed"> 42 import java.util.stream.Stream;</span>
 43 import jdk.internal.platform.Metrics;
 44 
<a name="4" id="anc4"></a>



 45 public class MetricsTester {
 46 
<a name="5" id="anc5"></a><span class="line-modified"> 47     private static final double ERROR_MARGIN = 0.1;</span>
<span class="line-modified"> 48     private static long unlimited_minimum = 0x7FFFFFFFFF000000L;</span>
<span class="line-removed"> 49     long startSysVal;</span>
<span class="line-removed"> 50     long startUserVal;</span>
<span class="line-removed"> 51     long startUsage;</span>
<span class="line-removed"> 52     long startPerCpu[];</span>
<span class="line-removed"> 53 </span>
<span class="line-removed"> 54     enum SubSystem {</span>
<span class="line-removed"> 55         MEMORY(&quot;memory&quot;),</span>
<span class="line-removed"> 56         CPUSET(&quot;cpuset&quot;),</span>
<span class="line-removed"> 57         CPU(&quot;cpu&quot;),</span>
<span class="line-removed"> 58         CPUACCT(&quot;cpuacct&quot;),</span>
<span class="line-removed"> 59         BLKIO(&quot;blkio&quot;);</span>
<span class="line-removed"> 60 </span>
<span class="line-removed"> 61         private String value;</span>
<span class="line-removed"> 62 </span>
<span class="line-removed"> 63         SubSystem(String value) {</span>
<span class="line-removed"> 64             this.value = value;</span>
<span class="line-removed"> 65         }</span>
<span class="line-removed"> 66 </span>
<span class="line-removed"> 67         public String value() {</span>
<span class="line-removed"> 68             return value;</span>
<span class="line-removed"> 69         }</span>
<span class="line-removed"> 70     }</span>
<span class="line-removed"> 71 </span>
<span class="line-removed"> 72     private static final Set&lt;String&gt; allowedSubSystems =</span>
<span class="line-removed"> 73             Stream.of(SubSystem.values()).map(SubSystem::value).collect(Collectors.toSet());</span>
<span class="line-removed"> 74 </span>
<span class="line-removed"> 75     private static final Map&lt;String, String[]&gt; subSystemPaths = new HashMap&lt;&gt;();</span>
<span class="line-removed"> 76 </span>
<span class="line-removed"> 77     private static void setPath(String[] line) {</span>
<span class="line-removed"> 78         String cgroupPath = line[2];</span>
<span class="line-removed"> 79         String[] subSystems = line[1].split(&quot;,&quot;);</span>
<span class="line-removed"> 80 </span>
<span class="line-removed"> 81         for (String subSystem : subSystems) {</span>
<span class="line-removed"> 82             if (allowedSubSystems.contains(subSystem)) {</span>
<span class="line-removed"> 83                 String[] paths = subSystemPaths.get(subSystem);</span>
<span class="line-removed"> 84                 String finalPath = &quot;&quot;;</span>
<span class="line-removed"> 85                 String root = paths[0];</span>
<span class="line-removed"> 86                 String mountPoint = paths[1];</span>
<span class="line-removed"> 87                 if (root != null &amp;&amp; cgroupPath != null) {</span>
<span class="line-removed"> 88                     if (root.equals(&quot;/&quot;)) {</span>
<span class="line-removed"> 89                         if (!cgroupPath.equals(&quot;/&quot;)) {</span>
<span class="line-removed"> 90                             finalPath = mountPoint + cgroupPath;</span>
<span class="line-removed"> 91                         } else {</span>
<span class="line-removed"> 92                             finalPath = mountPoint;</span>
<span class="line-removed"> 93                         }</span>
<span class="line-removed"> 94                     } else {</span>
<span class="line-removed"> 95                         if (root.equals(cgroupPath)) {</span>
<span class="line-removed"> 96                             finalPath = mountPoint;</span>
<span class="line-removed"> 97                         } else {</span>
<span class="line-removed"> 98                             if (cgroupPath.startsWith(root)) {</span>
<span class="line-removed"> 99                                 if (cgroupPath.length() &gt; root.length()) {</span>
<span class="line-removed">100                                     String cgroupSubstr = cgroupPath.substring(root.length());</span>
<span class="line-removed">101                                     finalPath = mountPoint + cgroupSubstr;</span>
<span class="line-removed">102                                 }</span>
<span class="line-removed">103                             }</span>
<span class="line-removed">104                         }</span>
<span class="line-removed">105                     }</span>
<span class="line-removed">106                 }</span>
<span class="line-removed">107                 subSystemPaths.put(subSystem, new String[]{finalPath, mountPoint});</span>
<span class="line-removed">108             }</span>
<span class="line-removed">109         }</span>
<span class="line-removed">110     }</span>
<span class="line-removed">111 </span>
<span class="line-removed">112     private static void createSubsystems(String[] line) {</span>
<span class="line-removed">113         if (line.length &lt; 5) return;</span>
<span class="line-removed">114         Path p = Paths.get(line[4]);</span>
<span class="line-removed">115         String subsystemName = p.getFileName().toString();</span>
<span class="line-removed">116         if (subsystemName != null) {</span>
<span class="line-removed">117             for (String subSystem : subsystemName.split(&quot;,&quot;)) {</span>
<span class="line-removed">118                 if (allowedSubSystems.contains(subSystem)) {</span>
<span class="line-removed">119                     subSystemPaths.put(subSystem, new String[]{line[3], line[4]});</span>
<span class="line-removed">120                 }</span>
<span class="line-removed">121             }</span>
<span class="line-removed">122         }</span>
<span class="line-removed">123     }</span>
<span class="line-removed">124 </span>
<span class="line-removed">125     public void setup() {</span>
<span class="line-removed">126         Metrics metrics = Metrics.systemMetrics();</span>
<span class="line-removed">127         // Initialize CPU usage metrics before we do any testing.</span>
<span class="line-removed">128         startSysVal = metrics.getCpuSystemUsage();</span>
<span class="line-removed">129         startUserVal = metrics.getCpuUserUsage();</span>
<span class="line-removed">130         startUsage = metrics.getCpuUsage();</span>
<span class="line-removed">131         startPerCpu = metrics.getPerCpuUsage();</span>
<span class="line-removed">132 </span>
<span class="line-removed">133         try {</span>
<span class="line-removed">134             Stream&lt;String&gt; lines = Files.lines(Paths.get(&quot;/proc/self/mountinfo&quot;));</span>
<span class="line-removed">135             lines.filter(line -&gt; line.contains(&quot; - cgroup cgroup &quot;))</span>
<span class="line-removed">136                     .map(line -&gt; line.split(&quot; &quot;))</span>
<span class="line-removed">137                     .forEach(MetricsTester::createSubsystems);</span>
<span class="line-removed">138             lines.close();</span>
<span class="line-removed">139 </span>
<span class="line-removed">140             lines = Files.lines(Paths.get(&quot;/proc/self/cgroup&quot;));</span>
<span class="line-removed">141             lines.map(line -&gt; line.split(&quot;:&quot;))</span>
<span class="line-removed">142                     .filter(line -&gt; (line.length &gt;= 3))</span>
<span class="line-removed">143                     .forEach(MetricsTester::setPath);</span>
<span class="line-removed">144             lines.close();</span>
<span class="line-removed">145         } catch (IOException e) {</span>
<span class="line-removed">146         }</span>
<span class="line-removed">147     }</span>
148 
<a name="6" id="anc6"></a><span class="line-modified">149     private static String getFileContents(SubSystem subSystem, String fileName) {</span>
<span class="line-modified">150         String fname = subSystemPaths.get(subSystem.value())[0] + File.separator + fileName;</span>
<span class="line-modified">151         try {</span>
<span class="line-modified">152             return new Scanner(new File(fname)).useDelimiter(&quot;\\Z&quot;).next();</span>
<span class="line-modified">153         } catch (FileNotFoundException e) {</span>
<span class="line-modified">154             System.err.println(&quot;Unable to open : &quot; + fname);</span>
<span class="line-modified">155             return &quot;&quot;;</span>





156         }
157     }
158 
<a name="7" id="anc7"></a><span class="line-modified">159     private static long getLongValueFromFile(SubSystem subSystem, String fileName) {</span>
<span class="line-modified">160         String data = getFileContents(subSystem, fileName);</span>
<span class="line-modified">161         return data.isEmpty() ? 0L : convertStringToLong(data);</span>
<span class="line-modified">162     }</span>
<span class="line-modified">163 </span>
<span class="line-modified">164     private static long convertStringToLong(String strval) {</span>
<span class="line-modified">165         long retval = 0;</span>
<span class="line-modified">166         if (strval == null) return 0L;</span>
<span class="line-modified">167 </span>
<span class="line-removed">168         try {</span>
<span class="line-removed">169             retval = Long.parseLong(strval);</span>
<span class="line-removed">170         } catch (NumberFormatException e) {</span>
<span class="line-removed">171             // For some properties (e.g. memory.limit_in_bytes) we may overflow the range of signed long.</span>
<span class="line-removed">172             // In this case, return Long.MAX_VALUE</span>
<span class="line-removed">173             BigInteger b = new BigInteger(strval);</span>
<span class="line-removed">174             if (b.compareTo(BigInteger.valueOf(Long.MAX_VALUE)) &gt; 0) {</span>
<span class="line-removed">175                 return Long.MAX_VALUE;</span>
<span class="line-removed">176             }</span>
<span class="line-removed">177         }</span>
<span class="line-removed">178         return retval;</span>
<span class="line-removed">179     }</span>
<span class="line-removed">180 </span>
<span class="line-removed">181     private static long getLongValueFromFile(SubSystem subSystem, String metric, String subMetric) {</span>
<span class="line-removed">182         String stats = getFileContents(subSystem, metric);</span>
<span class="line-removed">183         String[] tokens = stats.split(&quot;[\\r\\n]+&quot;);</span>
<span class="line-removed">184         for (int i = 0; i &lt; tokens.length; i++) {</span>
<span class="line-removed">185             if (tokens[i].startsWith(subMetric)) {</span>
<span class="line-removed">186                 String strval = tokens[i].split(&quot;\\s+&quot;)[1];</span>
<span class="line-removed">187                 return convertStringToLong(strval);</span>
<span class="line-removed">188             }</span>
<span class="line-removed">189         }</span>
<span class="line-removed">190         return 0L;</span>
<span class="line-removed">191     }</span>
<span class="line-removed">192 </span>
<span class="line-removed">193     private static double getDoubleValueFromFile(SubSystem subSystem, String fileName) {</span>
<span class="line-removed">194         String data = getFileContents(subSystem, fileName);</span>
<span class="line-removed">195         return data.isEmpty() ? 0.0 : Double.parseDouble(data);</span>
<span class="line-removed">196     }</span>
<span class="line-removed">197 </span>
<span class="line-removed">198     private boolean compareWithErrorMargin(long oldVal, long newVal) {</span>
<span class="line-removed">199         return Math.abs(oldVal - newVal) &lt;= Math.abs(oldVal * ERROR_MARGIN);</span>
<span class="line-removed">200     }</span>
<span class="line-removed">201 </span>
<span class="line-removed">202     private boolean compareWithErrorMargin(double oldVal, double newVal) {</span>
<span class="line-removed">203         return Math.abs(oldVal - newVal) &lt;= Math.abs(oldVal * ERROR_MARGIN);</span>
<span class="line-removed">204     }</span>
<span class="line-removed">205 </span>
<span class="line-removed">206     private static void fail(SubSystem system, String metric, long oldVal, long testVal) {</span>
<span class="line-removed">207         throw new RuntimeException(&quot;Test failed for - &quot; + system.value + &quot;:&quot;</span>
<span class="line-removed">208                 + metric + &quot;, expected [&quot; + oldVal + &quot;], got [&quot; + testVal + &quot;]&quot;);</span>
<span class="line-removed">209     }</span>
<span class="line-removed">210 </span>
<span class="line-removed">211     private static void fail(SubSystem system, String metric, String oldVal, String testVal) {</span>
<span class="line-removed">212         throw new RuntimeException(&quot;Test failed for - &quot; + system.value + &quot;:&quot;</span>
<span class="line-removed">213                 + metric + &quot;, expected [&quot; + oldVal + &quot;], got [&quot; + testVal + &quot;]&quot;);</span>
<span class="line-removed">214     }</span>
<span class="line-removed">215 </span>
<span class="line-removed">216     private static void fail(SubSystem system, String metric, double oldVal, double testVal) {</span>
<span class="line-removed">217         throw new RuntimeException(&quot;Test failed for - &quot; + system.value + &quot;:&quot;</span>
<span class="line-removed">218                 + metric + &quot;, expected [&quot; + oldVal + &quot;], got [&quot; + testVal + &quot;]&quot;);</span>
<span class="line-removed">219     }</span>
<span class="line-removed">220 </span>
<span class="line-removed">221     private static void fail(SubSystem system, String metric, boolean oldVal, boolean testVal) {</span>
<span class="line-removed">222         throw new RuntimeException(&quot;Test failed for - &quot; + system.value + &quot;:&quot;</span>
<span class="line-removed">223                 + metric + &quot;, expected [&quot; + oldVal + &quot;], got [&quot; + testVal + &quot;]&quot;);</span>
<span class="line-removed">224     }</span>
<span class="line-removed">225 </span>
<span class="line-removed">226     private static void warn(SubSystem system, String metric, long oldVal, long testVal) {</span>
<span class="line-removed">227         System.err.println(&quot;Warning - &quot; + system.value + &quot;:&quot; + metric</span>
<span class="line-removed">228                 + &quot;, expected [&quot; + oldVal + &quot;], got [&quot; + testVal + &quot;]&quot;);</span>
<span class="line-removed">229     }</span>
<span class="line-removed">230 </span>
<span class="line-removed">231     public void testMemorySubsystem() {</span>
<span class="line-removed">232         Metrics metrics = Metrics.systemMetrics();</span>
<span class="line-removed">233 </span>
<span class="line-removed">234         // User Memory</span>
<span class="line-removed">235         long oldVal = metrics.getMemoryFailCount();</span>
<span class="line-removed">236         long newVal = getLongValueFromFile(SubSystem.MEMORY, &quot;memory.failcnt&quot;);</span>
<span class="line-removed">237         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">238             fail(SubSystem.MEMORY, &quot;memory.failcnt&quot;, oldVal, newVal);</span>
<span class="line-removed">239         }</span>
<span class="line-removed">240 </span>
<span class="line-removed">241         oldVal = metrics.getMemoryLimit();</span>
<span class="line-removed">242         newVal = getLongValueFromFile(SubSystem.MEMORY, &quot;memory.limit_in_bytes&quot;);</span>
<span class="line-removed">243         newVal = newVal &gt; unlimited_minimum ? -1L : newVal;</span>
<span class="line-removed">244         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">245             fail(SubSystem.MEMORY, &quot;memory.limit_in_bytes&quot;, oldVal, newVal);</span>
<span class="line-removed">246         }</span>
<span class="line-removed">247 </span>
<span class="line-removed">248         oldVal = metrics.getMemoryMaxUsage();</span>
<span class="line-removed">249         newVal = getLongValueFromFile(SubSystem.MEMORY, &quot;memory.max_usage_in_bytes&quot;);</span>
<span class="line-removed">250         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">251             fail(SubSystem.MEMORY, &quot;memory.max_usage_in_bytes&quot;, oldVal, newVal);</span>
<span class="line-removed">252         }</span>
<span class="line-removed">253 </span>
<span class="line-removed">254         oldVal = metrics.getMemoryUsage();</span>
<span class="line-removed">255         newVal = getLongValueFromFile(SubSystem.MEMORY, &quot;memory.usage_in_bytes&quot;);</span>
<span class="line-removed">256         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">257             fail(SubSystem.MEMORY, &quot;memory.usage_in_bytes&quot;, oldVal, newVal);</span>
<span class="line-removed">258         }</span>
<span class="line-removed">259 </span>
<span class="line-removed">260         // Kernel memory</span>
<span class="line-removed">261         oldVal = metrics.getKernelMemoryFailCount();</span>
<span class="line-removed">262         newVal = getLongValueFromFile(SubSystem.MEMORY, &quot;memory.kmem.failcnt&quot;);</span>
<span class="line-removed">263         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">264             fail(SubSystem.MEMORY, &quot;memory.kmem.failcnt&quot;, oldVal, newVal);</span>
<span class="line-removed">265         }</span>
<span class="line-removed">266 </span>
<span class="line-removed">267         oldVal = metrics.getKernelMemoryLimit();</span>
<span class="line-removed">268         newVal = getLongValueFromFile(SubSystem.MEMORY, &quot;memory.kmem.limit_in_bytes&quot;);</span>
<span class="line-removed">269         newVal = newVal &gt; unlimited_minimum ? -1L : newVal;</span>
<span class="line-removed">270         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">271             fail(SubSystem.MEMORY, &quot;memory.kmem.limit_in_bytes&quot;, oldVal, newVal);</span>
<span class="line-removed">272         }</span>
<span class="line-removed">273 </span>
<span class="line-removed">274         oldVal = metrics.getKernelMemoryMaxUsage();</span>
<span class="line-removed">275         newVal = getLongValueFromFile(SubSystem.MEMORY, &quot;memory.kmem.max_usage_in_bytes&quot;);</span>
<span class="line-removed">276         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">277             fail(SubSystem.MEMORY, &quot;memory.kmem.max_usage_in_bytes&quot;, oldVal, newVal);</span>
<span class="line-removed">278         }</span>
<span class="line-removed">279 </span>
<span class="line-removed">280         oldVal = metrics.getKernelMemoryUsage();</span>
<span class="line-removed">281         newVal = getLongValueFromFile(SubSystem.MEMORY, &quot;memory.kmem.usage_in_bytes&quot;);</span>
<span class="line-removed">282         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">283             fail(SubSystem.MEMORY, &quot;memory.kmem.usage_in_bytes&quot;, oldVal, newVal);</span>
<span class="line-removed">284         }</span>
<span class="line-removed">285 </span>
<span class="line-removed">286         //TCP Memory</span>
<span class="line-removed">287         oldVal = metrics.getTcpMemoryFailCount();</span>
<span class="line-removed">288         newVal = getLongValueFromFile(SubSystem.MEMORY, &quot;memory.kmem.tcp.failcnt&quot;);</span>
<span class="line-removed">289         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">290             fail(SubSystem.MEMORY, &quot;memory.kmem.tcp.failcnt&quot;, oldVal, newVal);</span>
<span class="line-removed">291         }</span>
<span class="line-removed">292 </span>
<span class="line-removed">293         oldVal = metrics.getTcpMemoryLimit();</span>
<span class="line-removed">294         newVal = getLongValueFromFile(SubSystem.MEMORY, &quot;memory.kmem.tcp.limit_in_bytes&quot;);</span>
<span class="line-removed">295         newVal = newVal &gt; unlimited_minimum ? -1L : newVal;</span>
<span class="line-removed">296         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">297             fail(SubSystem.MEMORY, &quot;memory.kmem.tcp.limit_in_bytes&quot;, oldVal, newVal);</span>
<span class="line-removed">298         }</span>
<span class="line-removed">299 </span>
<span class="line-removed">300         oldVal = metrics.getTcpMemoryMaxUsage();</span>
<span class="line-removed">301         newVal = getLongValueFromFile(SubSystem.MEMORY, &quot;memory.kmem.tcp.max_usage_in_bytes&quot;);</span>
<span class="line-removed">302         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">303             fail(SubSystem.MEMORY, &quot;memory.kmem.tcp.max_usage_in_bytes&quot;, oldVal, newVal);</span>
<span class="line-removed">304         }</span>
<span class="line-removed">305 </span>
<span class="line-removed">306         oldVal = metrics.getTcpMemoryUsage();</span>
<span class="line-removed">307         newVal = getLongValueFromFile(SubSystem.MEMORY, &quot;memory.kmem.tcp.usage_in_bytes&quot;);</span>
<span class="line-removed">308         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">309             fail(SubSystem.MEMORY, &quot;memory.kmem.tcp.usage_in_bytes&quot;, oldVal, newVal);</span>
<span class="line-removed">310         }</span>
<span class="line-removed">311 </span>
<span class="line-removed">312         //  Memory and Swap</span>
<span class="line-removed">313         oldVal = metrics.getMemoryAndSwapFailCount();</span>
<span class="line-removed">314         newVal = getLongValueFromFile(SubSystem.MEMORY, &quot;memory.memsw.failcnt&quot;);</span>
<span class="line-removed">315         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">316             fail(SubSystem.MEMORY, &quot;memory.memsw.failcnt&quot;, oldVal, newVal);</span>
<span class="line-removed">317         }</span>
<span class="line-removed">318 </span>
<span class="line-removed">319         oldVal = metrics.getMemoryAndSwapLimit();</span>
<span class="line-removed">320         newVal = getLongValueFromFile(SubSystem.MEMORY, &quot;memory.memsw.limit_in_bytes&quot;);</span>
<span class="line-removed">321         newVal = newVal &gt; unlimited_minimum ? -1L : newVal;</span>
<span class="line-removed">322         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">323             fail(SubSystem.MEMORY, &quot;memory.memsw.limit_in_bytes&quot;, oldVal, newVal);</span>
<span class="line-removed">324         }</span>
<span class="line-removed">325 </span>
<span class="line-removed">326         oldVal = metrics.getMemoryAndSwapMaxUsage();</span>
<span class="line-removed">327         newVal = getLongValueFromFile(SubSystem.MEMORY, &quot;memory.memsw.max_usage_in_bytes&quot;);</span>
<span class="line-removed">328         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">329             fail(SubSystem.MEMORY, &quot;memory.memsw.max_usage_in_bytes&quot;, oldVal, newVal);</span>
<span class="line-removed">330         }</span>
<span class="line-removed">331 </span>
<span class="line-removed">332         oldVal = metrics.getMemoryAndSwapUsage();</span>
<span class="line-removed">333         newVal = getLongValueFromFile(SubSystem.MEMORY, &quot;memory.memsw.usage_in_bytes&quot;);</span>
<span class="line-removed">334         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">335             fail(SubSystem.MEMORY, &quot;memory.memsw.usage_in_bytes&quot;, oldVal, newVal);</span>
<span class="line-removed">336         }</span>
<span class="line-removed">337 </span>
<span class="line-removed">338         oldVal = metrics.getMemorySoftLimit();</span>
<span class="line-removed">339         newVal = getLongValueFromFile(SubSystem.MEMORY, &quot;memory.soft_limit_in_bytes&quot;);</span>
<span class="line-removed">340         newVal = newVal &gt; unlimited_minimum ? -1L : newVal;</span>
<span class="line-removed">341         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">342             fail(SubSystem.MEMORY, &quot;memory.soft_limit_in_bytes&quot;, oldVal, newVal);</span>
<span class="line-removed">343         }</span>
<span class="line-removed">344 </span>
<span class="line-removed">345         boolean oomKillEnabled = metrics.isMemoryOOMKillEnabled();</span>
<span class="line-removed">346         boolean newOomKillEnabled = getLongValueFromFile(SubSystem.MEMORY,</span>
<span class="line-removed">347                 &quot;memory.oom_control&quot;, &quot;oom_kill_disable&quot;) == 0L ? true : false;</span>
<span class="line-removed">348         if (oomKillEnabled != newOomKillEnabled) {</span>
<span class="line-removed">349             throw new RuntimeException(&quot;Test failed for - &quot; + SubSystem.MEMORY.value + &quot;:&quot;</span>
<span class="line-removed">350                     + &quot;memory.oom_control:oom_kill_disable&quot; + &quot;, expected [&quot;</span>
<span class="line-removed">351                     + oomKillEnabled + &quot;], got [&quot; + newOomKillEnabled + &quot;]&quot;);</span>
<span class="line-removed">352         }</span>
<span class="line-removed">353     }</span>
<span class="line-removed">354 </span>
<span class="line-removed">355     public void testCpuAccounting() {</span>
<span class="line-removed">356         Metrics metrics = Metrics.systemMetrics();</span>
<span class="line-removed">357         long oldVal = metrics.getCpuUsage();</span>
<span class="line-removed">358         long newVal = getLongValueFromFile(SubSystem.CPUACCT, &quot;cpuacct.usage&quot;);</span>
<span class="line-removed">359 </span>
<span class="line-removed">360         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">361             warn(SubSystem.CPUACCT, &quot;cpuacct.usage&quot;, oldVal, newVal);</span>
<span class="line-removed">362         }</span>
<span class="line-removed">363 </span>
<span class="line-removed">364         Long[] newVals = Stream.of(getFileContents(SubSystem.CPUACCT, &quot;cpuacct.usage_percpu&quot;)</span>
<span class="line-removed">365                 .split(&quot;\\s+&quot;))</span>
<span class="line-removed">366                 .map(Long::parseLong)</span>
<span class="line-removed">367                 .toArray(Long[]::new);</span>
<span class="line-removed">368         Long[] oldVals = LongStream.of(metrics.getPerCpuUsage()).boxed().toArray(Long[]::new);</span>
<span class="line-removed">369         for (int i = 0; i &lt; oldVals.length; i++) {</span>
<span class="line-removed">370             if (!compareWithErrorMargin(oldVals[i], newVals[i])) {</span>
<span class="line-removed">371                 warn(SubSystem.CPUACCT, &quot;cpuacct.usage_percpu&quot;, oldVals[i], newVals[i]);</span>
<span class="line-removed">372             }</span>
<span class="line-removed">373         }</span>
<span class="line-removed">374 </span>
<span class="line-removed">375         oldVal = metrics.getCpuUserUsage();</span>
<span class="line-removed">376         newVal = getLongValueFromFile(SubSystem.CPUACCT, &quot;cpuacct.stat&quot;, &quot;user&quot;);</span>
<span class="line-removed">377         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">378             warn(SubSystem.CPUACCT, &quot;cpuacct.usage - user&quot;, oldVal, newVal);</span>
<span class="line-removed">379         }</span>
<span class="line-removed">380 </span>
<span class="line-removed">381         oldVal = metrics.getCpuSystemUsage();</span>
<span class="line-removed">382         newVal = getLongValueFromFile(SubSystem.CPUACCT, &quot;cpuacct.stat&quot;, &quot;system&quot;);</span>
<span class="line-removed">383         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">384             warn(SubSystem.CPUACCT, &quot;cpuacct.usage - system&quot;, oldVal, newVal);</span>
<span class="line-removed">385         }</span>
<span class="line-removed">386     }</span>
<span class="line-removed">387 </span>
<span class="line-removed">388     public void testCpuSchedulingMetrics() {</span>
<span class="line-removed">389         Metrics metrics = Metrics.systemMetrics();</span>
<span class="line-removed">390         long oldVal = metrics.getCpuPeriod();</span>
<span class="line-removed">391         long newVal = getLongValueFromFile(SubSystem.CPUACCT, &quot;cpu.cfs_period_us&quot;);</span>
<span class="line-removed">392         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">393             fail(SubSystem.CPUACCT, &quot;cpu.cfs_period_us&quot;, oldVal, newVal);</span>
<span class="line-removed">394         }</span>
<span class="line-removed">395 </span>
<span class="line-removed">396         oldVal = metrics.getCpuQuota();</span>
<span class="line-removed">397         newVal = getLongValueFromFile(SubSystem.CPUACCT, &quot;cpu.cfs_quota_us&quot;);</span>
<span class="line-removed">398         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">399             fail(SubSystem.CPUACCT, &quot;cpu.cfs_quota_us&quot;, oldVal, newVal);</span>
<span class="line-removed">400         }</span>
<span class="line-removed">401 </span>
<span class="line-removed">402         oldVal = metrics.getCpuShares();</span>
<span class="line-removed">403         newVal = getLongValueFromFile(SubSystem.CPUACCT, &quot;cpu.shares&quot;);</span>
<span class="line-removed">404         if (newVal == 0 || newVal == 1024) newVal = -1;</span>
<span class="line-removed">405         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">406             fail(SubSystem.CPUACCT, &quot;cpu.shares&quot;, oldVal, newVal);</span>
<span class="line-removed">407         }</span>
<span class="line-removed">408 </span>
<span class="line-removed">409         oldVal = metrics.getCpuNumPeriods();</span>
<span class="line-removed">410         newVal = getLongValueFromFile(SubSystem.CPUACCT, &quot;cpu.stat&quot;, &quot;nr_periods&quot;);</span>
<span class="line-removed">411         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">412             fail(SubSystem.CPUACCT, &quot;cpu.stat - nr_periods&quot;, oldVal, newVal);</span>
<span class="line-removed">413         }</span>
<span class="line-removed">414 </span>
<span class="line-removed">415         oldVal = metrics.getCpuNumThrottled();</span>
<span class="line-removed">416         newVal = getLongValueFromFile(SubSystem.CPUACCT, &quot;cpu.stat&quot;, &quot;nr_throttled&quot;);</span>
<span class="line-removed">417         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">418             fail(SubSystem.CPUACCT, &quot;cpu.stat - nr_throttled&quot;, oldVal, newVal);</span>
<span class="line-removed">419         }</span>
<span class="line-removed">420 </span>
<span class="line-removed">421         oldVal = metrics.getCpuThrottledTime();</span>
<span class="line-removed">422         newVal = getLongValueFromFile(SubSystem.CPUACCT, &quot;cpu.stat&quot;, &quot;throttled_time&quot;);</span>
<span class="line-removed">423         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">424             fail(SubSystem.CPUACCT, &quot;cpu.stat - throttled_time&quot;, oldVal, newVal);</span>
<span class="line-removed">425         }</span>
<span class="line-removed">426     }</span>
<span class="line-removed">427 </span>
<span class="line-removed">428     public void testCpuSets() {</span>
<span class="line-removed">429         Metrics metrics = Metrics.systemMetrics();</span>
<span class="line-removed">430         Integer[] oldVal = Arrays.stream(metrics.getCpuSetCpus()).boxed().toArray(Integer[]::new);</span>
<span class="line-removed">431         Arrays.sort(oldVal);</span>
<span class="line-removed">432 </span>
<span class="line-removed">433         String cpusstr = getFileContents(SubSystem.CPUSET, &quot;cpuset.cpus&quot;);</span>
<span class="line-removed">434         // Parse range string in the format 1,2-6,7</span>
<span class="line-removed">435         Integer[] newVal = Stream.of(cpusstr.split(&quot;,&quot;)).flatMap(a -&gt; {</span>
<span class="line-removed">436             if (a.contains(&quot;-&quot;)) {</span>
<span class="line-removed">437                 String[] range = a.split(&quot;-&quot;);</span>
<span class="line-removed">438                 return IntStream.rangeClosed(Integer.parseInt(range[0]),</span>
<span class="line-removed">439                         Integer.parseInt(range[1])).boxed();</span>
<span class="line-removed">440             } else {</span>
<span class="line-removed">441                 return Stream.of(Integer.parseInt(a));</span>
<span class="line-removed">442             }</span>
<span class="line-removed">443         }).toArray(Integer[]::new);</span>
<span class="line-removed">444         Arrays.sort(newVal);</span>
<span class="line-removed">445         if (Arrays.compare(oldVal, newVal) != 0) {</span>
<span class="line-removed">446             fail(SubSystem.CPUSET, &quot;cpuset.cpus&quot;, Arrays.toString(oldVal),</span>
<span class="line-removed">447                 Arrays.toString(newVal));</span>
<span class="line-removed">448         }</span>
<span class="line-removed">449 </span>
<span class="line-removed">450         int [] cpuSets = metrics.getEffectiveCpuSetCpus();</span>
<span class="line-removed">451 </span>
<span class="line-removed">452         // Skip this test if this metric is supported on this platform</span>
<span class="line-removed">453         if (cpuSets.length != 0) {</span>
<span class="line-removed">454             oldVal = Arrays.stream(cpuSets).boxed().toArray(Integer[]::new);</span>
<span class="line-removed">455             Arrays.sort(oldVal);</span>
<span class="line-removed">456             cpusstr = getFileContents(SubSystem.CPUSET, &quot;cpuset.effective_cpus&quot;);</span>
<span class="line-removed">457             newVal = Stream.of(cpusstr.split(&quot;,&quot;)).flatMap(a -&gt; {</span>
<span class="line-removed">458                 if (a.contains(&quot;-&quot;)) {</span>
<span class="line-removed">459                     String[] range = a.split(&quot;-&quot;);</span>
<span class="line-removed">460                     return IntStream.rangeClosed(Integer.parseInt(range[0]),</span>
<span class="line-removed">461                             Integer.parseInt(range[1])).boxed();</span>
<span class="line-removed">462                 } else {</span>
<span class="line-removed">463                     return Stream.of(Integer.parseInt(a));</span>
<span class="line-removed">464                 }</span>
<span class="line-removed">465             }).toArray(Integer[]::new);</span>
<span class="line-removed">466             Arrays.sort(newVal);</span>
<span class="line-removed">467             if (Arrays.compare(oldVal, newVal) != 0) {</span>
<span class="line-removed">468                 fail(SubSystem.CPUSET, &quot;cpuset.effective_cpus&quot;, Arrays.toString(oldVal),</span>
<span class="line-removed">469                         Arrays.toString(newVal));</span>
<span class="line-removed">470             }</span>
<span class="line-removed">471         }</span>
<span class="line-removed">472 </span>
<span class="line-removed">473         oldVal = Arrays.stream(metrics.getCpuSetMems()).boxed().toArray(Integer[]::new);</span>
<span class="line-removed">474         Arrays.sort(oldVal);</span>
<span class="line-removed">475         cpusstr = getFileContents(SubSystem.CPUSET, &quot;cpuset.mems&quot;);</span>
<span class="line-removed">476         newVal = Stream.of(cpusstr.split(&quot;,&quot;)).flatMap(a -&gt; {</span>
<span class="line-removed">477             if (a.contains(&quot;-&quot;)) {</span>
<span class="line-removed">478                 String[] range = a.split(&quot;-&quot;);</span>
<span class="line-removed">479                 return IntStream.rangeClosed(Integer.parseInt(range[0]),</span>
<span class="line-removed">480                         Integer.parseInt(range[1])).boxed();</span>
<span class="line-removed">481             } else {</span>
<span class="line-removed">482                 return Stream.of(Integer.parseInt(a));</span>
<span class="line-removed">483             }</span>
<span class="line-removed">484         }).toArray(Integer[]::new);</span>
<span class="line-removed">485         Arrays.sort(newVal);</span>
<span class="line-removed">486         if (Arrays.compare(oldVal, newVal) != 0) {</span>
<span class="line-removed">487             fail(SubSystem.CPUSET, &quot;cpuset.mems&quot;, Arrays.toString(oldVal),</span>
<span class="line-removed">488                     Arrays.toString(newVal));</span>
<span class="line-removed">489         }</span>
<span class="line-removed">490 </span>
<span class="line-removed">491         int [] cpuSetMems = metrics.getEffectiveCpuSetMems();</span>
<span class="line-removed">492 </span>
<span class="line-removed">493         // Skip this test if this metric is supported on this platform</span>
<span class="line-removed">494         if (cpuSetMems.length != 0) {</span>
<span class="line-removed">495             oldVal = Arrays.stream(cpuSetMems).boxed().toArray(Integer[]::new);</span>
<span class="line-removed">496             Arrays.sort(oldVal);</span>
<span class="line-removed">497             cpusstr = getFileContents(SubSystem.CPUSET, &quot;cpuset.effective_mems&quot;);</span>
<span class="line-removed">498             newVal = Stream.of(cpusstr.split(&quot;,&quot;)).flatMap(a -&gt; {</span>
<span class="line-removed">499                 if (a.contains(&quot;-&quot;)) {</span>
<span class="line-removed">500                     String[] range = a.split(&quot;-&quot;);</span>
<span class="line-removed">501                     return IntStream.rangeClosed(Integer.parseInt(range[0]),</span>
<span class="line-removed">502                             Integer.parseInt(range[1])).boxed();</span>
<span class="line-removed">503                 } else {</span>
<span class="line-removed">504                     return Stream.of(Integer.parseInt(a));</span>
<span class="line-removed">505                 }</span>
<span class="line-removed">506             }).toArray(Integer[]::new);</span>
<span class="line-removed">507             Arrays.sort(newVal);</span>
<span class="line-removed">508             if (Arrays.compare(oldVal, newVal) != 0) {</span>
<span class="line-removed">509                 fail(SubSystem.CPUSET, &quot;cpuset.effective_mems&quot;, Arrays.toString(oldVal),</span>
<span class="line-removed">510                         Arrays.toString(newVal));</span>
<span class="line-removed">511             }</span>
<span class="line-removed">512         }</span>
<span class="line-removed">513 </span>
<span class="line-removed">514         double oldValue = metrics.getCpuSetMemoryPressure();</span>
<span class="line-removed">515         double newValue = getDoubleValueFromFile(SubSystem.CPUSET, &quot;cpuset.memory_pressure&quot;);</span>
<span class="line-removed">516         if (!compareWithErrorMargin(oldValue, newValue)) {</span>
<span class="line-removed">517             fail(SubSystem.CPUSET, &quot;cpuset.memory_pressure&quot;, oldValue, newValue);</span>
<span class="line-removed">518         }</span>
<span class="line-removed">519 </span>
<span class="line-removed">520         boolean oldV = metrics.isCpuSetMemoryPressureEnabled();</span>
<span class="line-removed">521         boolean newV = getLongValueFromFile(SubSystem.CPUSET,</span>
<span class="line-removed">522                 &quot;cpuset.memory_pressure_enabled&quot;) == 1 ? true : false;</span>
<span class="line-removed">523         if (oldV != newV) {</span>
<span class="line-removed">524             fail(SubSystem.CPUSET, &quot;cpuset.memory_pressure_enabled&quot;, oldV, newV);</span>
<span class="line-removed">525         }</span>
<span class="line-removed">526     }</span>
<span class="line-removed">527 </span>
<span class="line-removed">528     public void testBlkIO() {</span>
<span class="line-removed">529         Metrics metrics = Metrics.systemMetrics();</span>
<span class="line-removed">530             long oldVal = metrics.getBlkIOServiceCount();</span>
<span class="line-removed">531         long newVal = getLongValueFromFile(SubSystem.BLKIO,</span>
<span class="line-removed">532                 &quot;blkio.throttle.io_service_bytes&quot;, &quot;Total&quot;);</span>
<span class="line-removed">533         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">534             fail(SubSystem.BLKIO, &quot;blkio.throttle.io_service_bytes - Total&quot;,</span>
<span class="line-removed">535                     oldVal, newVal);</span>
<span class="line-removed">536         }</span>
<span class="line-removed">537 </span>
<span class="line-removed">538         oldVal = metrics.getBlkIOServiced();</span>
<span class="line-removed">539         newVal = getLongValueFromFile(SubSystem.BLKIO, &quot;blkio.throttle.io_serviced&quot;, &quot;Total&quot;);</span>
<span class="line-removed">540         if (!compareWithErrorMargin(oldVal, newVal)) {</span>
<span class="line-removed">541             fail(SubSystem.BLKIO, &quot;blkio.throttle.io_serviced - Total&quot;, oldVal, newVal);</span>
<span class="line-removed">542         }</span>
<span class="line-removed">543     }</span>
<span class="line-removed">544 </span>
<span class="line-removed">545     public void testCpuConsumption() throws IOException, InterruptedException {</span>
<span class="line-removed">546         Metrics metrics = Metrics.systemMetrics();</span>
<span class="line-removed">547         // make system call</span>
<span class="line-removed">548         long newSysVal = metrics.getCpuSystemUsage();</span>
<span class="line-removed">549         long newUserVal = metrics.getCpuUserUsage();</span>
<span class="line-removed">550         long newUsage = metrics.getCpuUsage();</span>
<span class="line-removed">551         long[] newPerCpu = metrics.getPerCpuUsage();</span>
<span class="line-removed">552 </span>
<span class="line-removed">553         // system/user CPU usage counters may be slowly increasing.</span>
<span class="line-removed">554         // allow for equal values for a pass</span>
<span class="line-removed">555         if (newSysVal &lt; startSysVal) {</span>
<span class="line-removed">556             fail(SubSystem.CPU, &quot;getCpuSystemUsage&quot;, newSysVal, startSysVal);</span>
<span class="line-removed">557         }</span>
<span class="line-removed">558 </span>
<span class="line-removed">559         // system/user CPU usage counters may be slowly increasing.</span>
<span class="line-removed">560         // allow for equal values for a pass</span>
<span class="line-removed">561         if (newUserVal &lt; startUserVal) {</span>
<span class="line-removed">562             fail(SubSystem.CPU, &quot;getCpuUserUsage&quot;, newUserVal, startUserVal);</span>
<span class="line-removed">563         }</span>
<span class="line-removed">564 </span>
<span class="line-removed">565         if (newUsage &lt;= startUsage) {</span>
<span class="line-removed">566             fail(SubSystem.CPU, &quot;getCpuUsage&quot;, newUsage, startUsage);</span>
<span class="line-removed">567         }</span>
<span class="line-removed">568 </span>
<span class="line-removed">569         boolean success = false;</span>
<span class="line-removed">570         for (int i = 0; i &lt; startPerCpu.length; i++) {</span>
<span class="line-removed">571             if (newPerCpu[i] &gt; startPerCpu[i]) {</span>
<span class="line-removed">572                 success = true;</span>
<span class="line-removed">573                 break;</span>
<span class="line-removed">574             }</span>
<span class="line-removed">575         }</span>
<span class="line-removed">576 </span>
<span class="line-removed">577         if(!success) fail(SubSystem.CPU, &quot;getPerCpuUsage&quot;, Arrays.toString(newPerCpu),</span>
<span class="line-removed">578                 Arrays.toString(startPerCpu));</span>
<span class="line-removed">579     }</span>
<span class="line-removed">580 </span>
<span class="line-removed">581     public void testMemoryUsage() throws Exception {</span>
<span class="line-removed">582         Metrics metrics = Metrics.systemMetrics();</span>
<span class="line-removed">583         long memoryMaxUsage = metrics.getMemoryMaxUsage();</span>
<span class="line-removed">584         long memoryUsage = metrics.getMemoryUsage();</span>
<span class="line-removed">585         long newMemoryMaxUsage = 0, newMemoryUsage = 0;</span>
<span class="line-removed">586 </span>
<span class="line-removed">587         // allocate memory in a loop and check more than once for new values</span>
<span class="line-removed">588         // otherwise we might see seldom the effect of decreasing new memory values</span>
<span class="line-removed">589         // e.g. because the system could free up memory</span>
<span class="line-removed">590         byte[][] bytes = new byte[32][];</span>
<span class="line-removed">591         for (int i = 0; i &lt; 32; i++) {</span>
<span class="line-removed">592             bytes[i] = new byte[8*1024*1024];</span>
<span class="line-removed">593             newMemoryUsage = metrics.getMemoryUsage();</span>
<span class="line-removed">594             if (newMemoryUsage &gt; memoryUsage) {</span>
<span class="line-removed">595                 break;</span>
<span class="line-removed">596             }</span>
<span class="line-removed">597         }</span>
<span class="line-removed">598         newMemoryMaxUsage = metrics.getMemoryMaxUsage();</span>
<span class="line-removed">599 </span>
<span class="line-removed">600         if (newMemoryMaxUsage &lt; memoryMaxUsage) {</span>
<span class="line-removed">601             fail(SubSystem.MEMORY, &quot;getMemoryMaxUsage&quot;, memoryMaxUsage,</span>
<span class="line-removed">602                     newMemoryMaxUsage);</span>
<span class="line-removed">603         }</span>
<span class="line-removed">604 </span>
<span class="line-removed">605         if (newMemoryUsage &lt; memoryUsage) {</span>
<span class="line-removed">606             fail(SubSystem.MEMORY, &quot;getMemoryUsage&quot;, memoryUsage, newMemoryUsage);</span>
<span class="line-removed">607         }</span>
608     }
609 
610     public static void main(String[] args) throws Exception {
<a name="8" id="anc8"></a>
611         // If cgroups is not configured, report success
<a name="9" id="anc9"></a><span class="line-modified">612         Metrics metrics = Metrics.systemMetrics();</span>
<span class="line-removed">613         if (metrics == null) {</span>
614             System.out.println(&quot;TEST PASSED!!!&quot;);
615             return;
616         }
617 
618         MetricsTester metricsTester = new MetricsTester();
<a name="10" id="anc10"></a><span class="line-modified">619         metricsTester.setup();</span>
<span class="line-removed">620         metricsTester.testCpuAccounting();</span>
<span class="line-removed">621         metricsTester.testCpuSchedulingMetrics();</span>
<span class="line-removed">622         metricsTester.testCpuSets();</span>
<span class="line-removed">623         metricsTester.testMemorySubsystem();</span>
<span class="line-removed">624         metricsTester.testBlkIO();</span>
<span class="line-removed">625         metricsTester.testCpuConsumption();</span>
<span class="line-removed">626         metricsTester.testMemoryUsage();</span>
627         System.out.println(&quot;TEST PASSED!!!&quot;);
628     }
629 }
<a name="11" id="anc11"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="11" type="hidden" />
</body>
</html>