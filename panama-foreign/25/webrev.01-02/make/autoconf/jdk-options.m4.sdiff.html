<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/jdk-options.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="hotspot.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="libraries.m4.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/jdk-options.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
297 # Enable or disable the elliptic curve crypto implementation
298 #
299 AC_DEFUN_ONCE([JDKOPT_DETECT_INTREE_EC],
300 [
301   AC_MSG_CHECKING([if elliptic curve crypto implementation is present])
302 
303   if test -d &quot;${TOPDIR}/src/jdk.crypto.ec/share/native/libsunec/impl&quot;; then
304     ENABLE_INTREE_EC=true
305     AC_MSG_RESULT([yes])
306   else
307     ENABLE_INTREE_EC=false
308     AC_MSG_RESULT([no])
309   fi
310 
311   AC_SUBST(ENABLE_INTREE_EC)
312 ])
313 
314 AC_DEFUN_ONCE([JDKOPT_SETUP_DEBUG_SYMBOLS],
315 [
316   #
<span class="line-modified">317   # NATIVE_DEBUG_SYMBOLS</span>
318   # This must be done after the toolchain is setup, since we&#39;re looking at objcopy.
319   #
320   AC_MSG_CHECKING([what type of native debug symbols to use])
321   AC_ARG_WITH([native-debug-symbols],
322       [AS_HELP_STRING([--with-native-debug-symbols],
323       [set the native debug symbol configuration (none, internal, external, zipped) @&lt;:@varying@:&gt;@])],
324       [
325         if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
326           if test &quot;x$withval&quot; = xexternal || test &quot;x$withval&quot; = xzipped; then
327             AC_MSG_ERROR([AIX only supports the parameters &#39;none&#39; and &#39;internal&#39; for --with-native-debug-symbols])
328           fi
<span class="line-modified">329         else</span>
<span class="line-modified">330           if test &quot;x$OPENJDK_TARGET_OS&quot; = xwindows; then</span>
<span class="line-modified">331             if test &quot;x$withval&quot; = xinternal; then</span>
<span class="line-removed">332               AC_MSG_ERROR([Windows does not support the parameter &#39;internal&#39; for --with-native-debug-symbols])</span>
<span class="line-removed">333             fi</span>
334           fi
335         fi
336       ],
337       [
338         if test &quot;x$STATIC_BUILD&quot; = xtrue; then
339           with_native_debug_symbols=&quot;none&quot;
340         else
341           if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
342             # AIX doesn&#39;t support &#39;external&#39; so use &#39;internal&#39; as default
343             with_native_debug_symbols=&quot;internal&quot;
344           else
345             with_native_debug_symbols=&quot;external&quot;
346           fi
347         fi
348       ])
<span class="line-modified">349   NATIVE_DEBUG_SYMBOLS=$with_native_debug_symbols</span>
<span class="line-removed">350   AC_MSG_RESULT([$NATIVE_DEBUG_SYMBOLS])</span>
351 
<span class="line-modified">352   if test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xnone; then</span>
353     COMPILE_WITH_DEBUG_SYMBOLS=false
354     COPY_DEBUG_SYMBOLS=false
355     ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="line-modified">356   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xinternal; then</span>
357     COMPILE_WITH_DEBUG_SYMBOLS=true
358     COPY_DEBUG_SYMBOLS=false
359     ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="line-modified">360   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xexternal; then</span>
361 
362     if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
363       if test &quot;x$OBJCOPY&quot; = x; then
364         # enabling of enable-debug-symbols and can&#39;t find objcopy
365         # this is an error
366         AC_MSG_ERROR([Unable to find objcopy, cannot enable native debug symbols])
367       fi
368     fi
369 
370     COMPILE_WITH_DEBUG_SYMBOLS=true
371     COPY_DEBUG_SYMBOLS=true
372     ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="line-modified">373   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xzipped; then</span>
374 
375     if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
376       if test &quot;x$OBJCOPY&quot; = x; then
377         # enabling of enable-debug-symbols and can&#39;t find objcopy
378         # this is an error
379         AC_MSG_ERROR([Unable to find objcopy, cannot enable native debug symbols])
380       fi
381     fi
382 
383     COMPILE_WITH_DEBUG_SYMBOLS=true
384     COPY_DEBUG_SYMBOLS=true
385     ZIP_EXTERNAL_DEBUG_SYMBOLS=true
386   else
387     AC_MSG_ERROR([Allowed native debug symbols are: none, internal, external, zipped])
388   fi
389 
390   AC_SUBST(COMPILE_WITH_DEBUG_SYMBOLS)
391   AC_SUBST(COPY_DEBUG_SYMBOLS)
392   AC_SUBST(ZIP_EXTERNAL_DEBUG_SYMBOLS)



























393 ])
394 
395 ################################################################################
396 #
397 # Native and Java code coverage
398 #
399 AC_DEFUN_ONCE([JDKOPT_SETUP_CODE_COVERAGE],
400 [
401   AC_ARG_ENABLE(native-coverage, [AS_HELP_STRING([--enable-native-coverage],
402       [enable native compilation with code coverage data@&lt;:@disabled@:&gt;@])])
403   GCOV_ENABLED=&quot;false&quot;
404   if test &quot;x$enable_native_coverage&quot; = &quot;xyes&quot;; then
405     case $TOOLCHAIN_TYPE in
406       gcc | clang)
407         AC_MSG_CHECKING([if native coverage is enabled])
408         AC_MSG_RESULT([yes])
409         GCOV_CFLAGS=&quot;-fprofile-arcs -ftest-coverage -fno-inline&quot;
410         GCOV_LDFLAGS=&quot;-fprofile-arcs&quot;
411         JVM_CFLAGS=&quot;$JVM_CFLAGS $GCOV_CFLAGS&quot;
412         JVM_LDFLAGS=&quot;$JVM_LDFLAGS $GCOV_LDFLAGS&quot;
</pre>
<hr />
<pre>
599       AC_MSG_RESULT([yes, jtreg present])
600     fi
601   else
602     AC_MSG_ERROR([Invalid value for --enable-jtreg-failure-handler: $enable_jtreg_failure_handler])
603   fi
604 
605   AC_SUBST(BUILD_FAILURE_HANDLER)
606 ])
607 
608 ################################################################################
609 #
610 # Enable or disable generation of the classlist at build time
611 #
612 AC_DEFUN_ONCE([JDKOPT_ENABLE_DISABLE_GENERATE_CLASSLIST],
613 [
614   AC_ARG_ENABLE([generate-classlist], [AS_HELP_STRING([--disable-generate-classlist],
615       [forces enabling or disabling of the generation of a CDS classlist at build time.
616       Default is to generate it when either the server or client JVMs are built and
617       enable-cds is true.])])
618 
<span class="line-modified">619   # Check if it&#39;s likely that it&#39;s possible to generate the classlist. Depending</span>
<span class="line-modified">620   # on exact jvm configuration it could be possible anyway.</span>
<span class="line-removed">621   if test &quot;x$ENABLE_CDS&quot; = &quot;xtrue&quot; &amp;&amp; (HOTSPOT_CHECK_JVM_VARIANT(server) || HOTSPOT_CHECK_JVM_VARIANT(client) || HOTSPOT_CHECK_JVM_FEATURE(cds)); then</span>
<span class="line-removed">622     ENABLE_GENERATE_CLASSLIST_POSSIBLE=&quot;true&quot;</span>
<span class="line-removed">623   else</span>
<span class="line-removed">624     ENABLE_GENERATE_CLASSLIST_POSSIBLE=&quot;false&quot;</span>
<span class="line-removed">625   fi</span>
626 
627   AC_MSG_CHECKING([if the CDS classlist generation should be enabled])
628   if test &quot;x$enable_generate_classlist&quot; = &quot;xyes&quot;; then
629     AC_MSG_RESULT([yes, forced])
630     ENABLE_GENERATE_CLASSLIST=&quot;true&quot;
<span class="line-modified">631     if test &quot;x$ENABLE_GENERATE_CLASSLIST_POSSIBLE&quot; = &quot;xfalse&quot;; then</span>
<span class="line-modified">632       if test &quot;x$ENABLE_CDS&quot; = &quot;xfalse&quot;; then</span>
<span class="line-modified">633         # In GenerateLinkOptData.gmk, DumpLoadedClassList is used to generate the</span>
<span class="line-modified">634         # classlist file. It never will work in this case since the VM will report</span>
<span class="line-modified">635         # an error for DumpLoadedClassList when CDS is disabled.</span>
<span class="line-removed">636         AC_MSG_ERROR([Generation of classlist is not possible with enable-cds=false])</span>
<span class="line-removed">637       else</span>
<span class="line-removed">638         AC_MSG_WARN([Generation of classlist might not be possible with JVM Variants $JVM_VARIANTS and enable-cds=$ENABLE_CDS])</span>
<span class="line-removed">639       fi</span>
640     fi
641   elif test &quot;x$enable_generate_classlist&quot; = &quot;xno&quot;; then
642     AC_MSG_RESULT([no, forced])
643     ENABLE_GENERATE_CLASSLIST=&quot;false&quot;
644   elif test &quot;x$enable_generate_classlist&quot; = &quot;x&quot;; then
<span class="line-modified">645     if test &quot;x$ENABLE_GENERATE_CLASSLIST_POSSIBLE&quot; = &quot;xtrue&quot;; then</span>
646       AC_MSG_RESULT([yes])
647       ENABLE_GENERATE_CLASSLIST=&quot;true&quot;
648     else
649       AC_MSG_RESULT([no])
650       ENABLE_GENERATE_CLASSLIST=&quot;false&quot;
651     fi
652   else
653     AC_MSG_ERROR([Invalid value for --enable-generate-classlist: $enable_generate_classlist])
654   fi
655 
656   AC_SUBST(ENABLE_GENERATE_CLASSLIST)
657 ])
658 
659 ################################################################################
660 #
661 # Optionally filter resource translations
662 #
663 AC_DEFUN([JDKOPT_EXCLUDE_TRANSLATIONS],
664 [
665   AC_ARG_WITH([exclude-translations], [AS_HELP_STRING([--with-exclude-translations],
</pre>
</td>
<td>
<hr />
<pre>
297 # Enable or disable the elliptic curve crypto implementation
298 #
299 AC_DEFUN_ONCE([JDKOPT_DETECT_INTREE_EC],
300 [
301   AC_MSG_CHECKING([if elliptic curve crypto implementation is present])
302 
303   if test -d &quot;${TOPDIR}/src/jdk.crypto.ec/share/native/libsunec/impl&quot;; then
304     ENABLE_INTREE_EC=true
305     AC_MSG_RESULT([yes])
306   else
307     ENABLE_INTREE_EC=false
308     AC_MSG_RESULT([no])
309   fi
310 
311   AC_SUBST(ENABLE_INTREE_EC)
312 ])
313 
314 AC_DEFUN_ONCE([JDKOPT_SETUP_DEBUG_SYMBOLS],
315 [
316   #
<span class="line-modified">317   # Native debug symbols.</span>
318   # This must be done after the toolchain is setup, since we&#39;re looking at objcopy.
319   #
320   AC_MSG_CHECKING([what type of native debug symbols to use])
321   AC_ARG_WITH([native-debug-symbols],
322       [AS_HELP_STRING([--with-native-debug-symbols],
323       [set the native debug symbol configuration (none, internal, external, zipped) @&lt;:@varying@:&gt;@])],
324       [
325         if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
326           if test &quot;x$withval&quot; = xexternal || test &quot;x$withval&quot; = xzipped; then
327             AC_MSG_ERROR([AIX only supports the parameters &#39;none&#39; and &#39;internal&#39; for --with-native-debug-symbols])
328           fi
<span class="line-modified">329         elif test &quot;x$OPENJDK_TARGET_OS&quot; = xwindows; then</span>
<span class="line-modified">330           if test &quot;x$withval&quot; = xinternal; then</span>
<span class="line-modified">331             AC_MSG_ERROR([Windows does not support the parameter &#39;internal&#39; for --with-native-debug-symbols])</span>


332           fi
333         fi
334       ],
335       [
336         if test &quot;x$STATIC_BUILD&quot; = xtrue; then
337           with_native_debug_symbols=&quot;none&quot;
338         else
339           if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
340             # AIX doesn&#39;t support &#39;external&#39; so use &#39;internal&#39; as default
341             with_native_debug_symbols=&quot;internal&quot;
342           else
343             with_native_debug_symbols=&quot;external&quot;
344           fi
345         fi
346       ])
<span class="line-modified">347   AC_MSG_RESULT([$with_native_debug_symbols])</span>

348 
<span class="line-modified">349   if test &quot;x$with_native_debug_symbols&quot; = xnone; then</span>
350     COMPILE_WITH_DEBUG_SYMBOLS=false
351     COPY_DEBUG_SYMBOLS=false
352     ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="line-modified">353   elif test &quot;x$with_native_debug_symbols&quot; = xinternal; then</span>
354     COMPILE_WITH_DEBUG_SYMBOLS=true
355     COPY_DEBUG_SYMBOLS=false
356     ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="line-modified">357   elif test &quot;x$with_native_debug_symbols&quot; = xexternal; then</span>
358 
359     if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
360       if test &quot;x$OBJCOPY&quot; = x; then
361         # enabling of enable-debug-symbols and can&#39;t find objcopy
362         # this is an error
363         AC_MSG_ERROR([Unable to find objcopy, cannot enable native debug symbols])
364       fi
365     fi
366 
367     COMPILE_WITH_DEBUG_SYMBOLS=true
368     COPY_DEBUG_SYMBOLS=true
369     ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="line-modified">370   elif test &quot;x$with_native_debug_symbols&quot; = xzipped; then</span>
371 
372     if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
373       if test &quot;x$OBJCOPY&quot; = x; then
374         # enabling of enable-debug-symbols and can&#39;t find objcopy
375         # this is an error
376         AC_MSG_ERROR([Unable to find objcopy, cannot enable native debug symbols])
377       fi
378     fi
379 
380     COMPILE_WITH_DEBUG_SYMBOLS=true
381     COPY_DEBUG_SYMBOLS=true
382     ZIP_EXTERNAL_DEBUG_SYMBOLS=true
383   else
384     AC_MSG_ERROR([Allowed native debug symbols are: none, internal, external, zipped])
385   fi
386 
387   AC_SUBST(COMPILE_WITH_DEBUG_SYMBOLS)
388   AC_SUBST(COPY_DEBUG_SYMBOLS)
389   AC_SUBST(ZIP_EXTERNAL_DEBUG_SYMBOLS)
<span class="line-added">390 </span>
<span class="line-added">391   # Should we add external native debug symbols to the shipped bundles?</span>
<span class="line-added">392   AC_MSG_CHECKING([if we should add external native debug symbols to the shipped bundles])</span>
<span class="line-added">393   AC_ARG_WITH([external-symbols-in-bundles],</span>
<span class="line-added">394       [AS_HELP_STRING([--with-external-symbols-in-bundles],</span>
<span class="line-added">395       [which type of external native debug symbol information shall be shipped in product bundles (none, public, full)</span>
<span class="line-added">396       (e.g. ship full/stripped pdbs on Windows) @&lt;:@none@:&gt;@])])</span>
<span class="line-added">397 </span>
<span class="line-added">398   if test &quot;x$with_external_symbols_in_bundles&quot; = x || test &quot;x$with_external_symbols_in_bundles&quot; = xnone ; then</span>
<span class="line-added">399     AC_MSG_RESULT([no])</span>
<span class="line-added">400   elif test &quot;x$with_external_symbols_in_bundles&quot; = xfull || test &quot;x$with_external_symbols_in_bundles&quot; = xpublic ; then</span>
<span class="line-added">401     if test &quot;x$OPENJDK_TARGET_OS&quot; != xwindows ; then</span>
<span class="line-added">402       AC_MSG_ERROR([--with-external-symbols-in-bundles currently only works on windows!])</span>
<span class="line-added">403     elif test &quot;x$COPY_DEBUG_SYMBOLS&quot; != xtrue ; then</span>
<span class="line-added">404       AC_MSG_ERROR([--with-external-symbols-in-bundles only works when --with-native-debug-symbols=external is used!])</span>
<span class="line-added">405     elif test &quot;x$with_external_symbols_in_bundles&quot; = xfull ; then</span>
<span class="line-added">406       AC_MSG_RESULT([full])</span>
<span class="line-added">407       SHIP_DEBUG_SYMBOLS=full</span>
<span class="line-added">408     else</span>
<span class="line-added">409       AC_MSG_RESULT([public])</span>
<span class="line-added">410       SHIP_DEBUG_SYMBOLS=public</span>
<span class="line-added">411     fi</span>
<span class="line-added">412   else</span>
<span class="line-added">413     AC_MSG_ERROR([$with_external_symbols_in_bundles is an unknown value for --with-external-symbols-in-bundles])</span>
<span class="line-added">414   fi</span>
<span class="line-added">415 </span>
<span class="line-added">416   AC_SUBST(SHIP_DEBUG_SYMBOLS)</span>
417 ])
418 
419 ################################################################################
420 #
421 # Native and Java code coverage
422 #
423 AC_DEFUN_ONCE([JDKOPT_SETUP_CODE_COVERAGE],
424 [
425   AC_ARG_ENABLE(native-coverage, [AS_HELP_STRING([--enable-native-coverage],
426       [enable native compilation with code coverage data@&lt;:@disabled@:&gt;@])])
427   GCOV_ENABLED=&quot;false&quot;
428   if test &quot;x$enable_native_coverage&quot; = &quot;xyes&quot;; then
429     case $TOOLCHAIN_TYPE in
430       gcc | clang)
431         AC_MSG_CHECKING([if native coverage is enabled])
432         AC_MSG_RESULT([yes])
433         GCOV_CFLAGS=&quot;-fprofile-arcs -ftest-coverage -fno-inline&quot;
434         GCOV_LDFLAGS=&quot;-fprofile-arcs&quot;
435         JVM_CFLAGS=&quot;$JVM_CFLAGS $GCOV_CFLAGS&quot;
436         JVM_LDFLAGS=&quot;$JVM_LDFLAGS $GCOV_LDFLAGS&quot;
</pre>
<hr />
<pre>
623       AC_MSG_RESULT([yes, jtreg present])
624     fi
625   else
626     AC_MSG_ERROR([Invalid value for --enable-jtreg-failure-handler: $enable_jtreg_failure_handler])
627   fi
628 
629   AC_SUBST(BUILD_FAILURE_HANDLER)
630 ])
631 
632 ################################################################################
633 #
634 # Enable or disable generation of the classlist at build time
635 #
636 AC_DEFUN_ONCE([JDKOPT_ENABLE_DISABLE_GENERATE_CLASSLIST],
637 [
638   AC_ARG_ENABLE([generate-classlist], [AS_HELP_STRING([--disable-generate-classlist],
639       [forces enabling or disabling of the generation of a CDS classlist at build time.
640       Default is to generate it when either the server or client JVMs are built and
641       enable-cds is true.])])
642 
<span class="line-modified">643   # In jvm-features.m4 ENABLE_CDS is set to true iff all JVM variants has cds</span>
<span class="line-modified">644   # enabled.</span>





645 
646   AC_MSG_CHECKING([if the CDS classlist generation should be enabled])
647   if test &quot;x$enable_generate_classlist&quot; = &quot;xyes&quot;; then
648     AC_MSG_RESULT([yes, forced])
649     ENABLE_GENERATE_CLASSLIST=&quot;true&quot;
<span class="line-modified">650     if test &quot;x$ENABLE_CDS&quot; = &quot;xfalse&quot;; then</span>
<span class="line-modified">651       # In GenerateLinkOptData.gmk, DumpLoadedClassList is used to generate the</span>
<span class="line-modified">652       # classlist file. It never will work in this case since the VM will report</span>
<span class="line-modified">653       # an error for DumpLoadedClassList when CDS is disabled.</span>
<span class="line-modified">654       AC_MSG_ERROR([Generation of classlist is not possible without JVM feature &#39;cds&#39;])</span>




655     fi
656   elif test &quot;x$enable_generate_classlist&quot; = &quot;xno&quot;; then
657     AC_MSG_RESULT([no, forced])
658     ENABLE_GENERATE_CLASSLIST=&quot;false&quot;
659   elif test &quot;x$enable_generate_classlist&quot; = &quot;x&quot;; then
<span class="line-modified">660     if test &quot;x$ENABLE_CDS&quot; = &quot;xtrue&quot;; then</span>
661       AC_MSG_RESULT([yes])
662       ENABLE_GENERATE_CLASSLIST=&quot;true&quot;
663     else
664       AC_MSG_RESULT([no])
665       ENABLE_GENERATE_CLASSLIST=&quot;false&quot;
666     fi
667   else
668     AC_MSG_ERROR([Invalid value for --enable-generate-classlist: $enable_generate_classlist])
669   fi
670 
671   AC_SUBST(ENABLE_GENERATE_CLASSLIST)
672 ])
673 
674 ################################################################################
675 #
676 # Optionally filter resource translations
677 #
678 AC_DEFUN([JDKOPT_EXCLUDE_TRANSLATIONS],
679 [
680   AC_ARG_WITH([exclude-translations], [AS_HELP_STRING([--with-exclude-translations],
</pre>
</td>
</tr>
</table>
<center><a href="hotspot.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="libraries.m4.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>