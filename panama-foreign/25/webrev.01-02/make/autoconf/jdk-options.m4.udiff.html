<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff make/autoconf/jdk-options.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="hotspot.m4.udiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="libraries.m4.udiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/jdk-options.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -312,11 +312,11 @@</span>
  ])
  
  AC_DEFUN_ONCE([JDKOPT_SETUP_DEBUG_SYMBOLS],
  [
    #
<span class="udiff-line-modified-removed">-   # NATIVE_DEBUG_SYMBOLS</span>
<span class="udiff-line-modified-added">+   # Native debug symbols.</span>
    # This must be done after the toolchain is setup, since we&#39;re looking at objcopy.
    #
    AC_MSG_CHECKING([what type of native debug symbols to use])
    AC_ARG_WITH([native-debug-symbols],
        [AS_HELP_STRING([--with-native-debug-symbols],
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -324,15 +324,13 @@</span>
        [
          if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
            if test &quot;x$withval&quot; = xexternal || test &quot;x$withval&quot; = xzipped; then
              AC_MSG_ERROR([AIX only supports the parameters &#39;none&#39; and &#39;internal&#39; for --with-native-debug-symbols])
            fi
<span class="udiff-line-modified-removed">-         else</span>
<span class="udiff-line-modified-removed">-           if test &quot;x$OPENJDK_TARGET_OS&quot; = xwindows; then</span>
<span class="udiff-line-modified-removed">-             if test &quot;x$withval&quot; = xinternal; then</span>
<span class="udiff-line-removed">-               AC_MSG_ERROR([Windows does not support the parameter &#39;internal&#39; for --with-native-debug-symbols])</span>
<span class="udiff-line-removed">-             fi</span>
<span class="udiff-line-modified-added">+         elif test &quot;x$OPENJDK_TARGET_OS&quot; = xwindows; then</span>
<span class="udiff-line-modified-added">+           if test &quot;x$withval&quot; = xinternal; then</span>
<span class="udiff-line-modified-added">+             AC_MSG_ERROR([Windows does not support the parameter &#39;internal&#39; for --with-native-debug-symbols])</span>
            fi
          fi
        ],
        [
          if test &quot;x$STATIC_BUILD&quot; = xtrue; then
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -344,22 +342,21 @@</span>
            else
              with_native_debug_symbols=&quot;external&quot;
            fi
          fi
        ])
<span class="udiff-line-modified-removed">-   NATIVE_DEBUG_SYMBOLS=$with_native_debug_symbols</span>
<span class="udiff-line-removed">-   AC_MSG_RESULT([$NATIVE_DEBUG_SYMBOLS])</span>
<span class="udiff-line-modified-added">+   AC_MSG_RESULT([$with_native_debug_symbols])</span>
  
<span class="udiff-line-modified-removed">-   if test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xnone; then</span>
<span class="udiff-line-modified-added">+   if test &quot;x$with_native_debug_symbols&quot; = xnone; then</span>
      COMPILE_WITH_DEBUG_SYMBOLS=false
      COPY_DEBUG_SYMBOLS=false
      ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="udiff-line-modified-removed">-   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xinternal; then</span>
<span class="udiff-line-modified-added">+   elif test &quot;x$with_native_debug_symbols&quot; = xinternal; then</span>
      COMPILE_WITH_DEBUG_SYMBOLS=true
      COPY_DEBUG_SYMBOLS=false
      ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="udiff-line-modified-removed">-   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xexternal; then</span>
<span class="udiff-line-modified-added">+   elif test &quot;x$with_native_debug_symbols&quot; = xexternal; then</span>
  
      if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
        if test &quot;x$OBJCOPY&quot; = x; then
          # enabling of enable-debug-symbols and can&#39;t find objcopy
          # this is an error
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -368,11 +365,11 @@</span>
      fi
  
      COMPILE_WITH_DEBUG_SYMBOLS=true
      COPY_DEBUG_SYMBOLS=true
      ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="udiff-line-modified-removed">-   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xzipped; then</span>
<span class="udiff-line-modified-added">+   elif test &quot;x$with_native_debug_symbols&quot; = xzipped; then</span>
  
      if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
        if test &quot;x$OBJCOPY&quot; = x; then
          # enabling of enable-debug-symbols and can&#39;t find objcopy
          # this is an error
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -388,10 +385,37 @@</span>
    fi
  
    AC_SUBST(COMPILE_WITH_DEBUG_SYMBOLS)
    AC_SUBST(COPY_DEBUG_SYMBOLS)
    AC_SUBST(ZIP_EXTERNAL_DEBUG_SYMBOLS)
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   # Should we add external native debug symbols to the shipped bundles?</span>
<span class="udiff-line-added">+   AC_MSG_CHECKING([if we should add external native debug symbols to the shipped bundles])</span>
<span class="udiff-line-added">+   AC_ARG_WITH([external-symbols-in-bundles],</span>
<span class="udiff-line-added">+       [AS_HELP_STRING([--with-external-symbols-in-bundles],</span>
<span class="udiff-line-added">+       [which type of external native debug symbol information shall be shipped in product bundles (none, public, full)</span>
<span class="udiff-line-added">+       (e.g. ship full/stripped pdbs on Windows) @&lt;:@none@:&gt;@])])</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   if test &quot;x$with_external_symbols_in_bundles&quot; = x || test &quot;x$with_external_symbols_in_bundles&quot; = xnone ; then</span>
<span class="udiff-line-added">+     AC_MSG_RESULT([no])</span>
<span class="udiff-line-added">+   elif test &quot;x$with_external_symbols_in_bundles&quot; = xfull || test &quot;x$with_external_symbols_in_bundles&quot; = xpublic ; then</span>
<span class="udiff-line-added">+     if test &quot;x$OPENJDK_TARGET_OS&quot; != xwindows ; then</span>
<span class="udiff-line-added">+       AC_MSG_ERROR([--with-external-symbols-in-bundles currently only works on windows!])</span>
<span class="udiff-line-added">+     elif test &quot;x$COPY_DEBUG_SYMBOLS&quot; != xtrue ; then</span>
<span class="udiff-line-added">+       AC_MSG_ERROR([--with-external-symbols-in-bundles only works when --with-native-debug-symbols=external is used!])</span>
<span class="udiff-line-added">+     elif test &quot;x$with_external_symbols_in_bundles&quot; = xfull ; then</span>
<span class="udiff-line-added">+       AC_MSG_RESULT([full])</span>
<span class="udiff-line-added">+       SHIP_DEBUG_SYMBOLS=full</span>
<span class="udiff-line-added">+     else</span>
<span class="udiff-line-added">+       AC_MSG_RESULT([public])</span>
<span class="udiff-line-added">+       SHIP_DEBUG_SYMBOLS=public</span>
<span class="udiff-line-added">+     fi</span>
<span class="udiff-line-added">+   else</span>
<span class="udiff-line-added">+     AC_MSG_ERROR([$with_external_symbols_in_bundles is an unknown value for --with-external-symbols-in-bundles])</span>
<span class="udiff-line-added">+   fi</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   AC_SUBST(SHIP_DEBUG_SYMBOLS)</span>
  ])
  
  ################################################################################
  #
  # Native and Java code coverage
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -614,37 +638,28 @@</span>
    AC_ARG_ENABLE([generate-classlist], [AS_HELP_STRING([--disable-generate-classlist],
        [forces enabling or disabling of the generation of a CDS classlist at build time.
        Default is to generate it when either the server or client JVMs are built and
        enable-cds is true.])])
  
<span class="udiff-line-modified-removed">-   # Check if it&#39;s likely that it&#39;s possible to generate the classlist. Depending</span>
<span class="udiff-line-modified-removed">-   # on exact jvm configuration it could be possible anyway.</span>
<span class="udiff-line-removed">-   if test &quot;x$ENABLE_CDS&quot; = &quot;xtrue&quot; &amp;&amp; (HOTSPOT_CHECK_JVM_VARIANT(server) || HOTSPOT_CHECK_JVM_VARIANT(client) || HOTSPOT_CHECK_JVM_FEATURE(cds)); then</span>
<span class="udiff-line-removed">-     ENABLE_GENERATE_CLASSLIST_POSSIBLE=&quot;true&quot;</span>
<span class="udiff-line-removed">-   else</span>
<span class="udiff-line-removed">-     ENABLE_GENERATE_CLASSLIST_POSSIBLE=&quot;false&quot;</span>
<span class="udiff-line-removed">-   fi</span>
<span class="udiff-line-modified-added">+   # In jvm-features.m4 ENABLE_CDS is set to true iff all JVM variants has cds</span>
<span class="udiff-line-modified-added">+   # enabled.</span>
  
    AC_MSG_CHECKING([if the CDS classlist generation should be enabled])
    if test &quot;x$enable_generate_classlist&quot; = &quot;xyes&quot;; then
      AC_MSG_RESULT([yes, forced])
      ENABLE_GENERATE_CLASSLIST=&quot;true&quot;
<span class="udiff-line-modified-removed">-     if test &quot;x$ENABLE_GENERATE_CLASSLIST_POSSIBLE&quot; = &quot;xfalse&quot;; then</span>
<span class="udiff-line-modified-removed">-       if test &quot;x$ENABLE_CDS&quot; = &quot;xfalse&quot;; then</span>
<span class="udiff-line-modified-removed">-         # In GenerateLinkOptData.gmk, DumpLoadedClassList is used to generate the</span>
<span class="udiff-line-modified-removed">-         # classlist file. It never will work in this case since the VM will report</span>
<span class="udiff-line-modified-removed">-         # an error for DumpLoadedClassList when CDS is disabled.</span>
<span class="udiff-line-removed">-         AC_MSG_ERROR([Generation of classlist is not possible with enable-cds=false])</span>
<span class="udiff-line-removed">-       else</span>
<span class="udiff-line-removed">-         AC_MSG_WARN([Generation of classlist might not be possible with JVM Variants $JVM_VARIANTS and enable-cds=$ENABLE_CDS])</span>
<span class="udiff-line-removed">-       fi</span>
<span class="udiff-line-modified-added">+     if test &quot;x$ENABLE_CDS&quot; = &quot;xfalse&quot;; then</span>
<span class="udiff-line-modified-added">+       # In GenerateLinkOptData.gmk, DumpLoadedClassList is used to generate the</span>
<span class="udiff-line-modified-added">+       # classlist file. It never will work in this case since the VM will report</span>
<span class="udiff-line-modified-added">+       # an error for DumpLoadedClassList when CDS is disabled.</span>
<span class="udiff-line-modified-added">+       AC_MSG_ERROR([Generation of classlist is not possible without JVM feature &#39;cds&#39;])</span>
      fi
    elif test &quot;x$enable_generate_classlist&quot; = &quot;xno&quot;; then
      AC_MSG_RESULT([no, forced])
      ENABLE_GENERATE_CLASSLIST=&quot;false&quot;
    elif test &quot;x$enable_generate_classlist&quot; = &quot;x&quot;; then
<span class="udiff-line-modified-removed">-     if test &quot;x$ENABLE_GENERATE_CLASSLIST_POSSIBLE&quot; = &quot;xtrue&quot;; then</span>
<span class="udiff-line-modified-added">+     if test &quot;x$ENABLE_CDS&quot; = &quot;xtrue&quot;; then</span>
        AC_MSG_RESULT([yes])
        ENABLE_GENERATE_CLASSLIST=&quot;true&quot;
      else
        AC_MSG_RESULT([no])
        ENABLE_GENERATE_CLASSLIST=&quot;false&quot;
</pre>
<center><a href="hotspot.m4.udiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="libraries.m4.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>