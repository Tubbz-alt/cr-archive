<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New make/autoconf/configure.ac</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
  <body>
    <pre>
  1 #
  2 # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 ###############################################################################
 27 #
 28 # Includes and boilerplate
 29 #
 30 ###############################################################################
 31 
 32 
 33 AC_PREREQ([2.69])
 34 AC_INIT(OpenJDK, openjdk, build-dev@openjdk.java.net,,http://openjdk.java.net)
 35 
 36 AC_CONFIG_AUX_DIR([$TOPDIR/make/autoconf/build-aux])
 37 m4_include([build-aux/pkg.m4])
 38 
 39 AC_DEFUN_ONCE([CUSTOM_EARLY_HOOK])
 40 AC_DEFUN_ONCE([CUSTOM_LATE_HOOK])
 41 AC_DEFUN_ONCE([CUSTOM_CONFIG_OUTPUT_GENERATED_HOOK])
 42 AC_DEFUN_ONCE([CUSTOM_SUMMARY_AND_WARNINGS_HOOK])
 43 
 44 # This line needs to be here, verbatim, after the dummy hook definitions but
 45 # before all includes. It is replaced with custom functionality when building
 46 # custom sources.
 47 #CUSTOM_AUTOCONF_INCLUDE
 48 
 49 # Include these first...
 50 m4_include([basics.m4])
 51 m4_include([basics_windows.m4])
 52 # ... then the rest
 53 m4_include([boot-jdk.m4])
 54 m4_include([build-performance.m4])
 55 m4_include([flags.m4])
 56 m4_include([help.m4])
 57 m4_include([hotspot.m4])
 58 m4_include([jdk-options.m4])
 59 m4_include([jdk-version.m4])
 60 m4_include([jvm-features.m4])
 61 m4_include([libraries.m4])
 62 m4_include([platform.m4])
 63 m4_include([source-dirs.m4])
 64 m4_include([toolchain.m4])
 65 m4_include([toolchain_windows.m4])
 66 
 67 ###############################################################################
 68 #
 69 # Initialization / Boot-strapping
 70 #
 71 # The bootstrapping process needs to solve the &quot;chicken or the egg&quot; problem,
 72 # thus it jumps back and forth, each time gaining something needed later on.
 73 #
 74 ###############################################################################
 75 
 76 # If we are requested to print additional help, do that and then exit.
 77 # This must be the very first call.
 78 HELP_PRINT_ADDITIONAL_HELP_AND_EXIT
 79 
 80 # Basic initialization that must happen first of all in the normal process.
 81 BASIC_INIT
 82 BASIC_SETUP_FUNDAMENTAL_TOOLS
 83 
 84 # Now we can determine OpenJDK build and target platforms. This is required to
 85 # have early on.
 86 PLATFORM_SETUP_OPENJDK_BUILD_AND_TARGET
 87 
 88 # Continue setting up basic stuff. Most remaining code require fundamental tools.
 89 BASIC_SETUP_PATHS
 90 
 91 # Check if it&#39;s a pure open build or if custom sources are to be used.
 92 JDKOPT_SETUP_OPEN_OR_CUSTOM
 93 
 94 # These are needed to be able to create a configuration name (and thus the output directory)
 95 JDKOPT_SETUP_DEBUG_LEVEL
 96 HOTSPOT_SETUP_JVM_VARIANTS
 97 
 98 # With basic setup done, call the custom early hook.
 99 CUSTOM_EARLY_HOOK
100 
101 # Check if we have devkits, extra paths or sysroot set.
102 BASIC_SETUP_DEVKIT
103 
104 # To properly create a configuration name, we need to have the OpenJDK target
105 # and options (variants and debug level) parsed.
106 BASIC_SETUP_OUTPUT_DIR
107 
108 # Must be done before we can call HELP_MSG_MISSING_DEPENDENCY.
109 HELP_SETUP_DEPENDENCY_HELP
110 
111 # Setup tools that requires more complex handling, or that is not needed by the configure script.
112 BASIC_SETUP_COMPLEX_TOOLS
113 BASIC_CHECK_BASH_OPTIONS
114 
115 # Check if pkg-config is available.
116 PKG_PROG_PKG_CONFIG
117 
118 # After basic tools have been setup, we can check build os specific details.
119 PLATFORM_SETUP_OPENJDK_BUILD_OS_VERSION
120 
121 # Misc basic settings
122 BASIC_SETUP_DEFAULT_MAKE_TARGET
123 BASIC_SETUP_DEFAULT_LOG
124 
125 ###############################################################################
126 #
127 # Determine OpenJDK variants, options and version numbers.
128 #
129 ###############################################################################
130 
131 # We need build &amp; target for this.
132 JDKOPT_SETUP_JDK_OPTIONS
133 JDKOPT_SETUP_JLINK_OPTIONS
134 JDKVER_SETUP_JDK_VERSION_NUMBERS
135 
136 ###############################################################################
137 #
138 # Setup BootJDK, used to bootstrap the build.
139 #
140 ###############################################################################
141 
142 BOOTJDK_SETUP_BOOT_JDK
143 BOOTJDK_SETUP_BUILD_JDK
144 
145 ###############################################################################
146 #
147 # Configure the sources to use. We can add or override individual directories.
148 #
149 ###############################################################################
150 
151 SRCDIRS_SETUP_DIRS
152 SRCDIRS_SETUP_IMPORT_MODULES
153 
154 ###############################################################################
155 #
156 # Setup the toolchain (compilers etc), i.e. tools used to compile and process
157 # native code.
158 #
159 ###############################################################################
160 
161 # See if we are doing a complete static build or not
162 JDKOPT_SETUP_STATIC_BUILD
163 
164 # First determine the toolchain type (compiler family)
165 TOOLCHAIN_DETERMINE_TOOLCHAIN_TYPE
166 
167 # The global flags are needed for configure to be able to run the compilers
168 # correctly.
169 FLAGS_PRE_TOOLCHAIN
170 
171 # Then detect the actual binaries needed
172 TOOLCHAIN_PRE_DETECTION
173 TOOLCHAIN_DETECT_TOOLCHAIN_CORE
174 TOOLCHAIN_DETECT_TOOLCHAIN_EXTRA
175 TOOLCHAIN_POST_DETECTION
176 
177 # Finally do some processing after the detection phase
178 TOOLCHAIN_SETUP_BUILD_COMPILERS
179 TOOLCHAIN_MISC_CHECKS
180 
181 # Setup the JTReg Regression Test Harness.
182 TOOLCHAIN_SETUP_JTREG
183 
184 # Setup the Java Microbenchmark Harness (JMH)
185 LIB_TESTS_SETUP_JMH
186 
187 # Setup Jib dependency tool
188 TOOLCHAIN_SETUP_JIB
189 
190 # After toolchain setup, we need to process some flags to be able to continue.
191 FLAGS_POST_TOOLCHAIN
192 
193 # Now we can test some aspects on the target using configure macros.
194 PLATFORM_SETUP_OPENJDK_TARGET_BITS
195 PLATFORM_SETUP_OPENJDK_TARGET_ENDIANNESS
196 
197 # Configure flags for the tools
198 FLAGS_SETUP_FLAGS
199 
200 # Setup debug symbols (need objcopy from the toolchain for that)
201 JDKOPT_SETUP_DEBUG_SYMBOLS
202 JDKOPT_SETUP_CODE_COVERAGE
203 
204 # AddressSanitizer
205 JDKOPT_SETUP_ADDRESS_SANITIZER
206 
207 ###############################################################################
208 #
209 # Check dependencies for external and internal libraries.
210 #
211 ###############################################################################
212 
213 # After we have toolchain, we can compile fixpath. It&#39;s needed by the lib checks.
214 BASIC_COMPILE_FIXPATH
215 
216 LIB_DETERMINE_DEPENDENCIES
217 LIB_SETUP_LIBRARIES
218 
219 ###############################################################################
220 #
221 # Setup hotspot and JVM features (needs toolchain).
222 #
223 ###############################################################################
224 
225 JVM_FEATURES_PARSE_OPTIONS
226 JVM_FEATURES_SETUP
227 
228 HOTSPOT_ENABLE_DISABLE_GTEST
229 HOTSPOT_SETUP_MISC
230 
231 ###############################################################################
232 #
233 # We need to do some final tweaking, when everything else is done.
234 #
235 ###############################################################################
236 
237 JDKOPT_DETECT_INTREE_EC
238 JDKOPT_ENABLE_DISABLE_FAILURE_HANDLER
239 JDKOPT_ENABLE_DISABLE_GENERATE_CLASSLIST
240 JDKOPT_EXCLUDE_TRANSLATIONS
241 JDKOPT_ENABLE_DISABLE_MANPAGES
242 JDKOPT_ENABLE_DISABLE_CDS_ARCHIVE
243 
244 ###############################################################################
245 #
246 # Configure parts of the build that only affect the build performance,
247 # not the result.
248 #
249 ###############################################################################
250 
251 BPERF_SETUP_BUILD_CORES
252 BPERF_SETUP_BUILD_MEMORY
253 BPERF_SETUP_BUILD_JOBS
254 BPERF_SETUP_TEST_JOBS
255 
256 # Setup arguments for the boot jdk (after cores and memory have been setup)
257 BOOTJDK_SETUP_BOOT_JDK_ARGUMENTS
258 
259 # Setup smart javac (after cores and memory have been setup)
260 BPERF_SETUP_SMART_JAVAC
261 
262 # Setup use of icecc if requested
263 BPERF_SETUP_ICECC
264 
265 # Can the C/C++ compiler use precompiled headers?
266 BPERF_SETUP_PRECOMPILED_HEADERS
267 
268 # Setup use of ccache, if available
269 BPERF_SETUP_CCACHE
270 
271 ###############################################################################
272 #
273 # And now the finish...
274 #
275 ###############################################################################
276 
277 # Check for some common pitfalls
278 BASIC_TEST_USABILITY_ISSUES
279 
280 # At the end, call the custom hook. (Dummy macro if no custom sources available)
281 CUSTOM_LATE_HOOK
282 
283 # Did user specify any unknown variables?
284 BASIC_CHECK_LEFTOVER_OVERRIDDEN
285 
286 # We&#39;re messing a bit with internal autoconf variables to put the config.status
287 # in the output directory instead of the current directory.
288 CONFIG_STATUS=&quot;$CONFIGURESUPPORT_OUTPUTDIR/config.status&quot;
289 
290 # Create the actual output files. Now the main work of configure is done.
291 AC_OUTPUT
292 
293 # After AC_OUTPUT, we need to do final work
294 CUSTOM_CONFIG_OUTPUT_GENERATED_HOOK
295 BASIC_POST_CONFIG_OUTPUT
296 
297 # Finally output some useful information to the user
298 HELP_PRINT_SUMMARY_AND_WARNINGS
299 CUSTOM_SUMMARY_AND_WARNINGS_HOOK
300 HELP_REPEAT_WARNINGS
    </pre>
  </body>
</html>