<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New make/autoconf/basics.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
  <body>
    <pre>
   1 #
   2 # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.
   3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4 #
   5 # This code is free software; you can redistribute it and/or modify it
   6 # under the terms of the GNU General Public License version 2 only, as
   7 # published by the Free Software Foundation.  Oracle designates this
   8 # particular file as subject to the &quot;Classpath&quot; exception as provided
   9 # by Oracle in the LICENSE file that accompanied this code.
  10 #
  11 # This code is distributed in the hope that it will be useful, but WITHOUT
  12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14 # version 2 for more details (a copy is included in the LICENSE file that
  15 # accompanied this code).
  16 #
  17 # You should have received a copy of the GNU General Public License version
  18 # 2 along with this work; if not, write to the Free Software Foundation,
  19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20 #
  21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22 # or visit www.oracle.com if you need additional information or have any
  23 # questions.
  24 #
  25 
  26 ###############################################################################
  27 # Create a function/macro that takes a series of named arguments. The call is
  28 # similar to AC_DEFUN, but the setup of the function looks like this:
  29 # BASIC_DEFUN_NAMED([MYFUNC], [FOO *BAR], [$@], [
  30 # ... do something
  31 #   AC_MSG_NOTICE([Value of BAR is ARG_BAR])
  32 # ])
  33 # A star (*) in front of a named argument means that it is required and it&#39;s
  34 # presence will be verified. To pass e.g. the first value as a normal indexed
  35 # argument, use [m4_shift($@)] as the third argument instead of [$@]. These
  36 # arguments are referenced in the function by their name prefixed by ARG_, e.g.
  37 # &quot;ARG_FOO&quot;.
  38 #
  39 # The generated function can be called like this:
  40 # MYFUNC(FOO: [foo-val],
  41 #     BAR: [
  42 #         $ECHO hello world
  43 #     ])
  44 # Note that the argument value must start on the same line as the argument name.
  45 #
  46 # Argument 1: Name of the function to define
  47 # Argument 2: List of legal named arguments, with a * prefix for required arguments
  48 # Argument 3: Argument array to treat as named, typically $@
  49 # Argument 4: The main function body
  50 AC_DEFUN([BASIC_DEFUN_NAMED],
  51 [
  52   AC_DEFUN($1, [
  53     m4_foreach(arg, m4_split($2), [
  54       m4_if(m4_bregexp(arg, [^\*]), -1,
  55         [
  56           m4_set_add(legal_named_args, arg)
  57         ],
  58         [
  59           m4_set_add(legal_named_args, m4_substr(arg, 1))
  60           m4_set_add(required_named_args, m4_substr(arg, 1))
  61         ]
  62       )
  63     ])
  64 
  65     m4_foreach([arg], [$3], [
  66       m4_define(arg_name, m4_substr(arg, 0, m4_bregexp(arg, [: ])))
  67       m4_set_contains(legal_named_args, arg_name, [],[AC_MSG_ERROR([Internal error: arg_name is not a valid named argument to [$1]. Valid arguments are &#39;m4_set_contents(legal_named_args, [ ])&#39;.])])
  68       m4_set_remove(required_named_args, arg_name)
  69       m4_set_remove(legal_named_args, arg_name)
  70       m4_pushdef([ARG_][]arg_name, m4_substr(arg, m4_incr(m4_incr(m4_bregexp(arg, [: ])))))
  71       m4_set_add(defined_args, arg_name)
  72       m4_undefine([arg_name])
  73     ])
  74     m4_set_empty(required_named_args, [], [
  75       AC_MSG_ERROR([Internal error: Required named arguments are missing for [$1]. Missing arguments: &#39;m4_set_contents(required_named_args, [ ])&#39;])
  76     ])
  77     m4_foreach([arg], m4_indir([m4_dquote]m4_set_listc([legal_named_args])), [
  78       m4_pushdef([ARG_][]arg, [])
  79       m4_set_add(defined_args, arg)
  80     ])
  81     m4_set_delete(legal_named_args)
  82     m4_set_delete(required_named_args)
  83 
  84     # Execute function body
  85     $4
  86 
  87     m4_foreach([arg], m4_indir([m4_dquote]m4_set_listc([defined_args])), [
  88       m4_popdef([ARG_][]arg)
  89     ])
  90 
  91     m4_set_delete(defined_args)
  92   ])
  93 ])
  94 
  95 ###############################################################################
  96 # Check if a list of space-separated words are selected only from a list of
  97 # space-separated legal words. Typical use is to see if a user-specified
  98 # set of words is selected from a set of legal words.
  99 #
 100 # Sets the specified variable to list of non-matching (offending) words, or to
 101 # the empty string if all words are matching the legal set.
 102 #
 103 # $1: result variable name
 104 # $2: list of values to check
 105 # $3: list of legal values
 106 AC_DEFUN([BASIC_GET_NON_MATCHING_VALUES],
 107 [
 108   # grep filter function inspired by a comment to http://stackoverflow.com/a/1617326
 109   # Notice that the original variant fails on SLES 10 and 11
 110   # Some grep versions (at least bsd) behaves strangely on the base case with
 111   # no legal_values, so make it explicit.
 112   values_to_check=`$ECHO $2 | $TR &#39; &#39; &#39;\n&#39;`
 113   legal_values=`$ECHO $3 | $TR &#39; &#39; &#39;\n&#39;`
 114   if test -z &quot;$legal_values&quot;; then
 115     $1=&quot;$2&quot;
 116   else
 117     result=`$GREP -Fvx &quot;$legal_values&quot; &lt;&lt;&lt; &quot;$values_to_check&quot; | $GREP -v &#39;^$&#39;`
 118     $1=${result//$&#39;\n&#39;/ }
 119   fi
 120 ])
 121 
 122 ###############################################################################
 123 # Check if a list of space-separated words contains any word(s) from a list of
 124 # space-separated illegal words. Typical use is to see if a user-specified
 125 # set of words contains any from a set of illegal words.
 126 #
 127 # Sets the specified variable to list of matching illegal words, or to
 128 # the empty string if no words are matching the illegal set.
 129 #
 130 # $1: result variable name
 131 # $2: list of values to check
 132 # $3: list of illegal values
 133 AC_DEFUN([BASIC_GET_MATCHING_VALUES],
 134 [
 135   # grep filter function inspired by a comment to http://stackoverflow.com/a/1617326
 136   # Notice that the original variant fails on SLES 10 and 11
 137   # Some grep versions (at least bsd) behaves strangely on the base case with
 138   # no legal_values, so make it explicit.
 139   values_to_check=`$ECHO $2 | $TR &#39; &#39; &#39;\n&#39;`
 140   illegal_values=`$ECHO $3 | $TR &#39; &#39; &#39;\n&#39;`
 141   if test -z &quot;$illegal_values&quot;; then
 142     $1=&quot;&quot;
 143   else
 144     result=`$GREP -Fx &quot;$illegal_values&quot; &lt;&lt;&lt; &quot;$values_to_check&quot; | $GREP -v &#39;^$&#39;`
 145     $1=${result//$&#39;\n&#39;/ }
 146   fi
 147 ])
 148 
 149 ###############################################################################
 150 # Sort a space-separated list, and remove duplicates.
 151 #
 152 # Sets the specified variable to the resulting list.
 153 #
 154 # $1: result variable name
 155 # $2: list of values to sort
 156 AC_DEFUN([BASIC_SORT_LIST],
 157 [
 158   values_to_sort=`$ECHO $2 | $TR &#39; &#39; &#39;\n&#39;`
 159   result=`$SORT -u &lt;&lt;&lt; &quot;$values_to_sort&quot; | $GREP -v &#39;^$&#39;`
 160   $1=${result//$&#39;\n&#39;/ }
 161 ])
 162 
 163 ###############################################################################
 164 # Test if $1 is a valid argument to $3 (often is $JAVA passed as $3)
 165 # If so, then append $1 to $2 \
 166 # Also set JVM_ARG_OK to true/false depending on outcome.
 167 AC_DEFUN([ADD_JVM_ARG_IF_OK],
 168 [
 169   $ECHO &quot;Check if jvm arg is ok: $1&quot; &gt;&amp;AS_MESSAGE_LOG_FD
 170   $ECHO &quot;Command: $3 $1 -version&quot; &gt;&amp;AS_MESSAGE_LOG_FD
 171   OUTPUT=`$3 $1 $USER_BOOT_JDK_OPTIONS -version 2&gt;&amp;1`
 172   FOUND_WARN=`$ECHO &quot;$OUTPUT&quot; | $GREP -i warn`
 173   FOUND_VERSION=`$ECHO $OUTPUT | $GREP &quot; version \&quot;&quot;`
 174   if test &quot;x$FOUND_VERSION&quot; != x &amp;&amp; test &quot;x$FOUND_WARN&quot; = x; then
 175     $2=&quot;[$]$2 $1&quot;
 176     JVM_ARG_OK=true
 177   else
 178     $ECHO &quot;Arg failed:&quot; &gt;&amp;AS_MESSAGE_LOG_FD
 179     $ECHO &quot;$OUTPUT&quot; &gt;&amp;AS_MESSAGE_LOG_FD
 180     JVM_ARG_OK=false
 181   fi
 182 ])
 183 
 184 # Appends a string to a path variable, only adding the : when needed.
 185 AC_DEFUN([BASIC_APPEND_TO_PATH],
 186 [
 187   if test &quot;x$2&quot; != x; then
 188     if test &quot;x[$]$1&quot; = x; then
 189       $1=&quot;$2&quot;
 190     else
 191       $1=&quot;[$]$1:$2&quot;
 192     fi
 193   fi
 194 ])
 195 
 196 # Prepends a string to a path variable, only adding the : when needed.
 197 AC_DEFUN([BASIC_PREPEND_TO_PATH],
 198 [
 199   if test &quot;x$2&quot; != x; then
 200     if test &quot;x[$]$1&quot; = x; then
 201       $1=&quot;$2&quot;
 202     else
 203       $1=&quot;$2:[$]$1&quot;
 204     fi
 205   fi
 206 ])
 207 
 208 ################################################################################
 209 # This will make a path absolute. Assumes it&#39;s already a unix path. Also
 210 # resolves ~ to homedir.
 211 AC_DEFUN([BASIC_ABSOLUTE_PATH],
 212 [
 213   if test &quot;x[$]$1&quot; != x; then
 214     new_path=&quot;[$]$1&quot;
 215 
 216     # Use eval to expand a potential ~. This technique does not work if there
 217     # are spaces in the path (which is valid at this point on Windows), so only
 218     # try to apply it if there is an actual ~ first in the path.
 219     if [ [[ &quot;$new_path&quot; = &quot;~&quot;* ]] ]; then
 220       eval new_path=&quot;$new_path&quot;
 221       if test ! -f &quot;$new_path&quot; &amp;&amp; test ! -d &quot;$new_path&quot;; then
 222         AC_MSG_ERROR([The new_path of $1, which resolves as &quot;$new_path&quot;, is not found.])
 223       fi
 224     fi
 225 
 226     if test -d &quot;$new_path&quot;; then
 227       $1=&quot;`cd &quot;$new_path&quot;; $THEPWDCMD -L`&quot;
 228     else
 229       dir=&quot;`$DIRNAME &quot;$new_path&quot;`&quot;
 230       base=&quot;`$BASENAME &quot;$new_path&quot;`&quot;
 231       $1=&quot;`cd &quot;$dir&quot;; $THEPWDCMD -L`/$base&quot;
 232     fi
 233   fi
 234 ])
 235 
 236 ###############################################################################
 237 # This will make sure the given variable points to a full and proper
 238 # path. This means:
 239 # 1) There will be no spaces in the path. On unix platforms,
 240 #    spaces in the path will result in an error. On Windows,
 241 #    the path will be rewritten using short-style to be space-free.
 242 # 2) The path will be absolute, and it will be in unix-style (on
 243 #     cygwin).
 244 # $1: The name of the variable to fix
 245 AC_DEFUN([BASIC_FIXUP_PATH],
 246 [
 247   # Only process if variable expands to non-empty
 248   if test &quot;x[$]$1&quot; != x; then
 249     if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.cygwin&quot;; then
 250       BASIC_FIXUP_PATH_CYGWIN($1)
 251     elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.msys&quot;; then
 252       BASIC_FIXUP_PATH_MSYS($1)
 253     elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
 254       BASIC_FIXUP_PATH_WSL($1)
 255     else
 256       # We&#39;re on a unix platform. Hooray! :)
 257       path=&quot;[$]$1&quot;
 258       has_space=`$ECHO &quot;$path&quot; | $GREP &quot; &quot;`
 259       if test &quot;x$has_space&quot; != x; then
 260         AC_MSG_NOTICE([The path of $1, which resolves as &quot;$path&quot;, is invalid.])
 261         AC_MSG_ERROR([Spaces are not allowed in this path.])
 262       fi
 263 
 264       BASIC_ABSOLUTE_PATH(path)
 265       $1=&quot;$path&quot;
 266     fi
 267   fi
 268 ])
 269 
 270 ###############################################################################
 271 # This will make sure the given variable points to a executable
 272 # with a full and proper path. This means:
 273 # 1) There will be no spaces in the path. On unix platforms,
 274 #    spaces in the path will result in an error. On Windows,
 275 #    the path will be rewritten using short-style to be space-free.
 276 # 2) The path will be absolute, and it will be in unix-style (on
 277 #     cygwin).
 278 # Any arguments given to the executable is preserved.
 279 # If the input variable does not have a directory specification, then
 280 # it need to be in the PATH.
 281 # $1: The name of the variable to fix
 282 AC_DEFUN([BASIC_FIXUP_EXECUTABLE],
 283 [
 284   # Only process if variable expands to non-empty
 285 
 286   if test &quot;x[$]$1&quot; != x; then
 287     if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.cygwin&quot;; then
 288       BASIC_FIXUP_EXECUTABLE_CYGWIN($1)
 289     elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.msys&quot;; then
 290       BASIC_FIXUP_EXECUTABLE_MSYS($1)
 291     elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
 292       BASIC_FIXUP_EXECUTABLE_WSL($1)
 293     else
 294       # We&#39;re on a unix platform. Hooray! :)
 295       # First separate the path from the arguments. This will split at the first
 296       # space.
 297       complete=&quot;[$]$1&quot;
 298       path=&quot;${complete%% *}&quot;
 299       tmp=&quot;$complete EOL&quot;
 300       arguments=&quot;${tmp#* }&quot;
 301 
 302       # Cannot rely on the command &quot;which&quot; here since it doesn&#39;t always work.
 303       is_absolute_path=`$ECHO &quot;$path&quot; | $GREP ^/`
 304       if test -z &quot;$is_absolute_path&quot;; then
 305         # Path to executable is not absolute. Find it.
 306         IFS_save=&quot;$IFS&quot;
 307         IFS=:
 308         for p in $PATH; do
 309           if test -f &quot;$p/$path&quot; &amp;&amp; test -x &quot;$p/$path&quot;; then
 310             new_path=&quot;$p/$path&quot;
 311             break
 312           fi
 313         done
 314         IFS=&quot;$IFS_save&quot;
 315       else
 316         # This is an absolute path, we can use it without further modifications.
 317         new_path=&quot;$path&quot;
 318       fi
 319 
 320       if test &quot;x$new_path&quot; = x; then
 321         AC_MSG_NOTICE([The path of $1, which resolves as &quot;$complete&quot;, is not found.])
 322         has_space=`$ECHO &quot;$complete&quot; | $GREP &quot; &quot;`
 323         if test &quot;x$has_space&quot; != x; then
 324           AC_MSG_NOTICE([This might be caused by spaces in the path, which is not allowed.])
 325         fi
 326         AC_MSG_ERROR([Cannot locate the the path of $1])
 327       fi
 328     fi
 329 
 330     # Now join together the path and the arguments once again
 331     if test &quot;x$arguments&quot; != xEOL; then
 332       new_complete=&quot;$new_path ${arguments% *}&quot;
 333     else
 334       new_complete=&quot;$new_path&quot;
 335     fi
 336 
 337     if test &quot;x$complete&quot; != &quot;x$new_complete&quot;; then
 338       $1=&quot;$new_complete&quot;
 339       AC_MSG_NOTICE([Rewriting $1 to &quot;$new_complete&quot;])
 340     fi
 341   fi
 342 ])
 343 
 344 ###############################################################################
 345 AC_DEFUN([BASIC_REMOVE_SYMBOLIC_LINKS],
 346 [
 347   if test &quot;x$OPENJDK_BUILD_OS&quot; != xwindows; then
 348     # Follow a chain of symbolic links. Use readlink
 349     # where it exists, else fall back to horribly
 350     # complicated shell code.
 351     if test &quot;x$READLINK_TESTED&quot; != yes; then
 352       # On MacOSX there is a readlink tool with a different
 353       # purpose than the GNU readlink tool. Check the found readlink.
 354       READLINK_ISGNU=`$READLINK --version 2&gt;&amp;1 | $GREP GNU`
 355       # If READLINK_ISGNU is empty, then it&#39;s a non-GNU readlink. Don&#39;t use it.
 356       READLINK_TESTED=yes
 357     fi
 358 
 359     if test &quot;x$READLINK&quot; != x &amp;&amp; test &quot;x$READLINK_ISGNU&quot; != x; then
 360       $1=`$READLINK -f [$]$1`
 361     else
 362       # Save the current directory for restoring afterwards
 363       STARTDIR=$PWD
 364       COUNTER=0
 365       sym_link_dir=`$DIRNAME [$]$1`
 366       sym_link_file=`$BASENAME [$]$1`
 367       cd $sym_link_dir
 368       # Use -P flag to resolve symlinks in directories.
 369       cd `$THEPWDCMD -P`
 370       sym_link_dir=`$THEPWDCMD -P`
 371       # Resolve file symlinks
 372       while test $COUNTER -lt 20; do
 373         ISLINK=`$LS -l $sym_link_dir/$sym_link_file | $GREP &#39;\-&gt;&#39; | $SED -e &#39;s/.*-&gt; \(.*\)/\1/&#39;`
 374         if test &quot;x$ISLINK&quot; == x; then
 375           # This is not a symbolic link! We are done!
 376           break
 377         fi
 378         # Again resolve directory symlinks since the target of the just found
 379         # link could be in a different directory
 380         cd `$DIRNAME $ISLINK`
 381         sym_link_dir=`$THEPWDCMD -P`
 382         sym_link_file=`$BASENAME $ISLINK`
 383         let COUNTER=COUNTER+1
 384       done
 385       cd $STARTDIR
 386       $1=$sym_link_dir/$sym_link_file
 387     fi
 388   fi
 389 ])
 390 
 391 ###############################################################################
 392 # Register a --with argument but mark it as deprecated
 393 # $1: The name of the with argument to deprecate, not including --with-
 394 AC_DEFUN([BASIC_DEPRECATED_ARG_WITH],
 395 [
 396   AC_ARG_WITH($1, [AS_HELP_STRING([--with-$1],
 397       [Deprecated. Option is kept for backwards compatibility and is ignored])],
 398       [AC_MSG_WARN([Option --with-$1 is deprecated and will be ignored.])])
 399 ])
 400 
 401 ###############################################################################
 402 # Register a --enable argument but mark it as deprecated
 403 # $1: The name of the with argument to deprecate, not including --enable-
 404 # $2: The name of the argument to deprecate, in shell variable style (i.e. with _ instead of -)
 405 # $3: Messages to user.
 406 AC_DEFUN([BASIC_DEPRECATED_ARG_ENABLE],
 407 [
 408   AC_ARG_ENABLE($1, [AS_HELP_STRING([--enable-$1],
 409       [Deprecated. Option is kept for backwards compatibility and is ignored])])
 410   if test &quot;x$enable_$2&quot; != x; then
 411     AC_MSG_WARN([Option --enable-$1 is deprecated and will be ignored.])
 412 
 413     if test &quot;x$3&quot; != x; then
 414       AC_MSG_WARN([$3])
 415     fi
 416 
 417   fi
 418 ])
 419 
 420 ###############################################################################
 421 # Register an --enable-* argument as an alias for another argument.
 422 # $1: The name of the enable argument for the new alias, not including --enable-
 423 # $2: The full name of the argument of which to make this an alias, including
 424 #     --enable- or --with-.
 425 AC_DEFUN([BASIC_ALIASED_ARG_ENABLE],
 426 [
 427   AC_ARG_ENABLE($1, [AS_HELP_STRING([--enable-$1], [alias for $2])], [
 428     # Use m4 to strip initial -- from target ($2), convert - to _, prefix enable_
 429     # to new alias name, and create a shell variable assignment,
 430     # e.g.: enable_old_style=&quot;$enable_new_alias&quot;
 431     translit(patsubst($2, --), -, _)=&quot;$[enable_]translit($1, -, _)&quot;
 432   ])
 433 ])
 434 
 435 ###############################################################################
 436 AC_DEFUN_ONCE([BASIC_INIT],
 437 [
 438   # Save the original command line. This is passed to us by the wrapper configure script.
 439   AC_SUBST(CONFIGURE_COMMAND_LINE)
 440   # AUTOCONF might be set in the environment by the user. Preserve for &quot;make reconfigure&quot;.
 441   AC_SUBST(AUTOCONF)
 442   # Save the path variable before it gets changed
 443   ORIGINAL_PATH=&quot;$PATH&quot;
 444   AC_SUBST(ORIGINAL_PATH)
 445   DATE_WHEN_CONFIGURED=`date`
 446   AC_SUBST(DATE_WHEN_CONFIGURED)
 447   AC_MSG_NOTICE([Configuration created at $DATE_WHEN_CONFIGURED.])
 448 ])
 449 
 450 ###############################################################################
 451 # Test that variable $1 denoting a program is not empty. If empty, exit with an error.
 452 # $1: variable to check
 453 AC_DEFUN([BASIC_CHECK_NONEMPTY],
 454 [
 455   if test &quot;x[$]$1&quot; = x; then
 456     AC_MSG_ERROR([Could not find required tool for $1])
 457   fi
 458 ])
 459 
 460 ###############################################################################
 461 # Check that there are no unprocessed overridden variables left.
 462 # If so, they are an incorrect argument and we will exit with an error.
 463 AC_DEFUN([BASIC_CHECK_LEFTOVER_OVERRIDDEN],
 464 [
 465   if test &quot;x$CONFIGURE_OVERRIDDEN_VARIABLES&quot; != x; then
 466     # Replace the separating ! with spaces before presenting for end user.
 467     unknown_variables=${CONFIGURE_OVERRIDDEN_VARIABLES//!/ }
 468     AC_MSG_WARN([The following variables might be unknown to configure: $unknown_variables])
 469   fi
 470 ])
 471 
 472 ###############################################################################
 473 # Setup a tool for the given variable. If correctly specified by the user,
 474 # use that value, otherwise search for the tool using the supplied code snippet.
 475 # $1: variable to set
 476 # $2: code snippet to call to look for the tool
 477 # $3: code snippet to call if variable was used to find tool
 478 AC_DEFUN([BASIC_SETUP_TOOL],
 479 [
 480   # Publish this variable in the help.
 481   AC_ARG_VAR($1, [Override default value for $1])
 482 
 483   if [[ -z &quot;${$1+x}&quot; ]]; then
 484     # The variable is not set by user, try to locate tool using the code snippet
 485     $2
 486   else
 487     # The variable is set, but is it from the command line or the environment?
 488 
 489     # Try to remove the string !$1! from our list.
 490     try_remove_var=${CONFIGURE_OVERRIDDEN_VARIABLES//!$1!/}
 491     if test &quot;x$try_remove_var&quot; = &quot;x$CONFIGURE_OVERRIDDEN_VARIABLES&quot;; then
 492       # If it failed, the variable was not from the command line. Ignore it,
 493       # but warn the user (except for BASH, which is always set by the calling BASH).
 494       if test &quot;x$1&quot; != xBASH; then
 495         AC_MSG_WARN([Ignoring value of $1 from the environment. Use command line variables instead.])
 496       fi
 497       # Try to locate tool using the code snippet
 498       $2
 499     else
 500       # If it succeeded, then it was overridden by the user. We will use it
 501       # for the tool.
 502 
 503       # First remove it from the list of overridden variables, so we can test
 504       # for unknown variables in the end.
 505       CONFIGURE_OVERRIDDEN_VARIABLES=&quot;$try_remove_var&quot;
 506 
 507       tool_override=[$]$1
 508       AC_MSG_NOTICE([User supplied override $1=&quot;$tool_override&quot;])
 509 
 510       # Check if we try to supply an empty value
 511       if test &quot;x$tool_override&quot; = x; then
 512         AC_MSG_CHECKING([for $1])
 513         AC_MSG_RESULT([disabled])
 514       else
 515         # Split up override in command part and argument part
 516         tool_and_args=($tool_override)
 517         [ tool_command=${tool_and_args[0]} ]
 518         [ unset &#39;tool_and_args[0]&#39; ]
 519         [ tool_args=${tool_and_args[@]} ]
 520 
 521         # Check if the provided tool contains a complete path.
 522         tool_basename=&quot;${tool_command##*/}&quot;
 523         if test &quot;x$tool_basename&quot; = &quot;x$tool_command&quot;; then
 524           # A command without a complete path is provided, search $PATH.
 525           AC_MSG_NOTICE([Will search for user supplied tool &quot;$tool_basename&quot;])
 526           AC_PATH_PROG($1, $tool_basename)
 527           if test &quot;x[$]$1&quot; = x; then
 528             AC_MSG_ERROR([User supplied tool $1=&quot;$tool_basename&quot; could not be found])
 529           fi
 530         else
 531           # Otherwise we believe it is a complete path. Use it as it is.
 532           AC_MSG_NOTICE([Will use user supplied tool &quot;$tool_command&quot;])
 533           AC_MSG_CHECKING([for $tool_command])
 534           if test ! -x &quot;$tool_command&quot;; then
 535             AC_MSG_RESULT([not found])
 536             AC_MSG_ERROR([User supplied tool $1=&quot;$tool_command&quot; does not exist or is not executable])
 537           fi
 538            $1=&quot;$tool_command&quot;
 539           AC_MSG_RESULT([found])
 540         fi
 541         if test &quot;x$tool_args&quot; != x; then
 542           # If we got arguments, re-append them to the command after the fixup.
 543           $1=&quot;[$]$1 $tool_args&quot;
 544         fi
 545       fi
 546     fi
 547     $3
 548   fi
 549 ])
 550 
 551 ###############################################################################
 552 # Call BASIC_SETUP_TOOL with AC_PATH_PROGS to locate the tool
 553 # $1: variable to set
 554 # $2: executable name (or list of names) to look for
 555 # $3: [path]
 556 AC_DEFUN([BASIC_PATH_PROGS],
 557 [
 558   BASIC_SETUP_TOOL($1, [AC_PATH_PROGS($1, $2, , $3)])
 559 ])
 560 
 561 ###############################################################################
 562 # Call BASIC_SETUP_TOOL with AC_CHECK_TOOLS to locate the tool
 563 # $1: variable to set
 564 # $2: executable name (or list of names) to look for
 565 AC_DEFUN([BASIC_CHECK_TOOLS],
 566 [
 567   BASIC_SETUP_TOOL($1, [AC_CHECK_TOOLS($1, $2)])
 568 ])
 569 
 570 ###############################################################################
 571 # Like BASIC_PATH_PROGS but fails if no tool was found.
 572 # $1: variable to set
 573 # $2: executable name (or list of names) to look for
 574 # $3: [path]
 575 AC_DEFUN([BASIC_REQUIRE_PROGS],
 576 [
 577   BASIC_PATH_PROGS($1, $2, , $3)
 578   BASIC_CHECK_NONEMPTY($1)
 579 ])
 580 
 581 ###############################################################################
 582 # Like BASIC_SETUP_TOOL but fails if no tool was found.
 583 # $1: variable to set
 584 # $2: autoconf macro to call to look for the special tool
 585 AC_DEFUN([BASIC_REQUIRE_SPECIAL],
 586 [
 587   BASIC_SETUP_TOOL($1, [$2])
 588   BASIC_CHECK_NONEMPTY($1)
 589 ])
 590 
 591 ###############################################################################
 592 # Like BASIC_REQUIRE_PROGS but also allows for bash built-ins
 593 # $1: variable to set
 594 # $2: executable name (or list of names) to look for
 595 # $3: [path]
 596 AC_DEFUN([BASIC_REQUIRE_BUILTIN_PROGS],
 597 [
 598   BASIC_SETUP_TOOL($1, [AC_PATH_PROGS($1, $2, , $3)])
 599   if test &quot;x[$]$1&quot; = x; then
 600     AC_MSG_NOTICE([Required tool $2 not found in PATH, checking built-in])
 601     if help $2 &gt; /dev/null 2&gt;&amp;1; then
 602       AC_MSG_NOTICE([Found $2 as shell built-in. Using it])
 603       $1=&quot;$2&quot;
 604     else
 605       AC_MSG_ERROR([Required tool $2 also not found as built-in.])
 606     fi
 607   fi
 608   BASIC_CHECK_NONEMPTY($1)
 609 ])
 610 
 611 ###############################################################################
 612 # Setup the most fundamental tools that relies on not much else to set up,
 613 # but is used by much of the early bootstrap code.
 614 AC_DEFUN_ONCE([BASIC_SETUP_FUNDAMENTAL_TOOLS],
 615 [
 616   # Start with tools that do not need have cross compilation support
 617   # and can be expected to be found in the default PATH. These tools are
 618   # used by configure.
 619 
 620   # First are all the simple required tools.
 621   BASIC_REQUIRE_PROGS(BASENAME, basename)
 622   BASIC_REQUIRE_PROGS(BASH, bash)
 623   BASIC_REQUIRE_PROGS(CAT, cat)
 624   BASIC_REQUIRE_PROGS(CHMOD, chmod)
 625   BASIC_REQUIRE_PROGS(CMP, cmp)
 626   BASIC_REQUIRE_PROGS(COMM, comm)
 627   BASIC_REQUIRE_PROGS(CP, cp)
 628   BASIC_REQUIRE_PROGS(CUT, cut)
 629   BASIC_REQUIRE_PROGS(DATE, date)
 630   BASIC_REQUIRE_PROGS(DIFF, [gdiff diff])
 631   BASIC_REQUIRE_PROGS(DIRNAME, dirname)
 632   BASIC_REQUIRE_PROGS(ECHO, echo)
 633   BASIC_REQUIRE_PROGS(EXPR, expr)
 634   BASIC_REQUIRE_PROGS(FILE, file)
 635   BASIC_REQUIRE_PROGS(FIND, find)
 636   BASIC_REQUIRE_PROGS(HEAD, head)
 637   BASIC_REQUIRE_PROGS(GUNZIP, gunzip)
 638   BASIC_REQUIRE_PROGS(GZIP, pigz gzip)
 639   BASIC_REQUIRE_PROGS(LN, ln)
 640   BASIC_REQUIRE_PROGS(LS, ls)
 641   # gmkdir is known to be safe for concurrent invocations with -p flag.
 642   BASIC_REQUIRE_PROGS(MKDIR, [gmkdir mkdir])
 643   BASIC_REQUIRE_PROGS(MKTEMP, mktemp)
 644   BASIC_REQUIRE_PROGS(MV, mv)
 645   BASIC_REQUIRE_PROGS(NAWK, [nawk gawk awk])
 646   BASIC_REQUIRE_PROGS(PRINTF, printf)
 647   BASIC_REQUIRE_PROGS(READLINK, [greadlink readlink])
 648   BASIC_REQUIRE_PROGS(RM, rm)
 649   BASIC_REQUIRE_PROGS(RMDIR, rmdir)
 650   BASIC_REQUIRE_PROGS(SH, sh)
 651   BASIC_REQUIRE_PROGS(SORT, sort)
 652   BASIC_REQUIRE_PROGS(TAIL, tail)
 653   BASIC_REQUIRE_PROGS(TAR, gtar tar)
 654   BASIC_REQUIRE_PROGS(TEE, tee)
 655   BASIC_REQUIRE_PROGS(TOUCH, touch)
 656   BASIC_REQUIRE_PROGS(TR, tr)
 657   BASIC_REQUIRE_PROGS(UNAME, uname)
 658   BASIC_REQUIRE_PROGS(UNIQ, uniq)
 659   BASIC_REQUIRE_PROGS(WC, wc)
 660   BASIC_REQUIRE_PROGS(WHICH, which)
 661   BASIC_REQUIRE_PROGS(XARGS, xargs)
 662 
 663   # Then required tools that require some special treatment.
 664   BASIC_REQUIRE_SPECIAL(AWK, [AC_PROG_AWK])
 665   BASIC_REQUIRE_SPECIAL(GREP, [AC_PROG_GREP])
 666   BASIC_REQUIRE_SPECIAL(EGREP, [AC_PROG_EGREP])
 667   BASIC_REQUIRE_SPECIAL(FGREP, [AC_PROG_FGREP])
 668   BASIC_REQUIRE_SPECIAL(SED, [AC_PROG_SED])
 669 
 670   # Always force rm.
 671   RM=&quot;$RM -f&quot;
 672 
 673   # pwd behaves differently on various platforms and some don&#39;t support the -L flag.
 674   # Always use the bash builtin pwd to get uniform behavior.
 675   THEPWDCMD=pwd
 676 
 677   # These are not required on all platforms
 678   BASIC_PATH_PROGS(CYGPATH, cygpath)
 679   BASIC_PATH_PROGS(WSLPATH, wslpath)
 680   BASIC_PATH_PROGS(DF, df)
 681   BASIC_PATH_PROGS(CPIO, [cpio bsdcpio])
 682   BASIC_PATH_PROGS(NICE, nice)
 683 
 684   BASIC_PATH_PROGS(LSB_RELEASE, lsb_release)
 685   BASIC_PATH_PROGS(CMD, [cmd.exe /mnt/c/Windows/System32/cmd.exe])
 686 ])
 687 
 688 ###############################################################################
 689 # Setup basic configuration paths, and platform-specific stuff related to PATHs.
 690 AC_DEFUN_ONCE([BASIC_SETUP_PATHS],
 691 [
 692   # Save the current directory this script was started from
 693   CONFIGURE_START_DIR=&quot;$PWD&quot;
 694 
 695   # We might need to rewrite ORIGINAL_PATH, if it includes &quot;#&quot;, to quote them
 696   # for make. We couldn&#39;t do this when we retrieved ORIGINAL_PATH, since SED
 697   # was not available at that time.
 698   REWRITTEN_PATH=`$ECHO &quot;$ORIGINAL_PATH&quot; | $SED -e &#39;s/#/\\\\#/g&#39;`
 699   if test &quot;x$REWRITTEN_PATH&quot; != &quot;x$ORIGINAL_PATH&quot;; then
 700     ORIGINAL_PATH=&quot;$REWRITTEN_PATH&quot;
 701     AC_MSG_NOTICE([Rewriting ORIGINAL_PATH to $REWRITTEN_PATH])
 702   fi
 703 
 704   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xwindows&quot;; then
 705     PATH_SEP=&quot;;&quot;
 706     EXE_SUFFIX=&quot;.exe&quot;
 707     BASIC_CHECK_PATHS_WINDOWS
 708   else
 709     PATH_SEP=&quot;:&quot;
 710     EXE_SUFFIX=&quot;&quot;
 711   fi
 712   AC_SUBST(PATH_SEP)
 713   AC_SUBST(EXE_SUFFIX)
 714 
 715   # We get the top-level directory from the supporting wrappers.
 716   AC_MSG_CHECKING([for top-level directory])
 717   AC_MSG_RESULT([$TOPDIR])
 718   AC_SUBST(TOPDIR)
 719   AC_SUBST(CONFIGURE_START_DIR)
 720 
 721   # We can only call BASIC_FIXUP_PATH after BASIC_CHECK_PATHS_WINDOWS.
 722   BASIC_FIXUP_PATH(CONFIGURE_START_DIR)
 723   BASIC_FIXUP_PATH(TOPDIR)
 724 
 725   # Locate the directory of this script.
 726   AUTOCONF_DIR=$TOPDIR/make/autoconf
 727 
 728   # Setup username (for use in adhoc version strings etc)
 729   # Outer [ ] to quote m4.
 730   [ USERNAME=`$ECHO &quot;$USER&quot; | $TR -d -c &#39;[a-z][A-Z][0-9]&#39;` ]
 731   AC_SUBST(USERNAME)
 732 ])
 733 
 734 ###############################################################################
 735 # Evaluates platform specific overrides for devkit variables.
 736 # $1: Name of variable
 737 AC_DEFUN([BASIC_EVAL_DEVKIT_VARIABLE],
 738 [
 739   if test &quot;x[$]$1&quot; = x; then
 740     eval $1=&quot;\${$1_${OPENJDK_TARGET_CPU}}&quot;
 741   fi
 742 ])
 743 
 744 ###############################################################################
 745 AC_DEFUN_ONCE([BASIC_SETUP_DEVKIT],
 746 [
 747   AC_ARG_WITH([devkit], [AS_HELP_STRING([--with-devkit],
 748       [use this devkit for compilers, tools and resources])])
 749 
 750   if test &quot;x$with_devkit&quot; = xyes; then
 751     AC_MSG_ERROR([--with-devkit must have a value])
 752   elif test &quot;x$with_devkit&quot; != x &amp;&amp; test &quot;x$with_devkit&quot; != xno; then
 753     BASIC_FIXUP_PATH([with_devkit])
 754     DEVKIT_ROOT=&quot;$with_devkit&quot;
 755     # Check for a meta data info file in the root of the devkit
 756     if test -f &quot;$DEVKIT_ROOT/devkit.info&quot;; then
 757       . $DEVKIT_ROOT/devkit.info
 758       # This potentially sets the following:
 759       # A descriptive name of the devkit
 760       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_NAME])
 761       # Corresponds to --with-extra-path
 762       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_EXTRA_PATH])
 763       # Corresponds to --with-toolchain-path
 764       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_TOOLCHAIN_PATH])
 765       # Corresponds to --with-sysroot
 766       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_SYSROOT])
 767 
 768       # Identifies the Visual Studio version in the devkit
 769       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_VS_VERSION])
 770       # The Visual Studio include environment variable
 771       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_VS_INCLUDE])
 772       # The Visual Studio lib environment variable
 773       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_VS_LIB])
 774       # Corresponds to --with-msvcr-dll
 775       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_MSVCR_DLL])
 776       # Corresponds to --with-msvcp-dll
 777       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_MSVCP_DLL])
 778       # Corresponds to --with-ucrt-dll-dir
 779       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_UCRT_DLL_DIR])
 780     fi
 781 
 782     AC_MSG_CHECKING([for devkit])
 783     if test &quot;x$DEVKIT_NAME&quot; != x; then
 784       AC_MSG_RESULT([$DEVKIT_NAME in $DEVKIT_ROOT])
 785     else
 786       AC_MSG_RESULT([$DEVKIT_ROOT])
 787     fi
 788 
 789     BASIC_PREPEND_TO_PATH([EXTRA_PATH],$DEVKIT_EXTRA_PATH)
 790 
 791     # Fallback default of just /bin if DEVKIT_PATH is not defined
 792     if test &quot;x$DEVKIT_TOOLCHAIN_PATH&quot; = x; then
 793       DEVKIT_TOOLCHAIN_PATH=&quot;$DEVKIT_ROOT/bin&quot;
 794     fi
 795     BASIC_PREPEND_TO_PATH([TOOLCHAIN_PATH],$DEVKIT_TOOLCHAIN_PATH)
 796 
 797     # If DEVKIT_SYSROOT is set, use that, otherwise try a couple of known
 798     # places for backwards compatiblity.
 799     if test &quot;x$DEVKIT_SYSROOT&quot; != x; then
 800       SYSROOT=&quot;$DEVKIT_SYSROOT&quot;
 801     elif test -d &quot;$DEVKIT_ROOT/$host_alias/libc&quot;; then
 802       SYSROOT=&quot;$DEVKIT_ROOT/$host_alias/libc&quot;
 803     elif test -d &quot;$DEVKIT_ROOT/$host/sys-root&quot;; then
 804       SYSROOT=&quot;$DEVKIT_ROOT/$host/sys-root&quot;
 805     fi
 806 
 807     if test &quot;x$DEVKIT_ROOT&quot; != x; then
 808       DEVKIT_LIB_DIR=&quot;$DEVKIT_ROOT/lib&quot;
 809       if test &quot;x$OPENJDK_TARGET_CPU_BITS&quot; = x64; then
 810         DEVKIT_LIB_DIR=&quot;$DEVKIT_ROOT/lib64&quot;
 811       fi
 812       AC_SUBST(DEVKIT_LIB_DIR)
 813     fi
 814   fi
 815 
 816   # You can force the sysroot if the sysroot encoded into the compiler tools
 817   # is not correct.
 818   AC_ARG_WITH(sys-root, [AS_HELP_STRING([--with-sys-root],
 819       [alias for --with-sysroot for backwards compatability])],
 820       [SYSROOT=$with_sys_root]
 821   )
 822 
 823   AC_ARG_WITH(sysroot, [AS_HELP_STRING([--with-sysroot],
 824       [use this directory as sysroot])],
 825       [SYSROOT=$with_sysroot]
 826   )
 827 
 828   AC_ARG_WITH([tools-dir], [AS_HELP_STRING([--with-tools-dir],
 829       [alias for --with-toolchain-path for backwards compatibility])],
 830       [BASIC_PREPEND_TO_PATH([TOOLCHAIN_PATH],$with_tools_dir)]
 831   )
 832 
 833   AC_ARG_WITH([toolchain-path], [AS_HELP_STRING([--with-toolchain-path],
 834       [prepend these directories when searching for toolchain binaries (compilers etc)])],
 835       [BASIC_PREPEND_TO_PATH([TOOLCHAIN_PATH],$with_toolchain_path)]
 836   )
 837 
 838   AC_ARG_WITH([extra-path], [AS_HELP_STRING([--with-extra-path],
 839       [prepend these directories to the default path])],
 840       [BASIC_PREPEND_TO_PATH([EXTRA_PATH],$with_extra_path)]
 841   )
 842 
 843   if test &quot;x$OPENJDK_BUILD_OS&quot; = &quot;xmacosx&quot;; then
 844     # If a devkit has been supplied, find xcodebuild in the toolchain_path.
 845     # If not, detect if Xcode is installed by running xcodebuild -version
 846     # if no Xcode installed, xcodebuild exits with 1
 847     # if Xcode is installed, even if xcode-select is misconfigured, then it exits with 0
 848     if test &quot;x$DEVKIT_ROOT&quot; != x || /usr/bin/xcodebuild -version &gt;/dev/null 2&gt;&amp;1; then
 849       # We need to use xcodebuild in the toolchain dir provided by the user, this will
 850       # fall back on the stub binary in /usr/bin/xcodebuild
 851       AC_PATH_PROG([XCODEBUILD], [xcodebuild], [/usr/bin/xcodebuild], [$TOOLCHAIN_PATH])
 852     else
 853       # this should result in SYSROOT being empty, unless --with-sysroot is provided
 854       # when only the command line tools are installed there are no SDKs, so headers
 855       # are copied into the system frameworks
 856       XCODEBUILD=
 857       AC_SUBST(XCODEBUILD)
 858     fi
 859 
 860     AC_MSG_CHECKING([for sdk name])
 861     AC_ARG_WITH([sdk-name], [AS_HELP_STRING([--with-sdk-name],
 862         [use the platform SDK of the given name. @&lt;:@macosx@:&gt;@])],
 863         [SDKNAME=$with_sdk_name]
 864     )
 865     AC_MSG_RESULT([$SDKNAME])
 866 
 867     # if toolchain path is specified then don&#39;t rely on system headers, they may not compile
 868     HAVE_SYSTEM_FRAMEWORK_HEADERS=0
 869     test -z &quot;$TOOLCHAIN_PATH&quot; &amp;&amp; \
 870       HAVE_SYSTEM_FRAMEWORK_HEADERS=`test ! -f /System/Library/Frameworks/Foundation.framework/Headers/Foundation.h; echo $?`
 871 
 872     if test -z &quot;$SYSROOT&quot;; then
 873       if test -n &quot;$XCODEBUILD&quot;; then
 874         # if we don&#39;t have system headers, use default SDK name (last resort)
 875         if test -z &quot;$SDKNAME&quot; -a $HAVE_SYSTEM_FRAMEWORK_HEADERS -eq 0; then
 876           SDKNAME=${SDKNAME:-macosx}
 877         fi
 878 
 879         if test -n &quot;$SDKNAME&quot;; then
 880           # Call xcodebuild to determine SYSROOT
 881           SYSROOT=`&quot;$XCODEBUILD&quot; -sdk $SDKNAME -version | $GREP &#39;^Path: &#39; | $SED &#39;s/Path: //&#39;`
 882         fi
 883       else
 884         if test $HAVE_SYSTEM_FRAMEWORK_HEADERS -eq 0; then
 885           AC_MSG_ERROR([No xcodebuild tool and no system framework headers found, use --with-sysroot or --with-sdk-name to provide a path to a valid SDK])
 886         fi
 887       fi
 888     else
 889       # warn user if --with-sdk-name was also set
 890       if test -n &quot;$with_sdk_name&quot;; then
 891         AC_MSG_WARN([Both SYSROOT and --with-sdk-name are set, only SYSROOT will be used])
 892       fi
 893     fi
 894 
 895     if test $HAVE_SYSTEM_FRAMEWORK_HEADERS -eq 0 -a -z &quot;$SYSROOT&quot;; then
 896       # If no system framework headers, then SYSROOT must be set, or we won&#39;t build
 897       AC_MSG_ERROR([Unable to determine SYSROOT and no headers found in /System/Library/Frameworks. Check Xcode configuration, --with-sysroot or --with-sdk-name arguments.])
 898     fi
 899 
 900     # Perform a basic sanity test
 901     if test ! -f &quot;$SYSROOT/System/Library/Frameworks/Foundation.framework/Headers/Foundation.h&quot;; then
 902       if test -z &quot;$SYSROOT&quot;; then
 903         AC_MSG_ERROR([Unable to find required framework headers, provide a path to an SDK via --with-sysroot or --with-sdk-name and be sure Xcode is installed properly])
 904       else
 905         AC_MSG_ERROR([Invalid SDK or SYSROOT path, dependent framework headers not found])
 906       fi
 907     fi
 908 
 909     # set SDKROOT too, Xcode tools will pick it up
 910     SDKROOT=&quot;$SYSROOT&quot;
 911     AC_SUBST(SDKROOT)
 912   fi
 913 
 914   # Prepend the extra path to the global path
 915   BASIC_PREPEND_TO_PATH([PATH],$EXTRA_PATH)
 916 
 917   AC_MSG_CHECKING([for sysroot])
 918   AC_MSG_RESULT([$SYSROOT])
 919   AC_MSG_CHECKING([for toolchain path])
 920   AC_MSG_RESULT([$TOOLCHAIN_PATH])
 921   AC_MSG_CHECKING([for extra path])
 922   AC_MSG_RESULT([$EXTRA_PATH])
 923 ])
 924 
 925 ###############################################################################
 926 AC_DEFUN_ONCE([BASIC_SETUP_OUTPUT_DIR],
 927 [
 928 
 929   AC_ARG_WITH(conf-name, [AS_HELP_STRING([--with-conf-name],
 930       [use this as the name of the configuration @&lt;:@generated from important configuration options@:&gt;@])],
 931       [ CONF_NAME=${with_conf_name} ])
 932 
 933   # Test from where we are running configure, in or outside of src root.
 934   AC_MSG_CHECKING([where to store configuration])
 935   if test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$TOPDIR&quot; \
 936       || test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$CUSTOM_ROOT&quot; \
 937       || test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$TOPDIR/make/autoconf&quot; \
 938       || test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$TOPDIR/make&quot; ; then
 939     # We are running configure from the src root.
 940     # Create a default ./build/target-variant-debuglevel output root.
 941     if test &quot;x${CONF_NAME}&quot; = x; then
 942       AC_MSG_RESULT([in default location])
 943       CONF_NAME=&quot;${OPENJDK_TARGET_OS}-${OPENJDK_TARGET_CPU}-${JVM_VARIANTS_WITH_AND}-${DEBUG_LEVEL}&quot;
 944     else
 945       AC_MSG_RESULT([in build directory with custom name])
 946     fi
 947 
 948     if test &quot;x$CUSTOM_ROOT&quot; != x; then
 949       WORKSPACE_ROOT=&quot;${CUSTOM_ROOT}&quot;
 950     else
 951       WORKSPACE_ROOT=&quot;${TOPDIR}&quot;
 952     fi
 953     OUTPUTDIR=&quot;${WORKSPACE_ROOT}/build/${CONF_NAME}&quot;
 954     $MKDIR -p &quot;$OUTPUTDIR&quot;
 955     if test ! -d &quot;$OUTPUTDIR&quot;; then
 956       AC_MSG_ERROR([Could not create build directory $OUTPUTDIR])
 957     fi
 958   else
 959     # We are running configure from outside of the src dir.
 960     # Then use the current directory as output dir!
 961     # If configuration is situated in normal build directory, just use the build
 962     # directory name as configuration name, otherwise use the complete path.
 963     if test &quot;x${CONF_NAME}&quot; = x; then
 964       CONF_NAME=`$ECHO $CONFIGURE_START_DIR | $SED -e &quot;s!^${TOPDIR}/build/!!&quot;`
 965     fi
 966     OUTPUTDIR=&quot;$CONFIGURE_START_DIR&quot;
 967     AC_MSG_RESULT([in current directory])
 968 
 969     # WARNING: This might be a bad thing to do. You need to be sure you want to
 970     # have a configuration in this directory. Do some sanity checks!
 971 
 972     if test ! -e &quot;$OUTPUTDIR/spec.gmk&quot;; then
 973       # If we have a spec.gmk, we have run here before and we are OK. Otherwise, check for
 974       # other files
 975       files_present=`$LS $OUTPUTDIR`
 976       # Configure has already touched config.log and confdefs.h in the current dir when this check
 977       # is performed.
 978       filtered_files=`$ECHO &quot;$files_present&quot; \
 979           | $SED -e &#39;s/config.log//g&#39; \
 980               -e &#39;s/configure.log//g&#39; \
 981               -e &#39;s/confdefs.h//g&#39; \
 982               -e &#39;s/configure-support//g&#39; \
 983               -e &#39;s/ //g&#39; \
 984           | $TR -d &#39;\n&#39;`
 985       if test &quot;x$filtered_files&quot; != x; then
 986         AC_MSG_NOTICE([Current directory is $CONFIGURE_START_DIR.])
 987         AC_MSG_NOTICE([Since this is not the source root, configure will output the configuration here])
 988         AC_MSG_NOTICE([(as opposed to creating a configuration in &lt;src_root&gt;/build/&lt;conf-name&gt;).])
 989         AC_MSG_NOTICE([However, this directory is not empty. This is not allowed, since it could])
 990         AC_MSG_NOTICE([seriously mess up just about everything.])
 991         AC_MSG_NOTICE([Try &#39;cd $TOPDIR&#39; and restart configure])
 992         AC_MSG_NOTICE([(or create a new empty directory and cd to it).])
 993         AC_MSG_ERROR([Will not continue creating configuration in $CONFIGURE_START_DIR])
 994       fi
 995     fi
 996   fi
 997   AC_MSG_CHECKING([what configuration name to use])
 998   AC_MSG_RESULT([$CONF_NAME])
 999 
1000   BASIC_FIXUP_PATH(OUTPUTDIR)
1001 
1002   CONFIGURESUPPORT_OUTPUTDIR=&quot;$OUTPUTDIR/configure-support&quot;
1003   $MKDIR -p &quot;$CONFIGURESUPPORT_OUTPUTDIR&quot;
1004 
1005   SPEC=&quot;$OUTPUTDIR/spec.gmk&quot;
1006   AC_SUBST(SPEC)
1007   AC_SUBST(CONF_NAME)
1008   AC_SUBST(OUTPUTDIR)
1009   AC_SUBST(WORKSPACE_ROOT)
1010   AC_SUBST(CONFIGURESUPPORT_OUTPUTDIR)
1011 
1012   # The spec.gmk file contains all variables for the make system.
1013   AC_CONFIG_FILES([$OUTPUTDIR/spec.gmk:$AUTOCONF_DIR/spec.gmk.in])
1014   # The bootcycle-spec.gmk file contains support for boot cycle builds.
1015   AC_CONFIG_FILES([$OUTPUTDIR/bootcycle-spec.gmk:$AUTOCONF_DIR/bootcycle-spec.gmk.in])
1016   # The buildjdk-spec.gmk file contains support for building a buildjdk when cross compiling.
1017   AC_CONFIG_FILES([$OUTPUTDIR/buildjdk-spec.gmk:$AUTOCONF_DIR/buildjdk-spec.gmk.in])
1018   # The compare.sh is used to compare the build output to other builds.
1019   AC_CONFIG_FILES([$OUTPUTDIR/compare.sh:$AUTOCONF_DIR/compare.sh.in])
1020   # The generated Makefile knows where the spec.gmk is and where the source is.
1021   # You can run make from the OUTPUTDIR, or from the top-level Makefile
1022   # which will look for generated configurations
1023   AC_CONFIG_FILES([$OUTPUTDIR/Makefile:$AUTOCONF_DIR/Makefile.in])
1024 ])
1025 
1026 #%%% Simple tools %%%
1027 
1028 ###############################################################################
1029 # Check if we have found a usable version of make
1030 # $1: the path to a potential make binary (or empty)
1031 # $2: the description on how we found this
1032 AC_DEFUN([BASIC_CHECK_MAKE_VERSION],
1033 [
1034   MAKE_CANDIDATE=&quot;$1&quot;
1035   DESCRIPTION=&quot;$2&quot;
1036 
1037   # On Cygwin, we require a newer version of make than on other platforms
1038   if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.cygwin&quot;; then
1039     MAKE_VERSION_EXPR=&quot;-e 4\.&quot;
1040     MAKE_REQUIRED_VERSION=&quot;4.0&quot;
1041    else
1042     MAKE_VERSION_EXPR=&quot;-e 3\.8[[12]] -e 4\.&quot;
1043     MAKE_REQUIRED_VERSION=&quot;3.81&quot;
1044   fi
1045 
1046   if test &quot;x$MAKE_CANDIDATE&quot; != x; then
1047     AC_MSG_NOTICE([Testing potential make at $MAKE_CANDIDATE, found using $DESCRIPTION])
1048     MAKE_VERSION_STRING=`$MAKE_CANDIDATE --version | $HEAD -n 1`
1049     IS_GNU_MAKE=`$ECHO $MAKE_VERSION_STRING | $GREP &#39;GNU Make&#39;`
1050     if test &quot;x$IS_GNU_MAKE&quot; = x; then
1051       AC_MSG_NOTICE([Found potential make at $MAKE_CANDIDATE, however, this is not GNU Make. Ignoring.])
1052     else
1053       IS_MODERN_MAKE=`$ECHO $MAKE_VERSION_STRING | $GREP $MAKE_VERSION_EXPR`
1054       if test &quot;x$IS_MODERN_MAKE&quot; = x; then
1055         AC_MSG_NOTICE([Found GNU make at $MAKE_CANDIDATE, however this is not version $MAKE_REQUIRED_VERSION or later. (it is: $MAKE_VERSION_STRING). Ignoring.])
1056       else
1057         if test &quot;x$OPENJDK_BUILD_OS&quot; = &quot;xwindows&quot;; then
1058           if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.cygwin&quot;; then
1059             MAKE_EXPECTED_ENV=&#39;cygwin&#39;
1060           elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.msys&quot;; then
1061             MAKE_EXPECTED_ENV=&#39;msys&#39;
1062           elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
1063             MAKE_EXPECTED_ENV=&#39;x86_64-.*-linux-gnu&#39;
1064           else
1065             AC_MSG_ERROR([Unknown Windows environment])
1066           fi
1067           MAKE_BUILT_FOR=`$MAKE_CANDIDATE --version | $GREP -i &#39;built for&#39;`
1068           IS_MAKE_CORRECT_ENV=`$ECHO $MAKE_BUILT_FOR | $GREP $MAKE_EXPECTED_ENV`
1069         else
1070           # Not relevant for non-Windows
1071           IS_MAKE_CORRECT_ENV=true
1072         fi
1073         if test &quot;x$IS_MAKE_CORRECT_ENV&quot; = x; then
1074           AC_MSG_NOTICE([Found GNU make version $MAKE_VERSION_STRING at $MAKE_CANDIDATE, but it is not for $MAKE_EXPECTED_ENV (it says: $MAKE_BUILT_FOR). Ignoring.])
1075         else
1076           FOUND_MAKE=$MAKE_CANDIDATE
1077           BASIC_FIXUP_EXECUTABLE(FOUND_MAKE)
1078         fi
1079       fi
1080     fi
1081   fi
1082 ])
1083 
1084 ###############################################################################
1085 AC_DEFUN([BASIC_CHECK_MAKE_OUTPUT_SYNC],
1086 [
1087   # Check if make supports the output sync option and if so, setup using it.
1088   AC_MSG_CHECKING([if make --output-sync is supported])
1089   if $MAKE --version -O &gt; /dev/null 2&gt;&amp;1; then
1090     OUTPUT_SYNC_SUPPORTED=true
1091     AC_MSG_RESULT([yes])
1092     AC_MSG_CHECKING([for output-sync value])
1093     AC_ARG_WITH([output-sync], [AS_HELP_STRING([--with-output-sync],
1094       [set make output sync type if supported by make. @&lt;:@recurse@:&gt;@])],
1095       [OUTPUT_SYNC=$with_output_sync])
1096     if test &quot;x$OUTPUT_SYNC&quot; = &quot;x&quot;; then
1097       OUTPUT_SYNC=none
1098     fi
1099     AC_MSG_RESULT([$OUTPUT_SYNC])
1100     if ! $MAKE --version -O$OUTPUT_SYNC &gt; /dev/null 2&gt;&amp;1; then
1101       AC_MSG_ERROR([Make did not the support the value $OUTPUT_SYNC as output sync type.])
1102     fi
1103   else
1104     OUTPUT_SYNC_SUPPORTED=false
1105     AC_MSG_RESULT([no])
1106   fi
1107   AC_SUBST(OUTPUT_SYNC_SUPPORTED)
1108   AC_SUBST(OUTPUT_SYNC)
1109 ])
1110 
1111 ###############################################################################
1112 # Goes looking for a usable version of GNU make.
1113 AC_DEFUN([BASIC_CHECK_GNU_MAKE],
1114 [
1115   BASIC_SETUP_TOOL([MAKE],
1116   [
1117     # Try our hardest to locate a correct version of GNU make
1118     AC_PATH_PROGS(CHECK_GMAKE, gmake)
1119     BASIC_CHECK_MAKE_VERSION(&quot;$CHECK_GMAKE&quot;, [gmake in PATH])
1120 
1121     if test &quot;x$FOUND_MAKE&quot; = x; then
1122       AC_PATH_PROGS(CHECK_MAKE, make)
1123       BASIC_CHECK_MAKE_VERSION(&quot;$CHECK_MAKE&quot;, [make in PATH])
1124     fi
1125 
1126     if test &quot;x$FOUND_MAKE&quot; = x; then
1127       if test &quot;x$TOOLCHAIN_PATH&quot; != x; then
1128         # We have a toolchain path, check that as well before giving up.
1129         OLD_PATH=$PATH
1130         PATH=$TOOLCHAIN_PATH:$PATH
1131         AC_PATH_PROGS(CHECK_TOOLSDIR_GMAKE, gmake)
1132         BASIC_CHECK_MAKE_VERSION(&quot;$CHECK_TOOLSDIR_GMAKE&quot;, [gmake in tools-dir])
1133         if test &quot;x$FOUND_MAKE&quot; = x; then
1134           AC_PATH_PROGS(CHECK_TOOLSDIR_MAKE, make)
1135           BASIC_CHECK_MAKE_VERSION(&quot;$CHECK_TOOLSDIR_MAKE&quot;, [make in tools-dir])
1136         fi
1137         PATH=$OLD_PATH
1138       fi
1139     fi
1140 
1141     if test &quot;x$FOUND_MAKE&quot; = x; then
1142       AC_MSG_ERROR([Cannot find GNU make $MAKE_REQUIRED_VERSION or newer! Please put it in the path, or add e.g. MAKE=/opt/gmake3.81/make as argument to configure.])
1143     fi
1144   ],[
1145     # If MAKE was set by user, verify the version
1146     BASIC_CHECK_MAKE_VERSION(&quot;$MAKE&quot;, [user supplied MAKE=$MAKE])
1147     if test &quot;x$FOUND_MAKE&quot; = x; then
1148       AC_MSG_ERROR([The specified make (by MAKE=$MAKE) is not GNU make $MAKE_REQUIRED_VERSION or newer.])
1149     fi
1150   ])
1151 
1152   MAKE=$FOUND_MAKE
1153   AC_SUBST(MAKE)
1154   AC_MSG_NOTICE([Using GNU make at $FOUND_MAKE (version: $MAKE_VERSION_STRING)])
1155 
1156   BASIC_CHECK_MAKE_OUTPUT_SYNC
1157 ])
1158 
1159 ###############################################################################
1160 AC_DEFUN([BASIC_CHECK_FIND_DELETE],
1161 [
1162   # Test if find supports -delete
1163   AC_MSG_CHECKING([if find supports -delete])
1164   FIND_DELETE=&quot;-delete&quot;
1165 
1166   DELETEDIR=`$MKTEMP -d tmp.XXXXXXXXXX` || (echo Could not create temporary directory!; exit $?)
1167 
1168   echo Hejsan &gt; $DELETEDIR/TestIfFindSupportsDelete
1169 
1170   TEST_DELETE=`$FIND &quot;$DELETEDIR&quot; -name TestIfFindSupportsDelete $FIND_DELETE 2&gt;&amp;1`
1171   if test -f $DELETEDIR/TestIfFindSupportsDelete; then
1172     # No, it does not.
1173     $RM $DELETEDIR/TestIfFindSupportsDelete
1174     if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xaix&quot;; then
1175       # AIX &#39;find&#39; is buggy if called with &#39;-exec {} \+&#39; and an empty file list
1176       FIND_DELETE=&quot;-print | $XARGS $RM&quot;
1177     else
1178       FIND_DELETE=&quot;-exec $RM \{\} \+&quot;
1179     fi
1180     AC_MSG_RESULT([no])
1181   else
1182     AC_MSG_RESULT([yes])
1183   fi
1184   $RMDIR $DELETEDIR
1185   AC_SUBST(FIND_DELETE)
1186 ])
1187 
1188 ###############################################################################
1189 AC_DEFUN([BASIC_CHECK_TAR],
1190 [
1191   # Test which kind of tar was found
1192   if test &quot;x$($TAR --version | $GREP &quot;GNU tar&quot;)&quot; != &quot;x&quot;; then
1193     TAR_TYPE=&quot;gnu&quot;
1194   elif test &quot;x$($TAR --version | $GREP &quot;bsdtar&quot;)&quot; != &quot;x&quot;; then
1195     TAR_TYPE=&quot;bsd&quot;
1196   elif test &quot;x$($TAR -v | $GREP &quot;bsdtar&quot;)&quot; != &quot;x&quot;; then
1197     TAR_TYPE=&quot;bsd&quot;
1198   elif test &quot;x$OPENJDK_BUILD_OS&quot; = &quot;xsolaris&quot;; then
1199     TAR_TYPE=&quot;solaris&quot;
1200   elif test &quot;x$OPENJDK_BUILD_OS&quot; = &quot;xaix&quot;; then
1201     TAR_TYPE=&quot;aix&quot;
1202   fi
1203   AC_MSG_CHECKING([what type of tar was found])
1204   AC_MSG_RESULT([$TAR_TYPE])
1205 
1206   TAR_CREATE_FILE_PARAM=&quot;&quot;
1207 
1208   if test &quot;x$TAR_TYPE&quot; = &quot;xgnu&quot;; then
1209     TAR_INCLUDE_PARAM=&quot;T&quot;
1210     TAR_SUPPORTS_TRANSFORM=&quot;true&quot;
1211     if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xsolaris&quot;; then
1212       # When using gnu tar for Solaris targets, need to use compatibility mode
1213       TAR_CREATE_EXTRA_PARAM=&quot;--format=ustar&quot;
1214     fi
1215   elif test &quot;x$TAR_TYPE&quot; = &quot;aix&quot;; then
1216     # -L InputList of aix tar: name of file listing the files and directories
1217     # that need to be   archived or extracted
1218     TAR_INCLUDE_PARAM=&quot;L&quot;
1219     TAR_SUPPORTS_TRANSFORM=&quot;false&quot;
1220   else
1221     TAR_INCLUDE_PARAM=&quot;I&quot;
1222     TAR_SUPPORTS_TRANSFORM=&quot;false&quot;
1223   fi
1224   AC_SUBST(TAR_TYPE)
1225   AC_SUBST(TAR_CREATE_EXTRA_PARAM)
1226   AC_SUBST(TAR_INCLUDE_PARAM)
1227   AC_SUBST(TAR_SUPPORTS_TRANSFORM)
1228 ])
1229 
1230 ###############################################################################
1231 AC_DEFUN([BASIC_CHECK_GREP],
1232 [
1233   # Test that grep supports -Fx with a list of pattern which includes null pattern.
1234   # This is a problem for the grep resident on AIX.
1235   AC_MSG_CHECKING([that grep ($GREP) -Fx handles empty lines in the pattern list correctly])
1236   # Multiple subsequent spaces..
1237   STACK_SPACES=&#39;aaa   bbb   ccc&#39;
1238   # ..converted to subsequent newlines, causes STACK_LIST to be a list with some empty
1239   # patterns in it.
1240   STACK_LIST=${STACK_SPACES// /$&#39;\n&#39;}
1241   NEEDLE_SPACES=&#39;ccc bbb aaa&#39;
1242   NEEDLE_LIST=${NEEDLE_SPACES// /$&#39;\n&#39;}
1243   RESULT=&quot;$($GREP -Fvx &quot;$STACK_LIST&quot; &lt;&lt;&lt; &quot;$NEEDLE_LIST&quot;)&quot;
1244   if test &quot;x$RESULT&quot; == &quot;x&quot;; then
1245     AC_MSG_RESULT([yes])
1246   else
1247     if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xaix&quot;; then
1248       ADDINFO=&quot;Please make sure you use GNU grep, usually found at /opt/freeware/bin.&quot;
1249     fi
1250     AC_MSG_ERROR([grep does not handle -Fx correctly. ${ADDINFO}])
1251   fi
1252 ])
1253 
1254 ###############################################################################
1255 AC_DEFUN_ONCE([BASIC_SETUP_COMPLEX_TOOLS],
1256 [
1257   BASIC_CHECK_GNU_MAKE
1258 
1259   BASIC_CHECK_FIND_DELETE
1260   BASIC_CHECK_TAR
1261   BASIC_CHECK_GREP
1262   BASIC_SETUP_PANDOC
1263 
1264   # These tools might not be installed by default,
1265   # need hint on how to install them.
1266   BASIC_REQUIRE_PROGS(UNZIP, unzip)
1267   # Since zip uses &quot;ZIP&quot; as a environment variable for passing options, we need
1268   # to name our variable differently, hence ZIPEXE.
1269   BASIC_REQUIRE_PROGS(ZIPEXE, zip)
1270 
1271   # Non-required basic tools
1272 
1273   BASIC_PATH_PROGS(LDD, ldd)
1274   if test &quot;x$LDD&quot; = &quot;x&quot;; then
1275     # List shared lib dependencies is used for
1276     # debug output and checking for forbidden dependencies.
1277     # We can build without it.
1278     LDD=&quot;true&quot;
1279   fi
1280   BASIC_PATH_PROGS(READELF, [greadelf readelf])
1281   BASIC_PATH_PROGS(DOT, dot)
1282   BASIC_PATH_PROGS(HG, hg)
1283   BASIC_PATH_PROGS(GIT, git)
1284   BASIC_PATH_PROGS(STAT, stat)
1285   BASIC_PATH_PROGS(TIME, time)
1286   BASIC_PATH_PROGS(FLOCK, flock)
1287   # Dtrace is usually found in /usr/sbin on Solaris, but that directory may not
1288   # be in the user path.
1289   BASIC_PATH_PROGS(DTRACE, dtrace, $PATH:/usr/sbin)
1290   BASIC_PATH_PROGS(PATCH, [gpatch patch])
1291   # Check if it&#39;s GNU time
1292   IS_GNU_TIME=`$TIME --version 2&gt;&amp;1 | $GREP &#39;GNU time&#39;`
1293   if test &quot;x$IS_GNU_TIME&quot; != x; then
1294     IS_GNU_TIME=yes
1295   else
1296     IS_GNU_TIME=no
1297   fi
1298   AC_SUBST(IS_GNU_TIME)
1299 
1300   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xmacosx&quot;; then
1301     BASIC_REQUIRE_PROGS(DSYMUTIL, dsymutil)
1302     BASIC_REQUIRE_PROGS(MIG, mig)
1303     BASIC_REQUIRE_PROGS(XATTR, xattr)
1304     BASIC_PATH_PROGS(CODESIGN, codesign)
1305 
1306     if test &quot;x$CODESIGN&quot; != &quot;x&quot;; then
1307       # Check for user provided code signing identity.
1308       # If no identity was provided, fall back to &quot;openjdk_codesign&quot;.
1309       AC_ARG_WITH([macosx-codesign-identity], [AS_HELP_STRING([--with-macosx-codesign-identity],
1310         [specify the code signing identity])],
1311         [MACOSX_CODESIGN_IDENTITY=$with_macosx_codesign_identity],
1312         [MACOSX_CODESIGN_IDENTITY=openjdk_codesign]
1313       )
1314 
1315       AC_SUBST(MACOSX_CODESIGN_IDENTITY)
1316 
1317       # Verify that the codesign certificate is present
1318       AC_MSG_CHECKING([if codesign certificate is present])
1319       $RM codesign-testfile
1320       $TOUCH codesign-testfile
1321       $CODESIGN -s &quot;$MACOSX_CODESIGN_IDENTITY&quot; codesign-testfile 2&gt;&amp;AS_MESSAGE_LOG_FD &gt;&amp;AS_MESSAGE_LOG_FD || CODESIGN=
1322       $RM codesign-testfile
1323       if test &quot;x$CODESIGN&quot; = x; then
1324         AC_MSG_RESULT([no])
1325       else
1326         AC_MSG_RESULT([yes])
1327       fi
1328     fi
1329     BASIC_REQUIRE_PROGS(SETFILE, SetFile)
1330   elif test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xsolaris&quot;; then
1331     BASIC_REQUIRE_PROGS(ELFEDIT, elfedit)
1332   fi
1333   if ! test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xwindows&quot;; then
1334     BASIC_REQUIRE_BUILTIN_PROGS(ULIMIT, ulimit)
1335   fi
1336 ])
1337 
1338 ###############################################################################
1339 # Check if build directory is on local disk. If not possible to determine,
1340 # we prefer to claim it&#39;s local.
1341 # Argument 1: directory to test
1342 # Argument 2: what to do if it is on local disk
1343 # Argument 3: what to do otherwise (remote disk or failure)
1344 AC_DEFUN([BASIC_CHECK_DIR_ON_LOCAL_DISK],
1345 [
1346   # df -l lists only local disks; if the given directory is not found then
1347   # a non-zero exit code is given
1348   if test &quot;x$DF&quot; = x; then
1349     if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.msys&quot;; then
1350       # msys does not have df; use Windows &quot;net use&quot; instead.
1351       IS_NETWORK_DISK=`net use | grep \`pwd -W | cut -d &quot;:&quot; -f 1 | tr a-z A-Z\`:`
1352       if test &quot;x$IS_NETWORK_DISK&quot; = x; then
1353         $2
1354       else
1355         $3
1356       fi
1357     else
1358       # No df here, say it&#39;s local
1359       $2
1360     fi
1361   else
1362     # JDK-8189619
1363     # df on AIX does not understand -l. On modern AIXes it understands &quot;-T local&quot; which
1364     # is the same. On older AIXes we just continue to live with a &quot;not local build&quot; warning.
1365     if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
1366       DF_LOCAL_ONLY_OPTION=&#39;-T local&#39;
1367     else
1368       DF_LOCAL_ONLY_OPTION=&#39;-l&#39;
1369     fi
1370     if $DF $DF_LOCAL_ONLY_OPTION $1 &gt; /dev/null 2&gt;&amp;1; then
1371       $2
1372     else
1373       # In WSL, local Windows drives are considered remote by df, but we are
1374       # required to build into a directory accessible from windows, so consider
1375       # them local here.
1376       if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
1377         if $DF $1 | $GREP -q &quot;^[[A-Z]]:&quot;; then
1378           $2
1379         else
1380           $3
1381         fi
1382       else
1383         $3
1384       fi
1385     fi
1386   fi
1387 ])
1388 
1389 ###############################################################################
1390 # Check that source files have basic read permissions set. This might
1391 # not be the case in cygwin in certain conditions.
1392 AC_DEFUN_ONCE([BASIC_CHECK_SRC_PERMS],
1393 [
1394   if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.cygwin&quot;; then
1395     file_to_test=&quot;$TOPDIR/LICENSE&quot;
1396     if test `$STAT -c &#39;%a&#39; &quot;$file_to_test&quot;` -lt 400; then
1397       AC_MSG_ERROR([Bad file permissions on src files. This is usually caused by cloning the repositories with a non cygwin hg in a directory not created in cygwin.])
1398     fi
1399   fi
1400 ])
1401 
1402 ###############################################################################
1403 AC_DEFUN_ONCE([BASIC_TEST_USABILITY_ISSUES],
1404 [
1405   AC_MSG_CHECKING([if build directory is on local disk])
1406   BASIC_CHECK_DIR_ON_LOCAL_DISK($OUTPUTDIR,
1407       [OUTPUT_DIR_IS_LOCAL=&quot;yes&quot;],
1408       [OUTPUT_DIR_IS_LOCAL=&quot;no&quot;])
1409   AC_MSG_RESULT($OUTPUT_DIR_IS_LOCAL)
1410 
1411   BASIC_CHECK_SRC_PERMS
1412 
1413   # Check if the user has any old-style ALT_ variables set.
1414   FOUND_ALT_VARIABLES=`env | grep ^ALT_`
1415 
1416   # Before generating output files, test if they exist. If they do, this is a reconfigure.
1417   # Since we can&#39;t properly handle the dependencies for this, warn the user about the situation
1418   if test -e $OUTPUTDIR/spec.gmk; then
1419     IS_RECONFIGURE=yes
1420   else
1421     IS_RECONFIGURE=no
1422   fi
1423 ])
1424 
1425 ###############################################################################
1426 # Check for support for specific options in bash
1427 AC_DEFUN_ONCE([BASIC_CHECK_BASH_OPTIONS],
1428 [
1429   # Check bash version
1430   # Extra [ ] to stop m4 mangling
1431   [ BASH_VER=`$BASH --version | $SED -n  -e &#39;s/^.*bash.*ersion *\([0-9.]*\).*$/\1/ p&#39;` ]
1432   AC_MSG_CHECKING([bash version])
1433   AC_MSG_RESULT([$BASH_VER])
1434 
1435   BASH_MAJOR=`$ECHO $BASH_VER | $CUT -d . -f 1`
1436   BASH_MINOR=`$ECHO $BASH_VER | $CUT -d . -f 2`
1437   if test $BASH_MAJOR -lt 3 || (test $BASH_MAJOR -eq 3 &amp;&amp; test $BASH_MINOR -lt 2); then
1438     AC_MSG_ERROR([bash version 3.2 or better is required])
1439   fi
1440 
1441   # Test if bash supports pipefail.
1442   AC_MSG_CHECKING([if bash supports pipefail])
1443   if ${BASH} -c &#39;set -o pipefail&#39;; then
1444     BASH_ARGS=&quot;$BASH_ARGS -o pipefail&quot;
1445     AC_MSG_RESULT([yes])
1446   else
1447     AC_MSG_RESULT([no])
1448   fi
1449 
1450   AC_MSG_CHECKING([if bash supports errexit (-e)])
1451   if ${BASH} -e -c &#39;true&#39;; then
1452     BASH_ARGS=&quot;$BASH_ARGS -e&quot;
1453     AC_MSG_RESULT([yes])
1454   else
1455     AC_MSG_RESULT([no])
1456   fi
1457 
1458   AC_SUBST(BASH_ARGS)
1459 ])
1460 
1461 ################################################################################
1462 #
1463 # Setup Pandoc
1464 #
1465 AC_DEFUN_ONCE([BASIC_SETUP_PANDOC],
1466 [
1467   BASIC_PATH_PROGS(PANDOC, pandoc)
1468 
1469   PANDOC_MARKDOWN_FLAG=&quot;markdown&quot;
1470   if test -n &quot;$PANDOC&quot;; then
1471     AC_MSG_CHECKING(if the pandoc smart extension needs to be disabled for markdown)
1472     if $PANDOC --list-extensions | $GREP -q &#39;\+smart&#39;; then
1473       AC_MSG_RESULT([yes])
1474       PANDOC_MARKDOWN_FLAG=&quot;markdown-smart&quot;
1475     else
1476       AC_MSG_RESULT([no])
1477     fi
1478   fi
1479 
1480   if test -n &quot;$PANDOC&quot;; then
1481     ENABLE_PANDOC=&quot;true&quot;
1482   else
1483     ENABLE_PANDOC=&quot;false&quot;
1484   fi
1485   AC_SUBST(ENABLE_PANDOC)
1486   AC_SUBST(PANDOC_MARKDOWN_FLAG)
1487 ])
1488 
1489 ################################################################################
1490 #
1491 # Default make target
1492 #
1493 AC_DEFUN_ONCE([BASIC_SETUP_DEFAULT_MAKE_TARGET],
1494 [
1495   AC_ARG_WITH(default-make-target, [AS_HELP_STRING([--with-default-make-target],
1496       [set the default make target @&lt;:@exploded-image@:&gt;@])])
1497   if test &quot;x$with_default_make_target&quot; = &quot;x&quot; \
1498       || test &quot;x$with_default_make_target&quot; = &quot;xyes&quot;; then
1499     DEFAULT_MAKE_TARGET=&quot;exploded-image&quot;
1500   elif test &quot;x$with_default_make_target&quot; = &quot;xno&quot;; then
1501     AC_MSG_ERROR([--without-default-make-target is not a valid option])
1502   else
1503     DEFAULT_MAKE_TARGET=&quot;$with_default_make_target&quot;
1504   fi
1505 
1506   AC_SUBST(DEFAULT_MAKE_TARGET)
1507 ])
1508 
1509 ###############################################################################
1510 # Setup the default value for LOG=
1511 #
1512 AC_DEFUN_ONCE([BASIC_SETUP_DEFAULT_LOG],
1513 [
1514   AC_ARG_WITH(log, [AS_HELP_STRING([--with-log],
1515       [[default vaue for make LOG argument [warn]]])])
1516   AC_MSG_CHECKING([for default LOG value])
1517   if test &quot;x$with_log&quot; = x; then
1518     DEFAULT_LOG=&quot;&quot;
1519   else
1520     # Syntax for valid LOG options is a bit too complex for it to be worth
1521     # implementing a test for correctness in configure. Just accept it.
1522     DEFAULT_LOG=$with_log
1523   fi
1524   AC_MSG_RESULT([$DEFAULT_LOG])
1525   AC_SUBST(DEFAULT_LOG)
1526 ])
1527 
1528 ###############################################################################
1529 # Code to run after AC_OUTPUT
1530 AC_DEFUN_ONCE([BASIC_POST_CONFIG_OUTPUT],
1531 [
1532   # Try to move config.log (generated by autoconf) to the configure-support directory.
1533   if test -e ./config.log; then
1534     $MV -f ./config.log &quot;$CONFIGURESUPPORT_OUTPUTDIR/config.log&quot; 2&gt; /dev/null
1535   fi
1536 
1537   # Rotate our log file (configure.log)
1538   if test -e &quot;$OUTPUTDIR/configure.log.old&quot;; then
1539     $RM -f &quot;$OUTPUTDIR/configure.log.old&quot;
1540   fi
1541   if test -e &quot;$OUTPUTDIR/configure.log&quot;; then
1542     $MV -f &quot;$OUTPUTDIR/configure.log&quot; &quot;$OUTPUTDIR/configure.log.old&quot; 2&gt; /dev/null
1543   fi
1544 
1545   # Move configure.log from current directory to the build output root
1546   if test -e ./configure.log; then
1547     $MV -f ./configure.log &quot;$OUTPUTDIR/configure.log&quot; 2&gt; /dev/null
1548   fi
1549 
1550   # Make the compare script executable
1551   $CHMOD +x $OUTPUTDIR/compare.sh
1552 ])
    </pre>
  </body>
</html>