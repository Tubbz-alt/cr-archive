<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/gc/shared/cardTable.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../parallel/psParallelCompact.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jvmFlagConstraintsGC.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shared/cardTable.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -49,34 +49,23 @@</span>
    _page_size(os::vm_page_size()),
    _byte_map_size(0),
    _byte_map(NULL),
    _byte_map_base(NULL),
    _cur_covered_regions(0),
<span class="udiff-line-modified-removed">-   _covered(NULL),</span>
<span class="udiff-line-modified-removed">-   _committed(NULL),</span>
<span class="udiff-line-modified-added">+   _covered(MemRegion::create_array(_max_covered_regions, mtGC)),</span>
<span class="udiff-line-modified-added">+   _committed(MemRegion::create_array(_max_covered_regions, mtGC)),</span>
    _guard_region()
  {
    assert((uintptr_t(_whole_heap.start())  &amp; (card_size - 1))  == 0, &quot;heap must start at card boundary&quot;);
    assert((uintptr_t(_whole_heap.end()) &amp; (card_size - 1))  == 0, &quot;heap must end at card boundary&quot;);
  
    assert(card_size &lt;= 512, &quot;card_size must be less than 512&quot;); // why?
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   _covered = new MemRegion[_max_covered_regions];</span>
<span class="udiff-line-removed">-   if (_covered == NULL) {</span>
<span class="udiff-line-removed">-     vm_exit_during_initialization(&quot;Could not allocate card table covered region set.&quot;);</span>
<span class="udiff-line-removed">-   }</span>
  }
  
  CardTable::~CardTable() {
<span class="udiff-line-modified-removed">-   if (_covered) {</span>
<span class="udiff-line-modified-removed">-     delete[] _covered;</span>
<span class="udiff-line-removed">-     _covered = NULL;</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-removed">-   if (_committed) {</span>
<span class="udiff-line-removed">-     delete[] _committed;</span>
<span class="udiff-line-removed">-     _committed = NULL;</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-modified-added">+   FREE_C_HEAP_ARRAY(MemRegion, _covered);</span>
<span class="udiff-line-modified-added">+   FREE_C_HEAP_ARRAY(MemRegion, _committed);</span>
  }
  
  void CardTable::initialize() {
    _guard_index = cards_required(_whole_heap.word_size()) - 1;
    _last_valid_index = _guard_index - 1;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -85,14 +74,10 @@</span>
  
    HeapWord* low_bound  = _whole_heap.start();
    HeapWord* high_bound = _whole_heap.end();
  
    _cur_covered_regions = 0;
<span class="udiff-line-removed">-   _committed = new MemRegion[_max_covered_regions];</span>
<span class="udiff-line-removed">-   if (_committed == NULL) {</span>
<span class="udiff-line-removed">-     vm_exit_during_initialization(&quot;Could not allocate card table committed region set.&quot;);</span>
<span class="udiff-line-removed">-   }</span>
  
    const size_t rs_align = _page_size == (size_t) os::vm_page_size() ? 0 :
      MAX2(_page_size, (size_t) os::vm_allocation_granularity());
    ReservedSpace heap_rs(_byte_map_size, rs_align, false);
  
</pre>
<center><a href="../parallel/psParallelCompact.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jvmFlagConstraintsGC.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>