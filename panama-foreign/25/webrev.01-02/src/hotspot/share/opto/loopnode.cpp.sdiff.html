<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/opto/loopnode.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="library_call.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="loopopts.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/opto/loopnode.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  23  */
  24 
  25 #include &quot;precompiled.hpp&quot;
  26 #include &quot;ci/ciMethodData.hpp&quot;
  27 #include &quot;compiler/compileLog.hpp&quot;
  28 #include &quot;gc/shared/barrierSet.hpp&quot;
  29 #include &quot;gc/shared/c2/barrierSetC2.hpp&quot;
  30 #include &quot;libadt/vectset.hpp&quot;
  31 #include &quot;memory/allocation.inline.hpp&quot;
  32 #include &quot;memory/resourceArea.hpp&quot;
  33 #include &quot;opto/addnode.hpp&quot;
  34 #include &quot;opto/callnode.hpp&quot;
  35 #include &quot;opto/connode.hpp&quot;
  36 #include &quot;opto/convertnode.hpp&quot;
  37 #include &quot;opto/divnode.hpp&quot;
  38 #include &quot;opto/idealGraphPrinter.hpp&quot;
  39 #include &quot;opto/loopnode.hpp&quot;
  40 #include &quot;opto/mulnode.hpp&quot;
  41 #include &quot;opto/rootnode.hpp&quot;
  42 #include &quot;opto/superword.hpp&quot;

  43 
  44 //=============================================================================
  45 //--------------------------is_cloop_ind_var-----------------------------------
  46 // Determine if a node is a counted loop induction variable.
  47 // NOTE: The method is declared in &quot;node.hpp&quot;.
  48 bool Node::is_cloop_ind_var() const {
  49   return (is_Phi() &amp;&amp; !as_Phi()-&gt;is_copy() &amp;&amp;
  50           as_Phi()-&gt;region()-&gt;is_CountedLoop() &amp;&amp;
  51           as_Phi()-&gt;region()-&gt;as_CountedLoop()-&gt;phi() == this);
  52 }
  53 
  54 //=============================================================================
  55 //------------------------------dump_spec--------------------------------------
  56 // Dump special per-node info
  57 #ifndef PRODUCT
  58 void LoopNode::dump_spec(outputStream *st) const {
  59   if (is_inner_loop()) st-&gt;print( &quot;inner &quot; );
  60   if (is_partial_peel_loop()) st-&gt;print( &quot;partial_peel &quot; );
  61   if (partial_peel_has_failed()) st-&gt;print( &quot;partial_peel_failed &quot; );
  62 }
</pre>
<hr />
<pre>
4071 
4072       Node_List worklist;
4073 
4074       Node *mem = n-&gt;in(MemNode::Memory);
4075       for (DUIterator_Fast imax, i = mem-&gt;fast_outs(imax); i &lt; imax; i++) {
4076         Node* s = mem-&gt;fast_out(i);
4077         worklist.push(s);
4078       }
4079       while(worklist.size() != 0 &amp;&amp; LCA != early) {
4080         Node* s = worklist.pop();
4081         if (s-&gt;is_Load() || s-&gt;Opcode() == Op_SafePoint ||
4082             (s-&gt;is_CallStaticJava() &amp;&amp; s-&gt;as_CallStaticJava()-&gt;uncommon_trap_request() != 0)) {
4083           continue;
4084         } else if (s-&gt;is_MergeMem()) {
4085           for (DUIterator_Fast imax, i = s-&gt;fast_outs(imax); i &lt; imax; i++) {
4086             Node* s1 = s-&gt;fast_out(i);
4087             worklist.push(s1);
4088           }
4089         } else {
4090           Node *sctrl = has_ctrl(s) ? get_ctrl(s) : s-&gt;in(0);
<span class="line-modified">4091           assert(sctrl != NULL || s-&gt;outcnt() == 0, &quot;must have control&quot;);</span>
4092           if (sctrl != NULL &amp;&amp; !sctrl-&gt;is_top() &amp;&amp; C-&gt;can_alias(s-&gt;adr_type(), load_alias_idx) &amp;&amp; is_dominator(early, sctrl)) {
4093             LCA = dom_lca_for_get_late_ctrl(LCA, sctrl, n);
4094           }
4095         }
4096       }
4097     }
4098   }
4099 
4100   assert(LCA == find_non_split_ctrl(LCA), &quot;unexpected late control&quot;);
4101   return LCA;
4102 }
4103 
4104 // true if CFG node d dominates CFG node n
4105 bool PhaseIdealLoop::is_dominator(Node *d, Node *n) {
4106   if (d == n)
4107     return true;
4108   assert(d-&gt;is_CFG() &amp;&amp; n-&gt;is_CFG(), &quot;must have CFG nodes&quot;);
4109   uint dd = dom_depth(d);
4110   while (dom_depth(n) &gt;= dd) {
4111     if (n == d)
</pre>
</td>
<td>
<hr />
<pre>
  23  */
  24 
  25 #include &quot;precompiled.hpp&quot;
  26 #include &quot;ci/ciMethodData.hpp&quot;
  27 #include &quot;compiler/compileLog.hpp&quot;
  28 #include &quot;gc/shared/barrierSet.hpp&quot;
  29 #include &quot;gc/shared/c2/barrierSetC2.hpp&quot;
  30 #include &quot;libadt/vectset.hpp&quot;
  31 #include &quot;memory/allocation.inline.hpp&quot;
  32 #include &quot;memory/resourceArea.hpp&quot;
  33 #include &quot;opto/addnode.hpp&quot;
  34 #include &quot;opto/callnode.hpp&quot;
  35 #include &quot;opto/connode.hpp&quot;
  36 #include &quot;opto/convertnode.hpp&quot;
  37 #include &quot;opto/divnode.hpp&quot;
  38 #include &quot;opto/idealGraphPrinter.hpp&quot;
  39 #include &quot;opto/loopnode.hpp&quot;
  40 #include &quot;opto/mulnode.hpp&quot;
  41 #include &quot;opto/rootnode.hpp&quot;
  42 #include &quot;opto/superword.hpp&quot;
<span class="line-added">  43 #include &quot;utilities/powerOfTwo.hpp&quot;</span>
  44 
  45 //=============================================================================
  46 //--------------------------is_cloop_ind_var-----------------------------------
  47 // Determine if a node is a counted loop induction variable.
  48 // NOTE: The method is declared in &quot;node.hpp&quot;.
  49 bool Node::is_cloop_ind_var() const {
  50   return (is_Phi() &amp;&amp; !as_Phi()-&gt;is_copy() &amp;&amp;
  51           as_Phi()-&gt;region()-&gt;is_CountedLoop() &amp;&amp;
  52           as_Phi()-&gt;region()-&gt;as_CountedLoop()-&gt;phi() == this);
  53 }
  54 
  55 //=============================================================================
  56 //------------------------------dump_spec--------------------------------------
  57 // Dump special per-node info
  58 #ifndef PRODUCT
  59 void LoopNode::dump_spec(outputStream *st) const {
  60   if (is_inner_loop()) st-&gt;print( &quot;inner &quot; );
  61   if (is_partial_peel_loop()) st-&gt;print( &quot;partial_peel &quot; );
  62   if (partial_peel_has_failed()) st-&gt;print( &quot;partial_peel_failed &quot; );
  63 }
</pre>
<hr />
<pre>
4072 
4073       Node_List worklist;
4074 
4075       Node *mem = n-&gt;in(MemNode::Memory);
4076       for (DUIterator_Fast imax, i = mem-&gt;fast_outs(imax); i &lt; imax; i++) {
4077         Node* s = mem-&gt;fast_out(i);
4078         worklist.push(s);
4079       }
4080       while(worklist.size() != 0 &amp;&amp; LCA != early) {
4081         Node* s = worklist.pop();
4082         if (s-&gt;is_Load() || s-&gt;Opcode() == Op_SafePoint ||
4083             (s-&gt;is_CallStaticJava() &amp;&amp; s-&gt;as_CallStaticJava()-&gt;uncommon_trap_request() != 0)) {
4084           continue;
4085         } else if (s-&gt;is_MergeMem()) {
4086           for (DUIterator_Fast imax, i = s-&gt;fast_outs(imax); i &lt; imax; i++) {
4087             Node* s1 = s-&gt;fast_out(i);
4088             worklist.push(s1);
4089           }
4090         } else {
4091           Node *sctrl = has_ctrl(s) ? get_ctrl(s) : s-&gt;in(0);
<span class="line-modified">4092           assert(sctrl != NULL || !s-&gt;is_reachable_from_root(), &quot;must have control&quot;);</span>
4093           if (sctrl != NULL &amp;&amp; !sctrl-&gt;is_top() &amp;&amp; C-&gt;can_alias(s-&gt;adr_type(), load_alias_idx) &amp;&amp; is_dominator(early, sctrl)) {
4094             LCA = dom_lca_for_get_late_ctrl(LCA, sctrl, n);
4095           }
4096         }
4097       }
4098     }
4099   }
4100 
4101   assert(LCA == find_non_split_ctrl(LCA), &quot;unexpected late control&quot;);
4102   return LCA;
4103 }
4104 
4105 // true if CFG node d dominates CFG node n
4106 bool PhaseIdealLoop::is_dominator(Node *d, Node *n) {
4107   if (d == n)
4108     return true;
4109   assert(d-&gt;is_CFG() &amp;&amp; n-&gt;is_CFG(), &quot;must have CFG nodes&quot;);
4110   uint dd = dom_depth(d);
4111   while (dom_depth(n) &gt;= dd) {
4112     if (n == d)
</pre>
</td>
</tr>
</table>
<center><a href="library_call.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="loopopts.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>