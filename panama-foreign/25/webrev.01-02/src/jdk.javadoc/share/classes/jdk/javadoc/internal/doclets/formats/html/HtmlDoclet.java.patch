diff a/src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/HtmlDoclet.java b/src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/HtmlDoclet.java
--- a/src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/HtmlDoclet.java
+++ b/src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/HtmlDoclet.java
@@ -148,11 +148,10 @@
         }
         // do early to reduce memory footprint
         if (options.classUse()) {
             ClassUseWriter.generate(configuration, classtree);
         }
-        IndexBuilder indexbuilder = new IndexBuilder(configuration, nodeprecated);
 
         if (options.createTree()) {
             TreeWriter.generate(configuration, classtree);
         }
 
@@ -167,15 +166,16 @@
                 PackageIndexWriter.generate(configuration);
             }
         }
 
         if (options.createIndex()) {
+            IndexBuilder indexBuilder = new IndexBuilder(configuration, nodeprecated);
             configuration.buildSearchTagIndex();
             if (options.splitIndex()) {
-                SplitIndexWriter.generate(configuration, indexbuilder);
+                SplitIndexWriter.generate(configuration, indexBuilder);
             } else {
-                SingleIndexWriter.generate(configuration, indexbuilder);
+                SingleIndexWriter.generate(configuration, indexBuilder);
             }
             AllClassesIndexWriter.generate(configuration,
                     new IndexBuilder(configuration, nodeprecated, true));
             if (!configuration.packages.isEmpty()) {
                 AllPackagesIndexWriter.generate(configuration);
