<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.core.common/src/org/graalvm/compiler/core/common/Fields.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../org.graalvm.compiler.core.amd64/src/org/graalvm/compiler/core/amd64/AMD64SuitesCreator.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="GraalOptions.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.core.common/src/org/graalvm/compiler/core/common/Fields.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -25,10 +25,11 @@</span>
  package org.graalvm.compiler.core.common;
  
  import static org.graalvm.compiler.serviceprovider.GraalUnsafeAccess.getUnsafe;
  
  import java.util.ArrayList;
<span class="udiff-line-added">+ import java.util.Arrays;</span>
  import java.util.Collections;
  
  import org.graalvm.compiler.debug.GraalError;
  
  import sun.misc.Unsafe;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -144,15 +145,46 @@</span>
                  } else {
                      assert false : &quot;unhandled property type: &quot; + type;
                  }
              } else {
                  Object obj = UNSAFE.getObject(from, offset);
<span class="udiff-line-added">+                 if (obj != null &amp;&amp; type.isArray()) {</span>
<span class="udiff-line-added">+                     if (type.getComponentType().isPrimitive()) {</span>
<span class="udiff-line-added">+                         obj = copyObjectAsArray(obj);</span>
<span class="udiff-line-added">+                     } else {</span>
<span class="udiff-line-added">+                         obj = ((Object[]) obj).clone();</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                 }</span>
                  UNSAFE.putObject(to, offset, trans == null ? obj : trans.apply(index, obj));
              }
          }
      }
  
<span class="udiff-line-added">+     private static Object copyObjectAsArray(Object obj) {</span>
<span class="udiff-line-added">+         Object objCopy;</span>
<span class="udiff-line-added">+         if (obj instanceof int[]) {</span>
<span class="udiff-line-added">+             objCopy = Arrays.copyOf((int[]) obj, ((int[]) obj).length);</span>
<span class="udiff-line-added">+         } else if (obj instanceof short[]) {</span>
<span class="udiff-line-added">+             objCopy = Arrays.copyOf((short[]) obj, ((short[]) obj).length);</span>
<span class="udiff-line-added">+         } else if (obj instanceof long[]) {</span>
<span class="udiff-line-added">+             objCopy = Arrays.copyOf((long[]) obj, ((long[]) obj).length);</span>
<span class="udiff-line-added">+         } else if (obj instanceof float[]) {</span>
<span class="udiff-line-added">+             objCopy = Arrays.copyOf((float[]) obj, ((float[]) obj).length);</span>
<span class="udiff-line-added">+         } else if (obj instanceof double[]) {</span>
<span class="udiff-line-added">+             objCopy = Arrays.copyOf((double[]) obj, ((double[]) obj).length);</span>
<span class="udiff-line-added">+         } else if (obj instanceof boolean[]) {</span>
<span class="udiff-line-added">+             objCopy = Arrays.copyOf((boolean[]) obj, ((boolean[]) obj).length);</span>
<span class="udiff-line-added">+         } else if (obj instanceof byte[]) {</span>
<span class="udiff-line-added">+             objCopy = Arrays.copyOf((byte[]) obj, ((byte[]) obj).length);</span>
<span class="udiff-line-added">+         } else if (obj instanceof char[]) {</span>
<span class="udiff-line-added">+             objCopy = Arrays.copyOf((char[]) obj, ((char[]) obj).length);</span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+             throw GraalError.shouldNotReachHere();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         return objCopy;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      /**
       * Gets the value of a field for a given object.
       *
       * @param object the object whose field is to be read
       * @param index the index of the field (between 0 and {@link #getCount()})
</pre>
<center><a href="../../../../../../../org.graalvm.compiler.core.amd64/src/org/graalvm/compiler/core/amd64/AMD64SuitesCreator.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="GraalOptions.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>