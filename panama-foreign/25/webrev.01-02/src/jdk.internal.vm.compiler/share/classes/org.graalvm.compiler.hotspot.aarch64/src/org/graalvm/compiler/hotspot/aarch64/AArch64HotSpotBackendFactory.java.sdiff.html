<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.hotspot.aarch64/src/org/graalvm/compiler/hotspot/aarch64/AArch64HotSpotBackendFactory.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AArch64HotSpotBackend.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="AArch64HotSpotDeoptimizeCallerOp.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.hotspot.aarch64/src/org/graalvm/compiler/hotspot/aarch64/AArch64HotSpotBackendFactory.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 27 
 28 import static jdk.vm.ci.aarch64.AArch64.sp;
 29 import static jdk.vm.ci.common.InitTimer.timer;
 30 
 31 import java.util.ArrayList;
 32 import java.util.Arrays;
 33 import java.util.List;
 34 
 35 import org.graalvm.compiler.bytecode.BytecodeProvider;
 36 import org.graalvm.compiler.core.aarch64.AArch64AddressLoweringByUse;
 37 import org.graalvm.compiler.core.aarch64.AArch64LIRKindTool;
 38 import org.graalvm.compiler.core.aarch64.AArch64SuitesCreator;
 39 import org.graalvm.compiler.hotspot.GraalHotSpotVMConfig;
 40 import org.graalvm.compiler.hotspot.HotSpotBackend;
 41 import org.graalvm.compiler.hotspot.HotSpotBackendFactory;
 42 import org.graalvm.compiler.hotspot.HotSpotGraalRuntimeProvider;
 43 import org.graalvm.compiler.hotspot.HotSpotReplacementsImpl;
 44 import org.graalvm.compiler.hotspot.meta.AddressLoweringHotSpotSuitesProvider;
 45 import org.graalvm.compiler.hotspot.meta.HotSpotConstantFieldProvider;
 46 import org.graalvm.compiler.hotspot.meta.HotSpotForeignCallsProvider;
<span class="line-modified"> 47 import org.graalvm.compiler.hotspot.meta.HotSpotGCProvider;</span>
 48 import org.graalvm.compiler.hotspot.meta.HotSpotGraalConstantFieldProvider;
 49 import org.graalvm.compiler.hotspot.meta.HotSpotGraphBuilderPlugins;
 50 import org.graalvm.compiler.hotspot.meta.HotSpotHostForeignCallsProvider;
 51 import org.graalvm.compiler.hotspot.meta.HotSpotLoweringProvider;
 52 import org.graalvm.compiler.hotspot.meta.HotSpotProviders;
 53 import org.graalvm.compiler.hotspot.meta.HotSpotRegisters;
 54 import org.graalvm.compiler.hotspot.meta.HotSpotRegistersProvider;
 55 import org.graalvm.compiler.hotspot.meta.HotSpotSnippetReflectionProvider;
 56 import org.graalvm.compiler.hotspot.meta.HotSpotStampProvider;
 57 import org.graalvm.compiler.hotspot.meta.HotSpotSuitesProvider;
 58 import org.graalvm.compiler.hotspot.word.HotSpotWordTypes;
 59 import org.graalvm.compiler.nodes.graphbuilderconf.GraphBuilderConfiguration.Plugins;
 60 import org.graalvm.compiler.nodes.spi.Replacements;
 61 import org.graalvm.compiler.options.OptionValues;
 62 import org.graalvm.compiler.phases.Phase;
 63 import org.graalvm.compiler.phases.common.AddressLoweringByUsePhase;
 64 import org.graalvm.compiler.phases.schedule.SchedulePhase;
 65 import org.graalvm.compiler.phases.tiers.CompilerConfiguration;
 66 import org.graalvm.compiler.phases.util.Providers;
 67 import org.graalvm.compiler.replacements.aarch64.AArch64GraphBuilderPlugins;
</pre>
<hr />
<pre>
 97 
 98     @Override
 99     @SuppressWarnings(&quot;try&quot;)
100     public HotSpotBackend createBackend(HotSpotGraalRuntimeProvider graalRuntime, CompilerConfiguration compilerConfiguration, HotSpotJVMCIRuntime jvmciRuntime, HotSpotBackend host) {
101         assert host == null;
102 
103         OptionValues options = graalRuntime.getOptions();
104         JVMCIBackend jvmci = jvmciRuntime.getHostJVMCIBackend();
105         GraalHotSpotVMConfig config = graalRuntime.getVMConfig();
106         HotSpotProviders providers;
107         HotSpotRegistersProvider registers;
108         HotSpotCodeCacheProvider codeCache = (HotSpotCodeCacheProvider) jvmci.getCodeCache();
109         TargetDescription target = codeCache.getTarget();
110         HotSpotHostForeignCallsProvider foreignCalls;
111         Value[] nativeABICallerSaveRegisters;
112         HotSpotMetaAccessProvider metaAccess = (HotSpotMetaAccessProvider) jvmci.getMetaAccess();
113         HotSpotConstantReflectionProvider constantReflection = (HotSpotConstantReflectionProvider) jvmci.getConstantReflection();
114         HotSpotConstantFieldProvider constantFieldProvider = new HotSpotGraalConstantFieldProvider(config, metaAccess);
115         HotSpotLoweringProvider lowerer;
116         HotSpotStampProvider stampProvider;
<span class="line-modified">117         HotSpotGCProvider gc;</span>
118         HotSpotSnippetReflectionProvider snippetReflection;
119         HotSpotReplacementsImpl replacements;
120         HotSpotSuitesProvider suites;
121         HotSpotWordTypes wordTypes;
122         Plugins plugins;
123         BytecodeProvider bytecodeProvider;
124         try (InitTimer t = timer(&quot;create providers&quot;)) {
125             try (InitTimer rt = timer(&quot;create HotSpotRegisters provider&quot;)) {
126                 registers = createRegisters();
127             }
128             try (InitTimer rt = timer(&quot;create NativeABICallerSaveRegisters&quot;)) {
129                 nativeABICallerSaveRegisters = createNativeABICallerSaveRegisters(config, codeCache.getRegisterConfig());
130             }
131             try (InitTimer rt = timer(&quot;create WordTypes&quot;)) {
132                 wordTypes = createWordTypes(metaAccess, target);
133             }
134             try (InitTimer rt = timer(&quot;create ForeignCalls provider&quot;)) {
135                 foreignCalls = createForeignCalls(jvmciRuntime, graalRuntime, metaAccess, codeCache, wordTypes, nativeABICallerSaveRegisters);
136             }
137             try (InitTimer rt = timer(&quot;create Lowerer provider&quot;)) {
138                 lowerer = createLowerer(graalRuntime, metaAccess, foreignCalls, registers, constantReflection, target);
139             }
140             try (InitTimer rt = timer(&quot;create stamp provider&quot;)) {
141                 stampProvider = createStampProvider();
142             }
143             try (InitTimer rt = timer(&quot;create GC provider&quot;)) {
<span class="line-modified">144                 gc = createGCProvider(config, metaAccess);</span>
145             }
146 
<span class="line-modified">147             Providers p = new Providers(metaAccess, codeCache, constantReflection, constantFieldProvider, foreignCalls, lowerer, null, stampProvider, gc);</span>
148 
149             try (InitTimer rt = timer(&quot;create SnippetReflection provider&quot;)) {
150                 snippetReflection = createSnippetReflection(graalRuntime, constantReflection, wordTypes);
151             }
152             try (InitTimer rt = timer(&quot;create Bytecode provider&quot;)) {
153                 bytecodeProvider = createBytecodeProvider(metaAccess, snippetReflection);
154             }
155             try (InitTimer rt = timer(&quot;create Replacements provider&quot;)) {
156                 replacements = createReplacements(target, p, snippetReflection, bytecodeProvider);
157             }
158             try (InitTimer rt = timer(&quot;create GraphBuilderPhase plugins&quot;)) {
159                 plugins = createGraphBuilderPlugins(graalRuntime, compilerConfiguration, config, constantReflection, foreignCalls, metaAccess, snippetReflection, replacements, wordTypes,
160                                 graalRuntime.getOptions(), target);
161                 replacements.setGraphBuilderPlugins(plugins);
162             }
163             try (InitTimer rt = timer(&quot;create Suites provider&quot;)) {
164                 suites = createSuites(config, graalRuntime, compilerConfiguration, plugins, replacements);
165             }
166             providers = new HotSpotProviders(metaAccess, codeCache, constantReflection, constantFieldProvider, foreignCalls, lowerer, replacements, suites, registers,
<span class="line-modified">167                             snippetReflection, wordTypes, plugins, gc);</span>
168             replacements.setProviders(providers);
169             replacements.maybeInitializeEncoder(options);
170         }
171         try (InitTimer rt = timer(&quot;instantiate backend&quot;)) {
172             return createBackend(config, graalRuntime, providers);
173         }
174     }
175 
176     protected Plugins createGraphBuilderPlugins(HotSpotGraalRuntimeProvider graalRuntime,
177                     CompilerConfiguration compilerConfiguration,
178                     GraalHotSpotVMConfig config,
179                     HotSpotConstantReflectionProvider constantReflection,
180                     HotSpotHostForeignCallsProvider foreignCalls,
181                     HotSpotMetaAccessProvider metaAccess,
182                     HotSpotSnippetReflectionProvider snippetReflection,
183                     HotSpotReplacementsImpl replacements,
184                     HotSpotWordTypes wordTypes,
185                     OptionValues options,
186                     TargetDescription target) {
187         Plugins plugins = HotSpotGraphBuilderPlugins.create(graalRuntime,
</pre>
</td>
<td>
<hr />
<pre>
 27 
 28 import static jdk.vm.ci.aarch64.AArch64.sp;
 29 import static jdk.vm.ci.common.InitTimer.timer;
 30 
 31 import java.util.ArrayList;
 32 import java.util.Arrays;
 33 import java.util.List;
 34 
 35 import org.graalvm.compiler.bytecode.BytecodeProvider;
 36 import org.graalvm.compiler.core.aarch64.AArch64AddressLoweringByUse;
 37 import org.graalvm.compiler.core.aarch64.AArch64LIRKindTool;
 38 import org.graalvm.compiler.core.aarch64.AArch64SuitesCreator;
 39 import org.graalvm.compiler.hotspot.GraalHotSpotVMConfig;
 40 import org.graalvm.compiler.hotspot.HotSpotBackend;
 41 import org.graalvm.compiler.hotspot.HotSpotBackendFactory;
 42 import org.graalvm.compiler.hotspot.HotSpotGraalRuntimeProvider;
 43 import org.graalvm.compiler.hotspot.HotSpotReplacementsImpl;
 44 import org.graalvm.compiler.hotspot.meta.AddressLoweringHotSpotSuitesProvider;
 45 import org.graalvm.compiler.hotspot.meta.HotSpotConstantFieldProvider;
 46 import org.graalvm.compiler.hotspot.meta.HotSpotForeignCallsProvider;
<span class="line-modified"> 47 import org.graalvm.compiler.hotspot.meta.HotSpotPlatformConfigurationProvider;</span>
 48 import org.graalvm.compiler.hotspot.meta.HotSpotGraalConstantFieldProvider;
 49 import org.graalvm.compiler.hotspot.meta.HotSpotGraphBuilderPlugins;
 50 import org.graalvm.compiler.hotspot.meta.HotSpotHostForeignCallsProvider;
 51 import org.graalvm.compiler.hotspot.meta.HotSpotLoweringProvider;
 52 import org.graalvm.compiler.hotspot.meta.HotSpotProviders;
 53 import org.graalvm.compiler.hotspot.meta.HotSpotRegisters;
 54 import org.graalvm.compiler.hotspot.meta.HotSpotRegistersProvider;
 55 import org.graalvm.compiler.hotspot.meta.HotSpotSnippetReflectionProvider;
 56 import org.graalvm.compiler.hotspot.meta.HotSpotStampProvider;
 57 import org.graalvm.compiler.hotspot.meta.HotSpotSuitesProvider;
 58 import org.graalvm.compiler.hotspot.word.HotSpotWordTypes;
 59 import org.graalvm.compiler.nodes.graphbuilderconf.GraphBuilderConfiguration.Plugins;
 60 import org.graalvm.compiler.nodes.spi.Replacements;
 61 import org.graalvm.compiler.options.OptionValues;
 62 import org.graalvm.compiler.phases.Phase;
 63 import org.graalvm.compiler.phases.common.AddressLoweringByUsePhase;
 64 import org.graalvm.compiler.phases.schedule.SchedulePhase;
 65 import org.graalvm.compiler.phases.tiers.CompilerConfiguration;
 66 import org.graalvm.compiler.phases.util.Providers;
 67 import org.graalvm.compiler.replacements.aarch64.AArch64GraphBuilderPlugins;
</pre>
<hr />
<pre>
 97 
 98     @Override
 99     @SuppressWarnings(&quot;try&quot;)
100     public HotSpotBackend createBackend(HotSpotGraalRuntimeProvider graalRuntime, CompilerConfiguration compilerConfiguration, HotSpotJVMCIRuntime jvmciRuntime, HotSpotBackend host) {
101         assert host == null;
102 
103         OptionValues options = graalRuntime.getOptions();
104         JVMCIBackend jvmci = jvmciRuntime.getHostJVMCIBackend();
105         GraalHotSpotVMConfig config = graalRuntime.getVMConfig();
106         HotSpotProviders providers;
107         HotSpotRegistersProvider registers;
108         HotSpotCodeCacheProvider codeCache = (HotSpotCodeCacheProvider) jvmci.getCodeCache();
109         TargetDescription target = codeCache.getTarget();
110         HotSpotHostForeignCallsProvider foreignCalls;
111         Value[] nativeABICallerSaveRegisters;
112         HotSpotMetaAccessProvider metaAccess = (HotSpotMetaAccessProvider) jvmci.getMetaAccess();
113         HotSpotConstantReflectionProvider constantReflection = (HotSpotConstantReflectionProvider) jvmci.getConstantReflection();
114         HotSpotConstantFieldProvider constantFieldProvider = new HotSpotGraalConstantFieldProvider(config, metaAccess);
115         HotSpotLoweringProvider lowerer;
116         HotSpotStampProvider stampProvider;
<span class="line-modified">117         HotSpotPlatformConfigurationProvider platformConfigurationProvider;</span>
118         HotSpotSnippetReflectionProvider snippetReflection;
119         HotSpotReplacementsImpl replacements;
120         HotSpotSuitesProvider suites;
121         HotSpotWordTypes wordTypes;
122         Plugins plugins;
123         BytecodeProvider bytecodeProvider;
124         try (InitTimer t = timer(&quot;create providers&quot;)) {
125             try (InitTimer rt = timer(&quot;create HotSpotRegisters provider&quot;)) {
126                 registers = createRegisters();
127             }
128             try (InitTimer rt = timer(&quot;create NativeABICallerSaveRegisters&quot;)) {
129                 nativeABICallerSaveRegisters = createNativeABICallerSaveRegisters(config, codeCache.getRegisterConfig());
130             }
131             try (InitTimer rt = timer(&quot;create WordTypes&quot;)) {
132                 wordTypes = createWordTypes(metaAccess, target);
133             }
134             try (InitTimer rt = timer(&quot;create ForeignCalls provider&quot;)) {
135                 foreignCalls = createForeignCalls(jvmciRuntime, graalRuntime, metaAccess, codeCache, wordTypes, nativeABICallerSaveRegisters);
136             }
137             try (InitTimer rt = timer(&quot;create Lowerer provider&quot;)) {
138                 lowerer = createLowerer(graalRuntime, metaAccess, foreignCalls, registers, constantReflection, target);
139             }
140             try (InitTimer rt = timer(&quot;create stamp provider&quot;)) {
141                 stampProvider = createStampProvider();
142             }
143             try (InitTimer rt = timer(&quot;create GC provider&quot;)) {
<span class="line-modified">144                 platformConfigurationProvider = createConfigInfoProvider(config, metaAccess);</span>
145             }
146 
<span class="line-modified">147             Providers p = new Providers(metaAccess, codeCache, constantReflection, constantFieldProvider, foreignCalls, lowerer, null, stampProvider, platformConfigurationProvider);</span>
148 
149             try (InitTimer rt = timer(&quot;create SnippetReflection provider&quot;)) {
150                 snippetReflection = createSnippetReflection(graalRuntime, constantReflection, wordTypes);
151             }
152             try (InitTimer rt = timer(&quot;create Bytecode provider&quot;)) {
153                 bytecodeProvider = createBytecodeProvider(metaAccess, snippetReflection);
154             }
155             try (InitTimer rt = timer(&quot;create Replacements provider&quot;)) {
156                 replacements = createReplacements(target, p, snippetReflection, bytecodeProvider);
157             }
158             try (InitTimer rt = timer(&quot;create GraphBuilderPhase plugins&quot;)) {
159                 plugins = createGraphBuilderPlugins(graalRuntime, compilerConfiguration, config, constantReflection, foreignCalls, metaAccess, snippetReflection, replacements, wordTypes,
160                                 graalRuntime.getOptions(), target);
161                 replacements.setGraphBuilderPlugins(plugins);
162             }
163             try (InitTimer rt = timer(&quot;create Suites provider&quot;)) {
164                 suites = createSuites(config, graalRuntime, compilerConfiguration, plugins, replacements);
165             }
166             providers = new HotSpotProviders(metaAccess, codeCache, constantReflection, constantFieldProvider, foreignCalls, lowerer, replacements, suites, registers,
<span class="line-modified">167                             snippetReflection, wordTypes, plugins, platformConfigurationProvider);</span>
168             replacements.setProviders(providers);
169             replacements.maybeInitializeEncoder(options);
170         }
171         try (InitTimer rt = timer(&quot;instantiate backend&quot;)) {
172             return createBackend(config, graalRuntime, providers);
173         }
174     }
175 
176     protected Plugins createGraphBuilderPlugins(HotSpotGraalRuntimeProvider graalRuntime,
177                     CompilerConfiguration compilerConfiguration,
178                     GraalHotSpotVMConfig config,
179                     HotSpotConstantReflectionProvider constantReflection,
180                     HotSpotHostForeignCallsProvider foreignCalls,
181                     HotSpotMetaAccessProvider metaAccess,
182                     HotSpotSnippetReflectionProvider snippetReflection,
183                     HotSpotReplacementsImpl replacements,
184                     HotSpotWordTypes wordTypes,
185                     OptionValues options,
186                     TargetDescription target) {
187         Plugins plugins = HotSpotGraphBuilderPlugins.create(graalRuntime,
</pre>
</td>
</tr>
</table>
<center><a href="AArch64HotSpotBackend.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="AArch64HotSpotDeoptimizeCallerOp.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>