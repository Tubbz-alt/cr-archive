<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.incubator.jextract/share/classes/jdk/incubator/jextract/tool/JavaSourceBuilder.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../internal/jextract/impl/LayoutUtils.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.incubator.jextract/share/classes/jdk/incubator/jextract/tool/JavaSourceBuilder.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 package jdk.incubator.jextract.tool;
 26 
 27 import jdk.incubator.jextract.Declaration;
 28 import jdk.incubator.foreign.FunctionDescriptor;
 29 import jdk.incubator.foreign.GroupLayout;
 30 import jdk.incubator.foreign.MemoryAddress;
 31 import jdk.incubator.foreign.MemoryLayout;
 32 import jdk.incubator.foreign.MemoryLayouts;
<span class="line-removed"> 33 import jdk.incubator.foreign.MemoryLayouts.SysV;</span>
 34 import jdk.incubator.foreign.MemorySegment;
 35 import jdk.incubator.foreign.SequenceLayout;
 36 import jdk.incubator.foreign.SystemABI;
 37 import jdk.incubator.foreign.ValueLayout;
 38 
 39 import java.lang.invoke.MethodType;
 40 import java.lang.reflect.Field;
 41 import java.util.ArrayList;
 42 import java.util.List;
 43 import java.util.stream.Collectors;
 44 import java.util.stream.IntStream;
 45 import java.util.stream.Stream;
 46 
 47 /**
 48  * A helper class to generate header interface class in source form.
 49  * After aggregating various constituents of a .java source, build
 50  * method is called to get overall generated source string.
 51  */
 52 class JavaSourceBuilder {
 53     private static final String ABI = SystemABI.getInstance().name();
</pre>
<hr />
<pre>
144                 case LONG -&gt; &quot;C_LONG&quot;;
145                 case UNSIGNED_LONG -&gt; &quot;C_ULONG&quot;;
146                 case LONG_LONG -&gt; &quot;C_LONGLONG&quot;;
147                 case UNSIGNED_LONG_LONG -&gt; &quot;C_ULONGLONG&quot;;
148                 case FLOAT -&gt; &quot;C_FLOAT&quot;;
149                 case DOUBLE -&gt; &quot;C_DOUBLE&quot;;
150                 case LONG_DOUBLE -&gt; &quot;C_LONGDOUBLE&quot;;
151                 case POINTER -&gt; &quot;C_POINTER&quot;;
152                 default -&gt; { throw new RuntimeException(&quot;should not reach here: &quot; + type); }
153             });
154         } else if (l instanceof SequenceLayout) {
155             sb.append(&quot;MemoryLayout.ofSequence(&quot;);
156             if (((SequenceLayout) l).elementCount().isPresent()) {
157                 sb.append(((SequenceLayout) l).elementCount().getAsLong() + &quot;, &quot;);
158             }
159             addLayout(((SequenceLayout) l).elementLayout());
160             sb.append(&quot;)&quot;);
161         } else if (l instanceof GroupLayout) {
162             SystemABI.Type type = l.abiType().orElse(null);
163             if (type == SystemABI.Type.COMPLEX_LONG_DOUBLE) {
<span class="line-modified">164                 if (ABI != SystemABI.ABI_SYSV) {</span>
165                     throw new RuntimeException(&quot;complex long double is supported only for SysV ABI&quot;);
166                 } else {
167                     sb.append(&quot;C_COMPLEX_LONGDOUBLE&quot;);
168                 }
169             } else {
170                 if (((GroupLayout) l).isStruct()) {
171                     sb.append(&quot;MemoryLayout.ofStruct(\n&quot;);
172                 } else {
173                     sb.append(&quot;MemoryLayout.ofUnion(\n&quot;);
174                 }
175                 incrAlign();
176                 String delim = &quot;&quot;;
177                 for (MemoryLayout e : ((GroupLayout) l).memberLayouts()) {
178                     sb.append(delim);
179                     indent();
180                     addLayout(e);
181                     delim = &quot;,\n&quot;;
182                 }
183                 sb.append(&quot;\n&quot;);
184                 decrAlign();
</pre>
</td>
<td>
<hr />
<pre>
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 package jdk.incubator.jextract.tool;
 26 
 27 import jdk.incubator.jextract.Declaration;
 28 import jdk.incubator.foreign.FunctionDescriptor;
 29 import jdk.incubator.foreign.GroupLayout;
 30 import jdk.incubator.foreign.MemoryAddress;
 31 import jdk.incubator.foreign.MemoryLayout;
 32 import jdk.incubator.foreign.MemoryLayouts;

 33 import jdk.incubator.foreign.MemorySegment;
 34 import jdk.incubator.foreign.SequenceLayout;
 35 import jdk.incubator.foreign.SystemABI;
 36 import jdk.incubator.foreign.ValueLayout;
 37 
 38 import java.lang.invoke.MethodType;
 39 import java.lang.reflect.Field;
 40 import java.util.ArrayList;
 41 import java.util.List;
 42 import java.util.stream.Collectors;
 43 import java.util.stream.IntStream;
 44 import java.util.stream.Stream;
 45 
 46 /**
 47  * A helper class to generate header interface class in source form.
 48  * After aggregating various constituents of a .java source, build
 49  * method is called to get overall generated source string.
 50  */
 51 class JavaSourceBuilder {
 52     private static final String ABI = SystemABI.getInstance().name();
</pre>
<hr />
<pre>
143                 case LONG -&gt; &quot;C_LONG&quot;;
144                 case UNSIGNED_LONG -&gt; &quot;C_ULONG&quot;;
145                 case LONG_LONG -&gt; &quot;C_LONGLONG&quot;;
146                 case UNSIGNED_LONG_LONG -&gt; &quot;C_ULONGLONG&quot;;
147                 case FLOAT -&gt; &quot;C_FLOAT&quot;;
148                 case DOUBLE -&gt; &quot;C_DOUBLE&quot;;
149                 case LONG_DOUBLE -&gt; &quot;C_LONGDOUBLE&quot;;
150                 case POINTER -&gt; &quot;C_POINTER&quot;;
151                 default -&gt; { throw new RuntimeException(&quot;should not reach here: &quot; + type); }
152             });
153         } else if (l instanceof SequenceLayout) {
154             sb.append(&quot;MemoryLayout.ofSequence(&quot;);
155             if (((SequenceLayout) l).elementCount().isPresent()) {
156                 sb.append(((SequenceLayout) l).elementCount().getAsLong() + &quot;, &quot;);
157             }
158             addLayout(((SequenceLayout) l).elementLayout());
159             sb.append(&quot;)&quot;);
160         } else if (l instanceof GroupLayout) {
161             SystemABI.Type type = l.abiType().orElse(null);
162             if (type == SystemABI.Type.COMPLEX_LONG_DOUBLE) {
<span class="line-modified">163                 if (!ABI.equals(SystemABI.ABI_SYSV)) {</span>
164                     throw new RuntimeException(&quot;complex long double is supported only for SysV ABI&quot;);
165                 } else {
166                     sb.append(&quot;C_COMPLEX_LONGDOUBLE&quot;);
167                 }
168             } else {
169                 if (((GroupLayout) l).isStruct()) {
170                     sb.append(&quot;MemoryLayout.ofStruct(\n&quot;);
171                 } else {
172                     sb.append(&quot;MemoryLayout.ofUnion(\n&quot;);
173                 }
174                 incrAlign();
175                 String delim = &quot;&quot;;
176                 for (MemoryLayout e : ((GroupLayout) l).memberLayouts()) {
177                     sb.append(delim);
178                     indent();
179                     addLayout(e);
180                     delim = &quot;,\n&quot;;
181                 }
182                 sb.append(&quot;\n&quot;);
183                 decrAlign();
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../internal/jextract/impl/LayoutUtils.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>