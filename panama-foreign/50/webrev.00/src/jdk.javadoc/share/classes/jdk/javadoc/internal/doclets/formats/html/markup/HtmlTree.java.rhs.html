<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/markup/HtmlTree.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2010, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.javadoc.internal.doclets.formats.html.markup;
 27 
 28 import java.io.IOException;
 29 import java.io.Writer;
<a name="1" id="anc1"></a><span class="line-modified"> 30 import java.nio.charset.StandardCharsets;</span>
 31 import java.util.ArrayList;
 32 import java.util.BitSet;
<a name="2" id="anc2"></a>
 33 import java.util.Iterator;
 34 import java.util.LinkedHashMap;
 35 import java.util.List;
 36 import java.util.Map;
<a name="3" id="anc3"></a><span class="line-added"> 37 import java.util.Objects;</span>
 38 
 39 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlAttr.Role;
 40 import jdk.javadoc.internal.doclets.toolkit.Content;
 41 import jdk.javadoc.internal.doclets.toolkit.util.DocletConstants;
 42 
 43 /**
<a name="4" id="anc4"></a><span class="line-modified"> 44  * A tree node representing an HTML element, containing the name of the element,</span>
<span class="line-added"> 45  * a collection of attributes, and content.</span>
<span class="line-added"> 46  *</span>
<span class="line-added"> 47  * Except where otherwise stated, all methods in this class will throw</span>
<span class="line-added"> 48  * {@code NullPointerException} for any arguments that are {@code null}</span>
<span class="line-added"> 49  * or that are arrays or collections that contain {@code null}.</span>
<span class="line-added"> 50  *</span>
<span class="line-added"> 51  * Many methods in this class return {@code this}, to enable a series</span>
<span class="line-added"> 52  * of chained method calls on a single object.</span>
<span class="line-added"> 53  *</span>
<span class="line-added"> 54  * Terminology: An HTML element is typically composed of a start tag, some</span>
<span class="line-added"> 55  * enclosed content and typically an end tag. The start tag contains any</span>
<span class="line-added"> 56  * attributes for the element. See:</span>
<span class="line-added"> 57  * &lt;a href=&quot;https://en.wikipedia.org/wiki/HTML_element&quot;&gt;HTML element&lt;/a&gt;.</span>
 58  *
 59  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
 60  *  If you write code that depends on this, you do so at your own risk.
 61  *  This code and its internal interfaces are subject to change or
 62  *  deletion without notice.&lt;/b&gt;
 63  */
 64 public class HtmlTree extends Content {
 65 
<a name="5" id="anc5"></a><span class="line-added"> 66     /**</span>
<span class="line-added"> 67      * The kind of tag for the HTML element.</span>
<span class="line-added"> 68      * This value is never {@code null}.</span>
<span class="line-added"> 69      */</span>
 70     public final HtmlTag htmlTag;
<a name="6" id="anc6"></a>


 71 
 72     /**
<a name="7" id="anc7"></a><span class="line-modified"> 73      * The attributes for the HTML element.</span>
<span class="line-modified"> 74      * The keys and values in this map are never {@code null}.</span>

 75      */
<a name="8" id="anc8"></a><span class="line-modified"> 76     private Map&lt;HtmlAttr, String&gt; attrs = Map.of();</span>


 77 
 78     /**
<a name="9" id="anc9"></a><span class="line-modified"> 79      * The enclosed content (&quot;inner HTML&quot;) for this HTML element.</span>
<span class="line-modified"> 80      * The items in this list are never null.</span>


 81      */
<a name="10" id="anc10"></a><span class="line-modified"> 82     private List&lt;Content&gt; content = List.of();</span>




 83 
 84     /**
<a name="11" id="anc11"></a><span class="line-modified"> 85      * A sentinel value to explicitly indicate empty content.</span>
<span class="line-added"> 86      */</span>
<span class="line-added"> 87     public static final Content EMPTY = new StringContent(&quot;&quot;);</span>
<span class="line-added"> 88 </span>
<span class="line-added"> 89     /**</span>
<span class="line-added"> 90      * Creates an {@code HTMLTree} object with a given kind of tag.</span>
 91      *
<a name="12" id="anc12"></a><span class="line-modified"> 92      * @param tag the kind of tag</span>

 93      */
<a name="13" id="anc13"></a><span class="line-modified"> 94     public HtmlTree(HtmlTag tag) {</span>
<span class="line-modified"> 95         htmlTag = Objects.requireNonNull(tag);</span>


 96     }
 97 
 98     /**
<a name="14" id="anc14"></a><span class="line-modified"> 99      * Adds an attribute.</span>
100      *
<a name="15" id="anc15"></a><span class="line-modified">101      * @param attrName  the name of the attribute</span>
<span class="line-modified">102      * @param attrValue the value of the attribute</span>
103      * @return this object
104      */
105     public HtmlTree put(HtmlAttr attrName, String attrValue) {
106         if (attrs.isEmpty())
107             attrs = new LinkedHashMap&lt;&gt;(3);
<a name="16" id="anc16"></a><span class="line-modified">108         attrs.put(Objects.requireNonNull(attrName), Entity.escapeHtmlChars(attrValue));</span>
109         return this;
110     }
111 
112     /**
<a name="17" id="anc17"></a><span class="line-modified">113      * Sets the {@code id} attribute.</span>
114      *
<a name="18" id="anc18"></a><span class="line-modified">115      * @param id the value for the attribute</span>
116      * @return this object
117      */
118     public HtmlTree setId(String id) {
<a name="19" id="anc19"></a><span class="line-modified">119         return put(HtmlAttr.ID, id);</span>

120     }
121 
122     /**
<a name="20" id="anc20"></a><span class="line-modified">123      * Sets the {@code title} attribute.</span>
<span class="line-modified">124      * Any nested start or end tags in the content will be removed.</span>
125      *
126      * @param body the content for the title attribute
127      * @return this object
128      */
129     public HtmlTree setTitle(Content body) {
<a name="21" id="anc21"></a><span class="line-modified">130         return put(HtmlAttr.TITLE, stripHtml(body));</span>

131     }
132 
133     /**
<a name="22" id="anc22"></a><span class="line-modified">134      * Sets the {@code role} attribute.</span>
135      *
136      * @param role the role
137      * @return this object
138      */
139     public HtmlTree setRole(Role role) {
<a name="23" id="anc23"></a><span class="line-modified">140         return put(HtmlAttr.ROLE, role.toString());</span>

141     }
142 
143     /**
<a name="24" id="anc24"></a><span class="line-modified">144      * Sets the {@code class} attribute.</span>
145      *
<a name="25" id="anc25"></a><span class="line-modified">146      * @param style the value for the attribute</span>
147      * @return this object
148      */
149     public HtmlTree setStyle(HtmlStyle style) {
<a name="26" id="anc26"></a><span class="line-modified">150         return put(HtmlAttr.CLASS, style.toString());</span>

151     }
152 
153     /**
<a name="27" id="anc27"></a><span class="line-modified">154      * Adds additional content for the HTML element.</span>
155      *
<a name="28" id="anc28"></a><span class="line-modified">156      * @param content the content</span>
157      */
158     @Override
<a name="29" id="anc29"></a><span class="line-modified">159     public HtmlTree add(Content content) {</span>
<span class="line-modified">160         if (content instanceof ContentBuilder) {</span>
<span class="line-modified">161             ((ContentBuilder) content).contents.forEach(this::add);</span>


162         }
<a name="30" id="anc30"></a><span class="line-modified">163         else if (content == HtmlTree.EMPTY || content.isValid()) {</span>
<span class="line-modified">164             // quietly avoid adding empty or invalid nodes (except EMPTY)</span>
<span class="line-modified">165             if (this.content.isEmpty())</span>
<span class="line-modified">166                 this.content = new ArrayList&lt;&gt;();</span>
<span class="line-added">167             this.content.add(content);</span>
168         }
<a name="31" id="anc31"></a><span class="line-added">169         return this;</span>
170     }
171 
172     /**
<a name="32" id="anc32"></a><span class="line-modified">173      * Adds text content for the HTML element.</span>
<span class="line-modified">174      *</span>
<span class="line-modified">175      * If the last content member that was added is a {@code StringContent},</span>
<span class="line-added">176      * appends the string to that item; otherwise, creates and uses a new {@code StringContent}</span>
<span class="line-added">177      * for the new text content.</span>
178      *
179      * @param stringContent string content that needs to be added
180      */
181     @Override
<a name="33" id="anc33"></a><span class="line-modified">182     public HtmlTree add(CharSequence stringContent) {</span>
183         if (!content.isEmpty()) {
184             Content lastContent = content.get(content.size() - 1);
185             if (lastContent instanceof StringContent)
186                 lastContent.add(stringContent);
<a name="34" id="anc34"></a><span class="line-modified">187             else {</span>
188                 add(new StringContent(stringContent));
<a name="35" id="anc35"></a><span class="line-added">189             }</span>
190         }
<a name="36" id="anc36"></a><span class="line-modified">191         else {</span>
192             add(new StringContent(stringContent));
<a name="37" id="anc37"></a><span class="line-added">193         }</span>
<span class="line-added">194         return this;</span>
<span class="line-added">195     }</span>
<span class="line-added">196 </span>
<span class="line-added">197     /**</span>
<span class="line-added">198      * Adds each of a list of content items.</span>
<span class="line-added">199      *</span>
<span class="line-added">200      * @param list the list</span>
<span class="line-added">201      * @return this object</span>
<span class="line-added">202      */</span>
<span class="line-added">203     public HtmlTree add(List&lt;? extends Content&gt; list) {</span>
<span class="line-added">204         list.forEach(this::add);</span>
<span class="line-added">205         return this;</span>
206     }
207 
208     @Override
209     public int charCount() {
210         int n = 0;
<a name="38" id="anc38"></a><span class="line-modified">211         for (Content c : content) {</span>
212             n += c.charCount();
<a name="39" id="anc39"></a><span class="line-added">213         }</span>
214         return n;
215     }
216 
217     /*
218      * The sets of ASCII URI characters to be left unencoded.
219      * See &quot;Uniform Resource Identifier (URI): Generic Syntax&quot;
220      * IETF RFC 3986. https://tools.ietf.org/html/rfc3986
221      */
222     public static final BitSet MAIN_CHARS;
223     public static final BitSet QUERY_FRAGMENT_CHARS;
224 
225     static {
226         BitSet alphaDigit = bitSet(bitSet(&#39;A&#39;, &#39;Z&#39;), bitSet(&#39;a&#39;, &#39;z&#39;), bitSet(&#39;0&#39;, &#39;9&#39;));
227         BitSet unreserved = bitSet(alphaDigit, bitSet(&quot;-._~&quot;));
228         BitSet genDelims = bitSet(&quot;:/?#[]@&quot;);
229         BitSet subDelims = bitSet(&quot;!$&amp;&#39;()*+,;=&quot;);
230         MAIN_CHARS = bitSet(unreserved, genDelims, subDelims);
231         BitSet pchar = bitSet(unreserved, subDelims, bitSet(&quot;:@&quot;));
232         QUERY_FRAGMENT_CHARS = bitSet(pchar, bitSet(&quot;/?&quot;));
233     }
234 
235     private static BitSet bitSet(String s) {
236         BitSet result = new BitSet();
237         for (int i = 0; i &lt; s.length(); i++) {
238            result.set(s.charAt(i));
239         }
240         return result;
241     }
242 
243     private static BitSet bitSet(char from, char to) {
244         BitSet result = new BitSet();
245         result.set(from, to + 1);
246         return result;
247     }
248 
249     private static BitSet bitSet(BitSet... sets) {
250         BitSet result = new BitSet();
251         for (BitSet set : sets) {
252             result.or(set);
253         }
254         return result;
255     }
256 
257     /**
258      * Apply percent-encoding to a URL.
259      * This is similar to {@link java.net.URLEncoder} but
260      * is less aggressive about encoding some characters,
261      * like &#39;(&#39;, &#39;)&#39;, &#39;,&#39; which are used in the anchor
262      * names for Java methods in HTML5 mode.
263      *
264      * @param url the url to be percent-encoded.
265      * @return a percent-encoded string.
266      */
267     public static String encodeURL(String url) {
268         BitSet nonEncodingChars = MAIN_CHARS;
269         StringBuilder sb = new StringBuilder();
<a name="40" id="anc40"></a><span class="line-modified">270         for (byte c : url.getBytes(StandardCharsets.UTF_8)) {</span>
271             if (c == &#39;?&#39; || c == &#39;#&#39;) {
272                 sb.append((char) c);
273                 // switch to the more restrictive set inside
274                 // the query and/or fragment
275                 nonEncodingChars = QUERY_FRAGMENT_CHARS;
276             } else if (nonEncodingChars.get(c &amp; 0xFF)) {
277                 sb.append((char) c);
278             } else {
279                 sb.append(String.format(&quot;%%%02X&quot;, c &amp; 0xFF));
280             }
281         }
282         return sb.toString();
283     }
284 
285     /**
<a name="41" id="anc41"></a><span class="line-modified">286      * Creates an HTML {@code A} element.</span>
287      *
<a name="42" id="anc42"></a><span class="line-modified">288      * @param ref the value for the {@code href} attribute}</span>
<span class="line-modified">289      * @param body the content for element</span>
<span class="line-modified">290      * @return the element</span>
291      */
292     public static HtmlTree A(String ref, Content body) {
<a name="43" id="anc43"></a><span class="line-modified">293         return new HtmlTree(HtmlTag.A)</span>
<span class="line-modified">294                 .put(HtmlAttr.HREF, encodeURL(ref))</span>
<span class="line-modified">295                 .add(body);</span>
296     }
297 
298     /**
<a name="44" id="anc44"></a><span class="line-modified">299      * Creates an HTML {@code CAPTION} element with the given content.</span>
300      *
<a name="45" id="anc45"></a><span class="line-modified">301      * @param body content for the element</span>
<span class="line-modified">302      * @return the element</span>
303      */
304     public static HtmlTree CAPTION(Content body) {
<a name="46" id="anc46"></a><span class="line-modified">305         return new HtmlTree(HtmlTag.CAPTION)</span>
<span class="line-modified">306                 .add(body);</span>
307     }
308 
309     /**
<a name="47" id="anc47"></a><span class="line-modified">310      * Creates an HTML {@code CODE} element with the given content.</span>
311      *
<a name="48" id="anc48"></a><span class="line-modified">312      * @param body content for the element</span>
<span class="line-modified">313      * @return the element</span>
314      */
315     public static HtmlTree CODE(Content body) {
<a name="49" id="anc49"></a><span class="line-modified">316         return new HtmlTree(HtmlTag.CODE)</span>
<span class="line-modified">317                 .add(body);</span>
318     }
319 
320     /**
<a name="50" id="anc50"></a><span class="line-modified">321      * Creates an HTML {@code DD} element with the given content.</span>
322      *
<a name="51" id="anc51"></a><span class="line-modified">323      * @param body content for the element</span>
<span class="line-modified">324      * @return the element</span>
325      */
326     public static HtmlTree DD(Content body) {
<a name="52" id="anc52"></a><span class="line-modified">327         return new HtmlTree(HtmlTag.DD)</span>
<span class="line-modified">328                 .add(body);</span>
329     }
330 
331     /**
<a name="53" id="anc53"></a><span class="line-modified">332      * Creates an HTML {@code DL} element with the given style.</span>
333      *
334      * @param style the style
<a name="54" id="anc54"></a><span class="line-modified">335      * @return the element</span>
336      */
337     public static HtmlTree DL(HtmlStyle style) {
<a name="55" id="anc55"></a><span class="line-modified">338         return new HtmlTree(HtmlTag.DL)</span>
<span class="line-added">339                 .setStyle(style);</span>
340     }
341 
342     /**
<a name="56" id="anc56"></a><span class="line-modified">343      * Creates an HTML {@code DL} element with the given style and content.</span>
344      *
<a name="57" id="anc57"></a><span class="line-modified">345      * @param style the style</span>
<span class="line-modified">346      * @param body  the content</span>
<span class="line-modified">347      * @return the element</span>
348      */
349     public static HtmlTree DL(HtmlStyle style, Content body) {
<a name="58" id="anc58"></a><span class="line-modified">350         return new HtmlTree(HtmlTag.DL)</span>
<span class="line-added">351                 .setStyle(style)</span>
<span class="line-added">352                 .add(body);</span>
353     }
354 
355     /**
<a name="59" id="anc59"></a><span class="line-modified">356      * Creates an HTML {@code DIV} element with the given style.</span>

357      *
<a name="60" id="anc60"></a><span class="line-modified">358      * @param style the style</span>
<span class="line-modified">359      * @return the element</span>

360      */
<a name="61" id="anc61"></a><span class="line-modified">361     public static HtmlTree DIV(HtmlStyle style) {</span>
<span class="line-modified">362         return new HtmlTree(HtmlTag.DIV)</span>
<span class="line-modified">363                 .setStyle(style);</span>


364     }
365 
366     /**
<a name="62" id="anc62"></a><span class="line-modified">367      * Creates an HTML {@code DIV} element with the given style and content.</span>
368      *
<a name="63" id="anc63"></a><span class="line-modified">369      * @param style the style</span>
<span class="line-modified">370      * @param body  the content</span>
<span class="line-added">371      * @return the element</span>
<span class="line-added">372      */</span>
<span class="line-added">373     public static HtmlTree DIV(HtmlStyle style, Content body) {</span>
<span class="line-added">374         return new HtmlTree(HtmlTag.DIV)</span>
<span class="line-added">375                 .setStyle(style)</span>
<span class="line-added">376                 .add(body);</span>
<span class="line-added">377     }</span>
<span class="line-added">378 </span>
<span class="line-added">379     /**</span>
<span class="line-added">380      * Creates an HTML {@code DIV} element with the given content.</span>
<span class="line-added">381      *</span>
<span class="line-added">382      * @param body the content</span>
<span class="line-added">383      * @return the element</span>
384      */
385     public static HtmlTree DIV(Content body) {
<a name="64" id="anc64"></a><span class="line-modified">386         return new HtmlTree(HtmlTag.DIV)</span>
<span class="line-added">387                 .add(body);</span>
388     }
389 
390     /**
<a name="65" id="anc65"></a><span class="line-modified">391      * Creates an HTML {@code DT} element with the given content.</span>
392      *
<a name="66" id="anc66"></a><span class="line-modified">393      * @param body the content</span>
<span class="line-modified">394      * @return the element</span>
395      */
396     public static HtmlTree DT(Content body) {
<a name="67" id="anc67"></a><span class="line-modified">397         return new HtmlTree(HtmlTag.DT)</span>
<span class="line-modified">398                 .add(body);</span>
399     }
400 
401     /**
<a name="68" id="anc68"></a><span class="line-modified">402      * Creates an HTML {@code FOOTER} element.</span>
<span class="line-added">403      * The role is set to {@code contentinfo}.</span>
404      *
<a name="69" id="anc69"></a><span class="line-modified">405      * @return the element</span>
406      */
407     public static HtmlTree FOOTER() {
<a name="70" id="anc70"></a><span class="line-modified">408         return new HtmlTree(HtmlTag.FOOTER)</span>
<span class="line-modified">409                 .setRole(Role.CONTENTINFO);</span>

410     }
411 
412     /**
<a name="71" id="anc71"></a><span class="line-modified">413      * Creates an HTML {@code HEADER} element.</span>
<span class="line-added">414      * The role is set to {@code banner}.</span>
415      *
<a name="72" id="anc72"></a><span class="line-modified">416      * @return the element</span>
417      */
418     public static HtmlTree HEADER() {
<a name="73" id="anc73"></a><span class="line-modified">419         return new HtmlTree(HtmlTag.HEADER)</span>
<span class="line-modified">420                 .setRole(Role.BANNER);</span>

421     }
422 
423     /**
<a name="74" id="anc74"></a><span class="line-modified">424      * Creates an HTML heading element with the given content.</span>

425      *
<a name="75" id="anc75"></a><span class="line-modified">426      * @param headingTag the tag for the heading</span>
<span class="line-modified">427      * @param body       the content</span>
<span class="line-modified">428      * @return the element</span>


429      */
<a name="76" id="anc76"></a><span class="line-modified">430     public static HtmlTree HEADING(HtmlTag headingTag, Content body) {</span>
<span class="line-modified">431         return new HtmlTree(checkHeading(headingTag))</span>
<span class="line-modified">432                 .add(body);</span>





433     }
434 
435     /**
<a name="77" id="anc77"></a><span class="line-modified">436      * Creates an HTML heading element with the given style and content.</span>

437      *
<a name="78" id="anc78"></a><span class="line-modified">438      * @param headingTag the tag for the heading</span>
<span class="line-modified">439      * @param style      the stylesheet class</span>
<span class="line-modified">440      * @param body       the content</span>
<span class="line-modified">441      * @return the element</span>
442      */
<a name="79" id="anc79"></a><span class="line-modified">443     public static HtmlTree HEADING(HtmlTag headingTag, HtmlStyle style, Content body) {</span>
<span class="line-modified">444         return new HtmlTree(checkHeading(headingTag))</span>
<span class="line-added">445                 .setStyle(style)</span>
<span class="line-added">446                 .add(body);</span>
447     }
448 
449     /**
<a name="80" id="anc80"></a><span class="line-modified">450      * Creates an HTML heading element with the given style and content.</span>
<span class="line-modified">451      * The {@code title} attribute is set from the content.</span>
452      *
<a name="81" id="anc81"></a><span class="line-modified">453      * @param headingTag the tag for the heading</span>
<span class="line-modified">454      * @param style      the stylesheet class</span>
<span class="line-modified">455      * @param body       the content</span>
<span class="line-modified">456      * @return the element</span>
457      */
<a name="82" id="anc82"></a><span class="line-modified">458     public static HtmlTree HEADING_TITLE(HtmlTag headingTag,</span>
<span class="line-modified">459                                          HtmlStyle style, Content body) {</span>
<span class="line-added">460         return new HtmlTree(checkHeading(headingTag))</span>
<span class="line-added">461                 .setTitle(body)</span>
<span class="line-added">462                 .setStyle(style)</span>
<span class="line-added">463                 .add(body);</span>
464     }
465 
466     /**
<a name="83" id="anc83"></a><span class="line-modified">467      * Creates an HTML heading element with the given style and content.</span>
<span class="line-added">468      * The {@code title} attribute is set from the content.</span>
469      *
<a name="84" id="anc84"></a><span class="line-modified">470      * @param headingTag the tag for the heading</span>
<span class="line-modified">471      * @param body       the content</span>
<span class="line-modified">472      * @return the element</span>
473      */
<a name="85" id="anc85"></a><span class="line-modified">474     public static HtmlTree HEADING_TITLE(HtmlTag headingTag, Content body) {</span>
<span class="line-modified">475         return new HtmlTree(checkHeading(headingTag))</span>
<span class="line-added">476                 .setTitle(body)</span>
<span class="line-added">477                 .add(body);</span>
478     }
479 
<a name="86" id="anc86"></a><span class="line-modified">480     private static HtmlTag checkHeading(HtmlTag headingTag) {</span>
<span class="line-modified">481         switch (headingTag) {</span>
<span class="line-modified">482             case H1: case H2: case H3: case H4: case H5: case H6:</span>
<span class="line-modified">483                 return headingTag;</span>
<span class="line-modified">484             default:</span>
<span class="line-modified">485                 throw new IllegalArgumentException(headingTag.toString());</span>
<span class="line-modified">486         }</span>






487     }
488 
489     /**
<a name="87" id="anc87"></a><span class="line-modified">490      * Craetes an HTML {@code HTML} element with the given {@code lang} attribute,</span>
<span class="line-added">491      * and {@code HEAD} and {@code BODY} contents.</span>
492      *
<a name="88" id="anc88"></a><span class="line-modified">493      * @param lang the value for the {@code lang} attribute</span>
<span class="line-modified">494      * @param head the {@code HEAD} element</span>
<span class="line-modified">495      * @param body the {@code BODY} element</span>
<span class="line-modified">496      * @return the {@code HTML} element</span>
497      */
<a name="89" id="anc89"></a><span class="line-modified">498     public static HtmlTree HTML(String lang, Content head, Content body) {</span>
<span class="line-modified">499         return new HtmlTree(HtmlTag.HTML)</span>
<span class="line-modified">500                 .put(HtmlAttr.LANG, lang)</span>
<span class="line-modified">501                 .add(head)</span>
<span class="line-modified">502                 .add(body);</span>

503     }
504 
505     /**
<a name="90" id="anc90"></a><span class="line-modified">506      * Creates an HTML {@code INPUT} element with the given id and initial value.</span>
<span class="line-added">507      * The element as marked as initially disabled.</span>
508      *
<a name="91" id="anc91"></a><span class="line-modified">509      * @param type  the type of input</span>
<span class="line-modified">510      * @param id    the id</span>
<span class="line-modified">511      * @param value the initial value</span>
<span class="line-modified">512      * @return the element</span>
513      */
514     public static HtmlTree INPUT(String type, String id, String value) {
<a name="92" id="anc92"></a><span class="line-modified">515         return new HtmlTree(HtmlTag.INPUT)</span>
<span class="line-modified">516                 .put(HtmlAttr.TYPE, type)</span>
<span class="line-modified">517                 .put(HtmlAttr.ID, id)</span>
<span class="line-modified">518                 .put(HtmlAttr.VALUE, value)</span>
<span class="line-modified">519                 .put(HtmlAttr.DISABLED, &quot;disabled&quot;);</span>

520     }
521 
522     /**
<a name="93" id="anc93"></a><span class="line-modified">523      * Creates an HTML {@code LABEL} element with the given content.</span>
524      *
<a name="94" id="anc94"></a><span class="line-modified">525      * @param forLabel the value of the {@code for} attribute</span>
<span class="line-modified">526      * @param body     the content</span>
<span class="line-modified">527      * @return the element</span>
528      */
529     public static HtmlTree LABEL(String forLabel, Content body) {
<a name="95" id="anc95"></a><span class="line-modified">530         return new HtmlTree(HtmlTag.LABEL)</span>
<span class="line-modified">531                 .put(HtmlAttr.FOR, forLabel)</span>
<span class="line-modified">532                 .add(body);</span>
533     }
534 
535     /**
<a name="96" id="anc96"></a><span class="line-modified">536      * Creates an HTML {@code LI} element with the given content.</span>
537      *
<a name="97" id="anc97"></a><span class="line-modified">538      * @param body the content</span>
<span class="line-modified">539      * @return the element</span>
540      */
541     public static HtmlTree LI(Content body) {
<a name="98" id="anc98"></a><span class="line-modified">542         return new HtmlTree(HtmlTag.LI)</span>
<span class="line-added">543                 .add(body);</span>
544     }
545 
546     /**
<a name="99" id="anc99"></a><span class="line-modified">547      * Creates an HTML {@code LI} element with the given style and the given content.</span>
548      *
<a name="100" id="anc100"></a><span class="line-modified">549      * @param style the style</span>
<span class="line-modified">550      * @param body  the content</span>
<span class="line-modified">551      * @return the element</span>
552      */
<a name="101" id="anc101"></a><span class="line-modified">553     public static HtmlTree LI(HtmlStyle style, Content body) {</span>
<span class="line-modified">554         return LI(body)</span>
<span class="line-modified">555                 .setStyle(style);</span>


556     }
557 
558     /**
<a name="102" id="anc102"></a><span class="line-modified">559      * Creates an HTML {@code LINK} tag with the given attributes.</span>
560      *
<a name="103" id="anc103"></a><span class="line-modified">561      * @param rel   the relevance of the link: the {@code rel} attribute</span>
<span class="line-modified">562      * @param type  the type of link: the {@code type} attribute</span>
<span class="line-modified">563      * @param href  the path for the link: the {@code href} attribute</span>
<span class="line-modified">564      * @param title title for the link: the {@code title} attribute</span>
<span class="line-modified">565      * @return the element</span>
566      */
567     public static HtmlTree LINK(String rel, String type, String href, String title) {
<a name="104" id="anc104"></a><span class="line-modified">568         return new HtmlTree(HtmlTag.LINK)</span>
<span class="line-modified">569                 .put(HtmlAttr.REL, rel)</span>
<span class="line-modified">570                 .put(HtmlAttr.TYPE, type)</span>
<span class="line-modified">571                 .put(HtmlAttr.HREF, href)</span>
<span class="line-modified">572                 .put(HtmlAttr.TITLE, title);</span>

573     }
574 
575     /**
<a name="105" id="anc105"></a><span class="line-modified">576      * Creates an HTML {@code MAIN} element.</span>
<span class="line-added">577      * The role is set to {@code main}.</span>
578      *
<a name="106" id="anc106"></a><span class="line-modified">579      * @return the element</span>
580      */
581     public static HtmlTree MAIN() {
<a name="107" id="anc107"></a><span class="line-modified">582         return new HtmlTree(HtmlTag.MAIN)</span>
<span class="line-modified">583                 .setRole(Role.MAIN);</span>

584     }
585 
586     /**
<a name="108" id="anc108"></a><span class="line-modified">587      * Creates an HTML {@code MAIN} element with the given content.</span>
<span class="line-added">588      * The role is set to {@code main}.</span>
589      *
<a name="109" id="anc109"></a><span class="line-modified">590      * @return the element</span>

591      */
592     public static HtmlTree MAIN(Content body) {
<a name="110" id="anc110"></a><span class="line-modified">593         return new HtmlTree(HtmlTag.MAIN)</span>
<span class="line-modified">594                 .setRole(Role.MAIN)</span>
<span class="line-modified">595                 .add(body);</span>
596     }
597 
598     /**
<a name="111" id="anc111"></a><span class="line-modified">599      * Creates an HTML {@code META} element with {@code http-equiv} and {@code content} attributes.</span>
600      *
<a name="112" id="anc112"></a><span class="line-modified">601      * @param httpEquiv the value for the {@code http-equiv} attribute</span>
<span class="line-modified">602      * @param content   the type of content, to be used in the {@code content} attribute</span>
<span class="line-modified">603      * @param charset   the character set for the document, to be used in the {@code content} attribute</span>
<span class="line-modified">604      * @return the element</span>
605      */
<a name="113" id="anc113"></a><span class="line-modified">606     public static HtmlTree META(String httpEquiv, String content, String charset) {</span>
<span class="line-modified">607         return new HtmlTree(HtmlTag.META)</span>
<span class="line-modified">608                 .put(HtmlAttr.HTTP_EQUIV, httpEquiv)</span>
<span class="line-modified">609                 .put(HtmlAttr.CONTENT, content + &quot;; charset=&quot; + charset);</span>


610     }
611 
612     /**
<a name="114" id="anc114"></a><span class="line-modified">613      * Creates an HTML {@code META} element with {@code name} and {@code content} attributes.</span>
614      *
<a name="115" id="anc115"></a><span class="line-modified">615      * @param name    the value for the {@code name} attribute</span>
<span class="line-modified">616      * @param content the value for the {@code content} attribute</span>
<span class="line-modified">617      * @return the element</span>
618      */
619     public static HtmlTree META(String name, String content) {
<a name="116" id="anc116"></a><span class="line-modified">620         return new HtmlTree(HtmlTag.META)</span>
<span class="line-modified">621                 .put(HtmlAttr.NAME, name)</span>
<span class="line-modified">622                 .put(HtmlAttr.CONTENT, content);</span>

623     }
624 
625     /**
<a name="117" id="anc117"></a><span class="line-modified">626      * Creates an HTML {@code NAV} element.</span>
<span class="line-added">627      * The role is set to {@code navigation}.</span>
628      *
<a name="118" id="anc118"></a><span class="line-modified">629      * @return the element</span>
630      */
631     public static HtmlTree NAV() {
<a name="119" id="anc119"></a><span class="line-modified">632         return new HtmlTree(HtmlTag.NAV)</span>
<span class="line-modified">633                 .setRole(Role.NAVIGATION);</span>

634     }
635 
636     /**
<a name="120" id="anc120"></a><span class="line-modified">637      * Creates an HTML {@code NOSCRIPT} element with some content.</span>
638      *
<a name="121" id="anc121"></a><span class="line-modified">639      * @param body the content</span>
<span class="line-modified">640      * @return the element</span>
641      */
642     public static HtmlTree NOSCRIPT(Content body) {
<a name="122" id="anc122"></a><span class="line-modified">643         return new HtmlTree(HtmlTag.NOSCRIPT)</span>
<span class="line-modified">644                 .add(body);</span>
645     }
646 
647     /**
<a name="123" id="anc123"></a><span class="line-modified">648      * Creates an HTML {@code P} element with some content.</span>
649      *
<a name="124" id="anc124"></a><span class="line-modified">650      * @param body the content</span>
<span class="line-modified">651      * @return the element</span>
652      */
653     public static HtmlTree P(Content body) {
<a name="125" id="anc125"></a><span class="line-modified">654         return new HtmlTree(HtmlTag.P)</span>
<span class="line-added">655                 .add(body);</span>
656     }
657 
658     /**
<a name="126" id="anc126"></a><span class="line-modified">659      * Creates an HTML {@code P} element with the given style and some content.</span>
660      *
<a name="127" id="anc127"></a><span class="line-modified">661      * @param style the style</span>
<span class="line-modified">662      * @param body  the content</span>
<span class="line-modified">663      * @return the element</span>
664      */
<a name="128" id="anc128"></a><span class="line-modified">665     public static HtmlTree P(HtmlStyle style, Content body) {</span>
<span class="line-modified">666         return P(body)</span>
<span class="line-modified">667                 .setStyle(style);</span>


668     }
669 
670     /**
<a name="129" id="anc129"></a><span class="line-modified">671      * Creates an HTML {@code SCRIPT} element with some script content.</span>
<span class="line-added">672      * The type of the script is set to {@code text/javascript}.</span>
673      *
<a name="130" id="anc130"></a><span class="line-modified">674      * @param src the content</span>
<span class="line-modified">675      * @return the element</span>
676      */
677     public static HtmlTree SCRIPT(String src) {
<a name="131" id="anc131"></a><span class="line-modified">678         return new HtmlTree(HtmlTag.SCRIPT)</span>
<span class="line-modified">679                 .put(HtmlAttr.TYPE, &quot;text/javascript&quot;)</span>
<span class="line-modified">680                 .put(HtmlAttr.SRC, src);</span>
<span class="line-modified">681 </span>
682     }
683 
684     /**
<a name="132" id="anc132"></a><span class="line-modified">685      * Creates an HTML {@code SECTION} element with the given style.</span>
686      *
<a name="133" id="anc133"></a><span class="line-modified">687      * @param style the style</span>
<span class="line-modified">688      * @return the element</span>
689      */
<a name="134" id="anc134"></a><span class="line-modified">690     public static HtmlTree SECTION(HtmlStyle style) {</span>
<span class="line-modified">691         return new HtmlTree(HtmlTag.SECTION)</span>
<span class="line-modified">692                 .setStyle(style);</span>

693     }
694 
695     /**
<a name="135" id="anc135"></a><span class="line-modified">696      * Creates an HTML {@code SECTION} element with the given style and some content.</span>
697      *
<a name="136" id="anc136"></a><span class="line-modified">698      * @param style the style</span>
<span class="line-modified">699      * @param body  the content</span>
<span class="line-modified">700      * @return the element</span>
701      */
<a name="137" id="anc137"></a><span class="line-modified">702     public static HtmlTree SECTION(HtmlStyle style, Content body) {</span>
<span class="line-modified">703         return new HtmlTree(HtmlTag.SECTION)</span>
<span class="line-modified">704                 .setStyle(style)</span>
<span class="line-modified">705                 .add(body);</span>


706     }
707 
708     /**
<a name="138" id="anc138"></a><span class="line-modified">709      * Creates an HTML {@code SMALL} element with some content.</span>
710      *
<a name="139" id="anc139"></a><span class="line-modified">711      * @param body  the content</span>
<span class="line-modified">712      * @return the element</span>
713      */
714     public static HtmlTree SMALL(Content body) {
<a name="140" id="anc140"></a><span class="line-modified">715         return new HtmlTree(HtmlTag.SMALL)</span>
<span class="line-modified">716                 .add(body);</span>
717     }
718 
719     /**
<a name="141" id="anc141"></a><span class="line-modified">720      * Creates an HTML {@code SPAN} element with some content.</span>
721      *
<a name="142" id="anc142"></a><span class="line-modified">722      * @param body  the content</span>
<span class="line-modified">723      * @return the element</span>
724      */
725     public static HtmlTree SPAN(Content body) {
<a name="143" id="anc143"></a><span class="line-modified">726         return new HtmlTree(HtmlTag.SPAN)</span>
<span class="line-added">727                 .add(body);</span>
728     }
729 
730     /**
<a name="144" id="anc144"></a><span class="line-modified">731      * Creates an HTML {@code SPAN} element with the given style and some content.</span>
732      *
<a name="145" id="anc145"></a><span class="line-modified">733      * @param styleClass the style</span>
<span class="line-modified">734      * @param body       the content</span>
<span class="line-modified">735      * @return the element</span>
736      */
737     public static HtmlTree SPAN(HtmlStyle styleClass, Content body) {
<a name="146" id="anc146"></a><span class="line-modified">738         return SPAN(body)</span>
<span class="line-modified">739                 .setStyle(styleClass);</span>


740     }
741 
742     /**
<a name="147" id="anc147"></a><span class="line-modified">743      * Creates an HTML {@code SPAN} element with the given id and some content.</span>
744      *
<a name="148" id="anc148"></a><span class="line-modified">745      * @param id    the id</span>
<span class="line-modified">746      * @param body  the content</span>
<span class="line-modified">747      * @return the element</span>
748      */
749     public static HtmlTree SPAN_ID(String id, Content body) {
<a name="149" id="anc149"></a><span class="line-modified">750         return new HtmlTree(HtmlTag.SPAN)</span>
<span class="line-modified">751                 .setId(id)</span>
<span class="line-modified">752                 .add(body);</span>
753     }
754 
755     /**
<a name="150" id="anc150"></a><span class="line-modified">756      * Creates an HTML {@code SPAN} element with the given id and style, and some content.</span>

757      *
<a name="151" id="anc151"></a><span class="line-modified">758      * @param id    the id</span>
<span class="line-modified">759      * @param style the style</span>
<span class="line-modified">760      * @param body  the content</span>
<span class="line-modified">761      * @return the element</span>














































762      */
<a name="152" id="anc152"></a><span class="line-modified">763     public static HtmlTree SPAN(String id, HtmlStyle style, Content body) {</span>
<span class="line-modified">764         return new HtmlTree(HtmlTag.SPAN)</span>
<span class="line-modified">765                 .setId(id)</span>
<span class="line-modified">766                 .setStyle(style)</span>
<span class="line-modified">767                 .add(body);</span>
768     }
769 
770     /**
<a name="153" id="anc153"></a><span class="line-modified">771      * Creates an HTML {@code TD} element with the given style and some content.</span>
772      *
<a name="154" id="anc154"></a><span class="line-modified">773      * @param style the style</span>
<span class="line-modified">774      * @param body  the content</span>
<span class="line-added">775      * @return the element</span>
776      */
<a name="155" id="anc155"></a><span class="line-modified">777     public static HtmlTree TD(HtmlStyle style, Content body) {</span>
<span class="line-modified">778         return new HtmlTree(HtmlTag.TD)</span>
<span class="line-added">779                 .setStyle(style)</span>
<span class="line-added">780                 .add(body);</span>
781     }
782 
783     /**
<a name="156" id="anc156"></a><span class="line-modified">784      * Creates an HTML {@code TH} element with the given style and scope, and some content.</span>
785      *
<a name="157" id="anc157"></a><span class="line-modified">786      * @param style the style</span>
<span class="line-modified">787      * @param scope the value for the {@code scope} attribute</span>
<span class="line-modified">788      * @param body  the content</span>
<span class="line-modified">789      * @return the element</span>
790      */
<a name="158" id="anc158"></a><span class="line-modified">791     public static HtmlTree TH(HtmlStyle style, String scope, Content body) {</span>
<span class="line-modified">792         return new HtmlTree(HtmlTag.TH)</span>
<span class="line-modified">793                 .setStyle(style)</span>
<span class="line-modified">794                 .put(HtmlAttr.SCOPE, scope)</span>
<span class="line-modified">795                 .add(body);</span>

796     }
797 
798     /**
<a name="159" id="anc159"></a><span class="line-modified">799      * Creates an HTML {@code TH} element with the given scope, and some content.</span>
800      *
<a name="160" id="anc160"></a><span class="line-modified">801      * @param scope the value for the {@code scope} attribute</span>
<span class="line-modified">802      * @param body  the content</span>
<span class="line-modified">803      * @return the element</span>
804      */
805     public static HtmlTree TH(String scope, Content body) {
<a name="161" id="anc161"></a><span class="line-modified">806         return new HtmlTree(HtmlTag.TH)</span>
<span class="line-modified">807                 .put(HtmlAttr.SCOPE, scope)</span>
<span class="line-modified">808                 .add(body);</span>









809     }
810 
811     /**
<a name="162" id="anc162"></a><span class="line-modified">812      * Creates an HTML {@code TITLE} element with some content.</span>
813      *
<a name="163" id="anc163"></a><span class="line-modified">814      * @param body the content</span>
<span class="line-modified">815      * @return the element</span>
816      */
817     public static HtmlTree TITLE(String body) {
<a name="164" id="anc164"></a><span class="line-modified">818         return new HtmlTree(HtmlTag.TITLE)</span>
<span class="line-modified">819             .add(body);</span>
820     }
821 
822     /**
<a name="165" id="anc165"></a><span class="line-modified">823      * Creates an HTML {@code UL} element with the given style and some content.</span>
824      *
<a name="166" id="anc166"></a><span class="line-modified">825      * @param style the style</span>
<span class="line-modified">826      * @param first the initial content</span>
<span class="line-modified">827      * @param more  additional content</span>
<span class="line-modified">828      * @return the element</span>
<span class="line-modified">829      */</span>
<span class="line-modified">830     public static HtmlTree UL(HtmlStyle style, Content first, Content... more) {</span>
<span class="line-modified">831         HtmlTree htmlTree = new HtmlTree(HtmlTag.UL)</span>
<span class="line-modified">832                 .setStyle(style);</span>
<span class="line-modified">833         htmlTree.add(first);</span>










834         for (Content c : more) {
<a name="167" id="anc167"></a><span class="line-modified">835             htmlTree.add(c);</span>
836         }
<a name="168" id="anc168"></a>
837         return htmlTree;
838     }
839 
840     @Override
841     public boolean isEmpty() {
842         return (!hasContent() &amp;&amp; !hasAttrs());
843     }
844 
845     /**
846      * Returns true if the HTML tree has content.
847      *
848      * @return true if the HTML tree has content else return false
849      */
850     public boolean hasContent() {
851         return (!content.isEmpty());
852     }
853 
854     /**
855      * Returns true if the HTML tree has attributes.
856      *
857      * @return true if the HTML tree has attributes else return false
858      */
859     public boolean hasAttrs() {
860         return (!attrs.isEmpty());
861     }
862 
863     /**
864      * Returns true if the HTML tree has a specific attribute.
865      *
866      * @param attrName name of the attribute to check within the HTML tree
867      * @return true if the HTML tree has the specified attribute else return false
868      */
869     public boolean hasAttr(HtmlAttr attrName) {
870         return (attrs.containsKey(attrName));
871     }
872 
873     /**
874      * Returns true if the HTML tree is valid. This check is more specific to
875      * standard doclet and not exactly similar to W3C specifications. But it
876      * ensures HTML validation.
877      *
878      * @return true if the HTML tree is valid
879      */
880     @Override
881     public boolean isValid() {
882         switch (htmlTag) {
<a name="169" id="anc169"></a><span class="line-modified">883             case A:</span>
<span class="line-modified">884                 return (hasAttr(HtmlAttr.ID) || (hasAttr(HtmlAttr.HREF) &amp;&amp; hasContent()));</span>
<span class="line-modified">885             case BR:</span>
886                 return (!hasContent() &amp;&amp; (!hasAttrs() || hasAttr(HtmlAttr.CLEAR)));
<a name="170" id="anc170"></a><span class="line-modified">887             case HR:</span>


888             case INPUT:
889                 return (!hasContent());
<a name="171" id="anc171"></a><span class="line-modified">890             case IMG:</span>
891                 return (hasAttr(HtmlAttr.SRC) &amp;&amp; hasAttr(HtmlAttr.ALT) &amp;&amp; !hasContent());
<a name="172" id="anc172"></a><span class="line-modified">892             case LINK:</span>
893                 return (hasAttr(HtmlAttr.HREF) &amp;&amp; !hasContent());
<a name="173" id="anc173"></a><span class="line-modified">894             case META:</span>
895                 return (hasAttr(HtmlAttr.CONTENT) &amp;&amp; !hasContent());
<a name="174" id="anc174"></a><span class="line-modified">896             case SCRIPT:</span>
897                 return ((hasAttr(HtmlAttr.TYPE) &amp;&amp; hasAttr(HtmlAttr.SRC) &amp;&amp; !hasContent()) ||
898                         (hasAttr(HtmlAttr.TYPE) &amp;&amp; hasContent()));
<a name="175" id="anc175"></a><span class="line-modified">899             case SPAN:</span>
900                 return (hasAttr(HtmlAttr.ID) || hasContent());
901             default :
902                 return hasContent();
903         }
904     }
905 
906     /**
907      * Returns true if the element is an inline element.
908      *
909      * @return true if the HTML tag is an inline element
910      */
911     public boolean isInline() {
912         return (htmlTag.blockType == HtmlTag.BlockType.INLINE);
913     }
914 
915     @Override
916     public boolean write(Writer out, boolean atNewline) throws IOException {
917         if (!isInline() &amp;&amp; !atNewline)
918             out.write(DocletConstants.NL);
919         String tagString = htmlTag.toString();
920         out.write(&quot;&lt;&quot;);
921         out.write(tagString);
922         Iterator&lt;HtmlAttr&gt; iterator = attrs.keySet().iterator();
923         HtmlAttr key;
924         String value;
925         while (iterator.hasNext()) {
926             key = iterator.next();
927             value = attrs.get(key);
928             out.write(&quot; &quot;);
929             out.write(key.toString());
930             if (!value.isEmpty()) {
931                 out.write(&quot;=\&quot;&quot;);
932                 out.write(value);
933                 out.write(&quot;\&quot;&quot;);
934             }
935         }
936         out.write(&quot;&gt;&quot;);
937         boolean nl = false;
938         for (Content c : content)
939             nl = c.write(out, nl);
940         if (htmlTag.endTagRequired()) {
941             out.write(&quot;&lt;/&quot;);
942             out.write(tagString);
943             out.write(&quot;&gt;&quot;);
944         }
945         if (!isInline()) {
946             out.write(DocletConstants.NL);
947             return true;
948         } else {
949             return false;
950         }
951     }
952 
953     /**
954      * Given a Content node, strips all html characters and
955      * return the result.
956      *
957      * @param body The content node to check.
958      * @return the plain text from the content node
959      *
960      */
961     private static String stripHtml(Content body) {
962         String rawString = body.toString();
963         // remove HTML tags
<a name="176" id="anc176"></a><span class="line-modified">964         rawString = rawString.replaceAll(&quot;&lt;.*?&gt;&quot;, &quot; &quot;);</span>
965         // consolidate multiple spaces between a word to a single space
966         rawString = rawString.replaceAll(&quot;\\b\\s{2,}\\b&quot;, &quot; &quot;);
967         // remove extra whitespaces
968         return rawString.trim();
969     }
970 }
<a name="177" id="anc177"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="177" type="hidden" />
</body>
</html>