<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/cpu/x86/macroAssembler_x86.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="globals_x86.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="stubGenerator_x86_64.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/x86/macroAssembler_x86.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 2722,21 ***</span>
      lea(rscratch1, src);
      Assembler::divss(dst, Address(rscratch1, 0));
    }
  }
  
<span class="line-removed">- #ifndef _LP64</span>
<span class="line-removed">- void MacroAssembler::empty_FPU_stack() {</span>
<span class="line-removed">-   if (VM_Version::supports_mmx()) {</span>
<span class="line-removed">-     emms();</span>
<span class="line-removed">-   } else {</span>
<span class="line-removed">-     for (int i = 8; i-- &gt; 0; ) ffree(i);</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- }</span>
<span class="line-removed">- #endif // !LP64</span>
<span class="line-removed">- </span>
<span class="line-removed">- </span>
  void MacroAssembler::enter() {
    push(rbp);
    mov(rbp, rsp);
  }
  
<span class="line-new-header">--- 2722,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2751,11 ***</span>
      emit_int8(0x65); // gs:
      emit_int8((unsigned char)0x90);
    }
  }
  
<span class="line-modified">! #if !defined(_LP64)</span>
  void MacroAssembler::fcmp(Register tmp) {
    fcmp(tmp, 1, true, true);
  }
  
  void MacroAssembler::fcmp(Register tmp, int index, bool pop_left, bool pop_right) {
<span class="line-new-header">--- 2740,11 ---</span>
      emit_int8(0x65); // gs:
      emit_int8((unsigned char)0x90);
    }
  }
  
<span class="line-modified">! #ifndef _LP64</span>
  void MacroAssembler::fcmp(Register tmp) {
    fcmp(tmp, 1, true, true);
  }
  
  void MacroAssembler::fcmp(Register tmp, int index, bool pop_left, bool pop_right) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2850,10 ***</span>
<span class="line-new-header">--- 2839,18 ---</span>
    // Note: fxch &amp; fpop to get rid of ST1
    // (otherwise FPU stack could overflow eventually)
    fxch(1);
    fpop();
  }
<span class="line-added">+ </span>
<span class="line-added">+ void MacroAssembler::empty_FPU_stack() {</span>
<span class="line-added">+   if (VM_Version::supports_mmx()) {</span>
<span class="line-added">+     emms();</span>
<span class="line-added">+   } else {</span>
<span class="line-added">+     for (int i = 8; i-- &gt; 0; ) ffree(i);</span>
<span class="line-added">+   }</span>
<span class="line-added">+ }</span>
  #endif // !LP64
  
  void MacroAssembler::mulpd(XMMRegister dst, AddressLiteral src) {
    if (reachable(src)) {
      Assembler::mulpd(dst, as_Address(src));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2862,43 ***</span>
      Assembler::mulpd(dst, Address(rscratch1, 0));
    }
  }
  
  void MacroAssembler::load_float(Address src) {
    if (UseSSE &gt;= 1) {
      movflt(xmm0, src);
    } else {
<span class="line-modified">!     LP64_ONLY(ShouldNotReachHere());</span>
<span class="line-removed">-     NOT_LP64(fld_s(src));</span>
    }
  }
  
  void MacroAssembler::store_float(Address dst) {
    if (UseSSE &gt;= 1) {
      movflt(dst, xmm0);
    } else {
<span class="line-modified">!     LP64_ONLY(ShouldNotReachHere());</span>
<span class="line-removed">-     NOT_LP64(fstp_s(dst));</span>
    }
  }
  
  void MacroAssembler::load_double(Address src) {
    if (UseSSE &gt;= 2) {
      movdbl(xmm0, src);
    } else {
<span class="line-modified">!     LP64_ONLY(ShouldNotReachHere());</span>
<span class="line-removed">-     NOT_LP64(fld_d(src));</span>
    }
  }
  
  void MacroAssembler::store_double(Address dst) {
    if (UseSSE &gt;= 2) {
      movdbl(dst, xmm0);
    } else {
<span class="line-modified">!     LP64_ONLY(ShouldNotReachHere());</span>
<span class="line-removed">-     NOT_LP64(fstp_d(dst));</span>
    }
  }
  
  // dst = c = a * b + c
  void MacroAssembler::fmad(XMMRegister dst, XMMRegister a, XMMRegister b, XMMRegister c) {
    Assembler::vfmadd231sd(c, a, b);
<span class="line-new-header">--- 2859,55 ---</span>
      Assembler::mulpd(dst, Address(rscratch1, 0));
    }
  }
  
  void MacroAssembler::load_float(Address src) {
<span class="line-added">+ #ifdef _LP64</span>
<span class="line-added">+   movflt(xmm0, src);</span>
<span class="line-added">+ #else</span>
    if (UseSSE &gt;= 1) {
      movflt(xmm0, src);
    } else {
<span class="line-modified">!     fld_s(src);</span>
    }
<span class="line-added">+ #endif // LP64</span>
  }
  
  void MacroAssembler::store_float(Address dst) {
<span class="line-added">+ #ifdef _LP64</span>
<span class="line-added">+   movflt(dst, xmm0);</span>
<span class="line-added">+ #else</span>
    if (UseSSE &gt;= 1) {
      movflt(dst, xmm0);
    } else {
<span class="line-modified">!     fstp_s(dst);</span>
    }
<span class="line-added">+ #endif // LP64</span>
  }
  
  void MacroAssembler::load_double(Address src) {
<span class="line-added">+ #ifdef _LP64</span>
<span class="line-added">+   movdbl(xmm0, src);</span>
<span class="line-added">+ #else</span>
    if (UseSSE &gt;= 2) {
      movdbl(xmm0, src);
    } else {
<span class="line-modified">!     fld_d(src);</span>
    }
<span class="line-added">+ #endif // LP64</span>
  }
  
  void MacroAssembler::store_double(Address dst) {
<span class="line-added">+ #ifdef _LP64</span>
<span class="line-added">+   movdbl(dst, xmm0);</span>
<span class="line-added">+ #else</span>
    if (UseSSE &gt;= 2) {
      movdbl(dst, xmm0);
    } else {
<span class="line-modified">!     fstp_d(dst);</span>
    }
<span class="line-added">+ #endif // LP64</span>
  }
  
  // dst = c = a * b + c
  void MacroAssembler::fmad(XMMRegister dst, XMMRegister a, XMMRegister b, XMMRegister c) {
    Assembler::vfmadd231sd(c, a, b);
</pre>
<center><a href="globals_x86.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="stubGenerator_x86_64.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>