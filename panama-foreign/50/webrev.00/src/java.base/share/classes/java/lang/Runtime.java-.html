<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/java.base/share/classes/java/lang/Runtime.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
  <body>
    <pre>
   1 /*
   2  * Copyright (c) 1995, 2019, Oracle and/or its affiliates. All rights reserved.
   3  * Copyright (c) 2019, Azul Systems, Inc. All rights reserved.
   4  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   5  *
   6  * This code is free software; you can redistribute it and/or modify it
   7  * under the terms of the GNU General Public License version 2 only, as
   8  * published by the Free Software Foundation.  Oracle designates this
   9  * particular file as subject to the &quot;Classpath&quot; exception as provided
  10  * by Oracle in the LICENSE file that accompanied this code.
  11  *
  12  * This code is distributed in the hope that it will be useful, but WITHOUT
  13  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  14  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  15  * version 2 for more details (a copy is included in the LICENSE file that
  16  * accompanied this code).
  17  *
  18  * You should have received a copy of the GNU General Public License version
  19  * 2 along with this work; if not, write to the Free Software Foundation,
  20  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  21  *
  22  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  23  * or visit www.oracle.com if you need additional information or have any
  24  * questions.
  25  */
  26 
  27 package java.lang;
  28 
  29 import java.io.*;
  30 import java.lang.ClassLoader.NativeLibrary;
  31 import java.lang.invoke.MethodHandles;
  32 import java.lang.invoke.MethodHandles.Lookup;
  33 import java.math.BigInteger;
  34 import java.util.regex.Matcher;
  35 import java.util.regex.Pattern;
  36 import java.util.stream.Collectors;
  37 import java.util.List;
  38 import java.util.Optional;
  39 import java.util.StringTokenizer;
  40 
  41 import jdk.internal.access.JavaLangAccess;
  42 import jdk.internal.access.SharedSecrets;
  43 import jdk.internal.access.foreign.NativeLibraryProxy;
  44 import jdk.internal.reflect.CallerSensitive;
  45 import jdk.internal.reflect.Reflection;
  46 
  47 /**
  48  * Every Java application has a single instance of class
  49  * {@code Runtime} that allows the application to interface with
  50  * the environment in which the application is running. The current
  51  * runtime can be obtained from the {@code getRuntime} method.
  52  * &lt;p&gt;
  53  * An application cannot create its own instance of this class.
  54  *
  55  * @author  unascribed
  56  * @see     java.lang.Runtime#getRuntime()
  57  * @since   1.0
  58  */
  59 
  60 public class Runtime {
  61     private static final Runtime currentRuntime = new Runtime();
  62 
  63     private static Version version;
  64 
  65     /**
  66      * Returns the runtime object associated with the current Java application.
  67      * Most of the methods of class {@code Runtime} are instance
  68      * methods and must be invoked with respect to the current runtime object.
  69      *
  70      * @return  the {@code Runtime} object associated with the current
  71      *          Java application.
  72      */
  73     public static Runtime getRuntime() {
  74         return currentRuntime;
  75     }
  76 
  77     /** Don&#39;t let anyone else instantiate this class */
  78     private Runtime() {}
  79 
  80     /**
  81      * Terminates the currently running Java virtual machine by initiating its
  82      * shutdown sequence.  This method never returns normally.  The argument
  83      * serves as a status code; by convention, a nonzero status code indicates
  84      * abnormal termination.
  85      *
  86      * &lt;p&gt; All registered {@linkplain #addShutdownHook shutdown hooks}, if any,
  87      * are started in some unspecified order and allowed to run concurrently
  88      * until they finish.  Once this is done the virtual machine
  89      * {@linkplain #halt halts}.
  90      *
  91      * &lt;p&gt; If this method is invoked after all shutdown hooks have already
  92      * been run and the status is nonzero then this method halts the
  93      * virtual machine with the given status code. Otherwise, this method
  94      * blocks indefinitely.
  95      *
  96      * &lt;p&gt; The {@link System#exit(int) System.exit} method is the
  97      * conventional and convenient means of invoking this method.
  98      *
  99      * @param  status
 100      *         Termination status.  By convention, a nonzero status code
 101      *         indicates abnormal termination.
 102      *
 103      * @throws SecurityException
 104      *         If a security manager is present and its
 105      *         {@link SecurityManager#checkExit checkExit} method does not permit
 106      *         exiting with the specified status
 107      *
 108      * @see java.lang.SecurityException
 109      * @see java.lang.SecurityManager#checkExit(int)
 110      * @see #addShutdownHook
 111      * @see #removeShutdownHook
 112      * @see #halt(int)
 113      */
 114     public void exit(int status) {
 115         SecurityManager security = System.getSecurityManager();
 116         if (security != null) {
 117             security.checkExit(status);
 118         }
 119         Shutdown.exit(status);
 120     }
 121 
 122     /**
 123      * Registers a new virtual-machine shutdown hook.
 124      *
 125      * &lt;p&gt; The Java virtual machine &lt;i&gt;shuts down&lt;/i&gt; in response to two kinds
 126      * of events:
 127      *
 128      *   &lt;ul&gt;
 129      *
 130      *   &lt;li&gt; The program &lt;i&gt;exits&lt;/i&gt; normally, when the last non-daemon
 131      *   thread exits or when the {@link #exit exit} (equivalently,
 132      *   {@link System#exit(int) System.exit}) method is invoked, or
 133      *
 134      *   &lt;li&gt; The virtual machine is &lt;i&gt;terminated&lt;/i&gt; in response to a
 135      *   user interrupt, such as typing {@code ^C}, or a system-wide event,
 136      *   such as user logoff or system shutdown.
 137      *
 138      *   &lt;/ul&gt;
 139      *
 140      * &lt;p&gt; A &lt;i&gt;shutdown hook&lt;/i&gt; is simply an initialized but unstarted
 141      * thread.  When the virtual machine begins its shutdown sequence it will
 142      * start all registered shutdown hooks in some unspecified order and let
 143      * them run concurrently.  When all the hooks have finished it will then
 144      * halt. Note that daemon threads will continue to run during the shutdown
 145      * sequence, as will non-daemon threads if shutdown was initiated by
 146      * invoking the {@link #exit exit} method.
 147      *
 148      * &lt;p&gt; Once the shutdown sequence has begun it can be stopped only by
 149      * invoking the {@link #halt halt} method, which forcibly
 150      * terminates the virtual machine.
 151      *
 152      * &lt;p&gt; Once the shutdown sequence has begun it is impossible to register a
 153      * new shutdown hook or de-register a previously-registered hook.
 154      * Attempting either of these operations will cause an
 155      * {@link IllegalStateException} to be thrown.
 156      *
 157      * &lt;p&gt; Shutdown hooks run at a delicate time in the life cycle of a virtual
 158      * machine and should therefore be coded defensively.  They should, in
 159      * particular, be written to be thread-safe and to avoid deadlocks insofar
 160      * as possible.  They should also not rely blindly upon services that may
 161      * have registered their own shutdown hooks and therefore may themselves in
 162      * the process of shutting down.  Attempts to use other thread-based
 163      * services such as the AWT event-dispatch thread, for example, may lead to
 164      * deadlocks.
 165      *
 166      * &lt;p&gt; Shutdown hooks should also finish their work quickly.  When a
 167      * program invokes {@link #exit exit} the expectation is
 168      * that the virtual machine will promptly shut down and exit.  When the
 169      * virtual machine is terminated due to user logoff or system shutdown the
 170      * underlying operating system may only allow a fixed amount of time in
 171      * which to shut down and exit.  It is therefore inadvisable to attempt any
 172      * user interaction or to perform a long-running computation in a shutdown
 173      * hook.
 174      *
 175      * &lt;p&gt; Uncaught exceptions are handled in shutdown hooks just as in any
 176      * other thread, by invoking the
 177      * {@link ThreadGroup#uncaughtException uncaughtException} method of the
 178      * thread&#39;s {@link ThreadGroup} object. The default implementation of this
 179      * method prints the exception&#39;s stack trace to {@link System#err} and
 180      * terminates the thread; it does not cause the virtual machine to exit or
 181      * halt.
 182      *
 183      * &lt;p&gt; In rare circumstances the virtual machine may &lt;i&gt;abort&lt;/i&gt;, that is,
 184      * stop running without shutting down cleanly.  This occurs when the
 185      * virtual machine is terminated externally, for example with the
 186      * {@code SIGKILL} signal on Unix or the {@code TerminateProcess} call on
 187      * Microsoft Windows.  The virtual machine may also abort if a native
 188      * method goes awry by, for example, corrupting internal data structures or
 189      * attempting to access nonexistent memory.  If the virtual machine aborts
 190      * then no guarantee can be made about whether or not any shutdown hooks
 191      * will be run.
 192      *
 193      * @param   hook
 194      *          An initialized but unstarted {@link Thread} object
 195      *
 196      * @throws  IllegalArgumentException
 197      *          If the specified hook has already been registered,
 198      *          or if it can be determined that the hook is already running or
 199      *          has already been run
 200      *
 201      * @throws  IllegalStateException
 202      *          If the virtual machine is already in the process
 203      *          of shutting down
 204      *
 205      * @throws  SecurityException
 206      *          If a security manager is present and it denies
 207      *          {@link RuntimePermission}(&quot;shutdownHooks&quot;)
 208      *
 209      * @see #removeShutdownHook
 210      * @see #halt(int)
 211      * @see #exit(int)
 212      * @since 1.3
 213      */
 214     public void addShutdownHook(Thread hook) {
 215         SecurityManager sm = System.getSecurityManager();
 216         if (sm != null) {
 217             sm.checkPermission(new RuntimePermission(&quot;shutdownHooks&quot;));
 218         }
 219         ApplicationShutdownHooks.add(hook);
 220     }
 221 
 222     /**
 223      * De-registers a previously-registered virtual-machine shutdown hook.
 224      *
 225      * @param hook the hook to remove
 226      * @return {@code true} if the specified hook had previously been
 227      * registered and was successfully de-registered, {@code false}
 228      * otherwise.
 229      *
 230      * @throws  IllegalStateException
 231      *          If the virtual machine is already in the process of shutting
 232      *          down
 233      *
 234      * @throws  SecurityException
 235      *          If a security manager is present and it denies
 236      *          {@link RuntimePermission}(&quot;shutdownHooks&quot;)
 237      *
 238      * @see #addShutdownHook
 239      * @see #exit(int)
 240      * @since 1.3
 241      */
 242     public boolean removeShutdownHook(Thread hook) {
 243         SecurityManager sm = System.getSecurityManager();
 244         if (sm != null) {
 245             sm.checkPermission(new RuntimePermission(&quot;shutdownHooks&quot;));
 246         }
 247         return ApplicationShutdownHooks.remove(hook);
 248     }
 249 
 250     /**
 251      * Forcibly terminates the currently running Java virtual machine.  This
 252      * method never returns normally.
 253      *
 254      * &lt;p&gt; This method should be used with extreme caution.  Unlike the
 255      * {@link #exit exit} method, this method does not cause shutdown
 256      * hooks to be started.  If the shutdown sequence has already been
 257      * initiated then this method does not wait for any running
 258      * shutdown hooks to finish their work.
 259      *
 260      * @param  status
 261      *         Termination status. By convention, a nonzero status code
 262      *         indicates abnormal termination. If the {@link Runtime#exit exit}
 263      *         (equivalently, {@link System#exit(int) System.exit}) method
 264      *         has already been invoked then this status code
 265      *         will override the status code passed to that method.
 266      *
 267      * @throws SecurityException
 268      *         If a security manager is present and its
 269      *         {@link SecurityManager#checkExit checkExit} method
 270      *         does not permit an exit with the specified status
 271      *
 272      * @see #exit
 273      * @see #addShutdownHook
 274      * @see #removeShutdownHook
 275      * @since 1.3
 276      */
 277     public void halt(int status) {
 278         SecurityManager sm = System.getSecurityManager();
 279         if (sm != null) {
 280             sm.checkExit(status);
 281         }
 282         Shutdown.beforeHalt();
 283         Shutdown.halt(status);
 284     }
 285 
 286     /**
 287      * Executes the specified string command in a separate process.
 288      *
 289      * &lt;p&gt;This is a convenience method.  An invocation of the form
 290      * {@code exec(command)}
 291      * behaves in exactly the same way as the invocation
 292      * {@link #exec(String, String[], File) exec}{@code (command, null, null)}.
 293      *
 294      * @param   command   a specified system command.
 295      *
 296      * @return  A new {@link Process} object for managing the subprocess
 297      *
 298      * @throws  SecurityException
 299      *          If a security manager exists and its
 300      *          {@link SecurityManager#checkExec checkExec}
 301      *          method doesn&#39;t allow creation of the subprocess
 302      *
 303      * @throws  IOException
 304      *          If an I/O error occurs
 305      *
 306      * @throws  NullPointerException
 307      *          If {@code command} is {@code null}
 308      *
 309      * @throws  IllegalArgumentException
 310      *          If {@code command} is empty
 311      *
 312      * @see     #exec(String[], String[], File)
 313      * @see     ProcessBuilder
 314      */
 315     public Process exec(String command) throws IOException {
 316         return exec(command, null, null);
 317     }
 318 
 319     /**
 320      * Executes the specified string command in a separate process with the
 321      * specified environment.
 322      *
 323      * &lt;p&gt;This is a convenience method.  An invocation of the form
 324      * {@code exec(command, envp)}
 325      * behaves in exactly the same way as the invocation
 326      * {@link #exec(String, String[], File) exec}{@code (command, envp, null)}.
 327      *
 328      * @param   command   a specified system command.
 329      *
 330      * @param   envp      array of strings, each element of which
 331      *                    has environment variable settings in the format
 332      *                    &lt;i&gt;name&lt;/i&gt;=&lt;i&gt;value&lt;/i&gt;, or
 333      *                    {@code null} if the subprocess should inherit
 334      *                    the environment of the current process.
 335      *
 336      * @return  A new {@link Process} object for managing the subprocess
 337      *
 338      * @throws  SecurityException
 339      *          If a security manager exists and its
 340      *          {@link SecurityManager#checkExec checkExec}
 341      *          method doesn&#39;t allow creation of the subprocess
 342      *
 343      * @throws  IOException
 344      *          If an I/O error occurs
 345      *
 346      * @throws  NullPointerException
 347      *          If {@code command} is {@code null},
 348      *          or one of the elements of {@code envp} is {@code null}
 349      *
 350      * @throws  IllegalArgumentException
 351      *          If {@code command} is empty
 352      *
 353      * @see     #exec(String[], String[], File)
 354      * @see     ProcessBuilder
 355      */
 356     public Process exec(String command, String[] envp) throws IOException {
 357         return exec(command, envp, null);
 358     }
 359 
 360     /**
 361      * Executes the specified string command in a separate process with the
 362      * specified environment and working directory.
 363      *
 364      * &lt;p&gt;This is a convenience method.  An invocation of the form
 365      * {@code exec(command, envp, dir)}
 366      * behaves in exactly the same way as the invocation
 367      * {@link #exec(String[], String[], File) exec}{@code (cmdarray, envp, dir)},
 368      * where {@code cmdarray} is an array of all the tokens in
 369      * {@code command}.
 370      *
 371      * &lt;p&gt;More precisely, the {@code command} string is broken
 372      * into tokens using a {@link StringTokenizer} created by the call
 373      * {@code new {@link StringTokenizer}(command)} with no
 374      * further modification of the character categories.  The tokens
 375      * produced by the tokenizer are then placed in the new string
 376      * array {@code cmdarray}, in the same order.
 377      *
 378      * @param   command   a specified system command.
 379      *
 380      * @param   envp      array of strings, each element of which
 381      *                    has environment variable settings in the format
 382      *                    &lt;i&gt;name&lt;/i&gt;=&lt;i&gt;value&lt;/i&gt;, or
 383      *                    {@code null} if the subprocess should inherit
 384      *                    the environment of the current process.
 385      *
 386      * @param   dir       the working directory of the subprocess, or
 387      *                    {@code null} if the subprocess should inherit
 388      *                    the working directory of the current process.
 389      *
 390      * @return  A new {@link Process} object for managing the subprocess
 391      *
 392      * @throws  SecurityException
 393      *          If a security manager exists and its
 394      *          {@link SecurityManager#checkExec checkExec}
 395      *          method doesn&#39;t allow creation of the subprocess
 396      *
 397      * @throws  IOException
 398      *          If an I/O error occurs
 399      *
 400      * @throws  NullPointerException
 401      *          If {@code command} is {@code null},
 402      *          or one of the elements of {@code envp} is {@code null}
 403      *
 404      * @throws  IllegalArgumentException
 405      *          If {@code command} is empty
 406      *
 407      * @see     ProcessBuilder
 408      * @since 1.3
 409      */
 410     public Process exec(String command, String[] envp, File dir)
 411         throws IOException {
 412         if (command.isEmpty())
 413             throw new IllegalArgumentException(&quot;Empty command&quot;);
 414 
 415         StringTokenizer st = new StringTokenizer(command);
 416         String[] cmdarray = new String[st.countTokens()];
 417         for (int i = 0; st.hasMoreTokens(); i++)
 418             cmdarray[i] = st.nextToken();
 419         return exec(cmdarray, envp, dir);
 420     }
 421 
 422     /**
 423      * Executes the specified command and arguments in a separate process.
 424      *
 425      * &lt;p&gt;This is a convenience method.  An invocation of the form
 426      * {@code exec(cmdarray)}
 427      * behaves in exactly the same way as the invocation
 428      * {@link #exec(String[], String[], File) exec}{@code (cmdarray, null, null)}.
 429      *
 430      * @param   cmdarray  array containing the command to call and
 431      *                    its arguments.
 432      *
 433      * @return  A new {@link Process} object for managing the subprocess
 434      *
 435      * @throws  SecurityException
 436      *          If a security manager exists and its
 437      *          {@link SecurityManager#checkExec checkExec}
 438      *          method doesn&#39;t allow creation of the subprocess
 439      *
 440      * @throws  IOException
 441      *          If an I/O error occurs
 442      *
 443      * @throws  NullPointerException
 444      *          If {@code cmdarray} is {@code null},
 445      *          or one of the elements of {@code cmdarray} is {@code null}
 446      *
 447      * @throws  IndexOutOfBoundsException
 448      *          If {@code cmdarray} is an empty array
 449      *          (has length {@code 0})
 450      *
 451      * @see     ProcessBuilder
 452      */
 453     public Process exec(String cmdarray[]) throws IOException {
 454         return exec(cmdarray, null, null);
 455     }
 456 
 457     /**
 458      * Executes the specified command and arguments in a separate process
 459      * with the specified environment.
 460      *
 461      * &lt;p&gt;This is a convenience method.  An invocation of the form
 462      * {@code exec(cmdarray, envp)}
 463      * behaves in exactly the same way as the invocation
 464      * {@link #exec(String[], String[], File) exec}{@code (cmdarray, envp, null)}.
 465      *
 466      * @param   cmdarray  array containing the command to call and
 467      *                    its arguments.
 468      *
 469      * @param   envp      array of strings, each element of which
 470      *                    has environment variable settings in the format
 471      *                    &lt;i&gt;name&lt;/i&gt;=&lt;i&gt;value&lt;/i&gt;, or
 472      *                    {@code null} if the subprocess should inherit
 473      *                    the environment of the current process.
 474      *
 475      * @return  A new {@link Process} object for managing the subprocess
 476      *
 477      * @throws  SecurityException
 478      *          If a security manager exists and its
 479      *          {@link SecurityManager#checkExec checkExec}
 480      *          method doesn&#39;t allow creation of the subprocess
 481      *
 482      * @throws  IOException
 483      *          If an I/O error occurs
 484      *
 485      * @throws  NullPointerException
 486      *          If {@code cmdarray} is {@code null},
 487      *          or one of the elements of {@code cmdarray} is {@code null},
 488      *          or one of the elements of {@code envp} is {@code null}
 489      *
 490      * @throws  IndexOutOfBoundsException
 491      *          If {@code cmdarray} is an empty array
 492      *          (has length {@code 0})
 493      *
 494      * @see     ProcessBuilder
 495      */
 496     public Process exec(String[] cmdarray, String[] envp) throws IOException {
 497         return exec(cmdarray, envp, null);
 498     }
 499 
 500 
 501     /**
 502      * Executes the specified command and arguments in a separate process with
 503      * the specified environment and working directory.
 504      *
 505      * &lt;p&gt;Given an array of strings {@code cmdarray}, representing the
 506      * tokens of a command line, and an array of strings {@code envp},
 507      * representing &quot;environment&quot; variable settings, this method creates
 508      * a new process in which to execute the specified command.
 509      *
 510      * &lt;p&gt;This method checks that {@code cmdarray} is a valid operating
 511      * system command.  Which commands are valid is system-dependent,
 512      * but at the very least the command must be a non-empty list of
 513      * non-null strings.
 514      *
 515      * &lt;p&gt;If {@code envp} is {@code null}, the subprocess inherits the
 516      * environment settings of the current process.
 517      *
 518      * &lt;p&gt;A minimal set of system dependent environment variables may
 519      * be required to start a process on some operating systems.
 520      * As a result, the subprocess may inherit additional environment variable
 521      * settings beyond those in the specified environment.
 522      *
 523      * &lt;p&gt;{@link ProcessBuilder#start()} is now the preferred way to
 524      * start a process with a modified environment.
 525      *
 526      * &lt;p&gt;The working directory of the new subprocess is specified by {@code dir}.
 527      * If {@code dir} is {@code null}, the subprocess inherits the
 528      * current working directory of the current process.
 529      *
 530      * &lt;p&gt;If a security manager exists, its
 531      * {@link SecurityManager#checkExec checkExec}
 532      * method is invoked with the first component of the array
 533      * {@code cmdarray} as its argument. This may result in a
 534      * {@link SecurityException} being thrown.
 535      *
 536      * &lt;p&gt;Starting an operating system process is highly system-dependent.
 537      * Among the many things that can go wrong are:
 538      * &lt;ul&gt;
 539      * &lt;li&gt;The operating system program file was not found.
 540      * &lt;li&gt;Access to the program file was denied.
 541      * &lt;li&gt;The working directory does not exist.
 542      * &lt;/ul&gt;
 543      *
 544      * &lt;p&gt;In such cases an exception will be thrown.  The exact nature
 545      * of the exception is system-dependent, but it will always be a
 546      * subclass of {@link IOException}.
 547      *
 548      * &lt;p&gt;If the operating system does not support the creation of
 549      * processes, an {@link UnsupportedOperationException} will be thrown.
 550      *
 551      *
 552      * @param   cmdarray  array containing the command to call and
 553      *                    its arguments.
 554      *
 555      * @param   envp      array of strings, each element of which
 556      *                    has environment variable settings in the format
 557      *                    &lt;i&gt;name&lt;/i&gt;=&lt;i&gt;value&lt;/i&gt;, or
 558      *                    {@code null} if the subprocess should inherit
 559      *                    the environment of the current process.
 560      *
 561      * @param   dir       the working directory of the subprocess, or
 562      *                    {@code null} if the subprocess should inherit
 563      *                    the working directory of the current process.
 564      *
 565      * @return  A new {@link Process} object for managing the subprocess
 566      *
 567      * @throws  SecurityException
 568      *          If a security manager exists and its
 569      *          {@link SecurityManager#checkExec checkExec}
 570      *          method doesn&#39;t allow creation of the subprocess
 571      *
 572      * @throws  UnsupportedOperationException
 573      *          If the operating system does not support the creation of processes.
 574      *
 575      * @throws  IOException
 576      *          If an I/O error occurs
 577      *
 578      * @throws  NullPointerException
 579      *          If {@code cmdarray} is {@code null},
 580      *          or one of the elements of {@code cmdarray} is {@code null},
 581      *          or one of the elements of {@code envp} is {@code null}
 582      *
 583      * @throws  IndexOutOfBoundsException
 584      *          If {@code cmdarray} is an empty array
 585      *          (has length {@code 0})
 586      *
 587      * @see     ProcessBuilder
 588      * @since 1.3
 589      */
 590     public Process exec(String[] cmdarray, String[] envp, File dir)
 591         throws IOException {
 592         return new ProcessBuilder(cmdarray)
 593             .environment(envp)
 594             .directory(dir)
 595             .start();
 596     }
 597 
 598     /**
 599      * Returns the number of processors available to the Java virtual machine.
 600      *
 601      * &lt;p&gt; This value may change during a particular invocation of the virtual
 602      * machine.  Applications that are sensitive to the number of available
 603      * processors should therefore occasionally poll this property and adjust
 604      * their resource usage appropriately. &lt;/p&gt;
 605      *
 606      * @return  the maximum number of processors available to the virtual
 607      *          machine; never smaller than one
 608      * @since 1.4
 609      */
 610     public native int availableProcessors();
 611 
 612     /**
 613      * Returns the amount of free memory in the Java Virtual Machine.
 614      * Calling the
 615      * {@code gc} method may result in increasing the value returned
 616      * by {@code freeMemory.}
 617      *
 618      * @return  an approximation to the total amount of memory currently
 619      *          available for future allocated objects, measured in bytes.
 620      */
 621     public native long freeMemory();
 622 
 623     /**
 624      * Returns the total amount of memory in the Java virtual machine.
 625      * The value returned by this method may vary over time, depending on
 626      * the host environment.
 627      * &lt;p&gt;
 628      * Note that the amount of memory required to hold an object of any
 629      * given type may be implementation-dependent.
 630      *
 631      * @return  the total amount of memory currently available for current
 632      *          and future objects, measured in bytes.
 633      */
 634     public native long totalMemory();
 635 
 636     /**
 637      * Returns the maximum amount of memory that the Java virtual machine
 638      * will attempt to use.  If there is no inherent limit then the value
 639      * {@link java.lang.Long#MAX_VALUE} will be returned.
 640      *
 641      * @return  the maximum amount of memory that the virtual machine will
 642      *          attempt to use, measured in bytes
 643      * @since 1.4
 644      */
 645     public native long maxMemory();
 646 
 647     /**
 648      * Runs the garbage collector in the Java Virtual Machine.
 649      * &lt;p&gt;
 650      * Calling this method suggests that the Java Virtual Machine
 651      * expend effort toward recycling unused objects in order to
 652      * make the memory they currently occupy available for reuse
 653      * by the Java Virtual Machine.
 654      * When control returns from the method call, the Java Virtual Machine
 655      * has made a best effort to reclaim space from all unused objects.
 656      * There is no guarantee that this effort will recycle any particular
 657      * number of unused objects, reclaim any particular amount of space, or
 658      * complete at any particular time, if at all, before the method returns or ever.
 659      * &lt;p&gt;
 660      * The name {@code gc} stands for &quot;garbage
 661      * collector&quot;. The Java Virtual Machine performs this recycling
 662      * process automatically as needed, in a separate thread, even if the
 663      * {@code gc} method is not invoked explicitly.
 664      * &lt;p&gt;
 665      * The method {@link System#gc()} is the conventional and convenient
 666      * means of invoking this method.
 667      */
 668     public native void gc();
 669 
 670     /**
 671      * Runs the finalization methods of any objects pending finalization.
 672      * Calling this method suggests that the Java virtual machine expend
 673      * effort toward running the {@code finalize} methods of objects
 674      * that have been found to be discarded but whose {@code finalize}
 675      * methods have not yet been run. When control returns from the
 676      * method call, the virtual machine has made a best effort to
 677      * complete all outstanding finalizations.
 678      * &lt;p&gt;
 679      * The virtual machine performs the finalization process
 680      * automatically as needed, in a separate thread, if the
 681      * {@code runFinalization} method is not invoked explicitly.
 682      * &lt;p&gt;
 683      * The method {@link System#runFinalization()} is the conventional
 684      * and convenient means of invoking this method.
 685      *
 686      * @see     java.lang.Object#finalize()
 687      */
 688     public void runFinalization() {
 689         SharedSecrets.getJavaLangRefAccess().runFinalization();
 690     }
 691 
 692     /**
 693      * Loads the native library specified by the filename argument.  The filename
 694      * argument must be an absolute path name.
 695      * (for example
 696      * {@code Runtime.getRuntime().load(&quot;/home/avh/lib/libX11.so&quot;);}).
 697      *
 698      * If the filename argument, when stripped of any platform-specific library
 699      * prefix, path, and file extension, indicates a library whose name is,
 700      * for example, L, and a native library called L is statically linked
 701      * with the VM, then the JNI_OnLoad_L function exported by the library
 702      * is invoked rather than attempting to load a dynamic library.
 703      * A filename matching the argument does not have to exist in the file
 704      * system.
 705      * See the &lt;a href=&quot;{@docRoot}/../specs/jni/index.html&quot;&gt; JNI Specification&lt;/a&gt;
 706      * for more details.
 707      *
 708      * Otherwise, the filename argument is mapped to a native library image in
 709      * an implementation-dependent manner.
 710      * &lt;p&gt;
 711      * First, if there is a security manager, its {@code checkLink}
 712      * method is called with the {@code filename} as its argument.
 713      * This may result in a security exception.
 714      * &lt;p&gt;
 715      * This is similar to the method {@link #loadLibrary(String)}, but it
 716      * accepts a general file name as an argument rather than just a library
 717      * name, allowing any file of native code to be loaded.
 718      * &lt;p&gt;
 719      * The method {@link System#load(String)} is the conventional and
 720      * convenient means of invoking this method.
 721      *
 722      * @param      filename   the file to load.
 723      * @throws     SecurityException  if a security manager exists and its
 724      *             {@code checkLink} method doesn&#39;t allow
 725      *             loading of the specified dynamic library
 726      * @throws     UnsatisfiedLinkError  if either the filename is not an
 727      *             absolute path name, the native library is not statically
 728      *             linked with the VM, or the library cannot be mapped to
 729      *             a native library image by the host system.
 730      * @throws     NullPointerException if {@code filename} is
 731      *             {@code null}
 732      * @see        java.lang.Runtime#getRuntime()
 733      * @see        java.lang.SecurityException
 734      * @see        java.lang.SecurityManager#checkLink(java.lang.String)
 735      */
 736     @CallerSensitive
 737     public void load(String filename) {
 738         load0(Reflection.getCallerClass(), filename);
 739     }
 740 
 741     NativeLibraryProxy load0(Class&lt;?&gt; fromClass, String filename) {
 742         SecurityManager security = System.getSecurityManager();
 743         if (security != null) {
 744             security.checkLink(filename);
 745         }
 746         if (!(new File(filename).isAbsolute())) {
 747             throw new UnsatisfiedLinkError(
 748                 &quot;Expecting an absolute path of the library: &quot; + filename);
 749         }
 750         return ClassLoader.loadLibrary(fromClass, filename, true);
 751     }
 752 
 753     /**
 754      * Loads the native library specified by the {@code libname}
 755      * argument.  The {@code libname} argument must not contain any platform
 756      * specific prefix, file extension or path. If a native library
 757      * called {@code libname} is statically linked with the VM, then the
 758      * JNI_OnLoad_{@code libname} function exported by the library is invoked.
 759      * See the &lt;a href=&quot;{@docRoot}/../specs/jni/index.html&quot;&gt; JNI Specification&lt;/a&gt;
 760      * for more details.
 761      *
 762      * Otherwise, the libname argument is loaded from a system library
 763      * location and mapped to a native library image in an implementation-
 764      * dependent manner.
 765      * &lt;p&gt;
 766      * First, if there is a security manager, its {@code checkLink}
 767      * method is called with the {@code libname} as its argument.
 768      * This may result in a security exception.
 769      * &lt;p&gt;
 770      * The method {@link System#loadLibrary(String)} is the conventional
 771      * and convenient means of invoking this method. If native
 772      * methods are to be used in the implementation of a class, a standard
 773      * strategy is to put the native code in a library file (call it
 774      * {@code LibFile}) and then to put a static initializer:
 775      * &lt;blockquote&gt;&lt;pre&gt;
 776      * static { System.loadLibrary(&quot;LibFile&quot;); }
 777      * &lt;/pre&gt;&lt;/blockquote&gt;
 778      * within the class declaration. When the class is loaded and
 779      * initialized, the necessary native code implementation for the native
 780      * methods will then be loaded as well.
 781      * &lt;p&gt;
 782      * If this method is called more than once with the same library
 783      * name, the second and subsequent calls are ignored.
 784      *
 785      * @param      libname   the name of the library.
 786      * @throws     SecurityException  if a security manager exists and its
 787      *             {@code checkLink} method doesn&#39;t allow
 788      *             loading of the specified dynamic library
 789      * @throws     UnsatisfiedLinkError if either the libname argument
 790      *             contains a file path, the native library is not statically
 791      *             linked with the VM,  or the library cannot be mapped to a
 792      *             native library image by the host system.
 793      * @throws     NullPointerException if {@code libname} is
 794      *             {@code null}
 795      * @see        java.lang.SecurityException
 796      * @see        java.lang.SecurityManager#checkLink(java.lang.String)
 797      */
 798     @CallerSensitive
 799     public void loadLibrary(String libname) {
 800         loadLibrary0(Reflection.getCallerClass(), libname);
 801     }
 802 
 803     /**
 804      * Panama specific: find library given name and lookup.
 805      * See {@link JavaLangAccess#loadLibrary(Lookup, String)}.
 806      */
 807     NativeLibrary loadLibrary(MethodHandles.Lookup lookup, String libname) {
 808         return loadLibrary0(lookup.lookupClass(), libname);
 809     }
 810 
 811     /**
 812      * Panama specific: find default system library.
 813      * See {@link JavaLangAccess#defaultLibrary()}.
 814      */
 815     NativeLibrary defaultLibrary() {
 816         return NativeLibrary.defaultLibrary;
 817     }
 818 
 819     NativeLibrary loadLibrary0(Class&lt;?&gt; fromClass, String libname) {
 820         SecurityManager security = System.getSecurityManager();
 821         if (security != null) {
 822             security.checkLink(libname);
 823         }
 824         if (libname.indexOf((int)File.separatorChar) != -1) {
 825             throw new UnsatisfiedLinkError(
 826                 &quot;Directory separator should not appear in library name: &quot; + libname);
 827         }
 828         return ClassLoader.loadLibrary(fromClass, libname, false);
 829     }
 830 
 831     /**
 832      * Returns the version of the Java Runtime Environment as a {@link Version}.
 833      *
 834      * @return  the {@link Version} of the Java Runtime Environment
 835      *
 836      * @since  9
 837      */
 838     public static Version version() {
 839         if (version == null) {
 840             version = new Version(VersionProps.versionNumbers(),
 841                     VersionProps.pre(), VersionProps.build(),
 842                     VersionProps.optional());
 843         }
 844         return version;
 845     }
 846 
 847     /**
 848      * A representation of a version string for an implementation of the
 849      * Java&amp;nbsp;SE Platform.  A version string consists of a version number
 850      * optionally followed by pre-release and build information.
 851      *
 852      * &lt;h2&gt;&lt;a id=&quot;verNum&quot;&gt;Version numbers&lt;/a&gt;&lt;/h2&gt;
 853      *
 854      * &lt;p&gt; A &lt;em&gt;version number&lt;/em&gt;, {@code $VNUM}, is a non-empty sequence of
 855      * elements separated by period characters (U+002E).  An element is either
 856      * zero, or an unsigned integer numeral without leading zeros.  The final
 857      * element in a version number must not be zero.  When an element is
 858      * incremented, all subsequent elements are removed.  The format is: &lt;/p&gt;
 859      *
 860      * &lt;blockquote&gt;&lt;pre&gt;
 861      * [1-9][0-9]*((\.0)*\.[1-9][0-9]*)*
 862      * &lt;/pre&gt;&lt;/blockquote&gt;
 863      *
 864      * &lt;p&gt; The sequence may be of arbitrary length but the first four elements
 865      * are assigned specific meanings, as follows:&lt;/p&gt;
 866      *
 867      * &lt;blockquote&gt;&lt;pre&gt;
 868      * $FEATURE.$INTERIM.$UPDATE.$PATCH
 869      * &lt;/pre&gt;&lt;/blockquote&gt;
 870      *
 871      * &lt;ul&gt;
 872      *
 873      * &lt;li&gt;&lt;p&gt; &lt;a id=&quot;FEATURE&quot;&gt;{@code $FEATURE}&lt;/a&gt; &amp;#x2014; The
 874      * feature-release counter, incremented for every feature release
 875      * regardless of release content.  Features may be added in a feature
 876      * release; they may also be removed, if advance notice was given at least
 877      * one feature release ahead of time.  Incompatible changes may be made
 878      * when justified. &lt;/p&gt;&lt;/li&gt;
 879      *
 880      * &lt;li&gt;&lt;p&gt; &lt;a id=&quot;INTERIM&quot;&gt;{@code $INTERIM}&lt;/a&gt; &amp;#x2014; The
 881      * interim-release counter, incremented for non-feature releases that
 882      * contain compatible bug fixes and enhancements but no incompatible
 883      * changes, no feature removals, and no changes to standard APIs.
 884      * &lt;/p&gt;&lt;/li&gt;
 885      *
 886      * &lt;li&gt;&lt;p&gt; &lt;a id=&quot;UPDATE&quot;&gt;{@code $UPDATE}&lt;/a&gt; &amp;#x2014; The update-release
 887      * counter, incremented for compatible update releases that fix security
 888      * issues, regressions, and bugs in newer features. &lt;/p&gt;&lt;/li&gt;
 889      *
 890      * &lt;li&gt;&lt;p&gt; &lt;a id=&quot;PATCH&quot;&gt;{@code $PATCH}&lt;/a&gt; &amp;#x2014; The emergency
 891      * patch-release counter, incremented only when it&#39;s necessary to produce
 892      * an emergency release to fix a critical issue. &lt;/p&gt;&lt;/li&gt;
 893      *
 894      * &lt;/ul&gt;
 895      *
 896      * &lt;p&gt; The fifth and later elements of a version number are free for use by
 897      * platform implementors, to identify implementor-specific patch
 898      * releases. &lt;/p&gt;
 899      *
 900      * &lt;p&gt; A version number never has trailing zero elements.  If an element
 901      * and all those that follow it logically have the value zero then all of
 902      * them are omitted. &lt;/p&gt;
 903      *
 904      * &lt;p&gt; The sequence of numerals in a version number is compared to another
 905      * such sequence in numerical, pointwise fashion; &lt;em&gt;e.g.&lt;/em&gt;, {@code
 906      * 10.0.4} is less than {@code 10.1.2}.  If one sequence is shorter than
 907      * another then the missing elements of the shorter sequence are considered
 908      * to be less than the corresponding elements of the longer sequence;
 909      * &lt;em&gt;e.g.&lt;/em&gt;, {@code 10.0.2} is less than {@code 10.0.2.1}. &lt;/p&gt;
 910      *
 911      * &lt;h2&gt;&lt;a id=&quot;verStr&quot;&gt;Version strings&lt;/a&gt;&lt;/h2&gt;
 912      *
 913      * &lt;p&gt; A &lt;em&gt;version string&lt;/em&gt;, {@code $VSTR}, is a version number {@code
 914      * $VNUM}, as described above, optionally followed by pre-release and build
 915      * information, in one of the following formats: &lt;/p&gt;
 916      *
 917      * &lt;blockquote&gt;&lt;pre&gt;
 918      *     $VNUM(-$PRE)?\+$BUILD(-$OPT)?
 919      *     $VNUM-$PRE(-$OPT)?
 920      *     $VNUM(\+-$OPT)?
 921      * &lt;/pre&gt;&lt;/blockquote&gt;
 922      *
 923      * &lt;p&gt; where: &lt;/p&gt;
 924      *
 925      * &lt;ul&gt;
 926      *
 927      * &lt;li&gt;&lt;p&gt; &lt;a id=&quot;pre&quot;&gt;{@code $PRE}&lt;/a&gt;, matching {@code ([a-zA-Z0-9]+)}
 928      * &amp;#x2014; A pre-release identifier.  Typically {@code ea}, for a
 929      * potentially unstable early-access release under active development, or
 930      * {@code internal}, for an internal developer build. &lt;/p&gt;&lt;/li&gt;
 931      *
 932      * &lt;li&gt;&lt;p&gt; &lt;a id=&quot;build&quot;&gt;{@code $BUILD}&lt;/a&gt;, matching {@code
 933      * (0|[1-9][0-9]*)} &amp;#x2014; The build number, incremented for each promoted
 934      * build.  {@code $BUILD} is reset to {@code 1} when any portion of {@code
 935      * $VNUM} is incremented. &lt;/p&gt;&lt;/li&gt;
 936      *
 937      * &lt;li&gt;&lt;p&gt; &lt;a id=&quot;opt&quot;&gt;{@code $OPT}&lt;/a&gt;, matching {@code ([-a-zA-Z0-9.]+)}
 938      * &amp;#x2014; Additional build information, if desired.  In the case of an
 939      * {@code internal} build this will often contain the date and time of the
 940      * build. &lt;/p&gt;&lt;/li&gt;
 941      *
 942      * &lt;/ul&gt;
 943      *
 944      * &lt;p&gt; A version string {@code 10-ea} matches {@code $VNUM = &quot;10&quot;} and
 945      * {@code $PRE = &quot;ea&quot;}.  The version string {@code 10+-ea} matches
 946      * {@code $VNUM = &quot;10&quot;} and {@code $OPT = &quot;ea&quot;}. &lt;/p&gt;
 947      *
 948      * &lt;p&gt; When comparing two version strings, the value of {@code $OPT}, if
 949      * present, may or may not be significant depending on the chosen
 950      * comparison method.  The comparison methods {@link #compareTo(Version)
 951      * compareTo()} and {@link #compareToIgnoreOptional(Version)
 952      * compareToIgnoreOptional()} should be used consistently with the
 953      * corresponding methods {@link #equals(Object) equals()} and {@link
 954      * #equalsIgnoreOptional(Object) equalsIgnoreOptional()}.  &lt;/p&gt;
 955      *
 956      * &lt;p&gt; A &lt;em&gt;short version string&lt;/em&gt;, {@code $SVSTR}, often useful in
 957      * less formal contexts, is a version number optionally followed by a
 958      * pre-release identifier:&lt;/p&gt;
 959      *
 960      * &lt;blockquote&gt;&lt;pre&gt;
 961      *     $VNUM(-$PRE)?
 962      * &lt;/pre&gt;&lt;/blockquote&gt;
 963      *
 964      * &lt;p&gt;This is a &lt;a href=&quot;./doc-files/ValueBased.html&quot;&gt;value-based&lt;/a&gt;
 965      * class; use of identity-sensitive operations (including reference equality
 966      * ({@code ==}), identity hash code, or synchronization) on instances of
 967      * {@code Version} may have unpredictable results and should be avoided.
 968      * &lt;/p&gt;
 969      *
 970      * @since  9
 971      */
 972     public static final class Version
 973         implements Comparable&lt;Version&gt;
 974     {
 975         private final List&lt;Integer&gt;     version;
 976         private final Optional&lt;String&gt;  pre;
 977         private final Optional&lt;Integer&gt; build;
 978         private final Optional&lt;String&gt;  optional;
 979 
 980         /*
 981          * List of version number components passed to this constructor MUST
 982          * be at least unmodifiable (ideally immutable). In the case on an
 983          * unmodifiable list, the caller MUST hand the list over to this
 984          * constructor and never change the underlying list.
 985          */
 986         private Version(List&lt;Integer&gt; unmodifiableListOfVersions,
 987                         Optional&lt;String&gt; pre,
 988                         Optional&lt;Integer&gt; build,
 989                         Optional&lt;String&gt; optional)
 990         {
 991             this.version = unmodifiableListOfVersions;
 992             this.pre = pre;
 993             this.build = build;
 994             this.optional = optional;
 995         }
 996 
 997         /**
 998          * Parses the given string as a valid
 999          * &lt;a href=&quot;#verStr&quot;&gt;version string&lt;/a&gt; containing a
1000          * &lt;a href=&quot;#verNum&quot;&gt;version number&lt;/a&gt; followed by pre-release and
1001          * build information.
1002          *
1003          * @param  s
1004          *         A string to interpret as a version
1005          *
1006          * @throws  IllegalArgumentException
1007          *          If the given string cannot be interpreted as a valid
1008          *          version
1009          *
1010          * @throws  NullPointerException
1011          *          If the given string is {@code null}
1012          *
1013          * @throws  NumberFormatException
1014          *          If an element of the version number or the build number
1015          *          cannot be represented as an {@link Integer}
1016          *
1017          * @return  The Version of the given string
1018          */
1019         public static Version parse(String s) {
1020             if (s == null)
1021                 throw new NullPointerException();
1022 
1023             // Shortcut to avoid initializing VersionPattern when creating
1024             // feature-version constants during startup
1025             if (isSimpleNumber(s)) {
1026                 return new Version(List.of(Integer.parseInt(s)),
1027                         Optional.empty(), Optional.empty(), Optional.empty());
1028             }
1029             Matcher m = VersionPattern.VSTR_PATTERN.matcher(s);
1030             if (!m.matches())
1031                 throw new IllegalArgumentException(&quot;Invalid version string: &#39;&quot;
1032                                                    + s + &quot;&#39;&quot;);
1033 
1034             // $VNUM is a dot-separated list of integers of arbitrary length
1035             String[] split = m.group(VersionPattern.VNUM_GROUP).split(&quot;\\.&quot;);
1036             Integer[] version = new Integer[split.length];
1037             for (int i = 0; i &lt; split.length; i++) {
1038                 version[i] = Integer.parseInt(split[i]);
1039             }
1040 
1041             Optional&lt;String&gt; pre = Optional.ofNullable(
1042                     m.group(VersionPattern.PRE_GROUP));
1043 
1044             String b = m.group(VersionPattern.BUILD_GROUP);
1045             // $BUILD is an integer
1046             Optional&lt;Integer&gt; build = (b == null)
1047                 ? Optional.empty()
1048                 : Optional.of(Integer.parseInt(b));
1049 
1050             Optional&lt;String&gt; optional = Optional.ofNullable(
1051                     m.group(VersionPattern.OPT_GROUP));
1052 
1053             // empty &#39;+&#39;
1054             if (!build.isPresent()) {
1055                 if (m.group(VersionPattern.PLUS_GROUP) != null) {
1056                     if (optional.isPresent()) {
1057                         if (pre.isPresent())
1058                             throw new IllegalArgumentException(&quot;&#39;+&#39; found with&quot;
1059                                 + &quot; pre-release and optional components:&#39;&quot; + s
1060                                 + &quot;&#39;&quot;);
1061                     } else {
1062                         throw new IllegalArgumentException(&quot;&#39;+&#39; found with neither&quot;
1063                             + &quot; build or optional components: &#39;&quot; + s + &quot;&#39;&quot;);
1064                     }
1065                 } else {
1066                     if (optional.isPresent() &amp;&amp; !pre.isPresent()) {
1067                         throw new IllegalArgumentException(&quot;optional component&quot;
1068                             + &quot; must be preceeded by a pre-release component&quot;
1069                             + &quot; or &#39;+&#39;: &#39;&quot; + s + &quot;&#39;&quot;);
1070                     }
1071                 }
1072             }
1073             return new Version(List.of(version), pre, build, optional);
1074         }
1075 
1076         private static boolean isSimpleNumber(String s) {
1077             for (int i = 0; i &lt; s.length(); i++) {
1078                 char c = s.charAt(i);
1079                 char lowerBound = (i &gt; 0) ? &#39;0&#39; : &#39;1&#39;;
1080                 if (c &lt; lowerBound || c &gt; &#39;9&#39;) {
1081                     return false;
1082                 }
1083             }
1084             return true;
1085         }
1086 
1087         /**
1088          * Returns the value of the &lt;a href=&quot;#FEATURE&quot;&gt;feature&lt;/a&gt; element of
1089          * the version number.
1090          *
1091          * @return The value of the feature element
1092          *
1093          * @since 10
1094          */
1095         public int feature() {
1096             return version.get(0);
1097         }
1098 
1099         /**
1100          * Returns the value of the &lt;a href=&quot;#INTERIM&quot;&gt;interim&lt;/a&gt; element of
1101          * the version number, or zero if it is absent.
1102          *
1103          * @return The value of the interim element, or zero
1104          *
1105          * @since 10
1106          */
1107         public int interim() {
1108             return (version.size() &gt; 1 ? version.get(1) : 0);
1109         }
1110 
1111         /**
1112          * Returns the value of the &lt;a href=&quot;#UPDATE&quot;&gt;update&lt;/a&gt; element of the
1113          * version number, or zero if it is absent.
1114          *
1115          * @return The value of the update element, or zero
1116          *
1117          * @since 10
1118          */
1119         public int update() {
1120             return (version.size() &gt; 2 ? version.get(2) : 0);
1121         }
1122 
1123         /**
1124          * Returns the value of the &lt;a href=&quot;#PATCH&quot;&gt;patch&lt;/a&gt; element of the
1125          * version number, or zero if it is absent.
1126          *
1127          * @return The value of the patch element, or zero
1128          *
1129          * @since 10
1130          */
1131         public int patch() {
1132             return (version.size() &gt; 3 ? version.get(3) : 0);
1133         }
1134 
1135         /**
1136          * Returns the value of the major element of the version number.
1137          *
1138          * @deprecated As of Java&amp;nbsp;SE 10, the first element of a version
1139          * number is not the major-release number but the feature-release
1140          * counter, incremented for every time-based release.  Use the {@link
1141          * #feature()} method in preference to this method.  For compatibility,
1142          * this method returns the value of the &lt;a href=&quot;#FEATURE&quot;&gt;feature&lt;/a&gt;
1143          * element.
1144          *
1145          * @return The value of the feature element
1146          */
1147         @Deprecated(since = &quot;10&quot;)
1148         public int major() {
1149             return feature();
1150         }
1151 
1152         /**
1153          * Returns the value of the minor element of the version number, or
1154          * zero if it is absent.
1155          *
1156          * @deprecated As of Java&amp;nbsp;SE 10, the second element of a version
1157          * number is not the minor-release number but the interim-release
1158          * counter, incremented for every interim release.  Use the {@link
1159          * #interim()} method in preference to this method.  For compatibility,
1160          * this method returns the value of the &lt;a href=&quot;#INTERIM&quot;&gt;interim&lt;/a&gt;
1161          * element, or zero if it is absent.
1162          *
1163          * @return The value of the interim element, or zero
1164          */
1165         @Deprecated(since = &quot;10&quot;)
1166         public int minor() {
1167             return interim();
1168         }
1169 
1170         /**
1171          * Returns the value of the security element of the version number, or
1172          * zero if it is absent.
1173          *
1174          * @deprecated As of Java&amp;nbsp;SE 10, the third element of a version
1175          * number is not the security level but the update-release counter,
1176          * incremented for every update release.  Use the {@link #update()}
1177          * method in preference to this method.  For compatibility, this method
1178          * returns the value of the &lt;a href=&quot;#UPDATE&quot;&gt;update&lt;/a&gt; element, or
1179          * zero if it is absent.
1180          *
1181          * @return  The value of the update element, or zero
1182          */
1183         @Deprecated(since = &quot;10&quot;)
1184         public int security() {
1185             return update();
1186         }
1187 
1188         /**
1189          * Returns an unmodifiable {@link java.util.List List} of the integers
1190          * represented in the &lt;a href=&quot;#verNum&quot;&gt;version number&lt;/a&gt;.
1191          * The {@code List} always contains at least one element corresponding to
1192          * the &lt;a href=&quot;#FEATURE&quot;&gt;feature version number&lt;/a&gt;.
1193          *
1194          * @return  An unmodifiable list of the integers
1195          *          represented in the version number
1196          */
1197         public List&lt;Integer&gt; version() {
1198             return version;
1199         }
1200 
1201         /**
1202          * Returns the optional &lt;a href=&quot;#pre&quot;&gt;pre-release&lt;/a&gt; information.
1203          *
1204          * @return  The optional pre-release information as a String
1205          */
1206         public Optional&lt;String&gt; pre() {
1207             return pre;
1208         }
1209 
1210         /**
1211          * Returns the &lt;a href=&quot;#build&quot;&gt;build number&lt;/a&gt;.
1212          *
1213          * @return  The optional build number.
1214          */
1215         public Optional&lt;Integer&gt; build() {
1216             return build;
1217         }
1218 
1219         /**
1220          * Returns &lt;a href=&quot;#opt&quot;&gt;optional&lt;/a&gt; additional identifying build
1221          * information.
1222          *
1223          * @return  Additional build information as a String
1224          */
1225         public Optional&lt;String&gt; optional() {
1226             return optional;
1227         }
1228 
1229         /**
1230          * Compares this version to another.
1231          *
1232          * &lt;p&gt; Each of the components in the &lt;a href=&quot;#verStr&quot;&gt;version&lt;/a&gt; is
1233          * compared in the following order of precedence: version numbers,
1234          * pre-release identifiers, build numbers, optional build information.
1235          * &lt;/p&gt;
1236          *
1237          * &lt;p&gt; Comparison begins by examining the sequence of version numbers.
1238          * If one sequence is shorter than another, then the missing elements
1239          * of the shorter sequence are considered to be less than the
1240          * corresponding elements of the longer sequence. &lt;/p&gt;
1241          *
1242          * &lt;p&gt; A version with a pre-release identifier is always considered to
1243          * be less than a version without one.  Pre-release identifiers are
1244          * compared numerically when they consist only of digits, and
1245          * lexicographically otherwise.  Numeric identifiers are considered to
1246          * be less than non-numeric identifiers.  &lt;/p&gt;
1247          *
1248          * &lt;p&gt; A version without a build number is always less than one with a
1249          * build number; otherwise build numbers are compared numerically. &lt;/p&gt;
1250          *
1251          * &lt;p&gt; The optional build information is compared lexicographically.
1252          * During this comparison, a version with optional build information is
1253          * considered to be greater than a version without one. &lt;/p&gt;
1254          *
1255          * @param  obj
1256          *         The object to be compared
1257          *
1258          * @return  A negative integer, zero, or a positive integer if this
1259          *          {@code Version} is less than, equal to, or greater than the
1260          *          given {@code Version}
1261          *
1262          * @throws  NullPointerException
1263          *          If the given object is {@code null}
1264          */
1265         @Override
1266         public int compareTo(Version obj) {
1267             return compare(obj, false);
1268         }
1269 
1270         /**
1271          * Compares this version to another disregarding optional build
1272          * information.
1273          *
1274          * &lt;p&gt; Two versions are compared by examining the version string as
1275          * described in {@link #compareTo(Version)} with the exception that the
1276          * optional build information is always ignored. &lt;/p&gt;
1277          *
1278          * &lt;p&gt; This method provides ordering which is consistent with
1279          * {@code equalsIgnoreOptional()}. &lt;/p&gt;
1280          *
1281          * @param  obj
1282          *         The object to be compared
1283          *
1284          * @return  A negative integer, zero, or a positive integer if this
1285          *          {@code Version} is less than, equal to, or greater than the
1286          *          given {@code Version}
1287          *
1288          * @throws  NullPointerException
1289          *          If the given object is {@code null}
1290          */
1291         public int compareToIgnoreOptional(Version obj) {
1292             return compare(obj, true);
1293         }
1294 
1295         private int compare(Version obj, boolean ignoreOpt) {
1296             if (obj == null)
1297                 throw new NullPointerException();
1298 
1299             int ret = compareVersion(obj);
1300             if (ret != 0)
1301                 return ret;
1302 
1303             ret = comparePre(obj);
1304             if (ret != 0)
1305                 return ret;
1306 
1307             ret = compareBuild(obj);
1308             if (ret != 0)
1309                 return ret;
1310 
1311             if (!ignoreOpt)
1312                 return compareOptional(obj);
1313 
1314             return 0;
1315         }
1316 
1317         private int compareVersion(Version obj) {
1318             int size = version.size();
1319             int oSize = obj.version().size();
1320             int min = Math.min(size, oSize);
1321             for (int i = 0; i &lt; min; i++) {
1322                 int val = version.get(i);
1323                 int oVal = obj.version().get(i);
1324                 if (val != oVal)
1325                     return val - oVal;
1326             }
1327             return size - oSize;
1328         }
1329 
1330         private int comparePre(Version obj) {
1331             Optional&lt;String&gt; oPre = obj.pre();
1332             if (!pre.isPresent()) {
1333                 if (oPre.isPresent())
1334                     return 1;
1335             } else {
1336                 if (!oPre.isPresent())
1337                     return -1;
1338                 String val = pre.get();
1339                 String oVal = oPre.get();
1340                 if (val.matches(&quot;\\d+&quot;)) {
1341                     return (oVal.matches(&quot;\\d+&quot;)
1342                         ? (new BigInteger(val)).compareTo(new BigInteger(oVal))
1343                         : -1);
1344                 } else {
1345                     return (oVal.matches(&quot;\\d+&quot;)
1346                         ? 1
1347                         : val.compareTo(oVal));
1348                 }
1349             }
1350             return 0;
1351         }
1352 
1353         private int compareBuild(Version obj) {
1354             Optional&lt;Integer&gt; oBuild = obj.build();
1355             if (oBuild.isPresent()) {
1356                 return (build.isPresent()
1357                         ? build.get().compareTo(oBuild.get())
1358                         : -1);
1359             } else if (build.isPresent()) {
1360                 return 1;
1361             }
1362             return 0;
1363         }
1364 
1365         private int compareOptional(Version obj) {
1366             Optional&lt;String&gt; oOpt = obj.optional();
1367             if (!optional.isPresent()) {
1368                 if (oOpt.isPresent())
1369                     return -1;
1370             } else {
1371                 if (!oOpt.isPresent())
1372                     return 1;
1373                 return optional.get().compareTo(oOpt.get());
1374             }
1375             return 0;
1376         }
1377 
1378         /**
1379          * Returns a string representation of this version.
1380          *
1381          * @return  The version string
1382          */
1383         @Override
1384         public String toString() {
1385             StringBuilder sb
1386                 = new StringBuilder(version.stream()
1387                     .map(Object::toString)
1388                     .collect(Collectors.joining(&quot;.&quot;)));
1389 
1390             pre.ifPresent(v -&gt; sb.append(&quot;-&quot;).append(v));
1391 
1392             if (build.isPresent()) {
1393                 sb.append(&quot;+&quot;).append(build.get());
1394                 if (optional.isPresent())
1395                     sb.append(&quot;-&quot;).append(optional.get());
1396             } else {
1397                 if (optional.isPresent()) {
1398                     sb.append(pre.isPresent() ? &quot;-&quot; : &quot;+-&quot;);
1399                     sb.append(optional.get());
1400                 }
1401             }
1402 
1403             return sb.toString();
1404         }
1405 
1406         /**
1407          * Determines whether this {@code Version} is equal to another object.
1408          *
1409          * &lt;p&gt; Two {@code Version}s are equal if and only if they represent the
1410          * same version string.
1411          *
1412          * @param  obj
1413          *         The object to which this {@code Version} is to be compared
1414          *
1415          * @return  {@code true} if, and only if, the given object is a {@code
1416          *          Version} that is identical to this {@code Version}
1417          *
1418          */
1419         @Override
1420         public boolean equals(Object obj) {
1421             boolean ret = equalsIgnoreOptional(obj);
1422             if (!ret)
1423                 return false;
1424 
1425             Version that = (Version)obj;
1426             return (this.optional().equals(that.optional()));
1427         }
1428 
1429         /**
1430          * Determines whether this {@code Version} is equal to another
1431          * disregarding optional build information.
1432          *
1433          * &lt;p&gt; Two {@code Version}s are equal if and only if they represent the
1434          * same version string disregarding the optional build information.
1435          *
1436          * @param  obj
1437          *         The object to which this {@code Version} is to be compared
1438          *
1439          * @return  {@code true} if, and only if, the given object is a {@code
1440          *          Version} that is identical to this {@code Version}
1441          *          ignoring the optional build information
1442          *
1443          */
1444         public boolean equalsIgnoreOptional(Object obj) {
1445             if (this == obj)
1446                 return true;
1447             if (!(obj instanceof Version))
1448                 return false;
1449 
1450             Version that = (Version)obj;
1451             return (this.version().equals(that.version())
1452                 &amp;&amp; this.pre().equals(that.pre())
1453                 &amp;&amp; this.build().equals(that.build()));
1454         }
1455 
1456         /**
1457          * Returns the hash code of this version.
1458          *
1459          * @return  The hashcode of this version
1460          */
1461         @Override
1462         public int hashCode() {
1463             int h = 1;
1464             int p = 17;
1465 
1466             h = p * h + version.hashCode();
1467             h = p * h + pre.hashCode();
1468             h = p * h + build.hashCode();
1469             h = p * h + optional.hashCode();
1470 
1471             return h;
1472         }
1473     }
1474 
1475     private static class VersionPattern {
1476         // $VNUM(-$PRE)?(\+($BUILD)?(\-$OPT)?)?
1477         // RE limits the format of version strings
1478         // ([1-9][0-9]*(?:(?:\.0)*\.[1-9][0-9]*)*)(?:-([a-zA-Z0-9]+))?(?:(\+)(0|[1-9][0-9]*)?)?(?:-([-a-zA-Z0-9.]+))?
1479 
1480         private static final String VNUM
1481             = &quot;(?&lt;VNUM&gt;[1-9][0-9]*(?:(?:\\.0)*\\.[1-9][0-9]*)*)&quot;;
1482         private static final String PRE      = &quot;(?:-(?&lt;PRE&gt;[a-zA-Z0-9]+))?&quot;;
1483         private static final String BUILD
1484             = &quot;(?:(?&lt;PLUS&gt;\\+)(?&lt;BUILD&gt;0|[1-9][0-9]*)?)?&quot;;
1485         private static final String OPT      = &quot;(?:-(?&lt;OPT&gt;[-a-zA-Z0-9.]+))?&quot;;
1486         private static final String VSTR_FORMAT = VNUM + PRE + BUILD + OPT;
1487 
1488         static final Pattern VSTR_PATTERN = Pattern.compile(VSTR_FORMAT);
1489 
1490         static final String VNUM_GROUP  = &quot;VNUM&quot;;
1491         static final String PRE_GROUP   = &quot;PRE&quot;;
1492         static final String PLUS_GROUP  = &quot;PLUS&quot;;
1493         static final String BUILD_GROUP = &quot;BUILD&quot;;
1494         static final String OPT_GROUP   = &quot;OPT&quot;;
1495     }
1496 }
    </pre>
  </body>
</html>