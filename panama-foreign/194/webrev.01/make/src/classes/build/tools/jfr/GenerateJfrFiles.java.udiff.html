<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff make/src/classes/build/tools/jfr/GenerateJfrFiles.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../jdk/src/classes/build/tools/classlist/HelloClasslist.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../../../src/hotspot/cpu/aarch64/aarch64.ad.udiff.html" target="_top">next &gt;</a></center>    <h2>make/src/classes/build/tools/jfr/GenerateJfrFiles.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -5,14 +5,14 @@</span>
  import java.io.FileNotFoundException;
  import java.io.FileOutputStream;
  import java.io.IOException;
  import java.io.PrintStream;
  import java.util.ArrayList;
<span class="udiff-line-removed">- import java.util.HashMap;</span>
  import java.util.LinkedHashMap;
  import java.util.List;
  import java.util.Map;
<span class="udiff-line-added">+ import java.util.Map.Entry;</span>
  import java.util.StringJoiner;
  import java.util.function.Predicate;
  
  import javax.xml.XMLConstants;
  import javax.xml.parsers.ParserConfigurationException;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -41,28 +41,95 @@</span>
  
              Metadata metadata = new Metadata(metadataXml, metadataSchema);
              metadata.verify();
              metadata.wireUpTypes();
  
<span class="udiff-line-added">+             TypeCounter typeCounter = new TypeCounter();</span>
<span class="udiff-line-added">+             printJfrEventIdsHpp(metadata, typeCounter, outputDirectory);</span>
<span class="udiff-line-added">+             printJfrTypesHpp(metadata, typeCounter, outputDirectory);</span>
              printJfrPeriodicHpp(metadata, outputDirectory);
<span class="udiff-line-modified-removed">-             printJfrEventIdsHpp(metadata, outputDirectory);</span>
<span class="udiff-line-removed">-             printJfrEventControlHpp(metadata, outputDirectory);</span>
<span class="udiff-line-removed">-             printJfrTypesHpp(metadata, outputDirectory);</span>
<span class="udiff-line-modified-added">+             printJfrEventControlHpp(metadata, typeCounter, outputDirectory);</span>
              printJfrEventClassesHpp(metadata, outputDirectory);
  
          } catch (Exception e) {
              e.printStackTrace();
              System.exit(1);
          }
      }
  
<span class="udiff-line-added">+     static class TypeCounter {</span>
<span class="udiff-line-added">+         final static long RESERVED_EVENT_COUNT = 2;</span>
<span class="udiff-line-added">+         long typeId = -1;</span>
<span class="udiff-line-added">+         long eventId = -1;</span>
<span class="udiff-line-added">+         long eventCount = 0;</span>
<span class="udiff-line-added">+         String firstTypeName;</span>
<span class="udiff-line-added">+         String lastTypeName;</span>
<span class="udiff-line-added">+         String firstEventName;</span>
<span class="udiff-line-added">+         String lastEventname;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         public long nextEventId(String name) {</span>
<span class="udiff-line-added">+             eventCount++;</span>
<span class="udiff-line-added">+             if (eventId == -1) {</span>
<span class="udiff-line-added">+                 eventId = firstEventId();</span>
<span class="udiff-line-added">+                 firstEventName = lastEventname = name;</span>
<span class="udiff-line-added">+                 return eventId;</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+             lastEventname = name;</span>
<span class="udiff-line-added">+             return ++eventId;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         public long nextTypeId(String typeName) {</span>
<span class="udiff-line-added">+             if (typeId == -1) {</span>
<span class="udiff-line-added">+                 lastTypeName = firstTypeName = typeName;</span>
<span class="udiff-line-added">+                 typeId = lastEventId();</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+             lastTypeName = typeName;</span>
<span class="udiff-line-added">+             return ++typeId;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         public long firstEventId() {</span>
<span class="udiff-line-added">+             return RESERVED_EVENT_COUNT;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         public long lastEventId() {</span>
<span class="udiff-line-added">+             return eventId == -1 ? firstEventId() : eventId;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         public long eventCount() {</span>
<span class="udiff-line-added">+             return eventCount;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         public String firstTypeName() {</span>
<span class="udiff-line-added">+             return firstTypeName;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         public String lastTypeName() {</span>
<span class="udiff-line-added">+             return lastTypeName;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         public String firstEventName() {</span>
<span class="udiff-line-added">+             return firstEventName;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         public String lastEventName() {</span>
<span class="udiff-line-added">+             return lastEventname;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      static class XmlType {
<span class="udiff-line-added">+         final String name;</span>
          final String fieldType;
          final String parameterType;
<span class="udiff-line-modified-removed">-         XmlType(String fieldType, String parameterType) {</span>
<span class="udiff-line-modified-added">+         final String javaType;</span>
<span class="udiff-line-added">+         final boolean unsigned;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         XmlType(String name, String fieldType, String parameterType, String javaType, boolean unsigned) {</span>
<span class="udiff-line-added">+             this.name = name;</span>
              this.fieldType = fieldType;
              this.parameterType = parameterType;
<span class="udiff-line-added">+             this.javaType = javaType;</span>
<span class="udiff-line-added">+             this.unsigned = unsigned;</span>
          }
      }
  
      static class TypeElement {
          List&lt;FieldElement&gt; fields = new ArrayList&lt;&gt;();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -72,11 +139,11 @@</span>
          boolean supportStruct;
      }
  
      static class Metadata {
          final Map&lt;String, TypeElement&gt; types = new LinkedHashMap&lt;&gt;();
<span class="udiff-line-modified-removed">-         final Map&lt;String, XmlType&gt; xmlTypes = new HashMap&lt;&gt;();</span>
<span class="udiff-line-modified-added">+         final Map&lt;String, XmlType&gt; xmlTypes = new LinkedHashMap&lt;&gt;();</span>
          Metadata(File metadataXml, File metadataSchema) throws ParserConfigurationException, SAXException, FileNotFoundException, IOException {
              SchemaFactory schemaFactory = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);
              SAXParserFactory factory = SAXParserFactory.newInstance();
              factory.setSchema(schemaFactory.newSchema(metadataSchema));
              SAXParser sp = factory.newSAXParser();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -108,16 +175,12 @@</span>
  
          List&lt;EventElement&gt; getPeriodicEvents() {
              return getList(t -&gt; t.getClass() == EventElement.class &amp;&amp; ((EventElement) t).periodic);
          }
  
<span class="udiff-line-removed">-         List&lt;TypeElement&gt; getNonEventsAndNonStructs() {</span>
<span class="udiff-line-removed">-             return getList(t -&gt; t.getClass() != EventElement.class &amp;&amp; !t.supportStruct);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
          List&lt;TypeElement&gt; getTypes() {
<span class="udiff-line-modified-removed">-             return getList(t -&gt; t.getClass() == TypeElement.class &amp;&amp; !t.supportStruct);</span>
<span class="udiff-line-modified-added">+             return getList(t -&gt; t.getClass() == TypeElement.class);</span>
          }
  
          List&lt;TypeElement&gt; getStructs() {
              return getList(t -&gt; t.getClass() == TypeElement.class &amp;&amp; t.supportStruct);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -211,12 +274,15 @@</span>
              switch (qName) {
              case &quot;XmlType&quot;:
                  String name = attributes.getValue(&quot;name&quot;);
                  String parameterType = attributes.getValue(&quot;parameterType&quot;);
                  String fieldType = attributes.getValue(&quot;fieldType&quot;);
<span class="udiff-line-modified-removed">-                 metadata.xmlTypes.put(name, new XmlType(fieldType, parameterType));</span>
<span class="udiff-line-modified-added">+                 String javaType = attributes.getValue(&quot;javaType&quot;);</span>
<span class="udiff-line-added">+                 boolean unsigned = getBoolean(attributes, &quot;unsigned&quot;, false);</span>
<span class="udiff-line-added">+                 metadata.xmlTypes.put(name, new XmlType(name, fieldType, parameterType, javaType, unsigned));</span>
                  break;
<span class="udiff-line-added">+             case &quot;Relation&quot;:</span>
              case &quot;Type&quot;:
                  currentType = new TypeElement();
                  currentType.name = attributes.getValue(&quot;name&quot;);
                  break;
              case &quot;Event&quot;:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -245,10 +311,11 @@</span>
          }
  
          @Override
          public void endElement(String uri, String localName, String qName) {
              switch (qName) {
<span class="udiff-line-added">+             case &quot;Relation&quot;:</span>
              case &quot;Type&quot;:
              case &quot;Event&quot;:
                  metadata.types.put(currentType.name, currentType);
                  currentType = null;
                  break;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -316,11 +383,11 @@</span>
              out.write(&quot;#endif // INCLUDE_JFR&quot;);
              out.write(&quot;#endif // JFRFILES_JFRPERIODICEVENTSET_HPP&quot;);
          }
      }
  
<span class="udiff-line-modified-removed">-     private static void printJfrEventControlHpp(Metadata metadata, File outputDirectory) throws Exception {</span>
<span class="udiff-line-modified-added">+     private static void printJfrEventControlHpp(Metadata metadata, TypeCounter typeCounter, File outputDirectory) throws Exception {</span>
          try (Printer out = new Printer(outputDirectory, &quot;jfrEventControl.hpp&quot;)) {
              out.write(&quot;#ifndef JFRFILES_JFR_NATIVE_EVENTSETTING_HPP&quot;);
              out.write(&quot;#define JFRFILES_JFR_NATIVE_EVENTSETTING_HPP&quot;);
              out.write(&quot;&quot;);
              out.write(&quot;#include \&quot;utilities/macros.hpp\&quot;&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -335,20 +402,21 @@</span>
              out.write(&quot;struct jfrNativeEventSetting {&quot;);
              out.write(&quot;  jlong  threshold_ticks;&quot;);
              out.write(&quot;  jlong  cutoff_ticks;&quot;);
              out.write(&quot;  u1     stacktrace;&quot;);
              out.write(&quot;  u1     enabled;&quot;);
<span class="udiff-line-modified-removed">-             out.write(&quot;  u1     pad[6]; // Because GCC on linux ia32 at least tries to pack this.&quot;);</span>
<span class="udiff-line-modified-added">+             out.write(&quot;  u1     large;&quot;);</span>
<span class="udiff-line-added">+             out.write(&quot;  u1     pad[5]; // Because GCC on linux ia32 at least tries to pack this.&quot;);</span>
              out.write(&quot;};&quot;);
              out.write(&quot;&quot;);
              out.write(&quot;union JfrNativeSettings {&quot;);
              out.write(&quot;  // Array version.&quot;);
<span class="udiff-line-modified-removed">-             out.write(&quot;  jfrNativeEventSetting bits[MaxJfrEventId];&quot;);</span>
<span class="udiff-line-modified-added">+             out.write(&quot;  jfrNativeEventSetting bits[NUMBER_OF_EVENTS];&quot;);</span>
              out.write(&quot;  // Then, to make it easy to debug,&quot;);
              out.write(&quot;  // add named struct members also.&quot;);
              out.write(&quot;  struct {&quot;);
<span class="udiff-line-modified-removed">-             out.write(&quot;    jfrNativeEventSetting pad[NUM_RESERVED_EVENTS];&quot;);</span>
<span class="udiff-line-modified-added">+             out.write(&quot;    jfrNativeEventSetting pad[NUMBER_OF_RESERVED_EVENTS];&quot;);</span>
              for (TypeElement t : metadata.getEventsAndStructs()) {
                  out.write(&quot;    jfrNativeEventSetting &quot; + t.name + &quot;;&quot;);
              }
              out.write(&quot;  } ev;&quot;);
              out.write(&quot;};&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -356,99 +424,93 @@</span>
              out.write(&quot;#endif // INCLUDE_JFR&quot;);
              out.write(&quot;#endif // JFRFILES_JFR_NATIVE_EVENTSETTING_HPP&quot;);
          }
      }
  
<span class="udiff-line-modified-removed">-     private static void printJfrEventIdsHpp(Metadata metadata, File outputDirectory) throws Exception {</span>
<span class="udiff-line-modified-added">+     private static void printJfrEventIdsHpp(Metadata metadata, TypeCounter typeCounter, File outputDirectory) throws Exception {</span>
          try (Printer out = new Printer(outputDirectory, &quot;jfrEventIds.hpp&quot;)) {
              out.write(&quot;#ifndef JFRFILES_JFREVENTIDS_HPP&quot;);
              out.write(&quot;#define JFRFILES_JFREVENTIDS_HPP&quot;);
              out.write(&quot;&quot;);
              out.write(&quot;#include \&quot;utilities/macros.hpp\&quot;&quot;);
              out.write(&quot;#if INCLUDE_JFR&quot;);
<span class="udiff-line-removed">-             out.write(&quot;#include \&quot;jfrfiles/jfrTypes.hpp\&quot;&quot;);</span>
              out.write(&quot;&quot;);
<span class="udiff-line-removed">-             out.write(&quot;/**&quot;);</span>
<span class="udiff-line-removed">-             out.write(&quot; * Enum of the event types in the JVM&quot;);</span>
<span class="udiff-line-removed">-             out.write(&quot; */&quot;);</span>
              out.write(&quot;enum JfrEventId {&quot;);
<span class="udiff-line-modified-removed">-             out.write(&quot;  _jfreventbase = (NUM_RESERVED_EVENTS-1), // Make sure we start at right index.&quot;);</span>
<span class="udiff-line-modified-removed">-             out.write(&quot;  &quot;);</span>
<span class="udiff-line-modified-removed">-             out.write(&quot;  // Events -&gt; enum entry&quot;);</span>
<span class="udiff-line-modified-removed">-             for (TypeElement t : metadata.getEventsAndStructs()) {</span>
<span class="udiff-line-modified-removed">-                 out.write(&quot;  Jfr&quot; + t.name + &quot;Event,&quot;);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             out.write(&quot;&quot;);</span>
<span class="udiff-line-removed">-             out.write(&quot;  MaxJfrEventId&quot;);</span>
<span class="udiff-line-removed">-             out.write(&quot;};&quot;);</span>
<span class="udiff-line-removed">-             out.write(&quot;&quot;);</span>
<span class="udiff-line-removed">-             out.write(&quot;/**&quot;);</span>
<span class="udiff-line-removed">-             out.write(&quot; * Struct types in the JVM&quot;);</span>
<span class="udiff-line-removed">-             out.write(&quot; */&quot;);</span>
<span class="udiff-line-removed">-             out.write(&quot;enum JfrStructId {&quot;);</span>
<span class="udiff-line-removed">-             for (TypeElement t : metadata.getNonEventsAndNonStructs()) {</span>
<span class="udiff-line-removed">-                 out.write(&quot;  Jfr&quot; + t.name + &quot;Struct,&quot;);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             for (TypeElement t : metadata.getEventsAndStructs()) {</span>
<span class="udiff-line-removed">-                 out.write(&quot;  Jfr&quot; + t.name + &quot;Struct,&quot;);</span>
<span class="udiff-line-modified-added">+             out.write(&quot;  JfrMetadataEvent = 0,&quot;);</span>
<span class="udiff-line-modified-added">+             out.write(&quot;  JfrCheckpointEvent = 1,&quot;);</span>
<span class="udiff-line-modified-added">+             for (TypeElement t : metadata.getEvents()) {</span>
<span class="udiff-line-modified-added">+                 String name = &quot;Jfr&quot; + t.name +&quot;Event&quot;;</span>
<span class="udiff-line-modified-added">+                 out.write(&quot;  &quot; + name + &quot; = &quot; + typeCounter.nextEventId(name) + &quot;,&quot;);</span>
              }
<span class="udiff-line-removed">-             out.write(&quot;&quot;);</span>
<span class="udiff-line-removed">-             out.write(&quot;  MaxJfrStructId&quot;);</span>
              out.write(&quot;};&quot;);
<span class="udiff-line-removed">-             out.write(&quot;&quot;);</span>
              out.write(&quot;typedef enum JfrEventId JfrEventId;&quot;);
<span class="udiff-line-removed">-             out.write(&quot;typedef enum JfrStructId JfrStructId;&quot;);</span>
              out.write(&quot;&quot;);
<span class="udiff-line-added">+             out.write(&quot;static const JfrEventId FIRST_EVENT_ID = &quot; + typeCounter.firstEventName() + &quot;;&quot;);</span>
<span class="udiff-line-added">+             out.write(&quot;static const JfrEventId LAST_EVENT_ID = &quot; + typeCounter.lastEventName() + &quot;;&quot;);</span>
<span class="udiff-line-added">+             out.write(&quot;static const int NUMBER_OF_EVENTS = &quot; + typeCounter.eventCount() + &quot;;&quot;);</span>
<span class="udiff-line-added">+             out.write(&quot;static const int NUMBER_OF_RESERVED_EVENTS = &quot; + TypeCounter.RESERVED_EVENT_COUNT + &quot;;&quot;);</span>
              out.write(&quot;#endif // INCLUDE_JFR&quot;);
              out.write(&quot;#endif // JFRFILES_JFREVENTIDS_HPP&quot;);
          }
      }
  
<span class="udiff-line-modified-removed">-     private static void printJfrTypesHpp(Metadata metadata, File outputDirectory) throws Exception {</span>
<span class="udiff-line-removed">-         List&lt;String&gt; knownTypes = List.of(&quot;Thread&quot;, &quot;StackTrace&quot;, &quot;Class&quot;, &quot;StackFrame&quot;);</span>
<span class="udiff-line-modified-added">+     private static void printJfrTypesHpp(Metadata metadata, TypeCounter typeCounter, File outputDirectory) throws Exception {</span>
          try (Printer out = new Printer(outputDirectory, &quot;jfrTypes.hpp&quot;)) {
              out.write(&quot;#ifndef JFRFILES_JFRTYPES_HPP&quot;);
              out.write(&quot;#define JFRFILES_JFRTYPES_HPP&quot;);
              out.write(&quot;&quot;);
              out.write(&quot;#include \&quot;utilities/macros.hpp\&quot;&quot;);
              out.write(&quot;#if INCLUDE_JFR&quot;);
              out.write(&quot;&quot;);
<span class="udiff-line-added">+             out.write(&quot;#include &lt;string.h&gt;&quot;);</span>
<span class="udiff-line-added">+             out.write(&quot;#include \&quot;memory/allocation.hpp\&quot;&quot;);</span>
<span class="udiff-line-added">+             out.write(&quot;&quot;);</span>
              out.write(&quot;enum JfrTypeId {&quot;);
<span class="udiff-line-modified-removed">-             out.write(&quot;  TYPE_NONE             = 0,&quot;);</span>
<span class="udiff-line-modified-removed">-             out.write(&quot;  TYPE_CLASS            = 20,&quot;);</span>
<span class="udiff-line-modified-removed">-             out.write(&quot;  TYPE_STRING           = 21,&quot;);</span>
<span class="udiff-line-modified-removed">-             out.write(&quot;  TYPE_THREAD           = 22,&quot;);</span>
<span class="udiff-line-modified-removed">-             out.write(&quot;  TYPE_STACKTRACE       = 23,&quot;);</span>
<span class="udiff-line-modified-removed">-             out.write(&quot;  TYPE_BYTES            = 24,&quot;);</span>
<span class="udiff-line-modified-removed">-             out.write(&quot;  TYPE_EPOCHMILLIS      = 25,&quot;);</span>
<span class="udiff-line-modified-removed">-             out.write(&quot;  TYPE_MILLIS           = 26,&quot;);</span>
<span class="udiff-line-modified-removed">-             out.write(&quot;  TYPE_NANOS            = 27,&quot;);</span>
<span class="udiff-line-modified-removed">-             out.write(&quot;  TYPE_TICKS            = 28,&quot;);</span>
<span class="udiff-line-modified-removed">-             out.write(&quot;  TYPE_ADDRESS          = 29,&quot;);</span>
<span class="udiff-line-removed">-             out.write(&quot;  TYPE_PERCENTAGE       = 30,&quot;);</span>
<span class="udiff-line-removed">-             out.write(&quot;  TYPE_DUMMY,&quot;);</span>
<span class="udiff-line-removed">-             out.write(&quot;  TYPE_DUMMY_1,&quot;);</span>
<span class="udiff-line-modified-added">+             Map&lt;String, XmlType&gt; javaTypes = new LinkedHashMap&lt;&gt;();</span>
<span class="udiff-line-modified-added">+             for (var t : metadata.xmlTypes.entrySet()) {</span>
<span class="udiff-line-modified-added">+                 String name = t.getKey();</span>
<span class="udiff-line-modified-added">+                 XmlType xmlType = t.getValue();</span>
<span class="udiff-line-modified-added">+                 if (xmlType.javaType != null &amp;&amp; !xmlType.unsigned) {</span>
<span class="udiff-line-modified-added">+                     String typeName = &quot;TYPE_&quot; + name.toUpperCase();</span>
<span class="udiff-line-modified-added">+                     long typeId = typeCounter.nextTypeId(typeName);</span>
<span class="udiff-line-modified-added">+                     out.write(&quot;  &quot; + typeName + &quot; = &quot; + typeId + &quot;,&quot;);</span>
<span class="udiff-line-modified-added">+                     javaTypes.put(name, xmlType);</span>
<span class="udiff-line-modified-added">+                 }</span>
<span class="udiff-line-modified-added">+             }</span>
              for (TypeElement type : metadata.getTypes()) {
<span class="udiff-line-modified-removed">-                 if (!knownTypes.contains(type.name)) {</span>
<span class="udiff-line-modified-removed">-                     out.write(&quot;  TYPE_&quot; + type.name.toUpperCase() + &quot;,&quot;);</span>
<span class="udiff-line-modified-added">+                 String name = type.name;</span>
<span class="udiff-line-modified-added">+                 if (!javaTypes.containsKey(name)) {</span>
<span class="udiff-line-added">+                     String typeName = &quot;TYPE_&quot; + name.toUpperCase();</span>
<span class="udiff-line-added">+                     long typeId = typeCounter.nextTypeId(typeName);</span>
<span class="udiff-line-added">+                     out.write(&quot;  &quot; + typeName + &quot; = &quot; + typeId + &quot;,&quot;);</span>
                  }
              }
<span class="udiff-line-removed">-             out.write(&quot;&quot;);</span>
<span class="udiff-line-removed">-             out.write(&quot;  NUM_JFR_TYPES,&quot;);</span>
<span class="udiff-line-removed">-             out.write(&quot;  TYPES_END             = 255&quot;);</span>
              out.write(&quot;};&quot;);
              out.write(&quot;&quot;);
<span class="udiff-line-modified-removed">-             out.write(&quot;enum ReservedEvent {&quot;);</span>
<span class="udiff-line-modified-removed">-             out.write(&quot;  EVENT_METADATA,&quot;);</span>
<span class="udiff-line-modified-removed">-             out.write(&quot;  EVENT_CHECKPOINT,&quot;);</span>
<span class="udiff-line-modified-removed">-             out.write(&quot;  EVENT_BUFFERLOST,&quot;);</span>
<span class="udiff-line-modified-removed">-             out.write(&quot;  NUM_RESERVED_EVENTS = TYPES_END&quot;);</span>
<span class="udiff-line-modified-added">+             out.write(&quot;static const JfrTypeId FIRST_TYPE_ID = &quot; + typeCounter.firstTypeName() + &quot;;&quot;);</span>
<span class="udiff-line-modified-added">+             out.write(&quot;static const JfrTypeId LAST_TYPE_ID = &quot; + typeCounter.lastTypeName() + &quot;;&quot;);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+             out.write(&quot;&quot;);</span>
<span class="udiff-line-modified-added">+             out.write(&quot;class JfrType : public AllStatic {&quot;);</span>
<span class="udiff-line-added">+             out.write(&quot; public:&quot;);</span>
<span class="udiff-line-added">+             out.write(&quot;  static jlong name_to_id(const char* type_name) {&quot;);</span>
<span class="udiff-line-added">+             for (Entry&lt;String, XmlType&gt; m : javaTypes.entrySet()) {</span>
<span class="udiff-line-added">+                 XmlType xmlType = m.getValue();</span>
<span class="udiff-line-added">+                 String javaName = xmlType.javaType;</span>
<span class="udiff-line-added">+                 String typeName = xmlType.name.toUpperCase();</span>
<span class="udiff-line-added">+                 out.write(&quot;    if (strcmp(type_name, \&quot;&quot; + javaName + &quot;\&quot;) == 0) {&quot;);</span>
<span class="udiff-line-added">+                 out.write(&quot;      return TYPE_&quot; + typeName + &quot;;&quot;);</span>
<span class="udiff-line-added">+                 out.write(&quot;    }&quot;);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+             out.write(&quot;    return -1;&quot;);</span>
<span class="udiff-line-added">+             out.write(&quot;  }&quot;);</span>
              out.write(&quot;};&quot;);
              out.write(&quot;&quot;);
              out.write(&quot;#endif // INCLUDE_JFR&quot;);
              out.write(&quot;#endif // JFRFILES_JFRTYPES_HPP&quot;);
<span class="udiff-line-modified-removed">-           };</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-added">+         ;</span>
      }
  
      private static void printJfrEventClassesHpp(Metadata metadata, File outputDirectory) throws Exception {
          try (Printer out = new Printer(outputDirectory, &quot;jfrEventClasses.hpp&quot;)) {
              out.write(&quot;#ifndef JFRFILES_JFREVENTCLASSES_HPP&quot;);
</pre>
<center><a href="../../../../../jdk/src/classes/build/tools/classlist/HelloClasslist.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../../../src/hotspot/cpu/aarch64/aarch64.ad.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>