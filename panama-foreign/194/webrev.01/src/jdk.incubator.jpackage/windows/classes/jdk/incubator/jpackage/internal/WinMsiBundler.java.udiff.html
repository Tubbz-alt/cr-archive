<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.incubator.jpackage/windows/classes/jdk/incubator/jpackage/internal/WinMsiBundler.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ExecutableRebrander.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="resources/WinResources.properties.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.incubator.jpackage/windows/classes/jdk/incubator/jpackage/internal/WinMsiBundler.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -246,18 +246,16 @@</span>
  
              wixSourcesBuilder.logWixFeatures();
  
              /********* validate bundle parameters *************/
  
<span class="udiff-line-modified-removed">-             String version = PRODUCT_VERSION.fetchFrom(params);</span>
<span class="udiff-line-modified-removed">-             if (!isVersionStringValid(version)) {</span>
<span class="udiff-line-modified-removed">-                 throw new ConfigException(</span>
<span class="udiff-line-modified-removed">-                         MessageFormat.format(I18N.getString(</span>
<span class="udiff-line-modified-removed">-                                 &quot;error.version-string-wrong-format&quot;), version),</span>
<span class="udiff-line-modified-removed">-                         MessageFormat.format(I18N.getString(</span>
<span class="udiff-line-removed">-                                 &quot;error.version-string-wrong-format.advice&quot;),</span>
<span class="udiff-line-removed">-                                 PRODUCT_VERSION.getID()));</span>
<span class="udiff-line-modified-added">+             try {</span>
<span class="udiff-line-modified-added">+                 String version = PRODUCT_VERSION.fetchFrom(params);</span>
<span class="udiff-line-modified-added">+                 MsiVersion.of(version);</span>
<span class="udiff-line-modified-added">+             } catch (IllegalArgumentException ex) {</span>
<span class="udiff-line-modified-added">+                 throw new ConfigException(ex.getMessage(), I18N.getString(</span>
<span class="udiff-line-modified-added">+                         &quot;error.version-string-wrong-format.advice&quot;), ex);</span>
              }
  
              FileAssociation.verify(FileAssociation.fetchFrom(params));
  
              return true;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -268,61 +266,10 @@</span>
                  throw new ConfigException(re);
              }
          }
      }
  
<span class="udiff-line-removed">-     // https://msdn.microsoft.com/en-us/library/aa370859%28v=VS.85%29.aspx</span>
<span class="udiff-line-removed">-     // The format of the string is as follows:</span>
<span class="udiff-line-removed">-     //     major.minor.build</span>
<span class="udiff-line-removed">-     // The first field is the major version and has a maximum value of 255.</span>
<span class="udiff-line-removed">-     // The second field is the minor version and has a maximum value of 255.</span>
<span class="udiff-line-removed">-     // The third field is called the build version or the update version and</span>
<span class="udiff-line-removed">-     // has a maximum value of 65,535.</span>
<span class="udiff-line-removed">-     static boolean isVersionStringValid(String v) {</span>
<span class="udiff-line-removed">-         if (v == null) {</span>
<span class="udiff-line-removed">-             return true;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         String p[] = v.split(&quot;\\.&quot;);</span>
<span class="udiff-line-removed">-         if (p.length &gt; 3) {</span>
<span class="udiff-line-removed">-             Log.verbose(I18N.getString(</span>
<span class="udiff-line-removed">-                     &quot;message.version-string-too-many-components&quot;));</span>
<span class="udiff-line-removed">-             return false;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         try {</span>
<span class="udiff-line-removed">-             int val = Integer.parseInt(p[0]);</span>
<span class="udiff-line-removed">-             if (val &lt; 0 || val &gt; 255) {</span>
<span class="udiff-line-removed">-                 Log.verbose(I18N.getString(</span>
<span class="udiff-line-removed">-                         &quot;error.version-string-major-out-of-range&quot;));</span>
<span class="udiff-line-removed">-                 return false;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             if (p.length &gt; 1) {</span>
<span class="udiff-line-removed">-                 val = Integer.parseInt(p[1]);</span>
<span class="udiff-line-removed">-                 if (val &lt; 0 || val &gt; 255) {</span>
<span class="udiff-line-removed">-                     Log.verbose(I18N.getString(</span>
<span class="udiff-line-removed">-                             &quot;error.version-string-minor-out-of-range&quot;));</span>
<span class="udiff-line-removed">-                     return false;</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             if (p.length &gt; 2) {</span>
<span class="udiff-line-removed">-                 val = Integer.parseInt(p[2]);</span>
<span class="udiff-line-removed">-                 if (val &lt; 0 || val &gt; 65535) {</span>
<span class="udiff-line-removed">-                     Log.verbose(I18N.getString(</span>
<span class="udiff-line-removed">-                             &quot;error.version-string-build-out-of-range&quot;));</span>
<span class="udiff-line-removed">-                     return false;</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         } catch (NumberFormatException ne) {</span>
<span class="udiff-line-removed">-             Log.verbose(I18N.getString(&quot;error.version-string-part-not-number&quot;));</span>
<span class="udiff-line-removed">-             Log.verbose(ne);</span>
<span class="udiff-line-removed">-             return false;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         return true;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
      private void prepareProto(Map&lt;String, ? super Object&gt; params)
                  throws PackagerException, IOException {
          File appImage = StandardBundlerParam.getPredefinedAppImage(params);
          File appDir = null;
  
</pre>
<center><a href="ExecutableRebrander.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="resources/WinResources.properties.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>