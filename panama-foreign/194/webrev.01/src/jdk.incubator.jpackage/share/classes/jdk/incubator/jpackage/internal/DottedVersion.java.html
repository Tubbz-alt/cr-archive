<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/jdk.incubator.jpackage/share/classes/jdk/incubator/jpackage/internal/DottedVersion.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.incubator.jpackage.internal;
 27 
 28 import java.math.BigInteger;
 29 import java.text.MessageFormat;
 30 import java.util.ArrayList;
 31 import java.util.List;
 32 import java.util.Objects;
 33 import java.util.regex.Pattern;
 34 import java.util.stream.Collectors;
 35 
 36 /**
 37  * Dotted numeric version string.
 38  * E.g.: 1.0.37, 10, 0.5
 39  */
 40 final class DottedVersion implements Comparable&lt;String&gt; {
 41 
 42     DottedVersion(String version) {
 43         greedy = true;
 44         components = parseVersionString(version, greedy);
 45         value = version;
 46     }
 47 
 48     private DottedVersion(String version, boolean greedy) {
 49         this.greedy = greedy;
 50         components = parseVersionString(version, greedy);
 51         value = version;
 52     }
 53 
 54     static DottedVersion greedy(String version) {
 55         return new DottedVersion(version);
 56     }
 57 
 58     static DottedVersion lazy(String version) {
 59         return new DottedVersion(version, false);
 60     }
 61 
 62     @Override
 63     public int compareTo(String o) {
 64         int result = 0;
 65         BigInteger[] otherComponents = parseVersionString(o, greedy);
 66         for (int i = 0; i &lt; Math.max(components.length, otherComponents.length)
 67                 &amp;&amp; result == 0; ++i) {
 68             final BigInteger x;
 69             if (i &lt; components.length) {
 70                 x = components[i];
 71             } else {
 72                 x = BigInteger.ZERO;
 73             }
 74 
 75             final BigInteger y;
 76             if (i &lt; otherComponents.length) {
 77                 y = otherComponents[i];
 78             } else {
 79                 y = BigInteger.ZERO;
 80             }
 81             result = x.compareTo(y);
 82         }
 83 
 84         return result;
 85     }
 86 
 87     private static BigInteger[] parseVersionString(String version, boolean greedy) {
 88         Objects.requireNonNull(version);
 89         if (version.isEmpty()) {
 90             if (!greedy) {
 91                 return new BigInteger[] {BigInteger.ZERO};
 92             }
 93             throw new IllegalArgumentException(I18N.getString(
 94                     &quot;error.version-string-empty&quot;));
 95         }
 96 
 97         int lastNotZeroIdx = -1;
 98         List&lt;BigInteger&gt; components = new ArrayList&lt;&gt;();
 99         for (var component : version.split(&quot;\\.&quot;, -1)) {
100             if (component.isEmpty()) {
101                 if (!greedy) {
102                     break;
103                 }
104 
105                 throw new IllegalArgumentException(MessageFormat.format(
106                         I18N.getString(
107                                 &quot;error.version-string-zero-length-component&quot;),
108                         version));
109             }
110 
111             if (!DIGITS.matcher(component).matches()) {
112                 // Catch &quot;+N&quot; and &quot;-N&quot;  cases.
113                 if (!greedy) {
114                     break;
115                 }
116 
117                 throw new IllegalArgumentException(MessageFormat.format(
118                         I18N.getString(
119                                 &quot;error.version-string-invalid-component&quot;),
120                         version, component));
121             }
122 
123             final BigInteger num;
124             try {
125                 num = new BigInteger(component);
126             } catch (NumberFormatException ex) {
127                 if (!greedy) {
128                     break;
129                 }
130 
131                 throw new IllegalArgumentException(MessageFormat.format(
132                         I18N.getString(
133                                 &quot;error.version-string-invalid-component&quot;),
134                         version, component));
135             }
136 
137             if (num != BigInteger.ZERO) {
138                 lastNotZeroIdx = components.size();
139             }
140             components.add(num);
141         }
142 
143         if (lastNotZeroIdx + 1 != components.size()) {
144             // Strip trailing zeros.
145             components = components.subList(0, lastNotZeroIdx + 1);
146         }
147 
148         if (components.isEmpty()) {
149             components.add(BigInteger.ZERO);
150         }
151         return components.stream()
152                 .collect(Collectors.toList()).toArray(BigInteger[]::new);
153     }
154 
155     @Override
156     public String toString() {
157         return value;
158     }
159 
160     BigInteger[] getComponents() {
161         return components;
162     }
163 
164     final private BigInteger[] components;
165     final private String value;
166     final private boolean greedy;
167 
168     private static final Pattern DIGITS = Pattern.compile(&quot;\\d+&quot;);
169 }
    </pre>
  </body>
</html>