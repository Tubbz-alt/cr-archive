<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.compiler/share/classes/com/sun/tools/javac/comp/Check.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Attr.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="Modules.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.compiler/share/classes/com/sun/tools/javac/comp/Check.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 158,10 ***</span>
<span class="line-new-header">--- 158,12 ---</span>
  
          deferredLintHandler = DeferredLintHandler.instance(context);
  
          allowRecords = (!preview.isPreview(Feature.RECORDS) || preview.isEnabled()) &amp;&amp;
                  Feature.RECORDS.allowedInSource(source);
<span class="line-added">+         allowSealed = (!preview.isPreview(Feature.SEALED_CLASSES) || preview.isEnabled()) &amp;&amp;</span>
<span class="line-added">+                 Feature.SEALED_CLASSES.allowedInSource(source);</span>
      }
  
      /** Character for synthetic names
       */
      char syntheticNameChar;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 193,10 ***</span>
<span class="line-new-header">--- 195,14 ---</span>
  
      /** Are records allowed
       */
      private final boolean allowRecords;
  
<span class="line-added">+     /** Are sealed classes allowed</span>
<span class="line-added">+      */</span>
<span class="line-added">+     private final boolean allowSealed;</span>
<span class="line-added">+ </span>
  /* *************************************************************************
   * Errors and Warnings
   **************************************************************************/
  
      Lint setLint(Lint newLint) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1220,28 ***</span>
                      if (sym.owner.kind == TYP) {
                          log.error(pos, Errors.StaticDeclarationNotAllowedInInnerClasses);
                      }
                  }
              } else if (sym.owner.kind == TYP) {
<span class="line-modified">!                 mask = (flags &amp; RECORD) != 0 ? MemberRecordFlags : MemberClassFlags;</span>
                  if (sym.owner.owner.kind == PCK ||
                      (sym.owner.flags_field &amp; STATIC) != 0)
                      mask |= STATIC;
                  else if ((flags &amp; ENUM) != 0 || (flags &amp; RECORD) != 0) {
                      log.error(pos, Errors.StaticDeclarationNotAllowedInInnerClasses);
                  }
                  // Nested interfaces and enums are always STATIC (Spec ???)
                  if ((flags &amp; (INTERFACE | ENUM | RECORD)) != 0 ) implicit = STATIC;
              } else {
<span class="line-modified">!                 mask = ClassFlags;</span>
              }
              // Interfaces are always ABSTRACT
              if ((flags &amp; INTERFACE) != 0) implicit |= ABSTRACT;
  
              if ((flags &amp; ENUM) != 0) {
<span class="line-modified">!                 // enums can&#39;t be declared abstract or final</span>
<span class="line-modified">!                 mask &amp;= ~(ABSTRACT | FINAL);</span>
                  implicit |= implicitEnumFinalFlag(tree);
              }
              if ((flags &amp; RECORD) != 0) {
                  // records can&#39;t be declared abstract
                  mask &amp;= ~ABSTRACT;
<span class="line-new-header">--- 1226,28 ---</span>
                      if (sym.owner.kind == TYP) {
                          log.error(pos, Errors.StaticDeclarationNotAllowedInInnerClasses);
                      }
                  }
              } else if (sym.owner.kind == TYP) {
<span class="line-modified">!                 mask = (flags &amp; RECORD) != 0 ? MemberRecordFlags : ExtendedMemberClassFlags;</span>
                  if (sym.owner.owner.kind == PCK ||
                      (sym.owner.flags_field &amp; STATIC) != 0)
                      mask |= STATIC;
                  else if ((flags &amp; ENUM) != 0 || (flags &amp; RECORD) != 0) {
                      log.error(pos, Errors.StaticDeclarationNotAllowedInInnerClasses);
                  }
                  // Nested interfaces and enums are always STATIC (Spec ???)
                  if ((flags &amp; (INTERFACE | ENUM | RECORD)) != 0 ) implicit = STATIC;
              } else {
<span class="line-modified">!                 mask = ExtendedClassFlags;</span>
              }
              // Interfaces are always ABSTRACT
              if ((flags &amp; INTERFACE) != 0) implicit |= ABSTRACT;
  
              if ((flags &amp; ENUM) != 0) {
<span class="line-modified">!                 // enums can&#39;t be declared abstract, final, sealed or non-sealed</span>
<span class="line-modified">!                 mask &amp;= ~(ABSTRACT | FINAL | SEALED | NON_SEALED);</span>
                  implicit |= implicitEnumFinalFlag(tree);
              }
              if ((flags &amp; RECORD) != 0) {
                  // records can&#39;t be declared abstract
                  mask &amp;= ~ABSTRACT;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1292,11 ***</span>
                                 VOLATILE)
                   &amp;&amp;
                   (sym.kind == TYP ||
                    checkDisjoint(pos, flags,
                                  ABSTRACT | NATIVE,
<span class="line-modified">!                                 STRICTFP))) {</span>
              // skip
          }
          return flags &amp; (mask | ~ExtendedStandardFlags) | implicit;
      }
  
<span class="line-new-header">--- 1298,17 ---</span>
                                 VOLATILE)
                   &amp;&amp;
                   (sym.kind == TYP ||
                    checkDisjoint(pos, flags,
                                  ABSTRACT | NATIVE,
<span class="line-modified">!                                 STRICTFP))</span>
<span class="line-added">+                  &amp;&amp; checkDisjoint(pos, flags,</span>
<span class="line-added">+                                 FINAL,</span>
<span class="line-added">+                            SEALED | NON_SEALED)</span>
<span class="line-added">+                  &amp;&amp; checkDisjoint(pos, flags,</span>
<span class="line-added">+                                 SEALED,</span>
<span class="line-added">+                            FINAL | NON_SEALED)) {</span>
              // skip
          }
          return flags &amp; (mask | ~ExtendedStandardFlags) | implicit;
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1332,11 ***</span>
  
          SpecialTreeVisitor sts = new SpecialTreeVisitor();
          JCClassDecl cdef = (JCClassDecl) tree;
          for (JCTree defs: cdef.defs) {
              defs.accept(sts);
<span class="line-modified">!             if (sts.specialized) return 0;</span>
          }
          return FINAL;
      }
  
  /* *************************************************************************
<span class="line-new-header">--- 1344,11 ---</span>
  
          SpecialTreeVisitor sts = new SpecialTreeVisitor();
          JCClassDecl cdef = (JCClassDecl) tree;
          for (JCTree defs: cdef.defs) {
              defs.accept(sts);
<span class="line-modified">!             if (sts.specialized) return allowSealed ? SEALED : 0;</span>
          }
          return FINAL;
      }
  
  /* *************************************************************************
</pre>
<center><a href="Attr.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="Modules.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>