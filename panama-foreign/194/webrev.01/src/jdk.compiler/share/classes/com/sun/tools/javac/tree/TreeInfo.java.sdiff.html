<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.compiler/share/classes/com/sun/tools/javac/tree/TreeInfo.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Pretty.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="TreeMaker.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.compiler/share/classes/com/sun/tools/javac/tree/TreeInfo.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1999, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 675             JCTry t = (JCTry) tree;
 676             Assert.checkNonNull(t.finalizer);
 677             return posKind.toPos(t.finalizer);
 678         } else if (tree.hasTag(SYNCHRONIZED)) {
 679             return endPos(((JCSynchronized) tree).body);
 680         } else {
 681             throw new AssertionError();
 682         }
 683     }
 684 
 685     /** Find the position for reporting an error about a symbol, where
 686      *  that symbol is defined somewhere in the given tree. */
 687     public static int positionFor(final Symbol sym, final JCTree tree) {
 688         JCTree decl = declarationFor(sym, tree);
 689         return ((decl != null) ? decl : tree).pos;
 690     }
 691 
 692     /** Find the position for reporting an error about a symbol, where
 693      *  that symbol is defined somewhere in the given tree. */
 694     public static DiagnosticPosition diagnosticPositionFor(final Symbol sym, final JCTree tree) {
<span class="line-modified"> 695         JCTree decl = declarationFor(sym, tree);</span>
<span class="line-removed"> 696         return ((decl != null) ? decl : tree).pos();</span>
 697     }
 698 
<span class="line-modified"> 699     /** Find the declaration for a symbol, where</span>
<span class="line-modified"> 700      *  that symbol is defined somewhere in the given tree. */</span>
<span class="line-modified"> 701     public static JCTree declarationFor(final Symbol sym, final JCTree tree) {</span>
<span class="line-modified"> 702         class DeclScanner extends TreeScanner {</span>
<span class="line-removed"> 703             JCTree result = null;</span>
<span class="line-removed"> 704             public void scan(JCTree tree) {</span>
<span class="line-removed"> 705                 if (tree!=null &amp;&amp; result==null)</span>
<span class="line-removed"> 706                     tree.accept(this);</span>
<span class="line-removed"> 707             }</span>
<span class="line-removed"> 708             public void visitTopLevel(JCCompilationUnit that) {</span>
<span class="line-removed"> 709                 if (that.packge == sym) result = that;</span>
<span class="line-removed"> 710                 else super.visitTopLevel(that);</span>
<span class="line-removed"> 711             }</span>
<span class="line-removed"> 712             public void visitModuleDef(JCModuleDecl that) {</span>
<span class="line-removed"> 713                 if (that.sym == sym) result = that;</span>
<span class="line-removed"> 714                 // no need to scan within module declaration</span>
<span class="line-removed"> 715             }</span>
<span class="line-removed"> 716             public void visitPackageDef(JCPackageDecl that) {</span>
<span class="line-removed"> 717                 if (that.packge == sym) result = that;</span>
<span class="line-removed"> 718                 else super.visitPackageDef(that);</span>
 719             }
<span class="line-modified"> 720             public void visitClassDef(JCClassDecl that) {</span>
<span class="line-modified"> 721                 if (that.sym == sym) result = that;</span>
<span class="line-removed"> 722                 else super.visitClassDef(that);</span>
<span class="line-removed"> 723             }</span>
<span class="line-removed"> 724             public void visitMethodDef(JCMethodDecl that) {</span>
 725                 if (that.sym == sym) result = that;
<span class="line-modified"> 726                 else super.visitMethodDef(that);</span>
 727             }
<span class="line-modified"> 728             public void visitVarDef(JCVariableDecl that) {</span>
 729                 if (that.sym == sym) result = that;
<span class="line-modified"> 730                 else super.visitVarDef(that);</span>
<span class="line-removed"> 731             }</span>
<span class="line-removed"> 732             public void visitTypeParameter(JCTypeParameter that) {</span>
<span class="line-removed"> 733                 if (that.type != null &amp;&amp; that.type.tsym == sym) result = that;</span>
<span class="line-removed"> 734                 else super.visitTypeParameter(that);</span>
 735             }
 736         }
<span class="line-modified"> 737         DeclScanner s = new DeclScanner();</span>
























































 738         tree.accept(s);
 739         return s.result;
 740     }
 741 
 742     public static Env&lt;AttrContext&gt; scopeFor(JCTree node, JCCompilationUnit unit) {
 743         return scopeFor(pathFor(node, unit));
 744     }
 745 
 746     public static Env&lt;AttrContext&gt; scopeFor(List&lt;JCTree&gt; path) {
 747         // TODO: not implemented yet
 748         throw new UnsupportedOperationException(&quot;not implemented yet&quot;);
 749     }
 750 
 751     public static List&lt;JCTree&gt; pathFor(final JCTree node, final JCCompilationUnit unit) {
 752         class Result extends Error {
 753             static final long serialVersionUID = -5942088234594905625L;
 754             List&lt;JCTree&gt; path;
 755             Result(List&lt;JCTree&gt; path) {
 756                 this.path = path;
 757             }
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1999, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 675             JCTry t = (JCTry) tree;
 676             Assert.checkNonNull(t.finalizer);
 677             return posKind.toPos(t.finalizer);
 678         } else if (tree.hasTag(SYNCHRONIZED)) {
 679             return endPos(((JCSynchronized) tree).body);
 680         } else {
 681             throw new AssertionError();
 682         }
 683     }
 684 
 685     /** Find the position for reporting an error about a symbol, where
 686      *  that symbol is defined somewhere in the given tree. */
 687     public static int positionFor(final Symbol sym, final JCTree tree) {
 688         JCTree decl = declarationFor(sym, tree);
 689         return ((decl != null) ? decl : tree).pos;
 690     }
 691 
 692     /** Find the position for reporting an error about a symbol, where
 693      *  that symbol is defined somewhere in the given tree. */
 694     public static DiagnosticPosition diagnosticPositionFor(final Symbol sym, final JCTree tree) {
<span class="line-modified"> 695         return diagnosticPositionFor(sym, tree, false);</span>

 696     }
 697 
<span class="line-modified"> 698     public static DiagnosticPosition diagnosticPositionFor(final Symbol sym, final JCTree tree, boolean returnNullIfNotFound) {</span>
<span class="line-modified"> 699         class DiagScanner extends DeclScanner {</span>
<span class="line-modified"> 700             DiagScanner(Symbol sym) {</span>
<span class="line-modified"> 701                 super(sym);</span>
















 702             }
<span class="line-modified"> 703 </span>
<span class="line-modified"> 704             public void visitIdent(JCIdent that) {</span>



 705                 if (that.sym == sym) result = that;
<span class="line-modified"> 706                 else super.visitIdent(that);</span>
 707             }
<span class="line-modified"> 708             public void visitSelect(JCFieldAccess that) {</span>
 709                 if (that.sym == sym) result = that;
<span class="line-modified"> 710                 else super.visitSelect(that);</span>




 711             }
 712         }
<span class="line-modified"> 713         DiagScanner s = new DiagScanner(sym);</span>
<span class="line-added"> 714         tree.accept(s);</span>
<span class="line-added"> 715         JCTree decl = s.result;</span>
<span class="line-added"> 716         if (decl == null &amp;&amp; returnNullIfNotFound) { return null; }</span>
<span class="line-added"> 717         return ((decl != null) ? decl : tree).pos();</span>
<span class="line-added"> 718     }</span>
<span class="line-added"> 719 </span>
<span class="line-added"> 720     public static DiagnosticPosition diagnosticPositionFor(final Symbol sym, final List&lt;? extends JCTree&gt; trees) {</span>
<span class="line-added"> 721         return trees.stream().map(t -&gt; TreeInfo.diagnosticPositionFor(sym, t)).filter(t -&gt; t != null).findFirst().get();</span>
<span class="line-added"> 722     }</span>
<span class="line-added"> 723 </span>
<span class="line-added"> 724     private static class DeclScanner extends TreeScanner {</span>
<span class="line-added"> 725         final Symbol sym;</span>
<span class="line-added"> 726 </span>
<span class="line-added"> 727         DeclScanner(final Symbol sym) {</span>
<span class="line-added"> 728             this.sym = sym;</span>
<span class="line-added"> 729         }</span>
<span class="line-added"> 730 </span>
<span class="line-added"> 731         JCTree result = null;</span>
<span class="line-added"> 732         public void scan(JCTree tree) {</span>
<span class="line-added"> 733             if (tree!=null &amp;&amp; result==null)</span>
<span class="line-added"> 734                 tree.accept(this);</span>
<span class="line-added"> 735         }</span>
<span class="line-added"> 736         public void visitTopLevel(JCCompilationUnit that) {</span>
<span class="line-added"> 737             if (that.packge == sym) result = that;</span>
<span class="line-added"> 738             else super.visitTopLevel(that);</span>
<span class="line-added"> 739         }</span>
<span class="line-added"> 740         public void visitModuleDef(JCModuleDecl that) {</span>
<span class="line-added"> 741             if (that.sym == sym) result = that;</span>
<span class="line-added"> 742             // no need to scan within module declaration</span>
<span class="line-added"> 743         }</span>
<span class="line-added"> 744         public void visitPackageDef(JCPackageDecl that) {</span>
<span class="line-added"> 745             if (that.packge == sym) result = that;</span>
<span class="line-added"> 746             else super.visitPackageDef(that);</span>
<span class="line-added"> 747         }</span>
<span class="line-added"> 748         public void visitClassDef(JCClassDecl that) {</span>
<span class="line-added"> 749             if (that.sym == sym) result = that;</span>
<span class="line-added"> 750             else super.visitClassDef(that);</span>
<span class="line-added"> 751         }</span>
<span class="line-added"> 752         public void visitMethodDef(JCMethodDecl that) {</span>
<span class="line-added"> 753             if (that.sym == sym) result = that;</span>
<span class="line-added"> 754             else super.visitMethodDef(that);</span>
<span class="line-added"> 755         }</span>
<span class="line-added"> 756         public void visitVarDef(JCVariableDecl that) {</span>
<span class="line-added"> 757             if (that.sym == sym) result = that;</span>
<span class="line-added"> 758             else super.visitVarDef(that);</span>
<span class="line-added"> 759         }</span>
<span class="line-added"> 760         public void visitTypeParameter(JCTypeParameter that) {</span>
<span class="line-added"> 761             if (that.type != null &amp;&amp; that.type.tsym == sym) result = that;</span>
<span class="line-added"> 762             else super.visitTypeParameter(that);</span>
<span class="line-added"> 763         }</span>
<span class="line-added"> 764     }</span>
<span class="line-added"> 765 </span>
<span class="line-added"> 766     /** Find the declaration for a symbol, where</span>
<span class="line-added"> 767      *  that symbol is defined somewhere in the given tree. */</span>
<span class="line-added"> 768     public static JCTree declarationFor(final Symbol sym, final JCTree tree) {</span>
<span class="line-added"> 769         DeclScanner s = new DeclScanner(sym);</span>
 770         tree.accept(s);
 771         return s.result;
 772     }
 773 
 774     public static Env&lt;AttrContext&gt; scopeFor(JCTree node, JCCompilationUnit unit) {
 775         return scopeFor(pathFor(node, unit));
 776     }
 777 
 778     public static Env&lt;AttrContext&gt; scopeFor(List&lt;JCTree&gt; path) {
 779         // TODO: not implemented yet
 780         throw new UnsupportedOperationException(&quot;not implemented yet&quot;);
 781     }
 782 
 783     public static List&lt;JCTree&gt; pathFor(final JCTree node, final JCCompilationUnit unit) {
 784         class Result extends Error {
 785             static final long serialVersionUID = -5942088234594905625L;
 786             List&lt;JCTree&gt; path;
 787             Result(List&lt;JCTree&gt; path) {
 788                 this.path = path;
 789             }
</pre>
</td>
</tr>
</table>
<center><a href="Pretty.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="TreeMaker.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>