<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/security/Signature.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../net/InetAddress.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="cert/CertificateRevokedException.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/security/Signature.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1996, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  29 import java.util.*;
  30 import java.util.concurrent.ConcurrentHashMap;
  31 import java.io.*;
  32 import java.security.cert.Certificate;
  33 import java.security.cert.X509Certificate;
  34 
  35 import java.nio.ByteBuffer;
  36 
  37 import java.security.Provider.Service;
  38 
  39 import javax.crypto.Cipher;
  40 import javax.crypto.IllegalBlockSizeException;
  41 import javax.crypto.BadPaddingException;
  42 import javax.crypto.NoSuchPaddingException;
  43 import jdk.internal.access.JavaSecuritySignatureAccess;
  44 import jdk.internal.access.SharedSecrets;
  45 
  46 import sun.security.util.Debug;
  47 import sun.security.jca.*;
  48 import sun.security.jca.GetInstance.Instance;

  49 
  50 /**
  51  * The Signature class is used to provide applications the functionality
  52  * of a digital signature algorithm. Digital signatures are used for
  53  * authentication and integrity assurance of digital data.
  54  *
  55  * &lt;p&gt; The signature algorithm can be, among others, the NIST standard
  56  * DSA, using DSA and SHA-256. The DSA algorithm using the
  57  * SHA-256 message digest algorithm can be specified as {@code SHA256withDSA}.
  58  * In the case of RSA the signing algorithm could be specified as, for example,
  59  * {@code SHA256withRSA}.
  60  * The algorithm name must be specified, as there is no default.
  61  *
  62  * &lt;p&gt; A Signature object can be used to generate and verify digital
  63  * signatures.
  64  *
  65  * &lt;p&gt; There are three phases to the use of a Signature object for
  66  * either signing data or verifying a signature:&lt;ol&gt;
  67  *
  68  * &lt;li&gt;Initialization, with either
</pre>
<hr />
<pre>
 531         if (!skipDebug &amp;&amp; pdebug != null) {
 532             pdebug.println(&quot;Signature.&quot; + algorithm +
 533                 &quot; verification algorithm from: &quot; + getProviderName());
 534         }
 535     }
 536 
 537     private static PublicKey getPublicKeyFromCert(Certificate cert)
 538             throws InvalidKeyException {
 539         // If the certificate is of type X509Certificate,
 540         // we should check whether it has a Key Usage
 541         // extension marked as critical.
 542         //if (cert instanceof java.security.cert.X509Certificate) {
 543         if (cert instanceof X509Certificate) {
 544             // Check whether the cert has a key usage extension
 545             // marked as a critical extension.
 546             // The OID for KeyUsage extension is 2.5.29.15.
 547             X509Certificate c = (X509Certificate)cert;
 548             Set&lt;String&gt; critSet = c.getCriticalExtensionOIDs();
 549 
 550             if (critSet != null &amp;&amp; !critSet.isEmpty()
<span class="line-modified"> 551                 &amp;&amp; critSet.contains(&quot;2.5.29.15&quot;)) {</span>
 552                 boolean[] keyUsageInfo = c.getKeyUsage();
 553                 // keyUsageInfo[0] is for digitalSignature.
 554                 if ((keyUsageInfo != null) &amp;&amp; (keyUsageInfo[0] == false))
 555                     throw new InvalidKeyException(&quot;Wrong key usage&quot;);
 556             }
 557         }
 558         return cert.getPublicKey();
 559     }
 560 
 561     /**
 562      * Initializes this object for verification, using the public key from
 563      * the given certificate.
 564      * &lt;p&gt;If the certificate is of type X.509 and has a &lt;i&gt;key usage&lt;/i&gt;
 565      * extension field marked as critical, and the value of the &lt;i&gt;key usage&lt;/i&gt;
 566      * extension field implies that the public key in
 567      * the certificate and its corresponding private key are not
 568      * supposed to be used for digital signatures, an
 569      * {@code InvalidKeyException} is thrown.
 570      *
 571      * @param certificate the certificate of the identity whose signature is
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1996, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  29 import java.util.*;
  30 import java.util.concurrent.ConcurrentHashMap;
  31 import java.io.*;
  32 import java.security.cert.Certificate;
  33 import java.security.cert.X509Certificate;
  34 
  35 import java.nio.ByteBuffer;
  36 
  37 import java.security.Provider.Service;
  38 
  39 import javax.crypto.Cipher;
  40 import javax.crypto.IllegalBlockSizeException;
  41 import javax.crypto.BadPaddingException;
  42 import javax.crypto.NoSuchPaddingException;
  43 import jdk.internal.access.JavaSecuritySignatureAccess;
  44 import jdk.internal.access.SharedSecrets;
  45 
  46 import sun.security.util.Debug;
  47 import sun.security.jca.*;
  48 import sun.security.jca.GetInstance.Instance;
<span class="line-added">  49 import sun.security.util.KnownOIDs;</span>
  50 
  51 /**
  52  * The Signature class is used to provide applications the functionality
  53  * of a digital signature algorithm. Digital signatures are used for
  54  * authentication and integrity assurance of digital data.
  55  *
  56  * &lt;p&gt; The signature algorithm can be, among others, the NIST standard
  57  * DSA, using DSA and SHA-256. The DSA algorithm using the
  58  * SHA-256 message digest algorithm can be specified as {@code SHA256withDSA}.
  59  * In the case of RSA the signing algorithm could be specified as, for example,
  60  * {@code SHA256withRSA}.
  61  * The algorithm name must be specified, as there is no default.
  62  *
  63  * &lt;p&gt; A Signature object can be used to generate and verify digital
  64  * signatures.
  65  *
  66  * &lt;p&gt; There are three phases to the use of a Signature object for
  67  * either signing data or verifying a signature:&lt;ol&gt;
  68  *
  69  * &lt;li&gt;Initialization, with either
</pre>
<hr />
<pre>
 532         if (!skipDebug &amp;&amp; pdebug != null) {
 533             pdebug.println(&quot;Signature.&quot; + algorithm +
 534                 &quot; verification algorithm from: &quot; + getProviderName());
 535         }
 536     }
 537 
 538     private static PublicKey getPublicKeyFromCert(Certificate cert)
 539             throws InvalidKeyException {
 540         // If the certificate is of type X509Certificate,
 541         // we should check whether it has a Key Usage
 542         // extension marked as critical.
 543         //if (cert instanceof java.security.cert.X509Certificate) {
 544         if (cert instanceof X509Certificate) {
 545             // Check whether the cert has a key usage extension
 546             // marked as a critical extension.
 547             // The OID for KeyUsage extension is 2.5.29.15.
 548             X509Certificate c = (X509Certificate)cert;
 549             Set&lt;String&gt; critSet = c.getCriticalExtensionOIDs();
 550 
 551             if (critSet != null &amp;&amp; !critSet.isEmpty()
<span class="line-modified"> 552                 &amp;&amp; critSet.contains(KnownOIDs.KeyUsage.value())) {</span>
 553                 boolean[] keyUsageInfo = c.getKeyUsage();
 554                 // keyUsageInfo[0] is for digitalSignature.
 555                 if ((keyUsageInfo != null) &amp;&amp; (keyUsageInfo[0] == false))
 556                     throw new InvalidKeyException(&quot;Wrong key usage&quot;);
 557             }
 558         }
 559         return cert.getPublicKey();
 560     }
 561 
 562     /**
 563      * Initializes this object for verification, using the public key from
 564      * the given certificate.
 565      * &lt;p&gt;If the certificate is of type X.509 and has a &lt;i&gt;key usage&lt;/i&gt;
 566      * extension field marked as critical, and the value of the &lt;i&gt;key usage&lt;/i&gt;
 567      * extension field implies that the public key in
 568      * the certificate and its corresponding private key are not
 569      * supposed to be used for digital signatures, an
 570      * {@code InvalidKeyException} is thrown.
 571      *
 572      * @param certificate the certificate of the identity whose signature is
</pre>
</td>
</tr>
</table>
<center><a href="../net/InetAddress.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="cert/CertificateRevokedException.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>