<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/java/security/cert/X509CertSelector.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="X509CRLSelector.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../util/Arrays.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/security/cert/X509CertSelector.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 115,26 ***</span>
      private X509Certificate x509Cert;
      private boolean matchAllSubjectAltNames = true;
  
      private static final Boolean FALSE = Boolean.FALSE;
  
<span class="line-removed">-     private static final int PRIVATE_KEY_USAGE_ID = 0;</span>
<span class="line-removed">-     private static final int SUBJECT_ALT_NAME_ID = 1;</span>
<span class="line-removed">-     private static final int NAME_CONSTRAINTS_ID = 2;</span>
<span class="line-removed">-     private static final int CERT_POLICIES_ID = 3;</span>
<span class="line-removed">-     private static final int EXTENDED_KEY_USAGE_ID = 4;</span>
<span class="line-removed">-     private static final int NUM_OF_EXTENSIONS = 5;</span>
<span class="line-removed">-     private static final String[] EXTENSION_OIDS = new String[NUM_OF_EXTENSIONS];</span>
<span class="line-removed">- </span>
<span class="line-removed">-     static {</span>
<span class="line-removed">-         EXTENSION_OIDS[PRIVATE_KEY_USAGE_ID]  = &quot;2.5.29.16&quot;;</span>
<span class="line-removed">-         EXTENSION_OIDS[SUBJECT_ALT_NAME_ID]   = &quot;2.5.29.17&quot;;</span>
<span class="line-removed">-         EXTENSION_OIDS[NAME_CONSTRAINTS_ID]   = &quot;2.5.29.30&quot;;</span>
<span class="line-removed">-         EXTENSION_OIDS[CERT_POLICIES_ID]      = &quot;2.5.29.32&quot;;</span>
<span class="line-removed">-         EXTENSION_OIDS[EXTENDED_KEY_USAGE_ID] = &quot;2.5.29.37&quot;;</span>
<span class="line-removed">-     };</span>
<span class="line-removed">- </span>
      /* Constants representing the GeneralName types */
      static final int NAME_ANY = 0;
      static final int NAME_RFC822 = 1;
      static final int NAME_DNS = 2;
      static final int NAME_X400 = 3;
<span class="line-new-header">--- 115,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1938,52 ***</span>
       * by the extension oid.
       * @throws IOException if cannot construct the {@code Extension}
       * object with the extension encoding retrieved from the passed in
       * {@code X509Certificate}.
       */
<span class="line-modified">!     private static Extension getExtensionObject(X509Certificate cert, int extId)</span>
              throws IOException {
          if (cert instanceof X509CertImpl) {
<span class="line-modified">!             X509CertImpl impl = (X509CertImpl)cert;</span>
              switch (extId) {
<span class="line-modified">!             case PRIVATE_KEY_USAGE_ID:</span>
<span class="line-modified">!                 return impl.getPrivateKeyUsageExtension();</span>
<span class="line-modified">!             case SUBJECT_ALT_NAME_ID:</span>
<span class="line-modified">!                 return impl.getSubjectAlternativeNameExtension();</span>
<span class="line-modified">!             case NAME_CONSTRAINTS_ID:</span>
<span class="line-modified">!                 return impl.getNameConstraintsExtension();</span>
<span class="line-modified">!             case CERT_POLICIES_ID:</span>
<span class="line-modified">!                 return impl.getCertificatePoliciesExtension();</span>
<span class="line-modified">!             case EXTENDED_KEY_USAGE_ID:</span>
<span class="line-modified">!                 return impl.getExtendedKeyUsageExtension();</span>
<span class="line-modified">!             default:</span>
<span class="line-modified">!                 return null;</span>
              }
          }
<span class="line-modified">!         byte[] rawExtVal = cert.getExtensionValue(EXTENSION_OIDS[extId]);</span>
          if (rawExtVal == null) {
              return null;
          }
          DerInputStream in = new DerInputStream(rawExtVal);
          byte[] encoded = in.getOctetString();
          switch (extId) {
<span class="line-modified">!         case PRIVATE_KEY_USAGE_ID:</span>
<span class="line-modified">!             try {</span>
<span class="line-modified">!                 return new PrivateKeyUsageExtension(FALSE, encoded);</span>
<span class="line-modified">!             } catch (CertificateException ex) {</span>
<span class="line-modified">!                 throw new IOException(ex.getMessage());</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!         case SUBJECT_ALT_NAME_ID:</span>
<span class="line-modified">!             return new SubjectAlternativeNameExtension(FALSE, encoded);</span>
<span class="line-modified">!         case NAME_CONSTRAINTS_ID:</span>
<span class="line-modified">!             return new NameConstraintsExtension(FALSE, encoded);</span>
<span class="line-modified">!         case CERT_POLICIES_ID:</span>
<span class="line-modified">!             return new CertificatePoliciesExtension(FALSE, encoded);</span>
<span class="line-modified">!         case EXTENDED_KEY_USAGE_ID:</span>
<span class="line-modified">!             return new ExtendedKeyUsageExtension(FALSE, encoded);</span>
<span class="line-modified">!         default:</span>
<span class="line-modified">!             return null;</span>
          }
      }
  
      /**
       * Decides whether a {@code Certificate} should be selected.
<span class="line-new-header">--- 1922,52 ---</span>
       * by the extension oid.
       * @throws IOException if cannot construct the {@code Extension}
       * object with the extension encoding retrieved from the passed in
       * {@code X509Certificate}.
       */
<span class="line-modified">!     private static Extension getExtensionObject(X509Certificate cert, KnownOIDs extId)</span>
              throws IOException {
          if (cert instanceof X509CertImpl) {
<span class="line-modified">!             X509CertImpl impl = (X509CertImpl) cert;</span>
              switch (extId) {
<span class="line-modified">!                 case PrivateKeyUsage:</span>
<span class="line-modified">!                     return impl.getPrivateKeyUsageExtension();</span>
<span class="line-modified">!                 case SubjectAlternativeName:</span>
<span class="line-modified">!                     return impl.getSubjectAlternativeNameExtension();</span>
<span class="line-modified">!                 case NameConstraints:</span>
<span class="line-modified">!                     return impl.getNameConstraintsExtension();</span>
<span class="line-modified">!                 case CertificatePolicies:</span>
<span class="line-modified">!                     return impl.getCertificatePoliciesExtension();</span>
<span class="line-modified">!                 case extendedKeyUsage:</span>
<span class="line-modified">!                     return impl.getExtendedKeyUsageExtension();</span>
<span class="line-modified">!                 default:</span>
<span class="line-modified">!                     return null;</span>
              }
          }
<span class="line-modified">!         byte[] rawExtVal = cert.getExtensionValue(extId.value());</span>
          if (rawExtVal == null) {
              return null;
          }
          DerInputStream in = new DerInputStream(rawExtVal);
          byte[] encoded = in.getOctetString();
          switch (extId) {
<span class="line-modified">!             case PrivateKeyUsage:</span>
<span class="line-modified">!                 try {</span>
<span class="line-modified">!                     return new PrivateKeyUsageExtension(FALSE, encoded);</span>
<span class="line-modified">!                 } catch (CertificateException ex) {</span>
<span class="line-modified">!                     throw new IOException(ex.getMessage());</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!             case SubjectAlternativeName:</span>
<span class="line-modified">!                 return new SubjectAlternativeNameExtension(FALSE, encoded);</span>
<span class="line-modified">!             case NameConstraints:</span>
<span class="line-modified">!                 return new NameConstraintsExtension(FALSE, encoded);</span>
<span class="line-modified">!             case CertificatePolicies:</span>
<span class="line-modified">!                 return new CertificatePoliciesExtension(FALSE, encoded);</span>
<span class="line-modified">!             case extendedKeyUsage:</span>
<span class="line-modified">!                 return new ExtendedKeyUsageExtension(FALSE, encoded);</span>
<span class="line-modified">!             default:</span>
<span class="line-modified">!                 return null;</span>
          }
      }
  
      /**
       * Decides whether a {@code Certificate} should be selected.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2169,11 ***</span>
              return true;
          }
          PrivateKeyUsageExtension ext = null;
          try {
              ext = (PrivateKeyUsageExtension)
<span class="line-modified">!                 getExtensionObject(xcert, PRIVATE_KEY_USAGE_ID);</span>
              if (ext != null) {
                  ext.valid(privateKeyValid);
              }
          } catch (CertificateExpiredException e1) {
              if (debug != null) {
<span class="line-new-header">--- 2153,11 ---</span>
              return true;
          }
          PrivateKeyUsageExtension ext = null;
          try {
              ext = (PrivateKeyUsageExtension)
<span class="line-modified">!                 getExtensionObject(xcert, KnownOIDs.PrivateKeyUsage);</span>
              if (ext != null) {
                  ext.valid(privateKeyValid);
              }
          } catch (CertificateExpiredException e1) {
              if (debug != null) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2281,11 ***</span>
              return true;
          }
          try {
              ExtendedKeyUsageExtension ext =
                  (ExtendedKeyUsageExtension)getExtensionObject(xcert,
<span class="line-modified">!                                                 EXTENDED_KEY_USAGE_ID);</span>
              if (ext != null) {
                  Vector&lt;ObjectIdentifier&gt; certKeyPurposeVector =
                      ext.get(ExtendedKeyUsageExtension.USAGES);
                  if (!certKeyPurposeVector.contains(ANY_EXTENDED_KEY_USAGE)
                          &amp;&amp; !certKeyPurposeVector.containsAll(keyPurposeOIDSet)) {
<span class="line-new-header">--- 2265,11 ---</span>
              return true;
          }
          try {
              ExtendedKeyUsageExtension ext =
                  (ExtendedKeyUsageExtension)getExtensionObject(xcert,
<span class="line-modified">!                                                 KnownOIDs.extendedKeyUsage);</span>
              if (ext != null) {
                  Vector&lt;ObjectIdentifier&gt; certKeyPurposeVector =
                      ext.get(ExtendedKeyUsageExtension.USAGES);
                  if (!certKeyPurposeVector.contains(ANY_EXTENDED_KEY_USAGE)
                          &amp;&amp; !certKeyPurposeVector.containsAll(keyPurposeOIDSet)) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2311,12 ***</span>
          if ((subjectAlternativeNames == null) || subjectAlternativeNames.isEmpty()) {
              return true;
          }
          try {
              SubjectAlternativeNameExtension sanExt =
<span class="line-modified">!                 (SubjectAlternativeNameExtension) getExtensionObject(xcert,</span>
<span class="line-modified">!                                                       SUBJECT_ALT_NAME_ID);</span>
              if (sanExt == null) {
                  if (debug != null) {
                    debug.println(&quot;X509CertSelector.match: &quot;
                        + &quot;no subject alternative name extension&quot;);
                  }
<span class="line-new-header">--- 2295,12 ---</span>
          if ((subjectAlternativeNames == null) || subjectAlternativeNames.isEmpty()) {
              return true;
          }
          try {
              SubjectAlternativeNameExtension sanExt =
<span class="line-modified">!                 (SubjectAlternativeNameExtension) getExtensionObject(</span>
<span class="line-modified">!                         xcert, KnownOIDs.SubjectAlternativeName);</span>
              if (sanExt == null) {
                  if (debug != null) {
                    debug.println(&quot;X509CertSelector.match: &quot;
                        + &quot;no subject alternative name extension&quot;);
                  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2381,11 ***</span>
          if (policy == null) {
              return true;
          }
          try {
              CertificatePoliciesExtension ext = (CertificatePoliciesExtension)
<span class="line-modified">!                 getExtensionObject(xcert, CERT_POLICIES_ID);</span>
              if (ext == null) {
                  if (debug != null) {
                    debug.println(&quot;X509CertSelector.match: &quot;
                        + &quot;no certificate policy extension&quot;);
                  }
<span class="line-new-header">--- 2365,11 ---</span>
          if (policy == null) {
              return true;
          }
          try {
              CertificatePoliciesExtension ext = (CertificatePoliciesExtension)
<span class="line-modified">!                 getExtensionObject(xcert, KnownOIDs.CertificatePolicies);</span>
              if (ext == null) {
                  if (debug != null) {
                    debug.println(&quot;X509CertSelector.match: &quot;
                        + &quot;no certificate policy extension&quot;);
                  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2446,11 ***</span>
          if (pathToGeneralNames == null) {
              return true;
          }
          try {
              NameConstraintsExtension ext = (NameConstraintsExtension)
<span class="line-modified">!                 getExtensionObject(xcert, NAME_CONSTRAINTS_ID);</span>
              if (ext == null) {
                  return true;
              }
              if ((debug != null) &amp;&amp; Debug.isOn(&quot;certpath&quot;)) {
                  debug.println(&quot;X509CertSelector.match pathToNames:\n&quot;);
<span class="line-new-header">--- 2430,11 ---</span>
          if (pathToGeneralNames == null) {
              return true;
          }
          try {
              NameConstraintsExtension ext = (NameConstraintsExtension)
<span class="line-modified">!                 getExtensionObject(xcert, KnownOIDs.NameConstraints);</span>
              if (ext == null) {
                  return true;
              }
              if ((debug != null) &amp;&amp; Debug.isOn(&quot;certpath&quot;)) {
                  debug.println(&quot;X509CertSelector.match pathToNames:\n&quot;);
</pre>
<center><a href="X509CRLSelector.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../util/Arrays.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>