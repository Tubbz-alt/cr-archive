<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/sun/security/ssl/TransportContext.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="SessionTicketExtension.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../util/KnownOIDs.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/ssl/TransportContext.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -62,10 +62,27 @@</span>
      boolean                         isInputCloseNotified = false;
      boolean                         peerUserCanceled = false;
      Exception                       closeReason = null;
      Exception                       delegatedThrown = null;
  
<span class="udiff-line-added">+     // For TLS 1.3 full handshake, the last handshake flight could be wrapped</span>
<span class="udiff-line-added">+     // and encrypted in one record and delegated task would be used.  There is</span>
<span class="udiff-line-added">+     // no chance to return FINISHED handshake status with SSLEngine.(un)wrap().</span>
<span class="udiff-line-added">+     // However, per the HandshakeStatus.FINISHED specification, this value is</span>
<span class="udiff-line-added">+     // only generated by a call to SSLEngine.wrap()/unwrap() and it is never</span>
<span class="udiff-line-added">+     // generated by SSLEngine.getHandshakeStatus().</span>
<span class="udiff-line-added">+     //</span>
<span class="udiff-line-added">+     // In order to workaround this case for TLS 1.3, the FINISHED status is</span>
<span class="udiff-line-added">+     // present with SSLEngine.wrap() while delivering of the NewSessionTicket</span>
<span class="udiff-line-added">+     // post-handshake message.  If this post-handshake message is not needed,</span>
<span class="udiff-line-added">+     // a follow-on SSLEngine.wrap() should be called to indicate the FINISHED</span>
<span class="udiff-line-added">+     // handshake status.  Although this special SSLEngine.wrap() should not</span>
<span class="udiff-line-added">+     // consume or produce any application or network data.</span>
<span class="udiff-line-added">+     boolean                         needHandshakeFinishedStatus = false;</span>
<span class="udiff-line-added">+     boolean                         hasDelegatedFinished = false;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
      // negotiated security parameters
      SSLSessionImpl                  conSession;
      ProtocolVersion                 protocolVersion;
      String                          applicationProtocol= null;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -587,10 +604,13 @@</span>
                  }
              } else if (!isOutboundClosed()) {
                  // Special case that the inbound was closed, but outbound open.
                  return HandshakeStatus.NEED_WRAP;
              }   // Otherwise, both inbound and outbound are closed.
<span class="udiff-line-added">+         } else if (needHandshakeFinishedStatus) {</span>
<span class="udiff-line-added">+             // Special case to get FINISHED status for TLS 1.3 full handshake.</span>
<span class="udiff-line-added">+             return HandshakeStatus.NEED_WRAP;</span>
          }
  
          return HandshakeStatus.NOT_HANDSHAKING;
      }
  
</pre>
<center><a href="SessionTicketExtension.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../util/KnownOIDs.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>