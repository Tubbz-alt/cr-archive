<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/pkcs12/PKCS12KeyStore.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../jdk/internal/org/objectweb/asm/util/TraceClassVisitor.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../provider/certpath/AdaptableX509CertSelector.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/pkcs12/PKCS12KeyStore.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
2216         allCerts.clear();
2217         keyList.clear();
2218     }
2219 
2220     /**
2221      * Find the issuer of input in allCerts. If the input has an
2222      * AuthorityKeyIdentifier extension and the keyId inside matches
2223      * the keyId of the SubjectKeyIdentifier of a cert. This cert is
2224      * returned. Otherwise, a cert whose subjectDN is the same as the
2225      * input&#39;s issuerDN is returned.
2226      *
2227      * @param input the input certificate
2228      * @return the isssuer, or null if none matches
2229      */
2230     private X509Certificate findIssuer(X509Certificate input) {
2231 
2232         X509Certificate fallback = null; // the DN match
2233         X500Principal issuerPrinc = input.getIssuerX500Principal();
2234 
2235         // AuthorityKeyIdentifier value encoded as an OCTET STRING
<span class="line-modified">2236         byte[] issuerIdExtension = input.getExtensionValue(&quot;2.5.29.35&quot;);</span>

2237         byte[] issuerId = null;
2238 
2239         if (issuerIdExtension != null) {
2240             try {
2241                 issuerId = new AuthorityKeyIdentifierExtension(
2242                             false,
2243                             new DerValue(issuerIdExtension).getOctetString())
2244                         .getEncodedKeyIdentifier();
2245             } catch (IOException e) {
2246                 // ignored. issuerId is still null
2247             }
2248         }
2249 
2250         for (X509Certificate cert : allCerts) {
2251             if (cert.getSubjectX500Principal().equals(issuerPrinc)) {
2252                 if (issuerId != null) {
2253                     // SubjectKeyIdentifier value encoded as an OCTET STRING
<span class="line-modified">2254                     byte[] subjectIdExtension = cert.getExtensionValue(&quot;2.5.29.14&quot;);</span>

2255                     byte[] subjectId = null;
2256                     if (subjectIdExtension != null) {
2257                         try {
2258                             subjectId = new DerValue(subjectIdExtension)
2259                                     .getOctetString();
2260                         } catch (IOException e) {
2261                             // ignored. issuerId is still null
2262                         }
2263                     }
2264                     if (subjectId != null) {
2265                         if (Arrays.equals(issuerId, subjectId)) {
2266                             // keyId exact match!
2267                             return cert;
2268                         } else {
2269                             // Different keyId. Not a fallback.
2270                             continue;
2271                         }
2272                     } else {
2273                         // A DN match with no subjectId
2274                         fallback = cert;
</pre>
</td>
<td>
<hr />
<pre>
2216         allCerts.clear();
2217         keyList.clear();
2218     }
2219 
2220     /**
2221      * Find the issuer of input in allCerts. If the input has an
2222      * AuthorityKeyIdentifier extension and the keyId inside matches
2223      * the keyId of the SubjectKeyIdentifier of a cert. This cert is
2224      * returned. Otherwise, a cert whose subjectDN is the same as the
2225      * input&#39;s issuerDN is returned.
2226      *
2227      * @param input the input certificate
2228      * @return the isssuer, or null if none matches
2229      */
2230     private X509Certificate findIssuer(X509Certificate input) {
2231 
2232         X509Certificate fallback = null; // the DN match
2233         X500Principal issuerPrinc = input.getIssuerX500Principal();
2234 
2235         // AuthorityKeyIdentifier value encoded as an OCTET STRING
<span class="line-modified">2236         byte[] issuerIdExtension = input.getExtensionValue(</span>
<span class="line-added">2237                 KnownOIDs.AuthorityKeyID.value());</span>
2238         byte[] issuerId = null;
2239 
2240         if (issuerIdExtension != null) {
2241             try {
2242                 issuerId = new AuthorityKeyIdentifierExtension(
2243                             false,
2244                             new DerValue(issuerIdExtension).getOctetString())
2245                         .getEncodedKeyIdentifier();
2246             } catch (IOException e) {
2247                 // ignored. issuerId is still null
2248             }
2249         }
2250 
2251         for (X509Certificate cert : allCerts) {
2252             if (cert.getSubjectX500Principal().equals(issuerPrinc)) {
2253                 if (issuerId != null) {
2254                     // SubjectKeyIdentifier value encoded as an OCTET STRING
<span class="line-modified">2255                     byte[] subjectIdExtension = cert.getExtensionValue(</span>
<span class="line-added">2256                             KnownOIDs.SubjectKeyID.value());</span>
2257                     byte[] subjectId = null;
2258                     if (subjectIdExtension != null) {
2259                         try {
2260                             subjectId = new DerValue(subjectIdExtension)
2261                                     .getOctetString();
2262                         } catch (IOException e) {
2263                             // ignored. issuerId is still null
2264                         }
2265                     }
2266                     if (subjectId != null) {
2267                         if (Arrays.equals(issuerId, subjectId)) {
2268                             // keyId exact match!
2269                             return cert;
2270                         } else {
2271                             // Different keyId. Not a fallback.
2272                             continue;
2273                         }
2274                     } else {
2275                         // A DN match with no subjectId
2276                         fallback = cert;
</pre>
</td>
</tr>
</table>
<center><a href="../../../jdk/internal/org/objectweb/asm/util/TraceClassVisitor.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../provider/certpath/AdaptableX509CertSelector.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>