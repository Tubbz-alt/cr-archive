<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/sun/security/ssl/HandshakeContext.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="Finished.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="NewSessionTicket.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/ssl/HandshakeContext.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2018, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -414,10 +414,45 @@</span>
  
                  delegatedActions.add(new SimpleImmutableEntry&lt;&gt;(
                          handshakeType,
                          fragment
                      ));
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                 // For TLS 1.2 and previous versions, the ChangeCipherSpec</span>
<span class="udiff-line-added">+                 // message is always delivered before the Finished handshake</span>
<span class="udiff-line-added">+                 // message.  ChangeCipherSpec is not a handshake message,</span>
<span class="udiff-line-added">+                 // and cannot be wrapped in one TLS record.  The processing</span>
<span class="udiff-line-added">+                 // of Finished handshake message is unlikely to be delegated.</span>
<span class="udiff-line-added">+                 //</span>
<span class="udiff-line-added">+                 // However, for TLS 1.3 there is no non-handshake messages</span>
<span class="udiff-line-added">+                 // delivered immediately before Finished message.  Then, the</span>
<span class="udiff-line-added">+                 // &#39;hasDelegated&#39; could be true, and the Finished message is</span>
<span class="udiff-line-added">+                 // handled in a delegated action.</span>
<span class="udiff-line-added">+                 //</span>
<span class="udiff-line-added">+                 // The HandshakeStatus.FINISHED for the final handshake flight</span>
<span class="udiff-line-added">+                 // could be used to determine if the handshake has completed.</span>
<span class="udiff-line-added">+                 // Per the HandshakeStatus.FINISHED specification, it is only</span>
<span class="udiff-line-added">+                 // generated by call to SSLEngine.wrap()/unwrap().  It is</span>
<span class="udiff-line-added">+                 // unlikely to change the spec, so we cannot use delegated</span>
<span class="udiff-line-added">+                 // action and SSLEngine.getHandshakeStatus() to indicate the</span>
<span class="udiff-line-added">+                 // FINISHED handshake status.</span>
<span class="udiff-line-added">+                 //</span>
<span class="udiff-line-added">+                 // To workaround this special user case, the follow-on call to</span>
<span class="udiff-line-added">+                 // SSLEngine.wrap() method will return HandshakeStatus.FINISHED</span>
<span class="udiff-line-added">+                 // status if needed.</span>
<span class="udiff-line-added">+                 //</span>
<span class="udiff-line-added">+                 // As the final handshake flight is always delivered from the</span>
<span class="udiff-line-added">+                 // client side, so we only need to take care of the server</span>
<span class="udiff-line-added">+                 // dispatching processes.</span>
<span class="udiff-line-added">+                 //</span>
<span class="udiff-line-added">+                 // See also the note on</span>
<span class="udiff-line-added">+                 // TransportContext.needHandshakeFinishedStatus.</span>
<span class="udiff-line-added">+                 if (hasDelegated &amp;&amp;</span>
<span class="udiff-line-added">+                         !conContext.sslConfig.isClientMode &amp;&amp;</span>
<span class="udiff-line-added">+                         handshakeType == SSLHandshake.FINISHED.id) {</span>
<span class="udiff-line-added">+                     conContext.hasDelegatedFinished = true;</span>
<span class="udiff-line-added">+                 }</span>
              } else {
                  dispatch(handshakeType, plaintext.fragment);
              }
          } else {
              dispatch(handshakeType, plaintext.fragment);
</pre>
<center><a href="Finished.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="NewSessionTicket.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>