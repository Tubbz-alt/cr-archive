<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/unix/classes/java/io/UnixFileSystem.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../share/native/libjava/Class.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../../java.compiler/share/classes/javax/lang/model/SourceVersion.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/unix/classes/java/io/UnixFileSystem.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 1998, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 1998, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 62,18 ***</span>
      }
  
      /* A normal Unix pathname contains no duplicate slashes and does not end
         with a slash.  It may be the empty string. */
  
<span class="line-modified">!     /* Normalize the given pathname, whose length is len, starting at the given</span>
<span class="line-modified">!        offset; everything before this offset is already normal. */</span>
<span class="line-modified">!     private String normalize(String pathname, int len, int off) {</span>
<span class="line-modified">!         if (len == 0) return pathname;</span>
<span class="line-modified">!         int n = len;</span>
<span class="line-modified">!         while ((n &gt; 0) &amp;&amp; (pathname.charAt(n - 1) == &#39;/&#39;)) n--;</span>
          if (n == 0) return &quot;/&quot;;
<span class="line-modified">!         StringBuilder sb = new StringBuilder(pathname.length());</span>
          if (off &gt; 0) sb.append(pathname, 0, off);
          char prevChar = 0;
          for (int i = off; i &lt; n; i++) {
              char c = pathname.charAt(i);
              if ((prevChar == &#39;/&#39;) &amp;&amp; (c == &#39;/&#39;)) continue;
<span class="line-new-header">--- 62,22 ---</span>
      }
  
      /* A normal Unix pathname contains no duplicate slashes and does not end
         with a slash.  It may be the empty string. */
  
<span class="line-modified">!     /**</span>
<span class="line-modified">!      * Normalize the given pathname, starting at the given</span>
<span class="line-modified">!      * offset; everything before off is already normal, and there&#39;s at least</span>
<span class="line-modified">!      * one duplicate or trailing slash to be removed</span>
<span class="line-modified">!      */</span>
<span class="line-modified">!     private String normalize(String pathname, int off) {</span>
<span class="line-added">+         int n = pathname.length();</span>
<span class="line-added">+         while ((n &gt; off) &amp;&amp; (pathname.charAt(n - 1) == &#39;/&#39;)) n--;</span>
          if (n == 0) return &quot;/&quot;;
<span class="line-modified">!         if (n == off) return pathname.substring(0, off);</span>
<span class="line-added">+ </span>
<span class="line-added">+         StringBuilder sb = new StringBuilder(n);</span>
          if (off &gt; 0) sb.append(pathname, 0, off);
          char prevChar = 0;
          for (int i = off; i &lt; n; i++) {
              char c = pathname.charAt(i);
              if ((prevChar == &#39;/&#39;) &amp;&amp; (c == &#39;/&#39;)) continue;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 86,26 ***</span>
      /* Check that the given pathname is normal.  If not, invoke the real
         normalizer on the part of the pathname that requires normalization.
         This way we iterate through the whole pathname string only once. */
      @Override
      public String normalize(String pathname) {
<span class="line-modified">!         int n = pathname.length();</span>
<span class="line-modified">!         char prevChar = 0;</span>
<span class="line-modified">!         for (int i = 0; i &lt; n; i++) {</span>
<span class="line-modified">!             char c = pathname.charAt(i);</span>
<span class="line-modified">!             if ((prevChar == &#39;/&#39;) &amp;&amp; (c == &#39;/&#39;))</span>
<span class="line-modified">!                 return normalize(pathname, n, i - 1);</span>
<span class="line-removed">-             prevChar = c;</span>
          }
<span class="line-removed">-         if (prevChar == &#39;/&#39;) return normalize(pathname, n, n - 1);</span>
          return pathname;
      }
  
      @Override
      public int prefixLength(String pathname) {
<span class="line-modified">!         if (pathname.isEmpty()) return 0;</span>
<span class="line-removed">-         return (pathname.charAt(0) == &#39;/&#39;) ? 1 : 0;</span>
      }
  
      @Override
      public String resolve(String parent, String child) {
          if (child.isEmpty()) return parent;
<span class="line-new-header">--- 90,23 ---</span>
      /* Check that the given pathname is normal.  If not, invoke the real
         normalizer on the part of the pathname that requires normalization.
         This way we iterate through the whole pathname string only once. */
      @Override
      public String normalize(String pathname) {
<span class="line-modified">!         int doubleSlash = pathname.indexOf(&quot;//&quot;);</span>
<span class="line-modified">!         if (doubleSlash &gt;= 0) {</span>
<span class="line-modified">!             return normalize(pathname, doubleSlash);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         if (pathname.endsWith(&quot;/&quot;)) {</span>
<span class="line-modified">!             return normalize(pathname, pathname.length() - 1);</span>
          }
          return pathname;
      }
  
      @Override
      public int prefixLength(String pathname) {
<span class="line-modified">!         return pathname.startsWith(&quot;/&quot;) ? 1 : 0;</span>
      }
  
      @Override
      public String resolve(String parent, String child) {
          if (child.isEmpty()) return parent;
</pre>
<center><a href="../../../../share/native/libjava/Class.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../../java.compiler/share/classes/javax/lang/model/SourceVersion.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>