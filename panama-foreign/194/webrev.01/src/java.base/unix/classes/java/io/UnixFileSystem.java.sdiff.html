<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/unix/classes/java/io/UnixFileSystem.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../share/native/libjava/Class.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../../java.compiler/share/classes/javax/lang/model/SourceVersion.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/unix/classes/java/io/UnixFileSystem.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1998, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 47         cache = useCanonCaches ? new ExpiringCache() : null;
 48         javaHomePrefixCache = useCanonPrefixCache ? new ExpiringCache() : null;
 49     }
 50 
 51 
 52     /* -- Normalization and construction -- */
 53 
 54     @Override
 55     public char getSeparator() {
 56         return slash;
 57     }
 58 
 59     @Override
 60     public char getPathSeparator() {
 61         return colon;
 62     }
 63 
 64     /* A normal Unix pathname contains no duplicate slashes and does not end
 65        with a slash.  It may be the empty string. */
 66 
<span class="line-modified"> 67     /* Normalize the given pathname, whose length is len, starting at the given</span>
<span class="line-modified"> 68        offset; everything before this offset is already normal. */</span>
<span class="line-modified"> 69     private String normalize(String pathname, int len, int off) {</span>
<span class="line-modified"> 70         if (len == 0) return pathname;</span>
<span class="line-modified"> 71         int n = len;</span>
<span class="line-modified"> 72         while ((n &gt; 0) &amp;&amp; (pathname.charAt(n - 1) == &#39;/&#39;)) n--;</span>


 73         if (n == 0) return &quot;/&quot;;
<span class="line-modified"> 74         StringBuilder sb = new StringBuilder(pathname.length());</span>


 75         if (off &gt; 0) sb.append(pathname, 0, off);
 76         char prevChar = 0;
 77         for (int i = off; i &lt; n; i++) {
 78             char c = pathname.charAt(i);
 79             if ((prevChar == &#39;/&#39;) &amp;&amp; (c == &#39;/&#39;)) continue;
 80             sb.append(c);
 81             prevChar = c;
 82         }
 83         return sb.toString();
 84     }
 85 
 86     /* Check that the given pathname is normal.  If not, invoke the real
 87        normalizer on the part of the pathname that requires normalization.
 88        This way we iterate through the whole pathname string only once. */
 89     @Override
 90     public String normalize(String pathname) {
<span class="line-modified"> 91         int n = pathname.length();</span>
<span class="line-modified"> 92         char prevChar = 0;</span>
<span class="line-modified"> 93         for (int i = 0; i &lt; n; i++) {</span>
<span class="line-modified"> 94             char c = pathname.charAt(i);</span>
<span class="line-modified"> 95             if ((prevChar == &#39;/&#39;) &amp;&amp; (c == &#39;/&#39;))</span>
<span class="line-modified"> 96                 return normalize(pathname, n, i - 1);</span>
<span class="line-removed"> 97             prevChar = c;</span>
 98         }
<span class="line-removed"> 99         if (prevChar == &#39;/&#39;) return normalize(pathname, n, n - 1);</span>
100         return pathname;
101     }
102 
103     @Override
104     public int prefixLength(String pathname) {
<span class="line-modified">105         if (pathname.isEmpty()) return 0;</span>
<span class="line-removed">106         return (pathname.charAt(0) == &#39;/&#39;) ? 1 : 0;</span>
107     }
108 
109     @Override
110     public String resolve(String parent, String child) {
111         if (child.isEmpty()) return parent;
112         if (child.charAt(0) == &#39;/&#39;) {
113             if (parent.equals(&quot;/&quot;)) return child;
114             return parent + child;
115         }
116         if (parent.equals(&quot;/&quot;)) return parent + child;
117         return parent + &#39;/&#39; + child;
118     }
119 
120     @Override
121     public String getDefaultParent() {
122         return &quot;/&quot;;
123     }
124 
125     @Override
126     public String fromURIPath(String path) {
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1998, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 47         cache = useCanonCaches ? new ExpiringCache() : null;
 48         javaHomePrefixCache = useCanonPrefixCache ? new ExpiringCache() : null;
 49     }
 50 
 51 
 52     /* -- Normalization and construction -- */
 53 
 54     @Override
 55     public char getSeparator() {
 56         return slash;
 57     }
 58 
 59     @Override
 60     public char getPathSeparator() {
 61         return colon;
 62     }
 63 
 64     /* A normal Unix pathname contains no duplicate slashes and does not end
 65        with a slash.  It may be the empty string. */
 66 
<span class="line-modified"> 67     /**</span>
<span class="line-modified"> 68      * Normalize the given pathname, starting at the given</span>
<span class="line-modified"> 69      * offset; everything before off is already normal, and there&#39;s at least</span>
<span class="line-modified"> 70      * one duplicate or trailing slash to be removed</span>
<span class="line-modified"> 71      */</span>
<span class="line-modified"> 72     private String normalize(String pathname, int off) {</span>
<span class="line-added"> 73         int n = pathname.length();</span>
<span class="line-added"> 74         while ((n &gt; off) &amp;&amp; (pathname.charAt(n - 1) == &#39;/&#39;)) n--;</span>
 75         if (n == 0) return &quot;/&quot;;
<span class="line-modified"> 76         if (n == off) return pathname.substring(0, off);</span>
<span class="line-added"> 77 </span>
<span class="line-added"> 78         StringBuilder sb = new StringBuilder(n);</span>
 79         if (off &gt; 0) sb.append(pathname, 0, off);
 80         char prevChar = 0;
 81         for (int i = off; i &lt; n; i++) {
 82             char c = pathname.charAt(i);
 83             if ((prevChar == &#39;/&#39;) &amp;&amp; (c == &#39;/&#39;)) continue;
 84             sb.append(c);
 85             prevChar = c;
 86         }
 87         return sb.toString();
 88     }
 89 
 90     /* Check that the given pathname is normal.  If not, invoke the real
 91        normalizer on the part of the pathname that requires normalization.
 92        This way we iterate through the whole pathname string only once. */
 93     @Override
 94     public String normalize(String pathname) {
<span class="line-modified"> 95         int doubleSlash = pathname.indexOf(&quot;//&quot;);</span>
<span class="line-modified"> 96         if (doubleSlash &gt;= 0) {</span>
<span class="line-modified"> 97             return normalize(pathname, doubleSlash);</span>
<span class="line-modified"> 98         }</span>
<span class="line-modified"> 99         if (pathname.endsWith(&quot;/&quot;)) {</span>
<span class="line-modified">100             return normalize(pathname, pathname.length() - 1);</span>

101         }

102         return pathname;
103     }
104 
105     @Override
106     public int prefixLength(String pathname) {
<span class="line-modified">107         return pathname.startsWith(&quot;/&quot;) ? 1 : 0;</span>

108     }
109 
110     @Override
111     public String resolve(String parent, String child) {
112         if (child.isEmpty()) return parent;
113         if (child.charAt(0) == &#39;/&#39;) {
114             if (parent.equals(&quot;/&quot;)) return child;
115             return parent + child;
116         }
117         if (parent.equals(&quot;/&quot;)) return parent + child;
118         return parent + &#39;/&#39; + child;
119     }
120 
121     @Override
122     public String getDefaultParent() {
123         return &quot;/&quot;;
124     }
125 
126     @Override
127     public String fromURIPath(String path) {
</pre>
</td>
</tr>
</table>
<center><a href="../../../../share/native/libjava/Class.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../../java.compiler/share/classes/javax/lang/model/SourceVersion.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>