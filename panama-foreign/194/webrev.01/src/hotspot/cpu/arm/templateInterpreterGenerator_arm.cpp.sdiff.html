<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/cpu/arm/templateInterpreterGenerator_arm.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="methodHandles_arm.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../ppc/c1_CodeStubs_ppc.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/arm/templateInterpreterGenerator_arm.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 691   //    1. The &quot;intrinsified&quot; code performing an ON_WEAK_OOP_REF load,
 692   //    2. The slow path - which is an expansion of the regular method entry.
 693   //
 694   // Notes:-
 695   // * An intrinsic is always executed, where an ON_WEAK_OOP_REF load is performed.
 696   // * We may jump to the slow path iff the receiver is null. If the
 697   //   Reference object is null then we no longer perform an ON_WEAK_OOP_REF load
 698   //   Thus we can use the regular method entry code to generate the NPE.
 699   //
 700   // Rmethod: Method*
 701   // Rthread: thread
 702   // Rsender_sp: sender sp, must be preserved for slow path, set SP to it on fast path
 703   // Rparams: parameters
 704 
 705   address entry = __ pc();
 706   Label slow_path;
 707   const Register Rthis = R0;
 708   const Register Rret_addr = Rtmp_save1;
 709   assert_different_registers(Rthis, Rret_addr, Rsender_sp);
 710 
<span class="line-modified"> 711   const int referent_offset = java_lang_ref_Reference::referent_offset;</span>
<span class="line-removed"> 712   guarantee(referent_offset &gt; 0, &quot;referent offset not initialized&quot;);</span>
 713 
 714   // Check if local 0 != NULL
 715   // If the receiver is null then it is OK to jump to the slow path.
 716   __ ldr(Rthis, Address(Rparams));
 717   __ cbz(Rthis, slow_path);
 718 
 719   // Preserve LR
 720   __ mov(Rret_addr, LR);
 721 
 722   // Load the value of the referent field.
 723   const Address field_address(Rthis, referent_offset);
 724   __ load_heap_oop(R0, field_address, Rtemp, R1_tmp, R2_tmp, ON_WEAK_OOP_REF);
 725 
 726   // _areturn
 727   __ mov(SP, Rsender_sp);
 728   __ ret(Rret_addr);
 729 
 730   // generate a vanilla interpreter entry as the slow path
 731   __ bind(slow_path);
 732   __ jump_to_entry(Interpreter::entry_for_kind(Interpreter::zerolocals));
</pre>
</td>
<td>
<hr />
<pre>
 691   //    1. The &quot;intrinsified&quot; code performing an ON_WEAK_OOP_REF load,
 692   //    2. The slow path - which is an expansion of the regular method entry.
 693   //
 694   // Notes:-
 695   // * An intrinsic is always executed, where an ON_WEAK_OOP_REF load is performed.
 696   // * We may jump to the slow path iff the receiver is null. If the
 697   //   Reference object is null then we no longer perform an ON_WEAK_OOP_REF load
 698   //   Thus we can use the regular method entry code to generate the NPE.
 699   //
 700   // Rmethod: Method*
 701   // Rthread: thread
 702   // Rsender_sp: sender sp, must be preserved for slow path, set SP to it on fast path
 703   // Rparams: parameters
 704 
 705   address entry = __ pc();
 706   Label slow_path;
 707   const Register Rthis = R0;
 708   const Register Rret_addr = Rtmp_save1;
 709   assert_different_registers(Rthis, Rret_addr, Rsender_sp);
 710 
<span class="line-modified"> 711   const int referent_offset = java_lang_ref_Reference::referent_offset();</span>

 712 
 713   // Check if local 0 != NULL
 714   // If the receiver is null then it is OK to jump to the slow path.
 715   __ ldr(Rthis, Address(Rparams));
 716   __ cbz(Rthis, slow_path);
 717 
 718   // Preserve LR
 719   __ mov(Rret_addr, LR);
 720 
 721   // Load the value of the referent field.
 722   const Address field_address(Rthis, referent_offset);
 723   __ load_heap_oop(R0, field_address, Rtemp, R1_tmp, R2_tmp, ON_WEAK_OOP_REF);
 724 
 725   // _areturn
 726   __ mov(SP, Rsender_sp);
 727   __ ret(Rret_addr);
 728 
 729   // generate a vanilla interpreter entry as the slow path
 730   __ bind(slow_path);
 731   __ jump_to_entry(Interpreter::entry_for_kind(Interpreter::zerolocals));
</pre>
</td>
</tr>
</table>
<center><a href="methodHandles_arm.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../ppc/c1_CodeStubs_ppc.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>