<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/cpu/aarch64/nativeInst_aarch64.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="methodHandles_aarch64.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="nativeInst_aarch64.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/aarch64/nativeInst_aarch64.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
445   }
446   return false;
447 }
448 
449 bool NativeInstruction::is_movz() {
450   return Instruction_aarch64::extract(int_at(0), 30, 23) == 0b10100101;
451 }
452 
453 bool NativeInstruction::is_movk() {
454   return Instruction_aarch64::extract(int_at(0), 30, 23) == 0b11100101;
455 }
456 
457 bool NativeInstruction::is_sigill_zombie_not_entrant() {
458   return uint_at(0) == 0xd4bbd5a1; // dcps1 #0xdead
459 }
460 
461 void NativeIllegalInstruction::insert(address code_pos) {
462   *(juint*)code_pos = 0xd4bbd5a1; // dcps1 #0xdead
463 }
464 




465 //-------------------------------------------------------------------
466 
467 // MT-safe inserting of a jump over a jump or a nop (used by
468 // nmethod::make_not_entrant_or_zombie)
469 
470 void NativeJump::patch_verified_entry(address entry, address verified_entry, address dest) {
471 
472   assert(dest == SharedRuntime::get_handle_wrong_method_stub(), &quot;expected fixed destination of patch&quot;);
473 
474 #ifdef ASSERT
475   // This may be the temporary nmethod generated while we&#39;re AOT
476   // compiling.  Such an nmethod doesn&#39;t begin with a NOP but with an ADRP.
477   if (! (CalculateClassFingerprint &amp;&amp; UseAOT &amp;&amp; is_adrp_at(verified_entry))) {
478     assert(nativeInstruction_at(verified_entry)-&gt;is_jump_or_nop()
479            || nativeInstruction_at(verified_entry)-&gt;is_sigill_zombie_not_entrant(),
480            &quot;Aarch64 cannot replace non-jump with jump&quot;);
481   }
482 #endif
483 
484   // Patch this nmethod atomically.
</pre>
</td>
<td>
<hr />
<pre>
445   }
446   return false;
447 }
448 
449 bool NativeInstruction::is_movz() {
450   return Instruction_aarch64::extract(int_at(0), 30, 23) == 0b10100101;
451 }
452 
453 bool NativeInstruction::is_movk() {
454   return Instruction_aarch64::extract(int_at(0), 30, 23) == 0b11100101;
455 }
456 
457 bool NativeInstruction::is_sigill_zombie_not_entrant() {
458   return uint_at(0) == 0xd4bbd5a1; // dcps1 #0xdead
459 }
460 
461 void NativeIllegalInstruction::insert(address code_pos) {
462   *(juint*)code_pos = 0xd4bbd5a1; // dcps1 #0xdead
463 }
464 
<span class="line-added">465 bool NativeInstruction::is_stop() {</span>
<span class="line-added">466   return uint_at(0) == 0xd4bbd5c1; // dcps1 #0xdeae</span>
<span class="line-added">467 }</span>
<span class="line-added">468 </span>
469 //-------------------------------------------------------------------
470 
471 // MT-safe inserting of a jump over a jump or a nop (used by
472 // nmethod::make_not_entrant_or_zombie)
473 
474 void NativeJump::patch_verified_entry(address entry, address verified_entry, address dest) {
475 
476   assert(dest == SharedRuntime::get_handle_wrong_method_stub(), &quot;expected fixed destination of patch&quot;);
477 
478 #ifdef ASSERT
479   // This may be the temporary nmethod generated while we&#39;re AOT
480   // compiling.  Such an nmethod doesn&#39;t begin with a NOP but with an ADRP.
481   if (! (CalculateClassFingerprint &amp;&amp; UseAOT &amp;&amp; is_adrp_at(verified_entry))) {
482     assert(nativeInstruction_at(verified_entry)-&gt;is_jump_or_nop()
483            || nativeInstruction_at(verified_entry)-&gt;is_sigill_zombie_not_entrant(),
484            &quot;Aarch64 cannot replace non-jump with jump&quot;);
485   }
486 #endif
487 
488   // Patch this nmethod atomically.
</pre>
</td>
</tr>
</table>
<center><a href="methodHandles_aarch64.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="nativeInst_aarch64.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>