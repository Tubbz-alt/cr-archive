<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/interpreter/interpreterRuntime.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../include/jvm.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../jfr/instrumentation/jfrEventClassTransformer.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/interpreter/interpreterRuntime.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 197   assert(result != NULL || is_fast_aldc, &quot;null result only valid for fast_aldc&quot;);
 198 
 199 #ifdef ASSERT
 200   {
 201     // The bytecode wrappers aren&#39;t GC-safe so construct a new one
 202     Bytecode_loadconstant ldc2(m, last_frame.bci());
 203     int rindex = ldc2.cache_index();
 204     if (rindex &lt; 0)
 205       rindex = m-&gt;constants()-&gt;cp_to_object_index(ldc2.pool_index());
 206     if (rindex &gt;= 0) {
 207       oop coop = m-&gt;constants()-&gt;resolved_references()-&gt;obj_at(rindex);
 208       oop roop = (result == NULL ? Universe::the_null_sentinel() : result);
 209       assert(roop == coop, &quot;expected result for assembly code&quot;);
 210     }
 211   }
 212 #endif
 213   thread-&gt;set_vm_result(result);
 214   if (!is_fast_aldc) {
 215     // Tell the interpreter how to unbox the primitive.
 216     guarantee(java_lang_boxing_object::is_instance(result, type), &quot;&quot;);
<span class="line-modified"> 217     int offset = java_lang_boxing_object::value_offset_in_bytes(type);</span>
 218     intptr_t flags = ((as_TosState(type) &lt;&lt; ConstantPoolCacheEntry::tos_state_shift)
 219                       | (offset &amp; ConstantPoolCacheEntry::field_index_mask));
 220     thread-&gt;set_vm_result_2((Metadata*)flags);
 221   }
 222 }
 223 JRT_END
 224 
 225 
 226 //------------------------------------------------------------------------------------------------------------------------
 227 // Allocation
 228 
 229 JRT_ENTRY(void, InterpreterRuntime::_new(JavaThread* thread, ConstantPool* pool, int index))
 230   Klass* k = pool-&gt;klass_at(index, CHECK);
 231   InstanceKlass* klass = InstanceKlass::cast(k);
 232 
 233   // Make sure we are not instantiating an abstract klass
 234   klass-&gt;check_valid_for_instantiation(true, CHECK);
 235 
 236   // Make sure klass is initialized
 237   klass-&gt;initialize(CHECK);
</pre>
</td>
<td>
<hr />
<pre>
 197   assert(result != NULL || is_fast_aldc, &quot;null result only valid for fast_aldc&quot;);
 198 
 199 #ifdef ASSERT
 200   {
 201     // The bytecode wrappers aren&#39;t GC-safe so construct a new one
 202     Bytecode_loadconstant ldc2(m, last_frame.bci());
 203     int rindex = ldc2.cache_index();
 204     if (rindex &lt; 0)
 205       rindex = m-&gt;constants()-&gt;cp_to_object_index(ldc2.pool_index());
 206     if (rindex &gt;= 0) {
 207       oop coop = m-&gt;constants()-&gt;resolved_references()-&gt;obj_at(rindex);
 208       oop roop = (result == NULL ? Universe::the_null_sentinel() : result);
 209       assert(roop == coop, &quot;expected result for assembly code&quot;);
 210     }
 211   }
 212 #endif
 213   thread-&gt;set_vm_result(result);
 214   if (!is_fast_aldc) {
 215     // Tell the interpreter how to unbox the primitive.
 216     guarantee(java_lang_boxing_object::is_instance(result, type), &quot;&quot;);
<span class="line-modified"> 217     int offset = java_lang_boxing_object::value_offset(type);</span>
 218     intptr_t flags = ((as_TosState(type) &lt;&lt; ConstantPoolCacheEntry::tos_state_shift)
 219                       | (offset &amp; ConstantPoolCacheEntry::field_index_mask));
 220     thread-&gt;set_vm_result_2((Metadata*)flags);
 221   }
 222 }
 223 JRT_END
 224 
 225 
 226 //------------------------------------------------------------------------------------------------------------------------
 227 // Allocation
 228 
 229 JRT_ENTRY(void, InterpreterRuntime::_new(JavaThread* thread, ConstantPool* pool, int index))
 230   Klass* k = pool-&gt;klass_at(index, CHECK);
 231   InstanceKlass* klass = InstanceKlass::cast(k);
 232 
 233   // Make sure we are not instantiating an abstract klass
 234   klass-&gt;check_valid_for_instantiation(true, CHECK);
 235 
 236   // Make sure klass is initialized
 237   klass-&gt;initialize(CHECK);
</pre>
</td>
</tr>
</table>
<center><a href="../include/jvm.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../jfr/instrumentation/jfrEventClassTransformer.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>