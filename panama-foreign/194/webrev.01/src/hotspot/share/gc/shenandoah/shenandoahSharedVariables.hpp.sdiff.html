<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/shenandoah/shenandoahSharedVariables.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahRootProcessor.inline.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahStringDedup.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/shenandoahSharedVariables.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
228 
229   volatile ShenandoahSharedValue* addr_of() {
230     return &amp;value;
231   }
232 
233 private:
234   volatile T* operator&amp;() {
235     fatal(&quot;Use addr_of() instead&quot;);
236     return NULL;
237   }
238 
239   bool operator==(ShenandoahSharedEnumFlag&amp; other) { fatal(&quot;Use get() instead&quot;); return false; }
240   bool operator!=(ShenandoahSharedEnumFlag&amp; other) { fatal(&quot;Use get() instead&quot;); return false; }
241   bool operator&gt; (ShenandoahSharedEnumFlag&amp; other) { fatal(&quot;Use get() instead&quot;); return false; }
242   bool operator&gt;=(ShenandoahSharedEnumFlag&amp; other) { fatal(&quot;Use get() instead&quot;); return false; }
243   bool operator&lt; (ShenandoahSharedEnumFlag&amp; other) { fatal(&quot;Use get() instead&quot;); return false; }
244   bool operator&lt;=(ShenandoahSharedEnumFlag&amp; other) { fatal(&quot;Use get() instead&quot;); return false; }
245 
246 };
247 


































248 #endif // SHARE_GC_SHENANDOAH_SHENANDOAHSHAREDVARIABLES_HPP
</pre>
</td>
<td>
<hr />
<pre>
228 
229   volatile ShenandoahSharedValue* addr_of() {
230     return &amp;value;
231   }
232 
233 private:
234   volatile T* operator&amp;() {
235     fatal(&quot;Use addr_of() instead&quot;);
236     return NULL;
237   }
238 
239   bool operator==(ShenandoahSharedEnumFlag&amp; other) { fatal(&quot;Use get() instead&quot;); return false; }
240   bool operator!=(ShenandoahSharedEnumFlag&amp; other) { fatal(&quot;Use get() instead&quot;); return false; }
241   bool operator&gt; (ShenandoahSharedEnumFlag&amp; other) { fatal(&quot;Use get() instead&quot;); return false; }
242   bool operator&gt;=(ShenandoahSharedEnumFlag&amp; other) { fatal(&quot;Use get() instead&quot;); return false; }
243   bool operator&lt; (ShenandoahSharedEnumFlag&amp; other) { fatal(&quot;Use get() instead&quot;); return false; }
244   bool operator&lt;=(ShenandoahSharedEnumFlag&amp; other) { fatal(&quot;Use get() instead&quot;); return false; }
245 
246 };
247 
<span class="line-added">248 typedef struct ShenandoahSharedSemaphore {</span>
<span class="line-added">249   shenandoah_padding(0);</span>
<span class="line-added">250   volatile ShenandoahSharedValue value;</span>
<span class="line-added">251   shenandoah_padding(1);</span>
<span class="line-added">252 </span>
<span class="line-added">253   static uint max_tokens() {</span>
<span class="line-added">254     return sizeof(ShenandoahSharedValue) * CHAR_MAX;</span>
<span class="line-added">255   }</span>
<span class="line-added">256 </span>
<span class="line-added">257   ShenandoahSharedSemaphore(uint tokens) {</span>
<span class="line-added">258     assert(tokens &lt;= max_tokens(), &quot;sanity&quot;);</span>
<span class="line-added">259     Atomic::release_store_fence(&amp;value, (ShenandoahSharedValue)tokens);</span>
<span class="line-added">260   }</span>
<span class="line-added">261 </span>
<span class="line-added">262   bool try_acquire() {</span>
<span class="line-added">263     while (true) {</span>
<span class="line-added">264       ShenandoahSharedValue ov = Atomic::load_acquire(&amp;value);</span>
<span class="line-added">265       if (ov == 0) {</span>
<span class="line-added">266         return false;</span>
<span class="line-added">267       }</span>
<span class="line-added">268       ShenandoahSharedValue nv = ov - 1;</span>
<span class="line-added">269       if (Atomic::cmpxchg(&amp;value, ov, nv) == ov) {</span>
<span class="line-added">270         // successfully set</span>
<span class="line-added">271         return true;</span>
<span class="line-added">272       }</span>
<span class="line-added">273     }</span>
<span class="line-added">274   }</span>
<span class="line-added">275 </span>
<span class="line-added">276   void claim_all() {</span>
<span class="line-added">277     Atomic::release_store_fence(&amp;value, (ShenandoahSharedValue)0);</span>
<span class="line-added">278   }</span>
<span class="line-added">279 </span>
<span class="line-added">280 } ShenandoahSharedSemaphore;</span>
<span class="line-added">281 </span>
282 #endif // SHARE_GC_SHENANDOAH_SHENANDOAHSHAREDVARIABLES_HPP
</pre>
</td>
</tr>
</table>
<center><a href="shenandoahRootProcessor.inline.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahStringDedup.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>