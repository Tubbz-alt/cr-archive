<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/shenandoah/shenandoahNMethod.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahHeap.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahPhaseTimings.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/shenandoahNMethod.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
506 ShenandoahNMethodList::ShenandoahNMethodList(int size) :
507   _size(size), _ref_count(1) {
508   _list = NEW_C_HEAP_ARRAY(ShenandoahNMethod*, size, mtGC);
509 }
510 
511 ShenandoahNMethodList::~ShenandoahNMethodList() {
512   assert(_list != NULL, &quot;Sanity&quot;);
513   assert(_ref_count == 0, &quot;Must be&quot;);
514   FREE_C_HEAP_ARRAY(ShenandoahNMethod*, _list);
515 }
516 
517 void ShenandoahNMethodList::transfer(ShenandoahNMethodList* const list, int limit) {
518   assert(limit &lt;= size(), &quot;Sanity&quot;);
519   ShenandoahNMethod** old_list = list-&gt;list();
520   for (int index = 0; index &lt; limit; index++) {
521     _list[index] = old_list[index];
522   }
523 }
524 
525 ShenandoahNMethodList* ShenandoahNMethodList::acquire() {
<span class="line-modified">526   assert(CodeCache_lock-&gt;owned_by_self(), &quot;Lock must be held&quot;);</span>
527   _ref_count++;
528   return this;
529 }
530 
531 void ShenandoahNMethodList::release() {
<span class="line-modified">532   assert(CodeCache_lock-&gt;owned_by_self(), &quot;Lock must be held&quot;);</span>
533   _ref_count--;
534   if (_ref_count == 0) {
535     delete this;
536   }
537 }
538 
539 ShenandoahNMethodTableSnapshot::ShenandoahNMethodTableSnapshot(ShenandoahNMethodTable* table) :
540   _heap(ShenandoahHeap::heap()), _list(table-&gt;_list-&gt;acquire()), _limit(table-&gt;_index), _claimed(0) {
541 }
542 
543 ShenandoahNMethodTableSnapshot::~ShenandoahNMethodTableSnapshot() {
544   _list-&gt;release();
545 }
546 
547 void ShenandoahNMethodTableSnapshot::parallel_blobs_do(CodeBlobClosure *f) {
548   size_t stride = 256; // educated guess
549 
550   ShenandoahNMethod** const list = _list-&gt;list();
551 
552   size_t max = (size_t)_limit;
</pre>
</td>
<td>
<hr />
<pre>
506 ShenandoahNMethodList::ShenandoahNMethodList(int size) :
507   _size(size), _ref_count(1) {
508   _list = NEW_C_HEAP_ARRAY(ShenandoahNMethod*, size, mtGC);
509 }
510 
511 ShenandoahNMethodList::~ShenandoahNMethodList() {
512   assert(_list != NULL, &quot;Sanity&quot;);
513   assert(_ref_count == 0, &quot;Must be&quot;);
514   FREE_C_HEAP_ARRAY(ShenandoahNMethod*, _list);
515 }
516 
517 void ShenandoahNMethodList::transfer(ShenandoahNMethodList* const list, int limit) {
518   assert(limit &lt;= size(), &quot;Sanity&quot;);
519   ShenandoahNMethod** old_list = list-&gt;list();
520   for (int index = 0; index &lt; limit; index++) {
521     _list[index] = old_list[index];
522   }
523 }
524 
525 ShenandoahNMethodList* ShenandoahNMethodList::acquire() {
<span class="line-modified">526   assert_locked_or_safepoint(CodeCache_lock);</span>
527   _ref_count++;
528   return this;
529 }
530 
531 void ShenandoahNMethodList::release() {
<span class="line-modified">532   assert_locked_or_safepoint(CodeCache_lock);</span>
533   _ref_count--;
534   if (_ref_count == 0) {
535     delete this;
536   }
537 }
538 
539 ShenandoahNMethodTableSnapshot::ShenandoahNMethodTableSnapshot(ShenandoahNMethodTable* table) :
540   _heap(ShenandoahHeap::heap()), _list(table-&gt;_list-&gt;acquire()), _limit(table-&gt;_index), _claimed(0) {
541 }
542 
543 ShenandoahNMethodTableSnapshot::~ShenandoahNMethodTableSnapshot() {
544   _list-&gt;release();
545 }
546 
547 void ShenandoahNMethodTableSnapshot::parallel_blobs_do(CodeBlobClosure *f) {
548   size_t stride = 256; // educated guess
549 
550   ShenandoahNMethod** const list = _list-&gt;list();
551 
552   size_t max = (size_t)_limit;
</pre>
</td>
</tr>
</table>
<center><a href="shenandoahHeap.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahPhaseTimings.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>