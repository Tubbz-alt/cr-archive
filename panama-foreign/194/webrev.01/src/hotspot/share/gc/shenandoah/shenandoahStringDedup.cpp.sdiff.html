<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/shenandoah/shenandoahStringDedup.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahSharedVariables.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../z/c1/zBarrierSetC1.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/shenandoahStringDedup.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 81   {
 82     ShenandoahWorkerTimingsTracker x(phase, ShenandoahPhaseTimings::StringDedupQueueRoots, worker_id);
 83     StringDedupQueue::unlink_or_oops_do(&amp;sd_cl);
 84   }
 85 
 86   {
 87     ShenandoahWorkerTimingsTracker x(phase, ShenandoahPhaseTimings::StringDedupTableRoots, worker_id);
 88     StringDedupTable::unlink_or_oops_do(&amp;sd_cl, worker_id);
 89   }
 90 }
 91 
 92 void ShenandoahStringDedup::oops_do_slow(OopClosure* cl) {
 93   assert(SafepointSynchronize::is_at_safepoint(), &quot;Must be at a safepoint&quot;);
 94   assert(is_enabled(), &quot;String deduplication not enabled&quot;);
 95   AlwaysTrueClosure always_true;
 96   StringDedupUnlinkOrOopsDoClosure sd_cl(&amp;always_true, cl);
 97   StringDedupQueue::unlink_or_oops_do(&amp;sd_cl);
 98   StringDedupTable::unlink_or_oops_do(&amp;sd_cl, 0);
 99 }
100 
<span class="line-removed">101 class ShenandoahIsMarkedNextClosure : public BoolObjectClosure {</span>
<span class="line-removed">102 private:</span>
<span class="line-removed">103   ShenandoahMarkingContext* const _mark_context;</span>
<span class="line-removed">104 </span>
<span class="line-removed">105 public:</span>
<span class="line-removed">106   ShenandoahIsMarkedNextClosure() : _mark_context(ShenandoahHeap::heap()-&gt;marking_context()) { }</span>
<span class="line-removed">107 </span>
<span class="line-removed">108   bool do_object_b(oop obj) {</span>
<span class="line-removed">109     return _mark_context-&gt;is_marked(obj);</span>
<span class="line-removed">110   }</span>
<span class="line-removed">111 };</span>
<span class="line-removed">112 </span>
113 //
114 // Task for parallel unlink_or_oops_do() operation on the deduplication queue
115 // and table.
116 //
117 class ShenandoahStringDedupUnlinkOrOopsDoTask : public AbstractGangTask {
118 private:
119   StringDedupUnlinkOrOopsDoClosure _cl;
120 
121 public:
122   ShenandoahStringDedupUnlinkOrOopsDoTask(BoolObjectClosure* is_alive,
123                                   OopClosure* keep_alive,
124                                   bool allow_resize_and_rehash) :
125     AbstractGangTask(&quot;StringDedupUnlinkOrOopsDoTask&quot;),
126     _cl(is_alive, keep_alive) {
127       StringDedup::gc_prologue(allow_resize_and_rehash);
128   }
129 
130   ~ShenandoahStringDedupUnlinkOrOopsDoTask() {
131     StringDedup::gc_epilogue();
132   }
</pre>
</td>
<td>
<hr />
<pre>
 81   {
 82     ShenandoahWorkerTimingsTracker x(phase, ShenandoahPhaseTimings::StringDedupQueueRoots, worker_id);
 83     StringDedupQueue::unlink_or_oops_do(&amp;sd_cl);
 84   }
 85 
 86   {
 87     ShenandoahWorkerTimingsTracker x(phase, ShenandoahPhaseTimings::StringDedupTableRoots, worker_id);
 88     StringDedupTable::unlink_or_oops_do(&amp;sd_cl, worker_id);
 89   }
 90 }
 91 
 92 void ShenandoahStringDedup::oops_do_slow(OopClosure* cl) {
 93   assert(SafepointSynchronize::is_at_safepoint(), &quot;Must be at a safepoint&quot;);
 94   assert(is_enabled(), &quot;String deduplication not enabled&quot;);
 95   AlwaysTrueClosure always_true;
 96   StringDedupUnlinkOrOopsDoClosure sd_cl(&amp;always_true, cl);
 97   StringDedupQueue::unlink_or_oops_do(&amp;sd_cl);
 98   StringDedupTable::unlink_or_oops_do(&amp;sd_cl, 0);
 99 }
100 












101 //
102 // Task for parallel unlink_or_oops_do() operation on the deduplication queue
103 // and table.
104 //
105 class ShenandoahStringDedupUnlinkOrOopsDoTask : public AbstractGangTask {
106 private:
107   StringDedupUnlinkOrOopsDoClosure _cl;
108 
109 public:
110   ShenandoahStringDedupUnlinkOrOopsDoTask(BoolObjectClosure* is_alive,
111                                   OopClosure* keep_alive,
112                                   bool allow_resize_and_rehash) :
113     AbstractGangTask(&quot;StringDedupUnlinkOrOopsDoTask&quot;),
114     _cl(is_alive, keep_alive) {
115       StringDedup::gc_prologue(allow_resize_and_rehash);
116   }
117 
118   ~ShenandoahStringDedupUnlinkOrOopsDoTask() {
119     StringDedup::gc_epilogue();
120   }
</pre>
</td>
</tr>
</table>
<center><a href="shenandoahSharedVariables.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../z/c1/zBarrierSetC1.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>