<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/shenandoah/shenandoahRootProcessor.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahRootProcessor.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahRootProcessor.inline.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/shenandoahRootProcessor.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
209   ShenandoahConcurrentStringDedupRoots();
210   ~ShenandoahConcurrentStringDedupRoots();
211 
212   void oops_do(BoolObjectClosure* is_alive, OopClosure* keep_alive, uint worker_id);
213 };
214 
215 class ShenandoahCodeCacheRoots {
216 private:
217   ShenandoahPhaseTimings::Phase _phase;
218   ShenandoahCodeRootsIterator   _coderoots_iterator;
219 public:
220   ShenandoahCodeCacheRoots(ShenandoahPhaseTimings::Phase phase);
221   ~ShenandoahCodeCacheRoots();
222 
223   void code_blobs_do(CodeBlobClosure* blob_cl, uint worker_id);
224 };
225 
226 template &lt;bool CONCURRENT, bool SINGLE_THREADED&gt;
227 class ShenandoahClassLoaderDataRoots {
228 private:

229   ShenandoahPhaseTimings::Phase _phase;








230 public:
<span class="line-modified">231   ShenandoahClassLoaderDataRoots(ShenandoahPhaseTimings::Phase phase);</span>
232   ~ShenandoahClassLoaderDataRoots();
233 
234   void always_strong_cld_do(CLDClosure* clds, uint worker_id);
235   void cld_do(CLDClosure* clds, uint worker_id);
236 };
237 
238 class ShenandoahRootProcessor : public StackObj {
239 private:
240   ShenandoahHeap* const               _heap;
241   const ShenandoahPhaseTimings::Phase _phase;
242   const ShenandoahGCWorkerPhase       _worker_phase;
243 public:
244   ShenandoahRootProcessor(ShenandoahPhaseTimings::Phase phase);
245 
246   ShenandoahHeap* heap() const { return _heap; }
247 };
248 
249 class ShenandoahRootScanner : public ShenandoahRootProcessor {
250 private:
251   ShenandoahSerialRoots                                     _serial_roots;
252   ShenandoahThreadRoots                                     _thread_roots;
<span class="line-removed">253   ShenandoahCodeCacheRoots                                  _code_roots;</span>
<span class="line-removed">254   ShenandoahVMRoots&lt;false /*concurrent*/ &gt;                  _vm_roots;</span>
255   ShenandoahStringDedupRoots                                _dedup_roots;
<span class="line-modified">256   ShenandoahClassLoaderDataRoots&lt;false /*concurrent*/, false /*single threaded*/&gt;</span>
<span class="line-removed">257                                                             _cld_roots;</span>
258 public:
259   ShenandoahRootScanner(uint n_workers, ShenandoahPhaseTimings::Phase phase);

260 
261   // Apply oops, clds and blobs to all strongly reachable roots in the system,
262   // during class unloading cycle
263   void strong_roots_do(uint worker_id, OopClosure* cl);
264   void strong_roots_do(uint worker_id, OopClosure* oops, CLDClosure* clds, CodeBlobClosure* code, ThreadClosure* tc = NULL);
265 
266   // Apply oops, clds and blobs to all strongly reachable roots and weakly reachable
267   // roots when class unloading is disabled during this cycle
268   void roots_do(uint worker_id, OopClosure* cl);
269   void roots_do(uint worker_id, OopClosure* oops, CLDClosure* clds, CodeBlobClosure* code, ThreadClosure* tc = NULL);
270 };
271 
















272 // This scanner is only for SH::object_iteration() and only supports single-threaded
273 // root scanning
274 class ShenandoahHeapIterationRootScanner : public ShenandoahRootProcessor {
275 private:
276   ShenandoahSerialRoots                                    _serial_roots;
277   ShenandoahThreadRoots                                    _thread_roots;
278   ShenandoahVMRoots&lt;false /*concurrent*/&gt;                  _vm_roots;
279   ShenandoahClassLoaderDataRoots&lt;false /*concurrent*/, true /*single threaded*/&gt;
280                                                            _cld_roots;
281   ShenandoahSerialWeakRoots                                _serial_weak_roots;
282   ShenandoahWeakRoots&lt;false /*concurrent*/&gt;                _weak_roots;
283   ShenandoahConcurrentStringDedupRoots                     _dedup_roots;
284   ShenandoahCodeCacheRoots                                 _code_roots;
285 
286 public:
287   ShenandoahHeapIterationRootScanner();
288 
289   void roots_do(OopClosure* cl);
290 };
291 
</pre>
</td>
<td>
<hr />
<pre>
209   ShenandoahConcurrentStringDedupRoots();
210   ~ShenandoahConcurrentStringDedupRoots();
211 
212   void oops_do(BoolObjectClosure* is_alive, OopClosure* keep_alive, uint worker_id);
213 };
214 
215 class ShenandoahCodeCacheRoots {
216 private:
217   ShenandoahPhaseTimings::Phase _phase;
218   ShenandoahCodeRootsIterator   _coderoots_iterator;
219 public:
220   ShenandoahCodeCacheRoots(ShenandoahPhaseTimings::Phase phase);
221   ~ShenandoahCodeCacheRoots();
222 
223   void code_blobs_do(CodeBlobClosure* blob_cl, uint worker_id);
224 };
225 
226 template &lt;bool CONCURRENT, bool SINGLE_THREADED&gt;
227 class ShenandoahClassLoaderDataRoots {
228 private:
<span class="line-added">229   ShenandoahSharedSemaphore     _semaphore;</span>
230   ShenandoahPhaseTimings::Phase _phase;
<span class="line-added">231 </span>
<span class="line-added">232   static uint worker_count(uint n_workers) {</span>
<span class="line-added">233     // Limit concurrency a bit, otherwise it wastes resources when workers are tripping</span>
<span class="line-added">234     // over each other. This also leaves free workers to process other parts of the root</span>
<span class="line-added">235     // set, while admitted workers are busy with doing the CLDG walk.</span>
<span class="line-added">236     return MAX2(1u, MIN2(ShenandoahSharedSemaphore::max_tokens(), n_workers / 2));</span>
<span class="line-added">237   }</span>
<span class="line-added">238 </span>
239 public:
<span class="line-modified">240   ShenandoahClassLoaderDataRoots(ShenandoahPhaseTimings::Phase phase, uint n_workers);</span>
241   ~ShenandoahClassLoaderDataRoots();
242 
243   void always_strong_cld_do(CLDClosure* clds, uint worker_id);
244   void cld_do(CLDClosure* clds, uint worker_id);
245 };
246 
247 class ShenandoahRootProcessor : public StackObj {
248 private:
249   ShenandoahHeap* const               _heap;
250   const ShenandoahPhaseTimings::Phase _phase;
251   const ShenandoahGCWorkerPhase       _worker_phase;
252 public:
253   ShenandoahRootProcessor(ShenandoahPhaseTimings::Phase phase);
254 
255   ShenandoahHeap* heap() const { return _heap; }
256 };
257 
258 class ShenandoahRootScanner : public ShenandoahRootProcessor {
259 private:
260   ShenandoahSerialRoots                                     _serial_roots;
261   ShenandoahThreadRoots                                     _thread_roots;


262   ShenandoahStringDedupRoots                                _dedup_roots;
<span class="line-modified">263 </span>

264 public:
265   ShenandoahRootScanner(uint n_workers, ShenandoahPhaseTimings::Phase phase);
<span class="line-added">266   ~ShenandoahRootScanner();</span>
267 
268   // Apply oops, clds and blobs to all strongly reachable roots in the system,
269   // during class unloading cycle
270   void strong_roots_do(uint worker_id, OopClosure* cl);
271   void strong_roots_do(uint worker_id, OopClosure* oops, CLDClosure* clds, CodeBlobClosure* code, ThreadClosure* tc = NULL);
272 
273   // Apply oops, clds and blobs to all strongly reachable roots and weakly reachable
274   // roots when class unloading is disabled during this cycle
275   void roots_do(uint worker_id, OopClosure* cl);
276   void roots_do(uint worker_id, OopClosure* oops, CLDClosure* clds, CodeBlobClosure* code, ThreadClosure* tc = NULL);
277 };
278 
<span class="line-added">279 template &lt;bool CONCURRENT&gt;</span>
<span class="line-added">280 class ShenandoahConcurrentRootScanner {</span>
<span class="line-added">281 private:</span>
<span class="line-added">282   ShenandoahVMRoots&lt;CONCURRENT&gt;            _vm_roots;</span>
<span class="line-added">283   ShenandoahClassLoaderDataRoots&lt;CONCURRENT, false /* single-threaded*/&gt;</span>
<span class="line-added">284                                            _cld_roots;</span>
<span class="line-added">285   ShenandoahNMethodTableSnapshot*          _codecache_snapshot;</span>
<span class="line-added">286   ShenandoahPhaseTimings::Phase            _phase;</span>
<span class="line-added">287 </span>
<span class="line-added">288 public:</span>
<span class="line-added">289   ShenandoahConcurrentRootScanner(uint n_workers, ShenandoahPhaseTimings::Phase phase);</span>
<span class="line-added">290   ~ShenandoahConcurrentRootScanner();</span>
<span class="line-added">291 </span>
<span class="line-added">292   void oops_do(OopClosure* oops, uint worker_id);</span>
<span class="line-added">293 };</span>
<span class="line-added">294 </span>
295 // This scanner is only for SH::object_iteration() and only supports single-threaded
296 // root scanning
297 class ShenandoahHeapIterationRootScanner : public ShenandoahRootProcessor {
298 private:
299   ShenandoahSerialRoots                                    _serial_roots;
300   ShenandoahThreadRoots                                    _thread_roots;
301   ShenandoahVMRoots&lt;false /*concurrent*/&gt;                  _vm_roots;
302   ShenandoahClassLoaderDataRoots&lt;false /*concurrent*/, true /*single threaded*/&gt;
303                                                            _cld_roots;
304   ShenandoahSerialWeakRoots                                _serial_weak_roots;
305   ShenandoahWeakRoots&lt;false /*concurrent*/&gt;                _weak_roots;
306   ShenandoahConcurrentStringDedupRoots                     _dedup_roots;
307   ShenandoahCodeCacheRoots                                 _code_roots;
308 
309 public:
310   ShenandoahHeapIterationRootScanner();
311 
312   void roots_do(OopClosure* cl);
313 };
314 
</pre>
</td>
</tr>
</table>
<center><a href="shenandoahRootProcessor.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahRootProcessor.inline.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>