<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/jfr/recorder/service/jfrEvent.hpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../repository/jfrChunkWriter.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../storage/jfrStorage.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/recorder/service/jfrEvent.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -117,10 +117,18 @@</span>
  
    static bool is_stacktrace_enabled() {
      return JfrEventSetting::has_stacktrace(T::eventId);
    }
  
<span class="udiff-line-added">+   static bool is_large() {</span>
<span class="udiff-line-added">+     return JfrEventSetting::is_large(T::eventId);</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   static void set_large() {</span>
<span class="udiff-line-added">+     JfrEventSetting::set_large(T::eventId);</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
    static JfrEventId id() {
      return T::eventId;
    }
  
    static bool is_instant() {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -158,11 +166,27 @@</span>
      JfrBuffer* const buffer = tl-&gt;native_buffer();
      if (buffer == NULL) {
        // most likely a pending OOM
        return;
      }
<span class="udiff-line-added">+     bool large = is_large();</span>
<span class="udiff-line-added">+     if (write_sized_event(buffer, event_thread, tl, large)) {</span>
<span class="udiff-line-added">+       // Event written succesfully</span>
<span class="udiff-line-added">+       return;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     if (!large) {</span>
<span class="udiff-line-added">+       // Try large size</span>
<span class="udiff-line-added">+       if (write_sized_event(buffer, event_thread, tl, true)) {</span>
<span class="udiff-line-added">+         // Event written succesfully, use large size from now on</span>
<span class="udiff-line-added">+         set_large();</span>
<span class="udiff-line-added">+       }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   bool write_sized_event(JfrBuffer* const buffer, Thread* const event_thread, JfrThreadLocal* const tl, bool large_size) {</span>
      JfrNativeEventWriter writer(buffer, event_thread);
<span class="udiff-line-added">+     writer.begin_event_write(large_size);</span>
      writer.write&lt;u8&gt;(T::eventId);
      assert(_start_time != 0, &quot;invariant&quot;);
      writer.write(_start_time);
      if (!(T::isInstant || T::isRequestable) || T::hasCutoff) {
        assert(_end_time != 0, &quot;invariant&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -182,20 +206,21 @@</span>
          writer.write&lt;traceid&gt;(0);
        }
      }
      // payload
      static_cast&lt;T*&gt;(this)-&gt;writeData(writer);
<span class="udiff-line-added">+     return writer.end_event_write(large_size) &gt; 0;</span>
    }
  
  #ifdef ASSERT
   private:
    // verification of event fields
    JfrEventVerifier _verifier;
  
    void assert_precondition() {
<span class="udiff-line-modified-removed">-     assert(T::eventId &gt;= (JfrEventId)NUM_RESERVED_EVENTS, &quot;event id underflow invariant&quot;);</span>
<span class="udiff-line-modified-removed">-     assert(T::eventId &lt; MaxJfrEventId, &quot;event id overflow invariant&quot;);</span>
<span class="udiff-line-modified-added">+     assert(T::eventId &gt;= FIRST_EVENT_ID, &quot;event id underflow invariant&quot;);</span>
<span class="udiff-line-modified-added">+     assert(T::eventId &lt;= LAST_EVENT_ID, &quot;event id overflow invariant&quot;);</span>
      DEBUG_ONLY(static_cast&lt;T*&gt;(this)-&gt;verify());
    }
  
   protected:
    void set_field_bit(size_t field_idx) {
</pre>
<center><a href="../repository/jfrChunkWriter.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../storage/jfrStorage.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>