<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/ci/ciField.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../c1/c1_LIRGenerator.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="ciInstanceKlass.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/ci/ciField.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
248 void ciField::initialize_from(fieldDescriptor* fd) {
249   // Get the flags, offset, and canonical holder of the field.
250   _flags = ciFlags(fd-&gt;access_flags());
251   _offset = fd-&gt;offset();
252   Klass* field_holder = fd-&gt;field_holder();
253   assert(field_holder != NULL, &quot;null field_holder&quot;);
254   _holder = CURRENT_ENV-&gt;get_instance_klass(field_holder);
255 
256   // Check to see if the field is constant.
257   Klass* k = _holder-&gt;get_Klass();
258   bool is_stable_field = FoldStableValues &amp;&amp; is_stable();
259   if ((is_final() &amp;&amp; !has_initialized_final_update()) || is_stable_field) {
260     if (is_static()) {
261       // This field just may be constant.  The only case where it will
262       // not be constant is when the field is a *special* static &amp; final field
263       // whose value may change.  The three examples are java.lang.System.in,
264       // java.lang.System.out, and java.lang.System.err.
265       assert(SystemDictionary::System_klass() != NULL, &quot;Check once per vm&quot;);
266       if (k == SystemDictionary::System_klass()) {
267         // Check offsets for case 2: System.in, System.out, or System.err
<span class="line-modified">268         if( _offset == java_lang_System::in_offset_in_bytes()  ||</span>
<span class="line-modified">269             _offset == java_lang_System::out_offset_in_bytes() ||</span>
<span class="line-modified">270             _offset == java_lang_System::err_offset_in_bytes() ) {</span>
271           _is_constant = false;
272           return;
273         }
274       }
275       _is_constant = true;
276     } else {
277       // An instance field can be constant if it&#39;s a final static field or if
278       // it&#39;s a final non-static field of a trusted class (classes in
279       // java.lang.invoke and sun.invoke packages and subpackages).
280       _is_constant = is_stable_field || trust_final_non_static_fields(_holder);
281     }
282   } else {
283     // For CallSite objects treat the target field as a compile time constant.
284     assert(SystemDictionary::CallSite_klass() != NULL, &quot;should be already initialized&quot;);
285     if (k == SystemDictionary::CallSite_klass() &amp;&amp;
<span class="line-modified">286         _offset == java_lang_invoke_CallSite::target_offset_in_bytes()) {</span>
287       assert(!has_initialized_final_update(), &quot;CallSite is not supposed to have writes to final fields outside initializers&quot;);
288       _is_constant = true;
289     } else {
290       // Non-final &amp; non-stable fields are not constants.
291       _is_constant = false;
292     }
293   }
294 }
295 
296 // ------------------------------------------------------------------
297 // ciField::constant_value
298 // Get the constant value of a this static field.
299 ciConstant ciField::constant_value() {
300   assert(is_static() &amp;&amp; is_constant(), &quot;illegal call to constant_value()&quot;);
301   if (!_holder-&gt;is_initialized()) {
302     return ciConstant(); // Not initialized yet
303   }
304   if (_constant_value.basic_type() == T_ILLEGAL) {
305     // Static fields are placed in mirror objects.
306     VM_ENTRY_MARK;
</pre>
</td>
<td>
<hr />
<pre>
248 void ciField::initialize_from(fieldDescriptor* fd) {
249   // Get the flags, offset, and canonical holder of the field.
250   _flags = ciFlags(fd-&gt;access_flags());
251   _offset = fd-&gt;offset();
252   Klass* field_holder = fd-&gt;field_holder();
253   assert(field_holder != NULL, &quot;null field_holder&quot;);
254   _holder = CURRENT_ENV-&gt;get_instance_klass(field_holder);
255 
256   // Check to see if the field is constant.
257   Klass* k = _holder-&gt;get_Klass();
258   bool is_stable_field = FoldStableValues &amp;&amp; is_stable();
259   if ((is_final() &amp;&amp; !has_initialized_final_update()) || is_stable_field) {
260     if (is_static()) {
261       // This field just may be constant.  The only case where it will
262       // not be constant is when the field is a *special* static &amp; final field
263       // whose value may change.  The three examples are java.lang.System.in,
264       // java.lang.System.out, and java.lang.System.err.
265       assert(SystemDictionary::System_klass() != NULL, &quot;Check once per vm&quot;);
266       if (k == SystemDictionary::System_klass()) {
267         // Check offsets for case 2: System.in, System.out, or System.err
<span class="line-modified">268         if (_offset == java_lang_System::in_offset()  ||</span>
<span class="line-modified">269             _offset == java_lang_System::out_offset() ||</span>
<span class="line-modified">270             _offset == java_lang_System::err_offset()) {</span>
271           _is_constant = false;
272           return;
273         }
274       }
275       _is_constant = true;
276     } else {
277       // An instance field can be constant if it&#39;s a final static field or if
278       // it&#39;s a final non-static field of a trusted class (classes in
279       // java.lang.invoke and sun.invoke packages and subpackages).
280       _is_constant = is_stable_field || trust_final_non_static_fields(_holder);
281     }
282   } else {
283     // For CallSite objects treat the target field as a compile time constant.
284     assert(SystemDictionary::CallSite_klass() != NULL, &quot;should be already initialized&quot;);
285     if (k == SystemDictionary::CallSite_klass() &amp;&amp;
<span class="line-modified">286         _offset == java_lang_invoke_CallSite::target_offset()) {</span>
287       assert(!has_initialized_final_update(), &quot;CallSite is not supposed to have writes to final fields outside initializers&quot;);
288       _is_constant = true;
289     } else {
290       // Non-final &amp; non-stable fields are not constants.
291       _is_constant = false;
292     }
293   }
294 }
295 
296 // ------------------------------------------------------------------
297 // ciField::constant_value
298 // Get the constant value of a this static field.
299 ciConstant ciField::constant_value() {
300   assert(is_static() &amp;&amp; is_constant(), &quot;illegal call to constant_value()&quot;);
301   if (!_holder-&gt;is_initialized()) {
302     return ciConstant(); // Not initialized yet
303   }
304   if (_constant_value.basic_type() == T_ILLEGAL) {
305     // Static fields are placed in mirror objects.
306     VM_ENTRY_MARK;
</pre>
</td>
</tr>
</table>
<center><a href="../c1/c1_LIRGenerator.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="ciInstanceKlass.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>