<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/runtime/serviceThread.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="safepoint.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="sharedRuntime.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/runtime/serviceThread.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -108,10 +108,11 @@</span>
      bool symboltable_work = false;
      bool resolved_method_table_work = false;
      bool thread_id_table_work = false;
      bool protection_domain_table_work = false;
      bool oopstorage_work = false;
<span class="udiff-line-added">+     bool deflate_idle_monitors = false;</span>
      JvmtiDeferredEvent jvmti_event;
      {
        // Need state transition ThreadBlockInVM so that this thread
        // will be handled by safepoint correctly when this thread is
        // notified at a safepoint.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -134,14 +135,18 @@</span>
                (stringtable_work = StringTable::has_work()) |
                (symboltable_work = SymbolTable::has_work()) |
                (resolved_method_table_work = ResolvedMethodTable::has_work()) |
                (thread_id_table_work = ThreadIdTable::has_work()) |
                (protection_domain_table_work = SystemDictionary::pd_cache_table()-&gt;has_work()) |
<span class="udiff-line-modified-removed">-               (oopstorage_work = OopStorage::has_cleanup_work_and_reset())</span>
<span class="udiff-line-modified-added">+               (oopstorage_work = OopStorage::has_cleanup_work_and_reset()) |</span>
<span class="udiff-line-added">+               (deflate_idle_monitors = ObjectSynchronizer::is_async_deflation_needed())</span>
               ) == 0) {
          // Wait until notified that there is some work to do.
<span class="udiff-line-modified-removed">-         ml.wait();</span>
<span class="udiff-line-modified-added">+         // If AsyncDeflateIdleMonitors, then we wait for</span>
<span class="udiff-line-added">+         // GuaranteedSafepointInterval so that is_async_deflation_needed()</span>
<span class="udiff-line-added">+         // is checked at the same interval.</span>
<span class="udiff-line-added">+         ml.wait(AsyncDeflateIdleMonitors ? GuaranteedSafepointInterval : 0);</span>
        }
  
        if (has_jvmti_events) {
          // Get the event under the Service_lock
          jvmti_event = _jvmti_service_queue.dequeue();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -189,10 +194,14 @@</span>
      }
  
      if (oopstorage_work) {
        cleanup_oopstorages();
      }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if (deflate_idle_monitors) {</span>
<span class="udiff-line-added">+       ObjectSynchronizer::deflate_idle_monitors_using_JT();</span>
<span class="udiff-line-added">+     }</span>
    }
  }
  
  void ServiceThread::enqueue_deferred_event(JvmtiDeferredEvent* event) {
    MutexLocker ml(Service_lock, Mutex::_no_safepoint_check_flag);
</pre>
<center><a href="safepoint.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="sharedRuntime.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>