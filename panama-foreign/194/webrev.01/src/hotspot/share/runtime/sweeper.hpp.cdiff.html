<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/runtime/sweeper.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="sweeper.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="synchronizer.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/runtime/sweeper.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 64,19 ***</span>
      MadeZombie,
      Flushed
    };
    static long      _traversals;                   // Stack scan count, also sweep ID.
    static long      _total_nof_code_cache_sweeps;  // Total number of full sweeps of the code cache
<span class="line-removed">-   static long      _time_counter;                 // Virtual time used to periodically invoke sweeper</span>
<span class="line-removed">-   static long      _last_sweep;                   // Value of _time_counter when the last sweep happened</span>
    static CompiledMethodIterator _current;         // Current compiled method
    static int       _seen;                         // Nof. nmethod we have currently processed in current pass of CodeCache
  
<span class="line-modified">!   static volatile int  _sweep_started;            // Flag to control conc sweeper</span>
<span class="line-modified">!   static volatile bool _should_sweep;             // Indicates if we should invoke the sweeper</span>
<span class="line-modified">!   static volatile bool _force_sweep;              // Indicates if we should force a sweep</span>
<span class="line-removed">-   static volatile int _bytes_changed;             // Counts the total nmethod size if the nmethod changed from:</span>
                                                    //   1) alive       -&gt; not_entrant
                                                    //   2) not_entrant -&gt; zombie
    // Stat counters
    static long      _total_nof_methods_reclaimed;    // Accumulated nof methods flushed
    static long      _total_nof_c2_methods_reclaimed; // Accumulated nof C2-compiled methods flushed
<span class="line-new-header">--- 64,17 ---</span>
      MadeZombie,
      Flushed
    };
    static long      _traversals;                   // Stack scan count, also sweep ID.
    static long      _total_nof_code_cache_sweeps;  // Total number of full sweeps of the code cache
    static CompiledMethodIterator _current;         // Current compiled method
    static int       _seen;                         // Nof. nmethod we have currently processed in current pass of CodeCache
<span class="line-added">+   static size_t    _sweep_threshold_bytes;        // The threshold for when to invoke sweeps</span>
  
<span class="line-modified">!   static volatile bool _should_sweep;             // Indicates if a normal sweep will be done</span>
<span class="line-modified">!   static volatile bool _force_sweep;              // Indicates if a forced sweep will be done</span>
<span class="line-modified">!   static volatile size_t _bytes_changed;          // Counts the total nmethod size if the nmethod changed from:</span>
                                                    //   1) alive       -&gt; not_entrant
                                                    //   2) not_entrant -&gt; zombie
    // Stat counters
    static long      _total_nof_methods_reclaimed;    // Accumulated nof methods flushed
    static long      _total_nof_c2_methods_reclaimed; // Accumulated nof C2-compiled methods flushed
</pre>
<hr />
<pre>
<span class="line-old-header">*** 93,37 ***</span>
    static void init_sweeper_log() NOT_DEBUG_RETURN;
    static bool wait_for_stack_scanning();
    static void sweep_code_cache();
    static void handle_safepoint_request();
    static void do_stack_scanning();
<span class="line-modified">!   static void possibly_sweep();</span>
   public:
<span class="line-modified">!   static long traversal_count()              { return _traversals; }</span>
<span class="line-modified">!   static int  total_nof_methods_reclaimed()  { return _total_nof_methods_reclaimed; }</span>
    static const Tickspan total_time_sweeping()      { return _total_time_sweeping; }
    static const Tickspan peak_sweep_time()          { return _peak_sweep_time; }
    static const Tickspan peak_sweep_fraction_time() { return _peak_sweep_fraction_time; }
    static void log_sweep(const char* msg, const char* format = NULL, ...) ATTRIBUTE_PRINTF(2, 3);
  
<span class="line-removed">- </span>
  #ifdef ASSERT
    // Keep track of sweeper activity in the ring buffer
    static void record_sweep(CompiledMethod* nm, int line);
<span class="line-removed">-   static void report_events(int id, address entry);</span>
<span class="line-removed">-   static void report_events();</span>
  #endif
  
<span class="line-removed">-   static void mark_active_nmethods();      // Invoked at the end of each safepoint</span>
    static CodeBlobClosure* prepare_mark_active_nmethods();
    static CodeBlobClosure* prepare_reset_hotness_counters();
    static void sweeper_loop();
<span class="line-modified">!   static void notify(int code_blob_type);  // Possibly start the sweeper thread.</span>
    static void force_sweep();
<span class="line-removed">- </span>
    static int hotness_counter_reset_val();
    static void report_state_change(nmethod* nm);
<span class="line-modified">!   static void possibly_enable_sweeper();</span>
    static void possibly_flush(nmethod* nm);
    static void print(outputStream* out);   // Printing/debugging
    static void print() { print(tty); }
  };
  
<span class="line-new-header">--- 91,35 ---</span>
    static void init_sweeper_log() NOT_DEBUG_RETURN;
    static bool wait_for_stack_scanning();
    static void sweep_code_cache();
    static void handle_safepoint_request();
    static void do_stack_scanning();
<span class="line-modified">!   static void sweep();</span>
   public:
<span class="line-modified">!   static long traversal_count()                    { return _traversals; }</span>
<span class="line-modified">!   static size_t sweep_threshold_bytes()              { return _sweep_threshold_bytes; }</span>
<span class="line-added">+   static void set_sweep_threshold_bytes(size_t threshold) { _sweep_threshold_bytes = threshold; }</span>
<span class="line-added">+   static int  total_nof_methods_reclaimed()        { return _total_nof_methods_reclaimed; }</span>
    static const Tickspan total_time_sweeping()      { return _total_time_sweeping; }
    static const Tickspan peak_sweep_time()          { return _peak_sweep_time; }
    static const Tickspan peak_sweep_fraction_time() { return _peak_sweep_fraction_time; }
    static void log_sweep(const char* msg, const char* format = NULL, ...) ATTRIBUTE_PRINTF(2, 3);
  
  #ifdef ASSERT
    // Keep track of sweeper activity in the ring buffer
    static void record_sweep(CompiledMethod* nm, int line);
  #endif
  
    static CodeBlobClosure* prepare_mark_active_nmethods();
    static CodeBlobClosure* prepare_reset_hotness_counters();
<span class="line-added">+ </span>
    static void sweeper_loop();
<span class="line-modified">!   static bool should_start_aggressive_sweep(int code_blob_type);</span>
    static void force_sweep();
    static int hotness_counter_reset_val();
    static void report_state_change(nmethod* nm);
<span class="line-modified">!   static void report_allocation(int code_blob_type);  // Possibly start the sweeper thread.</span>
    static void possibly_flush(nmethod* nm);
    static void print(outputStream* out);   // Printing/debugging
    static void print() { print(tty); }
  };
  
</pre>
<center><a href="sweeper.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="synchronizer.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>