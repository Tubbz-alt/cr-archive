<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/time/tck/java/time/TCKLocalDateTime.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../lang/invoke/defineHiddenClass/BasicTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="TCKLocalTime.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/time/tck/java/time/TCKLocalDateTime.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2012, 2015, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
</pre>
<hr />
<pre>
  93 import static java.time.temporal.ChronoUnit.HALF_DAYS;
  94 import static java.time.temporal.ChronoUnit.HOURS;
  95 import static java.time.temporal.ChronoUnit.MICROS;
  96 import static java.time.temporal.ChronoUnit.MILLENNIA;
  97 import static java.time.temporal.ChronoUnit.MILLIS;
  98 import static java.time.temporal.ChronoUnit.MINUTES;
  99 import static java.time.temporal.ChronoUnit.MONTHS;
 100 import static java.time.temporal.ChronoUnit.NANOS;
 101 import static java.time.temporal.ChronoUnit.SECONDS;
 102 import static java.time.temporal.ChronoUnit.WEEKS;
 103 import static java.time.temporal.ChronoUnit.YEARS;
 104 import static org.testng.Assert.assertEquals;
 105 import static org.testng.Assert.assertFalse;
 106 import static org.testng.Assert.assertSame;
 107 import static org.testng.Assert.assertTrue;
 108 import static org.testng.Assert.fail;
 109 
 110 import java.time.Clock;
 111 import java.time.DateTimeException;
 112 import java.time.DayOfWeek;

 113 import java.time.Instant;
 114 import java.time.LocalDate;
 115 import java.time.LocalDateTime;
 116 import java.time.LocalTime;
 117 import java.time.Month;
 118 import java.time.OffsetDateTime;
 119 import java.time.OffsetTime;
 120 import java.time.Year;
 121 import java.time.ZoneId;
 122 import java.time.ZoneOffset;
 123 import java.time.ZonedDateTime;
 124 import java.time.chrono.IsoChronology;
 125 import java.time.format.DateTimeFormatter;
 126 import java.time.format.DateTimeParseException;
 127 import java.time.temporal.ChronoField;
 128 import java.time.temporal.ChronoUnit;
 129 import java.time.temporal.JulianFields;
 130 import java.time.temporal.Temporal;
 131 import java.time.temporal.TemporalAccessor;
 132 import java.time.temporal.TemporalAdjuster;
</pre>
<hr />
<pre>
 267             expected = LocalDateTime.now(Clock.systemDefaultZone());
 268             test = LocalDateTime.now();
 269             diff = Math.abs(test.toLocalTime().toNanoOfDay() - expected.toLocalTime().toNanoOfDay());
 270         }
 271         assertTrue(diff &lt; DELTA);
 272     }
 273 
 274     //-----------------------------------------------------------------------
 275     // now(ZoneId)
 276     //-----------------------------------------------------------------------
 277     @Test(expectedExceptions=NullPointerException.class)
 278     public void now_ZoneId_nullZoneId() {
 279         LocalDateTime.now((ZoneId) null);
 280     }
 281 
 282     @Test
 283     public void now_ZoneId() {
 284         ZoneId zone = ZoneId.of(&quot;UTC+01:02:03&quot;);
 285         LocalDateTime expected = LocalDateTime.now(Clock.system(zone));
 286         LocalDateTime test = LocalDateTime.now(zone);
<span class="line-modified"> 287         for (int i = 0; i &lt; 100; i++) {</span>
<span class="line-modified"> 288             if (expected.equals(test)) {</span>
<span class="line-removed"> 289                 return;</span>
<span class="line-removed"> 290             }</span>
<span class="line-removed"> 291             expected = LocalDateTime.now(Clock.system(zone));</span>
<span class="line-removed"> 292             test = LocalDateTime.now(zone);</span>
<span class="line-removed"> 293         }</span>
<span class="line-removed"> 294         assertEquals(test.truncatedTo(ChronoUnit.SECONDS),</span>
<span class="line-removed"> 295                      expected.truncatedTo(ChronoUnit.SECONDS));</span>
 296     }
 297 
 298     //-----------------------------------------------------------------------
 299     // now(Clock)
 300     //-----------------------------------------------------------------------
 301     @Test(expectedExceptions=NullPointerException.class)
 302     public void now_Clock_nullClock() {
 303         LocalDateTime.now((Clock) null);
 304     }
 305 
 306     @Test
 307     public void now_Clock_allSecsInDay_utc() {
 308         for (int i = 0; i &lt; (2 * 24 * 60 * 60); i++) {
 309             Instant instant = Instant.ofEpochSecond(i).plusNanos(123456789L);
 310             Clock clock = Clock.fixed(instant, ZoneOffset.UTC);
 311             LocalDateTime test = LocalDateTime.now(clock);
 312             assertEquals(test.getYear(), 1970);
 313             assertEquals(test.getMonth(), Month.JANUARY);
 314             assertEquals(test.getDayOfMonth(), (i &lt; 24 * 60 * 60 ? 1 : 2));
 315             assertEquals(test.getHour(), (i / (60 * 60)) % 24);
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2012, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
</pre>
<hr />
<pre>
  93 import static java.time.temporal.ChronoUnit.HALF_DAYS;
  94 import static java.time.temporal.ChronoUnit.HOURS;
  95 import static java.time.temporal.ChronoUnit.MICROS;
  96 import static java.time.temporal.ChronoUnit.MILLENNIA;
  97 import static java.time.temporal.ChronoUnit.MILLIS;
  98 import static java.time.temporal.ChronoUnit.MINUTES;
  99 import static java.time.temporal.ChronoUnit.MONTHS;
 100 import static java.time.temporal.ChronoUnit.NANOS;
 101 import static java.time.temporal.ChronoUnit.SECONDS;
 102 import static java.time.temporal.ChronoUnit.WEEKS;
 103 import static java.time.temporal.ChronoUnit.YEARS;
 104 import static org.testng.Assert.assertEquals;
 105 import static org.testng.Assert.assertFalse;
 106 import static org.testng.Assert.assertSame;
 107 import static org.testng.Assert.assertTrue;
 108 import static org.testng.Assert.fail;
 109 
 110 import java.time.Clock;
 111 import java.time.DateTimeException;
 112 import java.time.DayOfWeek;
<span class="line-added"> 113 import java.time.Duration;</span>
 114 import java.time.Instant;
 115 import java.time.LocalDate;
 116 import java.time.LocalDateTime;
 117 import java.time.LocalTime;
 118 import java.time.Month;
 119 import java.time.OffsetDateTime;
 120 import java.time.OffsetTime;
 121 import java.time.Year;
 122 import java.time.ZoneId;
 123 import java.time.ZoneOffset;
 124 import java.time.ZonedDateTime;
 125 import java.time.chrono.IsoChronology;
 126 import java.time.format.DateTimeFormatter;
 127 import java.time.format.DateTimeParseException;
 128 import java.time.temporal.ChronoField;
 129 import java.time.temporal.ChronoUnit;
 130 import java.time.temporal.JulianFields;
 131 import java.time.temporal.Temporal;
 132 import java.time.temporal.TemporalAccessor;
 133 import java.time.temporal.TemporalAdjuster;
</pre>
<hr />
<pre>
 268             expected = LocalDateTime.now(Clock.systemDefaultZone());
 269             test = LocalDateTime.now();
 270             diff = Math.abs(test.toLocalTime().toNanoOfDay() - expected.toLocalTime().toNanoOfDay());
 271         }
 272         assertTrue(diff &lt; DELTA);
 273     }
 274 
 275     //-----------------------------------------------------------------------
 276     // now(ZoneId)
 277     //-----------------------------------------------------------------------
 278     @Test(expectedExceptions=NullPointerException.class)
 279     public void now_ZoneId_nullZoneId() {
 280         LocalDateTime.now((ZoneId) null);
 281     }
 282 
 283     @Test
 284     public void now_ZoneId() {
 285         ZoneId zone = ZoneId.of(&quot;UTC+01:02:03&quot;);
 286         LocalDateTime expected = LocalDateTime.now(Clock.system(zone));
 287         LocalDateTime test = LocalDateTime.now(zone);
<span class="line-modified"> 288         assertEquals(Duration.between(expected, test).truncatedTo(ChronoUnit.SECONDS),</span>
<span class="line-modified"> 289                 Duration.ZERO);</span>







 290     }
 291 
 292     //-----------------------------------------------------------------------
 293     // now(Clock)
 294     //-----------------------------------------------------------------------
 295     @Test(expectedExceptions=NullPointerException.class)
 296     public void now_Clock_nullClock() {
 297         LocalDateTime.now((Clock) null);
 298     }
 299 
 300     @Test
 301     public void now_Clock_allSecsInDay_utc() {
 302         for (int i = 0; i &lt; (2 * 24 * 60 * 60); i++) {
 303             Instant instant = Instant.ofEpochSecond(i).plusNanos(123456789L);
 304             Clock clock = Clock.fixed(instant, ZoneOffset.UTC);
 305             LocalDateTime test = LocalDateTime.now(clock);
 306             assertEquals(test.getYear(), 1970);
 307             assertEquals(test.getMonth(), Month.JANUARY);
 308             assertEquals(test.getDayOfMonth(), (i &lt; 24 * 60 * 60 ? 1 : 2));
 309             assertEquals(test.getHour(), (i / (60 * 60)) % 24);
</pre>
</td>
</tr>
</table>
<center><a href="../../../../lang/invoke/defineHiddenClass/BasicTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="TCKLocalTime.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>