<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/lang/invoke/DefineClassTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../String/concat/StringConcatFactoryInvariants.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="defineHiddenClass/BasicTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/lang/invoke/DefineClassTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
225     public void testNoPackageAccess() throws Exception {
226         Lookup lookup = lookup().dropLookupMode(PACKAGE);
227         lookup.defineClass(generateClass(THIS_PACKAGE + &quot;.C&quot;));
228     }
229 
230     @Test(expectedExceptions = { ClassFormatError.class })
231     public void testTruncatedClassFile() throws Exception {
232         lookup().defineClass(new byte[0]);
233     }
234 
235     @Test(expectedExceptions = { NullPointerException.class })
236     public void testNull() throws Exception {
237         lookup().defineClass(null);
238     }
239 
240     @Test(expectedExceptions = { NoClassDefFoundError.class })
241     public void testLinking() throws Exception {
242         lookup().defineClass(generateNonLinkableClass(THIS_PACKAGE + &quot;.NonLinkableClass&quot;));
243     }
244 





245     /**
246      * Generates a class file with the given class name
247      */
248     byte[] generateClass(String className) {
249         ClassWriter cw = new ClassWriter(ClassWriter.COMPUTE_MAXS
250                                          + ClassWriter.COMPUTE_FRAMES);
251         cw.visit(V9,
252                 ACC_PUBLIC + ACC_SUPER,
253                 className.replace(&quot;.&quot;, &quot;/&quot;),
254                 null,
255                 &quot;java/lang/Object&quot;,
256                 null);
257 
258         // &lt;init&gt;
259         MethodVisitor mv = cw.visitMethod(ACC_PUBLIC, &quot;&lt;init&gt;&quot;, &quot;()V&quot;, null, null);
260         mv.visitVarInsn(ALOAD, 0);
261         mv.visitMethodInsn(INVOKESPECIAL, &quot;java/lang/Object&quot;, &quot;&lt;init&gt;&quot;, &quot;()V&quot;, false);
262         mv.visitInsn(RETURN);
263         mv.visitMaxs(0, 0);
264         mv.visitEnd();
</pre>
<hr />
<pre>
349                 + ClassWriter.COMPUTE_FRAMES);
350         cw.visit(V14,
351                 ACC_PUBLIC + ACC_SUPER,
352                 className.replace(&quot;.&quot;, &quot;/&quot;),
353                 null,
354                 &quot;MissingSuperClass&quot;,
355                 null);
356 
357         // &lt;init&gt;
358         MethodVisitor mv = cw.visitMethod(ACC_PUBLIC, &quot;&lt;init&gt;&quot;, &quot;()V&quot;, null, null);
359         mv.visitVarInsn(ALOAD, 0);
360         mv.visitMethodInsn(INVOKESPECIAL, &quot;MissingSuperClass&quot;, &quot;&lt;init&gt;&quot;, &quot;()V&quot;, false);
361         mv.visitInsn(RETURN);
362         mv.visitMaxs(0, 0);
363         mv.visitEnd();
364 
365         cw.visitEnd();
366         return cw.toByteArray();
367     }
368 

















369     private int nextNumber() {
370         return ++nextNumber;
371     }
372 
373     private int nextNumber;
374 }
</pre>
</td>
<td>
<hr />
<pre>
225     public void testNoPackageAccess() throws Exception {
226         Lookup lookup = lookup().dropLookupMode(PACKAGE);
227         lookup.defineClass(generateClass(THIS_PACKAGE + &quot;.C&quot;));
228     }
229 
230     @Test(expectedExceptions = { ClassFormatError.class })
231     public void testTruncatedClassFile() throws Exception {
232         lookup().defineClass(new byte[0]);
233     }
234 
235     @Test(expectedExceptions = { NullPointerException.class })
236     public void testNull() throws Exception {
237         lookup().defineClass(null);
238     }
239 
240     @Test(expectedExceptions = { NoClassDefFoundError.class })
241     public void testLinking() throws Exception {
242         lookup().defineClass(generateNonLinkableClass(THIS_PACKAGE + &quot;.NonLinkableClass&quot;));
243     }
244 
<span class="line-added">245     @Test(expectedExceptions = { IllegalArgumentException.class })</span>
<span class="line-added">246     public void testModuleInfo() throws Exception {</span>
<span class="line-added">247         lookup().defineClass(generateModuleInfo());</span>
<span class="line-added">248     }</span>
<span class="line-added">249 </span>
250     /**
251      * Generates a class file with the given class name
252      */
253     byte[] generateClass(String className) {
254         ClassWriter cw = new ClassWriter(ClassWriter.COMPUTE_MAXS
255                                          + ClassWriter.COMPUTE_FRAMES);
256         cw.visit(V9,
257                 ACC_PUBLIC + ACC_SUPER,
258                 className.replace(&quot;.&quot;, &quot;/&quot;),
259                 null,
260                 &quot;java/lang/Object&quot;,
261                 null);
262 
263         // &lt;init&gt;
264         MethodVisitor mv = cw.visitMethod(ACC_PUBLIC, &quot;&lt;init&gt;&quot;, &quot;()V&quot;, null, null);
265         mv.visitVarInsn(ALOAD, 0);
266         mv.visitMethodInsn(INVOKESPECIAL, &quot;java/lang/Object&quot;, &quot;&lt;init&gt;&quot;, &quot;()V&quot;, false);
267         mv.visitInsn(RETURN);
268         mv.visitMaxs(0, 0);
269         mv.visitEnd();
</pre>
<hr />
<pre>
354                 + ClassWriter.COMPUTE_FRAMES);
355         cw.visit(V14,
356                 ACC_PUBLIC + ACC_SUPER,
357                 className.replace(&quot;.&quot;, &quot;/&quot;),
358                 null,
359                 &quot;MissingSuperClass&quot;,
360                 null);
361 
362         // &lt;init&gt;
363         MethodVisitor mv = cw.visitMethod(ACC_PUBLIC, &quot;&lt;init&gt;&quot;, &quot;()V&quot;, null, null);
364         mv.visitVarInsn(ALOAD, 0);
365         mv.visitMethodInsn(INVOKESPECIAL, &quot;MissingSuperClass&quot;, &quot;&lt;init&gt;&quot;, &quot;()V&quot;, false);
366         mv.visitInsn(RETURN);
367         mv.visitMaxs(0, 0);
368         mv.visitEnd();
369 
370         cw.visitEnd();
371         return cw.toByteArray();
372     }
373 
<span class="line-added">374     /**</span>
<span class="line-added">375      * Generates a class file with the given class name</span>
<span class="line-added">376      */</span>
<span class="line-added">377     byte[] generateModuleInfo() {</span>
<span class="line-added">378         ClassWriter cw = new ClassWriter(ClassWriter.COMPUTE_MAXS</span>
<span class="line-added">379                 + ClassWriter.COMPUTE_FRAMES);</span>
<span class="line-added">380         cw.visit(V14,</span>
<span class="line-added">381                 ACC_MODULE,</span>
<span class="line-added">382                 &quot;module-info&quot;,</span>
<span class="line-added">383                 null,</span>
<span class="line-added">384                 null,</span>
<span class="line-added">385                 null);</span>
<span class="line-added">386 </span>
<span class="line-added">387         cw.visitEnd();</span>
<span class="line-added">388         return cw.toByteArray();</span>
<span class="line-added">389     }</span>
<span class="line-added">390 </span>
391     private int nextNumber() {
392         return ++nextNumber;
393     }
394 
395     private int nextNumber;
396 }
</pre>
</td>
</tr>
</table>
<center><a href="../String/concat/StringConcatFactoryInvariants.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="defineHiddenClass/BasicTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>