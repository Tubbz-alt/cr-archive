<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/tools/javac/parser/JavacParserTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../modules/EdgeCases.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../processing/model/TestSourceVersion.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/parser/JavacParserTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
1475         CompilationUnitTree cut = ct.parse().iterator().next();
1476         List&lt;String&gt; actual = List.of(output.toString().split(&quot;\r?\n&quot;));
1477         List&lt;String&gt; expected = List.of(&quot;Test.java:1:29: compiler.err.expected: token.identifier&quot;);
1478 
1479         assertEquals(&quot;The expected and actual errors do not match, actual errors: &quot; + actual,
1480                      actual,
1481                      expected);
1482 
1483         String actualAST = cut.toString().replaceAll(&quot;\\R&quot;, &quot;\n&quot;);
1484         String expectedAST = &quot;package test;\n&quot; +
1485                              &quot;\n&quot; +
1486                              &quot;class Test {\n&quot; +
1487                              &quot;    v &lt;error&gt;;\n&quot; +
1488                              &quot;    v v;\n&quot; +
1489                              &quot;}&quot;;
1490         assertEquals(&quot;The expected and actual AST do not match, actual AST: &quot; + actualAST,
1491                      actualAST,
1492                      expectedAST);
1493     }
1494 




















1495     void run(String[] args) throws Exception {
1496         int passed = 0, failed = 0;
1497         final Pattern p = (args != null &amp;&amp; args.length &gt; 0)
1498                 ? Pattern.compile(args[0])
1499                 : null;
1500         for (Method m : this.getClass().getDeclaredMethods()) {
1501             boolean selected = (p == null)
1502                     ? m.isAnnotationPresent(Test.class)
1503                     : p.matcher(m.getName()).matches();
1504             if (selected) {
1505                 try {
1506                     m.invoke(this, (Object[]) null);
1507                     System.out.println(m.getName() + &quot;: OK&quot;);
1508                     passed++;
1509                 } catch (Throwable ex) {
1510                     System.out.printf(&quot;Test %s failed: %s %n&quot;, m, ex.getCause());
1511                     failed++;
1512                 }
1513             }
1514         }
</pre>
</td>
<td>
<hr />
<pre>
1475         CompilationUnitTree cut = ct.parse().iterator().next();
1476         List&lt;String&gt; actual = List.of(output.toString().split(&quot;\r?\n&quot;));
1477         List&lt;String&gt; expected = List.of(&quot;Test.java:1:29: compiler.err.expected: token.identifier&quot;);
1478 
1479         assertEquals(&quot;The expected and actual errors do not match, actual errors: &quot; + actual,
1480                      actual,
1481                      expected);
1482 
1483         String actualAST = cut.toString().replaceAll(&quot;\\R&quot;, &quot;\n&quot;);
1484         String expectedAST = &quot;package test;\n&quot; +
1485                              &quot;\n&quot; +
1486                              &quot;class Test {\n&quot; +
1487                              &quot;    v &lt;error&gt;;\n&quot; +
1488                              &quot;    v v;\n&quot; +
1489                              &quot;}&quot;;
1490         assertEquals(&quot;The expected and actual AST do not match, actual AST: &quot; + actualAST,
1491                      actualAST,
1492                      expectedAST);
1493     }
1494 
<span class="line-added">1495     @Test</span>
<span class="line-added">1496     void testStartAndEndPositionForClassesInPermitsClause() throws IOException {</span>
<span class="line-added">1497         String code = &quot;package t; sealed class Test permits Sub1, Sub2 {} final class Sub1 extends Test {} final class Sub2 extends Test {}&quot;;</span>
<span class="line-added">1498         JavacTaskImpl ct = (JavacTaskImpl) tool.getTask(null, fm, null,</span>
<span class="line-added">1499                 List.of(&quot;--enable-preview&quot;, &quot;-source&quot;, Integer.toString(Runtime.version().feature())),</span>
<span class="line-added">1500                 null, Arrays.asList(new MyFileObject(code)));</span>
<span class="line-added">1501         CompilationUnitTree cut = ct.parse().iterator().next();</span>
<span class="line-added">1502         ClassTree clazz = (ClassTree) cut.getTypeDecls().get(0);</span>
<span class="line-added">1503         List&lt;? extends Tree&gt; permitsList = clazz.getPermitsClause();</span>
<span class="line-added">1504         assertEquals(&quot;testStartAndEndPositionForClassesInPermitsClause&quot;, 2, permitsList.size());</span>
<span class="line-added">1505         Trees t = Trees.instance(ct);</span>
<span class="line-added">1506         List&lt;String&gt; expected = List.of(&quot;Sub1&quot;, &quot;Sub2&quot;);</span>
<span class="line-added">1507         int i = 0;</span>
<span class="line-added">1508         for (Tree permitted: permitsList) {</span>
<span class="line-added">1509             int start = (int) t.getSourcePositions().getStartPosition(cut, permitted);</span>
<span class="line-added">1510             int end = (int) t.getSourcePositions().getEndPosition(cut, permitted);</span>
<span class="line-added">1511             assertEquals(&quot;testStartAndEndPositionForClassesInPermitsClause&quot;, expected.get(i++), code.substring(start, end));</span>
<span class="line-added">1512         }</span>
<span class="line-added">1513     }</span>
<span class="line-added">1514 </span>
1515     void run(String[] args) throws Exception {
1516         int passed = 0, failed = 0;
1517         final Pattern p = (args != null &amp;&amp; args.length &gt; 0)
1518                 ? Pattern.compile(args[0])
1519                 : null;
1520         for (Method m : this.getClass().getDeclaredMethods()) {
1521             boolean selected = (p == null)
1522                     ? m.isAnnotationPresent(Test.class)
1523                     : p.matcher(m.getName()).matches();
1524             if (selected) {
1525                 try {
1526                     m.invoke(this, (Object[]) null);
1527                     System.out.println(m.getName() + &quot;: OK&quot;);
1528                     passed++;
1529                 } catch (Throwable ex) {
1530                     System.out.printf(&quot;Test %s failed: %s %n&quot;, m, ex.getCause());
1531                     failed++;
1532                 }
1533             }
1534         }
</pre>
</td>
</tr>
</table>
<center><a href="../modules/EdgeCases.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../processing/model/TestSourceVersion.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>