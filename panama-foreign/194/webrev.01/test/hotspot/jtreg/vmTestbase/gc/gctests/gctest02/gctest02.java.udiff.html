<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/hotspot/jtreg/vmTestbase/gc/gctests/gctest02/gctest02.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../gctest01/gctest01.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../gctest03/gctest03.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/gc/gctests/gctest02/gctest02.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2002, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2002, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -23,11 +23,11 @@</span>
  //gctest02.java
  
  
  /*
   * @test
<span class="udiff-line-modified-removed">-  * @key gc</span>
<span class="udiff-line-modified-added">+  * @key gc randomness</span>
   *
   * @summary converted from VM Testbase gc/gctests/gctest02.
   * VM Testbase keywords: [gc]
   *
   * @library /vmTestbase
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -38,39 +38,25 @@</span>
  
  package gc.gctests.gctest02;
  
  import nsk.share.TestFailure;
  import nsk.share.TestBug;
<span class="udiff-line-added">+ import nsk.share.test.LocalRandom;</span>
<span class="udiff-line-added">+ </span>
  /*  stress testing
   create 16 memory evil threads requesting to allocate
   the object of sizes from 8 to ( 2 ^ 19).
   The live time of objects is random (0 ~ 1000).
   Here we let the threads that reference the objects
   to simulate the object life time.
  */
  
<span class="udiff-line-removed">- import java.util.Random;</span>
<span class="udiff-line-removed">- </span>
  class PopulationException extends Exception {
      //this exception is used to signal that we&#39;ve
      //reached the end of the test
  }
  
<span class="udiff-line-removed">- //the LocalRandom class is used to isolate the pseudo-random</span>
<span class="udiff-line-removed">- //number generator from other parts of the system which might</span>
<span class="udiff-line-removed">- //silently be using it.</span>
<span class="udiff-line-removed">- //This is to make sure the tests are repeatable</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- class LocalRandom {</span>
<span class="udiff-line-removed">-     public static Random rGen = null;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     public static double random() {</span>
<span class="udiff-line-removed">-         //should fail if rGen is not initialized</span>
<span class="udiff-line-removed">-         return rGen.nextDouble();</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  class ThreadCount {
      static int count= 0;
      static synchronized void inc() { count++; }
      static synchronized void dec() { count --; }
      static synchronized int get() { return count; }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -188,11 +174,10 @@</span>
  
  public class gctest02 {
          public static void main(String args[] ) {
                  int bufsz = 8;
                  int peopleLimit = 1000;
<span class="udiff-line-removed">-                 long randomSeed = System.currentTimeMillis();</span>
                  Memevil me=null;
                  if (args.length &gt; 0)
                  {
                          try
                          {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -204,28 +189,13 @@</span>
                                          &quot;Bad input to gctest02. Expected integer, got: -&gt;&quot;
                                          + args[0] + &quot;&lt;-&quot;, e);
                          }
                  }
  
<span class="udiff-line-removed">-                 if (args.length == 2)</span>
<span class="udiff-line-removed">-                 {</span>
<span class="udiff-line-removed">-                         try</span>
<span class="udiff-line-removed">-                         {</span>
<span class="udiff-line-removed">-                                 randomSeed = new Long(args[1]).longValue();</span>
<span class="udiff-line-removed">-                         }</span>
<span class="udiff-line-removed">-                         catch (NumberFormatException e)</span>
<span class="udiff-line-removed">-                         {</span>
<span class="udiff-line-removed">-                                 throw new TestBug(</span>
<span class="udiff-line-removed">-                                         &quot;Bad input to gctest02. Expected long, got: -&gt;&quot;</span>
<span class="udiff-line-removed">-                                         + args[0] + &quot;&lt;-&quot;, e);</span>
<span class="udiff-line-removed">-                         }</span>
<span class="udiff-line-removed">-                 }</span>
                  Person.setPopulationLimit(peopleLimit);
<span class="udiff-line-removed">-                 System.out.println(&quot;Seed value: &quot; + randomSeed);</span>
                  for (int ii=0; ii&lt;40; ii++) {
                          bufsz = 8;
<span class="udiff-line-removed">-                         LocalRandom.rGen = new Random(randomSeed);</span>
                          Person.populationCount = 0;
                          Escaper you = new Escaper();
                          you.setName(&quot;Escaper&quot;);
                          ThreadCount.inc();
                          you.start();
</pre>
<center><a href="../gctest01/gctest01.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../gctest03/gctest03.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>