<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.incubator.foreign/share/classes/jdk/incubator/foreign/AllocationScope.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="AbstractLayout.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="Foreign.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.incubator.foreign/share/classes/jdk/incubator/foreign/AllocationScope.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
157      */
158     public MemoryAddress allocate(MemoryLayout layout, double value) {
159         VarHandle handle = layout.varHandle(double.class);
160         MemoryAddress addr = allocate(layout);
161         handle.set(addr, value);
162         return addr;
163     }
164 
165     /**
166      * Allocate a block of memory in this allocation scope with given layout and initialize it with given address value.
167      * The address returned by this method is associated with a segment which cannot be closed. Moreover, the returned
168      * address must conform to the layout alignment constraints.
169      * @param layout the layout of the block of memory to be allocated.
170      * @param value the value to be set on the newly allocated memory block.
171      * @return an address which points to the newly allocated memory block.
172      * @throws OutOfMemoryError if there is not enough space left in this allocation scope, that is, if
173      * {@code limit() - size() &lt; layout.byteSize()}.
174      * @throws IllegalArgumentException if {@code layout.byteSize()} does not conform to the size of an address value.
175      */
176     public MemoryAddress allocate(MemoryLayout layout, MemoryAddress value) {
<span class="line-modified">177         VarHandle handle = layout.varHandle(MemoryAddress.class);</span>
178         MemoryAddress addr = allocate(layout);
179         handle.set(addr, value);
180         return addr;
181     }
182 










183     /**
184      * Allocate a block of memory in this allocation scope with given layout. The address returned by this method is
185      * associated with a segment which cannot be closed. Moreover, the returned address must conform to the layout alignment constraints.
186      * @param layout the layout of the block of memory to be allocated.
187      * @return an address which points to the newly allocated memory block.
188      * @throws OutOfMemoryError if there is not enough space left in this allocation scope, that is, if
189      * {@code limit() - size() &lt; layout.byteSize()}.
190      */
191     public MemoryAddress allocate(MemoryLayout layout) {
192         return allocate(layout.byteSize(), layout.byteAlignment());
193     }
194 
195     /**
196      * Allocate a block of memory in this allocation scope with given size. The address returned by this method is
197      * associated with a segment which cannot be closed. Moreover, the returned address must be aligned to {@code size}.
198      * @param bytesSize the size (in bytes) of the block of memory to be allocated.
199      * @return an address which points to the newly allocated memory block.
200      * @throws OutOfMemoryError if there is not enough space left in this allocation scope, that is, if
201      * {@code limit() - size() &lt; bytesSize}.
202      */
</pre>
</td>
<td>
<hr />
<pre>
157      */
158     public MemoryAddress allocate(MemoryLayout layout, double value) {
159         VarHandle handle = layout.varHandle(double.class);
160         MemoryAddress addr = allocate(layout);
161         handle.set(addr, value);
162         return addr;
163     }
164 
165     /**
166      * Allocate a block of memory in this allocation scope with given layout and initialize it with given address value.
167      * The address returned by this method is associated with a segment which cannot be closed. Moreover, the returned
168      * address must conform to the layout alignment constraints.
169      * @param layout the layout of the block of memory to be allocated.
170      * @param value the value to be set on the newly allocated memory block.
171      * @return an address which points to the newly allocated memory block.
172      * @throws OutOfMemoryError if there is not enough space left in this allocation scope, that is, if
173      * {@code limit() - size() &lt; layout.byteSize()}.
174      * @throws IllegalArgumentException if {@code layout.byteSize()} does not conform to the size of an address value.
175      */
176     public MemoryAddress allocate(MemoryLayout layout, MemoryAddress value) {
<span class="line-modified">177         VarHandle handle = MemoryHandles.asAddressVarHandle(layout.varHandle(carrierForSize(layout.byteSize())));</span>
178         MemoryAddress addr = allocate(layout);
179         handle.set(addr, value);
180         return addr;
181     }
182 
<span class="line-added">183     private static Class&lt;?&gt; carrierForSize(long size) {</span>
<span class="line-added">184         return switch ((int)size) {</span>
<span class="line-added">185             case 1 -&gt; byte.class;</span>
<span class="line-added">186             case 2 -&gt; short.class;</span>
<span class="line-added">187             case 4 -&gt; int.class;</span>
<span class="line-added">188             case 8 -&gt; long.class;</span>
<span class="line-added">189             default -&gt; throw new IllegalArgumentException(&quot;Bad layout size: &quot; + size);</span>
<span class="line-added">190         };</span>
<span class="line-added">191     }</span>
<span class="line-added">192 </span>
193     /**
194      * Allocate a block of memory in this allocation scope with given layout. The address returned by this method is
195      * associated with a segment which cannot be closed. Moreover, the returned address must conform to the layout alignment constraints.
196      * @param layout the layout of the block of memory to be allocated.
197      * @return an address which points to the newly allocated memory block.
198      * @throws OutOfMemoryError if there is not enough space left in this allocation scope, that is, if
199      * {@code limit() - size() &lt; layout.byteSize()}.
200      */
201     public MemoryAddress allocate(MemoryLayout layout) {
202         return allocate(layout.byteSize(), layout.byteAlignment());
203     }
204 
205     /**
206      * Allocate a block of memory in this allocation scope with given size. The address returned by this method is
207      * associated with a segment which cannot be closed. Moreover, the returned address must be aligned to {@code size}.
208      * @param bytesSize the size (in bytes) of the block of memory to be allocated.
209      * @return an address which points to the newly allocated memory block.
210      * @throws OutOfMemoryError if there is not enough space left in this allocation scope, that is, if
211      * {@code limit() - size() &lt; bytesSize}.
212      */
</pre>
</td>
</tr>
</table>
<center><a href="AbstractLayout.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="Foreign.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>