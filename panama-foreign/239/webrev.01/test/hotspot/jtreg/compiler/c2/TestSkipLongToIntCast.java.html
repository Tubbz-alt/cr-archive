<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/hotspot/jtreg/compiler/c2/TestSkipLongToIntCast.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) BELLSOFT. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 package compiler.c2;
 25 
 26 /*
 27  * @test
 28  * @bug 8248043
 29  * @summary Functional test to enshure CmpL(int value, long constant) is not broken
 30  *
 31  * @run main/othervm -XX:-TieredCompilation -XX:CompileOnly=compiler.c2.TestSkipLongToIntCast::cmplTest
 32  *      compiler.c2.TestSkipLongToIntCast
 33  */
 34 public class TestSkipLongToIntCast {
 35 
 36     public static int[] pos = {0, 1, 2, 3};
 37     public static int[] neg = {0, -1, -2, -3};
 38     public static int[] max = {2147483647, 2147483646, 2147483645, 2147483644};
 39     public static int[] min = {-2147483648, -2147483647, -2147483646, -2147483645};
 40     public static int[] out = {(int)2147483648L, (int)-2147483649L, (int)Long.MAX_VALUE, (int)Long.MIN_VALUE};
 41 
 42     // Testing cmp(int value, long constant) expressions as they are updated
 43     // on Ideal graph level: i2l conversion is skipped when possible.
 44     public static void cmplTest() throws Exception {
 45         // values around zero
 46         if (pos[0] != 0L) { throw new Exception(&quot;pos[0] is &quot; + pos[0]); }
 47         if (pos[1] != 1L) { throw new Exception(&quot;pos[1] is &quot; + pos[1]); }
 48         if (pos[2] != 2L) { throw new Exception(&quot;pos[2] is &quot; + pos[2]); }
 49         if (pos[3] != 3L) { throw new Exception(&quot;pos[3] is &quot; + pos[3]); }
 50 
 51         if (neg[0] != -0L) { throw new Exception(&quot;neg[0] is &quot; + neg[0]); }
 52         if (neg[1] != -1L) { throw new Exception(&quot;neg[1] is &quot; + neg[1]); }
 53         if (neg[2] != -2L) { throw new Exception(&quot;neg[2] is &quot; + neg[2]); }
 54         if (neg[3] != -3L) { throw new Exception(&quot;neg[3] is &quot; + neg[3]); }
 55 
 56         // values near the ends of Integer range
 57         if (max[0] != 2147483647L) { throw new Exception(&quot;max[0] is &quot; + max[0]); }
 58         if (max[1] != 2147483646L) { throw new Exception(&quot;max[1] is &quot; + max[1]); }
 59         if (max[2] != 2147483645L) { throw new Exception(&quot;max[2] is &quot; + max[2]); }
 60         if (max[3] != 2147483644L) { throw new Exception(&quot;max[3] is &quot; + max[3]); }
 61 
 62         if (min[0] != -2147483648L) { throw new Exception(&quot;min[0] is &quot; + min[0]); }
 63         if (min[1] != -2147483647L) { throw new Exception(&quot;min[1] is &quot; + min[1]); }
 64         if (min[2] != -2147483646L) { throw new Exception(&quot;min[2] is &quot; + min[2]); }
 65         if (min[3] != -2147483645L) { throw new Exception(&quot;min[3] is &quot; + min[3]); }
 66 
 67         // constants outside of the Integer range
 68         if (out[0] == 2147483648L)  { throw new Exception(&quot;out[0] is &quot; + out[0]); }
 69         if (out[1] == -2147483649L) { throw new Exception(&quot;out[1] is &quot; + out[1]); }
 70         if (out[2] == Long.MAX_VALUE) { throw new Exception(&quot;out[2] is &quot; + out[2]); }
 71         if (out[3] == Long.MIN_VALUE) { throw new Exception(&quot;out[3] is &quot; + out[3]); }
 72     }
 73 
 74     // similar test with long constant on LHS
 75     public static void cmplTest_LHS() throws Exception {
 76         // values around zero
 77         if (0L != pos[0]) { throw new Exception(&quot;LHS: pos[0] is &quot; + pos[0]); }
 78         if (1L != pos[1]) { throw new Exception(&quot;LHS: pos[1] is &quot; + pos[1]); }
 79         if (2L != pos[2]) { throw new Exception(&quot;LHS: pos[2] is &quot; + pos[2]); }
 80         if (3L != pos[3]) { throw new Exception(&quot;LHS: pos[3] is &quot; + pos[3]); }
 81 
 82         if (-0L != neg[0]) { throw new Exception(&quot;LHS: neg[0] is &quot; + neg[0]); }
 83         if (-1L != neg[1]) { throw new Exception(&quot;LHS: neg[1] is &quot; + neg[1]); }
 84         if (-2L != neg[2]) { throw new Exception(&quot;LHS: neg[2] is &quot; + neg[2]); }
 85         if (-3L != neg[3]) { throw new Exception(&quot;LHS: neg[3] is &quot; + neg[3]); }
 86 
 87         // values near the ends of Integer range
 88         if (2147483647L != max[0]) { throw new Exception(&quot;LHS: max[0] is &quot; + max[0]); }
 89         if (2147483646L != max[1]) { throw new Exception(&quot;LHS: max[1] is &quot; + max[1]); }
 90         if (2147483645L != max[2]) { throw new Exception(&quot;LHS: max[2] is &quot; + max[2]); }
 91         if (2147483644L != max[3]) { throw new Exception(&quot;LHS: max[3] is &quot; + max[3]); }
 92 
 93         if (-2147483648L != min[0]) { throw new Exception(&quot;LHS: min[0] is &quot; + min[0]); }
 94         if (-2147483647L != min[1]) { throw new Exception(&quot;LHS: min[1] is &quot; + min[1]); }
 95         if (-2147483646L != min[2]) { throw new Exception(&quot;LHS: min[2] is &quot; + min[2]); }
 96         if (-2147483645L != min[3]) { throw new Exception(&quot;LHS: min[3] is &quot; + min[3]); }
 97 
 98         // constants outside of the Integer range
 99         if (2147483648L == out[0])  { throw new Exception(&quot;LHS: out[0] is &quot; + out[0]); }
100         if (-2147483649L == out[1]) { throw new Exception(&quot;LHS: out[1] is &quot; + out[1]); }
101         if (Long.MAX_VALUE == out[2]) { throw new Exception(&quot;LHS: out[2] is &quot; + out[2]); }
102         if (Long.MIN_VALUE == out[3]) { throw new Exception(&quot;LHS: out[3] is &quot; + out[3]); }
103     }
104 
105     public static void main(String[] args) throws Exception {
106         for (int i = 0; i &lt; 100_000; i++) {
107             cmplTest();
108             cmplTest_LHS();
109         }
110     }
111 }
    </pre>
  </body>
</html>