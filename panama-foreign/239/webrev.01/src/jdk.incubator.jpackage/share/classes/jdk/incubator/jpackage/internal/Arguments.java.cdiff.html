<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.incubator.jpackage/share/classes/jdk/incubator/jpackage/internal/Arguments.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AppImageFile.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="BundleParams.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.incubator.jpackage/share/classes/jdk/incubator/jpackage/internal/Arguments.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 22,13 ***</span>
   * or visit www.oracle.com if you need additional information or have any
   * questions.
   */
  package jdk.incubator.jpackage.internal;
  
<span class="line-removed">- import java.io.File;</span>
<span class="line-removed">- import java.io.FileInputStream;</span>
  import java.io.IOException;
  import java.nio.file.Paths;
  import java.text.MessageFormat;
  import java.util.ArrayList;
  import java.util.EnumSet;
  import java.util.HashMap;
<span class="line-new-header">--- 22,14 ---</span>
   * or visit www.oracle.com if you need additional information or have any
   * questions.
   */
  package jdk.incubator.jpackage.internal;
  
  import java.io.IOException;
<span class="line-added">+ import java.io.Reader;</span>
<span class="line-added">+ import java.nio.file.Files;</span>
<span class="line-added">+ import java.nio.file.Path;</span>
  import java.nio.file.Paths;
  import java.text.MessageFormat;
  import java.util.ArrayList;
  import java.util.EnumSet;
  import java.util.HashMap;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 87,11 ***</span>
      private List&lt;String&gt; argList = null;
  
      private List&lt;CLIOptions&gt; allOptions = null;
  
      private String input = null;
<span class="line-modified">!     private String output = null;</span>
  
      private boolean hasMainJar = false;
      private boolean hasMainClass = false;
      private boolean hasMainModule = false;
      public boolean userProvidedBuildRoot = false;
<span class="line-new-header">--- 88,11 ---</span>
      private List&lt;String&gt; argList = null;
  
      private List&lt;CLIOptions&gt; allOptions = null;
  
      private String input = null;
<span class="line-modified">!     private Path output = null;</span>
  
      private boolean hasMainJar = false;
      private boolean hasMainClass = false;
      private boolean hasMainModule = false;
      public boolean userProvidedBuildRoot = false;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 128,12 ***</span>
  
          allOptions = new ArrayList&lt;&gt;();
  
          addLaunchers = new ArrayList&lt;&gt;();
  
<span class="line-modified">!         output = Paths.get(&quot;&quot;).toAbsolutePath().toString();</span>
<span class="line-modified">!         deployParams.setOutput(new File(output));</span>
      }
  
      // CLIOptions is public for DeployParamsTest
      public enum CLIOptions {
          PACKAGE_TYPE(&quot;type&quot;, &quot;t&quot;, OptionCategories.PROPERTY, () -&gt; {
<span class="line-new-header">--- 129,12 ---</span>
  
          allOptions = new ArrayList&lt;&gt;();
  
          addLaunchers = new ArrayList&lt;&gt;();
  
<span class="line-modified">!         output = Paths.get(&quot;&quot;).toAbsolutePath();</span>
<span class="line-modified">!         deployParams.setOutput(output);</span>
      }
  
      // CLIOptions is public for DeployParamsTest
      public enum CLIOptions {
          PACKAGE_TYPE(&quot;type&quot;, &quot;t&quot;, OptionCategories.PROPERTY, () -&gt; {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 144,12 ***</span>
              context().input = popArg();
              setOptionValue(&quot;input&quot;, context().input);
          }),
  
          OUTPUT (&quot;dest&quot;, &quot;d&quot;, OptionCategories.PROPERTY, () -&gt; {
<span class="line-modified">!             context().output = popArg();</span>
<span class="line-modified">!             context().deployParams.setOutput(new File(context().output));</span>
          }),
  
          DESCRIPTION (&quot;description&quot;, OptionCategories.PROPERTY),
  
          VENDOR (&quot;vendor&quot;, OptionCategories.PROPERTY),
<span class="line-new-header">--- 145,12 ---</span>
              context().input = popArg();
              setOptionValue(&quot;input&quot;, context().input);
          }),
  
          OUTPUT (&quot;dest&quot;, &quot;d&quot;, OptionCategories.PROPERTY, () -&gt; {
<span class="line-modified">!             context().output = Path.of(popArg());</span>
<span class="line-modified">!             context().deployParams.setOutput(context().output);</span>
          }),
  
          DESCRIPTION (&quot;description&quot;, OptionCategories.PROPERTY),
  
          VENDOR (&quot;vendor&quot;, OptionCategories.PROPERTY),
</pre>
<hr />
<pre>
<span class="line-old-header">*** 668,11 ***</span>
          }
  
          Map&lt;String, ? super Object&gt; localParams = new HashMap&lt;&gt;(params);
          try {
              bundler.validate(localParams);
<span class="line-modified">!             File result = bundler.execute(localParams, deployParams.outdir);</span>
              if (result == null) {
                  throw new PackagerException(&quot;MSG_BundlerFailed&quot;,
                          bundler.getID(), bundler.getName());
              }
              Log.verbose(MessageFormat.format(
<span class="line-new-header">--- 669,11 ---</span>
          }
  
          Map&lt;String, ? super Object&gt; localParams = new HashMap&lt;&gt;(params);
          try {
              bundler.validate(localParams);
<span class="line-modified">!             Path result = bundler.execute(localParams, deployParams.outdir);</span>
              if (result == null) {
                  throw new PackagerException(&quot;MSG_BundlerFailed&quot;,
                          bundler.getID(), bundler.getName());
              }
              Log.verbose(MessageFormat.format(
</pre>
<hr />
<pre>
<span class="line-old-header">*** 694,11 ***</span>
                      bundler.getName(), re.toString());
          } finally {
              if (userProvidedBuildRoot) {
                  Log.verbose(MessageFormat.format(
                          I18N.getString(&quot;message.debug-working-directory&quot;),
<span class="line-modified">!                         (new File(buildRoot)).getAbsolutePath()));</span>
              } else {
                  // always clean up the temporary directory created
                  // when --temp option not used.
                  bundler.cleanup(localParams);
              }
<span class="line-new-header">--- 695,11 ---</span>
                      bundler.getName(), re.toString());
          } finally {
              if (userProvidedBuildRoot) {
                  Log.verbose(MessageFormat.format(
                          I18N.getString(&quot;message.debug-working-directory&quot;),
<span class="line-modified">!                         (Path.of(buildRoot)).toAbsolutePath().toString()));</span>
              } else {
                  // always clean up the temporary directory created
                  // when --temp option not used.
                  bundler.cleanup(localParams);
              }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 714,14 ***</span>
      }
  
      static Map&lt;String, String&gt; getPropertiesFromFile(String filename) {
          Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
          // load properties file
<span class="line-removed">-         File file = new File(filename);</span>
          Properties properties = new Properties();
<span class="line-modified">!         try (FileInputStream in = new FileInputStream(file)) {</span>
<span class="line-modified">!             properties.load(in);</span>
          } catch (IOException e) {
              Log.error(&quot;Exception: &quot; + e.getMessage());
          }
  
          for (final String name: properties.stringPropertyNames()) {
<span class="line-new-header">--- 715,13 ---</span>
      }
  
      static Map&lt;String, String&gt; getPropertiesFromFile(String filename) {
          Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
          // load properties file
          Properties properties = new Properties();
<span class="line-modified">!         try (Reader reader = Files.newBufferedReader(Path.of(filename))) {</span>
<span class="line-modified">!             properties.load(reader);</span>
          } catch (IOException e) {
              Log.error(&quot;Exception: &quot; + e.getMessage());
          }
  
          for (final String name: properties.stringPropertyNames()) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 806,15 ***</span>
              return null;
          }
  
          JarFile jf;
          try {
<span class="line-modified">!             File file = new File(input, mainJarPath);</span>
<span class="line-modified">!             if (!file.exists()) {</span>
                  return null;
              }
<span class="line-modified">!             jf = new JarFile(file);</span>
              Manifest m = jf.getManifest();
              Attributes attrs = (m != null) ? m.getMainAttributes() : null;
              if (attrs != null) {
                  return attrs.getValue(Attributes.Name.MAIN_CLASS);
              }
<span class="line-new-header">--- 806,15 ---</span>
              return null;
          }
  
          JarFile jf;
          try {
<span class="line-modified">!             Path file = Path.of(input, mainJarPath);</span>
<span class="line-modified">!             if (!Files.exists(file)) {</span>
                  return null;
              }
<span class="line-modified">!             jf = new JarFile(file.toFile());</span>
              Manifest m = jf.getManifest();
              Attributes attrs = (m != null) ? m.getMainAttributes() : null;
              if (attrs != null) {
                  return attrs.getValue(Attributes.Name.MAIN_CLASS);
              }
</pre>
<center><a href="AppImageFile.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="BundleParams.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>