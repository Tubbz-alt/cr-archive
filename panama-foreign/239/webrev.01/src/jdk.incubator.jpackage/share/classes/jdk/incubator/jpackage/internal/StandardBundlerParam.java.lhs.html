<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.incubator.jpackage/share/classes/jdk/incubator/jpackage/internal/StandardBundlerParam.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2014, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.incubator.jpackage.internal;
 27 
 28 import java.io.File;
 29 import java.io.IOException;
 30 import java.nio.file.Files;
 31 import java.nio.file.Path;
 32 import java.text.MessageFormat;
 33 import java.util.ArrayList;
 34 import java.util.Arrays;
 35 import java.util.Collections;
 36 import java.util.Date;
 37 import java.util.LinkedHashSet;
 38 import java.util.List;
 39 import java.util.Map;
 40 import java.util.Set;
 41 import java.util.function.BiFunction;
 42 import java.util.function.Function;
 43 import java.util.stream.Collectors;
 44 import java.util.stream.Stream;
 45 
 46 /**
 47  * StandardBundlerParam
 48  *
 49  * A parameter to a bundler.
 50  *
 51  * Also contains static definitions of all of the common bundler parameters.
 52  * (additional platform specific and mode specific bundler parameters
 53  * are defined in each of the specific bundlers)
 54  *
 55  * Also contains static methods that operate on maps of parameters.
 56  */
 57 class StandardBundlerParam&lt;T&gt; extends BundlerParamInfo&lt;T&gt; {
 58 
 59     private static final String JAVABASEJMOD = &quot;java.base.jmod&quot;;
 60     private final static String DEFAULT_VERSION = &quot;1.0&quot;;
 61     private final static String DEFAULT_RELEASE = &quot;1&quot;;
 62     private final static String[] DEFAULT_JLINK_OPTIONS = {
 63             &quot;--strip-native-commands&quot;,
 64             &quot;--strip-debug&quot;,
 65             &quot;--no-man-pages&quot;,
 66             &quot;--no-header-files&quot;};
 67 
 68     StandardBundlerParam(String id, Class&lt;T&gt; valueType,
 69             Function&lt;Map&lt;String, ? super Object&gt;, T&gt; defaultValueFunction,
 70             BiFunction&lt;String, Map&lt;String, ? super Object&gt;, T&gt; stringConverter)
 71     {
 72         this.id = id;
 73         this.valueType = valueType;
 74         this.defaultValueFunction = defaultValueFunction;
 75         this.stringConverter = stringConverter;
 76     }
 77 
 78     static final StandardBundlerParam&lt;LauncherData&gt; LAUNCHER_DATA =
 79             new StandardBundlerParam&lt;&gt;(
 80                     &quot;launcherData&quot;,
 81                     LauncherData.class,
 82                     params -&gt; {
 83                         try {
 84                             return LauncherData.create(params);
 85                         } catch (ConfigException | IOException ex) {
 86                             throw new RuntimeException(ex);
 87                         }
 88                     },
 89                     null
 90             );
 91 
 92     static final StandardBundlerParam&lt;Path&gt; SOURCE_DIR =
 93             new StandardBundlerParam&lt;&gt;(
 94                     Arguments.CLIOptions.INPUT.getId(),
 95                     Path.class,
 96                     p -&gt; null,
 97                     (s, p) -&gt; Path.of(s)
 98             );
 99 
100     // note that each bundler is likely to replace this one with
101     // their own converter
102     static final StandardBundlerParam&lt;Path&gt; MAIN_JAR =
103             new StandardBundlerParam&lt;&gt;(
104                     Arguments.CLIOptions.MAIN_JAR.getId(),
105                     Path.class,
106                     params -&gt; LAUNCHER_DATA.fetchFrom(params).mainJarName(),
107                     null
108             );
109 
110     static final StandardBundlerParam&lt;String&gt; MAIN_CLASS =
111             new StandardBundlerParam&lt;&gt;(
112                     Arguments.CLIOptions.APPCLASS.getId(),
113                     String.class,
114                     params -&gt; {
115                         if (isRuntimeInstaller(params)) {
116                             return null;
117                         }
118                         return LAUNCHER_DATA.fetchFrom(params).qualifiedClassName();
119                     },
120                     (s, p) -&gt; s
121             );
122 
<a name="1" id="anc1"></a><span class="line-modified">123     static final StandardBundlerParam&lt;File&gt; PREDEFINED_RUNTIME_IMAGE =</span>
124             new StandardBundlerParam&lt;&gt;(
125                     Arguments.CLIOptions.PREDEFINED_RUNTIME_IMAGE.getId(),
<a name="2" id="anc2"></a><span class="line-modified">126                     File.class,</span>
127                     params -&gt; null,
<a name="3" id="anc3"></a><span class="line-modified">128                     (s, p) -&gt; new File(s)</span>
129             );
130 
131     static final StandardBundlerParam&lt;String&gt; APP_NAME =
132             new StandardBundlerParam&lt;&gt;(
133                     Arguments.CLIOptions.NAME.getId(),
134                     String.class,
135                     params -&gt; {
136                         String s = MAIN_CLASS.fetchFrom(params);
137                         if (s != null) {
138                             int idx = s.lastIndexOf(&quot;.&quot;);
139                             if (idx &gt;= 0) {
140                                 return s.substring(idx+1);
141                             }
142                             return s;
143                         } else if (isRuntimeInstaller(params)) {
<a name="4" id="anc4"></a><span class="line-modified">144                             File f = PREDEFINED_RUNTIME_IMAGE.fetchFrom(params);</span>
145                             if (f != null) {
<a name="5" id="anc5"></a><span class="line-modified">146                                 return f.getName();</span>
147                             }
148                         }
149                         return null;
150                     },
151                     (s, p) -&gt; s
152             );
153 
<a name="6" id="anc6"></a><span class="line-modified">154     static final StandardBundlerParam&lt;File&gt; ICON =</span>
155             new StandardBundlerParam&lt;&gt;(
156                     Arguments.CLIOptions.ICON.getId(),
<a name="7" id="anc7"></a><span class="line-modified">157                     File.class,</span>
158                     params -&gt; null,
<a name="8" id="anc8"></a><span class="line-modified">159                     (s, p) -&gt; new File(s)</span>
160             );
161 
162     static final StandardBundlerParam&lt;String&gt; VENDOR =
163             new StandardBundlerParam&lt;&gt;(
164                     Arguments.CLIOptions.VENDOR.getId(),
165                     String.class,
166                     params -&gt; I18N.getString(&quot;param.vendor.default&quot;),
167                     (s, p) -&gt; s
168             );
169 
170     static final StandardBundlerParam&lt;String&gt; DESCRIPTION =
171             new StandardBundlerParam&lt;&gt;(
172                     Arguments.CLIOptions.DESCRIPTION.getId(),
173                     String.class,
174                     params -&gt; params.containsKey(APP_NAME.getID())
175                             ? APP_NAME.fetchFrom(params)
176                             : I18N.getString(&quot;param.description.default&quot;),
177                     (s, p) -&gt; s
178             );
179 
180     static final StandardBundlerParam&lt;String&gt; COPYRIGHT =
181             new StandardBundlerParam&lt;&gt;(
182                     Arguments.CLIOptions.COPYRIGHT.getId(),
183                     String.class,
184                     params -&gt; MessageFormat.format(I18N.getString(
185                             &quot;param.copyright.default&quot;), new Date()),
186                     (s, p) -&gt; s
187             );
188 
189     @SuppressWarnings(&quot;unchecked&quot;)
190     static final StandardBundlerParam&lt;List&lt;String&gt;&gt; ARGUMENTS =
191             new StandardBundlerParam&lt;&gt;(
192                     Arguments.CLIOptions.ARGUMENTS.getId(),
193                     (Class&lt;List&lt;String&gt;&gt;) (Object) List.class,
194                     params -&gt; Collections.emptyList(),
195                     (s, p) -&gt; null
196             );
197 
198     @SuppressWarnings(&quot;unchecked&quot;)
199     static final StandardBundlerParam&lt;List&lt;String&gt;&gt; JAVA_OPTIONS =
200             new StandardBundlerParam&lt;&gt;(
201                     Arguments.CLIOptions.JAVA_OPTIONS.getId(),
202                     (Class&lt;List&lt;String&gt;&gt;) (Object) List.class,
203                     params -&gt; Collections.emptyList(),
204                     (s, p) -&gt; Arrays.asList(s.split(&quot;\n\n&quot;))
205             );
206 
207     static final StandardBundlerParam&lt;String&gt; VERSION =
208             new StandardBundlerParam&lt;&gt;(
209                     Arguments.CLIOptions.VERSION.getId(),
210                     String.class,
211                     StandardBundlerParam::getDefaultAppVersion,
212                     (s, p) -&gt; s
213             );
214 
215     static final StandardBundlerParam&lt;String&gt; RELEASE =
216             new StandardBundlerParam&lt;&gt;(
217                     Arguments.CLIOptions.RELEASE.getId(),
218                     String.class,
219                     params -&gt; DEFAULT_RELEASE,
220                     (s, p) -&gt; s
221             );
222 
223     @SuppressWarnings(&quot;unchecked&quot;)
224     public static final StandardBundlerParam&lt;String&gt; LICENSE_FILE =
225             new StandardBundlerParam&lt;&gt;(
226                     Arguments.CLIOptions.LICENSE_FILE.getId(),
227                     String.class,
228                     params -&gt; null,
229                     (s, p) -&gt; s
230             );
231 
<a name="9" id="anc9"></a><span class="line-modified">232     static final StandardBundlerParam&lt;File&gt; TEMP_ROOT =</span>
233             new StandardBundlerParam&lt;&gt;(
234                     Arguments.CLIOptions.TEMP_ROOT.getId(),
<a name="10" id="anc10"></a><span class="line-modified">235                     File.class,</span>
236                     params -&gt; {
237                         try {
<a name="11" id="anc11"></a><span class="line-modified">238                             return Files.createTempDirectory(</span>
<span class="line-removed">239                                     &quot;jdk.incubator.jpackage&quot;).toFile();</span>
240                         } catch (IOException ioe) {
241                             return null;
242                         }
243                     },
<a name="12" id="anc12"></a><span class="line-modified">244                     (s, p) -&gt; new File(s)</span>
245             );
246 
<a name="13" id="anc13"></a><span class="line-modified">247     public static final StandardBundlerParam&lt;File&gt; CONFIG_ROOT =</span>
248             new StandardBundlerParam&lt;&gt;(
249                 &quot;configRoot&quot;,
<a name="14" id="anc14"></a><span class="line-modified">250                 File.class,</span>
251                 params -&gt; {
<a name="15" id="anc15"></a><span class="line-modified">252                     File root =</span>
<span class="line-modified">253                             new File(TEMP_ROOT.fetchFrom(params), &quot;config&quot;);</span>
<span class="line-modified">254                     root.mkdirs();</span>



255                     return root;
256                 },
257                 (s, p) -&gt; null
258             );
259 
260     static final StandardBundlerParam&lt;Boolean&gt; BIND_SERVICES =
261             new StandardBundlerParam&lt;&gt;(
262                     Arguments.CLIOptions.BIND_SERVICES.getId(),
263                     Boolean.class,
264                     params -&gt; false,
265                     (s, p) -&gt; (s == null || &quot;null&quot;.equalsIgnoreCase(s)) ?
266                             true : Boolean.valueOf(s)
267             );
268 
269 
270     static final StandardBundlerParam&lt;Boolean&gt; VERBOSE  =
271             new StandardBundlerParam&lt;&gt;(
272                     Arguments.CLIOptions.VERBOSE.getId(),
273                     Boolean.class,
274                     params -&gt; false,
275                     // valueOf(null) is false, and we actually do want null
276                     (s, p) -&gt; (s == null || &quot;null&quot;.equalsIgnoreCase(s)) ?
277                             true : Boolean.valueOf(s)
278             );
279 
<a name="16" id="anc16"></a><span class="line-modified">280     static final StandardBundlerParam&lt;File&gt; RESOURCE_DIR =</span>
281             new StandardBundlerParam&lt;&gt;(
282                     Arguments.CLIOptions.RESOURCE_DIR.getId(),
<a name="17" id="anc17"></a><span class="line-modified">283                     File.class,</span>
284                     params -&gt; null,
<a name="18" id="anc18"></a><span class="line-modified">285                     (s, p) -&gt; new File(s)</span>
286             );
287 
288     static final BundlerParamInfo&lt;String&gt; INSTALL_DIR =
289             new StandardBundlerParam&lt;&gt;(
290                     Arguments.CLIOptions.INSTALL_DIR.getId(),
291                     String.class,
292                      params -&gt; null,
293                     (s, p) -&gt; s
294     );
295 
<a name="19" id="anc19"></a><span class="line-modified">296     static final StandardBundlerParam&lt;File&gt; PREDEFINED_APP_IMAGE =</span>
297             new StandardBundlerParam&lt;&gt;(
298             Arguments.CLIOptions.PREDEFINED_APP_IMAGE.getId(),
<a name="20" id="anc20"></a><span class="line-modified">299             File.class,</span>
300             params -&gt; null,
<a name="21" id="anc21"></a><span class="line-modified">301             (s, p) -&gt; new File(s));</span>
302 
303     @SuppressWarnings(&quot;unchecked&quot;)
304     static final StandardBundlerParam&lt;List&lt;Map&lt;String, ? super Object&gt;&gt;&gt; ADD_LAUNCHERS =
305             new StandardBundlerParam&lt;&gt;(
306                     Arguments.CLIOptions.ADD_LAUNCHER.getId(),
307                     (Class&lt;List&lt;Map&lt;String, ? super Object&gt;&gt;&gt;) (Object)
308                             List.class,
309                     params -&gt; new ArrayList&lt;&gt;(1),
310                     // valueOf(null) is false, and we actually do want null
311                     (s, p) -&gt; null
312             );
313 
314     @SuppressWarnings(&quot;unchecked&quot;)
315     static final StandardBundlerParam
316             &lt;List&lt;Map&lt;String, ? super Object&gt;&gt;&gt; FILE_ASSOCIATIONS =
317             new StandardBundlerParam&lt;&gt;(
318                     Arguments.CLIOptions.FILE_ASSOCIATIONS.getId(),
319                     (Class&lt;List&lt;Map&lt;String, ? super Object&gt;&gt;&gt;) (Object)
320                             List.class,
321                     params -&gt; new ArrayList&lt;&gt;(1),
322                     // valueOf(null) is false, and we actually do want null
323                     (s, p) -&gt; null
324             );
325 
326     @SuppressWarnings(&quot;unchecked&quot;)
327     static final StandardBundlerParam&lt;List&lt;String&gt;&gt; FA_EXTENSIONS =
328             new StandardBundlerParam&lt;&gt;(
329                     &quot;fileAssociation.extension&quot;,
330                     (Class&lt;List&lt;String&gt;&gt;) (Object) List.class,
331                     params -&gt; null, // null means not matched to an extension
332                     (s, p) -&gt; Arrays.asList(s.split(&quot;(,|\\s)+&quot;))
333             );
334 
335     @SuppressWarnings(&quot;unchecked&quot;)
336     static final StandardBundlerParam&lt;List&lt;String&gt;&gt; FA_CONTENT_TYPE =
337             new StandardBundlerParam&lt;&gt;(
338                     &quot;fileAssociation.contentType&quot;,
339                     (Class&lt;List&lt;String&gt;&gt;) (Object) List.class,
340                     params -&gt; null,
341                             // null means not matched to a content/mime type
342                     (s, p) -&gt; Arrays.asList(s.split(&quot;(,|\\s)+&quot;))
343             );
344 
345     static final StandardBundlerParam&lt;String&gt; FA_DESCRIPTION =
346             new StandardBundlerParam&lt;&gt;(
347                     &quot;fileAssociation.description&quot;,
348                     String.class,
<a name="22" id="anc22"></a><span class="line-modified">349                     params -&gt; APP_NAME.fetchFrom(params) + &quot; File&quot;,</span>
350                     null
351             );
352 
<a name="23" id="anc23"></a><span class="line-modified">353     static final StandardBundlerParam&lt;File&gt; FA_ICON =</span>
354             new StandardBundlerParam&lt;&gt;(
355                     &quot;fileAssociation.icon&quot;,
<a name="24" id="anc24"></a><span class="line-modified">356                     File.class,</span>
357                     ICON::fetchFrom,
<a name="25" id="anc25"></a><span class="line-modified">358                     (s, p) -&gt; new File(s)</span>
359             );
360 
361     @SuppressWarnings(&quot;unchecked&quot;)
362     static final BundlerParamInfo&lt;List&lt;Path&gt;&gt; MODULE_PATH =
363             new StandardBundlerParam&lt;&gt;(
364                     Arguments.CLIOptions.MODULE_PATH.getId(),
365                     (Class&lt;List&lt;Path&gt;&gt;) (Object)List.class,
366                     p -&gt; getDefaultModulePath(),
367                     (s, p) -&gt; {
368                         List&lt;Path&gt; modulePath = Stream.of(s.split(File.pathSeparator))
369                                 .map(Path::of)
370                                 .collect(Collectors.toList());
371                         Path javaBasePath = findPathOfModule(modulePath, JAVABASEJMOD);
372 
373                         // Add the default JDK module path to the module path.
374                         if (javaBasePath == null) {
375                             List&lt;Path&gt; jdkModulePath = getDefaultModulePath();
376 
377                             if (jdkModulePath != null) {
378                                 modulePath.addAll(jdkModulePath);
379                                 javaBasePath = findPathOfModule(modulePath, JAVABASEJMOD);
380                             }
381                         }
382 
383                         if (javaBasePath == null ||
384                                 !Files.exists(javaBasePath)) {
385                             Log.error(String.format(I18N.getString(
386                                     &quot;warning.no.jdk.modules.found&quot;)));
387                         }
388 
389                         return modulePath;
390                     });
391 
392     // Returns the path to the JDK modules in the user defined module path.
393     private static Path findPathOfModule( List&lt;Path&gt; modulePath, String moduleName) {
394 
395         for (Path path : modulePath) {
396             Path moduleNamePath = path.resolve(moduleName);
397 
398             if (Files.exists(moduleNamePath)) {
399                 return path;
400             }
401         }
402 
403         return null;
404     }
405 
406     static final BundlerParamInfo&lt;String&gt; MODULE =
407             new StandardBundlerParam&lt;&gt;(
408                     Arguments.CLIOptions.MODULE.getId(),
409                     String.class,
410                     p -&gt; null,
411                     (s, p) -&gt; {
412                         return String.valueOf(s);
413                     });
414 
415     @SuppressWarnings(&quot;unchecked&quot;)
416     static final BundlerParamInfo&lt;Set&lt;String&gt;&gt; ADD_MODULES =
417             new StandardBundlerParam&lt;&gt;(
418                     Arguments.CLIOptions.ADD_MODULES.getId(),
419                     (Class&lt;Set&lt;String&gt;&gt;) (Object) Set.class,
420                     p -&gt; new LinkedHashSet&lt;String&gt;(),
421                     (s, p) -&gt; new LinkedHashSet&lt;&gt;(Arrays.asList(s.split(&quot;,&quot;)))
422             );
423 
424     @SuppressWarnings(&quot;unchecked&quot;)
425     static final StandardBundlerParam&lt;List&lt;String&gt;&gt; JLINK_OPTIONS =
426             new StandardBundlerParam&lt;&gt;(
427                     Arguments.CLIOptions.JLINK_OPTIONS.getId(),
428                     (Class&lt;List&lt;String&gt;&gt;) (Object) List.class,
429                     p -&gt; Arrays.asList(DEFAULT_JLINK_OPTIONS),
430                     (s, p) -&gt; null);
431 
432     @SuppressWarnings(&quot;unchecked&quot;)
433     static final BundlerParamInfo&lt;Set&lt;String&gt;&gt; LIMIT_MODULES =
434             new StandardBundlerParam&lt;&gt;(
435                     &quot;limit-modules&quot;,
436                     (Class&lt;Set&lt;String&gt;&gt;) (Object) Set.class,
437                     p -&gt; new LinkedHashSet&lt;String&gt;(),
438                     (s, p) -&gt; new LinkedHashSet&lt;&gt;(Arrays.asList(s.split(&quot;,&quot;)))
439             );
440 
441     static boolean isRuntimeInstaller(Map&lt;String, ? super Object&gt; params) {
442         if (params.containsKey(MODULE.getID()) ||
443                 params.containsKey(MAIN_JAR.getID()) ||
444                 params.containsKey(PREDEFINED_APP_IMAGE.getID())) {
445             return false; // we are building or are given an application
446         }
447         // runtime installer requires --runtime-image, if this is false
448         // here then we should have thrown error validating args.
449         return params.containsKey(PREDEFINED_RUNTIME_IMAGE.getID());
450     }
451 
<a name="26" id="anc26"></a><span class="line-modified">452     static File getPredefinedAppImage(Map&lt;String, ? super Object&gt; params) {</span>
<span class="line-modified">453         File applicationImage = PREDEFINED_APP_IMAGE.fetchFrom(params);</span>
<span class="line-modified">454         if (applicationImage != null &amp;&amp; !applicationImage.exists()) {</span>
455             throw new RuntimeException(
456                     MessageFormat.format(I18N.getString(
457                             &quot;message.app-image-dir-does-not-exist&quot;),
458                             PREDEFINED_APP_IMAGE.getID(),
459                             applicationImage.toString()));
460         }
461         return applicationImage;
462     }
463 
464     static void copyPredefinedRuntimeImage(Map&lt;String, ? super Object&gt; params,
465             ApplicationLayout appLayout) throws IOException, ConfigException {
<a name="27" id="anc27"></a><span class="line-modified">466         File topImage = PREDEFINED_RUNTIME_IMAGE.fetchFrom(params);</span>
<span class="line-modified">467         if (!topImage.exists()) {</span>
468             throw new ConfigException(
469                     MessageFormat.format(I18N.getString(
470                     &quot;message.runtime-image-dir-does-not-exist&quot;),
471                     PREDEFINED_RUNTIME_IMAGE.getID(),
472                     topImage.toString()),
473                     MessageFormat.format(I18N.getString(
474                     &quot;message.runtime-image-dir-does-not-exist.advice&quot;),
475                     PREDEFINED_RUNTIME_IMAGE.getID()));
476         }
477 
478         if (Platform.isMac()) {
479             // On Mac topImage can be runtime root or runtime home.
<a name="28" id="anc28"></a><span class="line-modified">480             Path runtimeHome = topImage.toPath().resolve(&quot;Contents/Home&quot;);</span>
481             if (Files.isDirectory(runtimeHome)) {
482                 // topImage references runtime root, adjust it to pick data from
483                 // runtime home
<a name="29" id="anc29"></a><span class="line-modified">484                 topImage = runtimeHome.toFile();</span>
485             }
486         }
487 
488         // copy whole runtime, need to skip jmods and src.zip
489         final List&lt;String&gt; excludes = Arrays.asList(&quot;jmods&quot;, &quot;src.zip&quot;);
<a name="30" id="anc30"></a><span class="line-modified">490         IOUtils.copyRecursive(topImage.toPath(),</span>
491                 appLayout.runtimeHomeDirectory(), excludes);
492 
493         // if module-path given - copy modules to appDir/mods
494         List&lt;Path&gt; modulePath = MODULE_PATH.fetchFrom(params);
495         List&lt;Path&gt; defaultModulePath = getDefaultModulePath();
496         Path dest = appLayout.appModsDirectory();
497 
498         if (dest != null) {
499             for (Path mp : modulePath) {
500                 if (!defaultModulePath.contains(mp)) {
501                     Files.createDirectories(dest);
502                     IOUtils.copyRecursive(mp, dest);
503                 }
504             }
505         }
506     }
507 
508     private static List&lt;Path&gt; getDefaultModulePath() {
509         return List.of(
510                 Path.of(System.getProperty(&quot;java.home&quot;), &quot;jmods&quot;).toAbsolutePath());
511     }
512 
513     private static String getDefaultAppVersion(Map&lt;String, ? super Object&gt; params) {
514         String appVersion = DEFAULT_VERSION;
515 
516         if (isRuntimeInstaller(params)) {
517             return appVersion;
518         }
519 
520         LauncherData launcherData = null;
521         try {
522             launcherData = LAUNCHER_DATA.fetchFrom(params);
523         } catch (RuntimeException ex) {
524             if (ex.getCause() instanceof ConfigException) {
525                 return appVersion;
526             }
527             throw ex;
528         }
529 
530         if (launcherData.isModular()) {
531             String moduleVersion = launcherData.getAppVersion();
532             if (moduleVersion != null) {
533                 Log.verbose(MessageFormat.format(I18N.getString(
534                         &quot;message.module-version&quot;),
535                         moduleVersion,
536                         launcherData.moduleName()));
537                 appVersion = moduleVersion;
538             }
539         }
540 
541         return appVersion;
542     }
543 }
<a name="31" id="anc31"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="31" type="hidden" />
</body>
</html>