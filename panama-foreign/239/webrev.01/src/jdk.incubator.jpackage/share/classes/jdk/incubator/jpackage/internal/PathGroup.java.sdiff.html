<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.incubator.jpackage/share/classes/jdk/incubator/jpackage/internal/PathGroup.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="LauncherData.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ScriptRunner.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.incubator.jpackage/share/classes/jdk/incubator/jpackage/internal/PathGroup.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 package jdk.incubator.jpackage.internal;
 26 
<span class="line-removed"> 27 import java.io.File;</span>
 28 import java.io.IOException;
 29 import java.nio.file.Files;
 30 import java.nio.file.Path;
 31 import java.util.ArrayList;
 32 import java.util.Collection;
 33 import java.util.HashMap;
 34 import java.util.List;
 35 import java.util.Map;
 36 import java.util.function.BiFunction;
 37 import java.util.stream.Collectors;
 38 import java.util.stream.Stream;
 39 
 40 
 41 /**
 42  * Group of paths.
 43  * Each path in the group is assigned a unique id.
 44  */
 45 final class PathGroup {
 46     PathGroup(Map&lt;Object, Path&gt; paths) {
 47         entries = new HashMap&lt;&gt;(paths);
</pre>
<hr />
<pre>
183                     Files.createDirectories(dst.getParent());
184                     if (move) {
185                         Files.move(src, dst);
186                     } else {
187                         Files.copy(src, dst);
188                     }
189                 }
190 
191                 @Override
192                 public void createDirectory(Path dir) throws IOException {
193                     Files.createDirectories(dir);
194                 }
195             };
196         }
197 
198         // destination -&gt; source file mapping
199         Map&lt;Path, Path&gt; actions = new HashMap&lt;&gt;();
200         for (var action: entries) {
201             Path src = action.getKey();
202             Path dst = action.getValue();
<span class="line-modified">203             if (src.toFile().isDirectory()) {</span>
204                try (Stream&lt;Path&gt; stream = Files.walk(src)) {
205                    stream.sequential().forEach(path -&gt; actions.put(dst.resolve(
206                             src.relativize(path)).normalize(), path));
207                }
208             } else {
209                 actions.put(dst.normalize(), src);
210             }
211         }
212 
213         for (var action : actions.entrySet()) {
214             Path dst = action.getKey();
215             Path src = action.getValue();
216 
217             if (excludePaths.stream().anyMatch(src::startsWith)) {
218                 continue;
219             }
220 
221             if (src.equals(dst) || !src.toFile().exists()) {
222                 continue;
223             }
224 
<span class="line-modified">225             if (src.toFile().isDirectory()) {</span>
226                 handler.createDirectory(dst);
227             } else {
228                 handler.copyFile(src, dst);
229             }
230         }
231 
232         if (move) {
233             // Delete source dirs.
234             for (var entry: entries) {
<span class="line-modified">235                 File srcFile = entry.getKey().toFile();</span>
<span class="line-modified">236                 if (srcFile.isDirectory()) {</span>
237                     IOUtils.deleteRecursive(srcFile);
238                 }
239             }
240         }
241     }
242 
243     private static Map.Entry&lt;Path, Path&gt; normalizedPath(Path v) {
244         final Path normalized;
245         if (!v.isAbsolute()) {
246             normalized = Path.of(&quot;./&quot;).resolve(v.normalize());
247         } else {
248             normalized = v.normalize();
249         }
250 
251         return Map.entry(normalized, v);
252     }
253 
254     private List&lt;Map.Entry&lt;Path, Path&gt;&gt; normalizedPaths() {
255         return entries.values().stream().map(PathGroup::normalizedPath).collect(
256                 Collectors.toList());
</pre>
</td>
<td>
<hr />
<pre>
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 package jdk.incubator.jpackage.internal;
 26 

 27 import java.io.IOException;
 28 import java.nio.file.Files;
 29 import java.nio.file.Path;
 30 import java.util.ArrayList;
 31 import java.util.Collection;
 32 import java.util.HashMap;
 33 import java.util.List;
 34 import java.util.Map;
 35 import java.util.function.BiFunction;
 36 import java.util.stream.Collectors;
 37 import java.util.stream.Stream;
 38 
 39 
 40 /**
 41  * Group of paths.
 42  * Each path in the group is assigned a unique id.
 43  */
 44 final class PathGroup {
 45     PathGroup(Map&lt;Object, Path&gt; paths) {
 46         entries = new HashMap&lt;&gt;(paths);
</pre>
<hr />
<pre>
182                     Files.createDirectories(dst.getParent());
183                     if (move) {
184                         Files.move(src, dst);
185                     } else {
186                         Files.copy(src, dst);
187                     }
188                 }
189 
190                 @Override
191                 public void createDirectory(Path dir) throws IOException {
192                     Files.createDirectories(dir);
193                 }
194             };
195         }
196 
197         // destination -&gt; source file mapping
198         Map&lt;Path, Path&gt; actions = new HashMap&lt;&gt;();
199         for (var action: entries) {
200             Path src = action.getKey();
201             Path dst = action.getValue();
<span class="line-modified">202             if (Files.isDirectory(src)) {</span>
203                try (Stream&lt;Path&gt; stream = Files.walk(src)) {
204                    stream.sequential().forEach(path -&gt; actions.put(dst.resolve(
205                             src.relativize(path)).normalize(), path));
206                }
207             } else {
208                 actions.put(dst.normalize(), src);
209             }
210         }
211 
212         for (var action : actions.entrySet()) {
213             Path dst = action.getKey();
214             Path src = action.getValue();
215 
216             if (excludePaths.stream().anyMatch(src::startsWith)) {
217                 continue;
218             }
219 
220             if (src.equals(dst) || !src.toFile().exists()) {
221                 continue;
222             }
223 
<span class="line-modified">224             if (Files.isDirectory(src)) {</span>
225                 handler.createDirectory(dst);
226             } else {
227                 handler.copyFile(src, dst);
228             }
229         }
230 
231         if (move) {
232             // Delete source dirs.
233             for (var entry: entries) {
<span class="line-modified">234                 Path srcFile = entry.getKey();</span>
<span class="line-modified">235                 if (Files.isDirectory(srcFile)) {</span>
236                     IOUtils.deleteRecursive(srcFile);
237                 }
238             }
239         }
240     }
241 
242     private static Map.Entry&lt;Path, Path&gt; normalizedPath(Path v) {
243         final Path normalized;
244         if (!v.isAbsolute()) {
245             normalized = Path.of(&quot;./&quot;).resolve(v.normalize());
246         } else {
247             normalized = v.normalize();
248         }
249 
250         return Map.entry(normalized, v);
251     }
252 
253     private List&lt;Map.Entry&lt;Path, Path&gt;&gt; normalizedPaths() {
254         return entries.values().stream().map(PathGroup::normalizedPath).collect(
255                 Collectors.toList());
</pre>
</td>
</tr>
</table>
<center><a href="LauncherData.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ScriptRunner.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>