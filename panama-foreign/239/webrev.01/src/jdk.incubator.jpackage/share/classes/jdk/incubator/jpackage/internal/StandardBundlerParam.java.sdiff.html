<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.incubator.jpackage/share/classes/jdk/incubator/jpackage/internal/StandardBundlerParam.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ScriptRunner.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="resources/HelpResources_ja.properties.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.incubator.jpackage/share/classes/jdk/incubator/jpackage/internal/StandardBundlerParam.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
103             new StandardBundlerParam&lt;&gt;(
104                     Arguments.CLIOptions.MAIN_JAR.getId(),
105                     Path.class,
106                     params -&gt; LAUNCHER_DATA.fetchFrom(params).mainJarName(),
107                     null
108             );
109 
110     static final StandardBundlerParam&lt;String&gt; MAIN_CLASS =
111             new StandardBundlerParam&lt;&gt;(
112                     Arguments.CLIOptions.APPCLASS.getId(),
113                     String.class,
114                     params -&gt; {
115                         if (isRuntimeInstaller(params)) {
116                             return null;
117                         }
118                         return LAUNCHER_DATA.fetchFrom(params).qualifiedClassName();
119                     },
120                     (s, p) -&gt; s
121             );
122 
<span class="line-modified">123     static final StandardBundlerParam&lt;File&gt; PREDEFINED_RUNTIME_IMAGE =</span>
124             new StandardBundlerParam&lt;&gt;(
125                     Arguments.CLIOptions.PREDEFINED_RUNTIME_IMAGE.getId(),
<span class="line-modified">126                     File.class,</span>
127                     params -&gt; null,
<span class="line-modified">128                     (s, p) -&gt; new File(s)</span>
129             );
130 
131     static final StandardBundlerParam&lt;String&gt; APP_NAME =
132             new StandardBundlerParam&lt;&gt;(
133                     Arguments.CLIOptions.NAME.getId(),
134                     String.class,
135                     params -&gt; {
136                         String s = MAIN_CLASS.fetchFrom(params);
137                         if (s != null) {
138                             int idx = s.lastIndexOf(&quot;.&quot;);
139                             if (idx &gt;= 0) {
140                                 return s.substring(idx+1);
141                             }
142                             return s;
143                         } else if (isRuntimeInstaller(params)) {
<span class="line-modified">144                             File f = PREDEFINED_RUNTIME_IMAGE.fetchFrom(params);</span>
145                             if (f != null) {
<span class="line-modified">146                                 return f.getName();</span>
147                             }
148                         }
149                         return null;
150                     },
151                     (s, p) -&gt; s
152             );
153 
<span class="line-modified">154     static final StandardBundlerParam&lt;File&gt; ICON =</span>
155             new StandardBundlerParam&lt;&gt;(
156                     Arguments.CLIOptions.ICON.getId(),
<span class="line-modified">157                     File.class,</span>
158                     params -&gt; null,
<span class="line-modified">159                     (s, p) -&gt; new File(s)</span>
160             );
161 
162     static final StandardBundlerParam&lt;String&gt; VENDOR =
163             new StandardBundlerParam&lt;&gt;(
164                     Arguments.CLIOptions.VENDOR.getId(),
165                     String.class,
166                     params -&gt; I18N.getString(&quot;param.vendor.default&quot;),
167                     (s, p) -&gt; s
168             );
169 
170     static final StandardBundlerParam&lt;String&gt; DESCRIPTION =
171             new StandardBundlerParam&lt;&gt;(
172                     Arguments.CLIOptions.DESCRIPTION.getId(),
173                     String.class,
174                     params -&gt; params.containsKey(APP_NAME.getID())
175                             ? APP_NAME.fetchFrom(params)
176                             : I18N.getString(&quot;param.description.default&quot;),
177                     (s, p) -&gt; s
178             );
179 
</pre>
<hr />
<pre>
212                     (s, p) -&gt; s
213             );
214 
215     static final StandardBundlerParam&lt;String&gt; RELEASE =
216             new StandardBundlerParam&lt;&gt;(
217                     Arguments.CLIOptions.RELEASE.getId(),
218                     String.class,
219                     params -&gt; DEFAULT_RELEASE,
220                     (s, p) -&gt; s
221             );
222 
223     @SuppressWarnings(&quot;unchecked&quot;)
224     public static final StandardBundlerParam&lt;String&gt; LICENSE_FILE =
225             new StandardBundlerParam&lt;&gt;(
226                     Arguments.CLIOptions.LICENSE_FILE.getId(),
227                     String.class,
228                     params -&gt; null,
229                     (s, p) -&gt; s
230             );
231 
<span class="line-modified">232     static final StandardBundlerParam&lt;File&gt; TEMP_ROOT =</span>
233             new StandardBundlerParam&lt;&gt;(
234                     Arguments.CLIOptions.TEMP_ROOT.getId(),
<span class="line-modified">235                     File.class,</span>
236                     params -&gt; {
237                         try {
<span class="line-modified">238                             return Files.createTempDirectory(</span>
<span class="line-removed">239                                     &quot;jdk.incubator.jpackage&quot;).toFile();</span>
240                         } catch (IOException ioe) {
241                             return null;
242                         }
243                     },
<span class="line-modified">244                     (s, p) -&gt; new File(s)</span>
245             );
246 
<span class="line-modified">247     public static final StandardBundlerParam&lt;File&gt; CONFIG_ROOT =</span>
248             new StandardBundlerParam&lt;&gt;(
249                 &quot;configRoot&quot;,
<span class="line-modified">250                 File.class,</span>
251                 params -&gt; {
<span class="line-modified">252                     File root =</span>
<span class="line-modified">253                             new File(TEMP_ROOT.fetchFrom(params), &quot;config&quot;);</span>
<span class="line-modified">254                     root.mkdirs();</span>



255                     return root;
256                 },
257                 (s, p) -&gt; null
258             );
259 
260     static final StandardBundlerParam&lt;Boolean&gt; BIND_SERVICES =
261             new StandardBundlerParam&lt;&gt;(
262                     Arguments.CLIOptions.BIND_SERVICES.getId(),
263                     Boolean.class,
264                     params -&gt; false,
265                     (s, p) -&gt; (s == null || &quot;null&quot;.equalsIgnoreCase(s)) ?
266                             true : Boolean.valueOf(s)
267             );
268 
269 
270     static final StandardBundlerParam&lt;Boolean&gt; VERBOSE  =
271             new StandardBundlerParam&lt;&gt;(
272                     Arguments.CLIOptions.VERBOSE.getId(),
273                     Boolean.class,
274                     params -&gt; false,
275                     // valueOf(null) is false, and we actually do want null
276                     (s, p) -&gt; (s == null || &quot;null&quot;.equalsIgnoreCase(s)) ?
277                             true : Boolean.valueOf(s)
278             );
279 
<span class="line-modified">280     static final StandardBundlerParam&lt;File&gt; RESOURCE_DIR =</span>
281             new StandardBundlerParam&lt;&gt;(
282                     Arguments.CLIOptions.RESOURCE_DIR.getId(),
<span class="line-modified">283                     File.class,</span>
284                     params -&gt; null,
<span class="line-modified">285                     (s, p) -&gt; new File(s)</span>
286             );
287 
288     static final BundlerParamInfo&lt;String&gt; INSTALL_DIR =
289             new StandardBundlerParam&lt;&gt;(
290                     Arguments.CLIOptions.INSTALL_DIR.getId(),
291                     String.class,
292                      params -&gt; null,
293                     (s, p) -&gt; s
294     );
295 
<span class="line-modified">296     static final StandardBundlerParam&lt;File&gt; PREDEFINED_APP_IMAGE =</span>
297             new StandardBundlerParam&lt;&gt;(
298             Arguments.CLIOptions.PREDEFINED_APP_IMAGE.getId(),
<span class="line-modified">299             File.class,</span>
300             params -&gt; null,
<span class="line-modified">301             (s, p) -&gt; new File(s));</span>
302 
303     @SuppressWarnings(&quot;unchecked&quot;)
304     static final StandardBundlerParam&lt;List&lt;Map&lt;String, ? super Object&gt;&gt;&gt; ADD_LAUNCHERS =
305             new StandardBundlerParam&lt;&gt;(
306                     Arguments.CLIOptions.ADD_LAUNCHER.getId(),
307                     (Class&lt;List&lt;Map&lt;String, ? super Object&gt;&gt;&gt;) (Object)
308                             List.class,
309                     params -&gt; new ArrayList&lt;&gt;(1),
310                     // valueOf(null) is false, and we actually do want null
311                     (s, p) -&gt; null
312             );
313 
314     @SuppressWarnings(&quot;unchecked&quot;)
315     static final StandardBundlerParam
316             &lt;List&lt;Map&lt;String, ? super Object&gt;&gt;&gt; FILE_ASSOCIATIONS =
317             new StandardBundlerParam&lt;&gt;(
318                     Arguments.CLIOptions.FILE_ASSOCIATIONS.getId(),
319                     (Class&lt;List&lt;Map&lt;String, ? super Object&gt;&gt;&gt;) (Object)
320                             List.class,
321                     params -&gt; new ArrayList&lt;&gt;(1),
</pre>
<hr />
<pre>
329                     &quot;fileAssociation.extension&quot;,
330                     (Class&lt;List&lt;String&gt;&gt;) (Object) List.class,
331                     params -&gt; null, // null means not matched to an extension
332                     (s, p) -&gt; Arrays.asList(s.split(&quot;(,|\\s)+&quot;))
333             );
334 
335     @SuppressWarnings(&quot;unchecked&quot;)
336     static final StandardBundlerParam&lt;List&lt;String&gt;&gt; FA_CONTENT_TYPE =
337             new StandardBundlerParam&lt;&gt;(
338                     &quot;fileAssociation.contentType&quot;,
339                     (Class&lt;List&lt;String&gt;&gt;) (Object) List.class,
340                     params -&gt; null,
341                             // null means not matched to a content/mime type
342                     (s, p) -&gt; Arrays.asList(s.split(&quot;(,|\\s)+&quot;))
343             );
344 
345     static final StandardBundlerParam&lt;String&gt; FA_DESCRIPTION =
346             new StandardBundlerParam&lt;&gt;(
347                     &quot;fileAssociation.description&quot;,
348                     String.class,
<span class="line-modified">349                     params -&gt; APP_NAME.fetchFrom(params) + &quot; File&quot;,</span>
350                     null
351             );
352 
<span class="line-modified">353     static final StandardBundlerParam&lt;File&gt; FA_ICON =</span>
354             new StandardBundlerParam&lt;&gt;(
355                     &quot;fileAssociation.icon&quot;,
<span class="line-modified">356                     File.class,</span>
357                     ICON::fetchFrom,
<span class="line-modified">358                     (s, p) -&gt; new File(s)</span>
359             );
360 
361     @SuppressWarnings(&quot;unchecked&quot;)
362     static final BundlerParamInfo&lt;List&lt;Path&gt;&gt; MODULE_PATH =
363             new StandardBundlerParam&lt;&gt;(
364                     Arguments.CLIOptions.MODULE_PATH.getId(),
365                     (Class&lt;List&lt;Path&gt;&gt;) (Object)List.class,
366                     p -&gt; getDefaultModulePath(),
367                     (s, p) -&gt; {
368                         List&lt;Path&gt; modulePath = Stream.of(s.split(File.pathSeparator))
369                                 .map(Path::of)
370                                 .collect(Collectors.toList());
371                         Path javaBasePath = findPathOfModule(modulePath, JAVABASEJMOD);
372 
373                         // Add the default JDK module path to the module path.
374                         if (javaBasePath == null) {
375                             List&lt;Path&gt; jdkModulePath = getDefaultModulePath();
376 
377                             if (jdkModulePath != null) {
378                                 modulePath.addAll(jdkModulePath);
</pre>
<hr />
<pre>
432     @SuppressWarnings(&quot;unchecked&quot;)
433     static final BundlerParamInfo&lt;Set&lt;String&gt;&gt; LIMIT_MODULES =
434             new StandardBundlerParam&lt;&gt;(
435                     &quot;limit-modules&quot;,
436                     (Class&lt;Set&lt;String&gt;&gt;) (Object) Set.class,
437                     p -&gt; new LinkedHashSet&lt;String&gt;(),
438                     (s, p) -&gt; new LinkedHashSet&lt;&gt;(Arrays.asList(s.split(&quot;,&quot;)))
439             );
440 
441     static boolean isRuntimeInstaller(Map&lt;String, ? super Object&gt; params) {
442         if (params.containsKey(MODULE.getID()) ||
443                 params.containsKey(MAIN_JAR.getID()) ||
444                 params.containsKey(PREDEFINED_APP_IMAGE.getID())) {
445             return false; // we are building or are given an application
446         }
447         // runtime installer requires --runtime-image, if this is false
448         // here then we should have thrown error validating args.
449         return params.containsKey(PREDEFINED_RUNTIME_IMAGE.getID());
450     }
451 
<span class="line-modified">452     static File getPredefinedAppImage(Map&lt;String, ? super Object&gt; params) {</span>
<span class="line-modified">453         File applicationImage = PREDEFINED_APP_IMAGE.fetchFrom(params);</span>
<span class="line-modified">454         if (applicationImage != null &amp;&amp; !applicationImage.exists()) {</span>
455             throw new RuntimeException(
456                     MessageFormat.format(I18N.getString(
457                             &quot;message.app-image-dir-does-not-exist&quot;),
458                             PREDEFINED_APP_IMAGE.getID(),
459                             applicationImage.toString()));
460         }
461         return applicationImage;
462     }
463 
464     static void copyPredefinedRuntimeImage(Map&lt;String, ? super Object&gt; params,
465             ApplicationLayout appLayout) throws IOException, ConfigException {
<span class="line-modified">466         File topImage = PREDEFINED_RUNTIME_IMAGE.fetchFrom(params);</span>
<span class="line-modified">467         if (!topImage.exists()) {</span>
468             throw new ConfigException(
469                     MessageFormat.format(I18N.getString(
470                     &quot;message.runtime-image-dir-does-not-exist&quot;),
471                     PREDEFINED_RUNTIME_IMAGE.getID(),
472                     topImage.toString()),
473                     MessageFormat.format(I18N.getString(
474                     &quot;message.runtime-image-dir-does-not-exist.advice&quot;),
475                     PREDEFINED_RUNTIME_IMAGE.getID()));
476         }
477 
478         if (Platform.isMac()) {
479             // On Mac topImage can be runtime root or runtime home.
<span class="line-modified">480             Path runtimeHome = topImage.toPath().resolve(&quot;Contents/Home&quot;);</span>
481             if (Files.isDirectory(runtimeHome)) {
482                 // topImage references runtime root, adjust it to pick data from
483                 // runtime home
<span class="line-modified">484                 topImage = runtimeHome.toFile();</span>
485             }
486         }
487 
488         // copy whole runtime, need to skip jmods and src.zip
489         final List&lt;String&gt; excludes = Arrays.asList(&quot;jmods&quot;, &quot;src.zip&quot;);
<span class="line-modified">490         IOUtils.copyRecursive(topImage.toPath(),</span>
491                 appLayout.runtimeHomeDirectory(), excludes);
492 
493         // if module-path given - copy modules to appDir/mods
494         List&lt;Path&gt; modulePath = MODULE_PATH.fetchFrom(params);
495         List&lt;Path&gt; defaultModulePath = getDefaultModulePath();
496         Path dest = appLayout.appModsDirectory();
497 
498         if (dest != null) {
499             for (Path mp : modulePath) {
500                 if (!defaultModulePath.contains(mp)) {
501                     Files.createDirectories(dest);
502                     IOUtils.copyRecursive(mp, dest);
503                 }
504             }
505         }
506     }
507 
508     private static List&lt;Path&gt; getDefaultModulePath() {
509         return List.of(
510                 Path.of(System.getProperty(&quot;java.home&quot;), &quot;jmods&quot;).toAbsolutePath());
</pre>
</td>
<td>
<hr />
<pre>
103             new StandardBundlerParam&lt;&gt;(
104                     Arguments.CLIOptions.MAIN_JAR.getId(),
105                     Path.class,
106                     params -&gt; LAUNCHER_DATA.fetchFrom(params).mainJarName(),
107                     null
108             );
109 
110     static final StandardBundlerParam&lt;String&gt; MAIN_CLASS =
111             new StandardBundlerParam&lt;&gt;(
112                     Arguments.CLIOptions.APPCLASS.getId(),
113                     String.class,
114                     params -&gt; {
115                         if (isRuntimeInstaller(params)) {
116                             return null;
117                         }
118                         return LAUNCHER_DATA.fetchFrom(params).qualifiedClassName();
119                     },
120                     (s, p) -&gt; s
121             );
122 
<span class="line-modified">123     static final StandardBundlerParam&lt;Path&gt; PREDEFINED_RUNTIME_IMAGE =</span>
124             new StandardBundlerParam&lt;&gt;(
125                     Arguments.CLIOptions.PREDEFINED_RUNTIME_IMAGE.getId(),
<span class="line-modified">126                     Path.class,</span>
127                     params -&gt; null,
<span class="line-modified">128                     (s, p) -&gt; Path.of(s)</span>
129             );
130 
131     static final StandardBundlerParam&lt;String&gt; APP_NAME =
132             new StandardBundlerParam&lt;&gt;(
133                     Arguments.CLIOptions.NAME.getId(),
134                     String.class,
135                     params -&gt; {
136                         String s = MAIN_CLASS.fetchFrom(params);
137                         if (s != null) {
138                             int idx = s.lastIndexOf(&quot;.&quot;);
139                             if (idx &gt;= 0) {
140                                 return s.substring(idx+1);
141                             }
142                             return s;
143                         } else if (isRuntimeInstaller(params)) {
<span class="line-modified">144                             Path f = PREDEFINED_RUNTIME_IMAGE.fetchFrom(params);</span>
145                             if (f != null) {
<span class="line-modified">146                                 return f.getFileName().toString();</span>
147                             }
148                         }
149                         return null;
150                     },
151                     (s, p) -&gt; s
152             );
153 
<span class="line-modified">154     static final StandardBundlerParam&lt;Path&gt; ICON =</span>
155             new StandardBundlerParam&lt;&gt;(
156                     Arguments.CLIOptions.ICON.getId(),
<span class="line-modified">157                     Path.class,</span>
158                     params -&gt; null,
<span class="line-modified">159                     (s, p) -&gt; Path.of(s)</span>
160             );
161 
162     static final StandardBundlerParam&lt;String&gt; VENDOR =
163             new StandardBundlerParam&lt;&gt;(
164                     Arguments.CLIOptions.VENDOR.getId(),
165                     String.class,
166                     params -&gt; I18N.getString(&quot;param.vendor.default&quot;),
167                     (s, p) -&gt; s
168             );
169 
170     static final StandardBundlerParam&lt;String&gt; DESCRIPTION =
171             new StandardBundlerParam&lt;&gt;(
172                     Arguments.CLIOptions.DESCRIPTION.getId(),
173                     String.class,
174                     params -&gt; params.containsKey(APP_NAME.getID())
175                             ? APP_NAME.fetchFrom(params)
176                             : I18N.getString(&quot;param.description.default&quot;),
177                     (s, p) -&gt; s
178             );
179 
</pre>
<hr />
<pre>
212                     (s, p) -&gt; s
213             );
214 
215     static final StandardBundlerParam&lt;String&gt; RELEASE =
216             new StandardBundlerParam&lt;&gt;(
217                     Arguments.CLIOptions.RELEASE.getId(),
218                     String.class,
219                     params -&gt; DEFAULT_RELEASE,
220                     (s, p) -&gt; s
221             );
222 
223     @SuppressWarnings(&quot;unchecked&quot;)
224     public static final StandardBundlerParam&lt;String&gt; LICENSE_FILE =
225             new StandardBundlerParam&lt;&gt;(
226                     Arguments.CLIOptions.LICENSE_FILE.getId(),
227                     String.class,
228                     params -&gt; null,
229                     (s, p) -&gt; s
230             );
231 
<span class="line-modified">232     static final StandardBundlerParam&lt;Path&gt; TEMP_ROOT =</span>
233             new StandardBundlerParam&lt;&gt;(
234                     Arguments.CLIOptions.TEMP_ROOT.getId(),
<span class="line-modified">235                     Path.class,</span>
236                     params -&gt; {
237                         try {
<span class="line-modified">238                             return Files.createTempDirectory(&quot;jdk.incubator.jpackage&quot;);</span>

239                         } catch (IOException ioe) {
240                             return null;
241                         }
242                     },
<span class="line-modified">243                     (s, p) -&gt; Path.of(s)</span>
244             );
245 
<span class="line-modified">246     public static final StandardBundlerParam&lt;Path&gt; CONFIG_ROOT =</span>
247             new StandardBundlerParam&lt;&gt;(
248                 &quot;configRoot&quot;,
<span class="line-modified">249                 Path.class,</span>
250                 params -&gt; {
<span class="line-modified">251                     Path root = TEMP_ROOT.fetchFrom(params).resolve(&quot;config&quot;);</span>
<span class="line-modified">252                     try {</span>
<span class="line-modified">253                         Files.createDirectories(root);</span>
<span class="line-added">254                     } catch (IOException ioe) {</span>
<span class="line-added">255                         return null;</span>
<span class="line-added">256                     }</span>
257                     return root;
258                 },
259                 (s, p) -&gt; null
260             );
261 
262     static final StandardBundlerParam&lt;Boolean&gt; BIND_SERVICES =
263             new StandardBundlerParam&lt;&gt;(
264                     Arguments.CLIOptions.BIND_SERVICES.getId(),
265                     Boolean.class,
266                     params -&gt; false,
267                     (s, p) -&gt; (s == null || &quot;null&quot;.equalsIgnoreCase(s)) ?
268                             true : Boolean.valueOf(s)
269             );
270 
271 
272     static final StandardBundlerParam&lt;Boolean&gt; VERBOSE  =
273             new StandardBundlerParam&lt;&gt;(
274                     Arguments.CLIOptions.VERBOSE.getId(),
275                     Boolean.class,
276                     params -&gt; false,
277                     // valueOf(null) is false, and we actually do want null
278                     (s, p) -&gt; (s == null || &quot;null&quot;.equalsIgnoreCase(s)) ?
279                             true : Boolean.valueOf(s)
280             );
281 
<span class="line-modified">282     static final StandardBundlerParam&lt;Path&gt; RESOURCE_DIR =</span>
283             new StandardBundlerParam&lt;&gt;(
284                     Arguments.CLIOptions.RESOURCE_DIR.getId(),
<span class="line-modified">285                     Path.class,</span>
286                     params -&gt; null,
<span class="line-modified">287                     (s, p) -&gt; Path.of(s)</span>
288             );
289 
290     static final BundlerParamInfo&lt;String&gt; INSTALL_DIR =
291             new StandardBundlerParam&lt;&gt;(
292                     Arguments.CLIOptions.INSTALL_DIR.getId(),
293                     String.class,
294                      params -&gt; null,
295                     (s, p) -&gt; s
296     );
297 
<span class="line-modified">298     static final StandardBundlerParam&lt;Path&gt; PREDEFINED_APP_IMAGE =</span>
299             new StandardBundlerParam&lt;&gt;(
300             Arguments.CLIOptions.PREDEFINED_APP_IMAGE.getId(),
<span class="line-modified">301             Path.class,</span>
302             params -&gt; null,
<span class="line-modified">303             (s, p) -&gt; Path.of(s));</span>
304 
305     @SuppressWarnings(&quot;unchecked&quot;)
306     static final StandardBundlerParam&lt;List&lt;Map&lt;String, ? super Object&gt;&gt;&gt; ADD_LAUNCHERS =
307             new StandardBundlerParam&lt;&gt;(
308                     Arguments.CLIOptions.ADD_LAUNCHER.getId(),
309                     (Class&lt;List&lt;Map&lt;String, ? super Object&gt;&gt;&gt;) (Object)
310                             List.class,
311                     params -&gt; new ArrayList&lt;&gt;(1),
312                     // valueOf(null) is false, and we actually do want null
313                     (s, p) -&gt; null
314             );
315 
316     @SuppressWarnings(&quot;unchecked&quot;)
317     static final StandardBundlerParam
318             &lt;List&lt;Map&lt;String, ? super Object&gt;&gt;&gt; FILE_ASSOCIATIONS =
319             new StandardBundlerParam&lt;&gt;(
320                     Arguments.CLIOptions.FILE_ASSOCIATIONS.getId(),
321                     (Class&lt;List&lt;Map&lt;String, ? super Object&gt;&gt;&gt;) (Object)
322                             List.class,
323                     params -&gt; new ArrayList&lt;&gt;(1),
</pre>
<hr />
<pre>
331                     &quot;fileAssociation.extension&quot;,
332                     (Class&lt;List&lt;String&gt;&gt;) (Object) List.class,
333                     params -&gt; null, // null means not matched to an extension
334                     (s, p) -&gt; Arrays.asList(s.split(&quot;(,|\\s)+&quot;))
335             );
336 
337     @SuppressWarnings(&quot;unchecked&quot;)
338     static final StandardBundlerParam&lt;List&lt;String&gt;&gt; FA_CONTENT_TYPE =
339             new StandardBundlerParam&lt;&gt;(
340                     &quot;fileAssociation.contentType&quot;,
341                     (Class&lt;List&lt;String&gt;&gt;) (Object) List.class,
342                     params -&gt; null,
343                             // null means not matched to a content/mime type
344                     (s, p) -&gt; Arrays.asList(s.split(&quot;(,|\\s)+&quot;))
345             );
346 
347     static final StandardBundlerParam&lt;String&gt; FA_DESCRIPTION =
348             new StandardBundlerParam&lt;&gt;(
349                     &quot;fileAssociation.description&quot;,
350                     String.class,
<span class="line-modified">351                     params -&gt; APP_NAME.fetchFrom(params) + &quot; Path&quot;,</span>
352                     null
353             );
354 
<span class="line-modified">355     static final StandardBundlerParam&lt;Path&gt; FA_ICON =</span>
356             new StandardBundlerParam&lt;&gt;(
357                     &quot;fileAssociation.icon&quot;,
<span class="line-modified">358                     Path.class,</span>
359                     ICON::fetchFrom,
<span class="line-modified">360                     (s, p) -&gt; Path.of(s)</span>
361             );
362 
363     @SuppressWarnings(&quot;unchecked&quot;)
364     static final BundlerParamInfo&lt;List&lt;Path&gt;&gt; MODULE_PATH =
365             new StandardBundlerParam&lt;&gt;(
366                     Arguments.CLIOptions.MODULE_PATH.getId(),
367                     (Class&lt;List&lt;Path&gt;&gt;) (Object)List.class,
368                     p -&gt; getDefaultModulePath(),
369                     (s, p) -&gt; {
370                         List&lt;Path&gt; modulePath = Stream.of(s.split(File.pathSeparator))
371                                 .map(Path::of)
372                                 .collect(Collectors.toList());
373                         Path javaBasePath = findPathOfModule(modulePath, JAVABASEJMOD);
374 
375                         // Add the default JDK module path to the module path.
376                         if (javaBasePath == null) {
377                             List&lt;Path&gt; jdkModulePath = getDefaultModulePath();
378 
379                             if (jdkModulePath != null) {
380                                 modulePath.addAll(jdkModulePath);
</pre>
<hr />
<pre>
434     @SuppressWarnings(&quot;unchecked&quot;)
435     static final BundlerParamInfo&lt;Set&lt;String&gt;&gt; LIMIT_MODULES =
436             new StandardBundlerParam&lt;&gt;(
437                     &quot;limit-modules&quot;,
438                     (Class&lt;Set&lt;String&gt;&gt;) (Object) Set.class,
439                     p -&gt; new LinkedHashSet&lt;String&gt;(),
440                     (s, p) -&gt; new LinkedHashSet&lt;&gt;(Arrays.asList(s.split(&quot;,&quot;)))
441             );
442 
443     static boolean isRuntimeInstaller(Map&lt;String, ? super Object&gt; params) {
444         if (params.containsKey(MODULE.getID()) ||
445                 params.containsKey(MAIN_JAR.getID()) ||
446                 params.containsKey(PREDEFINED_APP_IMAGE.getID())) {
447             return false; // we are building or are given an application
448         }
449         // runtime installer requires --runtime-image, if this is false
450         // here then we should have thrown error validating args.
451         return params.containsKey(PREDEFINED_RUNTIME_IMAGE.getID());
452     }
453 
<span class="line-modified">454     static Path getPredefinedAppImage(Map&lt;String, ? super Object&gt; params) {</span>
<span class="line-modified">455         Path applicationImage = PREDEFINED_APP_IMAGE.fetchFrom(params);</span>
<span class="line-modified">456         if (applicationImage != null &amp;&amp; !IOUtils.exists(applicationImage)) {</span>
457             throw new RuntimeException(
458                     MessageFormat.format(I18N.getString(
459                             &quot;message.app-image-dir-does-not-exist&quot;),
460                             PREDEFINED_APP_IMAGE.getID(),
461                             applicationImage.toString()));
462         }
463         return applicationImage;
464     }
465 
466     static void copyPredefinedRuntimeImage(Map&lt;String, ? super Object&gt; params,
467             ApplicationLayout appLayout) throws IOException, ConfigException {
<span class="line-modified">468         Path topImage = PREDEFINED_RUNTIME_IMAGE.fetchFrom(params);</span>
<span class="line-modified">469         if (!IOUtils.exists(topImage)) {</span>
470             throw new ConfigException(
471                     MessageFormat.format(I18N.getString(
472                     &quot;message.runtime-image-dir-does-not-exist&quot;),
473                     PREDEFINED_RUNTIME_IMAGE.getID(),
474                     topImage.toString()),
475                     MessageFormat.format(I18N.getString(
476                     &quot;message.runtime-image-dir-does-not-exist.advice&quot;),
477                     PREDEFINED_RUNTIME_IMAGE.getID()));
478         }
479 
480         if (Platform.isMac()) {
481             // On Mac topImage can be runtime root or runtime home.
<span class="line-modified">482             Path runtimeHome = topImage.resolve(&quot;Contents/Home&quot;);</span>
483             if (Files.isDirectory(runtimeHome)) {
484                 // topImage references runtime root, adjust it to pick data from
485                 // runtime home
<span class="line-modified">486                 topImage = runtimeHome;</span>
487             }
488         }
489 
490         // copy whole runtime, need to skip jmods and src.zip
491         final List&lt;String&gt; excludes = Arrays.asList(&quot;jmods&quot;, &quot;src.zip&quot;);
<span class="line-modified">492         IOUtils.copyRecursive(topImage,</span>
493                 appLayout.runtimeHomeDirectory(), excludes);
494 
495         // if module-path given - copy modules to appDir/mods
496         List&lt;Path&gt; modulePath = MODULE_PATH.fetchFrom(params);
497         List&lt;Path&gt; defaultModulePath = getDefaultModulePath();
498         Path dest = appLayout.appModsDirectory();
499 
500         if (dest != null) {
501             for (Path mp : modulePath) {
502                 if (!defaultModulePath.contains(mp)) {
503                     Files.createDirectories(dest);
504                     IOUtils.copyRecursive(mp, dest);
505                 }
506             }
507         }
508     }
509 
510     private static List&lt;Path&gt; getDefaultModulePath() {
511         return List.of(
512                 Path.of(System.getProperty(&quot;java.home&quot;), &quot;jmods&quot;).toAbsolutePath());
</pre>
</td>
</tr>
</table>
<center><a href="ScriptRunner.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="resources/HelpResources_ja.properties.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>