<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/share/classes/java/awt/image/RescaleOp.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../Desktop.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../javax/swing/PopupFactory.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/java/awt/image/RescaleOp.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package java.awt.image;
 27 
<span class="line-removed"> 28 import java.awt.color.ColorSpace;</span>
 29 import java.awt.geom.Rectangle2D;
 30 import java.awt.AlphaComposite;
 31 import java.awt.Graphics2D;
<span class="line-removed"> 32 import java.awt.Rectangle;</span>
 33 import java.awt.geom.Point2D;
 34 import java.awt.RenderingHints;
 35 import sun.awt.image.ImagingLib;
 36 
 37 /**
 38  * This class performs a pixel-by-pixel rescaling of the data in the
 39  * source image by multiplying the sample values for each pixel by a scale
 40  * factor and then adding an offset. The scaled sample values are clipped
 41  * to the minimum/maximum representable in the destination image.
 42  * &lt;p&gt;
 43  * The pseudo code for the rescaling operation is as follows:
 44  * &lt;pre&gt;
 45  *for each pixel from Source object {
 46  *    for each band/component of the pixel {
 47  *        dstElement = (srcElement*scaleFactor) + offset
 48  *    }
 49  *}
 50  * &lt;/pre&gt;
 51  * &lt;p&gt;
 52  * For Rasters, rescaling operates on bands.  The number of
</pre>
<hr />
<pre>
362      *         {@code RescaleOp} do not meet the requirements
363      *         stated in the class comments, or if the source and
364      *         destination images differ in size.
365      */
366     public final BufferedImage filter (BufferedImage src, BufferedImage dst) {
367         ColorModel srcCM = src.getColorModel();
368         ColorModel dstCM;
369         int numSrcColorComp = srcCM.getNumColorComponents();
370         int scaleConst = length;
371 
372         if (srcCM instanceof IndexColorModel) {
373             throw new
374                 IllegalArgumentException(&quot;Rescaling cannot be &quot;+
375                                          &quot;performed on an indexed image&quot;);
376         }
377         if (scaleConst != 1 &amp;&amp; scaleConst != numSrcColorComp &amp;&amp;
378             scaleConst != srcCM.getNumComponents())
379         {
380             throw new IllegalArgumentException(&quot;Number of scaling constants &quot;+
381                                                &quot;does not equal the number of&quot;+
<span class="line-modified">382                                                &quot; of color or color/alpha &quot;+</span>
383                                                &quot; components&quot;);
384         }
385 
386         boolean needToConvert = false;
387         boolean needToDraw = false;
388 
389         // Include alpha
390         if (scaleConst &gt; numSrcColorComp &amp;&amp; srcCM.hasAlpha()) {
391             scaleConst = numSrcColorComp+1;
392         }
393 
394         int width = src.getWidth();
395         int height = src.getHeight();
396 
397         BufferedImage origDst = dst;
398         if (dst == null) {
399             dst = createCompatibleDestImage(src, null);
400             dstCM = srcCM;
401         }
402         else {
</pre>
<hr />
<pre>
495             dst = createCompatibleDestRaster(src);
496         }
497         else if (height != dst.getHeight() || width != dst.getWidth()) {
498             throw new
499                IllegalArgumentException(&quot;Width or height of Rasters do not &quot;+
500                                         &quot;match&quot;);
501         }
502         else if (numBands != dst.getNumBands()) {
503             // Make sure that the number of bands are equal
504             throw new IllegalArgumentException(&quot;Number of bands in src &quot;
505                             + numBands
506                             + &quot; does not equal number of bands in dest &quot;
507                             + dst.getNumBands());
508         }
509 
510         // Make sure that the arrays match
511         // Make sure that the low/high/constant arrays match
512         if (sCheck &amp;&amp; scaleConst != 1 &amp;&amp; scaleConst != src.getNumBands()) {
513             throw new IllegalArgumentException(&quot;Number of scaling constants &quot;+
514                                                &quot;does not equal the number of&quot;+
<span class="line-modified">515                                                &quot; of bands in the src raster&quot;);</span>
516         }
517 
518         //
519         // Try for a native raster rescale first
520         //
521         if (ImagingLib.filter(this, src, dst) != null) {
522             return dst;
523         }
524 
525         //
526         // Native raster rescale failed.
527         // Try to see if a lookup operation can be used
528         //
529         if (canUseLookup(src, dst)) {
530             int srcNgray = (1 &lt;&lt; srcNbits);
531             int dstNgray = (1 &lt;&lt; dstNbits);
532 
533             if (dstNgray == 256) {
534                 ByteLookupTable lut = createByteLut(scaleFactors, offsets,
535                                                     numBands, srcNgray);
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package java.awt.image;
 27 

 28 import java.awt.geom.Rectangle2D;
 29 import java.awt.AlphaComposite;
 30 import java.awt.Graphics2D;

 31 import java.awt.geom.Point2D;
 32 import java.awt.RenderingHints;
 33 import sun.awt.image.ImagingLib;
 34 
 35 /**
 36  * This class performs a pixel-by-pixel rescaling of the data in the
 37  * source image by multiplying the sample values for each pixel by a scale
 38  * factor and then adding an offset. The scaled sample values are clipped
 39  * to the minimum/maximum representable in the destination image.
 40  * &lt;p&gt;
 41  * The pseudo code for the rescaling operation is as follows:
 42  * &lt;pre&gt;
 43  *for each pixel from Source object {
 44  *    for each band/component of the pixel {
 45  *        dstElement = (srcElement*scaleFactor) + offset
 46  *    }
 47  *}
 48  * &lt;/pre&gt;
 49  * &lt;p&gt;
 50  * For Rasters, rescaling operates on bands.  The number of
</pre>
<hr />
<pre>
360      *         {@code RescaleOp} do not meet the requirements
361      *         stated in the class comments, or if the source and
362      *         destination images differ in size.
363      */
364     public final BufferedImage filter (BufferedImage src, BufferedImage dst) {
365         ColorModel srcCM = src.getColorModel();
366         ColorModel dstCM;
367         int numSrcColorComp = srcCM.getNumColorComponents();
368         int scaleConst = length;
369 
370         if (srcCM instanceof IndexColorModel) {
371             throw new
372                 IllegalArgumentException(&quot;Rescaling cannot be &quot;+
373                                          &quot;performed on an indexed image&quot;);
374         }
375         if (scaleConst != 1 &amp;&amp; scaleConst != numSrcColorComp &amp;&amp;
376             scaleConst != srcCM.getNumComponents())
377         {
378             throw new IllegalArgumentException(&quot;Number of scaling constants &quot;+
379                                                &quot;does not equal the number of&quot;+
<span class="line-modified">380                                                &quot; color or color/alpha&quot;+</span>
381                                                &quot; components&quot;);
382         }
383 
384         boolean needToConvert = false;
385         boolean needToDraw = false;
386 
387         // Include alpha
388         if (scaleConst &gt; numSrcColorComp &amp;&amp; srcCM.hasAlpha()) {
389             scaleConst = numSrcColorComp+1;
390         }
391 
392         int width = src.getWidth();
393         int height = src.getHeight();
394 
395         BufferedImage origDst = dst;
396         if (dst == null) {
397             dst = createCompatibleDestImage(src, null);
398             dstCM = srcCM;
399         }
400         else {
</pre>
<hr />
<pre>
493             dst = createCompatibleDestRaster(src);
494         }
495         else if (height != dst.getHeight() || width != dst.getWidth()) {
496             throw new
497                IllegalArgumentException(&quot;Width or height of Rasters do not &quot;+
498                                         &quot;match&quot;);
499         }
500         else if (numBands != dst.getNumBands()) {
501             // Make sure that the number of bands are equal
502             throw new IllegalArgumentException(&quot;Number of bands in src &quot;
503                             + numBands
504                             + &quot; does not equal number of bands in dest &quot;
505                             + dst.getNumBands());
506         }
507 
508         // Make sure that the arrays match
509         // Make sure that the low/high/constant arrays match
510         if (sCheck &amp;&amp; scaleConst != 1 &amp;&amp; scaleConst != src.getNumBands()) {
511             throw new IllegalArgumentException(&quot;Number of scaling constants &quot;+
512                                                &quot;does not equal the number of&quot;+
<span class="line-modified">513                                                &quot; bands in the src raster&quot;);</span>
514         }
515 
516         //
517         // Try for a native raster rescale first
518         //
519         if (ImagingLib.filter(this, src, dst) != null) {
520             return dst;
521         }
522 
523         //
524         // Native raster rescale failed.
525         // Try to see if a lookup operation can be used
526         //
527         if (canUseLookup(src, dst)) {
528             int srcNgray = (1 &lt;&lt; srcNbits);
529             int dstNgray = (1 &lt;&lt; dstNbits);
530 
531             if (dstNgray == 256) {
532                 ByteLookupTable lut = createByteLut(scaleFactors, offsets,
533                                                     numBands, srcNgray);
</pre>
</td>
</tr>
</table>
<center><a href="../Desktop.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../javax/swing/PopupFactory.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>