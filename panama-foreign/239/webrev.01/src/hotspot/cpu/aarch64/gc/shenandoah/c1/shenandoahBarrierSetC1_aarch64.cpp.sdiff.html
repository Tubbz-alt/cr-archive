<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/cpu/aarch64/gc/shenandoah/c1/shenandoahBarrierSetC1_aarch64.cpp</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../c1_LIRAssembler_aarch64.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../shenandoahBarrierSetAssembler_aarch64.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/aarch64/gc/shenandoah/c1/shenandoahBarrierSetC1_aarch64.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 31 
 32 #define __ masm-&gt;masm()-&gt;
 33 
 34 void LIR_OpShenandoahCompareAndSwap::emit_code(LIR_Assembler* masm) {
 35   Register addr = _addr-&gt;as_register_lo();
 36   Register newval = _new_value-&gt;as_register();
 37   Register cmpval = _cmp_value-&gt;as_register();
 38   Register tmp1 = _tmp1-&gt;as_register();
 39   Register tmp2 = _tmp2-&gt;as_register();
 40   Register result = result_opr()-&gt;as_register();
 41 
 42   ShenandoahBarrierSet::assembler()-&gt;storeval_barrier(masm-&gt;masm(), newval, rscratch2);
 43 
 44   if (UseCompressedOops) {
 45     __ encode_heap_oop(tmp1, cmpval);
 46     cmpval = tmp1;
 47     __ encode_heap_oop(tmp2, newval);
 48     newval = tmp2;
 49   }
 50 
<span class="line-modified"> 51   ShenandoahBarrierSet::assembler()-&gt;cmpxchg_oop(masm-&gt;masm(), addr, cmpval, newval, /*acquire*/ false, /*release*/ true, /*weak*/ false, /*is_cae*/ false, result);</span>
 52 }
 53 
 54 #undef __
 55 
 56 #ifdef ASSERT
 57 #define __ gen-&gt;lir(__FILE__, __LINE__)-&gt;
 58 #else
 59 #define __ gen-&gt;lir()-&gt;
 60 #endif
 61 
 62 LIR_Opr ShenandoahBarrierSetC1::atomic_cmpxchg_at_resolved(LIRAccess&amp; access, LIRItem&amp; cmp_value, LIRItem&amp; new_value) {
 63   BasicType bt = access.type();
 64   if (access.is_oop()) {
 65     LIRGenerator *gen = access.gen();
 66     if (ShenandoahSATBBarrier) {
 67       pre_barrier(gen, access.access_emit_info(), access.decorators(), access.resolved_addr(),
 68                   LIR_OprFact::illegalOpr /* pre_val */);
 69     }
 70     if (ShenandoahCASBarrier) {
 71       cmp_value.load_item();
</pre>
</td>
<td>
<hr />
<pre>
 31 
 32 #define __ masm-&gt;masm()-&gt;
 33 
 34 void LIR_OpShenandoahCompareAndSwap::emit_code(LIR_Assembler* masm) {
 35   Register addr = _addr-&gt;as_register_lo();
 36   Register newval = _new_value-&gt;as_register();
 37   Register cmpval = _cmp_value-&gt;as_register();
 38   Register tmp1 = _tmp1-&gt;as_register();
 39   Register tmp2 = _tmp2-&gt;as_register();
 40   Register result = result_opr()-&gt;as_register();
 41 
 42   ShenandoahBarrierSet::assembler()-&gt;storeval_barrier(masm-&gt;masm(), newval, rscratch2);
 43 
 44   if (UseCompressedOops) {
 45     __ encode_heap_oop(tmp1, cmpval);
 46     cmpval = tmp1;
 47     __ encode_heap_oop(tmp2, newval);
 48     newval = tmp2;
 49   }
 50 
<span class="line-modified"> 51   ShenandoahBarrierSet::assembler()-&gt;cmpxchg_oop(masm-&gt;masm(), addr, cmpval, newval, /*acquire*/ false, /*release*/ true, /*is_cae*/ false, result);</span>
 52 }
 53 
 54 #undef __
 55 
 56 #ifdef ASSERT
 57 #define __ gen-&gt;lir(__FILE__, __LINE__)-&gt;
 58 #else
 59 #define __ gen-&gt;lir()-&gt;
 60 #endif
 61 
 62 LIR_Opr ShenandoahBarrierSetC1::atomic_cmpxchg_at_resolved(LIRAccess&amp; access, LIRItem&amp; cmp_value, LIRItem&amp; new_value) {
 63   BasicType bt = access.type();
 64   if (access.is_oop()) {
 65     LIRGenerator *gen = access.gen();
 66     if (ShenandoahSATBBarrier) {
 67       pre_barrier(gen, access.access_emit_info(), access.decorators(), access.resolved_addr(),
 68                   LIR_OprFact::illegalOpr /* pre_val */);
 69     }
 70     if (ShenandoahCASBarrier) {
 71       cmp_value.load_item();
</pre>
</td>
</tr>
</table>
<center><a href="../../../c1_LIRAssembler_aarch64.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../shenandoahBarrierSetAssembler_aarch64.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>