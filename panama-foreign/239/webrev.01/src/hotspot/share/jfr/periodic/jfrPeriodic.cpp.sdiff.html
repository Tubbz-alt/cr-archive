<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/jfr/periodic/jfrPeriodic.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../metadata/metadata.xml.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../recorder/jfrRecorder.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/periodic/jfrPeriodic.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 37 #include &quot;gc/shared/gcVMOperations.hpp&quot;
 38 #include &quot;gc/shared/objectCountEventSender.hpp&quot;
 39 #include &quot;jfr/jfrEvents.hpp&quot;
 40 #include &quot;jfr/periodic/jfrModuleEvent.hpp&quot;
 41 #include &quot;jfr/periodic/jfrOSInterface.hpp&quot;
 42 #include &quot;jfr/periodic/jfrThreadCPULoadEvent.hpp&quot;
 43 #include &quot;jfr/periodic/jfrThreadDumpEvent.hpp&quot;
 44 #include &quot;jfr/periodic/jfrNetworkUtilization.hpp&quot;
 45 #include &quot;jfr/recorder/jfrRecorder.hpp&quot;
 46 #include &quot;jfr/support/jfrThreadId.hpp&quot;
 47 #include &quot;jfr/utilities/jfrThreadIterator.hpp&quot;
 48 #include &quot;jfr/utilities/jfrTime.hpp&quot;
 49 #include &quot;jfrfiles/jfrPeriodic.hpp&quot;
 50 #include &quot;logging/log.hpp&quot;
 51 #include &quot;memory/heapInspection.hpp&quot;
 52 #include &quot;memory/resourceArea.hpp&quot;
 53 #include &quot;oops/oop.inline.hpp&quot;
 54 #include &quot;runtime/arguments.hpp&quot;
 55 #include &quot;runtime/flags/jvmFlag.hpp&quot;
 56 #include &quot;runtime/globals.hpp&quot;

 57 #include &quot;runtime/os.hpp&quot;
 58 #include &quot;runtime/os_perf.hpp&quot;
 59 #include &quot;runtime/thread.inline.hpp&quot;
 60 #include &quot;runtime/sweeper.hpp&quot;
 61 #include &quot;runtime/vmThread.hpp&quot;
 62 #include &quot;services/classLoadingService.hpp&quot;
 63 #include &quot;services/management.hpp&quot;
 64 #include &quot;services/threadService.hpp&quot;
 65 #include &quot;utilities/exceptions.hpp&quot;
 66 #include &quot;utilities/globalDefinitions.hpp&quot;
 67 #if INCLUDE_G1GC
 68 #include &quot;gc/g1/g1HeapRegionEventSender.hpp&quot;
 69 #endif
 70 #if INCLUDE_SHENANDOAHGC
 71 #include &quot;gc/shenandoah/shenandoahJfrSupport.hpp&quot;
 72 #endif
 73 /**
 74  *  JfrPeriodic class
 75  *  Implementation of declarations in
 76  *  xsl generated traceRequestables.hpp
</pre>
<hr />
<pre>
157     return;
158   }
159   if (ret_val == FUNCTIONALITY_NOT_IMPLEMENTED) {
160      return;
161   }
162   if (ret_val == OS_OK) {
163     EventCPUInformation event;
164     event.set_cpu(cpu_info.cpu_name());
165     event.set_description(cpu_info.cpu_description());
166     event.set_sockets(cpu_info.number_of_sockets());
167     event.set_cores(cpu_info.number_of_cores());
168     event.set_hwThreads(cpu_info.number_of_hardware_threads());
169     event.commit();
170   }
171 }
172 
173 TRACE_REQUEST_FUNC(CPULoad) {
174   double u = 0; // user time
175   double s = 0; // kernel time
176   double t = 0; // total time
<span class="line-modified">177   int ret_val = JfrOSInterface::cpu_loads_process(&amp;u, &amp;s, &amp;t);</span>






178   if (ret_val == OS_ERR) {
179     log_debug(jfr, system)( &quot;Unable to generate requestable event CPULoad&quot;);
180     return;
181   }
182   if (ret_val == OS_OK) {
183     EventCPULoad event;
184     event.set_jvmUser((float)u);
185     event.set_jvmSystem((float)s);
186     event.set_machineTotal((float)t);
187     event.commit();
188   }
189 }
190 
191 TRACE_REQUEST_FUNC(ThreadCPULoad) {
192   JfrThreadCPULoadEvent::send_events();
193 }
194 
195 TRACE_REQUEST_FUNC(NetworkUtilization) {
196   JfrNetworkUtilization::send_events();
197 }
</pre>
<hr />
<pre>
231          info = processes-&gt;name();
232       }
233       if (info == NULL) {
234          info = &quot;?&quot;;
235       }
236       jio_snprintf(pid_buf, sizeof(pid_buf), &quot;%d&quot;, processes-&gt;pid());
237       EventSystemProcess event(UNTIMED);
238       event.set_pid(pid_buf);
239       event.set_commandLine(info);
240       event.set_starttime(start_time);
241       event.set_endtime(end_time);
242       event.commit();
243       processes = processes-&gt;next();
244       delete tmp;
245     }
246   }
247 }
248 
249 TRACE_REQUEST_FUNC(ThreadContextSwitchRate) {
250   double rate = 0.0;
<span class="line-modified">251   int ret_val = JfrOSInterface::context_switch_rate(&amp;rate);</span>






252   if (ret_val == OS_ERR) {
253     log_debug(jfr, system)( &quot;Unable to generate requestable event ThreadContextSwitchRate&quot;);
254     return;
255   }
256   if (ret_val == FUNCTIONALITY_NOT_IMPLEMENTED) {
257     return;
258   }
259   if (ret_val == OS_OK) {
260     EventThreadContextSwitchRate event;
261     event.set_switchRate((float)rate + 0.0f);
262     event.commit();
263   }
264 }
265 
266 #define SEND_FLAGS_OF_TYPE(eventType, flagType)                   \
267   do {                                                            \
268     JVMFlag *flag = JVMFlag::flags;                               \
269     while (flag-&gt;_name != NULL) {                                 \
270       if (flag-&gt;is_ ## flagType()) {                              \
271         if (flag-&gt;is_unlocked()) {                                \
</pre>
</td>
<td>
<hr />
<pre>
 37 #include &quot;gc/shared/gcVMOperations.hpp&quot;
 38 #include &quot;gc/shared/objectCountEventSender.hpp&quot;
 39 #include &quot;jfr/jfrEvents.hpp&quot;
 40 #include &quot;jfr/periodic/jfrModuleEvent.hpp&quot;
 41 #include &quot;jfr/periodic/jfrOSInterface.hpp&quot;
 42 #include &quot;jfr/periodic/jfrThreadCPULoadEvent.hpp&quot;
 43 #include &quot;jfr/periodic/jfrThreadDumpEvent.hpp&quot;
 44 #include &quot;jfr/periodic/jfrNetworkUtilization.hpp&quot;
 45 #include &quot;jfr/recorder/jfrRecorder.hpp&quot;
 46 #include &quot;jfr/support/jfrThreadId.hpp&quot;
 47 #include &quot;jfr/utilities/jfrThreadIterator.hpp&quot;
 48 #include &quot;jfr/utilities/jfrTime.hpp&quot;
 49 #include &quot;jfrfiles/jfrPeriodic.hpp&quot;
 50 #include &quot;logging/log.hpp&quot;
 51 #include &quot;memory/heapInspection.hpp&quot;
 52 #include &quot;memory/resourceArea.hpp&quot;
 53 #include &quot;oops/oop.inline.hpp&quot;
 54 #include &quot;runtime/arguments.hpp&quot;
 55 #include &quot;runtime/flags/jvmFlag.hpp&quot;
 56 #include &quot;runtime/globals.hpp&quot;
<span class="line-added"> 57 #include &quot;runtime/interfaceSupport.inline.hpp&quot;</span>
 58 #include &quot;runtime/os.hpp&quot;
 59 #include &quot;runtime/os_perf.hpp&quot;
 60 #include &quot;runtime/thread.inline.hpp&quot;
 61 #include &quot;runtime/sweeper.hpp&quot;
 62 #include &quot;runtime/vmThread.hpp&quot;
 63 #include &quot;services/classLoadingService.hpp&quot;
 64 #include &quot;services/management.hpp&quot;
 65 #include &quot;services/threadService.hpp&quot;
 66 #include &quot;utilities/exceptions.hpp&quot;
 67 #include &quot;utilities/globalDefinitions.hpp&quot;
 68 #if INCLUDE_G1GC
 69 #include &quot;gc/g1/g1HeapRegionEventSender.hpp&quot;
 70 #endif
 71 #if INCLUDE_SHENANDOAHGC
 72 #include &quot;gc/shenandoah/shenandoahJfrSupport.hpp&quot;
 73 #endif
 74 /**
 75  *  JfrPeriodic class
 76  *  Implementation of declarations in
 77  *  xsl generated traceRequestables.hpp
</pre>
<hr />
<pre>
158     return;
159   }
160   if (ret_val == FUNCTIONALITY_NOT_IMPLEMENTED) {
161      return;
162   }
163   if (ret_val == OS_OK) {
164     EventCPUInformation event;
165     event.set_cpu(cpu_info.cpu_name());
166     event.set_description(cpu_info.cpu_description());
167     event.set_sockets(cpu_info.number_of_sockets());
168     event.set_cores(cpu_info.number_of_cores());
169     event.set_hwThreads(cpu_info.number_of_hardware_threads());
170     event.commit();
171   }
172 }
173 
174 TRACE_REQUEST_FUNC(CPULoad) {
175   double u = 0; // user time
176   double s = 0; // kernel time
177   double t = 0; // total time
<span class="line-modified">178   int ret_val = OS_ERR;</span>
<span class="line-added">179   {</span>
<span class="line-added">180     // Can take some time on certain platforms, especially under heavy load.</span>
<span class="line-added">181     // Transition to native to avoid unnecessary stalls for pending safepoint synchronizations.</span>
<span class="line-added">182     ThreadToNativeFromVM transition((JavaThread*)Thread::current());</span>
<span class="line-added">183     ret_val = JfrOSInterface::cpu_loads_process(&amp;u, &amp;s, &amp;t);</span>
<span class="line-added">184   }</span>
185   if (ret_val == OS_ERR) {
186     log_debug(jfr, system)( &quot;Unable to generate requestable event CPULoad&quot;);
187     return;
188   }
189   if (ret_val == OS_OK) {
190     EventCPULoad event;
191     event.set_jvmUser((float)u);
192     event.set_jvmSystem((float)s);
193     event.set_machineTotal((float)t);
194     event.commit();
195   }
196 }
197 
198 TRACE_REQUEST_FUNC(ThreadCPULoad) {
199   JfrThreadCPULoadEvent::send_events();
200 }
201 
202 TRACE_REQUEST_FUNC(NetworkUtilization) {
203   JfrNetworkUtilization::send_events();
204 }
</pre>
<hr />
<pre>
238          info = processes-&gt;name();
239       }
240       if (info == NULL) {
241          info = &quot;?&quot;;
242       }
243       jio_snprintf(pid_buf, sizeof(pid_buf), &quot;%d&quot;, processes-&gt;pid());
244       EventSystemProcess event(UNTIMED);
245       event.set_pid(pid_buf);
246       event.set_commandLine(info);
247       event.set_starttime(start_time);
248       event.set_endtime(end_time);
249       event.commit();
250       processes = processes-&gt;next();
251       delete tmp;
252     }
253   }
254 }
255 
256 TRACE_REQUEST_FUNC(ThreadContextSwitchRate) {
257   double rate = 0.0;
<span class="line-modified">258   int ret_val = OS_ERR;</span>
<span class="line-added">259   {</span>
<span class="line-added">260     // Can take some time on certain platforms, especially under heavy load.</span>
<span class="line-added">261     // Transition to native to avoid unnecessary stalls for pending safepoint synchronizations.</span>
<span class="line-added">262     ThreadToNativeFromVM transition((JavaThread*)Thread::current());</span>
<span class="line-added">263     ret_val = JfrOSInterface::context_switch_rate(&amp;rate);</span>
<span class="line-added">264   }</span>
265   if (ret_val == OS_ERR) {
266     log_debug(jfr, system)( &quot;Unable to generate requestable event ThreadContextSwitchRate&quot;);
267     return;
268   }
269   if (ret_val == FUNCTIONALITY_NOT_IMPLEMENTED) {
270     return;
271   }
272   if (ret_val == OS_OK) {
273     EventThreadContextSwitchRate event;
274     event.set_switchRate((float)rate + 0.0f);
275     event.commit();
276   }
277 }
278 
279 #define SEND_FLAGS_OF_TYPE(eventType, flagType)                   \
280   do {                                                            \
281     JVMFlag *flag = JVMFlag::flags;                               \
282     while (flag-&gt;_name != NULL) {                                 \
283       if (flag-&gt;is_ ## flagType()) {                              \
284         if (flag-&gt;is_unlocked()) {                                \
</pre>
</td>
</tr>
</table>
<center><a href="../metadata/metadata.xml.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../recorder/jfrRecorder.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>