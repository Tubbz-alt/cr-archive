diff a/src/jdk.incubator.jextract/share/classes/jdk/internal/jextract/impl/DeclarationImpl.java b/src/jdk.incubator.jextract/share/classes/jdk/internal/jextract/impl/DeclarationImpl.java
--- a/src/jdk.incubator.jextract/share/classes/jdk/internal/jextract/impl/DeclarationImpl.java
+++ b/src/jdk.incubator.jextract/share/classes/jdk/internal/jextract/impl/DeclarationImpl.java
@@ -24,11 +24,11 @@
  *
  */
 
 package jdk.internal.jextract.impl;
 
-import java.lang.constant.ConstantDesc;
+import java.lang.constant.Constable;
 import java.util.Collections;
 import java.util.List;
 import java.util.Map;
 import java.util.Optional;
 import java.util.Set;
@@ -39,16 +39,16 @@
 
 public abstract class DeclarationImpl implements Declaration {
 
     private final String name;
     private final Position pos;
-    private final Map<String, List<ConstantDesc>> attributes;
+    private final Optional<Map<String, List<Constable>>> attributes;
 
-    public DeclarationImpl(String name, Position pos, Map<String, List<ConstantDesc>> attrs) {
+    public DeclarationImpl(String name, Position pos, Map<String, List<Constable>> attrs) {
         this.name = name;
         this.pos = pos;
-        this.attributes = attrs;
+        this.attributes = Optional.ofNullable(attrs);
     }
 
     public String toString() {
         return new PrettyPrinter().print(this);
     }
@@ -61,44 +61,38 @@
     public Position pos() {
         return pos;
     }
 
     @Override
-    public Optional<List<ConstantDesc>> getAttribute(String name) {
-        return Optional.ofNullable(attributes.get(name));
+    public Optional<List<Constable>> getAttribute(String name) {
+        return attributes.map(attrs -> attrs.get(name));
     }
 
     @Override
-    public Set<String> attributeNames() { return Collections.unmodifiableSet(attributes.keySet()); }
+    public Set<String> attributeNames() { return Collections.unmodifiableSet(
+            attributes.map(Map::keySet).orElse(Collections.emptySet()));
+    }
 
     public static class VariableImpl extends DeclarationImpl implements Declaration.Variable {
 
         final Variable.Kind kind;
         final Type type;
         final Optional<MemoryLayout> layout;
 
-        private VariableImpl(Type type, Optional<MemoryLayout> layout, Variable.Kind kind, String name, Position pos, Map<String, List<ConstantDesc>> attrs) {
+        private VariableImpl(Type type, Optional<MemoryLayout> layout, Variable.Kind kind, String name, Position pos, Map<String, List<Constable>> attrs) {
             super(name, pos, attrs);
             this.kind = kind;
             this.type = type;
             this.layout = layout;
         }
 
         public VariableImpl(Type type, Variable.Kind kind, String name, Position pos) {
-            this(type, LayoutUtils.getLayout(type), kind, name, pos, Collections.emptyMap());
+            this(type, LayoutUtils.getLayout(type), kind, name, pos, null);
         }
 
         public VariableImpl(Type type, MemoryLayout layout, Variable.Kind kind, String name, Position pos) {
-            this(type, Optional.of(layout), kind, name, pos, Collections.emptyMap());
-        }
-
-        public static VariableImpl of(Type type, Variable.Kind kind, String name, Position pos, Map<String, List<ConstantDesc>> attrs) {
-            return new VariableImpl(type, LayoutUtils.getLayout(type), kind, name, pos, attrs);
-        }
-
-        public static VariableImpl of(Type type, MemoryLayout layout, Variable.Kind kind, String name, Position pos, Map<String, List<ConstantDesc>> attrs) {
-            return new VariableImpl(type, Optional.of(layout), kind, name, pos, attrs);
+            this(type, Optional.of(layout), kind, name, pos, null);
         }
 
         @Override
         public Kind kind() {
             return kind;
@@ -116,22 +110,32 @@
 
         @Override
         public Optional<MemoryLayout> layout() {
             return layout;
         }
+
+        @Override
+        public Variable withAttributes(Map<String, List<Constable>> attrs) {
+            return new VariableImpl(type, layout, kind, name(), pos(), attrs);
+        }
+
+        @Override
+        public Variable stripAttributes() {
+            return new VariableImpl(type, layout, kind, name(), pos(), null);
+        }
     }
 
     public static class FunctionImpl extends DeclarationImpl implements Declaration.Function {
 
         final List<Variable> params;
         final Type.Function type;
 
         public FunctionImpl(Type.Function type, List<Variable> params, String name, Position pos) {
-            this(type, params, name, pos, Collections.emptyMap());
+            this(type, params, name, pos, null);
         }
 
-        public FunctionImpl(Type.Function type, List<Variable> params, String name, Position pos, Map<String, List<ConstantDesc>> attrs) {
+        public FunctionImpl(Type.Function type, List<Variable> params, String name, Position pos, Map<String, List<Constable>> attrs) {
             super(name, pos, attrs);
             this.params = params;
             this.type = type;
         }
 
@@ -147,28 +151,39 @@
 
         @Override
         public Type.Function type() {
             return type;
         }
+
+        @Override
+        public Function withAttributes(Map<String, List<Constable>> attrs) {
+            return new FunctionImpl(type, params, name(), pos(), attrs);
+        }
+
+        @Override
+        public Function stripAttributes() {
+            return new FunctionImpl(type, params, name(), pos(), null);
+        }
     }
 
     public static class ScopedImpl extends DeclarationImpl implements Declaration.Scoped {
 
         private final Scoped.Kind kind;
         private final List<Declaration> declarations;
         private final Optional<MemoryLayout> optLayout;
 
         public ScopedImpl(Kind kind, MemoryLayout layout, List<Declaration> declarations, String name, Position pos) {
-            this(kind, Optional.of(layout), declarations, name, pos);
+            this(kind, Optional.of(layout), declarations, name, pos, null);
         }
 
         public ScopedImpl(Kind kind, List<Declaration> declarations, String name, Position pos) {
-            this(kind, Optional.empty(), declarations, name, pos);
+            this(kind, Optional.empty(), declarations, name, pos, null);
         }
 
-        ScopedImpl(Kind kind, Optional<MemoryLayout> optLayout, List<Declaration> declarations, String name, Position pos) {
-            super(name, pos, Collections.emptyMap());
+        ScopedImpl(Kind kind, Optional<MemoryLayout> optLayout, List<Declaration> declarations,
+                String name, Position pos, Map<String, List<Constable>> attrs) {
+            super(name, pos, attrs);
             this.kind = kind;
             this.declarations = declarations;
             this.optLayout = optLayout;
         }
 
@@ -189,22 +204,32 @@
 
         @Override
         public Kind kind() {
             return kind;
         }
+
+        @Override
+        public Scoped withAttributes(Map<String, List<Constable>> attrs) {
+            return new ScopedImpl(kind, optLayout, declarations, name(), pos(), attrs);
+        }
+
+        @Override
+        public Scoped stripAttributes() {
+            return new ScopedImpl(kind, optLayout, declarations, name(), pos(), null);
+        }
     }
 
     public static class ConstantImpl extends DeclarationImpl implements Declaration.Constant {
 
         final Object value;
         final Type type;
 
         public ConstantImpl(Type type, Object value, String name, Position pos) {
-            this(type, value, name, pos, Collections.emptyMap());
+            this(type, value, name, pos, null);
         }
 
-        public ConstantImpl(Type type, Object value, String name, Position pos, Map<String, List<ConstantDesc>> attrs) {
+        public ConstantImpl(Type type, Object value, String name, Position pos, Map<String, List<Constable>> attrs) {
             super(name, pos, attrs);
             this.value = value;
             this.type = type;
         }
 
@@ -220,7 +245,17 @@
 
         @Override
         public Type type() {
             return type;
         }
+
+        @Override
+        public Constant withAttributes(Map<String, List<Constable>> attrs) {
+            return new ConstantImpl(type, value, name(), pos(), attrs);
+        }
+
+        @Override
+        public Constant stripAttributes() {
+            return new ConstantImpl(type, value, name(), pos(), null);
+        }
     }
 }
