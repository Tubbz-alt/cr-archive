<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.incubator.jextract/share/classes/jdk/incubator/jextract/tool/StaticWrapperSourceFactory.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="HandleSourceFactory.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>src/jdk.incubator.jextract/share/classes/jdk/incubator/jextract/tool/StaticWrapperSourceFactory.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 87                 }
 88                 default:
 89                     return getAsFunctionPointer(((Type.Delegated) type).type());
 90             }
 91         } else {
 92             return null;
 93         }
 94     }
 95 
 96     @Override
 97     public Void visitVariable(Declaration.Variable tree, Declaration parent) {
 98         if (parent == null &amp;&amp; visitedVariable(tree)) {
 99             return null;
100         }
101 
102         String fieldName = tree.name();
103         String symbol = tree.name();
104         assert !symbol.isEmpty();
105         assert !fieldName.isEmpty();
106 

107         if (parent == null) {
108             setMangledName(tree);
109             fieldName = getMangledName(tree);
110         }
111 
112         Type type = tree.type();
113         MemoryLayout layout = tree.layout().orElse(Type.layoutFor(type).orElse(null));
114         if (layout == null) {
115             //no layout - abort
116             return null;
117         }
118         Class&lt;?&gt; clazz = typeTranslator.getJavaType(type);
119         if (tree.kind() == Declaration.Variable.Kind.BITFIELD || clazz == MemoryAddress.class ||
120                 clazz == MemorySegment.class || layout.byteSize() &gt; 8) {
121             //skip
122             return null;
123         }
124 
125         String parentName = parent != null? getMangledName(parent) : null;
126         if (parent != null) {
</pre>
</td>
<td>
<hr />
<pre>
 87                 }
 88                 default:
 89                     return getAsFunctionPointer(((Type.Delegated) type).type());
 90             }
 91         } else {
 92             return null;
 93         }
 94     }
 95 
 96     @Override
 97     public Void visitVariable(Declaration.Variable tree, Declaration parent) {
 98         if (parent == null &amp;&amp; visitedVariable(tree)) {
 99             return null;
100         }
101 
102         String fieldName = tree.name();
103         String symbol = tree.name();
104         assert !symbol.isEmpty();
105         assert !fieldName.isEmpty();
106 
<span class="line-added">107         // FIXME: we need tree transformer. The mangling should be a separate tree transform phase</span>
108         if (parent == null) {
109             setMangledName(tree);
110             fieldName = getMangledName(tree);
111         }
112 
113         Type type = tree.type();
114         MemoryLayout layout = tree.layout().orElse(Type.layoutFor(type).orElse(null));
115         if (layout == null) {
116             //no layout - abort
117             return null;
118         }
119         Class&lt;?&gt; clazz = typeTranslator.getJavaType(type);
120         if (tree.kind() == Declaration.Variable.Kind.BITFIELD || clazz == MemoryAddress.class ||
121                 clazz == MemorySegment.class || layout.byteSize() &gt; 8) {
122             //skip
123             return null;
124         }
125 
126         String parentName = parent != null? getMangledName(parent) : null;
127         if (parent != null) {
</pre>
</td>
</tr>
</table>
<center><a href="HandleSourceFactory.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>