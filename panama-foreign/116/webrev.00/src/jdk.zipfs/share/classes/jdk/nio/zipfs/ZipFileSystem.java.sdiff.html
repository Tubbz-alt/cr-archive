<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.zipfs/share/classes/jdk/nio/zipfs/ZipFileSystem.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ByteArrayChannel.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/failure_handler/src/share/conf/linux.properties.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.zipfs/share/classes/jdk/nio/zipfs/ZipFileSystem.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 875     // Note: The content of the channel is not compressed until the
 876     // channel is closed
 877     private class EntryOutputChannel extends ByteArrayChannel {
 878         final Entry e;
 879 
 880         EntryOutputChannel(Entry e) {
 881             super(e.size &gt; 0? (int)e.size : 8192, false);
 882             this.e = e;
 883             if (e.mtime == -1)
 884                 e.mtime = System.currentTimeMillis();
 885             if (e.method == -1)
 886                 e.method = defaultCompressionMethod;
 887             // store size, compressed size, and crc-32 in datadescriptor
 888             e.flag = FLAG_DATADESCR;
 889             if (zc.isUTF8())
 890                 e.flag |= FLAG_USE_UTF8;
 891         }
 892 
 893         @Override
 894         public void close() throws IOException {
<span class="line-modified"> 895             // will update the entry</span>
<span class="line-modified"> 896             try (OutputStream os = getOutputStream(e)) {</span>
<span class="line-modified"> 897                 os.write(toByteArray());</span>








 898             }
<span class="line-removed"> 899             super.close();</span>
 900         }
 901     }
 902 
 903     // Returns a Writable/ReadByteChannel for now. Might consider to use
 904     // newFileChannel() instead, which dump the entry data into a regular
 905     // file on the default file system and create a FileChannel on top of it.
 906     SeekableByteChannel newByteChannel(byte[] path,
 907                                        Set&lt;? extends OpenOption&gt; options,
 908                                        FileAttribute&lt;?&gt;... attrs)
 909         throws IOException
 910     {
 911         checkOptions(options);
 912         if (options.contains(StandardOpenOption.WRITE) ||
 913             options.contains(StandardOpenOption.APPEND)) {
 914             checkWritable();
 915             beginRead();    // only need a read lock, the &quot;update()&quot; will obtain
 916                             // the write lock when the channel is closed
 917             ensureOpen();
 918             try {
 919                 Entry e = getEntry(path);
</pre>
</td>
<td>
<hr />
<pre>
 875     // Note: The content of the channel is not compressed until the
 876     // channel is closed
 877     private class EntryOutputChannel extends ByteArrayChannel {
 878         final Entry e;
 879 
 880         EntryOutputChannel(Entry e) {
 881             super(e.size &gt; 0? (int)e.size : 8192, false);
 882             this.e = e;
 883             if (e.mtime == -1)
 884                 e.mtime = System.currentTimeMillis();
 885             if (e.method == -1)
 886                 e.method = defaultCompressionMethod;
 887             // store size, compressed size, and crc-32 in datadescriptor
 888             e.flag = FLAG_DATADESCR;
 889             if (zc.isUTF8())
 890                 e.flag |= FLAG_USE_UTF8;
 891         }
 892 
 893         @Override
 894         public void close() throws IOException {
<span class="line-modified"> 895             super.beginWrite();</span>
<span class="line-modified"> 896             try {</span>
<span class="line-modified"> 897                 if (!isOpen())</span>
<span class="line-added"> 898                     return;</span>
<span class="line-added"> 899                 // will update the entry</span>
<span class="line-added"> 900                 try (OutputStream os = getOutputStream(e)) {</span>
<span class="line-added"> 901                     os.write(toByteArray());</span>
<span class="line-added"> 902                 }</span>
<span class="line-added"> 903                 super.close();</span>
<span class="line-added"> 904             } finally {</span>
<span class="line-added"> 905                 super.endWrite();</span>
 906             }

 907         }
 908     }
 909 
 910     // Returns a Writable/ReadByteChannel for now. Might consider to use
 911     // newFileChannel() instead, which dump the entry data into a regular
 912     // file on the default file system and create a FileChannel on top of it.
 913     SeekableByteChannel newByteChannel(byte[] path,
 914                                        Set&lt;? extends OpenOption&gt; options,
 915                                        FileAttribute&lt;?&gt;... attrs)
 916         throws IOException
 917     {
 918         checkOptions(options);
 919         if (options.contains(StandardOpenOption.WRITE) ||
 920             options.contains(StandardOpenOption.APPEND)) {
 921             checkWritable();
 922             beginRead();    // only need a read lock, the &quot;update()&quot; will obtain
 923                             // the write lock when the channel is closed
 924             ensureOpen();
 925             try {
 926                 Entry e = getEntry(path);
</pre>
</td>
</tr>
</table>
<center><a href="ByteArrayChannel.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/failure_handler/src/share/conf/linux.properties.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>