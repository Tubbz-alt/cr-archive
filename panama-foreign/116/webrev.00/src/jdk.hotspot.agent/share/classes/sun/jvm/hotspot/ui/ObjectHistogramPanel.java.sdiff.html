<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/ui/ObjectHistogramPanel.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JavaThreadsPanel.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ObjectListPanel.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/ui/ObjectHistogramPanel.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2002, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
</pre>
<hr />
<pre>
 42 import sun.jvm.hotspot.ui.table.SortHeaderMouseAdapter;
 43 import sun.jvm.hotspot.ui.table.TableModelComparator;
 44 
 45 import sun.jvm.hotspot.ui.action.*;
 46 
 47 import com.sun.java.swing.ui.StatusBar;
 48 import com.sun.java.swing.ui.CommonToolBar;
 49 
 50 import com.sun.java.swing.action.ActionManager;
 51 import com.sun.java.swing.action.DelegateAction;
 52 
 53 /**
 54  * Displays the results of an ObjectHistogram run in a JTable, with a
 55  * button to display all objects of that type
 56  */
 57 public class ObjectHistogramPanel extends JPanel implements ActionListener {
 58     private ObjectHistogramTableModel dataModel;
 59     private ObjectHistogramToolBar toolbar;
 60     private StatusBar statusBar;
 61     private JTable     table;
<span class="line-modified"> 62     private java.util.List listeners;</span>
 63 
 64     public ObjectHistogramPanel(ObjectHistogram histo) {
 65         dataModel = new ObjectHistogramTableModel(histo);
 66         statusBar = new StatusBar();
 67 
 68         table = new JTable(dataModel, new ObjectHistogramColummModel());
 69         table.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
 70         table.addMouseListener(new MouseAdapter() {
 71                 public void mouseClicked(MouseEvent evt) {
 72                     if (evt.getClickCount() == 2) {
 73                         fireShowObjectsOfType();
 74                     }
 75                 }
 76             });
 77 
 78         JTableHeader header = table.getTableHeader();
 79         header.setDefaultRenderer(new SortHeaderCellRenderer(header, dataModel));
 80         header.addMouseListener(new SortHeaderMouseAdapter(table, dataModel));
 81 
 82         setLayout(new BorderLayout());
</pre>
<hr />
<pre>
178         public int getRowCount() {
179             return elements.size();
180         }
181 
182         public String getColumnName(int col) {
183             return columnNames[col];
184         }
185 
186         public Class getColumnClass(int col) {
187             return columnClasses[col];
188         }
189 
190         public Object getValueAt(int row, int col) {
191             return getValueForColumn(getElement(row), col);
192         }
193 
194         public Object getValueForColumn(Object obj, int col) {
195             ObjectHistogramElement el = (ObjectHistogramElement)obj;
196             switch (col) {
197             case 0:
<span class="line-modified">198                 return new Long(el.getSize());</span>
199             case 1:
<span class="line-modified">200                 return new Long(el.getCount());</span>
201             case 2:
202                 return el.getDescription();
203             default:
204                 throw new RuntimeException(&quot;Index (&quot; + col + &quot;) out of bounds&quot;);
205             }
206         }
207 
208         public ObjectHistogramElement getElement(int index) {
209             return (ObjectHistogramElement) elements.get(index);
210         }
211 
212         private class ObjectHistogramComparator extends TableModelComparator {
213 
214             public ObjectHistogramComparator(ObjectHistogramTableModel model) {
215                 super(model);
216             }
217 
218             /**
219              * Returns the value for the comparing object for the
220              * column.
</pre>
<hr />
<pre>
246 
247     }
248 
249     protected void registerActions() {
250         registerAction(FindAction.VALUE_COMMAND);
251         registerAction(ShowAction.VALUE_COMMAND);
252     }
253 
254     private void registerAction(String actionName) {
255         ActionManager manager = ActionManager.getInstance();
256         DelegateAction action = manager.getDelegateAction(actionName);
257         action.addActionListener(this);
258     }
259 
260     public interface Listener {
261         public void showObjectsOfType(Klass type);
262     }
263 
264     public void addPanelListener(Listener listener) {
265         if (listeners == null) {
<span class="line-modified">266             listeners = new ArrayList();</span>
267         }
268         listeners.add(listener);
269     }
270 
271     public void removePanelListener(Listener listener) {
272         if (listeners != null) {
273             listeners.remove(listener);
274         }
275     }
276 
277     //--------------------------------------------------------------------------------
278     // Internals only below this point
279     //
280 
281     /**
282      * Find and select the row that contains the text in the find field starting
283      * from the current selected row.
284      *
285      * Uses a linear search from the current row. Could be optimized withing the
286      * model and internal representation.
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
</pre>
<hr />
<pre>
 42 import sun.jvm.hotspot.ui.table.SortHeaderMouseAdapter;
 43 import sun.jvm.hotspot.ui.table.TableModelComparator;
 44 
 45 import sun.jvm.hotspot.ui.action.*;
 46 
 47 import com.sun.java.swing.ui.StatusBar;
 48 import com.sun.java.swing.ui.CommonToolBar;
 49 
 50 import com.sun.java.swing.action.ActionManager;
 51 import com.sun.java.swing.action.DelegateAction;
 52 
 53 /**
 54  * Displays the results of an ObjectHistogram run in a JTable, with a
 55  * button to display all objects of that type
 56  */
 57 public class ObjectHistogramPanel extends JPanel implements ActionListener {
 58     private ObjectHistogramTableModel dataModel;
 59     private ObjectHistogramToolBar toolbar;
 60     private StatusBar statusBar;
 61     private JTable     table;
<span class="line-modified"> 62     private java.util.List&lt;Listener&gt; listeners;</span>
 63 
 64     public ObjectHistogramPanel(ObjectHistogram histo) {
 65         dataModel = new ObjectHistogramTableModel(histo);
 66         statusBar = new StatusBar();
 67 
 68         table = new JTable(dataModel, new ObjectHistogramColummModel());
 69         table.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
 70         table.addMouseListener(new MouseAdapter() {
 71                 public void mouseClicked(MouseEvent evt) {
 72                     if (evt.getClickCount() == 2) {
 73                         fireShowObjectsOfType();
 74                     }
 75                 }
 76             });
 77 
 78         JTableHeader header = table.getTableHeader();
 79         header.setDefaultRenderer(new SortHeaderCellRenderer(header, dataModel));
 80         header.addMouseListener(new SortHeaderMouseAdapter(table, dataModel));
 81 
 82         setLayout(new BorderLayout());
</pre>
<hr />
<pre>
178         public int getRowCount() {
179             return elements.size();
180         }
181 
182         public String getColumnName(int col) {
183             return columnNames[col];
184         }
185 
186         public Class getColumnClass(int col) {
187             return columnClasses[col];
188         }
189 
190         public Object getValueAt(int row, int col) {
191             return getValueForColumn(getElement(row), col);
192         }
193 
194         public Object getValueForColumn(Object obj, int col) {
195             ObjectHistogramElement el = (ObjectHistogramElement)obj;
196             switch (col) {
197             case 0:
<span class="line-modified">198                 return el.getSize();</span>
199             case 1:
<span class="line-modified">200                 return el.getCount();</span>
201             case 2:
202                 return el.getDescription();
203             default:
204                 throw new RuntimeException(&quot;Index (&quot; + col + &quot;) out of bounds&quot;);
205             }
206         }
207 
208         public ObjectHistogramElement getElement(int index) {
209             return (ObjectHistogramElement) elements.get(index);
210         }
211 
212         private class ObjectHistogramComparator extends TableModelComparator {
213 
214             public ObjectHistogramComparator(ObjectHistogramTableModel model) {
215                 super(model);
216             }
217 
218             /**
219              * Returns the value for the comparing object for the
220              * column.
</pre>
<hr />
<pre>
246 
247     }
248 
249     protected void registerActions() {
250         registerAction(FindAction.VALUE_COMMAND);
251         registerAction(ShowAction.VALUE_COMMAND);
252     }
253 
254     private void registerAction(String actionName) {
255         ActionManager manager = ActionManager.getInstance();
256         DelegateAction action = manager.getDelegateAction(actionName);
257         action.addActionListener(this);
258     }
259 
260     public interface Listener {
261         public void showObjectsOfType(Klass type);
262     }
263 
264     public void addPanelListener(Listener listener) {
265         if (listeners == null) {
<span class="line-modified">266             listeners = new ArrayList&lt;&gt;();</span>
267         }
268         listeners.add(listener);
269     }
270 
271     public void removePanelListener(Listener listener) {
272         if (listeners != null) {
273             listeners.remove(listener);
274         }
275     }
276 
277     //--------------------------------------------------------------------------------
278     // Internals only below this point
279     //
280 
281     /**
282      * Find and select the row that contains the text in the find field starting
283      * from the current selected row.
284      *
285      * Uses a linear search from the current row. Could be optimized withing the
286      * model and internal representation.
</pre>
</td>
</tr>
</table>
<center><a href="JavaThreadsPanel.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ObjectListPanel.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>