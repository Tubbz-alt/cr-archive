<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/oops/GenerateOopMap.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ExceptionTableElement.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Instance.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/oops/GenerateOopMap.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2001, 2012, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2001, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 166,35 ***</span>
    /** Contains maping between jsr targets and there return addresses.
        One-to-many mapping. */
    static class RetTableEntry {
      private static int _init_nof_jsrs; // Default size of jsrs list
      private int _target_bci;           // Target PC address of jump (bytecode index)
<span class="line-modified">!     private List/*&lt;int&gt;*/ _jsrs;       // List of return addresses  (bytecode index)</span>
      private RetTableEntry _next;       // Link to next entry
  
      RetTableEntry(int target, RetTableEntry next) {
        _target_bci = target;
<span class="line-modified">!       _jsrs = new ArrayList(_init_nof_jsrs);</span>
        _next = next;
      }
  
      // Query
      int targetBci()  { return _target_bci; }
      int nofJsrs()    { return _jsrs.size(); }
<span class="line-modified">!     int jsrs(int i)  { return ((Integer) _jsrs.get(i)).intValue(); }</span>
  
      // Update entry
<span class="line-modified">!     void addJsr  (int return_bci)     { _jsrs.add(new Integer(return_bci)); }</span>
      void addDelta(int bci, int delta) {
        if (_target_bci &gt; bci) {
          _target_bci += delta;
        }
  
        for (int k = 0; k &lt; nofJsrs(); k++) {
          int jsr = jsrs(k);
          if (jsr &gt; bci) {
<span class="line-modified">!           _jsrs.set(k, new Integer(jsr+delta));</span>
          }
        }
      }
      RetTableEntry next()               { return _next; }
    }
<span class="line-new-header">--- 166,35 ---</span>
    /** Contains maping between jsr targets and there return addresses.
        One-to-many mapping. */
    static class RetTableEntry {
      private static int _init_nof_jsrs; // Default size of jsrs list
      private int _target_bci;           // Target PC address of jump (bytecode index)
<span class="line-modified">!     private List&lt;Integer&gt; _jsrs;       // List of return addresses  (bytecode index)</span>
      private RetTableEntry _next;       // Link to next entry
  
      RetTableEntry(int target, RetTableEntry next) {
        _target_bci = target;
<span class="line-modified">!       _jsrs = new ArrayList&lt;&gt;(_init_nof_jsrs);</span>
        _next = next;
      }
  
      // Query
      int targetBci()  { return _target_bci; }
      int nofJsrs()    { return _jsrs.size(); }
<span class="line-modified">!     int jsrs(int i)  { return _jsrs.get(i).intValue(); }</span>
  
      // Update entry
<span class="line-modified">!     void addJsr  (int return_bci)     { _jsrs.add(return_bci); }</span>
      void addDelta(int bci, int delta) {
        if (_target_bci &gt; bci) {
          _target_bci += delta;
        }
  
        for (int k = 0; k &lt; nofJsrs(); k++) {
          int jsr = jsrs(k);
          if (jsr &gt; bci) {
<span class="line-modified">!           _jsrs.set(k, jsr + delta);</span>
          }
        }
      }
      RetTableEntry next()               { return _next; }
    }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1924,22 ***</span>
  
      _report_result = false;
    }
  
    // Initvars
<span class="line-modified">!   List/*&lt;Integer&gt;*/ _init_vars;</span>
  
    void  initializeVars                      () {
      for (int k = 0; k &lt; _init_vars.size(); k++)
<span class="line-modified">!       _state.get(((Integer) _init_vars.get(k)).intValue()).set(CellTypeState.makeSlotRef(k));</span>
    }
  
    void  addToRefInitSet                     (int localNo) {
      //    if (TraceNewOopMapGeneration)
      //      tty.print_cr(&quot;Added init vars: %d&quot;, localNo);
  
<span class="line-modified">!     Integer local = new Integer(localNo);</span>
  
      // Is it already in the set?
      if (_init_vars.contains(local))
        return;
  
<span class="line-new-header">--- 1924,22 ---</span>
  
      _report_result = false;
    }
  
    // Initvars
<span class="line-modified">!   List&lt;Integer&gt; _init_vars;</span>
  
    void  initializeVars                      () {
      for (int k = 0; k &lt; _init_vars.size(); k++)
<span class="line-modified">!       _state.get((_init_vars.get(k)).intValue()).set(CellTypeState.makeSlotRef(k));</span>
    }
  
    void  addToRefInitSet                     (int localNo) {
      //    if (TraceNewOopMapGeneration)
      //      tty.print_cr(&quot;Added init vars: %d&quot;, localNo);
  
<span class="line-modified">!     Integer local = localNo;</span>
  
      // Is it already in the set?
      if (_init_vars.contains(local))
        return;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2153,11 ***</span>
      _conflict       = false;
      _max_locals     = (int) method().getMaxLocals();
      _max_stack      = (int) method().getMaxStack();
      _has_exceptions = (method().hasExceptionTable());
      _nof_refval_conflicts = 0;
<span class="line-modified">!     _init_vars      = new ArrayList(5);  // There are seldom more than 5 init_vars</span>
      _report_result  = false;
      _report_result_for_send = false;
      _report_for_exit_bci = -1;
      _new_var_map    = null;
      //    _ret_adr_tos    = new GrowableArray&lt;intptr_t&gt;(5);  // 5 seems like a good number;
<span class="line-new-header">--- 2153,11 ---</span>
      _conflict       = false;
      _max_locals     = (int) method().getMaxLocals();
      _max_stack      = (int) method().getMaxStack();
      _has_exceptions = (method().hasExceptionTable());
      _nof_refval_conflicts = 0;
<span class="line-modified">!     _init_vars      = new ArrayList&lt;&gt;(5);  // There are seldom more than 5 init_vars</span>
      _report_result  = false;
      _report_result_for_send = false;
      _report_for_exit_bci = -1;
      _new_var_map    = null;
      //    _ret_adr_tos    = new GrowableArray&lt;intptr_t&gt;(5);  // 5 seems like a good number;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2312,7 ***</span>
    public void fillStackmapEpilog          ()                              { throw new RuntimeException(&quot;ShouldNotReachHere&quot;); }
    public void fillStackmapForOpcodes      (BytecodeStream bcs,
                                             CellTypeStateList vars,
                                             CellTypeStateList stack,
                                             int stackTop)                  { throw new RuntimeException(&quot;ShouldNotReachHere&quot;); }
<span class="line-modified">!   public void fillInitVars                (List/*&lt;Integer&gt;*/ init_vars)   { throw new RuntimeException(&quot;ShouldNotReachHere&quot;); }</span>
  }
<span class="line-new-header">--- 2312,7 ---</span>
    public void fillStackmapEpilog          ()                              { throw new RuntimeException(&quot;ShouldNotReachHere&quot;); }
    public void fillStackmapForOpcodes      (BytecodeStream bcs,
                                             CellTypeStateList vars,
                                             CellTypeStateList stack,
                                             int stackTop)                  { throw new RuntimeException(&quot;ShouldNotReachHere&quot;); }
<span class="line-modified">!   public void fillInitVars                (List&lt;Integer&gt; init_vars)       { throw new RuntimeException(&quot;ShouldNotReachHere&quot;); }</span>
  }
</pre>
<center><a href="ExceptionTableElement.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Instance.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>