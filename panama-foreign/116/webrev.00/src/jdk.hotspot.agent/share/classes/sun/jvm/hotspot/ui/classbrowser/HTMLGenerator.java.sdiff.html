<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/ui/classbrowser/HTMLGenerator.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../action/ThreadInfoAction.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../tree/CTypeTreeNodeAdapter.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/ui/classbrowser/HTMLGenerator.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2002, 2017, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  *
</pre>
<hr />
<pre>
1050     protected void genScope(Formatter buf, Formatter tabs, ScopeDesc sd) {
1051         if (sd == null) {
1052             return;
1053         }
1054 
1055         genScope(buf, tabs, sd.sender());
1056 
1057         buf.append(tabs);
1058         Method m = sd.getMethod();
1059         buf.append(genMethodAndKlassLink(m));
1060         int bci = sd.getBCI();
1061         buf.append(&quot; @ bci = &quot;);
1062         buf.append(Integer.toString(bci));
1063 
1064         int line = m.getLineNumberFromBCI(bci);
1065         if (line != -1) {
1066             buf.append(&quot;, line = &quot;);
1067             buf.append(Integer.toString(line));
1068         }
1069 
<span class="line-modified">1070         List locals = sd.getLocals();</span>
1071         if (locals != null) {
1072             buf.br();
1073             buf.append(tabs);
1074             buf.append(genHTMLForLocals(sd, locals));
1075         }
1076 
<span class="line-modified">1077         List expressions = sd.getExpressions();</span>
1078         if (expressions != null) {
1079             buf.br();
1080             buf.append(tabs);
1081             buf.append(genHTMLForExpressions(sd, expressions));
1082         }
1083 
<span class="line-modified">1084         List monitors = sd.getMonitors();</span>
1085         if (monitors != null) {
1086             buf.br();
1087             buf.append(tabs);
1088             buf.append(genHTMLForMonitors(sd, monitors));
1089         }
1090 
1091         buf.br();
1092         tabs.append(tab);
1093     }
1094 
1095     protected void genScObjInfo(Formatter buf, Formatter tabs, ScopeDesc sd) {
1096         if (sd == null) {
1097             return;
1098         }
1099 
<span class="line-modified">1100         List objects = sd.getObjects();</span>
1101         if (objects == null) {
1102             return;
1103         }
1104         int length = objects.size();
1105         for (int i = 0; i &lt; length; i++) {
1106             buf.append(tabs);
<span class="line-modified">1107             ObjectValue ov = (ObjectValue)objects.get(i);</span>
1108             buf.append(&quot;ScObj&quot; + i);
1109             ScopeValue sv = ov.getKlass();
1110             if (Assert.ASSERTS_ENABLED) {
1111                 Assert.that(sv.isConstantOop(), &quot;scalar replaced object klass must be constant oop&quot;);
1112             }
1113             ConstantOopReadValue klv = (ConstantOopReadValue)sv;
1114             OopHandle klHandle = klv.getValue();
1115             if (Assert.ASSERTS_ENABLED) {
1116                 Assert.that(klHandle != null, &quot;scalar replaced object klass must be not NULL&quot;);
1117             }
1118             Oop obj = VM.getVM().getObjectHeap().newOop(klHandle);
1119             // Obj is a Java mirror
1120             Klass klass = java_lang_Class.asKlass(obj);
1121             if (klass instanceof InstanceKlass) {
1122                 InstanceKlass kls = (InstanceKlass) klass;
1123                 buf.append(&quot; &quot; + kls.getName().asString() + &quot;={&quot;);
1124                 int flen = ov.fieldsSize();
1125 
1126                 U2Array klfields = kls.getFields();
1127                 int klen = (int) klfields.length();
</pre>
<hr />
<pre>
1335          } else {
1336             buf.append(&quot;null&quot;);
1337          }
1338       } else if (sv.isLocation()) {
1339          LocationValue lvalue = (LocationValue) sv;
1340          Location loc = lvalue.getLocation();
1341          if (loc != null) {
1342             buf.append(locationAsString(loc));
1343          } else {
1344             buf.append(&quot;null&quot;);
1345          }
1346       } else if (sv.isObject()) {
1347          ObjectValue ov = (ObjectValue)sv;
1348          buf.append(&quot;#ScObj&quot; + sd.getObjects().indexOf(ov));
1349       } else {
1350          buf.append(&quot;unknown scope value &quot; + sv);
1351       }
1352       return buf.toString();
1353    }
1354 
<span class="line-modified">1355    protected String genHTMLForScopeValues(ScopeDesc sd, boolean locals, List values) {</span>
1356       int length = values.size();
1357       Formatter buf = new Formatter(genHTML);
1358       buf.append(locals? &quot;locals &quot; : &quot;expressions &quot;);
1359       for (int i = 0; i &lt; length; i++) {
<span class="line-modified">1360          ScopeValue sv = (ScopeValue) values.get(i);</span>
1361          if (sv == null) {
1362             continue;
1363          }
1364          buf.append(&#39;(&#39;);
1365          if (locals) {
1366             Symbol name = sd.getMethod().getLocalVariableName(sd.getBCI(), i);
1367             if (name != null) {
1368                buf.append(&quot;&#39;&quot;);
1369                buf.append(name.asString());
1370                buf.append(&#39;\&#39;&#39;);
1371             } else {
1372                buf.append(&quot;[&quot;);
1373                buf.append(Integer.toString(i));
1374                buf.append(&#39;]&#39;);
1375             }
1376          } else {
1377             buf.append(&quot;[&quot;);
1378             buf.append(Integer.toString(i));
1379             buf.append(&#39;]&#39;);
1380          }
1381 
1382          buf.append(&quot;, &quot;);
1383          buf.append(scopeValueAsString(sd, sv));
1384          buf.append(&quot;) &quot;);
1385       }
1386 
1387       return buf.toString();
1388    }
1389 
<span class="line-modified">1390    protected String genHTMLForLocals(ScopeDesc sd, List locals) {</span>
1391       return genHTMLForScopeValues(sd, true, locals);
1392    }
1393 
<span class="line-modified">1394    protected String genHTMLForExpressions(ScopeDesc sd, List expressions) {</span>
1395       return genHTMLForScopeValues(sd, false, expressions);
1396    }
1397 
<span class="line-modified">1398    protected String genHTMLForMonitors(ScopeDesc sd, List monitors) {</span>
1399       int length = monitors.size();
1400       Formatter buf = new Formatter(genHTML);
1401       buf.append(&quot;monitors &quot;);
1402       for (int i = 0; i &lt; length; i++) {
<span class="line-modified">1403          MonitorValue mv = (MonitorValue) monitors.get(i);</span>
1404          if (mv == null) {
1405             continue;
1406          }
1407          buf.append(&quot;(owner = &quot;);
1408          ScopeValue owner = mv.owner();
1409          if (owner != null) {
1410             buf.append(scopeValueAsString(sd, owner));
1411          } else {
1412             buf.append(&quot;null&quot;);
1413          }
1414          buf.append(&quot;, lock = &quot;);
1415 
1416          Location loc = mv.basicLock();
1417          if (loc != null) {
1418             buf.append(locationAsString(loc));
1419          } else {
1420             buf.append(&quot;null&quot;);
1421          }
1422          buf.append(&quot;) &quot;);
1423       }
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2002, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  *
</pre>
<hr />
<pre>
1050     protected void genScope(Formatter buf, Formatter tabs, ScopeDesc sd) {
1051         if (sd == null) {
1052             return;
1053         }
1054 
1055         genScope(buf, tabs, sd.sender());
1056 
1057         buf.append(tabs);
1058         Method m = sd.getMethod();
1059         buf.append(genMethodAndKlassLink(m));
1060         int bci = sd.getBCI();
1061         buf.append(&quot; @ bci = &quot;);
1062         buf.append(Integer.toString(bci));
1063 
1064         int line = m.getLineNumberFromBCI(bci);
1065         if (line != -1) {
1066             buf.append(&quot;, line = &quot;);
1067             buf.append(Integer.toString(line));
1068         }
1069 
<span class="line-modified">1070         List&lt;ScopeValue&gt; locals = sd.getLocals();</span>
1071         if (locals != null) {
1072             buf.br();
1073             buf.append(tabs);
1074             buf.append(genHTMLForLocals(sd, locals));
1075         }
1076 
<span class="line-modified">1077         List&lt;ScopeValue&gt; expressions = sd.getExpressions();</span>
1078         if (expressions != null) {
1079             buf.br();
1080             buf.append(tabs);
1081             buf.append(genHTMLForExpressions(sd, expressions));
1082         }
1083 
<span class="line-modified">1084         List&lt;MonitorValue&gt; monitors = sd.getMonitors();</span>
1085         if (monitors != null) {
1086             buf.br();
1087             buf.append(tabs);
1088             buf.append(genHTMLForMonitors(sd, monitors));
1089         }
1090 
1091         buf.br();
1092         tabs.append(tab);
1093     }
1094 
1095     protected void genScObjInfo(Formatter buf, Formatter tabs, ScopeDesc sd) {
1096         if (sd == null) {
1097             return;
1098         }
1099 
<span class="line-modified">1100         List&lt;ObjectValue&gt; objects = sd.getObjects();</span>
1101         if (objects == null) {
1102             return;
1103         }
1104         int length = objects.size();
1105         for (int i = 0; i &lt; length; i++) {
1106             buf.append(tabs);
<span class="line-modified">1107             ObjectValue ov = objects.get(i);</span>
1108             buf.append(&quot;ScObj&quot; + i);
1109             ScopeValue sv = ov.getKlass();
1110             if (Assert.ASSERTS_ENABLED) {
1111                 Assert.that(sv.isConstantOop(), &quot;scalar replaced object klass must be constant oop&quot;);
1112             }
1113             ConstantOopReadValue klv = (ConstantOopReadValue)sv;
1114             OopHandle klHandle = klv.getValue();
1115             if (Assert.ASSERTS_ENABLED) {
1116                 Assert.that(klHandle != null, &quot;scalar replaced object klass must be not NULL&quot;);
1117             }
1118             Oop obj = VM.getVM().getObjectHeap().newOop(klHandle);
1119             // Obj is a Java mirror
1120             Klass klass = java_lang_Class.asKlass(obj);
1121             if (klass instanceof InstanceKlass) {
1122                 InstanceKlass kls = (InstanceKlass) klass;
1123                 buf.append(&quot; &quot; + kls.getName().asString() + &quot;={&quot;);
1124                 int flen = ov.fieldsSize();
1125 
1126                 U2Array klfields = kls.getFields();
1127                 int klen = (int) klfields.length();
</pre>
<hr />
<pre>
1335          } else {
1336             buf.append(&quot;null&quot;);
1337          }
1338       } else if (sv.isLocation()) {
1339          LocationValue lvalue = (LocationValue) sv;
1340          Location loc = lvalue.getLocation();
1341          if (loc != null) {
1342             buf.append(locationAsString(loc));
1343          } else {
1344             buf.append(&quot;null&quot;);
1345          }
1346       } else if (sv.isObject()) {
1347          ObjectValue ov = (ObjectValue)sv;
1348          buf.append(&quot;#ScObj&quot; + sd.getObjects().indexOf(ov));
1349       } else {
1350          buf.append(&quot;unknown scope value &quot; + sv);
1351       }
1352       return buf.toString();
1353    }
1354 
<span class="line-modified">1355    protected String genHTMLForScopeValues(ScopeDesc sd, boolean locals, List&lt;ScopeValue&gt; values) {</span>
1356       int length = values.size();
1357       Formatter buf = new Formatter(genHTML);
1358       buf.append(locals? &quot;locals &quot; : &quot;expressions &quot;);
1359       for (int i = 0; i &lt; length; i++) {
<span class="line-modified">1360          ScopeValue sv = values.get(i);</span>
1361          if (sv == null) {
1362             continue;
1363          }
1364          buf.append(&#39;(&#39;);
1365          if (locals) {
1366             Symbol name = sd.getMethod().getLocalVariableName(sd.getBCI(), i);
1367             if (name != null) {
1368                buf.append(&quot;&#39;&quot;);
1369                buf.append(name.asString());
1370                buf.append(&#39;\&#39;&#39;);
1371             } else {
1372                buf.append(&quot;[&quot;);
1373                buf.append(Integer.toString(i));
1374                buf.append(&#39;]&#39;);
1375             }
1376          } else {
1377             buf.append(&quot;[&quot;);
1378             buf.append(Integer.toString(i));
1379             buf.append(&#39;]&#39;);
1380          }
1381 
1382          buf.append(&quot;, &quot;);
1383          buf.append(scopeValueAsString(sd, sv));
1384          buf.append(&quot;) &quot;);
1385       }
1386 
1387       return buf.toString();
1388    }
1389 
<span class="line-modified">1390    protected String genHTMLForLocals(ScopeDesc sd, List&lt;ScopeValue&gt; locals) {</span>
1391       return genHTMLForScopeValues(sd, true, locals);
1392    }
1393 
<span class="line-modified">1394    protected String genHTMLForExpressions(ScopeDesc sd, List&lt;ScopeValue&gt; expressions) {</span>
1395       return genHTMLForScopeValues(sd, false, expressions);
1396    }
1397 
<span class="line-modified">1398    protected String genHTMLForMonitors(ScopeDesc sd, List&lt;MonitorValue&gt; monitors) {</span>
1399       int length = monitors.size();
1400       Formatter buf = new Formatter(genHTML);
1401       buf.append(&quot;monitors &quot;);
1402       for (int i = 0; i &lt; length; i++) {
<span class="line-modified">1403          MonitorValue mv = monitors.get(i);</span>
1404          if (mv == null) {
1405             continue;
1406          }
1407          buf.append(&quot;(owner = &quot;);
1408          ScopeValue owner = mv.owner();
1409          if (owner != null) {
1410             buf.append(scopeValueAsString(sd, owner));
1411          } else {
1412             buf.append(&quot;null&quot;);
1413          }
1414          buf.append(&quot;, lock = &quot;);
1415 
1416          Location loc = mv.basicLock();
1417          if (loc != null) {
1418             buf.append(locationAsString(loc));
1419          } else {
1420             buf.append(&quot;null&quot;);
1421          }
1422          buf.append(&quot;) &quot;);
1423       }
</pre>
</td>
</tr>
</table>
<center><a href="../action/ThreadInfoAction.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../tree/CTypeTreeNodeAdapter.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>