<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/code/StubQueue.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SingletonBlob.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="UncommonTrapBlob.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/code/StubQueue.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2002, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 package sun.jvm.hotspot.code;
 26 
 27 import java.util.*;
 28 import sun.jvm.hotspot.debugger.*;
 29 import sun.jvm.hotspot.runtime.*;
 30 import sun.jvm.hotspot.types.*;
 31 import sun.jvm.hotspot.utilities.*;


 32 
 33 /** &lt;P&gt; A port of the VM&#39;s StubQueue. Note that the VM implicitly
 34     knows the type of the objects contained in each StubQueue because
 35     it passes in an instance of a StubInterface to the StubQueue&#39;s
 36     constructor; the goal in the VM was to save space in the generated
 37     code. In the SA APIs the pattern has been to use the
 38     VirtualConstructor mechanism to instantiate wrapper objects of the
 39     appropriate type for objects down in the VM; see, for example, the
 40     CodeCache, which identifies NMethods, RuntimeStubs, etc. &lt;/P&gt;
 41 
 42     &lt;P&gt; In this port we eliminate the StubInterface in favor of
 43     passing in the class corresponding to the type of Stub which this
 44     StubQueue contains. &lt;/P&gt; */
 45 
 46 public class StubQueue extends VMObject {
 47   // FIXME: add the rest of the fields
 48   private static AddressField  stubBufferField;
 49   private static CIntegerField bufferLimitField;
 50   private static CIntegerField queueBeginField;
 51   private static CIntegerField queueEndField;
 52   private static CIntegerField numberOfStubsField;
 53 
 54   // The type of the contained stubs (i.e., InterpreterCodelet,
 55   // ICStub). Must be a subclass of type Stub.
<span class="line-modified"> 56   private Class stubType;</span>
 57 
 58   static {
 59     VM.registerVMInitializedObserver(new Observer() {
 60         public void update(Observable o, Object data) {
 61           initialize(VM.getVM().getTypeDataBase());
 62         }
 63       });
 64   }
 65 
 66   private static synchronized void initialize(TypeDataBase db) {
 67     Type type = db.lookupType(&quot;StubQueue&quot;);
 68 
 69     stubBufferField    = type.getAddressField(&quot;_stub_buffer&quot;);
 70     bufferLimitField   = type.getCIntegerField(&quot;_buffer_limit&quot;);
 71     queueBeginField    = type.getCIntegerField(&quot;_queue_begin&quot;);
 72     queueEndField      = type.getCIntegerField(&quot;_queue_end&quot;);
 73     numberOfStubsField = type.getCIntegerField(&quot;_number_of_stubs&quot;);
 74   }
 75 
 76   public StubQueue(Address addr, Class stubType) {
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 package sun.jvm.hotspot.code;
 26 
 27 import java.util.*;
 28 import sun.jvm.hotspot.debugger.*;
 29 import sun.jvm.hotspot.runtime.*;
 30 import sun.jvm.hotspot.types.*;
 31 import sun.jvm.hotspot.utilities.*;
<span class="line-added"> 32 import sun.jvm.hotspot.utilities.Observable;</span>
<span class="line-added"> 33 import sun.jvm.hotspot.utilities.Observer;</span>
 34 
 35 /** &lt;P&gt; A port of the VM&#39;s StubQueue. Note that the VM implicitly
 36     knows the type of the objects contained in each StubQueue because
 37     it passes in an instance of a StubInterface to the StubQueue&#39;s
 38     constructor; the goal in the VM was to save space in the generated
 39     code. In the SA APIs the pattern has been to use the
 40     VirtualConstructor mechanism to instantiate wrapper objects of the
 41     appropriate type for objects down in the VM; see, for example, the
 42     CodeCache, which identifies NMethods, RuntimeStubs, etc. &lt;/P&gt;
 43 
 44     &lt;P&gt; In this port we eliminate the StubInterface in favor of
 45     passing in the class corresponding to the type of Stub which this
 46     StubQueue contains. &lt;/P&gt; */
 47 
 48 public class StubQueue extends VMObject {
 49   // FIXME: add the rest of the fields
 50   private static AddressField  stubBufferField;
 51   private static CIntegerField bufferLimitField;
 52   private static CIntegerField queueBeginField;
 53   private static CIntegerField queueEndField;
 54   private static CIntegerField numberOfStubsField;
 55 
 56   // The type of the contained stubs (i.e., InterpreterCodelet,
 57   // ICStub). Must be a subclass of type Stub.
<span class="line-modified"> 58   private Class&lt;?&gt; stubType;</span>
 59 
 60   static {
 61     VM.registerVMInitializedObserver(new Observer() {
 62         public void update(Observable o, Object data) {
 63           initialize(VM.getVM().getTypeDataBase());
 64         }
 65       });
 66   }
 67 
 68   private static synchronized void initialize(TypeDataBase db) {
 69     Type type = db.lookupType(&quot;StubQueue&quot;);
 70 
 71     stubBufferField    = type.getAddressField(&quot;_stub_buffer&quot;);
 72     bufferLimitField   = type.getCIntegerField(&quot;_buffer_limit&quot;);
 73     queueBeginField    = type.getCIntegerField(&quot;_queue_begin&quot;);
 74     queueEndField      = type.getCIntegerField(&quot;_queue_end&quot;);
 75     numberOfStubsField = type.getCIntegerField(&quot;_number_of_stubs&quot;);
 76   }
 77 
 78   public StubQueue(Address addr, Class stubType) {
</pre>
</td>
</tr>
</table>
<center><a href="SingletonBlob.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="UncommonTrapBlob.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>