<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/ui/JavaThreadsPanel.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="HistoryComboBox.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ObjectHistogramPanel.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/ui/JavaThreadsPanel.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
</pre>
<hr />
<pre>
 28 import java.awt.Dimension;
 29 
 30 import java.awt.event.*;
 31 
 32 import java.io.*;
 33 import java.util.*;
 34 
 35 import javax.swing.*;
 36 import javax.swing.event.ListSelectionEvent;
 37 import javax.swing.event.ListSelectionListener;
 38 import javax.swing.table.*;
 39 
 40 import sun.jvm.hotspot.debugger.*;
 41 import sun.jvm.hotspot.runtime.*;
 42 import sun.jvm.hotspot.types.*;
 43 
 44 import sun.jvm.hotspot.ui.action.*;
 45 
 46 import com.sun.java.swing.ui.*;
 47 import com.sun.java.swing.action.*;


 48 
 49 /**
 50  * This panel contains a JTable which displays the list of Java
 51  * threads as their native thread identifiers combined with their
 52  * Java names. It allows selection and examination of any of the
 53  * threads.
 54  */
 55 public class JavaThreadsPanel extends SAPanel implements ActionListener {
 56     private JavaThreadsTableModel dataModel;
 57     private StatusBar statusBar;
 58     private JTable     threadTable;
<span class="line-modified"> 59     private java.util.List&lt;CachedThread&gt; cachedThreads = new ArrayList();</span>
 60     private static AddressField crashThread;
 61 
 62 
 63     static {
 64         VM.registerVMInitializedObserver(
 65                             (o, a) -&gt; initialize(VM.getVM().getTypeDataBase()));
 66     }
 67 
 68     private static void initialize(TypeDataBase db) {
 69         crashThread = db.lookupType(&quot;VMError&quot;).getAddressField(&quot;_thread&quot;);
 70     }
 71 
 72     /** Constructor assumes the threads panel is created while the VM is
 73         suspended. Subsequent resume and suspend operations of the VM
 74         will cause the threads panel to clear and fill itself back in,
 75         respectively. */
 76     public JavaThreadsPanel() {
 77         VM.getVM().registerVMResumedObserver(new Observer() {
 78                 public void update(Observable o, Object data) {
 79                     decache();
</pre>
<hr />
<pre>
248             column = new TableColumn(0, MAX_WIDTH);
249             column.setHeaderValue(columnNames[0]);
250             column.setMaxWidth(MAX_WIDTH);
251             column.setResizable(false);
252             addColumn(column);
253 
254             // Thread name
255             column = new TableColumn(1, HUGE_WIDTH);
256             column.setHeaderValue(columnNames[1]);
257             column.setResizable(false);
258             addColumn(column);
259         }
260     } // end class JavaThreadsColumnModel
261 
262     /**
263      * Encapsulates the set of threads in a table model
264      */
265     private class JavaThreadsTableModel extends AbstractTableModel {
266         private String[] columnNames = { &quot;OS Thread ID&quot;, &quot;Java Thread Name&quot; };
267 
<span class="line-modified">268         private java.util.List elements;</span>
269 
<span class="line-modified">270         public JavaThreadsTableModel(java.util.List threads) {</span>
271             this.elements = threads;
272         }
273 
274         public int getColumnCount() {
275             return columnNames.length;
276         }
277 
278         public int getRowCount() {
279             return elements.size();
280         }
281 
282         public String getColumnName(int col) {
283             return columnNames[col];
284         }
285 
286         public Object getValueAt(int row, int col) {
287             CachedThread thread = getRow(row);
288             switch (col) {
289             case 0:
290                 return thread.getThreadID();
291             case 1:
292                 return thread.getThreadName();
293             default:
294                 throw new RuntimeException(&quot;Index (&quot; + col + &quot;, &quot; + row + &quot;) out of bounds&quot;);
295             }
296         }
297 
298         /**
299          * Returns the selected Java Thread indexed by the row or null.
300          */
301         public JavaThread getJavaThread(int index) {
302             return getRow(index).getThread();
303         }
304 
305         private CachedThread getRow(int row) {
<span class="line-modified">306             return (CachedThread)elements.get(row);</span>
307         }
308 
309         private String threadIDAt(int index) {
<span class="line-modified">310             return ((CachedThread) cachedThreads.get(index)).getThreadID();</span>
311         }
312 
313         private String threadNameAt(int index) {
314             try {
<span class="line-modified">315                 return ((CachedThread) cachedThreads.get(index)).getThreadName();</span>
316             } catch (AddressException e) {
317                 return &quot;&lt;Error: AddressException&gt;&quot;;
318             } catch (NullPointerException e) {
319                 return &quot;&lt;Error: NullPointerException&gt;&quot;;
320             }
321         }
322     } // end class JavaThreadsTableModel
323 
324     public void actionPerformed(ActionEvent evt) {
325         String command = evt.getActionCommand();
326 
327         if (command.equals(InspectAction.VALUE_COMMAND)) {
328             fireShowThreadOopInspector();
329         } else if (command.equals(MemoryAction.VALUE_COMMAND)) {
330             fireShowThreadStackMemory();
331         } else if (command.equals(ThreadInfoAction.VALUE_COMMAND)) {
332             fireShowThreadInfo();
333         } else if (command.equals(FindCrashesAction.VALUE_COMMAND)) {
334             if (fireShowThreadCrashes()) {
335                 statusBar.setMessage(&quot;Some thread crashes were encountered&quot;);
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
</pre>
<hr />
<pre>
 28 import java.awt.Dimension;
 29 
 30 import java.awt.event.*;
 31 
 32 import java.io.*;
 33 import java.util.*;
 34 
 35 import javax.swing.*;
 36 import javax.swing.event.ListSelectionEvent;
 37 import javax.swing.event.ListSelectionListener;
 38 import javax.swing.table.*;
 39 
 40 import sun.jvm.hotspot.debugger.*;
 41 import sun.jvm.hotspot.runtime.*;
 42 import sun.jvm.hotspot.types.*;
 43 
 44 import sun.jvm.hotspot.ui.action.*;
 45 
 46 import com.sun.java.swing.ui.*;
 47 import com.sun.java.swing.action.*;
<span class="line-added"> 48 import sun.jvm.hotspot.utilities.Observable;</span>
<span class="line-added"> 49 import sun.jvm.hotspot.utilities.Observer;</span>
 50 
 51 /**
 52  * This panel contains a JTable which displays the list of Java
 53  * threads as their native thread identifiers combined with their
 54  * Java names. It allows selection and examination of any of the
 55  * threads.
 56  */
 57 public class JavaThreadsPanel extends SAPanel implements ActionListener {
 58     private JavaThreadsTableModel dataModel;
 59     private StatusBar statusBar;
 60     private JTable     threadTable;
<span class="line-modified"> 61     private java.util.List&lt;CachedThread&gt; cachedThreads = new ArrayList&lt;&gt;();</span>
 62     private static AddressField crashThread;
 63 
 64 
 65     static {
 66         VM.registerVMInitializedObserver(
 67                             (o, a) -&gt; initialize(VM.getVM().getTypeDataBase()));
 68     }
 69 
 70     private static void initialize(TypeDataBase db) {
 71         crashThread = db.lookupType(&quot;VMError&quot;).getAddressField(&quot;_thread&quot;);
 72     }
 73 
 74     /** Constructor assumes the threads panel is created while the VM is
 75         suspended. Subsequent resume and suspend operations of the VM
 76         will cause the threads panel to clear and fill itself back in,
 77         respectively. */
 78     public JavaThreadsPanel() {
 79         VM.getVM().registerVMResumedObserver(new Observer() {
 80                 public void update(Observable o, Object data) {
 81                     decache();
</pre>
<hr />
<pre>
250             column = new TableColumn(0, MAX_WIDTH);
251             column.setHeaderValue(columnNames[0]);
252             column.setMaxWidth(MAX_WIDTH);
253             column.setResizable(false);
254             addColumn(column);
255 
256             // Thread name
257             column = new TableColumn(1, HUGE_WIDTH);
258             column.setHeaderValue(columnNames[1]);
259             column.setResizable(false);
260             addColumn(column);
261         }
262     } // end class JavaThreadsColumnModel
263 
264     /**
265      * Encapsulates the set of threads in a table model
266      */
267     private class JavaThreadsTableModel extends AbstractTableModel {
268         private String[] columnNames = { &quot;OS Thread ID&quot;, &quot;Java Thread Name&quot; };
269 
<span class="line-modified">270         private java.util.List&lt;CachedThread&gt; elements;</span>
271 
<span class="line-modified">272         public JavaThreadsTableModel(java.util.List&lt;CachedThread&gt; threads) {</span>
273             this.elements = threads;
274         }
275 
276         public int getColumnCount() {
277             return columnNames.length;
278         }
279 
280         public int getRowCount() {
281             return elements.size();
282         }
283 
284         public String getColumnName(int col) {
285             return columnNames[col];
286         }
287 
288         public Object getValueAt(int row, int col) {
289             CachedThread thread = getRow(row);
290             switch (col) {
291             case 0:
292                 return thread.getThreadID();
293             case 1:
294                 return thread.getThreadName();
295             default:
296                 throw new RuntimeException(&quot;Index (&quot; + col + &quot;, &quot; + row + &quot;) out of bounds&quot;);
297             }
298         }
299 
300         /**
301          * Returns the selected Java Thread indexed by the row or null.
302          */
303         public JavaThread getJavaThread(int index) {
304             return getRow(index).getThread();
305         }
306 
307         private CachedThread getRow(int row) {
<span class="line-modified">308             return elements.get(row);</span>
309         }
310 
311         private String threadIDAt(int index) {
<span class="line-modified">312             return cachedThreads.get(index).getThreadID();</span>
313         }
314 
315         private String threadNameAt(int index) {
316             try {
<span class="line-modified">317                 return cachedThreads.get(index).getThreadName();</span>
318             } catch (AddressException e) {
319                 return &quot;&lt;Error: AddressException&gt;&quot;;
320             } catch (NullPointerException e) {
321                 return &quot;&lt;Error: NullPointerException&gt;&quot;;
322             }
323         }
324     } // end class JavaThreadsTableModel
325 
326     public void actionPerformed(ActionEvent evt) {
327         String command = evt.getActionCommand();
328 
329         if (command.equals(InspectAction.VALUE_COMMAND)) {
330             fireShowThreadOopInspector();
331         } else if (command.equals(MemoryAction.VALUE_COMMAND)) {
332             fireShowThreadStackMemory();
333         } else if (command.equals(ThreadInfoAction.VALUE_COMMAND)) {
334             fireShowThreadInfo();
335         } else if (command.equals(FindCrashesAction.VALUE_COMMAND)) {
336             if (fireShowThreadCrashes()) {
337                 statusBar.setMessage(&quot;Some thread crashes were encountered&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="HistoryComboBox.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ObjectHistogramPanel.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>