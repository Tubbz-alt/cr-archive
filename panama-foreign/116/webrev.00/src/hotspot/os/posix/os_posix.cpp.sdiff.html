<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/os/posix/os_posix.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../../cpu/x86/methodHandles_x86.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../windows/os_windows.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/os/posix/os_posix.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 396 // boot/uptime information;
 397 // unfortunately it does not work on macOS and Linux because the utx chain has no entry
 398 // for reboot at least on my test machines
 399 void os::Posix::print_uptime_info(outputStream* st) {
 400   int bootsec = -1;
 401   int currsec = time(NULL);
 402   struct utmpx* ent;
 403   setutxent();
 404   while ((ent = getutxent())) {
 405     if (!strcmp(&quot;system boot&quot;, ent-&gt;ut_line)) {
 406       bootsec = ent-&gt;ut_tv.tv_sec;
 407       break;
 408     }
 409   }
 410 
 411   if (bootsec != -1) {
 412     os::print_dhm(st, &quot;OS uptime:&quot;, (long) (currsec-bootsec));
 413   }
 414 }
 415 
<span class="line-modified"> 416 </span>
<span class="line-modified"> 417 void os::Posix::print_rlimit_info(outputStream* st) {</span>
<span class="line-removed"> 418   st-&gt;print(&quot;rlimit:&quot;);</span>
 419   struct rlimit rlim;
 420 
<span class="line-modified"> 421   st-&gt;print(&quot; STACK &quot;);</span>
<span class="line-modified"> 422   getrlimit(RLIMIT_STACK, &amp;rlim);</span>
<span class="line-modified"> 423   if (rlim.rlim_cur == RLIM_INFINITY) st-&gt;print(&quot;infinity&quot;);</span>
<span class="line-modified"> 424   else st-&gt;print(UINT64_FORMAT &quot;k&quot;, uint64_t(rlim.rlim_cur) / 1024);</span>
















 425 
<span class="line-modified"> 426   st-&gt;print(&quot;, CORE &quot;);</span>
<span class="line-modified"> 427   getrlimit(RLIMIT_CORE, &amp;rlim);</span>
<span class="line-modified"> 428   if (rlim.rlim_cur == RLIM_INFINITY) st-&gt;print(&quot;infinity&quot;);</span>
<span class="line-modified"> 429   else st-&gt;print(UINT64_FORMAT &quot;k&quot;, uint64_t(rlim.rlim_cur) / 1024);</span>
 430 
<span class="line-removed"> 431   // Isn&#39;t there on solaris</span>
 432 #if defined(AIX)
 433   st-&gt;print(&quot;, NPROC &quot;);
 434   st-&gt;print(&quot;%d&quot;, sysconf(_SC_CHILD_MAX));
<span class="line-modified"> 435   st-&gt;print(&quot;, THREADS &quot;);</span>
<span class="line-modified"> 436   getrlimit(RLIMIT_THREADS, &amp;rlim);</span>
<span class="line-removed"> 437   if (rlim.rlim_cur == RLIM_INFINITY) st-&gt;print(&quot;infinity&quot;);</span>
<span class="line-removed"> 438   else st-&gt;print(UINT64_FORMAT, uint64_t(rlim.rlim_cur));</span>
 439 #elif !defined(SOLARIS)
<span class="line-modified"> 440   st-&gt;print(&quot;, NPROC &quot;);</span>
<span class="line-modified"> 441   getrlimit(RLIMIT_NPROC, &amp;rlim);</span>
<span class="line-modified"> 442   if (rlim.rlim_cur == RLIM_INFINITY) st-&gt;print(&quot;infinity&quot;);</span>
<span class="line-modified"> 443   else st-&gt;print(UINT64_FORMAT, uint64_t(rlim.rlim_cur));</span>

















 444 #endif
 445 
<span class="line-modified"> 446   st-&gt;print(&quot;, NOFILE &quot;);</span>
<span class="line-modified"> 447   getrlimit(RLIMIT_NOFILE, &amp;rlim);</span>
<span class="line-modified"> 448   if (rlim.rlim_cur == RLIM_INFINITY) st-&gt;print(&quot;infinity&quot;);</span>
<span class="line-modified"> 449   else st-&gt;print(UINT64_FORMAT, uint64_t(rlim.rlim_cur));</span>
<span class="line-removed"> 450 </span>
<span class="line-removed"> 451   st-&gt;print(&quot;, AS &quot;);</span>
<span class="line-removed"> 452   getrlimit(RLIMIT_AS, &amp;rlim);</span>
<span class="line-removed"> 453   if (rlim.rlim_cur == RLIM_INFINITY) st-&gt;print(&quot;infinity&quot;);</span>
<span class="line-removed"> 454   else st-&gt;print(UINT64_FORMAT &quot;k&quot;, uint64_t(rlim.rlim_cur) / 1024);</span>
<span class="line-removed"> 455 </span>
<span class="line-removed"> 456   st-&gt;print(&quot;, CPU &quot;);</span>
<span class="line-removed"> 457   getrlimit(RLIMIT_CPU, &amp;rlim);</span>
<span class="line-removed"> 458   if (rlim.rlim_cur == RLIM_INFINITY) st-&gt;print(&quot;infinity&quot;);</span>
<span class="line-removed"> 459   else st-&gt;print(UINT64_FORMAT, uint64_t(rlim.rlim_cur));</span>
<span class="line-removed"> 460 </span>
<span class="line-removed"> 461   st-&gt;print(&quot;, DATA &quot;);</span>
<span class="line-removed"> 462   getrlimit(RLIMIT_DATA, &amp;rlim);</span>
<span class="line-removed"> 463   if (rlim.rlim_cur == RLIM_INFINITY) st-&gt;print(&quot;infinity&quot;);</span>
<span class="line-removed"> 464   else st-&gt;print(UINT64_FORMAT &quot;k&quot;, uint64_t(rlim.rlim_cur) / 1024);</span>
<span class="line-removed"> 465 </span>
<span class="line-removed"> 466   st-&gt;print(&quot;, FSIZE &quot;);</span>
<span class="line-removed"> 467   getrlimit(RLIMIT_FSIZE, &amp;rlim);</span>
<span class="line-removed"> 468   if (rlim.rlim_cur == RLIM_INFINITY) st-&gt;print(&quot;infinity&quot;);</span>
<span class="line-removed"> 469   else st-&gt;print(UINT64_FORMAT &quot;k&quot;, uint64_t(rlim.rlim_cur) / 1024);</span>
 470 
 471   st-&gt;cr();
 472 }
 473 
 474 void os::Posix::print_uname_info(outputStream* st) {
 475   // kernel
 476   st-&gt;print(&quot;uname:&quot;);
 477   struct utsname name;
 478   uname(&amp;name);
 479   st-&gt;print(&quot;%s &quot;, name.sysname);
 480 #ifdef ASSERT
 481   st-&gt;print(&quot;%s &quot;, name.nodename);
 482 #endif
 483   st-&gt;print(&quot;%s &quot;, name.release);
 484   st-&gt;print(&quot;%s &quot;, name.version);
 485   st-&gt;print(&quot;%s&quot;, name.machine);
 486   st-&gt;cr();
 487 }
 488 
 489 void os::Posix::print_umask(outputStream* st, mode_t umsk) {
</pre>
</td>
<td>
<hr />
<pre>
 396 // boot/uptime information;
 397 // unfortunately it does not work on macOS and Linux because the utx chain has no entry
 398 // for reboot at least on my test machines
 399 void os::Posix::print_uptime_info(outputStream* st) {
 400   int bootsec = -1;
 401   int currsec = time(NULL);
 402   struct utmpx* ent;
 403   setutxent();
 404   while ((ent = getutxent())) {
 405     if (!strcmp(&quot;system boot&quot;, ent-&gt;ut_line)) {
 406       bootsec = ent-&gt;ut_tv.tv_sec;
 407       break;
 408     }
 409   }
 410 
 411   if (bootsec != -1) {
 412     os::print_dhm(st, &quot;OS uptime:&quot;, (long) (currsec-bootsec));
 413   }
 414 }
 415 
<span class="line-modified"> 416 static void print_rlimit(outputStream* st, const char* msg,</span>
<span class="line-modified"> 417                          int resource, bool output_k = false) {</span>

 418   struct rlimit rlim;
 419 
<span class="line-modified"> 420   st-&gt;print(&quot; %s &quot;, msg);</span>
<span class="line-modified"> 421   int res = getrlimit(resource, &amp;rlim);</span>
<span class="line-modified"> 422   if (res == -1) {</span>
<span class="line-modified"> 423     st-&gt;print(&quot;could not obtain value&quot;);</span>
<span class="line-added"> 424   } else {</span>
<span class="line-added"> 425     // soft limit</span>
<span class="line-added"> 426     if (rlim.rlim_cur == RLIM_INFINITY) { st-&gt;print(&quot;infinity&quot;); }</span>
<span class="line-added"> 427     else {</span>
<span class="line-added"> 428       if (output_k) { st-&gt;print(UINT64_FORMAT &quot;k&quot;, uint64_t(rlim.rlim_cur) / 1024); }</span>
<span class="line-added"> 429       else { st-&gt;print(UINT64_FORMAT, uint64_t(rlim.rlim_cur)); }</span>
<span class="line-added"> 430     }</span>
<span class="line-added"> 431     // hard limit</span>
<span class="line-added"> 432     st-&gt;print(&quot;/&quot;);</span>
<span class="line-added"> 433     if (rlim.rlim_max == RLIM_INFINITY) { st-&gt;print(&quot;infinity&quot;); }</span>
<span class="line-added"> 434     else {</span>
<span class="line-added"> 435       if (output_k) { st-&gt;print(UINT64_FORMAT &quot;k&quot;, uint64_t(rlim.rlim_max) / 1024); }</span>
<span class="line-added"> 436       else { st-&gt;print(UINT64_FORMAT, uint64_t(rlim.rlim_max)); }</span>
<span class="line-added"> 437     }</span>
<span class="line-added"> 438   }</span>
<span class="line-added"> 439 }</span>
 440 
<span class="line-modified"> 441 void os::Posix::print_rlimit_info(outputStream* st) {</span>
<span class="line-modified"> 442   st-&gt;print(&quot;rlimit (soft/hard):&quot;);</span>
<span class="line-modified"> 443   print_rlimit(st, &quot;STACK&quot;, RLIMIT_STACK, true);</span>
<span class="line-modified"> 444   print_rlimit(st, &quot;, CORE&quot;, RLIMIT_CORE, true);</span>
 445 

 446 #if defined(AIX)
 447   st-&gt;print(&quot;, NPROC &quot;);
 448   st-&gt;print(&quot;%d&quot;, sysconf(_SC_CHILD_MAX));
<span class="line-modified"> 449 </span>
<span class="line-modified"> 450   print_rlimit(st, &quot;, THREADS&quot;, RLIMIT_THREADS);</span>


 451 #elif !defined(SOLARIS)
<span class="line-modified"> 452   print_rlimit(st, &quot;, NPROC&quot;, RLIMIT_NPROC);</span>
<span class="line-modified"> 453 #endif</span>
<span class="line-modified"> 454 </span>
<span class="line-modified"> 455   print_rlimit(st, &quot;, NOFILE&quot;, RLIMIT_NOFILE);</span>
<span class="line-added"> 456   print_rlimit(st, &quot;, AS&quot;, RLIMIT_AS, true);</span>
<span class="line-added"> 457   print_rlimit(st, &quot;, CPU&quot;, RLIMIT_CPU);</span>
<span class="line-added"> 458   print_rlimit(st, &quot;, DATA&quot;, RLIMIT_DATA, true);</span>
<span class="line-added"> 459 </span>
<span class="line-added"> 460   // maximum size of files that the process may create</span>
<span class="line-added"> 461   print_rlimit(st, &quot;, FSIZE&quot;, RLIMIT_FSIZE, true);</span>
<span class="line-added"> 462 </span>
<span class="line-added"> 463 #if defined(LINUX) || defined(__APPLE__)</span>
<span class="line-added"> 464   // maximum number of bytes of memory that may be locked into RAM</span>
<span class="line-added"> 465   // (rounded down to the nearest  multiple of system pagesize)</span>
<span class="line-added"> 466   print_rlimit(st, &quot;, MEMLOCK&quot;, RLIMIT_MEMLOCK, true);</span>
<span class="line-added"> 467 #endif</span>
<span class="line-added"> 468 </span>
<span class="line-added"> 469 #if defined(SOLARIS)</span>
<span class="line-added"> 470   // maximum size of mapped address space of a process in bytes;</span>
<span class="line-added"> 471   // if the limit is exceeded, mmap and brk fail</span>
<span class="line-added"> 472   print_rlimit(st, &quot;, VMEM&quot;, RLIMIT_VMEM, true);</span>
 473 #endif
 474 
<span class="line-modified"> 475   // MacOS; The maximum size (in bytes) to which a process&#39;s resident set size may grow.</span>
<span class="line-modified"> 476 #if defined(__APPLE__)</span>
<span class="line-modified"> 477   print_rlimit(st, &quot;, RSS&quot;, RLIMIT_RSS, true);</span>
<span class="line-modified"> 478 #endif</span>




















 479 
 480   st-&gt;cr();
 481 }
 482 
 483 void os::Posix::print_uname_info(outputStream* st) {
 484   // kernel
 485   st-&gt;print(&quot;uname:&quot;);
 486   struct utsname name;
 487   uname(&amp;name);
 488   st-&gt;print(&quot;%s &quot;, name.sysname);
 489 #ifdef ASSERT
 490   st-&gt;print(&quot;%s &quot;, name.nodename);
 491 #endif
 492   st-&gt;print(&quot;%s &quot;, name.release);
 493   st-&gt;print(&quot;%s &quot;, name.version);
 494   st-&gt;print(&quot;%s&quot;, name.machine);
 495   st-&gt;cr();
 496 }
 497 
 498 void os::Posix::print_umask(outputStream* st, mode_t umsk) {
</pre>
</td>
</tr>
</table>
<center><a href="../../cpu/x86/methodHandles_x86.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../windows/os_windows.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>