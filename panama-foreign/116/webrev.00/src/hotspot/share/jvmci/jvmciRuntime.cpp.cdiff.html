<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/jvmci/jvmciRuntime.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../interpreter/linkResolver.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../logging/log.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jvmci/jvmciRuntime.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 380,52 ***</span>
  
    assert(continuation != NULL, &quot;no handler found&quot;);
    return continuation;
  }
  
<span class="line-modified">! JRT_ENTRY_NO_ASYNC(void, JVMCIRuntime::monitorenter(JavaThread* thread, oopDesc* obj, BasicLock* lock))</span>
<span class="line-modified">!   IF_TRACE_jvmci_3 {</span>
<span class="line-removed">-     char type[O_BUFLEN];</span>
<span class="line-removed">-     obj-&gt;klass()-&gt;name()-&gt;as_C_string(type, O_BUFLEN);</span>
<span class="line-removed">-     markWord mark = obj-&gt;mark();</span>
<span class="line-removed">-     TRACE_jvmci_3(&quot;%s: entered locking slow case with obj=&quot; INTPTR_FORMAT &quot;, type=%s, mark=&quot; INTPTR_FORMAT &quot;, lock=&quot; INTPTR_FORMAT, thread-&gt;name(), p2i(obj), type, mark.value(), p2i(lock));</span>
<span class="line-removed">-     tty-&gt;flush();</span>
<span class="line-removed">-   }</span>
<span class="line-removed">-   if (PrintBiasedLockingStatistics) {</span>
<span class="line-removed">-     Atomic::inc(BiasedLocking::slow_path_entry_count_addr());</span>
<span class="line-removed">-   }</span>
<span class="line-removed">-   Handle h_obj(thread, obj);</span>
<span class="line-removed">-   assert(oopDesc::is_oop(h_obj()), &quot;must be NULL or an object&quot;);</span>
<span class="line-removed">-   ObjectSynchronizer::enter(h_obj, lock, THREAD);</span>
<span class="line-removed">-   TRACE_jvmci_3(&quot;%s: exiting locking slow with obj=&quot; INTPTR_FORMAT, thread-&gt;name(), p2i(obj));</span>
  JRT_END
  
  JRT_LEAF(void, JVMCIRuntime::monitorexit(JavaThread* thread, oopDesc* obj, BasicLock* lock))
<span class="line-removed">-   assert(thread == JavaThread::current(), &quot;threads must correspond&quot;);</span>
    assert(thread-&gt;last_Java_sp(), &quot;last_Java_sp must be set&quot;);
<span class="line-modified">!   // monitorexit is non-blocking (leaf routine) =&gt; no exceptions can be thrown</span>
<span class="line-modified">!   EXCEPTION_MARK;</span>
<span class="line-removed">- </span>
<span class="line-removed">- #ifdef ASSERT</span>
<span class="line-removed">-   if (!oopDesc::is_oop(obj)) {</span>
<span class="line-removed">-     ResetNoHandleMark rhm;</span>
<span class="line-removed">-     nmethod* method = thread-&gt;last_frame().cb()-&gt;as_nmethod_or_null();</span>
<span class="line-removed">-     if (method != NULL) {</span>
<span class="line-removed">-       tty-&gt;print_cr(&quot;ERROR in monitorexit in method %s wrong obj &quot; INTPTR_FORMAT, method-&gt;name(), p2i(obj));</span>
<span class="line-removed">-     }</span>
<span class="line-removed">-     thread-&gt;print_stack_on(tty);</span>
<span class="line-removed">-     assert(false, &quot;invalid lock object pointer dected&quot;);</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- #endif</span>
<span class="line-removed">- </span>
<span class="line-removed">-   ObjectSynchronizer::exit(obj, lock, THREAD);</span>
<span class="line-removed">-   IF_TRACE_jvmci_3 {</span>
<span class="line-removed">-     char type[O_BUFLEN];</span>
<span class="line-removed">-     obj-&gt;klass()-&gt;name()-&gt;as_C_string(type, O_BUFLEN);</span>
<span class="line-removed">-     TRACE_jvmci_3(&quot;%s: exited locking slow case with obj=&quot; INTPTR_FORMAT &quot;, type=%s, mark=&quot; INTPTR_FORMAT &quot;, lock=&quot; INTPTR_FORMAT, thread-&gt;name(), p2i(obj), type, obj-&gt;mark().value(), p2i(lock));</span>
<span class="line-removed">-     tty-&gt;flush();</span>
<span class="line-removed">-   }</span>
  JRT_END
  
  // Object.notify() fast path, caller does slow path
  JRT_LEAF(jboolean, JVMCIRuntime::object_notify(JavaThread *thread, oopDesc* obj))
  
<span class="line-new-header">--- 380,18 ---</span>
  
    assert(continuation != NULL, &quot;no handler found&quot;);
    return continuation;
  }
  
<span class="line-modified">! JRT_BLOCK_ENTRY(void, JVMCIRuntime::monitorenter(JavaThread* thread, oopDesc* obj, BasicLock* lock))</span>
<span class="line-modified">!   SharedRuntime::monitor_enter_helper(obj, lock, thread);</span>
  JRT_END
  
  JRT_LEAF(void, JVMCIRuntime::monitorexit(JavaThread* thread, oopDesc* obj, BasicLock* lock))
    assert(thread-&gt;last_Java_sp(), &quot;last_Java_sp must be set&quot;);
<span class="line-modified">!   assert(oopDesc::is_oop(obj), &quot;invalid lock object pointer dected&quot;);</span>
<span class="line-modified">!   SharedRuntime::monitor_exit_helper(obj, lock, thread);</span>
  JRT_END
  
  // Object.notify() fast path, caller does slow path
  JRT_LEAF(jboolean, JVMCIRuntime::object_notify(JavaThread *thread, oopDesc* obj))
  
</pre>
<center><a href="../interpreter/linkResolver.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../logging/log.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>