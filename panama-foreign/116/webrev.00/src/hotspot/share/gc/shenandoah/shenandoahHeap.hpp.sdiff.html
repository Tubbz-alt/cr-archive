<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/shenandoah/shenandoahHeap.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahHeap.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahHeap.inline.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/shenandoahHeap.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
259     EVACUATION_BITPOS = 2,
260 
261     // Heap is under updating: needs no additional barriers.
262     UPDATEREFS_BITPOS = 3,
263   };
264 
265   enum GCState {
266     STABLE        = 0,
267     HAS_FORWARDED = 1 &lt;&lt; HAS_FORWARDED_BITPOS,
268     MARKING       = 1 &lt;&lt; MARKING_BITPOS,
269     EVACUATION    = 1 &lt;&lt; EVACUATION_BITPOS,
270     UPDATEREFS    = 1 &lt;&lt; UPDATEREFS_BITPOS,
271   };
272 
273 private:
274   ShenandoahSharedBitmap _gc_state;
275   ShenandoahSharedFlag   _degenerated_gc_in_progress;
276   ShenandoahSharedFlag   _full_gc_in_progress;
277   ShenandoahSharedFlag   _full_gc_move_in_progress;
278   ShenandoahSharedFlag   _progress_last_gc;
<span class="line-modified">279   ShenandoahSharedFlag   _concurrent_root_in_progress;</span>

280 
281   void set_gc_state_all_threads(char state);
282   void set_gc_state_mask(uint mask, bool value);
283 
284 public:
285   char gc_state() const;
286   static address gc_state_addr();
287 
288   void set_concurrent_mark_in_progress(bool in_progress);
289   void set_evacuation_in_progress(bool in_progress);
290   void set_update_refs_in_progress(bool in_progress);
291   void set_degenerated_gc_in_progress(bool in_progress);
292   void set_full_gc_in_progress(bool in_progress);
293   void set_full_gc_move_in_progress(bool in_progress);
294   void set_has_forwarded_objects(bool cond);
<span class="line-modified">295   void set_concurrent_root_in_progress(bool cond);</span>

296 
297   inline bool is_stable() const;
298   inline bool is_idle() const;
299   inline bool is_concurrent_mark_in_progress() const;
300   inline bool is_update_refs_in_progress() const;
301   inline bool is_evacuation_in_progress() const;
302   inline bool is_degenerated_gc_in_progress() const;
303   inline bool is_full_gc_in_progress() const;
304   inline bool is_full_gc_move_in_progress() const;
305   inline bool has_forwarded_objects() const;
306   inline bool is_gc_in_progress_mask(uint mask) const;
307   inline bool is_stw_gc_in_progress() const;
<span class="line-modified">308   inline bool is_concurrent_root_in_progress() const;</span>

309 
310 // ---------- GC cancellation and degeneration machinery
311 //
312 // Cancelled GC flag is used to notify concurrent phases that they should terminate.
313 //
314 public:
315   enum ShenandoahDegenPoint {
316     _degenerated_unset,
317     _degenerated_outside_cycle,
318     _degenerated_mark,
319     _degenerated_evac,
320     _degenerated_updaterefs,
321     _DEGENERATED_LIMIT
322   };
323 
324   static const char* degen_point_to_string(ShenandoahDegenPoint point) {
325     switch (point) {
326       case _degenerated_unset:
327         return &quot;&lt;UNSET&gt;&quot;;
328       case _degenerated_outside_cycle:
</pre>
<hr />
<pre>
377   void vmop_entry_final_mark();
378   void vmop_entry_init_updaterefs();
379   void vmop_entry_final_updaterefs();
380   void vmop_entry_full(GCCause::Cause cause);
381   void vmop_degenerated(ShenandoahDegenPoint point);
382 
383   // Entry methods to normally STW GC operations. These set up logging, monitoring
384   // and workers for net VM operation
385   void entry_init_mark();
386   void entry_final_mark();
387   void entry_init_updaterefs();
388   void entry_final_updaterefs();
389   void entry_full(GCCause::Cause cause);
390   void entry_degenerated(int point);
391 
392   // Entry methods to normally concurrent GC operations. These set up logging, monitoring
393   // for concurrent operation.
394   void entry_reset();
395   void entry_mark();
396   void entry_preclean();
<span class="line-modified">397   void entry_roots();</span>

398   void entry_cleanup();
399   void entry_evac();
400   void entry_updaterefs();
401   void entry_uncommit(double shrink_before);
402 
403 private:
404   // Actual work for the phases
405   void op_init_mark();
406   void op_final_mark();
407   void op_init_updaterefs();
408   void op_final_updaterefs();
409   void op_full(GCCause::Cause cause);
410   void op_degenerated(ShenandoahDegenPoint point);
411   void op_degenerated_fail();
412   void op_degenerated_futile();
413 
414   void op_reset();
415   void op_mark();
416   void op_preclean();
<span class="line-modified">417   void op_roots();</span>

418   void op_cleanup();
419   void op_conc_evac();
420   void op_stw_evac();
421   void op_updaterefs();
422   void op_uncommit(double shrink_before);
423 
424   // Messages for GC trace events, they have to be immortal for
425   // passing around the logging/tracing systems
426   const char* init_mark_event_message() const;
427   const char* final_mark_event_message() const;
428   const char* conc_mark_event_message() const;
429   const char* degen_event_message(ShenandoahDegenPoint point) const;
430 
431 // ---------- GC subsystems
432 //
433 private:
434   ShenandoahControlThread*   _control_thread;
435   ShenandoahCollectorPolicy* _shenandoah_policy;
436   ShenandoahMode*            _gc_mode;
437   ShenandoahHeuristics*      _heuristics;
</pre>
</td>
<td>
<hr />
<pre>
259     EVACUATION_BITPOS = 2,
260 
261     // Heap is under updating: needs no additional barriers.
262     UPDATEREFS_BITPOS = 3,
263   };
264 
265   enum GCState {
266     STABLE        = 0,
267     HAS_FORWARDED = 1 &lt;&lt; HAS_FORWARDED_BITPOS,
268     MARKING       = 1 &lt;&lt; MARKING_BITPOS,
269     EVACUATION    = 1 &lt;&lt; EVACUATION_BITPOS,
270     UPDATEREFS    = 1 &lt;&lt; UPDATEREFS_BITPOS,
271   };
272 
273 private:
274   ShenandoahSharedBitmap _gc_state;
275   ShenandoahSharedFlag   _degenerated_gc_in_progress;
276   ShenandoahSharedFlag   _full_gc_in_progress;
277   ShenandoahSharedFlag   _full_gc_move_in_progress;
278   ShenandoahSharedFlag   _progress_last_gc;
<span class="line-modified">279   ShenandoahSharedFlag   _concurrent_strong_root_in_progress;</span>
<span class="line-added">280   ShenandoahSharedFlag   _concurrent_weak_root_in_progress;</span>
281 
282   void set_gc_state_all_threads(char state);
283   void set_gc_state_mask(uint mask, bool value);
284 
285 public:
286   char gc_state() const;
287   static address gc_state_addr();
288 
289   void set_concurrent_mark_in_progress(bool in_progress);
290   void set_evacuation_in_progress(bool in_progress);
291   void set_update_refs_in_progress(bool in_progress);
292   void set_degenerated_gc_in_progress(bool in_progress);
293   void set_full_gc_in_progress(bool in_progress);
294   void set_full_gc_move_in_progress(bool in_progress);
295   void set_has_forwarded_objects(bool cond);
<span class="line-modified">296   void set_concurrent_strong_root_in_progress(bool cond);</span>
<span class="line-added">297   void set_concurrent_weak_root_in_progress(bool cond);</span>
298 
299   inline bool is_stable() const;
300   inline bool is_idle() const;
301   inline bool is_concurrent_mark_in_progress() const;
302   inline bool is_update_refs_in_progress() const;
303   inline bool is_evacuation_in_progress() const;
304   inline bool is_degenerated_gc_in_progress() const;
305   inline bool is_full_gc_in_progress() const;
306   inline bool is_full_gc_move_in_progress() const;
307   inline bool has_forwarded_objects() const;
308   inline bool is_gc_in_progress_mask(uint mask) const;
309   inline bool is_stw_gc_in_progress() const;
<span class="line-modified">310   inline bool is_concurrent_strong_root_in_progress() const;</span>
<span class="line-added">311   inline bool is_concurrent_weak_root_in_progress() const;</span>
312 
313 // ---------- GC cancellation and degeneration machinery
314 //
315 // Cancelled GC flag is used to notify concurrent phases that they should terminate.
316 //
317 public:
318   enum ShenandoahDegenPoint {
319     _degenerated_unset,
320     _degenerated_outside_cycle,
321     _degenerated_mark,
322     _degenerated_evac,
323     _degenerated_updaterefs,
324     _DEGENERATED_LIMIT
325   };
326 
327   static const char* degen_point_to_string(ShenandoahDegenPoint point) {
328     switch (point) {
329       case _degenerated_unset:
330         return &quot;&lt;UNSET&gt;&quot;;
331       case _degenerated_outside_cycle:
</pre>
<hr />
<pre>
380   void vmop_entry_final_mark();
381   void vmop_entry_init_updaterefs();
382   void vmop_entry_final_updaterefs();
383   void vmop_entry_full(GCCause::Cause cause);
384   void vmop_degenerated(ShenandoahDegenPoint point);
385 
386   // Entry methods to normally STW GC operations. These set up logging, monitoring
387   // and workers for net VM operation
388   void entry_init_mark();
389   void entry_final_mark();
390   void entry_init_updaterefs();
391   void entry_final_updaterefs();
392   void entry_full(GCCause::Cause cause);
393   void entry_degenerated(int point);
394 
395   // Entry methods to normally concurrent GC operations. These set up logging, monitoring
396   // for concurrent operation.
397   void entry_reset();
398   void entry_mark();
399   void entry_preclean();
<span class="line-modified">400   void entry_weak_roots();</span>
<span class="line-added">401   void entry_strong_roots();</span>
402   void entry_cleanup();
403   void entry_evac();
404   void entry_updaterefs();
405   void entry_uncommit(double shrink_before);
406 
407 private:
408   // Actual work for the phases
409   void op_init_mark();
410   void op_final_mark();
411   void op_init_updaterefs();
412   void op_final_updaterefs();
413   void op_full(GCCause::Cause cause);
414   void op_degenerated(ShenandoahDegenPoint point);
415   void op_degenerated_fail();
416   void op_degenerated_futile();
417 
418   void op_reset();
419   void op_mark();
420   void op_preclean();
<span class="line-modified">421   void op_weak_roots();</span>
<span class="line-added">422   void op_strong_roots();</span>
423   void op_cleanup();
424   void op_conc_evac();
425   void op_stw_evac();
426   void op_updaterefs();
427   void op_uncommit(double shrink_before);
428 
429   // Messages for GC trace events, they have to be immortal for
430   // passing around the logging/tracing systems
431   const char* init_mark_event_message() const;
432   const char* final_mark_event_message() const;
433   const char* conc_mark_event_message() const;
434   const char* degen_event_message(ShenandoahDegenPoint point) const;
435 
436 // ---------- GC subsystems
437 //
438 private:
439   ShenandoahControlThread*   _control_thread;
440   ShenandoahCollectorPolicy* _shenandoah_policy;
441   ShenandoahMode*            _gc_mode;
442   ShenandoahHeuristics*      _heuristics;
</pre>
</td>
</tr>
</table>
<center><a href="shenandoahHeap.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahHeap.inline.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>