<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/java.base/share/classes/java/lang/VersionProps.java.template</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 1999, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package java.lang;
 27 
 28 import java.io.PrintStream;
 29 import java.util.Arrays;
 30 import java.util.List;
 31 import java.util.Map;
 32 import java.util.Optional;
 33 
 34 class VersionProps {
 35 
 36     private static final String launcher_name =
 37         &quot;@@LAUNCHER_NAME@@&quot;;
 38 
 39     private static final String java_version =
 40         &quot;@@VERSION_SHORT@@&quot;;
 41 
 42     private static final String java_version_date =
 43         &quot;@@VERSION_DATE@@&quot;;
 44 
 45     // This field is read by HotSpot
 46     private static final String java_runtime_name =
 47         &quot;@@RUNTIME_NAME@@&quot;;
 48 
 49     // This field is read by HotSpot
 50     private static final String java_runtime_version =
 51         &quot;@@VERSION_STRING@@&quot;;
 52 
 53     private static final String VERSION_NUMBER =
 54         &quot;@@VERSION_NUMBER@@&quot;;
 55 
 56     private static final String VERSION_SPECIFICATION =
 57         &quot;@@VERSION_SPECIFICATION@@&quot;;
 58 
 59     private static final String VERSION_BUILD =
 60         &quot;@@VERSION_BUILD@@&quot;;
 61 
 62     private static final String VERSION_PRE =
 63         &quot;@@VERSION_PRE@@&quot;;
 64 
 65     private static final String VERSION_OPT =
 66         &quot;@@VERSION_OPT@@&quot;;
 67 
 68     private static final boolean isLTS =
 69         &quot;@@VERSION_OPT@@&quot;.startsWith(&quot;LTS&quot;);
 70 
 71     private static final String CLASSFILE_MAJOR_MINOR =
 72         &quot;@@VERSION_CLASSFILE_MAJOR@@.@@VERSION_CLASSFILE_MINOR@@&quot;;
 73 
 74     private static final String VENDOR =
 75         &quot;@@VENDOR@@&quot;;
 76 
 77     private static final String VENDOR_URL =
 78         &quot;@@VENDOR_URL@@&quot;;
 79 
 80     // The remaining VENDOR_* fields must not be final,
 81     // so that they can be redefined by jlink plugins
 82 
 83     // This field is read by HotSpot
 84     private static String VENDOR_VERSION =
 85         &quot;@@VENDOR_VERSION_STRING@@&quot;;
 86 
 87     private static String VENDOR_URL_BUG =
 88         &quot;@@VENDOR_URL_BUG@@&quot;;
 89 
 90     // This field is read by HotSpot
 91     @SuppressWarnings(&quot;unused&quot;)
 92     private static String VENDOR_URL_VM_BUG =
 93         &quot;@@VENDOR_URL_VM_BUG@@&quot;;
 94 
 95     /**
 96      * Initialize system properties using build provided values.
 97      *
 98      * @param props Map instance in which to insert the properties
 99      */
100     public static void init(Map&lt;String, String&gt; props) {
101         props.put(&quot;java.version&quot;, java_version);
102         props.put(&quot;java.version.date&quot;, java_version_date);
103         props.put(&quot;java.runtime.version&quot;, java_runtime_version);
104         props.put(&quot;java.runtime.name&quot;, java_runtime_name);
105         if (!VENDOR_VERSION.isEmpty())
106             props.put(&quot;java.vendor.version&quot;, VENDOR_VERSION);
107 
108         props.put(&quot;java.class.version&quot;, CLASSFILE_MAJOR_MINOR);
109 
110         props.put(&quot;java.specification.version&quot;, VERSION_SPECIFICATION);
111         props.put(&quot;java.specification.name&quot;, &quot;Java Platform API Specification&quot;);
112         props.put(&quot;java.specification.vendor&quot;, &quot;Oracle Corporation&quot;);
113 
114         props.put(&quot;java.vendor&quot;, VENDOR);
115         props.put(&quot;java.vendor.url&quot;, VENDOR_URL);
116         props.put(&quot;java.vendor.url.bug&quot;, VENDOR_URL_BUG);
117     }
118 
119     private static int parseVersionNumber(String version, int prevIndex, int index) {
120         if (index - prevIndex &gt; 1 &amp;&amp;
121             Character.digit(version.charAt(prevIndex), 10) &lt;= 0)
122             throw new IllegalArgumentException(&quot;Leading zeros not supported (&quot; +
123                     version.substring(prevIndex, index) + &quot;)&quot;);
124         return Integer.parseInt(version, prevIndex, index, 10);
125     }
126 
127     // This method is reflectively used by regression tests.
128     static List&lt;Integer&gt; parseVersionNumbers(String version) {
129         // Let&#39;s find the size of an array required to hold $VNUM components
130         int size = 0;
131         int prevIndex = 0;
132         do {
133             prevIndex = version.indexOf(&#39;.&#39;, prevIndex) + 1;
134             size++;
135         } while (prevIndex &gt; 0);
136         Integer[] verNumbers = new Integer[size];
137 
138         // Fill in the array with $VNUM components
139         int n = 0;
140         prevIndex = 0;
141         int index = version.indexOf(&#39;.&#39;);
142         while (index &gt; -1) {
143             verNumbers[n] = parseVersionNumber(version, prevIndex, index);
144             prevIndex = index + 1; // Skip the period
145             index = version.indexOf(&#39;.&#39;, prevIndex);
146             n++;
147         }
148         verNumbers[n] = parseVersionNumber(version, prevIndex, version.length());
149 
150         if (verNumbers[0] == 0 || verNumbers[n] == 0)
151             throw new IllegalArgumentException(&quot;Leading/trailing zeros not allowed (&quot; +
152                     Arrays.toString(verNumbers) + &quot;)&quot;);
153 
154         return List.of(verNumbers);
155     }
156 
157     static List&lt;Integer&gt; versionNumbers() {
158         return parseVersionNumbers(VERSION_NUMBER);
159     }
160 
161     static Optional&lt;String&gt; pre() {
162         return optionalOf(VERSION_PRE);
163     }
164 
165     static Optional&lt;Integer&gt; build() {
166         return VERSION_BUILD.isEmpty() ?
167                 Optional.empty() :
168                 Optional.of(Integer.parseInt(VERSION_BUILD));
169     }
170 
171     static Optional&lt;String&gt; optional() {
172         return optionalOf(VERSION_OPT);
173     }
174 
175     // Treat empty strings as value not being present
176     private static Optional&lt;String&gt; optionalOf(String value) {
177         if (!value.isEmpty()) {
178             return Optional.of(value);
179         } else {
180             return Optional.empty();
181         }
182     }
183 
184     /**
185      * In case you were wondering this method is called by java -version.
186      */
187     public static void print(boolean err) {
188         print(err, false);
189     }
190 
191     /**
192      * This is the same as print except that it adds an extra line-feed
193      * at the end, typically used by the -showversion in the launcher
194      */
195     public static void println(boolean err) {
196         print(err, true);
197     }
198 
199     /**
200      * Print version info.
201      */
202     private static void print(boolean err, boolean newln) {
203         PrintStream ps = err ? System.err : System.out;
204 
205         /* First line: platform version. */
206         if (err) {
207             ps.println(launcher_name + &quot; version \&quot;&quot; + java_version + &quot;\&quot;&quot;
208                        + &quot; &quot; + java_version_date
209                        + (isLTS ? &quot; LTS&quot; : &quot;&quot;));
210         } else {
211             /* Use a format more in line with GNU conventions */
212             ps.println(launcher_name + &quot; &quot; + java_version
213                        + &quot; &quot; + java_version_date
214                        + (isLTS ? &quot; LTS&quot; : &quot;&quot;));
215         }
216 
217         /* Second line: runtime version (ie, libraries). */
218         String jdk_debug_level = System.getProperty(&quot;jdk.debug&quot;, &quot;release&quot;);
219         if (&quot;release&quot;.equals(jdk_debug_level)) {
220            /* Do not show debug level &quot;release&quot; builds */
221             jdk_debug_level = &quot;&quot;;
222         } else {
223             jdk_debug_level = jdk_debug_level + &quot; &quot;;
224         }
225 
226         String vendor_version = (VENDOR_VERSION.isEmpty()
227                                  ? &quot;&quot; : &quot; &quot; + VENDOR_VERSION);
228 
229         ps.println(java_runtime_name + vendor_version
230                    + &quot; (&quot; + jdk_debug_level + &quot;build &quot; + java_runtime_version + &quot;)&quot;);
231 
232         /* Third line: JVM information. */
233         String java_vm_name    = System.getProperty(&quot;java.vm.name&quot;);
234         String java_vm_version = System.getProperty(&quot;java.vm.version&quot;);
235         String java_vm_info    = System.getProperty(&quot;java.vm.info&quot;);
236         ps.println(java_vm_name + vendor_version
237                    + &quot; (&quot; + jdk_debug_level + &quot;build &quot; + java_vm_version + &quot;, &quot;
238                             + java_vm_info + &quot;)&quot;);
239 
240     }
241 
242 }
    </pre>
  </body>
</html>