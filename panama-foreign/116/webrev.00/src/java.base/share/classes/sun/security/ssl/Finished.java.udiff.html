<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/sun/security/ssl/Finished.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ClientKeyExchange.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="HandshakeContext.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/ssl/Finished.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -479,15 +479,20 @@</span>
                          ChangeCipherSpec.t10Consumer);
                  shc.handshakeConsumers.put(
                          SSLHandshake.FINISHED.id, SSLHandshake.FINISHED);
                  shc.conContext.inputRecord.expectingFinishFlight();
              } else {
<span class="udiff-line-modified-removed">-                 if (shc.handshakeSession.isRejoinable() &amp;&amp;</span>
<span class="udiff-line-modified-removed">-                         !shc.handshakeSession.isStatelessable(shc)) {</span>
<span class="udiff-line-modified-removed">-                     ((SSLSessionContextImpl)shc.sslContext.</span>
<span class="udiff-line-modified-removed">-                         engineGetServerSessionContext()).put(</span>
<span class="udiff-line-modified-removed">-                             shc.handshakeSession);</span>
<span class="udiff-line-modified-added">+                 // Set the session&#39;s context based on stateless/cache status</span>
<span class="udiff-line-modified-added">+                 if (shc.handshakeSession.isStatelessable(shc)) {</span>
<span class="udiff-line-modified-added">+                     shc.handshakeSession.setContext((SSLSessionContextImpl)</span>
<span class="udiff-line-modified-added">+                             shc.sslContext.engineGetServerSessionContext());</span>
<span class="udiff-line-modified-added">+                 } else {</span>
<span class="udiff-line-added">+                     if (shc.handshakeSession.isRejoinable()) {</span>
<span class="udiff-line-added">+                         ((SSLSessionContextImpl)shc.sslContext.</span>
<span class="udiff-line-added">+                                 engineGetServerSessionContext()).put(</span>
<span class="udiff-line-added">+                                 shc.handshakeSession);</span>
<span class="udiff-line-added">+                     }</span>
                  }
                  shc.conContext.conSession = shc.handshakeSession.finish();
                  shc.conContext.protocolVersion = shc.negotiatedProtocol;
  
                  // handshake context cleanup.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -855,10 +860,13 @@</span>
               */
              if (shc.conContext.secureRenegotiation) {
                  shc.conContext.serverVerifyData = fm.verifyData;
              }
  
<span class="udiff-line-added">+             // Make sure session&#39;s context is set</span>
<span class="udiff-line-added">+             shc.handshakeSession.setContext((SSLSessionContextImpl)</span>
<span class="udiff-line-added">+                     shc.sslContext.engineGetServerSessionContext());</span>
              shc.conContext.conSession = shc.handshakeSession.finish();
  
              // update the context
              shc.handshakeConsumers.put(
                      SSLHandshake.FINISHED.id, SSLHandshake.FINISHED);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -895,10 +903,12 @@</span>
                  ByteBuffer message) throws IOException {
              // Make sure that any expected CertificateVerify message
              // has been received and processed.
              if (!chc.isResumption) {
                  if (chc.handshakeConsumers.containsKey(
<span class="udiff-line-added">+                         SSLHandshake.CERTIFICATE.id) ||</span>
<span class="udiff-line-added">+                     chc.handshakeConsumers.containsKey(</span>
                          SSLHandshake.CERTIFICATE_VERIFY.id)) {
                      throw chc.conContext.fatal(Alert.UNEXPECTED_MESSAGE,
                              &quot;Unexpected Finished handshake message&quot;);
                  }
              }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1027,10 +1037,12 @@</span>
                  ByteBuffer message) throws IOException {
              // Make sure that any expected CertificateVerify message
              // has been received and processed.
              if (!shc.isResumption) {
                  if (shc.handshakeConsumers.containsKey(
<span class="udiff-line-added">+                         SSLHandshake.CERTIFICATE.id) ||</span>
<span class="udiff-line-added">+                     shc.handshakeConsumers.containsKey(</span>
                          SSLHandshake.CERTIFICATE_VERIFY.id)) {
                      throw shc.conContext.fatal(Alert.UNEXPECTED_MESSAGE,
                              &quot;Unexpected Finished handshake message&quot;);
                  }
              }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1068,18 +1080,10 @@</span>
                  throw shc.conContext.fatal(Alert.INTERNAL_ERROR,
                          &quot;Not supported key derivation: &quot; +
                          shc.negotiatedProtocol);
              }
  
<span class="udiff-line-removed">-             // Save the session if possible and not stateless</span>
<span class="udiff-line-removed">-             if (!shc.statelessResumption &amp;&amp; !shc.isResumption &amp;&amp;</span>
<span class="udiff-line-removed">-                     shc.handshakeSession.isRejoinable()) {</span>
<span class="udiff-line-removed">-                 SSLSessionContextImpl sessionContext = (SSLSessionContextImpl)</span>
<span class="udiff-line-removed">-                         shc.sslContext.engineGetServerSessionContext();</span>
<span class="udiff-line-removed">-                 sessionContext.put(shc.handshakeSession);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">- </span>
              try {
                  // update the application traffic read keys.
                  SecretKey readSecret = kd.deriveKey(
                          &quot;TlsClientAppTrafficSecret&quot;, null);
  
</pre>
<center><a href="ClientKeyExchange.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="HandshakeContext.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>