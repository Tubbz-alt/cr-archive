<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/ssl/SessionTicketExtension.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="SSLTransport.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="StatusResponseManager.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/ssl/SessionTicketExtension.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
430                 HandshakeMessage message, ByteBuffer buffer)
431                 throws IOException {
432             ServerHandshakeContext shc = (ServerHandshakeContext) context;
433 
434             // Skip if extension is not provided
435             if (!shc.sslConfig.isAvailable(CH_SESSION_TICKET)) {
436                 return;
437             }
438 
439             // Skip consumption if we are already in stateless resumption
440             if (shc.statelessResumption) {
441                 return;
442             }
443             // If the context does not allow stateless tickets, exit
444             SSLSessionContextImpl cache = (SSLSessionContextImpl)shc.sslContext
445                     .engineGetServerSessionContext();
446             if (!cache.statelessEnabled()) {
447                 return;
448             }
449 



450             if (buffer.remaining() == 0) {
<span class="line-removed">451                 shc.statelessResumption = true;</span>
452                 if (SSLLogger.isOn &amp;&amp; SSLLogger.isOn(&quot;ssl,handshake&quot;)) {
453                     SSLLogger.fine(&quot;Client accepts session tickets.&quot;);
454                 }
455                 return;
456             }
457 
458             // Parse the extension.
459             SessionTicketSpec spec = new SessionTicketSpec(shc, buffer);
460             ByteBuffer b = spec.decrypt(shc);
461             if (b != null) {
462                 shc.resumingSession = new SSLSessionImpl(shc, b);
463                 shc.isResumption = true;
<span class="line-removed">464                 shc.statelessResumption = true;</span>
465                 if (SSLLogger.isOn &amp;&amp; SSLLogger.isOn(&quot;ssl,handshake&quot;)) {
466                     SSLLogger.fine(&quot;Valid stateless session ticket found&quot;);
467                 }




468             }
469         }
470     }
471 
472 
473     private static final class T12SHSessionTicketProducer
474             extends SupportedGroups implements HandshakeProducer {
475         T12SHSessionTicketProducer() {
476         }
477 
478         @Override
479         public byte[] produce(ConnectionContext context,
480                 HandshakeMessage message) {
481 
482             ServerHandshakeContext shc = (ServerHandshakeContext)context;
483 
484             // If boolean is false, the CH did not have this extension
485             if (!shc.statelessResumption) {
486                 return null;
487             }
</pre>
</td>
<td>
<hr />
<pre>
430                 HandshakeMessage message, ByteBuffer buffer)
431                 throws IOException {
432             ServerHandshakeContext shc = (ServerHandshakeContext) context;
433 
434             // Skip if extension is not provided
435             if (!shc.sslConfig.isAvailable(CH_SESSION_TICKET)) {
436                 return;
437             }
438 
439             // Skip consumption if we are already in stateless resumption
440             if (shc.statelessResumption) {
441                 return;
442             }
443             // If the context does not allow stateless tickets, exit
444             SSLSessionContextImpl cache = (SSLSessionContextImpl)shc.sslContext
445                     .engineGetServerSessionContext();
446             if (!cache.statelessEnabled()) {
447                 return;
448             }
449 
<span class="line-added">450             // Regardless of session ticket contents, client allows stateless</span>
<span class="line-added">451             shc.statelessResumption = true;</span>
<span class="line-added">452 </span>
453             if (buffer.remaining() == 0) {

454                 if (SSLLogger.isOn &amp;&amp; SSLLogger.isOn(&quot;ssl,handshake&quot;)) {
455                     SSLLogger.fine(&quot;Client accepts session tickets.&quot;);
456                 }
457                 return;
458             }
459 
460             // Parse the extension.
461             SessionTicketSpec spec = new SessionTicketSpec(shc, buffer);
462             ByteBuffer b = spec.decrypt(shc);
463             if (b != null) {
464                 shc.resumingSession = new SSLSessionImpl(shc, b);
465                 shc.isResumption = true;

466                 if (SSLLogger.isOn &amp;&amp; SSLLogger.isOn(&quot;ssl,handshake&quot;)) {
467                     SSLLogger.fine(&quot;Valid stateless session ticket found&quot;);
468                 }
<span class="line-added">469             } else {</span>
<span class="line-added">470                 if (SSLLogger.isOn &amp;&amp; SSLLogger.isOn(&quot;ssl,handshake&quot;)) {</span>
<span class="line-added">471                     SSLLogger.fine(&quot;Invalid stateless session ticket found&quot;);</span>
<span class="line-added">472                 }</span>
473             }
474         }
475     }
476 
477 
478     private static final class T12SHSessionTicketProducer
479             extends SupportedGroups implements HandshakeProducer {
480         T12SHSessionTicketProducer() {
481         }
482 
483         @Override
484         public byte[] produce(ConnectionContext context,
485                 HandshakeMessage message) {
486 
487             ServerHandshakeContext shc = (ServerHandshakeContext)context;
488 
489             // If boolean is false, the CH did not have this extension
490             if (!shc.statelessResumption) {
491                 return null;
492             }
</pre>
</td>
</tr>
</table>
<center><a href="SSLTransport.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="StatusResponseManager.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>