<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/unix/native/libawt/awt/awt_Mlib.c</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../common/java2d/x11/X11TextRenderer_md.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../libawt_xawt/awt/gtk2_interface.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/unix/native/libawt/awt/awt_Mlib.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 23  * questions.
 24  */
 25 
 26 #include &lt;stdlib.h&gt;
 27 #include &lt;string.h&gt;
 28 #include &lt;sys/time.h&gt;
 29 #include &lt;sys/utsname.h&gt;
 30 #include &lt;sys/types.h&gt;
 31 #include &lt;errno.h&gt;
 32 #include &lt;dlfcn.h&gt;
 33 #include &quot;jni.h&quot;
 34 #include &lt;jni_util.h&gt;
 35 #include &quot;jvm_md.h&quot;
 36 #include &quot;awt_Mlib.h&quot;
 37 #include &quot;java_awt_image_BufferedImage.h&quot;
 38 
 39 static void start_timer(int numsec);
 40 static void stop_timer(int numsec, int ntimes);
 41 
 42 /*
<span class="line-modified"> 43  * This is called by awt_ImagingLib.initLib() to figure out if we</span>
<span class="line-removed"> 44  * can use the VIS version of medialib</span>
 45  */
 46 mlib_status awt_getImagingLib(JNIEnv *env, mlibFnS_t *sMlibFns,
 47                               mlibSysFnS_t *sMlibSysFns) {
 48     int status;
 49     jstring jstr = NULL;
 50     mlibFnS_t *mptr;
 51     void *(*vPtr)();
 52     int (*intPtr)();
 53     mlib_status (*fPtr)();
 54     int i;
 55     void *handle = NULL;
 56     mlibSysFnS_t tempSysFns;
 57     static int s_timeIt = 0;
 58     static int s_verbose = 1;
 59     mlib_status ret = MLIB_SUCCESS;
 60     struct utsname name;
 61 
<span class="line-modified"> 62     /*</span>
<span class="line-removed"> 63      * Find out the machine name. If it is an SUN ultra, we</span>
<span class="line-removed"> 64      * can use the vis library</span>
<span class="line-removed"> 65      */</span>
<span class="line-removed"> 66     if ((uname(&amp;name) &gt;= 0) &amp;&amp; (getenv(&quot;NO_VIS&quot;) == NULL) &amp;&amp;</span>
<span class="line-removed"> 67         (strncmp(name.machine, &quot;sun4u&quot; , 5) == 0) ||</span>
<span class="line-removed"> 68         ((strncmp(name.machine, &quot;sun4v&quot; , 5) == 0) &amp;&amp;</span>
<span class="line-removed"> 69          (getenv(&quot;USE_VIS_ON_SUN4V&quot;) != NULL)))</span>
<span class="line-removed"> 70     {</span>
<span class="line-removed"> 71         handle = dlopen(JNI_LIB_NAME(&quot;mlib_image_v&quot;), RTLD_LAZY);</span>
<span class="line-removed"> 72     }</span>
<span class="line-removed"> 73 </span>
<span class="line-removed"> 74     if (handle == NULL) {</span>
<span class="line-removed"> 75         handle = dlopen(JNI_LIB_NAME(&quot;mlib_image&quot;), RTLD_LAZY);</span>
<span class="line-removed"> 76     }</span>
 77 
 78     if (handle == NULL) {
 79         if (s_timeIt || s_verbose) {
 80             printf (&quot;error in dlopen: %s&quot;, dlerror());
 81         }
 82         return MLIB_FAILURE;
 83     }
 84 
 85     /* So, if we are here, then either vis or generic version of
 86      * medialib library was sucessfuly loaded.
 87      * Let&#39;s try to initialize handlers...
 88      */
 89     if ((tempSysFns.createFP = (MlibCreateFP_t)dlsym(handle,
 90                                        &quot;j2d_mlib_ImageCreate&quot;)) == NULL) {
 91         if (s_timeIt) {
 92             printf (&quot;error in dlsym: %s&quot;, dlerror());
 93         }
 94         ret = MLIB_FAILURE;
 95     }
 96 
</pre>
</td>
<td>
<hr />
<pre>
 23  * questions.
 24  */
 25 
 26 #include &lt;stdlib.h&gt;
 27 #include &lt;string.h&gt;
 28 #include &lt;sys/time.h&gt;
 29 #include &lt;sys/utsname.h&gt;
 30 #include &lt;sys/types.h&gt;
 31 #include &lt;errno.h&gt;
 32 #include &lt;dlfcn.h&gt;
 33 #include &quot;jni.h&quot;
 34 #include &lt;jni_util.h&gt;
 35 #include &quot;jvm_md.h&quot;
 36 #include &quot;awt_Mlib.h&quot;
 37 #include &quot;java_awt_image_BufferedImage.h&quot;
 38 
 39 static void start_timer(int numsec);
 40 static void stop_timer(int numsec, int ntimes);
 41 
 42 /*
<span class="line-modified"> 43  * This is called by awt_ImagingLib.initLib()</span>

 44  */
 45 mlib_status awt_getImagingLib(JNIEnv *env, mlibFnS_t *sMlibFns,
 46                               mlibSysFnS_t *sMlibSysFns) {
 47     int status;
 48     jstring jstr = NULL;
 49     mlibFnS_t *mptr;
 50     void *(*vPtr)();
 51     int (*intPtr)();
 52     mlib_status (*fPtr)();
 53     int i;
 54     void *handle = NULL;
 55     mlibSysFnS_t tempSysFns;
 56     static int s_timeIt = 0;
 57     static int s_verbose = 1;
 58     mlib_status ret = MLIB_SUCCESS;
 59     struct utsname name;
 60 
<span class="line-modified"> 61     handle = dlopen(JNI_LIB_NAME(&quot;mlib_image&quot;), RTLD_LAZY);</span>














 62 
 63     if (handle == NULL) {
 64         if (s_timeIt || s_verbose) {
 65             printf (&quot;error in dlopen: %s&quot;, dlerror());
 66         }
 67         return MLIB_FAILURE;
 68     }
 69 
 70     /* So, if we are here, then either vis or generic version of
 71      * medialib library was sucessfuly loaded.
 72      * Let&#39;s try to initialize handlers...
 73      */
 74     if ((tempSysFns.createFP = (MlibCreateFP_t)dlsym(handle,
 75                                        &quot;j2d_mlib_ImageCreate&quot;)) == NULL) {
 76         if (s_timeIt) {
 77             printf (&quot;error in dlsym: %s&quot;, dlerror());
 78         }
 79         ret = MLIB_FAILURE;
 80     }
 81 
</pre>
</td>
</tr>
</table>
<center><a href="../../common/java2d/x11/X11TextRenderer_md.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../libawt_xawt/awt/gtk2_interface.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>