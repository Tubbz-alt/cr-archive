<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/gc/g1/TestGCLogMessages.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../compiler/c2/aarch64/TestVolatilesShenandoah.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestRemsetLoggingTools.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/gc/g1/TestGCLogMessages.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
126         new LogMessageWithLevel(&quot;Universe Roots&quot;, Level.TRACE),
127         new LogMessageWithLevel(&quot;JNI Handles Roots&quot;, Level.TRACE),
128         new LogMessageWithLevel(&quot;ObjectSynchronizer Roots&quot;, Level.TRACE),
129         new LogMessageWithLevel(&quot;Management Roots&quot;, Level.TRACE),
130         new LogMessageWithLevel(&quot;SystemDictionary Roots&quot;, Level.TRACE),
131         new LogMessageWithLevel(&quot;CLDG Roots&quot;, Level.TRACE),
132         new LogMessageWithLevel(&quot;JVMTI Roots&quot;, Level.TRACE),
133         new LogMessageWithLevel(&quot;CM RefProcessor Roots&quot;, Level.TRACE),
134         // Redirty Cards
135         new LogMessageWithLevel(&quot;Redirty Cards&quot;, Level.DEBUG),
136         new LogMessageWithLevel(&quot;Parallel Redirty&quot;, Level.TRACE),
137         new LogMessageWithLevel(&quot;Redirtied Cards&quot;, Level.TRACE),
138         // Misc Top-level
139         new LogMessageWithLevel(&quot;Code Roots Purge&quot;, Level.DEBUG),
140         new LogMessageWithLevel(&quot;String Deduplication&quot;, Level.DEBUG),
141         new LogMessageWithLevel(&quot;Queue Fixup&quot;, Level.DEBUG),
142         new LogMessageWithLevel(&quot;Table Fixup&quot;, Level.DEBUG),
143         new LogMessageWithLevel(&quot;Expand Heap After Collection&quot;, Level.DEBUG),
144         new LogMessageWithLevel(&quot;Region Register&quot;, Level.DEBUG),
145         new LogMessageWithLevel(&quot;Prepare Heap Roots&quot;, Level.DEBUG),

146         // Free CSet
147         new LogMessageWithLevel(&quot;Free Collection Set&quot;, Level.DEBUG),
148         new LogMessageWithLevel(&quot;Serial Free Collection Set&quot;, Level.TRACE),
149         new LogMessageWithLevel(&quot;Parallel Free Collection Set&quot;, Level.TRACE),
150         new LogMessageWithLevel(&quot;Young Free Collection Set&quot;, Level.TRACE),
151         new LogMessageWithLevel(&quot;Non-Young Free Collection Set&quot;, Level.TRACE),
152         // Rebuild Free List
153         new LogMessageWithLevel(&quot;Rebuild Free List&quot;, Level.DEBUG),
154         new LogMessageWithLevel(&quot;Serial Rebuild Free List&quot;, Level.TRACE),
155         new LogMessageWithLevel(&quot;Parallel Rebuild Free List&quot;, Level.TRACE),
156 
157         // Humongous Eager Reclaim
158         new LogMessageWithLevel(&quot;Humongous Reclaim&quot;, Level.DEBUG),
159         // Merge PSS
160         new LogMessageWithLevel(&quot;Merge Per-Thread State&quot;, Level.DEBUG),
161         // TLAB handling
162         new LogMessageWithLevel(&quot;Prepare TLABs&quot;, Level.DEBUG),
163         new LogMessageWithLevel(&quot;Resize TLABs&quot;, Level.DEBUG),
164         // Reference Processing
165         new LogMessageWithLevel(&quot;Reference Processing&quot;, Level.DEBUG),
</pre>
<hr />
<pre>
169         new LogMessageWithLevel(&quot;StringTable weak&quot;, Level.DEBUG),
170         new LogMessageWithLevel(&quot;ResolvedMethodTable weak&quot;, Level.DEBUG),
171         new LogMessageWithLevel(&quot;VM weak&quot;, Level.DEBUG),
172 
173         new LogMessageWithLevelC2OrJVMCIOnly(&quot;DerivedPointerTable Update&quot;, Level.DEBUG),
174         new LogMessageWithLevel(&quot;Start New Collection Set&quot;, Level.DEBUG),
175     };
176 
177     void checkMessagesAtLevel(OutputAnalyzer output, LogMessageWithLevel messages[], Level level) throws Exception {
178         for (LogMessageWithLevel l : messages) {
179             if (level.lessThan(l.level) || !l.isAvailable()) {
180                 output.shouldNotContain(l.message);
181             } else {
182                 output.shouldMatch(&quot;\\[&quot; + l.level + &quot;.*&quot; + l.message);
183             }
184         }
185     }
186 
187     public static void main(String[] args) throws Exception {
188         new TestGCLogMessages().testNormalLogs();

189         new TestGCLogMessages().testWithToSpaceExhaustionLogs();
190         new TestGCLogMessages().testWithInitialMark();
191         new TestGCLogMessages().testExpandHeap();
192     }
193 
194     private void testNormalLogs() throws Exception {
195 
196         ProcessBuilder pb = ProcessTools.createJavaProcessBuilder(&quot;-XX:+UseG1GC&quot;,
197                                                                   &quot;-Xmx10M&quot;,
198                                                                   GCTest.class.getName());
199 
200         OutputAnalyzer output = new OutputAnalyzer(pb.start());
201         checkMessagesAtLevel(output, allLogMessages, Level.OFF);
202         output.shouldHaveExitValue(0);
203 
204         pb = ProcessTools.createJavaProcessBuilder(&quot;-XX:+UseG1GC&quot;,
205                                                    &quot;-XX:+UseStringDeduplication&quot;,
206                                                    &quot;-Xmx10M&quot;,
207                                                    &quot;-Xlog:gc+phases=debug&quot;,
208                                                    GCTest.class.getName());
209 
210         output = new OutputAnalyzer(pb.start());
211         checkMessagesAtLevel(output, allLogMessages, Level.DEBUG);
212 
213         pb = ProcessTools.createJavaProcessBuilder(&quot;-XX:+UseG1GC&quot;,
214                                                    &quot;-XX:+UseStringDeduplication&quot;,
215                                                    &quot;-Xmx10M&quot;,
216                                                    &quot;-Xlog:gc+phases=trace&quot;,
217                                                    GCTest.class.getName());
218 
219         output = new OutputAnalyzer(pb.start());
220         checkMessagesAtLevel(output, allLogMessages, Level.TRACE);
221         output.shouldHaveExitValue(0);
222     }
223 

















224     LogMessageWithLevel exhFailureMessages[] = new LogMessageWithLevel[] {
225         new LogMessageWithLevel(&quot;Evacuation Failure&quot;, Level.DEBUG),
226         new LogMessageWithLevel(&quot;Recalculate Used&quot;, Level.TRACE),
227         new LogMessageWithLevel(&quot;Remove Self Forwards&quot;, Level.TRACE),
228     };
229 
230     private void testWithToSpaceExhaustionLogs() throws Exception {
231         ProcessBuilder pb = ProcessTools.createJavaProcessBuilder(&quot;-XX:+UseG1GC&quot;,
232                                                                   &quot;-Xmx32M&quot;,
233                                                                   &quot;-Xmn16M&quot;,
234                                                                   &quot;-Xlog:gc+phases=debug&quot;,
235                                                                   GCTestWithToSpaceExhaustion.class.getName());
236 
237         OutputAnalyzer output = new OutputAnalyzer(pb.start());
238         checkMessagesAtLevel(output, exhFailureMessages, Level.DEBUG);
239         output.shouldHaveExitValue(0);
240 
241         pb = ProcessTools.createJavaProcessBuilder(&quot;-XX:+UseG1GC&quot;,
242                                                    &quot;-Xmx32M&quot;,
243                                                    &quot;-Xmn16M&quot;,
</pre>
</td>
<td>
<hr />
<pre>
126         new LogMessageWithLevel(&quot;Universe Roots&quot;, Level.TRACE),
127         new LogMessageWithLevel(&quot;JNI Handles Roots&quot;, Level.TRACE),
128         new LogMessageWithLevel(&quot;ObjectSynchronizer Roots&quot;, Level.TRACE),
129         new LogMessageWithLevel(&quot;Management Roots&quot;, Level.TRACE),
130         new LogMessageWithLevel(&quot;SystemDictionary Roots&quot;, Level.TRACE),
131         new LogMessageWithLevel(&quot;CLDG Roots&quot;, Level.TRACE),
132         new LogMessageWithLevel(&quot;JVMTI Roots&quot;, Level.TRACE),
133         new LogMessageWithLevel(&quot;CM RefProcessor Roots&quot;, Level.TRACE),
134         // Redirty Cards
135         new LogMessageWithLevel(&quot;Redirty Cards&quot;, Level.DEBUG),
136         new LogMessageWithLevel(&quot;Parallel Redirty&quot;, Level.TRACE),
137         new LogMessageWithLevel(&quot;Redirtied Cards&quot;, Level.TRACE),
138         // Misc Top-level
139         new LogMessageWithLevel(&quot;Code Roots Purge&quot;, Level.DEBUG),
140         new LogMessageWithLevel(&quot;String Deduplication&quot;, Level.DEBUG),
141         new LogMessageWithLevel(&quot;Queue Fixup&quot;, Level.DEBUG),
142         new LogMessageWithLevel(&quot;Table Fixup&quot;, Level.DEBUG),
143         new LogMessageWithLevel(&quot;Expand Heap After Collection&quot;, Level.DEBUG),
144         new LogMessageWithLevel(&quot;Region Register&quot;, Level.DEBUG),
145         new LogMessageWithLevel(&quot;Prepare Heap Roots&quot;, Level.DEBUG),
<span class="line-added">146         new LogMessageWithLevel(&quot;Concatenate Dirty Card Logs&quot;, Level.DEBUG),</span>
147         // Free CSet
148         new LogMessageWithLevel(&quot;Free Collection Set&quot;, Level.DEBUG),
149         new LogMessageWithLevel(&quot;Serial Free Collection Set&quot;, Level.TRACE),
150         new LogMessageWithLevel(&quot;Parallel Free Collection Set&quot;, Level.TRACE),
151         new LogMessageWithLevel(&quot;Young Free Collection Set&quot;, Level.TRACE),
152         new LogMessageWithLevel(&quot;Non-Young Free Collection Set&quot;, Level.TRACE),
153         // Rebuild Free List
154         new LogMessageWithLevel(&quot;Rebuild Free List&quot;, Level.DEBUG),
155         new LogMessageWithLevel(&quot;Serial Rebuild Free List&quot;, Level.TRACE),
156         new LogMessageWithLevel(&quot;Parallel Rebuild Free List&quot;, Level.TRACE),
157 
158         // Humongous Eager Reclaim
159         new LogMessageWithLevel(&quot;Humongous Reclaim&quot;, Level.DEBUG),
160         // Merge PSS
161         new LogMessageWithLevel(&quot;Merge Per-Thread State&quot;, Level.DEBUG),
162         // TLAB handling
163         new LogMessageWithLevel(&quot;Prepare TLABs&quot;, Level.DEBUG),
164         new LogMessageWithLevel(&quot;Resize TLABs&quot;, Level.DEBUG),
165         // Reference Processing
166         new LogMessageWithLevel(&quot;Reference Processing&quot;, Level.DEBUG),
</pre>
<hr />
<pre>
170         new LogMessageWithLevel(&quot;StringTable weak&quot;, Level.DEBUG),
171         new LogMessageWithLevel(&quot;ResolvedMethodTable weak&quot;, Level.DEBUG),
172         new LogMessageWithLevel(&quot;VM weak&quot;, Level.DEBUG),
173 
174         new LogMessageWithLevelC2OrJVMCIOnly(&quot;DerivedPointerTable Update&quot;, Level.DEBUG),
175         new LogMessageWithLevel(&quot;Start New Collection Set&quot;, Level.DEBUG),
176     };
177 
178     void checkMessagesAtLevel(OutputAnalyzer output, LogMessageWithLevel messages[], Level level) throws Exception {
179         for (LogMessageWithLevel l : messages) {
180             if (level.lessThan(l.level) || !l.isAvailable()) {
181                 output.shouldNotContain(l.message);
182             } else {
183                 output.shouldMatch(&quot;\\[&quot; + l.level + &quot;.*&quot; + l.message);
184             }
185         }
186     }
187 
188     public static void main(String[] args) throws Exception {
189         new TestGCLogMessages().testNormalLogs();
<span class="line-added">190         new TestGCLogMessages().testConcurrentRefinementLogs();</span>
191         new TestGCLogMessages().testWithToSpaceExhaustionLogs();
192         new TestGCLogMessages().testWithInitialMark();
193         new TestGCLogMessages().testExpandHeap();
194     }
195 
196     private void testNormalLogs() throws Exception {
197 
198         ProcessBuilder pb = ProcessTools.createJavaProcessBuilder(&quot;-XX:+UseG1GC&quot;,
199                                                                   &quot;-Xmx10M&quot;,
200                                                                   GCTest.class.getName());
201 
202         OutputAnalyzer output = new OutputAnalyzer(pb.start());
203         checkMessagesAtLevel(output, allLogMessages, Level.OFF);
204         output.shouldHaveExitValue(0);
205 
206         pb = ProcessTools.createJavaProcessBuilder(&quot;-XX:+UseG1GC&quot;,
207                                                    &quot;-XX:+UseStringDeduplication&quot;,
208                                                    &quot;-Xmx10M&quot;,
209                                                    &quot;-Xlog:gc+phases=debug&quot;,
210                                                    GCTest.class.getName());
211 
212         output = new OutputAnalyzer(pb.start());
213         checkMessagesAtLevel(output, allLogMessages, Level.DEBUG);
214 
215         pb = ProcessTools.createJavaProcessBuilder(&quot;-XX:+UseG1GC&quot;,
216                                                    &quot;-XX:+UseStringDeduplication&quot;,
217                                                    &quot;-Xmx10M&quot;,
218                                                    &quot;-Xlog:gc+phases=trace&quot;,
219                                                    GCTest.class.getName());
220 
221         output = new OutputAnalyzer(pb.start());
222         checkMessagesAtLevel(output, allLogMessages, Level.TRACE);
223         output.shouldHaveExitValue(0);
224     }
225 
<span class="line-added">226     LogMessageWithLevel concRefineMessages[] = new LogMessageWithLevel[] {</span>
<span class="line-added">227         new LogMessageWithLevel(&quot;Mutator refinement: &quot;, Level.DEBUG),</span>
<span class="line-added">228         new LogMessageWithLevel(&quot;Concurrent refinement: &quot;, Level.DEBUG),</span>
<span class="line-added">229         new LogMessageWithLevel(&quot;Total refinement: &quot;, Level.DEBUG),</span>
<span class="line-added">230         // &quot;Concurrent refinement rate&quot; optionally printed if any.</span>
<span class="line-added">231         // &quot;Generate dirty cards rate&quot; optionally printed if any.</span>
<span class="line-added">232     };</span>
<span class="line-added">233 </span>
<span class="line-added">234     private void testConcurrentRefinementLogs() throws Exception {</span>
<span class="line-added">235         ProcessBuilder pb = ProcessTools.createJavaProcessBuilder(&quot;-XX:+UseG1GC&quot;,</span>
<span class="line-added">236                                                                   &quot;-Xmx10M&quot;,</span>
<span class="line-added">237                                                                   &quot;-Xlog:gc+refine+stats=debug&quot;,</span>
<span class="line-added">238                                                                   GCTest.class.getName());</span>
<span class="line-added">239         OutputAnalyzer output = new OutputAnalyzer(pb.start());</span>
<span class="line-added">240         checkMessagesAtLevel(output, concRefineMessages, Level.DEBUG);</span>
<span class="line-added">241     }</span>
<span class="line-added">242 </span>
243     LogMessageWithLevel exhFailureMessages[] = new LogMessageWithLevel[] {
244         new LogMessageWithLevel(&quot;Evacuation Failure&quot;, Level.DEBUG),
245         new LogMessageWithLevel(&quot;Recalculate Used&quot;, Level.TRACE),
246         new LogMessageWithLevel(&quot;Remove Self Forwards&quot;, Level.TRACE),
247     };
248 
249     private void testWithToSpaceExhaustionLogs() throws Exception {
250         ProcessBuilder pb = ProcessTools.createJavaProcessBuilder(&quot;-XX:+UseG1GC&quot;,
251                                                                   &quot;-Xmx32M&quot;,
252                                                                   &quot;-Xmn16M&quot;,
253                                                                   &quot;-Xlog:gc+phases=debug&quot;,
254                                                                   GCTestWithToSpaceExhaustion.class.getName());
255 
256         OutputAnalyzer output = new OutputAnalyzer(pb.start());
257         checkMessagesAtLevel(output, exhFailureMessages, Level.DEBUG);
258         output.shouldHaveExitValue(0);
259 
260         pb = ProcessTools.createJavaProcessBuilder(&quot;-XX:+UseG1GC&quot;,
261                                                    &quot;-Xmx32M&quot;,
262                                                    &quot;-Xmn16M&quot;,
</pre>
</td>
</tr>
</table>
<center><a href="../../compiler/c2/aarch64/TestVolatilesShenandoah.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestRemsetLoggingTools.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>