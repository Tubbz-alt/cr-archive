<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/nashorn/script/basic/optimistic_check_type.js</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2014, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /**
 25  * @test
 26  * @bug 8036987, 8037572
 27  * @summary Implement tests that checks static types in the compiled code
 28  * @option --optimistic-types=true
 29  * @run
 30  */
 31 
 32 var inspect = Java.type(&quot;jdk.nashorn.test.tools.StaticTypeInspector&quot;).inspect
 33 var a=3, b=2.3, c=true, d;
 34 var x = { a: 2, b:0, c:undefined}
 35 var trees = new Array(&quot;redwood&quot;, &quot;bay&quot;, &quot;cedar&quot;, &quot;oak&quot;);
 36 
 37 // Testing conditional operator
 38 print(inspect(&quot;&quot; ? b : x.a, &quot;ternary operator&quot;))
 39 var b1 = b;
 40 print(inspect(x.b ? b1 : x.a, &quot;ternary operator&quot;))
 41 var b2 = b;
 42 print(inspect(c ? b2 : a, &quot;ternary operator&quot;))
 43 var b3 = b;
 44 print(inspect(!c ? b3 : a, &quot;ternary operator&quot;))
 45 var b4 = b;
 46 print(inspect(d ? b4 : x.c, &quot;ternary operator&quot;))
 47 print(inspect(x.c ? a : c, &quot;ternary operator&quot;))
 48 print(inspect(c ? d : a, &quot;ternary operator&quot;))
 49 var b5 = b;
 50 print(inspect(c ? +a : b5, &quot;ternary operator&quot;))
 51 
 52 // Testing format methods
 53 print(inspect(b.toFixed(2), &quot;global double toFixed()&quot;))
 54 print(inspect(b.toPrecision(2)/1, &quot;global double toPrecision() divided by 1&quot;))
 55 print(inspect(b.toExponential(2), &quot;global double toExponential()&quot;))
 56 
 57 // Testing arrays
 58 print(inspect(trees[1], &quot;member object&quot;))
 59 trees[1] = undefined;
 60 print(inspect(trees[1], &quot;member undefined&quot;))
 61 var b6=b;
 62 print(inspect(1 in trees ? b6 : a, &quot;conditional on array member&quot;))
 63 delete trees[2]
 64 var b7=b;
 65 print(inspect(2 in trees ? b7 : a, &quot;conditional on array member&quot;))
 66 print(inspect(3 in trees ? trees[2]=&quot;bay&quot; : a, &quot;conditional on array member&quot;))
 67 var b8=b;
 68 print(inspect(&quot;oak&quot; in trees ? b8 : a, &quot;conditional on array member&quot;))
 69 
 70 // Testing nested functions and return value
 71 function f1() {
 72     var x = 2, y = 1;
 73     function g() {
 74         print(inspect(x, &quot;outer local variable&quot;));
 75         print(inspect(a, &quot;global variable&quot;));
 76         print(inspect(x*y, &quot;outer local int multiplication by outer local int&quot;));
 77         print(inspect(a*d, &quot;global int multiplication by global undefined&quot;));
 78     }
 79     g()
 80 }
 81 f1()
 82 
 83 function f2(a,b,c) {
 84     g = (a+b) * c;
 85     print(inspect(c, &quot;local undefined&quot;));
 86     print(inspect(a+b, &quot;local undefined addition local undefined&quot;));
 87     print(inspect(g, &quot;local undefined multiplication by undefined&quot;));
 88 }
 89 f2()
 90 
 91 function f3(a,b) {
 92     g = a &amp;&amp; b;
 93     print(inspect(g, &quot;local undefined AND local undefined&quot;));
 94     print(inspect(c||g, &quot;global true OR local undefined&quot;));
 95 }
 96 f3()
 97 
 98 function f4() {
 99     var x = true, y = 0;
100     function g() {
101         print(inspect(x+y, &quot;outer local true addition local int&quot;));
102         print(inspect(a+x, &quot;global int addition outer local true&quot;));
103         print(inspect(x*y, &quot;outer local true multiplication by outer local int&quot;));
104         print(inspect(y*d, &quot;outer local int multiplication by global undefined&quot;));
105     }
106     g()
107 }
108 f4()
    </pre>
  </body>
</html>