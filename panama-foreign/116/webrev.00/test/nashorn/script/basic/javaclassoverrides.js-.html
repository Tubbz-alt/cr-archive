<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/nashorn/script/basic/javaclassoverrides.js</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
  <body>
    <pre>
 1 /*
 2  * Copyright (c) 2010, 2013, Oracle and/or its affiliates. All rights reserved.
 3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 4  *
 5  * This code is free software; you can redistribute it and/or modify it
 6  * under the terms of the GNU General Public License version 2 only, as
 7  * published by the Free Software Foundation.
 8  *
 9  * This code is distributed in the hope that it will be useful, but WITHOUT
10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
12  * version 2 for more details (a copy is included in the LICENSE file that
13  * accompanied this code).
14  *
15  * You should have received a copy of the GNU General Public License version
16  * 2 along with this work; if not, write to the Free Software Foundation,
17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
18  *
19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
20  * or visit www.oracle.com if you need additional information or have any
21  * questions.
22  */
23 
24 /**
25  * Check behavior of class-level overrides.
26  *
27  * @test
28  * @run
29  */
30 
31 
32 // Make two classes with class overrides
33 
34 var R1 = Java.extend(java.lang.Runnable, {
35     run: function() {
36         print(&quot;R1.run() invoked&quot;)
37     }
38 })
39 
40 var R2 = Java.extend(java.lang.Runnable, {
41     run: function() {
42         print(&quot;R2.run() invoked&quot;)
43     }
44 })
45 
46 var r1 = new R1
47 var r2 = new R2
48 // Create one with an instance-override too
49 var R3 = Java.extend(R2)
50 var r3 = new R3({ run: function() { print(&quot;r3.run() invoked&quot;) }})
51 
52 // Run &#39;em - we&#39;re passing them through a Thread to make sure they indeed
53 // are full-blown Runnables
54 function runInThread(r) {
55     var t = new java.lang.Thread(r)
56     t.start()
57     t.join()
58 }
59 runInThread(r1)
60 runInThread(r2)
61 runInThread(r3)
62 
63 // Two class-override classes differ
64 print(&quot;r1.class !== r2.class: &quot; + (r1.class !== r2.class))
65 // instance-override class also differs
66 print(&quot;r2.class !== r3.class: &quot; + (r2.class !== r3.class))
67 
68 function checkAbstract(r) {
69     try {
70         r.run()
71         print(&quot;Expected to fail!&quot;)
72     } catch(e) {
73         print(&quot;Got exception: &quot; + e)
74     }
75 }
76 
77 // Check we&#39;re hitting UnsupportedOperationException if neither class
78 // overrides nor instance overrides are present
79 var RAbstract = Java.extend(java.lang.Runnable, {})
80 checkAbstract(new RAbstract()) // class override (empty)
81 checkAbstract(new (Java.extend(RAbstract))() {}) // class+instance override (empty)
82 
83 // Check we delegate to superclass if neither class
84 // overrides nor instance overrides are present
85 var ExtendsList = Java.extend(java.util.ArrayList, {})
86 print(&quot;(new ExtendsList).size() = &quot; + (new ExtendsList).size())
87 print(&quot;(new (Java.extend(ExtendsList)){}).size() = &quot; + (new (Java.extend(ExtendsList)){}).size())
    </pre>
  </body>
</html>