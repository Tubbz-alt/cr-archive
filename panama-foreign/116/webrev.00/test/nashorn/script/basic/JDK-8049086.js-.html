<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/nashorn/script/basic/JDK-8049086.js</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2014, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /**
 25  * JDK-8049086: Minor API convenience functions on &quot;Java&quot; object
 26  *
 27  * @test
 28  * @run
 29  */
 30 
 31 var System = Java.type(&quot;java.lang.System&quot;);
 32 var out = System.out;
 33 var println = out.println;
 34 var getProperty = System.getProperty;
 35 var File = Java.type(&quot;java.io.File&quot;)[&quot;(String)&quot;];
 36 
 37 print(&quot;println is java method? &quot; + Java.isJavaMethod(println));
 38 print(&quot;println is script function? &quot; + Java.isScriptFunction(println));
 39 print(&quot;getProperty is java method? &quot; + Java.isJavaMethod(getProperty));
 40 print(&quot;getProperty is script function? &quot; + Java.isScriptFunction(getProperty));
 41 print(&quot;File is java method? &quot; + Java.isJavaMethod(File));
 42 print(&quot;File is script function? &quot; + Java.isScriptFunction(File));
 43 
 44 print(&quot;eval is script function? &quot; + Java.isScriptFunction(eval));
 45 print(&quot;eval is java method? &quot; + Java.isJavaMethod(eval));
 46 function hello() {}
 47 print(&quot;hello is script function? &quot; + Java.isScriptFunction(hello));
 48 print(&quot;hello is java method? &quot; + Java.isJavaMethod(hello));
 49 
 50 print(&quot;out is script object? &quot; + Java.isScriptObject(out));
 51 print(&quot;System is script object? &quot; + Java.isScriptObject(System));
 52 print(&quot;Object is script object? &quot; + Java.isScriptObject(Object));
 53 print(&quot;{} is script object? &quot; + Java.isScriptObject({}));
 54 print(&quot;/foo/ is script object? &quot; + Java.isScriptObject(/foo/));
 55 
 56 // Java function is anything whose &#39;typeof&#39; is &#39;function&#39; but it is not
 57 // a script function! This includes:
 58 // (a) Java methods (b) Java classes (as these respond to new)
 59 // (c) FunctionalInterface objects (d) JSObjects that are &#39;functions&#39;
 60 
 61 print(&quot;java.lang.String is java function? &quot; + Java.isJavaFunction(java.lang.String));
 62 print(&quot;java.lang.Runnable instance is java function? &quot;
 63     + Java.isJavaFunction(new java.lang.Runnable(function() {})));
 64 print(&quot;eval is java function? &quot; + Java.isJavaFunction(eval));
 65 print(&quot;println is java function? &quot; + Java.isJavaFunction(println));
 66 print(&quot;getProperty is java function? &quot; + Java.isJavaFunction(getProperty));
 67 
 68 var JSObject = Java.type(&quot;jdk.nashorn.api.scripting.JSObject&quot;);
 69 print(&quot;callable JSObject is function? &quot; +
 70     Java.isJavaFunction(new JSObject() {
 71         isFunction: function() true,
 72         call: function() {}
 73     })
 74 );
 75 
 76 print(&quot;Non callable JSObject is function? &quot; +
 77     Java.isJavaFunction(new JSObject() {
 78         isFunction: function() false,
 79     })
 80 );
 81 
 82 // synchronized function
 83 var lock = new java.lang.Object();
 84 
 85 print(&quot;lock is java object? &quot; + Java.isJavaObject(lock));
 86 print(&quot;eval is java object? &quot; + Java.isJavaObject(eval));
 87 print(&quot;{} is java object? &quot; + Java.isJavaObject({}));
 88 print(&quot;/foo/ is java object? &quot; + Java.isJavaObject(/foo/));
 89 print(&quot;[] is java object? &quot; + Java.isJavaObject([]));
 90 print(&quot;java.io.File is java object? &quot; + Java.isJavaObject(java.io.File));
 91 
 92 // synchornized function checks
 93 Java.synchronized(function() {
 94     var th = new java.lang.Thread(Java.synchronized(function() {
 95         print(&quot;new thread&quot;);
 96         print(&quot;notifying..&quot;);
 97         lock.notifyAll();
 98     }, lock));
 99     th.start();
100     print(&quot;about to wait..&quot;);
101     lock.wait();
102     th.join();
103     print(&quot;done waiting!&quot;);
104 }, lock)();
105 
106 // try Mozilla &quot;sync&quot; as well
107 load(&quot;nashorn:mozilla_compat.js&quot;);
108 sync(function() {
109     var th = new java.lang.Thread(sync(function() {
110         print(&quot;new thread&quot;);
111         print(&quot;notifying..&quot;);
112         lock.notifyAll();
113     }, lock));
114     th.start();
115     print(&quot;about to wait..&quot;);
116     lock.wait();
117     th.join();
118     print(&quot;done waiting!&quot;);
119 }, lock)();
120 
121 function expectTypeError(func) {
122     try {
123         func();
124         throw new Error(&quot;should have thrown TypeError&quot;);
125     } catch (e) {
126         if (! (e instanceof TypeError)) {
127             fail(&quot;Expected TypeError, got &quot; +e);
128         }
129         print(e);
130     }
131 }
132 
133 expectTypeError(function() Java.synchronized(232));
134 expectTypeError(function() sync(232));
135 expectTypeError(function() Java.synchronized({}));
136 expectTypeError(function() sync({}));
137 expectTypeError(function() Java.synchronized([]));
138 expectTypeError(function() sync([]));
139 expectTypeError(function() Java.synchronized(&quot;hello&quot;));
140 expectTypeError(function() sync(&quot;hello&quot;));
141 expectTypeError(function() Java.synchronized(null));
142 expectTypeError(function() sync(null));
143 expectTypeError(function() Java.synchronized(undefined));
144 expectTypeError(function() sync(undefined));
    </pre>
  </body>
</html>