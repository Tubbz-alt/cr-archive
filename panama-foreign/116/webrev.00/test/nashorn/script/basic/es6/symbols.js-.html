<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/nashorn/script/basic/es6/symbols.js</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2015, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  * 
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  * 
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  * 
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  * 
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /**
 25  * JDK-8141702: Add support for Symbol property keys
 26  *
 27  * @test
 28  * @run
 29  * @option --language=es6
 30  */
 31 
 32 Assert.assertTrue(typeof Symbol === &#39;function&#39;);
 33 Assert.assertTrue(typeof Symbol() === &#39;symbol&#39;);
 34 
 35 Assert.assertTrue(Symbol().toString() === &#39;Symbol()&#39;);
 36 Assert.assertTrue(Symbol(&#39;foo&#39;).toString() === &#39;Symbol(foo)&#39;);
 37 Assert.assertTrue(Symbol(1).toString() === &#39;Symbol(1)&#39;);
 38 Assert.assertTrue(Symbol(true).toString() === &#39;Symbol(true)&#39;);
 39 Assert.assertTrue(Symbol([1, 2, 3]).toString() === &#39;Symbol(1,2,3)&#39;);
 40 Assert.assertTrue(Symbol(null).toString() === &#39;Symbol(null)&#39;);
 41 Assert.assertTrue(Symbol(undefined).toString() === &#39;Symbol()&#39;);
 42 
 43 const s1 = Symbol();
 44 const s2 = Symbol(&quot;s2&quot;);
 45 Assert.assertFalse(s1 instanceof Symbol); // not an object
 46 
 47 let obj = {};
 48 obj[&#39;foo&#39;] = &#39;foo&#39;;
 49 obj[s1] = s1;
 50 obj[&#39;bar&#39;] = &#39;bar&#39;;
 51 obj[1] = 1;
 52 obj[s2] = s2;
 53 
 54 Assert.assertTrue(obj[&#39;foo&#39;] === &#39;foo&#39;);
 55 Assert.assertTrue(obj[s1] === s1);
 56 Assert.assertTrue(obj[&#39;bar&#39;] === &#39;bar&#39;);
 57 Assert.assertTrue(obj[1] === 1);
 58 Assert.assertTrue(obj[s2] === s2);
 59 
 60 const expectedNames = [&#39;1&#39;, &#39;foo&#39;, &#39;bar&#39;];
 61 const expectedSymbols = [s1, s2];
 62 const actualNames = Object.getOwnPropertyNames(obj);
 63 let actualSymbols = Object.getOwnPropertySymbols(obj);
 64 Assert.assertTrue(expectedNames.length == actualNames.length);
 65 Assert.assertTrue(expectedSymbols.length == actualSymbols.length);
 66 
 67 for (let key in expectedNames) {
 68     Assert.assertTrue(expectedNames[key] === actualNames[key]);
 69 }
 70 for (let key in expectedSymbols) {
 71     Assert.assertTrue(expectedSymbols[key] === actualSymbols[key]);
 72 }
 73 
 74 // Delete
 75 Assert.assertTrue(delete obj[s1]);
 76 Assert.assertTrue(Object.getOwnPropertySymbols(obj).length === 1);
 77 Assert.assertTrue(Object.getOwnPropertySymbols(obj)[0] === s2);
 78 
 79 // Object.defineProperty
 80 Object.defineProperty(obj, s1, {value : &#39;hello&#39;});
 81 Assert.assertTrue(obj[s1] === &#39;hello&#39;);
 82 actualSymbols = Object.getOwnPropertySymbols(obj);
 83 Assert.assertTrue(Object.getOwnPropertySymbols(obj).length === 2);
 84 Assert.assertTrue(Object.getOwnPropertySymbols(obj)[1] === s1);
 85 
 86 // Symbol called as constructor
 87 try {
 88     new Symbol();
 89     Assert.fail(&quot;Symbol invoked as constructor&quot;);
 90 } catch (e) {
 91     if (e.name !== &quot;TypeError&quot; || e.message !== &quot;Symbol is not a constructor.&quot;) {
 92         Assert.fail(&quot;Unexpected error: &quot; + e);
 93     }
 94 }
 95 
 96 // Implicit conversion to string or number should throw
 97 try {
 98     &#39; &#39; + s1;
 99     Assert.fail(&quot;Symbol converted to string&quot;);
100 } catch (e) {
101     if (e.name !== &quot;TypeError&quot; || e.message !== &quot;Can not convert Symbol value to string.&quot;) {
102         Assert.fail(&quot;Unexpected error: &quot; + e);
103     }
104 }
105 
106 try {
107     4 * s1;
108     Assert.fail(&quot;Symbol converted to number&quot;);
109 } catch (e) {
110     if (e.name !== &quot;TypeError&quot; || e.message !== &quot;Can not convert Symbol value to number.&quot;) {
111         Assert.fail(&quot;Unexpected error: &quot; + e);
112     }
113 }
114 
115 // Symbol.for and Symbol.keyFor
116 
117 const uncached = Symbol(&#39;foo&#39;);
118 const cached = Symbol.for(&#39;foo&#39;);
119 
120 Assert.assertTrue(uncached !== cached);
121 Assert.assertTrue(Symbol.keyFor(uncached) === undefined);
122 Assert.assertTrue(Symbol.keyFor(cached) === &#39;foo&#39;);
123 Assert.assertTrue(cached === Symbol.for(&#39;foo&#39;));
124 Assert.assertTrue(cached === Symbol.for(&#39;f&#39; + &#39;oo&#39;));
125 
126 // JDK-8147008: Make sure symbols are handled by primitive linker
127 Symbol.prototype.foo = 123;
128 Symbol.prototype[s2] = s2;
129 Assert.assertEquals(s1.foo, 123);
130 Assert.assertEquals(s2[s2], s2);
131 
132 // Object wrapper
133 
134 const o = Object(s1);
135 obj = {};
136 obj[s1] = &quot;s1&quot;;
137 Assert.assertTrue(o == s1);
138 Assert.assertTrue(o !== s1);
139 Assert.assertTrue(typeof o === &#39;object&#39;);
140 Assert.assertTrue(o instanceof Symbol);
141 Assert.assertTrue(obj[o] == &#39;s1&#39;);
142 Assert.assertTrue(o in obj);
143 Assert.assertEquals(o.foo, 123);
144 Assert.assertEquals(o[s2], s2);
145 
146 // various non-strict comparisons that should fail
147 
148 Assert.assertFalse(0 == Symbol());
149 Assert.assertFalse(1 == Symbol(1));
150 Assert.assertFalse(null == Symbol());
151 Assert.assertFalse(undefined == Symbol);
152 Assert.assertFalse(&#39;Symbol()&#39; == Symbol());
153 Assert.assertFalse(&#39;Symbol(foo)&#39; == Symbol(&#39;foo&#39;));
154 
    </pre>
  </body>
</html>