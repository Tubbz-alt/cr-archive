<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/nashorn/script/nosecurity/treeapi/utils.js</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2015, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /**
 25  *
 26  * @subtest
 27  */
 28 
 29 var parser = Java.type(&#39;jdk.nashorn.api.tree.Parser&#39;);
 30 var tree = Java.type(&#39;jdk.nashorn.api.tree.Tree&#39;);
 31 var list = Java.type(&#39;java.util.List&#39;);
 32 var visitor = Java.type(&#39;jdk.nashorn.api.tree.SimpleTreeVisitorES5_1&#39;);
 33 var visitor_es6 = Java.type(&#39;jdk.nashorn.api.tree.SimpleTreeVisitorES6&#39;);
 34 var file = Java.type(&#39;java.io.File&#39;)
 35 var cls = Java.type(&#39;java.lang.Class&#39;)
 36 
 37 function convert (value) {
 38     if (!value || typeof(value) != &#39;object&#39;) {
 39         return value;
 40     }
 41     var  obj = Object.bindProperties({}, value)
 42     var result = {}
 43     for (var i in obj) {
 44         if (i == &quot;lineMap&quot;) {
 45             continue;
 46         }
 47 
 48         var val = obj[i]
 49         // skip these ES6 specific properties to reduce noise
 50         // in the output - unless there were set to true
 51         if (typeof(val) == &#39;boolean&#39; &amp;&amp; val == false) {
 52             switch (i) {
 53                 case &quot;computed&quot;:
 54                 case &quot;static&quot;:
 55                 case &quot;restParameter&quot;:
 56                 case &quot;this&quot;:
 57                 case &quot;super&quot;:
 58                 case &quot;star&quot;:
 59                 case &quot;default&quot;:
 60                 case &quot;starDefaultStar&quot;:
 61                 case &quot;arrow&quot;:
 62                 case &quot;generator&quot;:
 63                 case &quot;let&quot;:
 64                 case &quot;const&quot;:
 65                     continue;
 66              }
 67         }
 68 
 69         if (typeof(val) == &#39;object&#39;) {
 70             if (val instanceof cls) {
 71                 continue;
 72             }
 73             if (val instanceof tree) {
 74                 result[i] = convert(val)
 75             }
 76             else if (val instanceof list) {
 77                 var lst = []
 78                 for (var j in val) {
 79                     lst.push(convert(val[j]))
 80                 }
 81                 result[i] = lst
 82             }
 83             else {
 84                 result[i] = String(val)
 85             }
 86         } else if (typeof(val) != &#39;function&#39;) {
 87             result[i] = String(val)
 88         }
 89     }
 90     return result
 91 }
 92 
 93 function parse(name, code, args, visitor, listener) {
 94     var tree =  parser.create(args).parse(name, code, listener || null)
 95     var results = []
 96     tree.accept(visitor, results)
 97     print(JSON.stringify(results, null, 2))
 98 }
 99 
100 function parseModule(name, code) {
101     return parser.create(&quot;--es6-module&quot;).parse(name, code, null);
102 }
103 
104 function parseDiagnostic (code, args) {
105     var messages = new Array()
106     var tree = parser.create(args).parse(&quot;test.js&quot;,  code, function (message) {
107         messages.push(convert(message))
108     })
109     print(JSON.stringify(messages, null, 2).replace(/\\r/g, &#39;&#39;))
110 }
    </pre>
  </body>
</html>