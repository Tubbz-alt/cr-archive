<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/nashorn/src/jdk/nashorn/api/javaaccess/test/ObjectAccessTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2010, 2013, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.nashorn.api.javaaccess.test;
 27 
 28 import static org.testng.AssertJUnit.assertEquals;
 29 import static org.testng.internal.junit.ArrayAsserts.assertArrayEquals;
 30 import javax.script.ScriptEngine;
 31 import javax.script.ScriptEngineManager;
 32 import javax.script.ScriptException;
 33 import org.testng.TestNG;
 34 import org.testng.annotations.AfterClass;
 35 import org.testng.annotations.BeforeClass;
 36 import org.testng.annotations.Test;
 37 
 38 /**
 39  * @test
 40  * @build jdk.nashorn.api.javaaccess.test.SharedObject jdk.nashorn.api.javaaccess.test.Person jdk.nashorn.api.javaaccess.test.ObjectAccessTest
 41  * @run testng/othervm jdk.nashorn.api.javaaccess.test.ObjectAccessTest
 42  */
 43 @SuppressWarnings(&quot;javadoc&quot;)
 44 public class ObjectAccessTest {
 45 
 46     private static ScriptEngine e = null;
 47     private static SharedObject o = null;
 48 
 49     public static void main(final String[] args) {
 50         TestNG.main(args);
 51     }
 52 
 53     @BeforeClass
 54     public static void setUpClass() throws ScriptException {
 55         final ScriptEngineManager m = new ScriptEngineManager();
 56         e = m.getEngineByName(&quot;nashorn&quot;);
 57         o = new SharedObject();
 58         e.put(&quot;o&quot;, o);
 59         e.eval(&quot;var SharedObject = Packages.jdk.nashorn.api.javaaccess.test.SharedObject;&quot;);
 60         e.eval(&quot;var Person = Packages.jdk.nashorn.api.javaaccess.test.Person;&quot;);
 61     }
 62 
 63     @AfterClass
 64     public static void tearDownClass() {
 65         e = null;
 66         o = null;
 67     }
 68 
 69     @Test
 70     public void accessFieldObject() throws ScriptException {
 71         e.eval(&quot;var p_object = o.publicObject;&quot;);
 72         assertEquals(o.publicObject, e.get(&quot;p_object&quot;));
 73         assertEquals(&quot;object&quot;, e.eval(&quot;typeof p_object;&quot;));
 74         e.eval(&quot;o.publicObject = new Person(14);&quot;);
 75         assertEquals(new Person(14), o.publicObject);
 76     }
 77 
 78     @Test
 79     public void accessFieldObjectArray() throws ScriptException {
 80         e.eval(&quot;var p_object_array = o.publicObjectArray;&quot;);
 81         assertEquals(o.publicObjectArray[0], e.eval(&quot;o.publicObjectArray[0]&quot;));
 82         assertArrayEquals(o.publicObjectArray, (Object[])e.get(&quot;p_object_array&quot;));
 83         e.eval(&quot;var t_object_arr = new (Java.type(\&quot;jdk.nashorn.api.javaaccess.test.Person[]\&quot;))(3);&quot; +
 84                 &quot;t_object_arr[0] = new Person(100);&quot; +
 85                 &quot;t_object_arr[1] = new Person(120);&quot; +
 86                 &quot;t_object_arr[2] = new Person(140);&quot; +
 87                 &quot;o.publicObjectArray = t_object_arr;&quot;);
 88         assertArrayEquals(new Person[] { new Person(100), new Person(120), new Person(140) }, o.publicObjectArray);
 89         e.eval(&quot;o.publicObjectArray[0] = new Person(10);&quot;);
 90         assertEquals(new Person(10), o.publicObjectArray[0]);
 91     }
 92 
 93     @Test
 94     public void accessStaticFieldObject() throws ScriptException {
 95         e.eval(&quot;var ps_object = SharedObject.publicStaticObject;&quot;);
 96         assertEquals(SharedObject.publicStaticObject, e.get(&quot;ps_object&quot;));
 97         assertEquals(&quot;object&quot;, e.eval(&quot;typeof ps_object;&quot;));
 98         e.eval(&quot;SharedObject.publicStaticObject = new Person(16);&quot;);
 99         assertEquals(new Person(16), SharedObject.publicStaticObject);
100     }
101 
102     @Test
103     public void accessStaticFieldObjectArray() throws ScriptException {
104         e.eval(&quot;var ps_object_array = SharedObject.publicStaticObjectArray;&quot;);
105         assertEquals(SharedObject.publicStaticObjectArray[0], e.eval(&quot;SharedObject.publicStaticObjectArray[0]&quot;));
106         assertArrayEquals(SharedObject.publicStaticObjectArray, (Object[])e.get(&quot;ps_object_array&quot;));
107         e.eval(&quot;var ts_object_arr = new (Java.type(\&quot;jdk.nashorn.api.javaaccess.test.Person[]\&quot;))(3);&quot; +
108                 &quot;ts_object_arr[0] = new Person(100);&quot; +
109                 &quot;ts_object_arr[1] = new Person(120);&quot; +
110                 &quot;ts_object_arr[2] = new Person(140);&quot; +
111                 &quot;SharedObject.publicStaticObjectArray = ts_object_arr;&quot;);
112         assertArrayEquals(new Person[] { new Person(100), new Person(120), new Person(140) }, SharedObject.publicStaticObjectArray);
113         e.eval(&quot;SharedObject.publicStaticObjectArray[0] = new Person(10);&quot;);
114         assertEquals(new Person(10), SharedObject.publicStaticObjectArray[0]);
115     }
116 
117     @Test
118     public void accessFinalFieldObject() throws ScriptException {
119         e.eval(&quot;var pf_object = o.publicFinalObject;&quot;);
120         assertEquals(o.publicFinalObject, e.get(&quot;pf_object&quot;));
121         assertEquals(&quot;object&quot;, e.eval(&quot;typeof pf_object;&quot;));
122         e.eval(&quot;o.publicFinalObject = new Person(-999);&quot;);
123         assertEquals(new Person(1024), o.publicFinalObject);
124     }
125 
126     @Test
127     public void accessFinalFieldObjectArray() throws ScriptException {
128         e.eval(&quot;var pf_object_array = o.publicFinalObjectArray;&quot;);
129         assertEquals(o.publicFinalObjectArray[0], e.eval(&quot;o.publicFinalObjectArray[0]&quot;));
130         assertArrayEquals(o.publicFinalObjectArray, (Object[])e.get(&quot;pf_object_array&quot;));
131         e.eval(&quot;var tf_object_arr = new (Java.type(\&quot;jdk.nashorn.api.javaaccess.test.Person[]\&quot;))(3);&quot; +
132                 &quot;tf_object_arr[0] = new Person(100);&quot; +
133                 &quot;tf_object_arr[1] = new Person(120);&quot; +
134                 &quot;tf_object_arr[2] = new Person(140);&quot; +
135                 &quot;o.publicOFinalbjectArray = tf_object_arr;&quot;);
136         assertArrayEquals(new Person[] { new Person(-900), new Person(1000), new Person(180) }, o.publicFinalObjectArray);
137         e.eval(&quot;o.publicFinalObjectArray[0] = new Person(10);&quot;);
138         assertEquals(new Person(10), o.publicFinalObjectArray[0]);
139     }
140 
141     @Test
142     public void accessStaticFinalFieldObject() throws ScriptException {
143         e.eval(&quot;var psf_object = SharedObject.publicStaticFinalObject;&quot;);
144         assertEquals(SharedObject.publicStaticFinalObject, e.get(&quot;psf_object&quot;));
145         assertEquals(&quot;object&quot;, e.eval(&quot;typeof psf_object;&quot;));
146         e.eval(&quot;SharedObject.publicStaticFinalObject = new Person(6);&quot;);
147         assertEquals(new Person(2048), SharedObject.publicStaticFinalObject);
148     }
149 
150     @Test
151     public void accessStaticFinalFieldObjectArray() throws ScriptException {
152         e.eval(&quot;var psf_object_array = SharedObject.publicStaticFinalObjectArray;&quot;);
153         assertEquals(SharedObject.publicStaticFinalObjectArray[0], e.eval(&quot;SharedObject.publicStaticFinalObjectArray[0]&quot;));
154         assertArrayEquals(SharedObject.publicStaticFinalObjectArray, (Object[])e.get(&quot;psf_object_array&quot;));
155         e.eval(&quot;var tsf_object_arr = new (Java.type(\&quot;jdk.nashorn.api.javaaccess.test.Person[]\&quot;))(3);&quot; +
156                 &quot;tsf_object_arr[0] = new Person(100);&quot; +
157                 &quot;tsf_object_arr[1] = new Person(120);&quot; +
158                 &quot;tsf_object_arr[2] = new Person(140);&quot; +
159                 &quot;SharedObject.publicStaticFinalObjectArray = tsf_object_arr;&quot;);
160         assertArrayEquals(new Person[] { new Person(-9), new Person(110), new Person(Integer.MAX_VALUE) }, SharedObject.publicStaticFinalObjectArray);
161         e.eval(&quot;SharedObject.publicStaticFinalObjectArray[0] = new Person(90);&quot;);
162         assertEquals(new Person(90), SharedObject.publicStaticFinalObjectArray[0]);
163     }
164 
165 }
    </pre>
  </body>
</html>