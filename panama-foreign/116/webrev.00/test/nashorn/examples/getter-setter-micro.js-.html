<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/nashorn/examples/getter-setter-micro.js</title>
    <link rel="stylesheet" href="../../../style.css" />
  </head>
  <body>
    <pre>
 1 /*
 2  * Copyright (c) 2014, Oracle and/or its affiliates. All rights reserved.
 3  *
 4  * Redistribution and use in source and binary forms, with or without
 5  * modification, are permitted provided that the following conditions
 6  * are met:
 7  *
 8  *   - Redistributions of source code must retain the above copyright
 9  *     notice, this list of conditions and the following disclaimer.
10  *
11  *   - Redistributions in binary form must reproduce the above copyright
12  *     notice, this list of conditions and the following disclaimer in the
13  *     documentation and/or other materials provided with the distribution.
14  *
15  *   - Neither the name of Oracle nor the names of its
16  *     contributors may be used to endorse or promote products derived
17  *     from this software without specific prior written permission.
18  *
19  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS
20  * IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
21  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
22  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
23  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
24  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
25  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
26  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
27  * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
28  * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
29  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
30  */
31 
32 /*
33  * A micro-benchmark for getters and setters with primitive values,
34  * alternating between ints and doubles. Introduction of primitive
35  * and optimistic user accessors in JDK-8062401 make this faster by
36  * 10x or more by allowing inlining and other optimizations to take place.
37  */
38 
39 var x = {
40     get m() {
41         return this._m;
42     },
43     set m(v) {
44         this._m = v;
45     },
46     get n() {
47         return this._n;
48     },
49     set n(v) {
50         this._n = v;
51     }
52 };
53 
54 
55 function bench(v1, v2, result) {
56     var start = Date.now();
57     x.n = v1;
58     for (var i = 0; i &lt; 1e8; i++) {
59         x.m = v2;
60         if (x.m + x.n !== result) {
61             throw &quot;wrong result&quot;;
62         }
63     }
64     print(&quot;done in&quot;, Date.now() - start, &quot;millis&quot;);
65 }
66 
67 for (var i = 0; i &lt; 10; i++) {
68     bench(i, 4, 4 + i);
69 }
70 
71 for (var i = 0; i &lt; 10; i++) {
72     bench(i, 4.5, 4.5 + i);
73 }
74 
75 for (var i = 0; i &lt; 10; i++) {
76     bench(i, 5, 5 + i);
77 }
78 
79 for (var i = 0; i &lt; 10; i++) {
80     bench(i, 5.5, 5.5 + i);
81 }
    </pre>
  </body>
</html>