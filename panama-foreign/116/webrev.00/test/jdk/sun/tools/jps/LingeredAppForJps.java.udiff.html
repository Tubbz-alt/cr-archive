<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/sun/tools/jps/LingeredAppForJps.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../security/tools/jarsigner/Options.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestJps.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/tools/jps/LingeredAppForJps.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -67,30 +67,42 @@</span>
      public void buildJar() throws IOException {
          String className = LingeredAppForJps.class.getName();
          File jar = new File(className + &quot;.jar&quot;);
          String testClassPath = System.getProperty(&quot;test.class.path&quot;, &quot;?&quot;);
  
<span class="udiff-line-added">+         // Classpath contains test class dir, libraries class dir(s), and</span>
<span class="udiff-line-added">+         // may contains some additional dirs.</span>
<span class="udiff-line-added">+         // We need to add to jar only classes from the test class directory.</span>
<span class="udiff-line-added">+         // Main class (this class) should only be found in one directory</span>
<span class="udiff-line-added">+         // from the classpath (test class dir), therefore only added once.</span>
<span class="udiff-line-added">+         // Libraries class dir(s) and any additional classpath directories</span>
<span class="udiff-line-added">+         // are written the jar manifest.</span>
<span class="udiff-line-added">+ </span>
          File manifestFile = new File(className + &quot;.mf&quot;);
          String nl = System.getProperty(&quot;line.separator&quot;);
<span class="udiff-line-modified-removed">-         try (BufferedWriter output = new BufferedWriter(new FileWriter(manifestFile))) {</span>
<span class="udiff-line-removed">-             output.write(&quot;Main-Class: &quot; + className + nl);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+         String manifestClasspath = &quot;&quot;;</span>
  
          List&lt;String&gt; jarArgs = new ArrayList&lt;&gt;();
          jarArgs.add(&quot;-cfm&quot;);
          jarArgs.add(jar.getAbsolutePath());
          jarArgs.add(manifestFile.getAbsolutePath());
<span class="udiff-line-removed">- </span>
          for (String path : testClassPath.split(File.pathSeparator)) {
              String classFullName = path + File.separator + className + &quot;.class&quot;;
              File f = new File(classFullName);
              if (f.exists()) {
<span class="udiff-line-modified-removed">-               jarArgs.add(&quot;-C&quot;);</span>
<span class="udiff-line-modified-removed">-               jarArgs.add(path);</span>
<span class="udiff-line-modified-removed">-               jarArgs.add(&quot;.&quot;);</span>
<span class="udiff-line-modified-removed">-               System.out.println(&quot;INFO: scheduled to jar &quot; + path);</span>
<span class="udiff-line-modified-removed">-               break;</span>
<span class="udiff-line-modified-added">+                 jarArgs.add(&quot;-C&quot;);</span>
<span class="udiff-line-modified-added">+                 jarArgs.add(path);</span>
<span class="udiff-line-modified-added">+                 jarArgs.add(&quot;.&quot;);</span>
<span class="udiff-line-modified-added">+                 System.out.println(&quot;INFO: scheduled to jar &quot; + path);</span>
<span class="udiff-line-modified-added">+             } else {</span>
<span class="udiff-line-added">+                 manifestClasspath += &quot; &quot; + new File(path).toURI();</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         try (BufferedWriter output = new BufferedWriter(new FileWriter(manifestFile))) {</span>
<span class="udiff-line-added">+             output.write(&quot;Main-Class: &quot; + className + nl);</span>
<span class="udiff-line-added">+             if (!manifestClasspath.isEmpty()) {</span>
<span class="udiff-line-added">+                 output.write(&quot;Class-Path: &quot; + manifestClasspath + nl);</span>
              }
          }
  
          System.out.println(&quot;Running jar &quot; + jarArgs.toString());
          sun.tools.jar.Main jarTool = new sun.tools.jar.Main(System.out, System.err, &quot;jar&quot;);
</pre>
<center><a href="../../security/tools/jarsigner/Options.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestJps.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>