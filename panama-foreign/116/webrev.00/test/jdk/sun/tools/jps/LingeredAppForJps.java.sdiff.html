<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/sun/tools/jps/LingeredAppForJps.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../security/tools/jarsigner/Options.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestJps.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/tools/jps/LingeredAppForJps.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 52      */
 53     public String getProcessName() {
 54         return jarFile == null
 55                 ? getClass().getSimpleName()
 56                 : jarFile.getName();
 57     }
 58 
 59     // full package name for the application&#39;s main class or the full path
 60     // name to the application&#39;s JAR file:
 61     public String getFullProcessName() {
 62         return jarFile == null
 63                 ? getClass().getCanonicalName()
 64                 : jarFile.getAbsolutePath();
 65     }
 66 
 67     public void buildJar() throws IOException {
 68         String className = LingeredAppForJps.class.getName();
 69         File jar = new File(className + &quot;.jar&quot;);
 70         String testClassPath = System.getProperty(&quot;test.class.path&quot;, &quot;?&quot;);
 71 








 72         File manifestFile = new File(className + &quot;.mf&quot;);
 73         String nl = System.getProperty(&quot;line.separator&quot;);
<span class="line-modified"> 74         try (BufferedWriter output = new BufferedWriter(new FileWriter(manifestFile))) {</span>
<span class="line-removed"> 75             output.write(&quot;Main-Class: &quot; + className + nl);</span>
<span class="line-removed"> 76         }</span>
 77 
 78         List&lt;String&gt; jarArgs = new ArrayList&lt;&gt;();
 79         jarArgs.add(&quot;-cfm&quot;);
 80         jarArgs.add(jar.getAbsolutePath());
 81         jarArgs.add(manifestFile.getAbsolutePath());
<span class="line-removed"> 82 </span>
 83         for (String path : testClassPath.split(File.pathSeparator)) {
 84             String classFullName = path + File.separator + className + &quot;.class&quot;;
 85             File f = new File(classFullName);
 86             if (f.exists()) {
<span class="line-modified"> 87               jarArgs.add(&quot;-C&quot;);</span>
<span class="line-modified"> 88               jarArgs.add(path);</span>
<span class="line-modified"> 89               jarArgs.add(&quot;.&quot;);</span>
<span class="line-modified"> 90               System.out.println(&quot;INFO: scheduled to jar &quot; + path);</span>
<span class="line-modified"> 91               break;</span>







 92             }
 93         }
 94 
 95         System.out.println(&quot;Running jar &quot; + jarArgs.toString());
 96         sun.tools.jar.Main jarTool = new sun.tools.jar.Main(System.out, System.err, &quot;jar&quot;);
 97         if (!jarTool.run(jarArgs.toArray(new String[jarArgs.size()]))) {
 98             throw new IOException(&quot;jar failed: args=&quot; + jarArgs.toString());
 99         }
100 
101         manifestFile.delete();
102         jar.deleteOnExit();
103 
104         // Print content of jar file
105         System.out.println(&quot;Content of jar file&quot; + jar.getAbsolutePath());
106 
107         jarArgs = new ArrayList&lt;&gt;();
108         jarArgs.add(&quot;-tvf&quot;);
109         jarArgs.add(jar.getAbsolutePath());
110 
111         jarTool = new sun.tools.jar.Main(System.out, System.err, &quot;jar&quot;);
</pre>
</td>
<td>
<hr />
<pre>
 52      */
 53     public String getProcessName() {
 54         return jarFile == null
 55                 ? getClass().getSimpleName()
 56                 : jarFile.getName();
 57     }
 58 
 59     // full package name for the application&#39;s main class or the full path
 60     // name to the application&#39;s JAR file:
 61     public String getFullProcessName() {
 62         return jarFile == null
 63                 ? getClass().getCanonicalName()
 64                 : jarFile.getAbsolutePath();
 65     }
 66 
 67     public void buildJar() throws IOException {
 68         String className = LingeredAppForJps.class.getName();
 69         File jar = new File(className + &quot;.jar&quot;);
 70         String testClassPath = System.getProperty(&quot;test.class.path&quot;, &quot;?&quot;);
 71 
<span class="line-added"> 72         // Classpath contains test class dir, libraries class dir(s), and</span>
<span class="line-added"> 73         // may contains some additional dirs.</span>
<span class="line-added"> 74         // We need to add to jar only classes from the test class directory.</span>
<span class="line-added"> 75         // Main class (this class) should only be found in one directory</span>
<span class="line-added"> 76         // from the classpath (test class dir), therefore only added once.</span>
<span class="line-added"> 77         // Libraries class dir(s) and any additional classpath directories</span>
<span class="line-added"> 78         // are written the jar manifest.</span>
<span class="line-added"> 79 </span>
 80         File manifestFile = new File(className + &quot;.mf&quot;);
 81         String nl = System.getProperty(&quot;line.separator&quot;);
<span class="line-modified"> 82         String manifestClasspath = &quot;&quot;;</span>


 83 
 84         List&lt;String&gt; jarArgs = new ArrayList&lt;&gt;();
 85         jarArgs.add(&quot;-cfm&quot;);
 86         jarArgs.add(jar.getAbsolutePath());
 87         jarArgs.add(manifestFile.getAbsolutePath());

 88         for (String path : testClassPath.split(File.pathSeparator)) {
 89             String classFullName = path + File.separator + className + &quot;.class&quot;;
 90             File f = new File(classFullName);
 91             if (f.exists()) {
<span class="line-modified"> 92                 jarArgs.add(&quot;-C&quot;);</span>
<span class="line-modified"> 93                 jarArgs.add(path);</span>
<span class="line-modified"> 94                 jarArgs.add(&quot;.&quot;);</span>
<span class="line-modified"> 95                 System.out.println(&quot;INFO: scheduled to jar &quot; + path);</span>
<span class="line-modified"> 96             } else {</span>
<span class="line-added"> 97                 manifestClasspath += &quot; &quot; + new File(path).toURI();</span>
<span class="line-added"> 98             }</span>
<span class="line-added"> 99         }</span>
<span class="line-added">100         try (BufferedWriter output = new BufferedWriter(new FileWriter(manifestFile))) {</span>
<span class="line-added">101             output.write(&quot;Main-Class: &quot; + className + nl);</span>
<span class="line-added">102             if (!manifestClasspath.isEmpty()) {</span>
<span class="line-added">103                 output.write(&quot;Class-Path: &quot; + manifestClasspath + nl);</span>
104             }
105         }
106 
107         System.out.println(&quot;Running jar &quot; + jarArgs.toString());
108         sun.tools.jar.Main jarTool = new sun.tools.jar.Main(System.out, System.err, &quot;jar&quot;);
109         if (!jarTool.run(jarArgs.toArray(new String[jarArgs.size()]))) {
110             throw new IOException(&quot;jar failed: args=&quot; + jarArgs.toString());
111         }
112 
113         manifestFile.delete();
114         jar.deleteOnExit();
115 
116         // Print content of jar file
117         System.out.println(&quot;Content of jar file&quot; + jar.getAbsolutePath());
118 
119         jarArgs = new ArrayList&lt;&gt;();
120         jarArgs.add(&quot;-tvf&quot;);
121         jarArgs.add(jar.getAbsolutePath());
122 
123         jarTool = new sun.tools.jar.Main(System.out, System.err, &quot;jar&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="../../security/tools/jarsigner/Options.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestJps.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>