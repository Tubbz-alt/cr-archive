<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/java/util/regex/RegExTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../security/Policy/SignedJar/SignedJarTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../javax/script/Helper.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/util/regex/RegExTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -34,11 +34,11 @@</span>
   * 7067045 7014640 7189363 8007395 8013252 8013254 8012646 8023647 6559590
   * 8027645 8035076 8039124 8035975 8074678 6854417 8143854 8147531 7071819
   * 8151481 4867170 7080302 6728861 6995635 6736245 4916384 6328855 6192895
   * 6345469 6988218 6693451 7006761 8140212 8143282 8158482 8176029 8184706
   * 8194667 8197462 8184692 8221431 8224789 8228352 8230829 8236034 8235812
<span class="udiff-line-modified-removed">-  * 8216332 8214245 8237599</span>
<span class="udiff-line-modified-added">+  * 8216332 8214245 8237599 8241055</span>
   *
   * @library /test/lib
   * @library /lib/testlibrary/java/lang
   * @build jdk.test.lib.RandomFactory
   * @run main RegExTest
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4795,52 +4795,103 @@</span>
          }
          report(&quot;Embedded flags&quot;);
      }
  
      private static void grapheme() throws Exception {
<span class="udiff-line-added">+         final int[] lineNumber = new int[1];</span>
          Stream.concat(Files.lines(UCDFiles.GRAPHEME_BREAK_TEST),
                  Files.lines(Paths.get(System.getProperty(&quot;test.src&quot;, &quot;.&quot;), &quot;GraphemeTestCases.txt&quot;)))
<span class="udiff-line-removed">-             .filter( ln -&gt; ln.length() != 0 &amp;&amp; !ln.startsWith(&quot;#&quot;) )</span>
              .forEach( ln -&gt; {
<span class="udiff-line-modified-removed">-                 ln = ln.replaceAll(&quot;\\s+|\\([a-zA-Z]+\\)|\\[[a-zA-Z]]+\\]|#.*&quot;, &quot;&quot;);</span>
<span class="udiff-line-modified-removed">-                 // System.out.println(str);</span>
<span class="udiff-line-modified-removed">-                 String[] strs = ln.split(&quot;\u00f7|\u00d7&quot;);</span>
<span class="udiff-line-removed">-                 StringBuilder src = new StringBuilder();</span>
<span class="udiff-line-removed">-                 ArrayList&lt;String&gt; graphemes = new ArrayList&lt;&gt;();</span>
<span class="udiff-line-removed">-                 StringBuilder buf = new StringBuilder();</span>
<span class="udiff-line-removed">-                 int offBk = 0;</span>
<span class="udiff-line-removed">-                 for (String str : strs) {</span>
<span class="udiff-line-removed">-                     if (str.length() == 0)  // first empty str</span>
<span class="udiff-line-removed">-                         continue;</span>
<span class="udiff-line-removed">-                     int cp = Integer.parseInt(str, 16);</span>
<span class="udiff-line-removed">-                     src.appendCodePoint(cp);</span>
<span class="udiff-line-removed">-                     buf.appendCodePoint(cp);</span>
<span class="udiff-line-removed">-                     offBk += (str.length() + 1);</span>
<span class="udiff-line-removed">-                     if (ln.charAt(offBk) == &#39;\u00f7&#39;) {    // DIV</span>
<span class="udiff-line-removed">-                         graphemes.add(buf.toString());</span>
<span class="udiff-line-removed">-                         buf = new StringBuilder();</span>
<span class="udiff-line-modified-added">+                     lineNumber[0]++;</span>
<span class="udiff-line-modified-added">+                     if (ln.length() == 0 || ln.startsWith(&quot;#&quot;)) {</span>
<span class="udiff-line-modified-added">+                         return;</span>
                      }
<span class="udiff-line-modified-removed">-                 }</span>
<span class="udiff-line-modified-removed">-                 Pattern p = Pattern.compile(&quot;\\X&quot;);</span>
<span class="udiff-line-modified-removed">-                 Matcher m = p.matcher(src.toString());</span>
<span class="udiff-line-modified-removed">-                 Scanner s = new Scanner(src.toString()).useDelimiter(&quot;\\b{g}&quot;);</span>
<span class="udiff-line-modified-removed">-                 for (String g : graphemes) {</span>
<span class="udiff-line-modified-removed">-                     // System.out.printf(&quot;     grapheme:=[%s]%n&quot;, g);</span>
<span class="udiff-line-modified-removed">-                     // (1) test \\X directly</span>
<span class="udiff-line-modified-removed">-                     if (!m.find() || !m.group().equals(g)) {</span>
<span class="udiff-line-modified-removed">-                         System.out.println(&quot;Failed \\X [&quot; + ln + &quot;] : &quot; + g);</span>
<span class="udiff-line-modified-added">+                     ln = ln.replaceAll(&quot;\\s+|\\([a-zA-Z]+\\)|\\[[a-zA-Z]]+\\]|#.*&quot;, &quot;&quot;);</span>
<span class="udiff-line-modified-added">+                     // System.out.println(str);</span>
<span class="udiff-line-modified-added">+                     String[] strs = ln.split(&quot;\u00f7|\u00d7&quot;);</span>
<span class="udiff-line-modified-added">+                     StringBuilder src = new StringBuilder();</span>
<span class="udiff-line-modified-added">+                     ArrayList&lt;String&gt; graphemes = new ArrayList&lt;&gt;();</span>
<span class="udiff-line-modified-added">+                     StringBuilder buf = new StringBuilder();</span>
<span class="udiff-line-modified-added">+                     int offBk = 0;</span>
<span class="udiff-line-modified-added">+                     for (String str : strs) {</span>
<span class="udiff-line-modified-added">+                         if (str.length() == 0)  // first empty str</span>
<span class="udiff-line-added">+                             continue;</span>
<span class="udiff-line-added">+                         int cp = Integer.parseInt(str, 16);</span>
<span class="udiff-line-added">+                         src.appendCodePoint(cp);</span>
<span class="udiff-line-added">+                         buf.appendCodePoint(cp);</span>
<span class="udiff-line-added">+                         offBk += (str.length() + 1);</span>
<span class="udiff-line-added">+                         if (ln.charAt(offBk) == &#39;\u00f7&#39;) {    // DIV</span>
<span class="udiff-line-added">+                             graphemes.add(buf.toString());</span>
<span class="udiff-line-added">+                             buf = new StringBuilder();</span>
<span class="udiff-line-added">+                         }</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                     Pattern p = Pattern.compile(&quot;\\X&quot;);</span>
<span class="udiff-line-added">+                     // (1) test \X directly</span>
<span class="udiff-line-added">+                     Matcher m = p.matcher(src.toString());</span>
<span class="udiff-line-added">+                     for (String g : graphemes) {</span>
<span class="udiff-line-added">+                         // System.out.printf(&quot;     grapheme:=[%s]%n&quot;, g);</span>
<span class="udiff-line-added">+                         String group = null;</span>
<span class="udiff-line-added">+                         if (!m.find() || !(group = m.group()).equals(g)) {</span>
<span class="udiff-line-added">+                             System.out.println(&quot;Failed pattern \\X [&quot; + ln + &quot;] : &quot;</span>
<span class="udiff-line-added">+                                     + &quot;expected: &quot; + g + &quot; - actual: &quot; + group</span>
<span class="udiff-line-added">+                                     + &quot;(line &quot; + lineNumber[0] + &quot;)&quot;);</span>
<span class="udiff-line-added">+                             failCount++;</span>
<span class="udiff-line-added">+                         }</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                     if (m.find()) {</span>
<span class="udiff-line-added">+                         failCount++;</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                     // test \b{g} without \X via Pattern</span>
<span class="udiff-line-added">+                     Pattern pbg = Pattern.compile(&quot;\\b{g}&quot;);</span>
<span class="udiff-line-added">+                     m = pbg.matcher(src.toString());</span>
<span class="udiff-line-added">+                     m.find();</span>
<span class="udiff-line-added">+                     int prev = m.end();</span>
<span class="udiff-line-added">+                     for (String g : graphemes) {</span>
<span class="udiff-line-added">+                         String group = null;</span>
<span class="udiff-line-added">+                         if (!m.find() || !(group = src.substring(prev, m.end())).equals(g)) {</span>
<span class="udiff-line-added">+                             System.out.println(&quot;Failed pattern \\b{g} [&quot; + ln + &quot;] : &quot;</span>
<span class="udiff-line-added">+                                     + &quot;expected: &quot; + g + &quot; - actual: &quot; + group</span>
<span class="udiff-line-added">+                                     + &quot;(line &quot; + lineNumber[0] + &quot;)&quot;);</span>
<span class="udiff-line-added">+                             failCount++;</span>
<span class="udiff-line-added">+                         }</span>
<span class="udiff-line-added">+                         if (!&quot;&quot;.equals(m.group())) {</span>
<span class="udiff-line-added">+                             failCount++;</span>
<span class="udiff-line-added">+                         }</span>
<span class="udiff-line-added">+                         prev = m.end();</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                     if (m.find()) {</span>
                          failCount++;
                      }
<span class="udiff-line-modified-removed">-                     // (2) test \\b{g} + \\X  via Scanner</span>
<span class="udiff-line-modified-removed">-                     boolean hasNext = s.hasNext(p);</span>
<span class="udiff-line-modified-removed">-                     // if (!s.hasNext() || !s.next().equals(next)) {</span>
<span class="udiff-line-modified-removed">-                     if (!s.hasNext(p) || !s.next(p).equals(g)) {</span>
<span class="udiff-line-modified-removed">-                         System.out.println(&quot;Failed b{g} [&quot; + ln + &quot;] : &quot; + g);</span>
<span class="udiff-line-modified-added">+                     // (2) test \b{g} + \X  via Scanner</span>
<span class="udiff-line-modified-added">+                     Scanner s = new Scanner(src.toString()).useDelimiter(&quot;\\b{g}&quot;);</span>
<span class="udiff-line-modified-added">+                     for (String g : graphemes) {</span>
<span class="udiff-line-modified-added">+                         String next = null;</span>
<span class="udiff-line-modified-added">+                         if (!s.hasNext(p) || !(next = s.next(p)).equals(g)) {</span>
<span class="udiff-line-added">+                             System.out.println(&quot;Failed \\b{g} [&quot; + ln + &quot;] : &quot;</span>
<span class="udiff-line-added">+                                     + &quot;expected: &quot; + g + &quot; - actual: &quot; + next</span>
<span class="udiff-line-added">+                                     + &quot; (line &quot; + lineNumber[0] + &quot;)&quot;);</span>
<span class="udiff-line-added">+                             failCount++;</span>
<span class="udiff-line-added">+                         }</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                     if (s.hasNext(p)) {</span>
                          failCount++;
                      }
<span class="udiff-line-modified-removed">-                 }</span>
<span class="udiff-line-modified-removed">-             });</span>
<span class="udiff-line-modified-added">+                     // test \b{g} without \X via Scanner</span>
<span class="udiff-line-modified-added">+                     s = new Scanner(src.toString()).useDelimiter(&quot;\\b{g}&quot;);</span>
<span class="udiff-line-added">+                     for (String g : graphemes) {</span>
<span class="udiff-line-added">+                         String next = null;</span>
<span class="udiff-line-added">+                         if (!s.hasNext() || !(next = s.next()).equals(g)) {</span>
<span class="udiff-line-added">+                             System.out.println(&quot;Failed \\b{g} [&quot; + ln + &quot;] : &quot;</span>
<span class="udiff-line-added">+                                     + &quot;expected: &quot; + g + &quot; - actual: &quot; + next</span>
<span class="udiff-line-added">+                                     + &quot; (line &quot; + lineNumber[0] + &quot;)&quot;);</span>
<span class="udiff-line-added">+                             failCount++;</span>
<span class="udiff-line-added">+                         }</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                     if (s.hasNext()) {</span>
<span class="udiff-line-added">+                         failCount++;</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                 });</span>
          // some sanity checks
          if (!Pattern.compile(&quot;\\X{10}&quot;).matcher(&quot;abcdefghij&quot;).matches() ||
              !Pattern.compile(&quot;\\b{g}(?:\\X\\b{g}){5}\\b{g}&quot;).matcher(&quot;abcde&quot;).matches() ||
              !Pattern.compile(&quot;(?:\\X\\b{g}){2}&quot;).matcher(&quot;\ud800\udc00\ud801\udc02&quot;).matches())
              failCount++;
</pre>
<center><a href="../../security/Policy/SignedJar/SignedJarTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../javax/script/Helper.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>