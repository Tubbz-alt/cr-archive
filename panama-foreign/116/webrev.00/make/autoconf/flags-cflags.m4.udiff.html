<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff make/autoconf/flags-cflags.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="configure.ac.udiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="flags-ldflags.m4.udiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/flags-cflags.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -639,10 +639,11 @@</span>
    fi
  
    # Where does this really belong??
    if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
      PICFLAG=&quot;-fPIC&quot;
<span class="udiff-line-added">+     PIEFLAG=&quot;-fPIE&quot;</span>
    elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
      PICFLAG=&quot;-KPIC&quot;
    elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
      # &#39;-qpic&#39; defaults to &#39;qpic=small&#39;. This means that the compiler generates only
      # one instruction for accessing the TOC. If the TOC grows larger than 64K, the linker
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -852,22 +853,31 @@</span>
      $1_TOOLCHAIN_CFLAGS=&quot;${$1_GCC6_CFLAGS}&quot;
  
      $1_WARNING_CFLAGS_JVM=&quot;-Wno-format-zero-length -Wtype-limits -Wuninitialized&quot;
    fi
  
<span class="udiff-line-modified-removed">-   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then</span>
<span class="udiff-line-modified-removed">-     # Check if compiler supports -fmacro-prefix-map. If so, use that to make</span>
<span class="udiff-line-modified-removed">-     # the __FILE__ macro resolve to paths relative to the workspace root.</span>
<span class="udiff-line-modified-removed">-     workspace_root_trailing_slash=&quot;${WORKSPACE_ROOT%/}/&quot;</span>
<span class="udiff-line-modified-removed">-     FILE_MACRO_CFLAGS=&quot;-fmacro-prefix-map=${workspace_root_trailing_slash}=&quot;</span>
<span class="udiff-line-modified-removed">-     FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${FILE_MACRO_CFLAGS}],</span>
<span class="udiff-line-modified-removed">-         PREFIX: $3,</span>
<span class="udiff-line-modified-removed">-         IF_FALSE: [</span>
<span class="udiff-line-modified-removed">-             FILE_MACRO_CFLAGS=</span>
<span class="udiff-line-modified-removed">-         ]</span>
<span class="udiff-line-modified-removed">-     )</span>
<span class="udiff-line-modified-added">+   # Prevent the __FILE__ macro from generating absolute paths into the built</span>
<span class="udiff-line-modified-added">+   # binaries. Depending on toolchain, different mitigations are possible.</span>
<span class="udiff-line-modified-added">+   # * GCC and Clang of new enough versions have -fmacro-prefix-map.</span>
<span class="udiff-line-modified-added">+   # * For most other toolchains, supplying all source files and -I flags as</span>
<span class="udiff-line-modified-added">+   #   relative paths fixes the issue.</span>
<span class="udiff-line-modified-added">+   FILE_MACRO_CFLAGS=</span>
<span class="udiff-line-modified-added">+   if test &quot;x$ALLOW_ABSOLUTE_PATHS_IN_OUTPUT&quot; = &quot;xfalse&quot;; then</span>
<span class="udiff-line-modified-added">+     if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then</span>
<span class="udiff-line-modified-added">+       # Check if compiler supports -fmacro-prefix-map. If so, use that to make</span>
<span class="udiff-line-modified-added">+       # the __FILE__ macro resolve to paths relative to the workspace root.</span>
<span class="udiff-line-modified-added">+       workspace_root_trailing_slash=&quot;${WORKSPACE_ROOT%/}/&quot;</span>
<span class="udiff-line-added">+       FILE_MACRO_CFLAGS=&quot;-fmacro-prefix-map=${workspace_root_trailing_slash}=&quot;</span>
<span class="udiff-line-added">+       FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${FILE_MACRO_CFLAGS}],</span>
<span class="udiff-line-added">+           PREFIX: $3,</span>
<span class="udiff-line-added">+           IF_FALSE: [</span>
<span class="udiff-line-added">+               FILE_MACRO_CFLAGS=</span>
<span class="udiff-line-added">+           ]</span>
<span class="udiff-line-added">+       )</span>
<span class="udiff-line-added">+     fi</span>
    fi
<span class="udiff-line-added">+   AC_SUBST(FILE_MACRO_CFLAGS)</span>
  
    # EXPORT to API
    CFLAGS_JVM_COMMON=&quot;$ALWAYS_CFLAGS_JVM $ALWAYS_DEFINES_JVM \
        $TOOLCHAIN_CFLAGS_JVM ${$1_TOOLCHAIN_CFLAGS_JVM} \
        $OS_CFLAGS $OS_CFLAGS_JVM $CFLAGS_OS_DEF_JVM $DEBUG_CFLAGS_JVM \
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -892,14 +902,16 @@</span>
    $1_CFLAGS_JVM=&quot;${$1_DEFINES_CPU_JVM} ${$1_CFLAGS_CPU} ${$1_CFLAGS_CPU_JVM} ${$1_TOOLCHAIN_CFLAGS} ${$1_WARNING_CFLAGS_JVM}&quot;
    $1_CFLAGS_JDK=&quot;${$1_DEFINES_CPU_JDK} ${$1_CFLAGS_CPU} ${$1_CFLAGS_CPU_JDK} ${$1_TOOLCHAIN_CFLAGS}&quot;
  
    $2JVM_CFLAGS=&quot;$CFLAGS_JVM_COMMON ${$1_CFLAGS_JVM} ${$2EXTRA_CXXFLAGS}&quot;
  
<span class="udiff-line-modified-removed">-   $2CFLAGS_JDKEXE=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CONLY ${$1_CFLAGS_JDK}&quot;</span>
<span class="udiff-line-modified-removed">-   $2CXXFLAGS_JDKEXE=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CXXONLY ${$1_CFLAGS_JDK}&quot;</span>
<span class="udiff-line-modified-removed">-   $2CFLAGS_JDKLIB=&quot;${$2CFLAGS_JDKEXE} $JDK_PICFLAG ${$1_CFLAGS_CPU_JDK_LIBONLY}&quot;</span>
<span class="udiff-line-modified-removed">-   $2CXXFLAGS_JDKLIB=&quot;${$2CXXFLAGS_JDKEXE} $JDK_PICFLAG ${$1_CFLAGS_CPU_JDK_LIBONLY}&quot;</span>
<span class="udiff-line-modified-added">+   $2CFLAGS_JDKEXE=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CONLY ${$1_CFLAGS_JDK} $PIEFLAG&quot;</span>
<span class="udiff-line-modified-added">+   $2CXXFLAGS_JDKEXE=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CXXONLY ${$1_CFLAGS_JDK} $PIEFLAG&quot;</span>
<span class="udiff-line-modified-added">+   $2CFLAGS_JDKLIB=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CONLY ${$1_CFLAGS_JDK} \</span>
<span class="udiff-line-modified-added">+       $JDK_PICFLAG ${$1_CFLAGS_CPU_JDK_LIBONLY}&quot;</span>
<span class="udiff-line-added">+   $2CXXFLAGS_JDKLIB=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CXXONLY ${$1_CFLAGS_JDK} \</span>
<span class="udiff-line-added">+       $JDK_PICFLAG ${$1_CFLAGS_CPU_JDK_LIBONLY}&quot;</span>
  
    AC_SUBST($2JVM_CFLAGS)
    AC_SUBST($2CFLAGS_JDKLIB)
    AC_SUBST($2CFLAGS_JDKEXE)
    AC_SUBST($2CXXFLAGS_JDKLIB)
</pre>
<center><a href="configure.ac.udiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="flags-ldflags.m4.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>