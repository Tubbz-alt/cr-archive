<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/CreateJmods.gmk</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="CompileJavaModules.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="RunTests.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/CreateJmods.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
160     ifneq ($(INTERIM_JMOD), true)
161       ALL_UPGRADEABLE_MODULES := $(call FindAllUpgradeableModules)
162       DEPS += $(patsubst %, $(JMODS_DIR)/%.jmod, \
163           $(filter-out java.base $(ALL_UPGRADEABLE_MODULES), $(call FindAllModules)))
164 
165       EXCLUDE_PATTERN := $(strip $(subst $(SPACE),$$|,$(strip $(ALL_UPGRADEABLE_MODULES))))
166 
167       JMOD_FLAGS += --module-path $(JMODS_DIR) \
168           --hash-modules &#39;^(?!$(EXCLUDE_PATTERN)$$)&#39;
169     endif
170   endif
171 else # not java.base
172   ifeq ($(call isTargetOs, windows), true)
173     # Only java.base needs to include the MSVC*_DLLs. Make sure no other module
174     # tries to include them (typically imported ones).
175     ifneq ($(MSVCR_DLL), )
176       ifneq ($(wildcard $(LIBS_DIR)/$(notdir $(MSVCR_DLL))), )
177         JMOD_FLAGS += --exclude &#39;$(notdir $(MSVCR_DLL))&#39;
178       endif
179     endif





180     ifneq ($(MSVCP_DLL), )
181       ifneq ($(wildcard $(LIBS_DIR)/$(notdir $(MSVCP_DLL))), )
182         JMOD_FLAGS += --exclude &#39;$(notdir $(MSVCP_DLL))&#39;
183       endif
184     endif
185     ifneq ($(UCRT_DLL_DIR), )
186       UCRT_DLL_FILES := $(notdir $(wildcard $(UCRT_DLL_DIR)/*.dll))
187       ifneq ($(wildcard $(LIBS_DIR)/$(firstword $(UCRT_DLL_FILES))), )
188         JMOD_FLAGS += $(patsubst %, --exclude &#39;%&#39;, $(UCRT_DLL_FILES))
189       endif
190     endif
191   endif
192 endif
193 
194 # Changes to the jmod tool itself should also trigger a rebuild of all jmods.
195 # The variable JMOD_CMD could contain an environment variable assignment before
196 # the actual command. Filter that out using wildcard before adding to DEPS.
197 DEPS += $(wildcard $(JMOD_CMD))
198 ifeq ($(EXTERNAL_BUILDJDK), false)
199   DEPS += $(call FindFiles, $(JDK_OUTPUTDIR)/modules/jdk.jlink/jdk/tools/jmod)
</pre>
</td>
<td>
<hr />
<pre>
160     ifneq ($(INTERIM_JMOD), true)
161       ALL_UPGRADEABLE_MODULES := $(call FindAllUpgradeableModules)
162       DEPS += $(patsubst %, $(JMODS_DIR)/%.jmod, \
163           $(filter-out java.base $(ALL_UPGRADEABLE_MODULES), $(call FindAllModules)))
164 
165       EXCLUDE_PATTERN := $(strip $(subst $(SPACE),$$|,$(strip $(ALL_UPGRADEABLE_MODULES))))
166 
167       JMOD_FLAGS += --module-path $(JMODS_DIR) \
168           --hash-modules &#39;^(?!$(EXCLUDE_PATTERN)$$)&#39;
169     endif
170   endif
171 else # not java.base
172   ifeq ($(call isTargetOs, windows), true)
173     # Only java.base needs to include the MSVC*_DLLs. Make sure no other module
174     # tries to include them (typically imported ones).
175     ifneq ($(MSVCR_DLL), )
176       ifneq ($(wildcard $(LIBS_DIR)/$(notdir $(MSVCR_DLL))), )
177         JMOD_FLAGS += --exclude &#39;$(notdir $(MSVCR_DLL))&#39;
178       endif
179     endif
<span class="line-added">180     ifneq ($(VCRUNTIME_1_DLL), )</span>
<span class="line-added">181       ifneq ($(wildcard $(LIBS_DIR)/$(notdir $(VCRUNTIME_1_DLL))), )</span>
<span class="line-added">182         JMOD_FLAGS += --exclude &#39;$(notdir $(VCRUNTIME_1_DLL))&#39;</span>
<span class="line-added">183       endif</span>
<span class="line-added">184     endif</span>
185     ifneq ($(MSVCP_DLL), )
186       ifneq ($(wildcard $(LIBS_DIR)/$(notdir $(MSVCP_DLL))), )
187         JMOD_FLAGS += --exclude &#39;$(notdir $(MSVCP_DLL))&#39;
188       endif
189     endif
190     ifneq ($(UCRT_DLL_DIR), )
191       UCRT_DLL_FILES := $(notdir $(wildcard $(UCRT_DLL_DIR)/*.dll))
192       ifneq ($(wildcard $(LIBS_DIR)/$(firstword $(UCRT_DLL_FILES))), )
193         JMOD_FLAGS += $(patsubst %, --exclude &#39;%&#39;, $(UCRT_DLL_FILES))
194       endif
195     endif
196   endif
197 endif
198 
199 # Changes to the jmod tool itself should also trigger a rebuild of all jmods.
200 # The variable JMOD_CMD could contain an environment variable assignment before
201 # the actual command. Filter that out using wildcard before adding to DEPS.
202 DEPS += $(wildcard $(JMOD_CMD))
203 ifeq ($(EXTERNAL_BUILDJDK), false)
204   DEPS += $(call FindFiles, $(JDK_OUTPUTDIR)/modules/jdk.jlink/jdk/tools/jmod)
</pre>
</td>
</tr>
</table>
<center><a href="CompileJavaModules.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="RunTests.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>