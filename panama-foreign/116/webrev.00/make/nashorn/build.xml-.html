<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old make/nashorn/build.xml</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
  <body>
    <pre>
  1 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
  2 
  3 &lt;!--
  4  Copyright (c) 2010, 2018, Oracle and/or its affiliates. All rights reserved.
  5  DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  6 
  7  This code is free software; you can redistribute it and/or modify it
  8  under the terms of the GNU General Public License version 2 only, as
  9  published by the Free Software Foundation.
 10 
 11  This code is distributed in the hope that it will be useful, but WITHOUT
 12  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  version 2 for more details (a copy is included in the LICENSE file that
 15  accompanied this code).
 16 
 17  You should have received a copy of the GNU General Public License version
 18  2 along with this work; if not, write to the Free Software Foundation,
 19  Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 
 21  Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  or visit www.oracle.com if you need additional information or have any
 23  questions.
 24 --&gt;
 25 
 26 &lt;project name=&quot;nashorn&quot; default=&quot;test&quot; basedir=&quot;../..&quot;&gt;
 27   &lt;import file=&quot;build-nasgen.xml&quot;/&gt;
 28   &lt;import file=&quot;code_coverage.xml&quot;/&gt;
 29 
 30   &lt;target name=&quot;load-properties&quot;&gt;
 31     &lt;!-- set default values to run.test.jvmargs.external property --&gt;
 32     &lt;condition property=&quot;run.test.jvmargs.external&quot; value=&quot;&quot;&gt;
 33      &lt;not&gt;&lt;isset property=&quot;run.test.jvmargs.external&quot;/&gt;&lt;/not&gt;
 34     &lt;/condition&gt;     
 35     &lt;!-- loading locally defined resources and properties. NB they owerwrite default ones defined later --&gt;
 36     &lt;property file=&quot;${user.home}/.nashorn.project.local.properties&quot;/&gt;
 37 
 38     &lt;loadproperties srcFile=&quot;make/nashorn/project.properties&quot;/&gt;
 39   &lt;/target&gt;
 40 
 41   &lt;target name=&quot;init-conditions&quot; depends=&quot;load-properties&quot;&gt;
 42     &lt;path id=&quot;nashorn.jar.path&quot;&gt;
 43          &lt;pathelement location=&quot;${nashorn.jar}&quot;/&gt;
 44     &lt;/path&gt;
 45     &lt;condition property=&quot;svn.executable&quot; value=&quot;/usr/local/bin/svn&quot; else=&quot;svn&quot;&gt;
 46       &lt;available file=&quot;/usr/local/bin/svn&quot;/&gt;
 47     &lt;/condition&gt;
 48     &lt;condition property=&quot;hg.executable&quot; value=&quot;/usr/local/bin/hg&quot; else=&quot;hg&quot;&gt;
 49       &lt;available file=&quot;/usr/local/bin/hg&quot;/&gt;
 50     &lt;/condition&gt;
 51     &lt;condition property=&quot;git.executable&quot; value=&quot;/usr/local/bin/git&quot; else=&quot;git&quot;&gt;
 52       &lt;available file=&quot;/usr/local/bin/git&quot;/&gt;
 53     &lt;/condition&gt;
 54     &lt;!-- check if TestNG and dependencies are available, and download them if they aren&#39;t --&gt;
 55     &lt;antcall target=&quot;get-testng&quot;/&gt;
 56     &lt;condition property=&quot;testng.available&quot; value=&quot;true&quot;&gt;
 57       &lt;and&gt;
 58         &lt;available file=&quot;${file.reference.testng.jar}&quot;/&gt;
 59         &lt;available file=&quot;${file.reference.jcommander.jar}&quot;/&gt;
 60         &lt;available file=&quot;${file.reference.bsh.jar}&quot;/&gt;
 61         &lt;available file=&quot;${file.reference.snakeyaml.jar}&quot;/&gt;
 62       &lt;/and&gt;
 63     &lt;/condition&gt;
 64 
 65     &lt;!-- check if asmtools-6.0.jar is available, and download it if it isn&#39;t --&gt;
 66     &lt;!--
 67     &lt;available property=&quot;asmtools.already.present&quot; file=&quot;${file.reference.asmtools.jar}&quot;/&gt;
 68     &lt;antcall target=&quot;get-asmtools&quot;/&gt;
 69     &lt;available property=&quot;asmtools.available&quot; file=&quot;${file.reference.asmtools.jar}&quot;/&gt;
 70     --&gt;
 71 
 72     &lt;!-- check if Jemmy ang TestNG are avaiable --&gt;
 73     &lt;condition property=&quot;jemmy.jfx.testng.available&quot; value=&quot;true&quot;&gt;
 74       &lt;and&gt;
 75         &lt;available file=&quot;${file.reference.jemmyfx.jar}&quot;/&gt;
 76         &lt;available file=&quot;${file.reference.jemmycore.jar}&quot;/&gt;
 77         &lt;available file=&quot;${file.reference.jemmyawtinput.jar}&quot;/&gt;
 78         &lt;available file=&quot;${file.reference.jfxrt.jar}&quot;/&gt;
 79         &lt;isset property=&quot;testng.available&quot;/&gt;
 80       &lt;/and&gt;
 81     &lt;/condition&gt;
 82 
 83     &lt;!-- enable/disable make code coverage --&gt;
 84     &lt;condition property=&quot;cc.enabled&quot;&gt;
 85         &lt;istrue value=&quot;${make.code.coverage}&quot; /&gt;
 86     &lt;/condition&gt;
 87 
 88     &lt;!-- exclude tests in exclude lists --&gt;
 89     &lt;condition property=&quot;exclude.list&quot; value=&quot;${nashorn.make.dir}/exclude/exclude_list_cc.txt&quot; else=&quot;${nashorn.make.dir}/exclude/exclude_list.txt&quot;&gt;
 90       &lt;istrue value=&quot;${make.code.coverage}&quot; /&gt;
 91     &lt;/condition&gt;
 92 
 93     &lt;condition property=&quot;jfr.options&quot; value=&quot;${run.test.jvmargs.jfr}&quot; else=&quot;&quot;&gt;
 94       &lt;istrue value=&quot;${jfr}&quot;/&gt;
 95     &lt;/condition&gt;
 96 
 97     &lt;condition property=&quot;test-sys-prop-no-security.os.not.windows&quot;&gt;
 98       &lt;not&gt;
 99         &lt;os family=&quot;windows&quot;/&gt;
100       &lt;/not&gt;
101     &lt;/condition&gt;
102 
103     &lt;!--set windows cygwin/cmd specific properties--&gt;
104     &lt;property environment=&quot;env&quot;/&gt;
105     &lt;condition property=&quot;test-sys-prop-no-security.os.not.windows.cmd&quot;&gt;
106      &lt;not&gt;
107       &lt;and&gt;
108         &lt;os family=&quot;windows&quot;/&gt;
109         &lt;not&gt;
110           &lt;isset property=&quot;env.SHELL&quot;/&gt;
111         &lt;/not&gt;
112       &lt;/and&gt;
113      &lt;/not&gt;
114     &lt;/condition&gt;
115    &lt;/target&gt;
116   
117 
118   &lt;!-- check minimum ant version required to be 1.9.5 --&gt;
119   &lt;target name=&quot;check-ant-version&quot;&gt;
120     &lt;property name=&quot;ant.version.required&quot; value=&quot;1.9.5&quot;/&gt;
121     &lt;antversion property=&quot;ant.current.version&quot; /&gt;
122     &lt;fail message=&quot;The current ant version, ${ant.current.version}, is too old. Please use 1.9.5 or above.&quot;&gt;
123         &lt;condition&gt;
124             &lt;not&gt;
125                 &lt;antversion atleast=&quot;${ant.version.required}&quot;/&gt;
126             &lt;/not&gt;
127         &lt;/condition&gt;
128     &lt;/fail&gt;
129   &lt;/target&gt;
130 
131   &lt;target name=&quot;check-java-version&quot;&gt;
132     &lt;!-- look for a Class that is available only in jdk1.8 or above --&gt;
133     &lt;!-- core/exposed API class is better than an implementation class --&gt;
134     &lt;available property=&quot;jdk1.8+&quot; classname=&quot;java.util.stream.Stream&quot;/&gt;
135 
136     &lt;!-- need jdk1.8 or above --&gt;
137     &lt;fail message=&quot;Unsupported Java version: ${ant.java.version}. Please use Java version 1.8 or greater.&quot; unless=&quot;jdk1.8+&quot;&gt;
138     &lt;/fail&gt;
139   &lt;/target&gt;
140 
141   &lt;target name=&quot;init&quot; depends=&quot;check-ant-version, check-java-version, init-conditions, init-cc&quot;&gt;
142     &lt;!-- extends jvm args --&gt;
143     &lt;property name=&quot;run.test.jvmargs&quot; value=&quot;${run.test.jvmargs.main} ${run.test.cc.jvmargs} ${jfr.options}&quot;/&gt;
144     &lt;property name=&quot;run.test.jvmargs.octane&quot; value=&quot;${run.test.jvmargs.octane.main} ${run.test.cc.jvmargs} ${jfr.options}&quot;/&gt;
145 
146     &lt;echo message=&quot;run.test.jvmargs=${run.test.jvmargs}&quot;/&gt;
147     &lt;echo message=&quot;run.test.jvmargs.octane=${run.test.jvmargs.octane}&quot;/&gt;
148     &lt;echo message=&quot;run.test.xms=${run.test.xms}&quot;/&gt;
149     &lt;echo message=&quot;run.test.xmx=${run.test.xmx}&quot;/&gt;
150 
151   &lt;/target&gt;
152 
153   &lt;target name=&quot;prepare&quot; depends=&quot;init&quot;&gt;
154     &lt;mkdir dir=&quot;${build.dir}&quot;/&gt;
155     &lt;mkdir dir=&quot;${build.classes.dir}&quot;/&gt;
156     &lt;mkdir dir=&quot;${nashorn.module.classes.dir}&quot;/&gt;
157     &lt;mkdir dir=&quot;${dynalink.module.classes.dir}&quot;/&gt;
158     &lt;mkdir dir=&quot;${nashorn.shell.module.classes.dir}&quot;/&gt;
159     &lt;mkdir dir=&quot;${nashorn.module.classes.dir}/META-INF/services&quot;/&gt;
160     &lt;mkdir dir=&quot;${build.test.classes.dir}&quot;/&gt;
161     &lt;mkdir dir=&quot;${dist.dir}&quot;/&gt;
162     &lt;mkdir dir=&quot;${dist.javadoc.dir}&quot;/&gt;
163   &lt;/target&gt;
164 
165   &lt;target name=&quot;clean&quot; depends=&quot;init, clean-nasgen, init-cc-cleanup&quot;&gt;
166     &lt;delete includeemptydirs=&quot;true&quot;&gt;
167       &lt;fileset dir=&quot;${build.dir}&quot; erroronmissingdir=&quot;false&quot;/&gt;
168     &lt;/delete&gt;
169     &lt;delete dir=&quot;${dist.dir}&quot;/&gt;
170     &lt;delete dir=&quot;${jdk.build.dir}/nashorn_code_cache&quot;/&gt;
171     &lt;delete file=&quot;${basedir}/NashornProfile.txt&quot;/&gt;
172   &lt;/target&gt;
173 
174   &lt;target name=&quot;compile&quot; depends=&quot;prepare&quot; description=&quot;Compiles nashorn&quot;&gt;
175     &lt;javac srcdir=&quot;${dynalink.module.src.dir}&quot;
176            destdir=&quot;${dynalink.module.classes.dir}&quot;
177            debug=&quot;${javac.debug}&quot;
178            encoding=&quot;${javac.encoding}&quot;
179            includeantruntime=&quot;false&quot; fork=&quot;true&quot;&gt;
180       &lt;compilerarg value=&quot;-Xlint:all&quot;/&gt;
181       &lt;compilerarg value=&quot;-XDignore.symbol.file&quot;/&gt;
182       &lt;compilerarg value=&quot;-Xdiags:verbose&quot;/&gt;
183       &lt;compilerarg value=&quot;-parameters&quot;/&gt;
184     &lt;/javac&gt;
185     &lt;!-- patch-module does not like module-info.class files! --&gt;
186     &lt;delete&gt;
187       &lt;fileset dir=&quot;${build.classes.dir}&quot; includes=&quot;**/module-info.class&quot;/&gt;
188     &lt;/delete&gt;
189     &lt;javac srcdir=&quot;${nashorn.module.src.dir}&quot;
190            destdir=&quot;${nashorn.module.classes.dir}&quot;
191            debug=&quot;${javac.debug}&quot;
192            encoding=&quot;${javac.encoding}&quot;
193            includeantruntime=&quot;false&quot; fork=&quot;true&quot;&gt;
194       &lt;compilerarg value=&quot;-Xlint:all&quot;/&gt;
195       &lt;compilerarg value=&quot;-XDignore.symbol.file&quot;/&gt;
196       &lt;compilerarg value=&quot;-Xdiags:verbose&quot;/&gt;
197       &lt;compilerarg value=&quot;-parameters&quot;/&gt;
198       &lt;compilerarg line=&quot;${nashorn.override.option}&quot;/&gt;
199     &lt;/javac&gt;
200     &lt;!-- patch-module does not like module-info.class files! --&gt;
201     &lt;delete&gt;
202       &lt;fileset dir=&quot;${build.classes.dir}&quot; includes=&quot;**/module-info.class&quot;/&gt;
203     &lt;/delete&gt;
204     &lt;javac srcdir=&quot;${nashorn.shell.module.src.dir}&quot;
205            destdir=&quot;${nashorn.shell.module.classes.dir}&quot;
206            debug=&quot;${javac.debug}&quot;
207            encoding=&quot;${javac.encoding}&quot;
208            includeantruntime=&quot;false&quot; fork=&quot;true&quot;&gt;
209       &lt;compilerarg value=&quot;-Xlint:all&quot;/&gt;
210       &lt;compilerarg value=&quot;-XDignore.symbol.file&quot;/&gt;
211       &lt;compilerarg value=&quot;-Xdiags:verbose&quot;/&gt;
212       &lt;compilerarg value=&quot;-parameters&quot;/&gt;
213       &lt;compilerarg line=&quot;${nashorn.override.option}&quot;/&gt;
214     &lt;/javac&gt;
215     &lt;!-- patch-module does not like module-info.class files! --&gt;
216     &lt;delete&gt;
217       &lt;fileset dir=&quot;${build.classes.dir}&quot; includes=&quot;**/module-info.class&quot;/&gt;
218     &lt;/delete&gt;
219      &lt;copy todir=&quot;${nashorn.module.classes.dir}/jdk/nashorn/api/scripting/resources&quot;&gt;
220        &lt;fileset dir=&quot;${nashorn.module.src.dir}/jdk/nashorn/api/scripting/resources/&quot;/&gt;
221     &lt;/copy&gt;
222     &lt;copy todir=&quot;${nashorn.module.classes.dir}/jdk/nashorn/internal/runtime/resources&quot;&gt;
223        &lt;fileset dir=&quot;${nashorn.module.src.dir}/jdk/nashorn/internal/runtime/resources/&quot;/&gt;
224     &lt;/copy&gt;
225     &lt;copy todir=&quot;${nashorn.module.classes.dir}/jdk/nashorn/tools/resources&quot;&gt;
226        &lt;fileset dir=&quot;${nashorn.module.src.dir}/jdk/nashorn/tools/resources/&quot;/&gt;
227     &lt;/copy&gt;
228     &lt;copy file=&quot;${dynalink.module.src.dir}/jdk/dynalink/support/messages.properties&quot; todir=&quot;${dynalink.module.classes.dir}/jdk/dynalink/support&quot;/&gt;
229     &lt;copy file=&quot;${nashorn.module.src.dir}/jdk/nashorn/internal/codegen/anchor.properties&quot; todir=&quot;${nashorn.module.classes.dir}/jdk/nashorn/internal/codegen&quot;/&gt;
230     &lt;copy todir=&quot;${nashorn.shell.module.classes.dir}/jdk/nashorn/tools/jjs/resources&quot;&gt;
231        &lt;fileset dir=&quot;${nashorn.shell.module.src.dir}/jdk/nashorn/tools/jjs/resources/&quot;/&gt;
232     &lt;/copy&gt;
233 
234     &lt;echo message=&quot;version_string=${nashorn.fullversion}&quot; file=&quot;${nashorn.module.classes.dir}/jdk/nashorn/internal/runtime/resources/version.properties&quot;/&gt;
235     &lt;echo file=&quot;${nashorn.module.classes.dir}/jdk/nashorn/internal/runtime/resources/version.properties&quot; append=&quot;true&quot;&gt;${line.separator}&lt;/echo&gt;
236     &lt;echo message=&quot;version_short=${nashorn.version}&quot; file=&quot;${nashorn.module.classes.dir}/jdk/nashorn/internal/runtime/resources/version.properties&quot; append=&quot;true&quot;/&gt;
237   &lt;/target&gt;
238 
239   &lt;target name=&quot;jar&quot; depends=&quot;compile, run-nasgen, generate-cc-template&quot; description=&quot;Creates nashorn.jar&quot; unless=&quot;compile.suppress.jar&quot;&gt;
240     &lt;jar jarfile=&quot;${dynalink.jar}&quot;&gt;
241       &lt;fileset dir=&quot;${dynalink.module.classes.dir}&quot;/&gt;
242     &lt;/jar&gt;
243     &lt;jar jarfile=&quot;${nashorn.jar}&quot; index=&quot;true&quot; filesetmanifest=&quot;merge&quot;&gt;
244       &lt;fileset dir=&quot;${nashorn.module.classes.dir}&quot;/&gt;
245       &lt;manifest&gt;
246         &lt;attribute name=&quot;Archiver-Version&quot; value=&quot;n/a&quot;/&gt;
247         &lt;attribute name=&quot;Build-Jdk&quot; value=&quot;${java.runtime.version}&quot;/&gt;
248         &lt;attribute name=&quot;Built-By&quot; value=&quot;n/a&quot;/&gt;
249         &lt;attribute name=&quot;Created-By&quot; value=&quot;Ant jar task&quot;/&gt;
250         &lt;section name=&quot;jdk/nashorn/&quot;&gt;
251           &lt;attribute name=&quot;Implementation-Title&quot; value=&quot;${nashorn.product.name}&quot;/&gt;
252           &lt;attribute name=&quot;Implementation-Version&quot; value=&quot;${nashorn.version}&quot;/&gt;
253         &lt;/section&gt;
254       &lt;/manifest&gt;
255     &lt;/jar&gt;
256     &lt;jar jarfile=&quot;${jjs.jar}&quot;&gt;
257       &lt;fileset dir=&quot;${nashorn.shell.module.classes.dir}&quot;/&gt;
258     &lt;/jar&gt;
259   &lt;/target&gt;
260 
261   &lt;target name=&quot;use-promoted-nashorn&quot; depends=&quot;init&quot;&gt;
262     &lt;delete file=&quot;${dist.dir}/nashorn.jar&quot;/&gt;
263     &lt;copy file=&quot;${java.home}/lib/ext/nashorn.jar&quot; todir=&quot;${dist.dir}&quot;/&gt;
264     &lt;property name=&quot;compile.suppress.jar&quot; value=&quot;defined&quot;/&gt;
265   &lt;/target&gt;
266 
267   &lt;!-- generate javadoc for Nashorn classes --&gt;
268   &lt;target name=&quot;javadoc&quot; depends=&quot;jar&quot; unless=&quot;test.class&quot;&gt;
269     &lt;javadoc destdir=&quot;${dist.javadoc.dir}&quot; use=&quot;yes&quot;
270         windowtitle=&quot;${nashorn.product.name} ${nashorn.version}&quot;
271         additionalparam=&quot;-quiet&quot; failonerror=&quot;true&quot; useexternalfile=&quot;true&quot;&gt; 
272       &lt;arg value=&quot;--patch-module&quot;/&gt;
273       &lt;arg value=&quot;jdk.scripting.nashorn=${basedir}/${nashorn.module.src.dir}&quot;/&gt;
274       &lt;arg value=&quot;--patch-module&quot;/&gt;
275       &lt;arg value=&quot;jdk.dynalink=${basedir}/${dynalink.module.src.dir}&quot;/&gt;
276       &lt;arg value=&quot;--module-source-path&quot;/&gt;
277       &lt;arg value=&quot;.&quot;/&gt;
278       &lt;arg value=&quot;${javadoc.option}&quot;/&gt;
279       &lt;fileset dir=&quot;${nashorn.module.src.dir}&quot; includes=&quot;**/*.java&quot;/&gt;
280       &lt;fileset dir=&quot;${dynalink.module.src.dir}&quot; includes=&quot;**/*.java&quot;/&gt;
281       &lt;link offline=&quot;true&quot; href=&quot;${javadoc.base.url}&quot; packagelistLoc=&quot;${javadoc.element.list}&quot;/&gt;
282     &lt;/javadoc&gt;
283   &lt;/target&gt;
284 
285   &lt;!-- generate javadoc only for nashorn extension api classes --&gt;
286   &lt;target name=&quot;nashornapi&quot; depends=&quot;jar&quot;&gt;
287     &lt;mkdir dir=&quot;${dist.nashornapi.javadoc.dir}&quot;/&gt;
288     &lt;javadoc destdir=&quot;${dist.nashornapi.javadoc.dir}&quot; use=&quot;yes&quot;
289         windowtitle=&quot;${nashorn.product.name} ${nashorn.version}&quot;
290         additionalparam=&quot;-quiet&quot; failonerror=&quot;true&quot; useexternalfile=&quot;true&quot;&gt;
291       &lt;arg value=&quot;--patch-module&quot;/&gt;
292       &lt;arg value=&quot;jdk.scripting.nashorn=${basedir}/${nashorn.module.src.dir}&quot;/&gt;
293       &lt;arg value=&quot;--patch-module&quot;/&gt;
294       &lt;arg value=&quot;jdk.dynalink=${basedir}/${dynalink.module.src.dir}&quot;/&gt;
295       &lt;arg value=&quot;--module-source-path&quot;/&gt;
296       &lt;arg value=&quot;.&quot;/&gt;
297       &lt;arg value=&quot;${javadoc.option}&quot;/&gt;
298       &lt;fileset dir=&quot;${nashorn.module.src.dir}&quot; includes=&quot;jdk/nashorn/api/**/*.java&quot;/&gt;
299       &lt;link offline=&quot;true&quot; href=&quot;${javadoc.base.url}&quot; packagelistLoc=&quot;${javadoc.element.list}&quot;/&gt;
300     &lt;/javadoc&gt;
301   &lt;/target&gt;
302 
303   &lt;!-- generate javadoc only for Dynalink API classes --&gt;
304   &lt;target name=&quot;dynalinkapi&quot; depends=&quot;jar&quot;&gt;
305     &lt;mkdir dir=&quot;${dist.dynalinkapi.javadoc.dir}&quot;/&gt;
306     &lt;javadoc destdir=&quot;${dist.dynalinkapi.javadoc.dir}&quot; use=&quot;yes&quot;
307         windowtitle=&quot;Dynalink&quot;
308         additionalparam=&quot;-quiet&quot; failonerror=&quot;true&quot; useexternalfile=&quot;true&quot;&gt;
309       &lt;arg value=&quot;--patch-module&quot;/&gt;
310       &lt;arg value=&quot;jdk.scripting.nashorn=${basedir}/${nashorn.module.src.dir}&quot;/&gt;
311       &lt;arg value=&quot;--patch-module&quot;/&gt;
312       &lt;arg value=&quot;jdk.dynalink=${basedir}/${dynalink.module.src.dir}&quot;/&gt;
313       &lt;arg value=&quot;--module-source-path&quot;/&gt;
314       &lt;arg value=&quot;.&quot;/&gt;
315       &lt;arg value=&quot;${javadoc.option}&quot;/&gt;
316       &lt;fileset dir=&quot;${dynalink.module.src.dir}&quot; includes=&quot;**/*.java&quot;/&gt;
317       &lt;link offline=&quot;true&quot; href=&quot;${javadoc.base.url}&quot; packagelistLoc=&quot;${javadoc.element.list}&quot;/&gt;
318     &lt;/javadoc&gt;
319   &lt;/target&gt;
320 
321   &lt;target name=&quot;javadocapi&quot; depends=&quot;nashornapi, dynalinkapi&quot;/&gt;
322 
323   &lt;!-- generate all docs --&gt;
324   &lt;target name=&quot;docs&quot; depends=&quot;javadoc&quot;/&gt;
325 
326   &lt;!-- create .zip and .tar.gz for nashorn binaries and scripts. --&gt;
327   &lt;target name=&quot;dist&quot; depends=&quot;jar&quot;&gt;
328       &lt;zip destfile=&quot;${build.zip}&quot; basedir=&quot;..&quot;
329           excludes=&quot;nashorn/bin/*.sh&quot; includes=&quot;nashorn/bin/** nashorn/dist/**&quot;/&gt;
330       &lt;tar destfile=&quot;${build.gzip}&quot; basedir=&quot;..&quot; compression=&quot;gzip&quot;
331           excludes=&quot;nashorn/bin/*.sh&quot; includes=&quot;nashorn/bin/** nashorn/dist/**&quot;/&gt;
332   &lt;/target&gt;
333 
334   &lt;target name=&quot;compile-test&quot; depends=&quot;compile, run-nasgen&quot; if=&quot;testng.available&quot;&gt;
335     &lt;!-- testng task --&gt;
336     &lt;taskdef name=&quot;testng&quot; classname=&quot;org.testng.TestNGAntTask&quot;
337         classpath=&quot;${testng.ant.classpath}&quot;/&gt;
338 
339     &lt;javac srcdir=&quot;${test.src.dir}&quot;
340            destdir=&quot;${build.test.classes.dir}&quot;
341            classpath=&quot;${javac.test.classpath}&quot;
342            debug=&quot;${javac.debug}&quot;
343            encoding=&quot;${javac.encoding}&quot;
344            includeantruntime=&quot;false&quot; fork=&quot;true&quot;&gt;
345         &lt;compilerarg line=&quot;${nashorn.override.option}&quot;/&gt;
346         &lt;compilerarg value=&quot;-Xlint:unchecked&quot;/&gt;
347         &lt;compilerarg value=&quot;-Xlint:deprecation&quot;/&gt;
348         &lt;compilerarg value=&quot;-Xdiags:verbose&quot;/&gt;
349         &lt;compilerarg line=&quot;${test.module.imports.compile.time}&quot;/&gt;
350     &lt;/javac&gt;
351 
352     &lt;copy todir=&quot;${build.test.classes.dir}/META-INF/services&quot;&gt;
353        &lt;fileset dir=&quot;${test.src.dir}/META-INF/services/&quot;/&gt;
354     &lt;/copy&gt;
355 
356     &lt;copy todir=&quot;${build.test.classes.dir}/jdk/nashorn/internal/runtime/test/resources&quot;&gt;
357        &lt;fileset dir=&quot;${test.src.dir}/jdk/nashorn/internal/runtime/test/resources&quot;/&gt;
358     &lt;/copy&gt;
359 
360     &lt;copy todir=&quot;${build.test.classes.dir}/jdk/nashorn/internal/runtime/doubleconv/test/resources&quot;&gt;
361       &lt;fileset dir=&quot;${test.src.dir}/jdk/nashorn/internal/runtime/doubleconv/test/resources&quot;/&gt;
362     &lt;/copy&gt;
363 
364     &lt;copy todir=&quot;${build.test.classes.dir}/jdk/nashorn/api/scripting/test/resources&quot;&gt;
365        &lt;fileset dir=&quot;${test.src.dir}/jdk/nashorn/api/scripting/test/resources&quot;/&gt;
366     &lt;/copy&gt;
367 
368     &lt;!-- tests that check nashorn internals and internal API --&gt;
369     &lt;jar jarfile=&quot;${nashorn.internal.tests.jar}&quot;&gt;
370       &lt;fileset dir=&quot;${build.test.classes.dir}&quot; includes=&quot;**/internal/**&quot;/&gt;
371       &lt;fileset dir=&quot;${build.test.classes.dir}&quot; includes=&quot;**/test/tools/**&quot;/&gt;
372       &lt;fileset dir=&quot;${build.test.classes.dir}&quot; includes=&quot;**/models/**&quot;/&gt;
373       &lt;fileset dir=&quot;${build.test.classes.dir}&quot; includes=&quot;**/jdk/dynalink/test/Trusted**&quot;/&gt;
374       &lt;fileset dir=&quot;${build.test.classes.dir}&quot; includes=&quot;**/META-INF/**&quot;/&gt;
375     &lt;/jar&gt;
376 
377     &lt;!-- tests that check nashorn script engine (jsr-223) API and dynalink API --&gt;
378     &lt;jar jarfile=&quot;${nashorn.api.tests.jar}&quot;&gt;
379       &lt;fileset dir=&quot;${build.test.classes.dir}&quot; includes=&quot;**/jdk/dynalink/**&quot; excludes=&quot;**/jdk/dynalink/test/Trusted**&quot;/&gt;
380       &lt;fileset dir=&quot;${build.test.classes.dir}&quot; includes=&quot;**/api/**&quot;/&gt;
381       &lt;fileset dir=&quot;${build.test.classes.dir}&quot; includes=&quot;**/META-INF/**&quot;/&gt;
382       &lt;fileset dir=&quot;${build.test.classes.dir}&quot; includes=&quot;**/resources/*.js&quot;/&gt;
383       &lt;fileset dir=&quot;${build.test.classes.dir}&quot; includes=&quot;**/UnnamedPackage**&quot;/&gt;
384     &lt;/jar&gt;
385 
386   &lt;/target&gt;
387 
388   &lt;target name=&quot;generate-security-config&quot; depends=&quot;generate-policy-file, generate-security-properties-file&quot;/&gt;
389 
390   &lt;target name=&quot;generate-security-properties-file&quot; depends=&quot;prepare&quot;&gt;
391     &lt;echo file=&quot;${build.dir}/nashorn.security.properties&quot;&gt;
392 
393 package.access=sun.misc.,\
394     sun.reflect.,\
395     jdk.nashorn.internal.
396 
397     &lt;/echo&gt;
398   &lt;/target&gt;
399 
400   &lt;target name=&quot;generate-policy-file&quot; depends=&quot;prepare&quot;&gt;
401     &lt;echo file=&quot;${build.dir}/nashorn.policy&quot;&gt;
402 
403 grant codeBase &quot;file:/${basedir}/${dynalink.module.classes.dir}&quot; {
404     permission java.security.AllPermission;
405 };
406 
407 grant codeBase &quot;file:/${basedir}/${nashorn.module.classes.dir}&quot; {
408     permission java.security.AllPermission;
409 };
410 
411 grant codeBase &quot;file:/${basedir}/${nashorn.internal.tests.jar}&quot; {
412     permission java.security.AllPermission;
413 };
414 
415 grant codeBase &quot;file:/${basedir}/${nashorn.api.tests.jar}&quot; {
416     permission java.util.PropertyPermission &quot;parserapitest.*&quot;, &quot;read&quot;;
417     permission java.util.PropertyPermission &quot;test.*&quot;, &quot;read&quot;;
418     permission java.util.PropertyPermission &quot;test262.*&quot;, &quot;read&quot;;
419     permission java.io.FilePermission &quot;${basedir}/test/nashorn/-&quot;,&quot;read&quot;;
420     permission java.io.FilePermission &quot;$${user.dir}&quot;, &quot;read&quot;;
421     permission java.util.PropertyPermission &quot;user.dir&quot;, &quot;read&quot;;
422 };
423 
424 grant codeBase &quot;file:/${basedir}/${file.reference.testng.jar}&quot; {
425     permission java.security.AllPermission;
426 };
427 grant codeBase &quot;file:/${basedir}/${file.reference.jcommander.jar}&quot; {
428     permission java.security.AllPermission;
429 };
430 grant codeBase &quot;file:/${basedir}/${file.reference.bsh.jar}&quot; {
431     permission java.security.AllPermission;
432 };
433 grant codeBase &quot;file:/${basedir}/${file.reference.snakeyaml.jar}&quot; {
434     permission java.security.AllPermission;
435 };
436 //// in case of absolute path:
437 grant codeBase &quot;file:/${nashorn.internal.tests.jar}&quot; {
438     permission java.security.AllPermission;
439 };
440 
441 grant codeBase &quot;file:/${file.reference.testng.jar}&quot; {
442     permission java.security.AllPermission;
443 };
444 grant codeBase &quot;file:/${file.reference.jcommander.jar}&quot; {
445     permission java.security.AllPermission;
446 };
447 grant codeBase &quot;file:/${file.reference.bsh.jar}&quot; {
448     permission java.security.AllPermission;
449 };
450 grant codeBase &quot;file:/${file.reference.snakeyaml.jar}&quot; {
451     permission java.security.AllPermission;
452 };
453 
454 
455 grant codeBase &quot;file:/${basedir}/${test.script.dir}/trusted/*&quot; {
456     permission java.security.AllPermission;
457 };
458 
459 grant codeBase &quot;file:/${basedir}/${test.script.dir}/maptests/*&quot; {
460     permission java.io.FilePermission &quot;${basedir}/${test.script.dir}/maptests/*&quot;,&quot;read&quot;;
461     permission java.lang.RuntimePermission &quot;nashorn.debugMode&quot;;
462 };
463 
464 grant codeBase &quot;file:/${basedir}/${test.script.dir}/basic/*&quot; {
465     permission java.io.FilePermission &quot;${basedir}/${test.script.dir}/-&quot;, &quot;read&quot;;
466     permission java.io.FilePermission &quot;$${user.dir}&quot;, &quot;read&quot;;
467     permission java.util.PropertyPermission &quot;user.dir&quot;, &quot;read&quot;;
468     permission java.util.PropertyPermission &quot;nashorn.test.*&quot;, &quot;read&quot;;
469 };
470 
471 grant codeBase &quot;file:/${basedir}/${test.script.dir}/basic/apply_to_call/*&quot; {
472     permission java.io.FilePermission &quot;${basedir}/${test.script.dir}/-&quot;, &quot;read&quot;;
473     permission java.io.FilePermission &quot;$${user.dir}&quot;, &quot;read&quot;;
474     permission java.util.PropertyPermission &quot;user.dir&quot;, &quot;read&quot;;
475     permission java.util.PropertyPermission &quot;nashorn.test.*&quot;, &quot;read&quot;;
476 };
477 
478 grant codeBase &quot;file:/${basedir}/${test.script.dir}/basic/parser/*&quot; {
479     permission java.io.FilePermission &quot;${basedir}/${test.script.dir}/-&quot;, &quot;read&quot;;
480     permission java.io.FilePermission &quot;$${user.dir}&quot;, &quot;read&quot;;
481     permission java.util.PropertyPermission &quot;user.dir&quot;, &quot;read&quot;;
482     permission java.util.PropertyPermission &quot;nashorn.test.*&quot;, &quot;read&quot;;
483 };
484 
485 grant codeBase &quot;file:/${basedir}/${test.script.dir}/basic/es6/*&quot; {
486     permission java.io.FilePermission &quot;${basedir}/${test.script.dir}/-&quot;, &quot;read&quot;;
487     permission java.io.FilePermission &quot;$${user.dir}&quot;, &quot;read&quot;;
488     permission java.util.PropertyPermission &quot;user.dir&quot;, &quot;read&quot;;
489     permission java.util.PropertyPermission &quot;nashorn.test.*&quot;, &quot;read&quot;;
490 };
491 
492 grant codeBase &quot;file:/${basedir}/${test.script.dir}/basic/JDK-8010946-privileged.js&quot; {
493     permission java.util.PropertyPermission &quot;java.security.policy&quot;, &quot;read&quot;;
494 };
495 
496 grant codeBase &quot;file:/${basedir}/${test.script.dir}/basic/classloader.js&quot; {
497     permission java.lang.RuntimePermission &quot;nashorn.JavaReflection&quot;;
498 };
499 
500 grant codeBase &quot;file:/${basedir}/${test.script.dir}/markdown.js&quot; {
501     permission java.io.FilePermission &quot;${basedir}/${test.script.dir}/external/showdown/-&quot;, &quot;read&quot;;
502 };
503 
504 grant codeBase &quot;file:/${basedir}/${test.script.dir}/basic/JDK-8158467.js&quot; {
505     permission java.lang.RuntimePermission &quot;nashorn.setConfig&quot;;
506 };
507 
508     &lt;/echo&gt;
509 
510     &lt;replace file=&quot;${build.dir}/nashorn.policy&quot;&gt;&lt;replacetoken&gt;\&lt;/replacetoken&gt;&lt;replacevalue&gt;/&lt;/replacevalue&gt;&lt;/replace&gt;    &lt;!--hack for Windows - to make URLs with normal path separators --&gt;
511     &lt;replace file=&quot;${build.dir}/nashorn.policy&quot;&gt;&lt;replacetoken&gt;//&lt;/replacetoken&gt;&lt;replacevalue&gt;/&lt;/replacevalue&gt;&lt;/replace&gt;   &lt;!--hack for Unix - to avoid leading // in URLs --&gt;
512 
513   &lt;/target&gt;
514 
515   &lt;target name=&quot;check-external-tests&quot;&gt;
516       &lt;available file=&quot;${test.external.dir}/prototype&quot; property=&quot;test-sys-prop.external.prototype&quot;/&gt;
517       &lt;available file=&quot;${test.external.dir}/sunspider&quot; property=&quot;test-sys-prop.external.sunspider&quot;/&gt;
518       &lt;available file=&quot;${test.external.dir}/underscore&quot; property=&quot;test-sys-prop.external.underscore&quot;/&gt;
519       &lt;available file=&quot;${test.external.dir}/octane&quot; property=&quot;test-sys-prop.external.octane&quot;/&gt;
520       &lt;available file=&quot;${test.external.dir}/yui&quot; property=&quot;test-sys-prop.external.yui&quot;/&gt;
521       &lt;available file=&quot;${test.external.dir}/jquery&quot; property=&quot;test-sys-prop.external.jquery&quot;/&gt;
522       &lt;available file=&quot;${test.external.dir}/test262&quot; property=&quot;test-sys-prop.external.test262&quot;/&gt;
523       &lt;available file=&quot;${test.external.dir}/showdown&quot; property=&quot;test-sys-prop.external.markdown&quot;/&gt;
524   &lt;/target&gt;
525 
526   &lt;target name=&quot;check-testng&quot; unless=&quot;testng.available&quot;&gt;
527     &lt;echo message=&quot;WARNING: TestNG not available, will not run tests. Please copy TestNG and dependency JARs to the ${test.lib} directory.&quot;/&gt;
528   &lt;/target&gt;
529 
530   &lt;!-- only to be invoked as dependency of &quot;test&quot; target --&gt;
531   &lt;target name=&quot;-test-classes-all&quot; depends=&quot;jar&quot; unless=&quot;test.class&quot;&gt;
532       &lt;fileset id=&quot;test.classes&quot; dir=&quot;${build.test.classes.dir}&quot;&gt;
533           &lt;include name=&quot;**/dynalink/beans/test/*Test.class&quot;/&gt;
534           &lt;include name=&quot;**/dynalink/linker/support/test/*Test.class&quot;/&gt;
535           &lt;include name=&quot;**/dynalink/support/test/*Test.class&quot;/&gt;
536           &lt;include name=&quot;**/dynalink/test/*Test.class&quot;/&gt;
537           &lt;include name=&quot;**/api/javaaccess/test/*Test.class&quot;/&gt;
538           &lt;include name=&quot;**/api/scripting/test/*Test.class&quot;/&gt;
539           &lt;include name=&quot;**/api/tree/test/*Test.class&quot;/&gt;
540           &lt;include name=&quot;**/codegen/test/*Test.class&quot;/&gt;
541           &lt;include name=&quot;**/parser/test/*Test.class&quot;/&gt;
542           &lt;include name=&quot;**/runtime/test/*Test.class&quot;/&gt;
543           &lt;include name=&quot;**/runtime/doubleconv/test/*Test.class&quot;/&gt;
544           &lt;include name=&quot;**/runtime/regexp/test/*Test.class&quot;/&gt;
545           &lt;include name=&quot;**/runtime/regexp/joni/test/*Test.class&quot;/&gt;
546           &lt;include name=&quot;**/framework/*Test.class&quot;/&gt;
547      &lt;/fileset&gt;
548   &lt;/target&gt;
549 
550   &lt;!-- only to be invoked as dependency of &quot;test&quot; target --&gt;
551   &lt;target name=&quot;-test-classes-single&quot; depends=&quot;jar&quot; if=&quot;test.class&quot;&gt;
552      &lt;fileset id=&quot;test.classes&quot; dir=&quot;${build.test.classes.dir}&quot;&gt;
553          &lt;include name=&quot;${test.class}*&quot;/&gt;
554      &lt;/fileset&gt;
555   &lt;/target&gt;
556 
557   &lt;!-- only to be invoked as dependency of &quot;test&quot; target --&gt;
558   &lt;target name=&quot;-test-nosecurity&quot; unless=&quot;test.class&quot;&gt;
559     &lt;fileset id=&quot;test.nosecurity.classes&quot; dir=&quot;${build.test.classes.dir}&quot;&gt;
560       &lt;include name=&quot;**/framework/ScriptTest.class&quot;/&gt;
561       &lt;include name=&quot;**/runtime/linker/test/*Test.class&quot;/&gt;
562     &lt;/fileset&gt;
563     &lt;testng outputdir=&quot;${build.nosecurity.test.results.dir}/${testResultsSubDir}&quot; classfilesetref=&quot;test.nosecurity.classes&quot;
564        verbose=&quot;${testng.verbose}&quot; haltonfailure=&quot;true&quot; useDefaultListeners=&quot;false&quot; listeners=&quot;${testng.listeners}&quot; workingDir=&quot;${basedir}&quot;&gt;
565       &lt;jvmarg line=&quot;${run.test.jvmargs} -Xmx${run.test.xmx} -Dbuild.dir=${build.dir}&quot;/&gt;
566       &lt;sysproperty key=&quot;nashorn.jar&quot; value=&quot;${dist.dir}/nashorn.jar&quot;/&gt;
567       &lt;propertyset&gt;
568         &lt;propertyref prefix=&quot;nashorn.&quot;/&gt;
569       &lt;/propertyset&gt;
570       &lt;propertyset&gt;
571         &lt;propertyref prefix=&quot;test-sys-prop-no-security.&quot;/&gt;
572         &lt;mapper from=&quot;test-sys-prop-no-security.*&quot; to=&quot;*&quot; type=&quot;glob&quot;/&gt;
573       &lt;/propertyset&gt;
574       &lt;sysproperty key=&quot;optimistic.override&quot; value=&quot;${optimistic}&quot;/&gt;
575       &lt;classpath&gt;
576           &lt;pathelement path=&quot;${run.test.classpath}&quot;/&gt;
577       &lt;/classpath&gt;
578     &lt;/testng&gt;
579   &lt;/target&gt;
580 
581   &lt;!-- only to be invoked as dependency of &quot;test&quot; target --&gt;
582   &lt;target name=&quot;-test-security&quot;&gt;
583     &lt;delete dir=&quot;${build.dir}/nashorn_code_cache&quot;/&gt;
584     &lt;property name=&quot;debug.test.jvmargs&quot; value=&quot;&quot;/&gt;
585     &lt;testng outputdir=&quot;${build.test.results.dir}/${testResultsSubDir}&quot; classfilesetref=&quot;test.classes&quot;
586             verbose=&quot;${testng.verbose}&quot; haltonfailure=&quot;true&quot; useDefaultListeners=&quot;false&quot; listeners=&quot;${testng.listeners}&quot; workingDir=&quot;${basedir}&quot;&gt;
587       &lt;jvmarg line=&quot;${run.test.jvmargs} -Xmx${run.test.xmx} ${run.test.jvmsecurityargs} -Dbuild.dir=${build.dir}&quot;/&gt;
588       &lt;jvmarg line=&quot;${debug.test.jvmargs}&quot;/&gt;
589       &lt;propertyset&gt;
590         &lt;propertyref prefix=&quot;nashorn.&quot;/&gt;
591       &lt;/propertyset&gt;
592       &lt;propertyset&gt;
593         &lt;propertyref prefix=&quot;test-sys-prop.&quot;/&gt;
594         &lt;mapper from=&quot;test-sys-prop.*&quot; to=&quot;*&quot; type=&quot;glob&quot;/&gt;
595       &lt;/propertyset&gt;
596       &lt;sysproperty key=&quot;optimistic.override&quot; value=&quot;${optimistic}&quot;/&gt;
597       &lt;sysproperty key=&quot;test.js.excludes.file&quot; value=&quot;${exclude.list}&quot;/&gt;
598       &lt;classpath&gt;
599           &lt;pathelement path=&quot;${run.test.classpath}&quot;/&gt;
600       &lt;/classpath&gt;
601     &lt;/testng&gt;
602   &lt;/target&gt;
603 
604   &lt;target name=&quot;test&quot; depends=&quot;prepare, javadoc, test-pessimistic, test-optimistic&quot;/&gt;
605 
606   &lt;target name=&quot;test-optimistic&quot; depends=&quot;jar, -test-classes-all,-test-classes-single, check-testng, check-external-tests, compile-test, generate-security-config&quot; if=&quot;testng.available&quot;&gt;
607     &lt;echo message=&quot;Running test suite in OPTIMISTIC mode...&quot;/&gt;
608     &lt;antcall target=&quot;-test-nosecurity&quot; inheritRefs=&quot;true&quot;&gt;
609       &lt;param name=&quot;optimistic&quot; value=&quot;true&quot;/&gt;
610       &lt;param name=&quot;testResultsSubDir&quot; value=&quot;optimistic&quot;/&gt;
611     &lt;/antcall&gt;
612     &lt;antcall target=&quot;-test-security&quot; inheritRefs=&quot;true&quot;&gt;
613       &lt;param name=&quot;optimistic&quot; value=&quot;true&quot;/&gt;
614       &lt;param name=&quot;testResultsSubDir&quot; value=&quot;optimistic&quot;/&gt;
615     &lt;/antcall&gt;
616   &lt;/target&gt;
617 
618   &lt;target name=&quot;test-pessimistic&quot; depends=&quot;jar, -test-classes-all,-test-classes-single, check-testng, check-external-tests, compile-test, generate-security-config&quot; if=&quot;testng.available&quot;&gt;
619     &lt;echo message=&quot;Running test suite in PESSIMISTIC mode...&quot;/&gt;
620     &lt;antcall target=&quot;-test-nosecurity&quot; inheritRefs=&quot;true&quot;&gt;
621       &lt;param name=&quot;optimistic&quot; value=&quot;false&quot;/&gt;
622       &lt;param name=&quot;testResultsSubDir&quot; value=&quot;pessimistic&quot;/&gt;
623     &lt;/antcall&gt;
624     &lt;antcall target=&quot;-test-security&quot; inheritRefs=&quot;true&quot;&gt;
625       &lt;param name=&quot;optimistic&quot; value=&quot;false&quot;/&gt;
626       &lt;param name=&quot;testResultsSubDir&quot; value=&quot;pessimistic&quot;/&gt;
627     &lt;/antcall&gt;
628   &lt;/target&gt;
629 
630   &lt;target name=&quot;check-jemmy.jfx.testng&quot; unless=&quot;jemmy.jfx.testng.available&quot;&gt;
631     &lt;echo message=&quot;WARNING: Jemmy or JavaFX or TestNG not available, will not run tests. Please copy TestNG and dependency JARs, JemmyCore.jar, JemmyFX.jar, JemmyAWTInput.jar to the test${file.separator}lib directory. And make sure you have jfxrt.jar in ${java.home}${file.separator}lib${file.separator}ext dir.&quot;/&gt;
632   &lt;/target&gt;
633 
634   &lt;target name=&quot;testjfx&quot; depends=&quot;jar, check-jemmy.jfx.testng, compile-test&quot; if=&quot;jemmy.jfx.testng.available&quot;&gt;
635     &lt;fileset id=&quot;test.classes&quot; dir=&quot;${build.test.classes.dir}&quot;&gt;
636        &lt;include name=&quot;**/framework/*Test.class&quot;/&gt;
637     &lt;/fileset&gt;
638 
639     &lt;copy file=&quot;${file.reference.jfxrt.jar}&quot; todir=&quot;dist&quot;/&gt;
640 
641     &lt;condition property=&quot;jfx.prism.order&quot; value=&quot;-Dprism.order=j2d&quot; else=&quot; &quot;&gt;
642         &lt;not&gt;
643             &lt;os family=&quot;mac&quot;/&gt;
644         &lt;/not&gt;
645     &lt;/condition&gt;
646 
647     &lt;testng outputdir=&quot;${build.test.results.dir}&quot; classfilesetref=&quot;test.classes&quot;
648        verbose=&quot;${testng.verbose}&quot; haltonfailure=&quot;true&quot; useDefaultListeners=&quot;false&quot; listeners=&quot;${testng.listeners}&quot; workingDir=&quot;${basedir}&quot;&gt;
649       &lt;jvmarg line=&quot;${run.test.jvmargs} -Xmx${run.test.xmx} -Dbuild.dir=${build.dir}&quot;/&gt;
650       &lt;propertyset&gt;
651         &lt;propertyref prefix=&quot;testjfx-test-sys-prop.&quot;/&gt;
652         &lt;mapper from=&quot;testjfx-test-sys-prop.*&quot; to=&quot;*&quot; type=&quot;glob&quot;/&gt;
653       &lt;/propertyset&gt;
654       &lt;sysproperty key=&quot;test.fork.jvm.options&quot; value=&quot;${testjfx-test-sys-prop.test.fork.jvm.options} ${jfx.prism.order}&quot;/&gt;
655       &lt;classpath&gt;
656           &lt;pathelement path=&quot;${testjfx.run.test.classpath}&quot;/&gt;
657       &lt;/classpath&gt;
658     &lt;/testng&gt;
659   &lt;/target&gt;
660 
661   &lt;target name=&quot;testmarkdown&quot; depends=&quot;jar, check-testng, check-external-tests, compile-test, generate-security-config&quot; if=&quot;testng.available&quot;&gt;
662     &lt;fileset id=&quot;test.classes&quot; dir=&quot;${build.test.classes.dir}&quot;&gt;
663        &lt;include name=&quot;**/framework/*Test.class&quot;/&gt;
664     &lt;/fileset&gt;
665 
666     &lt;testng outputdir=&quot;${build.test.results.dir}&quot; classfilesetref=&quot;test.classes&quot;
667        verbose=&quot;${testng.verbose}&quot; haltonfailure=&quot;true&quot; useDefaultListeners=&quot;false&quot; listeners=&quot;${testng.listeners}&quot; workingDir=&quot;${basedir}&quot;&gt;
668       &lt;jvmarg line=&quot;${run.test.jvmargs} -Xmx${run.test.xmx} ${run.test.jvmsecurityargs} -Dbuild.dir=${build.dir}&quot;/&gt;
669       &lt;propertyset&gt;
670         &lt;propertyref prefix=&quot;testmarkdown-test-sys-prop.&quot;/&gt;
671         &lt;mapper from=&quot;testmarkdown-test-sys-prop.*&quot; to=&quot;*&quot; type=&quot;glob&quot;/&gt;
672       &lt;/propertyset&gt;
673       &lt;classpath&gt;
674           &lt;pathelement path=&quot;${run.test.classpath}&quot;/&gt;
675       &lt;/classpath&gt;
676     &lt;/testng&gt;
677   &lt;/target&gt;
678 
679   &lt;target name=&quot;test262&quot; depends=&quot;jar, check-testng, check-external-tests, compile-test, generate-security-config&quot; if=&quot;testng.available&quot;&gt;
680     &lt;fileset id=&quot;test.classes&quot; dir=&quot;${build.test.classes.dir}&quot;&gt;
681        &lt;include name=&quot;**/framework/*Test.class&quot;/&gt;
682     &lt;/fileset&gt;
683 
684     &lt;testng outputdir=&quot;${build.test.results.dir}&quot; classfilesetref=&quot;test.classes&quot;
685        verbose=&quot;${testng.verbose}&quot; haltonfailure=&quot;true&quot; useDefaultListeners=&quot;false&quot; listeners=&quot;${testng.listeners}&quot; workingDir=&quot;${basedir}&quot;&gt;
686       &lt;jvmarg line=&quot;${run.test.jvmargs} -Xmx${run.test.xmx} ${run.test.jvmsecurityargs} -Dbuild.dir=${build.dir}&quot;/&gt;
687       &lt;propertyset&gt;
688         &lt;propertyref prefix=&quot;nashorn.&quot;/&gt;
689       &lt;/propertyset&gt;
690       &lt;propertyset&gt;
691         &lt;propertyref prefix=&quot;test262-test-sys-prop.&quot;/&gt;
692         &lt;mapper from=&quot;test262-test-sys-prop.*&quot; to=&quot;*&quot; type=&quot;glob&quot;/&gt;
693       &lt;/propertyset&gt;
694       &lt;classpath&gt;
695           &lt;pathelement path=&quot;${run.test.classpath}&quot;/&gt;
696       &lt;/classpath&gt;
697     &lt;/testng&gt;
698   &lt;/target&gt;
699 
700   &lt;target name=&quot;test262parallel&quot; depends=&quot;test262-parallel&quot;/&gt;
701 
702   &lt;target name=&quot;test262-parallel&quot; depends=&quot;jar, check-testng, check-external-tests, compile-test, generate-security-config&quot; if=&quot;testng.available&quot;&gt;
703     &lt;!-- use just build.test.classes.dir to avoid referring to TestNG --&gt;
704     &lt;java classname=&quot;${parallel.test.runner}&quot; dir=&quot;${basedir}&quot; fork=&quot;true&quot; failonerror=&quot;true&quot;&gt;
705       &lt;jvmarg line=&quot;${run.test.jvmargs} -Xmx${run.test.xmx} ${run.test.jvmsecurityargs} -Dbuild.dir=${build.dir}&quot;/&gt;
706       &lt;!-- avoid too many typeinfo cache files. Each script is run only once anyway --&gt;
707       &lt;jvmarg line=&quot;-Dnashorn.typeInfo.disabled=true&quot;/&gt;
708       &lt;classpath&gt;
709           &lt;pathelement path=&quot;${run.test.classpath}&quot;/&gt;
710       &lt;/classpath&gt;
711       &lt;syspropertyset&gt;
712           &lt;propertyref prefix=&quot;test262-test-sys-prop.&quot;/&gt;
713           &lt;mapper type=&quot;glob&quot; from=&quot;test262-test-sys-prop.*&quot; to=&quot;*&quot;/&gt;
714       &lt;/syspropertyset&gt;
715     &lt;/java&gt;
716   &lt;/target&gt;
717 
718   &lt;target name=&quot;testparallel&quot; depends=&quot;test-parallel&quot;/&gt;
719 
720   &lt;target name=&quot;test-parallel&quot; depends=&quot;jar, check-testng, check-external-tests, compile-test, generate-security-config&quot; if=&quot;testng.available&quot;&gt;
721       &lt;!-- use just build.test.classes.dir to avoid referring to TestNG --&gt;
722       &lt;java classname=&quot;${parallel.test.runner}&quot; dir=&quot;${basedir}&quot;
723         failonerror=&quot;true&quot;
724         fork=&quot;true&quot;&gt;
725       &lt;jvmarg line=&quot;${run.test.jvmargs} -Xmx${run.test.xmx} ${run.test.jvmsecurityargs}&quot;/&gt;
726       &lt;classpath&gt;
727           &lt;pathelement path=&quot;${run.test.classpath}&quot;/&gt;
728       &lt;pathelement path=&quot;${build.test.classes.dir}&quot;/&gt;
729       &lt;/classpath&gt;
730       &lt;syspropertyset&gt;
731           &lt;propertyref prefix=&quot;test-sys-prop.&quot;/&gt;
732           &lt;mapper type=&quot;glob&quot; from=&quot;test-sys-prop.*&quot; to=&quot;*&quot;/&gt;
733       &lt;/syspropertyset&gt;
734       &lt;/java&gt;
735   &lt;/target&gt;
736 
737   &lt;target name=&quot;all&quot; depends=&quot;test, docs&quot;
738       description=&quot;Build, test and generate docs for nashorn&quot;/&gt;
739 
740   &lt;target name=&quot;run&quot; depends=&quot;jar&quot;
741       description=&quot;Run the shell with a sample script&quot;&gt;
742     &lt;java classname=&quot;${nashorn.shell.tool}&quot; fork=&quot;true&quot; dir=&quot;${basedir}/src/sample/nashorn&quot;&gt;
743         &lt;jvmarg line=&quot;${run.test.jvmargs} -Xmx${run.test.xmx}&quot;/&gt;
744         &lt;arg value=&quot;-dump-on-error&quot;/&gt;
745         &lt;arg value=&quot;test.js&quot;/&gt;
746     &lt;/java&gt;
747   &lt;/target&gt;
748 
749   &lt;target name=&quot;debug&quot; depends=&quot;jar&quot;
750       description=&quot;Debug the shell with a sample script&quot;&gt;
751     &lt;java classname=&quot;${nashorn.shell.tool}&quot; fork=&quot;true&quot; dir=&quot;${basedir}/src/sample/nashorn&quot;&gt;
752         &lt;jvmarg line=&quot;${run.test.jvmargs} -Xmx${run.test.xmx}&quot;/&gt;
753         &lt;arg value=&quot;--print-code&quot;/&gt;
754         &lt;arg value=&quot;--verify-code&quot;/&gt;
755         &lt;arg value=&quot;--print-symbols&quot;/&gt;
756         &lt;jvmarg value=&quot;-Dnashorn.codegen.debug=true&quot;/&gt;
757         &lt;arg value=&quot;test.js&quot;/&gt;
758     &lt;/java&gt;
759   &lt;/target&gt;
760 
761   &lt;!-- targets to get external script tests --&gt;
762 
763   &lt;!-- test262 test suite --&gt;
764   &lt;target name=&quot;get-test262&quot; depends=&quot;init&quot; unless=&quot;${test-sys-prop.external.test262}&quot;&gt;
765     &lt;!-- clone test262 git repo --&gt;
766     &lt;exec executable=&quot;${git.executable}&quot;&gt;
767        &lt;arg value=&quot;clone&quot;/&gt;
768        &lt;arg value=&quot;--branch&quot;/&gt;
769        &lt;arg value=&quot;es5-tests&quot;/&gt;
770        &lt;arg value=&quot;https://github.com/tc39/test262&quot;/&gt;
771        &lt;arg value=&quot;${test.external.dir}/test262&quot;/&gt;
772     &lt;/exec&gt;
773   &lt;/target&gt;
774   &lt;target name=&quot;update-test262&quot; depends=&quot;init&quot; if=&quot;${test-sys-prop.external.test262}&quot;&gt;
775     &lt;!-- update test262 git repo --&gt;
776     &lt;exec executable=&quot;${git.executable}&quot; dir=&quot;${test.external.dir}/test262&quot;&gt;
777        &lt;arg value=&quot;pull&quot;/&gt;
778     &lt;/exec&gt;
779   &lt;/target&gt;
780 
781   &lt;!-- octane benchmark --&gt;
782   &lt;target name=&quot;get-octane&quot; depends=&quot;init&quot; unless=&quot;${test-sys-prop.external.octane}&quot;&gt;
783     &lt;!-- checkout octane benchmarks --&gt;
784     &lt;exec executable=&quot;${git.executable}&quot;&gt;
785        &lt;arg value=&quot;clone&quot;/&gt;
786        &lt;arg value=&quot;https://github.com/chromium/octane&quot;/&gt;
787        &lt;arg value=&quot;${test.external.dir}/octane&quot;/&gt;
788     &lt;/exec&gt;
789   &lt;/target&gt;
790   &lt;target name=&quot;update-octane&quot; depends=&quot;init&quot; if=&quot;${test-sys-prop.external.octane}&quot;&gt;
791     &lt;!-- update octane benchmarks --&gt;
792     &lt;exec executable=&quot;${git.executable}&quot; dir=&quot;${test.external.dir}/octane&quot;&gt;
793        &lt;arg value=&quot;pull&quot;/&gt;
794     &lt;/exec&gt;
795   &lt;/target&gt;
796 
797   &lt;!-- sunspider benchmark --&gt;
798   &lt;target name=&quot;get-sunspider&quot; depends=&quot;init&quot; unless=&quot;${test-sys-prop.external.sunspider}&quot;&gt;
799     &lt;!-- checkout sunspider --&gt;
800     &lt;exec executable=&quot;${svn.executable}&quot;&gt;
801        &lt;arg value=&quot;--non-interactive&quot;/&gt;
802        &lt;arg value=&quot;--trust-server-cert&quot;/&gt;
803        &lt;arg value=&quot;checkout&quot;/&gt;
804        &lt;arg value=&quot;http://svn.webkit.org/repository/webkit/trunk/PerformanceTests/SunSpider&quot;/&gt;
805        &lt;arg value=&quot;${test.external.dir}/sunspider&quot;/&gt;
806     &lt;/exec&gt;
807   &lt;/target&gt;
808   &lt;target name=&quot;update-sunspider&quot; depends=&quot;init&quot; if=&quot;${test-sys-prop.external.sunspider}&quot;&gt;
809     &lt;!-- update sunspider --&gt;
810     &lt;exec executable=&quot;${svn.executable}&quot; dir=&quot;${test.external.dir}/sunspider&quot;&gt;
811        &lt;arg value=&quot;--non-interactive&quot;/&gt;
812        &lt;arg value=&quot;--trust-server-cert&quot;/&gt;
813        &lt;arg value=&quot;update&quot;/&gt;
814     &lt;/exec&gt;
815   &lt;/target&gt;
816 
817   &lt;!-- get all external test scripts --&gt;
818   &lt;target name=&quot;externals&quot; depends=&quot;init, check-external-tests, get-test262, get-octane, get-sunspider&quot;&gt;
819     &lt;!-- make external test dir --&gt;
820     &lt;mkdir dir=&quot;${test.external.dir}&quot;/&gt;
821 
822     &lt;!-- jquery --&gt;
823     &lt;mkdir dir=&quot;${test.external.dir}/jquery&quot;/&gt;
824     &lt;get src=&quot;http://code.jquery.com/jquery-1.7.2.js&quot; dest=&quot;${test.external.dir}/jquery&quot; skipexisting=&quot;true&quot; ignoreerrors=&quot;true&quot;/&gt;
825     &lt;get src=&quot;http://code.jquery.com/jquery-1.7.2.min.js&quot; dest=&quot;${test.external.dir}/jquery&quot; skipexisting=&quot;true&quot; ignoreerrors=&quot;true&quot;/&gt;
826 
827     &lt;!-- prototype --&gt;
828     &lt;mkdir dir=&quot;${test.external.dir}/prototype&quot;/&gt;
829     &lt;get src=&quot;http://ajax.googleapis.com/ajax/libs/prototype/1.7.0/prototype.js&quot; dest=&quot;${test.external.dir}/prototype&quot; usetimestamp=&quot;true&quot; skipexisting=&quot;true&quot; ignoreerrors=&quot;true&quot;/&gt;
830 
831     &lt;!-- underscorejs --&gt;
832     &lt;mkdir dir=&quot;${test.external.dir}/underscore&quot;/&gt;
833     &lt;get src=&quot;http://underscorejs.org/underscore.js&quot; dest=&quot;${test.external.dir}/underscore&quot; skipexisting=&quot;true&quot; ignoreerrors=&quot;true&quot; tryGzipEncoding=&quot;true&quot;/&gt;
834     &lt;get src=&quot;http://underscorejs.org/underscore-min.js&quot; dest=&quot;${test.external.dir}/underscore&quot; skipexisting=&quot;true&quot; ignoreerrors=&quot;true&quot; tryGzipEncoding=&quot;true&quot;/&gt;
835 
836     &lt;!-- yui --&gt;
837     &lt;mkdir dir=&quot;${test.external.dir}/yui&quot;/&gt;
838     &lt;get src=&quot;http://yui.yahooapis.com/3.5.1/build/yui/yui.js&quot; dest=&quot;${test.external.dir}/yui&quot; skipexisting=&quot;true&quot; ignoreerrors=&quot;true&quot; tryGzipEncoding=&quot;true&quot;/&gt;
839     &lt;get src=&quot;http://yui.yahooapis.com/3.5.1/build/yui/yui-min.js&quot; dest=&quot;${test.external.dir}/yui&quot; skipexisting=&quot;true&quot; ignoreerrors=&quot;true&quot; tryGzipEncoding=&quot;true&quot;/&gt;
840 
841     &lt;!-- showdown --&gt;
842     &lt;mkdir dir=&quot;${test.external.dir}/showdown&quot;/&gt;
843     &lt;get src=&quot;https://raw.githubusercontent.com/showdownjs/showdown/0.5.4/src/showdown.js&quot; dest=&quot;${test.external.dir}/showdown&quot; skipexisting=&quot;true&quot; ignoreerrors=&quot;true&quot;/&gt;
844     &lt;get src=&quot;https://raw.githubusercontent.com/showdownjs/showdown/0.5.4/src/extensions/table.js&quot; dest=&quot;${test.external.dir}/showdown&quot; skipexisting=&quot;true&quot; ignoreerrors=&quot;true&quot;/&gt;
845 
846   &lt;/target&gt;
847 
848   &lt;!-- update external test suites that are pulled from source control systems --&gt;
849   &lt;target name=&quot;update-externals&quot; depends=&quot;init, check-external-tests, update-test262, update-octane, update-sunspider&quot;/&gt;
850 
851   &lt;!-- run all perf tests --&gt;
852   &lt;target name=&quot;perf&quot; depends=&quot;externals, update-externals, sunspider, octane&quot;/&gt;
853 
854   &lt;!-- download and install testng.jar --&gt;
855   &lt;target name=&quot;get-testng&quot;&gt;
856     &lt;get dest=&quot;${test.lib}&quot; skipexisting=&quot;true&quot;&gt;
857       &lt;url url=&quot;http://central.maven.org/maven2/org/testng/testng/6.8/testng-6.8.jar&quot;/&gt;
858       &lt;url url=&quot;http://central.maven.org/maven2/com/beust/jcommander/1.27/jcommander-1.27.jar&quot;/&gt;
859       &lt;url url=&quot;http://central.maven.org/maven2/org/beanshell/bsh/2.0b4/bsh-2.0b4.jar&quot;/&gt;
860       &lt;url url=&quot;http://central.maven.org/maven2/org/yaml/snakeyaml/1.6/snakeyaml-1.6.jar&quot;/&gt;
861     &lt;/get&gt;
862   &lt;/target&gt;
863 
864   &lt;!-- download and install asmtools.jar --&gt;
865   &lt;target name=&quot;get-asmtools&quot; unless=&quot;asmtools.already.present&quot;&gt;
866     &lt;get src=&quot;https://adopt-openjdk.ci.cloudbees.com/view/OpenJDK/job/asmtools/lastSuccessfulBuild/artifact/asmtools-6.0.tar.gz&quot; dest=&quot;${test.lib}&quot; skipexisting=&quot;true&quot; ignoreerrors=&quot;true&quot;/&gt;
867     &lt;untar src=&quot;${test.lib}${file.separator}asmtools-6.0.tar.gz&quot; dest=&quot;${test.lib}&quot; compression=&quot;gzip&quot;/&gt;
868     &lt;!-- they are tar.gz&#39;ing a .zip file! --&gt;
869     &lt;unzip src=&quot;${test.lib}${file.separator}asmtools-6.0.zip&quot; dest=&quot;${test.lib}&quot;&gt;
870       &lt;patternset&gt;
871         &lt;include name=&quot;asmtools-6.0/lib/asmtools.jar&quot;/&gt;
872       &lt;/patternset&gt;
873     &lt;/unzip&gt;
874     &lt;move file=&quot;${test.lib}${file.separator}asmtools-6.0${file.separator}lib${file.separator}asmtools.jar&quot; tofile=&quot;${test.lib}${file.separator}asmtools.jar&quot;/&gt;
875     &lt;delete dir=&quot;${test.lib}${file.separator}asmtools-6.0&quot;/&gt;
876   &lt;/target&gt;
877 
878   &lt;!-- run all tests --&gt;
879   &lt;target name=&quot;alltests&quot; depends=&quot;externals, update-externals, test, test262parallel, testmarkdown, perf&quot;/&gt;
880 
881   &lt;import file=&quot;build-benchmark.xml&quot;/&gt;
882 
883 &lt;/project&gt;
    </pre>
  </body>
</html>