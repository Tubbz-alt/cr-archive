diff a/test/jdk/java/foreign/TestUpcallStubs.java b/test/jdk/java/foreign/TestUpcallStubs.java
--- a/test/jdk/java/foreign/TestUpcallStubs.java
+++ b/test/jdk/java/foreign/TestUpcallStubs.java
@@ -62,11 +62,11 @@
 
     @Test(expectedExceptions = UnsupportedOperationException.class)
     public void testNoAccess() {
         try (MemorySegment stub = getStub()) {
             VarHandle vh = JAVA_INT.varHandle(int.class);
-            vh.set(stub.address(), 10);
+            vh.set(stub, 10);
         }
     }
 
     @Test
     public void testFree() {
