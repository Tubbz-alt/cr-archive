<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/hotspot/jtreg/vmTestbase/nsk/jdi/Argument/value/value004.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../serviceability/threads/TestFalseDeadLock.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="value004/TestDescription.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jdi/Argument/value/value004.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -31,10 +31,12 @@</span>
  import com.sun.jdi.connect.*;
  import java.io.*;
  import javax.naming.directory.Attribute;
  import java.util.*;
  
<span class="udiff-line-added">+ import jtreg.SkippedException;</span>
<span class="udiff-line-added">+ </span>
  /**
   * Test for the control of
   *
   *      Interface:      com.sun.jdi.connect.Connector.Argument
   *      Method:         public java.lang.String value()
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -47,14 +49,10 @@</span>
   *                      &quot;command&quot; argument.
   *                      The test sets up the new &quot;command&quot; argument
   *                      value and then checks that new value remains previously
   *                      after connection establishing with debugee VM and
   *                      after debugee VM finishing.
<span class="udiff-line-removed">-  *</span>
<span class="udiff-line-removed">-  *      Warning:        Temporarily the test is prepared only for</span>
<span class="udiff-line-removed">-  *                      Sparc.Solaris.dt_socket-transport of RawCommandLineLaunch</span>
<span class="udiff-line-removed">-  *                      connector</span>
   */
  
  public class value004 {
      private static Log log;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -76,32 +74,19 @@</span>
          } else {
              log.complain(&quot;FAILURE: no JDI launching connectors found!&quot;);
              return 2;
          }
  
<span class="udiff-line-added">+         boolean skipped = true;</span>
          Iterator lci = lcl.iterator();
<span class="udiff-line-modified-removed">-         for (int i = 1; lci.hasNext(); i++) {</span>
<span class="udiff-line-modified-added">+         while (lci.hasNext()) {</span>
              Connector c = (Connector) lci.next();
<span class="udiff-line-modified-removed">-             if (c.name().compareTo(&quot;com.sun.jdi.RawCommandLineLaunch&quot;) != 0) {</span>
<span class="udiff-line-modified-added">+             if (!&quot;com.sun.jdi.RawCommandLineLaunch&quot;.equals(c.name())) {</span>
<span class="udiff-line-added">+                 log.display(&quot;skipping &quot; + c);</span>
                  continue;
              }
              log.display(&quot;Connector&#39;s transport is: &quot; + c.transport().name());
<span class="udiff-line-removed">-             if (c.transport().name().compareTo(&quot;dt_socket&quot;) != 0) {</span>
<span class="udiff-line-removed">-                 log.display(&quot;WARNING: Temporarily the test is prepared only &quot;</span>
<span class="udiff-line-removed">-                           + &quot;for dt_socket-transport of &quot;</span>
<span class="udiff-line-removed">-                           + &quot;RawCommandLineLaunch connector!&quot;);</span>
<span class="udiff-line-removed">-                 return 0;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             if (System.getProperties().getProperty(&quot;os.arch&quot;)</span>
<span class="udiff-line-removed">-                 .compareTo(&quot;sparc&quot;) != 0 ||</span>
<span class="udiff-line-removed">-                 System.getProperties().getProperty(&quot;os.name&quot;)</span>
<span class="udiff-line-removed">-                 .compareTo(&quot;SunOS&quot;) != 0) {</span>
<span class="udiff-line-removed">-                 log.display(&quot;WARNING: Temporarily the test is prepared &quot;</span>
<span class="udiff-line-removed">-                           + &quot;only for Sparc.Solaris-transport of &quot;</span>
<span class="udiff-line-removed">-                           + &quot;RawCommandLineLaunch connector!&quot;);</span>
<span class="udiff-line-removed">-                 return 0;</span>
<span class="udiff-line-removed">-             }</span>
              Map&lt;java.lang.String,? extends com.sun.jdi.connect.Connector.Argument&gt; cdfltArgmnts = c.defaultArguments();
              int ksz = cdfltArgmnts.size();
              String av[] = new String[ksz + 1];
              Set ks = cdfltArgmnts.keySet();
              if (ks.isEmpty()) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -136,11 +121,11 @@</span>
                      continue;
                  }
                  flg = true;
                  ovl = argHandler.getLaunchExecPath() + &quot; &quot;
                       + &quot;-Xdebug -Xnoagent -Djava.compiler=NONE &quot;
<span class="udiff-line-modified-removed">-                      + &quot;-Xrunjdwp:transport=dt_socket,suspend=y,&quot;</span>
<span class="udiff-line-modified-added">+                      + &quot;-Xrunjdwp:transport=&quot; + c.transport().name() + &quot;,suspend=y,&quot;</span>
                       + &quot;address=&quot; + address + &quot; nsk.jdi.Argument.value.value004a&quot;;
                  if (argval.isValid(ovl)) {
                      argval.setValue(ovl);
                  } else {
                      log.complain(&quot;FAILURE: Can&#39;t set up new value for &quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -211,10 +196,14 @@</span>
                                     + &quot;with &quot; + extcd + &quot; exit code.&quot;);
                          return 2;
                      }
                  }
              }
<span class="udiff-line-modified-removed">-         };</span>
<span class="udiff-line-modified-added">+             skipped = false;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (skipped) {</span>
<span class="udiff-line-added">+             throw new SkippedException(&quot;no suitable connectors&quot;);</span>
<span class="udiff-line-added">+         }</span>
          log.display(&quot;Test PASSED!&quot;);
          return 0;
      }
  }
</pre>
<center><a href="../../../../../serviceability/threads/TestFalseDeadLock.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="value004/TestDescription.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>