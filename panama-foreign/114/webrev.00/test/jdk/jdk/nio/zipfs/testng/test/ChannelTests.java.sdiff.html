<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/jdk/nio/zipfs/testng/test/ChannelTests.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../internal/jrtfs/Basic.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../sun/java2d/loops/RenderToCustomBufferTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/jdk/nio/zipfs/testng/test/ChannelTests.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 322                            final int compression) throws Exception {
 323         Path zipFile = generatePath(HERE, &quot;test&quot;, &quot;.zip&quot;);
 324         Files.deleteIfExists(zipFile);
 325         Entry e0 = Entry.of(&quot;Entry-0&quot;, compression, THE_SLAMS);
 326         zip(zipFile, env, e0);
 327         // Validate that a FileAlreadyExistsException is thrown
 328         try (FileSystem zipfs = FileSystems.newFileSystem(zipFile, env)) {
 329             assertThrows(FileAlreadyExistsException.class, () -&gt;
 330                     Files.newByteChannel(zipfs.getPath(e0.name),
 331                             Set.of(CREATE_NEW, WRITE)));
 332             assertThrows(FileAlreadyExistsException.class, () -&gt;
 333                     Files.newByteChannel(zipfs.getPath(e0.name),
 334                             Set.of(CREATE_NEW, APPEND)));
 335         }
 336         Files.deleteIfExists(zipFile);
 337     }
 338 
 339     /**
 340      * Validate when SeekableByteChannel::close is called more than once, that
 341      * no error occurs
<span class="line-removed"> 342      * &lt;p&gt;</span>
<span class="line-removed"> 343      * Note: this is currently disabled due to bug JDK-8241883</span>
 344      *
 345      * @param env         Zip FS properties to use when creating the Zip file
 346      * @param compression The compression used when writing the entries
 347      * @throws Exception If an error occurs
 348      */
<span class="line-modified"> 349     @Test(dataProvider = &quot;zipfsMap&quot;, enabled = false)</span>
 350     public void sbcCloseTest(final Map&lt;String, String&gt; env,
 351                              final int compression) throws Exception {
 352         Path zipFile = generatePath(HERE, &quot;test&quot;, &quot;.zip&quot;);
 353         Files.deleteIfExists(zipFile);
 354         Entry e0 = Entry.of(&quot;Entry-0&quot;, compression, THE_SLAMS);
 355         zip(zipFile, env, e0);
 356         try (FileSystem zipfs = FileSystems.newFileSystem(zipFile, env)) {
 357             SeekableByteChannel sbc = Files.newByteChannel(zipfs.getPath(e0.name),
 358                     Set.of(READ, WRITE));
 359             sbc.close();
 360             sbc.close();
 361             assertFalse(sbc.isOpen());
 362         }
 363         Files.deleteIfExists(zipFile);
 364     }
 365 
 366     /**
 367      * Validate ClosedChannelException is thrown when a SeekableByteChannel
 368      * method is invoked after calling SeekableByteChannel::close
 369      *
</pre>
</td>
<td>
<hr />
<pre>
 322                            final int compression) throws Exception {
 323         Path zipFile = generatePath(HERE, &quot;test&quot;, &quot;.zip&quot;);
 324         Files.deleteIfExists(zipFile);
 325         Entry e0 = Entry.of(&quot;Entry-0&quot;, compression, THE_SLAMS);
 326         zip(zipFile, env, e0);
 327         // Validate that a FileAlreadyExistsException is thrown
 328         try (FileSystem zipfs = FileSystems.newFileSystem(zipFile, env)) {
 329             assertThrows(FileAlreadyExistsException.class, () -&gt;
 330                     Files.newByteChannel(zipfs.getPath(e0.name),
 331                             Set.of(CREATE_NEW, WRITE)));
 332             assertThrows(FileAlreadyExistsException.class, () -&gt;
 333                     Files.newByteChannel(zipfs.getPath(e0.name),
 334                             Set.of(CREATE_NEW, APPEND)));
 335         }
 336         Files.deleteIfExists(zipFile);
 337     }
 338 
 339     /**
 340      * Validate when SeekableByteChannel::close is called more than once, that
 341      * no error occurs


 342      *
 343      * @param env         Zip FS properties to use when creating the Zip file
 344      * @param compression The compression used when writing the entries
 345      * @throws Exception If an error occurs
 346      */
<span class="line-modified"> 347     @Test(dataProvider = &quot;zipfsMap&quot;)</span>
 348     public void sbcCloseTest(final Map&lt;String, String&gt; env,
 349                              final int compression) throws Exception {
 350         Path zipFile = generatePath(HERE, &quot;test&quot;, &quot;.zip&quot;);
 351         Files.deleteIfExists(zipFile);
 352         Entry e0 = Entry.of(&quot;Entry-0&quot;, compression, THE_SLAMS);
 353         zip(zipFile, env, e0);
 354         try (FileSystem zipfs = FileSystems.newFileSystem(zipFile, env)) {
 355             SeekableByteChannel sbc = Files.newByteChannel(zipfs.getPath(e0.name),
 356                     Set.of(READ, WRITE));
 357             sbc.close();
 358             sbc.close();
 359             assertFalse(sbc.isOpen());
 360         }
 361         Files.deleteIfExists(zipFile);
 362     }
 363 
 364     /**
 365      * Validate ClosedChannelException is thrown when a SeekableByteChannel
 366      * method is invoked after calling SeekableByteChannel::close
 367      *
</pre>
</td>
</tr>
</table>
<center><a href="../../../../internal/jrtfs/Basic.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../sun/java2d/loops/RenderToCustomBufferTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>