<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/nashorn/script/basic/JDK-8161579.js</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
  <body>
    <pre>
 1 /*
 2  * Copyright (c) 2016, Oracle and/or its affiliates. All rights reserved.
 3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 4  * 
 5  * This code is free software; you can redistribute it and/or modify it
 6  * under the terms of the GNU General Public License version 2 only, as
 7  * published by the Free Software Foundation.
 8  * 
 9  * This code is distributed in the hope that it will be useful, but WITHOUT
10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
12  * version 2 for more details (a copy is included in the LICENSE file that
13  * accompanied this code).
14  * 
15  * You should have received a copy of the GNU General Public License version
16  * 2 along with this work; if not, write to the Free Software Foundation,
17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
18  * 
19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
20  * or visit www.oracle.com if you need additional information or have any
21  * questions.
22  */
23 
24 /**
25  * JDK-8161579: Array-like AbstractJSObject-based instance not treated as array by native array functions
26  *
27  * @test
28  * @run
29  */
30 
31 
32 var AbstractJSObject = Java.type(&quot;jdk.nashorn.api.scripting.AbstractJSObject&quot;);
33 var JavaStringArray = Java.type(&quot;java.lang.String[]&quot;);
34 var JavaArrayList = Java.type(&quot;java.util.ArrayList&quot;);
35 
36 var arrayLikeJSObject = new AbstractJSObject() {
37     hasMember: function(name) { return name == &quot;length&quot;; },
38     getMember: function(name) { return name == &quot;length&quot; ? 3 : null; },
39     hasSlot: function(slot) { return slot &gt;= 0 &amp;&amp; slot &lt;= 2; },
40     getSlot: function(slot) { return &quot;abc&quot;[slot]; },
41     isArray: function() { return true; }
42 }
43 
44 var javaStringArray = new JavaStringArray(3);
45 javaStringArray[0] = &quot;x&quot;;
46 javaStringArray[1] = &quot;y&quot;;
47 javaStringArray[2] = &quot;z&quot;;
48 
49 var javaArrayList = new JavaArrayList();
50 javaArrayList.add(&quot;i&quot;);
51 javaArrayList.add(&quot;j&quot;);
52 javaArrayList.add(&quot;k&quot;);
53 
54 Assert.assertEquals([1, 2, 3].concat(arrayLikeJSObject).join(), &quot;1,2,3,a,b,c&quot;);
55 Assert.assertEquals([1, 2, 3].concat(javaStringArray).join(), &quot;1,2,3,x,y,z&quot;);
56 Assert.assertEquals([1, 2, 3].concat(javaArrayList).join(), &quot;1,2,3,i,j,k&quot;);
57 Assert.assertEquals([1, 2, 3].concat(&quot;foo&quot;).join(), &quot;1,2,3,foo&quot;);
58 Assert.assertEquals([1, 2, 3].concat(4).join(), &quot;1,2,3,4&quot;);
59 Assert.assertEquals([1, 2, 3].concat(false).join(), &quot;1,2,3,false&quot;);
60 
    </pre>
  </body>
</html>