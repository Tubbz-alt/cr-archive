<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/nashorn/script/basic/NASHORN-768.js</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
  <body>
    <pre>
 1 /*
 2  * Copyright (c) 2010, 2013, Oracle and/or its affiliates. All rights reserved.
 3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 4  *
 5  * This code is free software; you can redistribute it and/or modify it
 6  * under the terms of the GNU General Public License version 2 only, as
 7  * published by the Free Software Foundation.
 8  *
 9  * This code is distributed in the hope that it will be useful, but WITHOUT
10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
12  * version 2 for more details (a copy is included in the LICENSE file that
13  * accompanied this code).
14  *
15  * You should have received a copy of the GNU General Public License version
16  * 2 along with this work; if not, write to the Free Software Foundation,
17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
18  *
19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
20  * or visit www.oracle.com if you need additional information or have any
21  * questions.
22  */
23 
24 /**
25  * NASHORN-768 :  Implement cross context property/function access and browser JSObject access by JSObject dynalink linker
26  *
27  * @test
28  * @option -scripting
29  * @run
30  */
31 
32 // create another nashorn engine
33 var m = new javax.script.ScriptEngineManager();
34 var engine = m.getEngineByName(&quot;nashorn&quot;);
35 
36 // our global var &#39;id&#39;
37 var id = &quot;global-id&quot;;
38 
39 engine.eval(&lt;&lt;CODE
40 
41 // code evaluated in engine
42 
43 // engine code&#39;s id
44 var id = &quot;engine-global-id&quot;;
45 
46 // global object
47 var obj = {
48     foo: 42,
49     bar: function(x) {
50         if (id != &quot;engine-global-id&quot;) {
51             throw &quot;id != &#39;engine-global-id&#39;&quot;;
52         }
53         // check this.foo is accessible
54         if (this.foo != 42) {
55             throw &quot;this.foo != 42&quot;;
56         }
57 
58         return x;
59     }
60 };
61 
62 // global function
63 function func(callback) {
64     var res = callback(id);
65     if (res != id) {
66         fail(&quot;result of callback is wrong&quot;);
67     }
68 }
69 
70 CODE);
71 
72 var obj = engine.get(&quot;obj&quot;);
73 if (obj.bar(&quot;hello&quot;) != &quot;hello&quot;) {
74     fail(&quot;obj.bar(&#39;hello&#39;) return value is wrong&quot;);
75 }
76 
77 if (obj.foo != 42) {
78     fail(&quot;obj.foo != 42&quot;);
79 }
80 
81 var func = engine.get(&quot;func&quot;);
82 var inside_f = false;
83 function f(arg) {
84     inside_f = true;
85     if (id != &quot;global-id&quot;) {
86         fail(&quot;id != &#39;global-id&#39;&quot;);
87     }
88     return arg;
89 }
90 func(f);
91 if (! inside_f) {
92     fail(&quot;function &#39;f&#39; was not called&quot;);
93 }
    </pre>
  </body>
</html>