<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/nashorn/script/basic/JDK-8047057.js</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
  <body>
    <pre>
 1 /*
 2  * Copyright (c) 2014, Oracle and/or its affiliates. All rights reserved.
 3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 4  *
 5  * This code is free software; you can redistribute it and/or modify it
 6  * under the terms of the GNU General Public License version 2 only, as
 7  * published by the Free Software Foundation.
 8  *
 9  * This code is distributed in the hope that it will be useful, but WITHOUT
10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
12  * version 2 for more details (a copy is included in the LICENSE file that
13  * accompanied this code).
14  *
15  * You should have received a copy of the GNU General Public License version
16  * 2 along with this work; if not, write to the Free Software Foundation,
17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
18  *
19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
20  * or visit www.oracle.com if you need additional information or have any
21  * questions.
22  */
23 
24 /**
25  * JDK-8047057: Add a regression test for the passing test cases from JDK-8042304
26  *
27  * @test
28  * @run
29  */
30 
31 // commented out makeFuncAndCall calls are still result in crash
32 // Tests commented with //** fail only when assertions are turned on
33 
34 function makeFuncAndCall(code) {
35     Function(code)();
36 }
37 
38 function makeFuncExpectError(code, ErrorType) {
39     try {
40         makeFuncAndCall(code);
41     } catch (e) {
42         if (! (e instanceof ErrorType)) {
43             fail(ErrorType.name + &quot; expected, got &quot; + e);
44         }
45     }
46 }
47 
48 makeFuncAndCall(&quot;switch(0) { default: {break;} return }&quot;);
49 makeFuncAndCall(&quot;L: { { break L; } return; }&quot;);
50 makeFuncAndCall(&quot;L: { while(0) break L; return; }&quot;);
51 makeFuncExpectError(&quot;L: {while(0) break L; return [](); }&quot;, TypeError);
52 makeFuncAndCall(&quot;do with({}) break ; while(0);&quot;);
53 makeFuncAndCall(&quot;while(0) with({}) continue ;&quot;);
54 makeFuncAndCall(&quot;eval([]);&quot;);
55 makeFuncAndCall(&quot;try{} finally{[]}&quot;);
56 makeFuncAndCall(&quot;try { } catch(x if 1) { try { } catch(x2) { } }&quot;);
57 makeFuncAndCall(&quot;try { } catch(x if 1) { try { return; } catch(x2) { { } } }&quot;);
58 makeFuncAndCall(&quot;Error() * (false)[-0]--&quot;);
59 makeFuncAndCall(&quot;try { var x = 1, x = null; } finally { }&quot;);
60 makeFuncAndCall(&quot;try { var x = {}, x = []; } catch(x3) { }&quot;);
61 makeFuncAndCall(&quot;[delete this]&quot;);
62 makeFuncAndCall(&quot;if(eval(&#39;&#39;, eval(&#39;&#39;, function() {}))) { }&quot;);
63 makeFuncAndCall(&quot;if(eval(&#39;&#39;, eval(&#39;&#39;, function() {}))) { }&quot;);
64 makeFuncAndCall(&quot;eval(\&quot;[,,];\&quot;, [11,12,13,14].some)&quot;);
65 makeFuncAndCall(&quot;eval(\&quot;1.2e3\&quot;, ({})[ /x/ ])&quot;);
66 makeFuncExpectError(&quot;eval(\&quot;x4\&quot;, x3);&quot;, ReferenceError);
67 makeFuncAndCall(&quot;with({5.0000000000000000000000: String()}){(false); }&quot;);
68 makeFuncAndCall(&quot;try { var x = undefined, x = 5.0000000000000000000000; } catch(x) { x = undefined; }&quot;);
69 makeFuncAndCall(&quot;(function (x){ x %= this}(false))&quot;);
70 makeFuncAndCall(&quot;eval.apply.apply(function(){ eval(&#39;&#39;) })&quot;);
71 makeFuncAndCall(&quot;(false % !this) &amp;&amp; 0&quot;);
72 makeFuncAndCall(&quot;with({8: &#39;fafafa&#39;.replace()}){ }&quot;);
73 makeFuncAndCall(&quot;(function (x) &#39;&#39; )(true)&quot;);
74 makeFuncExpectError(&quot;new eval(function(){})&quot;, TypeError);
75 makeFuncAndCall(&#39;eval(&quot;23&quot;, ({})[/x/])&#39;);
    </pre>
  </body>
</html>