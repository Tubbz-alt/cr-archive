<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/nashorn/script/sandbox/javaextend.js</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2010, 2013, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /**
 25  * @test
 26  * @run
 27  */
 28 
 29 function model(n) {
 30   return Java.type(&quot;jdk.nashorn.test.models.&quot; + n)
 31 }
 32 
 33 // Can&#39;t extend a final class
 34 try {
 35     Java.extend(model(&quot;FinalClass&quot;))
 36 } catch(e) {
 37     print(e)
 38 }
 39 
 40 // Can&#39;t extend a class with no public or protected constructor
 41 try {
 42     Java.extend(model(&quot;NoAccessibleConstructorClass&quot;))
 43 } catch(e) {
 44     print(e)
 45 }
 46 
 47 // Can&#39;t extend a non-public class
 48 try {
 49     Java.extend(model(&quot;NonPublicClass&quot;))
 50 } catch(e) {
 51     print(e)
 52 }
 53 
 54 // Can&#39;t extend a class with explicit non-overridable finalizer
 55 try {
 56     Java.extend(model(&quot;ClassWithFinalFinalizer&quot;))
 57 } catch(e) {
 58     print(e)
 59 }
 60 
 61 // Can&#39;t extend a class with inherited non-overridable finalizer
 62 try {
 63     Java.extend(model(&quot;ClassWithInheritedFinalFinalizer&quot;))
 64 } catch(e) {
 65     print(e)
 66 }
 67 
 68 
 69 // Can&#39;t extend two classes
 70 try {
 71     Java.extend(java.lang.Thread,java.lang.Number)
 72 } catch(e) {
 73     print(e)
 74 }
 75 
 76 // Make sure we can implement interfaces from the unnamed package
 77 var c = new (Java.extend(Java.type(&quot;UnnamedPackageTestCallback&quot;)))() { call: function(s) { return s + s } }
 78 print(c.call(&quot;abcd&quot;))
 79 
 80 // Basic Runnable from an object
 81 new (Java.extend(java.lang.Runnable))({ run: function() { print(&quot;run-object&quot;) } }).run()
 82 
 83 // Basic Runnable from a function
 84 new (Java.extend(java.lang.Runnable))(function() { print(&quot;run-fn&quot;) }).run()
 85 
 86 // Basic Runnable from an autoconverted function
 87 var t = new java.lang.Thread(function() { print(&quot;run-fn-autoconvert&quot;) })
 88 t.start()
 89 t.join()
 90 
 91 // SAM conversion should work on overloaded methods of same name
 92 var os = new (Java.extend(model(&quot;OverloadedSam&quot;)))(function(s1, s2) { print(&quot;overloaded-sam: &quot; + s1 + &quot;, &quot; + s2) })
 93 os.sam(&quot;x&quot;)
 94 os.sam(&quot;x&quot;, &quot;y&quot;)
 95 
 96 // Test overriding of hashCode, equals, and toString
 97 var oo = Java.extend(model(&quot;OverrideObject&quot;))
 98 // First, see non-overridden values
 99 print(&quot;oo-plain-hashCode: &quot; + (new oo({})).hashCode())
100 print(&quot;oo-plain-toString: &quot; + (new oo({})).toString())
101 print(&quot;oo-plain-equals  : &quot; + (new oo({})).equals({}))
102 // Now, override them
103 print(&quot;oo-overridden-hashCode: &quot; + (new oo({ hashCode: function() { return 6 }})).hashCode())
104 print(&quot;oo-overridden-toString: &quot; + (new oo({ toString: function() { return &quot;override-object-overriden&quot; }})).toString())
105 print(&quot;oo-overridden-equals  : &quot; + (new oo({ equals: function() { return true }})).equals({}))
106 // Finally, test that equals and hashCode can be overridden with functions from a prototype, but toString() can&#39;t:
107 function Proto() {
108     return this;
109 }
110 Proto.prototype = {
111     toString: function() { return &quot;this-will-never-be-seen&quot; }, // toString only overridden when it&#39;s own property, never from prototype
112     equals: function() { return true },
113     hashCode: function() { return 7 }
114 }
115 print(&quot;oo-proto-overridden-hashCode: &quot; + (new oo(new Proto())).hashCode())
116 print(&quot;oo-proto-overridden-toString: &quot; + (new oo(new Proto())).toString())
117 print(&quot;oo-proto-overridden-equals  : &quot; + (new oo(new Proto())).equals({}))
118 
119 // Subclass a class with a protected constructor, and one that takes
120 // additional constructor arguments (a token). Also demonstrates how can
121 // you access the Java adapter instance from the script (just store it in the
122 // scope, in this example, &quot;cwa&quot;) to retrieve the token later on.
123 var cwa = new (Java.extend(model(&quot;ConstructorWithArgument&quot;)))(&quot;cwa-token&quot;, function() { print(cwa.token) })
124 cwa.doSomething()
125 
126 // Do the same thing with proprietary syntax and object literal
127 var cwa2 = new (model(&quot;ConstructorWithArgument&quot;))(&quot;cwa2-token&quot;) { doSomething: function() { print(&quot;cwa2-&quot; + cwa2.token ) } }
128 cwa2.doSomething()
129 
130 // Implement two interfaces
131 var desertToppingAndFloorWax = new (Java.extend(model(&quot;DessertTopping&quot;), model(&quot;FloorWax&quot;))) {
132     pourOnDessert: function() { print(&quot;Glop; IM IN UR DESSERT NOW&quot;) },
133     shineUpTheFloor: function() { print(&quot;The floor sure is shining!&quot;) }
134 }
135 var dtfwDriver = new (model(&quot;DessertToppingFloorWaxDriver&quot;))
136 dtfwDriver.decorateDessert(desertToppingAndFloorWax)
137 dtfwDriver.waxFloor(desertToppingAndFloorWax)
138 
139 // Extend a class and implement two interfaces. For additional measure, put the class in between the two interfaces
140 var desertToppingFloorWaxAndToothpaste = new (Java.extend(model(&quot;DessertTopping&quot;), model(&quot;Toothpaste&quot;), model(&quot;FloorWax&quot;))) {
141     pourOnDessert: function() { print(&quot;Yum&quot;) },
142     shineUpTheFloor: function() { print(&quot;Scrub, scrub, scrub&quot;) },
143     applyToBrushImpl: function() { print(&quot;It&#39;s a dessert topping! It&#39;s a floor wax! It&#39;s a toothpaste!&quot;) }
144 }
145 dtfwDriver.decorateDessert(desertToppingFloorWaxAndToothpaste)
146 dtfwDriver.waxFloor(desertToppingFloorWaxAndToothpaste)
147 desertToppingFloorWaxAndToothpaste.applyToBrush();
    </pre>
  </body>
</html>