<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/nashorn/script/nosecurity/parservisitor.js</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2015, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  * 
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  * 
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  * 
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  * 
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /**
 25  * Nashorn parser API - Basic TreeVisitor tests.
 26  *
 27  * @test
 28  * @option -scripting
 29  * @run
 30  */
 31 
 32 // Java types used
 33 var SimpleTreeVisitor = Java.type(&quot;jdk.nashorn.api.tree.SimpleTreeVisitorES5_1&quot;);
 34 var Parser = Java.type(&quot;jdk.nashorn.api.tree.Parser&quot;);
 35 
 36 function parse(name, script, visitor) {
 37     var parser = Parser.create(&quot;--empty-statements&quot;);
 38     var tree = parser.parse(name, script, null);
 39     return tree.accept(visitor, print);
 40 }
 41 
 42 parse(&quot;arrayaccess.js&quot;, &quot;this[&#39;eval&#39;]&quot;,
 43     new (Java.extend(SimpleTreeVisitor))() {
 44         visitArrayAccess: function(aa) {
 45             print(&quot;in visitArrayAccess &quot; +
 46               aa.expression.name + &quot; &quot; + aa.index.value);
 47         }
 48     });
 49 
 50 parse(&quot;arrayliteral.js&quot;, &quot;[2, 3, 22]&quot;,
 51     new (Java.extend(SimpleTreeVisitor))() {
 52         visitArrayLiteral: function(al) {
 53             print(&quot;in visitArrayLiteral&quot;);
 54             for each (var e in al.elements) {
 55                print(e.value);
 56             }
 57         }
 58     });
 59 
 60 parse(&quot;assign.js&quot;, &quot;x = 33&quot;,
 61     new (Java.extend(SimpleTreeVisitor))() {
 62         visitAssignment: function(an) {
 63             print(&quot;in visitAssignment &quot; +
 64                 an.variable.name + &quot; &quot; + an.expression.value);
 65         }
 66     });
 67 
 68 function binaryExpr(name, code) {
 69     parse(name, code, 
 70         new (Java.extend(SimpleTreeVisitor))() {
 71             visitBinary: function(bn) {
 72                 print(&quot;in visitBinary &quot; + bn.kind + &quot; &quot; +
 73                     bn.leftOperand.value + &quot;, &quot; + bn.rightOperand.value);
 74             }
 75         });
 76 }
 77 
 78 binaryExpr(&quot;add.js&quot;, &quot;3 + 4&quot;);
 79 binaryExpr(&quot;sub.js&quot;, &quot;3 - 4&quot;);
 80 binaryExpr(&quot;mul.js&quot;, &quot;3 * 4&quot;);
 81 binaryExpr(&quot;div.js&quot;, &quot;3 / 4&quot;);
 82 binaryExpr(&quot;rem.js&quot;, &quot;3 % 4&quot;);
 83 binaryExpr(&quot;rshift.js&quot;, &quot;3 &gt;&gt; 4&quot;);
 84 binaryExpr(&quot;rshift.js&quot;, &quot;3 &gt;&gt;&gt; 4&quot;);
 85 binaryExpr(&quot;lshift.js&quot;, &quot;3 &lt;&lt; 4&quot;);
 86 binaryExpr(&quot;less.js&quot;, &quot;3 &lt; 4&quot;);
 87 binaryExpr(&quot;lessOrEq.js&quot;, &quot;3 &lt;= 4&quot;);
 88 binaryExpr(&quot;greater.js&quot;, &quot;3 &gt; 4&quot;);
 89 binaryExpr(&quot;greaterOrEq.js&quot;, &quot;3 &gt;= 4&quot;);
 90 binaryExpr(&quot;in.js&quot;, &quot;3 in this&quot;);
 91 binaryExpr(&quot;eq.js&quot;, &quot;3 == 3&quot;);
 92 binaryExpr(&quot;ne.js&quot;, &quot;3 != 2&quot;);
 93 binaryExpr(&quot;seq.js&quot;, &quot;3 === 2&quot;);
 94 binaryExpr(&quot;sne.js&quot;, &quot;3 !== 2&quot;);
 95 binaryExpr(&quot;and.js&quot;, &quot;3 &amp; 2&quot;);
 96 binaryExpr(&quot;or.js&quot;, &quot;3 | 2&quot;);
 97 binaryExpr(&quot;xor.js&quot;, &quot;3 ^ 2&quot;);
 98 binaryExpr(&quot;cond_and.js&quot;, &quot;3 &amp;&amp; 2&quot;);
 99 binaryExpr(&quot;cond_or.js&quot;, &quot;3 || 2&quot;);
100 binaryExpr(&quot;comma&quot;, &quot;3, 2&quot;);
101 
102 parse(&quot;block.js&quot;, &quot;{ print(&#39;hello&#39;); }&quot;, 
103     new (Java.extend(SimpleTreeVisitor))() {
104         visitBlock: function() {
105             print(&quot;in visitBlock&quot;);
106         }
107     });
108 
109 
110 parse(&quot;break.js&quot;, &quot;while(true) { break; }&quot;, 
111     new (Java.extend(SimpleTreeVisitor))() {
112         visitBreak: function() {
113             print(&quot;in visitBreak&quot;);
114         }
115     });
116 
117 function compAssignExpr(name, code) {
118     parse(name, code, 
119         new (Java.extend(SimpleTreeVisitor))() {
120             visitCompoundAssignment: function(bn) {
121                 print(&quot;in visitCompoundAssignment &quot; + bn.kind + &quot; &quot; +
122                   bn.variable.name + &quot; &quot; + bn.expression.value);
123             }
124         });
125 }
126 
127 compAssignExpr(&quot;mult_assign.js&quot;, &quot;x *= 3&quot;);
128 compAssignExpr(&quot;div_assign.js&quot;, &quot;x /= 3&quot;);
129 compAssignExpr(&quot;rem_assign.js&quot;, &quot;x %= 3&quot;);
130 compAssignExpr(&quot;add_assign.js&quot;, &quot;x += 3&quot;);
131 compAssignExpr(&quot;sub_assign.js&quot;, &quot;x -= 3&quot;);
132 compAssignExpr(&quot;lshift_assign.js&quot;, &quot;x &lt;&lt;= 3&quot;);
133 compAssignExpr(&quot;rshift_assign.js&quot;, &quot;x &gt;&gt;= 3&quot;);
134 compAssignExpr(&quot;urshift_assign.js&quot;, &quot;x &gt;&gt;&gt;= 3&quot;);
135 compAssignExpr(&quot;and_assign.js&quot;, &quot;x &amp;= 3&quot;);
136 compAssignExpr(&quot;xor_assign.js&quot;, &quot;x ^= 3&quot;);
137 compAssignExpr(&quot;or_assign.js&quot;, &quot;x |= 3&quot;);
138 
139 parse(&quot;condexpr.js&quot;, &quot;foo? x : y&quot;, 
140     new (Java.extend(SimpleTreeVisitor))() {
141         visitConditionalExpression: function() {
142             print(&quot;in visitConditionalExpression&quot;);
143         }
144     });
145 
146 parse(&quot;continue.js&quot;, &quot;while(true) { continue; }&quot;, 
147     new (Java.extend(SimpleTreeVisitor))() {
148         visitContinue: function() {
149             print(&quot;in visitContinue&quot;);
150         }
151     });
152 
153 parse(&quot;debugger.js&quot;, &quot;debugger;&quot;, 
154     new (Java.extend(SimpleTreeVisitor))() {
155         visitDebugger: function() {
156             print(&quot;in visitDebugger&quot;);
157         }
158     });
159 
160 parse(&quot;dowhile.js&quot;, &quot;do {} while(true)&quot;, 
161     new (Java.extend(SimpleTreeVisitor))() {
162         visitDoWhileLoop: function() {
163             print(&quot;in visitDoWhileLoop&quot;);
164         }
165     });
166 
167 parse(&quot;empty.js&quot;, &quot;;&quot;, 
168     new (Java.extend(SimpleTreeVisitor))() {
169         visitEmptyStatement: function() {
170             print(&quot;in visitEmptyStatement&quot;);
171         }
172     });
173 
174 parse(&quot;exprstat.js&quot;, &quot;2+3;&quot;, 
175     new (Java.extend(SimpleTreeVisitor))() {
176         visitExpressionStatement: function() {
177             print(&quot;in visitExpressionStatement&quot;);
178         }
179     });
180 
181 parse(&quot;forin.js&quot;, &quot;for(i in this) {}&quot;, 
182     new (Java.extend(SimpleTreeVisitor))() {
183         visitForInLoop: function() {
184             print(&quot;in visitForInLoop&quot;);
185         }
186     });
187 
188 parse(&quot;for.js&quot;, &quot;for(;;) {}&quot;, 
189     new (Java.extend(SimpleTreeVisitor))() {
190         visitForLoop: function() {
191             print(&quot;in visitForLoop&quot;);
192         }
193     });
194 
195 parse(&quot;funccall.js&quot;, &quot;func()&quot;, 
196     new (Java.extend(SimpleTreeVisitor))() {
197         visitFunctionCall: function(fc) {
198             print(&quot;in visitFunctionCall &quot; + fc.functionSelect.name);
199         }
200     });
201 
202 parse(&quot;funcdecl.js&quot;, &quot;function func() {}&quot;, 
203     new (Java.extend(SimpleTreeVisitor))() {
204         visitFunctionDeclaration: function(fd) {
205             print(&quot;in visitFunctionDeclaration &quot; + fd.name.name);
206         }
207     });
208 
209 parse(&quot;funcexpr.js&quot;, &quot;x = function() {}&quot;, 
210     new (Java.extend(SimpleTreeVisitor))() {
211         visitFunctionExpression: function() {
212             print(&quot;in visitFunctionExpression&quot;);
213         }
214     });
215 
216 parse(&quot;ident.js&quot;, &quot;this&quot;, 
217     new (Java.extend(SimpleTreeVisitor))() {
218         visitIdentifier: function(ident) {
219             print(&quot;in visitIdentifier &quot; + ident.name);
220         }
221     });
222 
223 parse(&quot;if.js&quot;, &quot;if (true) {}&quot;, 
224     new (Java.extend(SimpleTreeVisitor))() {
225         visitIf: function() {
226             print(&quot;in visitIf&quot;);
227         }
228     });
229 
230 parse(&quot;if2.js&quot;, &quot;if (true) print(&#39;yes&#39;)&quot;, 
231     new (visitor = Java.extend(SimpleTreeVisitor))() {
232         visitBlock: function(node, extra) {
233             print(&quot;ERROR: No block expected here!&quot;);
234             Error.dumpStack();
235         }
236     });
237 
238 parse(&quot;instanceof.js&quot;, &quot;this instanceof Object&quot;, 
239     new (Java.extend(SimpleTreeVisitor))() {
240         visitInstanceOf: function() {
241             print(&quot;in visitInstanceOf&quot;);
242         }
243     });
244 
245 parse(&quot;labeled.js&quot;, &quot;foo: print(&#39;hello&#39;);&quot;, 
246     new (Java.extend(SimpleTreeVisitor))() {
247         visitLabeledStatement: function() {
248             print(&quot;in visitLabeledStatement&quot;);
249         }
250     });
251 
252 function literalExpr(name, code) {
253     parse(name, code, 
254         new (Java.extend(SimpleTreeVisitor))() {
255             visitLiteral: function(ln) {
256                 print(&quot;in visitLiteral &quot; + ln.kind + &quot; &quot; + ln.value);
257             }
258         });
259 }
260 
261 literalExpr(&quot;bool.js&quot;, &quot;true&quot;);
262 literalExpr(&quot;num.js&quot;, &quot;3.14&quot;);
263 literalExpr(&quot;str.js&quot;, &quot;&#39;hello&#39;&quot;);
264 literalExpr(&quot;null.js&quot;, &quot;null&quot;);
265 
266 parse(&quot;memselect.js&quot;, &quot;this.foo&quot;, 
267     new (Java.extend(SimpleTreeVisitor))() {
268         visitMemberSelect: function(ms) {
269             print(&quot;in visitMemberSelect &quot; + ms.identifier);
270         }
271     });
272 
273 parse(&quot;new.js&quot;, &quot;new Object()&quot;, 
274     new (Java.extend(SimpleTreeVisitor))() {
275         visitNew: function() {
276             print(&quot;in visitNew&quot;);
277         }
278     });
279 
280 parse(&quot;obj_literal.js&quot;, &quot;({ foo: 343 })&quot;, 
281     visitor = new (Java.extend(SimpleTreeVisitor))() {
282         visitObjectLiteral: function(ol) {
283             print(&quot;in visitObjectLiteral&quot;);
284             Java.super(visitor).visitObjectLiteral(ol, null);
285         },
286 
287         visitProperty: function(pn) {
288             print(&quot;in visitProperty &quot; + pn.key.name);
289         }
290     });
291 
292 parse(&quot;regexp.js&quot;, &quot;/[a-b]/i&quot;, 
293     new (Java.extend(SimpleTreeVisitor))() {
294         visitRegExpLiteral: function(re) {
295             print(&quot;in visitRegExpLiteral &quot; + re.pattern + &quot; &quot; + re.options);
296         }
297     });
298 
299 parse(&quot;ret.js&quot;, &quot;function func() { return 33 }&quot;, 
300     new (Java.extend(SimpleTreeVisitor))() {
301         visitReturn: function(ret) {
302             print(&quot;in visitReturn &quot; + ret.expression.value);
303         }
304     });
305 
306 parse(&quot;switch.js&quot;, &quot;switch(c) { case &#39;1&#39;: break; default: }&quot;, 
307     visitor = new (Java.extend(SimpleTreeVisitor))() {
308         visitSwitch: function(sn) {
309             print(&quot;in visitSwitch&quot;);
310             Java.super(visitor).visitSwitch(sn, null);
311         },
312 
313         visitCase: function(cn) {
314             if (cn.expression) {
315                 print(&quot;in visitCase&quot;);
316             } else {
317                 print(&quot;in visitCase (default)&quot;);
318             }
319         }
320     });
321 
322 parse(&quot;throw.js&quot;, &quot;throw 2&quot;, 
323     new (Java.extend(SimpleTreeVisitor))() {
324         visitThrow: function(tn) {
325             print(&quot;in visitThrow &quot; + tn.expression.value);
326         }
327     });
328 
329 parse(&quot;try.js&quot;, &quot;try { func() } catch(e) {}&quot;, 
330     visitor = new (Java.extend(SimpleTreeVisitor))() {
331         visitTry: function(tn) {
332             print(&quot;in visitTry&quot;);
333             Java.super(visitor).visitTry(tn, null);
334         },
335         visitCatch: function(cn) {
336             print(&quot;in visitCatch &quot; + cn.parameter.name);
337         }
338     });
339 
340 function unaryExpr(name, code) {
341     parse(name, code, 
342         new (Java.extend(SimpleTreeVisitor))() {
343             visitUnary: function(un) {
344                 print(&quot;in visitUnary &quot; + un.kind + &quot; &quot; + un.expression.name);
345             }
346         });
347 }
348 
349 unaryExpr(&quot;postincr.js&quot;, &quot;x++&quot;);
350 unaryExpr(&quot;postdecr.js&quot;, &quot;x--&quot;);
351 unaryExpr(&quot;preincr.js&quot;, &quot;++x&quot;);
352 unaryExpr(&quot;predecr.js&quot;, &quot;--x&quot;);
353 unaryExpr(&quot;plus.js&quot;, &quot;+x&quot;);
354 unaryExpr(&quot;minus.js&quot;, &quot;-x&quot;);
355 unaryExpr(&quot;complement.js&quot;, &quot;~x&quot;);
356 unaryExpr(&quot;logical_compl.js&quot;, &quot;!x&quot;);
357 unaryExpr(&quot;delete.js&quot;, &quot;delete x&quot;);
358 unaryExpr(&quot;typeof.js&quot;, &quot;typeof x&quot;);
359 unaryExpr(&quot;void.js&quot;, &quot;void x&quot;);
360 
361 parse(&quot;var.js&quot;, &quot;var x = 34;&quot;, 
362     new (Java.extend(SimpleTreeVisitor))() {
363         visitVariable: function(vn) {
364             print(&quot;in visitVariable &quot; + vn.binding.name + &quot; = &quot; + vn.initializer.value);
365         }
366     });
367 
368 parse(&quot;while.js&quot;, &quot;while(true) {}&quot;, 
369     new (Java.extend(SimpleTreeVisitor))() {
370         visitWhileLoop: function() {
371             print(&quot;in visitWhileLoop&quot;);
372         }
373     });
374 
375 parse(&quot;with.js&quot;, &quot;with({}) {}&quot;, 
376     new (Java.extend(SimpleTreeVisitor))() {
377         visitWith: function() {
378             print(&quot;in visitWith&quot;);
379         }
380     });
    </pre>
  </body>
</html>