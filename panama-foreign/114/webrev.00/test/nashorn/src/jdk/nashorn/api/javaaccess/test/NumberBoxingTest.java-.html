<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/nashorn/src/jdk/nashorn/api/javaaccess/test/NumberBoxingTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2010, 2013, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.nashorn.api.javaaccess.test;
 27 
 28 import static org.testng.AssertJUnit.assertEquals;
 29 import static org.testng.AssertJUnit.assertTrue;
 30 import javax.script.ScriptEngine;
 31 import javax.script.ScriptEngineManager;
 32 import javax.script.ScriptException;
 33 import org.testng.TestNG;
 34 import org.testng.annotations.AfterClass;
 35 import org.testng.annotations.BeforeClass;
 36 import org.testng.annotations.Test;
 37 
 38 /**
 39  * @test
 40  * @build jdk.nashorn.api.javaaccess.test.SharedObject jdk.nashorn.api.javaaccess.test.Person jdk.nashorn.api.javaaccess.test.NumberBoxingTest
 41  * @run testng/othervm jdk.nashorn.api.javaaccess.test.NumberBoxingTest
 42  */
 43 @SuppressWarnings(&quot;javadoc&quot;)
 44 public class NumberBoxingTest {
 45 
 46     private static ScriptEngine e;
 47     private static SharedObject o;
 48 
 49     public static void main(final String[] args) {
 50         TestNG.main(args);
 51     }
 52 
 53     @BeforeClass
 54     public static void setUpClass() throws ScriptException {
 55         final ScriptEngineManager m = new ScriptEngineManager();
 56         e = m.getEngineByName(&quot;nashorn&quot;);
 57         o = new SharedObject();
 58         e.put(&quot;o&quot;, o);
 59         e.eval(&quot;var SharedObject = Packages.jdk.nashorn.api.javaaccess.test.SharedObject;&quot;);
 60     }
 61 
 62     @AfterClass
 63     public static void tearDownClass() {
 64         e = null;
 65         o = null;
 66     }
 67 
 68     // --------------------------------long
 69     // tests------------------------------------
 70     @Test
 71     public void accessFieldLongBoxing() throws ScriptException {
 72         e.eval(&quot;var p_long = o.publicLongBox;&quot;);
 73         assertEquals(o.publicLongBox.longValue(), ((Number) e.get(&quot;p_long&quot;)).longValue());
 74         e.eval(&quot;o.publicLongBox = 12;&quot;);
 75         assertEquals(Long.valueOf(12), o.publicLongBox);
 76     }
 77 
 78     @Test
 79     public void accessStaticFieldLongBoxing() throws ScriptException {
 80         e.eval(&quot;var ps_long = SharedObject.publicStaticLongBox;&quot;);
 81         assertEquals(SharedObject.publicStaticLongBox.longValue(), ((Number) e.get(&quot;ps_long&quot;)).longValue());
 82         e.eval(&quot;SharedObject.publicStaticLongBox = 120;&quot;);
 83         assertEquals(120L, SharedObject.publicStaticLongBox.longValue());
 84     }
 85 
 86     @Test
 87     public void accessFinalFieldLongBoxing() throws ScriptException {
 88         e.eval(&quot;var pf_long = o.publicFinalLongBox;&quot;);
 89         assertEquals(o.publicFinalLongBox.longValue(), ((Number) e.get(&quot;pf_long&quot;)).longValue());
 90         e.eval(&quot;o.publicFinalLongBox = 120;&quot;);
 91         assertEquals(Long.valueOf(9377333334L), o.publicFinalLongBox);
 92     }
 93 
 94     @Test
 95     public void accessStaticFinalFieldLongBoxing() throws ScriptException {
 96         e.eval(&quot;var psf_long = SharedObject.publicStaticFinalLong;&quot;);
 97         assertEquals(SharedObject.publicStaticFinalLong, ((Number) e.get(&quot;psf_long&quot;)).longValue());
 98         e.eval(&quot;SharedObject.publicStaticFinalLong = 120;&quot;);
 99         assertEquals(8333333333333L, SharedObject.publicStaticFinalLong);
100     }
101 
102     // --------------------------------int
103     // tests------------------------------------
104     @Test
105     public void accessFieldIntBoxing() throws ScriptException {
106         e.eval(&quot;var p_int = o.publicIntBox;&quot;);
107         assertEquals(o.publicIntBox, e.get(&quot;p_int&quot;));
108         e.eval(&quot;o.publicIntBox = 14;&quot;);
109         assertEquals(Integer.valueOf(14), o.publicIntBox);
110     }
111 
112     @Test
113     public void accessStaticFieldIntBoxing() throws ScriptException {
114         e.eval(&quot;var ps_int = SharedObject.publicStaticInt;&quot;);
115         assertEquals(SharedObject.publicStaticInt, e.get(&quot;ps_int&quot;));
116         e.eval(&quot;SharedObject.publicStaticInt = 140;&quot;);
117         assertEquals(140, SharedObject.publicStaticInt);
118     }
119 
120     @Test
121     public void accessFinalFieldIntBoxing() throws ScriptException {
122         e.eval(&quot;var pf_int = o.publicFinalIntBox;&quot;);
123         assertEquals(o.publicFinalIntBox, e.get(&quot;pf_int&quot;));
124         e.eval(&quot;o.publicFinalIntBox = 10;&quot;);
125         assertEquals(Integer.valueOf(207512301), o.publicFinalIntBox);
126     }
127 
128     @Test
129     public void accessStaticFinalFieldIntBoxing() throws ScriptException {
130         e.eval(&quot;var psf_int = SharedObject.publicStaticFinalInt;&quot;);
131         assertEquals(SharedObject.publicStaticFinalInt, e.get(&quot;psf_int&quot;));
132         e.eval(&quot;SharedObject.publicStaticFinalInt = 140;&quot;);
133         assertEquals(207182023, SharedObject.publicStaticFinalInt);
134     }
135 
136     // --------------------------------byte
137     // tests------------------------------------
138     @Test
139     public void accessFieldByteBoxing() throws ScriptException {
140         e.eval(&quot;var p_byte = o.publicByteBox;&quot;);
141         assertEqualsDouble(o.publicByteBox, &quot;p_byte&quot;);
142         e.eval(&quot;o.publicByteBox = 16;&quot;);
143         assertEquals(Byte.valueOf((byte)16), o.publicByteBox);
144     }
145 
146     @Test
147     public void accessStaticFieldByteBoxing() throws ScriptException {
148         e.eval(&quot;var ps_byte = SharedObject.publicStaticByte;&quot;);
149         assertEqualsDouble(SharedObject.publicStaticByte, &quot;ps_byte&quot;);
150         e.eval(&quot;SharedObject.publicStaticByte = 16;&quot;);
151         assertEquals(16, SharedObject.publicStaticByte);
152     }
153 
154     @Test
155     public void accessFinalFieldByteBoxing() throws ScriptException {
156         e.eval(&quot;var pf_byte = o.publicFinalByteBox;&quot;);
157         assertEqualsDouble(o.publicFinalByteBox, &quot;pf_byte&quot;);
158         e.eval(&quot;o.publicFinalByteBox = 16;&quot;);
159         assertEquals(Byte.valueOf((byte)19), o.publicFinalByteBox);
160     }
161 
162     @Test
163     public void accessStaticFinalFieldByteBoxing() throws ScriptException {
164         e.eval(&quot;var psf_byte = SharedObject.publicStaticFinalByte;&quot;);
165         assertEqualsDouble(SharedObject.publicStaticFinalByte, &quot;psf_byte&quot;);
166         e.eval(&quot;SharedObject.publicStaticFinalByte = 16;&quot;);
167         assertEquals(-70, SharedObject.publicStaticFinalByte);
168     }
169 
170     // --------------------------------short
171     // tests------------------------------------
172     @Test
173     public void accessFieldShortBoxing() throws ScriptException {
174         e.eval(&quot;var p_short = o.publicShortBox;&quot;);
175         assertEqualsDouble(o.publicShortBox, &quot;p_short&quot;);
176         e.eval(&quot;o.publicShortBox = 18;&quot;);
177         assertEquals(Short.valueOf((short)18), o.publicShortBox);
178     }
179 
180     private static void assertEqualsDouble(final Number n, final String name) {
181         assertEquals(n.doubleValue(), ((Number)e.get(name)).doubleValue());
182     }
183 
184     @Test
185     public void accessStaticFieldShortBoxing() throws ScriptException {
186         e.eval(&quot;var ps_short = SharedObject.publicStaticShort;&quot;);
187         assertEqualsDouble(SharedObject.publicStaticShort, &quot;ps_short&quot;);
188         e.eval(&quot;SharedObject.publicStaticShort = 180;&quot;);
189         assertEquals(180, SharedObject.publicStaticShort);
190     }
191 
192     @Test
193     public void accessFinalFieldShortBoxing() throws ScriptException {
194         e.eval(&quot;var pf_short = o.publicFinalShortBox;&quot;);
195         assertEqualsDouble(o.publicFinalShortBox, &quot;pf_short&quot;);
196         e.eval(&quot;o.publicFinalShortBox = 180;&quot;);
197         assertEquals(Short.valueOf((short)-26777), o.publicFinalShortBox);
198     }
199 
200     @Test
201     public void accessStaticFinalFieldShortBoxing() throws ScriptException {
202         e.eval(&quot;var psf_short = SharedObject.publicStaticFinalShort;&quot;);
203         assertEqualsDouble(SharedObject.publicStaticFinalShort, &quot;psf_short&quot;);
204         e.eval(&quot;SharedObject.publicStaticFinalShort = 180;&quot;);
205         assertEquals(8888, SharedObject.publicStaticFinalShort);
206     }
207 
208     // --------------------------------char
209     // tests------------------------------------
210     @Test
211     public void accessFieldCharBoxing() throws ScriptException {
212         e.eval(&quot;var p_char = o.publicCharBox;&quot;);
213         assertEquals(o.publicCharBox, e.get(&quot;p_char&quot;));
214         e.eval(&quot;o.publicCharBox = &#39;S&#39;;&quot;);
215         assertEquals(Character.valueOf(&#39;S&#39;), o.publicCharBox);
216         e.eval(&quot;try {&quot; +
217                 &quot;    o.publicCharBox = &#39;Big string&#39;;&quot; +
218                 &quot;} catch(e) {&quot; +
219                 &quot;    var isThrown = true;&quot; +
220                 &quot;}&quot;);
221         assertEquals(&quot;Exception thrown&quot;, true, e.get(&quot;isThrown&quot;));
222         assertEquals(Character.valueOf(&#39;S&#39;), o.publicCharBox);
223     }
224 
225     @Test
226     public void accessStaticFieldCharBoxing() throws ScriptException {
227         e.eval(&quot;var ps_char = SharedObject.publicStaticChar;&quot;);
228         assertEquals(SharedObject.publicStaticChar, e.get(&quot;ps_char&quot;));
229         e.eval(&quot;SharedObject.publicStaticChar = &#39;Z&#39;;&quot;);
230         assertEquals(&#39;Z&#39;, SharedObject.publicStaticChar);
231     }
232 
233     @Test
234     public void accessFinalFieldCharBoxing() throws ScriptException {
235         e.eval(&quot;var pf_char = o.publicFinalCharBox;&quot;);
236         assertEquals(o.publicFinalCharBox, e.get(&quot;pf_char&quot;));
237         e.eval(&quot;o.publicFinalCharBox = &#39;S&#39;;&quot;);
238         assertEquals(Character.valueOf(&#39;F&#39;), o.publicFinalCharBox);
239     }
240 
241     @Test
242     public void accessStaticFinalFieldCharBoxing() throws ScriptException {
243         e.eval(&quot;var psf_char = SharedObject.publicStaticFinalChar;&quot;);
244         assertEquals(SharedObject.publicStaticFinalChar, e.get(&quot;psf_char&quot;));
245         e.eval(&quot;SharedObject.publicStaticFinalChar = &#39;Z&#39;;&quot;);
246         assertEquals(&#39;K&#39;, SharedObject.publicStaticFinalChar);
247     }
248 
249     // --------------------------------float
250     // tests------------------------------------
251     @Test
252     public void accessFieldFloatBoxing() throws ScriptException {
253         e.eval(&quot;var p_float = o.publicFloatBox;&quot;);
254         assertEqualsDouble(o.publicFloatBox, &quot;p_float&quot;);
255         o.publicFloatBox = 0.0f / 0.0f;
256         assertEquals(true, e.eval(&quot;isNaN(o.publicFloatBox)&quot;));
257         o.publicFloatBox = 1.0f / 0.0f;
258         assertEquals(true, e.eval(&quot;Number.POSITIVE_INFINITY === o.publicFloatBox&quot;));
259         o.publicFloatBox = -1.0f / 0.0f;
260         assertEquals(true, e.eval(&quot;Number.NEGATIVE_INFINITY === o.publicFloatBox&quot;));
261         e.eval(&quot;o.publicFloatBox = 20;&quot;);
262         assertEquals(20, o.publicFloatBox, 1e-10);
263         e.eval(&quot;o.publicFloatBox = 0.0/0.0;&quot;);
264         assertTrue(Float.isNaN(o.publicFloatBox));
265         e.eval(&quot;o.publicFloatBox = 1.0/0.0;&quot;);
266         assertEquals(Float.floatToIntBits(Float.POSITIVE_INFINITY), Float.floatToIntBits(o.publicFloatBox));
267         e.eval(&quot;o.publicFloatBox = -1.0/0.0;&quot;);
268         assertEquals(Float.NEGATIVE_INFINITY, o.publicFloatBox, 1e-10);
269     }
270 
271     @Test
272     public void accessStaticFieldFloatBoxing() throws ScriptException {
273         e.eval(&quot;var ps_float = SharedObject.publicStaticFloat;&quot;);
274         assertEqualsDouble(SharedObject.publicStaticFloat, &quot;ps_float&quot;);
275         SharedObject.publicStaticFloat = 0.0f / 0.0f;
276         assertEquals(true, e.eval(&quot;isNaN(SharedObject.publicStaticFloat)&quot;));
277         SharedObject.publicStaticFloat = 1.0f / 0.0f;
278         assertEquals(true, e.eval(&quot;Number.POSITIVE_INFINITY === SharedObject.publicStaticFloat&quot;));
279         SharedObject.publicStaticFloat = -1.0f / 0.0f;
280         assertEquals(true, e.eval(&quot;Number.NEGATIVE_INFINITY === SharedObject.publicStaticFloat&quot;));
281         e.eval(&quot;SharedObject.publicStaticFloat = 20.0;&quot;);
282         assertEquals(20.0f, SharedObject.publicStaticFloat, 1e-10);
283         e.eval(&quot;SharedObject.publicStaticFloat = 0.0/0.0;&quot;);
284         assertTrue(Float.isNaN(SharedObject.publicStaticFloat));
285         e.eval(&quot;SharedObject.publicStaticFloat = 1.0/0.0;&quot;);
286         assertEquals(Float.floatToIntBits(Float.POSITIVE_INFINITY), Float.floatToIntBits(SharedObject.publicStaticFloat));
287         e.eval(&quot;SharedObject.publicStaticFloat = -1.0/0.0;&quot;);
288         assertEquals(Float.floatToIntBits(Float.NEGATIVE_INFINITY), Float.floatToIntBits(SharedObject.publicStaticFloat));
289     }
290 
291     @Test
292     public void accessFinalFloatBoxing() throws ScriptException {
293         e.eval(&quot;var pf_float = o.publicFinalFloatBox;&quot;);
294         assertEqualsDouble(o.publicFinalFloatBox, &quot;pf_float&quot;);
295         e.eval(&quot;o.publicFinalFloatBox = 20.0;&quot;);
296         assertEquals(1.372e4f, o.publicFinalFloatBox, 1e-10);
297     }
298 
299     @Test
300     public void accessStaticFinalFieldFloatBoxing() throws ScriptException {
301         e.eval(&quot;var psf_float = SharedObject.publicStaticFinalFloat;&quot;);
302         assertEqualsDouble(SharedObject.publicStaticFinalFloat, &quot;psf_float&quot;);
303         e.eval(&quot;SharedObject.publicStaticFinalFloat = 20.0;&quot;);
304         assertEquals(0.72e8f, SharedObject.publicStaticFinalFloat, 1e-10);
305     }
306 
307     // --------------------------------double
308     // tests------------------------------------
309     @Test
310     public void accessFieldDoubleBoxing() throws ScriptException {
311         e.eval(&quot;var p_double = o.publicDoubleBox;&quot;);
312         assertEquals(o.publicDoubleBox, e.get(&quot;p_double&quot;));
313         o.publicDoubleBox = 0.0 / 0.0;
314         assertEquals(true, e.eval(&quot;isNaN(o.publicDoubleBox)&quot;));
315         o.publicDoubleBox = 1.0 / 0.0;
316         assertEquals(true, e.eval(&quot;Number.POSITIVE_INFINITY === o.publicDoubleBox&quot;));
317         o.publicDoubleBox = -1.0 / 0.0;
318         assertEquals(true, e.eval(&quot;Number.NEGATIVE_INFINITY === o.publicDoubleBox&quot;));
319         e.eval(&quot;o.publicDoubleBox = 30;&quot;);
320         assertEquals(Double.doubleToLongBits(30.0), Double.doubleToLongBits(o.publicDoubleBox));
321         e.eval(&quot;o.publicDoubleBox = 0.0/0.0;&quot;);
322         assertTrue(Double.isNaN(o.publicDoubleBox));
323         e.eval(&quot;o.publicDoubleBox = 1.0/0.0;&quot;);
324         assertEquals(Double.doubleToLongBits(Double.POSITIVE_INFINITY), Double.doubleToLongBits(o.publicDoubleBox));
325         e.eval(&quot;o.publicDoubleBox = -1.0/0.0;&quot;);
326         assertEquals(Double.doubleToLongBits(Double.NEGATIVE_INFINITY), Double.doubleToLongBits(o.publicDoubleBox));
327     }
328 
329     @Test
330     public void accessStaticFieldDoubleBoxing() throws ScriptException {
331         e.eval(&quot;var ps_double = SharedObject.publicStaticDouble;&quot;);
332         assertEquals(SharedObject.publicStaticDouble, e.get(&quot;ps_double&quot;));
333         SharedObject.publicStaticDouble = 0.0 / 0.0;
334         assertEquals(true, e.eval(&quot;isNaN(SharedObject.publicStaticDouble)&quot;));
335         SharedObject.publicStaticDouble = 1.0 / 0.0;
336         assertEquals(true, e.eval(&quot;Number.POSITIVE_INFINITY === SharedObject.publicStaticDouble&quot;));
337         SharedObject.publicStaticDouble = -1.0 / 0.0;
338         assertEquals(true, e.eval(&quot;Number.NEGATIVE_INFINITY === SharedObject.publicStaticDouble&quot;));
339         e.eval(&quot;SharedObject.publicStaticDouble = 40.0;&quot;);
340         assertEquals(Double.doubleToLongBits(40.0), Double.doubleToLongBits(SharedObject.publicStaticDouble));
341         e.eval(&quot;SharedObject.publicStaticDouble = 0.0/0.0;&quot;);
342         assertTrue(Double.isNaN(SharedObject.publicStaticDouble));
343         e.eval(&quot;SharedObject.publicStaticDouble = 1.0/0.0;&quot;);
344         assertEquals(Double.doubleToLongBits(Double.POSITIVE_INFINITY), Double.doubleToLongBits(SharedObject.publicStaticDouble));
345         e.eval(&quot;SharedObject.publicStaticDouble = -1.0/0.0;&quot;);
346         assertEquals(Double.doubleToLongBits(Double.NEGATIVE_INFINITY), Double.doubleToLongBits(SharedObject.publicStaticDouble));
347     }
348 
349     @Test
350     public void accessFinalFieldDoubleBoxing() throws ScriptException {
351         e.eval(&quot;var pf_double = o.publicFinalDoubleBox;&quot;);
352         assertEquals(o.publicFinalDoubleBox, e.get(&quot;pf_double&quot;));
353         e.eval(&quot;o.publicFinalDoubleBox = 30.0;&quot;);
354         assertEquals(Double.doubleToLongBits(1.412e-12), Double.doubleToLongBits(o.publicFinalDoubleBox));
355     }
356 
357     @Test
358     public void accessStaticFinalFieldDoubleBoxing() throws ScriptException {
359         e.eval(&quot;var psf_double = SharedObject.publicStaticFinalDouble;&quot;);
360         assertEquals(SharedObject.publicStaticFinalDouble, e.get(&quot;psf_double&quot;));
361         e.eval(&quot;SharedObject.publicStaticFinalDouble = 40.0;&quot;);
362         assertEquals(Double.doubleToLongBits(1.8e12), Double.doubleToLongBits(SharedObject.publicStaticFinalDouble));
363     }
364 
365 }
    </pre>
  </body>
</html>