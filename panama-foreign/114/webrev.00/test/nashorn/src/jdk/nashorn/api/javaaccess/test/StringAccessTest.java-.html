<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/nashorn/src/jdk/nashorn/api/javaaccess/test/StringAccessTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2010, 2013, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.nashorn.api.javaaccess.test;
 27 
 28 import static org.testng.AssertJUnit.assertEquals;
 29 import static org.testng.internal.junit.ArrayAsserts.assertArrayEquals;
 30 import javax.script.ScriptEngine;
 31 import javax.script.ScriptEngineManager;
 32 import javax.script.ScriptException;
 33 import org.testng.TestNG;
 34 import org.testng.annotations.AfterClass;
 35 import org.testng.annotations.BeforeClass;
 36 import org.testng.annotations.Test;
 37 
 38 /**
 39  * @test
 40  * @build jdk.nashorn.api.javaaccess.test.SharedObject jdk.nashorn.api.javaaccess.test.Person jdk.nashorn.api.javaaccess.test.StringAccessTest
 41  * @run testng/othervm jdk.nashorn.api.javaaccess.test.StringAccessTest
 42  */
 43 @SuppressWarnings(&quot;javadoc&quot;)
 44 public class StringAccessTest {
 45 
 46     private static ScriptEngine e = null;
 47     private static SharedObject o = null;
 48 
 49     public static void main(final String[] args) {
 50         TestNG.main(args);
 51     }
 52 
 53     @BeforeClass
 54     public static void setUpClass() throws ScriptException {
 55         final ScriptEngineManager m = new ScriptEngineManager();
 56         e = m.getEngineByName(&quot;nashorn&quot;);
 57         o = new SharedObject();
 58         e.put(&quot;o&quot;, o);
 59         e.eval(&quot;var SharedObject = Packages.jdk.nashorn.api.javaaccess.test.SharedObject;&quot;);
 60     }
 61 
 62     @AfterClass
 63     public static void tearDownClass() {
 64         e = null;
 65         o = null;
 66     }
 67 
 68     @Test
 69     public void accessFieldString() throws ScriptException {
 70         e.eval(&quot;var p_string = o.publicString;&quot;);
 71         assertEquals(o.publicString, e.get(&quot;p_string&quot;));
 72         assertEquals(&quot;string&quot;, e.eval(&quot;typeof p_string;&quot;));
 73         e.eval(&quot;o.publicString = &#39;changedString&#39;;&quot;);
 74         assertEquals(&quot;changedString&quot;, o.publicString);
 75     }
 76 
 77     @Test
 78     public void accessFieldStringArray() throws ScriptException {
 79         e.eval(&quot;var p_string_array = o.publicStringArray;&quot;);
 80         assertEquals(o.publicStringArray[0], e.eval(&quot;o.publicStringArray[0]&quot;));
 81         assertArrayEquals(o.publicStringArray, (String[])e.get(&quot;p_string_array&quot;));
 82         e.eval(&quot;var t_string_arr = new (Java.type(\&quot;java.lang.String[]\&quot;))(3);&quot; +
 83                 &quot;t_string_arr[0] = &#39;abc&#39;;&quot; +
 84                 &quot;t_string_arr[1] = &#39;123&#39;;&quot; +
 85                 &quot;t_string_arr[2] = &#39;xyzzzz&#39;;&quot; +
 86                 &quot;o.publicStringArray = t_string_arr;&quot;);
 87         assertArrayEquals(new String[] { &quot;abc&quot;, &quot;123&quot;, &quot;xyzzzz&quot; }, o.publicStringArray);
 88         e.eval(&quot;o.publicStringArray[0] = &#39;nashorn&#39;;&quot;);
 89         assertEquals(&quot;nashorn&quot;, o.publicStringArray[0]);
 90     }
 91 
 92     @Test
 93     public void accessStaticFieldString() throws ScriptException {
 94         e.eval(&quot;var ps_string = SharedObject.publicStaticString;&quot;);
 95         assertEquals(SharedObject.publicStaticString, e.get(&quot;ps_string&quot;));
 96         assertEquals(&quot;string&quot;, e.eval(&quot;typeof ps_string;&quot;));
 97         e.eval(&quot;SharedObject.publicStaticString = &#39;changedString&#39;;&quot;);
 98         assertEquals(&quot;changedString&quot;, SharedObject.publicStaticString);
 99     }
100 
101     @Test
102     public void accessStaticFieldStringArray() throws ScriptException {
103         e.eval(&quot;var ps_string_array = SharedObject.publicStaticStringArray;&quot;);
104         assertEquals(SharedObject.publicStaticStringArray[0], e.eval(&quot;SharedObject.publicStaticStringArray[0]&quot;));
105         assertArrayEquals(SharedObject.publicStaticStringArray, (String[])e.get(&quot;ps_string_array&quot;));
106         e.eval(&quot;var ts_string_arr = new (Java.type(\&quot;java.lang.String[]\&quot;))(3);&quot; +
107                 &quot;ts_string_arr[0] = &#39;abc&#39;;&quot; +
108                 &quot;ts_string_arr[1] = &#39;123&#39;;&quot; +
109                 &quot;ts_string_arr[2] = &#39;xyzzzz&#39;;&quot; +
110                 &quot;SharedObject.publicStaticStringArray = ts_string_arr;&quot;);
111         assertArrayEquals(new String[] { &quot;abc&quot;, &quot;123&quot;, &quot;xyzzzz&quot; }, SharedObject.publicStaticStringArray);
112         e.eval(&quot;SharedObject.publicStaticStringArray[0] = &#39;nashorn&#39;;&quot;);
113         assertEquals(&quot;nashorn&quot;, SharedObject.publicStaticStringArray[0]);
114     }
115 
116     @Test
117     public void accessFinalFieldString() throws ScriptException {
118         e.eval(&quot;var pf_string = o.publicFinalString;&quot;);
119         assertEquals(o.publicFinalString, e.get(&quot;pf_string&quot;));
120         assertEquals(&quot;string&quot;, e.eval(&quot;typeof pf_string;&quot;));
121         e.eval(&quot;o.publicFinalString = &#39;changedString&#39;;&quot;);
122         assertEquals(&quot;PublicFinalString&quot;, o.publicFinalString);
123     }
124 
125     @Test
126     public void accessFinalFieldStringArray() throws ScriptException {
127         e.eval(&quot;var pf_string_array = o.publicFinalStringArray;&quot;);
128         assertEquals(o.publicFinalStringArray[0], e.eval(&quot;o.publicFinalStringArray[0]&quot;));
129         assertArrayEquals(o.publicFinalStringArray, (String[])e.get(&quot;pf_string_array&quot;));
130         e.eval(&quot;var tf_string_arr = new (Java.type(\&quot;java.lang.String[]\&quot;))(3);&quot; +
131                 &quot;tf_string_arr[0] = &#39;abc&#39;;&quot; +
132                 &quot;tf_string_arr[1] = &#39;123&#39;;&quot; +
133                 &quot;tf_string_arr[2] = &#39;xyzzzz&#39;;&quot; +
134                 &quot;o.publicFinalStringArray = tf_string_arr;&quot;);
135         assertArrayEquals(new String[] { &quot;FinalArrayString[0]&quot;, &quot;FinalArrayString[1]&quot;, &quot;FinalArrayString[2]&quot;, &quot;FinalArrayString[3]&quot; }, o.publicFinalStringArray);
136         e.eval(&quot;o.publicFinalStringArray[0] = &#39;nashorn&#39;;&quot;);
137         assertEquals(&quot;nashorn&quot;, o.publicFinalStringArray[0]);
138     }
139 
140     @Test
141     public void accessStaticFinalFieldString() throws ScriptException {
142         e.eval(&quot;var psf_string = SharedObject.publicStaticFinalString;&quot;);
143         assertEquals(SharedObject.publicStaticFinalString, e.get(&quot;psf_string&quot;));
144         assertEquals(&quot;string&quot;, e.eval(&quot;typeof psf_string;&quot;));
145         e.eval(&quot;SharedObject.publicStaticFinalString = &#39;changedString&#39;;&quot;);
146         assertEquals(&quot;PublicStaticFinalString&quot;, SharedObject.publicStaticFinalString);
147     }
148 
149     @Test
150     public void accessStaticFinalFieldStringArray() throws ScriptException {
151         e.eval(&quot;var psf_string_array = SharedObject.publicStaticFinalStringArray;&quot;);
152         assertEquals(SharedObject.publicStaticFinalStringArray[0], e.eval(&quot;SharedObject.publicStaticFinalStringArray[0]&quot;));
153         assertArrayEquals(SharedObject.publicStaticFinalStringArray, (String[])e.get(&quot;psf_string_array&quot;));
154         e.eval(&quot;var tsf_string_arr = new (Java.type(\&quot;java.lang.String[]\&quot;))(3);&quot; +
155                 &quot;tsf_string_arr[0] = &#39;abc&#39;;&quot; +
156                 &quot;tsf_string_arr[1] = &#39;123&#39;;&quot; +
157                 &quot;tsf_string_arr[2] = &#39;xyzzzz&#39;;&quot; +
158                 &quot;SharedObject.publicStaticFinalStringArray = tsf_string_arr;&quot;);
159         assertArrayEquals(new String[] { &quot;StaticFinalArrayString[0]&quot;,
160                     &quot;StaticFinalArrayString[1]&quot;,
161                     &quot;StaticFinalArrayString[2]&quot;,
162                     &quot;StaticFinalArrayString[3]&quot; },
163                 SharedObject.publicStaticFinalStringArray);
164         e.eval(&quot;SharedObject.publicStaticFinalStringArray[0] = &#39;nashorn&#39;;&quot;);
165         assertEquals(&quot;nashorn&quot;, SharedObject.publicStaticFinalStringArray[0]);
166     }
167 
168 }
    </pre>
  </body>
</html>