<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/nashorn/src/jdk/nashorn/internal/runtime/linker/test/JavaAdapterTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2016, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 package jdk.nashorn.internal.runtime.linker.test;
 26 
 27 import java.util.Collection;
 28 import java.util.Deque;
 29 import java.util.List;
 30 import java.util.Map;
 31 import java.util.Queue;
 32 import java.util.function.Function;
 33 import java.util.function.Supplier;
 34 import javax.script.Bindings;
 35 import javax.script.ScriptContext;
 36 import javax.script.ScriptEngine;
 37 import javax.script.ScriptException;
 38 import jdk.nashorn.api.scripting.JSObject;
 39 import jdk.nashorn.api.scripting.NashornScriptEngine;
 40 import jdk.nashorn.api.scripting.NashornScriptEngineFactory;
 41 import jdk.nashorn.api.scripting.ScriptObjectMirror;
 42 import jdk.nashorn.internal.runtime.Context;
 43 import org.testng.Assert;
 44 import org.testng.annotations.Test;
 45 
 46 public class JavaAdapterTest {
 47     public interface TestConversions {
 48         public byte getByte(byte b);
 49         public short getShort(short b);
 50         public char getChar(char c);
 51         public int getInt(int i);
 52         public float getFloat(float f);
 53         public long getLong(long l);
 54         public double getDouble(double d);
 55     }
 56 
 57     @Test
 58     public static void testBlah() throws ScriptException {
 59         final ScriptEngine e = createEngine();
 60         e.eval(&quot;new java.util.Comparator({})&quot;);
 61     }
 62 
 63     @Test
 64     public static void testConversions() throws ScriptException {
 65         final ScriptEngine e = createEngine();
 66         e.put(&quot;TestConversionsClass&quot;, TestConversions.class);
 67         final TestConversions tc = (TestConversions)e.eval(
 68                 &quot;function id(x) { return x };&quot; +
 69                 &quot;new TestConversionsClass.static({&quot; +
 70                 &quot;  getByte: id, getShort: id, getChar: id, getInt: id,&quot; +
 71                 &quot;  getFloat: id, getLong: id, getDouble: id });&quot;);
 72 
 73         Assert.assertEquals(Byte.MIN_VALUE, tc.getByte(Byte.MIN_VALUE));
 74         Assert.assertEquals(Byte.MAX_VALUE, tc.getByte(Byte.MAX_VALUE));
 75 
 76         Assert.assertEquals(Short.MIN_VALUE, tc.getShort(Short.MIN_VALUE));
 77         Assert.assertEquals(Short.MAX_VALUE, tc.getShort(Short.MAX_VALUE));
 78 
 79         Assert.assertEquals(Character.MIN_VALUE, tc.getChar(Character.MIN_VALUE));
 80         Assert.assertEquals(Character.MAX_VALUE, tc.getChar(Character.MAX_VALUE));
 81 
 82         Assert.assertEquals(Integer.MIN_VALUE, tc.getInt(Integer.MIN_VALUE));
 83         Assert.assertEquals(Integer.MAX_VALUE, tc.getInt(Integer.MAX_VALUE));
 84 
 85         Assert.assertEquals(Long.MIN_VALUE, tc.getLong(Long.MIN_VALUE));
 86         Assert.assertEquals(Long.MAX_VALUE, tc.getLong(Long.MAX_VALUE));
 87 
 88         Assert.assertEquals(Float.MIN_VALUE, tc.getFloat(Float.MIN_VALUE));
 89         Assert.assertEquals(Float.MAX_VALUE, tc.getFloat(Float.MAX_VALUE));
 90         Assert.assertEquals(Float.MIN_NORMAL, tc.getFloat(Float.MIN_NORMAL));
 91         Assert.assertEquals(Float.POSITIVE_INFINITY, tc.getFloat(Float.POSITIVE_INFINITY));
 92         Assert.assertEquals(Float.NEGATIVE_INFINITY, tc.getFloat(Float.NEGATIVE_INFINITY));
 93         Assert.assertTrue(Float.isNaN(tc.getFloat(Float.NaN)));
 94 
 95         Assert.assertEquals(Double.MIN_VALUE, tc.getDouble(Double.MIN_VALUE));
 96         Assert.assertEquals(Double.MAX_VALUE, tc.getDouble(Double.MAX_VALUE));
 97         Assert.assertEquals(Double.MIN_NORMAL, tc.getDouble(Double.MIN_NORMAL));
 98         Assert.assertEquals(Double.POSITIVE_INFINITY, tc.getDouble(Double.POSITIVE_INFINITY));
 99         Assert.assertEquals(Double.NEGATIVE_INFINITY, tc.getDouble(Double.NEGATIVE_INFINITY));
100         Assert.assertTrue(Double.isNaN(tc.getDouble(Double.NaN)));
101     }
102 
103     private static ScriptEngine createEngine() {
104         // Use no optimistic typing so we run faster; short-running tests.
105         return new NashornScriptEngineFactory().getScriptEngine(&quot;-ot=false&quot;);
106     }
107 
108     @Test
109     public static void testUnimplemented() throws ScriptException {
110         final ScriptEngine e = createEngine();
111         final Runnable r = (Runnable) e.eval(&quot;new java.lang.Runnable({})&quot;);
112         Assert.assertNull(Context.getGlobal());
113         try {
114             r.run();
115             Assert.fail();
116         } catch(final UnsupportedOperationException x) {
117             // This is expected
118         }
119         // Check global has been restored
120         Assert.assertNull(Context.getGlobal());
121     }
122 
123     public interface ThrowingRunnable {
124         public void run() throws Throwable;
125     }
126 
127     @Test
128     public static void testUnimplementedWithThrowable() throws Throwable {
129         final ScriptEngine e = createEngine();
130         e.put(&quot;ThrowingRunnableClass&quot;, ThrowingRunnable.class);
131         final ThrowingRunnable r = (ThrowingRunnable) e.eval(&quot;new ThrowingRunnableClass.static({})&quot;);
132         Assert.assertNull(Context.getGlobal());
133         try {
134             r.run();
135             Assert.fail();
136         } catch(final UnsupportedOperationException x) {
137             // This is expected
138         }
139         // Check global has been restored
140         Assert.assertNull(Context.getGlobal());
141     }
142 
143     public interface IntSupplierWithDefault {
144         public default int get() { return 42; }
145     }
146 
147     @Test
148     public static void testUnimplementedWithDefault() throws ScriptException {
149         final ScriptEngine e = createEngine();
150         e.put(&quot;IntSupplierWithDefault&quot;, IntSupplierWithDefault.class);
151         final IntSupplierWithDefault s1 = (IntSupplierWithDefault) e.eval(&quot;new IntSupplierWithDefault.static({})&quot;);
152         Assert.assertEquals(42, s1.get());
153         final IntSupplierWithDefault s2 = (IntSupplierWithDefault) e.eval(&quot;new IntSupplierWithDefault.static({ get: function() { return 43 }})&quot;);
154         Assert.assertEquals(43, s2.get());
155     }
156 
157     public interface SupplierSupplier {
158         public Supplier&lt;Object&gt; getSupplier();
159     }
160 
161     @Test
162     public static void testReturnAdapter() throws ScriptException {
163         final ScriptEngine e = createEngine();
164         e.put(&quot;SupplierSupplier&quot;, SupplierSupplier.class);
165         final SupplierSupplier s = (SupplierSupplier) e.eval(&quot;new SupplierSupplier.static(function(){ return function() { return &#39;foo&#39; } })&quot;);
166         Assert.assertEquals(&quot;foo&quot;, s.getSupplier().get());
167     }
168 
169     public interface MaxParams {
170         public Object method(boolean p1, byte p2, short p3, char p4, int p5, float p6, long p7, double p8,
171                 Object p9, Object p10, Object p11, Object p12, Object p13, Object p14, Object p15, Object p16,
172                 Object p17, Object p18, Object p19, Object p20, Object p21, Object p22, Object p23, Object p24,
173                 Object p25, Object p26, Object p27, Object p28, Object p29, Object p30, Object p31, Object p32,
174                 Object p33, Object p34, Object p35, Object p36, Object p37, Object p38, Object p39, Object p40,
175                 Object p41, Object p42, Object p43, Object p44, Object p45, Object p46, Object p47, Object p48,
176                 Object p49, Object p50, Object p51, Object p52, Object p53, Object p54, Object p55, Object p56,
177                 Object p57, Object p58, Object p59, Object p60, Object p61, Object p62, Object p63, Object p64,
178                 Object p65, Object p66, Object p67, Object p68, Object p69, Object p70, Object p71, Object p72,
179                 Object p73, Object p74, Object p75, Object p76, Object p77, Object p78, Object p79, Object p80,
180                 Object p81, Object p82, Object p83, Object p84, Object p85, Object p86, Object p87, Object p88,
181                 Object p89, Object p90, Object p91, Object p92, Object p93, Object p94, Object p95, Object p96,
182                 Object p97, Object p98, Object p99, Object p100, Object p101, Object p102, Object p103, Object p104,
183                 Object p105, Object p106, Object p107, Object p108, Object p109, Object p110, Object p111, Object p112,
184                 Object p113, Object p114, Object p115, Object p116, Object p117, Object p118, Object p119, Object p120,
185                 Object p121, Object p122, Object p123, Object p124, Object p125, Object p126, Object p127, Object p128,
186                 Object p129, Object p130, Object p131, Object p132, Object p133, Object p134, Object p135, Object p136,
187                 Object p137, Object p138, Object p139, Object p140, Object p141, Object p142, Object p143, Object p144,
188                 Object p145, Object p146, Object p147, Object p148, Object p149, Object p150, Object p151, Object p152,
189                 Object p153, Object p154, Object p155, Object p156, Object p157, Object p158, Object p159, Object p160,
190                 Object p161, Object p162, Object p163, Object p164, Object p165, Object p166, Object p167, Object p168,
191                 Object p169, Object p170, Object p171, Object p172, Object p173, Object p174, Object p175, Object p176,
192                 Object p177, Object p178, Object p179, Object p180, Object p181, Object p182, Object p183, Object p184,
193                 Object p185, Object p186, Object p187, Object p188, Object p189, Object p190, Object p191, Object p192,
194                 Object p193, Object p194, Object p195, Object p196, Object p197, Object p198, Object p199, Object p200,
195                 Object p201, Object p202, Object p203, Object p204, Object p205, Object p206, Object p207, Object p208,
196                 Object p209, Object p210, Object p211, Object p212, Object p213, Object p214, Object p215, Object p216,
197                 Object p217, Object p218, Object p219, Object p220, Object p221, Object p222, Object p223, Object p224,
198                 Object p225, Object p226, Object p227, Object p228, Object p229, Object p230, Object p231, Object p232,
199                 Object p233, Object p234, Object p235, Object p236, Object p237, Object p238, Object p239, Object p240,
200                 Object p241, Object p242, Object p243, Object p244, Object p245, Object p246, Object p247, Object p248,
201                 Object p249, Object p250, Object p251, Object p252);
202     }
203 
204     @Test
205     public static void testMaxLengthAdapter() throws ScriptException {
206         final ScriptEngine e = createEngine();
207         e.put(&quot;MaxParams&quot;, MaxParams.class);
208         final MaxParams s = (MaxParams) e.eval(&quot;new MaxParams.static(function(){ return arguments })&quot;);
209         final ScriptObjectMirror m = (ScriptObjectMirror)s.method(true, Byte.MIN_VALUE, Short.MIN_VALUE, &#39;a&#39;, Integer.MAX_VALUE, Float.MAX_VALUE, Long.MAX_VALUE, Double.MAX_VALUE,
210                 &quot;8&quot;, &quot;9&quot;, &quot;10&quot;, &quot;11&quot;, &quot;12&quot;, &quot;13&quot;, &quot;14&quot;, &quot;15&quot;, &quot;16&quot;, &quot;17&quot;, &quot;18&quot;, &quot;19&quot;, &quot;20&quot;, &quot;21&quot;, &quot;22&quot;, &quot;23&quot;, &quot;24&quot;, &quot;25&quot;, &quot;26&quot;,
211                 &quot;27&quot;, &quot;28&quot;, &quot;29&quot;, &quot;30&quot;, &quot;31&quot;, &quot;32&quot;, &quot;33&quot;, &quot;34&quot;, &quot;35&quot;, &quot;36&quot;, &quot;37&quot;, &quot;38&quot;, &quot;39&quot;, &quot;40&quot;, &quot;41&quot;, &quot;42&quot;, &quot;43&quot;, &quot;44&quot;,
212                 &quot;45&quot;, &quot;46&quot;, &quot;47&quot;, &quot;48&quot;, &quot;49&quot;, &quot;50&quot;, &quot;51&quot;, &quot;52&quot;, &quot;53&quot;, &quot;54&quot;, &quot;55&quot;, &quot;56&quot;, &quot;57&quot;, &quot;58&quot;, &quot;59&quot;, &quot;60&quot;, &quot;61&quot;, &quot;62&quot;,
213                 &quot;63&quot;, &quot;64&quot;, &quot;65&quot;, &quot;66&quot;, &quot;67&quot;, &quot;68&quot;, &quot;69&quot;, &quot;70&quot;, &quot;71&quot;, &quot;72&quot;, &quot;73&quot;, &quot;74&quot;, &quot;75&quot;, &quot;76&quot;, &quot;77&quot;, &quot;78&quot;, &quot;79&quot;, &quot;80&quot;,
214                 &quot;81&quot;, &quot;82&quot;, &quot;83&quot;, &quot;84&quot;, &quot;85&quot;, &quot;86&quot;, &quot;87&quot;, &quot;88&quot;, &quot;89&quot;, &quot;90&quot;, &quot;91&quot;, &quot;92&quot;, &quot;93&quot;, &quot;94&quot;, &quot;95&quot;, &quot;96&quot;, &quot;97&quot;, &quot;98&quot;,
215                 &quot;99&quot;, &quot;100&quot;, &quot;101&quot;, &quot;102&quot;, &quot;103&quot;, &quot;104&quot;, &quot;105&quot;, &quot;106&quot;, &quot;107&quot;, &quot;108&quot;, &quot;109&quot;, &quot;110&quot;, &quot;111&quot;, &quot;112&quot;, &quot;113&quot;, &quot;114&quot;,
216                 &quot;115&quot;, &quot;116&quot;, &quot;117&quot;, &quot;118&quot;, &quot;119&quot;, &quot;120&quot;, &quot;121&quot;, &quot;122&quot;, &quot;123&quot;, &quot;124&quot;, &quot;125&quot;, &quot;126&quot;, &quot;127&quot;, &quot;128&quot;, &quot;129&quot;, &quot;130&quot;,
217                 &quot;131&quot;, &quot;132&quot;, &quot;133&quot;, &quot;134&quot;, &quot;135&quot;, &quot;136&quot;, &quot;137&quot;, &quot;138&quot;, &quot;139&quot;, &quot;140&quot;, &quot;141&quot;, &quot;142&quot;, &quot;143&quot;, &quot;144&quot;, &quot;145&quot;, &quot;146&quot;,
218                 &quot;147&quot;, &quot;148&quot;, &quot;149&quot;, &quot;150&quot;, &quot;151&quot;, &quot;152&quot;, &quot;153&quot;, &quot;154&quot;, &quot;155&quot;, &quot;156&quot;, &quot;157&quot;, &quot;158&quot;, &quot;159&quot;, &quot;160&quot;, &quot;161&quot;, &quot;162&quot;,
219                 &quot;163&quot;, &quot;164&quot;, &quot;165&quot;, &quot;166&quot;, &quot;167&quot;, &quot;168&quot;, &quot;169&quot;, &quot;170&quot;, &quot;171&quot;, &quot;172&quot;, &quot;173&quot;, &quot;174&quot;, &quot;175&quot;, &quot;176&quot;, &quot;177&quot;, &quot;178&quot;,
220                 &quot;179&quot;, &quot;180&quot;, &quot;181&quot;, &quot;182&quot;, &quot;183&quot;, &quot;184&quot;, &quot;185&quot;, &quot;186&quot;, &quot;187&quot;, &quot;188&quot;, &quot;189&quot;, &quot;190&quot;, &quot;191&quot;, &quot;192&quot;, &quot;193&quot;, &quot;194&quot;,
221                 &quot;195&quot;, &quot;196&quot;, &quot;197&quot;, &quot;198&quot;, &quot;199&quot;, &quot;200&quot;, &quot;201&quot;, &quot;202&quot;, &quot;203&quot;, &quot;204&quot;, &quot;205&quot;, &quot;206&quot;, &quot;207&quot;, &quot;208&quot;, &quot;209&quot;, &quot;210&quot;,
222                 &quot;211&quot;, &quot;212&quot;, &quot;213&quot;, &quot;214&quot;, &quot;215&quot;, &quot;216&quot;, &quot;217&quot;, &quot;218&quot;, &quot;219&quot;, &quot;220&quot;, &quot;221&quot;, &quot;222&quot;, &quot;223&quot;, &quot;224&quot;, &quot;225&quot;, &quot;226&quot;,
223                 &quot;227&quot;, &quot;228&quot;, &quot;229&quot;, &quot;230&quot;, &quot;231&quot;, &quot;232&quot;, &quot;233&quot;, &quot;234&quot;, &quot;235&quot;, &quot;236&quot;, &quot;237&quot;, &quot;238&quot;, &quot;239&quot;, &quot;240&quot;, &quot;241&quot;, &quot;242&quot;,
224                 &quot;243&quot;, &quot;244&quot;, &quot;245&quot;, &quot;246&quot;, &quot;247&quot;, &quot;248&quot;, &quot;249&quot;, &quot;250&quot;, &quot;251&quot;);
225         Assert.assertEquals(true, m.getSlot(0));
226         Assert.assertEquals(Integer.valueOf(Byte.MIN_VALUE), m.getSlot(1)); // Byte becomes Integer
227         Assert.assertEquals(Integer.valueOf(Short.MIN_VALUE), m.getSlot(2)); // Short becomes Integer
228         Assert.assertEquals(Character.valueOf(&#39;a&#39;), m.getSlot(3));
229         Assert.assertEquals(Integer.valueOf(Integer.MAX_VALUE), m.getSlot(4));
230         Assert.assertEquals(Double.valueOf(Float.MAX_VALUE), m.getSlot(5)); // Float becomes Double
231         Assert.assertEquals(Long.valueOf(Long.MAX_VALUE), m.getSlot(6)); // Long was untouched
232         Assert.assertEquals(Double.valueOf(Double.MAX_VALUE), m.getSlot(7));
233         for (int i = 8; i &lt; 252; ++i) {
234             Assert.assertEquals(String.valueOf(i), m.getSlot(i));
235         }
236     }
237 
238     public interface TestScriptObjectMirror {
239         public JSObject getJSObject();
240         public ScriptObjectMirror getScriptObjectMirror();
241         public Map&lt;Object, Object&gt; getMap();
242         public Bindings getBindings();
243     }
244 
245     @Test
246     public static void testReturnsScriptObjectMirror() throws ScriptException {
247         final ScriptEngine e = createEngine();
248         e.put(&quot;TestScriptObjectMirrorClass&quot;, TestScriptObjectMirror.class);
249         final TestScriptObjectMirror tsom = (TestScriptObjectMirror)e.eval(
250                 &quot;new TestScriptObjectMirrorClass.static({\n&quot; +
251                 &quot;  getJSObject: function() { return { &#39;kind&#39;: &#39;JSObject&#39; } },\n&quot; +
252                 &quot;  getScriptObjectMirror: function() { return { &#39;kind&#39;: &#39;ScriptObjectMirror&#39; } },\n&quot; +
253                 &quot;  getMap: function() { return { &#39;kind&#39;: &#39;Map&#39; } },\n&quot; +
254                 &quot;  getBindings: function() { return { &#39;kind&#39;: &#39;Bindings&#39; } } })\n&quot;);
255         Assert.assertEquals(tsom.getJSObject().getMember(&quot;kind&quot;), &quot;JSObject&quot;);
256         Assert.assertEquals(tsom.getScriptObjectMirror().getMember(&quot;kind&quot;), &quot;ScriptObjectMirror&quot;);
257         Assert.assertEquals(tsom.getMap().get(&quot;kind&quot;), &quot;Map&quot;);
258         Assert.assertEquals(tsom.getBindings().get(&quot;kind&quot;), &quot;Bindings&quot;);
259     }
260 
261     public interface TestListAdapter {
262         public List&lt;Object&gt; getList();
263         public Collection&lt;Object&gt; getCollection();
264         public Queue&lt;Object&gt; getQueue();
265         public Deque&lt;Object&gt; getDequeue();
266     }
267 
268     @Test
269     public static void testReturnsListAdapter() throws ScriptException {
270         final ScriptEngine e = createEngine();
271         e.put(&quot;TestListAdapterClass&quot;, TestListAdapter.class);
272         final TestListAdapter tla = (TestListAdapter)e.eval(
273                 &quot;new TestListAdapterClass.static({\n&quot; +
274                 &quot;  getList: function() { return [ &#39;List&#39; ] },\n&quot; +
275                 &quot;  getCollection: function() { return [ &#39;Collection&#39; ] },\n&quot; +
276                 &quot;  getQueue: function() { return [ &#39;Queue&#39; ] },\n&quot; +
277                 &quot;  getDequeue: function() { return [ &#39;Dequeue&#39; ] } })\n&quot;);
278         Assert.assertEquals(tla.getList().get(0), &quot;List&quot;);
279         Assert.assertEquals(tla.getCollection().iterator().next(), &quot;Collection&quot;);
280         Assert.assertEquals(tla.getQueue().peek(), &quot;Queue&quot;);
281         Assert.assertEquals(tla.getDequeue().peek(), &quot;Dequeue&quot;);
282     }
283 
284     @Test
285     public static void testMirrorAdapter() throws ScriptException {
286         final NashornScriptEngine e = (NashornScriptEngine) createEngine();
287         e.setBindings(e.createBindings(), ScriptContext.GLOBAL_SCOPE); // Null by default
288 
289         // Referencing functions from across scopes causes them to be wrapped in ScriptObjectMirrors
290         e.eval(&quot;function convertObjectFromEngineScope(){ return new java.util.concurrent.Callable(o).call(); }&quot;, e.getBindings(ScriptContext.ENGINE_SCOPE));
291         e.eval(&quot;function convertObjectFromGlobalScope(){ return new java.util.concurrent.Callable(o).call(); }&quot;, e.getBindings(ScriptContext.GLOBAL_SCOPE));
292         e.eval(&quot;function convertFuncFromEngineScope(){ return new java.util.concurrent.Callable(g).call(); }&quot;, e.getBindings(ScriptContext.ENGINE_SCOPE));
293         e.eval(&quot;function convertFuncFromGlobalScope(){ return new java.util.concurrent.Callable(g).call(); }&quot;, e.getBindings(ScriptContext.GLOBAL_SCOPE));
294         e.eval(&quot;function convertParamFromEngineScope(){ return Java.type(&#39;jdk.nashorn.internal.runtime.linker.test.JavaAdapterTest&#39;).m(f);}&quot;, e.getBindings(ScriptContext.ENGINE_SCOPE));
295         e.eval(&quot;function convertParamFromGlobalScope(){ return Java.type(&#39;jdk.nashorn.internal.runtime.linker.test.JavaAdapterTest&#39;).m(f);}&quot;, e.getBindings(ScriptContext.GLOBAL_SCOPE));
296 
297         e.eval(&quot;var o = { call: function () { return &#39;ok from o&#39;; } }&quot;, e.getBindings(ScriptContext.ENGINE_SCOPE));
298         e.eval(&quot;function g() { return &#39;ok from g&#39;; }&quot;, e.getBindings(ScriptContext.ENGINE_SCOPE));
299         e.eval(&quot;function f(a) { return a.toUpperCase(); }&quot;, e.getBindings(ScriptContext.ENGINE_SCOPE));
300 
301         try {
302             Assert.assertEquals(e.invokeFunction(&quot;convertObjectFromEngineScope&quot;), &quot;ok from o&quot;);
303             Assert.assertEquals(e.invokeFunction(&quot;convertObjectFromGlobalScope&quot;), &quot;ok from o&quot;);
304             Assert.assertEquals(e.invokeFunction(&quot;convertFuncFromEngineScope&quot;), &quot;ok from g&quot;);
305             Assert.assertEquals(e.invokeFunction(&quot;convertFuncFromGlobalScope&quot;), &quot;ok from g&quot;);
306             Assert.assertEquals(e.invokeFunction(&quot;convertParamFromEngineScope&quot;), &quot;OK&quot;);
307             Assert.assertEquals(e.invokeFunction(&quot;convertParamFromGlobalScope&quot;), &quot;OK&quot;);
308         } catch (final NoSuchMethodException x) {
309             throw new RuntimeException(x);
310         }
311     }
312 
313     public static String m(final Function&lt;String, String&gt; f){
314         return f.apply(&quot;ok&quot;);
315     }
316 }
    </pre>
  </body>
</html>