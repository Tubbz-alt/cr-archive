<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/flags-cflags.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="configure.ac.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="flags-ldflags.m4.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/flags-cflags.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
624   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
625     WARNING_CFLAGS=&quot;&quot;  # currently left empty
626   fi
627 
628   # Set some additional per-OS defines.
629 
630   # Additional macosx handling
631   if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
632     OS_CFLAGS=&quot;-DMAC_OS_X_VERSION_MIN_REQUIRED=$MACOSX_VERSION_MIN_NODOTS \
633         -mmacosx-version-min=$MACOSX_VERSION_MIN&quot;
634 
635     if test -n &quot;$MACOSX_VERSION_MAX&quot;; then
636         OS_CFLAGS=&quot;$OS_CFLAGS \
637             -DMAC_OS_X_VERSION_MAX_ALLOWED=$MACOSX_VERSION_MAX_NODOTS&quot;
638     fi
639   fi
640 
641   # Where does this really belong??
642   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
643     PICFLAG=&quot;-fPIC&quot;

644   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
645     PICFLAG=&quot;-KPIC&quot;
646   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
647     # &#39;-qpic&#39; defaults to &#39;qpic=small&#39;. This means that the compiler generates only
648     # one instruction for accessing the TOC. If the TOC grows larger than 64K, the linker
649     # will have to patch this single instruction with a call to some out-of-order code which
650     # does the load from the TOC. This is of course slower, and we also would have
651     # to use &#39;-bbigtoc&#39; for linking anyway so we could also change the PICFLAG to &#39;qpic=large&#39;.
652     # With &#39;qpic=large&#39; the compiler will by default generate a two-instruction sequence which
653     # can be patched directly by the linker and does not require a jump to out-of-order code.
654     #
655     # Since large TOC causes perf. overhead, only pay it where we must. Currently this is
656     # for all libjvm variants (both gtest and normal) but no other binaries. So, build
657     # libjvm with -qpic=large and link with -bbigtoc.
658     JVM_PICFLAG=&quot;-qpic=large&quot;
659     JDK_PICFLAG=&quot;-qpic&quot;
660   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
661     PICFLAG=&quot;&quot;
662   fi
663 
</pre>
<hr />
<pre>
837 
838   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
839     if test &quot;x$FLAGS_CPU&quot; = xx86; then
840       $1_CFLAGS_CPU_JVM=&quot;-arch:IA32&quot;
841     elif test &quot;x$OPENJDK_TARGET_CPU&quot; = xx86_64; then
842       if test &quot;x$DEBUG_LEVEL&quot; != xrelease; then
843         # NOTE: This is probably redundant; -homeparams is default on
844         # non-release builds.
845         $1_CFLAGS_CPU_JVM=&quot;-homeparams&quot;
846       fi
847     fi
848   fi
849 
850   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
851     FLAGS_SETUP_GCC6_COMPILER_FLAGS($1, $3)
852     $1_TOOLCHAIN_CFLAGS=&quot;${$1_GCC6_CFLAGS}&quot;
853 
854     $1_WARNING_CFLAGS_JVM=&quot;-Wno-format-zero-length -Wtype-limits -Wuninitialized&quot;
855   fi
856 
<span class="line-modified">857   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then</span>
<span class="line-modified">858     # Check if compiler supports -fmacro-prefix-map. If so, use that to make</span>
<span class="line-modified">859     # the __FILE__ macro resolve to paths relative to the workspace root.</span>
<span class="line-modified">860     workspace_root_trailing_slash=&quot;${WORKSPACE_ROOT%/}/&quot;</span>
<span class="line-modified">861     FILE_MACRO_CFLAGS=&quot;-fmacro-prefix-map=${workspace_root_trailing_slash}=&quot;</span>
<span class="line-modified">862     FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${FILE_MACRO_CFLAGS}],</span>
<span class="line-modified">863         PREFIX: $3,</span>
<span class="line-modified">864         IF_FALSE: [</span>
<span class="line-modified">865             FILE_MACRO_CFLAGS=</span>
<span class="line-modified">866         ]</span>
<span class="line-modified">867     )</span>








868   fi

869 
870   # EXPORT to API
871   CFLAGS_JVM_COMMON=&quot;$ALWAYS_CFLAGS_JVM $ALWAYS_DEFINES_JVM \
872       $TOOLCHAIN_CFLAGS_JVM ${$1_TOOLCHAIN_CFLAGS_JVM} \
873       $OS_CFLAGS $OS_CFLAGS_JVM $CFLAGS_OS_DEF_JVM $DEBUG_CFLAGS_JVM \
874       $WARNING_CFLAGS $WARNING_CFLAGS_JVM $JVM_PICFLAG $FILE_MACRO_CFLAGS&quot;
875 
876   CFLAGS_JDK_COMMON=&quot;$ALWAYS_CFLAGS_JDK $ALWAYS_DEFINES_JDK $TOOLCHAIN_CFLAGS_JDK \
877       $OS_CFLAGS $CFLAGS_OS_DEF_JDK $DEBUG_CFLAGS_JDK $DEBUG_OPTIONS_FLAGS_JDK \
878       $WARNING_CFLAGS $WARNING_CFLAGS_JDK $DEBUG_SYMBOLS_CFLAGS_JDK \
879       $FILE_MACRO_CFLAGS&quot;
880 
881   # Use ${$2EXTRA_CFLAGS} to block EXTRA_CFLAGS to be added to build flags.
882   # (Currently we don&#39;t have any OPENJDK_BUILD_EXTRA_CFLAGS, but that might
883   # change in the future.)
884 
885   CFLAGS_JDK_COMMON_CONLY=&quot;$TOOLCHAIN_CFLAGS_JDK_CONLY  \
886       $WARNING_CFLAGS_JDK_CONLY ${$2EXTRA_CFLAGS}&quot;
887   CFLAGS_JDK_COMMON_CXXONLY=&quot;$ALWAYS_DEFINES_JDK_CXXONLY \
888       $TOOLCHAIN_CFLAGS_JDK_CXXONLY \
889       ${$1_TOOLCHAIN_CFLAGS_JDK_CXXONLY} \
890       $WARNING_CFLAGS_JDK_CXXONLY ${$2EXTRA_CXXFLAGS}&quot;
891 
892   $1_CFLAGS_JVM=&quot;${$1_DEFINES_CPU_JVM} ${$1_CFLAGS_CPU} ${$1_CFLAGS_CPU_JVM} ${$1_TOOLCHAIN_CFLAGS} ${$1_WARNING_CFLAGS_JVM}&quot;
893   $1_CFLAGS_JDK=&quot;${$1_DEFINES_CPU_JDK} ${$1_CFLAGS_CPU} ${$1_CFLAGS_CPU_JDK} ${$1_TOOLCHAIN_CFLAGS}&quot;
894 
895   $2JVM_CFLAGS=&quot;$CFLAGS_JVM_COMMON ${$1_CFLAGS_JVM} ${$2EXTRA_CXXFLAGS}&quot;
896 
<span class="line-modified">897   $2CFLAGS_JDKEXE=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CONLY ${$1_CFLAGS_JDK}&quot;</span>
<span class="line-modified">898   $2CXXFLAGS_JDKEXE=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CXXONLY ${$1_CFLAGS_JDK}&quot;</span>
<span class="line-modified">899   $2CFLAGS_JDKLIB=&quot;${$2CFLAGS_JDKEXE} $JDK_PICFLAG ${$1_CFLAGS_CPU_JDK_LIBONLY}&quot;</span>
<span class="line-modified">900   $2CXXFLAGS_JDKLIB=&quot;${$2CXXFLAGS_JDKEXE} $JDK_PICFLAG ${$1_CFLAGS_CPU_JDK_LIBONLY}&quot;</span>


901 
902   AC_SUBST($2JVM_CFLAGS)
903   AC_SUBST($2CFLAGS_JDKLIB)
904   AC_SUBST($2CFLAGS_JDKEXE)
905   AC_SUBST($2CXXFLAGS_JDKLIB)
906   AC_SUBST($2CXXFLAGS_JDKEXE)
907   AC_SUBST($2ADLC_CXXFLAG)
908 
909   COMPILER_FP_CONTRACT_OFF_FLAG=&quot;-ffp-contract=off&quot;
910   # Check that the compiler supports -ffp-contract=off flag
911   # Set FDLIBM_CFLAGS to -ffp-contract=off if it does. Empty
912   # otherwise.
913   # These flags are required for GCC-based builds of
914   # fdlibm with optimization without losing precision.
915   # Notably, -ffp-contract=off needs to be added for GCC &gt;= 4.6.
916   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
917     FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${COMPILER_FP_CONTRACT_OFF_FLAG}],
918         PREFIX: $3,
919         IF_TRUE: [$2FDLIBM_CFLAGS=${COMPILER_FP_CONTRACT_OFF_FLAG}],
920         IF_FALSE: [$2FDLIBM_CFLAGS=&quot;&quot;])
</pre>
</td>
<td>
<hr />
<pre>
624   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
625     WARNING_CFLAGS=&quot;&quot;  # currently left empty
626   fi
627 
628   # Set some additional per-OS defines.
629 
630   # Additional macosx handling
631   if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
632     OS_CFLAGS=&quot;-DMAC_OS_X_VERSION_MIN_REQUIRED=$MACOSX_VERSION_MIN_NODOTS \
633         -mmacosx-version-min=$MACOSX_VERSION_MIN&quot;
634 
635     if test -n &quot;$MACOSX_VERSION_MAX&quot;; then
636         OS_CFLAGS=&quot;$OS_CFLAGS \
637             -DMAC_OS_X_VERSION_MAX_ALLOWED=$MACOSX_VERSION_MAX_NODOTS&quot;
638     fi
639   fi
640 
641   # Where does this really belong??
642   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
643     PICFLAG=&quot;-fPIC&quot;
<span class="line-added">644     PIEFLAG=&quot;-fPIE&quot;</span>
645   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
646     PICFLAG=&quot;-KPIC&quot;
647   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
648     # &#39;-qpic&#39; defaults to &#39;qpic=small&#39;. This means that the compiler generates only
649     # one instruction for accessing the TOC. If the TOC grows larger than 64K, the linker
650     # will have to patch this single instruction with a call to some out-of-order code which
651     # does the load from the TOC. This is of course slower, and we also would have
652     # to use &#39;-bbigtoc&#39; for linking anyway so we could also change the PICFLAG to &#39;qpic=large&#39;.
653     # With &#39;qpic=large&#39; the compiler will by default generate a two-instruction sequence which
654     # can be patched directly by the linker and does not require a jump to out-of-order code.
655     #
656     # Since large TOC causes perf. overhead, only pay it where we must. Currently this is
657     # for all libjvm variants (both gtest and normal) but no other binaries. So, build
658     # libjvm with -qpic=large and link with -bbigtoc.
659     JVM_PICFLAG=&quot;-qpic=large&quot;
660     JDK_PICFLAG=&quot;-qpic&quot;
661   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
662     PICFLAG=&quot;&quot;
663   fi
664 
</pre>
<hr />
<pre>
838 
839   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
840     if test &quot;x$FLAGS_CPU&quot; = xx86; then
841       $1_CFLAGS_CPU_JVM=&quot;-arch:IA32&quot;
842     elif test &quot;x$OPENJDK_TARGET_CPU&quot; = xx86_64; then
843       if test &quot;x$DEBUG_LEVEL&quot; != xrelease; then
844         # NOTE: This is probably redundant; -homeparams is default on
845         # non-release builds.
846         $1_CFLAGS_CPU_JVM=&quot;-homeparams&quot;
847       fi
848     fi
849   fi
850 
851   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
852     FLAGS_SETUP_GCC6_COMPILER_FLAGS($1, $3)
853     $1_TOOLCHAIN_CFLAGS=&quot;${$1_GCC6_CFLAGS}&quot;
854 
855     $1_WARNING_CFLAGS_JVM=&quot;-Wno-format-zero-length -Wtype-limits -Wuninitialized&quot;
856   fi
857 
<span class="line-modified">858   # Prevent the __FILE__ macro from generating absolute paths into the built</span>
<span class="line-modified">859   # binaries. Depending on toolchain, different mitigations are possible.</span>
<span class="line-modified">860   # * GCC and Clang of new enough versions have -fmacro-prefix-map.</span>
<span class="line-modified">861   # * For most other toolchains, supplying all source files and -I flags as</span>
<span class="line-modified">862   #   relative paths fixes the issue.</span>
<span class="line-modified">863   FILE_MACRO_CFLAGS=</span>
<span class="line-modified">864   if test &quot;x$ALLOW_ABSOLUTE_PATHS_IN_OUTPUT&quot; = &quot;xfalse&quot;; then</span>
<span class="line-modified">865     if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then</span>
<span class="line-modified">866       # Check if compiler supports -fmacro-prefix-map. If so, use that to make</span>
<span class="line-modified">867       # the __FILE__ macro resolve to paths relative to the workspace root.</span>
<span class="line-modified">868       workspace_root_trailing_slash=&quot;${WORKSPACE_ROOT%/}/&quot;</span>
<span class="line-added">869       FILE_MACRO_CFLAGS=&quot;-fmacro-prefix-map=${workspace_root_trailing_slash}=&quot;</span>
<span class="line-added">870       FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${FILE_MACRO_CFLAGS}],</span>
<span class="line-added">871           PREFIX: $3,</span>
<span class="line-added">872           IF_FALSE: [</span>
<span class="line-added">873               FILE_MACRO_CFLAGS=</span>
<span class="line-added">874           ]</span>
<span class="line-added">875       )</span>
<span class="line-added">876     fi</span>
877   fi
<span class="line-added">878   AC_SUBST(FILE_MACRO_CFLAGS)</span>
879 
880   # EXPORT to API
881   CFLAGS_JVM_COMMON=&quot;$ALWAYS_CFLAGS_JVM $ALWAYS_DEFINES_JVM \
882       $TOOLCHAIN_CFLAGS_JVM ${$1_TOOLCHAIN_CFLAGS_JVM} \
883       $OS_CFLAGS $OS_CFLAGS_JVM $CFLAGS_OS_DEF_JVM $DEBUG_CFLAGS_JVM \
884       $WARNING_CFLAGS $WARNING_CFLAGS_JVM $JVM_PICFLAG $FILE_MACRO_CFLAGS&quot;
885 
886   CFLAGS_JDK_COMMON=&quot;$ALWAYS_CFLAGS_JDK $ALWAYS_DEFINES_JDK $TOOLCHAIN_CFLAGS_JDK \
887       $OS_CFLAGS $CFLAGS_OS_DEF_JDK $DEBUG_CFLAGS_JDK $DEBUG_OPTIONS_FLAGS_JDK \
888       $WARNING_CFLAGS $WARNING_CFLAGS_JDK $DEBUG_SYMBOLS_CFLAGS_JDK \
889       $FILE_MACRO_CFLAGS&quot;
890 
891   # Use ${$2EXTRA_CFLAGS} to block EXTRA_CFLAGS to be added to build flags.
892   # (Currently we don&#39;t have any OPENJDK_BUILD_EXTRA_CFLAGS, but that might
893   # change in the future.)
894 
895   CFLAGS_JDK_COMMON_CONLY=&quot;$TOOLCHAIN_CFLAGS_JDK_CONLY  \
896       $WARNING_CFLAGS_JDK_CONLY ${$2EXTRA_CFLAGS}&quot;
897   CFLAGS_JDK_COMMON_CXXONLY=&quot;$ALWAYS_DEFINES_JDK_CXXONLY \
898       $TOOLCHAIN_CFLAGS_JDK_CXXONLY \
899       ${$1_TOOLCHAIN_CFLAGS_JDK_CXXONLY} \
900       $WARNING_CFLAGS_JDK_CXXONLY ${$2EXTRA_CXXFLAGS}&quot;
901 
902   $1_CFLAGS_JVM=&quot;${$1_DEFINES_CPU_JVM} ${$1_CFLAGS_CPU} ${$1_CFLAGS_CPU_JVM} ${$1_TOOLCHAIN_CFLAGS} ${$1_WARNING_CFLAGS_JVM}&quot;
903   $1_CFLAGS_JDK=&quot;${$1_DEFINES_CPU_JDK} ${$1_CFLAGS_CPU} ${$1_CFLAGS_CPU_JDK} ${$1_TOOLCHAIN_CFLAGS}&quot;
904 
905   $2JVM_CFLAGS=&quot;$CFLAGS_JVM_COMMON ${$1_CFLAGS_JVM} ${$2EXTRA_CXXFLAGS}&quot;
906 
<span class="line-modified">907   $2CFLAGS_JDKEXE=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CONLY ${$1_CFLAGS_JDK} $PIEFLAG&quot;</span>
<span class="line-modified">908   $2CXXFLAGS_JDKEXE=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CXXONLY ${$1_CFLAGS_JDK} $PIEFLAG&quot;</span>
<span class="line-modified">909   $2CFLAGS_JDKLIB=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CONLY ${$1_CFLAGS_JDK} \</span>
<span class="line-modified">910       $JDK_PICFLAG ${$1_CFLAGS_CPU_JDK_LIBONLY}&quot;</span>
<span class="line-added">911   $2CXXFLAGS_JDKLIB=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CXXONLY ${$1_CFLAGS_JDK} \</span>
<span class="line-added">912       $JDK_PICFLAG ${$1_CFLAGS_CPU_JDK_LIBONLY}&quot;</span>
913 
914   AC_SUBST($2JVM_CFLAGS)
915   AC_SUBST($2CFLAGS_JDKLIB)
916   AC_SUBST($2CFLAGS_JDKEXE)
917   AC_SUBST($2CXXFLAGS_JDKLIB)
918   AC_SUBST($2CXXFLAGS_JDKEXE)
919   AC_SUBST($2ADLC_CXXFLAG)
920 
921   COMPILER_FP_CONTRACT_OFF_FLAG=&quot;-ffp-contract=off&quot;
922   # Check that the compiler supports -ffp-contract=off flag
923   # Set FDLIBM_CFLAGS to -ffp-contract=off if it does. Empty
924   # otherwise.
925   # These flags are required for GCC-based builds of
926   # fdlibm with optimization without losing precision.
927   # Notably, -ffp-contract=off needs to be added for GCC &gt;= 4.6.
928   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
929     FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${COMPILER_FP_CONTRACT_OFF_FLAG}],
930         PREFIX: $3,
931         IF_TRUE: [$2FDLIBM_CFLAGS=${COMPILER_FP_CONTRACT_OFF_FLAG}],
932         IF_FALSE: [$2FDLIBM_CFLAGS=&quot;&quot;])
</pre>
</td>
</tr>
</table>
<center><a href="configure.ac.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="flags-ldflags.m4.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>