<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/basic.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="../TestImage.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="configure.ac.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/basic.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 69     AC_MSG_NOTICE([Rewriting ORIGINAL_PATH to $REWRITTEN_PATH])
 70   fi
 71 
 72   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xwindows&quot;; then
 73     PATH_SEP=&quot;;&quot;
 74     EXE_SUFFIX=&quot;.exe&quot;
 75     BASIC_CHECK_PATHS_WINDOWS
 76   else
 77     PATH_SEP=&quot;:&quot;
 78     EXE_SUFFIX=&quot;&quot;
 79   fi
 80   AC_SUBST(PATH_SEP)
 81   AC_SUBST(EXE_SUFFIX)
 82 
 83   # We get the top-level directory from the supporting wrappers.
 84   AC_MSG_CHECKING([for top-level directory])
 85   AC_MSG_RESULT([$TOPDIR])
 86   AC_SUBST(TOPDIR)
 87   AC_SUBST(CONFIGURE_START_DIR)
 88 







 89   # We can only call UTIL_FIXUP_PATH after BASIC_CHECK_PATHS_WINDOWS.
 90   UTIL_FIXUP_PATH(CONFIGURE_START_DIR)
 91   UTIL_FIXUP_PATH(TOPDIR)
 92 
 93   # Locate the directory of this script.
 94   AUTOCONF_DIR=$TOPDIR/make/autoconf
 95 
 96   # Setup username (for use in adhoc version strings etc)
 97   # Outer [ ] to quote m4.
 98   [ USERNAME=`$ECHO &quot;$USER&quot; | $TR -d -c &#39;[a-z][A-Z][0-9]&#39;` ]
 99   AC_SUBST(USERNAME)
100 ])
101 
102 ###############################################################################
103 # Evaluates platform specific overrides for devkit variables.
104 # $1: Name of variable
105 AC_DEFUN([BASIC_EVAL_DEVKIT_VARIABLE],
106 [
107   if test &quot;x[$]$1&quot; = x; then
108     eval $1=&quot;\${$1_${OPENJDK_TARGET_CPU}}&quot;
</pre>
<hr />
<pre>
124     if test -f &quot;$DEVKIT_ROOT/devkit.info&quot;; then
125       . $DEVKIT_ROOT/devkit.info
126       # This potentially sets the following:
127       # A descriptive name of the devkit
128       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_NAME])
129       # Corresponds to --with-extra-path
130       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_EXTRA_PATH])
131       # Corresponds to --with-toolchain-path
132       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_TOOLCHAIN_PATH])
133       # Corresponds to --with-sysroot
134       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_SYSROOT])
135 
136       # Identifies the Visual Studio version in the devkit
137       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_VS_VERSION])
138       # The Visual Studio include environment variable
139       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_VS_INCLUDE])
140       # The Visual Studio lib environment variable
141       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_VS_LIB])
142       # Corresponds to --with-msvcr-dll
143       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_MSVCR_DLL])


144       # Corresponds to --with-msvcp-dll
145       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_MSVCP_DLL])
146       # Corresponds to --with-ucrt-dll-dir
147       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_UCRT_DLL_DIR])
148     fi
149 
150     AC_MSG_CHECKING([for devkit])
151     if test &quot;x$DEVKIT_NAME&quot; != x; then
152       AC_MSG_RESULT([$DEVKIT_NAME in $DEVKIT_ROOT])
153     else
154       AC_MSG_RESULT([$DEVKIT_ROOT])
155     fi
156 
157     UTIL_PREPEND_TO_PATH([EXTRA_PATH],$DEVKIT_EXTRA_PATH)
158 
159     # Fallback default of just /bin if DEVKIT_PATH is not defined
160     if test &quot;x$DEVKIT_TOOLCHAIN_PATH&quot; = x; then
161       DEVKIT_TOOLCHAIN_PATH=&quot;$DEVKIT_ROOT/bin&quot;
162     fi
163     UTIL_PREPEND_TO_PATH([TOOLCHAIN_PATH],$DEVKIT_TOOLCHAIN_PATH)
</pre>
<hr />
<pre>
296 
297   AC_ARG_WITH(conf-name, [AS_HELP_STRING([--with-conf-name],
298       [use this as the name of the configuration @&lt;:@generated from important configuration options@:&gt;@])],
299       [ CONF_NAME=${with_conf_name} ])
300 
301   # Test from where we are running configure, in or outside of src root.
302   AC_MSG_CHECKING([where to store configuration])
303   if test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$TOPDIR&quot; \
304       || test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$CUSTOM_ROOT&quot; \
305       || test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$TOPDIR/make/autoconf&quot; \
306       || test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$TOPDIR/make&quot; ; then
307     # We are running configure from the src root.
308     # Create a default ./build/target-variant-debuglevel output root.
309     if test &quot;x${CONF_NAME}&quot; = x; then
310       AC_MSG_RESULT([in default location])
311       CONF_NAME=&quot;${OPENJDK_TARGET_OS}-${OPENJDK_TARGET_CPU}-${JVM_VARIANTS_WITH_AND}-${DEBUG_LEVEL}&quot;
312     else
313       AC_MSG_RESULT([in build directory with custom name])
314     fi
315 
<span class="line-removed">316     if test &quot;x$CUSTOM_ROOT&quot; != x; then</span>
<span class="line-removed">317       WORKSPACE_ROOT=&quot;${CUSTOM_ROOT}&quot;</span>
<span class="line-removed">318     else</span>
<span class="line-removed">319       WORKSPACE_ROOT=&quot;${TOPDIR}&quot;</span>
<span class="line-removed">320     fi</span>
321     OUTPUTDIR=&quot;${WORKSPACE_ROOT}/build/${CONF_NAME}&quot;
322     $MKDIR -p &quot;$OUTPUTDIR&quot;
323     if test ! -d &quot;$OUTPUTDIR&quot;; then
324       AC_MSG_ERROR([Could not create build directory $OUTPUTDIR])
325     fi
326   else
327     # We are running configure from outside of the src dir.
328     # Then use the current directory as output dir!
329     # If configuration is situated in normal build directory, just use the build
330     # directory name as configuration name, otherwise use the complete path.
331     if test &quot;x${CONF_NAME}&quot; = x; then
332       CONF_NAME=`$ECHO $CONFIGURE_START_DIR | $SED -e &quot;s!^${TOPDIR}/build/!!&quot;`
333     fi
334     OUTPUTDIR=&quot;$CONFIGURE_START_DIR&quot;
335     AC_MSG_RESULT([in current directory])
336 
337     # WARNING: This might be a bad thing to do. You need to be sure you want to
338     # have a configuration in this directory. Do some sanity checks!
339 
340     if test ! -e &quot;$OUTPUTDIR/spec.gmk&quot;; then
</pre>
<hr />
<pre>
357         AC_MSG_NOTICE([However, this directory is not empty. This is not allowed, since it could])
358         AC_MSG_NOTICE([seriously mess up just about everything.])
359         AC_MSG_NOTICE([Try &#39;cd $TOPDIR&#39; and restart configure])
360         AC_MSG_NOTICE([(or create a new empty directory and cd to it).])
361         AC_MSG_ERROR([Will not continue creating configuration in $CONFIGURE_START_DIR])
362       fi
363     fi
364   fi
365   AC_MSG_CHECKING([what configuration name to use])
366   AC_MSG_RESULT([$CONF_NAME])
367 
368   UTIL_FIXUP_PATH(OUTPUTDIR)
369 
370   CONFIGURESUPPORT_OUTPUTDIR=&quot;$OUTPUTDIR/configure-support&quot;
371   $MKDIR -p &quot;$CONFIGURESUPPORT_OUTPUTDIR&quot;
372 
373   SPEC=&quot;$OUTPUTDIR/spec.gmk&quot;
374   AC_SUBST(SPEC)
375   AC_SUBST(CONF_NAME)
376   AC_SUBST(OUTPUTDIR)
<span class="line-removed">377   AC_SUBST(WORKSPACE_ROOT)</span>
378   AC_SUBST(CONFIGURESUPPORT_OUTPUTDIR)
379 
380   # The spec.gmk file contains all variables for the make system.
381   AC_CONFIG_FILES([$OUTPUTDIR/spec.gmk:$AUTOCONF_DIR/spec.gmk.in])
382   # The bootcycle-spec.gmk file contains support for boot cycle builds.
383   AC_CONFIG_FILES([$OUTPUTDIR/bootcycle-spec.gmk:$AUTOCONF_DIR/bootcycle-spec.gmk.in])
384   # The buildjdk-spec.gmk file contains support for building a buildjdk when cross compiling.
385   AC_CONFIG_FILES([$OUTPUTDIR/buildjdk-spec.gmk:$AUTOCONF_DIR/buildjdk-spec.gmk.in])
386   # The compare.sh is used to compare the build output to other builds.
387   AC_CONFIG_FILES([$OUTPUTDIR/compare.sh:$AUTOCONF_DIR/compare.sh.in])
388   # The generated Makefile knows where the spec.gmk is and where the source is.
389   # You can run make from the OUTPUTDIR, or from the top-level Makefile
390   # which will look for generated configurations
391   AC_CONFIG_FILES([$OUTPUTDIR/Makefile:$AUTOCONF_DIR/Makefile.in])
392 ])
393 
394 ###############################################################################
395 # Check if build directory is on local disk. If not possible to determine,
396 # we prefer to claim it&#39;s local.
397 # Argument 1: directory to test
</pre>
</td>
<td>
<hr />
<pre>
 69     AC_MSG_NOTICE([Rewriting ORIGINAL_PATH to $REWRITTEN_PATH])
 70   fi
 71 
 72   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xwindows&quot;; then
 73     PATH_SEP=&quot;;&quot;
 74     EXE_SUFFIX=&quot;.exe&quot;
 75     BASIC_CHECK_PATHS_WINDOWS
 76   else
 77     PATH_SEP=&quot;:&quot;
 78     EXE_SUFFIX=&quot;&quot;
 79   fi
 80   AC_SUBST(PATH_SEP)
 81   AC_SUBST(EXE_SUFFIX)
 82 
 83   # We get the top-level directory from the supporting wrappers.
 84   AC_MSG_CHECKING([for top-level directory])
 85   AC_MSG_RESULT([$TOPDIR])
 86   AC_SUBST(TOPDIR)
 87   AC_SUBST(CONFIGURE_START_DIR)
 88 
<span class="line-added"> 89   if test &quot;x$CUSTOM_ROOT&quot; != x; then</span>
<span class="line-added"> 90     WORKSPACE_ROOT=&quot;${CUSTOM_ROOT}&quot;</span>
<span class="line-added"> 91   else</span>
<span class="line-added"> 92     WORKSPACE_ROOT=&quot;${TOPDIR}&quot;</span>
<span class="line-added"> 93   fi</span>
<span class="line-added"> 94   AC_SUBST(WORKSPACE_ROOT)</span>
<span class="line-added"> 95 </span>
 96   # We can only call UTIL_FIXUP_PATH after BASIC_CHECK_PATHS_WINDOWS.
 97   UTIL_FIXUP_PATH(CONFIGURE_START_DIR)
 98   UTIL_FIXUP_PATH(TOPDIR)
 99 
100   # Locate the directory of this script.
101   AUTOCONF_DIR=$TOPDIR/make/autoconf
102 
103   # Setup username (for use in adhoc version strings etc)
104   # Outer [ ] to quote m4.
105   [ USERNAME=`$ECHO &quot;$USER&quot; | $TR -d -c &#39;[a-z][A-Z][0-9]&#39;` ]
106   AC_SUBST(USERNAME)
107 ])
108 
109 ###############################################################################
110 # Evaluates platform specific overrides for devkit variables.
111 # $1: Name of variable
112 AC_DEFUN([BASIC_EVAL_DEVKIT_VARIABLE],
113 [
114   if test &quot;x[$]$1&quot; = x; then
115     eval $1=&quot;\${$1_${OPENJDK_TARGET_CPU}}&quot;
</pre>
<hr />
<pre>
131     if test -f &quot;$DEVKIT_ROOT/devkit.info&quot;; then
132       . $DEVKIT_ROOT/devkit.info
133       # This potentially sets the following:
134       # A descriptive name of the devkit
135       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_NAME])
136       # Corresponds to --with-extra-path
137       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_EXTRA_PATH])
138       # Corresponds to --with-toolchain-path
139       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_TOOLCHAIN_PATH])
140       # Corresponds to --with-sysroot
141       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_SYSROOT])
142 
143       # Identifies the Visual Studio version in the devkit
144       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_VS_VERSION])
145       # The Visual Studio include environment variable
146       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_VS_INCLUDE])
147       # The Visual Studio lib environment variable
148       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_VS_LIB])
149       # Corresponds to --with-msvcr-dll
150       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_MSVCR_DLL])
<span class="line-added">151       # Corresponds to --with-vcruntime-1-dll</span>
<span class="line-added">152       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_VCRUNTIME_1_DLL])</span>
153       # Corresponds to --with-msvcp-dll
154       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_MSVCP_DLL])
155       # Corresponds to --with-ucrt-dll-dir
156       BASIC_EVAL_DEVKIT_VARIABLE([DEVKIT_UCRT_DLL_DIR])
157     fi
158 
159     AC_MSG_CHECKING([for devkit])
160     if test &quot;x$DEVKIT_NAME&quot; != x; then
161       AC_MSG_RESULT([$DEVKIT_NAME in $DEVKIT_ROOT])
162     else
163       AC_MSG_RESULT([$DEVKIT_ROOT])
164     fi
165 
166     UTIL_PREPEND_TO_PATH([EXTRA_PATH],$DEVKIT_EXTRA_PATH)
167 
168     # Fallback default of just /bin if DEVKIT_PATH is not defined
169     if test &quot;x$DEVKIT_TOOLCHAIN_PATH&quot; = x; then
170       DEVKIT_TOOLCHAIN_PATH=&quot;$DEVKIT_ROOT/bin&quot;
171     fi
172     UTIL_PREPEND_TO_PATH([TOOLCHAIN_PATH],$DEVKIT_TOOLCHAIN_PATH)
</pre>
<hr />
<pre>
305 
306   AC_ARG_WITH(conf-name, [AS_HELP_STRING([--with-conf-name],
307       [use this as the name of the configuration @&lt;:@generated from important configuration options@:&gt;@])],
308       [ CONF_NAME=${with_conf_name} ])
309 
310   # Test from where we are running configure, in or outside of src root.
311   AC_MSG_CHECKING([where to store configuration])
312   if test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$TOPDIR&quot; \
313       || test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$CUSTOM_ROOT&quot; \
314       || test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$TOPDIR/make/autoconf&quot; \
315       || test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$TOPDIR/make&quot; ; then
316     # We are running configure from the src root.
317     # Create a default ./build/target-variant-debuglevel output root.
318     if test &quot;x${CONF_NAME}&quot; = x; then
319       AC_MSG_RESULT([in default location])
320       CONF_NAME=&quot;${OPENJDK_TARGET_OS}-${OPENJDK_TARGET_CPU}-${JVM_VARIANTS_WITH_AND}-${DEBUG_LEVEL}&quot;
321     else
322       AC_MSG_RESULT([in build directory with custom name])
323     fi
324 





325     OUTPUTDIR=&quot;${WORKSPACE_ROOT}/build/${CONF_NAME}&quot;
326     $MKDIR -p &quot;$OUTPUTDIR&quot;
327     if test ! -d &quot;$OUTPUTDIR&quot;; then
328       AC_MSG_ERROR([Could not create build directory $OUTPUTDIR])
329     fi
330   else
331     # We are running configure from outside of the src dir.
332     # Then use the current directory as output dir!
333     # If configuration is situated in normal build directory, just use the build
334     # directory name as configuration name, otherwise use the complete path.
335     if test &quot;x${CONF_NAME}&quot; = x; then
336       CONF_NAME=`$ECHO $CONFIGURE_START_DIR | $SED -e &quot;s!^${TOPDIR}/build/!!&quot;`
337     fi
338     OUTPUTDIR=&quot;$CONFIGURE_START_DIR&quot;
339     AC_MSG_RESULT([in current directory])
340 
341     # WARNING: This might be a bad thing to do. You need to be sure you want to
342     # have a configuration in this directory. Do some sanity checks!
343 
344     if test ! -e &quot;$OUTPUTDIR/spec.gmk&quot;; then
</pre>
<hr />
<pre>
361         AC_MSG_NOTICE([However, this directory is not empty. This is not allowed, since it could])
362         AC_MSG_NOTICE([seriously mess up just about everything.])
363         AC_MSG_NOTICE([Try &#39;cd $TOPDIR&#39; and restart configure])
364         AC_MSG_NOTICE([(or create a new empty directory and cd to it).])
365         AC_MSG_ERROR([Will not continue creating configuration in $CONFIGURE_START_DIR])
366       fi
367     fi
368   fi
369   AC_MSG_CHECKING([what configuration name to use])
370   AC_MSG_RESULT([$CONF_NAME])
371 
372   UTIL_FIXUP_PATH(OUTPUTDIR)
373 
374   CONFIGURESUPPORT_OUTPUTDIR=&quot;$OUTPUTDIR/configure-support&quot;
375   $MKDIR -p &quot;$CONFIGURESUPPORT_OUTPUTDIR&quot;
376 
377   SPEC=&quot;$OUTPUTDIR/spec.gmk&quot;
378   AC_SUBST(SPEC)
379   AC_SUBST(CONF_NAME)
380   AC_SUBST(OUTPUTDIR)

381   AC_SUBST(CONFIGURESUPPORT_OUTPUTDIR)
382 
383   # The spec.gmk file contains all variables for the make system.
384   AC_CONFIG_FILES([$OUTPUTDIR/spec.gmk:$AUTOCONF_DIR/spec.gmk.in])
385   # The bootcycle-spec.gmk file contains support for boot cycle builds.
386   AC_CONFIG_FILES([$OUTPUTDIR/bootcycle-spec.gmk:$AUTOCONF_DIR/bootcycle-spec.gmk.in])
387   # The buildjdk-spec.gmk file contains support for building a buildjdk when cross compiling.
388   AC_CONFIG_FILES([$OUTPUTDIR/buildjdk-spec.gmk:$AUTOCONF_DIR/buildjdk-spec.gmk.in])
389   # The compare.sh is used to compare the build output to other builds.
390   AC_CONFIG_FILES([$OUTPUTDIR/compare.sh:$AUTOCONF_DIR/compare.sh.in])
391   # The generated Makefile knows where the spec.gmk is and where the source is.
392   # You can run make from the OUTPUTDIR, or from the top-level Makefile
393   # which will look for generated configurations
394   AC_CONFIG_FILES([$OUTPUTDIR/Makefile:$AUTOCONF_DIR/Makefile.in])
395 ])
396 
397 ###############################################################################
398 # Check if build directory is on local disk. If not possible to determine,
399 # we prefer to claim it&#39;s local.
400 # Argument 1: directory to test
</pre>
</td>
</tr>
</table>
<center><a href="../TestImage.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="configure.ac.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>