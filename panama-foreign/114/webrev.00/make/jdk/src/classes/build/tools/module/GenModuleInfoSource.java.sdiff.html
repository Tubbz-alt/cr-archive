<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/jdk/src/classes/build/tools/module/GenModuleInfoSource.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../generatecharacter/GenerateCharacter.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../launcher/LauncherCommon.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/jdk/src/classes/build/tools/module/GenModuleInfoSource.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 42 import java.util.stream.Collectors;
 43 import java.util.stream.Stream;
 44 import static java.util.stream.Collectors.*;
 45 
 46 /**
 47  * A build tool to extend the module-info.java in the source tree for
 48  * platform-specific exports, opens, uses, and provides and write to
 49  * the specified output file.
 50  *
 51  * GenModuleInfoSource will be invoked for each module that has
 52  * module-info.java.extra in the source directory.
 53  *
 54  * The extra exports, opens, uses, provides can be specified
 55  * in module-info.java.extra.
 56  * Injecting platform-specific requires is not supported.
 57  *
 58  * @see build.tools.module.ModuleInfoExtraTest for basic testing
 59  */
 60 public class GenModuleInfoSource {
 61     private final static String USAGE =
<span class="line-modified"> 62         &quot;Usage: GenModuleInfoSource -o &lt;output file&gt; \n&quot; +</span>
<span class="line-modified"> 63         &quot;  --source-file &lt;module-info-java&gt;\n&quot; +</span>
<span class="line-modified"> 64         &quot;  --modules &lt;module-name&gt;[,&lt;module-name&gt;...]\n&quot; +</span>
<span class="line-modified"> 65         &quot;  &lt;module-info.java.extra&gt; ...\n&quot;;</span>


 66 

 67     static boolean verbose = false;
 68     public static void main(String... args) throws Exception {
 69         Path outfile = null;
 70         Path moduleInfoJava = null;
 71         Set&lt;String&gt; modules = Collections.emptySet();
 72         List&lt;Path&gt; extras = new ArrayList&lt;&gt;();
 73         // validate input arguments
 74         for (int i = 0; i &lt; args.length; i++){
 75             String option = args[i];
 76             String arg = i+1 &lt; args.length ? args[i+1] : null;
 77             switch (option) {



 78                 case &quot;-o&quot;:
 79                     outfile = Paths.get(arg);
 80                     i++;
 81                     break;
 82                 case &quot;--source-file&quot;:
 83                     moduleInfoJava = Paths.get(arg);
 84                     if (Files.notExists(moduleInfoJava)) {
 85                         throw new IllegalArgumentException(moduleInfoJava + &quot; not exist&quot;);
 86                     }
 87                     i++;
 88                     break;
 89                 case &quot;--modules&quot;:
 90                     modules = Arrays.stream(arg.split(&quot;,&quot;))
 91                                     .collect(toSet());
 92                     i++;
 93                     break;
 94                 case &quot;-v&quot;:
 95                     verbose = true;
 96                     break;
 97                 default:
</pre>
<hr />
<pre>
131         this.moduleInfo.parse(sourceFile);
132 
133         // parse module-info.java.extra
134         this.extras = new ModuleInfo();
135         for (Path file : extraFiles) {
136             extras.parseExtra(file);
137         }
138 
139         // merge with module-info.java.extra
140         moduleInfo.augmentModuleInfo(extras, modules);
141     }
142 
143     void generate(Path output) throws IOException {
144         List&lt;String&gt; lines = Files.readAllLines(sourceFile);
145         try (BufferedWriter bw = Files.newBufferedWriter(output);
146              PrintWriter writer = new PrintWriter(bw)) {
147             // write the copyright header and lines up to module declaration
148             for (String l : lines) {
149                 writer.println(l);
150                 if (l.trim().startsWith(&quot;module &quot;)) {
<span class="line-modified">151                     // print URI rather than file path to avoid escape</span>
<span class="line-modified">152                     writer.format(&quot;    // source file: %s%n&quot;, sourceFile.toUri());</span>
<span class="line-modified">153                     for (Path file: extraFiles) {</span>
<span class="line-modified">154                         writer.format(&quot;    //              %s%n&quot;, file.toUri());</span>


155                     }
156                     break;
157                 }
158             }
159 
160             // requires
161             for (String l : lines) {
162                 if (l.trim().startsWith(&quot;requires&quot;))
163                     writer.println(l);
164             }
165 
166             // write exports, opens, uses, and provides
167             moduleInfo.print(writer);
168 
169             // close
170             writer.println(&quot;}&quot;);
171         }
172     }
173 
174 
</pre>
</td>
<td>
<hr />
<pre>
 42 import java.util.stream.Collectors;
 43 import java.util.stream.Stream;
 44 import static java.util.stream.Collectors.*;
 45 
 46 /**
 47  * A build tool to extend the module-info.java in the source tree for
 48  * platform-specific exports, opens, uses, and provides and write to
 49  * the specified output file.
 50  *
 51  * GenModuleInfoSource will be invoked for each module that has
 52  * module-info.java.extra in the source directory.
 53  *
 54  * The extra exports, opens, uses, provides can be specified
 55  * in module-info.java.extra.
 56  * Injecting platform-specific requires is not supported.
 57  *
 58  * @see build.tools.module.ModuleInfoExtraTest for basic testing
 59  */
 60 public class GenModuleInfoSource {
 61     private final static String USAGE =
<span class="line-modified"> 62             &quot;Usage: GenModuleInfoSource \n&quot; +</span>
<span class="line-modified"> 63                     &quot; [-d]\n&quot; +</span>
<span class="line-modified"> 64                     &quot; -o &lt;output file&gt;\n&quot; +</span>
<span class="line-modified"> 65                     &quot;  --source-file &lt;module-info-java&gt;\n&quot; +</span>
<span class="line-added"> 66                     &quot;  --modules &lt;module-name&gt;[,&lt;module-name&gt;...]\n&quot; +</span>
<span class="line-added"> 67                     &quot;  &lt;module-info.java.extra&gt; ...\n&quot;;</span>
 68 
<span class="line-added"> 69     static boolean debug = false;</span>
 70     static boolean verbose = false;
 71     public static void main(String... args) throws Exception {
 72         Path outfile = null;
 73         Path moduleInfoJava = null;
 74         Set&lt;String&gt; modules = Collections.emptySet();
 75         List&lt;Path&gt; extras = new ArrayList&lt;&gt;();
 76         // validate input arguments
 77         for (int i = 0; i &lt; args.length; i++){
 78             String option = args[i];
 79             String arg = i+1 &lt; args.length ? args[i+1] : null;
 80             switch (option) {
<span class="line-added"> 81                 case &quot;-d&quot;:</span>
<span class="line-added"> 82                     debug = true;</span>
<span class="line-added"> 83                     break;</span>
 84                 case &quot;-o&quot;:
 85                     outfile = Paths.get(arg);
 86                     i++;
 87                     break;
 88                 case &quot;--source-file&quot;:
 89                     moduleInfoJava = Paths.get(arg);
 90                     if (Files.notExists(moduleInfoJava)) {
 91                         throw new IllegalArgumentException(moduleInfoJava + &quot; not exist&quot;);
 92                     }
 93                     i++;
 94                     break;
 95                 case &quot;--modules&quot;:
 96                     modules = Arrays.stream(arg.split(&quot;,&quot;))
 97                                     .collect(toSet());
 98                     i++;
 99                     break;
100                 case &quot;-v&quot;:
101                     verbose = true;
102                     break;
103                 default:
</pre>
<hr />
<pre>
137         this.moduleInfo.parse(sourceFile);
138 
139         // parse module-info.java.extra
140         this.extras = new ModuleInfo();
141         for (Path file : extraFiles) {
142             extras.parseExtra(file);
143         }
144 
145         // merge with module-info.java.extra
146         moduleInfo.augmentModuleInfo(extras, modules);
147     }
148 
149     void generate(Path output) throws IOException {
150         List&lt;String&gt; lines = Files.readAllLines(sourceFile);
151         try (BufferedWriter bw = Files.newBufferedWriter(output);
152              PrintWriter writer = new PrintWriter(bw)) {
153             // write the copyright header and lines up to module declaration
154             for (String l : lines) {
155                 writer.println(l);
156                 if (l.trim().startsWith(&quot;module &quot;)) {
<span class="line-modified">157                     if (debug) {</span>
<span class="line-modified">158                         // print URI rather than file path to avoid escape</span>
<span class="line-modified">159                         writer.format(&quot;    // source file: %s%n&quot;, sourceFile.toUri());</span>
<span class="line-modified">160                         for (Path file : extraFiles) {</span>
<span class="line-added">161                             writer.format(&quot;    //              %s%n&quot;, file.toUri());</span>
<span class="line-added">162                         }</span>
163                     }
164                     break;
165                 }
166             }
167 
168             // requires
169             for (String l : lines) {
170                 if (l.trim().startsWith(&quot;requires&quot;))
171                     writer.println(l);
172             }
173 
174             // write exports, opens, uses, and provides
175             moduleInfo.print(writer);
176 
177             // close
178             writer.println(&quot;}&quot;);
179         }
180     }
181 
182 
</pre>
</td>
</tr>
</table>
<center><a href="../generatecharacter/GenerateCharacter.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../launcher/LauncherCommon.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>