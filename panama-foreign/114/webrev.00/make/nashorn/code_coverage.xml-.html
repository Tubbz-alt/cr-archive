<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old make/nashorn/code_coverage.xml</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
  <body>
    <pre>
  1 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
  2 &lt;!--
  3  Copyright (c) 2010, 2013, Oracle and/or its affiliates. All rights reserved.
  4  DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  5  
  6  This code is free software; you can redistribute it and/or modify it
  7  under the terms of the GNU General Public License version 2 only, as
  8  published by the Free Software Foundation.
  9  
 10  This code is distributed in the hope that it will be useful, but WITHOUT
 11  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 12  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 13  version 2 for more details (a copy is included in the LICENSE file that
 14  accompanied this code).
 15  
 16  You should have received a copy of the GNU General Public License version
 17  2 along with this work; if not, write to the Free Software Foundation,
 18  Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 19  
 20  Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 21  or visit www.oracle.com if you need additional information or have any
 22  questions.
 23 --&gt;
 24 &lt;project name=&quot;code-coverage&quot; default=&quot;generate-code-coverage-report&quot; basedir=&quot;..&quot;&gt;
 25 
 26   &lt;!-- CODE COVERAGE --&gt;
 27   &lt;target name=&quot;init-cc-enabled&quot; if=&quot;${cc.enabled}&quot;&gt;
 28 
 29     &lt;echo message=&quot;initialize [${jcov}] java coverage&quot;/&gt;
 30 
 31 
 32     &lt;property name=&quot;cc.report.dir&quot; value=&quot;${cc.dir}/CC_${jcov}_report&quot;/&gt;
 33     &lt;property name=&quot;cc.merged.xml&quot; value=&quot;${cc.dir}/CC_${jcov}_result-merged.xml&quot;/&gt;
 34 
 35     &lt;condition property=&quot;run.test.cc.jvmargs&quot; value=&quot;${cc.dynamic.args}&quot;&gt;
 36       &lt;equals arg1=&quot;${jcov}&quot; arg2=&quot;dynamic&quot; trim=&quot;true&quot;/&gt;
 37     &lt;/condition&gt;
 38 
 39     &lt;condition property=&quot;cc.generate.template&quot; value=&quot;true&quot;&gt;
 40       &lt;equals arg1=&quot;${cc.dynamic.genereate.template}&quot; arg2=&quot;true&quot; trim=&quot;true&quot;/&gt;
 41     &lt;/condition&gt;
 42 
 43     &lt;mkdir dir=&quot;${cc.dir}&quot;/&gt;
 44     &lt;mkdir dir=&quot;${build.dir}/to_be_instrumented&quot;/&gt;
 45 
 46     &lt;!-- info --&gt;
 47     &lt;echo message=&quot;jcov=${jcov}&quot;/&gt;
 48     &lt;echo message=&quot;cc.generate.template=${cc.generate.template}&quot;/&gt;
 49     &lt;echo message=&quot;cc.instrument=${cc.instrument}&quot;/&gt;
 50     &lt;echo message=&quot;run.test.cc.jvmargs=${run.test.cc.jvmargs}&quot;/&gt;
 51     &lt;echo message=&quot;cc.report.dir=${cc.report.dir}&quot;/&gt;
 52     &lt;echo message=&quot;cc.merged.xml=${cc.merged.xml}&quot;/&gt;
 53   &lt;/target&gt;
 54 
 55   &lt;target name=&quot;init-cc-disabled&quot; unless=&quot;${cc.enabled}&quot;&gt;
 56     &lt;property name=&quot;run.test.cc.jvmargs&quot; value=&quot;&quot;/&gt;
 57   &lt;/target&gt;
 58 
 59   &lt;target name=&quot;prepare-to-be-instrumented&quot; depends=&quot;compile&quot; description=&quot;Prepares to_be_instrumented dir&quot;&gt;
 60     &lt;copy todir=&quot;${build.dir}/to_be_instrumented&quot;&gt;
 61       &lt;fileset dir=&quot;${build.classes.dir}&quot;&gt;
 62         &lt;include name=&quot;**/*.class&quot;/&gt;
 63       &lt;/fileset&gt;
 64     &lt;/copy&gt;
 65   &lt;/target&gt;
 66 
 67   &lt;target name=&quot;generate-cc-template&quot; depends=&quot;prepare-to-be-instrumented&quot; description=&quot;Generates code coverage template for dynamic CC&quot; if=&quot;cc.generate.template&quot;&gt;
 68     &lt;property name=&quot;cc.instrumented.path&quot; location=&quot;${build.dir}/to_be_instrumented&quot;/&gt;
 69     &lt;java classname=&quot;com.sun.tdk.jcov.TmplGen&quot;&gt;
 70       &lt;arg value=&quot;-verbose&quot;/&gt;
 71       &lt;arg line=&quot;-include ${cc.include}&quot;/&gt;
 72       &lt;arg line=&quot;-type all&quot;/&gt;
 73       &lt;arg line=&quot;-template ${cc.template}&quot;/&gt;
 74       &lt;arg value=&quot;${cc.instrumented.path}&quot;/&gt;
 75       &lt;classpath&gt;
 76         &lt;pathelement location=&quot;${jcov.jar}&quot;/&gt;
 77       &lt;/classpath&gt;
 78     &lt;/java&gt;
 79 
 80     &lt;java classname=&quot;com.sun.tdk.jcov.RepGen&quot;&gt;
 81       &lt;arg value=&quot;-verbose&quot;/&gt;
 82       &lt;arg line=&quot;-output ${cc.dir}/CC_template_report&quot;/&gt;
 83       &lt;arg value=&quot;${cc.template}&quot;/&gt;
 84       &lt;classpath&gt;
 85         &lt;pathelement location=&quot;${jcov.jar}&quot;/&gt;
 86       &lt;/classpath&gt;
 87     &lt;/java&gt;
 88   &lt;/target&gt;
 89 
 90   &lt;target name=&quot;init-cc&quot; depends=&quot;init-cc-disabled, init-cc-enabled&quot;&gt;
 91     &lt;property name=&quot;run.test.cc.jvmargs&quot; value=&quot;&quot;/&gt;
 92   &lt;/target&gt;
 93 
 94   &lt;target name=&quot;init-cc-cleanup&quot; if=&quot;${cc.enabled}&quot;&gt;
 95     &lt;delete dir=&quot;${cc.dir}&quot; failonerror=&quot;false&quot; /&gt;
 96     &lt;delete dir=&quot;${build.dir}/to_be_instrumented&quot; failonerror=&quot;false&quot; /&gt;
 97   &lt;/target&gt;
 98 
 99   &lt;target name=&quot;check-merging-files&quot; depends=&quot;init&quot;&gt;
100 	&lt;echo message=&quot;checking avalibility of ${cc.template}&quot;/&gt;
101     &lt;condition property=&quot;nothing-to-merge&quot; value=&quot;true&quot;&gt;
102 		&lt;not&gt;
103 	      &lt;available file=&quot;${cc.template}&quot;/&gt;
104 		&lt;/not&gt;
105     &lt;/condition&gt;
106 	&lt;echo message=&quot;nothing-to-merge = ${nothing-to-merge}&quot;/&gt;
107   &lt;/target&gt;
108 
109   &lt;target name=&quot;fix-merging-files&quot; depends=&quot;check-merging-files&quot; if=&quot;${nothing-to-merge}&quot;&gt;
110 	&lt;echo message=&quot;making pre-merge workaround due to missed template&quot;/&gt;
111 	&lt;move todir=&quot;${cc.dir}&quot; includeemptydirs=&quot;false&quot;&gt;
112 		&lt;fileset dir=&quot;${cc.dir}&quot;&gt;
113 			&lt;include name=&quot;*.xml&quot;/&gt;
114 		&lt;/fileset&gt;
115 		&lt;mapper type=&quot;glob&quot; from=&quot;*.xml&quot; to=&quot;CC_${jcov}_result-merged.xml&quot;/&gt;
116 	&lt;/move&gt;
117   &lt;/target&gt;
118  
119   &lt;target name=&quot;merge-code-coverage&quot; depends=&quot;fix-merging-files&quot; unless=&quot;${nothing-to-merge}&quot;&gt;
120 	&lt;echo message=&quot;merging files&quot;/&gt;
121     &lt;fileset dir=&quot;${cc.dir}&quot; id=&quot;cc.xmls&quot;&gt;
122       &lt;include name=&quot;**/*_${jcov}_*.xml&quot;/&gt;
123       &lt;include name=&quot;**/CC_template.xml&quot;/&gt;
124     &lt;/fileset&gt;
125 
126     &lt;pathconvert pathsep=&quot; &quot; property=&quot;cc.all.xmls&quot; refid=&quot;cc.xmls&quot;/&gt;
127 	&lt;echo message=&quot;merging files - ${cc.all.xmls}&quot; /&gt;
128     &lt;java classname=&quot;com.sun.tdk.jcov.Merger&quot;&gt;
129       &lt;arg value=&quot;-verbose&quot;/&gt;
130       &lt;arg value=&quot;-output&quot;/&gt;
131       &lt;arg value=&quot;${cc.merged.xml}&quot;/&gt;
132       &lt;arg value=&quot;-exclude&quot;/&gt;
133       &lt;arg value=&quot;com\.oracle\.nashorn\.runtime\.ScriptRuntime*&quot;/&gt;
134       &lt;arg value=&quot;-exclude&quot;/&gt;
135       &lt;arg value=&quot;jdk\.nashorn\.javaadapters*&quot;/&gt;
136       &lt;arg value=&quot;-exclude&quot;/&gt;
137       &lt;arg value=&quot;jdk\.nashorn\.internal\.objects\.annotations*&quot;/&gt;
138       &lt;arg value=&quot;-exclude&quot;/&gt;
139       &lt;arg value=&quot;jdk\.nashorn\.internal\.scripts*&quot;/&gt;
140       &lt;arg value=&quot;-exclude&quot;/&gt;
141       &lt;arg value=&quot;jdk\.nashorn\.internal\.lookup\.MethodHandleFactory*&quot;/&gt;
142       &lt;arg value=&quot;-exclude&quot;/&gt;
143       &lt;arg value=&quot;jdk\.nashorn\.internal\.test\.framework*&quot;/&gt;
144       &lt;arg value=&quot;-exclude&quot;/&gt;
145       &lt;arg value=&quot;jdk\.nashorn\.test\.models*&quot;/&gt;
146       &lt;arg value=&quot;-exclude&quot;/&gt;
147       &lt;arg value=&quot;jdk\.nashorn\.internal\.ir\.debug*&quot;/&gt;
148       &lt;arg value=&quot;-exclude&quot;/&gt;
149       &lt;arg value=&quot;jdk\.nashorn\.internal\.runtime\.regexp\.joni\.bench*&quot;/&gt;
150       &lt;arg value=&quot;-exclude&quot;/&gt;
151       &lt;arg value=&quot;jdk\.nashorn\.internal\.runtime\.DebugLogger*&quot;/&gt;
152       &lt;arg value=&quot;-exclude&quot;/&gt;
153       &lt;arg value=&quot;jdk\.nashorn\.internal\.runtime\.Timing*&quot;/&gt;
154       &lt;arg value=&quot;-exclude&quot;/&gt;
155       &lt;arg value=&quot;jdk\.nashorn\.internal\.runtime\.Logging*&quot;/&gt;
156       &lt;arg value=&quot;-exclude&quot;/&gt;
157       &lt;arg value=&quot;jdk\.nashorn\.internal\.runtime\.Debug*&quot;/&gt;
158       &lt;arg value=&quot;-exclude&quot;/&gt;
159       &lt;arg value=&quot;jdk\.nashorn\.internal\.objects\.NativeDebug*&quot;/&gt;
160       &lt;arg line=&quot;${cc.all.xmls}&quot;/&gt;
161       &lt;classpath&gt;
162         &lt;pathelement location=&quot;${jcov.jar}&quot;/&gt;
163       &lt;/classpath&gt;
164     &lt;/java&gt;
165 
166   &lt;/target&gt;
167 
168   &lt;target name=&quot;generate-code-coverage-report&quot; depends=&quot;merge-code-coverage&quot;&gt;
169     &lt;java classname=&quot;com.sun.tdk.jcov.RepGen&quot;&gt;
170       &lt;arg value=&quot;-verbose&quot;/&gt;
171 &lt;!--      &lt;arg line =&quot;-exclude_list CC.report.exclude&quot;/&gt; --&gt;
172       &lt;arg line=&quot;-output ${cc.report.dir}&quot;/&gt;
173       &lt;arg value=&quot;${cc.merged.xml}&quot;/&gt;
174       &lt;classpath&gt;
175         &lt;pathelement location=&quot;${jcov.jar}&quot;/&gt;
176       &lt;/classpath&gt;
177     &lt;/java&gt;
178   &lt;/target&gt;
179 
180 
181 &lt;/project&gt;
    </pre>
  </body>
</html>