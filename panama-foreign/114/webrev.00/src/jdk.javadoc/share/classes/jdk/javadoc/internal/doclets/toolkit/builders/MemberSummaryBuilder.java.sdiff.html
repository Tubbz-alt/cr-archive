<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/builders/MemberSummaryBuilder.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ClassBuilder.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="ModuleSummaryBuilder.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/builders/MemberSummaryBuilder.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 83      */
 84     private MemberSummaryBuilder(Context context, TypeElement typeElement) {
 85         super(context, typeElement);
 86         memberSummaryWriters = new EnumMap&lt;&gt;(VisibleMemberTable.Kind.class);
 87         comparator = utils.comparators.makeIndexElementComparator();
 88         pHelper = new PropertyHelper(this);
 89     }
 90 
 91     /**
 92      * Construct a new MemberSummaryBuilder for a general type.
 93      *
 94      * @param classWriter   the writer for the class whose members are being
 95      *                      summarized.
 96      * @param context       the build context.
 97      * @return              the instance
 98      */
 99     public static MemberSummaryBuilder getInstance(
100             ClassWriter classWriter, Context context) {
101         MemberSummaryBuilder builder = new MemberSummaryBuilder(context, classWriter.getTypeElement()) {
102             @Override
<span class="line-modified">103             public void build(Content contentTree) {</span>
<span class="line-modified">104                 buildPropertiesSummary(contentTree);</span>
<span class="line-modified">105                 buildNestedClassesSummary(contentTree);</span>
<span class="line-modified">106                 buildEnumConstantsSummary(contentTree);</span>
<span class="line-modified">107                 buildAnnotationTypeRequiredMemberSummary(contentTree);</span>
<span class="line-modified">108                 buildAnnotationTypeOptionalMemberSummary(contentTree);</span>
<span class="line-modified">109                 buildFieldsSummary(contentTree);</span>
<span class="line-modified">110                 buildConstructorsSummary(contentTree);</span>
<span class="line-modified">111                 buildMethodsSummary(contentTree);</span>
112             }
113 
114             @Override
115             public boolean hasMembersToDocument() {
116                 return visibleMemberTable.hasVisibleMembers();
117             }
118         };
119         WriterFactory wf = context.configuration.getWriterFactory();
120         for (VisibleMemberTable.Kind kind : VisibleMemberTable.Kind.values()) {
121             MemberSummaryWriter msw = builder.getVisibleMemberTable().hasVisibleMembers(kind)
122                     ? wf.getMemberSummaryWriter(classWriter, kind)
123                     : null;
124             builder.memberSummaryWriters.put(kind, msw);
125         }
126         return builder;
127     }
128 
129     /**
130      * Return the specified visible member map.
131      *
</pre>
<hr />
<pre>
157      * @param kind the kind of elements to return.
158      * @return a list of methods that will be documented.
159      * @see VisibleMemberTable
160      */
161     public SortedSet&lt;Element&gt; members(VisibleMemberTable.Kind kind) {
162         TreeSet&lt;Element&gt; out = new TreeSet&lt;&gt;(comparator);
163         out.addAll(getVisibleMembers(kind));
164         return out;
165     }
166 
167     /**
168      * Returns true if there are members of the given kind, false otherwise.
169      * @param kind
170      * @return true if there are members of the given kind, false otherwise
171      */
172     public boolean hasMembers(VisibleMemberTable.Kind kind) {
173         return !getVisibleMembers(kind).isEmpty();
174     }
175 
176     /**
<span class="line-modified">177      * Build the summary for the enum constants.</span>
178      *
<span class="line-modified">179      * @param memberSummaryTree the content tree to which the documentation will be added</span>
180      */
<span class="line-modified">181     protected void buildEnumConstantsSummary(Content memberSummaryTree) {</span>
<span class="line-modified">182         MemberSummaryWriter writer = memberSummaryWriters.get(ENUM_CONSTANTS);</span>
<span class="line-modified">183         addSummary(writer, ENUM_CONSTANTS, false, memberSummaryTree);</span>
<span class="line-removed">184     }</span>
<span class="line-removed">185 </span>
<span class="line-removed">186     /**</span>
<span class="line-removed">187      * Build the summary for fields.</span>
<span class="line-removed">188      *</span>
<span class="line-removed">189      * @param memberSummaryTree the content tree to which the documentation will be added</span>
<span class="line-removed">190      */</span>
<span class="line-removed">191     protected void buildAnnotationTypeFieldsSummary(Content memberSummaryTree) {</span>
<span class="line-removed">192         MemberSummaryWriter writer = memberSummaryWriters.get(FIELDS);</span>
<span class="line-removed">193         addSummary(writer, FIELDS, false, memberSummaryTree);</span>
194     }
195 
196     /**
<span class="line-modified">197      * Build the summary for the optional members.</span>
198      *
<span class="line-modified">199      * @param memberSummaryTree the content tree to which the documentation will be added</span>
200      */
<span class="line-modified">201     protected void buildAnnotationTypeOptionalMemberSummary(Content memberSummaryTree) {</span>
<span class="line-modified">202         MemberSummaryWriter writer = memberSummaryWriters.get(ANNOTATION_TYPE_MEMBER_OPTIONAL);</span>
<span class="line-modified">203         addSummary(writer, ANNOTATION_TYPE_MEMBER_OPTIONAL, false, memberSummaryTree);</span>
204     }
205 
206     /**
<span class="line-modified">207      * Build the summary for the optional members.</span>
208      *
<span class="line-modified">209      * @param memberSummaryTree the content tree to which the documentation will be added</span>
210      */
<span class="line-modified">211     protected void buildAnnotationTypeRequiredMemberSummary(Content memberSummaryTree) {</span>
<span class="line-modified">212         MemberSummaryWriter writer = memberSummaryWriters.get(ANNOTATION_TYPE_MEMBER_REQUIRED);</span>
<span class="line-modified">213         addSummary(writer, ANNOTATION_TYPE_MEMBER_REQUIRED, false, memberSummaryTree);</span>
214     }
215 
216     /**
<span class="line-modified">217      * Build the summary for the fields.</span>
218      *
<span class="line-modified">219      * @param memberSummaryTree the content tree to which the documentation will be added</span>
220      */
<span class="line-modified">221     protected void buildFieldsSummary(Content memberSummaryTree) {</span>
222         MemberSummaryWriter writer = memberSummaryWriters.get(FIELDS);
<span class="line-modified">223         addSummary(writer, FIELDS, true, memberSummaryTree);</span>
224     }
225 
226     /**
<span class="line-modified">227      * Build the summary for the fields.</span>
228      *
<span class="line-modified">229      * @param memberSummaryTree the content tree to which the documentation will be added</span>
230      */
<span class="line-modified">231     protected void buildPropertiesSummary(Content memberSummaryTree) {</span>
232         MemberSummaryWriter writer = memberSummaryWriters.get(PROPERTIES);
<span class="line-modified">233         addSummary(writer, PROPERTIES, true, memberSummaryTree);</span>
234     }
235 
236     /**
<span class="line-modified">237      * Build the summary for the nested classes.</span>
238      *
<span class="line-modified">239      * @param memberSummaryTree the content tree to which the documentation will be added</span>
240      */
<span class="line-modified">241     protected void buildNestedClassesSummary(Content memberSummaryTree) {</span>
242         MemberSummaryWriter writer = memberSummaryWriters.get(INNER_CLASSES);
<span class="line-modified">243         addSummary(writer, INNER_CLASSES, true, memberSummaryTree);</span>
244     }
245 
246     /**
<span class="line-modified">247      * Build the method summary.</span>
248      *
<span class="line-modified">249      * @param memberSummaryTree the content tree to which the documentation will be added</span>
250      */
<span class="line-modified">251     protected void buildMethodsSummary(Content memberSummaryTree) {</span>
252         MemberSummaryWriter writer = memberSummaryWriters.get(METHODS);
<span class="line-modified">253         addSummary(writer, METHODS, true, memberSummaryTree);</span>
254     }
255 
256     /**
<span class="line-modified">257      * Build the constructor summary.</span>
258      *
<span class="line-modified">259      * @param memberSummaryTree the content tree to which the documentation will be added</span>
260      */
<span class="line-modified">261     protected void buildConstructorsSummary(Content memberSummaryTree) {</span>
262         MemberSummaryWriter writer = memberSummaryWriters.get(CONSTRUCTORS);
<span class="line-modified">263         addSummary(writer, CONSTRUCTORS, false, memberSummaryTree);</span>
264     }
265 
266     /**
267      * Build the member summary for the given members.
268      *
269      * @param writer the summary writer to write the output.
270      * @param kind the kind of  members to summarize.
271      * @param summaryTreeList list of content trees to which the documentation will be added
272      */
273     private void buildSummary(MemberSummaryWriter writer,
274             VisibleMemberTable.Kind kind, LinkedList&lt;Content&gt; summaryTreeList) {
275         SortedSet&lt;? extends Element&gt; members = asSortedSet(getVisibleMembers(kind));
276         if (!members.isEmpty()) {
277             for (Element member : members) {
278                 final Element property = pHelper.getPropertyElement(member);
279                 if (property != null) {
280                     processProperty(member, property);
281                 }
282                 List&lt;? extends DocTree&gt; firstSentenceTags = utils.getFirstSentenceTrees(member);
283                 if (utils.isExecutableElement(member) &amp;&amp; firstSentenceTags.isEmpty()) {
</pre>
<hr />
<pre>
427                 Content inheritedTree = writer.getInheritedSummaryHeader(inheritedClass);
428                 Content linksTree = writer.getInheritedSummaryLinksTree();
429                 addSummaryFootNote(inheritedClass, inheritedMembers, linksTree, writer);
430                 inheritedTree.add(linksTree);
431                 summaryTreeList.add(inheritedTree);
432             }
433         }
434     }
435 
436     private void addSummaryFootNote(TypeElement inheritedClass, SortedSet&lt;Element&gt; inheritedMembers,
437                                     Content linksTree, MemberSummaryWriter writer) {
438         for (Element member : inheritedMembers) {
439             TypeElement t = utils.isUndocumentedEnclosure(inheritedClass)
440                     ? typeElement : inheritedClass;
441             writer.addInheritedMemberSummary(t, member, inheritedMembers.first() == member,
442                     inheritedMembers.last() == member, linksTree);
443         }
444     }
445 
446     /**
<span class="line-modified">447      * Add the summary for the documentation.</span>
448      *
<span class="line-modified">449      * @param writer the writer for this member summary.</span>
<span class="line-modified">450      * @param kind the kind of members to document.</span>
<span class="line-modified">451      * @param showInheritedSummary true if inherited summary should be documented</span>
<span class="line-modified">452      * @param memberSummaryTree the content tree to which the documentation will be added</span>
453      */
454     private void addSummary(MemberSummaryWriter writer,
455                             VisibleMemberTable.Kind kind,
456                             boolean showInheritedSummary,
<span class="line-modified">457                             Content memberSummaryTree)</span>
458     {
459         LinkedList&lt;Content&gt; summaryTreeList = new LinkedList&lt;&gt;();
460         buildSummary(writer, kind, summaryTreeList);
461         if (showInheritedSummary)
462             buildInheritedSummary(writer, kind, summaryTreeList);
463         if (!summaryTreeList.isEmpty()) {
<span class="line-modified">464             Content memberTree = writer.getMemberSummaryHeader(typeElement, memberSummaryTree);</span>
465             summaryTreeList.forEach(memberTree::add);
<span class="line-modified">466             writer.addMemberTree(memberSummaryTree, memberTree);</span>
467         }
468     }
469 
470     private SortedSet&lt;? extends Element&gt; asSortedSet(Collection&lt;? extends Element&gt; members) {
471         SortedSet&lt;Element&gt; out = new TreeSet&lt;&gt;(comparator);
472         out.addAll(members);
473         return out;
474     }
475 
476     static class PropertyHelper {
477 
478         private final Map&lt;Element, Element&gt; classPropertiesMap = new HashMap&lt;&gt;();
479 
480         private final MemberSummaryBuilder  builder;
481 
482         PropertyHelper(MemberSummaryBuilder builder) {
483             this.builder = builder;
484             computeProperties();
485         }
486 
</pre>
</td>
<td>
<hr />
<pre>
 83      */
 84     private MemberSummaryBuilder(Context context, TypeElement typeElement) {
 85         super(context, typeElement);
 86         memberSummaryWriters = new EnumMap&lt;&gt;(VisibleMemberTable.Kind.class);
 87         comparator = utils.comparators.makeIndexElementComparator();
 88         pHelper = new PropertyHelper(this);
 89     }
 90 
 91     /**
 92      * Construct a new MemberSummaryBuilder for a general type.
 93      *
 94      * @param classWriter   the writer for the class whose members are being
 95      *                      summarized.
 96      * @param context       the build context.
 97      * @return              the instance
 98      */
 99     public static MemberSummaryBuilder getInstance(
100             ClassWriter classWriter, Context context) {
101         MemberSummaryBuilder builder = new MemberSummaryBuilder(context, classWriter.getTypeElement()) {
102             @Override
<span class="line-modified">103             public void build(Content summariesList) {</span>
<span class="line-modified">104                 buildPropertiesSummary(summariesList);</span>
<span class="line-modified">105                 buildNestedClassesSummary(summariesList);</span>
<span class="line-modified">106                 buildEnumConstantsSummary(summariesList);</span>
<span class="line-modified">107                 buildAnnotationTypeRequiredMemberSummary(summariesList);</span>
<span class="line-modified">108                 buildAnnotationTypeOptionalMemberSummary(summariesList);</span>
<span class="line-modified">109                 buildFieldsSummary(summariesList);</span>
<span class="line-modified">110                 buildConstructorsSummary(summariesList);</span>
<span class="line-modified">111                 buildMethodsSummary(summariesList);</span>
112             }
113 
114             @Override
115             public boolean hasMembersToDocument() {
116                 return visibleMemberTable.hasVisibleMembers();
117             }
118         };
119         WriterFactory wf = context.configuration.getWriterFactory();
120         for (VisibleMemberTable.Kind kind : VisibleMemberTable.Kind.values()) {
121             MemberSummaryWriter msw = builder.getVisibleMemberTable().hasVisibleMembers(kind)
122                     ? wf.getMemberSummaryWriter(classWriter, kind)
123                     : null;
124             builder.memberSummaryWriters.put(kind, msw);
125         }
126         return builder;
127     }
128 
129     /**
130      * Return the specified visible member map.
131      *
</pre>
<hr />
<pre>
157      * @param kind the kind of elements to return.
158      * @return a list of methods that will be documented.
159      * @see VisibleMemberTable
160      */
161     public SortedSet&lt;Element&gt; members(VisibleMemberTable.Kind kind) {
162         TreeSet&lt;Element&gt; out = new TreeSet&lt;&gt;(comparator);
163         out.addAll(getVisibleMembers(kind));
164         return out;
165     }
166 
167     /**
168      * Returns true if there are members of the given kind, false otherwise.
169      * @param kind
170      * @return true if there are members of the given kind, false otherwise
171      */
172     public boolean hasMembers(VisibleMemberTable.Kind kind) {
173         return !getVisibleMembers(kind).isEmpty();
174     }
175 
176     /**
<span class="line-modified">177      * Builds the summary for any optional members of an annotation type.</span>
178      *
<span class="line-modified">179      * @param summariesList the list of summaries to which the summary will be added</span>
180      */
<span class="line-modified">181     protected void buildAnnotationTypeOptionalMemberSummary(Content summariesList) {</span>
<span class="line-modified">182         MemberSummaryWriter writer = memberSummaryWriters.get(ANNOTATION_TYPE_MEMBER_OPTIONAL);</span>
<span class="line-modified">183         addSummary(writer, ANNOTATION_TYPE_MEMBER_OPTIONAL, false, summariesList);</span>










184     }
185 
186     /**
<span class="line-modified">187      * Builds the summary for any required members of an annotation type.</span>
188      *
<span class="line-modified">189      * @param summariesList the list of summaries to which the summary will be added</span>
190      */
<span class="line-modified">191     protected void buildAnnotationTypeRequiredMemberSummary(Content summariesList) {</span>
<span class="line-modified">192         MemberSummaryWriter writer = memberSummaryWriters.get(ANNOTATION_TYPE_MEMBER_REQUIRED);</span>
<span class="line-modified">193         addSummary(writer, ANNOTATION_TYPE_MEMBER_REQUIRED, false, summariesList);</span>
194     }
195 
196     /**
<span class="line-modified">197      * Builds the summary for any enum constants of an enum type.</span>
198      *
<span class="line-modified">199      * @param summariesList the list of summaries to which the summary will be added</span>
200      */
<span class="line-modified">201     protected void buildEnumConstantsSummary(Content summariesList) {</span>
<span class="line-modified">202         MemberSummaryWriter writer = memberSummaryWriters.get(ENUM_CONSTANTS);</span>
<span class="line-modified">203         addSummary(writer, ENUM_CONSTANTS, false, summariesList);</span>
204     }
205 
206     /**
<span class="line-modified">207      * Builds the summary for any fields.</span>
208      *
<span class="line-modified">209      * @param summariesList the list of summaries to which the summary will be added</span>
210      */
<span class="line-modified">211     protected void buildFieldsSummary(Content summariesList) {</span>
212         MemberSummaryWriter writer = memberSummaryWriters.get(FIELDS);
<span class="line-modified">213         addSummary(writer, FIELDS, true, summariesList);</span>
214     }
215 
216     /**
<span class="line-modified">217      * Builds the summary for any properties.</span>
218      *
<span class="line-modified">219      * @param summariesList the list of summaries to which the summary will be added</span>
220      */
<span class="line-modified">221     protected void buildPropertiesSummary(Content summariesList) {</span>
222         MemberSummaryWriter writer = memberSummaryWriters.get(PROPERTIES);
<span class="line-modified">223         addSummary(writer, PROPERTIES, true, summariesList);</span>
224     }
225 
226     /**
<span class="line-modified">227      * Builds the summary for any nested classes.</span>
228      *
<span class="line-modified">229      * @param summariesList the list of summaries to which the summary will be added</span>
230      */
<span class="line-modified">231     protected void buildNestedClassesSummary(Content summariesList) {</span>
232         MemberSummaryWriter writer = memberSummaryWriters.get(INNER_CLASSES);
<span class="line-modified">233         addSummary(writer, INNER_CLASSES, true, summariesList);</span>
234     }
235 
236     /**
<span class="line-modified">237      * Builds the summary for any methods.</span>
238      *
<span class="line-modified">239      * @param summariesList the content tree to which the documentation will be added</span>
240      */
<span class="line-modified">241     protected void buildMethodsSummary(Content summariesList) {</span>
242         MemberSummaryWriter writer = memberSummaryWriters.get(METHODS);
<span class="line-modified">243         addSummary(writer, METHODS, true, summariesList);</span>
244     }
245 
246     /**
<span class="line-modified">247      * Builds the summary for any constructors.</span>
248      *
<span class="line-modified">249      * @param summariesList the content tree to which the documentation will be added</span>
250      */
<span class="line-modified">251     protected void buildConstructorsSummary(Content summariesList) {</span>
252         MemberSummaryWriter writer = memberSummaryWriters.get(CONSTRUCTORS);
<span class="line-modified">253         addSummary(writer, CONSTRUCTORS, false, summariesList);</span>
254     }
255 
256     /**
257      * Build the member summary for the given members.
258      *
259      * @param writer the summary writer to write the output.
260      * @param kind the kind of  members to summarize.
261      * @param summaryTreeList list of content trees to which the documentation will be added
262      */
263     private void buildSummary(MemberSummaryWriter writer,
264             VisibleMemberTable.Kind kind, LinkedList&lt;Content&gt; summaryTreeList) {
265         SortedSet&lt;? extends Element&gt; members = asSortedSet(getVisibleMembers(kind));
266         if (!members.isEmpty()) {
267             for (Element member : members) {
268                 final Element property = pHelper.getPropertyElement(member);
269                 if (property != null) {
270                     processProperty(member, property);
271                 }
272                 List&lt;? extends DocTree&gt; firstSentenceTags = utils.getFirstSentenceTrees(member);
273                 if (utils.isExecutableElement(member) &amp;&amp; firstSentenceTags.isEmpty()) {
</pre>
<hr />
<pre>
417                 Content inheritedTree = writer.getInheritedSummaryHeader(inheritedClass);
418                 Content linksTree = writer.getInheritedSummaryLinksTree();
419                 addSummaryFootNote(inheritedClass, inheritedMembers, linksTree, writer);
420                 inheritedTree.add(linksTree);
421                 summaryTreeList.add(inheritedTree);
422             }
423         }
424     }
425 
426     private void addSummaryFootNote(TypeElement inheritedClass, SortedSet&lt;Element&gt; inheritedMembers,
427                                     Content linksTree, MemberSummaryWriter writer) {
428         for (Element member : inheritedMembers) {
429             TypeElement t = utils.isUndocumentedEnclosure(inheritedClass)
430                     ? typeElement : inheritedClass;
431             writer.addInheritedMemberSummary(t, member, inheritedMembers.first() == member,
432                     inheritedMembers.last() == member, linksTree);
433         }
434     }
435 
436     /**
<span class="line-modified">437      * Adds the summary for the documentation.</span>
438      *
<span class="line-modified">439      * @param writer               the writer for this member summary</span>
<span class="line-modified">440      * @param kind                 the kind of members to document</span>
<span class="line-modified">441      * @param showInheritedSummary true if a summary of any inherited elements should be documented</span>
<span class="line-modified">442      * @param summariesList        the list of summaries to which the summary will be added</span>
443      */
444     private void addSummary(MemberSummaryWriter writer,
445                             VisibleMemberTable.Kind kind,
446                             boolean showInheritedSummary,
<span class="line-modified">447                             Content summariesList)</span>
448     {
449         LinkedList&lt;Content&gt; summaryTreeList = new LinkedList&lt;&gt;();
450         buildSummary(writer, kind, summaryTreeList);
451         if (showInheritedSummary)
452             buildInheritedSummary(writer, kind, summaryTreeList);
453         if (!summaryTreeList.isEmpty()) {
<span class="line-modified">454             Content memberTree = writer.getMemberSummaryHeader(typeElement, summariesList);</span>
455             summaryTreeList.forEach(memberTree::add);
<span class="line-modified">456             writer.addSummary(summariesList, memberTree);</span>
457         }
458     }
459 
460     private SortedSet&lt;? extends Element&gt; asSortedSet(Collection&lt;? extends Element&gt; members) {
461         SortedSet&lt;Element&gt; out = new TreeSet&lt;&gt;(comparator);
462         out.addAll(members);
463         return out;
464     }
465 
466     static class PropertyHelper {
467 
468         private final Map&lt;Element, Element&gt; classPropertiesMap = new HashMap&lt;&gt;();
469 
470         private final MemberSummaryBuilder  builder;
471 
472         PropertyHelper(MemberSummaryBuilder builder) {
473             this.builder = builder;
474             computeProperties();
475         }
476 
</pre>
</td>
</tr>
</table>
<center><a href="ClassBuilder.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="ModuleSummaryBuilder.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>