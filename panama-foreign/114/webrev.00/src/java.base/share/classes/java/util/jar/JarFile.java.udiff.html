<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/java/util/jar/JarFile.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../Scanner.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../regex/Grapheme.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/util/jar/JarFile.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -429,14 +429,10 @@</span>
              }
          }
          return man;
      }
  
<span class="udiff-line-removed">-     private String[] getMetaInfEntryNames() {</span>
<span class="udiff-line-removed">-         return JUZFA.getMetaInfEntryNames((ZipFile)this);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
      /**
       * Returns the {@code JarEntry} for the given base entry name or
       * {@code null} if not found.
       *
       * &lt;p&gt;If this {@code JarFile} is a multi-release jar file and is configured
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -502,15 +498,19 @@</span>
       * If a subclass overrides this method, assure that the override method
       * invokes {@code super.getEntry(name)} to obtain all versioned entries.
       * &lt;/div&gt;
       */
      public ZipEntry getEntry(String name) {
<span class="udiff-line-removed">-         JarFileEntry je = getEntry0(name);</span>
          if (isMultiRelease()) {
<span class="udiff-line-modified-removed">-             return getVersionedEntry(name, je);</span>
<span class="udiff-line-modified-added">+             JarEntry je = getVersionedEntry(name, null);</span>
<span class="udiff-line-added">+             if (je == null) {</span>
<span class="udiff-line-added">+                 je = getEntry0(name);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+             return je;</span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+             return getEntry0(name);</span>
          }
<span class="udiff-line-removed">-         return je;</span>
      }
  
      /**
       * Returns an enumeration of the jar file entries.
       *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -596,25 +596,33 @@</span>
              return name.substring(index + 1);
          }
          return name;
      }
  
<span class="udiff-line-modified-removed">-     private JarEntry getVersionedEntry(String name, JarEntry je) {</span>
<span class="udiff-line-modified-removed">-         if (BASE_VERSION_FEATURE &lt; versionFeature) {</span>
<span class="udiff-line-modified-removed">-             if (!name.startsWith(META_INF)) {</span>
<span class="udiff-line-modified-added">+     private JarEntry getVersionedEntry(String name, JarEntry defaultEntry) {</span>
<span class="udiff-line-modified-added">+         if (!name.startsWith(META_INF)) {</span>
<span class="udiff-line-modified-added">+             int[] versions = JUZFA.getMetaInfVersions(this);</span>
<span class="udiff-line-added">+             if (BASE_VERSION_FEATURE &lt; versionFeature &amp;&amp; versions.length &gt; 0) {</span>
                  // search for versioned entry
<span class="udiff-line-modified-removed">-                 int v = versionFeature;</span>
<span class="udiff-line-modified-removed">-                 while (v &gt; BASE_VERSION_FEATURE) {</span>
<span class="udiff-line-modified-removed">-                     JarFileEntry vje = getEntry0(META_INF_VERSIONS + v + &quot;/&quot; + name);</span>
<span class="udiff-line-modified-added">+                 for (int i = versions.length - 1; i &gt;= 0; i--) {</span>
<span class="udiff-line-modified-added">+                     int version = versions[i];</span>
<span class="udiff-line-modified-added">+                     // skip versions above versionFeature</span>
<span class="udiff-line-added">+                     if (version &gt; versionFeature) {</span>
<span class="udiff-line-added">+                         continue;</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                     // skip versions below base version</span>
<span class="udiff-line-added">+                     if (version &lt; BASE_VERSION_FEATURE) {</span>
<span class="udiff-line-added">+                         break;</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                     JarFileEntry vje = getEntry0(META_INF_VERSIONS + version + &quot;/&quot; + name);</span>
                      if (vje != null) {
                          return vje.withBasename(name);
                      }
<span class="udiff-line-removed">-                     v--;</span>
                  }
              }
          }
<span class="udiff-line-modified-removed">-         return je;</span>
<span class="udiff-line-modified-added">+         return defaultEntry;</span>
      }
  
      // placeholder for now
      String getRealName(JarEntry entry) {
          return entry.getRealName();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -705,11 +713,11 @@</span>
          if (jv != null) {
              return;
          }
  
          if (verify) {
<span class="udiff-line-modified-removed">-             String[] names = getMetaInfEntryNames();</span>
<span class="udiff-line-modified-added">+             String[] names = JUZFA.getMetaInfEntryNames(this);</span>
              if (names != null) {
                  for (String nameLower : names) {
                      String name = nameLower.toUpperCase(Locale.ENGLISH);
                      if (name.endsWith(&quot;.DSA&quot;) ||
                          name.endsWith(&quot;.RSA&quot;) ||
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -736,11 +744,11 @@</span>
      private void initializeVerifier() {
          ManifestEntryVerifier mev = null;
  
          // Verify &quot;META-INF/&quot; entries...
          try {
<span class="udiff-line-modified-removed">-             String[] names = getMetaInfEntryNames();</span>
<span class="udiff-line-modified-added">+             String[] names = JUZFA.getMetaInfEntryNames(this);</span>
              if (names != null) {
                  for (String name : names) {
                      String uname = name.toUpperCase(Locale.ENGLISH);
                      if (MANIFEST_NAME.equals(uname)
                              || SignatureFileVerifier.isBlockOrSF(uname)) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -930,11 +938,11 @@</span>
              // First look up manifest entry using standard name
              JarEntry manEntry = getEntry0(MANIFEST_NAME);
              if (manEntry == null) {
                  // If not found, then iterate through all the &quot;META-INF/&quot;
                  // entries to find a match.
<span class="udiff-line-modified-removed">-                 String[] names = getMetaInfEntryNames();</span>
<span class="udiff-line-modified-added">+                 String[] names = JUZFA.getMetaInfEntryNames(this);</span>
                  if (names != null) {
                      for (String name : names) {
                          if (MANIFEST_NAME.equals(name.toUpperCase(Locale.ENGLISH))) {
                              manEntry = getEntry0(name);
                              break;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1014,11 +1022,11 @@</span>
                      if (i != -1) {
                          // Read the main attributes of the manifest
                          byte[] lbuf = new byte[512];
                          Attributes attr = new Attributes();
                          attr.read(new Manifest.FastInputStream(
<span class="udiff-line-modified-removed">-                             new ByteArrayInputStream(b)), lbuf);</span>
<span class="udiff-line-modified-added">+                                 new ByteArrayInputStream(b)), lbuf);</span>
                          isMultiRelease = Boolean.parseBoolean(
                              attr.getValue(Attributes.Name.MULTI_RELEASE));
                      }
                  }
              }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1066,11 +1074,11 @@</span>
       * with the given name. It is invoked from JarVerifier&#39;s entries2
       * for {@code singers}.
       */
      JarEntry newEntry(String name) {
          if (isMultiRelease()) {
<span class="udiff-line-modified-removed">-             JarEntry vje = getVersionedEntry(name, (JarEntry)null);</span>
<span class="udiff-line-modified-added">+             JarEntry vje = getVersionedEntry(name, null);</span>
              if (vje != null) {
                  return vje;
              }
          }
          return new JarFileEntry(name);
</pre>
<center><a href="../Scanner.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../regex/Grapheme.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>