<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/io/ObjectStreamClass.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="ObjectInputStream.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../lang/ProcessBuilder.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/io/ObjectStreamClass.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1996, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 868             }
 869         }
 870     }
 871 
 872     /**
 873      * Returns ClassNotFoundException (if any) thrown while attempting to
 874      * resolve local class corresponding to this class descriptor.
 875      */
 876     ClassNotFoundException getResolveException() {
 877         return resolveEx;
 878     }
 879 
 880     /**
 881      * Throws InternalError if not initialized.
 882      */
 883     private final void requireInitialized() {
 884         if (!initialized)
 885             throw new InternalError(&quot;Unexpected call when not initialized&quot;);
 886     }
 887 











 888     /**
 889      * Throws an InvalidClassException if object instances referencing this
 890      * class descriptor should not be allowed to deserialize.  This method does
 891      * not apply to deserialization of enum constants.
 892      */
 893     void checkDeserialize() throws InvalidClassException {
 894         requireInitialized();
 895         if (deserializeEx != null) {
 896             throw deserializeEx.newInvalidClassException();
 897         }
 898     }
 899 
 900     /**
 901      * Throws an InvalidClassException if objects whose class is represented by
 902      * this descriptor should not be allowed to serialize.  This method does
 903      * not apply to serialization of enum constants.
 904      */
 905     void checkSerialize() throws InvalidClassException {
 906         requireInitialized();
 907         if (serializeEx != null) {
</pre>
<hr />
<pre>
1133                     }; // Can&#39;t use PrivilegedExceptionAction with jsa
1134                     try {
1135                         return jsa.doIntersectionPrivilege(pea,
1136                                    AccessController.getContext(),
1137                                    new AccessControlContext(domains));
1138                     } catch (UndeclaredThrowableException x) {
1139                         Throwable cause = x.getCause();
1140                         if (cause instanceof InstantiationException)
1141                             throw (InstantiationException) cause;
1142                         if (cause instanceof InvocationTargetException)
1143                             throw (InvocationTargetException) cause;
1144                         if (cause instanceof IllegalAccessException)
1145                             throw (IllegalAccessException) cause;
1146                         // not supposed to happen
1147                         throw x;
1148                     }
1149                 }
1150             } catch (IllegalAccessException ex) {
1151                 // should not occur, as access checks have been suppressed
1152                 throw new InternalError(ex);




1153             }
1154         } else {
1155             throw new UnsupportedOperationException();
1156         }
1157     }
1158 
1159     /**
1160      * Invokes the writeObject method of the represented serializable class.
1161      * Throws UnsupportedOperationException if this class descriptor is not
1162      * associated with a class, or if the class is externalizable,
1163      * non-serializable or does not define writeObject.
1164      */
1165     void invokeWriteObject(Object obj, ObjectOutputStream out)
1166         throws IOException, UnsupportedOperationException
1167     {
1168         requireInitialized();
1169         if (writeObjectMethod != null) {
1170             try {
1171                 writeObjectMethod.invoke(obj, new Object[]{ out });
1172             } catch (InvocationTargetException ex) {
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1996, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 868             }
 869         }
 870     }
 871 
 872     /**
 873      * Returns ClassNotFoundException (if any) thrown while attempting to
 874      * resolve local class corresponding to this class descriptor.
 875      */
 876     ClassNotFoundException getResolveException() {
 877         return resolveEx;
 878     }
 879 
 880     /**
 881      * Throws InternalError if not initialized.
 882      */
 883     private final void requireInitialized() {
 884         if (!initialized)
 885             throw new InternalError(&quot;Unexpected call when not initialized&quot;);
 886     }
 887 
<span class="line-added"> 888     /**</span>
<span class="line-added"> 889      * Throws InvalidClassException if not initialized.</span>
<span class="line-added"> 890      * To be called in cases where an uninitialized class descriptor indicates</span>
<span class="line-added"> 891      * a problem in the serialization stream.</span>
<span class="line-added"> 892      */</span>
<span class="line-added"> 893     final void checkInitialized() throws InvalidClassException {</span>
<span class="line-added"> 894         if (!initialized) {</span>
<span class="line-added"> 895             throw new InvalidClassException(&quot;Class descriptor should be initialized&quot;);</span>
<span class="line-added"> 896         }</span>
<span class="line-added"> 897     }</span>
<span class="line-added"> 898 </span>
 899     /**
 900      * Throws an InvalidClassException if object instances referencing this
 901      * class descriptor should not be allowed to deserialize.  This method does
 902      * not apply to deserialization of enum constants.
 903      */
 904     void checkDeserialize() throws InvalidClassException {
 905         requireInitialized();
 906         if (deserializeEx != null) {
 907             throw deserializeEx.newInvalidClassException();
 908         }
 909     }
 910 
 911     /**
 912      * Throws an InvalidClassException if objects whose class is represented by
 913      * this descriptor should not be allowed to serialize.  This method does
 914      * not apply to serialization of enum constants.
 915      */
 916     void checkSerialize() throws InvalidClassException {
 917         requireInitialized();
 918         if (serializeEx != null) {
</pre>
<hr />
<pre>
1144                     }; // Can&#39;t use PrivilegedExceptionAction with jsa
1145                     try {
1146                         return jsa.doIntersectionPrivilege(pea,
1147                                    AccessController.getContext(),
1148                                    new AccessControlContext(domains));
1149                     } catch (UndeclaredThrowableException x) {
1150                         Throwable cause = x.getCause();
1151                         if (cause instanceof InstantiationException)
1152                             throw (InstantiationException) cause;
1153                         if (cause instanceof InvocationTargetException)
1154                             throw (InvocationTargetException) cause;
1155                         if (cause instanceof IllegalAccessException)
1156                             throw (IllegalAccessException) cause;
1157                         // not supposed to happen
1158                         throw x;
1159                     }
1160                 }
1161             } catch (IllegalAccessException ex) {
1162                 // should not occur, as access checks have been suppressed
1163                 throw new InternalError(ex);
<span class="line-added">1164             } catch (InstantiationError err) {</span>
<span class="line-added">1165                 var ex = new InstantiationException();</span>
<span class="line-added">1166                 ex.initCause(err);</span>
<span class="line-added">1167                 throw ex;</span>
1168             }
1169         } else {
1170             throw new UnsupportedOperationException();
1171         }
1172     }
1173 
1174     /**
1175      * Invokes the writeObject method of the represented serializable class.
1176      * Throws UnsupportedOperationException if this class descriptor is not
1177      * associated with a class, or if the class is externalizable,
1178      * non-serializable or does not define writeObject.
1179      */
1180     void invokeWriteObject(Object obj, ObjectOutputStream out)
1181         throws IOException, UnsupportedOperationException
1182     {
1183         requireInitialized();
1184         if (writeObjectMethod != null) {
1185             try {
1186                 writeObjectMethod.invoke(obj, new Object[]{ out });
1187             } catch (InvocationTargetException ex) {
</pre>
</td>
</tr>
</table>
<center><a href="ObjectInputStream.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../lang/ProcessBuilder.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>