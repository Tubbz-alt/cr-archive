<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/ssl/SSLConfiguration.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="SSLAlgorithmConstraints.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SSLContextImpl.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/ssl/SSLConfiguration.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 34 import java.util.Collection;
 35 import java.util.Collections;
 36 import java.util.HashMap;
 37 import java.util.List;
 38 import java.util.function.BiFunction;
 39 import javax.crypto.KeyGenerator;
 40 import javax.net.ssl.HandshakeCompletedListener;
 41 import javax.net.ssl.SNIMatcher;
 42 import javax.net.ssl.SNIServerName;
 43 import javax.net.ssl.SSLEngine;
 44 import javax.net.ssl.SSLParameters;
 45 import javax.net.ssl.SSLSocket;
 46 import sun.security.ssl.SSLExtension.ClientExtensions;
 47 import sun.security.ssl.SSLExtension.ServerExtensions;
 48 
 49 /**
 50  * SSL/(D)TLS configuration.
 51  */
 52 final class SSLConfiguration implements Cloneable {
 53     // configurations with SSLParameters
<span class="line-modified"> 54     AlgorithmConstraints        algorithmConstraints;</span>
 55     List&lt;ProtocolVersion&gt;       enabledProtocols;
 56     List&lt;CipherSuite&gt;           enabledCipherSuites;
 57     ClientAuthType              clientAuthType;
 58     String                      identificationProtocol;
 59     List&lt;SNIServerName&gt;         serverNames;
 60     Collection&lt;SNIMatcher&gt;      sniMatchers;
 61     String[]                    applicationProtocols;
 62     boolean                     preferLocalCipherSuites;
 63     boolean                     enableRetransmissions;
 64     int                         maximumPacketSize;
 65 
 66     // the maximum protocol version of enabled protocols
 67     ProtocolVersion             maximumProtocolVersion;
 68 
 69     // Configurations per SSLSocket or SSLEngine instance.
 70     boolean                     isClientMode;
 71     boolean                     enableSessionCreation;
 72 
 73     // the application layer protocol negotiation configuration
 74     BiFunction&lt;SSLSocket, List&lt;String&gt;, String&gt; socketAPSelector;
</pre>
<hr />
<pre>
 99     static final boolean acknowledgeCloseNotify  = Utilities.getBooleanProperty(
100             &quot;jdk.tls.acknowledgeCloseNotify&quot;, false);
101 
102     // Is the extended_master_secret extension supported?
103     static {
104         boolean supportExtendedMasterSecret = Utilities.getBooleanProperty(
105                     &quot;jdk.tls.useExtendedMasterSecret&quot;, true);
106         if (supportExtendedMasterSecret) {
107             try {
108                 KeyGenerator.getInstance(&quot;SunTlsExtendedMasterSecret&quot;);
109             } catch (NoSuchAlgorithmException nae) {
110                 supportExtendedMasterSecret = false;
111             }
112         }
113         useExtendedMasterSecret = supportExtendedMasterSecret;
114     }
115 
116     SSLConfiguration(SSLContextImpl sslContext, boolean isClientMode) {
117 
118         // Configurations with SSLParameters, default values.
<span class="line-modified">119         this.algorithmConstraints = SSLAlgorithmConstraints.DEFAULT;</span>

120         this.enabledProtocols =
121                 sslContext.getDefaultProtocolVersions(!isClientMode);
122         this.enabledCipherSuites =
123                 sslContext.getDefaultCipherSuites(!isClientMode);
124         this.clientAuthType = ClientAuthType.CLIENT_AUTH_NONE;
125 
126         this.identificationProtocol = null;
127         this.serverNames = Collections.&lt;SNIServerName&gt;emptyList();
128         this.sniMatchers = Collections.&lt;SNIMatcher&gt;emptyList();
129         this.preferLocalCipherSuites = true;
130 
131         this.applicationProtocols = new String[0];
132         this.enableRetransmissions = sslContext.isDTLS();
133         this.maximumPacketSize = 0;         // please reset it explicitly later
134 
135         this.maximumProtocolVersion = ProtocolVersion.NONE;
136         for (ProtocolVersion pv : enabledProtocols) {
137             if (pv.compareTo(maximumProtocolVersion) &gt; 0) {
138                 this.maximumProtocolVersion = pv;
139             }
140         }
141 
142         // Configurations per SSLSocket or SSLEngine instance.
143         this.isClientMode = isClientMode;
144         this.enableSessionCreation = true;
145         this.socketAPSelector = null;
146         this.engineAPSelector = null;
147 
148         this.handshakeListeners = null;
149         this.noSniExtension = false;
150         this.noSniMatcher = false;
151     }
152 
153     SSLParameters getSSLParameters() {
154         SSLParameters params = new SSLParameters();
155 
<span class="line-modified">156         params.setAlgorithmConstraints(this.algorithmConstraints);</span>
157         params.setProtocols(ProtocolVersion.toStringArray(enabledProtocols));
158         params.setCipherSuites(CipherSuite.namesOf(enabledCipherSuites));
159         switch (this.clientAuthType) {
160             case CLIENT_AUTH_REQUIRED:
161                 params.setNeedClientAuth(true);
162                 break;
163             case CLIENT_AUTH_REQUESTED:
164                 params.setWantClientAuth(true);
165                 break;
166             default:
167                 params.setWantClientAuth(false);
168         }
169         params.setEndpointIdentificationAlgorithm(this.identificationProtocol);
170 
171         if (serverNames.isEmpty() &amp;&amp; !noSniExtension) {
172             // &#39;null&#39; indicates none has been set
173             params.setServerNames(null);
174         } else {
175             params.setServerNames(this.serverNames);
176         }
177 
178         if (sniMatchers.isEmpty() &amp;&amp; !noSniMatcher) {
179             // &#39;null&#39; indicates none has been set
180             params.setSNIMatchers(null);
181         } else {
182             params.setSNIMatchers(this.sniMatchers);
183         }
184 
185         params.setApplicationProtocols(this.applicationProtocols);
186         params.setUseCipherSuitesOrder(this.preferLocalCipherSuites);
187         params.setEnableRetransmissions(this.enableRetransmissions);
188         params.setMaximumPacketSize(this.maximumPacketSize);
189 
190         return params;
191     }
192 
193     void setSSLParameters(SSLParameters params) {
194         AlgorithmConstraints ac = params.getAlgorithmConstraints();
195         if (ac != null) {
<span class="line-modified">196             this.algorithmConstraints = ac;</span>
197         }   // otherwise, use the default value
198 
199         String[] sa = params.getCipherSuites();
200         if (sa != null) {
201             this.enabledCipherSuites = CipherSuite.validValuesOf(sa);
202         }   // otherwise, use the default values
203 
204         sa = params.getProtocols();
205         if (sa != null) {
206             this.enabledProtocols = ProtocolVersion.namesOf(sa);
207 
208             this.maximumProtocolVersion = ProtocolVersion.NONE;
209             for (ProtocolVersion pv : enabledProtocols) {
210                 if (pv.compareTo(maximumProtocolVersion) &gt; 0) {
211                     this.maximumProtocolVersion = pv;
212                 }
213             }
214         }   // otherwise, use the default values
215 
216         if (params.getNeedClientAuth()) {
</pre>
</td>
<td>
<hr />
<pre>
 34 import java.util.Collection;
 35 import java.util.Collections;
 36 import java.util.HashMap;
 37 import java.util.List;
 38 import java.util.function.BiFunction;
 39 import javax.crypto.KeyGenerator;
 40 import javax.net.ssl.HandshakeCompletedListener;
 41 import javax.net.ssl.SNIMatcher;
 42 import javax.net.ssl.SNIServerName;
 43 import javax.net.ssl.SSLEngine;
 44 import javax.net.ssl.SSLParameters;
 45 import javax.net.ssl.SSLSocket;
 46 import sun.security.ssl.SSLExtension.ClientExtensions;
 47 import sun.security.ssl.SSLExtension.ServerExtensions;
 48 
 49 /**
 50  * SSL/(D)TLS configuration.
 51  */
 52 final class SSLConfiguration implements Cloneable {
 53     // configurations with SSLParameters
<span class="line-modified"> 54     AlgorithmConstraints        userSpecifiedAlgorithmConstraints;</span>
 55     List&lt;ProtocolVersion&gt;       enabledProtocols;
 56     List&lt;CipherSuite&gt;           enabledCipherSuites;
 57     ClientAuthType              clientAuthType;
 58     String                      identificationProtocol;
 59     List&lt;SNIServerName&gt;         serverNames;
 60     Collection&lt;SNIMatcher&gt;      sniMatchers;
 61     String[]                    applicationProtocols;
 62     boolean                     preferLocalCipherSuites;
 63     boolean                     enableRetransmissions;
 64     int                         maximumPacketSize;
 65 
 66     // the maximum protocol version of enabled protocols
 67     ProtocolVersion             maximumProtocolVersion;
 68 
 69     // Configurations per SSLSocket or SSLEngine instance.
 70     boolean                     isClientMode;
 71     boolean                     enableSessionCreation;
 72 
 73     // the application layer protocol negotiation configuration
 74     BiFunction&lt;SSLSocket, List&lt;String&gt;, String&gt; socketAPSelector;
</pre>
<hr />
<pre>
 99     static final boolean acknowledgeCloseNotify  = Utilities.getBooleanProperty(
100             &quot;jdk.tls.acknowledgeCloseNotify&quot;, false);
101 
102     // Is the extended_master_secret extension supported?
103     static {
104         boolean supportExtendedMasterSecret = Utilities.getBooleanProperty(
105                     &quot;jdk.tls.useExtendedMasterSecret&quot;, true);
106         if (supportExtendedMasterSecret) {
107             try {
108                 KeyGenerator.getInstance(&quot;SunTlsExtendedMasterSecret&quot;);
109             } catch (NoSuchAlgorithmException nae) {
110                 supportExtendedMasterSecret = false;
111             }
112         }
113         useExtendedMasterSecret = supportExtendedMasterSecret;
114     }
115 
116     SSLConfiguration(SSLContextImpl sslContext, boolean isClientMode) {
117 
118         // Configurations with SSLParameters, default values.
<span class="line-modified">119         this.userSpecifiedAlgorithmConstraints =</span>
<span class="line-added">120                 SSLAlgorithmConstraints.DEFAULT;</span>
121         this.enabledProtocols =
122                 sslContext.getDefaultProtocolVersions(!isClientMode);
123         this.enabledCipherSuites =
124                 sslContext.getDefaultCipherSuites(!isClientMode);
125         this.clientAuthType = ClientAuthType.CLIENT_AUTH_NONE;
126 
127         this.identificationProtocol = null;
128         this.serverNames = Collections.&lt;SNIServerName&gt;emptyList();
129         this.sniMatchers = Collections.&lt;SNIMatcher&gt;emptyList();
130         this.preferLocalCipherSuites = true;
131 
132         this.applicationProtocols = new String[0];
133         this.enableRetransmissions = sslContext.isDTLS();
134         this.maximumPacketSize = 0;         // please reset it explicitly later
135 
136         this.maximumProtocolVersion = ProtocolVersion.NONE;
137         for (ProtocolVersion pv : enabledProtocols) {
138             if (pv.compareTo(maximumProtocolVersion) &gt; 0) {
139                 this.maximumProtocolVersion = pv;
140             }
141         }
142 
143         // Configurations per SSLSocket or SSLEngine instance.
144         this.isClientMode = isClientMode;
145         this.enableSessionCreation = true;
146         this.socketAPSelector = null;
147         this.engineAPSelector = null;
148 
149         this.handshakeListeners = null;
150         this.noSniExtension = false;
151         this.noSniMatcher = false;
152     }
153 
154     SSLParameters getSSLParameters() {
155         SSLParameters params = new SSLParameters();
156 
<span class="line-modified">157         params.setAlgorithmConstraints(this.userSpecifiedAlgorithmConstraints);</span>
158         params.setProtocols(ProtocolVersion.toStringArray(enabledProtocols));
159         params.setCipherSuites(CipherSuite.namesOf(enabledCipherSuites));
160         switch (this.clientAuthType) {
161             case CLIENT_AUTH_REQUIRED:
162                 params.setNeedClientAuth(true);
163                 break;
164             case CLIENT_AUTH_REQUESTED:
165                 params.setWantClientAuth(true);
166                 break;
167             default:
168                 params.setWantClientAuth(false);
169         }
170         params.setEndpointIdentificationAlgorithm(this.identificationProtocol);
171 
172         if (serverNames.isEmpty() &amp;&amp; !noSniExtension) {
173             // &#39;null&#39; indicates none has been set
174             params.setServerNames(null);
175         } else {
176             params.setServerNames(this.serverNames);
177         }
178 
179         if (sniMatchers.isEmpty() &amp;&amp; !noSniMatcher) {
180             // &#39;null&#39; indicates none has been set
181             params.setSNIMatchers(null);
182         } else {
183             params.setSNIMatchers(this.sniMatchers);
184         }
185 
186         params.setApplicationProtocols(this.applicationProtocols);
187         params.setUseCipherSuitesOrder(this.preferLocalCipherSuites);
188         params.setEnableRetransmissions(this.enableRetransmissions);
189         params.setMaximumPacketSize(this.maximumPacketSize);
190 
191         return params;
192     }
193 
194     void setSSLParameters(SSLParameters params) {
195         AlgorithmConstraints ac = params.getAlgorithmConstraints();
196         if (ac != null) {
<span class="line-modified">197             this.userSpecifiedAlgorithmConstraints = ac;</span>
198         }   // otherwise, use the default value
199 
200         String[] sa = params.getCipherSuites();
201         if (sa != null) {
202             this.enabledCipherSuites = CipherSuite.validValuesOf(sa);
203         }   // otherwise, use the default values
204 
205         sa = params.getProtocols();
206         if (sa != null) {
207             this.enabledProtocols = ProtocolVersion.namesOf(sa);
208 
209             this.maximumProtocolVersion = ProtocolVersion.NONE;
210             for (ProtocolVersion pv : enabledProtocols) {
211                 if (pv.compareTo(maximumProtocolVersion) &gt; 0) {
212                     this.maximumProtocolVersion = pv;
213                 }
214             }
215         }   // otherwise, use the default values
216 
217         if (params.getNeedClientAuth()) {
</pre>
</td>
</tr>
</table>
<center><a href="SSLAlgorithmConstraints.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SSLContextImpl.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>