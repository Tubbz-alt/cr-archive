<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/ssl/Alert.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../provider/certpath/URICertStore.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ClientHello.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/ssl/Alert.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
248                     tc.closeOutbound();
249                 } else if (tc.handshakeContext != null) {
250                     throw tc.fatal(Alert.UNEXPECTED_MESSAGE,
251                             &quot;Received close_notify during handshake&quot;);
252                 }
253             } else if (alert == Alert.USER_CANCELED) {
254                 if (level == Level.WARNING) {
255                     tc.peerUserCanceled = true;
256                 } else {
257                     throw tc.fatal(alert,
258                             &quot;Received fatal close_notify alert&quot;, true, null);
259                 }
260             } else if ((level == Level.WARNING) &amp;&amp; (alert != null)) {
261                 // Terminate the connection if an alert with a level of warning
262                 // is received during handshaking, except the no_certificate
263                 // warning.
264                 if (alert.handshakeOnly &amp;&amp; (tc.handshakeContext != null)) {
265                     // It&#39;s OK to get a no_certificate alert from a client of
266                     // which we requested client authentication.  However,
267                     // if we required it, then this is not acceptable.
<span class="line-modified">268                      if (tc.sslConfig.isClientMode ||</span>
269                             alert != Alert.NO_CERTIFICATE ||
270                             (tc.sslConfig.clientAuthType !=
271                                     ClientAuthType.CLIENT_AUTH_REQUESTED)) {
272                         throw tc.fatal(Alert.HANDSHAKE_FAILURE,
273                             &quot;received handshake warning: &quot; + alert.description);
274                     } else {
275                         // Otherwise ignore the warning but remove the
<span class="line-modified">276                         // CertificateVerify handshake consumer so the state</span>
<span class="line-modified">277                         // machine doesn&#39;t expect it.</span>


278                         tc.handshakeContext.handshakeConsumers.remove(
279                                 SSLHandshake.CERTIFICATE_VERIFY.id);
280                     }
281                 }  // Otherwise, ignore the warning
282             } else {    // fatal or unknown
283                 String diagnostic;
284                 if (alert == null) {
285                     alert = Alert.UNEXPECTED_MESSAGE;
286                     diagnostic = &quot;Unknown alert description (&quot; + am.id + &quot;)&quot;;
287                 } else {
288                     diagnostic = &quot;Received fatal alert: &quot; + alert.description;
289                 }
290 
291                 throw tc.fatal(alert, diagnostic, true, null);
292             }
293         }
294     }
295 }
</pre>
</td>
<td>
<hr />
<pre>
248                     tc.closeOutbound();
249                 } else if (tc.handshakeContext != null) {
250                     throw tc.fatal(Alert.UNEXPECTED_MESSAGE,
251                             &quot;Received close_notify during handshake&quot;);
252                 }
253             } else if (alert == Alert.USER_CANCELED) {
254                 if (level == Level.WARNING) {
255                     tc.peerUserCanceled = true;
256                 } else {
257                     throw tc.fatal(alert,
258                             &quot;Received fatal close_notify alert&quot;, true, null);
259                 }
260             } else if ((level == Level.WARNING) &amp;&amp; (alert != null)) {
261                 // Terminate the connection if an alert with a level of warning
262                 // is received during handshaking, except the no_certificate
263                 // warning.
264                 if (alert.handshakeOnly &amp;&amp; (tc.handshakeContext != null)) {
265                     // It&#39;s OK to get a no_certificate alert from a client of
266                     // which we requested client authentication.  However,
267                     // if we required it, then this is not acceptable.
<span class="line-modified">268                     if (tc.sslConfig.isClientMode ||</span>
269                             alert != Alert.NO_CERTIFICATE ||
270                             (tc.sslConfig.clientAuthType !=
271                                     ClientAuthType.CLIENT_AUTH_REQUESTED)) {
272                         throw tc.fatal(Alert.HANDSHAKE_FAILURE,
273                             &quot;received handshake warning: &quot; + alert.description);
274                     } else {
275                         // Otherwise ignore the warning but remove the
<span class="line-modified">276                         // Certificate and CertificateVerify handshake</span>
<span class="line-modified">277                         // consumer so the state machine doesn&#39;t expect it.</span>
<span class="line-added">278                         tc.handshakeContext.handshakeConsumers.remove(</span>
<span class="line-added">279                                 SSLHandshake.CERTIFICATE.id);</span>
280                         tc.handshakeContext.handshakeConsumers.remove(
281                                 SSLHandshake.CERTIFICATE_VERIFY.id);
282                     }
283                 }  // Otherwise, ignore the warning
284             } else {    // fatal or unknown
285                 String diagnostic;
286                 if (alert == null) {
287                     alert = Alert.UNEXPECTED_MESSAGE;
288                     diagnostic = &quot;Unknown alert description (&quot; + am.id + &quot;)&quot;;
289                 } else {
290                     diagnostic = &quot;Received fatal alert: &quot; + alert.description;
291                 }
292 
293                 throw tc.fatal(alert, diagnostic, true, null);
294             }
295         }
296     }
297 }
</pre>
</td>
</tr>
</table>
<center><a href="../provider/certpath/URICertStore.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ClientHello.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>