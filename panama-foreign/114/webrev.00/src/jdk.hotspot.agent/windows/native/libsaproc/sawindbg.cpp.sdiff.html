<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.hotspot.agent/windows/native/libsaproc/sawindbg.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../../share/classes/sun/jvm/hotspot/utilities/soql/MapScriptObject.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../jdk.httpserver/share/classes/com/sun/net/httpserver/Headers.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/windows/native/libsaproc/sawindbg.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
711 
712 
713 /*
714  * Class:     sun_jvm_hotspot_debugger_windbg_WindbgDebuggerLocal
715  * Method:    readBytesFromProcess0
716  * Signature: (JJ)[B
717  */
718 JNIEXPORT jbyteArray JNICALL Java_sun_jvm_hotspot_debugger_windbg_WindbgDebuggerLocal_readBytesFromProcess0
719     (JNIEnv *env, jobject obj, jlong address, jlong numBytes) {
720   jbyteArray byteArray = env-&gt;NewByteArray((jsize)numBytes);
721   CHECK_EXCEPTION_(0);
722 
723   AutoJavaByteArray arrayBytes(env, byteArray);
724   CHECK_EXCEPTION_(0);
725 
726   IDebugDataSpaces* ptrIDebugDataSpaces = (IDebugDataSpaces*) env-&gt;GetLongField(obj,
727                                                        ptrIDebugDataSpaces_ID);
728   CHECK_EXCEPTION_(0);
729 
730   ULONG bytesRead;
<span class="line-modified">731   COM_VERIFY_OK_(ptrIDebugDataSpaces-&gt;ReadVirtual((ULONG64)address, arrayBytes,</span>
<span class="line-modified">732                                                   (ULONG)numBytes, &amp;bytesRead),</span>
<span class="line-modified">733                  &quot;Windbg Error: ReadVirtual failed!&quot;, 0);</span>
<span class="line-removed">734 </span>
<span class="line-removed">735   if (bytesRead != numBytes) {</span>
736      return 0;
737   }
738 
739   arrayBytes.setReleaseMode(0);
740 
741   return byteArray;
742 }
743 
744 /*
745  * Class:     sun_jvm_hotspot_debugger_windbg_WindbgDebuggerLocal
746  * Method:    getThreadIdFromSysId0
747  * Signature: (J)J
748  */
749 JNIEXPORT jlong JNICALL Java_sun_jvm_hotspot_debugger_windbg_WindbgDebuggerLocal_getThreadIdFromSysId0
750     (JNIEnv *env, jobject obj, jlong sysId) {
751   IDebugSystemObjects* ptrIDebugSystemObjects = (IDebugSystemObjects*) env-&gt;GetLongField(obj,
752                                                     ptrIDebugSystemObjects_ID);
753   CHECK_EXCEPTION_(0);
754 
755   ULONG id = 0;
</pre>
</td>
<td>
<hr />
<pre>
711 
712 
713 /*
714  * Class:     sun_jvm_hotspot_debugger_windbg_WindbgDebuggerLocal
715  * Method:    readBytesFromProcess0
716  * Signature: (JJ)[B
717  */
718 JNIEXPORT jbyteArray JNICALL Java_sun_jvm_hotspot_debugger_windbg_WindbgDebuggerLocal_readBytesFromProcess0
719     (JNIEnv *env, jobject obj, jlong address, jlong numBytes) {
720   jbyteArray byteArray = env-&gt;NewByteArray((jsize)numBytes);
721   CHECK_EXCEPTION_(0);
722 
723   AutoJavaByteArray arrayBytes(env, byteArray);
724   CHECK_EXCEPTION_(0);
725 
726   IDebugDataSpaces* ptrIDebugDataSpaces = (IDebugDataSpaces*) env-&gt;GetLongField(obj,
727                                                        ptrIDebugDataSpaces_ID);
728   CHECK_EXCEPTION_(0);
729 
730   ULONG bytesRead;
<span class="line-modified">731   const HRESULT hr = ptrIDebugDataSpaces-&gt;ReadVirtual((ULONG64)address, arrayBytes,</span>
<span class="line-modified">732                                                       (ULONG)numBytes, &amp;bytesRead);</span>
<span class="line-modified">733   if (hr != S_OK || bytesRead != numBytes) {</span>


734      return 0;
735   }
736 
737   arrayBytes.setReleaseMode(0);
738 
739   return byteArray;
740 }
741 
742 /*
743  * Class:     sun_jvm_hotspot_debugger_windbg_WindbgDebuggerLocal
744  * Method:    getThreadIdFromSysId0
745  * Signature: (J)J
746  */
747 JNIEXPORT jlong JNICALL Java_sun_jvm_hotspot_debugger_windbg_WindbgDebuggerLocal_getThreadIdFromSysId0
748     (JNIEnv *env, jobject obj, jlong sysId) {
749   IDebugSystemObjects* ptrIDebugSystemObjects = (IDebugSystemObjects*) env-&gt;GetLongField(obj,
750                                                     ptrIDebugSystemObjects_ID);
751   CHECK_EXCEPTION_(0);
752 
753   ULONG id = 0;
</pre>
</td>
</tr>
</table>
<center><a href="../../../share/classes/sun/jvm/hotspot/utilities/soql/MapScriptObject.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../jdk.httpserver/share/classes/com/sun/net/httpserver/Headers.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>