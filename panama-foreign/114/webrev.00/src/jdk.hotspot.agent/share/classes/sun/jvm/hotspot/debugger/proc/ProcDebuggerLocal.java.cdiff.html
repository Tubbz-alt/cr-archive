<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/debugger/proc/ProcDebuggerLocal.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ProcDebugger.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../remote/RemoteDebuggerClient.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/debugger/proc/ProcDebuggerLocal.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2014, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2014, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 132,30 ***</span>
       * parsing of its output */
      public boolean hasProcessList() throws DebuggerException {
          return false;
      }
  
<span class="line-modified">!     public List getProcessList() throws DebuggerException {</span>
          throw new DebuggerException(&quot;Not yet supported&quot;);
      }
  
  
      /** From the Debugger interface via JVMDebugger */
      public synchronized void attach(int processID) throws DebuggerException {
          checkAttached();
          isCore = false;
<span class="line-modified">!         attach0(new Integer(processID).toString());</span>
          attached = true;
          suspended = true;
      }
  
      /** From the Debugger interface via JVMDebugger */
      public synchronized void attach
      (String executableName, String coreFileName) throws DebuggerException {
          checkAttached();
          isCore = true;
<span class="line-modified">!         topFrameCache = new HashMap();</span>
          attach0(executableName, coreFileName);
          attached = true;
          suspended = true;
      }
  
<span class="line-new-header">--- 132,30 ---</span>
       * parsing of its output */
      public boolean hasProcessList() throws DebuggerException {
          return false;
      }
  
<span class="line-modified">!     public List&lt;ProcessInfo&gt; getProcessList() throws DebuggerException {</span>
          throw new DebuggerException(&quot;Not yet supported&quot;);
      }
  
  
      /** From the Debugger interface via JVMDebugger */
      public synchronized void attach(int processID) throws DebuggerException {
          checkAttached();
          isCore = false;
<span class="line-modified">!         attach0(Integer.toString(processID));</span>
          attached = true;
          suspended = true;
      }
  
      /** From the Debugger interface via JVMDebugger */
      public synchronized void attach
      (String executableName, String coreFileName) throws DebuggerException {
          checkAttached();
          isCore = true;
<span class="line-modified">!         topFrameCache = new HashMap&lt;&gt;();</span>
          attach0(executableName, coreFileName);
          attached = true;
          suspended = true;
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 437,27 ***</span>
          if (value == 0) return null;
          return new ProcAddress(this, value);
      }
  
      /** From the ProcDebugger interface */
<span class="line-modified">!     public synchronized List getThreadList() throws DebuggerException {</span>
          requireAttach();
<span class="line-modified">!         List res = null;</span>
          if (isCore &amp;&amp; (threadListCache != null)) {
              res = threadListCache;
          } else {
<span class="line-modified">!             res = new ArrayList();</span>
              fillThreadList0(res);
              if (isCore) {
                  threadListCache = res;
              }
          }
          return res;
      }
  
      /** From the ProcDebugger interface */
<span class="line-modified">!     public synchronized List getLoadObjectList() throws DebuggerException {</span>
          requireAttach();
          if (!suspended) {
              throw new DebuggerException(&quot;Process not suspended&quot;);
          }
  
<span class="line-new-header">--- 437,27 ---</span>
          if (value == 0) return null;
          return new ProcAddress(this, value);
      }
  
      /** From the ProcDebugger interface */
<span class="line-modified">!     public synchronized List&lt;ThreadProxy&gt; getThreadList() throws DebuggerException {</span>
          requireAttach();
<span class="line-modified">!         List&lt;ThreadProxy&gt; res = null;</span>
          if (isCore &amp;&amp; (threadListCache != null)) {
              res = threadListCache;
          } else {
<span class="line-modified">!             res = new ArrayList&lt;&gt;();</span>
              fillThreadList0(res);
              if (isCore) {
                  threadListCache = res;
              }
          }
          return res;
      }
  
      /** From the ProcDebugger interface */
<span class="line-modified">!     public synchronized List&lt;LoadObject&gt; getLoadObjectList() throws DebuggerException {</span>
          requireAttach();
          if (!suspended) {
              throw new DebuggerException(&quot;Process not suspended&quot;);
          }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 503,20 ***</span>
      //------------- Internals only below this point --------------------
      //
      //
  
      private void updateLoadObjectCache() {
<span class="line-modified">!         List res = new ArrayList();</span>
<span class="line-modified">!         nameToDsoMap = new HashMap();</span>
          fillLoadObjectList0(res);
          loadObjectCache = sortLoadObjects(res);
      }
  
      // sort load objects by base address
<span class="line-modified">!     private static List sortLoadObjects(List in) {</span>
          // sort the list by base address
<span class="line-modified">!         Object[] arr = in.toArray();</span>
          Arrays.sort(arr, loadObjectComparator);
          return Arrays.asList(arr);
      }
  
      private long lookupByName(String objectName, String symbolName)
<span class="line-new-header">--- 503,20 ---</span>
      //------------- Internals only below this point --------------------
      //
      //
  
      private void updateLoadObjectCache() {
<span class="line-modified">!         List&lt;LoadObject&gt; res = new ArrayList&lt;&gt;();</span>
<span class="line-modified">!         nameToDsoMap = new HashMap&lt;&gt;();</span>
          fillLoadObjectList0(res);
          loadObjectCache = sortLoadObjects(res);
      }
  
      // sort load objects by base address
<span class="line-modified">!     private static List&lt;LoadObject&gt; sortLoadObjects(List&lt;LoadObject&gt; in) {</span>
          // sort the list by base address
<span class="line-modified">!         LoadObject[] arr = in.toArray(new LoadObject[0]);</span>
          Arrays.sort(arr, loadObjectComparator);
          return Arrays.asList(arr);
      }
  
      private long lookupByName(String objectName, String symbolName)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 612,11 ***</span>
      private native int getRemoteProcessAddressSize0() throws DebuggerException;
      private native int getPageSize0() throws DebuggerException;
  
      // threads, stacks
      private native long[] getThreadIntegerRegisterSet0(long tid) throws DebuggerException;
<span class="line-modified">!     private native void   fillThreadList0(List l) throws DebuggerException;</span>
  
      // fills stack frame list given reg set of the top frame and top frame
      private native ProcCFrame fillCFrameList0(long[] regs) throws DebuggerException;
  
      // helper called by fillCFrameList0
<span class="line-new-header">--- 612,11 ---</span>
      private native int getRemoteProcessAddressSize0() throws DebuggerException;
      private native int getPageSize0() throws DebuggerException;
  
      // threads, stacks
      private native long[] getThreadIntegerRegisterSet0(long tid) throws DebuggerException;
<span class="line-modified">!     private native void   fillThreadList0(List&lt;ThreadProxy&gt; l) throws DebuggerException;</span>
  
      // fills stack frame list given reg set of the top frame and top frame
      private native ProcCFrame fillCFrameList0(long[] regs) throws DebuggerException;
  
      // helper called by fillCFrameList0
</pre>
<hr />
<pre>
<span class="line-old-header">*** 627,11 ***</span>
          }
          return sender;
      }
  
      // shared objects
<span class="line-modified">!     private native void fillLoadObjectList0(List l) throws DebuggerException;</span>
  
      // helper called by fillLoadObjectList0
      private LoadObject createLoadObject(String fileName, long textsize, long base) {
          File f = new File(fileName);
          Address baseAddr = newAddress(base);
<span class="line-new-header">--- 627,11 ---</span>
          }
          return sender;
      }
  
      // shared objects
<span class="line-modified">!     private native void fillLoadObjectList0(List&lt;LoadObject&gt; l) throws DebuggerException;</span>
  
      // helper called by fillLoadObjectList0
      private LoadObject createLoadObject(String fileName, long textsize, long base) {
          File f = new File(fileName);
          Address baseAddr = newAddress(base);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 687,14 ***</span>
      private int pcRegIndex;
      private int fpRegIndex;
  
      // Symbol lookup support
      // This is a map of library names to DSOs
<span class="line-modified">!     private Map nameToDsoMap;  // Map&lt;String, SharedObject&gt;</span>
  
      // C/C++ debugging support
<span class="line-modified">!     private List/*&lt;LoadObject&gt;*/ loadObjects;</span>
      private CDebugger cdbg;
  
      // ProcessControl support
      private boolean suspended;
  
<span class="line-new-header">--- 687,14 ---</span>
      private int pcRegIndex;
      private int fpRegIndex;
  
      // Symbol lookup support
      // This is a map of library names to DSOs
<span class="line-modified">!     private Map&lt;String, SharedObject&gt; nameToDsoMap;</span>
  
      // C/C++ debugging support
<span class="line-modified">!     private List&lt;LoadObject&gt; loadObjects;</span>
      private CDebugger cdbg;
  
      // ProcessControl support
      private boolean suspended;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 720,9 ***</span>
      private boolean attached = false;
      private boolean isCore;
  
      // for core files, we cache load object list, thread list, top frames etc.
      // for processes we cache load object list and sync. it during suspend.
<span class="line-modified">!     private List threadListCache;</span>
<span class="line-modified">!     private List loadObjectCache;</span>
<span class="line-modified">!     private Map  topFrameCache;      // Map&lt;ThreadProxy, CFrame&gt;</span>
  }
<span class="line-new-header">--- 720,9 ---</span>
      private boolean attached = false;
      private boolean isCore;
  
      // for core files, we cache load object list, thread list, top frames etc.
      // for processes we cache load object list and sync. it during suspend.
<span class="line-modified">!     private List&lt;ThreadProxy&gt; threadListCache;</span>
<span class="line-modified">!     private List&lt;LoadObject&gt; loadObjectCache;</span>
<span class="line-modified">!     private Map&lt;ThreadProxy, CFrame&gt; topFrameCache;</span>
  }
</pre>
<center><a href="ProcDebugger.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../remote/RemoteDebuggerClient.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>