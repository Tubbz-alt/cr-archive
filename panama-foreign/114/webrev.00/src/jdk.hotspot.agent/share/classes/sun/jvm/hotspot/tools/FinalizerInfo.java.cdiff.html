<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/tools/FinalizerInfo.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ClassLoaderStats.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="HeapSummary.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/tools/FinalizerInfo.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2004, 2013, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2004, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 104,33 ***</span>
              OopField referentField =
                  (OopField) k.findField(&quot;referent&quot;, &quot;Ljava/lang/Object;&quot;);
              OopField nextField =
                  (OopField) k.findField(&quot;next&quot;, &quot;Ljava/lang/ref/Reference;&quot;);
  
<span class="line-modified">!             HashMap map = new HashMap();</span>
              for (;;) {
                  Oop referent = referentField.getValue(head);
  
                  Klass klass = referent.getKlass();
                  if (!map.containsKey(klass)) {
                      map.put(klass, new ObjectHistogramElement(klass));
                  }
<span class="line-modified">!                 ((ObjectHistogramElement)map.get(klass)).updateWith(referent);</span>
  
                  Oop next = nextField.getValue(head);
                  if (next == null || next.equals(head)) break;
                  head = next;
              }
  
              /*
               * Sort results - decending order by total size
               */
<span class="line-modified">!             ArrayList list = new ArrayList();</span>
              list.addAll(map.values());
<span class="line-modified">!             Collections.sort(list, new Comparator() {</span>
<span class="line-modified">!               public int compare(Object o1, Object o2) {</span>
<span class="line-modified">!                   return ((ObjectHistogramElement)o1).compare((ObjectHistogramElement)o2);</span>
                }
              });
  
              /*
               * Print summary of objects in queue
<span class="line-new-header">--- 104,33 ---</span>
              OopField referentField =
                  (OopField) k.findField(&quot;referent&quot;, &quot;Ljava/lang/Object;&quot;);
              OopField nextField =
                  (OopField) k.findField(&quot;next&quot;, &quot;Ljava/lang/ref/Reference;&quot;);
  
<span class="line-modified">!             HashMap&lt;Klass, ObjectHistogramElement&gt; map = new HashMap&lt;&gt;();</span>
              for (;;) {
                  Oop referent = referentField.getValue(head);
  
                  Klass klass = referent.getKlass();
                  if (!map.containsKey(klass)) {
                      map.put(klass, new ObjectHistogramElement(klass));
                  }
<span class="line-modified">!                 map.get(klass).updateWith(referent);</span>
  
                  Oop next = nextField.getValue(head);
                  if (next == null || next.equals(head)) break;
                  head = next;
              }
  
              /*
               * Sort results - decending order by total size
               */
<span class="line-modified">!             ArrayList&lt;ObjectHistogramElement&gt; list = new ArrayList&lt;&gt;();</span>
              list.addAll(map.values());
<span class="line-modified">!             Collections.sort(list, new Comparator&lt;&gt;() {</span>
<span class="line-modified">!               public int compare(ObjectHistogramElement o1, ObjectHistogramElement o2) {</span>
<span class="line-modified">!                   return o1.compare(o2);</span>
                }
              });
  
              /*
               * Print summary of objects in queue
</pre>
<center><a href="ClassLoaderStats.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="HeapSummary.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>