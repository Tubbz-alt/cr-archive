<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/debugger/win32/coff/COFFFileParser.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../remote/RemoteDebuggerClient.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../windbg/WindbgCDebugInfoBuilder.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/debugger/win32/coff/COFFFileParser.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2000, 2010, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1425,18 ***</span>
              this.size   = ssSize;
              seek(offset);
              names = new MemoizedObject() {
                  public Object computeValue() {
                    int i = 0;
<span class="line-modified">!                   List data = new ArrayList();</span>
                    while (i &lt; size) {
                      String s = readCString();
                      data.add(s);
                      i += s.length();
                    }
                    String[] res = new String[data.size()];
<span class="line-modified">!                   res = (String[]) data.toArray(res);</span>
                    return res;
                  }
                };
            }
  
<span class="line-new-header">--- 1425,18 ---</span>
              this.size   = ssSize;
              seek(offset);
              names = new MemoizedObject() {
                  public Object computeValue() {
                    int i = 0;
<span class="line-modified">!                   List&lt;String&gt; data = new ArrayList&lt;&gt;();</span>
                    while (i &lt; size) {
                      String s = readCString();
                      data.add(s);
                      i += s.length();
                    }
                    String[] res = new String[data.size()];
<span class="line-modified">!                   res = data.toArray(res);</span>
                    return res;
                  }
                };
            }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3773,14 ***</span>
          }
  
          /** This version takes an absolute offset in the file */
          String getAtOffset(int offset) {
            int i = Arrays.binarySearch(strings, new COFFString(null, offset),
<span class="line-modified">!                                       new Comparator() {</span>
<span class="line-modified">!                                           public int compare(Object o1, Object o2) {</span>
<span class="line-removed">-                                             COFFString s1 = (COFFString) o1;</span>
<span class="line-removed">-                                             COFFString s2 = (COFFString) o2;</span>
                                              if (s1.offset == s2.offset) {
                                                return 0;
                                              } else if (s1.offset &lt; s2.offset) {
                                                return -1;
                                              } else {
<span class="line-new-header">--- 3773,12 ---</span>
          }
  
          /** This version takes an absolute offset in the file */
          String getAtOffset(int offset) {
            int i = Arrays.binarySearch(strings, new COFFString(null, offset),
<span class="line-modified">!                                       new Comparator&lt;&gt;() {</span>
<span class="line-modified">!                                           public int compare(COFFString s1, COFFString s2) {</span>
                                              if (s1.offset == s2.offset) {
                                                return 0;
                                              } else if (s1.offset &lt; s2.offset) {
                                                return -1;
                                              } else {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3903,18 ***</span>
        long l = readLong();
        return Double.longBitsToDouble(l);
      }
  
      String readCString() throws COFFException {
<span class="line-modified">!       List data = new ArrayList();</span>
        byte b = 0;
        while ((b = readByte()) != 0) {
<span class="line-modified">!         data.add(new Byte(b));</span>
        }
        byte[] bytes = new byte[data.size()];
        for (int i = 0; i &lt; data.size(); i++) {
<span class="line-modified">!         bytes[i] = ((Byte) data.get(i)).byteValue();</span>
        }
        try {
          return new String(bytes, US_ASCII);
        } catch (UnsupportedEncodingException e) {
          throw new COFFException(e);
<span class="line-new-header">--- 3901,18 ---</span>
        long l = readLong();
        return Double.longBitsToDouble(l);
      }
  
      String readCString() throws COFFException {
<span class="line-modified">!       List&lt;Byte&gt; data = new ArrayList&lt;&gt;();</span>
        byte b = 0;
        while ((b = readByte()) != 0) {
<span class="line-modified">!         data.add(b);</span>
        }
        byte[] bytes = new byte[data.size()];
        for (int i = 0; i &lt; data.size(); i++) {
<span class="line-modified">!         bytes[i] = (data.get(i)).byteValue();</span>
        }
        try {
          return new String(bytes, US_ASCII);
        } catch (UnsupportedEncodingException e) {
          throw new COFFException(e);
</pre>
<center><a href="../../remote/RemoteDebuggerClient.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../windbg/WindbgCDebugInfoBuilder.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>