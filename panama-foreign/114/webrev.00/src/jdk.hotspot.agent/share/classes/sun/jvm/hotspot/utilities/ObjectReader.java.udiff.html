<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/utilities/ObjectReader.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MethodArray.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RBTree.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/utilities/ObjectReader.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -76,12 +76,12 @@</span>
        DEBUG = System.getProperty(&quot;sun.jvm.hotspot.utilities.ObjectReader.DEBUG&quot;) != null;
     }
  
     public ObjectReader(ClassLoader cl) {
        this.cl = cl;
<span class="udiff-line-modified-removed">-       this.oopToObjMap = new HashMap();</span>
<span class="udiff-line-modified-removed">-       this.fieldMap = new HashMap();</span>
<span class="udiff-line-modified-added">+       this.oopToObjMap = new HashMap&lt;&gt;();</span>
<span class="udiff-line-modified-added">+       this.fieldMap = new HashMap&lt;&gt;();</span>
     }
  
     public ObjectReader() {
        this(new ProcImageClassLoader());
     }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -115,23 +115,23 @@</span>
  
     protected final Object getDefaultPrimitiveValue(Class clz) {
        if (clz == Boolean.TYPE) {
           return Boolean.FALSE;
        } else if (clz == Character.TYPE) {
<span class="udiff-line-modified-removed">-          return new Character(&#39; &#39;);</span>
<span class="udiff-line-modified-added">+          return &#39; &#39;;</span>
        } else if (clz == Byte.TYPE) {
<span class="udiff-line-modified-removed">-          return new Byte((byte) 0);</span>
<span class="udiff-line-modified-added">+          return (byte) 0;</span>
        } else if (clz == Short.TYPE) {
<span class="udiff-line-modified-removed">-          return new Short((short) 0);</span>
<span class="udiff-line-modified-added">+          return (short) 0;</span>
        } else if (clz == Integer.TYPE) {
<span class="udiff-line-modified-removed">-          return new Integer(0);</span>
<span class="udiff-line-modified-added">+          return 0;</span>
        } else if (clz == Long.TYPE) {
<span class="udiff-line-modified-removed">-          return new Long(0L);</span>
<span class="udiff-line-modified-added">+          return 0L;</span>
        } else if (clz == Float.TYPE) {
<span class="udiff-line-modified-removed">-          return new Float(0.0f);</span>
<span class="udiff-line-modified-added">+          return 0.0f;</span>
        } else if (clz == Double.TYPE) {
<span class="udiff-line-modified-removed">-          return new Double(0.0);</span>
<span class="udiff-line-modified-added">+          return 0.0;</span>
        } else {
           throw new RuntimeException(&quot;should not reach here!&quot;);
        }
     }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -166,11 +166,11 @@</span>
           javaUtilProperties = &quot;java/util/Properties&quot;;
        }
        return javaUtilProperties;
     }
  
<span class="udiff-line-modified-removed">-    private void setHashtableEntry(java.util.Hashtable p, Oop oop) {</span>
<span class="udiff-line-modified-added">+    private void setHashtableEntry(java.util.Hashtable&lt;Object, Object&gt; p, Oop oop) {</span>
        InstanceKlass ik = (InstanceKlass)oop.getKlass();
        OopField keyField = (OopField)ik.findField(&quot;key&quot;, &quot;Ljava/lang/Object;&quot;);
        OopField valueField = (OopField)ik.findField(&quot;value&quot;, &quot;Ljava/lang/Object;&quot;);
        OopField nextField = (OopField)ik.findField(&quot;next&quot;, &quot;Ljava/util/Hashtable$Entry;&quot;);
        if (DEBUG) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -227,11 +227,11 @@</span>
        OopField tableField = (OopField)k.findField(&quot;table&quot;, &quot;[Ljava/util/Hashtable$Entry;&quot;);
        if (tableField == null) {
           debugPrintln(&quot;Could not find field of [Ljava/util/Hashtable$Entry;&quot;);
           return null;
        }
<span class="udiff-line-modified-removed">-       java.util.Hashtable table = new java.util.Hashtable();</span>
<span class="udiff-line-modified-added">+       java.util.Hashtable&lt;Object, Object&gt; table = new java.util.Hashtable&lt;&gt;();</span>
        ObjArray kvs = (ObjArray)tableField.getValue(oop);
        long size = kvs.getLength();
        debugPrintln(&quot;Hashtable$Entry Size = &quot; + size);
        for (long i=0; i&lt;size; i++) {
           Oop entry = kvs.getObjAt(i);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -297,11 +297,11 @@</span>
              return getProperties(oop);
           }
  
           Class clz = readClass(kls);
           try {
<span class="udiff-line-modified-removed">-             result = clz.newInstance();</span>
<span class="udiff-line-modified-added">+             result = clz.getDeclaredConstructor().newInstance();</span>
           } catch (Exception ex) {
              // no-arg constructor failed to create object. Let us try
              // to call constructors one-by-one with default arguments
              // (null for objects, 0/0.0 etc. for primitives) till we
              // succeed or fail on all constructors.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -651,11 +651,11 @@</span>
  
     public java.lang.reflect.Method readMethod(sun.jvm.hotspot.oops.Method m)
              throws NoSuchMethodException, ClassNotFoundException {
        java.lang.reflect.Method result = (java.lang.reflect.Method) getFromObjTable(m);
        if (result == null) {
<span class="udiff-line-modified-removed">-          Class clz = readClass((InstanceKlass)m.getMethodHolder());</span>
<span class="udiff-line-modified-added">+          Class&lt;?&gt; clz = readClass(m.getMethodHolder());</span>
           String name = m.getName().asString();
           Class[] paramTypes = getParamTypes(m.getSignature());
           result = clz.getMethod(name, paramTypes);
           putIntoObjTable(m, result);
        }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -664,11 +664,11 @@</span>
  
     public java.lang.reflect.Constructor readConstructor(sun.jvm.hotspot.oops.Method m)
              throws NoSuchMethodException, ClassNotFoundException {
        java.lang.reflect.Constructor result = (java.lang.reflect.Constructor) getFromObjTable(m);
        if (result == null) {
<span class="udiff-line-modified-removed">-          Class clz = readClass((InstanceKlass)m.getMethodHolder());</span>
<span class="udiff-line-modified-added">+          Class&lt;?&gt; clz = readClass(m.getMethodHolder());</span>
           String name = m.getName().asString();
           Class[] paramTypes = getParamTypes(m.getSignature());
           result = clz.getDeclaredConstructor(paramTypes);
           putIntoObjTable(m, result);
        }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -691,12 +691,12 @@</span>
        }
        return result;
     }
  
     protected final ClassLoader cl;
<span class="udiff-line-modified-removed">-    protected Map   oopToObjMap; // Map&lt;Oop, Object&gt;</span>
<span class="udiff-line-modified-removed">-    protected Map   fieldMap;    // Map&lt;sun.jvm.hotspot.oops.Field, java.lang.reflect.Field&gt;</span>
<span class="udiff-line-modified-added">+    protected Map&lt;Object, Object&gt; oopToObjMap;</span>
<span class="udiff-line-modified-added">+    protected Map&lt;sun.jvm.hotspot.oops.Field, java.lang.reflect.Field&gt; fieldMap;</span>
  
     protected void putIntoObjTable(Oop oop, Object obj) {
        oopToObjMap.put(oop, obj);
     }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -711,11 +711,11 @@</span>
     protected Object getFromObjTable(Metadata oop) {
        return oopToObjMap.get(oop);
     }
  
     protected class SignatureParser extends SignatureIterator {
<span class="udiff-line-modified-removed">-       protected Vector tmp = new Vector(); // Vector&lt;Class&gt;</span>
<span class="udiff-line-modified-added">+       protected Vector&lt;Class&lt;?&gt;&gt; tmp = new Vector&lt;&gt;();</span>
  
        public SignatureParser(Symbol s) {
           super(s);
        }
  
</pre>
<center><a href="MethodArray.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RBTree.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>