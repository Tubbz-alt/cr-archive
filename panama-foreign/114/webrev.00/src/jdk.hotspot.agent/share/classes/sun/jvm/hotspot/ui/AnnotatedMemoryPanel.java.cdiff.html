<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/ui/AnnotatedMemoryPanel.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../types/basic/BasicVtblAccess.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Annotation.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/ui/AnnotatedMemoryPanel.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2000, 2008, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 53,11 ***</span>
    private int paintCount;
    private String unmappedAddrString;
    // Type of this is an IntervalTree indexed by Interval&lt;Address&gt; and
    // with user data of type Annotation
    private IntervalTree annotations =
<span class="line-modified">!     new IntervalTree(new Comparator() {</span>
          public int compare(Object o1, Object o2) {
            Address a1 = (Address) o1;
            Address a2 = (Address) o2;
  
            if ((a1 == null) &amp;&amp; (a2 == null)) {
<span class="line-new-header">--- 53,11 ---</span>
    private int paintCount;
    private String unmappedAddrString;
    // Type of this is an IntervalTree indexed by Interval&lt;Address&gt; and
    // with user data of type Annotation
    private IntervalTree annotations =
<span class="line-modified">!     new IntervalTree(new Comparator&lt;&gt;() {</span>
          public int compare(Object o1, Object o2) {
            Address a1 = (Address) o1;
            Address a2 = (Address) o2;
  
            if ((a1 == null) &amp;&amp; (a2 == null)) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 80,11 ***</span>
    // can scroll annotations
    private Address lastStartAddr;
    // This contains the list of currently-visible IntervalNodes, in
    // sorted order by their low endpoint, in the form of a
    // List&lt;Annotation&gt;. These annotations have already been laid out.
<span class="line-modified">!   private java.util.List visibleAnnotations;</span>
    // Darker colors than defaults for better readability
    private static Color[] colors = {
      new Color(0.0f, 0.0f, 0.6f), // blue
      new Color(0.6f, 0.0f, 0.6f), // magenta
      new Color(0.0f, 0.8f, 0.0f), // green
<span class="line-new-header">--- 80,11 ---</span>
    // can scroll annotations
    private Address lastStartAddr;
    // This contains the list of currently-visible IntervalNodes, in
    // sorted order by their low endpoint, in the form of a
    // List&lt;Annotation&gt;. These annotations have already been laid out.
<span class="line-modified">!   private java.util.List&lt;Annotation&gt; visibleAnnotations;</span>
    // Darker colors than defaults for better readability
    private static Color[] colors = {
      new Color(0.0f, 0.0f, 0.6f), // blue
      new Color(0.6f, 0.0f, 0.6f), // magenta
      new Color(0.0f, 0.8f, 0.0f), // green
</pre>
<hr />
<pre>
<span class="line-old-header">*** 199,11 ***</span>
      // Query for visible annotations (little slop to ensure we get the
      // top and bottom)
      // FIXME: it would be nice to have a more static layout; that is,
      // if something scrolls off the bottom of the screen, other
      // annotations still visible shouldn&#39;t change position
<span class="line-modified">!     java.util.List va =</span>
        annotations.findAllNodesIntersecting(new Interval(startAddr.addOffsetTo(-addressSize),
                                                          endAddr.addOffsetTo(2 * addressSize)));
  
      // Render them
      int curLineX = lineStartX;
<span class="line-new-header">--- 199,11 ---</span>
      // Query for visible annotations (little slop to ensure we get the
      // top and bottom)
      // FIXME: it would be nice to have a more static layout; that is,
      // if something scrolls off the bottom of the screen, other
      // annotations still visible shouldn&#39;t change position
<span class="line-modified">!     java.util.List&lt;IntervalNode&gt; va =</span>
        annotations.findAllNodesIntersecting(new Interval(startAddr.addOffsetTo(-addressSize),
                                                          endAddr.addOffsetTo(2 * addressSize)));
  
      // Render them
      int curLineX = lineStartX;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 212,16 ***</span>
      if (g instanceof Graphics2D) {
        Stroke stroke = new BasicStroke(3.0f);
        ((Graphics2D) g).setStroke(stroke);
      }
  
<span class="line-modified">!     Stack drawStack = new Stack();</span>
  
      layoutAnnotations(va, g, curTextX, startAddr, lineHeight);
  
<span class="line-modified">!     for (Iterator iter = visibleAnnotations.iterator(); iter.hasNext(); ) {</span>
<span class="line-modified">!       Annotation anno   = (Annotation) iter.next();</span>
        Interval interval = anno.getInterval();
  
        if (!drawStack.empty()) {
          // See whether we can pop any items off the stack
          boolean shouldContinue = true;
<span class="line-new-header">--- 212,16 ---</span>
      if (g instanceof Graphics2D) {
        Stroke stroke = new BasicStroke(3.0f);
        ((Graphics2D) g).setStroke(stroke);
      }
  
<span class="line-modified">!     Stack&lt;AnnoX&gt; drawStack = new Stack&lt;&gt;();</span>
  
      layoutAnnotations(va, g, curTextX, startAddr, lineHeight);
  
<span class="line-modified">!     for (Iterator&lt;Annotation&gt; iter = visibleAnnotations.iterator(); iter.hasNext(); ) {</span>
<span class="line-modified">!       Annotation anno   = iter.next();</span>
        Interval interval = anno.getInterval();
  
        if (!drawStack.empty()) {
          // See whether we can pop any items off the stack
          boolean shouldContinue = true;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 291,11 ***</span>
        unmappedAddrString = &quot;??????????&quot;;
      }
      setLayout(new BorderLayout());
      setupScrollBar(addrValue, addrLow, addrHigh);
      add(scrollBar, BorderLayout.EAST);
<span class="line-modified">!     visibleAnnotations = new ArrayList();</span>
      setBackground(Color.white);
      addHierarchyBoundsListener(new HierarchyBoundsListener() {
          public void ancestorMoved(HierarchyEvent e) {
          }
  
<span class="line-new-header">--- 291,11 ---</span>
        unmappedAddrString = &quot;??????????&quot;;
      }
      setLayout(new BorderLayout());
      setupScrollBar(addrValue, addrLow, addrHigh);
      add(scrollBar, BorderLayout.EAST);
<span class="line-modified">!     visibleAnnotations = new ArrayList&lt;&gt;();</span>
      setBackground(Color.white);
      addHierarchyBoundsListener(new HierarchyBoundsListener() {
          public void ancestorMoved(HierarchyEvent e) {
          }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 436,21 ***</span>
      return a.toString();
    }
  
    /** Scrolls the visible annotations by the given Y amount */
    private void scrollAnnotations(int y) {
<span class="line-modified">!     for (Iterator iter = visibleAnnotations.iterator(); iter.hasNext(); ) {</span>
<span class="line-modified">!       Annotation anno = (Annotation) iter.next();</span>
        anno.setY(anno.getY() + y);
      }
    }
  
    /** Takes the list of currently-visible annotations (in the form of
        a List&lt;IntervalNode&gt;) and lays them out given the current
        visible position and the already-visible annotations. Does not
        perturb the layouts of the currently-visible annotations. */
<span class="line-modified">!   private void layoutAnnotations(java.util.List va,</span>
                                   Graphics g,
                                   int x,
                                   Address startAddr,
                                   int lineHeight) {
      // Handle degenerate case early: no visible annotations.
<span class="line-new-header">--- 436,21 ---</span>
      return a.toString();
    }
  
    /** Scrolls the visible annotations by the given Y amount */
    private void scrollAnnotations(int y) {
<span class="line-modified">!     for (Iterator&lt;Annotation&gt; iter = visibleAnnotations.iterator(); iter.hasNext(); ) {</span>
<span class="line-modified">!       Annotation anno = iter.next();</span>
        anno.setY(anno.getY() + y);
      }
    }
  
    /** Takes the list of currently-visible annotations (in the form of
        a List&lt;IntervalNode&gt;) and lays them out given the current
        visible position and the already-visible annotations. Does not
        perturb the layouts of the currently-visible annotations. */
<span class="line-modified">!   private void layoutAnnotations(java.util.List&lt;IntervalNode&gt; va,</span>
                                   Graphics g,
                                   int x,
                                   Address startAddr,
                                   int lineHeight) {
      // Handle degenerate case early: no visible annotations.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 488,19 ***</span>
      Annotation firstConstraintAnnotation = null;
      // The index from which we search forward in the
      // visibleAnnotations list. This reduces the amount of work we do.
      int searchIndex = 0;
      // The new set of annotations
<span class="line-modified">!     java.util.List newAnnos = new ArrayList();</span>
  
<span class="line-modified">!     for (Iterator iter = va.iterator(); iter.hasNext(); ) {</span>
        Annotation anno = (Annotation) ((IntervalNode) iter.next()).getData();
  
        // Search forward for this one
        boolean found = false;
        for (int i = searchIndex; i &lt; visibleAnnotations.size(); i++) {
<span class="line-modified">!         Annotation el = (Annotation) visibleAnnotations.get(i);</span>
          // See whether we can abort the search unsuccessfully because
          // we went forward too far
          if (el.getLowAddress().greaterThan(anno.getLowAddress())) {
            break;
          }
<span class="line-new-header">--- 488,19 ---</span>
      Annotation firstConstraintAnnotation = null;
      // The index from which we search forward in the
      // visibleAnnotations list. This reduces the amount of work we do.
      int searchIndex = 0;
      // The new set of annotations
<span class="line-modified">!     java.util.List&lt;Annotation&gt; newAnnos = new ArrayList&lt;&gt;();</span>
  
<span class="line-modified">!     for (Iterator&lt;IntervalNode&gt; iter = va.iterator(); iter.hasNext(); ) {</span>
        Annotation anno = (Annotation) ((IntervalNode) iter.next()).getData();
  
        // Search forward for this one
        boolean found = false;
        for (int i = searchIndex; i &lt; visibleAnnotations.size(); i++) {
<span class="line-modified">!         Annotation el = visibleAnnotations.get(i);</span>
          // See whether we can abort the search unsuccessfully because
          // we went forward too far
          if (el.getLowAddress().greaterThan(anno.getLowAddress())) {
            break;
          }
</pre>
<center><a href="../types/basic/BasicVtblAccess.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Annotation.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>