<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.incubator.jpackage/linux/classes/jdk/incubator/jpackage/internal/LinuxPackageBundler.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../jdk.httpserver/share/classes/com/sun/net/httpserver/Headers.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="resources/LinuxResources.properties.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.incubator.jpackage/linux/classes/jdk/incubator/jpackage/internal/LinuxPackageBundler.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 38 import static jdk.incubator.jpackage.internal.LinuxAppBundler.LINUX_PACKAGE_DEPENDENCIES;
 39 import static jdk.incubator.jpackage.internal.StandardBundlerParam.*;
 40 
 41 
 42 abstract class LinuxPackageBundler extends AbstractBundler {
 43 
 44     LinuxPackageBundler(BundlerParamInfo&lt;String&gt; packageName) {
 45         this.packageName = packageName;
 46     }
 47 
 48     @Override
 49     final public boolean validate(Map&lt;String, ? super Object&gt; params)
 50             throws ConfigException {
 51 
 52         // run basic validation to ensure requirements are met
 53         // we are not interested in return code, only possible exception
 54         APP_BUNDLER.fetchFrom(params).validate(params);
 55 
 56         validateInstallDir(LINUX_INSTALL_DIR.fetchFrom(params));
 57 
<span class="line-modified"> 58         validateFileAssociations(FILE_ASSOCIATIONS.fetchFrom(params));</span>
 59 
 60         // If package name has some restrictions, the string converter will
 61         // throw an exception if invalid
 62         packageName.getStringConverter().apply(packageName.fetchFrom(params),
 63             params);
 64 
 65         for (var validator: getToolValidators(params)) {
 66             ConfigException ex = validator.validate();
 67             if (ex != null) {
 68                 throw ex;
 69             }
 70         }
 71 
 72         withFindNeededPackages = LibProvidersLookup.supported();
 73         if (!withFindNeededPackages) {
 74             final String advice;
 75             if (&quot;deb&quot;.equals(getID())) {
 76                 advice = &quot;message.deb-ldd-not-available.advice&quot;;
 77             } else {
 78                 advice = &quot;message.rpm-ldd-not-available.advice&quot;;
</pre>
<hr />
<pre>
296         }
297 
298         boolean valid = false;
299         try {
300             final Path installDirPath = Path.of(installDir);
301             valid = installDirPath.isAbsolute();
302             if (valid &amp;&amp; !installDirPath.normalize().toString().equals(
303                     installDirPath.toString())) {
304                 // Don&#39;t allow &#39;/opt/foo/..&#39; or /opt/.
305                 valid = false;
306             }
307         } catch (InvalidPathException ex) {
308         }
309 
310         if (!valid) {
311             throw new ConfigException(MessageFormat.format(I18N.getString(
312                     &quot;error.invalid-install-dir&quot;), installDir), null);
313         }
314     }
315 
<span class="line-removed">316     private static void validateFileAssociations(</span>
<span class="line-removed">317             List&lt;Map&lt;String, ? super Object&gt;&gt; associations) throws</span>
<span class="line-removed">318             ConfigException {</span>
<span class="line-removed">319         // only one mime type per association, at least one file extention</span>
<span class="line-removed">320         int assocIdx = 0;</span>
<span class="line-removed">321         for (var assoc : associations) {</span>
<span class="line-removed">322             ++assocIdx;</span>
<span class="line-removed">323             List&lt;String&gt; mimes = FA_CONTENT_TYPE.fetchFrom(assoc);</span>
<span class="line-removed">324             if (mimes == null || mimes.isEmpty()) {</span>
<span class="line-removed">325                 String msgKey = &quot;error.no-content-types-for-file-association&quot;;</span>
<span class="line-removed">326                 throw new ConfigException(</span>
<span class="line-removed">327                         MessageFormat.format(I18N.getString(msgKey), assocIdx),</span>
<span class="line-removed">328                         I18N.getString(msgKey + &quot;.advise&quot;));</span>
<span class="line-removed">329 </span>
<span class="line-removed">330             }</span>
<span class="line-removed">331 </span>
<span class="line-removed">332             if (mimes.size() &gt; 1) {</span>
<span class="line-removed">333                 String msgKey = &quot;error.too-many-content-types-for-file-association&quot;;</span>
<span class="line-removed">334                 throw new ConfigException(</span>
<span class="line-removed">335                         MessageFormat.format(I18N.getString(msgKey), assocIdx),</span>
<span class="line-removed">336                         I18N.getString(msgKey + &quot;.advise&quot;));</span>
<span class="line-removed">337             }</span>
<span class="line-removed">338         }</span>
<span class="line-removed">339     }</span>
<span class="line-removed">340 </span>
341     private final BundlerParamInfo&lt;String&gt; packageName;
342     private boolean withFindNeededPackages;
343     private DesktopIntegration desktopIntegration;
344 
345     private static final BundlerParamInfo&lt;LinuxAppBundler&gt; APP_BUNDLER =
346         new StandardBundlerParam&lt;&gt;(
347                 &quot;linux.app.bundler&quot;,
348                 LinuxAppBundler.class,
349                 (params) -&gt; new LinuxAppBundler(),
350                 null
351         );
352 
353 }
</pre>
</td>
<td>
<hr />
<pre>
 38 import static jdk.incubator.jpackage.internal.LinuxAppBundler.LINUX_PACKAGE_DEPENDENCIES;
 39 import static jdk.incubator.jpackage.internal.StandardBundlerParam.*;
 40 
 41 
 42 abstract class LinuxPackageBundler extends AbstractBundler {
 43 
 44     LinuxPackageBundler(BundlerParamInfo&lt;String&gt; packageName) {
 45         this.packageName = packageName;
 46     }
 47 
 48     @Override
 49     final public boolean validate(Map&lt;String, ? super Object&gt; params)
 50             throws ConfigException {
 51 
 52         // run basic validation to ensure requirements are met
 53         // we are not interested in return code, only possible exception
 54         APP_BUNDLER.fetchFrom(params).validate(params);
 55 
 56         validateInstallDir(LINUX_INSTALL_DIR.fetchFrom(params));
 57 
<span class="line-modified"> 58         FileAssociation.verify(FileAssociation.fetchFrom(params));</span>
 59 
 60         // If package name has some restrictions, the string converter will
 61         // throw an exception if invalid
 62         packageName.getStringConverter().apply(packageName.fetchFrom(params),
 63             params);
 64 
 65         for (var validator: getToolValidators(params)) {
 66             ConfigException ex = validator.validate();
 67             if (ex != null) {
 68                 throw ex;
 69             }
 70         }
 71 
 72         withFindNeededPackages = LibProvidersLookup.supported();
 73         if (!withFindNeededPackages) {
 74             final String advice;
 75             if (&quot;deb&quot;.equals(getID())) {
 76                 advice = &quot;message.deb-ldd-not-available.advice&quot;;
 77             } else {
 78                 advice = &quot;message.rpm-ldd-not-available.advice&quot;;
</pre>
<hr />
<pre>
296         }
297 
298         boolean valid = false;
299         try {
300             final Path installDirPath = Path.of(installDir);
301             valid = installDirPath.isAbsolute();
302             if (valid &amp;&amp; !installDirPath.normalize().toString().equals(
303                     installDirPath.toString())) {
304                 // Don&#39;t allow &#39;/opt/foo/..&#39; or /opt/.
305                 valid = false;
306             }
307         } catch (InvalidPathException ex) {
308         }
309 
310         if (!valid) {
311             throw new ConfigException(MessageFormat.format(I18N.getString(
312                     &quot;error.invalid-install-dir&quot;), installDir), null);
313         }
314     }
315 

























316     private final BundlerParamInfo&lt;String&gt; packageName;
317     private boolean withFindNeededPackages;
318     private DesktopIntegration desktopIntegration;
319 
320     private static final BundlerParamInfo&lt;LinuxAppBundler&gt; APP_BUNDLER =
321         new StandardBundlerParam&lt;&gt;(
322                 &quot;linux.app.bundler&quot;,
323                 LinuxAppBundler.class,
324                 (params) -&gt; new LinuxAppBundler(),
325                 null
326         );
327 
328 }
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../jdk.httpserver/share/classes/com/sun/net/httpserver/Headers.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="resources/LinuxResources.properties.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>