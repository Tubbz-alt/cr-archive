<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.jartool/share/classes/jdk/security/jarsigner/JarSigner.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../com/sun/jarsigner/package-info.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../sun/security/tools/jarsigner/Main.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jartool/share/classes/jdk/security/jarsigner/JarSigner.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 32,10 ***</span>
<span class="line-new-header">--- 32,11 ---</span>
  import sun.security.util.ManifestDigester;
  import sun.security.util.SignatureFileVerifier;
  import sun.security.x509.AlgorithmId;
  
  import java.io.*;
<span class="line-added">+ import java.lang.reflect.InvocationTargetException;</span>
  import java.net.SocketTimeoutException;
  import java.net.URI;
  import java.net.URL;
  import java.net.URLClassLoader;
  import java.security.*;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 839,18 ***</span>
          byte[] content = baos.toByteArray();
  
          signer.update(content);
          byte[] signature = signer.sign();
  
<span class="line-modified">!         @SuppressWarnings(&quot;deprecation&quot;)</span>
          ContentSigner signingMechanism = null;
          if (altSigner != null) {
              signingMechanism = loadSigningMechanism(altSigner,
                      altSignerPath);
          }
  
<span class="line-modified">!         @SuppressWarnings(&quot;deprecation&quot;)</span>
          ContentSignerParameters params =
                  new JarSignerParameters(null, tsaUrl, tSAPolicyID,
                          tSADigestAlg, signature,
                          signer.getAlgorithm(), certChain, content, zipFile);
          block = sf.generateBlock(params, externalSF, signingMechanism);
<span class="line-new-header">--- 840,18 ---</span>
          byte[] content = baos.toByteArray();
  
          signer.update(content);
          byte[] signature = signer.sign();
  
<span class="line-modified">!         @SuppressWarnings(&quot;removal&quot;)</span>
          ContentSigner signingMechanism = null;
          if (altSigner != null) {
              signingMechanism = loadSigningMechanism(altSigner,
                      altSignerPath);
          }
  
<span class="line-modified">!         @SuppressWarnings(&quot;removal&quot;)</span>
          ContentSignerParameters params =
                  new JarSignerParameters(null, tsaUrl, tSAPolicyID,
                          tSADigestAlg, signature,
                          signer.getAlgorithm(), certChain, content, zipFile);
          block = sf.generateBlock(params, externalSF, signingMechanism);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1056,14 ***</span>
  
      /*
       * Try to load the specified signing mechanism.
       * The URL class loader is used.
       */
<span class="line-modified">!     @SuppressWarnings(&quot;deprecation&quot;)</span>
      private ContentSigner loadSigningMechanism(String signerClassName,
                                                 String signerClassPath) {
  
          // construct class loader
          String cpString;   // make sure env.class.path defaults to dot
  
          // do prepends to get correct ordering
          cpString = PathList.appendPath(
<span class="line-new-header">--- 1057,19 ---</span>
  
      /*
       * Try to load the specified signing mechanism.
       * The URL class loader is used.
       */
<span class="line-modified">!     @SuppressWarnings(&quot;removal&quot;)</span>
      private ContentSigner loadSigningMechanism(String signerClassName,
                                                 String signerClassPath) {
  
<span class="line-added">+         // If there is no signerClassPath provided, search from here</span>
<span class="line-added">+         if (signerClassPath == null) {</span>
<span class="line-added">+             signerClassPath = &quot;.&quot;;</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
          // construct class loader
          String cpString;   // make sure env.class.path defaults to dot
  
          // do prepends to get correct ordering
          cpString = PathList.appendPath(
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1075,14 ***</span>
          ClassLoader appClassLoader = new URLClassLoader(urls);
  
          try {
              // attempt to find signer
              Class&lt;?&gt; signerClass = appClassLoader.loadClass(signerClassName);
<span class="line-modified">!             Object signer = signerClass.newInstance();</span>
              return (ContentSigner) signer;
          } catch (ClassNotFoundException|InstantiationException|
<span class="line-modified">!                 IllegalAccessException|ClassCastException e) {</span>
              throw new IllegalArgumentException(
                      &quot;Invalid altSigner or altSignerPath&quot;, e);
          }
      }
  
<span class="line-new-header">--- 1081,15 ---</span>
          ClassLoader appClassLoader = new URLClassLoader(urls);
  
          try {
              // attempt to find signer
              Class&lt;?&gt; signerClass = appClassLoader.loadClass(signerClassName);
<span class="line-modified">!             Object signer = signerClass.getDeclaredConstructor().newInstance();</span>
              return (ContentSigner) signer;
          } catch (ClassNotFoundException|InstantiationException|
<span class="line-modified">!                 IllegalAccessException|ClassCastException|</span>
<span class="line-added">+                 NoSuchMethodException| InvocationTargetException e) {</span>
              throw new IllegalArgumentException(
                      &quot;Invalid altSigner or altSignerPath&quot;, e);
          }
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1172,11 ***</span>
              String keyAlgorithm = privateKey.getAlgorithm();
              return getBaseSignatureFilesName(baseName) + keyAlgorithm;
          }
  
          // Generates the PKCS#7 content of block file
<span class="line-modified">!         @SuppressWarnings(&quot;deprecation&quot;)</span>
          public byte[] generateBlock(ContentSignerParameters params,
                                      boolean externalSF,
                                      ContentSigner signingMechanism)
                  throws NoSuchAlgorithmException,
                         IOException, CertificateException {
<span class="line-new-header">--- 1179,11 ---</span>
              String keyAlgorithm = privateKey.getAlgorithm();
              return getBaseSignatureFilesName(baseName) + keyAlgorithm;
          }
  
          // Generates the PKCS#7 content of block file
<span class="line-modified">!         @SuppressWarnings(&quot;removal&quot;)</span>
          public byte[] generateBlock(ContentSignerParameters params,
                                      boolean externalSF,
                                      ContentSigner signingMechanism)
                  throws NoSuchAlgorithmException,
                         IOException, CertificateException {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1190,11 ***</span>
                      params.getTimestampingAuthority() != null
                          || params.getTimestampingAuthorityCertificate() != null);
          }
      }
  
<span class="line-modified">!     @SuppressWarnings(&quot;deprecation&quot;)</span>
      class JarSignerParameters implements ContentSignerParameters {
  
          private String[] args;
          private URI tsa;
          private byte[] signature;
<span class="line-new-header">--- 1197,11 ---</span>
                      params.getTimestampingAuthority() != null
                          || params.getTimestampingAuthorityCertificate() != null);
          }
      }
  
<span class="line-modified">!     @SuppressWarnings(&quot;removal&quot;)</span>
      class JarSignerParameters implements ContentSignerParameters {
  
          private String[] args;
          private URI tsa;
          private byte[] signature;
</pre>
<center><a href="../../../com/sun/jarsigner/package-info.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../sun/security/tools/jarsigner/Main.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>