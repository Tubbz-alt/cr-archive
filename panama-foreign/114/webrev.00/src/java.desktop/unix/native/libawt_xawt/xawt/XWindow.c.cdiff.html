<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/unix/native/libawt_xawt/xawt/XWindow.c</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="XToolkit.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../windows/classes/sun/awt/windows/WPathGraphics.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/unix/native/libawt_xawt/xawt/XWindow.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2002, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2002, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1122,23 ***</span>
  }
  
  
  extern struct X11GraphicsConfigIDs x11GraphicsConfigIDs;
  
<span class="line-removed">- /*</span>
<span class="line-removed">-  * Class:     Java_sun_awt_X11_XWindow_getNativeColor</span>
<span class="line-removed">-  * Method:    getNativeColor</span>
<span class="line-removed">-  * Signature  (Ljava/awt/Color;Ljava/awt/GraphicsConfiguration;)I</span>
<span class="line-removed">-  */</span>
<span class="line-removed">- JNIEXPORT jint JNICALL Java_sun_awt_X11_XWindow_getNativeColor</span>
<span class="line-removed">- (JNIEnv *env, jobject this, jobject color, jobject gc_object) {</span>
<span class="line-removed">-     AwtGraphicsConfigDataPtr adata;</span>
<span class="line-removed">-     /* fire warning because JNU_GetLongFieldAsPtr casts jlong to (void *) */</span>
<span class="line-removed">-     adata = (AwtGraphicsConfigDataPtr) JNU_GetLongFieldAsPtr(env, gc_object, x11GraphicsConfigIDs.aData);</span>
<span class="line-removed">-     return awtJNI_GetColorForVis(env, color, adata);</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
  /* syncTopLevelPos() is necessary to insure that the window manager has in
   * fact moved us to our final position relative to the reParented WM window.
   * We have noted a timing window which our shell has not been moved so we
   * screw up the insets thinking they are 0,0.  Wait (for a limited period of
   * time to let the WM hava a chance to move us
<span class="line-new-header">--- 1122,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1162,88 ***</span>
               XSync(d, False);
           }
      } while (i++ &lt; 50);
  }
  
<span class="line-removed">- static Window getTopWindow(Window win, Window *rootWin)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     Window root=None, current_window=win, parent=None, *ignore_children=NULL;</span>
<span class="line-removed">-     Window prev_window=None;</span>
<span class="line-removed">-     unsigned int ignore_uint=0;</span>
<span class="line-removed">-     Status status = 0;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (win == None) return None;</span>
<span class="line-removed">-     do {</span>
<span class="line-removed">-         status = XQueryTree(awt_display,</span>
<span class="line-removed">-                             current_window,</span>
<span class="line-removed">-                             &amp;root,</span>
<span class="line-removed">-                             &amp;parent,</span>
<span class="line-removed">-                             &amp;ignore_children,</span>
<span class="line-removed">-                             &amp;ignore_uint);</span>
<span class="line-removed">-         XFree(ignore_children);</span>
<span class="line-removed">-         if (status == 0) return None;</span>
<span class="line-removed">-         prev_window = current_window;</span>
<span class="line-removed">-         current_window = parent;</span>
<span class="line-removed">-     } while (parent != root);</span>
<span class="line-removed">-     *rootWin = root;</span>
<span class="line-removed">-     return prev_window;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- JNIEXPORT jlong JNICALL Java_sun_awt_X11_XWindow_getTopWindow</span>
<span class="line-removed">- (JNIEnv *env, jclass clazz, jlong win, jlong rootWin) {</span>
<span class="line-removed">-     return getTopWindow((Window) win, (Window*) jlong_to_ptr(rootWin));</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- static void</span>
<span class="line-removed">- getWMInsets</span>
<span class="line-removed">- (Window window, int *left, int *top, int *right, int *bottom, int *border) {</span>
<span class="line-removed">-     // window is event-&gt;xreparent.window</span>
<span class="line-removed">-     Window topWin = None, rootWin = None, containerWindow = None;</span>
<span class="line-removed">-     XWindowAttributes winAttr, topAttr;</span>
<span class="line-removed">-     int screenX, screenY;</span>
<span class="line-removed">-     topWin = getTopWindow(window, &amp;rootWin);</span>
<span class="line-removed">-     syncTopLevelPos(awt_display, topWin, &amp;topAttr);</span>
<span class="line-removed">-     // (screenX, screenY) is (0,0) of the reparented window</span>
<span class="line-removed">-     // converted to screen coordinates.</span>
<span class="line-removed">-     XTranslateCoordinates(awt_display, window, rootWin,</span>
<span class="line-removed">-         0,0, &amp;screenX, &amp;screenY, &amp;containerWindow);</span>
<span class="line-removed">-     *left = screenX - topAttr.x - topAttr.border_width;</span>
<span class="line-removed">-     *top  = screenY - topAttr.y - topAttr.border_width;</span>
<span class="line-removed">-     XGetWindowAttributes(awt_display, window, &amp;winAttr);</span>
<span class="line-removed">-     *right  = topAttr.width  - ((winAttr.width)  + *left);</span>
<span class="line-removed">-     *bottom = topAttr.height - ((winAttr.height) + *top);</span>
<span class="line-removed">-     *border = topAttr.border_width;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- JNIEXPORT void JNICALL Java_sun_awt_X11_XWindow_getWMInsets</span>
<span class="line-removed">- (JNIEnv *env, jclass clazz, jlong window, jlong left, jlong top, jlong right, jlong bottom, jlong border) {</span>
<span class="line-removed">-     getWMInsets((Window) window,</span>
<span class="line-removed">-                 (int*) jlong_to_ptr(left),</span>
<span class="line-removed">-                 (int*) jlong_to_ptr(top),</span>
<span class="line-removed">-                 (int*) jlong_to_ptr(right),</span>
<span class="line-removed">-                 (int*) jlong_to_ptr(bottom),</span>
<span class="line-removed">-                 (int*) jlong_to_ptr(border));</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- static void</span>
<span class="line-removed">- getWindowBounds</span>
<span class="line-removed">- (Window window, int *x, int *y, int *width, int *height) {</span>
<span class="line-removed">-     XWindowAttributes winAttr;</span>
<span class="line-removed">-     XSync(awt_display, False);</span>
<span class="line-removed">-     XGetWindowAttributes(awt_display, window, &amp;winAttr);</span>
<span class="line-removed">-     *x = winAttr.x;</span>
<span class="line-removed">-     *y = winAttr.y;</span>
<span class="line-removed">-     *width = winAttr.width;</span>
<span class="line-removed">-     *height = winAttr.height;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- JNIEXPORT void JNICALL Java_sun_awt_X11_XWindow_getWindowBounds</span>
<span class="line-removed">- (JNIEnv *env, jclass clazz, jlong window, jlong x, jlong y, jlong width, jlong height) {</span>
<span class="line-removed">-     getWindowBounds((Window) window, (int*) jlong_to_ptr(x), (int*) jlong_to_ptr(y),</span>
<span class="line-removed">-                     (int*) jlong_to_ptr(width), (int*) jlong_to_ptr(height));</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
  JNIEXPORT void JNICALL Java_sun_awt_X11_XWindow_setSizeHints
  (JNIEnv *env, jclass clazz, jlong window, jlong x, jlong y, jlong width, jlong height) {
      XSizeHints *size_hints = XAllocSizeHints();
      size_hints-&gt;flags = USPosition | PPosition | PSize;
      size_hints-&gt;x = (int)x;
<span class="line-new-header">--- 1149,10 ---</span>
</pre>
<center><a href="XToolkit.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../windows/classes/sun/awt/windows/WPathGraphics.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>