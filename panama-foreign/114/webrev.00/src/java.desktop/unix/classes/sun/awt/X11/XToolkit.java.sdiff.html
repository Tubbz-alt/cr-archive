<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/unix/classes/sun/awt/X11/XToolkit.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="XIconWindow.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="XWindow.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/unix/classes/sun/awt/X11/XToolkit.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 194     private FontConfigManager fcManager = new FontConfigManager();
 195 
 196     static int arrowCursor;
 197     static TreeMap&lt;Long, XBaseWindow&gt; winMap = new TreeMap&lt;&gt;();
 198     static HashMap&lt;Object, Object&gt; specialPeerMap = new HashMap&lt;&gt;();
 199     static HashMap&lt;Long, Collection&lt;XEventDispatcher&gt;&gt; winToDispatcher = new HashMap&lt;&gt;();
 200     static UIDefaults uidefaults;
 201     static final X11GraphicsEnvironment localEnv;
 202     private static final X11GraphicsDevice device;
 203     private static final long display;
 204     static int awt_multiclick_time;
 205     static boolean securityWarningEnabled;
 206 
 207     /**
 208      * Dimensions of default virtual screen in pixels. These values are used to
 209      * limit the maximum size of the window.
 210      */
 211     private static volatile int maxWindowWidthInPixels = -1;
 212     private static volatile int maxWindowHeightInPixels = -1;
 213 
<span class="line-removed"> 214     static long awt_defaultFg; // Pixel</span>
 215     private static XMouseInfoPeer xPeer;
 216 
 217     /**
 218      * Should we check &quot;_NET_WM_STRUT/_NET_WM_STRUT_PARTIAL&quot; during insets
 219      * calculation.
 220      */
 221     private static Boolean checkSTRUT;
 222 
 223     static {
 224         initSecurityWarning();
 225         if (GraphicsEnvironment.isHeadless()) {
 226             localEnv = null;
 227             device = null;
 228             display = 0;
 229         } else {
 230             localEnv = (X11GraphicsEnvironment) GraphicsEnvironment
 231                 .getLocalGraphicsEnvironment();
 232             device = (X11GraphicsDevice) localEnv.getDefaultScreenDevice();
 233             display = device.getDisplay();
 234             setupModifierMap();
</pre>
<hr />
<pre>
 323                 XlibWrapper.DefaultScreen(XToolkit.getDisplay()));
 324 
 325             if (res == 0) {
 326                throw new IllegalStateException(&quot;Root window must not be null&quot;);
 327             }
 328             return res;
 329         } finally {
 330             awtUnlock();
 331         }
 332     }
 333 
 334     void init() {
 335         awtLock();
 336         try {
 337             XlibWrapper.XSupportsLocale();
 338             if (XlibWrapper.XSetLocaleModifiers(&quot;&quot;) == null) {
 339                 log.finer(&quot;X locale modifiers are not supported, using default&quot;);
 340             }
 341             tryXKB();
 342 
<span class="line-removed"> 343             AwtScreenData defaultScreen = new AwtScreenData(XToolkit.getDefaultScreenData());</span>
<span class="line-removed"> 344             awt_defaultFg = defaultScreen.get_blackpixel();</span>
<span class="line-removed"> 345 </span>
 346             arrowCursor = XlibWrapper.XCreateFontCursor(XToolkit.getDisplay(),
 347                 XCursorFontConstants.XC_arrow);
 348             final String extraButtons = &quot;sun.awt.enableExtraMouseButtons&quot;;
 349             AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {
 350                 areExtraMouseButtonsEnabled =
 351                     Boolean.parseBoolean(System.getProperty(extraButtons, &quot;true&quot;));
 352                 //set system property if not yet assigned
 353                 System.setProperty(extraButtons, &quot;&quot;+areExtraMouseButtonsEnabled);
 354                 return null;
 355             });
 356             // Detect display mode changes
 357             XlibWrapper.XSelectInput(XToolkit.getDisplay(), XToolkit.getDefaultRootWindow(), XConstants.StructureNotifyMask);
 358             XToolkit.addEventDispatcher(XToolkit.getDefaultRootWindow(), new XEventDispatcher() {
 359                 @Override
 360                 public void dispatchEvent(XEvent ev) {
 361                     if (ev.get_type() == XConstants.ConfigureNotify) {
 362                         awtUnlock();
 363                         try {
 364                             ((X11GraphicsEnvironment)GraphicsEnvironment.
 365                              getLocalGraphicsEnvironment()).
</pre>
<hr />
<pre>
1476         } finally {
1477             awtUnlock();
1478         }
1479     }
1480 
1481     @Override
1482     public int getScreenResolution() {
1483         long display = getDisplay();
1484         awtLock();
1485         try {
1486             return (int) ((XlibWrapper.DisplayWidth(display,
1487                 XlibWrapper.DefaultScreen(display)) * 25.4) /
1488                     XlibWrapper.DisplayWidthMM(display,
1489                 XlibWrapper.DefaultScreen(display)));
1490         } finally {
1491             awtUnlock();
1492         }
1493     }
1494 
1495     static native long getDefaultXColormap();
<span class="line-removed">1496     static native long getDefaultScreenData();</span>
1497 
1498     /**
1499      * Returns a new input method adapter descriptor for native input methods.
1500      */
1501     @Override
1502     public InputMethodDescriptor getInputMethodAdapterDescriptor() throws AWTException {
1503         return new XInputMethodDescriptor();
1504     }
1505 
1506     /**
1507      * Returns whether enableInputMethods should be set to true for peered
1508      * TextComponent instances on this platform. True by default.
1509      */
1510     @Override
1511     public boolean enableInputMethodsForTextComponent() {
1512         return true;
1513     }
1514 
1515     static int getMultiClickTime() {
1516         if (awt_multiclick_time == 0) {
</pre>
<hr />
<pre>
2158                     timeoutTaskLog.finer(&quot;XToolkit.callTimeoutTasks(): current time={0}&quot; +
2159                                          &quot;;  about to run task={1}&quot;, Long.valueOf(currentTime), task);
2160                 }
2161 
2162                 try {
2163                     task.run();
2164                 } catch (ThreadDeath td) {
2165                     throw td;
2166                 } catch (Throwable thr) {
2167                     processException(thr);
2168                 }
2169             }
2170 
2171             if (timeoutTasks.isEmpty()) {
2172                 break;
2173             }
2174             time = timeoutTasks.firstKey();
2175         }
2176     }
2177 
<span class="line-removed">2178     static long getAwtDefaultFg() {</span>
<span class="line-removed">2179         return awt_defaultFg;</span>
<span class="line-removed">2180     }</span>
<span class="line-removed">2181 </span>
2182     static boolean isLeftMouseButton(MouseEvent me) {
2183         switch (me.getID()) {
2184           case MouseEvent.MOUSE_PRESSED:
2185           case MouseEvent.MOUSE_RELEASED:
2186               return (me.getButton() == MouseEvent.BUTTON1);
2187           case MouseEvent.MOUSE_ENTERED:
2188           case MouseEvent.MOUSE_EXITED:
2189           case MouseEvent.MOUSE_CLICKED:
2190           case MouseEvent.MOUSE_DRAGGED:
2191               return ((me.getModifiersEx() &amp; InputEvent.BUTTON1_DOWN_MASK) != 0);
2192         }
2193         return false;
2194     }
2195 
2196     static boolean isRightMouseButton(MouseEvent me) {
2197         int numButtons = ((Integer)getDefaultToolkit().getDesktopProperty(&quot;awt.mouse.numButtons&quot;)).intValue();
2198         switch (me.getID()) {
2199           case MouseEvent.MOUSE_PRESSED:
2200           case MouseEvent.MOUSE_RELEASED:
2201               return ((numButtons == 2 &amp;&amp; me.getButton() == MouseEvent.BUTTON2) ||
</pre>
</td>
<td>
<hr />
<pre>
 194     private FontConfigManager fcManager = new FontConfigManager();
 195 
 196     static int arrowCursor;
 197     static TreeMap&lt;Long, XBaseWindow&gt; winMap = new TreeMap&lt;&gt;();
 198     static HashMap&lt;Object, Object&gt; specialPeerMap = new HashMap&lt;&gt;();
 199     static HashMap&lt;Long, Collection&lt;XEventDispatcher&gt;&gt; winToDispatcher = new HashMap&lt;&gt;();
 200     static UIDefaults uidefaults;
 201     static final X11GraphicsEnvironment localEnv;
 202     private static final X11GraphicsDevice device;
 203     private static final long display;
 204     static int awt_multiclick_time;
 205     static boolean securityWarningEnabled;
 206 
 207     /**
 208      * Dimensions of default virtual screen in pixels. These values are used to
 209      * limit the maximum size of the window.
 210      */
 211     private static volatile int maxWindowWidthInPixels = -1;
 212     private static volatile int maxWindowHeightInPixels = -1;
 213 

 214     private static XMouseInfoPeer xPeer;
 215 
 216     /**
 217      * Should we check &quot;_NET_WM_STRUT/_NET_WM_STRUT_PARTIAL&quot; during insets
 218      * calculation.
 219      */
 220     private static Boolean checkSTRUT;
 221 
 222     static {
 223         initSecurityWarning();
 224         if (GraphicsEnvironment.isHeadless()) {
 225             localEnv = null;
 226             device = null;
 227             display = 0;
 228         } else {
 229             localEnv = (X11GraphicsEnvironment) GraphicsEnvironment
 230                 .getLocalGraphicsEnvironment();
 231             device = (X11GraphicsDevice) localEnv.getDefaultScreenDevice();
 232             display = device.getDisplay();
 233             setupModifierMap();
</pre>
<hr />
<pre>
 322                 XlibWrapper.DefaultScreen(XToolkit.getDisplay()));
 323 
 324             if (res == 0) {
 325                throw new IllegalStateException(&quot;Root window must not be null&quot;);
 326             }
 327             return res;
 328         } finally {
 329             awtUnlock();
 330         }
 331     }
 332 
 333     void init() {
 334         awtLock();
 335         try {
 336             XlibWrapper.XSupportsLocale();
 337             if (XlibWrapper.XSetLocaleModifiers(&quot;&quot;) == null) {
 338                 log.finer(&quot;X locale modifiers are not supported, using default&quot;);
 339             }
 340             tryXKB();
 341 



 342             arrowCursor = XlibWrapper.XCreateFontCursor(XToolkit.getDisplay(),
 343                 XCursorFontConstants.XC_arrow);
 344             final String extraButtons = &quot;sun.awt.enableExtraMouseButtons&quot;;
 345             AccessController.doPrivileged((PrivilegedAction&lt;Void&gt;) () -&gt; {
 346                 areExtraMouseButtonsEnabled =
 347                     Boolean.parseBoolean(System.getProperty(extraButtons, &quot;true&quot;));
 348                 //set system property if not yet assigned
 349                 System.setProperty(extraButtons, &quot;&quot;+areExtraMouseButtonsEnabled);
 350                 return null;
 351             });
 352             // Detect display mode changes
 353             XlibWrapper.XSelectInput(XToolkit.getDisplay(), XToolkit.getDefaultRootWindow(), XConstants.StructureNotifyMask);
 354             XToolkit.addEventDispatcher(XToolkit.getDefaultRootWindow(), new XEventDispatcher() {
 355                 @Override
 356                 public void dispatchEvent(XEvent ev) {
 357                     if (ev.get_type() == XConstants.ConfigureNotify) {
 358                         awtUnlock();
 359                         try {
 360                             ((X11GraphicsEnvironment)GraphicsEnvironment.
 361                              getLocalGraphicsEnvironment()).
</pre>
<hr />
<pre>
1472         } finally {
1473             awtUnlock();
1474         }
1475     }
1476 
1477     @Override
1478     public int getScreenResolution() {
1479         long display = getDisplay();
1480         awtLock();
1481         try {
1482             return (int) ((XlibWrapper.DisplayWidth(display,
1483                 XlibWrapper.DefaultScreen(display)) * 25.4) /
1484                     XlibWrapper.DisplayWidthMM(display,
1485                 XlibWrapper.DefaultScreen(display)));
1486         } finally {
1487             awtUnlock();
1488         }
1489     }
1490 
1491     static native long getDefaultXColormap();

1492 
1493     /**
1494      * Returns a new input method adapter descriptor for native input methods.
1495      */
1496     @Override
1497     public InputMethodDescriptor getInputMethodAdapterDescriptor() throws AWTException {
1498         return new XInputMethodDescriptor();
1499     }
1500 
1501     /**
1502      * Returns whether enableInputMethods should be set to true for peered
1503      * TextComponent instances on this platform. True by default.
1504      */
1505     @Override
1506     public boolean enableInputMethodsForTextComponent() {
1507         return true;
1508     }
1509 
1510     static int getMultiClickTime() {
1511         if (awt_multiclick_time == 0) {
</pre>
<hr />
<pre>
2153                     timeoutTaskLog.finer(&quot;XToolkit.callTimeoutTasks(): current time={0}&quot; +
2154                                          &quot;;  about to run task={1}&quot;, Long.valueOf(currentTime), task);
2155                 }
2156 
2157                 try {
2158                     task.run();
2159                 } catch (ThreadDeath td) {
2160                     throw td;
2161                 } catch (Throwable thr) {
2162                     processException(thr);
2163                 }
2164             }
2165 
2166             if (timeoutTasks.isEmpty()) {
2167                 break;
2168             }
2169             time = timeoutTasks.firstKey();
2170         }
2171     }
2172 




2173     static boolean isLeftMouseButton(MouseEvent me) {
2174         switch (me.getID()) {
2175           case MouseEvent.MOUSE_PRESSED:
2176           case MouseEvent.MOUSE_RELEASED:
2177               return (me.getButton() == MouseEvent.BUTTON1);
2178           case MouseEvent.MOUSE_ENTERED:
2179           case MouseEvent.MOUSE_EXITED:
2180           case MouseEvent.MOUSE_CLICKED:
2181           case MouseEvent.MOUSE_DRAGGED:
2182               return ((me.getModifiersEx() &amp; InputEvent.BUTTON1_DOWN_MASK) != 0);
2183         }
2184         return false;
2185     }
2186 
2187     static boolean isRightMouseButton(MouseEvent me) {
2188         int numButtons = ((Integer)getDefaultToolkit().getDesktopProperty(&quot;awt.mouse.numButtons&quot;)).intValue();
2189         switch (me.getID()) {
2190           case MouseEvent.MOUSE_PRESSED:
2191           case MouseEvent.MOUSE_RELEASED:
2192               return ((numButtons == 2 &amp;&amp; me.getButton() == MouseEvent.BUTTON2) ||
</pre>
</td>
</tr>
</table>
<center><a href="XIconWindow.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="XWindow.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>