<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/windows/native/libawt/windows/alloc.h</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="WPrinterJob.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="awt_DCHolder.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/windows/native/libawt/windows/alloc.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #ifndef _ALLOC_H_
 27 #define _ALLOC_H_
 28 
<span class="line-removed"> 29 /* Use THIS_FILE when it is available. */</span>
<span class="line-removed"> 30 #ifndef THIS_FILE</span>
<span class="line-removed"> 31     #define THIS_FILE __FILE__</span>
<span class="line-removed"> 32 #endif</span>
<span class="line-removed"> 33 </span>
 34 #include &quot;stdhdrs.h&quot;
 35 
 36 // By defining std::bad_alloc in a local header file instead of including
 37 // the Standard C++ &lt;new&gt; header file, we avoid making awt.dll dependent
 38 // on msvcp50.dll. This reduces the size of the JRE by 500kb.
 39 namespace std {
 40     class bad_alloc {};
 41 }
 42 
 43 #define SIZECALC_ALLOC_THROWING_BAD_ALLOC
 44 #include &quot;sizecalc.h&quot;
 45 
 46 class awt_toolkit_shutdown {};
 47 
 48 // Disable &quot;C++ Exception Specification ignored&quot; warnings.
 49 // These warnings are generated because VC++ 5.0 allows, but does not enforce,
 50 // exception specifications. This #pragma can be safely removed when VC++
 51 // is updated to enforce exception specifications.
 52 #pragma warning(disable : 4290)
 53 
</pre>
<hr />
<pre>
118 // This function throws awt_toolkit_shutdown if the Toolkit is not active
119 void throw_if_shutdown(void) throw (awt_toolkit_shutdown);
120 
121 // This function is called when a std::bad_alloc exception is caught
122 void handle_bad_alloc(void);
123 
124 // Uncomment to nondeterministically test OutOfMemory errors
125 // #define OUTOFMEM_TEST
126 
127 #ifdef OUTOFMEM_TEST
128     void *safe_Malloc_outofmem(size_t size, const char *, int)
129         throw (std::bad_alloc);
130     void *safe_Calloc_outofmem(size_t num, size_t size, const char *, int)
131         throw (std::bad_alloc);
132     void *safe_Realloc_outofmem(void *memblock, size_t size, const char *, int)
133         throw (std::bad_alloc);
134     void * CDECL operator new(size_t size, const char *, int)
135         throw (std::bad_alloc);
136 
137     #define safe_Malloc(size) \
<span class="line-modified">138         safe_Malloc_outofmem(size, THIS_FILE, __LINE__)</span>
139     #define safe_Calloc(num, size) \
<span class="line-modified">140         safe_Calloc_outofmem(num, size, THIS_FILE, __LINE__)</span>
141     #define safe_Realloc(memblock, size) \
<span class="line-modified">142         safe_Realloc_outofmem(memblock, size, THIS_FILE, __LINE__)</span>
<span class="line-modified">143     #define new new(THIS_FILE, __LINE__)</span>
144 #endif /* OUTOFMEM_TEST */
145 
146 #define TRY \
147     try { \
148         entry_point(); \
149         hang_if_shutdown();
150 // The _NO_HANG version of TRY causes the AWT native code to return to Java
151 // immediately if the Toolkit is not active. Normal AWT operations should
152 // never use this macro. It should only be used for cleanup routines where:
153 // (1) Hanging is not a valid option, because the method is called during
154 // execution of runFinalizersOnExit; and, (2) Execution of the method would
155 // generate a NullPointerException or other Exception.
156 #define TRY_NO_HANG \
157     try { \
158         entry_point(); \
159         throw_if_shutdown();
160 // The _NO_VERIFY version of TRY does not verify that the Toolkit is still
161 // active before proceeding. Normal AWT operations should never use this
162 // macro. It should only be used for cleanup routines which can safely
163 // execute after the Toolkit is disposed, and then only with caution. Users
</pre>
</td>
<td>
<hr />
<pre>
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #ifndef _ALLOC_H_
 27 #define _ALLOC_H_
 28 





 29 #include &quot;stdhdrs.h&quot;
 30 
 31 // By defining std::bad_alloc in a local header file instead of including
 32 // the Standard C++ &lt;new&gt; header file, we avoid making awt.dll dependent
 33 // on msvcp50.dll. This reduces the size of the JRE by 500kb.
 34 namespace std {
 35     class bad_alloc {};
 36 }
 37 
 38 #define SIZECALC_ALLOC_THROWING_BAD_ALLOC
 39 #include &quot;sizecalc.h&quot;
 40 
 41 class awt_toolkit_shutdown {};
 42 
 43 // Disable &quot;C++ Exception Specification ignored&quot; warnings.
 44 // These warnings are generated because VC++ 5.0 allows, but does not enforce,
 45 // exception specifications. This #pragma can be safely removed when VC++
 46 // is updated to enforce exception specifications.
 47 #pragma warning(disable : 4290)
 48 
</pre>
<hr />
<pre>
113 // This function throws awt_toolkit_shutdown if the Toolkit is not active
114 void throw_if_shutdown(void) throw (awt_toolkit_shutdown);
115 
116 // This function is called when a std::bad_alloc exception is caught
117 void handle_bad_alloc(void);
118 
119 // Uncomment to nondeterministically test OutOfMemory errors
120 // #define OUTOFMEM_TEST
121 
122 #ifdef OUTOFMEM_TEST
123     void *safe_Malloc_outofmem(size_t size, const char *, int)
124         throw (std::bad_alloc);
125     void *safe_Calloc_outofmem(size_t num, size_t size, const char *, int)
126         throw (std::bad_alloc);
127     void *safe_Realloc_outofmem(void *memblock, size_t size, const char *, int)
128         throw (std::bad_alloc);
129     void * CDECL operator new(size_t size, const char *, int)
130         throw (std::bad_alloc);
131 
132     #define safe_Malloc(size) \
<span class="line-modified">133         safe_Malloc_outofmem(size, __FILE__, __LINE__)</span>
134     #define safe_Calloc(num, size) \
<span class="line-modified">135         safe_Calloc_outofmem(num, size, __FILE__, __LINE__)</span>
136     #define safe_Realloc(memblock, size) \
<span class="line-modified">137         safe_Realloc_outofmem(memblock, size, __FILE__, __LINE__)</span>
<span class="line-modified">138     #define new new(__FILE__, __LINE__)</span>
139 #endif /* OUTOFMEM_TEST */
140 
141 #define TRY \
142     try { \
143         entry_point(); \
144         hang_if_shutdown();
145 // The _NO_HANG version of TRY causes the AWT native code to return to Java
146 // immediately if the Toolkit is not active. Normal AWT operations should
147 // never use this macro. It should only be used for cleanup routines where:
148 // (1) Hanging is not a valid option, because the method is called during
149 // execution of runFinalizersOnExit; and, (2) Execution of the method would
150 // generate a NullPointerException or other Exception.
151 #define TRY_NO_HANG \
152     try { \
153         entry_point(); \
154         throw_if_shutdown();
155 // The _NO_VERIFY version of TRY does not verify that the Toolkit is still
156 // active before proceeding. Normal AWT operations should never use this
157 // macro. It should only be used for cleanup routines which can safely
158 // execute after the Toolkit is disposed, and then only with caution. Users
</pre>
</td>
</tr>
</table>
<center><a href="WPrinterJob.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="awt_DCHolder.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>