<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/windows/classes/sun/print/PrintServiceLookupProvider.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../awt/windows/WPathGraphics.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../native/libawt/java2d/d3d/D3DPipeline.h.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/windows/classes/sun/print/PrintServiceLookupProvider.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -23,14 +23,14 @@</span>
   * questions.
   */
  
  package sun.print;
  
<span class="udiff-line-removed">- import java.security.AccessController;</span>
  import java.util.ArrayList;
  import java.util.Arrays;
  import java.util.Comparator;
<span class="udiff-line-added">+ </span>
  import javax.print.DocFlavor;
  import javax.print.MultiDocPrintService;
  import javax.print.PrintService;
  import javax.print.PrintServiceLookup;
  import javax.print.attribute.Attribute;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -118,17 +118,10 @@</span>
      public PrintServiceLookupProvider() {
  
          if (win32PrintLUS == null) {
              win32PrintLUS = this;
  
<span class="udiff-line-removed">-             String osName = AccessController.doPrivileged(</span>
<span class="udiff-line-removed">-                 new sun.security.action.GetPropertyAction(&quot;os.name&quot;));</span>
<span class="udiff-line-removed">-             // There&#39;s no capability for Win98 to refresh printers.</span>
<span class="udiff-line-removed">-             // See &quot;OpenPrinter&quot; for more info.</span>
<span class="udiff-line-removed">-             if (osName != null &amp;&amp; osName.startsWith(&quot;Windows 98&quot;)) {</span>
<span class="udiff-line-removed">-                 return;</span>
<span class="udiff-line-removed">-             }</span>
              // start the local printer listener thread
              Thread thr = new Thread(null, new PrinterChangeListener(),
                                      &quot;PrinterListener&quot;, 0, false);
              thr.setDaemon(true);
              thr.start();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -354,33 +347,14 @@</span>
              defaultPrintService = new Win32PrintService(defaultPrinter);
          }
          return defaultPrintService;
      }
  
<span class="udiff-line-modified-removed">-     class PrinterChangeListener implements Runnable {</span>
<span class="udiff-line-removed">-         long chgObj;</span>
<span class="udiff-line-removed">-         PrinterChangeListener() {</span>
<span class="udiff-line-removed">-             chgObj = notifyFirstPrinterChange(null);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-modified-added">+     private final class PrinterChangeListener implements Runnable {</span>
          @Override
          public void run() {
<span class="udiff-line-modified-removed">-             if (chgObj != -1) {</span>
<span class="udiff-line-removed">-                 while (true) {</span>
<span class="udiff-line-removed">-                     // wait for configuration to change</span>
<span class="udiff-line-removed">-                     if (notifyPrinterChange(chgObj) != 0) {</span>
<span class="udiff-line-removed">-                         try {</span>
<span class="udiff-line-removed">-                             refreshServices();</span>
<span class="udiff-line-removed">-                         } catch (SecurityException se) {</span>
<span class="udiff-line-removed">-                             break;</span>
<span class="udiff-line-removed">-                         }</span>
<span class="udiff-line-removed">-                     } else {</span>
<span class="udiff-line-removed">-                         notifyClosePrinterChange(chgObj);</span>
<span class="udiff-line-removed">-                         break;</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-modified-added">+             notifyLocalPrinterChange(); // busy loop in the native code</span>
          }
      }
  
      /* Windows provides *PrinterChangeNotification* functions that provides
         information about printer status changes of the local printers but not
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -444,10 +418,8 @@</span>
          }
      }
  
      private native String getDefaultPrinterName();
      private native String[] getAllPrinterNames();
<span class="udiff-line-modified-removed">-     private native long notifyFirstPrinterChange(String printer);</span>
<span class="udiff-line-removed">-     private native void notifyClosePrinterChange(long chgObj);</span>
<span class="udiff-line-removed">-     private native int notifyPrinterChange(long chgObj);</span>
<span class="udiff-line-modified-added">+     private native void notifyLocalPrinterChange();</span>
      private native String[] getRemotePrintersNames();
  }
</pre>
<center><a href="../awt/windows/WPathGraphics.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../native/libawt/java2d/d3d/D3DPipeline.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>