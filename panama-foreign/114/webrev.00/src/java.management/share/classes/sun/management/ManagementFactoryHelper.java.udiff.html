<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.management/share/classes/sun/management/ManagementFactoryHelper.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../java.instrument/unix/native/libinstrument/EncodingSupport_md.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../../java.security.jgss/share/classes/sun/security/krb5/Checksum.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.management/share/classes/sun/management/ManagementFactoryHelper.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -37,12 +37,13 @@</span>
  import javax.management.RuntimeOperationsException;
  import java.security.AccessController;
  import java.security.PrivilegedActionException;
  import java.security.PrivilegedExceptionAction;
  
<span class="udiff-line-removed">- import jdk.internal.access.JavaNioAccess;</span>
  import jdk.internal.access.SharedSecrets;
<span class="udiff-line-added">+ import jdk.internal.misc.VM;</span>
<span class="udiff-line-added">+ import jdk.internal.misc.VM.BufferPool;</span>
  
  import java.util.ArrayList;
  import java.util.List;
  
  import java.lang.reflect.UndeclaredThrowableException;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -50,10 +51,11 @@</span>
  import java.util.Arrays;
  import java.util.Collections;
  import java.util.HashMap;
  import java.util.Map;
  import java.util.Optional;
<span class="udiff-line-added">+ import java.util.stream.Collectors;</span>
  
  /**
   * ManagementFactoryHelper provides static factory methods to create
   * instances of the management interface.
   */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -335,31 +337,31 @@</span>
           }
  
          static final PlatformLoggingMXBean MBEAN = getInstance();
      }
  
<span class="udiff-line-modified-removed">-     private static List&lt;BufferPoolMXBean&gt; bufferPools = null;</span>
<span class="udiff-line-modified-removed">-     public static synchronized List&lt;BufferPoolMXBean&gt; getBufferPoolMXBeans() {</span>
<span class="udiff-line-modified-added">+     private static volatile List&lt;BufferPoolMXBean&gt; bufferPools;</span>
<span class="udiff-line-modified-added">+     public static List&lt;BufferPoolMXBean&gt; getBufferPoolMXBeans() {</span>
          if (bufferPools == null) {
<span class="udiff-line-modified-removed">-             bufferPools = new ArrayList&lt;&gt;(2);</span>
<span class="udiff-line-modified-removed">-             bufferPools.add(createBufferPoolMXBean(SharedSecrets.getJavaNioAccess()</span>
<span class="udiff-line-modified-removed">-                 .getDirectBufferPool()));</span>
<span class="udiff-line-modified-removed">-             bufferPools.add(createBufferPoolMXBean(sun.nio.ch.FileChannelImpl</span>
<span class="udiff-line-modified-removed">-                 .getMappedBufferPool()));</span>
<span class="udiff-line-modified-removed">-             bufferPools.add(createBufferPoolMXBean(sun.nio.ch.FileChannelImpl</span>
<span class="udiff-line-modified-removed">-                 .getSyncMappedBufferPool()));</span>
<span class="udiff-line-modified-added">+             synchronized (ManagementFactoryHelper.class) {</span>
<span class="udiff-line-modified-added">+                 if (bufferPools == null) {</span>
<span class="udiff-line-modified-added">+                     bufferPools = VM.getBufferPools().stream()</span>
<span class="udiff-line-modified-added">+                                     .map(ManagementFactoryHelper::createBufferPoolMXBean)</span>
<span class="udiff-line-modified-added">+                                     .collect(Collectors.toList());</span>
<span class="udiff-line-modified-added">+                 }</span>
<span class="udiff-line-modified-added">+             }</span>
          }
          return bufferPools;
      }
  
      private final static String BUFFER_POOL_MXBEAN_NAME = &quot;java.nio:type=BufferPool&quot;;
  
      /**
       * Creates management interface for the given buffer pool.
       */
      private static BufferPoolMXBean
<span class="udiff-line-modified-removed">-         createBufferPoolMXBean(final JavaNioAccess.BufferPool pool)</span>
<span class="udiff-line-modified-added">+         createBufferPoolMXBean(final BufferPool pool)</span>
      {
          return new BufferPoolMXBean() {
              private volatile ObjectName objname;  // created lazily
              @Override
              public ObjectName getObjectName() {
</pre>
<center><a href="../../../../../java.instrument/unix/native/libinstrument/EncodingSupport_md.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../../java.security.jgss/share/classes/sun/security/krb5/Checksum.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>