<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/shenandoah/shenandoahMarkCompact.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahHeap.inline.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahNMethod.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/shenandoahMarkCompact.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  58 
  59 ShenandoahMarkCompact::ShenandoahMarkCompact() :
  60   _gc_timer(NULL),
  61   _preserved_marks(new PreservedMarksSet(true)) {}
  62 
  63 void ShenandoahMarkCompact::initialize(GCTimer* gc_timer) {
  64   _gc_timer = gc_timer;
  65 }
  66 
  67 void ShenandoahMarkCompact::do_it(GCCause::Cause gc_cause) {
  68   ShenandoahHeap* heap = ShenandoahHeap::heap();
  69 
  70   if (ShenandoahVerify) {
  71     heap-&gt;verifier()-&gt;verify_before_fullgc();
  72   }
  73 
  74   if (VerifyBeforeGC) {
  75     Universe::verify();
  76   }
  77 
<span class="line-modified">  78   // Degenerated GC may carry concurrent_root_in_progress flag when upgrading to</span>
  79   // full GC. We need to reset it before mutators resume.
  80   if (ShenandoahConcurrentRoots::can_do_concurrent_class_unloading()) {
<span class="line-modified">  81     heap-&gt;set_concurrent_root_in_progress(false);</span>

  82   }
  83 
  84   heap-&gt;set_full_gc_in_progress(true);
  85 
  86   assert(ShenandoahSafepoint::is_at_shenandoah_safepoint(), &quot;must be at a safepoint&quot;);
  87   assert(Thread::current()-&gt;is_VM_thread(), &quot;Do full GC only while world is stopped&quot;);
  88 
  89   {
  90     ShenandoahGCPhase phase(ShenandoahPhaseTimings::full_gc_heapdumps);
  91     heap-&gt;pre_full_gc_dump(_gc_timer);
  92   }
  93 
  94   {
  95     ShenandoahGCPhase prepare_phase(ShenandoahPhaseTimings::full_gc_prepare);
  96     // Full GC is supposed to recover from any GC state:
  97 
  98     // a0. Remember if we have forwarded objects
  99     bool has_forwarded_objects = heap-&gt;has_forwarded_objects();
 100 
 101     // a1. Cancel evacuation, if in progress
</pre>
</td>
<td>
<hr />
<pre>
  58 
  59 ShenandoahMarkCompact::ShenandoahMarkCompact() :
  60   _gc_timer(NULL),
  61   _preserved_marks(new PreservedMarksSet(true)) {}
  62 
  63 void ShenandoahMarkCompact::initialize(GCTimer* gc_timer) {
  64   _gc_timer = gc_timer;
  65 }
  66 
  67 void ShenandoahMarkCompact::do_it(GCCause::Cause gc_cause) {
  68   ShenandoahHeap* heap = ShenandoahHeap::heap();
  69 
  70   if (ShenandoahVerify) {
  71     heap-&gt;verifier()-&gt;verify_before_fullgc();
  72   }
  73 
  74   if (VerifyBeforeGC) {
  75     Universe::verify();
  76   }
  77 
<span class="line-modified">  78   // Degenerated GC may carry concurrent root flags when upgrading to</span>
  79   // full GC. We need to reset it before mutators resume.
  80   if (ShenandoahConcurrentRoots::can_do_concurrent_class_unloading()) {
<span class="line-modified">  81     heap-&gt;set_concurrent_strong_root_in_progress(false);</span>
<span class="line-added">  82     heap-&gt;set_concurrent_weak_root_in_progress(false);</span>
  83   }
  84 
  85   heap-&gt;set_full_gc_in_progress(true);
  86 
  87   assert(ShenandoahSafepoint::is_at_shenandoah_safepoint(), &quot;must be at a safepoint&quot;);
  88   assert(Thread::current()-&gt;is_VM_thread(), &quot;Do full GC only while world is stopped&quot;);
  89 
  90   {
  91     ShenandoahGCPhase phase(ShenandoahPhaseTimings::full_gc_heapdumps);
  92     heap-&gt;pre_full_gc_dump(_gc_timer);
  93   }
  94 
  95   {
  96     ShenandoahGCPhase prepare_phase(ShenandoahPhaseTimings::full_gc_prepare);
  97     // Full GC is supposed to recover from any GC state:
  98 
  99     // a0. Remember if we have forwarded objects
 100     bool has_forwarded_objects = heap-&gt;has_forwarded_objects();
 101 
 102     // a1. Cancel evacuation, if in progress
</pre>
</td>
</tr>
</table>
<center><a href="shenandoahHeap.inline.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahNMethod.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>