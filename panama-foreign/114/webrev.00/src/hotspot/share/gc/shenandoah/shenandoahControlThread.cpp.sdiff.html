<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/shenandoah/shenandoahControlThread.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahCodeRoots.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahFreeSet.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/shenandoahControlThread.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
325   ShenandoahGCSession session(cause);
326 
327   TraceCollectorStats tcs(heap-&gt;monitoring_support()-&gt;concurrent_collection_counters());
328 
329   // Reset for upcoming marking
330   heap-&gt;entry_reset();
331 
332   // Start initial mark under STW
333   heap-&gt;vmop_entry_init_mark();
334 
335   // Continue concurrent mark
336   heap-&gt;entry_mark();
337   if (check_cancellation_or_degen(ShenandoahHeap::_degenerated_mark)) return;
338 
339   // If not cancelled, can try to concurrently pre-clean
340   heap-&gt;entry_preclean();
341 
342   // Complete marking under STW, and start evacuation
343   heap-&gt;vmop_entry_final_mark();
344 
<span class="line-modified">345   // Evacuate concurrent roots</span>
<span class="line-modified">346   heap-&gt;entry_roots();</span>
347 
348   // Final mark might have reclaimed some immediate garbage, kick cleanup to reclaim
349   // the space. This would be the last action if there is nothing to evacuate.
350   heap-&gt;entry_cleanup();
351 
352   {
353     ShenandoahHeapLocker locker(heap-&gt;lock());
354     heap-&gt;free_set()-&gt;log_status();
355   }
356 







357   // Continue the cycle with evacuation and optional update-refs.
358   // This may be skipped if there is nothing to evacuate.
359   // If so, evac_in_progress would be unset by collection set preparation code.
360   if (heap-&gt;is_evacuation_in_progress()) {
361     // Concurrently evacuate
362     heap-&gt;entry_evac();
363     if (check_cancellation_or_degen(ShenandoahHeap::_degenerated_evac)) return;
364 
365     // Perform update-refs phase.
366     heap-&gt;vmop_entry_init_updaterefs();
367     heap-&gt;entry_updaterefs();
368     if (check_cancellation_or_degen(ShenandoahHeap::_degenerated_updaterefs)) return;
369 
370     heap-&gt;vmop_entry_final_updaterefs();
371 
372     // Update references freed up collection set, kick the cleanup to reclaim the space.
373     heap-&gt;entry_cleanup();
374   }
375 
376   // Cycle is complete
</pre>
</td>
<td>
<hr />
<pre>
325   ShenandoahGCSession session(cause);
326 
327   TraceCollectorStats tcs(heap-&gt;monitoring_support()-&gt;concurrent_collection_counters());
328 
329   // Reset for upcoming marking
330   heap-&gt;entry_reset();
331 
332   // Start initial mark under STW
333   heap-&gt;vmop_entry_init_mark();
334 
335   // Continue concurrent mark
336   heap-&gt;entry_mark();
337   if (check_cancellation_or_degen(ShenandoahHeap::_degenerated_mark)) return;
338 
339   // If not cancelled, can try to concurrently pre-clean
340   heap-&gt;entry_preclean();
341 
342   // Complete marking under STW, and start evacuation
343   heap-&gt;vmop_entry_final_mark();
344 
<span class="line-modified">345   // Process weak roots that might still point to regions that would be broken by cleanup</span>
<span class="line-modified">346   heap-&gt;entry_weak_roots();</span>
347 
348   // Final mark might have reclaimed some immediate garbage, kick cleanup to reclaim
349   // the space. This would be the last action if there is nothing to evacuate.
350   heap-&gt;entry_cleanup();
351 
352   {
353     ShenandoahHeapLocker locker(heap-&gt;lock());
354     heap-&gt;free_set()-&gt;log_status();
355   }
356 
<span class="line-added">357   // Processing strong roots</span>
<span class="line-added">358   // This may be skipped if there is nothing to update/evacuate.</span>
<span class="line-added">359   // If so, strong_root_in_progress would be unset.</span>
<span class="line-added">360   if (heap-&gt;is_concurrent_strong_root_in_progress()) {</span>
<span class="line-added">361     heap-&gt;entry_strong_roots();</span>
<span class="line-added">362   }</span>
<span class="line-added">363 </span>
364   // Continue the cycle with evacuation and optional update-refs.
365   // This may be skipped if there is nothing to evacuate.
366   // If so, evac_in_progress would be unset by collection set preparation code.
367   if (heap-&gt;is_evacuation_in_progress()) {
368     // Concurrently evacuate
369     heap-&gt;entry_evac();
370     if (check_cancellation_or_degen(ShenandoahHeap::_degenerated_evac)) return;
371 
372     // Perform update-refs phase.
373     heap-&gt;vmop_entry_init_updaterefs();
374     heap-&gt;entry_updaterefs();
375     if (check_cancellation_or_degen(ShenandoahHeap::_degenerated_updaterefs)) return;
376 
377     heap-&gt;vmop_entry_final_updaterefs();
378 
379     // Update references freed up collection set, kick the cleanup to reclaim the space.
380     heap-&gt;entry_cleanup();
381   }
382 
383   // Cycle is complete
</pre>
</td>
</tr>
</table>
<center><a href="shenandoahCodeRoots.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahFreeSet.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>