<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/c1/c1_Runtime1.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="c1_LinearScan.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../ci/bcEscapeAnalyzer.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/c1/c1_Runtime1.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 682 JRT_END
 683 
 684 
 685 JRT_ENTRY(void, Runtime1::throw_class_cast_exception(JavaThread* thread, oopDesc* object))
 686   NOT_PRODUCT(_throw_class_cast_exception_count++;)
 687   ResourceMark rm(thread);
 688   char* message = SharedRuntime::generate_class_cast_message(
 689     thread, object-&gt;klass());
 690   SharedRuntime::throw_and_post_jvmti_exception(
 691     thread, vmSymbols::java_lang_ClassCastException(), message);
 692 JRT_END
 693 
 694 
 695 JRT_ENTRY(void, Runtime1::throw_incompatible_class_change_error(JavaThread* thread))
 696   NOT_PRODUCT(_throw_incompatible_class_change_error_count++;)
 697   ResourceMark rm(thread);
 698   SharedRuntime::throw_and_post_jvmti_exception(thread, vmSymbols::java_lang_IncompatibleClassChangeError());
 699 JRT_END
 700 
 701 
<span class="line-modified"> 702 JRT_ENTRY_NO_ASYNC(void, Runtime1::monitorenter(JavaThread* thread, oopDesc* obj, BasicObjectLock* lock))</span>
 703   NOT_PRODUCT(_monitorenter_slowcase_cnt++;)
<span class="line-removed"> 704   if (PrintBiasedLockingStatistics) {</span>
<span class="line-removed"> 705     Atomic::inc(BiasedLocking::slow_path_entry_count_addr());</span>
<span class="line-removed"> 706   }</span>
<span class="line-removed"> 707   Handle h_obj(thread, obj);</span>
 708   if (!UseFastLocking) {
 709     lock-&gt;set_obj(obj);
 710   }
 711   assert(obj == lock-&gt;obj(), &quot;must match&quot;);
<span class="line-modified"> 712   ObjectSynchronizer::enter(h_obj, lock-&gt;lock(), THREAD);</span>
 713 JRT_END
 714 
 715 
 716 JRT_LEAF(void, Runtime1::monitorexit(JavaThread* thread, BasicObjectLock* lock))
 717   NOT_PRODUCT(_monitorexit_slowcase_cnt++;)
<span class="line-removed"> 718   assert(thread == JavaThread::current(), &quot;threads must correspond&quot;);</span>
 719   assert(thread-&gt;last_Java_sp(), &quot;last_Java_sp must be set&quot;);
<span class="line-removed"> 720   // monitorexit is non-blocking (leaf routine) =&gt; no exceptions can be thrown</span>
<span class="line-removed"> 721   EXCEPTION_MARK;</span>
<span class="line-removed"> 722 </span>
 723   oop obj = lock-&gt;obj();
 724   assert(oopDesc::is_oop(obj), &quot;must be NULL or an object&quot;);
<span class="line-modified"> 725   ObjectSynchronizer::exit(obj, lock-&gt;lock(), THREAD);</span>
 726 JRT_END
 727 
 728 // Cf. OptoRuntime::deoptimize_caller_frame
 729 JRT_ENTRY(void, Runtime1::deoptimize(JavaThread* thread, jint trap_request))
 730   // Called from within the owner thread, so no need for safepoint
 731   RegisterMap reg_map(thread, false);
 732   frame stub_frame = thread-&gt;last_frame();
 733   assert(stub_frame.is_runtime_frame(), &quot;Sanity check&quot;);
 734   frame caller_frame = stub_frame.sender(&amp;reg_map);
 735   nmethod* nm = caller_frame.cb()-&gt;as_nmethod_or_null();
 736   assert(nm != NULL, &quot;Sanity check&quot;);
 737   methodHandle method(thread, nm-&gt;method());
 738   assert(nm == CodeCache::find_nmethod(caller_frame.pc()), &quot;Should be the same&quot;);
 739   Deoptimization::DeoptAction action = Deoptimization::trap_request_action(trap_request);
 740   Deoptimization::DeoptReason reason = Deoptimization::trap_request_reason(trap_request);
 741 
 742   if (action == Deoptimization::Action_make_not_entrant) {
 743     if (nm-&gt;make_not_entrant()) {
 744       if (reason == Deoptimization::Reason_tenured) {
 745         MethodData* trap_mdo = Deoptimization::get_method_data(thread, method, true /*create_if_missing*/);
</pre>
</td>
<td>
<hr />
<pre>
 682 JRT_END
 683 
 684 
 685 JRT_ENTRY(void, Runtime1::throw_class_cast_exception(JavaThread* thread, oopDesc* object))
 686   NOT_PRODUCT(_throw_class_cast_exception_count++;)
 687   ResourceMark rm(thread);
 688   char* message = SharedRuntime::generate_class_cast_message(
 689     thread, object-&gt;klass());
 690   SharedRuntime::throw_and_post_jvmti_exception(
 691     thread, vmSymbols::java_lang_ClassCastException(), message);
 692 JRT_END
 693 
 694 
 695 JRT_ENTRY(void, Runtime1::throw_incompatible_class_change_error(JavaThread* thread))
 696   NOT_PRODUCT(_throw_incompatible_class_change_error_count++;)
 697   ResourceMark rm(thread);
 698   SharedRuntime::throw_and_post_jvmti_exception(thread, vmSymbols::java_lang_IncompatibleClassChangeError());
 699 JRT_END
 700 
 701 
<span class="line-modified"> 702 JRT_BLOCK_ENTRY(void, Runtime1::monitorenter(JavaThread* thread, oopDesc* obj, BasicObjectLock* lock))</span>
 703   NOT_PRODUCT(_monitorenter_slowcase_cnt++;)




 704   if (!UseFastLocking) {
 705     lock-&gt;set_obj(obj);
 706   }
 707   assert(obj == lock-&gt;obj(), &quot;must match&quot;);
<span class="line-modified"> 708   SharedRuntime::monitor_enter_helper(obj, lock-&gt;lock(), thread);</span>
 709 JRT_END
 710 
 711 
 712 JRT_LEAF(void, Runtime1::monitorexit(JavaThread* thread, BasicObjectLock* lock))
 713   NOT_PRODUCT(_monitorexit_slowcase_cnt++;)

 714   assert(thread-&gt;last_Java_sp(), &quot;last_Java_sp must be set&quot;);



 715   oop obj = lock-&gt;obj();
 716   assert(oopDesc::is_oop(obj), &quot;must be NULL or an object&quot;);
<span class="line-modified"> 717   SharedRuntime::monitor_exit_helper(obj, lock-&gt;lock(), thread);</span>
 718 JRT_END
 719 
 720 // Cf. OptoRuntime::deoptimize_caller_frame
 721 JRT_ENTRY(void, Runtime1::deoptimize(JavaThread* thread, jint trap_request))
 722   // Called from within the owner thread, so no need for safepoint
 723   RegisterMap reg_map(thread, false);
 724   frame stub_frame = thread-&gt;last_frame();
 725   assert(stub_frame.is_runtime_frame(), &quot;Sanity check&quot;);
 726   frame caller_frame = stub_frame.sender(&amp;reg_map);
 727   nmethod* nm = caller_frame.cb()-&gt;as_nmethod_or_null();
 728   assert(nm != NULL, &quot;Sanity check&quot;);
 729   methodHandle method(thread, nm-&gt;method());
 730   assert(nm == CodeCache::find_nmethod(caller_frame.pc()), &quot;Should be the same&quot;);
 731   Deoptimization::DeoptAction action = Deoptimization::trap_request_action(trap_request);
 732   Deoptimization::DeoptReason reason = Deoptimization::trap_request_reason(trap_request);
 733 
 734   if (action == Deoptimization::Action_make_not_entrant) {
 735     if (nm-&gt;make_not_entrant()) {
 736       if (reason == Deoptimization::Reason_tenured) {
 737         MethodData* trap_mdo = Deoptimization::get_method_data(thread, method, true /*create_if_missing*/);
</pre>
</td>
</tr>
</table>
<center><a href="c1_LinearScan.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../ci/bcEscapeAnalyzer.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>