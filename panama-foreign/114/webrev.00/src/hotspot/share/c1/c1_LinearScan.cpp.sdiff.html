<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/c1/c1_LinearScan.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../aot/aotLoader.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="c1_Runtime1.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/c1/c1_LinearScan.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 220       // the hole because of the alignment is filled with the next single-word value
 221       assert(_unused_spill_slot == -1, &quot;wasting a spill slot&quot;);
 222       _unused_spill_slot = _max_spills;
 223       _max_spills++;
 224     }
 225     spill_slot = _max_spills;
 226     _max_spills += 2;
 227 
 228   } else if (_unused_spill_slot != -1) {
 229     // re-use hole that was the result of a previous double-word alignment
 230     spill_slot = _unused_spill_slot;
 231     _unused_spill_slot = -1;
 232 
 233   } else {
 234     spill_slot = _max_spills;
 235     _max_spills++;
 236   }
 237 
 238   int result = spill_slot + LinearScan::nof_regs + frame_map()-&gt;argcount();
 239 
<span class="line-modified"> 240   // the class OopMapValue uses only 11 bits for storing the name of the</span>
<span class="line-removed"> 241   // oop location. So a stack slot bigger than 2^11 leads to an overflow</span>
<span class="line-removed"> 242   // that is not reported in product builds. Prevent this by checking the</span>
<span class="line-removed"> 243   // spill slot here (altough this value and the later used location name</span>
<span class="line-removed"> 244   // are slightly different)</span>
 245   if (result &gt; 2000) {
 246     bailout(&quot;too many stack slots used&quot;);
 247   }
 248 
 249   return result;
 250 }
 251 
 252 void LinearScan::assign_spill_slot(Interval* it) {
 253   // assign the canonical spill slot of the parent (if a part of the interval
 254   // is already spilled) or allocate a new spill slot
 255   if (it-&gt;canonical_spill_slot() &gt;= 0) {
 256     it-&gt;assign_reg(it-&gt;canonical_spill_slot());
 257   } else {
 258     int spill = allocate_spill_slot(type2spill_size[it-&gt;type()] == 2);
 259     it-&gt;set_canonical_spill_slot(spill);
 260     it-&gt;assign_reg(spill);
 261   }
 262 }
 263 
 264 void LinearScan::propagate_spill_slots() {
</pre>
</td>
<td>
<hr />
<pre>
 220       // the hole because of the alignment is filled with the next single-word value
 221       assert(_unused_spill_slot == -1, &quot;wasting a spill slot&quot;);
 222       _unused_spill_slot = _max_spills;
 223       _max_spills++;
 224     }
 225     spill_slot = _max_spills;
 226     _max_spills += 2;
 227 
 228   } else if (_unused_spill_slot != -1) {
 229     // re-use hole that was the result of a previous double-word alignment
 230     spill_slot = _unused_spill_slot;
 231     _unused_spill_slot = -1;
 232 
 233   } else {
 234     spill_slot = _max_spills;
 235     _max_spills++;
 236   }
 237 
 238   int result = spill_slot + LinearScan::nof_regs + frame_map()-&gt;argcount();
 239 
<span class="line-modified"> 240   // if too many slots used, bailout compilation.</span>




 241   if (result &gt; 2000) {
 242     bailout(&quot;too many stack slots used&quot;);
 243   }
 244 
 245   return result;
 246 }
 247 
 248 void LinearScan::assign_spill_slot(Interval* it) {
 249   // assign the canonical spill slot of the parent (if a part of the interval
 250   // is already spilled) or allocate a new spill slot
 251   if (it-&gt;canonical_spill_slot() &gt;= 0) {
 252     it-&gt;assign_reg(it-&gt;canonical_spill_slot());
 253   } else {
 254     int spill = allocate_spill_slot(type2spill_size[it-&gt;type()] == 2);
 255     it-&gt;set_canonical_spill_slot(spill);
 256     it-&gt;assign_reg(spill);
 257   }
 258 }
 259 
 260 void LinearScan::propagate_spill_slots() {
</pre>
</td>
</tr>
</table>
<center><a href="../aot/aotLoader.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="c1_Runtime1.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>