<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/utilities/exceptions.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../runtime/sharedRuntime.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="exceptions.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/utilities/exceptions.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1998, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
</pre>
<hr />
<pre>
384 // encoding scheme of the string into account. One thing we should do at some
385 // point is to push this flag down to class java_lang_String since other
386 // classes may need similar functionalities.
387 Handle Exceptions::new_exception(Thread* thread, Symbol* name,
388                                  const char* message,
389                                  ExceptionMsgToUtf8Mode to_utf8_safe) {
390 
391   Handle       h_loader(thread, NULL);
392   Handle       h_prot(thread, NULL);
393   Handle       h_cause(thread, NULL);
394   return Exceptions::new_exception(thread, name, message, h_cause, h_loader,
395                                    h_prot, to_utf8_safe);
396 }
397 
398 // invokedynamic uses wrap_dynamic_exception for:
399 //    - bootstrap method resolution
400 //    - post call to MethodHandleNatives::linkCallSite
401 // dynamically computed constant uses wrap_dynamic_exception for:
402 //    - bootstrap method resolution
403 //    - post call to MethodHandleNatives::linkDynamicConstant
<span class="line-modified">404 void Exceptions::wrap_dynamic_exception(Thread* THREAD) {</span>
405   if (THREAD-&gt;has_pending_exception()) {










406     oop exception = THREAD-&gt;pending_exception();

407     // See the &quot;Linking Exceptions&quot; section for the invokedynamic instruction
408     // in JVMS 6.5.
409     if (exception-&gt;is_a(SystemDictionary::Error_klass())) {
410       // Pass through an Error, including BootstrapMethodError, any other form
411       // of linkage error, or say ThreadDeath/OutOfMemoryError
<span class="line-modified">412       if (TraceMethodHandles) {</span>
<span class="line-modified">413         tty-&gt;print_cr(&quot;bootstrap method invocation wraps BSME around &quot; INTPTR_FORMAT, p2i((void *)exception));</span>
<span class="line-modified">414         exception-&gt;print();</span>
415       }
416       return;
417     }
418 
419     // Otherwise wrap the exception in a BootstrapMethodError
<span class="line-modified">420     if (TraceMethodHandles) {</span>
<span class="line-modified">421       tty-&gt;print_cr(&quot;[constant/invoke]dynamic throws BSME for &quot; INTPTR_FORMAT, p2i((void *)exception));</span>
<span class="line-modified">422       exception-&gt;print();</span>
423     }
424     Handle nested_exception(THREAD, exception);
425     THREAD-&gt;clear_pending_exception();
426     THROW_CAUSE(vmSymbols::java_lang_BootstrapMethodError(), nested_exception)
427   }
428 }
429 
430 // Exception counting for hs_err file
431 volatile int Exceptions::_stack_overflow_errors = 0;
432 volatile int Exceptions::_linkage_errors = 0;
433 volatile int Exceptions::_out_of_memory_error_java_heap_errors = 0;
434 volatile int Exceptions::_out_of_memory_error_metaspace_errors = 0;
435 volatile int Exceptions::_out_of_memory_error_class_metaspace_errors = 0;
436 
437 void Exceptions::count_out_of_memory_exceptions(Handle exception) {
438   if (exception() == Universe::out_of_memory_error_metaspace()) {
439      Atomic::inc(&amp;_out_of_memory_error_metaspace_errors);
440   } else if (exception() == Universe::out_of_memory_error_class_metaspace()) {
441      Atomic::inc(&amp;_out_of_memory_error_class_metaspace_errors);
442   } else {
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1998, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
</pre>
<hr />
<pre>
384 // encoding scheme of the string into account. One thing we should do at some
385 // point is to push this flag down to class java_lang_String since other
386 // classes may need similar functionalities.
387 Handle Exceptions::new_exception(Thread* thread, Symbol* name,
388                                  const char* message,
389                                  ExceptionMsgToUtf8Mode to_utf8_safe) {
390 
391   Handle       h_loader(thread, NULL);
392   Handle       h_prot(thread, NULL);
393   Handle       h_cause(thread, NULL);
394   return Exceptions::new_exception(thread, name, message, h_cause, h_loader,
395                                    h_prot, to_utf8_safe);
396 }
397 
398 // invokedynamic uses wrap_dynamic_exception for:
399 //    - bootstrap method resolution
400 //    - post call to MethodHandleNatives::linkCallSite
401 // dynamically computed constant uses wrap_dynamic_exception for:
402 //    - bootstrap method resolution
403 //    - post call to MethodHandleNatives::linkDynamicConstant
<span class="line-modified">404 void Exceptions::wrap_dynamic_exception(bool is_indy, Thread* THREAD) {</span>
405   if (THREAD-&gt;has_pending_exception()) {
<span class="line-added">406     bool log_indy = log_is_enabled(Debug, methodhandles, indy) &amp;&amp; is_indy;</span>
<span class="line-added">407     bool log_condy = log_is_enabled(Debug, methodhandles, condy) &amp;&amp; !is_indy;</span>
<span class="line-added">408     LogStreamHandle(Debug, methodhandles, indy) lsh_indy;</span>
<span class="line-added">409     LogStreamHandle(Debug, methodhandles, condy) lsh_condy;</span>
<span class="line-added">410     LogStream* ls = NULL;</span>
<span class="line-added">411     if (log_indy) {</span>
<span class="line-added">412       ls = &amp;lsh_indy;</span>
<span class="line-added">413     } else if (log_condy) {</span>
<span class="line-added">414       ls = &amp;lsh_condy;</span>
<span class="line-added">415     }</span>
416     oop exception = THREAD-&gt;pending_exception();
<span class="line-added">417 </span>
418     // See the &quot;Linking Exceptions&quot; section for the invokedynamic instruction
419     // in JVMS 6.5.
420     if (exception-&gt;is_a(SystemDictionary::Error_klass())) {
421       // Pass through an Error, including BootstrapMethodError, any other form
422       // of linkage error, or say ThreadDeath/OutOfMemoryError
<span class="line-modified">423       if (ls != NULL) {</span>
<span class="line-modified">424         ls-&gt;print_cr(&quot;bootstrap method invocation wraps BSME around &quot; INTPTR_FORMAT, p2i((void *)exception));</span>
<span class="line-modified">425         exception-&gt;print_on(ls);</span>
426       }
427       return;
428     }
429 
430     // Otherwise wrap the exception in a BootstrapMethodError
<span class="line-modified">431     if (ls != NULL) {</span>
<span class="line-modified">432       ls-&gt;print_cr(&quot;%s throws BSME for &quot; INTPTR_FORMAT, is_indy ? &quot;invokedynamic&quot; : &quot;dynamic constant&quot;, p2i((void *)exception));</span>
<span class="line-modified">433       exception-&gt;print_on(ls);</span>
434     }
435     Handle nested_exception(THREAD, exception);
436     THREAD-&gt;clear_pending_exception();
437     THROW_CAUSE(vmSymbols::java_lang_BootstrapMethodError(), nested_exception)
438   }
439 }
440 
441 // Exception counting for hs_err file
442 volatile int Exceptions::_stack_overflow_errors = 0;
443 volatile int Exceptions::_linkage_errors = 0;
444 volatile int Exceptions::_out_of_memory_error_java_heap_errors = 0;
445 volatile int Exceptions::_out_of_memory_error_metaspace_errors = 0;
446 volatile int Exceptions::_out_of_memory_error_class_metaspace_errors = 0;
447 
448 void Exceptions::count_out_of_memory_exceptions(Handle exception) {
449   if (exception() == Universe::out_of_memory_error_metaspace()) {
450      Atomic::inc(&amp;_out_of_memory_error_metaspace_errors);
451   } else if (exception() == Universe::out_of_memory_error_class_metaspace()) {
452      Atomic::inc(&amp;_out_of_memory_error_class_metaspace_errors);
453   } else {
</pre>
</td>
</tr>
</table>
<center><a href="../runtime/sharedRuntime.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="exceptions.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>