<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/jdk.scripting.nashorn/share/classes/jdk/nashorn/internal/runtime/resources/mozilla_compat.js</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2010, 2013, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 /**
 27  * This script contains non-standard, Mozilla compatibility functionality on
 28  * the standard global objects. Please note that it is incomplete. Only the most
 29  * often used functionality is supported.
 30  */
 31 
 32 // JavaAdapter
 33 Object.defineProperty(this, &quot;JavaAdapter&quot;, {
 34     configurable: true, enumerable: false, writable: true,
 35     value: function() {
 36         if (arguments.length &lt; 2) {
 37             throw new TypeError(&quot;JavaAdapter requires atleast two arguments&quot;);
 38         }
 39 
 40         var types = Array.prototype.slice.call(arguments, 0, arguments.length - 1);
 41         var NewType = Java.extend.apply(Java, types);
 42         return new NewType(arguments[arguments.length - 1]);
 43     }
 44 });
 45 
 46 
 47 // importPackage
 48 // avoid unnecessary chaining of __noSuchProperty__ again
 49 // in case user loads this script more than once.
 50 if (typeof importPackage == &#39;undefined&#39; || !(importPackage instanceof Function)) {
 51 
 52 Object.defineProperty(this, &quot;importPackage&quot;, {
 53     configurable: true, enumerable: false, writable: true,
 54     value: (function() {
 55         var _packages = [];
 56         var global = this;
 57         var oldNoSuchProperty = global.__noSuchProperty__;
 58         var __noSuchProperty__ = function(name) {
 59             &#39;use strict&#39;;
 60             for (var i in _packages) {
 61                 try {
 62                     var type = Java.type(_packages[i] + &quot;.&quot; + name);
 63                     global[name] = type;
 64                     return type;
 65                 } catch (e) {}
 66             }
 67 
 68             if (oldNoSuchProperty) {
 69                 return oldNoSuchProperty.call(this, name);
 70             } else {
 71                 if (this === undefined) {
 72                     throw new ReferenceError(name + &quot; is not defined&quot;);
 73                 } else {
 74                     return undefined;
 75                 }
 76             }
 77         }
 78 
 79         Object.defineProperty(global, &quot;__noSuchProperty__&quot;, {
 80             writable: true, configurable: true, enumerable: false,
 81             value: __noSuchProperty__
 82         });
 83 
 84         var prefix = &quot;[JavaPackage &quot;;
 85         return function() {
 86             for (var i in arguments) {
 87                 var pkgName = arguments[i];
 88                 if ((typeof pkgName) != &#39;string&#39;) {
 89                     pkgName = String(pkgName);
 90                     // extract name from JavaPackage object
 91                     if (pkgName.startsWith(prefix)) {
 92                         pkgName = pkgName.substring(prefix.length, pkgName.length - 1);
 93                     }
 94                 }
 95                 _packages.push(pkgName);
 96             }
 97         }
 98     })()
 99 });
100 
101 }
102 
103 // sync
104 Object.defineProperty(this, &quot;sync&quot;, {
105     configurable: true, enumerable: false, writable: true,
106     value: function(func, syncobj) {
107         if (arguments.length &lt; 1 || arguments.length &gt; 2 ) {
108             throw &quot;sync(function [,object]) parameter count mismatch&quot;;
109         }
110         return Java.synchronized(func, syncobj);
111     }
112 });
113 
114 // Object.prototype.__defineGetter__
115 Object.defineProperty(Object.prototype, &quot;__defineGetter__&quot;, {
116     configurable: true, enumerable: false, writable: true,
117     value: function(name, func) {
118         Object.defineProperty(this, name, {
119             configurable: true, enumerable: true, get: func });
120     }
121 });
122 
123 // Object.prototype.__defineSetter__
124 Object.defineProperty(Object.prototype, &quot;__defineSetter__&quot;, {
125     configurable: true, enumerable: false, writable: true,
126     value: function(name, func) {
127         Object.defineProperty(this, name, {
128             configurable: true, enumerable: true, set: func });
129     }
130 });
131 
132 // Object.prototype.__lookupGetter__
133 Object.defineProperty(Object.prototype, &quot;__lookupGetter__&quot;, {
134     configurable: true, enumerable: false, writable: true,
135     value: function(name) {
136         var obj = this;
137         while (obj) {
138             var desc = Object.getOwnPropertyDescriptor(obj, name);
139             if (desc) return desc.get;
140             obj = Object.getPrototypeOf(obj);
141         }
142         return undefined;
143     }
144 });
145 
146 // Object.prototype.__lookupSetter__
147 Object.defineProperty(Object.prototype, &quot;__lookupSetter__&quot;, {
148     configurable: true, enumerable: false, writable: true,
149     value: function(name) {
150         var obj = this;
151         while (obj) {
152             var desc = Object.getOwnPropertyDescriptor(obj, name);
153             if (desc) return desc.set;
154             obj = Object.getPrototypeOf(obj);
155         }
156         return undefined;
157     }
158 });
159 
160 // Object.prototype.toSource
161 Object.defineProperty(Object.prototype, &quot;toSource&quot;, {
162     configurable: true, enumerable: false, writable: true,
163     value: function(state) {
164         if (! state) {
165             state = java.util.Collections.newSetFromMap(new java.util.HashMap());
166         }
167         if (state.contains(this)) {
168             return &quot;{}&quot;;
169         }
170         state.add(this);
171         var str = new java.lang.StringBuffer(&#39;({&#39;);
172         for (i in this) {
173             str.append(i);
174             str.append(&#39;:&#39;);
175             if (this[i] instanceof Object &amp;&amp; typeof(this[i].toSource) == &#39;function&#39;) {
176                 str.append(this[i].toSource(state));
177             } else {
178                 str.append(String(this[i]));
179             }
180             str.append(&#39;, &#39;);
181         }
182         // delete last extra command and space
183         str = str.deleteCharAt(str.length() - 1);
184         str = str.deleteCharAt(str.length() - 1);
185         str.append(&#39;})&#39;);
186         return str.toString();
187     }
188 });
189 
190 // Boolean.prototype.toSource
191 Object.defineProperty(Boolean.prototype, &quot;toSource&quot;, {
192     configurable: true, enumerable: false, writable: true,
193     value: function() {
194         return &#39;(new Boolean(&#39; + this.toString() + &#39;))&#39;;
195     }
196 });
197 
198 // Date.prototype.toSource
199 Object.defineProperty(Date.prototype, &quot;toSource&quot;, {
200     configurable: true, enumerable: false, writable: true,
201     value: function() {
202         return &#39;(new Date(&#39; + this.valueOf() + &#39;))&#39;;
203     }
204 });
205 
206 // Function.prototype.toSource -- already implemented in nashorn
207 
208 // Number.prototype.toSource
209 Object.defineProperty(Number.prototype, &quot;toSource&quot;, {
210     configurable: true, enumerable: false, writable: true,
211     value: function() {
212         return &#39;(new Number(&#39; + this.toString() + &#39;))&#39;;
213     }
214 });
215 
216 // RegExp.prototype.toSource
217 Object.defineProperty(RegExp.prototype, &quot;toSource&quot;, {
218     configurable: true, enumerable: false, writable: true,
219     value: function() {
220         return this.toString();
221     }
222 });
223 
224 // String.prototype.toSource
225 Object.defineProperty(String.prototype, &quot;toSource&quot;, {
226     configurable: true, enumerable: false, writable: true,
227     value: function() {
228         return &#39;(new String(&#39; + this.quote() + &#39;))&#39;;
229     }
230 });
231 
232 // Error.prototype.toSource
233 Object.defineProperty(Error.prototype, &quot;toSource&quot;, {
234     configurable: true, enumerable: false, writable: true,
235     value: function() {
236         var msg = this.message? String(this.message).quote() : &quot;&#39;&#39;&quot;;
237         return &#39;(new &#39; + this.name + &#39;(&#39; + msg + &#39;))&#39;;
238     }
239 });
240 
241 // Function.prototype.arity
242 Object.defineProperty(Function.prototype, &quot;arity&quot;, {
243     configurable: true, enumerable: false,
244     get: function() { return this.length; },
245     set: function(x) {
246         throw new TypeError(&quot;Function arity can not be modified&quot;);
247     }
248 });
249 
250 // String.prototype.quote
251 Object.defineProperty(String.prototype, &quot;quote&quot;, {
252     configurable: true, enumerable: false, writable: true,
253     value: function() {
254         return JSON.stringify(this);
255     }
256 });
257 
258 // HTML generation methods of String.prototype
259 
260 // String.prototype.anchor
261 Object.defineProperty(String.prototype, &quot;anchor&quot;, {
262     configurable: true, enumerable: false, writable: true,
263     value: function(name) {
264         return &#39;&lt;a name=&quot;&#39; + name + &#39;&quot;&gt;&#39; + this + &#39;&lt;/a&gt;&#39;;
265     }
266 });
267 
268 // String.prototype.big
269 Object.defineProperty(String.prototype, &quot;big&quot;, {
270     configurable: true, enumerable: false, writable: true,
271     value: function() {
272         return &#39;&lt;big&gt;&#39; + this + &#39;&lt;/big&gt;&#39;;
273     }
274 });
275 
276 // String.prototype.blink
277 Object.defineProperty(String.prototype, &quot;blink&quot;, {
278     configurable: true, enumerable: false, writable: true,
279     value: function() {
280         return &#39;&lt;blink&gt;&#39; + this + &#39;&lt;/blink&gt;&#39;;
281     }
282 });
283 
284 // String.prototype.bold
285 Object.defineProperty(String.prototype, &quot;bold&quot;, {
286     configurable: true, enumerable: false, writable: true,
287     value: function() {
288         return &#39;&lt;b&gt;&#39; + this + &#39;&lt;/b&gt;&#39;;
289     }
290 });
291 
292 // String.prototype.fixed
293 Object.defineProperty(String.prototype, &quot;fixed&quot;, {
294     configurable: true, enumerable: false, writable: true,
295     value: function() {
296         return &#39;&lt;tt&gt;&#39; + this + &#39;&lt;/tt&gt;&#39;;
297     }
298 });
299 
300 // String.prototype.fontcolor
301 Object.defineProperty(String.prototype, &quot;fontcolor&quot;, {
302     configurable: true, enumerable: false, writable: true,
303     value: function(clr) {
304         return &#39;&lt;font color=&quot;&#39; + clr + &#39;&quot;&gt;&#39; + this + &#39;&lt;/font&gt;&#39;;
305     }
306 });
307 
308 // String.prototype.fontsize
309 Object.defineProperty(String.prototype, &quot;fontsize&quot;, {
310     configurable: true, enumerable: false, writable: true,
311     value: function(size) {
312         return &#39;&lt;font size=&quot;&#39; + size + &#39;&quot;&gt;&#39; + this + &#39;&lt;/font&gt;&#39;;
313     }
314 });
315 
316 // String.prototype.italics
317 Object.defineProperty(String.prototype, &quot;italics&quot;, {
318     configurable: true, enumerable: false, writable: true,
319     value: function() {
320         return &#39;&lt;i&gt;&#39; + this + &#39;&lt;/i&gt;&#39;;
321     }
322 });
323 
324 // String.prototype.link
325 Object.defineProperty(String.prototype, &quot;link&quot;, {
326     configurable: true, enumerable: false, writable: true,
327     value: function(url) {
328         return &#39;&lt;a href=&quot;&#39; + url + &#39;&quot;&gt;&#39; + this + &#39;&lt;/a&gt;&#39;;
329     }
330 });
331 
332 // String.prototype.small
333 Object.defineProperty(String.prototype, &quot;small&quot;, {
334     configurable: true, enumerable: false, writable: true,
335     value: function() {
336         return &#39;&lt;small&gt;&#39; + this + &#39;&lt;/small&gt;&#39;;
337     }
338 });
339 
340 // String.prototype.strike
341 Object.defineProperty(String.prototype, &quot;strike&quot;, {
342     configurable: true, enumerable: false, writable: true,
343     value: function() {
344         return &#39;&lt;strike&gt;&#39; + this + &#39;&lt;/strike&gt;&#39;;
345     }
346 });
347 
348 // String.prototype.sub
349 Object.defineProperty(String.prototype, &quot;sub&quot;, {
350     configurable: true, enumerable: false, writable: true,
351     value: function() {
352         return &#39;&lt;sub&gt;&#39; + this + &#39;&lt;/sub&gt;&#39;;
353     }
354 });
355 
356 // String.prototype.sup
357 Object.defineProperty(String.prototype, &quot;sup&quot;, {
358     configurable: true, enumerable: false, writable: true,
359     value: function() {
360         return &#39;&lt;sup&gt;&#39; + this + &#39;&lt;/sup&gt;&#39;;
361     }
362 });
363 
364 // Rhino: global.importClass
365 Object.defineProperty(this, &quot;importClass&quot;, {
366     configurable: true, enumerable: false, writable: true,
367     value: function() {
368         for (var arg in arguments) {
369             var clazz = arguments[arg];
370             if (Java.isType(clazz)) {
371                 var className = Java.typeName(clazz);
372                 var simpleName = className.substring(className.lastIndexOf(&#39;.&#39;) + 1);
373                 this[simpleName] = clazz;
374             } else {
375                 throw new TypeError(clazz + &quot; is not a Java class&quot;);
376             }
377         }
378     }
379 });
    </pre>
  </body>
</html>