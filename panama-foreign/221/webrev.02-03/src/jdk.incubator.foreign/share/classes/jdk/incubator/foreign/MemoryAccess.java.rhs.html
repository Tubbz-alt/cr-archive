<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.incubator.foreign/share/classes/jdk/incubator/foreign/MemoryAccess.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 package jdk.incubator.foreign;
  2 
  3 import java.lang.invoke.VarHandle;
  4 import java.nio.ByteOrder;
  5 
  6 /**
  7  * This class defines ready-made static accessors which can be used to dereference memory segments in many ways.
  8  * Each accessor (see {@link #getInt(MemoryAddress, long)} takes a &lt;em&gt;base&lt;/em&gt; address and an offset (expressed in bytes).
  9  * The final address at which the dereference will occur will be computed by offsetting the base address by
 10  * the specified offset, as if by calling {@link MemoryAddress#addOffset(long)} on the specified base address.
 11  */
 12 public final class MemoryAccess {
 13 
<a name="1" id="anc1"></a><span class="line-modified"> 14     private MemoryAccess() {</span>
 15         // just the one
 16     }
 17 
 18     private static final VarHandle byte_LE_handle = indexedHandle(MemoryLayouts.BITS_8_LE, byte.class);
 19     private static final VarHandle char_LE_handle = indexedHandle(MemoryLayouts.BITS_16_LE, char.class);
 20     private static final VarHandle short_LE_handle = indexedHandle(MemoryLayouts.BITS_16_LE, short.class);
 21     private static final VarHandle int_LE_handle = indexedHandle(MemoryLayouts.BITS_32_LE, int.class);
 22     private static final VarHandle float_LE_handle = indexedHandle(MemoryLayouts.BITS_32_LE, float.class);
 23     private static final VarHandle long_LE_handle = indexedHandle(MemoryLayouts.BITS_64_LE, long.class);
 24     private static final VarHandle double_LE_handle = indexedHandle(MemoryLayouts.BITS_64_LE, double.class);
 25     private static final VarHandle byte_BE_handle = indexedHandle(MemoryLayouts.BITS_8_BE, byte.class);
 26     private static final VarHandle char_BE_handle = indexedHandle(MemoryLayouts.BITS_16_BE, char.class);
 27     private static final VarHandle short_BE_handle = indexedHandle(MemoryLayouts.BITS_16_BE, short.class);
 28     private static final VarHandle int_BE_handle = indexedHandle(MemoryLayouts.BITS_32_BE, int.class);
 29     private static final VarHandle float_BE_handle = indexedHandle(MemoryLayouts.BITS_32_BE, float.class);
 30     private static final VarHandle long_BE_handle = indexedHandle(MemoryLayouts.BITS_64_BE, long.class);
 31     private static final VarHandle double_BE_handle = indexedHandle(MemoryLayouts.BITS_64_BE, double.class);
 32     private static final VarHandle address_handle = MemoryHandles.asAddressVarHandle((ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN) ? long_BE_handle : long_LE_handle);
 33 
 34     /**
 35      * Read a byte from given address and offset, with byte order set to {@link ByteOrder#LITTLE_ENDIAN}.
 36      * &lt;p&gt;
 37      * This is equivalent to the following code:
 38      * &lt;blockquote&gt;&lt;pre&gt;{@code
 39     VarHandle handle = MemoryHandles.withStride(BITS_8_LE.withBitAlignment(8).varHandle(byte.class), 1L);
 40     byte value = (byte)handle.get(addr, offset);
 41      * }&lt;/pre&gt;&lt;/blockquote&gt;
 42      *
 43      * @param addr base address.
 44      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="2" id="anc2"></a><span class="line-modified"> 45      * @return a byte value read from {@code addr} at the offset specified by {@code offset}.</span>
 46      */
 47     public static byte getByte_LE(MemoryAddress addr, long offset) {
 48         return (byte)byte_LE_handle.get(addr, offset);
 49     }
 50 
 51     /**
 52      * Writes a byte at given address and offset, with byte order set to {@link ByteOrder#LITTLE_ENDIAN}.
 53      * &lt;p&gt;
 54      * This is equivalent to the following code:
 55      * &lt;blockquote&gt;&lt;pre&gt;{@code
 56     VarHandle handle = MemoryHandles.withStride(BITS_8_LE.withBitAlignment(8).varHandle(byte.class), 1L);
 57     handle.set(addr, offset, value);
 58      * }&lt;/pre&gt;&lt;/blockquote&gt;
 59      * @param addr base address.
 60      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
 61      * @param value the byte value to be written.
 62      */
 63     public static void setByte_LE(MemoryAddress addr, long offset, byte value) {
 64         byte_LE_handle.set(addr, offset, value);
 65     }
 66 
 67     /**
 68      * Read a char from given address and offset, with byte order set to {@link ByteOrder#LITTLE_ENDIAN}.
 69      * &lt;p&gt;
 70      * This is equivalent to the following code:
 71      * &lt;blockquote&gt;&lt;pre&gt;{@code
 72     VarHandle handle = MemoryHandles.withStride(BITS_16_LE.withBitAlignment(8).varHandle(char.class), 1L);
 73     char value = (char)handle.get(addr, offset);
 74      * }&lt;/pre&gt;&lt;/blockquote&gt;
 75      * @param addr base address.
 76      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="3" id="anc3"></a><span class="line-modified"> 77      * @return a char value read from {@code addr} at the offset specified by {@code offset}.</span>
 78      */
 79     public static char getChar_LE(MemoryAddress addr, long offset) {
 80         return (char)char_LE_handle.get(addr, offset);
 81     }
 82 
 83     /**
 84      * Writes a char at given address and offset, with byte order set to {@link ByteOrder#LITTLE_ENDIAN}.
 85      * &lt;p&gt;
 86      * This is equivalent to the following code:
 87      * &lt;blockquote&gt;&lt;pre&gt;{@code
 88     VarHandle handle = MemoryHandles.withStride(BITS_16_LE.withBitAlignment(8).varHandle(char.class), 1L);
 89     handle.set(addr, offset, value);
 90      * }&lt;/pre&gt;&lt;/blockquote&gt;
 91      * @param addr base address.
 92      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
 93      * @param value the char value to be written.
 94      */
 95     public static void setChar_LE(MemoryAddress addr, long offset, char value) {
 96         char_LE_handle.set(addr, offset, value);
 97     }
 98 
 99     /**
100      * Read a short from given address and offset, with byte order set to {@link ByteOrder#LITTLE_ENDIAN}.
101      * &lt;p&gt;
102      * This is equivalent to the following code:
103      * &lt;blockquote&gt;&lt;pre&gt;{@code
104     VarHandle handle = MemoryHandles.withStride(BITS_16_LE.withBitAlignment(8).varHandle(short.class), 1L);
105     short value = (short)handle.get(addr, offset);
106      * }&lt;/pre&gt;&lt;/blockquote&gt;
107      * @param addr base address.
108      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="4" id="anc4"></a><span class="line-modified">109      * @return a short value read from {@code addr} at the offset specified by {@code offset}.</span>
110      */
111     public static short getShort_LE(MemoryAddress addr, long offset) {
112         return (short)short_LE_handle.get(addr, offset);
113     }
114 
115     /**
116      * Writes a short at given address and offset, with byte order set to {@link ByteOrder#LITTLE_ENDIAN}.
117      * &lt;p&gt;
118      * This is equivalent to the following code:
119      * &lt;blockquote&gt;&lt;pre&gt;{@code
120     VarHandle handle = MemoryHandles.withStride(BITS_16_LE.withBitAlignment(8).varHandle(short.class), 1L);
121     handle.set(addr, offset, value);
122      * }&lt;/pre&gt;&lt;/blockquote&gt;
123      * @param addr base address.
124      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
125      * @param value the short value to be written.
126      */
127     public static void setShort_LE(MemoryAddress addr, long offset, short value) {
128         short_LE_handle.set(addr, offset, value);
129     }
130 
131     /**
132      * Read an int from given address and offset, with byte order set to {@link ByteOrder#LITTLE_ENDIAN}.
133      * &lt;p&gt;
134      * This is equivalent to the following code:
135      * &lt;blockquote&gt;&lt;pre&gt;{@code
136     VarHandle handle = MemoryHandles.withStride(BITS_32_LE.withBitAlignment(8).varHandle(int.class), 1L);
137     int value = (int)handle.get(addr, offset);
138      * }&lt;/pre&gt;&lt;/blockquote&gt;
139      * @param addr base address.
140      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="5" id="anc5"></a><span class="line-modified">141      * @return an int value read from {@code addr} at the offset specified by {@code offset}.</span>
142      */
143     public static int getInt_LE(MemoryAddress addr, long offset) {
144         return (int)int_LE_handle.get(addr, offset);
145     }
146 
147     /**
148      * Writes an int at given address and offset, with byte order set to {@link ByteOrder#LITTLE_ENDIAN}.
149      * &lt;p&gt;
150      * This is equivalent to the following code:
151      * &lt;blockquote&gt;&lt;pre&gt;{@code
152     VarHandle handle = MemoryHandles.withStride(BITS_32_LE.withBitAlignment(8).varHandle(int.class), 1L);
153     handle.set(addr, offset, value);
154      * }&lt;/pre&gt;&lt;/blockquote&gt;
155      * @param addr base address.
156      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
157      * @param value the int value to be written.
158      */
159     public static void setInt_LE(MemoryAddress addr, long offset, int value) {
160         int_LE_handle.set(addr, offset, value);
161     }
162 
163     /**
164      * Read a float from given address and offset, with byte order set to {@link ByteOrder#LITTLE_ENDIAN}.
165      * &lt;p&gt;
166      * This is equivalent to the following code:
167      * &lt;blockquote&gt;&lt;pre&gt;{@code
168     VarHandle handle = MemoryHandles.withStride(BITS_32_LE.withBitAlignment(8).varHandle(float.class), 1L);
169     float value = (float)handle.get(addr, offset);
170      * }&lt;/pre&gt;&lt;/blockquote&gt;
171      * @param addr base address.
172      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="6" id="anc6"></a><span class="line-modified">173      * @return a float value read from {@code addr} at the offset specified by {@code offset}.</span>
174      */
175     public static float getFloat_LE(MemoryAddress addr, long offset) {
176         return (float)float_LE_handle.get(addr, offset);
177     }
178 
179     /**
180      * Writes a float at given address and offset, with byte order set to {@link ByteOrder#LITTLE_ENDIAN}.
181      * &lt;p&gt;
182      * This is equivalent to the following code:
183      * &lt;blockquote&gt;&lt;pre&gt;{@code
184     VarHandle handle = MemoryHandles.withStride(BITS_32_LE.withBitAlignment(8).varHandle(float.class), 1L);
185     handle.set(addr, offset, value);
186      * }&lt;/pre&gt;&lt;/blockquote&gt;
187      * @param addr base address.
188      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
189      * @param value the float value to be written.
190      */
191     public static void setFloat_LE(MemoryAddress addr, long offset, float value) {
192         float_LE_handle.set(addr, offset, value);
193     }
194 
195     /**
196      * Read a long from given address and offset, with byte order set to {@link ByteOrder#LITTLE_ENDIAN}.
197      * &lt;p&gt;
198      * This is equivalent to the following code:
199      * &lt;blockquote&gt;&lt;pre&gt;{@code
200     VarHandle handle = MemoryHandles.withStride(BITS_64_LE.withBitAlignment(8).varHandle(long.class), 1L);
201     long value = (long)handle.get(addr, offset);
202      * }&lt;/pre&gt;&lt;/blockquote&gt;
203      * @param addr base address.
204      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="7" id="anc7"></a><span class="line-modified">205      * @return a long value read from {@code addr} at the offset specified by {@code offset}.</span>
206      */
207     public static long getLong_LE(MemoryAddress addr, long offset) {
208         return (long)long_LE_handle.get(addr, offset);
209     }
210 
211     /**
212      * Writes a long at given address and offset, with byte order set to {@link ByteOrder#LITTLE_ENDIAN}.
213      * &lt;p&gt;
214      * This is equivalent to the following code:
215      * &lt;blockquote&gt;&lt;pre&gt;{@code
216     VarHandle handle = MemoryHandles.withStride(BITS_64_LE.withBitAlignment(8).varHandle(long.class), 1L);
217     handle.set(addr, offset, value);
218      * }&lt;/pre&gt;&lt;/blockquote&gt;
219      * @param addr base address.
220      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
221      * @param value the long value to be written.
222      */
223     public static void setLong_LE(MemoryAddress addr, long offset, long value) {
224         long_LE_handle.set(addr, offset, value);
225     }
226 
227     /**
228      * Read a double from given address and offset, with byte order set to {@link ByteOrder#LITTLE_ENDIAN}.
229      * &lt;p&gt;
230      * This is equivalent to the following code:
231      * &lt;blockquote&gt;&lt;pre&gt;{@code
232     VarHandle handle = MemoryHandles.withStride(BITS_32_LE.withBitAlignment(8).varHandle(double.class), 1L);
233     double value = (double)handle.get(addr, offset);
234      * }&lt;/pre&gt;&lt;/blockquote&gt;
235      * @param addr base address.
236      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="8" id="anc8"></a><span class="line-modified">237      * @return a double value read from {@code addr} at the offset specified by {@code offset}.</span>
238      */
239     public static double getDouble_LE(MemoryAddress addr, long offset) {
240         return (double)double_LE_handle.get(addr, offset);
241     }
242 
243     /**
244      * Writes a double at given address and offset, with byte order set to {@link ByteOrder#LITTLE_ENDIAN}.
245      * &lt;p&gt;
246      * This is equivalent to the following code:
247      * &lt;blockquote&gt;&lt;pre&gt;{@code
248     VarHandle handle = MemoryHandles.withStride(BITS_64_LE.withBitAlignment(8).varHandle(double.class), 1L);
249     handle.set(addr, offset, value);
250      * }&lt;/pre&gt;&lt;/blockquote&gt;
251      * @param addr base address.
252      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
253      * @param value the double value to be written.
254      */
255     public static void setDouble_LE(MemoryAddress addr, long offset, double value) {
256         double_LE_handle.set(addr, offset, value);
257     }
258 
259     /**
260      * Read a byte from given address and offset, with byte order set to {@link ByteOrder#BIG_ENDIAN}.
261      * &lt;p&gt;
262      * This is equivalent to the following code:
263      * &lt;blockquote&gt;&lt;pre&gt;{@code
264     VarHandle handle = MemoryHandles.withStride(BITS_8_BE.withBitAlignment(8).varHandle(byte.class), 1L);
265     byte value = (byte)handle.get(addr, offset);
266      * }&lt;/pre&gt;&lt;/blockquote&gt;
267      *
268      * @param addr base address.
269      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="9" id="anc9"></a><span class="line-modified">270      * @return a byte value read from {@code addr} at the offset specified by {@code offset}.</span>
271      */
272     public static byte getByte_BE(MemoryAddress addr, long offset) {
273         return (byte)byte_BE_handle.get(addr, offset);
274     }
275 
276     /**
277      * Writes a byte at given address and offset, with byte order set to {@link ByteOrder#BIG_ENDIAN}.
278      * &lt;p&gt;
279      * This is equivalent to the following code:
280      * &lt;blockquote&gt;&lt;pre&gt;{@code
281     VarHandle handle = MemoryHandles.withStride(BITS_8_BE.withBitAlignment(8).varHandle(byte.class), 1L);
282     handle.set(addr, offset, value);
283      * }&lt;/pre&gt;&lt;/blockquote&gt;
284      * @param addr base address.
285      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
286      * @param value the byte value to be written.
287      */
288     public static void setByte_BE(MemoryAddress addr, long offset, byte value) {
289         byte_BE_handle.set(addr, offset, value);
290     }
291 
292     /**
293      * Read a char from given address and offset, with byte order set to {@link ByteOrder#BIG_ENDIAN}.
294      * &lt;p&gt;
295      * This is equivalent to the following code:
296      * &lt;blockquote&gt;&lt;pre&gt;{@code
297     VarHandle handle = MemoryHandles.withStride(BITS_16_BE.withBitAlignment(8).varHandle(char.class), 1L);
298     char value = (char)handle.get(addr, offset);
299      * }&lt;/pre&gt;&lt;/blockquote&gt;
300      * @param addr base address.
301      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="10" id="anc10"></a><span class="line-modified">302      * @return a char value read from {@code addr} at the offset specified by {@code offset}.</span>
303      */
304     public static char getChar_BE(MemoryAddress addr, long offset) {
305         return (char)char_BE_handle.get(addr, offset);
306     }
307 
308     /**
309      * Writes a char at given address and offset, with byte order set to {@link ByteOrder#BIG_ENDIAN}.
310      * &lt;p&gt;
311      * This is equivalent to the following code:
312      * &lt;blockquote&gt;&lt;pre&gt;{@code
313     VarHandle handle = MemoryHandles.withStride(BITS_16_BE.withBitAlignment(8).varHandle(char.class), 1L);
314     handle.set(addr, offset, value);
315      * }&lt;/pre&gt;&lt;/blockquote&gt;
316      * @param addr base address.
317      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
318      * @param value the char value to be written.
319      */
320     public static void setChar_BE(MemoryAddress addr, long offset, char value) {
321         char_BE_handle.set(addr, offset, value);
322     }
323 
324     /**
325      * Read a short from given address and offset, with byte order set to {@link ByteOrder#BIG_ENDIAN}.
326      * &lt;p&gt;
327      * This is equivalent to the following code:
328      * &lt;blockquote&gt;&lt;pre&gt;{@code
329     VarHandle handle = MemoryHandles.withStride(BITS_16_BE.withBitAlignment(8).varHandle(short.class), 1L);
330     short value = (short)handle.get(addr, offset);
331      * }&lt;/pre&gt;&lt;/blockquote&gt;
332      * @param addr base address.
333      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="11" id="anc11"></a><span class="line-modified">334      * @return a short value read from {@code addr} at the offset specified by {@code offset}.</span>
335      */
336     public static short getShort_BE(MemoryAddress addr, long offset) {
337         return (short)short_BE_handle.get(addr, offset);
338     }
339 
340     /**
341      * Writes a short at given address and offset, with byte order set to {@link ByteOrder#BIG_ENDIAN}.
342      * &lt;p&gt;
343      * This is equivalent to the following code:
344      * &lt;blockquote&gt;&lt;pre&gt;{@code
345     VarHandle handle = MemoryHandles.withStride(BITS_16_BE.withBitAlignment(8).varHandle(short.class), 1L);
346     handle.set(addr, offset, value);
347      * }&lt;/pre&gt;&lt;/blockquote&gt;
348      * @param addr base address.
349      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
350      * @param value the short value to be written.
351      */
352     public static void setShort_BE(MemoryAddress addr, long offset, short value) {
353         short_BE_handle.set(addr, offset, value);
354     }
355 
356     /**
357      * Read an int from given address and offset, with byte order set to {@link ByteOrder#BIG_ENDIAN}.
358      * &lt;p&gt;
359      * This is equivalent to the following code:
360      * &lt;blockquote&gt;&lt;pre&gt;{@code
361     VarHandle handle = MemoryHandles.withStride(BITS_32_BE.withBitAlignment(8).varHandle(int.class), 1L);
362     int value = (int)handle.get(addr, offset);
363      * }&lt;/pre&gt;&lt;/blockquote&gt;
364      * @param addr base address.
365      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="12" id="anc12"></a><span class="line-modified">366      * @return an int value read from {@code addr} at the offset specified by {@code offset}.</span>
367      */
368     public static int getInt_BE(MemoryAddress addr, long offset) {
369         return (int)int_BE_handle.get(addr, offset);
370     }
371 
372     /**
373      * Writes an int at given address and offset, with byte order set to {@link ByteOrder#BIG_ENDIAN}.
374      * &lt;p&gt;
375      * This is equivalent to the following code:
376      * &lt;blockquote&gt;&lt;pre&gt;{@code
377     VarHandle handle = MemoryHandles.withStride(BITS_32_BE.withBitAlignment(8).varHandle(int.class), 1L);
378     handle.set(addr, offset, value);
379      * }&lt;/pre&gt;&lt;/blockquote&gt;
380      * @param addr base address.
381      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
382      * @param value the int value to be written.
383      */
384     public static void setInt_BE(MemoryAddress addr, long offset, int value) {
385         int_BE_handle.set(addr, offset, value);
386     }
387 
388     /**
389      * Read a float from given address and offset, with byte order set to {@link ByteOrder#BIG_ENDIAN}.
390      * &lt;p&gt;
391      * This is equivalent to the following code:
392      * &lt;blockquote&gt;&lt;pre&gt;{@code
393     VarHandle handle = MemoryHandles.withStride(BITS_32_BE.withBitAlignment(8).varHandle(float.class), 1L);
394     float value = (float)handle.get(addr, offset);
395      * }&lt;/pre&gt;&lt;/blockquote&gt;
396      * @param addr base address.
397      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="13" id="anc13"></a><span class="line-modified">398      * @return a float value read from {@code addr} at the offset specified by {@code offset}.</span>
399      */
400     public static float getFloat_BE(MemoryAddress addr, long offset) {
401         return (float)float_BE_handle.get(addr, offset);
402     }
403 
404     /**
405      * Writes a float at given address and offset, with byte order set to {@link ByteOrder#BIG_ENDIAN}.
406      * &lt;p&gt;
407      * This is equivalent to the following code:
408      * &lt;blockquote&gt;&lt;pre&gt;{@code
409     VarHandle handle = MemoryHandles.withStride(BITS_32_BE.withBitAlignment(8).varHandle(float.class), 1L);
410     handle.set(addr, offset, value);
411      * }&lt;/pre&gt;&lt;/blockquote&gt;
412      * @param addr base address.
413      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
414      * @param value the float value to be written.
415      */
416     public static void setFloat_BE(MemoryAddress addr, long offset, float value) {
417         float_BE_handle.set(addr, offset, value);
418     }
419 
420     /**
421      * Read a long from given address and offset, with byte order set to {@link ByteOrder#BIG_ENDIAN}.
422      * &lt;p&gt;
423      * This is equivalent to the following code:
424      * &lt;blockquote&gt;&lt;pre&gt;{@code
425     VarHandle handle = MemoryHandles.withStride(BITS_64_BE.withBitAlignment(8).varHandle(long.class), 1L);
426     long value = (long)handle.get(addr, offset);
427      * }&lt;/pre&gt;&lt;/blockquote&gt;
428      * @param addr base address.
429      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="14" id="anc14"></a><span class="line-modified">430      * @return a long value read from {@code addr} at the offset specified by {@code offset}.</span>
431      */
432     public static long getLong_BE(MemoryAddress addr, long offset) {
433         return (long)long_BE_handle.get(addr, offset);
434     }
435 
436     /**
437      * Writes a long at given address and offset, with byte order set to {@link ByteOrder#BIG_ENDIAN}.
438      * &lt;p&gt;
439      * This is equivalent to the following code:
440      * &lt;blockquote&gt;&lt;pre&gt;{@code
441     VarHandle handle = MemoryHandles.withStride(BITS_64_BE.withBitAlignment(8).varHandle(long.class), 1L);
442     handle.set(addr, offset, value);
443      * }&lt;/pre&gt;&lt;/blockquote&gt;
444      * @param addr base address.
445      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
446      * @param value the long value to be written.
447      */
448     public static void setLong_BE(MemoryAddress addr, long offset, long value) {
449         long_BE_handle.set(addr, offset, value);
450     }
451 
452     /**
453      * Read a double from given address and offset, with byte order set to {@link ByteOrder#BIG_ENDIAN}.
454      * &lt;p&gt;
455      * This is equivalent to the following code:
456      * &lt;blockquote&gt;&lt;pre&gt;{@code
457     VarHandle handle = MemoryHandles.withStride(BITS_32_BE.withBitAlignment(8).varHandle(double.class), 1L);
458     double value = (double)handle.get(addr, offset);
459      * }&lt;/pre&gt;&lt;/blockquote&gt;
460      * @param addr base address.
461      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="15" id="anc15"></a><span class="line-modified">462      * @return a double value read from {@code addr} at the offset specified by {@code offset}.</span>
463      */
464     public static double getDouble_BE(MemoryAddress addr, long offset) {
465         return (double)double_BE_handle.get(addr, offset);
466     }
467 
468     /**
469      * Writes a double at given address and offset, with byte order set to {@link ByteOrder#BIG_ENDIAN}.
470      * &lt;p&gt;
471      * This is equivalent to the following code:
472      * &lt;blockquote&gt;&lt;pre&gt;{@code
473     VarHandle handle = MemoryHandles.withStride(BITS_64_BE.withBitAlignment(8).varHandle(double.class), 1L);
474     handle.set(addr, offset, value);
475      * }&lt;/pre&gt;&lt;/blockquote&gt;
476      * @param addr base address.
477      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
478      * @param value the double value to be written.
479      */
480     public static void setDouble_BE(MemoryAddress addr, long offset, double value) {
481         double_BE_handle.set(addr, offset, value);
482     }
483 
484     /**
485      * Read a byte from given address and offset, with byte order set to {@link ByteOrder#nativeOrder()}.
486      * &lt;p&gt;
487      * This is equivalent to the following code:
488      * &lt;blockquote&gt;&lt;pre&gt;{@code
489     VarHandle handle = MemoryHandles.withStride(JAVA_BYTE.withBitAlignment(8).varHandle(byte.class), 1L);
490     byte value = (byte)handle.get(addr, offset);
491      * }&lt;/pre&gt;&lt;/blockquote&gt;
492      *
493      * @param addr base address.
494      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="16" id="anc16"></a><span class="line-modified">495      * @return a byte value read from {@code addr} at the offset specified by {@code offset}.</span>
496      */
497     public static byte getByte(MemoryAddress addr, long offset) {
498         return (byte)((ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN) ? byte_BE_handle : byte_LE_handle).get(addr, offset);
499     }
500 
501     /**
502      * Writes a byte at given address and offset, with byte order set to {@link ByteOrder#nativeOrder()}.
503      * &lt;p&gt;
504      * This is equivalent to the following code:
505      * &lt;blockquote&gt;&lt;pre&gt;{@code
506     VarHandle handle = MemoryHandles.withStride(JAVA_BYTE.withBitAlignment(8).varHandle(byte.class), 1L);
507     handle.set(addr, offset, value);
508      * }&lt;/pre&gt;&lt;/blockquote&gt;
509      * @param addr base address.
510      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
511      * @param value the byte value to be written.
512      */
513     public static void setByte(MemoryAddress addr, long offset, byte value) {
514         ((ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN) ? byte_BE_handle : byte_LE_handle).set(addr, offset, value);
515     }
516 
517     /**
518      * Read a char from given address and offset, with byte order set to {@link ByteOrder#nativeOrder()}.
519      * &lt;p&gt;
520      * This is equivalent to the following code:
521      * &lt;blockquote&gt;&lt;pre&gt;{@code
522     VarHandle handle = MemoryHandles.withStride(JAVA_CHAR.withBitAlignment(8).varHandle(char.class), 1L);
523     char value = (char)handle.get(addr, offset);
524      * }&lt;/pre&gt;&lt;/blockquote&gt;
525      * @param addr base address.
526      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="17" id="anc17"></a><span class="line-modified">527      * @return a char value read from {@code addr} at the offset specified by {@code offset}.</span>
528      */
529     public static char getChar(MemoryAddress addr, long offset) {
530         return (char)((ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN) ? char_BE_handle : char_LE_handle).get(addr, offset);
531     }
532 
533     /**
534      * Writes a char at given address and offset, with byte order set to {@link ByteOrder#nativeOrder()}.
535      * &lt;p&gt;
536      * This is equivalent to the following code:
537      * &lt;blockquote&gt;&lt;pre&gt;{@code
538     VarHandle handle = MemoryHandles.withStride(JAVA_CHAR.withBitAlignment(8).varHandle(char.class), 1L);
539     handle.set(addr, offset, value);
540      * }&lt;/pre&gt;&lt;/blockquote&gt;
541      * @param addr base address.
542      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
543      * @param value the char value to be written.
544      */
545     public static void setChar(MemoryAddress addr, long offset, char value) {
546         ((ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN) ? char_BE_handle : char_LE_handle).set(addr, offset, value);
547     }
548 
549     /**
550      * Read a short from given address and offset, with byte order set to {@link ByteOrder#nativeOrder()}.
551      * &lt;p&gt;
552      * This is equivalent to the following code:
553      * &lt;blockquote&gt;&lt;pre&gt;{@code
554     VarHandle handle = MemoryHandles.withStride(JAVA_SHORT.withBitAlignment(8).varHandle(short.class), 1L);
555     short value = (short)handle.get(addr, offset);
556      * }&lt;/pre&gt;&lt;/blockquote&gt;
557      * @param addr base address.
558      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="18" id="anc18"></a><span class="line-modified">559      * @return a short value read from {@code addr} at the offset specified by {@code offset}.</span>
560      */
561     public static short getShort(MemoryAddress addr, long offset) {
562         return (short)((ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN) ? short_BE_handle : short_LE_handle).get(addr, offset);
563     }
564 
565     /**
566      * Writes a short at given address and offset, with byte order set to {@link ByteOrder#nativeOrder()}.
567      * &lt;p&gt;
568      * This is equivalent to the following code:
569      * &lt;blockquote&gt;&lt;pre&gt;{@code
570     VarHandle handle = MemoryHandles.withStride(JAVA_SHORT.withBitAlignment(8).varHandle(short.class), 1L);
571     handle.set(addr, offset, value);
572      * }&lt;/pre&gt;&lt;/blockquote&gt;
573      * @param addr base address.
574      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
575      * @param value the short value to be written.
576      */
577     public static void setShort(MemoryAddress addr, long offset, short value) {
578         ((ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN) ? short_BE_handle : short_LE_handle).set(addr, offset, value);
579     }
580 
581     /**
582      * Read an int from given address and offset, with byte order set to {@link ByteOrder#nativeOrder()}.
583      * &lt;p&gt;
584      * This is equivalent to the following code:
585      * &lt;blockquote&gt;&lt;pre&gt;{@code
586     VarHandle handle = MemoryHandles.withStride(JAVA_INT.withBitAlignment(8).varHandle(int.class), 1L);
587     int value = (int)handle.get(addr, offset);
588      * }&lt;/pre&gt;&lt;/blockquote&gt;
589      * @param addr base address.
590      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="19" id="anc19"></a><span class="line-modified">591      * @return an int value read from {@code addr} at the offset specified by {@code offset}.</span>
592      */
593     public static int getInt(MemoryAddress addr, long offset) {
594         return (int)((ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN) ? int_BE_handle : int_LE_handle).get(addr, offset);
595     }
596 
597     /**
598      * Writes an int at given address and offset, with byte order set to {@link ByteOrder#nativeOrder()}.
599      * &lt;p&gt;
600      * This is equivalent to the following code:
601      * &lt;blockquote&gt;&lt;pre&gt;{@code
602     VarHandle handle = MemoryHandles.withStride(JAVA_INT.withBitAlignment(8).varHandle(int.class), 1L);
603     handle.set(addr, offset, value);
604      * }&lt;/pre&gt;&lt;/blockquote&gt;
605      * @param addr base address.
606      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
607      * @param value the int value to be written.
608      */
609     public static void setInt(MemoryAddress addr, long offset, int value) {
610         ((ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN) ? int_BE_handle : int_LE_handle).set(addr, offset, value);
611     }
612 
613     /**
614      * Read a float from given address and offset, with byte order set to {@link ByteOrder#nativeOrder()}.
615      * &lt;p&gt;
616      * This is equivalent to the following code:
617      * &lt;blockquote&gt;&lt;pre&gt;{@code
618     VarHandle handle = MemoryHandles.withStride(JAVA_FLOAT.withBitAlignment(8).varHandle(float.class), 1L);
619     float value = (float)handle.get(addr, offset);
620      * }&lt;/pre&gt;&lt;/blockquote&gt;
621      * @param addr base address.
622      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="20" id="anc20"></a><span class="line-modified">623      * @return a float value read from {@code addr} at the offset specified by {@code offset}.</span>
624      */
625     public static float getFloat(MemoryAddress addr, long offset) {
626         return (float)((ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN) ? float_BE_handle : float_LE_handle).get(addr, offset);
627     }
628 
629     /**
630      * Writes a float at given address and offset, with byte order set to {@link ByteOrder#nativeOrder()}.
631      * &lt;p&gt;
632      * This is equivalent to the following code:
633      * &lt;blockquote&gt;&lt;pre&gt;{@code
634     VarHandle handle = MemoryHandles.withStride(JAVA_FLOAT.withBitAlignment(8).varHandle(float.class), 1L);
635     handle.set(addr, offset, value);
636      * }&lt;/pre&gt;&lt;/blockquote&gt;
637      * @param addr base address.
638      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
639      * @param value the float value to be written.
640      */
641     public static void setFloat(MemoryAddress addr, long offset, float value) {
642         ((ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN) ? float_BE_handle : float_LE_handle).set(addr, offset, value);
643     }
644 
645     /**
646      * Read a long from given address and offset, with byte order set to {@link ByteOrder#nativeOrder()}.
647      * &lt;p&gt;
648      * This is equivalent to the following code:
649      * &lt;blockquote&gt;&lt;pre&gt;{@code
650     VarHandle handle = MemoryHandles.withStride(JAVA_LONG.withBitAlignment(8).varHandle(long.class), 1L);
651     long value = (long)handle.get(addr, offset);
652      * }&lt;/pre&gt;&lt;/blockquote&gt;
653      * @param addr base address.
654      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="21" id="anc21"></a><span class="line-modified">655      * @return a long value read from {@code addr} at the offset specified by {@code offset}.</span>
656      */
657     public static long getLong(MemoryAddress addr, long offset) {
658         return (long)((ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN) ? long_BE_handle : long_LE_handle).get(addr, offset);
659     }
660 
661     /**
662      * Writes a long at given address and offset, with byte order set to {@link ByteOrder#nativeOrder()}.
663      * &lt;p&gt;
664      * This is equivalent to the following code:
665      * &lt;blockquote&gt;&lt;pre&gt;{@code
666     VarHandle handle = MemoryHandles.withStride(JAVA_LONG.withBitAlignment(8).varHandle(long.class), 1L);
667     handle.set(addr, offset, value);
668      * }&lt;/pre&gt;&lt;/blockquote&gt;
669      * @param addr base address.
670      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
671      * @param value the long value to be written.
672      */
673     public static void setLong(MemoryAddress addr, long offset, long value) {
674         ((ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN) ? long_BE_handle : long_LE_handle).set(addr, offset, value);
675     }
676 
677     /**
678      * Read a double from given address and offset, with byte order set to {@link ByteOrder#nativeOrder()}.
679      * &lt;p&gt;
680      * This is equivalent to the following code:
681      * &lt;blockquote&gt;&lt;pre&gt;{@code
682     VarHandle handle = MemoryHandles.withStride(JAVA_DOUBLE.withBitAlignment(8).varHandle(double.class), 1L);
683     double value = (double)handle.get(addr, offset);
684      * }&lt;/pre&gt;&lt;/blockquote&gt;
685      * @param addr base address.
686      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="22" id="anc22"></a><span class="line-modified">687      * @return a double value read from {@code addr} at the offset specified by {@code offset}.</span>
688      */
689     public static double getDouble(MemoryAddress addr, long offset) {
690         return (double)((ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN) ? double_BE_handle : double_LE_handle).get(addr, offset);
691     }
692 
693     /**
694      * Writes a double at given address and offset, with byte order set to {@link ByteOrder#nativeOrder()}.
695      * &lt;p&gt;
696      * This is equivalent to the following code:
697      * &lt;blockquote&gt;&lt;pre&gt;{@code
698     VarHandle handle = MemoryHandles.withStride(JAVA_DOUBLE.withBitAlignment(8).varHandle(double.class), 1L);
699     handle.set(addr, offset, value);
700      * }&lt;/pre&gt;&lt;/blockquote&gt;
701      * @param addr base address.
702      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
703      * @param value the double value to be written.
704      */
705     public static void setDouble(MemoryAddress addr, long offset, double value) {
706         ((ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN) ? double_BE_handle : double_LE_handle).set(addr, offset, value);
707     }
708 
709     /**
710      * Read a memory address from given address and offset, with byte order set to {@link ByteOrder#nativeOrder()}.
711      * &lt;p&gt;
712      * This is equivalent to the following code:
713      * &lt;blockquote&gt;&lt;pre&gt;{@code
714     VarHandle handle = MemoryHandles.asAddressHandle(MemoryHandles.withStride(JAVA_LONG.withBitAlignment(8).varHandle(long.class), 1L));
715     MemoryAddress value = (MemoryAddress)handle.get(addr, offset);
716      * }&lt;/pre&gt;&lt;/blockquote&gt;
717      * @param addr base address.
718      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
<a name="23" id="anc23"></a><span class="line-modified">719      * @return a memory address read from {@code addr} at the offset specified by {@code offset}.</span>
720      */
721     public static MemoryAddress getAddress(MemoryAddress addr, long offset) {
722         return (MemoryAddress)address_handle.get(addr, offset);
723     }
724 
725     /**
726      * Writes a memory address at given address and offset, with byte order set to {@link ByteOrder#nativeOrder()}.
727      * &lt;p&gt;
728      * This is equivalent to the following code:
729      * &lt;blockquote&gt;&lt;pre&gt;{@code
730     VarHandle handle = MemoryHandles.asAddressHandle(MemoryHandles.withStride(JAVA_LONG.withBitAlignment(8).varHandle(long.class), 1L));
731     handle.set(addr, offset, value);
732      * }&lt;/pre&gt;&lt;/blockquote&gt;
733      * @param addr base address.
734      * @param offset offset (relative to {@code addr}). The final address of this read operation can be expressed as {@code addr.addOffset(offset)}.
735      * @param value the memory address to be written.
736      */
737     public static void setAddress(MemoryAddress addr, long offset, MemoryAddress value) {
738         address_handle.set(addr, offset, value);
739     }
740 
741     private static VarHandle indexedHandle(MemoryLayout elementLayout, Class&lt;?&gt; carrier) {
742         return MemoryHandles.withStride(elementLayout.withBitAlignment(8).varHandle(carrier), 1L);
743     }
744 }
<a name="24" id="anc24"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="24" type="hidden" />
</body>
</html>