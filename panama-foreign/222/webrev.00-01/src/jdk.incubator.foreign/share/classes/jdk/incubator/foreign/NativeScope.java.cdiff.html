<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.incubator.foreign/share/classes/jdk/incubator/foreign/NativeScope.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>src/jdk.incubator.foreign/share/classes/jdk/incubator/foreign/NativeScope.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 50,12 ***</span>
   * created to share the same life-cycle as a given native scope - which in turns enables client to group all memory
   * allocation and usage under a single &lt;em&gt;try-with-resources block&lt;/em&gt;.
   */
  public abstract class NativeScope implements AutoCloseable {
  
<span class="line-removed">-     Unsafe unsafe = Unsafe.getUnsafe();</span>
<span class="line-removed">- </span>
      /**
       * If this native scope is bounded, returns the size, in bytes, of this native scope.
       * @return the size, in bytes, of this native scope (if available).
       */
      public abstract OptionalLong byteSize();
<span class="line-new-header">--- 50,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 354,10 ***</span>
<span class="line-new-header">--- 352,29 ---</span>
       */
      public MemoryAddress allocate(MemoryLayout layout) {
          return allocate(layout.byteSize(), layout.byteAlignment());
      }
  
<span class="line-added">+     /**</span>
<span class="line-added">+      * Allocate a block of memory corresponding to an array with given element layout and size.</span>
<span class="line-added">+      * The address returned by this method is associated with a segment which cannot be closed.</span>
<span class="line-added">+      * Moreover, the returned address must conform to the layout alignment constraints. This is equivalent to the</span>
<span class="line-added">+      * following code:</span>
<span class="line-added">+      * &lt;pre&gt;{@code</span>
<span class="line-added">+     allocate(MemoryLayout.ofSequence(size, elementLayout));</span>
<span class="line-added">+      * }&lt;/pre&gt;</span>
<span class="line-added">+      * @param elementLayout the array element layout.</span>
<span class="line-added">+      * @param size the array size.</span>
<span class="line-added">+      * @return an address which points to the newly allocated memory block.</span>
<span class="line-added">+      * @throws OutOfMemoryError if there is not enough space left in this native scope, that is, if</span>
<span class="line-added">+      * {@code limit() - size() &lt; (elementLayout.byteSize() * size)}.</span>
<span class="line-added">+      * @throws IllegalArgumentException if {@code elementLayout.byteSize()} does not conform to the size of a double value.</span>
<span class="line-added">+      */</span>
<span class="line-added">+     public MemoryAddress allocateArray(MemoryLayout elementLayout, long size) {</span>
<span class="line-added">+         return allocate(MemoryLayout.ofSequence(size, elementLayout));</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      /**
       * Allocate a block of memory in this native scope with given size. The address returned by this method is
       * associated with a segment which cannot be closed. Moreover, the returned address must be aligned to {@code size}.
       * @param bytesSize the size (in bytes) of the block of memory to be allocated.
       * @return an address which points to the newly allocated memory block.
</pre>
<center>&lt; prev <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>