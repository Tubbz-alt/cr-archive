<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.incubator.foreign/share/classes/jdk/internal/foreign/MemoryScope.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>src/jdk.incubator.foreign/share/classes/jdk/internal/foreign/MemoryScope.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 47,12 ***</span>
   * the root scope. There is only a single level of children. All child scopes are peers.
   * A child scope can be {@link #close() closed} at any time, but root scope can only
   * be closed after all its children have been closed, at which time any associated
   * cleanup action is executed (the associated memory segment is freed).
   * Besides thread-confined checked scopes, {@linkplain #createUnchecked(Thread, Object, Runnable)}
<span class="line-modified">!  * method may be used passing {@code null} as the &quot;owner&quot; thread to create an</span>
<span class="line-modified">!  * unchecked scope that doesn&#39;t check for thread-confinement or temporal bounds.</span>
   */
  abstract class MemoryScope {
  
      /**
       * Creates a root MemoryScope with given ref, cleanupAction and current
<span class="line-new-header">--- 47,15 ---</span>
   * the root scope. There is only a single level of children. All child scopes are peers.
   * A child scope can be {@link #close() closed} at any time, but root scope can only
   * be closed after all its children have been closed, at which time any associated
   * cleanup action is executed (the associated memory segment is freed).
   * Besides thread-confined checked scopes, {@linkplain #createUnchecked(Thread, Object, Runnable)}
<span class="line-modified">!  * method may be used passing {@code null} as the &quot;owner&quot; thread to create a</span>
<span class="line-modified">!  * scope that doesn&#39;t check for thread-confinement while its temporal bounds are</span>
<span class="line-added">+  * enforced reliably only under condition that thread that closes the scope is also</span>
<span class="line-added">+  * the single thread performing the checked access or there is an external synchronization</span>
<span class="line-added">+  * in place that prevents concurrent access and closing of the scope.</span>
   */
  abstract class MemoryScope {
  
      /**
       * Creates a root MemoryScope with given ref, cleanupAction and current
</pre>
<hr />
<pre>
<span class="line-old-header">*** 182,16 ***</span>
       *                               method is executed outside owning thread
       *                               in checked scope
       */
      @ForceInline
      final void checkValidState() {
<span class="line-modified">!         if (owner != null) {</span>
<span class="line-modified">!             if (owner != Thread.currentThread()) {</span>
<span class="line-removed">-                 throw new IllegalStateException(&quot;Attempted access outside owning thread&quot;);</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             checkAliveConfined(this);</span>
          }
      }
  
      /**
       * Checks that this scope is still alive.
       *
<span class="line-new-header">--- 185,14 ---</span>
       *                               method is executed outside owning thread
       *                               in checked scope
       */
      @ForceInline
      final void checkValidState() {
<span class="line-modified">!         if (owner != null &amp;&amp; owner != Thread.currentThread()) {</span>
<span class="line-modified">!             throw new IllegalStateException(&quot;Attempted access outside owning thread&quot;);</span>
          }
<span class="line-added">+         checkAliveConfined(this);</span>
      }
  
      /**
       * Checks that this scope is still alive.
       *
</pre>
<center>&lt; prev <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>