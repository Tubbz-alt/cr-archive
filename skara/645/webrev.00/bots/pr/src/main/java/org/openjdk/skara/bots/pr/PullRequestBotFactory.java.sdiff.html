<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/pr/src/main/java/org/openjdk/skara/bots/pr/PullRequestBotFactory.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="PullRequestBotBuilder.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/bots/pr/LabelerTests.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>bots/pr/src/main/java/org/openjdk/skara/bots/pr/PullRequestBotFactory.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 45             for (var command : specific.get(&quot;external&quot;).fields()) {
 46                 external.put(command.name(), command.value().asString());
 47             }
 48         }
 49 
 50         var blockers = new HashMap&lt;String, String&gt;();
 51         if (specific.contains(&quot;blockers&quot;)) {
 52             for (var blocker : specific.get(&quot;blockers&quot;).fields()) {
 53                 blockers.put(blocker.name(), blocker.value().asString());
 54             }
 55         }
 56 
 57         var readyLabels = specific.get(&quot;ready&quot;).get(&quot;labels&quot;).stream()
 58                                   .map(JSONValue::asString)
 59                                   .collect(Collectors.toSet());
 60         var readyComments = specific.get(&quot;ready&quot;).get(&quot;comments&quot;).stream()
 61                                     .map(JSONValue::asObject)
 62                                     .collect(Collectors.toMap(obj -&gt; obj.get(&quot;user&quot;).asString(),
 63                                                               obj -&gt; Pattern.compile(obj.get(&quot;pattern&quot;).asString())));
 64 





























 65         for (var repo : specific.get(&quot;repositories&quot;).fields()) {
 66             var censusRepo = configuration.repository(repo.value().get(&quot;census&quot;).asString());
 67             var censusRef = configuration.repositoryRef(repo.value().get(&quot;census&quot;).asString());
 68 
 69             var botBuilder = PullRequestBot.newBuilder()
 70                                            .repo(configuration.repository(repo.name()))
 71                                            .censusRepo(censusRepo)
 72                                            .censusRef(censusRef)
 73                                            .blockingCheckLabels(blockers)
 74                                            .readyLabels(readyLabels)
 75                                            .readyComments(readyComments)
 76                                            .externalCommands(external)
 77                                            .seedStorage(configuration.storageFolder().resolve(&quot;seeds&quot;));
 78 
 79             if (repo.value().contains(&quot;labels&quot;)) {
<span class="line-modified"> 80                 var labelPatterns = new HashMap&lt;String, List&lt;Pattern&gt;&gt;();</span>
<span class="line-modified"> 81                 for (var label : repo.value().get(&quot;labels&quot;).fields()) {</span>
<span class="line-modified"> 82                     var patterns = label.value().stream()</span>
<span class="line-removed"> 83                                         .map(JSONValue::asString)</span>
<span class="line-removed"> 84                                         .map(Pattern::compile)</span>
<span class="line-removed"> 85                                         .collect(Collectors.toList());</span>
<span class="line-removed"> 86                     labelPatterns.put(label.name(), patterns);</span>
 87                 }
<span class="line-modified"> 88                 botBuilder.labelPatterns(labelPatterns);</span>
 89             }
 90             if (repo.value().contains(&quot;issues&quot;)) {
 91                 botBuilder.issueProject(configuration.issueProject(repo.value().get(&quot;issues&quot;).asString()));
 92             }
 93             if (repo.value().contains(&quot;ignorestale&quot;)) {
 94                 botBuilder.ignoreStaleReviews(repo.value().get(&quot;ignorestale&quot;).asBoolean());
 95             }
 96             if (repo.value().contains(&quot;targetbranches&quot;)) {
 97                 botBuilder.allowedTargetBranches(repo.value().get(&quot;targetbranches&quot;).asString());
 98             }
 99 
100             ret.add(botBuilder.build());
101         }
102 
103         return ret;
104     }
105 }
</pre>
</td>
<td>
<hr />
<pre>
 45             for (var command : specific.get(&quot;external&quot;).fields()) {
 46                 external.put(command.name(), command.value().asString());
 47             }
 48         }
 49 
 50         var blockers = new HashMap&lt;String, String&gt;();
 51         if (specific.contains(&quot;blockers&quot;)) {
 52             for (var blocker : specific.get(&quot;blockers&quot;).fields()) {
 53                 blockers.put(blocker.name(), blocker.value().asString());
 54             }
 55         }
 56 
 57         var readyLabels = specific.get(&quot;ready&quot;).get(&quot;labels&quot;).stream()
 58                                   .map(JSONValue::asString)
 59                                   .collect(Collectors.toSet());
 60         var readyComments = specific.get(&quot;ready&quot;).get(&quot;comments&quot;).stream()
 61                                     .map(JSONValue::asObject)
 62                                     .collect(Collectors.toMap(obj -&gt; obj.get(&quot;user&quot;).asString(),
 63                                                               obj -&gt; Pattern.compile(obj.get(&quot;pattern&quot;).asString())));
 64 
<span class="line-added"> 65         var labelConfigurations = new HashMap&lt;String, LabelConfiguration&gt;();</span>
<span class="line-added"> 66         for (var labelGroup : specific.get(&quot;labels&quot;).fields()) {</span>
<span class="line-added"> 67             var labelConfiguration = LabelConfiguration.newBuilder();</span>
<span class="line-added"> 68             if (labelGroup.value().contains(&quot;matchers&quot;)) {</span>
<span class="line-added"> 69                 var matchers = labelGroup.value().get(&quot;matchers&quot;).fields().stream()</span>
<span class="line-added"> 70                                          .collect(Collectors.toMap(JSONObject.Field::name,</span>
<span class="line-added"> 71                                                                    field -&gt; field.value().stream()</span>
<span class="line-added"> 72                                                                                  .map(JSONValue::asString)</span>
<span class="line-added"> 73                                                                                  .map(Pattern::compile)</span>
<span class="line-added"> 74                                                                                  .collect(Collectors.toList())));</span>
<span class="line-added"> 75                 matchers.forEach(labelConfiguration::addMatchers);</span>
<span class="line-added"> 76             }</span>
<span class="line-added"> 77             if (labelGroup.value().contains(&quot;groups&quot;)) {</span>
<span class="line-added"> 78                 var groups = labelGroup.value().get(&quot;groups&quot;).fields().stream()</span>
<span class="line-added"> 79                                        .collect(Collectors.toMap(JSONObject.Field::name,</span>
<span class="line-added"> 80                                                                  field -&gt; field.value().stream()</span>
<span class="line-added"> 81                                                                                .map(JSONValue::asString)</span>
<span class="line-added"> 82                                                                                .collect(Collectors.toList())));</span>
<span class="line-added"> 83                 groups.forEach(labelConfiguration::addGroup);</span>
<span class="line-added"> 84             }</span>
<span class="line-added"> 85             if (labelGroup.value().contains(&quot;extra&quot;)) {</span>
<span class="line-added"> 86                 var extra = labelGroup.value().get(&quot;extra&quot;).stream()</span>
<span class="line-added"> 87                                       .map(JSONValue::asString)</span>
<span class="line-added"> 88                                       .collect(Collectors.toList());</span>
<span class="line-added"> 89                 extra.forEach(labelConfiguration::addExtra);</span>
<span class="line-added"> 90             }</span>
<span class="line-added"> 91             labelConfigurations.put(labelGroup.name(), labelConfiguration.build());</span>
<span class="line-added"> 92         }</span>
<span class="line-added"> 93 </span>
 94         for (var repo : specific.get(&quot;repositories&quot;).fields()) {
 95             var censusRepo = configuration.repository(repo.value().get(&quot;census&quot;).asString());
 96             var censusRef = configuration.repositoryRef(repo.value().get(&quot;census&quot;).asString());
 97 
 98             var botBuilder = PullRequestBot.newBuilder()
 99                                            .repo(configuration.repository(repo.name()))
100                                            .censusRepo(censusRepo)
101                                            .censusRef(censusRef)
102                                            .blockingCheckLabels(blockers)
103                                            .readyLabels(readyLabels)
104                                            .readyComments(readyComments)
105                                            .externalCommands(external)
106                                            .seedStorage(configuration.storageFolder().resolve(&quot;seeds&quot;));
107 
108             if (repo.value().contains(&quot;labels&quot;)) {
<span class="line-modified">109                 var labelGroup = repo.value().get(&quot;labels&quot;).asString();</span>
<span class="line-modified">110                 if (!labelConfigurations.containsKey(labelGroup)) {</span>
<span class="line-modified">111                     throw new RuntimeException(&quot;Unknown label group: &quot; + labelGroup);</span>




112                 }
<span class="line-modified">113                 botBuilder.labelConfiguration(labelConfigurations.get(labelGroup));</span>
114             }
115             if (repo.value().contains(&quot;issues&quot;)) {
116                 botBuilder.issueProject(configuration.issueProject(repo.value().get(&quot;issues&quot;).asString()));
117             }
118             if (repo.value().contains(&quot;ignorestale&quot;)) {
119                 botBuilder.ignoreStaleReviews(repo.value().get(&quot;ignorestale&quot;).asBoolean());
120             }
121             if (repo.value().contains(&quot;targetbranches&quot;)) {
122                 botBuilder.allowedTargetBranches(repo.value().get(&quot;targetbranches&quot;).asString());
123             }
124 
125             ret.add(botBuilder.build());
126         }
127 
128         return ret;
129     }
130 }
</pre>
</td>
</tr>
</table>
<center><a href="PullRequestBotBuilder.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/bots/pr/LabelerTests.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>