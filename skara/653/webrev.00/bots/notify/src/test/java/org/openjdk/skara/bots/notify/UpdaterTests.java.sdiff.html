<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/notify/src/test/java/org/openjdk/skara/bots/notify/UpdaterTests.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../main/java/org/openjdk/skara/bots/notify/slack/SlackNotifier.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>bots/notify/src/test/java/org/openjdk/skara/bots/notify/UpdaterTests.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 33 import java.io.IOException;
 34 import java.util.List;
 35 import java.util.regex.Pattern;
 36 
 37 import static org.junit.jupiter.api.Assertions.*;
 38 import static org.openjdk.skara.bots.notify.TestUtils.*;
 39 
 40 public class UpdaterTests {
 41     private static class TestRepositoryListener implements Notifier, RepositoryListener {
 42         private final String name;
 43         private final boolean idempotent;
 44         private int updateCount = 0;
 45         private boolean shouldFail = false;
 46 
 47         TestRepositoryListener(String name, boolean idempotent) {
 48             this.name = name;
 49             this.idempotent = idempotent;
 50         }
 51 
 52         @Override
<span class="line-modified"> 53         public void handleCommits(HostedRepository repository, Repository localRepository, List&lt;Commit&gt; commits,</span>
 54                                   Branch branch) throws NonRetriableException {
 55             updateCount++;
 56             if (shouldFail) {
 57                 if (idempotent) {
 58                     throw new RuntimeException(&quot;induced failure&quot;);
 59                 } else {
 60                     throw new NonRetriableException(new RuntimeException(&quot;unretriable failure&quot;));
 61                 }
 62             }
 63         }
 64 
 65         @Override
<span class="line-modified"> 66         public void handleOpenJDKTagCommits(HostedRepository repository, Repository localRepository,</span>
 67          List&lt;Commit&gt; commits, OpenJDKTag tag, Tag.Annotated annotated) {
 68             throw new RuntimeException(&quot;unexpected&quot;);
 69         }
 70 
 71         @Override
<span class="line-modified"> 72         public void handleTagCommit(HostedRepository repository, Repository localRepository, Commit commit, Tag tag,</span>
 73          Tag.Annotated annotation) {
 74             throw new RuntimeException(&quot;unexpected&quot;);
 75         }
 76 
 77         @Override
<span class="line-modified"> 78         public void handleNewBranch(HostedRepository repository, Repository localRepository, List&lt;Commit&gt; commits,</span>
 79          Branch parent, Branch branch) {
 80             throw new RuntimeException(&quot;unexpected&quot;);
 81         }
 82 
 83         @Override
 84         public String name() {
 85             return name;
 86         }
 87 
 88         @Override
 89         public void attachTo(Emitter e) {
 90             e.registerRepositoryListener(this);
 91         }
 92     }
 93 
 94     @Test
 95     void testIdempotenceMix(TestInfo testInfo) throws IOException {
 96         try (var credentials = new HostCredentials(testInfo);
 97              var tempFolder = new TemporaryDirectory()) {
 98             var repo = credentials.getHostedRepository();
</pre>
</td>
<td>
<hr />
<pre>
 33 import java.io.IOException;
 34 import java.util.List;
 35 import java.util.regex.Pattern;
 36 
 37 import static org.junit.jupiter.api.Assertions.*;
 38 import static org.openjdk.skara.bots.notify.TestUtils.*;
 39 
 40 public class UpdaterTests {
 41     private static class TestRepositoryListener implements Notifier, RepositoryListener {
 42         private final String name;
 43         private final boolean idempotent;
 44         private int updateCount = 0;
 45         private boolean shouldFail = false;
 46 
 47         TestRepositoryListener(String name, boolean idempotent) {
 48             this.name = name;
 49             this.idempotent = idempotent;
 50         }
 51 
 52         @Override
<span class="line-modified"> 53         public void onNewCommits(HostedRepository repository, Repository localRepository, List&lt;Commit&gt; commits,</span>
 54                                   Branch branch) throws NonRetriableException {
 55             updateCount++;
 56             if (shouldFail) {
 57                 if (idempotent) {
 58                     throw new RuntimeException(&quot;induced failure&quot;);
 59                 } else {
 60                     throw new NonRetriableException(new RuntimeException(&quot;unretriable failure&quot;));
 61                 }
 62             }
 63         }
 64 
 65         @Override
<span class="line-modified"> 66         public void onNewOpenJDKTagCommits(HostedRepository repository, Repository localRepository,</span>
 67          List&lt;Commit&gt; commits, OpenJDKTag tag, Tag.Annotated annotated) {
 68             throw new RuntimeException(&quot;unexpected&quot;);
 69         }
 70 
 71         @Override
<span class="line-modified"> 72         public void onNewTagCommit(HostedRepository repository, Repository localRepository, Commit commit, Tag tag,</span>
 73          Tag.Annotated annotation) {
 74             throw new RuntimeException(&quot;unexpected&quot;);
 75         }
 76 
 77         @Override
<span class="line-modified"> 78         public void onNewBranch(HostedRepository repository, Repository localRepository, List&lt;Commit&gt; commits,</span>
 79          Branch parent, Branch branch) {
 80             throw new RuntimeException(&quot;unexpected&quot;);
 81         }
 82 
 83         @Override
 84         public String name() {
 85             return name;
 86         }
 87 
 88         @Override
 89         public void attachTo(Emitter e) {
 90             e.registerRepositoryListener(this);
 91         }
 92     }
 93 
 94     @Test
 95     void testIdempotenceMix(TestInfo testInfo) throws IOException {
 96         try (var credentials = new HostCredentials(testInfo);
 97              var tempFolder = new TemporaryDirectory()) {
 98             var repo = credentials.getHostedRepository();
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../main/java/org/openjdk/skara/bots/notify/slack/SlackNotifier.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>