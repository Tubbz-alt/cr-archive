<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff bots/notify/src/test/java/org/openjdk/skara/bots/notify/mailinglist/MailingListNotifierTests.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../json/JsonNotifierTests.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>bots/notify/src/test/java/org/openjdk/skara/bots/notify/mailinglist/MailingListNotifierTests.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -56,29 +56,29 @@</span>
              var branchStorage = createBranchStorage(repo);
              var prStateStorage = createPullRequestStateStorage(repo);
              var storageFolder = tempFolder.path().resolve(&quot;storage&quot;);
  
              var sender = EmailAddress.from(&quot;duke&quot;, &quot;duke@duke.duke&quot;);
<span class="udiff-line-added">+             var notifyBot = NotifyBot.newBuilder()</span>
<span class="udiff-line-added">+                                      .repository(repo)</span>
<span class="udiff-line-added">+                                      .storagePath(storageFolder)</span>
<span class="udiff-line-added">+                                      .branches(Pattern.compile(&quot;master&quot;))</span>
<span class="udiff-line-added">+                                      .tagStorageBuilder(tagStorage)</span>
<span class="udiff-line-added">+                                      .branchStorageBuilder(branchStorage)</span>
<span class="udiff-line-added">+                                      .prStateStorageBuilder(prStateStorage)</span>
<span class="udiff-line-added">+                                      .build();</span>
              var updater = MailingListNotifier.newBuilder()
                                               .list(mailmanList)
                                               .recipient(listAddress)
                                               .sender(sender)
                                               .reportNewTags(false)
                                               .reportNewBranches(false)
                                               .reportNewBuilds(false)
                                               .headers(Map.of(&quot;extra1&quot;, &quot;value1&quot;, &quot;extra2&quot;, &quot;value2&quot;))
                                               .allowedAuthorDomains(Pattern.compile(&quot;none&quot;))
                                               .build();
<span class="udiff-line-modified-removed">-             var notifyBot = NotifyBot.newBuilder()</span>
<span class="udiff-line-removed">-                                      .repository(repo)</span>
<span class="udiff-line-removed">-                                      .storagePath(storageFolder)</span>
<span class="udiff-line-removed">-                                      .branches(Pattern.compile(&quot;master&quot;))</span>
<span class="udiff-line-removed">-                                      .tagStorageBuilder(tagStorage)</span>
<span class="udiff-line-removed">-                                      .branchStorageBuilder(branchStorage)</span>
<span class="udiff-line-removed">-                                      .prStateStorageBuilder(prStateStorage)</span>
<span class="udiff-line-removed">-                                      .updaters(List.of(updater))</span>
<span class="udiff-line-removed">-                                      .build();</span>
<span class="udiff-line-modified-added">+             updater.attachTo(notifyBot);</span>
  
              // No mail should be sent on the first run as there is no history
              TestBotRunner.runPeriodicItems(notifyBot);
              assertThrows(RuntimeException.class, () -&gt; listServer.processIncoming(Duration.ofMillis(1)));
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -128,27 +128,27 @@</span>
              var branchStorage = createBranchStorage(repo);
              var prStateStorage = createPullRequestStateStorage(repo);
              var storageFolder = tempFolder.path().resolve(&quot;storage&quot;);
  
              var sender = EmailAddress.from(&quot;duke&quot;, &quot;duke@duke.duke&quot;);
<span class="udiff-line-removed">-             var updater = MailingListNotifier.newBuilder()</span>
<span class="udiff-line-removed">-                                              .list(mailmanList)</span>
<span class="udiff-line-removed">-                                              .recipient(listAddress)</span>
<span class="udiff-line-removed">-                                              .sender(sender)</span>
<span class="udiff-line-removed">-                                              .reportNewTags(false)</span>
<span class="udiff-line-removed">-                                              .reportNewBranches(false)</span>
<span class="udiff-line-removed">-                                              .reportNewBuilds(false)</span>
<span class="udiff-line-removed">-                                              .build();</span>
              var notifyBot = NotifyBot.newBuilder()
                                       .repository(repo)
                                       .storagePath(storageFolder)
                                       .branches(Pattern.compile(&quot;master&quot;))
                                       .tagStorageBuilder(tagStorage)
                                       .branchStorageBuilder(branchStorage)
                                       .prStateStorageBuilder(prStateStorage)
<span class="udiff-line-removed">-                                      .updaters(List.of(updater))</span>
                                       .build();
<span class="udiff-line-added">+             var updater = MailingListNotifier.newBuilder()</span>
<span class="udiff-line-added">+                                              .list(mailmanList)</span>
<span class="udiff-line-added">+                                              .recipient(listAddress)</span>
<span class="udiff-line-added">+                                              .sender(sender)</span>
<span class="udiff-line-added">+                                              .reportNewTags(false)</span>
<span class="udiff-line-added">+                                              .reportNewBranches(false)</span>
<span class="udiff-line-added">+                                              .reportNewBuilds(false)</span>
<span class="udiff-line-added">+                                              .build();</span>
<span class="udiff-line-added">+             updater.attachTo(notifyBot);</span>
  
              // No mail should be sent on the first run as there is no history
              TestBotRunner.runPeriodicItems(notifyBot);
              assertThrows(RuntimeException.class, () -&gt; listServer.processIncoming(Duration.ofMillis(1)));
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -200,27 +200,27 @@</span>
              var branchStorage = createBranchStorage(repo);
              var prStateStorage = createPullRequestStateStorage(repo);
              var storageFolder = tempFolder.path().resolve(&quot;storage&quot;);
  
              var sender = EmailAddress.from(&quot;duke&quot;, &quot;duke@duke.duke&quot;);
<span class="udiff-line-removed">-             var updater = MailingListNotifier.newBuilder()</span>
<span class="udiff-line-removed">-                                              .list(mailmanList)</span>
<span class="udiff-line-removed">-                                              .recipient(listAddress)</span>
<span class="udiff-line-removed">-                                              .sender(sender)</span>
<span class="udiff-line-removed">-                                              .reportNewTags(false)</span>
<span class="udiff-line-removed">-                                              .reportNewBranches(false)</span>
<span class="udiff-line-removed">-                                              .reportNewBuilds(false)</span>
<span class="udiff-line-removed">-                                              .build();</span>
              var notifyBot = NotifyBot.newBuilder()
                                       .repository(repo)
                                       .storagePath(storageFolder)
                                       .branches(Pattern.compile(&quot;master&quot;))
                                       .tagStorageBuilder(tagStorage)
                                       .branchStorageBuilder(branchStorage)
                                       .prStateStorageBuilder(prStateStorage)
<span class="udiff-line-removed">-                                      .updaters(List.of(updater))</span>
                                       .build();
<span class="udiff-line-added">+             var updater = MailingListNotifier.newBuilder()</span>
<span class="udiff-line-added">+                                              .list(mailmanList)</span>
<span class="udiff-line-added">+                                              .recipient(listAddress)</span>
<span class="udiff-line-added">+                                              .sender(sender)</span>
<span class="udiff-line-added">+                                              .reportNewTags(false)</span>
<span class="udiff-line-added">+                                              .reportNewBranches(false)</span>
<span class="udiff-line-added">+                                              .reportNewBuilds(false)</span>
<span class="udiff-line-added">+                                              .build();</span>
<span class="udiff-line-added">+             updater.attachTo(notifyBot);</span>
  
              // No mail should be sent on the first run as there is no history
              TestBotRunner.runPeriodicItems(notifyBot);
              assertThrows(RuntimeException.class, () -&gt; listServer.processIncoming(Duration.ofMillis(1)));
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -265,29 +265,29 @@</span>
              var prStateStorage = createPullRequestStateStorage(repo);
              var storageFolder = tempFolder.path().resolve(&quot;storage&quot;);
  
              var sender = EmailAddress.from(&quot;duke&quot;, &quot;duke@duke.duke&quot;);
              var author = EmailAddress.from(&quot;author&quot;, &quot;author@duke.duke&quot;);
<span class="udiff-line-added">+             var notifyBot = NotifyBot.newBuilder()</span>
<span class="udiff-line-added">+                                      .repository(repo)</span>
<span class="udiff-line-added">+                                      .storagePath(storageFolder)</span>
<span class="udiff-line-added">+                                      .branches(Pattern.compile(&quot;master|another&quot;))</span>
<span class="udiff-line-added">+                                      .tagStorageBuilder(tagStorage)</span>
<span class="udiff-line-added">+                                      .branchStorageBuilder(branchStorage)</span>
<span class="udiff-line-added">+                                      .prStateStorageBuilder(prStateStorage)</span>
<span class="udiff-line-added">+                                      .build();</span>
              var updater = MailingListNotifier.newBuilder()
                                               .list(mailmanList)
                                               .recipient(listAddress)
                                               .sender(sender)
                                               .author(author)
                                               .includeBranch(true)
                                               .reportNewTags(false)
                                               .reportNewBranches(false)
                                               .reportNewBuilds(false)
                                               .build();
<span class="udiff-line-modified-removed">-             var notifyBot = NotifyBot.newBuilder()</span>
<span class="udiff-line-removed">-                                      .repository(repo)</span>
<span class="udiff-line-removed">-                                      .storagePath(storageFolder)</span>
<span class="udiff-line-removed">-                                      .branches(Pattern.compile(&quot;master|another&quot;))</span>
<span class="udiff-line-removed">-                                      .tagStorageBuilder(tagStorage)</span>
<span class="udiff-line-removed">-                                      .branchStorageBuilder(branchStorage)</span>
<span class="udiff-line-removed">-                                      .prStateStorageBuilder(prStateStorage)</span>
<span class="udiff-line-removed">-                                      .updaters(List.of(updater))</span>
<span class="udiff-line-removed">-                                      .build();</span>
<span class="udiff-line-modified-added">+             updater.attachTo(notifyBot);</span>
  
              // No mail should be sent on the first run as there is no history
              TestBotRunner.runPeriodicItems(notifyBot);
              assertThrows(RuntimeException.class, () -&gt; listServer.processIncoming(Duration.ofMillis(1)));
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -363,10 +363,18 @@</span>
              var prStateStorage = createPullRequestStateStorage(repo);
              var storageFolder = tempFolder.path().resolve(&quot;storage&quot;);
  
              var sender = EmailAddress.from(&quot;duke&quot;, &quot;duke@duke.duke&quot;);
              var author = EmailAddress.from(&quot;author&quot;, &quot;author@duke.duke&quot;);
<span class="udiff-line-added">+             var notifyBot = NotifyBot.newBuilder()</span>
<span class="udiff-line-added">+                                      .repository(repo)</span>
<span class="udiff-line-added">+                                      .storagePath(storageFolder)</span>
<span class="udiff-line-added">+                                      .branches(Pattern.compile(&quot;master|other&quot;))</span>
<span class="udiff-line-added">+                                      .tagStorageBuilder(tagStorage)</span>
<span class="udiff-line-added">+                                      .branchStorageBuilder(branchStorage)</span>
<span class="udiff-line-added">+                                      .prStateStorageBuilder(prStateStorage)</span>
<span class="udiff-line-added">+                                      .build();</span>
              var updater = MailingListNotifier.newBuilder()
                                               .list(mailmanList)
                                               .recipient(listAddress)
                                               .sender(sender)
                                               .author(author)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -374,19 +382,11 @@</span>
                                               .reportNewBranches(false)
                                               .reportNewBuilds(false)
                                               .includeBranch(true)
                                               .mode(MailingListNotifier.Mode.PR)
                                               .build();
<span class="udiff-line-modified-removed">-             var notifyBot = NotifyBot.newBuilder()</span>
<span class="udiff-line-removed">-                                      .repository(repo)</span>
<span class="udiff-line-removed">-                                      .storagePath(storageFolder)</span>
<span class="udiff-line-removed">-                                      .branches(Pattern.compile(&quot;master|other&quot;))</span>
<span class="udiff-line-removed">-                                      .tagStorageBuilder(tagStorage)</span>
<span class="udiff-line-removed">-                                      .branchStorageBuilder(branchStorage)</span>
<span class="udiff-line-removed">-                                      .prStateStorageBuilder(prStateStorage)</span>
<span class="udiff-line-removed">-                                      .updaters(List.of(updater))</span>
<span class="udiff-line-removed">-                                      .build();</span>
<span class="udiff-line-modified-added">+             updater.attachTo(notifyBot);</span>
  
              // Populate our known branches
              localRepo.push(masterHash, repo.url(), &quot;master&quot;, true);
              localRepo.push(masterHash, repo.url(), &quot;other&quot;, true);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -448,28 +448,28 @@</span>
              var branchStorage = createBranchStorage(repo);
              var prStateStorage = createPullRequestStateStorage(repo);
              var storageFolder = tempFolder.path().resolve(&quot;storage&quot;);
  
              var sender = EmailAddress.from(&quot;duke&quot;, &quot;duke@duke.duke&quot;);
<span class="udiff-line-added">+             var notifyBot = NotifyBot.newBuilder()</span>
<span class="udiff-line-added">+                                      .repository(repo)</span>
<span class="udiff-line-added">+                                      .storagePath(storageFolder)</span>
<span class="udiff-line-added">+                                      .branches(Pattern.compile(&quot;master&quot;))</span>
<span class="udiff-line-added">+                                      .tagStorageBuilder(tagStorage)</span>
<span class="udiff-line-added">+                                      .branchStorageBuilder(branchStorage)</span>
<span class="udiff-line-added">+                                      .prStateStorageBuilder(prStateStorage)</span>
<span class="udiff-line-added">+                                      .build();</span>
              var updater = MailingListNotifier.newBuilder()
                                               .list(mailmanList)
                                               .recipient(listAddress)
                                               .sender(sender)
                                               .reportNewTags(false)
                                               .reportNewBranches(false)
                                               .reportNewBuilds(false)
                                               .mode(MailingListNotifier.Mode.PR)
                                               .build();
<span class="udiff-line-modified-removed">-             var notifyBot = NotifyBot.newBuilder()</span>
<span class="udiff-line-removed">-                                      .repository(repo)</span>
<span class="udiff-line-removed">-                                      .storagePath(storageFolder)</span>
<span class="udiff-line-removed">-                                      .branches(Pattern.compile(&quot;master&quot;))</span>
<span class="udiff-line-removed">-                                      .tagStorageBuilder(tagStorage)</span>
<span class="udiff-line-removed">-                                      .branchStorageBuilder(branchStorage)</span>
<span class="udiff-line-removed">-                                      .prStateStorageBuilder(prStateStorage)</span>
<span class="udiff-line-removed">-                                      .updaters(List.of(updater))</span>
<span class="udiff-line-removed">-                                      .build();</span>
<span class="udiff-line-modified-added">+             updater.attachTo(notifyBot);</span>
  
              // No mail should be sent on the first run as there is no history
              TestBotRunner.runPeriodicItems(notifyBot);
              assertThrows(RuntimeException.class, () -&gt; listServer.processIncoming(Duration.ofMillis(1)));
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -540,29 +540,29 @@</span>
              var branchStorage = createBranchStorage(repo);
              var prStateStorage = createPullRequestStateStorage(repo);
              var storageFolder = tempFolder.path().resolve(&quot;storage&quot;);
  
              var sender = EmailAddress.from(&quot;duke&quot;, &quot;duke@duke.duke&quot;);
<span class="udiff-line-added">+             var notifyBot = NotifyBot.newBuilder()</span>
<span class="udiff-line-added">+                                      .repository(repo)</span>
<span class="udiff-line-added">+                                      .storagePath(storageFolder)</span>
<span class="udiff-line-added">+                                      .branches(Pattern.compile(&quot;master|other&quot;))</span>
<span class="udiff-line-added">+                                      .tagStorageBuilder(tagStorage)</span>
<span class="udiff-line-added">+                                      .branchStorageBuilder(branchStorage)</span>
<span class="udiff-line-added">+                                      .prStateStorageBuilder(prStateStorage)</span>
<span class="udiff-line-added">+                                      .build();</span>
              var updater = MailingListNotifier.newBuilder()
                                               .list(mailmanList)
                                               .recipient(listAddress)
                                               .sender(sender)
                                               .author(null)
                                               .reportNewTags(false)
                                               .reportNewBranches(false)
                                               .reportNewBuilds(false)
                                               .mode(MailingListNotifier.Mode.PR)
                                               .build();
<span class="udiff-line-modified-removed">-             var notifyBot = NotifyBot.newBuilder()</span>
<span class="udiff-line-removed">-                                      .repository(repo)</span>
<span class="udiff-line-removed">-                                      .storagePath(storageFolder)</span>
<span class="udiff-line-removed">-                                      .branches(Pattern.compile(&quot;master|other&quot;))</span>
<span class="udiff-line-removed">-                                      .tagStorageBuilder(tagStorage)</span>
<span class="udiff-line-removed">-                                      .branchStorageBuilder(branchStorage)</span>
<span class="udiff-line-removed">-                                      .prStateStorageBuilder(prStateStorage)</span>
<span class="udiff-line-removed">-                                      .updaters(List.of(updater))</span>
<span class="udiff-line-removed">-                                      .build();</span>
<span class="udiff-line-modified-added">+             updater.attachTo(notifyBot);</span>
  
              // No mail should be sent on the first run as there is no history
              TestBotRunner.runPeriodicItems(notifyBot);
              assertThrows(RuntimeException.class, () -&gt; listServer.processIncoming(Duration.ofMillis(1)));
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -635,34 +635,36 @@</span>
              var branchStorage = createBranchStorage(repo);
              var prStateStorage = createPullRequestStateStorage(repo);
              var storageFolder = tempFolder.path().resolve(&quot;storage&quot;);
  
              var sender = EmailAddress.from(&quot;duke&quot;, &quot;duke@duke.duke&quot;);
<span class="udiff-line-added">+             var notifyBot = NotifyBot.newBuilder()</span>
<span class="udiff-line-added">+                                      .repository(repo)</span>
<span class="udiff-line-added">+                                      .storagePath(storageFolder)</span>
<span class="udiff-line-added">+                                      .branches(Pattern.compile(&quot;master&quot;))</span>
<span class="udiff-line-added">+                                      .tagStorageBuilder(tagStorage)</span>
<span class="udiff-line-added">+                                      .branchStorageBuilder(branchStorage)</span>
<span class="udiff-line-added">+                                      .prStateStorageBuilder(prStateStorage)</span>
<span class="udiff-line-added">+                                      .build();</span>
              var updater = MailingListNotifier.newBuilder()
                                               .list(mailmanList)
                                               .recipient(listAddress)
                                               .sender(sender)
                                               .reportNewBranches(false)
                                               .headers(Map.of(&quot;extra1&quot;, &quot;value1&quot;, &quot;extra2&quot;, &quot;value2&quot;))
                                               .build();
<span class="udiff-line-added">+             updater.attachTo(notifyBot);</span>
<span class="udiff-line-added">+ </span>
              var noTagsUpdater = MailingListNotifier.newBuilder()
                                                     .list(mailmanList)
                                                     .recipient(listAddress)
                                                     .sender(sender)
                                                     .reportNewTags(false)
                                                     .reportNewBranches(false)
                                                     .reportNewBuilds(false)
                                                     .build();
<span class="udiff-line-modified-removed">-             var notifyBot = NotifyBot.newBuilder()</span>
<span class="udiff-line-removed">-                                      .repository(repo)</span>
<span class="udiff-line-removed">-                                      .storagePath(storageFolder)</span>
<span class="udiff-line-removed">-                                      .branches(Pattern.compile(&quot;master&quot;))</span>
<span class="udiff-line-removed">-                                      .tagStorageBuilder(tagStorage)</span>
<span class="udiff-line-removed">-                                      .branchStorageBuilder(branchStorage)</span>
<span class="udiff-line-removed">-                                      .prStateStorageBuilder(prStateStorage)</span>
<span class="udiff-line-removed">-                                      .updaters(List.of(updater, noTagsUpdater))</span>
<span class="udiff-line-removed">-                                      .build();</span>
<span class="udiff-line-modified-added">+             noTagsUpdater.attachTo(notifyBot);</span>
  
              // No mail should be sent on the first run as there is no history
              TestBotRunner.runPeriodicItems(notifyBot);
              assertThrows(RuntimeException.class, () -&gt; listServer.processIncoming(Duration.ofMillis(1)));
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -752,35 +754,36 @@</span>
              var branchStorage = createBranchStorage(repo);
              var prStateStorage = createPullRequestStateStorage(repo);
              var storageFolder = tempFolder.path().resolve(&quot;storage&quot;);
  
              var sender = EmailAddress.from(&quot;duke&quot;, &quot;duke@duke.duke&quot;);
<span class="udiff-line-added">+             var notifyBot = NotifyBot.newBuilder()</span>
<span class="udiff-line-added">+                                      .repository(repo)</span>
<span class="udiff-line-added">+                                      .storagePath(storageFolder)</span>
<span class="udiff-line-added">+                                      .branches(Pattern.compile(&quot;master&quot;))</span>
<span class="udiff-line-added">+                                      .tagStorageBuilder(tagStorage)</span>
<span class="udiff-line-added">+                                      .branchStorageBuilder(branchStorage)</span>
<span class="udiff-line-added">+                                      .prStateStorageBuilder(prStateStorage)</span>
<span class="udiff-line-added">+                                      .build();</span>
              var updater = MailingListNotifier.newBuilder()
                                               .list(mailmanList)
                                               .recipient(listAddress)
                                               .sender(sender)
                                               .reportNewBranches(false)
                                               .reportNewBuilds(false)
                                               .headers(Map.of(&quot;extra1&quot;, &quot;value1&quot;, &quot;extra2&quot;, &quot;value2&quot;))
                                               .build();
<span class="udiff-line-added">+             updater.attachTo(notifyBot);</span>
              var noTagsUpdater = MailingListNotifier.newBuilder()
                                                     .list(mailmanList)
                                                     .recipient(listAddress)
                                                     .sender(sender)
                                                     .reportNewTags(false)
                                                     .reportNewBranches(false)
                                                     .reportNewBuilds(false)
                                                     .build();
<span class="udiff-line-modified-removed">-             var notifyBot = NotifyBot.newBuilder()</span>
<span class="udiff-line-removed">-                                      .repository(repo)</span>
<span class="udiff-line-removed">-                                      .storagePath(storageFolder)</span>
<span class="udiff-line-removed">-                                      .branches(Pattern.compile(&quot;master&quot;))</span>
<span class="udiff-line-removed">-                                      .tagStorageBuilder(tagStorage)</span>
<span class="udiff-line-removed">-                                      .branchStorageBuilder(branchStorage)</span>
<span class="udiff-line-removed">-                                      .prStateStorageBuilder(prStateStorage)</span>
<span class="udiff-line-removed">-                                      .updaters(List.of(updater, noTagsUpdater))</span>
<span class="udiff-line-removed">-                                      .build();</span>
<span class="udiff-line-modified-added">+             noTagsUpdater.attachTo(notifyBot);</span>
  
              // No mail should be sent on the first run as there is no history
              TestBotRunner.runPeriodicItems(notifyBot);
              assertThrows(RuntimeException.class, () -&gt; listServer.processIncoming(Duration.ofMillis(1)));
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -845,27 +848,27 @@</span>
              var branchStorage = createBranchStorage(repo);
              var prStateStorage = createPullRequestStateStorage(repo);
              var storageFolder = tempFolder.path().resolve(&quot;storage&quot;);
  
              var sender = EmailAddress.from(&quot;duke&quot;, &quot;duke@duke.duke&quot;);
<span class="udiff-line-removed">-             var updater = MailingListNotifier.newBuilder()</span>
<span class="udiff-line-removed">-                                              .list(mailmanList)</span>
<span class="udiff-line-removed">-                                              .recipient(listAddress)</span>
<span class="udiff-line-removed">-                                              .sender(sender)</span>
<span class="udiff-line-removed">-                                              .reportNewTags(false)</span>
<span class="udiff-line-removed">-                                              .reportNewBuilds(false)</span>
<span class="udiff-line-removed">-                                              .headers(Map.of(&quot;extra1&quot;, &quot;value1&quot;, &quot;extra2&quot;, &quot;value2&quot;))</span>
<span class="udiff-line-removed">-                                              .build();</span>
              var notifyBot = NotifyBot.newBuilder()
                                       .repository(repo)
                                       .storagePath(storageFolder)
                                       .branches(Pattern.compile(&quot;master|newbranch.&quot;))
                                       .tagStorageBuilder(tagStorage)
                                       .branchStorageBuilder(branchStorage)
                                       .prStateStorageBuilder(prStateStorage)
<span class="udiff-line-removed">-                                      .updaters(List.of(updater))</span>
                                       .build();
<span class="udiff-line-added">+             var updater = MailingListNotifier.newBuilder()</span>
<span class="udiff-line-added">+                                              .list(mailmanList)</span>
<span class="udiff-line-added">+                                              .recipient(listAddress)</span>
<span class="udiff-line-added">+                                              .sender(sender)</span>
<span class="udiff-line-added">+                                              .reportNewTags(false)</span>
<span class="udiff-line-added">+                                              .reportNewBuilds(false)</span>
<span class="udiff-line-added">+                                              .headers(Map.of(&quot;extra1&quot;, &quot;value1&quot;, &quot;extra2&quot;, &quot;value2&quot;))</span>
<span class="udiff-line-added">+                                              .build();</span>
<span class="udiff-line-added">+             updater.attachTo(notifyBot);</span>
  
              // No mail should be sent on the first run as there is no history
              TestBotRunner.runPeriodicItems(notifyBot);
              assertThrows(RuntimeException.class, () -&gt; listServer.processIncoming(Duration.ofMillis(1)));
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -925,29 +928,29 @@</span>
              var branchStorage = createBranchStorage(repo);
              var prStateStorage = createPullRequestStateStorage(repo);
              var storageFolder = tempFolder.path().resolve(&quot;storage&quot;);
  
              var sender = EmailAddress.from(&quot;duke&quot;, &quot;duke@duke.duke&quot;);
<span class="udiff-line-added">+             var notifyBot = NotifyBot.newBuilder()</span>
<span class="udiff-line-added">+                                      .repository(repo)</span>
<span class="udiff-line-added">+                                      .storagePath(storageFolder)</span>
<span class="udiff-line-added">+                                      .branches(Pattern.compile(&quot;master&quot;))</span>
<span class="udiff-line-added">+                                      .tagStorageBuilder(tagStorage)</span>
<span class="udiff-line-added">+                                      .branchStorageBuilder(branchStorage)</span>
<span class="udiff-line-added">+                                      .prStateStorageBuilder(prStateStorage)</span>
<span class="udiff-line-added">+                                      .build();</span>
              var updater = MailingListNotifier.newBuilder()
                                               .list(mailmanList)
                                               .recipient(listAddress)
                                               .sender(sender)
                                               .reportNewTags(false)
                                               .reportNewBranches(false)
                                               .reportNewBuilds(false)
                                               .headers(Map.of(&quot;extra1&quot;, &quot;value1&quot;, &quot;extra2&quot;, &quot;value2&quot;))
                                               .allowedAuthorDomains(Pattern.compile(&quot;none&quot;))
                                               .build();
<span class="udiff-line-modified-removed">-             var notifyBot = NotifyBot.newBuilder()</span>
<span class="udiff-line-removed">-                                      .repository(repo)</span>
<span class="udiff-line-removed">-                                      .storagePath(storageFolder)</span>
<span class="udiff-line-removed">-                                      .branches(Pattern.compile(&quot;master&quot;))</span>
<span class="udiff-line-removed">-                                      .tagStorageBuilder(tagStorage)</span>
<span class="udiff-line-removed">-                                      .branchStorageBuilder(branchStorage)</span>
<span class="udiff-line-removed">-                                      .prStateStorageBuilder(prStateStorage)</span>
<span class="udiff-line-removed">-                                      .updaters(List.of(updater))</span>
<span class="udiff-line-removed">-                                      .build();</span>
<span class="udiff-line-modified-added">+             updater.attachTo(notifyBot);</span>
  
              // No mail should be sent on the first run as there is no history
              TestBotRunner.runPeriodicItems(notifyBot);
              assertThrows(RuntimeException.class, () -&gt; listServer.processIncoming(Duration.ofMillis(1)));
  
</pre>
<center><a href="../json/JsonNotifierTests.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>