<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff vcs/src/main/java/org/openjdk/skara/vcs/hg/HgRepository.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../git/GitRepository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>vcs/src/main/java/org/openjdk/skara/vcs/hg/HgRepository.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 386             await(p);
 387         }
 388     }
 389 
 390     @Override
 391     public void reset(Hash target, boolean hard) throws IOException {
 392         throw new RuntimeException(&quot;Not implemented yet&quot;);
 393     }
 394 
 395     @Override
 396     public Repository reinitialize() throws IOException {
 397         Files.walk(dir)
 398              .map(Path::toFile)
 399              .sorted(Comparator.reverseOrder())
 400              .forEach(File::delete);
 401 
 402         return init();
 403     }
 404 
 405     @Override
<span class="line-modified"> 406     public Hash fetch(URI uri, String refspec) throws IOException {</span>

 407         return fetch(uri != null ? uri.toString() : null, refspec);
 408     }
 409 
 410     private Hash fetch(String from, String refspec) throws IOException {
 411         var oldHeads = new HashSet&lt;Hash&gt;(heads());
 412 
 413         var cmd = new ArrayList&lt;String&gt;();
 414         cmd.add(&quot;hg&quot;);
 415         cmd.add(&quot;pull&quot;);
 416         if (refspec != null) {
 417             cmd.add(&quot;--rev&quot;);
 418             cmd.add(refspec);
 419         }
 420         if (from != null) {
 421             cmd.add(from);
 422         }
 423         try (var p = capture(cmd)) {
 424             await(p);
 425         }
 426 
 427         var newHeads = new HashSet&lt;Hash&gt;(heads());
 428         newHeads.removeAll(oldHeads);
 429 
 430         if (newHeads.size() &gt; 1) {
 431             throw new IllegalStateException(&quot;fetching multiple heads is not supported&quot;);
 432         } else if (newHeads.size() == 0) {
 433             // no new head was fetched, return current head
 434             return head();
 435         }
 436         return newHeads.iterator().next();
 437     }
 438 
 439     @Override
<span class="line-modified"> 440     public void fetchAll() throws IOException {</span>

 441         var pullPaths = new ArrayList&lt;URI&gt;();
 442         try (var p = capture(&quot;hg&quot;, &quot;paths&quot;)) {
 443             var res = await(p);
 444             for (var line : res.stdout()) {
 445                 var parts = line.split(&quot;=&quot;);
 446                 var name = parts[0].trim();
 447                 var uri = parts[1].trim();
 448                 if (!name.endsWith(&quot;-push&quot;)) {
 449                     pullPaths.add(URI.create(uri));
 450                 }
 451             }
 452         }
 453 
 454         for (var uri : pullPaths) {
 455             fetch(uri, null);
 456         }
 457     }
 458 
 459     @Override
 460     public void fetchRemote(String remote) throws IOException {
</pre>
</td>
<td>
<hr />
<pre>
 386             await(p);
 387         }
 388     }
 389 
 390     @Override
 391     public void reset(Hash target, boolean hard) throws IOException {
 392         throw new RuntimeException(&quot;Not implemented yet&quot;);
 393     }
 394 
 395     @Override
 396     public Repository reinitialize() throws IOException {
 397         Files.walk(dir)
 398              .map(Path::toFile)
 399              .sorted(Comparator.reverseOrder())
 400              .forEach(File::delete);
 401 
 402         return init();
 403     }
 404 
 405     @Override
<span class="line-modified"> 406     public Hash fetch(URI uri, String refspec, boolean includeTags) throws IOException {</span>
<span class="line-added"> 407         // Ignore includeTags, Mercurial always fetches tags</span>
 408         return fetch(uri != null ? uri.toString() : null, refspec);
 409     }
 410 
 411     private Hash fetch(String from, String refspec) throws IOException {
 412         var oldHeads = new HashSet&lt;Hash&gt;(heads());
 413 
 414         var cmd = new ArrayList&lt;String&gt;();
 415         cmd.add(&quot;hg&quot;);
 416         cmd.add(&quot;pull&quot;);
 417         if (refspec != null) {
 418             cmd.add(&quot;--rev&quot;);
 419             cmd.add(refspec);
 420         }
 421         if (from != null) {
 422             cmd.add(from);
 423         }
 424         try (var p = capture(cmd)) {
 425             await(p);
 426         }
 427 
 428         var newHeads = new HashSet&lt;Hash&gt;(heads());
 429         newHeads.removeAll(oldHeads);
 430 
 431         if (newHeads.size() &gt; 1) {
 432             throw new IllegalStateException(&quot;fetching multiple heads is not supported&quot;);
 433         } else if (newHeads.size() == 0) {
 434             // no new head was fetched, return current head
 435             return head();
 436         }
 437         return newHeads.iterator().next();
 438     }
 439 
 440     @Override
<span class="line-modified"> 441     public void fetchAll(boolean includeTags) throws IOException {</span>
<span class="line-added"> 442         // Ignore includeTags, Mercurial always fetches tags</span>
 443         var pullPaths = new ArrayList&lt;URI&gt;();
 444         try (var p = capture(&quot;hg&quot;, &quot;paths&quot;)) {
 445             var res = await(p);
 446             for (var line : res.stdout()) {
 447                 var parts = line.split(&quot;=&quot;);
 448                 var name = parts[0].trim();
 449                 var uri = parts[1].trim();
 450                 if (!name.endsWith(&quot;-push&quot;)) {
 451                     pullPaths.add(URI.create(uri));
 452                 }
 453             }
 454         }
 455 
 456         for (var uri : pullPaths) {
 457             fetch(uri, null);
 458         }
 459     }
 460 
 461     @Override
 462     public void fetchRemote(String remote) throws IOException {
</pre>
</td>
</tr>
</table>
<center><a href="../git/GitRepository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>