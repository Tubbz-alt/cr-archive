<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/ArchiveItem.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/ArchiveItem.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 23     private final Supplier&lt;String&gt; subject;
 24     private final Supplier&lt;String&gt; header;
 25     private final Supplier&lt;String&gt; body;
 26     private final Supplier&lt;String&gt; footer;
 27 
 28     private ArchiveItem(ArchiveItem parent, String id, ZonedDateTime created, ZonedDateTime updated, HostUser author, Map&lt;String, String&gt; extraHeaders, Supplier&lt;String&gt; subject, Supplier&lt;String&gt; header, Supplier&lt;String&gt; body, Supplier&lt;String&gt; footer) {
 29         this.id = id;
 30         this.created = created;
 31         this.updated = updated;
 32         this.author = author;
 33         this.extraHeaders = extraHeaders;
 34         this.parent = parent;
 35         this.subject = subject;
 36         this.header = header;
 37         this.body = body;
 38         this.footer = footer;
 39     }
 40 
 41     private static Optional&lt;Commit&gt; mergeCommit(Repository localRepo, Hash head) {
 42         try {
<span class="line-modified"> 43             var mergeCommit = localRepo.lookup(head);</span>
<span class="line-removed"> 44             if (mergeCommit.isEmpty()) {</span>
<span class="line-removed"> 45                 return Optional.empty();</span>
<span class="line-removed"> 46             }</span>
<span class="line-removed"> 47             if (!mergeCommit.get().isMerge()) {</span>
<span class="line-removed"> 48                 return Optional.empty();</span>
<span class="line-removed"> 49             }</span>
<span class="line-removed"> 50             return mergeCommit;</span>
 51         } catch (IOException e) {
 52             return Optional.empty();
 53         }
 54     }
 55 
 56     static ArchiveItem from(PullRequest pr, Repository localRepo, HostUserToEmailAuthor hostUserToEmailAuthor,
 57                             URI issueTracker, String issuePrefix, WebrevStorage.WebrevGenerator webrevGenerator,
 58                             WebrevNotification webrevNotification, ZonedDateTime created, ZonedDateTime updated,
 59                             Hash base, Hash head, String subjectPrefix) {
 60         return new ArchiveItem(null, &quot;fc&quot;, created, updated, pr.author(), Map.of(&quot;PR-Head-Hash&quot;, head.hex(), &quot;PR-Base-Hash&quot;, base.hex()),
 61                                () -&gt; subjectPrefix + &quot;RFR: &quot; + pr.title(),
 62                                () -&gt; &quot;&quot;,
 63                                () -&gt; ArchiveMessages.composeConversation(pr, localRepo, base, head),
 64                                () -&gt; {
 65                                    var fullWebrev = webrevGenerator.generate(base, head, &quot;00&quot;, WebrevDescription.Type.FULL);
 66                                    if (pr.title().startsWith(&quot;Merge&quot;)) {
 67                                        var mergeCommit = mergeCommit(localRepo, head);
 68                                         if (mergeCommit.isPresent()) {
 69                                             var mergeWebrevs = new ArrayList&lt;WebrevDescription&gt;();
 70                                             mergeWebrevs.add(fullWebrev);
</pre>
</td>
<td>
<hr />
<pre>
 23     private final Supplier&lt;String&gt; subject;
 24     private final Supplier&lt;String&gt; header;
 25     private final Supplier&lt;String&gt; body;
 26     private final Supplier&lt;String&gt; footer;
 27 
 28     private ArchiveItem(ArchiveItem parent, String id, ZonedDateTime created, ZonedDateTime updated, HostUser author, Map&lt;String, String&gt; extraHeaders, Supplier&lt;String&gt; subject, Supplier&lt;String&gt; header, Supplier&lt;String&gt; body, Supplier&lt;String&gt; footer) {
 29         this.id = id;
 30         this.created = created;
 31         this.updated = updated;
 32         this.author = author;
 33         this.extraHeaders = extraHeaders;
 34         this.parent = parent;
 35         this.subject = subject;
 36         this.header = header;
 37         this.body = body;
 38         this.footer = footer;
 39     }
 40 
 41     private static Optional&lt;Commit&gt; mergeCommit(Repository localRepo, Hash head) {
 42         try {
<span class="line-modified"> 43             return localRepo.lookup(head).filter(Commit::isMerge);</span>







 44         } catch (IOException e) {
 45             return Optional.empty();
 46         }
 47     }
 48 
 49     static ArchiveItem from(PullRequest pr, Repository localRepo, HostUserToEmailAuthor hostUserToEmailAuthor,
 50                             URI issueTracker, String issuePrefix, WebrevStorage.WebrevGenerator webrevGenerator,
 51                             WebrevNotification webrevNotification, ZonedDateTime created, ZonedDateTime updated,
 52                             Hash base, Hash head, String subjectPrefix) {
 53         return new ArchiveItem(null, &quot;fc&quot;, created, updated, pr.author(), Map.of(&quot;PR-Head-Hash&quot;, head.hex(), &quot;PR-Base-Hash&quot;, base.hex()),
 54                                () -&gt; subjectPrefix + &quot;RFR: &quot; + pr.title(),
 55                                () -&gt; &quot;&quot;,
 56                                () -&gt; ArchiveMessages.composeConversation(pr, localRepo, base, head),
 57                                () -&gt; {
 58                                    var fullWebrev = webrevGenerator.generate(base, head, &quot;00&quot;, WebrevDescription.Type.FULL);
 59                                    if (pr.title().startsWith(&quot;Merge&quot;)) {
 60                                        var mergeCommit = mergeCommit(localRepo, head);
 61                                         if (mergeCommit.isPresent()) {
 62                                             var mergeWebrevs = new ArrayList&lt;WebrevDescription&gt;();
 63                                             mergeWebrevs.add(fullWebrev);
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>