<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/pr/src/test/java/org/openjdk/skara/bots/pr/SummaryTests.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../main/java/org/openjdk/skara/bots/pr/SummaryCommand.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>bots/pr/src/test/java/org/openjdk/skara/bots/pr/SummaryTests.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
238             pr.addComment(&quot;/summary\n1L\n2L&quot;);
239             TestBotRunner.runPeriodicItems(prBot);
240 
241             // The bot should reply with a success message
242             assertLastCommentContains(pr,
243                 &quot;Updating existing summary to:\n&quot; +
244                 &quot;\n&quot; +
245                 &quot;```\n&quot; +
246                 &quot;1L\n&quot; +
247                 &quot;2L\n&quot; +
248                 &quot;```&quot;);
249 
250             // Finally update it to a single line summary
251             pr.addComment(&quot;/summary single line&quot;);
252             TestBotRunner.runPeriodicItems(prBot);
253 
254             // The bot should reply with a success message
255             assertLastCommentContains(pr, &quot;Updating existing summary to `single line`&quot;);
256         }
257     }





























































































































258 }
</pre>
</td>
<td>
<hr />
<pre>
238             pr.addComment(&quot;/summary\n1L\n2L&quot;);
239             TestBotRunner.runPeriodicItems(prBot);
240 
241             // The bot should reply with a success message
242             assertLastCommentContains(pr,
243                 &quot;Updating existing summary to:\n&quot; +
244                 &quot;\n&quot; +
245                 &quot;```\n&quot; +
246                 &quot;1L\n&quot; +
247                 &quot;2L\n&quot; +
248                 &quot;```&quot;);
249 
250             // Finally update it to a single line summary
251             pr.addComment(&quot;/summary single line&quot;);
252             TestBotRunner.runPeriodicItems(prBot);
253 
254             // The bot should reply with a success message
255             assertLastCommentContains(pr, &quot;Updating existing summary to `single line`&quot;);
256         }
257     }
<span class="line-added">258 </span>
<span class="line-added">259     @Test</span>
<span class="line-added">260     void precedingBlankLines(TestInfo testInfo) throws IOException {</span>
<span class="line-added">261         try (var credentials = new HostCredentials(testInfo);</span>
<span class="line-added">262              var tempFolder = new TemporaryDirectory()) {</span>
<span class="line-added">263             var author = credentials.getHostedRepository();</span>
<span class="line-added">264             var integrator = credentials.getHostedRepository();</span>
<span class="line-added">265 </span>
<span class="line-added">266             var censusBuilder = credentials.getCensusBuilder()</span>
<span class="line-added">267                                            .addReviewer(integrator.forge().currentUser().id())</span>
<span class="line-added">268                                            .addCommitter(author.forge().currentUser().id());</span>
<span class="line-added">269             var prBot = PullRequestBot.newBuilder().repo(integrator).censusRepo(censusBuilder.build()).build();</span>
<span class="line-added">270 </span>
<span class="line-added">271             // Populate the projects repository</span>
<span class="line-added">272             var localRepoFolder = tempFolder.path().resolve(&quot;localrepo&quot;);</span>
<span class="line-added">273             var localRepo = CheckableRepository.init(localRepoFolder, author.repositoryType());</span>
<span class="line-added">274             var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();</span>
<span class="line-added">275             assertFalse(CheckableRepository.hasBeenEdited(localRepo));</span>
<span class="line-added">276             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
<span class="line-added">277 </span>
<span class="line-added">278             // Make a change with a corresponding PR</span>
<span class="line-added">279             var editHash = CheckableRepository.appendAndCommit(localRepo);</span>
<span class="line-added">280             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
<span class="line-added">281             var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);</span>
<span class="line-added">282 </span>
<span class="line-added">283             // Try setting a summary when none has been set yet</span>
<span class="line-added">284             pr.addComment(&quot;/summary&quot;);</span>
<span class="line-added">285             TestBotRunner.runPeriodicItems(prBot);</span>
<span class="line-added">286 </span>
<span class="line-added">287             // The bot should reply with a help message</span>
<span class="line-added">288             assertLastCommentContains(pr,&quot;To set a summary&quot;);</span>
<span class="line-added">289 </span>
<span class="line-added">290             // Add a multi-line summary with preceding blank lines</span>
<span class="line-added">291             pr.addComment(&quot;/summary\n\n\nFirst line\nSecond line&quot;);</span>
<span class="line-added">292             TestBotRunner.runPeriodicItems(prBot);</span>
<span class="line-added">293 </span>
<span class="line-added">294             // The bot should reply with a success message</span>
<span class="line-added">295             assertLastCommentContains(pr,</span>
<span class="line-added">296                 &quot;Setting summary to:\n&quot; +</span>
<span class="line-added">297                 &quot;\n&quot; +</span>
<span class="line-added">298                 &quot;```\n&quot; +</span>
<span class="line-added">299                 &quot;First line\n&quot; +</span>
<span class="line-added">300                 &quot;Second line\n&quot; +</span>
<span class="line-added">301                 &quot;```&quot;);</span>
<span class="line-added">302         }</span>
<span class="line-added">303     }</span>
<span class="line-added">304 </span>
<span class="line-added">305     @Test</span>
<span class="line-added">306     void trailingBlankLines(TestInfo testInfo) throws IOException {</span>
<span class="line-added">307         try (var credentials = new HostCredentials(testInfo);</span>
<span class="line-added">308              var tempFolder = new TemporaryDirectory()) {</span>
<span class="line-added">309             var author = credentials.getHostedRepository();</span>
<span class="line-added">310             var integrator = credentials.getHostedRepository();</span>
<span class="line-added">311 </span>
<span class="line-added">312             var censusBuilder = credentials.getCensusBuilder()</span>
<span class="line-added">313                                            .addReviewer(integrator.forge().currentUser().id())</span>
<span class="line-added">314                                            .addCommitter(author.forge().currentUser().id());</span>
<span class="line-added">315             var prBot = PullRequestBot.newBuilder().repo(integrator).censusRepo(censusBuilder.build()).build();</span>
<span class="line-added">316 </span>
<span class="line-added">317             // Populate the projects repository</span>
<span class="line-added">318             var localRepoFolder = tempFolder.path().resolve(&quot;localrepo&quot;);</span>
<span class="line-added">319             var localRepo = CheckableRepository.init(localRepoFolder, author.repositoryType());</span>
<span class="line-added">320             var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();</span>
<span class="line-added">321             assertFalse(CheckableRepository.hasBeenEdited(localRepo));</span>
<span class="line-added">322             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
<span class="line-added">323 </span>
<span class="line-added">324             // Make a change with a corresponding PR</span>
<span class="line-added">325             var editHash = CheckableRepository.appendAndCommit(localRepo);</span>
<span class="line-added">326             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
<span class="line-added">327             var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);</span>
<span class="line-added">328 </span>
<span class="line-added">329             // Try setting a summary when none has been set yet</span>
<span class="line-added">330             pr.addComment(&quot;/summary&quot;);</span>
<span class="line-added">331             TestBotRunner.runPeriodicItems(prBot);</span>
<span class="line-added">332 </span>
<span class="line-added">333             // The bot should reply with a help message</span>
<span class="line-added">334             assertLastCommentContains(pr,&quot;To set a summary&quot;);</span>
<span class="line-added">335 </span>
<span class="line-added">336             // Add a multi-line summary with preceding blank lines</span>
<span class="line-added">337             pr.addComment(&quot;/summary\nFirst line\nSecond line\n\n\n&quot;);</span>
<span class="line-added">338             TestBotRunner.runPeriodicItems(prBot);</span>
<span class="line-added">339 </span>
<span class="line-added">340             // The bot should reply with a success message</span>
<span class="line-added">341             assertLastCommentContains(pr,</span>
<span class="line-added">342                 &quot;Setting summary to:\n&quot; +</span>
<span class="line-added">343                 &quot;\n&quot; +</span>
<span class="line-added">344                 &quot;```\n&quot; +</span>
<span class="line-added">345                 &quot;First line\n&quot; +</span>
<span class="line-added">346                 &quot;Second line\n&quot; +</span>
<span class="line-added">347                 &quot;```&quot;);</span>
<span class="line-added">348         }</span>
<span class="line-added">349     }</span>
<span class="line-added">350 </span>
<span class="line-added">351     @Test</span>
<span class="line-added">352     void singleAndMultiLineSummary(TestInfo testInfo) throws IOException {</span>
<span class="line-added">353         try (var credentials = new HostCredentials(testInfo);</span>
<span class="line-added">354              var tempFolder = new TemporaryDirectory()) {</span>
<span class="line-added">355             var author = credentials.getHostedRepository();</span>
<span class="line-added">356             var integrator = credentials.getHostedRepository();</span>
<span class="line-added">357 </span>
<span class="line-added">358             var censusBuilder = credentials.getCensusBuilder()</span>
<span class="line-added">359                                            .addReviewer(integrator.forge().currentUser().id())</span>
<span class="line-added">360                                            .addCommitter(author.forge().currentUser().id());</span>
<span class="line-added">361             var prBot = PullRequestBot.newBuilder().repo(integrator).censusRepo(censusBuilder.build()).build();</span>
<span class="line-added">362 </span>
<span class="line-added">363             // Populate the projects repository</span>
<span class="line-added">364             var localRepoFolder = tempFolder.path().resolve(&quot;localrepo&quot;);</span>
<span class="line-added">365             var localRepo = CheckableRepository.init(localRepoFolder, author.repositoryType());</span>
<span class="line-added">366             var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();</span>
<span class="line-added">367             assertFalse(CheckableRepository.hasBeenEdited(localRepo));</span>
<span class="line-added">368             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
<span class="line-added">369 </span>
<span class="line-added">370             // Make a change with a corresponding PR</span>
<span class="line-added">371             var editHash = CheckableRepository.appendAndCommit(localRepo);</span>
<span class="line-added">372             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
<span class="line-added">373             var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);</span>
<span class="line-added">374 </span>
<span class="line-added">375             // Try setting a summary when none has been set yet</span>
<span class="line-added">376             pr.addComment(&quot;/summary inline\nnext line&quot;);</span>
<span class="line-added">377             TestBotRunner.runPeriodicItems(prBot);</span>
<span class="line-added">378 </span>
<span class="line-added">379             // The bot should reply with a help message</span>
<span class="line-added">380             assertLastCommentContains(pr,&quot;To set a multi-line summary, use the syntax:&quot;);</span>
<span class="line-added">381         }</span>
<span class="line-added">382     }</span>
383 }
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../main/java/org/openjdk/skara/bots/pr/SummaryCommand.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>