<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/ReviewArchive.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ArchiveItem.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/bots/mlbridge/MailingListBridgeBotTests.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/ReviewArchive.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 53                         .filter(item -&gt; item.parent().isPresent())
 54                         .filter(item -&gt; item.parent().get().equals(parent))
 55                         .findAny();
 56     }
 57 
 58     private List&lt;ArchiveItem&gt; generateArchiveItems(List&lt;Email&gt; sentEmails, Repository localRepo, URI issueTracker, String issuePrefix, HostUserToEmailAuthor hostUserToEmailAuthor, HostUserToUserName hostUserToUserName, HostUserToRole hostUserToRole, WebrevStorage.WebrevGenerator webrevGenerator, WebrevNotification webrevNotification, String subjectPrefix) {
 59         var generated = new ArrayList&lt;ArchiveItem&gt;();
 60         Hash lastBase = null;
 61         Hash lastHead = null;
 62         int revisionIndex = 0;
 63         var threadPrefix = &quot;RFR&quot;;
 64 
 65         if (!sentEmails.isEmpty()) {
 66             var first = sentEmails.get(0);
 67             if (first.hasHeader(&quot;PR-Thread-Prefix&quot;)) {
 68                 threadPrefix = first.headerValue(&quot;PR-Thread-Prefix&quot;);
 69             }
 70         } else {
 71             if (pr.state() != Issue.State.OPEN) {
 72                 threadPrefix = &quot;FYI&quot;;


 73             }
 74         }
 75 
 76         // Check existing generated mails to find which hashes have been previously reported
 77         for (var email : sentEmails) {
 78             if (email.hasHeader(&quot;PR-Base-Hash&quot;)) {
 79                 var curBase = new Hash(email.headerValue(&quot;PR-Base-Hash&quot;));
 80                 var curHead = new Hash(email.headerValue(&quot;PR-Head-Hash&quot;));
 81                 var created = email.date();
 82 
 83                 if (generated.isEmpty()) {
 84                     var first = ArchiveItem.from(pr, localRepo, hostUserToEmailAuthor, issueTracker, issuePrefix, webrevGenerator, webrevNotification, pr.createdAt(), pr.updatedAt(), curBase, curHead, subjectPrefix, threadPrefix);
 85                     generated.add(first);
 86                 } else {
 87                     var revision = ArchiveItem.from(pr, localRepo, hostUserToEmailAuthor, webrevGenerator, webrevNotification, created, created, lastBase, lastHead, curBase, curHead, ++revisionIndex, generated.get(0), subjectPrefix, threadPrefix);
 88                     generated.add(revision);
 89                 }
 90 
 91                 lastBase = curBase;
 92                 lastHead = curHead;
</pre>
</td>
<td>
<hr />
<pre>
 53                         .filter(item -&gt; item.parent().isPresent())
 54                         .filter(item -&gt; item.parent().get().equals(parent))
 55                         .findAny();
 56     }
 57 
 58     private List&lt;ArchiveItem&gt; generateArchiveItems(List&lt;Email&gt; sentEmails, Repository localRepo, URI issueTracker, String issuePrefix, HostUserToEmailAuthor hostUserToEmailAuthor, HostUserToUserName hostUserToUserName, HostUserToRole hostUserToRole, WebrevStorage.WebrevGenerator webrevGenerator, WebrevNotification webrevNotification, String subjectPrefix) {
 59         var generated = new ArrayList&lt;ArchiveItem&gt;();
 60         Hash lastBase = null;
 61         Hash lastHead = null;
 62         int revisionIndex = 0;
 63         var threadPrefix = &quot;RFR&quot;;
 64 
 65         if (!sentEmails.isEmpty()) {
 66             var first = sentEmails.get(0);
 67             if (first.hasHeader(&quot;PR-Thread-Prefix&quot;)) {
 68                 threadPrefix = first.headerValue(&quot;PR-Thread-Prefix&quot;);
 69             }
 70         } else {
 71             if (pr.state() != Issue.State.OPEN) {
 72                 threadPrefix = &quot;FYI&quot;;
<span class="line-added"> 73             } else if (pr.labels().contains(&quot;failed-auto-merge&quot;)) {</span>
<span class="line-added"> 74                 threadPrefix = &quot;&quot;;</span>
 75             }
 76         }
 77 
 78         // Check existing generated mails to find which hashes have been previously reported
 79         for (var email : sentEmails) {
 80             if (email.hasHeader(&quot;PR-Base-Hash&quot;)) {
 81                 var curBase = new Hash(email.headerValue(&quot;PR-Base-Hash&quot;));
 82                 var curHead = new Hash(email.headerValue(&quot;PR-Head-Hash&quot;));
 83                 var created = email.date();
 84 
 85                 if (generated.isEmpty()) {
 86                     var first = ArchiveItem.from(pr, localRepo, hostUserToEmailAuthor, issueTracker, issuePrefix, webrevGenerator, webrevNotification, pr.createdAt(), pr.updatedAt(), curBase, curHead, subjectPrefix, threadPrefix);
 87                     generated.add(first);
 88                 } else {
 89                     var revision = ArchiveItem.from(pr, localRepo, hostUserToEmailAuthor, webrevGenerator, webrevNotification, created, created, lastBase, lastHead, curBase, curHead, ++revisionIndex, generated.get(0), subjectPrefix, threadPrefix);
 90                     generated.add(revision);
 91                 }
 92 
 93                 lastBase = curBase;
 94                 lastHead = curHead;
</pre>
</td>
</tr>
</table>
<center><a href="ArchiveItem.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/bots/mlbridge/MailingListBridgeBotTests.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>