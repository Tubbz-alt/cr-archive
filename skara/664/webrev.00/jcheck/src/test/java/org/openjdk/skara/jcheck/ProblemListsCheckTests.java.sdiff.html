<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff jcheck/src/test/java/org/openjdk/skara/jcheck/ProblemListsCheckTests.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MessageCheckTests.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ReviewersCheckTests.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>jcheck/src/test/java/org/openjdk/skara/jcheck/ProblemListsCheckTests.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
135                     }
136                 } else if (filename.equals(&quot;ProjProblemList.txt&quot;)) {
137                     if (h.hex().charAt(0) == &#39;1&#39;) {
138                         result = List.of(&quot;test1 PROJ-2&quot;, &quot;test3 PROJ-2,PROJ-3,PROJ1-1&quot;, &quot;# test PROJ-1,PROJ-2,PROJ-3&quot;);
139                     } else {
140                         result = List.of(&quot;test1 PROJ-1&quot;, &quot;test1 PROJ-2&quot;, &quot;test3 PROJ-2,PROJ-3,PROJ1-1&quot;, &quot;# test PROJ-1,PROJ-2,PROJ-3&quot;);
141                     }
142                 } else {
143                     return super.lines(p, h);
144                 }
145                 return Optional.of(result);
146             }
147             return super.lines(p, h);
148         }
149     };
150 
151     private static Commit commit(int id, String... message) {
152         var author = new Author(&quot;foo&quot;, &quot;foo@host.org&quot;);
153         var hash = new Hash((&quot;&quot; + id).repeat(40));
154         var parents = List.of(Hash.zero());
<span class="line-modified">155         var date = ZonedDateTime.now();</span>
<span class="line-modified">156         var metadata = new CommitMetadata(hash, parents, author, author, date, List.of(message));</span>
157         return new Commit(metadata, List.of());
158     }
159 
160     private static CommitMessage message(Commit c) {
161         return CommitMessageParsers.v1.parse(c);
162     }
163 
164     private List&lt;Issue&gt; toList(Iterator&lt;Issue&gt; i) {
165         var list = new ArrayList&lt;Issue&gt;();
166         while (i.hasNext()) {
167             list.add(i.next());
168         }
169         return list;
170     }
171 
172     @Test
173     void titleOnlyMessageShouldBypass() {
174         var commit = commit(0, &quot;Bugfix&quot;);
175         var message = message(commit);
176         var check = new ProblemListsCheck(REPOSITORY);
</pre>
<hr />
<pre>
379         }
380     }
381 
382     @Test
383     void singlePrefixedAlwaysProblemListedConf4() {
384         var check = new ProblemListsCheck(REPOSITORY);
385 
386         var commit = commit(0, &quot;PROJ-2: Bugfix&quot;);
387         var message = message(commit);
388         var issues = toList(check.check(commit, message, conf4));
389 
390         assertEquals(1, issues.size());
391         assertTrue(issues.get(0) instanceof ProblemListsIssue);
392         var issue = (ProblemListsIssue) issues.get(0);
393         assertEquals(&quot;PROJ-2&quot;, issue.issue());
394         assertEquals(Set.of(Path.of(&quot;test1/ProjProblemList.txt&quot;),
395                 Path.of(&quot;test2/ProjProblemList.txt&quot;)), issue.files());
396 
397     }
398 
<span class="line-modified">399 }</span>
</pre>
</td>
<td>
<hr />
<pre>
135                     }
136                 } else if (filename.equals(&quot;ProjProblemList.txt&quot;)) {
137                     if (h.hex().charAt(0) == &#39;1&#39;) {
138                         result = List.of(&quot;test1 PROJ-2&quot;, &quot;test3 PROJ-2,PROJ-3,PROJ1-1&quot;, &quot;# test PROJ-1,PROJ-2,PROJ-3&quot;);
139                     } else {
140                         result = List.of(&quot;test1 PROJ-1&quot;, &quot;test1 PROJ-2&quot;, &quot;test3 PROJ-2,PROJ-3,PROJ1-1&quot;, &quot;# test PROJ-1,PROJ-2,PROJ-3&quot;);
141                     }
142                 } else {
143                     return super.lines(p, h);
144                 }
145                 return Optional.of(result);
146             }
147             return super.lines(p, h);
148         }
149     };
150 
151     private static Commit commit(int id, String... message) {
152         var author = new Author(&quot;foo&quot;, &quot;foo@host.org&quot;);
153         var hash = new Hash((&quot;&quot; + id).repeat(40));
154         var parents = List.of(Hash.zero());
<span class="line-modified">155         var authored = ZonedDateTime.now();</span>
<span class="line-modified">156         var metadata = new CommitMetadata(hash, parents, author, authored, author, authored, List.of(message));</span>
157         return new Commit(metadata, List.of());
158     }
159 
160     private static CommitMessage message(Commit c) {
161         return CommitMessageParsers.v1.parse(c);
162     }
163 
164     private List&lt;Issue&gt; toList(Iterator&lt;Issue&gt; i) {
165         var list = new ArrayList&lt;Issue&gt;();
166         while (i.hasNext()) {
167             list.add(i.next());
168         }
169         return list;
170     }
171 
172     @Test
173     void titleOnlyMessageShouldBypass() {
174         var commit = commit(0, &quot;Bugfix&quot;);
175         var message = message(commit);
176         var check = new ProblemListsCheck(REPOSITORY);
</pre>
<hr />
<pre>
379         }
380     }
381 
382     @Test
383     void singlePrefixedAlwaysProblemListedConf4() {
384         var check = new ProblemListsCheck(REPOSITORY);
385 
386         var commit = commit(0, &quot;PROJ-2: Bugfix&quot;);
387         var message = message(commit);
388         var issues = toList(check.check(commit, message, conf4));
389 
390         assertEquals(1, issues.size());
391         assertTrue(issues.get(0) instanceof ProblemListsIssue);
392         var issue = (ProblemListsIssue) issues.get(0);
393         assertEquals(&quot;PROJ-2&quot;, issue.issue());
394         assertEquals(Set.of(Path.of(&quot;test1/ProjProblemList.txt&quot;),
395                 Path.of(&quot;test2/ProjProblemList.txt&quot;)), issue.files());
396 
397     }
398 
<span class="line-modified">399 }</span>
</pre>
</td>
</tr>
</table>
<center><a href="MessageCheckTests.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ReviewersCheckTests.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>