<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff jcheck/src/main/java/org/openjdk/skara/jcheck/JCheck.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../../bots/pr/src/test/java/org/openjdk/skara/bots/pr/CheckTests.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../test/java/org/openjdk/skara/jcheck/JCheckTests.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>jcheck/src/main/java/org/openjdk/skara/jcheck/JCheck.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
121             if (skip != null &amp;&amp; skip.contains(commit.hash())) {
122                 log.finer(&quot;Commit check &#39;&quot; + c.name() + &quot;&#39; is whitelisted for &quot; + commit.hash().hex());
123                 return Collections.emptyIterator();
124             }
125             log.finer(&quot;Running commit check &#39;&quot; + c.name() + &quot;&#39; for &quot; + commit.hash().hex());
126             return c.check(commit, message, conf);
127         });
128         return new FlatMapIterator&lt;Issue&gt;(iterator);
129     }
130 
131     private Set&lt;CommitCheck&gt; checksForCommit(Commit c) {
132         var configuration = getConfigurationFor(c);
133         if (!configuration.isPresent()) {
134             return new HashSet&lt;&gt;();
135         }
136 
137         var conf = configuration.get();
138         return new HashSet&lt;&gt;(conf.checks().enabled(commitChecks));
139     }
140 
<span class="line-modified">141     private Set&lt;Check&gt; checksForCommits() throws IOException {</span>
142         try (var commits = repository.commits(revisionRange)) {
143             return commits.stream()
<span class="line-modified">144                     .flatMap(commit -&gt; checksForCommit(commit).stream())</span>
<span class="line-modified">145                     .collect(Collectors.toSet());</span>
146         }
147     }
148 
149     public static class Issues implements Iterable&lt;Issue&gt;, AutoCloseable {
150         private final Iterator&lt;Issue&gt; iterator;
151         private final Closeable resource;
152 
153         public Issues(Iterator&lt;Issue&gt; iterator,
154                       Closeable resource) {
155             this.iterator = iterator;
156             this.resource = resource;
157         }
158 
159         @Override
160         public Iterator&lt;Issue&gt; iterator() {
161             return iterator;
162         }
163 
164         public List&lt;Issue&gt; asList() {
165             var res = new ArrayList&lt;Issue&gt;();
</pre>
<hr />
<pre>
249     public static Issues check(ReadOnlyRepository repository,
250                                Census census,
251                                CommitMessageParser parser,
252                                String revisionRange,
253                                Map&lt;String, Set&lt;Hash&gt;&gt; whitelist,
254                                Set&lt;Hash&gt; blacklist) throws IOException {
255         if (repository.isEmpty()) {
256             return new Issues(new ArrayList&lt;Issue&gt;().iterator(), null);
257         }
258 
259         var master = repository.resolve(repository.defaultBranch().name())
260                                .orElseThrow(() -&gt; new IllegalStateException(&quot;Default branch not found&quot;));
261 
262         var conf = parseConfiguration(repository, master, List.of());
263         var branchRegex = conf.isPresent() ? conf.get().repository().branches() : &quot;.*&quot;;
264         var tagRegex = conf.isPresent() ? conf.get().repository().tags() : &quot;.*&quot;;
265 
266         return check(repository, census, parser, branchRegex, tagRegex, revisionRange, whitelist, blacklist, List.of(), null);
267     }
268 
<span class="line-modified">269     public static Set&lt;Check&gt; checks(ReadOnlyRepository repository, Census census, Hash hash) throws IOException {</span>
270         var jcheck = new JCheck(repository,
271                                 census,
272                                 CommitMessageParsers.v1,
<span class="line-modified">273                                 hash.hex() + &quot;^..&quot; + hash.hex(),</span>
274                                 Pattern.compile(&quot;.*&quot;),
275                                 Pattern.compile(&quot;.*&quot;),
276                                 new HashMap&lt;String, Set&lt;Hash&gt;&gt;(),
277                                 new HashSet&lt;Hash&gt;(),
278                                 List.of(),
279                                 null);
<span class="line-modified">280         return jcheck.checksForCommits();</span>
281     }
282 }
</pre>
</td>
<td>
<hr />
<pre>
121             if (skip != null &amp;&amp; skip.contains(commit.hash())) {
122                 log.finer(&quot;Commit check &#39;&quot; + c.name() + &quot;&#39; is whitelisted for &quot; + commit.hash().hex());
123                 return Collections.emptyIterator();
124             }
125             log.finer(&quot;Running commit check &#39;&quot; + c.name() + &quot;&#39; for &quot; + commit.hash().hex());
126             return c.check(commit, message, conf);
127         });
128         return new FlatMapIterator&lt;Issue&gt;(iterator);
129     }
130 
131     private Set&lt;CommitCheck&gt; checksForCommit(Commit c) {
132         var configuration = getConfigurationFor(c);
133         if (!configuration.isPresent()) {
134             return new HashSet&lt;&gt;();
135         }
136 
137         var conf = configuration.get();
138         return new HashSet&lt;&gt;(conf.checks().enabled(commitChecks));
139     }
140 
<span class="line-modified">141     private Set&lt;Check&gt; checksForRange() throws IOException {</span>
142         try (var commits = repository.commits(revisionRange)) {
143             return commits.stream()
<span class="line-modified">144                           .flatMap(commit -&gt; checksForCommit(commit).stream())</span>
<span class="line-modified">145                           .collect(Collectors.toSet());</span>
146         }
147     }
148 
149     public static class Issues implements Iterable&lt;Issue&gt;, AutoCloseable {
150         private final Iterator&lt;Issue&gt; iterator;
151         private final Closeable resource;
152 
153         public Issues(Iterator&lt;Issue&gt; iterator,
154                       Closeable resource) {
155             this.iterator = iterator;
156             this.resource = resource;
157         }
158 
159         @Override
160         public Iterator&lt;Issue&gt; iterator() {
161             return iterator;
162         }
163 
164         public List&lt;Issue&gt; asList() {
165             var res = new ArrayList&lt;Issue&gt;();
</pre>
<hr />
<pre>
249     public static Issues check(ReadOnlyRepository repository,
250                                Census census,
251                                CommitMessageParser parser,
252                                String revisionRange,
253                                Map&lt;String, Set&lt;Hash&gt;&gt; whitelist,
254                                Set&lt;Hash&gt; blacklist) throws IOException {
255         if (repository.isEmpty()) {
256             return new Issues(new ArrayList&lt;Issue&gt;().iterator(), null);
257         }
258 
259         var master = repository.resolve(repository.defaultBranch().name())
260                                .orElseThrow(() -&gt; new IllegalStateException(&quot;Default branch not found&quot;));
261 
262         var conf = parseConfiguration(repository, master, List.of());
263         var branchRegex = conf.isPresent() ? conf.get().repository().branches() : &quot;.*&quot;;
264         var tagRegex = conf.isPresent() ? conf.get().repository().tags() : &quot;.*&quot;;
265 
266         return check(repository, census, parser, branchRegex, tagRegex, revisionRange, whitelist, blacklist, List.of(), null);
267     }
268 
<span class="line-modified">269     public static Set&lt;Check&gt; checksFor(ReadOnlyRepository repository, Census census, Hash hash) throws IOException {</span>
270         var jcheck = new JCheck(repository,
271                                 census,
272                                 CommitMessageParsers.v1,
<span class="line-modified">273                                 repository.range(hash),</span>
274                                 Pattern.compile(&quot;.*&quot;),
275                                 Pattern.compile(&quot;.*&quot;),
276                                 new HashMap&lt;String, Set&lt;Hash&gt;&gt;(),
277                                 new HashSet&lt;Hash&gt;(),
278                                 List.of(),
279                                 null);
<span class="line-modified">280         return jcheck.checksForRange();</span>
281     }
282 }
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../../bots/pr/src/test/java/org/openjdk/skara/bots/pr/CheckTests.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../test/java/org/openjdk/skara/jcheck/JCheckTests.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>