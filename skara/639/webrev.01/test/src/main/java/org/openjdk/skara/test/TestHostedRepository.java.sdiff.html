<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/src/main/java/org/openjdk/skara/test/TestHostedRepository.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../../forge/src/main/java/org/openjdk/skara/forge/gitlab/GitLabRepository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>test/src/main/java/org/openjdk/skara/test/TestHostedRepository.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 23 package org.openjdk.skara.test;
 24 
 25 import org.openjdk.skara.forge.*;
 26 import org.openjdk.skara.issuetracker.Issue;
 27 import org.openjdk.skara.json.JSONValue;
 28 import org.openjdk.skara.vcs.*;
 29 
 30 import java.io.*;
 31 import java.net.*;
 32 import java.nio.file.Path;
 33 import java.time.ZonedDateTime;
 34 import java.util.*;
 35 import java.util.regex.Pattern;
 36 import java.util.stream.Collectors;
 37 
 38 public class TestHostedRepository extends TestIssueProject implements HostedRepository {
 39     private final TestHost host;
 40     private final String projectName;
 41     private final Repository localRepository;
 42     private final Pattern pullRequestPattern;


 43 
 44     public TestHostedRepository(TestHost host, String projectName, Repository localRepository) {
 45         super(host, projectName);
 46         this.host = host;
 47         this.projectName = projectName;
 48         this.localRepository = localRepository;
 49         pullRequestPattern = Pattern.compile(url().toString() + &quot;/pr/&quot; + &quot;(\\d+)&quot;);


 50     }
 51 
 52     @Override
 53     public Forge forge() {
 54         return host;
 55     }
 56 
 57     @Override
 58     public Optional&lt;HostedRepository&gt; parent() {
 59         throw new RuntimeException(&quot;Not implemented yet&quot;);
 60     }
 61 
 62     @Override
 63     public PullRequest createPullRequest(HostedRepository target, String targetRef, String sourceRef, String title, List&lt;String&gt; body, boolean draft) {
 64         return host.createPullRequest((TestHostedRepository) target, this, targetRef, sourceRef, title, body, draft);
 65     }
 66 
 67     @Override
 68     public PullRequest pullRequest(String id) {
 69         return host.getPullRequest(this, id);
</pre>
<hr />
<pre>
182             var hash = localRepository.resolve(ref).orElseThrow();
183             return hash;
184         } catch (IOException e) {
185             throw new RuntimeException(e);
186         }
187     }
188 
189     @Override
190     public List&lt;HostedBranch&gt; branches() {
191         try {
192             var result = new ArrayList&lt;HostedBranch&gt;();
193             for (var b : localRepository.branches()) {
194                 result.add(new HostedBranch(b.name(), localRepository.resolve(b).orElseThrow()));
195             }
196             return result;
197         } catch (IOException e) {
198             throw new RuntimeException(e);
199         }
200     }
201 


















202     Repository localRepository() {
203         return localRepository;
204     }
205 }
</pre>
</td>
<td>
<hr />
<pre>
 23 package org.openjdk.skara.test;
 24 
 25 import org.openjdk.skara.forge.*;
 26 import org.openjdk.skara.issuetracker.Issue;
 27 import org.openjdk.skara.json.JSONValue;
 28 import org.openjdk.skara.vcs.*;
 29 
 30 import java.io.*;
 31 import java.net.*;
 32 import java.nio.file.Path;
 33 import java.time.ZonedDateTime;
 34 import java.util.*;
 35 import java.util.regex.Pattern;
 36 import java.util.stream.Collectors;
 37 
 38 public class TestHostedRepository extends TestIssueProject implements HostedRepository {
 39     private final TestHost host;
 40     private final String projectName;
 41     private final Repository localRepository;
 42     private final Pattern pullRequestPattern;
<span class="line-added"> 43     private final Map&lt;Hash, List&lt;CommitComment&gt;&gt; commitComments;</span>
<span class="line-added"> 44     private int nextCommitCommentId;</span>
 45 
 46     public TestHostedRepository(TestHost host, String projectName, Repository localRepository) {
 47         super(host, projectName);
 48         this.host = host;
 49         this.projectName = projectName;
 50         this.localRepository = localRepository;
 51         pullRequestPattern = Pattern.compile(url().toString() + &quot;/pr/&quot; + &quot;(\\d+)&quot;);
<span class="line-added"> 52         commitComments = new HashMap&lt;Hash, List&lt;CommitComment&gt;&gt;();</span>
<span class="line-added"> 53         nextCommitCommentId = 0;</span>
 54     }
 55 
 56     @Override
 57     public Forge forge() {
 58         return host;
 59     }
 60 
 61     @Override
 62     public Optional&lt;HostedRepository&gt; parent() {
 63         throw new RuntimeException(&quot;Not implemented yet&quot;);
 64     }
 65 
 66     @Override
 67     public PullRequest createPullRequest(HostedRepository target, String targetRef, String sourceRef, String title, List&lt;String&gt; body, boolean draft) {
 68         return host.createPullRequest((TestHostedRepository) target, this, targetRef, sourceRef, title, body, draft);
 69     }
 70 
 71     @Override
 72     public PullRequest pullRequest(String id) {
 73         return host.getPullRequest(this, id);
</pre>
<hr />
<pre>
186             var hash = localRepository.resolve(ref).orElseThrow();
187             return hash;
188         } catch (IOException e) {
189             throw new RuntimeException(e);
190         }
191     }
192 
193     @Override
194     public List&lt;HostedBranch&gt; branches() {
195         try {
196             var result = new ArrayList&lt;HostedBranch&gt;();
197             for (var b : localRepository.branches()) {
198                 result.add(new HostedBranch(b.name(), localRepository.resolve(b).orElseThrow()));
199             }
200             return result;
201         } catch (IOException e) {
202             throw new RuntimeException(e);
203         }
204     }
205 
<span class="line-added">206     @Override</span>
<span class="line-added">207     public List&lt;CommitComment&gt; commitComments(Hash hash) {</span>
<span class="line-added">208         if (!commitComments.containsKey(hash)) {</span>
<span class="line-added">209             return List.of();</span>
<span class="line-added">210         }</span>
<span class="line-added">211         return commitComments.get(hash);</span>
<span class="line-added">212     }</span>
<span class="line-added">213 </span>
<span class="line-added">214     @Override</span>
<span class="line-added">215     public void addCommitComment(Hash hash, String body) {</span>
<span class="line-added">216         var id = nextCommitCommentId;</span>
<span class="line-added">217         nextCommitCommentId += 1;</span>
<span class="line-added">218         var createdAt = ZonedDateTime.now();</span>
<span class="line-added">219 </span>
<span class="line-added">220         var comments = commitComments.putIfAbsent(hash, new ArrayList&lt;CommitComment&gt;());</span>
<span class="line-added">221         comments.add(new CommitComment(hash, null, -1, Integer.toString(id), body, host.currentUser(), createdAt, createdAt));</span>
<span class="line-added">222     }</span>
<span class="line-added">223 </span>
224     Repository localRepository() {
225         return localRepository;
226     }
227 }
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../../forge/src/main/java/org/openjdk/skara/forge/gitlab/GitLabRepository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>