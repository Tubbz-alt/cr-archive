<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff forge/src/main/java/org/openjdk/skara/forge/gitlab/GitLabHost.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../github/GitHubRepository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="GitLabRepository.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>forge/src/main/java/org/openjdk/skara/forge/gitlab/GitLabHost.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
104             project = request.get(&quot;projects/&quot; + encodedName).execute();
105         }
106         return project.asObject();
107     }
108 
109     JSONObject getProjectInfo(int id) {
110         return request.get(&quot;projects/&quot; + Integer.toString(id))
111                       .execute()
112                       .asObject();
113     }
114 
115     @Override
116     public Optional&lt;HostedRepository&gt; repository(String name) {
117         try {
118             return Optional.of(new GitLabRepository(this, name));
119         } catch (Throwable t) {
120             return Optional.empty();
121         }
122     }
123 
<span class="line-modified">124     private HostUser parseUserDetails(JSONObject details) {</span>
<span class="line-modified">125         var id = details.get(&quot;id&quot;).asInt();</span>
<span class="line-modified">126         var username = details.get(&quot;username&quot;).asString();</span>
<span class="line-modified">127         var name = details.get(&quot;name&quot;).asString();</span>
<span class="line-modified">128         var email = details.get(&quot;email&quot;).asString();</span>




129         return new HostUser(id, username, name, email);
130     }
131 
132     @Override
133     public Optional&lt;HostUser&gt; user(String username) {
134         var details = request.get(&quot;users&quot;)
135                              .param(&quot;username&quot;, username)
136                              .onError(r -&gt; Optional.of(JSON.of()))
137                              .execute();
138 
139         if (details.isNull()) {
140             return Optional.empty();
141         }
142 
143         var users = details.asArray();
144         if (users.size() != 1) {
145             return Optional.empty();
146         }
147 
<span class="line-modified">148         return Optional.of(parseUserDetails(users.get(0).asObject()));</span>
149     }
150 
151     @Override
152     public HostUser currentUser() {
153         var details = request.get(&quot;user&quot;).execute().asObject();
<span class="line-modified">154         return parseUserDetails(details);</span>
155     }
156 
157     @Override
158     public boolean supportsReviewBody() {
159         // GitLab CE does not support this
160         return false;
161     }
162 
163     boolean isProjectForkComplete(String name) {
164         var project = getProjectInfo(name);
165         if (project.contains(&quot;import_status&quot;)) {
166             var status = project.get(&quot;import_status&quot;).asString();
167             switch (status) {
168                 case &quot;finished&quot;:
169                     return true;
170                 case &quot;started&quot;:
171                     return false;
172                 default:
173                     throw new RuntimeException(&quot;Unknown fork status: &quot; + status);
174             }
</pre>
</td>
<td>
<hr />
<pre>
104             project = request.get(&quot;projects/&quot; + encodedName).execute();
105         }
106         return project.asObject();
107     }
108 
109     JSONObject getProjectInfo(int id) {
110         return request.get(&quot;projects/&quot; + Integer.toString(id))
111                       .execute()
112                       .asObject();
113     }
114 
115     @Override
116     public Optional&lt;HostedRepository&gt; repository(String name) {
117         try {
118             return Optional.of(new GitLabRepository(this, name));
119         } catch (Throwable t) {
120             return Optional.empty();
121         }
122     }
123 
<span class="line-modified">124     HostUser parseAuthorField(JSONValue json) {</span>
<span class="line-modified">125         return parseAuthorObject(json.get(&quot;author&quot;).asObject());</span>
<span class="line-modified">126     }</span>
<span class="line-modified">127 </span>
<span class="line-modified">128     HostUser parseAuthorObject(JSONObject o) {</span>
<span class="line-added">129         var id = o.get(&quot;id&quot;).asInt();</span>
<span class="line-added">130         var username = o.get(&quot;username&quot;).asString();</span>
<span class="line-added">131         var name = o.get(&quot;name&quot;).asString();</span>
<span class="line-added">132         var email = o.get(&quot;email&quot;).asString();</span>
133         return new HostUser(id, username, name, email);
134     }
135 
136     @Override
137     public Optional&lt;HostUser&gt; user(String username) {
138         var details = request.get(&quot;users&quot;)
139                              .param(&quot;username&quot;, username)
140                              .onError(r -&gt; Optional.of(JSON.of()))
141                              .execute();
142 
143         if (details.isNull()) {
144             return Optional.empty();
145         }
146 
147         var users = details.asArray();
148         if (users.size() != 1) {
149             return Optional.empty();
150         }
151 
<span class="line-modified">152         return Optional.of(parseAuthorObject(users.get(0).asObject()));</span>
153     }
154 
155     @Override
156     public HostUser currentUser() {
157         var details = request.get(&quot;user&quot;).execute().asObject();
<span class="line-modified">158         return parseAuthorObject(details);</span>
159     }
160 
161     @Override
162     public boolean supportsReviewBody() {
163         // GitLab CE does not support this
164         return false;
165     }
166 
167     boolean isProjectForkComplete(String name) {
168         var project = getProjectInfo(name);
169         if (project.contains(&quot;import_status&quot;)) {
170             var status = project.get(&quot;import_status&quot;).asString();
171             switch (status) {
172                 case &quot;finished&quot;:
173                     return true;
174                 case &quot;started&quot;:
175                     return false;
176                 default:
177                     throw new RuntimeException(&quot;Unknown fork status: &quot; + status);
178             }
</pre>
</td>
</tr>
</table>
<center><a href="../github/GitHubRepository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="GitLabRepository.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>