<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/pr/src/test/java/org/openjdk/skara/bots/pr/IssueTests.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../main/java/org/openjdk/skara/bots/pr/IssueCommand.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>bots/pr/src/test/java/org/openjdk/skara/bots/pr/IssueTests.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
365             TestBotRunner.runPeriodicItems(prBot);
366             assertTrue(pr.body().contains(issue1.id()));
367             assertTrue(pr.body().contains(&quot;First&quot;));
368             assertTrue(pr.body().contains(&quot;## Issue\n&quot;));
369 
370             // Add an extra issue
371             var issue2 = issues.createIssue(&quot;Second&quot;, List.of(&quot;There&quot;), Map.of());
372             pr.addComment(&quot;/issue &quot; + issue2.id() + &quot;: Description&quot;);
373 
374             // Check that the body was updated
375             TestBotRunner.runPeriodicItems(prBot);
376             TestBotRunner.runPeriodicItems(prBot);
377             assertTrue(pr.body().contains(issue1.id()));
378             assertTrue(pr.body().contains(&quot;First&quot;));
379             assertTrue(pr.body().contains(issue2.id()));
380             assertTrue(pr.body().contains(&quot;Second&quot;));
381             assertFalse(pr.body().contains(&quot;## Issue\n&quot;));
382             assertTrue(pr.body().contains(&quot;## Issues\n&quot;));
383         }
384     }



































































385 }
</pre>
</td>
<td>
<hr />
<pre>
365             TestBotRunner.runPeriodicItems(prBot);
366             assertTrue(pr.body().contains(issue1.id()));
367             assertTrue(pr.body().contains(&quot;First&quot;));
368             assertTrue(pr.body().contains(&quot;## Issue\n&quot;));
369 
370             // Add an extra issue
371             var issue2 = issues.createIssue(&quot;Second&quot;, List.of(&quot;There&quot;), Map.of());
372             pr.addComment(&quot;/issue &quot; + issue2.id() + &quot;: Description&quot;);
373 
374             // Check that the body was updated
375             TestBotRunner.runPeriodicItems(prBot);
376             TestBotRunner.runPeriodicItems(prBot);
377             assertTrue(pr.body().contains(issue1.id()));
378             assertTrue(pr.body().contains(&quot;First&quot;));
379             assertTrue(pr.body().contains(issue2.id()));
380             assertTrue(pr.body().contains(&quot;Second&quot;));
381             assertFalse(pr.body().contains(&quot;## Issue\n&quot;));
382             assertTrue(pr.body().contains(&quot;## Issues\n&quot;));
383         }
384     }
<span class="line-added">385 </span>
<span class="line-added">386     @Test</span>
<span class="line-added">387     void projectPrefix(TestInfo testInfo) throws IOException {</span>
<span class="line-added">388         try (var credentials = new HostCredentials(testInfo);</span>
<span class="line-added">389              var tempFolder = new TemporaryDirectory()) {</span>
<span class="line-added">390             var author = credentials.getHostedRepository();</span>
<span class="line-added">391             var integrator = credentials.getHostedRepository();</span>
<span class="line-added">392 </span>
<span class="line-added">393             var issueProject = credentials.getIssueProject();</span>
<span class="line-added">394             var censusBuilder = credentials.getCensusBuilder()</span>
<span class="line-added">395                                            .addAuthor(author.forge().currentUser().id());</span>
<span class="line-added">396             var prBot = PullRequestBot.newBuilder()</span>
<span class="line-added">397                                       .repo(integrator)</span>
<span class="line-added">398                                       .censusRepo(censusBuilder.build())</span>
<span class="line-added">399                                       .issueProject(issueProject)</span>
<span class="line-added">400                                       .build();</span>
<span class="line-added">401 </span>
<span class="line-added">402             // Populate the projects repository</span>
<span class="line-added">403             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
<span class="line-added">404             var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();</span>
<span class="line-added">405             assertFalse(CheckableRepository.hasBeenEdited(localRepo));</span>
<span class="line-added">406             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
<span class="line-added">407 </span>
<span class="line-added">408             // Create issues</span>
<span class="line-added">409             var issue1 = credentials.createIssue(issueProject, &quot;Issue 1&quot;);</span>
<span class="line-added">410             var issue2 = credentials.createIssue(issueProject, &quot;Issue 2&quot;);</span>
<span class="line-added">411 </span>
<span class="line-added">412             // Make a change with a corresponding PR</span>
<span class="line-added">413             var editHash = CheckableRepository.appendAndCommit(localRepo);</span>
<span class="line-added">414             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
<span class="line-added">415             var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, issue1.id() + &quot;: This is a pull request&quot;);</span>
<span class="line-added">416             TestBotRunner.runPeriodicItems(prBot);</span>
<span class="line-added">417 </span>
<span class="line-added">418             // Add variations of this issue</span>
<span class="line-added">419             pr.addComment(&quot;/issue add &quot; + issue2.id().toLowerCase());</span>
<span class="line-added">420             TestBotRunner.runPeriodicItems(prBot);</span>
<span class="line-added">421 </span>
<span class="line-added">422             // The bot should reply with a success message</span>
<span class="line-added">423             assertLastCommentContains(pr,&quot;Adding additional issue to issue list&quot;);</span>
<span class="line-added">424 </span>
<span class="line-added">425             pr.addComment(&quot;/issue remove &quot; + issue2.id().toLowerCase());</span>
<span class="line-added">426             TestBotRunner.runPeriodicItems(prBot);</span>
<span class="line-added">427 </span>
<span class="line-added">428             // The bot should reply with a success message</span>
<span class="line-added">429             assertLastCommentContains(pr,&quot;Removing additional issue from issue list&quot;);</span>
<span class="line-added">430 </span>
<span class="line-added">431             // Add variations of this issue</span>
<span class="line-added">432             pr.addComment(&quot;/issue add &quot; + issue2.id().toUpperCase());</span>
<span class="line-added">433             TestBotRunner.runPeriodicItems(prBot);</span>
<span class="line-added">434 </span>
<span class="line-added">435             // The bot should reply with a success message</span>
<span class="line-added">436             assertLastCommentContains(pr,&quot;Adding additional issue to issue list&quot;);</span>
<span class="line-added">437 </span>
<span class="line-added">438             pr.addComment(&quot;/issue remove &quot; + issue2.id().toUpperCase());</span>
<span class="line-added">439             TestBotRunner.runPeriodicItems(prBot);</span>
<span class="line-added">440 </span>
<span class="line-added">441             // The bot should reply with a success message</span>
<span class="line-added">442             assertLastCommentContains(pr,&quot;Removing additional issue from issue list&quot;);</span>
<span class="line-added">443 </span>
<span class="line-added">444             // Add variations of this issue</span>
<span class="line-added">445             pr.addComment(&quot;/issue add &quot; + issue2.id().split(&quot;-&quot;)[1]);</span>
<span class="line-added">446             TestBotRunner.runPeriodicItems(prBot);</span>
<span class="line-added">447 </span>
<span class="line-added">448             // The bot should reply with a success message</span>
<span class="line-added">449             assertLastCommentContains(pr,&quot;Adding additional issue to issue list&quot;);</span>
<span class="line-added">450         }</span>
<span class="line-added">451     }</span>
452 }
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../main/java/org/openjdk/skara/bots/pr/IssueCommand.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>