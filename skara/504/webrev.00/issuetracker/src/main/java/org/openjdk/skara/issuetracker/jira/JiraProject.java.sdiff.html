<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff issuetracker/src/main/java/org/openjdk/skara/issuetracker/jira/JiraProject.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>issuetracker/src/main/java/org/openjdk/skara/issuetracker/jira/JiraProject.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
103 
104     private String projectId() {
105         return project().get(&quot;id&quot;).asString();
106     }
107 
108     private String defaultIssueType() {
109         return issueTypes().values().stream()
110                            .min(Comparator.naturalOrder()).orElseThrow();
111     }
112 
113     private String defaultComponent() {
114         return components().values().stream()
115                            .min(Comparator.naturalOrder()).orElseThrow();
116     }
117 
118     JiraHost jiraHost() {
119         return jiraHost;
120     }
121 
122     private static final Set&lt;String&gt; knownProperties = Set.of(&quot;issuetype&quot;, &quot;fixVersions&quot;, &quot;versions&quot;, &quot;priority&quot;, &quot;components&quot;);

123 
<span class="line-modified">124     boolean isAllowedProperty(String name) {</span>
125         if (knownProperties.contains(name)) {
126             return true;
127         }



128         return name.startsWith(&quot;customfield_&quot;);
129     }
130 
131     Optional&lt;JSONValue&gt; decodeProperty(String name, JSONValue value) {
<span class="line-modified">132         if (!isAllowedProperty(name)) {</span>
133             return Optional.empty();
134         }
135         if (value.isNull()) {
136             return Optional.empty();
137         }
138 
139         // Transform known fields to a better representation
140         switch (name) {
141             case &quot;fixVersions&quot;: // fall-through
142             case &quot;versions&quot;: // fall-through
143             case &quot;components&quot;:
144                 return Optional.of(new JSONArray(value.stream()
145                                                       .map(obj -&gt; obj.get(&quot;name&quot;))
146                                                       .collect(Collectors.toList())));
147             case &quot;issuetype&quot;:
148                 return Optional.of(JSON.of(value.get(&quot;name&quot;).asString()));
149             case &quot;priority&quot;:
150                 return Optional.of(JSON.of(value.get(&quot;id&quot;).asString()));
151             default:
152                 return Optional.of(value);
153         }
154     }
155 
156     Optional&lt;JSONValue&gt; encodeProperty(String name, JSONValue value) {
<span class="line-modified">157         if (!isAllowedProperty(name)) {</span>
158             return Optional.empty();
159         }
160 
161         switch (name) {
162             case &quot;fixVersions&quot;: // fall-through
163             case &quot;versions&quot;:
164                 return Optional.of(new JSONArray(value.stream()
165                                                       .map(JSONValue::asString)
166                                                       .map(s -&gt; JSON.object().put(&quot;id&quot;, versions().get(s)))
167                                                       .collect(Collectors.toList())));
168             case &quot;components&quot;:
169                 return Optional.of(new JSONArray(value.stream()
170                                                       .map(JSONValue::asString)
171                                                       .map(s -&gt; JSON.object().put(&quot;id&quot;, components().get(s)))
172                                                       .collect(Collectors.toList())));
173             case &quot;issuetype&quot;:
174                 return Optional.of(JSON.object().put(&quot;id&quot;, issueTypes().get(value.asString())));
175             case &quot;priority&quot;:
176                 return Optional.of(JSON.object().put(&quot;id&quot;, value.asString()));
177             default:
</pre>
</td>
<td>
<hr />
<pre>
103 
104     private String projectId() {
105         return project().get(&quot;id&quot;).asString();
106     }
107 
108     private String defaultIssueType() {
109         return issueTypes().values().stream()
110                            .min(Comparator.naturalOrder()).orElseThrow();
111     }
112 
113     private String defaultComponent() {
114         return components().values().stream()
115                            .min(Comparator.naturalOrder()).orElseThrow();
116     }
117 
118     JiraHost jiraHost() {
119         return jiraHost;
120     }
121 
122     private static final Set&lt;String&gt; knownProperties = Set.of(&quot;issuetype&quot;, &quot;fixVersions&quot;, &quot;versions&quot;, &quot;priority&quot;, &quot;components&quot;);
<span class="line-added">123     private static final Set&lt;String&gt; readOnlyProperties = Set.of(&quot;resolution&quot;);</span>
124 
<span class="line-modified">125     boolean isAllowedProperty(String name, boolean forWrite) {</span>
126         if (knownProperties.contains(name)) {
127             return true;
128         }
<span class="line-added">129         if (!forWrite &amp;&amp; readOnlyProperties.contains(name)) {</span>
<span class="line-added">130             return true;</span>
<span class="line-added">131         }</span>
132         return name.startsWith(&quot;customfield_&quot;);
133     }
134 
135     Optional&lt;JSONValue&gt; decodeProperty(String name, JSONValue value) {
<span class="line-modified">136         if (!isAllowedProperty(name, false)) {</span>
137             return Optional.empty();
138         }
139         if (value.isNull()) {
140             return Optional.empty();
141         }
142 
143         // Transform known fields to a better representation
144         switch (name) {
145             case &quot;fixVersions&quot;: // fall-through
146             case &quot;versions&quot;: // fall-through
147             case &quot;components&quot;:
148                 return Optional.of(new JSONArray(value.stream()
149                                                       .map(obj -&gt; obj.get(&quot;name&quot;))
150                                                       .collect(Collectors.toList())));
151             case &quot;issuetype&quot;:
152                 return Optional.of(JSON.of(value.get(&quot;name&quot;).asString()));
153             case &quot;priority&quot;:
154                 return Optional.of(JSON.of(value.get(&quot;id&quot;).asString()));
155             default:
156                 return Optional.of(value);
157         }
158     }
159 
160     Optional&lt;JSONValue&gt; encodeProperty(String name, JSONValue value) {
<span class="line-modified">161         if (!isAllowedProperty(name, true)) {</span>
162             return Optional.empty();
163         }
164 
165         switch (name) {
166             case &quot;fixVersions&quot;: // fall-through
167             case &quot;versions&quot;:
168                 return Optional.of(new JSONArray(value.stream()
169                                                       .map(JSONValue::asString)
170                                                       .map(s -&gt; JSON.object().put(&quot;id&quot;, versions().get(s)))
171                                                       .collect(Collectors.toList())));
172             case &quot;components&quot;:
173                 return Optional.of(new JSONArray(value.stream()
174                                                       .map(JSONValue::asString)
175                                                       .map(s -&gt; JSON.object().put(&quot;id&quot;, components().get(s)))
176                                                       .collect(Collectors.toList())));
177             case &quot;issuetype&quot;:
178                 return Optional.of(JSON.object().put(&quot;id&quot;, issueTypes().get(value.asString())));
179             case &quot;priority&quot;:
180                 return Optional.of(JSON.object().put(&quot;id&quot;, value.asString()));
181             default:
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>