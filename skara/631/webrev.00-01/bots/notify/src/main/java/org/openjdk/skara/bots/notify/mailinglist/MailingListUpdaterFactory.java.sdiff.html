<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/notify/src/main/java/org/openjdk/skara/bots/notify/mailinglist/MailingListUpdaterFactory.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../test/java/org/openjdk/skara/bots/notify/MailingListUpdaterTests.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>bots/notify/src/main/java/org/openjdk/skara/bots/notify/mailinglist/MailingListUpdaterFactory.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
44         var smtp = notifierConfiguration.get(&quot;smtp&quot;).asString();
45         var sender = EmailAddress.parse(notifierConfiguration.get(&quot;sender&quot;).asString());
46         var archive = URIBuilder.base(notifierConfiguration.get(&quot;archive&quot;).asString()).build();
47         var interval = notifierConfiguration.contains(&quot;interval&quot;) ? Duration.parse(notifierConfiguration.get(&quot;interval&quot;).asString()) : Duration.ofSeconds(1);
48         var listServer = MailingListServerFactory.createMailmanServer(archive, smtp, interval);
49 
50         var recipient = notifierConfiguration.get(&quot;recipient&quot;).asString();
51         var recipientAddress = EmailAddress.parse(recipient);
52 
53         var author = notifierConfiguration.contains(&quot;author&quot;) ? EmailAddress.parse(notifierConfiguration.get(&quot;author&quot;).asString()) : null;
54         var allowedDomains = author == null ? Pattern.compile(notifierConfiguration.get(&quot;domains&quot;).asString()) : null;
55 
56         var mailingListUpdaterBuilder = MailingListUpdater.newBuilder()
57                                                           .list(listServer.getList(recipient))
58                                                           .recipient(recipientAddress)
59                                                           .sender(sender)
60                                                           .author(author)
61                                                           .allowedAuthorDomains(allowedDomains);
62 
63         if (notifierConfiguration.contains(&quot;mode&quot;)) {
<span class="line-modified">64             var mode = MailingListUpdater.Mode.ALL;</span>
65             switch (notifierConfiguration.get(&quot;mode&quot;).asString()) {



66                 case &quot;pr&quot;:
67                     mode = MailingListUpdater.Mode.PR;
68                     break;
69                 default:
70                     throw new RuntimeException(&quot;Unknown mode&quot;);
71             }
72             mailingListUpdaterBuilder.mode(mode);
73         }
74         if (notifierConfiguration.contains(&quot;headers&quot;)) {
75             mailingListUpdaterBuilder.headers(notifierConfiguration.get(&quot;headers&quot;).fields().stream()
76                                                                    .collect(Collectors.toMap(JSONObject.Field::name,
77                                                                            field -&gt; field.value().asString())));
78         }
79         if (notifierConfiguration.contains(&quot;branchnames&quot;)) {
80             mailingListUpdaterBuilder.includeBranch(notifierConfiguration.get(&quot;branchnames&quot;).asBoolean());
81         }
82         if (notifierConfiguration.contains(&quot;tags&quot;)) {
83             mailingListUpdaterBuilder.reportNewTags(notifierConfiguration.get(&quot;tags&quot;).asBoolean());
84         }
85         if (notifierConfiguration.contains(&quot;branches&quot;)) {
</pre>
</td>
<td>
<hr />
<pre>
44         var smtp = notifierConfiguration.get(&quot;smtp&quot;).asString();
45         var sender = EmailAddress.parse(notifierConfiguration.get(&quot;sender&quot;).asString());
46         var archive = URIBuilder.base(notifierConfiguration.get(&quot;archive&quot;).asString()).build();
47         var interval = notifierConfiguration.contains(&quot;interval&quot;) ? Duration.parse(notifierConfiguration.get(&quot;interval&quot;).asString()) : Duration.ofSeconds(1);
48         var listServer = MailingListServerFactory.createMailmanServer(archive, smtp, interval);
49 
50         var recipient = notifierConfiguration.get(&quot;recipient&quot;).asString();
51         var recipientAddress = EmailAddress.parse(recipient);
52 
53         var author = notifierConfiguration.contains(&quot;author&quot;) ? EmailAddress.parse(notifierConfiguration.get(&quot;author&quot;).asString()) : null;
54         var allowedDomains = author == null ? Pattern.compile(notifierConfiguration.get(&quot;domains&quot;).asString()) : null;
55 
56         var mailingListUpdaterBuilder = MailingListUpdater.newBuilder()
57                                                           .list(listServer.getList(recipient))
58                                                           .recipient(recipientAddress)
59                                                           .sender(sender)
60                                                           .author(author)
61                                                           .allowedAuthorDomains(allowedDomains);
62 
63         if (notifierConfiguration.contains(&quot;mode&quot;)) {
<span class="line-modified">64             MailingListUpdater.Mode mode;</span>
65             switch (notifierConfiguration.get(&quot;mode&quot;).asString()) {
<span class="line-added">66                 case &quot;all&quot;:</span>
<span class="line-added">67                     mode = MailingListUpdater.Mode.ALL;</span>
<span class="line-added">68                     break;</span>
69                 case &quot;pr&quot;:
70                     mode = MailingListUpdater.Mode.PR;
71                     break;
72                 default:
73                     throw new RuntimeException(&quot;Unknown mode&quot;);
74             }
75             mailingListUpdaterBuilder.mode(mode);
76         }
77         if (notifierConfiguration.contains(&quot;headers&quot;)) {
78             mailingListUpdaterBuilder.headers(notifierConfiguration.get(&quot;headers&quot;).fields().stream()
79                                                                    .collect(Collectors.toMap(JSONObject.Field::name,
80                                                                            field -&gt; field.value().asString())));
81         }
82         if (notifierConfiguration.contains(&quot;branchnames&quot;)) {
83             mailingListUpdaterBuilder.includeBranch(notifierConfiguration.get(&quot;branchnames&quot;).asBoolean());
84         }
85         if (notifierConfiguration.contains(&quot;tags&quot;)) {
86             mailingListUpdaterBuilder.reportNewTags(notifierConfiguration.get(&quot;tags&quot;).asBoolean());
87         }
88         if (notifierConfiguration.contains(&quot;branches&quot;)) {
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../test/java/org/openjdk/skara/bots/notify/MailingListUpdaterTests.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>