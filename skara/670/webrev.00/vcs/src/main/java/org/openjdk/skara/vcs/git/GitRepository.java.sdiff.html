<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff vcs/src/main/java/org/openjdk/skara/vcs/git/GitRepository.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/vcs/RepositoryTests.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>vcs/src/main/java/org/openjdk/skara/vcs/git/GitRepository.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
1382                         throw new IOException(&quot;Unexpected output: &quot; + treeHash);
1383                     }
1384                 } else {
1385                     throw new IOException(&quot;Unexpected output: &quot; + line);
1386                 }
1387             } else {
1388                 throw new IOException(&quot;Unexpected output: &quot; + res.stderr());
1389             }
1390         }
1391         return new Tree(new Hash(treeHash));
1392     }
1393 
1394     @Override
1395     public Optional&lt;Tag.Annotated&gt; annotate(Tag tag) throws IOException {
1396         var ref = &quot;refs/tags/&quot; + tag.name();
1397         var format = &quot;%(refname:short)%0a%(*objectname)%0a%(taggername) %(taggeremail)%0a%(taggerdate:iso-strict)%0a%(contents)&quot;;
1398         try (var p = capture(&quot;git&quot;, &quot;for-each-ref&quot;, &quot;--format&quot;, format, ref)) {
1399             var lines = await(p).stdout();
1400             if (lines.size() &gt;= 4) {
1401                 var name = lines.get(0);
<span class="line-modified">1402                 var target = new Hash(lines.get(1));</span>
<span class="line-modified">1403                 var author = Author.fromString(lines.get(2));</span>

1404 







1405                 var formatter = DateTimeFormatter.ISO_OFFSET_DATE_TIME;
<span class="line-modified">1406                 var date = ZonedDateTime.parse(lines.get(3), formatter);</span>
1407                 var message = String.join(&quot;\n&quot;, lines.subList(4, lines.size()));
1408 
1409                 return Optional.of(new Tag.Annotated(name, target, author, date, message));
1410             }
1411             return Optional.empty();
1412         }
1413     }
1414 
1415     @Override
1416     public void config(String section, String key, String value, boolean global) throws IOException {
1417         var cmd = new ArrayList&lt;String&gt;();
1418         cmd.addAll(List.of(&quot;git&quot;, &quot;config&quot;));
1419         if (global) {
1420             cmd.add(&quot;--global&quot;);
1421         }
1422         cmd.add(section + &quot;.&quot; + key);
1423         cmd.add(value);
1424         try (var p = capture(cmd)) {
1425             await(p);
1426         }
</pre>
</td>
<td>
<hr />
<pre>
1382                         throw new IOException(&quot;Unexpected output: &quot; + treeHash);
1383                     }
1384                 } else {
1385                     throw new IOException(&quot;Unexpected output: &quot; + line);
1386                 }
1387             } else {
1388                 throw new IOException(&quot;Unexpected output: &quot; + res.stderr());
1389             }
1390         }
1391         return new Tree(new Hash(treeHash));
1392     }
1393 
1394     @Override
1395     public Optional&lt;Tag.Annotated&gt; annotate(Tag tag) throws IOException {
1396         var ref = &quot;refs/tags/&quot; + tag.name();
1397         var format = &quot;%(refname:short)%0a%(*objectname)%0a%(taggername) %(taggeremail)%0a%(taggerdate:iso-strict)%0a%(contents)&quot;;
1398         try (var p = capture(&quot;git&quot;, &quot;for-each-ref&quot;, &quot;--format&quot;, format, ref)) {
1399             var lines = await(p).stdout();
1400             if (lines.size() &gt;= 4) {
1401                 var name = lines.get(0);
<span class="line-modified">1402                 var targetLine = lines.get(1);</span>
<span class="line-modified">1403                 var authorLine = lines.get(2);</span>
<span class="line-added">1404                 var dateLine = lines.get(3);</span>
1405 
<span class="line-added">1406                 if (targetLine.isEmpty() &amp;&amp; authorLine.equals(&quot; &quot;) &amp;&amp; dateLine.isEmpty()) {</span>
<span class="line-added">1407                     // Must be a lightweight tag, no metadata present</span>
<span class="line-added">1408                     return Optional.empty();</span>
<span class="line-added">1409                 }</span>
<span class="line-added">1410 </span>
<span class="line-added">1411                 var target = new Hash(targetLine);</span>
<span class="line-added">1412                 var author = Author.fromString(authorLine);</span>
1413                 var formatter = DateTimeFormatter.ISO_OFFSET_DATE_TIME;
<span class="line-modified">1414                 var date = ZonedDateTime.parse(dateLine, formatter);</span>
1415                 var message = String.join(&quot;\n&quot;, lines.subList(4, lines.size()));
1416 
1417                 return Optional.of(new Tag.Annotated(name, target, author, date, message));
1418             }
1419             return Optional.empty();
1420         }
1421     }
1422 
1423     @Override
1424     public void config(String section, String key, String value, boolean global) throws IOException {
1425         var cmd = new ArrayList&lt;String&gt;();
1426         cmd.addAll(List.of(&quot;git&quot;, &quot;config&quot;));
1427         if (global) {
1428             cmd.add(&quot;--global&quot;);
1429         }
1430         cmd.add(section + &quot;.&quot; + key);
1431         cmd.add(value);
1432         try (var p = capture(cmd)) {
1433             await(p);
1434         }
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/vcs/RepositoryTests.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>