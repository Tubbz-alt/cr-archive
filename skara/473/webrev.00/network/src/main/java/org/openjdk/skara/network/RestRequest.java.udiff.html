<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff network/src/main/java/org/openjdk/skara/network/RestRequest.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>network/src/main/java/org/openjdk/skara/network/RestRequest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -25,13 +25,13 @@</span>
  import org.openjdk.skara.json.*;
  
  import java.io.*;
  import java.net.URI;
  import java.net.http.*;
<span class="udiff-line-modified-removed">- import java.time.Duration;</span>
<span class="udiff-line-modified-added">+ import java.time.*;</span>
  import java.util.*;
<span class="udiff-line-modified-removed">- import java.util.logging.Logger;</span>
<span class="udiff-line-modified-added">+ import java.util.logging.*;</span>
  import java.util.regex.Pattern;
  import java.util.stream.Collectors;
  
  public class RestRequest {
      private enum RequestType {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -199,21 +199,32 @@</span>
          }
          return builder;
      }
  
      private void logRateLimit(HttpHeaders headers) {
<span class="udiff-line-modified-removed">-         if ((!headers.firstValue(&quot;x-ratelimit-limit&quot;).isPresent()) ||</span>
<span class="udiff-line-modified-removed">-                 (!headers.firstValue(&quot;x-ratelimit-remaining&quot;).isPresent()) ||</span>
<span class="udiff-line-modified-removed">-                 (!headers.firstValue(&quot;x-ratelimit-reset&quot;).isPresent())) {</span>
<span class="udiff-line-modified-added">+         if ((headers.firstValue(&quot;x-ratelimit-limit&quot;).isEmpty()) ||</span>
<span class="udiff-line-modified-added">+                 (headers.firstValue(&quot;x-ratelimit-remaining&quot;).isEmpty()) ||</span>
<span class="udiff-line-modified-added">+                 (headers.firstValue(&quot;x-ratelimit-reset&quot;).isEmpty())) {</span>
              return;
          }
  
<span class="udiff-line-modified-removed">-         var limit = Integer.valueOf(headers.firstValue(&quot;x-ratelimit-limit&quot;).get());</span>
<span class="udiff-line-modified-removed">-         var remaining = Integer.valueOf(headers.firstValue(&quot;x-ratelimit-remaining&quot;).get());</span>
<span class="udiff-line-modified-removed">-         var reset = Integer.valueOf(headers.firstValue(&quot;x-ratelimit-reset&quot;).get());</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         log.fine(&quot;Rate limit: &quot; + limit + &quot; - remaining: &quot; + remaining);</span>
<span class="udiff-line-modified-added">+         var limit = Integer.parseInt(headers.firstValue(&quot;x-ratelimit-limit&quot;).get());</span>
<span class="udiff-line-modified-added">+         var remaining = Integer.parseInt(headers.firstValue(&quot;x-ratelimit-remaining&quot;).get());</span>
<span class="udiff-line-modified-added">+         var reset = Integer.parseInt(headers.firstValue(&quot;x-ratelimit-reset&quot;).get());</span>
<span class="udiff-line-modified-added">+         var timeToReset = Duration.between(Instant.now(), Instant.ofEpochSecond(reset));</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+         var level = Level.FINE;</span>
<span class="udiff-line-added">+         var remainingPercentage = (remaining * 100) / limit;</span>
<span class="udiff-line-added">+         if (remainingPercentage &lt; 10) {</span>
<span class="udiff-line-added">+             level = Level.SEVERE;</span>
<span class="udiff-line-added">+         } else if (remainingPercentage &lt; 20) {</span>
<span class="udiff-line-added">+             level = Level.WARNING;</span>
<span class="udiff-line-added">+         } else if (remainingPercentage &lt; 50) {</span>
<span class="udiff-line-added">+             level = Level.INFO;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         log.log(level,&quot;Rate limit: &quot; + limit + &quot; Remaining: &quot; + remaining + &quot; (&quot; + remainingPercentage + &quot;%) &quot; +</span>
<span class="udiff-line-added">+                 &quot;Resets in: &quot; + timeToReset.toMinutes() + &quot; minutes&quot;);</span>
      }
  
      private Duration retryBackoffStep = Duration.ofSeconds(1);
  
      void setRetryBackoffStep(Duration duration) {
</pre>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>