<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/pr/src/main/java/org/openjdk/skara/bots/pr/IssueCommand.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/bots/pr/IssueTests.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>bots/pr/src/main/java/org/openjdk/skara/bots/pr/IssueCommand.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 49         return reason;
 50     }
 51 }
 52 
 53 public class IssueCommand implements CommandHandler {
 54     private final String name;
 55 
 56     private void showHelp(PrintWriter reply) {
 57         reply.println(&quot;Command syntax: `/&quot; + name + &quot; [add|remove] &lt;id&gt;[,&lt;id&gt;,...]` or `/issue [add] &lt;id&gt;: &lt;description&gt;`. For example:&quot;);
 58         reply.println();
 59         reply.println(&quot; * `/&quot; + name + &quot; add JDK-1234567,4567890`&quot;);
 60         reply.println(&quot; * `/&quot; + name + &quot; remove JDK-4567890`&quot;);
 61         reply.println(&quot; * `/&quot; + name + &quot; 1234567: Use this exact title`&quot;);
 62         reply.println();
 63         reply.print(&quot;If issues are specified only by their ID, the title will be automatically retrieved from JBS. &quot;);
 64         reply.print(&quot;The project prefix (`JDK-` in the above examples) is optional. &quot;);
 65         reply.println(&quot;Separate multiple issue IDs using either spaces or commas.&quot;);
 66     }
 67 
 68     private static final Pattern shortIssuePattern = Pattern.compile(&quot;((?:[A-Za-z]+-)?[0-9]+)(?:,| |$)&quot;);

 69 
 70     private List&lt;Issue&gt; parseIssueList(String allowedPrefix, String issueList) throws InvalidIssue {
 71         List&lt;Issue&gt; ret;
 72         // Is this a single fully described issue?
 73         var singleIssue = Issue.fromString(issueList);
 74         if (singleIssue.isPresent()) {
 75             ret = List.of(singleIssue.get());
 76         } else {
 77             var shortIssueMatcher = shortIssuePattern.matcher(issueList);
 78             ret = shortIssueMatcher.results()
 79                                    .map(matchResult -&gt; matchResult.group(1))
 80                                    .map(identifier -&gt; new Issue(identifier, null))
 81                                    .collect(Collectors.toList());
 82         }
 83         for (var issue : ret) {
 84             if (issue.id().contains(&quot;-&quot;) &amp;&amp; !issue.id().startsWith(allowedPrefix)) {
 85                 throw new InvalidIssue(issue.id(), &quot;This PR can only solve issues in the &quot; + allowedPrefix + &quot; project&quot;);
 86             }
 87         }
 88 
 89         // Drop the validated project prefixes
 90         return ret.stream()
 91                   .map(issue -&gt; issue.id().contains(&quot;-&quot;) ? new Issue(issue.id().split(&quot;-&quot;, 2)[1], issue.description()) : issue)
 92                   .collect(Collectors.toList());
 93     }
 94 
<span class="line-removed"> 95     private final static Pattern subCommandPattern = Pattern.compile(&quot;^(add|remove|delete|(?:[A-Za-z]+-)?[0-9]+:?)[ ,]+.*$&quot;);</span>
<span class="line-removed"> 96 </span>
 97     IssueCommand(String name) {
 98         this.name = name;
 99     }
100 
101     IssueCommand() {
102         this(&quot;issue&quot;);
103     }
104 
105     @Override
106     public void handle(PullRequestBot bot, PullRequest pr, CensusInstance censusInstance, Path scratchPath, String args, Comment comment, List&lt;Comment&gt; allComments, PrintWriter reply) {
107         if (!comment.author().equals(pr.author())) {
108             reply.println(&quot;Only the author (@&quot; + pr.author().userName() + &quot;) is allowed to issue the `/&quot; + name + &quot;` command.&quot;);
109             return;
110         }
111         if (args.isBlank()) {
112             showHelp(reply);
113             return;
114         }
115         var subCommandMatcher = subCommandPattern.matcher(args);
116         if (!subCommandMatcher.matches()) {
</pre>
</td>
<td>
<hr />
<pre>
 49         return reason;
 50     }
 51 }
 52 
 53 public class IssueCommand implements CommandHandler {
 54     private final String name;
 55 
 56     private void showHelp(PrintWriter reply) {
 57         reply.println(&quot;Command syntax: `/&quot; + name + &quot; [add|remove] &lt;id&gt;[,&lt;id&gt;,...]` or `/issue [add] &lt;id&gt;: &lt;description&gt;`. For example:&quot;);
 58         reply.println();
 59         reply.println(&quot; * `/&quot; + name + &quot; add JDK-1234567,4567890`&quot;);
 60         reply.println(&quot; * `/&quot; + name + &quot; remove JDK-4567890`&quot;);
 61         reply.println(&quot; * `/&quot; + name + &quot; 1234567: Use this exact title`&quot;);
 62         reply.println();
 63         reply.print(&quot;If issues are specified only by their ID, the title will be automatically retrieved from JBS. &quot;);
 64         reply.print(&quot;The project prefix (`JDK-` in the above examples) is optional. &quot;);
 65         reply.println(&quot;Separate multiple issue IDs using either spaces or commas.&quot;);
 66     }
 67 
 68     private static final Pattern shortIssuePattern = Pattern.compile(&quot;((?:[A-Za-z]+-)?[0-9]+)(?:,| |$)&quot;);
<span class="line-added"> 69     private final static Pattern subCommandPattern = Pattern.compile(&quot;^(add|remove|delete|(?:[A-Za-z]+-)?[0-9]+:?)[ ,]?.*$&quot;);</span>
 70 
 71     private List&lt;Issue&gt; parseIssueList(String allowedPrefix, String issueList) throws InvalidIssue {
 72         List&lt;Issue&gt; ret;
 73         // Is this a single fully described issue?
 74         var singleIssue = Issue.fromString(issueList);
 75         if (singleIssue.isPresent()) {
 76             ret = List.of(singleIssue.get());
 77         } else {
 78             var shortIssueMatcher = shortIssuePattern.matcher(issueList);
 79             ret = shortIssueMatcher.results()
 80                                    .map(matchResult -&gt; matchResult.group(1))
 81                                    .map(identifier -&gt; new Issue(identifier, null))
 82                                    .collect(Collectors.toList());
 83         }
 84         for (var issue : ret) {
 85             if (issue.id().contains(&quot;-&quot;) &amp;&amp; !issue.id().startsWith(allowedPrefix)) {
 86                 throw new InvalidIssue(issue.id(), &quot;This PR can only solve issues in the &quot; + allowedPrefix + &quot; project&quot;);
 87             }
 88         }
 89 
 90         // Drop the validated project prefixes
 91         return ret.stream()
 92                   .map(issue -&gt; issue.id().contains(&quot;-&quot;) ? new Issue(issue.id().split(&quot;-&quot;, 2)[1], issue.description()) : issue)
 93                   .collect(Collectors.toList());
 94     }
 95 


 96     IssueCommand(String name) {
 97         this.name = name;
 98     }
 99 
100     IssueCommand() {
101         this(&quot;issue&quot;);
102     }
103 
104     @Override
105     public void handle(PullRequestBot bot, PullRequest pr, CensusInstance censusInstance, Path scratchPath, String args, Comment comment, List&lt;Comment&gt; allComments, PrintWriter reply) {
106         if (!comment.author().equals(pr.author())) {
107             reply.println(&quot;Only the author (@&quot; + pr.author().userName() + &quot;) is allowed to issue the `/&quot; + name + &quot;` command.&quot;);
108             return;
109         }
110         if (args.isBlank()) {
111             showHelp(reply);
112             return;
113         }
114         var subCommandMatcher = subCommandPattern.matcher(args);
115         if (!subCommandMatcher.matches()) {
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/bots/pr/IssueTests.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>