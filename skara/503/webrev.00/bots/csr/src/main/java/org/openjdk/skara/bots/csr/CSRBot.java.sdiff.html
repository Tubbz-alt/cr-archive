<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/csr/src/main/java/org/openjdk/skara/bots/csr/CSRBot.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>bots/csr/src/main/java/org/openjdk/skara/bots/csr/CSRBot.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 85 
 86             var issue = org.openjdk.skara.vcs.openjdk.Issue.fromString(pr.title());
 87             if (issue.isEmpty()) {
 88                 log.info(&quot;No issue found in title for &quot; + describe(pr));
 89                 continue;
 90             }
 91             var jbsIssue = project.issue(issue.get().id());
 92             if (jbsIssue.isEmpty()) {
 93                 log.info(&quot;No issue found in JBS for &quot; + describe(pr));
 94                 continue;
 95             }
 96 
 97             for (var link : jbsIssue.get().links()) {
 98                 var relationship = link.relationship();
 99                 if (relationship.isPresent() &amp;&amp; relationship.get().equals(&quot;csr for&quot;)) {
100                     log.info(&quot;Found CSR for &quot; + describe(pr));
101 
102                     var csr = link.issue().orElseThrow(
103                             () -&gt; new IllegalStateException(&quot;Link with title &#39;csr for&#39; does not contain issue&quot;)
104                     );



105                     var resolution = csr.properties().get(&quot;resolution&quot;);
106                     if (resolution == null || resolution.isNull()) {

107                         continue;
108                     }
109                     var name = resolution.get(&quot;name&quot;);
110                     if (name == null || name.isNull()) {

111                         continue;
112                     }
113 
<span class="line-modified">114                     if (csr.state() == Issue.State.CLOSED &amp;&amp; name.asString().equals(&quot;Approved&quot;)) {</span>
<span class="line-modified">115                         log.info(&quot;CSR closed and approved for &quot; + repo.name() + &quot;#&quot; + pr.id() + &quot;, removing csr label&quot;);</span>
<span class="line-modified">116                         pr.removeLabel(CSR_LABEL);</span>
<span class="line-removed">117                         hasCSRLabel.remove(pr.id());</span>
118                     }









119                 }
120             }
121         }
122     }
123 
124     @Override
125     public String toString() {
126         return &quot;CSRBot@&quot; + repo.name();
127     }
128 
129     @Override
130     public List&lt;WorkItem&gt; getPeriodicItems() {
131         return List.of(this);
132     }
133 }
</pre>
</td>
<td>
<hr />
<pre>
 85 
 86             var issue = org.openjdk.skara.vcs.openjdk.Issue.fromString(pr.title());
 87             if (issue.isEmpty()) {
 88                 log.info(&quot;No issue found in title for &quot; + describe(pr));
 89                 continue;
 90             }
 91             var jbsIssue = project.issue(issue.get().id());
 92             if (jbsIssue.isEmpty()) {
 93                 log.info(&quot;No issue found in JBS for &quot; + describe(pr));
 94                 continue;
 95             }
 96 
 97             for (var link : jbsIssue.get().links()) {
 98                 var relationship = link.relationship();
 99                 if (relationship.isPresent() &amp;&amp; relationship.get().equals(&quot;csr for&quot;)) {
100                     log.info(&quot;Found CSR for &quot; + describe(pr));
101 
102                     var csr = link.issue().orElseThrow(
103                             () -&gt; new IllegalStateException(&quot;Link with title &#39;csr for&#39; does not contain issue&quot;)
104                     );
<span class="line-added">105 </span>
<span class="line-added">106                     log.info(&quot;CSR for &quot; + describe(pr) + &quot; has id &quot; + csr.id());</span>
<span class="line-added">107 </span>
108                     var resolution = csr.properties().get(&quot;resolution&quot;);
109                     if (resolution == null || resolution.isNull()) {
<span class="line-added">110                         log.info(&quot;CSR issue resolution is null for &quot; + describe(pr) + &quot;, not removing CSR label&quot;);</span>
111                         continue;
112                     }
113                     var name = resolution.get(&quot;name&quot;);
114                     if (name == null || name.isNull()) {
<span class="line-added">115                         log.info(&quot;CSR issue resolution name is null for &quot; + describe(pr) + &quot;, not removing CSR label&quot;);</span>
116                         continue;
117                     }
118 
<span class="line-modified">119                     if (csr.state() != Issue.State.CLOSED) {</span>
<span class="line-modified">120                         log.info(&quot;CSR issue state is not closed for &quot; + describe(pr) + &quot;, not removing CSR label&quot;);</span>
<span class="line-modified">121                         continue;</span>

122                     }
<span class="line-added">123 </span>
<span class="line-added">124                     if (!name.asString().equals(&quot;Approved&quot;)) {</span>
<span class="line-added">125                         log.info(&quot;CSR issue resolution is not &#39;Approved&#39; for &quot; + describe(pr) + &quot;, not removing CSR label&quot;);</span>
<span class="line-added">126                         continue;</span>
<span class="line-added">127                     }</span>
<span class="line-added">128 </span>
<span class="line-added">129                     log.info(&quot;CSR closed and approved for &quot; + describe(pr) + &quot;, removing CSR label&quot;);</span>
<span class="line-added">130                     pr.removeLabel(CSR_LABEL);</span>
<span class="line-added">131                     hasCSRLabel.remove(pr.id());</span>
132                 }
133             }
134         }
135     }
136 
137     @Override
138     public String toString() {
139         return &quot;CSRBot@&quot; + repo.name();
140     }
141 
142     @Override
143     public List&lt;WorkItem&gt; getPeriodicItems() {
144         return List.of(this);
145     }
146 }
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>