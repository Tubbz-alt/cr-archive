<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff cli/src/main/java/org/openjdk/skara/cli/GitFork.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>cli/src/main/java/org/openjdk/skara/cli/GitFork.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
254             exit(&quot;error: not a valid URI: &quot; + uri);
255         }
256 
257         var webURI = Remote.toWebURI(uri.toString());
258         var token = isMercurial ? System.getenv(&quot;HG_TOKEN&quot;) : System.getenv(&quot;GIT_TOKEN&quot;);
259         var username = getOption(&quot;username&quot;, subsection, arguments);
260         var credentials = GitCredentials.fill(webURI.getHost(), webURI.getPath(), username, token, webURI.getScheme());
261 
262         if (credentials.password() == null) {
263             exit(&quot;error: no personal access token found, use git-credentials or the environment variable GIT_TOKEN&quot;);
264         }
265         if (credentials.username() == null) {
266             exit(&quot;error: no username for &quot; + webURI.getHost() + &quot; found, use git-credentials or the flag --username&quot;);
267         }
268 
269         var host = Forge.from(webURI, new Credential(credentials.username(), credentials.password()));
270         if (host.isEmpty()) {
271             exit(&quot;error: could not connect to host &quot; + webURI.getHost());
272         }
273 
<span class="line-modified">274         var hostedRepo = host.get().repository(webURI.getPath().substring(1)).orElseThrow(() -&gt;</span>







275             new IOException(&quot;Could not find repository at &quot; + webURI.toString())
276         );
277 
278         var fork = hostedRepo.fork();
279         if (token == null) {
280             GitCredentials.approve(credentials);
281         }
282 
283         var forkWebUrl = fork.webUrl();
284         if (isMercurial) {
285             forkWebUrl = URI.create(&quot;git+&quot; + forkWebUrl.toString());
286         }
287 
288         boolean noClone = getSwitch(&quot;no-clone&quot;, subsection, arguments);
289         boolean noRemote = getSwitch(&quot;no-remote&quot;, subsection, arguments);
290         boolean shouldSync = getSwitch(&quot;sync&quot;, subsection, arguments);
291         if (noClone || !arguments.at(0).isPresent()) {
292             if (!arguments.at(0).isPresent()) {
293                 var cwd = Path.of(&quot;&quot;).toAbsolutePath();
294                 var repo = Repository.get(cwd).orElseGet(die(&quot;error: no git repository found at &quot; + cwd));
</pre>
</td>
<td>
<hr />
<pre>
254             exit(&quot;error: not a valid URI: &quot; + uri);
255         }
256 
257         var webURI = Remote.toWebURI(uri.toString());
258         var token = isMercurial ? System.getenv(&quot;HG_TOKEN&quot;) : System.getenv(&quot;GIT_TOKEN&quot;);
259         var username = getOption(&quot;username&quot;, subsection, arguments);
260         var credentials = GitCredentials.fill(webURI.getHost(), webURI.getPath(), username, token, webURI.getScheme());
261 
262         if (credentials.password() == null) {
263             exit(&quot;error: no personal access token found, use git-credentials or the environment variable GIT_TOKEN&quot;);
264         }
265         if (credentials.username() == null) {
266             exit(&quot;error: no username for &quot; + webURI.getHost() + &quot; found, use git-credentials or the flag --username&quot;);
267         }
268 
269         var host = Forge.from(webURI, new Credential(credentials.username(), credentials.password()));
270         if (host.isEmpty()) {
271             exit(&quot;error: could not connect to host &quot; + webURI.getHost());
272         }
273 
<span class="line-modified">274         var repositoryPath = webURI.getPath().substring(1);</span>
<span class="line-added">275 </span>
<span class="line-added">276         if (repositoryPath.endsWith(&quot;/&quot;)) {</span>
<span class="line-added">277             repositoryPath =</span>
<span class="line-added">278                     repositoryPath.substring(0, repositoryPath.length() - 1);</span>
<span class="line-added">279         }</span>
<span class="line-added">280 </span>
<span class="line-added">281         var hostedRepo = host.get().repository(repositoryPath).orElseThrow(() -&gt;</span>
282             new IOException(&quot;Could not find repository at &quot; + webURI.toString())
283         );
284 
285         var fork = hostedRepo.fork();
286         if (token == null) {
287             GitCredentials.approve(credentials);
288         }
289 
290         var forkWebUrl = fork.webUrl();
291         if (isMercurial) {
292             forkWebUrl = URI.create(&quot;git+&quot; + forkWebUrl.toString());
293         }
294 
295         boolean noClone = getSwitch(&quot;no-clone&quot;, subsection, arguments);
296         boolean noRemote = getSwitch(&quot;no-remote&quot;, subsection, arguments);
297         boolean shouldSync = getSwitch(&quot;sync&quot;, subsection, arguments);
298         if (noClone || !arguments.at(0).isPresent()) {
299             if (!arguments.at(0).isPresent()) {
300                 var cwd = Path.of(&quot;&quot;).toAbsolutePath();
301                 var repo = Repository.get(cwd).orElseGet(die(&quot;error: no git repository found at &quot; + cwd));
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>