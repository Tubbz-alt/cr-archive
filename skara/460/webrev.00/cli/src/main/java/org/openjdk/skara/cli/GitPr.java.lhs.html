<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames cli/src/main/java/org/openjdk/skara/cli/GitPr.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 /*
   2  * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
  23 package org.openjdk.skara.cli;
  24 
  25 import org.openjdk.skara.args.*;
<a name="1" id="anc1"></a><span class="line-modified">  26 import org.openjdk.skara.forge.*;</span>
<span class="line-removed">  27 import org.openjdk.skara.host.*;</span>
<span class="line-removed">  28 import org.openjdk.skara.issuetracker.IssueTracker;</span>
<span class="line-removed">  29 import org.openjdk.skara.issuetracker.Issue;</span>
<span class="line-removed">  30 import org.openjdk.skara.jcheck.JCheckConfiguration;</span>
  31 import org.openjdk.skara.proxy.HttpProxy;
<a name="2" id="anc2"></a><span class="line-removed">  32 import org.openjdk.skara.vcs.*;</span>
<span class="line-removed">  33 import org.openjdk.skara.vcs.openjdk.CommitMessageParsers;</span>
<span class="line-removed">  34 import org.openjdk.skara.version.Version;</span>
  35 
<a name="3" id="anc3"></a><span class="line-modified">  36 import java.io.IOException;</span>
<span class="line-removed">  37 import java.net.URI;</span>
<span class="line-removed">  38 import java.nio.charset.StandardCharsets;</span>
<span class="line-removed">  39 import java.nio.file.*;</span>
<span class="line-removed">  40 import java.util.*;</span>
<span class="line-removed">  41 import java.util.regex.Pattern;</span>
<span class="line-removed">  42 import java.util.concurrent.TimeUnit;</span>
<span class="line-removed">  43 import java.util.logging.Level;</span>
<span class="line-removed">  44 import java.util.regex.Matcher;</span>
<span class="line-removed">  45 import java.util.stream.Collectors;</span>
  46 
  47 public class GitPr {
<a name="4" id="anc4"></a><span class="line-removed">  48     private static final Pattern ISSUE_ID_PATTERN = Pattern.compile(&quot;([A-Za-z][A-Za-z0-9]+)?-([0-9]+)&quot;);</span>
<span class="line-removed">  49     private static final Pattern ISSUE_MARKDOWN_PATTERN =</span>
<span class="line-removed">  50         Pattern.compile(&quot;^(?: \\* )?\\[([A-Z]+-[0-9]+)\\]\\(https:\\/\\/bugs.openjdk.java.net\\/browse\\/[A-Z]+-[0-9]+\\): .*$&quot;);</span>
<span class="line-removed">  51 </span>
<span class="line-removed">  52     private static void exit(String fmt, Object...args) {</span>
<span class="line-removed">  53         System.err.println(String.format(fmt, args));</span>
<span class="line-removed">  54         System.exit(1);</span>
<span class="line-removed">  55     }</span>
<span class="line-removed">  56 </span>
<span class="line-removed">  57     private static String gitConfig(String key) {</span>
<span class="line-removed">  58         try {</span>
<span class="line-removed">  59             var pb = new ProcessBuilder(&quot;git&quot;, &quot;config&quot;, key);</span>
<span class="line-removed">  60             pb.redirectOutput(ProcessBuilder.Redirect.PIPE);</span>
<span class="line-removed">  61             pb.redirectError(ProcessBuilder.Redirect.DISCARD);</span>
<span class="line-removed">  62             var p = pb.start();</span>
<span class="line-removed">  63 </span>
<span class="line-removed">  64             var output = new String(p.getInputStream().readAllBytes(), StandardCharsets.UTF_8);</span>
<span class="line-removed">  65             var res = p.waitFor();</span>
<span class="line-removed">  66             if (res != 0) {</span>
<span class="line-removed">  67                 return null;</span>
<span class="line-removed">  68             }</span>
<span class="line-removed">  69 </span>
<span class="line-removed">  70             return output == null ? null : output.replace(&quot;\n&quot;, &quot;&quot;);</span>
<span class="line-removed">  71         } catch (InterruptedException e) {</span>
<span class="line-removed">  72             return null;</span>
<span class="line-removed">  73         } catch (IOException e) {</span>
<span class="line-removed">  74             return null;</span>
<span class="line-removed">  75         }</span>
<span class="line-removed">  76     }</span>
<span class="line-removed">  77 </span>
<span class="line-removed">  78     private static String getOption(String name, Arguments arguments) {</span>
<span class="line-removed">  79         return getOption(name, null, arguments);</span>
<span class="line-removed">  80     }</span>
<span class="line-removed">  81 </span>
<span class="line-removed">  82     private static String getOption(String name, String subsection, Arguments arguments) {</span>
<span class="line-removed">  83         if (arguments.contains(name)) {</span>
<span class="line-removed">  84             return arguments.get(name).asString();</span>
<span class="line-removed">  85         }</span>
<span class="line-removed">  86 </span>
<span class="line-removed">  87         if (subsection != null &amp;&amp; !subsection.isEmpty()) {</span>
<span class="line-removed">  88             var subsectionSpecific = gitConfig(&quot;pr.&quot; + subsection + &quot;.&quot; + name);</span>
<span class="line-removed">  89             if (subsectionSpecific != null) {</span>
<span class="line-removed">  90                 return subsectionSpecific;</span>
<span class="line-removed">  91             }</span>
<span class="line-removed">  92         }</span>
<span class="line-removed">  93 </span>
<span class="line-removed">  94         return gitConfig(&quot;fork.&quot; + name);</span>
<span class="line-removed">  95     }</span>
<span class="line-removed">  96 </span>
<span class="line-removed">  97     private static boolean getSwitch(String name, Arguments arguments) {</span>
<span class="line-removed">  98         return getSwitch(name, null, arguments);</span>
<span class="line-removed">  99     }</span>
<span class="line-removed"> 100 </span>
<span class="line-removed"> 101     private static boolean getSwitch(String name, String subsection, Arguments arguments) {</span>
<span class="line-removed"> 102         if (arguments.contains(name)) {</span>
<span class="line-removed"> 103             return true;</span>
<span class="line-removed"> 104         }</span>
<span class="line-removed"> 105 </span>
<span class="line-removed"> 106         if (subsection != null &amp;&amp; !subsection.isEmpty()) {</span>
<span class="line-removed"> 107             var subsectionSpecific = gitConfig(&quot;pr.&quot; + subsection + &quot;.&quot; + name);</span>
<span class="line-removed"> 108             if (subsectionSpecific != null) {</span>
<span class="line-removed"> 109                 return subsectionSpecific.toLowerCase().equals(&quot;true&quot;);</span>
<span class="line-removed"> 110             }</span>
<span class="line-removed"> 111         }</span>
<span class="line-removed"> 112 </span>
<span class="line-removed"> 113         var sectionSpecific = gitConfig(&quot;fork.&quot; + name);</span>
<span class="line-removed"> 114         return sectionSpecific != null &amp;&amp; sectionSpecific.toLowerCase().equals(&quot;true&quot;);</span>
<span class="line-removed"> 115     }</span>
<span class="line-removed"> 116 </span>
<span class="line-removed"> 117     private static String rightPad(String s, int length) {</span>
<span class="line-removed"> 118         return String.format(&quot;%-&quot; + length + &quot;s&quot;, s);</span>
<span class="line-removed"> 119     }</span>
<span class="line-removed"> 120 </span>
<span class="line-removed"> 121     private static void appendPaddedHTMLComment(Path file, String line) throws IOException {</span>
<span class="line-removed"> 122         var end = &quot; --&gt;&quot;;</span>
<span class="line-removed"> 123         var pad = 79 - end.length();</span>
<span class="line-removed"> 124         var newLine = &quot;\n&quot;;</span>
<span class="line-removed"> 125         Files.writeString(file, rightPad(&quot;&lt;!-- &quot; + line, pad) + end + newLine, StandardOpenOption.APPEND);</span>
<span class="line-removed"> 126     }</span>
<span class="line-removed"> 127 </span>
<span class="line-removed"> 128     private static String format(Issue issue) {</span>
<span class="line-removed"> 129         var parts = issue.id().split(&quot;-&quot;);</span>
<span class="line-removed"> 130         var id = parts.length == 2 ? parts[1] : issue.id();</span>
<span class="line-removed"> 131         return id + &quot;: &quot; + issue.title();</span>
<span class="line-removed"> 132     }</span>
<span class="line-removed"> 133 </span>
<span class="line-removed"> 134 </span>
<span class="line-removed"> 135     private static String pullRequestIdArgument(ReadOnlyRepository repo, Arguments arguments) throws IOException {</span>
<span class="line-removed"> 136         if (arguments.at(0).isPresent()) {</span>
<span class="line-removed"> 137             return arguments.at(0).asString();</span>
<span class="line-removed"> 138         }</span>
<span class="line-removed"> 139 </span>
<span class="line-removed"> 140         var currentBranch = repo.currentBranch();</span>
<span class="line-removed"> 141         if (currentBranch.isPresent()) {</span>
<span class="line-removed"> 142             var lines = repo.config(&quot;pr.&quot; + currentBranch.get().name() + &quot;.id&quot;);</span>
<span class="line-removed"> 143             if (lines.size() == 1) {</span>
<span class="line-removed"> 144                 return lines.get(0);</span>
<span class="line-removed"> 145             }</span>
<span class="line-removed"> 146         }</span>
<span class="line-removed"> 147 </span>
<span class="line-removed"> 148         exit(&quot;error: you must provide a pull request id&quot;);</span>
<span class="line-removed"> 149         return null;</span>
<span class="line-removed"> 150     }</span>
<span class="line-removed"> 151 </span>
<span class="line-removed"> 152     private static String statusForPullRequest(PullRequest pr) {</span>
<span class="line-removed"> 153         var labels = pr.labels();</span>
<span class="line-removed"> 154         if (pr.isDraft()) {</span>
<span class="line-removed"> 155             return &quot;DRAFT&quot;;</span>
<span class="line-removed"> 156         } else if (labels.contains(&quot;integrated&quot;)) {</span>
<span class="line-removed"> 157             return &quot;INTEGRATED&quot;;</span>
<span class="line-removed"> 158         } else if (labels.contains(&quot;ready&quot;)) {</span>
<span class="line-removed"> 159             return &quot;READY&quot;;</span>
<span class="line-removed"> 160         } else if (labels.contains(&quot;rfr&quot;)) {</span>
<span class="line-removed"> 161             return &quot;RFR&quot;;</span>
<span class="line-removed"> 162         } else if (labels.contains(&quot;outdated&quot;)) {</span>
<span class="line-removed"> 163             return &quot;OUTDATED&quot;;</span>
<span class="line-removed"> 164         } else if (labels.contains(&quot;oca&quot;)) {</span>
<span class="line-removed"> 165             return &quot;OCA&quot;;</span>
<span class="line-removed"> 166         } else {</span>
<span class="line-removed"> 167             var checks = pr.checks(pr.headHash());</span>
<span class="line-removed"> 168             var jcheck = Optional.ofNullable(checks.get(&quot;jcheck&quot;));</span>
<span class="line-removed"> 169             if (jcheck.isPresent()) {</span>
<span class="line-removed"> 170                 var checkStatus = jcheck.get().status();</span>
<span class="line-removed"> 171                 if (checkStatus == CheckStatus.IN_PROGRESS) {</span>
<span class="line-removed"> 172                     return &quot;CHECKING&quot;;</span>
<span class="line-removed"> 173                 } else if (checkStatus == CheckStatus.SUCCESS) {</span>
<span class="line-removed"> 174                     return &quot;RFR&quot;;</span>
<span class="line-removed"> 175                 } else if (checkStatus == CheckStatus.FAILURE) {</span>
<span class="line-removed"> 176                     return &quot;FAILURE&quot;;</span>
<span class="line-removed"> 177                 }</span>
<span class="line-removed"> 178             } else {</span>
<span class="line-removed"> 179                 return &quot;CHECKING&quot;;</span>
<span class="line-removed"> 180             }</span>
<span class="line-removed"> 181         }</span>
<span class="line-removed"> 182 </span>
<span class="line-removed"> 183         return &quot;UNKNOWN&quot;;</span>
<span class="line-removed"> 184     }</span>
<span class="line-removed"> 185 </span>
<span class="line-removed"> 186     private static String statusForCheck(Check check) {</span>
<span class="line-removed"> 187         var checkStatus = check.status();</span>
<span class="line-removed"> 188         if (checkStatus == CheckStatus.IN_PROGRESS) {</span>
<span class="line-removed"> 189             return &quot;RUNNING&quot;;</span>
<span class="line-removed"> 190         } else if (checkStatus == CheckStatus.SUCCESS) {</span>
<span class="line-removed"> 191             return &quot;OK&quot;;</span>
<span class="line-removed"> 192         } else if (checkStatus == CheckStatus.FAILURE) {</span>
<span class="line-removed"> 193             return &quot;FAILED&quot;;</span>
<span class="line-removed"> 194         } else if (checkStatus == CheckStatus.CANCELLED) {</span>
<span class="line-removed"> 195             return &quot;CANCELLED&quot;;</span>
<span class="line-removed"> 196         }</span>
<span class="line-removed"> 197 </span>
<span class="line-removed"> 198         return &quot;UNKNOWN&quot;;</span>
<span class="line-removed"> 199     }</span>
<span class="line-removed"> 200 </span>
<span class="line-removed"> 201     private static List&lt;String&gt; issuesFromPullRequest(PullRequest pr) {</span>
<span class="line-removed"> 202         var issueTitleIndex = -1;</span>
<span class="line-removed"> 203         var lines = pr.body().split(&quot;\n&quot;);</span>
<span class="line-removed"> 204         for (var i = 0; i &lt; lines.length; i++) {</span>
<span class="line-removed"> 205             if (lines[i].startsWith(&quot;### Issue&quot;)) {</span>
<span class="line-removed"> 206                 issueTitleIndex = i;</span>
<span class="line-removed"> 207                 break;</span>
<span class="line-removed"> 208             }</span>
<span class="line-removed"> 209         }</span>
<span class="line-removed"> 210 </span>
<span class="line-removed"> 211         if (issueTitleIndex == -1) {</span>
<span class="line-removed"> 212             return List.of();</span>
<span class="line-removed"> 213         }</span>
<span class="line-removed"> 214 </span>
<span class="line-removed"> 215         var issues = new ArrayList&lt;String&gt;();</span>
<span class="line-removed"> 216         for (var i = issueTitleIndex + 1; i &lt; lines.length; i++) {</span>
<span class="line-removed"> 217             var m = ISSUE_MARKDOWN_PATTERN.matcher(lines[i]);</span>
<span class="line-removed"> 218             if (m.matches()) {</span>
<span class="line-removed"> 219                 issues.add(m.group(1));</span>
<span class="line-removed"> 220             } else {</span>
<span class="line-removed"> 221                 break;</span>
<span class="line-removed"> 222             }</span>
<span class="line-removed"> 223         }</span>
<span class="line-removed"> 224 </span>
<span class="line-removed"> 225         return issues;</span>
<span class="line-removed"> 226     }</span>
<span class="line-removed"> 227 </span>
<span class="line-removed"> 228     private static String jbsProjectFromJcheckConf(Repository repo, String targetBranch) throws IOException {</span>
<span class="line-removed"> 229         var conf = JCheckConfiguration.from(repo, repo.resolve(targetBranch).orElseThrow(() -&gt;</span>
<span class="line-removed"> 230             new IOException(&quot;Could not resolve &#39;&quot; + targetBranch + &quot;&#39; branch&quot;)</span>
<span class="line-removed"> 231         ));</span>
<span class="line-removed"> 232 </span>
<span class="line-removed"> 233         return conf.general().jbs();</span>
<span class="line-removed"> 234     }</span>
<span class="line-removed"> 235 </span>
<span class="line-removed"> 236     private static Optional&lt;Issue&gt; getIssue(Commit commit, String project) throws IOException {</span>
<span class="line-removed"> 237         var message = CommitMessageParsers.v1.parse(commit.message());</span>
<span class="line-removed"> 238         var issues = message.issues();</span>
<span class="line-removed"> 239         if (issues.isEmpty()) {</span>
<span class="line-removed"> 240             return getIssue(message.title(), project);</span>
<span class="line-removed"> 241         } else if (issues.size() == 1) {</span>
<span class="line-removed"> 242             var issue = issues.get(0);</span>
<span class="line-removed"> 243             return getIssue(issue.id(), project);</span>
<span class="line-removed"> 244         }</span>
<span class="line-removed"> 245         return Optional.empty();</span>
<span class="line-removed"> 246     }</span>
<span class="line-removed"> 247 </span>
<span class="line-removed"> 248     private static Optional&lt;Issue&gt; getIssue(Branch b, String project) throws IOException {</span>
<span class="line-removed"> 249         return getIssue(b.name(), project);</span>
<span class="line-removed"> 250     }</span>
<span class="line-removed"> 251 </span>
<span class="line-removed"> 252     private static Optional&lt;Issue&gt; getIssue(String s, String project) throws IOException {</span>
<span class="line-removed"> 253         var m = ISSUE_ID_PATTERN.matcher(s);</span>
<span class="line-removed"> 254         if (m.matches()) {</span>
<span class="line-removed"> 255             var id = m.group(2);</span>
<span class="line-removed"> 256             if (project == null) {</span>
<span class="line-removed"> 257                 project = m.group(1);</span>
<span class="line-removed"> 258             }</span>
<span class="line-removed"> 259             var issueTracker = IssueTracker.from(&quot;jira&quot;, URI.create(&quot;https://bugs.openjdk.java.net&quot;));</span>
<span class="line-removed"> 260             return issueTracker.project(project).issue(id);</span>
<span class="line-removed"> 261         }</span>
<span class="line-removed"> 262 </span>
<span class="line-removed"> 263         return Optional.empty();</span>
<span class="line-removed"> 264     }</span>
<span class="line-removed"> 265 </span>
<span class="line-removed"> 266     private static void await(Process p, Integer... allowedExitCodes) throws IOException {</span>
<span class="line-removed"> 267         var allowed = new HashSet&lt;&gt;(Arrays.asList(allowedExitCodes));</span>
<span class="line-removed"> 268         allowed.add(0);</span>
<span class="line-removed"> 269         try {</span>
<span class="line-removed"> 270             var res = p.waitFor();</span>
<span class="line-removed"> 271 </span>
<span class="line-removed"> 272             if (!allowed.contains(res)) {</span>
<span class="line-removed"> 273                 throw new IOException(&quot;Unexpected exit code &quot; + res);</span>
<span class="line-removed"> 274             }</span>
<span class="line-removed"> 275         } catch (InterruptedException e) {</span>
<span class="line-removed"> 276             throw new IOException(e);</span>
<span class="line-removed"> 277         }</span>
<span class="line-removed"> 278     }</span>
<span class="line-removed"> 279 </span>
<span class="line-removed"> 280     private static boolean spawnEditor(ReadOnlyRepository repo, Path file) throws IOException {</span>
<span class="line-removed"> 281         String editor = null;</span>
<span class="line-removed"> 282         var lines = repo.config(&quot;core.editor&quot;);</span>
<span class="line-removed"> 283         if (lines.size() == 1) {</span>
<span class="line-removed"> 284             editor = lines.get(0);</span>
<span class="line-removed"> 285         }</span>
<span class="line-removed"> 286         if (editor == null) {</span>
<span class="line-removed"> 287             editor = System.getenv(&quot;GIT_EDITOR&quot;);</span>
<span class="line-removed"> 288         }</span>
<span class="line-removed"> 289         if (editor == null) {</span>
<span class="line-removed"> 290             editor = System.getenv(&quot;EDITOR&quot;);</span>
<span class="line-removed"> 291         }</span>
<span class="line-removed"> 292         if (editor == null) {</span>
<span class="line-removed"> 293             editor = System.getenv(&quot;VISUAL&quot;);</span>
<span class="line-removed"> 294         }</span>
<span class="line-removed"> 295         if (editor == null) {</span>
<span class="line-removed"> 296             editor = &quot;vi&quot;;</span>
<span class="line-removed"> 297         }</span>
<span class="line-removed"> 298 </span>
<span class="line-removed"> 299         // As an editor command may have multiple arguments, we need to add each single one</span>
<span class="line-removed"> 300         // to the ProcessBuilder. Arguments are split by whitespace and can be quoted.</span>
<span class="line-removed"> 301         // e.g. I found core.editor =</span>
<span class="line-removed"> 302         // \&quot;C:\\\\Program Files\\\\Notepad++\\\\notepad++.exe\&quot; -multiInst -notabbar -nosession -noPlugin</span>
<span class="line-removed"> 303         List&lt;String&gt; editorParts = new ArrayList&lt;&gt;();</span>
<span class="line-removed"> 304         Matcher em = Pattern.compile(&quot;\\s*([^\&quot;]\\S*|\&quot;.+?\&quot;)\\s*&quot;).matcher(editor);</span>
<span class="line-removed"> 305         while (em.find()) {</span>
<span class="line-removed"> 306             editorParts.add(em.group(1));</span>
<span class="line-removed"> 307         }</span>
<span class="line-removed"> 308         editorParts.add(file.toString());</span>
<span class="line-removed"> 309         var pb = new ProcessBuilder(editorParts);</span>
<span class="line-removed"> 310         pb.inheritIO();</span>
<span class="line-removed"> 311         var p = pb.start();</span>
<span class="line-removed"> 312         try {</span>
<span class="line-removed"> 313             return p.waitFor() == 0;</span>
<span class="line-removed"> 314         } catch (InterruptedException e) {</span>
<span class="line-removed"> 315             throw new IOException(e);</span>
<span class="line-removed"> 316         }</span>
<span class="line-removed"> 317     }</span>
<span class="line-removed"> 318 </span>
<span class="line-removed"> 319     private static String projectName(URI uri) {</span>
<span class="line-removed"> 320         var name = uri.getPath().toString().substring(1);</span>
<span class="line-removed"> 321         if (name.endsWith(&quot;.git&quot;)) {</span>
<span class="line-removed"> 322             name = name.substring(0, name.length() - &quot;.git&quot;.length());</span>
<span class="line-removed"> 323         }</span>
<span class="line-removed"> 324         return name;</span>
<span class="line-removed"> 325     }</span>
<span class="line-removed"> 326 </span>
<span class="line-removed"> 327     private static HostedRepository getHostedRepositoryFor(URI uri, ReadOnlyRepository repo, Forge host) throws IOException {</span>
<span class="line-removed"> 328         HostedRepository targetRepo = null;</span>
<span class="line-removed"> 329 </span>
<span class="line-removed"> 330         try {</span>
<span class="line-removed"> 331             var upstream = Remote.toWebURI(repo.pullPath(&quot;upstream&quot;));</span>
<span class="line-removed"> 332             targetRepo = host.repository(projectName(upstream)).orElse(null);</span>
<span class="line-removed"> 333         } catch (IOException e) {</span>
<span class="line-removed"> 334             // do nothing</span>
<span class="line-removed"> 335         }</span>
<span class="line-removed"> 336 </span>
<span class="line-removed"> 337         if (targetRepo == null) {</span>
<span class="line-removed"> 338             var remoteRepo = host.repository(projectName(uri)).orElseThrow(() -&gt;</span>
<span class="line-removed"> 339                     new IOException(&quot;Could not find repository at: &quot; + uri.toString())</span>
<span class="line-removed"> 340             );</span>
<span class="line-removed"> 341             var parentRepo = remoteRepo.parent();</span>
<span class="line-removed"> 342             targetRepo = parentRepo.isPresent() ? parentRepo.get() : remoteRepo;</span>
<span class="line-removed"> 343         }</span>
<span class="line-removed"> 344 </span>
<span class="line-removed"> 345         return targetRepo;</span>
<span class="line-removed"> 346     }</span>
<span class="line-removed"> 347 </span>
<span class="line-removed"> 348     private static PullRequest getPullRequest(URI uri, ReadOnlyRepository repo, Forge host, String prId) throws IOException {</span>
<span class="line-removed"> 349         var pr = getHostedRepositoryFor(uri, repo, host).pullRequest(prId);</span>
<span class="line-removed"> 350         if (pr == null) {</span>
<span class="line-removed"> 351             exit(&quot;error: could not fetch PR information&quot;);</span>
<span class="line-removed"> 352         }</span>
<span class="line-removed"> 353 </span>
<span class="line-removed"> 354         return pr;</span>
<span class="line-removed"> 355     }</span>
<span class="line-removed"> 356 </span>
<span class="line-removed"> 357     private static void show(String ref, Hash hash) throws IOException {</span>
<span class="line-removed"> 358         show(ref, hash, null);</span>
<span class="line-removed"> 359     }</span>
<span class="line-removed"> 360     private static void show(String ref, Hash hash, Path dir) throws IOException {</span>
<span class="line-removed"> 361         var pb = new ProcessBuilder(&quot;git&quot;, &quot;diff&quot;, &quot;--binary&quot;,</span>
<span class="line-removed"> 362                                                    &quot;--patch&quot;,</span>
<span class="line-removed"> 363                                                    &quot;--find-renames=50%&quot;,</span>
<span class="line-removed"> 364                                                    &quot;--find-copies=50%&quot;,</span>
<span class="line-removed"> 365                                                    &quot;--find-copies-harder&quot;,</span>
<span class="line-removed"> 366                                                    &quot;--abbrev&quot;,</span>
<span class="line-removed"> 367                                                    ref + &quot;...&quot; + hash.hex());</span>
<span class="line-removed"> 368         if (dir != null) {</span>
<span class="line-removed"> 369             pb.directory(dir.toFile());</span>
<span class="line-removed"> 370         }</span>
<span class="line-removed"> 371         pb.inheritIO();</span>
<span class="line-removed"> 372 </span>
<span class="line-removed"> 373         // git will return 141 (128 + 13) when it receive SIGPIPE (signal 13) from</span>
<span class="line-removed"> 374         // e.g. less when a user exits less when looking at a large diff. Therefore</span>
<span class="line-removed"> 375         // must allow 141 as a valid exit code.</span>
<span class="line-removed"> 376         await(pb.start(), 141);</span>
<span class="line-removed"> 377     }</span>
<span class="line-removed"> 378 </span>
<span class="line-removed"> 379     private static Path diff(String ref, Hash hash) throws IOException {</span>
<span class="line-removed"> 380         return diff(ref, hash, null);</span>
<span class="line-removed"> 381     }</span>
<span class="line-removed"> 382 </span>
<span class="line-removed"> 383     private static Path diff(String ref, Hash hash, Path dir) throws IOException {</span>
<span class="line-removed"> 384         var patch = Files.createTempFile(hash.hex(), &quot;.patch&quot;);</span>
<span class="line-removed"> 385         var pb = new ProcessBuilder(&quot;git&quot;, &quot;diff&quot;, &quot;--binary&quot;,</span>
<span class="line-removed"> 386                                                    &quot;--patch&quot;,</span>
<span class="line-removed"> 387                                                    &quot;--find-renames=50%&quot;,</span>
<span class="line-removed"> 388                                                    &quot;--find-copies=50%&quot;,</span>
<span class="line-removed"> 389                                                    &quot;--find-copies-harder&quot;,</span>
<span class="line-removed"> 390                                                    &quot;--abbrev&quot;,</span>
<span class="line-removed"> 391                                                    ref + &quot;...&quot; + hash.hex());</span>
<span class="line-removed"> 392         if (dir != null) {</span>
<span class="line-removed"> 393             pb.directory(dir.toFile());</span>
<span class="line-removed"> 394         }</span>
<span class="line-removed"> 395         pb.redirectOutput(patch.toFile());</span>
<span class="line-removed"> 396         pb.redirectError(ProcessBuilder.Redirect.INHERIT);</span>
<span class="line-removed"> 397         await(pb.start());</span>
<span class="line-removed"> 398         return patch;</span>
<span class="line-removed"> 399     }</span>
<span class="line-removed"> 400 </span>
<span class="line-removed"> 401     private static void apply(Path patch) throws IOException {</span>
<span class="line-removed"> 402         var pb = new ProcessBuilder(&quot;git&quot;, &quot;apply&quot;, &quot;--no-commit&quot;, patch.toString());</span>
<span class="line-removed"> 403         pb.inheritIO();</span>
<span class="line-removed"> 404         await(pb.start());</span>
<span class="line-removed"> 405     }</span>
<span class="line-removed"> 406 </span>
<span class="line-removed"> 407     private static int longest(List&lt;String&gt; strings) {</span>
<span class="line-removed"> 408         return strings.stream().mapToInt(String::length).max().orElse(0);</span>
<span class="line-removed"> 409     }</span>
<span class="line-removed"> 410 </span>
<span class="line-removed"> 411     private static String removeTrailing(String s, String trail) {</span>
<span class="line-removed"> 412         return s.endsWith(trail) ?</span>
<span class="line-removed"> 413             s.substring(0, s.length() - trail.length()) :</span>
<span class="line-removed"> 414             s;</span>
<span class="line-removed"> 415     }</span>
<span class="line-removed"> 416 </span>
<span class="line-removed"> 417     private static Repository getRepo() throws IOException {</span>
<span class="line-removed"> 418         var cwd = Path.of(&quot;&quot;).toAbsolutePath();</span>
<span class="line-removed"> 419         return Repository.get(cwd).orElseThrow(() -&gt; new IOException(&quot;no git repository found at &quot; + cwd.toString()));</span>
<span class="line-removed"> 420     }</span>
<span class="line-removed"> 421 </span>
<span class="line-removed"> 422     private static Arguments parse(ArgumentParser parser, String[] args) {</span>
<span class="line-removed"> 423         var arguments = parser.parse(args);</span>
<span class="line-removed"> 424         if (arguments.contains(&quot;version&quot;)) {</span>
<span class="line-removed"> 425             System.out.println(&quot;git-pr version: &quot; + Version.fromManifest().orElse(&quot;unknown&quot;));</span>
<span class="line-removed"> 426             System.exit(0);</span>
<span class="line-removed"> 427         }</span>
<span class="line-removed"> 428         if (arguments.contains(&quot;verbose&quot;) || arguments.contains(&quot;debug&quot;)) {</span>
<span class="line-removed"> 429             var level = arguments.contains(&quot;debug&quot;) ? Level.FINER : Level.FINE;</span>
<span class="line-removed"> 430             Logging.setup(level);</span>
<span class="line-removed"> 431         }</span>
<span class="line-removed"> 432         return arguments;</span>
<span class="line-removed"> 433     }</span>
<span class="line-removed"> 434 </span>
<span class="line-removed"> 435     private static String getRemote(ReadOnlyRepository repo, Arguments arguments) throws IOException {</span>
<span class="line-removed"> 436         var remote = getOption(&quot;remote&quot;, arguments);</span>
<span class="line-removed"> 437         return remote == null ? &quot;origin&quot; : remote;</span>
<span class="line-removed"> 438     }</span>
<span class="line-removed"> 439 </span>
<span class="line-removed"> 440     private static URI getURI(ReadOnlyRepository repo, Arguments arguments) throws IOException {</span>
<span class="line-removed"> 441         var remotePullPath = repo.pullPath(getRemote(repo, arguments));</span>
<span class="line-removed"> 442         return Remote.toWebURI(remotePullPath);</span>
<span class="line-removed"> 443     }</span>
<span class="line-removed"> 444 </span>
<span class="line-removed"> 445     private static Forge getForge(URI uri, ReadOnlyRepository repo, Arguments arguments) throws IOException {</span>
<span class="line-removed"> 446         var username = getOption(&quot;username&quot;, arguments);</span>
<span class="line-removed"> 447         var token = System.getenv(&quot;GIT_TOKEN&quot;);</span>
<span class="line-removed"> 448         var shouldUseToken = !getSwitch(&quot;no-token&quot;, arguments);</span>
<span class="line-removed"> 449         var credentials = !shouldUseToken ?</span>
<span class="line-removed"> 450             null :</span>
<span class="line-removed"> 451             GitCredentials.fill(uri.getHost(), uri.getPath(), username, token, uri.getScheme());</span>
<span class="line-removed"> 452         var forgeURI = URI.create(uri.getScheme() + &quot;://&quot; + uri.getHost());</span>
<span class="line-removed"> 453         var forge = credentials == null ?</span>
<span class="line-removed"> 454             Forge.from(forgeURI) :</span>
<span class="line-removed"> 455             Forge.from(forgeURI, new Credential(credentials.username(), credentials.password()));</span>
<span class="line-removed"> 456         if (forge.isEmpty()) {</span>
<span class="line-removed"> 457             if (!shouldUseToken) {</span>
<span class="line-removed"> 458                 if (arguments.contains(&quot;verbose&quot;)) {</span>
<span class="line-removed"> 459                     System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 460                 }</span>
<span class="line-removed"> 461                 System.err.println(&quot;warning: using git-pr with --no-token may result in rate limiting from &quot; + forgeURI);</span>
<span class="line-removed"> 462                 if (!arguments.contains(&quot;verbose&quot;)) {</span>
<span class="line-removed"> 463                     System.err.println(&quot;         Re-run git-pr with --verbose to see if you are being rate limited&quot;);</span>
<span class="line-removed"> 464                     System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 465                 }</span>
<span class="line-removed"> 466             }</span>
<span class="line-removed"> 467             exit(&quot;error: failed to connect to host: &quot; + forgeURI);</span>
<span class="line-removed"> 468         }</span>
<span class="line-removed"> 469         return forge.get();</span>
<span class="line-removed"> 470     }</span>
<span class="line-removed"> 471 </span>
<span class="line-removed"> 472     private static void create(String[] args) throws IOException, InterruptedException {</span>
<span class="line-removed"> 473         var flags = List.of(</span>
<span class="line-removed"> 474             Option.shortcut(&quot;u&quot;)</span>
<span class="line-removed"> 475                   .fullname(&quot;username&quot;)</span>
<span class="line-removed"> 476                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed"> 477                   .helptext(&quot;Username on host&quot;)</span>
<span class="line-removed"> 478                   .optional(),</span>
<span class="line-removed"> 479             Option.shortcut(&quot;r&quot;)</span>
<span class="line-removed"> 480                   .fullname(&quot;remote&quot;)</span>
<span class="line-removed"> 481                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed"> 482                   .helptext(&quot;Name of remote, defaults to &#39;origin&#39;&quot;)</span>
<span class="line-removed"> 483                   .optional(),</span>
<span class="line-removed"> 484             Option.shortcut(&quot;b&quot;)</span>
<span class="line-removed"> 485                   .fullname(&quot;branch&quot;)</span>
<span class="line-removed"> 486                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed"> 487                   .helptext(&quot;Name of target branch, defaults to &#39;master&#39;&quot;)</span>
<span class="line-removed"> 488                   .optional(),</span>
<span class="line-removed"> 489             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed"> 490                   .fullname(&quot;ignore-workspace&quot;)</span>
<span class="line-removed"> 491                   .helptext(&quot;Ignore local changes in worktree and staging area when creating pull request&quot;)</span>
<span class="line-removed"> 492                   .optional(),</span>
<span class="line-removed"> 493             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed"> 494                   .fullname(&quot;ignore-local-commits&quot;)</span>
<span class="line-removed"> 495                   .helptext(&quot;Ignore local commits not pushed when creating pull request&quot;)</span>
<span class="line-removed"> 496                   .optional(),</span>
<span class="line-removed"> 497             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed"> 498                   .fullname(&quot;publish&quot;)</span>
<span class="line-removed"> 499                   .helptext(&quot;Publish the local branch before creating the pull request&quot;)</span>
<span class="line-removed"> 500                   .optional(),</span>
<span class="line-removed"> 501             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed"> 502                   .fullname(&quot;jcheck&quot;)</span>
<span class="line-removed"> 503                   .helptext(&quot;Run jcheck before creating the pull request&quot;)</span>
<span class="line-removed"> 504                   .optional(),</span>
<span class="line-removed"> 505             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed"> 506                   .fullname(&quot;verbose&quot;)</span>
<span class="line-removed"> 507                   .helptext(&quot;Turn on verbose output&quot;)</span>
<span class="line-removed"> 508                   .optional(),</span>
<span class="line-removed"> 509             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed"> 510                   .fullname(&quot;debug&quot;)</span>
<span class="line-removed"> 511                   .helptext(&quot;Turn on debugging output&quot;)</span>
<span class="line-removed"> 512                   .optional(),</span>
<span class="line-removed"> 513             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed"> 514                   .fullname(&quot;version&quot;)</span>
<span class="line-removed"> 515                   .helptext(&quot;Print the version of this tool&quot;)</span>
<span class="line-removed"> 516                   .optional()</span>
<span class="line-removed"> 517         );</span>
<span class="line-removed"> 518 </span>
<span class="line-removed"> 519         var inputs = List.of(</span>
<span class="line-removed"> 520             Input.position(0)</span>
<span class="line-removed"> 521                  .describe(&quot;ID&quot;)</span>
<span class="line-removed"> 522                  .singular()</span>
<span class="line-removed"> 523                  .optional()</span>
<span class="line-removed"> 524         );</span>
<span class="line-removed"> 525 </span>
<span class="line-removed"> 526         var parser = new ArgumentParser(&quot;git-pr&quot;, flags, inputs);</span>
<span class="line-removed"> 527         var arguments = parse(parser, args);</span>
<span class="line-removed"> 528         var repo = getRepo();</span>
<span class="line-removed"> 529         var uri = getURI(repo, arguments);</span>
<span class="line-removed"> 530         var host = getForge(uri, repo, arguments);</span>
<span class="line-removed"> 531         var remote = getRemote(repo, arguments);</span>
<span class="line-removed"> 532         var currentBranch = repo.currentBranch().orElseGet(() -&gt; {</span>
<span class="line-removed"> 533                 System.err.println(&quot;error: the repository is in a detached HEAD state&quot;);</span>
<span class="line-removed"> 534                 System.exit(1);</span>
<span class="line-removed"> 535                 return null;</span>
<span class="line-removed"> 536         });</span>
<span class="line-removed"> 537         if (currentBranch.equals(repo.defaultBranch())) {</span>
<span class="line-removed"> 538             System.err.println(&quot;error: you should not create pull requests from the &#39;master&#39; branch&quot;);</span>
<span class="line-removed"> 539             System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 540             System.err.println(&quot;To create a local branch for your changes and restore the &#39;master&#39; branch, run:&quot;);</span>
<span class="line-removed"> 541             System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 542             System.err.println(&quot;    git checkout -b NAME-FOR-YOUR-LOCAL-BRANCH&quot;);</span>
<span class="line-removed"> 543             System.err.println(&quot;    git branch --force master origin/master&quot;);</span>
<span class="line-removed"> 544             System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 545             System.exit(1);</span>
<span class="line-removed"> 546         }</span>
<span class="line-removed"> 547 </span>
<span class="line-removed"> 548         var ignoreWorkspace = getSwitch(&quot;ignore-workspace&quot;, &quot;create&quot;, arguments);</span>
<span class="line-removed"> 549         if (!ignoreWorkspace) {</span>
<span class="line-removed"> 550             var diff = repo.diff(repo.head());</span>
<span class="line-removed"> 551             if (!diff.patches().isEmpty()) {</span>
<span class="line-removed"> 552                 System.err.println(&quot;error: there are uncommitted changes in your working tree:&quot;);</span>
<span class="line-removed"> 553                 System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 554                 for (var patch : diff.patches()) {</span>
<span class="line-removed"> 555                     var path = patch.target().path().isPresent() ?</span>
<span class="line-removed"> 556                         patch.target().path().get() : patch.source().path().get();</span>
<span class="line-removed"> 557                     System.err.println(&quot;    &quot; + patch.status().toString() + &quot; &quot; + path.toString());</span>
<span class="line-removed"> 558                 }</span>
<span class="line-removed"> 559                 System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 560                 System.err.println(&quot;If these changes are meant to be part of the pull request, run:&quot;);</span>
<span class="line-removed"> 561                 System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 562                 System.err.println(&quot;    git commit -am &#39;Forgot to add some changes&#39;&quot;);</span>
<span class="line-removed"> 563                 System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 564                 System.err.println(&quot;If these changes are *not* meant to be part of the pull request, run:&quot;);</span>
<span class="line-removed"> 565                 System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 566                 System.err.println(&quot;    git stash&quot;);</span>
<span class="line-removed"> 567                 System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 568                 System.err.println(&quot;(You can later restore the changes by running: git stash pop)&quot;);</span>
<span class="line-removed"> 569                 System.exit(1);</span>
<span class="line-removed"> 570             }</span>
<span class="line-removed"> 571         }</span>
<span class="line-removed"> 572 </span>
<span class="line-removed"> 573         var upstream = repo.upstreamFor(currentBranch);</span>
<span class="line-removed"> 574         if (upstream.isEmpty()) {</span>
<span class="line-removed"> 575             var shouldPublish = getSwitch(&quot;publish&quot;, &quot;create&quot;, arguments);</span>
<span class="line-removed"> 576             if (shouldPublish) {</span>
<span class="line-removed"> 577                 GitPublish.main(new String[] { &quot;--quiet&quot;, remote });</span>
<span class="line-removed"> 578                 upstream = repo.upstreamFor(currentBranch);</span>
<span class="line-removed"> 579             } else {</span>
<span class="line-removed"> 580                 System.err.println(&quot;error: there is no remote branch for the local branch &#39;&quot; + currentBranch.name() + &quot;&#39;&quot;);</span>
<span class="line-removed"> 581                 System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 582                 System.err.println(&quot;A remote branch must be present at &quot; + uri + &quot; to create a pull request&quot;);</span>
<span class="line-removed"> 583                 System.err.println(&quot;To create a remote branch and push the commits for your local branch, run:&quot;);</span>
<span class="line-removed"> 584                 System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 585                 System.err.println(&quot;    git publish&quot;);</span>
<span class="line-removed"> 586                 System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 587                 System.err.println(&quot;If you created the remote branch from another client, you must update this repository.&quot;);</span>
<span class="line-removed"> 588                 System.err.println(&quot;To update remote information for this repository, run:&quot;);</span>
<span class="line-removed"> 589                 System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 590                 System.err.println(&quot;    git fetch &quot; + remote);</span>
<span class="line-removed"> 591                 System.err.println(&quot;    git branch --set-upstream &quot; + currentBranch + &quot; &quot; + remote + &quot;/&quot; + currentBranch);</span>
<span class="line-removed"> 592                 System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 593                 System.exit(1);</span>
<span class="line-removed"> 594             }</span>
<span class="line-removed"> 595         }</span>
<span class="line-removed"> 596 </span>
<span class="line-removed"> 597         var upstreamRefName = upstream.get().substring(remote.length() + 1);</span>
<span class="line-removed"> 598         repo.fetch(uri, upstreamRefName);</span>
<span class="line-removed"> 599 </span>
<span class="line-removed"> 600         var shouldIgnoreLocalCommits = getSwitch(&quot;ignore-local-commits&quot;, &quot;create&quot;, arguments);</span>
<span class="line-removed"> 601         if (!shouldIgnoreLocalCommits) {</span>
<span class="line-removed"> 602             var branchCommits = repo.commits(upstream.get() + &quot;..&quot; + currentBranch.name()).asList();</span>
<span class="line-removed"> 603             if (!branchCommits.isEmpty()) {</span>
<span class="line-removed"> 604                 System.err.println(&quot;error: there are local commits on branch &#39;&quot; + currentBranch.name() + &quot;&#39; not present in the remote repository &quot; + uri);</span>
<span class="line-removed"> 605                 System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 606                 System.err.println(&quot;All commits must be present in the remote repository to be part of the pull request&quot;);</span>
<span class="line-removed"> 607                 System.err.println(&quot;The following commits are not present in the remote repository:&quot;);</span>
<span class="line-removed"> 608                 System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 609                 for (var commit : branchCommits) {</span>
<span class="line-removed"> 610                     System.err.println(&quot;- &quot; + commit.hash().abbreviate() + &quot;: &quot; + commit.message().get(0));</span>
<span class="line-removed"> 611                 }</span>
<span class="line-removed"> 612                 System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 613                 System.err.println(&quot;To push the above local commits to the remote repository, run:&quot;);</span>
<span class="line-removed"> 614                 System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 615                 System.err.println(&quot;    git push &quot; + remote + &quot; &quot; + currentBranch.name());</span>
<span class="line-removed"> 616                 System.err.println(&quot;&quot;);</span>
<span class="line-removed"> 617                 System.exit(1);</span>
<span class="line-removed"> 618             }</span>
<span class="line-removed"> 619         }</span>
<span class="line-removed"> 620 </span>
<span class="line-removed"> 621         var remoteRepo = host.repository(projectName(uri)).orElseThrow(() -&gt;</span>
<span class="line-removed"> 622                 new IOException(&quot;Could not find repository at &quot; + uri.toString())</span>
<span class="line-removed"> 623         );</span>
<span class="line-removed"> 624         var parentRepo = remoteRepo.parent().orElseThrow(() -&gt;</span>
<span class="line-removed"> 625                 new IOException(&quot;error: remote repository &quot; + uri + &quot; is not a fork of any repository&quot;)</span>
<span class="line-removed"> 626         );</span>
<span class="line-removed"> 627 </span>
<span class="line-removed"> 628         var targetBranch = getOption(&quot;branch&quot;, &quot;create&quot;, arguments);</span>
<span class="line-removed"> 629         if (targetBranch == null) {</span>
<span class="line-removed"> 630             var upstreamBranchNames = repo.remoteBranches(parentRepo.webUrl().toString())</span>
<span class="line-removed"> 631                                           .stream()</span>
<span class="line-removed"> 632                                           .map(r -&gt; r.name())</span>
<span class="line-removed"> 633                                           .collect(Collectors.toSet());</span>
<span class="line-removed"> 634             var remoteBranches = repo.branches(remote);</span>
<span class="line-removed"> 635             var candidates = new ArrayList&lt;Branch&gt;();</span>
<span class="line-removed"> 636             for (var b : remoteBranches) {</span>
<span class="line-removed"> 637                 var withoutRemotePrefix = b.name().substring(remote.length() + 1);</span>
<span class="line-removed"> 638                 if (upstreamBranchNames.contains(withoutRemotePrefix)) {</span>
<span class="line-removed"> 639                     candidates.add(b);</span>
<span class="line-removed"> 640                 }</span>
<span class="line-removed"> 641             }</span>
<span class="line-removed"> 642 </span>
<span class="line-removed"> 643             var localBranches = repo.branches();</span>
<span class="line-removed"> 644             Branch closest = null;</span>
<span class="line-removed"> 645             var shortestDistance = Integer.MAX_VALUE;</span>
<span class="line-removed"> 646             for (var b : candidates) {</span>
<span class="line-removed"> 647                 var from = b.name();</span>
<span class="line-removed"> 648                 for (var localBranch : localBranches) {</span>
<span class="line-removed"> 649                     var trackingBranch = repo.upstreamFor(localBranch);</span>
<span class="line-removed"> 650                     if (trackingBranch.isPresent() &amp;&amp;</span>
<span class="line-removed"> 651                         trackingBranch.get().equals(b.name())) {</span>
<span class="line-removed"> 652                         from = localBranch.name();</span>
<span class="line-removed"> 653                     }</span>
<span class="line-removed"> 654                 }</span>
<span class="line-removed"> 655                 var distance = repo.commitMetadata(from + &quot;...&quot; + currentBranch.name()).size();</span>
<span class="line-removed"> 656                 if (distance &lt; shortestDistance) {</span>
<span class="line-removed"> 657                     closest = b;</span>
<span class="line-removed"> 658                     shortestDistance = distance;</span>
<span class="line-removed"> 659                 }</span>
<span class="line-removed"> 660             }</span>
<span class="line-removed"> 661 </span>
<span class="line-removed"> 662             if (closest != null) {</span>
<span class="line-removed"> 663                 targetBranch = closest.name().substring(remote.length() + 1);</span>
<span class="line-removed"> 664             } else {</span>
<span class="line-removed"> 665                 System.err.println(&quot;error: cannot automatically infer target branch&quot;);</span>
<span class="line-removed"> 666                 System.err.println(&quot;       use --branch to specify target branch&quot;);</span>
<span class="line-removed"> 667                 System.exit(1);</span>
<span class="line-removed"> 668             }</span>
<span class="line-removed"> 669         }</span>
<span class="line-removed"> 670         var commits = repo.commits(targetBranch + &quot;..&quot; + upstream.get()).asList();</span>
<span class="line-removed"> 671         if (commits.isEmpty()) {</span>
<span class="line-removed"> 672             System.err.println(&quot;error: no difference between branches &quot; + targetBranch + &quot; and &quot; + currentBranch.name());</span>
<span class="line-removed"> 673             System.err.println(&quot;       Cannot create an empty pull request, have you committed?&quot;);</span>
<span class="line-removed"> 674             System.exit(1);</span>
<span class="line-removed"> 675         }</span>
<span class="line-removed"> 676 </span>
<span class="line-removed"> 677         var shouldRunJCheck = getSwitch(&quot;jcheck&quot;, &quot;create&quot;, arguments);</span>
<span class="line-removed"> 678         if (shouldRunJCheck) {</span>
<span class="line-removed"> 679             var jcheckArgs = new String[]{ &quot;--pull-request&quot;, &quot;--rev&quot;, targetBranch + &quot;..&quot; + upstream.get() };</span>
<span class="line-removed"> 680             var err = GitJCheck.run(jcheckArgs);</span>
<span class="line-removed"> 681             if (err != 0) {</span>
<span class="line-removed"> 682                 System.exit(err);</span>
<span class="line-removed"> 683             }</span>
<span class="line-removed"> 684         }</span>
<span class="line-removed"> 685 </span>
<span class="line-removed"> 686         var project = jbsProjectFromJcheckConf(repo, targetBranch);</span>
<span class="line-removed"> 687         var issue = getIssue(currentBranch, project);</span>
<span class="line-removed"> 688         var file = Files.createTempFile(&quot;PULL_REQUEST_&quot;, &quot;.md&quot;);</span>
<span class="line-removed"> 689         if (issue.isPresent()) {</span>
<span class="line-removed"> 690             Files.writeString(file, format(issue.get()) + &quot;\n\n&quot;);</span>
<span class="line-removed"> 691         } else if (commits.size() == 1) {</span>
<span class="line-removed"> 692             var commit = commits.get(0);</span>
<span class="line-removed"> 693             issue = getIssue(commit, project);</span>
<span class="line-removed"> 694             if (issue.isPresent()) {</span>
<span class="line-removed"> 695                 Files.writeString(file, format(issue.get()) + &quot;\n\n&quot;);</span>
<span class="line-removed"> 696             } else {</span>
<span class="line-removed"> 697                 var message = CommitMessageParsers.v1.parse(commit.message());</span>
<span class="line-removed"> 698                 Files.writeString(file, message.title() + &quot;\n&quot;);</span>
<span class="line-removed"> 699                 if (!message.summaries().isEmpty()) {</span>
<span class="line-removed"> 700                     Files.write(file, message.summaries(), StandardOpenOption.APPEND);</span>
<span class="line-removed"> 701                 }</span>
<span class="line-removed"> 702                 if (!message.additional().isEmpty()) {</span>
<span class="line-removed"> 703                     Files.write(file, message.additional(), StandardOpenOption.APPEND);</span>
<span class="line-removed"> 704                 }</span>
<span class="line-removed"> 705             }</span>
<span class="line-removed"> 706         } else {</span>
<span class="line-removed"> 707             Files.write(file, List.of(&quot;&quot;));</span>
<span class="line-removed"> 708         }</span>
<span class="line-removed"> 709 </span>
<span class="line-removed"> 710         appendPaddedHTMLComment(file, &quot;Please enter the pull request message for your changes.&quot;);</span>
<span class="line-removed"> 711         appendPaddedHTMLComment(file, &quot;The first line will be considered the subject, use a blank line to&quot;);</span>
<span class="line-removed"> 712         appendPaddedHTMLComment(file, &quot;separate the subject from the body. These HTML comment lines will&quot;);</span>
<span class="line-removed"> 713         appendPaddedHTMLComment(file, &quot;be removed automatically. An empty message aborts the pull request.&quot;);</span>
<span class="line-removed"> 714         appendPaddedHTMLComment(file, &quot;&quot;);</span>
<span class="line-removed"> 715         appendPaddedHTMLComment(file, &quot;Commits to be included from branch &#39;&quot; + currentBranch.name() + &quot;&#39;:&quot;);</span>
<span class="line-removed"> 716         for (var commit : commits) {</span>
<span class="line-removed"> 717             var desc = commit.hash().abbreviate() + &quot;: &quot; + commit.message().get(0);</span>
<span class="line-removed"> 718             appendPaddedHTMLComment(file, &quot;- &quot; + desc);</span>
<span class="line-removed"> 719             if (!commit.isMerge()) {</span>
<span class="line-removed"> 720                 var diff = commit.parentDiffs().get(0);</span>
<span class="line-removed"> 721                 for (var patch : diff.patches()) {</span>
<span class="line-removed"> 722                     var status = patch.status();</span>
<span class="line-removed"> 723                     if (status.isModified()) {</span>
<span class="line-removed"> 724                         appendPaddedHTMLComment(file, &quot;  M  &quot; + patch.target().path().get().toString());</span>
<span class="line-removed"> 725                     } else if (status.isAdded()) {</span>
<span class="line-removed"> 726                         appendPaddedHTMLComment(file, &quot;  A  &quot; + patch.target().path().get().toString());</span>
<span class="line-removed"> 727                     } else if (status.isDeleted()) {</span>
<span class="line-removed"> 728                         appendPaddedHTMLComment(file, &quot;  D  &quot; + patch.source().path().get().toString());</span>
<span class="line-removed"> 729                     } else if (status.isRenamed()) {</span>
<span class="line-removed"> 730                         appendPaddedHTMLComment(file, &quot;  R  &quot; + patch.target().path().get().toString());</span>
<span class="line-removed"> 731                         appendPaddedHTMLComment(file, &quot;      (&quot; + patch.source().path().get().toString() + &quot;)&quot;);</span>
<span class="line-removed"> 732                     } else if (status.isCopied()) {</span>
<span class="line-removed"> 733                         appendPaddedHTMLComment(file, &quot;  C  &quot; + patch.target().path().get().toString());</span>
<span class="line-removed"> 734                         appendPaddedHTMLComment(file, &quot;      (&quot; + patch.source().path().get().toString() + &quot;)&quot;);</span>
<span class="line-removed"> 735                     }</span>
<span class="line-removed"> 736                 }</span>
<span class="line-removed"> 737             }</span>
<span class="line-removed"> 738         }</span>
<span class="line-removed"> 739         appendPaddedHTMLComment(file, &quot;&quot;);</span>
<span class="line-removed"> 740         if (issue.isPresent()) {</span>
<span class="line-removed"> 741             appendPaddedHTMLComment(file, &quot;Issue:      &quot; + issue.get().webUrl());</span>
<span class="line-removed"> 742         }</span>
<span class="line-removed"> 743         appendPaddedHTMLComment(file, &quot;Repository: &quot; + parentRepo.webUrl());</span>
<span class="line-removed"> 744         appendPaddedHTMLComment(file, &quot;Branch:     &quot; + targetBranch);</span>
<span class="line-removed"> 745 </span>
<span class="line-removed"> 746         var success = spawnEditor(repo, file);</span>
<span class="line-removed"> 747         if (!success) {</span>
<span class="line-removed"> 748             System.err.println(&quot;error: editor exited with non-zero status code, aborting&quot;);</span>
<span class="line-removed"> 749             System.exit(1);</span>
<span class="line-removed"> 750         }</span>
<span class="line-removed"> 751         var lines = Files.readAllLines(file)</span>
<span class="line-removed"> 752                          .stream()</span>
<span class="line-removed"> 753                          .filter(l -&gt; !(l.startsWith(&quot;&lt;!--&quot;) &amp;&amp; l.endsWith(&quot;--&gt;&quot;)))</span>
<span class="line-removed"> 754                          .collect(Collectors.toList());</span>
<span class="line-removed"> 755         var isEmpty = lines.stream().allMatch(String::isEmpty);</span>
<span class="line-removed"> 756         if (isEmpty) {</span>
<span class="line-removed"> 757             System.err.println(&quot;error: no message present, aborting&quot;);</span>
<span class="line-removed"> 758             System.exit(1);</span>
<span class="line-removed"> 759         }</span>
<span class="line-removed"> 760 </span>
<span class="line-removed"> 761         var title = lines.get(0);</span>
<span class="line-removed"> 762         List&lt;String&gt; body = null;</span>
<span class="line-removed"> 763         if (lines.size() &gt; 1) {</span>
<span class="line-removed"> 764             body = lines.subList(1, lines.size())</span>
<span class="line-removed"> 765                         .stream()</span>
<span class="line-removed"> 766                         .dropWhile(String::isEmpty)</span>
<span class="line-removed"> 767                         .collect(Collectors.toList());</span>
<span class="line-removed"> 768         } else {</span>
<span class="line-removed"> 769             body = Collections.emptyList();</span>
<span class="line-removed"> 770         }</span>
<span class="line-removed"> 771 </span>
<span class="line-removed"> 772         var pr = remoteRepo.createPullRequest(parentRepo, targetBranch, currentBranch.name(), title, body);</span>
<span class="line-removed"> 773         var assigneesOption = getOption(&quot;assignees&quot;, &quot;create&quot;, arguments);</span>
<span class="line-removed"> 774         if (assigneesOption != null) {</span>
<span class="line-removed"> 775             var usernames = Arrays.asList(assigneesOption.split(&quot;,&quot;));</span>
<span class="line-removed"> 776             var assignees = usernames.stream()</span>
<span class="line-removed"> 777                                      .map(u -&gt; host.user(u))</span>
<span class="line-removed"> 778                                      .filter(Optional::isPresent)</span>
<span class="line-removed"> 779                                      .map(Optional::get)</span>
<span class="line-removed"> 780                                      .collect(Collectors.toList());</span>
<span class="line-removed"> 781             pr.setAssignees(assignees);</span>
<span class="line-removed"> 782         }</span>
<span class="line-removed"> 783         System.out.println(pr.webUrl().toString());</span>
<span class="line-removed"> 784         Files.deleteIfExists(file);</span>
<span class="line-removed"> 785 </span>
<span class="line-removed"> 786         repo.config(&quot;pr.&quot; + currentBranch.name(), &quot;id&quot;, pr.id().toString());</span>
<span class="line-removed"> 787     }</span>
<span class="line-removed"> 788 </span>
<span class="line-removed"> 789     private static void integrate(String[] args) throws IOException, InterruptedException {</span>
<span class="line-removed"> 790         var flags = List.of(</span>
<span class="line-removed"> 791             Option.shortcut(&quot;u&quot;)</span>
<span class="line-removed"> 792                   .fullname(&quot;username&quot;)</span>
<span class="line-removed"> 793                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed"> 794                   .helptext(&quot;Username on host&quot;)</span>
<span class="line-removed"> 795                   .optional(),</span>
<span class="line-removed"> 796             Option.shortcut(&quot;r&quot;)</span>
<span class="line-removed"> 797                   .fullname(&quot;remote&quot;)</span>
<span class="line-removed"> 798                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed"> 799                   .helptext(&quot;Name of remote, defaults to &#39;origin&#39;&quot;)</span>
<span class="line-removed"> 800                   .optional(),</span>
<span class="line-removed"> 801             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed"> 802                   .fullname(&quot;atomic&quot;)</span>
<span class="line-removed"> 803                   .helptext(&quot;Integrate the pull request atomically&quot;)</span>
<span class="line-removed"> 804                   .optional(),</span>
<span class="line-removed"> 805             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed"> 806                   .fullname(&quot;verbose&quot;)</span>
<span class="line-removed"> 807                   .helptext(&quot;Turn on verbose output&quot;)</span>
<span class="line-removed"> 808                   .optional(),</span>
<span class="line-removed"> 809             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed"> 810                   .fullname(&quot;debug&quot;)</span>
<span class="line-removed"> 811                   .helptext(&quot;Turn on debugging output&quot;)</span>
<span class="line-removed"> 812                   .optional(),</span>
<span class="line-removed"> 813             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed"> 814                   .fullname(&quot;version&quot;)</span>
<span class="line-removed"> 815                   .helptext(&quot;Print the version of this tool&quot;)</span>
<span class="line-removed"> 816                   .optional()</span>
<span class="line-removed"> 817         );</span>
<span class="line-removed"> 818 </span>
<span class="line-removed"> 819         var inputs = List.of(</span>
<span class="line-removed"> 820             Input.position(0)</span>
<span class="line-removed"> 821                  .describe(&quot;ID&quot;)</span>
<span class="line-removed"> 822                  .singular()</span>
<span class="line-removed"> 823                  .optional()</span>
<span class="line-removed"> 824         );</span>
<span class="line-removed"> 825 </span>
<span class="line-removed"> 826         var parser = new ArgumentParser(&quot;git-pr&quot;, flags, inputs);</span>
<span class="line-removed"> 827         var arguments = parse(parser, args);</span>
<span class="line-removed"> 828         var repo = getRepo();</span>
<span class="line-removed"> 829         var uri = getURI(repo, arguments);</span>
<span class="line-removed"> 830         var host = getForge(uri, repo, arguments);</span>
<span class="line-removed"> 831         var id = pullRequestIdArgument(repo, arguments);</span>
<span class="line-removed"> 832         var pr = getPullRequest(uri, repo, host, id);</span>
<span class="line-removed"> 833         var isAtomic = getSwitch(&quot;atomic&quot;, &quot;integrate&quot;, arguments);</span>
<span class="line-removed"> 834 </span>
<span class="line-removed"> 835         var message = &quot;/integrate&quot;;</span>
<span class="line-removed"> 836         if (isAtomic) {</span>
<span class="line-removed"> 837             var targetHash = repo.resolve(pr.targetRef());</span>
<span class="line-removed"> 838             if (!targetHash.isPresent()) {</span>
<span class="line-removed"> 839                 exit(&quot;error: cannot resolve target branch &quot; + pr.targetRef());</span>
<span class="line-removed"> 840             }</span>
<span class="line-removed"> 841             var sourceHash = repo.fetch(pr.repository().webUrl(), pr.fetchRef());</span>
<span class="line-removed"> 842             var mergeBase = repo.mergeBase(sourceHash, targetHash.get());</span>
<span class="line-removed"> 843             message += &quot; &quot; + mergeBase.hex();</span>
<span class="line-removed"> 844         }</span>
<span class="line-removed"> 845 </span>
<span class="line-removed"> 846         var integrateComment = pr.addComment(message);</span>
<span class="line-removed"> 847 </span>
<span class="line-removed"> 848         var seenIntegrateComment = false;</span>
<span class="line-removed"> 849         var expected = &quot;&lt;!-- Jmerge command reply message (&quot; + integrateComment.id() + &quot;) --&gt;&quot;;</span>
<span class="line-removed"> 850         for (var i = 0; i &lt; 90; i++) {</span>
<span class="line-removed"> 851             var comments = pr.comments();</span>
<span class="line-removed"> 852             for (var comment : comments) {</span>
<span class="line-removed"> 853                 if (!seenIntegrateComment) {</span>
<span class="line-removed"> 854                     if (comment.id().equals(integrateComment.id())) {</span>
<span class="line-removed"> 855                         seenIntegrateComment = true;</span>
<span class="line-removed"> 856                     }</span>
<span class="line-removed"> 857                     continue;</span>
<span class="line-removed"> 858                 }</span>
<span class="line-removed"> 859                 var lines = comment.body().split(&quot;\n&quot;);</span>
<span class="line-removed"> 860                 if (lines.length &gt; 0 &amp;&amp; lines[0].equals(expected)) {</span>
<span class="line-removed"> 861                     for (var line : lines) {</span>
<span class="line-removed"> 862                         if (line.startsWith(&quot;Pushed as commit&quot;)) {</span>
<span class="line-removed"> 863                             var output = removeTrailing(line, &quot;.&quot;);</span>
<span class="line-removed"> 864                             System.out.println(output);</span>
<span class="line-removed"> 865                             System.exit(0);</span>
<span class="line-removed"> 866                         }</span>
<span class="line-removed"> 867                     }</span>
<span class="line-removed"> 868                 }</span>
<span class="line-removed"> 869             }</span>
<span class="line-removed"> 870 </span>
<span class="line-removed"> 871             Thread.sleep(2000);</span>
<span class="line-removed"> 872         }</span>
<span class="line-removed"> 873 </span>
<span class="line-removed"> 874         System.err.println(&quot;error: timed out waiting for response to /integrate command&quot;);</span>
<span class="line-removed"> 875         System.exit(1);</span>
<span class="line-removed"> 876     }</span>
<span class="line-removed"> 877 </span>
<span class="line-removed"> 878     private static void test(String[] args) throws IOException, InterruptedException {</span>
<span class="line-removed"> 879         var flags = List.of(</span>
<span class="line-removed"> 880             Option.shortcut(&quot;u&quot;)</span>
<span class="line-removed"> 881                   .fullname(&quot;username&quot;)</span>
<span class="line-removed"> 882                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed"> 883                   .helptext(&quot;Username on host&quot;)</span>
<span class="line-removed"> 884                   .optional(),</span>
<span class="line-removed"> 885             Option.shortcut(&quot;r&quot;)</span>
<span class="line-removed"> 886                   .fullname(&quot;remote&quot;)</span>
<span class="line-removed"> 887                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed"> 888                   .helptext(&quot;Name of remote, defaults to &#39;origin&#39;&quot;)</span>
<span class="line-removed"> 889                   .optional(),</span>
<span class="line-removed"> 890             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed"> 891                   .fullname(&quot;verbose&quot;)</span>
<span class="line-removed"> 892                   .helptext(&quot;Turn on verbose output&quot;)</span>
<span class="line-removed"> 893                   .optional(),</span>
<span class="line-removed"> 894             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed"> 895                   .fullname(&quot;debug&quot;)</span>
<span class="line-removed"> 896                   .helptext(&quot;Turn on debugging output&quot;)</span>
<span class="line-removed"> 897                   .optional(),</span>
<span class="line-removed"> 898             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed"> 899                   .fullname(&quot;version&quot;)</span>
<span class="line-removed"> 900                   .helptext(&quot;Print the version of this tool&quot;)</span>
<span class="line-removed"> 901                   .optional()</span>
<span class="line-removed"> 902         );</span>
<span class="line-removed"> 903 </span>
<span class="line-removed"> 904         var inputs = List.of(</span>
<span class="line-removed"> 905             Input.position(0)</span>
<span class="line-removed"> 906                  .describe(&quot;ID&quot;)</span>
<span class="line-removed"> 907                  .singular()</span>
<span class="line-removed"> 908                  .optional()</span>
<span class="line-removed"> 909         );</span>
<span class="line-removed"> 910         var parser = new ArgumentParser(&quot;git-pr&quot;, flags, inputs);</span>
<span class="line-removed"> 911         var arguments = parse(parser, args);</span>
<span class="line-removed"> 912         var repo = getRepo();</span>
<span class="line-removed"> 913         var uri = getURI(repo, arguments);</span>
<span class="line-removed"> 914         var host = getForge(uri, repo, arguments);</span>
<span class="line-removed"> 915         var id = pullRequestIdArgument(repo, arguments);</span>
<span class="line-removed"> 916         var pr = getPullRequest(uri, repo, host, id);</span>
<span class="line-removed"> 917         var head = pr.headHash();</span>
<span class="line-removed"> 918         var testComment = pr.addComment(&quot;/test&quot;);</span>
<span class="line-removed"> 919 </span>
<span class="line-removed"> 920         var seenTestComment = false;</span>
<span class="line-removed"> 921         for (var i = 0; i &lt; 90; i++) {</span>
<span class="line-removed"> 922             var comments = pr.comments();</span>
<span class="line-removed"> 923             for (var comment : comments) {</span>
<span class="line-removed"> 924                 if (!seenTestComment) {</span>
<span class="line-removed"> 925                     if (comment.id().equals(testComment.id())) {</span>
<span class="line-removed"> 926                         seenTestComment = true;</span>
<span class="line-removed"> 927                     }</span>
<span class="line-removed"> 928                     continue;</span>
<span class="line-removed"> 929                 }</span>
<span class="line-removed"> 930                 var lines = comment.body().split(&quot;\n&quot;);</span>
<span class="line-removed"> 931                 var n = lines.length;</span>
<span class="line-removed"> 932                 if (n &gt; 0) {</span>
<span class="line-removed"> 933                     if (n == 4 &amp;&amp;</span>
<span class="line-removed"> 934                         lines[0].equals(&quot;&lt;!-- TEST STARTED --&gt;&quot;) &amp;&amp;</span>
<span class="line-removed"> 935                         lines[1].startsWith(&quot;&lt;!-- github.com-&quot;) &amp;&amp;</span>
<span class="line-removed"> 936                         lines[2].equals(&quot;&lt;!-- &quot; + head.hex() + &quot; --&gt;&quot;)) {</span>
<span class="line-removed"> 937                         var output = removeTrailing(lines[3], &quot;.&quot;);</span>
<span class="line-removed"> 938                         System.out.println(output);</span>
<span class="line-removed"> 939                         System.exit(0);</span>
<span class="line-removed"> 940                     } else if (n == 2 &amp;&amp;</span>
<span class="line-removed"> 941                                lines[0].equals(&quot;&lt;!-- TEST ERROR --&gt;&quot;)) {</span>
<span class="line-removed"> 942                         var output = removeTrailing(lines[1], &quot;.&quot;);</span>
<span class="line-removed"> 943                         System.out.println(output);</span>
<span class="line-removed"> 944                         System.exit(1);</span>
<span class="line-removed"> 945                     } else if (n == 4 &amp;&amp;</span>
<span class="line-removed"> 946                                lines[0].equals(&quot;&lt;!-- TEST PENDING --&gt;&quot;) &amp;&amp;</span>
<span class="line-removed"> 947                                lines[1].equals(&quot;&lt;!--- &quot; + head.hex() + &quot; --&gt;&quot;)) {</span>
<span class="line-removed"> 948                         var output = removeTrailing(lines[3], &quot;.&quot;);</span>
<span class="line-removed"> 949                         System.out.println(output);</span>
<span class="line-removed"> 950                         System.exit(0);</span>
<span class="line-removed"> 951                     }</span>
<span class="line-removed"> 952                 }</span>
<span class="line-removed"> 953             }</span>
<span class="line-removed"> 954 </span>
<span class="line-removed"> 955             Thread.sleep(2000);</span>
<span class="line-removed"> 956         }</span>
<span class="line-removed"> 957     }</span>
<span class="line-removed"> 958 </span>
<span class="line-removed"> 959     private static void approve(String[] args) throws IOException, InterruptedException {</span>
<span class="line-removed"> 960         var flags = List.of(</span>
<span class="line-removed"> 961             Option.shortcut(&quot;u&quot;)</span>
<span class="line-removed"> 962                   .fullname(&quot;username&quot;)</span>
<span class="line-removed"> 963                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed"> 964                   .helptext(&quot;Username on host&quot;)</span>
<span class="line-removed"> 965                   .optional(),</span>
<span class="line-removed"> 966             Option.shortcut(&quot;r&quot;)</span>
<span class="line-removed"> 967                   .fullname(&quot;remote&quot;)</span>
<span class="line-removed"> 968                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed"> 969                   .helptext(&quot;Name of remote, defaults to &#39;origin&#39;&quot;)</span>
<span class="line-removed"> 970                   .optional(),</span>
<span class="line-removed"> 971             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed"> 972                   .fullname(&quot;verbose&quot;)</span>
<span class="line-removed"> 973                   .helptext(&quot;Turn on verbose output&quot;)</span>
<span class="line-removed"> 974                   .optional(),</span>
<span class="line-removed"> 975             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed"> 976                   .fullname(&quot;debug&quot;)</span>
<span class="line-removed"> 977                   .helptext(&quot;Turn on debugging output&quot;)</span>
<span class="line-removed"> 978                   .optional(),</span>
<span class="line-removed"> 979             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed"> 980                   .fullname(&quot;version&quot;)</span>
<span class="line-removed"> 981                   .helptext(&quot;Print the version of this tool&quot;)</span>
<span class="line-removed"> 982                   .optional()</span>
<span class="line-removed"> 983         );</span>
<span class="line-removed"> 984 </span>
<span class="line-removed"> 985         var inputs = List.of(</span>
<span class="line-removed"> 986             Input.position(0)</span>
<span class="line-removed"> 987                  .describe(&quot;ID&quot;)</span>
<span class="line-removed"> 988                  .singular()</span>
<span class="line-removed"> 989                  .optional()</span>
<span class="line-removed"> 990         );</span>
<span class="line-removed"> 991         var parser = new ArgumentParser(&quot;git-pr&quot;, flags, inputs);</span>
<span class="line-removed"> 992         var arguments = parse(parser, args);</span>
<span class="line-removed"> 993         var repo = getRepo();</span>
<span class="line-removed"> 994         var uri = getURI(repo, arguments);</span>
<span class="line-removed"> 995         var host = getForge(uri, repo, arguments);</span>
<span class="line-removed"> 996         var id = pullRequestIdArgument(repo, arguments);</span>
<span class="line-removed"> 997         var pr = getPullRequest(uri, repo, host, id);</span>
<span class="line-removed"> 998         pr.addReview(Review.Verdict.APPROVED, &quot;Looks good!&quot;);</span>
<span class="line-removed"> 999     }</span>
<span class="line-removed">1000 </span>
<span class="line-removed">1001     private static void list(String[] args) throws IOException, InterruptedException {</span>
<span class="line-removed">1002         var flags = List.of(</span>
<span class="line-removed">1003             Option.shortcut(&quot;u&quot;)</span>
<span class="line-removed">1004                   .fullname(&quot;username&quot;)</span>
<span class="line-removed">1005                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1006                   .helptext(&quot;Username on host&quot;)</span>
<span class="line-removed">1007                   .optional(),</span>
<span class="line-removed">1008             Option.shortcut(&quot;r&quot;)</span>
<span class="line-removed">1009                   .fullname(&quot;remote&quot;)</span>
<span class="line-removed">1010                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1011                   .helptext(&quot;Name of remote, defaults to &#39;origin&#39;&quot;)</span>
<span class="line-removed">1012                   .optional(),</span>
<span class="line-removed">1013             Option.shortcut(&quot;&quot;)</span>
<span class="line-removed">1014                   .fullname(&quot;authors&quot;)</span>
<span class="line-removed">1015                   .describe(&quot;LIST&quot;)</span>
<span class="line-removed">1016                   .helptext(&quot;Comma separated list of authors&quot;)</span>
<span class="line-removed">1017                   .optional(),</span>
<span class="line-removed">1018             Option.shortcut(&quot;&quot;)</span>
<span class="line-removed">1019                   .fullname(&quot;assignees&quot;)</span>
<span class="line-removed">1020                   .describe(&quot;LIST&quot;)</span>
<span class="line-removed">1021                   .helptext(&quot;Comma separated list of assignees&quot;)</span>
<span class="line-removed">1022                   .optional(),</span>
<span class="line-removed">1023             Option.shortcut(&quot;&quot;)</span>
<span class="line-removed">1024                   .fullname(&quot;labels&quot;)</span>
<span class="line-removed">1025                   .describe(&quot;LIST&quot;)</span>
<span class="line-removed">1026                   .helptext(&quot;Comma separated list of labels&quot;)</span>
<span class="line-removed">1027                   .optional(),</span>
<span class="line-removed">1028             Option.shortcut(&quot;&quot;)</span>
<span class="line-removed">1029                   .fullname(&quot;issues&quot;)</span>
<span class="line-removed">1030                   .describe(&quot;LIST&quot;)</span>
<span class="line-removed">1031                   .helptext(&quot;Comma separated list of issues&quot;)</span>
<span class="line-removed">1032                   .optional(),</span>
<span class="line-removed">1033             Option.shortcut(&quot;&quot;)</span>
<span class="line-removed">1034                   .fullname(&quot;columns&quot;)</span>
<span class="line-removed">1035                   .describe(&quot;id,title,author,assignees,labels&quot;)</span>
<span class="line-removed">1036                   .helptext(&quot;Comma separated list of columns to show&quot;)</span>
<span class="line-removed">1037                   .optional(),</span>
<span class="line-removed">1038             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1039                   .fullname(&quot;no-decoration&quot;)</span>
<span class="line-removed">1040                   .helptext(&quot;Hide any decorations when listing PRs&quot;)</span>
<span class="line-removed">1041                   .optional(),</span>
<span class="line-removed">1042             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1043                   .fullname(&quot;no-draft&quot;)</span>
<span class="line-removed">1044                   .helptext(&quot;Hide all pull requests in draft state&quot;)</span>
<span class="line-removed">1045                   .optional(),</span>
<span class="line-removed">1046             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1047                   .fullname(&quot;no-token&quot;)</span>
<span class="line-removed">1048                   .helptext(&quot;Do not use a personal access token (PAT)&quot;)</span>
<span class="line-removed">1049                   .optional(),</span>
<span class="line-removed">1050             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1051                   .fullname(&quot;verbose&quot;)</span>
<span class="line-removed">1052                   .helptext(&quot;Turn on verbose output&quot;)</span>
<span class="line-removed">1053                   .optional(),</span>
<span class="line-removed">1054             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1055                   .fullname(&quot;debug&quot;)</span>
<span class="line-removed">1056                   .helptext(&quot;Turn on debugging output&quot;)</span>
<span class="line-removed">1057                   .optional(),</span>
<span class="line-removed">1058             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1059                   .fullname(&quot;version&quot;)</span>
<span class="line-removed">1060                   .helptext(&quot;Print the version of this tool&quot;)</span>
<span class="line-removed">1061                   .optional());</span>
<span class="line-removed">1062 </span>
<span class="line-removed">1063         var inputs = List.of(</span>
<span class="line-removed">1064             Input.position(0)</span>
<span class="line-removed">1065                  .describe(&quot;ID&quot;)</span>
<span class="line-removed">1066                  .singular()</span>
<span class="line-removed">1067                  .optional()</span>
<span class="line-removed">1068         );</span>
<span class="line-removed">1069 </span>
<span class="line-removed">1070         var parser = new ArgumentParser(&quot;git-pr&quot;, flags, inputs);</span>
<span class="line-removed">1071         var arguments = parse(parser, args);</span>
<span class="line-removed">1072         var repo = getRepo();</span>
<span class="line-removed">1073         var uri = getURI(repo, arguments);</span>
<span class="line-removed">1074         var host = getForge(uri, repo, arguments);</span>
<span class="line-removed">1075         var remoteRepo = getHostedRepositoryFor(uri, repo, host);</span>
<span class="line-removed">1076 </span>
<span class="line-removed">1077         var prs = remoteRepo.pullRequests();</span>
<span class="line-removed">1078         var ids = new ArrayList&lt;String&gt;();</span>
<span class="line-removed">1079         var titles = new ArrayList&lt;String&gt;();</span>
<span class="line-removed">1080         var authors = new ArrayList&lt;String&gt;();</span>
<span class="line-removed">1081         var assignees = new ArrayList&lt;String&gt;();</span>
<span class="line-removed">1082         var labels = new ArrayList&lt;String&gt;();</span>
<span class="line-removed">1083         var issues = new ArrayList&lt;String&gt;();</span>
<span class="line-removed">1084         var branches = new ArrayList&lt;String&gt;();</span>
<span class="line-removed">1085         var statuses = new ArrayList&lt;String&gt;();</span>
<span class="line-removed">1086         var noDraft = getSwitch(&quot;no-draft&quot;, &quot;list&quot;, arguments);</span>
<span class="line-removed">1087 </span>
<span class="line-removed">1088         var authorsOption = getOption(&quot;authors&quot;, &quot;list&quot;, arguments);</span>
<span class="line-removed">1089         var filterAuthors = authorsOption == null ?</span>
<span class="line-removed">1090             Set.of() :</span>
<span class="line-removed">1091             new HashSet&lt;&gt;(Arrays.asList(authorsOption.split(&quot;,&quot;)));</span>
<span class="line-removed">1092 </span>
<span class="line-removed">1093         var assigneesOption = getOption(&quot;assignees&quot;, &quot;list&quot;, arguments);</span>
<span class="line-removed">1094         var filterAssignees = assigneesOption == null ?</span>
<span class="line-removed">1095             Set.of() :</span>
<span class="line-removed">1096             Arrays.asList(assigneesOption.split(&quot;,&quot;));</span>
<span class="line-removed">1097 </span>
<span class="line-removed">1098         var labelsOption = getOption(&quot;labels&quot;, &quot;list&quot;, arguments);</span>
<span class="line-removed">1099         var filterLabels = labelsOption == null ?</span>
<span class="line-removed">1100             Set.of() :</span>
<span class="line-removed">1101             Arrays.asList(labelsOption.split(&quot;,&quot;));</span>
<span class="line-removed">1102 </span>
<span class="line-removed">1103         var issuesOption = getOption(&quot;issues&quot;, &quot;list&quot;, arguments);</span>
<span class="line-removed">1104         var filterIssues = issuesOption == null ?</span>
<span class="line-removed">1105             Set.of() :</span>
<span class="line-removed">1106             Arrays.asList(issuesOption.split(&quot;,&quot;));</span>
<span class="line-removed">1107 </span>
<span class="line-removed">1108         var columnTitles = List.of(&quot;id&quot;, &quot;title&quot;, &quot;authors&quot;, &quot;assignees&quot;, &quot;labels&quot;, &quot;issues&quot;, &quot;branch&quot;, &quot;status&quot;);</span>
<span class="line-removed">1109         var columnValues = Map.of(columnTitles.get(0), ids,</span>
<span class="line-removed">1110                                   columnTitles.get(1), titles,</span>
<span class="line-removed">1111                                   columnTitles.get(2), authors,</span>
<span class="line-removed">1112                                   columnTitles.get(3), assignees,</span>
<span class="line-removed">1113                                   columnTitles.get(4), labels,</span>
<span class="line-removed">1114                                   columnTitles.get(5), issues,</span>
<span class="line-removed">1115                                   columnTitles.get(6), branches,</span>
<span class="line-removed">1116                                   columnTitles.get(7), statuses);</span>
<span class="line-removed">1117         var columnsOption = getOption(&quot;columns&quot;, &quot;list&quot;, arguments);</span>
<span class="line-removed">1118         var columns = columnsOption == null ?</span>
<span class="line-removed">1119             List.of(&quot;id&quot;, &quot;title&quot;, &quot;authors&quot;, &quot;status&quot;) :</span>
<span class="line-removed">1120             Arrays.asList(columnsOption.split(&quot;,&quot;));</span>
<span class="line-removed">1121 </span>
<span class="line-removed">1122         for (var column : columns) {</span>
<span class="line-removed">1123             if (!columnTitles.contains(column)) {</span>
<span class="line-removed">1124                 System.err.println(&quot;error: unknown column: &quot; + column);</span>
<span class="line-removed">1125                 System.err.println(&quot;       available columns are: &quot; + String.join(&quot;,&quot;, columnTitles));</span>
<span class="line-removed">1126                 System.exit(1);</span>
<span class="line-removed">1127             }</span>
<span class="line-removed">1128         }</span>
<span class="line-removed">1129 </span>
<span class="line-removed">1130         for (var pr : prs) {</span>
<span class="line-removed">1131             if (pr.isDraft() &amp;&amp; noDraft) {</span>
<span class="line-removed">1132                 continue;</span>
<span class="line-removed">1133             }</span>
<span class="line-removed">1134 </span>
<span class="line-removed">1135             var prAuthor = pr.author().userName();</span>
<span class="line-removed">1136             if (!filterAuthors.isEmpty() &amp;&amp; !filterAuthors.contains(prAuthor)) {</span>
<span class="line-removed">1137                 continue;</span>
<span class="line-removed">1138             }</span>
<span class="line-removed">1139 </span>
<span class="line-removed">1140             var prAssignees = pr.assignees().stream()</span>
<span class="line-removed">1141                                 .map(HostUser::userName)</span>
<span class="line-removed">1142                                 .collect(Collectors.toSet());</span>
<span class="line-removed">1143             if (!filterAssignees.isEmpty() &amp;&amp; !filterAssignees.stream().anyMatch(prAssignees::contains)) {</span>
<span class="line-removed">1144                 continue;</span>
<span class="line-removed">1145             }</span>
<span class="line-removed">1146 </span>
<span class="line-removed">1147             var prLabels = new HashSet&lt;&gt;(pr.labels());</span>
<span class="line-removed">1148             if (!filterLabels.isEmpty() &amp;&amp; !filterLabels.stream().anyMatch(prLabels::contains)) {</span>
<span class="line-removed">1149                 continue;</span>
<span class="line-removed">1150             }</span>
<span class="line-removed">1151 </span>
<span class="line-removed">1152             var prIssues = new HashSet&lt;&gt;(issuesFromPullRequest(pr));</span>
<span class="line-removed">1153             if (!filterIssues.isEmpty() &amp;&amp; !filterIssues.stream().anyMatch(prIssues::contains)) {</span>
<span class="line-removed">1154                 continue;</span>
<span class="line-removed">1155             }</span>
<span class="line-removed">1156 </span>
<span class="line-removed">1157 </span>
<span class="line-removed">1158             ids.add(pr.id());</span>
<span class="line-removed">1159             titles.add(pr.title());</span>
<span class="line-removed">1160             authors.add(prAuthor);</span>
<span class="line-removed">1161             assignees.add(String.join(&quot;,&quot;, prAssignees));</span>
<span class="line-removed">1162             labels.add(String.join(&quot;,&quot;, prLabels));</span>
<span class="line-removed">1163             issues.add(String.join(&quot;,&quot;, prIssues));</span>
<span class="line-removed">1164 </span>
<span class="line-removed">1165             if (pr.sourceRepository().webUrl().equals(uri)) {</span>
<span class="line-removed">1166                 branches.add(pr.sourceRef());</span>
<span class="line-removed">1167             } else {</span>
<span class="line-removed">1168                 branches.add(&quot;&quot;);</span>
<span class="line-removed">1169             }</span>
<span class="line-removed">1170 </span>
<span class="line-removed">1171             if (columns.contains(&quot;status&quot;)) {</span>
<span class="line-removed">1172                 statuses.add(statusForPullRequest(pr).toLowerCase());</span>
<span class="line-removed">1173             } else {</span>
<span class="line-removed">1174                 statuses.add(&quot;&quot;);</span>
<span class="line-removed">1175             }</span>
<span class="line-removed">1176         }</span>
<span class="line-removed">1177 </span>
<span class="line-removed">1178 </span>
<span class="line-removed">1179         String fmt = &quot;&quot;;</span>
<span class="line-removed">1180         for (var column : columns.subList(0, columns.size() - 1)) {</span>
<span class="line-removed">1181             var values = columnValues.get(column);</span>
<span class="line-removed">1182             var n = Math.max(column.length(), longest(values));</span>
<span class="line-removed">1183             fmt += &quot;%-&quot; + n + &quot;s    &quot;;</span>
<span class="line-removed">1184         }</span>
<span class="line-removed">1185         fmt += &quot;%s\n&quot;;</span>
<span class="line-removed">1186 </span>
<span class="line-removed">1187         var noDecoration = getSwitch(&quot;no-decoration&quot;, &quot;list&quot;, arguments);</span>
<span class="line-removed">1188         if (!ids.isEmpty() &amp;&amp; !noDecoration) {</span>
<span class="line-removed">1189             var upperCase = columns.stream()</span>
<span class="line-removed">1190                                    .map(String::toUpperCase)</span>
<span class="line-removed">1191                                    .collect(Collectors.toList());</span>
<span class="line-removed">1192             System.out.format(fmt, (Object[]) upperCase.toArray(new String[0]));</span>
<span class="line-removed">1193         }</span>
<span class="line-removed">1194         for (var i = 0; i &lt; ids.size(); i++) {</span>
<span class="line-removed">1195             final int n = i;</span>
<span class="line-removed">1196             var row = columns.stream()</span>
<span class="line-removed">1197                              .map(columnValues::get)</span>
<span class="line-removed">1198                              .map(values -&gt; values.get(n))</span>
<span class="line-removed">1199                              .collect(Collectors.toList());</span>
<span class="line-removed">1200             System.out.format(fmt, (Object[]) row.toArray(new String[0]));</span>
<span class="line-removed">1201         }</span>
<span class="line-removed">1202     }</span>
<span class="line-removed">1203 </span>
<span class="line-removed">1204     private static void close(String[] args) throws IOException, InterruptedException {</span>
<span class="line-removed">1205         var flags = List.of(</span>
<span class="line-removed">1206             Option.shortcut(&quot;u&quot;)</span>
<span class="line-removed">1207                   .fullname(&quot;username&quot;)</span>
<span class="line-removed">1208                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1209                   .helptext(&quot;Username on host&quot;)</span>
<span class="line-removed">1210                   .optional(),</span>
<span class="line-removed">1211             Option.shortcut(&quot;r&quot;)</span>
<span class="line-removed">1212                   .fullname(&quot;remote&quot;)</span>
<span class="line-removed">1213                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1214                   .helptext(&quot;Name of remote, defaults to &#39;origin&#39;&quot;)</span>
<span class="line-removed">1215                   .optional(),</span>
<span class="line-removed">1216             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1217                   .fullname(&quot;verbose&quot;)</span>
<span class="line-removed">1218                   .helptext(&quot;Turn on verbose output&quot;)</span>
<span class="line-removed">1219                   .optional(),</span>
<span class="line-removed">1220             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1221                   .fullname(&quot;debug&quot;)</span>
<span class="line-removed">1222                   .helptext(&quot;Turn on debugging output&quot;)</span>
<span class="line-removed">1223                   .optional(),</span>
<span class="line-removed">1224             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1225                   .fullname(&quot;version&quot;)</span>
<span class="line-removed">1226                   .helptext(&quot;Print the version of this tool&quot;)</span>
<span class="line-removed">1227                   .optional()</span>
<span class="line-removed">1228         );</span>
<span class="line-removed">1229 </span>
<span class="line-removed">1230         var inputs = List.of(</span>
<span class="line-removed">1231             Input.position(0)</span>
<span class="line-removed">1232                  .describe(&quot;ID&quot;)</span>
<span class="line-removed">1233                  .singular()</span>
<span class="line-removed">1234                  .optional()</span>
<span class="line-removed">1235         );</span>
<span class="line-removed">1236 </span>
<span class="line-removed">1237         var parser = new ArgumentParser(&quot;git-pr&quot;, flags, inputs);</span>
<span class="line-removed">1238         var arguments = parse(parser, args);</span>
<span class="line-removed">1239         var repo = getRepo();</span>
<span class="line-removed">1240         var uri = getURI(repo, arguments);</span>
<span class="line-removed">1241         var host = getForge(uri, repo, arguments);</span>
<span class="line-removed">1242         var id = pullRequestIdArgument(repo, arguments);</span>
<span class="line-removed">1243         var pr = getPullRequest(uri, repo, host, id);</span>
<span class="line-removed">1244 </span>
<span class="line-removed">1245         pr.setState(PullRequest.State.CLOSED);</span>
<span class="line-removed">1246     }</span>
<span class="line-removed">1247 </span>
<span class="line-removed">1248     private static void set(String[] args) throws IOException, InterruptedException {</span>
<span class="line-removed">1249         var flags = List.of(</span>
<span class="line-removed">1250             Option.shortcut(&quot;u&quot;)</span>
<span class="line-removed">1251                   .fullname(&quot;username&quot;)</span>
<span class="line-removed">1252                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1253                   .helptext(&quot;Username on host&quot;)</span>
<span class="line-removed">1254                   .optional(),</span>
<span class="line-removed">1255             Option.shortcut(&quot;r&quot;)</span>
<span class="line-removed">1256                   .fullname(&quot;remote&quot;)</span>
<span class="line-removed">1257                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1258                   .helptext(&quot;Name of remote, defaults to &#39;origin&#39;&quot;)</span>
<span class="line-removed">1259                   .optional(),</span>
<span class="line-removed">1260             Option.shortcut(&quot;&quot;)</span>
<span class="line-removed">1261                   .fullname(&quot;assignees&quot;)</span>
<span class="line-removed">1262                   .describe(&quot;LIST&quot;)</span>
<span class="line-removed">1263                   .helptext(&quot;Comma separated list of assignees&quot;)</span>
<span class="line-removed">1264                   .optional(),</span>
<span class="line-removed">1265             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1266                   .fullname(&quot;verbose&quot;)</span>
<span class="line-removed">1267                   .helptext(&quot;Turn on verbose output&quot;)</span>
<span class="line-removed">1268                   .optional(),</span>
<span class="line-removed">1269             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1270                   .fullname(&quot;debug&quot;)</span>
<span class="line-removed">1271                   .helptext(&quot;Turn on debugging output&quot;)</span>
<span class="line-removed">1272                   .optional(),</span>
<span class="line-removed">1273             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1274                   .fullname(&quot;version&quot;)</span>
<span class="line-removed">1275                   .helptext(&quot;Print the version of this tool&quot;)</span>
<span class="line-removed">1276                   .optional()</span>
<span class="line-removed">1277         );</span>
<span class="line-removed">1278 </span>
<span class="line-removed">1279         var inputs = List.of(</span>
<span class="line-removed">1280             Input.position(0)</span>
<span class="line-removed">1281                  .describe(&quot;ID&quot;)</span>
<span class="line-removed">1282                  .singular()</span>
<span class="line-removed">1283                  .optional()</span>
<span class="line-removed">1284         );</span>
<span class="line-removed">1285 </span>
<span class="line-removed">1286         var parser = new ArgumentParser(&quot;git-pr&quot;, flags, inputs);</span>
<span class="line-removed">1287         var arguments = parse(parser, args);</span>
<span class="line-removed">1288         var repo = getRepo();</span>
<span class="line-removed">1289         var uri = getURI(repo, arguments);</span>
<span class="line-removed">1290         var host = getForge(uri, repo, arguments);</span>
<span class="line-removed">1291         var id = pullRequestIdArgument(repo, arguments);</span>
<span class="line-removed">1292         var pr = getPullRequest(uri, repo, host, id);</span>
<span class="line-removed">1293 </span>
<span class="line-removed">1294         var assigneesOption = getOption(&quot;assignees&quot;, &quot;set&quot;, arguments);</span>
<span class="line-removed">1295         if (assigneesOption != null) {</span>
<span class="line-removed">1296             var usernames = Arrays.asList(assigneesOption.split(&quot;,&quot;));</span>
<span class="line-removed">1297             var assignees = usernames.stream()</span>
<span class="line-removed">1298                 .map(u -&gt; host.user(u))</span>
<span class="line-removed">1299                 .filter(Optional::isPresent)</span>
<span class="line-removed">1300                 .map(Optional::get)</span>
<span class="line-removed">1301                 .collect(Collectors.toList());</span>
<span class="line-removed">1302             pr.setAssignees(assignees);</span>
<span class="line-removed">1303         }</span>
<span class="line-removed">1304     }</span>
<span class="line-removed">1305 </span>
<span class="line-removed">1306     private static void status(String[] args) throws IOException, InterruptedException {</span>
<span class="line-removed">1307         var flags = List.of(</span>
<span class="line-removed">1308             Option.shortcut(&quot;u&quot;)</span>
<span class="line-removed">1309                   .fullname(&quot;username&quot;)</span>
<span class="line-removed">1310                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1311                   .helptext(&quot;Username on host&quot;)</span>
<span class="line-removed">1312                   .optional(),</span>
<span class="line-removed">1313             Option.shortcut(&quot;r&quot;)</span>
<span class="line-removed">1314                   .fullname(&quot;remote&quot;)</span>
<span class="line-removed">1315                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1316                   .helptext(&quot;Name of remote, defaults to &#39;origin&#39;&quot;)</span>
<span class="line-removed">1317                   .optional(),</span>
<span class="line-removed">1318             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1319                   .fullname(&quot;no-decoration&quot;)</span>
<span class="line-removed">1320                   .helptext(&quot;Hide any decorations when listing PRs&quot;)</span>
<span class="line-removed">1321                   .optional(),</span>
<span class="line-removed">1322             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1323                   .fullname(&quot;no-token&quot;)</span>
<span class="line-removed">1324                   .helptext(&quot;Do not use a personal access token (PAT)&quot;)</span>
<span class="line-removed">1325                   .optional(),</span>
<span class="line-removed">1326             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1327                   .fullname(&quot;no-checks&quot;)</span>
<span class="line-removed">1328                   .helptext(&quot;Do not show check status as part of the &#39;git pr status&#39; output&quot;)</span>
<span class="line-removed">1329                   .optional(),</span>
<span class="line-removed">1330             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1331                   .fullname(&quot;verbose&quot;)</span>
<span class="line-removed">1332                   .helptext(&quot;Turn on verbose output&quot;)</span>
<span class="line-removed">1333                   .optional(),</span>
<span class="line-removed">1334             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1335                   .fullname(&quot;debug&quot;)</span>
<span class="line-removed">1336                   .helptext(&quot;Turn on debugging output&quot;)</span>
<span class="line-removed">1337                   .optional(),</span>
<span class="line-removed">1338             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1339                   .fullname(&quot;version&quot;)</span>
<span class="line-removed">1340                   .helptext(&quot;Print the version of this tool&quot;)</span>
<span class="line-removed">1341                   .optional()</span>
<span class="line-removed">1342         );</span>
<span class="line-removed">1343 </span>
<span class="line-removed">1344         var inputs = List.of(</span>
<span class="line-removed">1345             Input.position(0)</span>
<span class="line-removed">1346                  .describe(&quot;ID&quot;)</span>
<span class="line-removed">1347                  .singular()</span>
<span class="line-removed">1348                  .optional()</span>
<span class="line-removed">1349         );</span>
<span class="line-removed">1350 </span>
<span class="line-removed">1351         var parser = new ArgumentParser(&quot;git-pr&quot;, flags, inputs);</span>
<span class="line-removed">1352         var arguments = parse(parser, args);</span>
<span class="line-removed">1353         var repo = getRepo();</span>
<span class="line-removed">1354         var uri = getURI(repo, arguments);</span>
<span class="line-removed">1355         var host = getForge(uri, repo, arguments);</span>
<span class="line-removed">1356         var id = pullRequestIdArgument(repo, arguments);</span>
<span class="line-removed">1357         var pr = getPullRequest(uri, repo, host, id);</span>
<span class="line-removed">1358 </span>
<span class="line-removed">1359         var noDecoration = getSwitch(&quot;no-decoration&quot;, &quot;status&quot;, arguments);</span>
<span class="line-removed">1360         var decoration = noDecoration ? &quot;&quot; : &quot;Status: &quot;;</span>
<span class="line-removed">1361         System.out.println(decoration + statusForPullRequest(pr));</span>
<span class="line-removed">1362 </span>
<span class="line-removed">1363         var noChecks = getSwitch(&quot;no-checks&quot;, &quot;status&quot;, arguments);</span>
<span class="line-removed">1364         if (!noChecks) {</span>
<span class="line-removed">1365             var checks = pr.checks(pr.headHash());</span>
<span class="line-removed">1366             var jcheck = Optional.ofNullable(checks.get(&quot;jcheck&quot;));</span>
<span class="line-removed">1367             var submit = Optional.ofNullable(checks.get(&quot;submit&quot;));</span>
<span class="line-removed">1368             var showChecks = jcheck.isPresent() || submit.isPresent();</span>
<span class="line-removed">1369             if (showChecks) {</span>
<span class="line-removed">1370                 System.out.println(&quot;Checks:&quot;);</span>
<span class="line-removed">1371                 if (jcheck.isPresent()) {</span>
<span class="line-removed">1372                     System.out.println(&quot;- jcheck: &quot; + statusForCheck(jcheck.get()));</span>
<span class="line-removed">1373                 }</span>
<span class="line-removed">1374                 if (submit.isPresent()) {</span>
<span class="line-removed">1375                     System.out.println(&quot;- submit: &quot; + statusForCheck(submit.get()));</span>
<span class="line-removed">1376                 }</span>
<span class="line-removed">1377             }</span>
<span class="line-removed">1378         }</span>
<span class="line-removed">1379     }</span>
<span class="line-removed">1380 </span>
<span class="line-removed">1381     private static void fetch(String[] args) throws IOException, InterruptedException {</span>
<span class="line-removed">1382         var flags = List.of(</span>
<span class="line-removed">1383             Option.shortcut(&quot;u&quot;)</span>
<span class="line-removed">1384                   .fullname(&quot;username&quot;)</span>
<span class="line-removed">1385                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1386                   .helptext(&quot;Username on host&quot;)</span>
<span class="line-removed">1387                   .optional(),</span>
<span class="line-removed">1388             Option.shortcut(&quot;r&quot;)</span>
<span class="line-removed">1389                   .fullname(&quot;remote&quot;)</span>
<span class="line-removed">1390                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1391                   .helptext(&quot;Name of remote, defaults to &#39;origin&#39;&quot;)</span>
<span class="line-removed">1392                   .optional(),</span>
<span class="line-removed">1393             Option.shortcut(&quot;b&quot;)</span>
<span class="line-removed">1394                   .fullname(&quot;branch&quot;)</span>
<span class="line-removed">1395                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1396                   .helptext(&quot;Name of target branch, defaults to &#39;master&#39;&quot;)</span>
<span class="line-removed">1397                   .optional(),</span>
<span class="line-removed">1398             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1399                   .fullname(&quot;no-token&quot;)</span>
<span class="line-removed">1400                   .helptext(&quot;Do not use a personal access token (PAT)&quot;)</span>
<span class="line-removed">1401                   .optional(),</span>
<span class="line-removed">1402             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1403                   .fullname(&quot;verbose&quot;)</span>
<span class="line-removed">1404                   .helptext(&quot;Turn on verbose output&quot;)</span>
<span class="line-removed">1405                   .optional(),</span>
<span class="line-removed">1406             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1407                   .fullname(&quot;debug&quot;)</span>
<span class="line-removed">1408                   .helptext(&quot;Turn on debugging output&quot;)</span>
<span class="line-removed">1409                   .optional(),</span>
<span class="line-removed">1410             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1411                   .fullname(&quot;version&quot;)</span>
<span class="line-removed">1412                   .helptext(&quot;Print the version of this tool&quot;)</span>
<span class="line-removed">1413                   .optional()</span>
<span class="line-removed">1414         );</span>
<span class="line-removed">1415 </span>
<span class="line-removed">1416         var inputs = List.of(</span>
<span class="line-removed">1417             Input.position(0)</span>
<span class="line-removed">1418                  .describe(&quot;ID&quot;)</span>
<span class="line-removed">1419                  .singular()</span>
<span class="line-removed">1420                  .optional()</span>
<span class="line-removed">1421         );</span>
<span class="line-removed">1422 </span>
<span class="line-removed">1423         var parser = new ArgumentParser(&quot;git-pr&quot;, flags, inputs);</span>
<span class="line-removed">1424         var arguments = parse(parser, args);</span>
<span class="line-removed">1425         var repo = getRepo();</span>
<span class="line-removed">1426         var uri = getURI(repo, arguments);</span>
<span class="line-removed">1427         var host = getForge(uri, repo, arguments);</span>
<span class="line-removed">1428         var id = pullRequestIdArgument(repo, arguments);</span>
<span class="line-removed">1429         var pr = getPullRequest(uri, repo, host, id);</span>
<span class="line-removed">1430 </span>
<span class="line-removed">1431         var fetchHead = repo.fetch(pr.repository().webUrl(), pr.fetchRef());</span>
<span class="line-removed">1432         var branchName = getOption(&quot;branch&quot;, &quot;fetch&quot;, arguments);</span>
<span class="line-removed">1433         if (branchName != null) {</span>
<span class="line-removed">1434             repo.branch(fetchHead, branchName);</span>
<span class="line-removed">1435         } else {</span>
<span class="line-removed">1436             System.out.println(fetchHead.hex());</span>
<span class="line-removed">1437         }</span>
<span class="line-removed">1438     }</span>
<span class="line-removed">1439 </span>
<span class="line-removed">1440     private static void show(String[] args) throws IOException, InterruptedException {</span>
<span class="line-removed">1441         var flags = List.of(</span>
<span class="line-removed">1442             Option.shortcut(&quot;u&quot;)</span>
<span class="line-removed">1443                   .fullname(&quot;username&quot;)</span>
<span class="line-removed">1444                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1445                   .helptext(&quot;Username on host&quot;)</span>
<span class="line-removed">1446                   .optional(),</span>
<span class="line-removed">1447             Option.shortcut(&quot;r&quot;)</span>
<span class="line-removed">1448                   .fullname(&quot;remote&quot;)</span>
<span class="line-removed">1449                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1450                   .helptext(&quot;Name of remote, defaults to &#39;origin&#39;&quot;)</span>
<span class="line-removed">1451                   .optional(),</span>
<span class="line-removed">1452             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1453                   .fullname(&quot;no-token&quot;)</span>
<span class="line-removed">1454                   .helptext(&quot;Do not use a personal access token (PAT)&quot;)</span>
<span class="line-removed">1455                   .optional(),</span>
<span class="line-removed">1456             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1457                   .fullname(&quot;verbose&quot;)</span>
<span class="line-removed">1458                   .helptext(&quot;Turn on verbose output&quot;)</span>
<span class="line-removed">1459                   .optional(),</span>
<span class="line-removed">1460             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1461                   .fullname(&quot;debug&quot;)</span>
<span class="line-removed">1462                   .helptext(&quot;Turn on debugging output&quot;)</span>
<span class="line-removed">1463                   .optional(),</span>
<span class="line-removed">1464             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1465                   .fullname(&quot;version&quot;)</span>
<span class="line-removed">1466                   .helptext(&quot;Print the version of this tool&quot;)</span>
<span class="line-removed">1467                   .optional()</span>
<span class="line-removed">1468         );</span>
<span class="line-removed">1469 </span>
<span class="line-removed">1470         var inputs = List.of(</span>
<span class="line-removed">1471             Input.position(0)</span>
<span class="line-removed">1472                  .describe(&quot;ID&quot;)</span>
<span class="line-removed">1473                  .singular()</span>
<span class="line-removed">1474                  .optional()</span>
<span class="line-removed">1475         );</span>
<span class="line-removed">1476 </span>
<span class="line-removed">1477         var parser = new ArgumentParser(&quot;git-pr&quot;, flags, inputs);</span>
<span class="line-removed">1478         var arguments = parse(parser, args);</span>
<span class="line-removed">1479         var repo = getRepo();</span>
<span class="line-removed">1480         var uri = getURI(repo, arguments);</span>
<span class="line-removed">1481         var host = getForge(uri, repo, arguments);</span>
<span class="line-removed">1482         var id = pullRequestIdArgument(repo, arguments);</span>
<span class="line-removed">1483         var pr = getPullRequest(uri, repo, host, id);</span>
<span class="line-removed">1484 </span>
<span class="line-removed">1485         var fetchHead = repo.fetch(pr.repository().webUrl(), pr.fetchRef());</span>
<span class="line-removed">1486         show(pr.targetRef(), fetchHead);</span>
<span class="line-removed">1487     }</span>
<span class="line-removed">1488 </span>
<span class="line-removed">1489     private static void checkout(String[] args) throws IOException, InterruptedException {</span>
<span class="line-removed">1490         var flags = List.of(</span>
<span class="line-removed">1491             Option.shortcut(&quot;u&quot;)</span>
<span class="line-removed">1492                   .fullname(&quot;username&quot;)</span>
<span class="line-removed">1493                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1494                   .helptext(&quot;Username on host&quot;)</span>
<span class="line-removed">1495                   .optional(),</span>
<span class="line-removed">1496             Option.shortcut(&quot;r&quot;)</span>
<span class="line-removed">1497                   .fullname(&quot;remote&quot;)</span>
<span class="line-removed">1498                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1499                   .helptext(&quot;Name of remote, defaults to &#39;origin&#39;&quot;)</span>
<span class="line-removed">1500                   .optional(),</span>
<span class="line-removed">1501             Option.shortcut(&quot;b&quot;)</span>
<span class="line-removed">1502                   .fullname(&quot;branch&quot;)</span>
<span class="line-removed">1503                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1504                   .helptext(&quot;Name of target branch, defaults to &#39;master&#39;&quot;)</span>
<span class="line-removed">1505                   .optional(),</span>
<span class="line-removed">1506             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1507                   .fullname(&quot;no-token&quot;)</span>
<span class="line-removed">1508                   .helptext(&quot;Do not use a personal access token (PAT)&quot;)</span>
<span class="line-removed">1509                   .optional(),</span>
<span class="line-removed">1510             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1511                   .fullname(&quot;verbose&quot;)</span>
<span class="line-removed">1512                   .helptext(&quot;Turn on verbose output&quot;)</span>
<span class="line-removed">1513                   .optional(),</span>
<span class="line-removed">1514             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1515                   .fullname(&quot;debug&quot;)</span>
<span class="line-removed">1516                   .helptext(&quot;Turn on debugging output&quot;)</span>
<span class="line-removed">1517                   .optional(),</span>
<span class="line-removed">1518             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1519                   .fullname(&quot;version&quot;)</span>
<span class="line-removed">1520                   .helptext(&quot;Print the version of this tool&quot;)</span>
<span class="line-removed">1521                   .optional()</span>
<span class="line-removed">1522         );</span>
<span class="line-removed">1523 </span>
<span class="line-removed">1524         var inputs = List.of(</span>
<span class="line-removed">1525             Input.position(0)</span>
<span class="line-removed">1526                  .describe(&quot;ID&quot;)</span>
<span class="line-removed">1527                  .singular()</span>
<span class="line-removed">1528                  .optional()</span>
<span class="line-removed">1529         );</span>
<span class="line-removed">1530 </span>
<span class="line-removed">1531         var parser = new ArgumentParser(&quot;git-pr&quot;, flags, inputs);</span>
<span class="line-removed">1532         var arguments = parse(parser, args);</span>
<span class="line-removed">1533         var repo = getRepo();</span>
<span class="line-removed">1534         var uri = getURI(repo, arguments);</span>
<span class="line-removed">1535         var host = getForge(uri, repo, arguments);</span>
<span class="line-removed">1536         var id = pullRequestIdArgument(repo, arguments);</span>
<span class="line-removed">1537         var pr = getPullRequest(uri, repo, host, id);</span>
<span class="line-removed">1538 </span>
<span class="line-removed">1539         var fetchHead = repo.fetch(pr.repository().webUrl(), pr.fetchRef());</span>
<span class="line-removed">1540         var branchName = getOption(&quot;branch&quot;, &quot;checkout&quot;, arguments);</span>
<span class="line-removed">1541         if (branchName != null) {</span>
<span class="line-removed">1542             var branch = repo.branch(fetchHead, branchName);</span>
<span class="line-removed">1543             repo.checkout(branch, false);</span>
<span class="line-removed">1544         } else {</span>
<span class="line-removed">1545             repo.checkout(fetchHead, false);</span>
<span class="line-removed">1546         }</span>
<span class="line-removed">1547     }</span>
<span class="line-removed">1548 </span>
<span class="line-removed">1549     private static void apply(String[] args) throws IOException, InterruptedException {</span>
<span class="line-removed">1550         var flags = List.of(</span>
<span class="line-removed">1551             Option.shortcut(&quot;u&quot;)</span>
<span class="line-removed">1552                   .fullname(&quot;username&quot;)</span>
<span class="line-removed">1553                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1554                   .helptext(&quot;Username on host&quot;)</span>
<span class="line-removed">1555                   .optional(),</span>
<span class="line-removed">1556             Option.shortcut(&quot;r&quot;)</span>
<span class="line-removed">1557                   .fullname(&quot;remote&quot;)</span>
<span class="line-removed">1558                   .describe(&quot;NAME&quot;)</span>
<span class="line-removed">1559                   .helptext(&quot;Name of remote, defaults to &#39;origin&#39;&quot;)</span>
<span class="line-removed">1560                   .optional(),</span>
<span class="line-removed">1561             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1562                   .fullname(&quot;no-token&quot;)</span>
<span class="line-removed">1563                   .helptext(&quot;Do not use a personal access token (PAT)&quot;)</span>
<span class="line-removed">1564                   .optional(),</span>
<span class="line-removed">1565             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1566                   .fullname(&quot;verbose&quot;)</span>
<span class="line-removed">1567                   .helptext(&quot;Turn on verbose output&quot;)</span>
<span class="line-removed">1568                   .optional(),</span>
<span class="line-removed">1569             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1570                   .fullname(&quot;debug&quot;)</span>
<span class="line-removed">1571                   .helptext(&quot;Turn on debugging output&quot;)</span>
<span class="line-removed">1572                   .optional(),</span>
<span class="line-removed">1573             Switch.shortcut(&quot;&quot;)</span>
<span class="line-removed">1574                   .fullname(&quot;version&quot;)</span>
<span class="line-removed">1575                   .helptext(&quot;Print the version of this tool&quot;)</span>
<span class="line-removed">1576                   .optional()</span>
<span class="line-removed">1577         );</span>
<span class="line-removed">1578 </span>
<span class="line-removed">1579         var inputs = List.of(</span>
<span class="line-removed">1580             Input.position(0)</span>
<span class="line-removed">1581                  .describe(&quot;ID&quot;)</span>
<span class="line-removed">1582                  .singular()</span>
<span class="line-removed">1583                  .optional()</span>
<span class="line-removed">1584         );</span>
<span class="line-removed">1585 </span>
<span class="line-removed">1586         var parser = new ArgumentParser(&quot;git-pr&quot;, flags, inputs);</span>
<span class="line-removed">1587         var arguments = parse(parser, args);</span>
<span class="line-removed">1588         var repo = getRepo();</span>
<span class="line-removed">1589         var uri = getURI(repo, arguments);</span>
<span class="line-removed">1590         var host = getForge(uri, repo, arguments);</span>
<span class="line-removed">1591         var id = pullRequestIdArgument(repo, arguments);</span>
<span class="line-removed">1592         var pr = getPullRequest(uri, repo, host, id);</span>
<span class="line-removed">1593 </span>
<span class="line-removed">1594         var fetchHead = repo.fetch(pr.repository().webUrl(), pr.fetchRef());</span>
<span class="line-removed">1595         var patch = diff(pr.targetRef(), fetchHead);</span>
<span class="line-removed">1596         apply(patch);</span>
<span class="line-removed">1597         Files.deleteIfExists(patch);</span>
<span class="line-removed">1598     }</span>
<span class="line-removed">1599 </span>
1600     public static void main(String[] args) throws Exception {
1601         var commands = List.of(
1602                     Default.name(&quot;list&quot;)
1603                            .helptext(&quot;list open pull requests&quot;)
<a name="5" id="anc5"></a><span class="line-modified">1604                            .main(GitPr::list),</span>
1605                     Command.name(&quot;fetch&quot;)
1606                            .helptext(&quot;fetch a pull request&quot;)
<a name="6" id="anc6"></a><span class="line-modified">1607                            .main(GitPr::fetch),</span>
1608                     Command.name(&quot;show&quot;)
1609                            .helptext(&quot;show a pull request&quot;)
<a name="7" id="anc7"></a><span class="line-modified">1610                            .main(GitPr::show),</span>
1611                     Command.name(&quot;checkout&quot;)
1612                            .helptext(&quot;checkout a pull request&quot;)
<a name="8" id="anc8"></a><span class="line-modified">1613                            .main(GitPr::checkout),</span>
1614                     Command.name(&quot;apply&quot;)
1615                            .helptext(&quot;apply a pull request&quot;)
<a name="9" id="anc9"></a><span class="line-modified">1616                            .main(GitPr::apply),</span>
1617                     Command.name(&quot;integrate&quot;)
1618                            .helptext(&quot;integrate a pull request&quot;)
<a name="10" id="anc10"></a><span class="line-modified">1619                            .main(GitPr::integrate),</span>
1620                     Command.name(&quot;approve&quot;)
1621                            .helptext(&quot;approve a pull request&quot;)
<a name="11" id="anc11"></a><span class="line-modified">1622                            .main(GitPr::approve),</span>
1623                     Command.name(&quot;create&quot;)
1624                            .helptext(&quot;create a pull request&quot;)
<a name="12" id="anc12"></a><span class="line-modified">1625                            .main(GitPr::create),</span>
1626                     Command.name(&quot;close&quot;)
1627                            .helptext(&quot;close a pull request&quot;)
<a name="13" id="anc13"></a><span class="line-modified">1628                            .main(GitPr::close),</span>
1629                     Command.name(&quot;set&quot;)
1630                            .helptext(&quot;set properties of a pull request&quot;)
<a name="14" id="anc14"></a><span class="line-modified">1631                            .main(GitPr::set),</span>
1632                     Command.name(&quot;test&quot;)
1633                            .helptext(&quot;test a pull request&quot;)
<a name="15" id="anc15"></a><span class="line-modified">1634                            .main(GitPr::test),</span>
1635                     Command.name(&quot;status&quot;)
1636                            .helptext(&quot;show status of a pull request&quot;)
<a name="16" id="anc16"></a><span class="line-modified">1637                            .main(GitPr::status)</span>
1638         );
1639 
1640         HttpProxy.setup();
1641 
1642         var parser = new MultiCommandParser(&quot;git pr&quot;, commands);
1643         var command = parser.parse(args);
1644         command.execute();
1645     }
1646 }
<a name="17" id="anc17"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="17" type="hidden" />
</body>
</html>