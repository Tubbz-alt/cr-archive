<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/security/cert/X509CertSelectorTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../src/jdk.crypto.ec/share/classes/sun/security/ec/ed/EdDSAPrivateKeyImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../sun/security/pkcs/pkcs7/SignerOrder.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/security/cert/X509CertSelectorTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
326         selector.setKeyUsage(keyUsage);
327         System.out.println(&quot;Selector = &quot; + selector.toString());
328         checkMatch(selector, cert, false);
329 
330         // good match
331         selector.setKeyUsage(cert.getKeyUsage());
332         System.out.println(&quot;Selector = &quot; + selector.toString());
333         checkMatch(selector, cert, true);
334     }
335 
336     /*
337      * Tests matching on the subject alternative name extension contained in the
338      * certificate.
339      */
340     private void testSubjectAltName() throws IOException {
341         System.out.println(&quot;X.509 Certificate Match on subjectAltName&quot;);
342         // bad match
343         X509CertSelector selector = new X509CertSelector();
344         GeneralNameInterface dnsName = new DNSName(&quot;foo.com&quot;);
345         DerOutputStream tmp = new DerOutputStream();
<span class="line-modified">346         dnsName.encode(tmp);</span>
347         selector.addSubjectAlternativeName(2, tmp.toByteArray());
348         checkMatch(selector, cert, false);
349 
350         // good match
351         DerInputStream in = new DerInputStream(cert.getExtensionValue(&quot;2.5.29.17&quot;));
352         byte[] encoded = in.getOctetString();
353         SubjectAlternativeNameExtension ext = new SubjectAlternativeNameExtension(false, encoded);
354         GeneralNames names = (GeneralNames) ext.get(SubjectAlternativeNameExtension.SUBJECT_NAME);
355         GeneralName name = (GeneralName) names.get(0);
356         selector.setSubjectAlternativeNames(null);
357         DerOutputStream tmp2 = new DerOutputStream();
<span class="line-modified">358         name.getName().encode(tmp2);</span>
359         selector.addSubjectAlternativeName(name.getType(), tmp2.toByteArray());
360         checkMatch(selector, cert, true);
361 
362         // good match 2 (matches at least one)
363         selector.setMatchAllSubjectAltNames(false);
364         selector.addSubjectAlternativeName(2, &quot;foo.com&quot;);
365         checkMatch(selector, cert, true);
366     }
367 
368     /*
369      * Tests matching on the policy constraints extension contained in the
370      * certificate.
371      */
372     private void testPolicy() throws IOException {
373         System.out.println(&quot;X.509 Certificate Match on certificatePolicies&quot;);
374         // test encoding of CertificatePoliciesExtension because we wrote the
375         // code
376         // bad match
377         X509CertSelector selector = new X509CertSelector();
378         Set&lt;String&gt; s = new HashSet&lt;&gt;();
</pre>
<hr />
<pre>
399     private void testPathToName() throws IOException {
400         System.out.println(&quot;X.509 Certificate Match on pathToName&quot;);
401 
402         X509CertSelector selector = null;
403         DerInputStream in = new DerInputStream(cert.getExtensionValue(&quot;2.5.29.30&quot;));
404         byte[] encoded = in.getOctetString();
405         NameConstraintsExtension ext = new NameConstraintsExtension(false, encoded);
406         GeneralSubtrees permitted = (GeneralSubtrees) ext.get(PERMITTED_SUBTREES);
407         GeneralSubtrees excluded = (GeneralSubtrees) ext.get(EXCLUDED_SUBTREES);
408 
409         // bad matches on pathToName within excluded subtrees
410         if (excluded != null) {
411             Iterator&lt;GeneralSubtree&gt; e = excluded.iterator();
412             while (e.hasNext()) {
413                 GeneralSubtree tree = e.next();
414                 if (tree.getName().getType() == NAME_DIRECTORY) {
415                     X500Name excludedDN1 = new X500Name(tree.getName().toString());
416                     X500Name excludedDN2 = new X500Name(&quot;CN=Bogus, &quot; + tree.getName().toString());
417                     DerOutputStream derDN1 = new DerOutputStream();
418                     DerOutputStream derDN2 = new DerOutputStream();
<span class="line-modified">419                     excludedDN1.encode(derDN1);</span>
<span class="line-modified">420                     excludedDN2.encode(derDN2);</span>
421                     selector = new X509CertSelector();
422                     selector.addPathToName(NAME_DIRECTORY, derDN1.toByteArray());
423                     checkMatch(selector, cert, false);
424                     selector.setPathToNames(null);
425                     selector.addPathToName(NAME_DIRECTORY, derDN2.toByteArray());
426                     checkMatch(selector, cert, false);
427                 }
428             }
429         }
430 
431         // good matches on pathToName within permitted subtrees
432         if (permitted != null) {
433             Iterator&lt;GeneralSubtree&gt; e = permitted.iterator();
434             while (e.hasNext()) {
435                 GeneralSubtree tree = e.next();
436                 if (tree.getName().getType() == NAME_DIRECTORY) {
437                     X500Name permittedDN1 = new X500Name(tree.getName().toString());
438                     X500Name permittedDN2 = new X500Name(&quot;CN=good, &quot; + tree.getName().toString());
439                     DerOutputStream derDN1 = new DerOutputStream();
440                     DerOutputStream derDN2 = new DerOutputStream();
<span class="line-modified">441                     permittedDN1.encode(derDN1);</span>
<span class="line-modified">442                     permittedDN2.encode(derDN2);</span>
443                     selector = new X509CertSelector();
444                     selector.addPathToName(NAME_DIRECTORY, derDN1.toByteArray());
445                     checkMatch(selector, cert, true);
446                     selector.setPathToNames(null);
447                     selector.addPathToName(NAME_DIRECTORY, derDN2.toByteArray());
448                     checkMatch(selector, cert, true);
449                 }
450             }
451         }
452     }
453 
454     // Tests matching on the subject name contained in the certificate.
455     private void testSubject() throws IOException {
456         System.out.println(&quot;X.509 Certificate Match on subject&quot;);
457         // bad match
458         X509CertSelector selector = new X509CertSelector();
459         selector.setSubject(&quot;ou=bogus,ou=east,o=sun,c=us&quot;);
460         checkMatch(selector, cert, false);
461 
462         // good match
</pre>
</td>
<td>
<hr />
<pre>
326         selector.setKeyUsage(keyUsage);
327         System.out.println(&quot;Selector = &quot; + selector.toString());
328         checkMatch(selector, cert, false);
329 
330         // good match
331         selector.setKeyUsage(cert.getKeyUsage());
332         System.out.println(&quot;Selector = &quot; + selector.toString());
333         checkMatch(selector, cert, true);
334     }
335 
336     /*
337      * Tests matching on the subject alternative name extension contained in the
338      * certificate.
339      */
340     private void testSubjectAltName() throws IOException {
341         System.out.println(&quot;X.509 Certificate Match on subjectAltName&quot;);
342         // bad match
343         X509CertSelector selector = new X509CertSelector();
344         GeneralNameInterface dnsName = new DNSName(&quot;foo.com&quot;);
345         DerOutputStream tmp = new DerOutputStream();
<span class="line-modified">346         dnsName.derEncode(tmp);</span>
347         selector.addSubjectAlternativeName(2, tmp.toByteArray());
348         checkMatch(selector, cert, false);
349 
350         // good match
351         DerInputStream in = new DerInputStream(cert.getExtensionValue(&quot;2.5.29.17&quot;));
352         byte[] encoded = in.getOctetString();
353         SubjectAlternativeNameExtension ext = new SubjectAlternativeNameExtension(false, encoded);
354         GeneralNames names = (GeneralNames) ext.get(SubjectAlternativeNameExtension.SUBJECT_NAME);
355         GeneralName name = (GeneralName) names.get(0);
356         selector.setSubjectAlternativeNames(null);
357         DerOutputStream tmp2 = new DerOutputStream();
<span class="line-modified">358         name.getName().derEncode(tmp2);</span>
359         selector.addSubjectAlternativeName(name.getType(), tmp2.toByteArray());
360         checkMatch(selector, cert, true);
361 
362         // good match 2 (matches at least one)
363         selector.setMatchAllSubjectAltNames(false);
364         selector.addSubjectAlternativeName(2, &quot;foo.com&quot;);
365         checkMatch(selector, cert, true);
366     }
367 
368     /*
369      * Tests matching on the policy constraints extension contained in the
370      * certificate.
371      */
372     private void testPolicy() throws IOException {
373         System.out.println(&quot;X.509 Certificate Match on certificatePolicies&quot;);
374         // test encoding of CertificatePoliciesExtension because we wrote the
375         // code
376         // bad match
377         X509CertSelector selector = new X509CertSelector();
378         Set&lt;String&gt; s = new HashSet&lt;&gt;();
</pre>
<hr />
<pre>
399     private void testPathToName() throws IOException {
400         System.out.println(&quot;X.509 Certificate Match on pathToName&quot;);
401 
402         X509CertSelector selector = null;
403         DerInputStream in = new DerInputStream(cert.getExtensionValue(&quot;2.5.29.30&quot;));
404         byte[] encoded = in.getOctetString();
405         NameConstraintsExtension ext = new NameConstraintsExtension(false, encoded);
406         GeneralSubtrees permitted = (GeneralSubtrees) ext.get(PERMITTED_SUBTREES);
407         GeneralSubtrees excluded = (GeneralSubtrees) ext.get(EXCLUDED_SUBTREES);
408 
409         // bad matches on pathToName within excluded subtrees
410         if (excluded != null) {
411             Iterator&lt;GeneralSubtree&gt; e = excluded.iterator();
412             while (e.hasNext()) {
413                 GeneralSubtree tree = e.next();
414                 if (tree.getName().getType() == NAME_DIRECTORY) {
415                     X500Name excludedDN1 = new X500Name(tree.getName().toString());
416                     X500Name excludedDN2 = new X500Name(&quot;CN=Bogus, &quot; + tree.getName().toString());
417                     DerOutputStream derDN1 = new DerOutputStream();
418                     DerOutputStream derDN2 = new DerOutputStream();
<span class="line-modified">419                     excludedDN1.derEncode(derDN1);</span>
<span class="line-modified">420                     excludedDN2.derEncode(derDN2);</span>
421                     selector = new X509CertSelector();
422                     selector.addPathToName(NAME_DIRECTORY, derDN1.toByteArray());
423                     checkMatch(selector, cert, false);
424                     selector.setPathToNames(null);
425                     selector.addPathToName(NAME_DIRECTORY, derDN2.toByteArray());
426                     checkMatch(selector, cert, false);
427                 }
428             }
429         }
430 
431         // good matches on pathToName within permitted subtrees
432         if (permitted != null) {
433             Iterator&lt;GeneralSubtree&gt; e = permitted.iterator();
434             while (e.hasNext()) {
435                 GeneralSubtree tree = e.next();
436                 if (tree.getName().getType() == NAME_DIRECTORY) {
437                     X500Name permittedDN1 = new X500Name(tree.getName().toString());
438                     X500Name permittedDN2 = new X500Name(&quot;CN=good, &quot; + tree.getName().toString());
439                     DerOutputStream derDN1 = new DerOutputStream();
440                     DerOutputStream derDN2 = new DerOutputStream();
<span class="line-modified">441                     permittedDN1.derEncode(derDN1);</span>
<span class="line-modified">442                     permittedDN2.derEncode(derDN2);</span>
443                     selector = new X509CertSelector();
444                     selector.addPathToName(NAME_DIRECTORY, derDN1.toByteArray());
445                     checkMatch(selector, cert, true);
446                     selector.setPathToNames(null);
447                     selector.addPathToName(NAME_DIRECTORY, derDN2.toByteArray());
448                     checkMatch(selector, cert, true);
449                 }
450             }
451         }
452     }
453 
454     // Tests matching on the subject name contained in the certificate.
455     private void testSubject() throws IOException {
456         System.out.println(&quot;X.509 Certificate Match on subject&quot;);
457         // bad match
458         X509CertSelector selector = new X509CertSelector();
459         selector.setSubject(&quot;ou=bogus,ou=east,o=sun,c=us&quot;);
460         checkMatch(selector, cert, false);
461 
462         // good match
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../src/jdk.crypto.ec/share/classes/sun/security/ec/ed/EdDSAPrivateKeyImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../sun/security/pkcs/pkcs7/SignerOrder.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>