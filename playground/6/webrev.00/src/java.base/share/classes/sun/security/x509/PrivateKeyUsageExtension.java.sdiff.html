<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/x509/PrivateKeyUsageExtension.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="PolicyMappingsExtension.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="RDN.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/x509/PrivateKeyUsageExtension.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 64     /**
 65      * Identifier for this attribute, to be used with the
 66      * get, set, delete methods of Certificate, x509 type.
 67      */
 68     public static final String IDENT = &quot;x509.info.extensions.PrivateKeyUsage&quot;;
 69     /**
 70      * Sub attributes name for this CertAttrSet.
 71      */
 72     public static final String NAME = &quot;PrivateKeyUsage&quot;;
 73     public static final String NOT_BEFORE = &quot;not_before&quot;;
 74     public static final String NOT_AFTER = &quot;not_after&quot;;
 75 
 76     // Private data members
 77     private static final byte TAG_BEFORE = 0;
 78     private static final byte TAG_AFTER = 1;
 79 
 80     private Date        notBefore = null;
 81     private Date        notAfter = null;
 82 
 83     // Encode this extension value.
<span class="line-modified"> 84     private void encodeThis() throws IOException {</span>
 85         if (notBefore == null &amp;&amp; notAfter == null) {
 86             this.extensionValue = null;
 87             return;
 88         }
 89         DerOutputStream seq = new DerOutputStream();
 90 
 91         DerOutputStream tagged = new DerOutputStream();
 92         if (notBefore != null) {
 93             DerOutputStream tmp = new DerOutputStream();
 94             tmp.putGeneralizedTime(notBefore);
 95             tagged.writeImplicit(DerValue.createTag(DerValue.TAG_CONTEXT,
 96                                  false, TAG_BEFORE), tmp);
 97         }
 98         if (notAfter != null) {
 99             DerOutputStream tmp = new DerOutputStream();
100             tmp.putGeneralizedTime(notAfter);
101             tagged.writeImplicit(DerValue.createTag(DerValue.TAG_CONTEXT,
102                                  false, TAG_AFTER), tmp);
103         }
104         seq.write(DerValue.tag_Sequence, tagged);
</pre>
<hr />
<pre>
223          * we use the internal Dates rather than the passed in Date
224          * because someone could override the Date methods after()
225          * and before() to do something entirely different.
226          */
227         if (notBefore != null &amp;&amp; notBefore.after(now)) {
228             throw new CertificateNotYetValidException(&quot;NotBefore: &quot; +
229                                                       notBefore.toString());
230         }
231         if (notAfter != null &amp;&amp; notAfter.before(now)) {
232             throw new CertificateExpiredException(&quot;NotAfter: &quot; +
233                                                   notAfter.toString());
234         }
235     }
236 
237     /**
238      * Write the extension to the OutputStream.
239      *
240      * @param out the OutputStream to write the extension to.
241      * @exception IOException on encoding errors.
242      */
<span class="line-modified">243     public void encode(OutputStream out) throws IOException {</span>
<span class="line-modified">244         DerOutputStream tmp = new DerOutputStream();</span>
245         if (extensionValue == null) {
246             extensionId = PKIXExtensions.PrivateKeyUsage_Id;
247             critical = false;
248             encodeThis();
249         }
<span class="line-modified">250         super.encode(tmp);</span>
<span class="line-removed">251         out.write(tmp.toByteArray());</span>
252     }
253 
254     /**
255      * Set the attribute value.
256      * @exception CertificateException on attribute handling errors.
257      */
258     public void set(String name, Object obj)
259     throws CertificateException, IOException {
260         if (!(obj instanceof Date)) {
261             throw new CertificateException(&quot;Attribute must be of type Date.&quot;);
262         }
263         if (name.equalsIgnoreCase(NOT_BEFORE)) {
264             notBefore = (Date)obj;
265         } else if (name.equalsIgnoreCase(NOT_AFTER)) {
266             notAfter = (Date)obj;
267         } else {
268           throw new CertificateException(&quot;Attribute name not recognized by&quot;
269                            + &quot; CertAttrSet:PrivateKeyUsage.&quot;);
270         }
271         encodeThis();
</pre>
</td>
<td>
<hr />
<pre>
 64     /**
 65      * Identifier for this attribute, to be used with the
 66      * get, set, delete methods of Certificate, x509 type.
 67      */
 68     public static final String IDENT = &quot;x509.info.extensions.PrivateKeyUsage&quot;;
 69     /**
 70      * Sub attributes name for this CertAttrSet.
 71      */
 72     public static final String NAME = &quot;PrivateKeyUsage&quot;;
 73     public static final String NOT_BEFORE = &quot;not_before&quot;;
 74     public static final String NOT_AFTER = &quot;not_after&quot;;
 75 
 76     // Private data members
 77     private static final byte TAG_BEFORE = 0;
 78     private static final byte TAG_AFTER = 1;
 79 
 80     private Date        notBefore = null;
 81     private Date        notAfter = null;
 82 
 83     // Encode this extension value.
<span class="line-modified"> 84     private void encodeThis() {</span>
 85         if (notBefore == null &amp;&amp; notAfter == null) {
 86             this.extensionValue = null;
 87             return;
 88         }
 89         DerOutputStream seq = new DerOutputStream();
 90 
 91         DerOutputStream tagged = new DerOutputStream();
 92         if (notBefore != null) {
 93             DerOutputStream tmp = new DerOutputStream();
 94             tmp.putGeneralizedTime(notBefore);
 95             tagged.writeImplicit(DerValue.createTag(DerValue.TAG_CONTEXT,
 96                                  false, TAG_BEFORE), tmp);
 97         }
 98         if (notAfter != null) {
 99             DerOutputStream tmp = new DerOutputStream();
100             tmp.putGeneralizedTime(notAfter);
101             tagged.writeImplicit(DerValue.createTag(DerValue.TAG_CONTEXT,
102                                  false, TAG_AFTER), tmp);
103         }
104         seq.write(DerValue.tag_Sequence, tagged);
</pre>
<hr />
<pre>
223          * we use the internal Dates rather than the passed in Date
224          * because someone could override the Date methods after()
225          * and before() to do something entirely different.
226          */
227         if (notBefore != null &amp;&amp; notBefore.after(now)) {
228             throw new CertificateNotYetValidException(&quot;NotBefore: &quot; +
229                                                       notBefore.toString());
230         }
231         if (notAfter != null &amp;&amp; notAfter.before(now)) {
232             throw new CertificateExpiredException(&quot;NotAfter: &quot; +
233                                                   notAfter.toString());
234         }
235     }
236 
237     /**
238      * Write the extension to the OutputStream.
239      *
240      * @param out the OutputStream to write the extension to.
241      * @exception IOException on encoding errors.
242      */
<span class="line-modified">243     @Override</span>
<span class="line-modified">244     public void encode(DerOutputStream out) {</span>
245         if (extensionValue == null) {
246             extensionId = PKIXExtensions.PrivateKeyUsage_Id;
247             critical = false;
248             encodeThis();
249         }
<span class="line-modified">250         super.encode(out);</span>

251     }
252 
253     /**
254      * Set the attribute value.
255      * @exception CertificateException on attribute handling errors.
256      */
257     public void set(String name, Object obj)
258     throws CertificateException, IOException {
259         if (!(obj instanceof Date)) {
260             throw new CertificateException(&quot;Attribute must be of type Date.&quot;);
261         }
262         if (name.equalsIgnoreCase(NOT_BEFORE)) {
263             notBefore = (Date)obj;
264         } else if (name.equalsIgnoreCase(NOT_AFTER)) {
265             notAfter = (Date)obj;
266         } else {
267           throw new CertificateException(&quot;Attribute name not recognized by&quot;
268                            + &quot; CertAttrSet:PrivateKeyUsage.&quot;);
269         }
270         encodeThis();
</pre>
</td>
</tr>
</table>
<center><a href="PolicyMappingsExtension.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="RDN.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>