<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/pkcs10/PKCS10.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../pkcs/SignerInfo.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="PKCS10Attribute.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/pkcs10/PKCS10.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
193      * @exception IOException on errors.
194      * @exception CertificateException on certificate handling errors.
195      * @exception SignatureException on signature handling errors.
196      */
197     public void encodeAndSign(X500Name subject, Signature signature)
198     throws CertificateException, IOException, SignatureException {
199         DerOutputStream out, scratch;
200         byte[]          certificateRequestInfo;
201         byte[]          sig;
202 
203         if (encoded != null)
204             throw new SignatureException(&quot;request is already signed&quot;);
205 
206         this.subject = subject;
207 
208         /*
209          * Encode cert request info, wrap in a sequence for signing
210          */
211         scratch = new DerOutputStream();
212         scratch.putInteger(BigInteger.ZERO);            // PKCS #10 v1.0
<span class="line-modified">213         subject.encode(scratch);                        // X.500 name</span>
214         scratch.write(subjectPublicKeyInfo.getEncoded()); // public key
<span class="line-modified">215         attributeSet.encode(scratch);</span>
216 
217         out = new DerOutputStream();
218         out.write(DerValue.tag_Sequence, scratch);      // wrap it!
219         certificateRequestInfo = out.toByteArray();
220         scratch = out;
221 
222         /*
223          * Sign it ...
224          */
225         signature.update(certificateRequestInfo, 0,
226                 certificateRequestInfo.length);
227         sig = signature.sign();
228         sigAlg = signature.getAlgorithm();
229 
230         /*
231          * Build guts of SIGNED macro
232          */
233         AlgorithmId algId = null;
234         try {
235             AlgorithmParameters params = signature.getParameters();
236             algId = params == null
237                     ? AlgorithmId.get(signature.getAlgorithm())
238                     : AlgorithmId.get(params);
239         } catch (NoSuchAlgorithmException nsae) {
240             throw new SignatureException(nsae);
241         }
242 
<span class="line-modified">243         algId.encode(scratch);     // sig algorithm</span>
244         scratch.putBitString(sig);                      // sig
245 
246         /*
247          * Wrap those guts in a sequence
248          */
249         out = new DerOutputStream();
250         out.write(DerValue.tag_Sequence, scratch);
251         encoded = out.toByteArray();
252     }
253 
254     /**
255      * Returns the subject&#39;s name.
256      */
257     public X500Name getSubjectName() { return subject; }
258 
259     /**
260      * Returns the subject&#39;s public key.
261      */
262     public PublicKey getSubjectPublicKeyInfo()
263         { return subjectPublicKeyInfo; }
</pre>
</td>
<td>
<hr />
<pre>
193      * @exception IOException on errors.
194      * @exception CertificateException on certificate handling errors.
195      * @exception SignatureException on signature handling errors.
196      */
197     public void encodeAndSign(X500Name subject, Signature signature)
198     throws CertificateException, IOException, SignatureException {
199         DerOutputStream out, scratch;
200         byte[]          certificateRequestInfo;
201         byte[]          sig;
202 
203         if (encoded != null)
204             throw new SignatureException(&quot;request is already signed&quot;);
205 
206         this.subject = subject;
207 
208         /*
209          * Encode cert request info, wrap in a sequence for signing
210          */
211         scratch = new DerOutputStream();
212         scratch.putInteger(BigInteger.ZERO);            // PKCS #10 v1.0
<span class="line-modified">213         subject.derEncode(scratch);                        // X.500 name</span>
214         scratch.write(subjectPublicKeyInfo.getEncoded()); // public key
<span class="line-modified">215         attributeSet.derEncode(scratch);</span>
216 
217         out = new DerOutputStream();
218         out.write(DerValue.tag_Sequence, scratch);      // wrap it!
219         certificateRequestInfo = out.toByteArray();
220         scratch = out;
221 
222         /*
223          * Sign it ...
224          */
225         signature.update(certificateRequestInfo, 0,
226                 certificateRequestInfo.length);
227         sig = signature.sign();
228         sigAlg = signature.getAlgorithm();
229 
230         /*
231          * Build guts of SIGNED macro
232          */
233         AlgorithmId algId = null;
234         try {
235             AlgorithmParameters params = signature.getParameters();
236             algId = params == null
237                     ? AlgorithmId.get(signature.getAlgorithm())
238                     : AlgorithmId.get(params);
239         } catch (NoSuchAlgorithmException nsae) {
240             throw new SignatureException(nsae);
241         }
242 
<span class="line-modified">243         algId.derEncode(scratch);     // sig algorithm</span>
244         scratch.putBitString(sig);                      // sig
245 
246         /*
247          * Wrap those guts in a sequence
248          */
249         out = new DerOutputStream();
250         out.write(DerValue.tag_Sequence, scratch);
251         encoded = out.toByteArray();
252     }
253 
254     /**
255      * Returns the subject&#39;s name.
256      */
257     public X500Name getSubjectName() { return subject; }
258 
259     /**
260      * Returns the subject&#39;s public key.
261      */
262     public PublicKey getSubjectPublicKeyInfo()
263         { return subjectPublicKeyInfo; }
</pre>
</td>
</tr>
</table>
<center><a href="../pkcs/SignerInfo.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="PKCS10Attribute.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>