<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/util/ObjectIdentifier.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="DerValue.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>src/java.base/share/classes/sun/security/util/ObjectIdentifier.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
200                         }
201                         pos += pack7Oid(num, tmp, pos);
202                     }
203                 }
204                 start = end + 1;
205                 count++;
206             } while (end != -1);
207 
208             checkCount(count);
209             encoding = new byte[pos];
210             System.arraycopy(tmp, 0, encoding, 0, pos);
211             this.stringForm = oid;
212         } catch (IOException ioe) { // already detected by checkXXX
213             throw ioe;
214         } catch (Exception e) {
215             throw new IOException(&quot;ObjectIdentifier() -- Invalid format: &quot;
216                     + e.toString(), e);
217         }
218     }
219 










220     /**
221      * Constructor, from an ASN.1 encoded input stream.
222      * Validity check NOT included.
223      * The encoding of the ID in the stream uses &quot;DER&quot;, a BER/1 subset.
224      * In this case, that means a triple { typeId, length, data }.
225      *
226      * &lt;P&gt;&lt;STRONG&gt;NOTE:&lt;/STRONG&gt;  When an exception is thrown, the
227      * input stream has not been returned to its &quot;initial&quot; state.
228      *
229      * @param in DER-encoded data holding an object ID
230      * @exception IOException indicates a decoding error
231      */
232     public ObjectIdentifier(DerInputStream in) throws IOException {
<span class="line-modified">233         byte    type_id;</span>
<span class="line-removed">234         int     bufferEnd;</span>
<span class="line-removed">235 </span>
<span class="line-removed">236         /*</span>
<span class="line-removed">237          * Object IDs are a &quot;universal&quot; type, and their tag needs only</span>
<span class="line-removed">238          * one byte of encoding.  Verify that the tag of this datum</span>
<span class="line-removed">239          * is that of an object ID.</span>
<span class="line-removed">240          *</span>
<span class="line-removed">241          * Then get and check the length of the ID&#39;s encoding.  We set</span>
<span class="line-removed">242          * up so that we can use in.available() to check for the end of</span>
<span class="line-removed">243          * this value in the data stream.</span>
<span class="line-removed">244          */</span>
<span class="line-removed">245         type_id = (byte)in.getByte();</span>
<span class="line-removed">246         if (type_id != DerValue.tag_ObjectId)</span>
<span class="line-removed">247             throw new IOException (</span>
<span class="line-removed">248                 &quot;ObjectIdentifier() -- data isn&#39;t an object ID&quot;</span>
<span class="line-removed">249                 + &quot; (tag = &quot; +  type_id + &quot;)&quot;</span>
<span class="line-removed">250                 );</span>
<span class="line-removed">251 </span>
<span class="line-removed">252         int len = in.getDefiniteLength();</span>
<span class="line-removed">253         if (len &gt; in.available()) {</span>
<span class="line-removed">254             throw new IOException(&quot;ObjectIdentifier() -- length exceeds&quot; +</span>
<span class="line-removed">255                     &quot;data available.  Length: &quot; + len + &quot;, Available: &quot; +</span>
<span class="line-removed">256                     in.available());</span>
<span class="line-removed">257         }</span>
<span class="line-removed">258         encoding = new byte[len];</span>
<span class="line-removed">259         in.getBytes(encoding);</span>
<span class="line-removed">260         check(encoding);</span>
<span class="line-removed">261     }</span>
<span class="line-removed">262 </span>
<span class="line-removed">263     /*</span>
<span class="line-removed">264      * Constructor, from the rest of a DER input buffer;</span>
<span class="line-removed">265      * the tag and length have been removed/verified</span>
<span class="line-removed">266      * Validity check NOT included.</span>
<span class="line-removed">267      */</span>
<span class="line-removed">268     ObjectIdentifier(DerInputBuffer buf) throws IOException {</span>
<span class="line-removed">269         DerInputStream in = new DerInputStream(buf);</span>
<span class="line-removed">270         encoding = new byte[in.available()];</span>
<span class="line-removed">271         in.getBytes(encoding);</span>
<span class="line-removed">272         check(encoding);</span>
273     }
274 
275     private void init(int[] components, int length) {
276         int pos = 0;
277         byte[] tmp = new byte[length*5+1];  // +1 for empty input
278 
279         if (components[1] &lt; Integer.MAX_VALUE - components[0]*40)
280             pos += pack7Oid(components[0]*40+components[1], tmp, pos);
281         else {
282             BigInteger big = BigInteger.valueOf(components[1]);
283             big = big.add(BigInteger.valueOf(components[0]*40));
284             pos += pack7Oid(big, tmp, pos);
285         }
286 
287         for (int i=2; i&lt;length; i++) {
288             pos += pack7Oid(components[i], tmp, pos);
289         }
290         encoding = new byte[pos];
291         System.arraycopy(tmp, 0, encoding, 0, pos);
292     }
</pre>
</td>
<td>
<hr />
<pre>
200                         }
201                         pos += pack7Oid(num, tmp, pos);
202                     }
203                 }
204                 start = end + 1;
205                 count++;
206             } while (end != -1);
207 
208             checkCount(count);
209             encoding = new byte[pos];
210             System.arraycopy(tmp, 0, encoding, 0, pos);
211             this.stringForm = oid;
212         } catch (IOException ioe) { // already detected by checkXXX
213             throw ioe;
214         } catch (Exception e) {
215             throw new IOException(&quot;ObjectIdentifier() -- Invalid format: &quot;
216                     + e.toString(), e);
217         }
218     }
219 
<span class="line-added">220     public ObjectIdentifier(byte[] data, int start, int end) throws IOException {</span>
<span class="line-added">221         encoding = Arrays.copyOfRange(data, start, end);</span>
<span class="line-added">222         check(encoding);</span>
<span class="line-added">223     }</span>
<span class="line-added">224 </span>
<span class="line-added">225     ObjectIdentifier(ByteArrayInputStream in) throws IOException {</span>
<span class="line-added">226         encoding = in.readAllBytes();</span>
<span class="line-added">227         check(encoding);</span>
<span class="line-added">228     }</span>
<span class="line-added">229 </span>
230     /**
231      * Constructor, from an ASN.1 encoded input stream.
232      * Validity check NOT included.
233      * The encoding of the ID in the stream uses &quot;DER&quot;, a BER/1 subset.
234      * In this case, that means a triple { typeId, length, data }.
235      *
236      * &lt;P&gt;&lt;STRONG&gt;NOTE:&lt;/STRONG&gt;  When an exception is thrown, the
237      * input stream has not been returned to its &quot;initial&quot; state.
238      *
239      * @param in DER-encoded data holding an object ID
240      * @exception IOException indicates a decoding error
241      */
242     public ObjectIdentifier(DerInputStream in) throws IOException {
<span class="line-modified">243         encoding = in.getDerValue().getOID().encoding;</span>







































244     }
245 
246     private void init(int[] components, int length) {
247         int pos = 0;
248         byte[] tmp = new byte[length*5+1];  // +1 for empty input
249 
250         if (components[1] &lt; Integer.MAX_VALUE - components[0]*40)
251             pos += pack7Oid(components[0]*40+components[1], tmp, pos);
252         else {
253             BigInteger big = BigInteger.valueOf(components[1]);
254             big = big.add(BigInteger.valueOf(components[0]*40));
255             pos += pack7Oid(big, tmp, pos);
256         }
257 
258         for (int i=2; i&lt;length; i++) {
259             pos += pack7Oid(components[i], tmp, pos);
260         }
261         encoding = new byte[pos];
262         System.arraycopy(tmp, 0, encoding, 0, pos);
263     }
</pre>
</td>
</tr>
</table>
<center><a href="DerValue.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>