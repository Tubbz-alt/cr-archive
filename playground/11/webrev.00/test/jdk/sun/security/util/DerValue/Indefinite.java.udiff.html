<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/sun/security/util/DerValue/Indefinite.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../pkcs/pkcs8/PKCS8Test.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>test/jdk/sun/security/util/DerValue/Indefinite.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -24,22 +24,46 @@</span>
  /*
   * @test
   * @bug 6731685
   * @summary CertificateFactory.generateCertificates throws IOException on PKCS7 cert chain
   * @modules java.base/sun.security.util
<span class="udiff-line-added">+  * @library /test/lib</span>
   */
  
  import java.io.*;
<span class="udiff-line-added">+ import java.util.Arrays;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ import jdk.test.lib.Asserts;</span>
  import sun.security.util.*;
  
  public class Indefinite {
  
      public static void main(String[] args) throws Exception {
          byte[] input = {
              // An OCTET-STRING in 2 parts
<span class="udiff-line-modified-removed">-             4, (byte)0x80, 4, 2, &#39;a&#39;, &#39;b&#39;, 4, 2, &#39;c&#39;, &#39;d&#39;, 0, 0,</span>
<span class="udiff-line-removed">-             // Garbage follows, may be falsely recognized as EOC</span>
<span class="udiff-line-removed">-             0, 0, 0, 0</span>
<span class="udiff-line-modified-added">+             0x24, (byte)0x80, 4, 2, &#39;a&#39;, &#39;b&#39;, 4, 2, &#39;c&#39;, &#39;d&#39;, 0, 0,</span>
          };
<span class="udiff-line-modified-removed">-         new DerValue(new ByteArrayInputStream(input));</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+         // Add some garbage, may be falsely recognized as EOC</span>
<span class="udiff-line-added">+         new DerValue(new ByteArrayInputStream(</span>
<span class="udiff-line-added">+                 Arrays.copyOf(input, input.length + 4)));</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // Make a SEQUENCE of input and (bool) true.</span>
<span class="udiff-line-added">+         byte[] comp = new byte[input.length + 5];</span>
<span class="udiff-line-added">+         comp[0] = DerValue.tag_Sequence;</span>
<span class="udiff-line-added">+         comp[1] = (byte)(input.length + 3);</span>
<span class="udiff-line-added">+         System.arraycopy(input, 0, comp, 2, input.length);</span>
<span class="udiff-line-added">+         comp[2 + input.length] = comp[3 + input.length] = comp[4 + input.length] = 1;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // Read it</span>
<span class="udiff-line-added">+         DerValue d = new DerValue(comp);</span>
<span class="udiff-line-added">+         Asserts.assertEQ(new String(d.data.getDerValue().getOctetString()), &quot;abcd&quot;);</span>
<span class="udiff-line-added">+         Asserts.assertTrue(d.data.getBoolean());</span>
<span class="udiff-line-added">+         d.data.atEnd();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // Or skip it</span>
<span class="udiff-line-added">+         d = new DerValue(comp);</span>
<span class="udiff-line-added">+         d.data.skipDerValue();</span>
<span class="udiff-line-added">+         Asserts.assertTrue(d.data.getBoolean());</span>
<span class="udiff-line-added">+         d.data.atEnd();</span>
      }
  }
</pre>
<center><a href="../../pkcs/pkcs8/PKCS8Test.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>