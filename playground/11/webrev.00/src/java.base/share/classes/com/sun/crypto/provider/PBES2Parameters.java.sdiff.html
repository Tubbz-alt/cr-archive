<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/com/sun/crypto/provider/PBES2Parameters.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../java/security/cert/PolicyQualifierInfo.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/com/sun/crypto/provider/PBES2Parameters.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
252         if (keyDerivationFunc.tag != DerValue.tag_Sequence) {
253             throw new IOException(&quot;PBE parameter parsing error: &quot;
254                 + &quot;not an ASN.1 SEQUENCE tag&quot;);
255         }
256         DerValue pBKDF2_params = keyDerivationFunc.data.getDerValue();
257         if (pBKDF2_params.tag != DerValue.tag_Sequence) {
258             throw new IOException(&quot;PBE parameter parsing error: &quot;
259                 + &quot;not an ASN.1 SEQUENCE tag&quot;);
260         }
261         DerValue specified = pBKDF2_params.data.getDerValue();
262         // the &#39;specified&#39; ASN.1 CHOICE for &#39;salt&#39; is supported
263         if (specified.tag == DerValue.tag_OctetString) {
264             salt = specified.getOctetString();
265         } else {
266             // the &#39;otherSource&#39; ASN.1 CHOICE for &#39;salt&#39; is not supported
267             throw new IOException(&quot;PBE parameter parsing error: &quot;
268                 + &quot;not an ASN.1 OCTET STRING tag&quot;);
269         }
270         iCount = pBKDF2_params.data.getInteger();
271 
<span class="line-removed">272         DerValue prf = null;</span>
273         // keyLength INTEGER (1..MAX) OPTIONAL,
<span class="line-modified">274         if (pBKDF2_params.data.available() &gt; 0) {</span>
<span class="line-modified">275             DerValue keyLength = pBKDF2_params.data.getDerValue();</span>
<span class="line-removed">276             if (keyLength.tag == DerValue.tag_Integer) {</span>
<span class="line-removed">277                 keysize = keyLength.getInteger() * 8; // keysize (in bits)</span>
<span class="line-removed">278             } else {</span>
<span class="line-removed">279                 // Should be the prf</span>
<span class="line-removed">280                 prf = keyLength;</span>
<span class="line-removed">281             }</span>
282         }
283         // prf AlgorithmIdentifier {{PBKDF2-PRFs}} DEFAULT algid-hmacWithSHA1
284         String kdfAlgo = &quot;HmacSHA1&quot;;
<span class="line-modified">285         if (prf == null) {</span>
<span class="line-modified">286             if (pBKDF2_params.data.available() &gt; 0) {</span>
<span class="line-removed">287                 prf = pBKDF2_params.data.getDerValue();</span>
<span class="line-removed">288             }</span>
<span class="line-removed">289         }</span>
<span class="line-removed">290         if (prf != null) {</span>
291             kdfAlgo_OID = prf.data.getOID();
292             KnownOIDs o = KnownOIDs.findMatch(kdfAlgo_OID.toString());
293             if (o == null || (!o.stdName().equals(&quot;HmacSHA1&quot;) &amp;&amp;
294                 !o.stdName().equals(&quot;HmacSHA224&quot;) &amp;&amp;
295                 !o.stdName().equals(&quot;HmacSHA256&quot;) &amp;&amp;
296                 !o.stdName().equals(&quot;HmacSHA384&quot;) &amp;&amp;
297                 !o.stdName().equals(&quot;HmacSHA512&quot;))) {
298                 throw new IOException(&quot;PBE parameter parsing error: &quot;
299                         + &quot;expecting the object identifier for a HmacSHA key &quot;
300                         + &quot;derivation function&quot;);
301             }
302             kdfAlgo = o.stdName();
<span class="line-modified">303 </span>
<span class="line-modified">304             if (prf.data.available() != 0) {</span>
<span class="line-removed">305                 // parameter is &#39;NULL&#39; for all HmacSHA KDFs</span>
<span class="line-removed">306                 DerValue parameter = prf.data.getDerValue();</span>
<span class="line-removed">307                 if (parameter.tag != DerValue.tag_Null) {</span>
<span class="line-removed">308                     throw new IOException(&quot;PBE parameter parsing error: &quot;</span>
<span class="line-removed">309                             + &quot;not an ASN.1 NULL tag&quot;);</span>
<span class="line-removed">310                 }</span>
311             }

312         }
313 
314         return kdfAlgo;
315     }
316 
317     @SuppressWarnings(&quot;deprecation&quot;)
318     private String parseES(DerValue encryptionScheme) throws IOException {
319         String cipherAlgo = null;
320 
321         cipherAlgo_OID = encryptionScheme.data.getOID();
322         if (aes128CBC_OID.equals(cipherAlgo_OID)) {
323             cipherAlgo = &quot;AES_128&quot;;
324             // parameter is AES-IV &#39;OCTET STRING (SIZE(16))&#39;
325             cipherParam =
326                 new IvParameterSpec(encryptionScheme.data.getOctetString());
327             keysize = 128;
328         } else if (aes256CBC_OID.equals(cipherAlgo_OID)) {
329             cipherAlgo = &quot;AES_256&quot;;
330             // parameter is AES-IV &#39;OCTET STRING (SIZE(16))&#39;
331             cipherParam =
</pre>
</td>
<td>
<hr />
<pre>
252         if (keyDerivationFunc.tag != DerValue.tag_Sequence) {
253             throw new IOException(&quot;PBE parameter parsing error: &quot;
254                 + &quot;not an ASN.1 SEQUENCE tag&quot;);
255         }
256         DerValue pBKDF2_params = keyDerivationFunc.data.getDerValue();
257         if (pBKDF2_params.tag != DerValue.tag_Sequence) {
258             throw new IOException(&quot;PBE parameter parsing error: &quot;
259                 + &quot;not an ASN.1 SEQUENCE tag&quot;);
260         }
261         DerValue specified = pBKDF2_params.data.getDerValue();
262         // the &#39;specified&#39; ASN.1 CHOICE for &#39;salt&#39; is supported
263         if (specified.tag == DerValue.tag_OctetString) {
264             salt = specified.getOctetString();
265         } else {
266             // the &#39;otherSource&#39; ASN.1 CHOICE for &#39;salt&#39; is not supported
267             throw new IOException(&quot;PBE parameter parsing error: &quot;
268                 + &quot;not an ASN.1 OCTET STRING tag&quot;);
269         }
270         iCount = pBKDF2_params.data.getInteger();
271 

272         // keyLength INTEGER (1..MAX) OPTIONAL,
<span class="line-modified">273         if (pBKDF2_params.data.seeOptional(DerValue.tag_Integer)) {</span>
<span class="line-modified">274             keysize = pBKDF2_params.data.getInteger() * 8; // keysize (in bits)</span>






275         }
276         // prf AlgorithmIdentifier {{PBKDF2-PRFs}} DEFAULT algid-hmacWithSHA1
277         String kdfAlgo = &quot;HmacSHA1&quot;;
<span class="line-modified">278         if (pBKDF2_params.data.available() &gt; 0) {</span>
<span class="line-modified">279             DerValue prf = pBKDF2_params.data.getDerValue();</span>




280             kdfAlgo_OID = prf.data.getOID();
281             KnownOIDs o = KnownOIDs.findMatch(kdfAlgo_OID.toString());
282             if (o == null || (!o.stdName().equals(&quot;HmacSHA1&quot;) &amp;&amp;
283                 !o.stdName().equals(&quot;HmacSHA224&quot;) &amp;&amp;
284                 !o.stdName().equals(&quot;HmacSHA256&quot;) &amp;&amp;
285                 !o.stdName().equals(&quot;HmacSHA384&quot;) &amp;&amp;
286                 !o.stdName().equals(&quot;HmacSHA512&quot;))) {
287                 throw new IOException(&quot;PBE parameter parsing error: &quot;
288                         + &quot;expecting the object identifier for a HmacSHA key &quot;
289                         + &quot;derivation function&quot;);
290             }
291             kdfAlgo = o.stdName();
<span class="line-modified">292             if (prf.data.seeOptional(t -&gt; t == DerValue.tag_Null)) {</span>
<span class="line-modified">293                 prf.data.skipDerValue();</span>






294             }
<span class="line-added">295             prf.data.atEnd();</span>
296         }
297 
298         return kdfAlgo;
299     }
300 
301     @SuppressWarnings(&quot;deprecation&quot;)
302     private String parseES(DerValue encryptionScheme) throws IOException {
303         String cipherAlgo = null;
304 
305         cipherAlgo_OID = encryptionScheme.data.getOID();
306         if (aes128CBC_OID.equals(cipherAlgo_OID)) {
307             cipherAlgo = &quot;AES_128&quot;;
308             // parameter is AES-IV &#39;OCTET STRING (SIZE(16))&#39;
309             cipherParam =
310                 new IvParameterSpec(encryptionScheme.data.getOctetString());
311             keysize = 128;
312         } else if (aes256CBC_OID.equals(cipherAlgo_OID)) {
313             cipherAlgo = &quot;AES_256&quot;;
314             // parameter is AES-IV &#39;OCTET STRING (SIZE(16))&#39;
315             cipherParam =
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../java/security/cert/PolicyQualifierInfo.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>