<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/sun/security/x509/PrivateKeyUsageExtension.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="PolicyInformation.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="X509CRLEntryImpl.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/x509/PrivateKeyUsageExtension.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 136,42 ***</span>
      throws CertificateException, IOException {
          this.extensionId = PKIXExtensions.PrivateKeyUsage_Id;
          this.critical = critical.booleanValue();
  
          this.extensionValue = (byte[]) value;
<span class="line-modified">!         DerInputStream str = new DerInputStream(this.extensionValue);</span>
<span class="line-modified">!         DerValue[] seq = str.getSequence(2);</span>
<span class="line-modified">! </span>
<span class="line-removed">-         // NB. this is always encoded with the IMPLICIT tag</span>
<span class="line-removed">-         // The checks only make sense if we assume implicit tagging,</span>
<span class="line-removed">-         // with explicit tagging the form is always constructed.</span>
<span class="line-removed">-         for (int i = 0; i &lt; seq.length; i++) {</span>
<span class="line-removed">-             DerValue opt = seq[i];</span>
<span class="line-removed">- </span>
<span class="line-removed">-             if (opt.isContextSpecific(TAG_BEFORE) &amp;&amp;</span>
<span class="line-removed">-                 !opt.isConstructed()) {</span>
<span class="line-removed">-                 if (notBefore != null) {</span>
<span class="line-removed">-                     throw new CertificateParsingException(</span>
<span class="line-removed">-                         &quot;Duplicate notBefore in PrivateKeyUsage.&quot;);</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-                 opt.resetTag(DerValue.tag_GeneralizedTime);</span>
<span class="line-removed">-                 str = new DerInputStream(opt.toByteArray());</span>
<span class="line-removed">-                 notBefore = str.getGeneralizedTime();</span>
<span class="line-removed">- </span>
<span class="line-removed">-             } else if (opt.isContextSpecific(TAG_AFTER) &amp;&amp;</span>
<span class="line-removed">-                        !opt.isConstructed()) {</span>
<span class="line-removed">-                 if (notAfter != null) {</span>
<span class="line-removed">-                     throw new CertificateParsingException(</span>
<span class="line-removed">-                         &quot;Duplicate notAfter in PrivateKeyUsage.&quot;);</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-                 opt.resetTag(DerValue.tag_GeneralizedTime);</span>
<span class="line-removed">-                 str = new DerInputStream(opt.toByteArray());</span>
<span class="line-removed">-                 notAfter = str.getGeneralizedTime();</span>
<span class="line-removed">-             } else</span>
<span class="line-removed">-                 throw new IOException(&quot;Invalid encoding of &quot; +</span>
<span class="line-removed">-                                       &quot;PrivateKeyUsageExtension&quot;);</span>
          }
      }
  
      /**
       * Return the printable string.
       */
<span class="line-new-header">--- 136,28 ---</span>
      throws CertificateException, IOException {
          this.extensionId = PKIXExtensions.PrivateKeyUsage_Id;
          this.critical = critical.booleanValue();
  
          this.extensionValue = (byte[]) value;
<span class="line-modified">!         DerValue derValue = new DerValue(this.extensionValue);</span>
<span class="line-modified">!         if (derValue.tag != DerValue.tag_Sequence) {</span>
<span class="line-modified">!             throw new IOException(&quot;Input not a SEQUNCE&quot;);</span>
          }
<span class="line-added">+ </span>
<span class="line-added">+         var v = derValue.data.getOptionalImplicitContextSpecific(</span>
<span class="line-added">+                 TAG_BEFORE, DerValue.tag_GeneralizedTime);</span>
<span class="line-added">+         if (v.isPresent()) {</span>
<span class="line-added">+             notBefore = v.get().getGeneralizedTime();</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         v = derValue.data.getOptionalImplicitContextSpecific(</span>
<span class="line-added">+                 TAG_AFTER, DerValue.tag_GeneralizedTime);</span>
<span class="line-added">+         if (v.isPresent()) {</span>
<span class="line-added">+             notAfter = v.get().getGeneralizedTime();</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         derValue.data.atEnd();</span>
      }
  
      /**
       * Return the printable string.
       */
</pre>
<center><a href="PolicyInformation.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="X509CRLEntryImpl.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>