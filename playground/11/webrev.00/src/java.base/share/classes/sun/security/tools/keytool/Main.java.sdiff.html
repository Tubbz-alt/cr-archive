<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/tools/keytool/Main.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../timestamp/TSResponse.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../util/DerInputBuffer.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/tools/keytool/Main.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
1540 
1541         PrivateKey privateKey =
1542                 (PrivateKey)recoverKey(alias, storePass, keyPass).fst;
1543         if (sigAlgName == null) {
1544             sigAlgName = getCompatibleSigAlgName(privateKey);
1545         }
1546 
1547         X509CRLEntry[] badCerts = new X509CRLEntry[ids.size()];
1548         for (int i=0; i&lt;ids.size(); i++) {
1549             String id = ids.get(i);
1550             int d = id.indexOf(&#39;:&#39;);
1551             if (d &gt;= 0) {
1552                 CRLExtensions ext = new CRLExtensions();
1553                 ext.set(&quot;Reason&quot;, new CRLReasonCodeExtension(Integer.parseInt(id.substring(d+1))));
1554                 badCerts[i] = new X509CRLEntryImpl(new BigInteger(id.substring(0, d)),
1555                         firstDate, ext);
1556             } else {
1557                 badCerts[i] = new X509CRLEntryImpl(new BigInteger(ids.get(i)), firstDate);
1558             }
1559         }
<span class="line-modified">1560         X509CRLImpl crl = new X509CRLImpl(owner, firstDate, lastDate, badCerts);</span>




1561         crl.sign(privateKey, sigAlgName);
1562         if (rfc) {
1563             out.println(&quot;-----BEGIN X509 CRL-----&quot;);
1564             out.println(Base64.getMimeEncoder(64, CRLF).encodeToString(crl.getEncodedInternal()));
1565             out.println(&quot;-----END X509 CRL-----&quot;);
1566         } else {
1567             out.write(crl.getEncodedInternal());
1568         }
1569         checkWeak(rb.getString(&quot;the.generated.crl&quot;), crl, privateKey);
1570     }
1571 
1572     /**
1573      * Creates a PKCS#10 cert signing request, corresponding to the
1574      * keys (and name) associated with a given alias.
1575      */
1576     private void doCertReq(String alias, String sigAlgName, PrintStream out)
1577         throws Exception
1578     {
1579         if (alias == null) {
1580             alias = keyAlias;
</pre>
</td>
<td>
<hr />
<pre>
1540 
1541         PrivateKey privateKey =
1542                 (PrivateKey)recoverKey(alias, storePass, keyPass).fst;
1543         if (sigAlgName == null) {
1544             sigAlgName = getCompatibleSigAlgName(privateKey);
1545         }
1546 
1547         X509CRLEntry[] badCerts = new X509CRLEntry[ids.size()];
1548         for (int i=0; i&lt;ids.size(); i++) {
1549             String id = ids.get(i);
1550             int d = id.indexOf(&#39;:&#39;);
1551             if (d &gt;= 0) {
1552                 CRLExtensions ext = new CRLExtensions();
1553                 ext.set(&quot;Reason&quot;, new CRLReasonCodeExtension(Integer.parseInt(id.substring(d+1))));
1554                 badCerts[i] = new X509CRLEntryImpl(new BigInteger(id.substring(0, d)),
1555                         firstDate, ext);
1556             } else {
1557                 badCerts[i] = new X509CRLEntryImpl(new BigInteger(ids.get(i)), firstDate);
1558             }
1559         }
<span class="line-modified">1560         CRLExtensions crlExts = new CRLExtensions();</span>
<span class="line-added">1561         AuthorityKeyIdentifierExtension ext = new AuthorityKeyIdentifierExtension(</span>
<span class="line-added">1562                 new KeyIdentifier(signerCert.getPublicKey()), null, null);</span>
<span class="line-added">1563         crlExts.set(ext.getId(), ext);</span>
<span class="line-added">1564         X509CRLImpl crl = new X509CRLImpl(owner, firstDate, lastDate, badCerts, crlExts);</span>
1565         crl.sign(privateKey, sigAlgName);
1566         if (rfc) {
1567             out.println(&quot;-----BEGIN X509 CRL-----&quot;);
1568             out.println(Base64.getMimeEncoder(64, CRLF).encodeToString(crl.getEncodedInternal()));
1569             out.println(&quot;-----END X509 CRL-----&quot;);
1570         } else {
1571             out.write(crl.getEncodedInternal());
1572         }
1573         checkWeak(rb.getString(&quot;the.generated.crl&quot;), crl, privateKey);
1574     }
1575 
1576     /**
1577      * Creates a PKCS#10 cert signing request, corresponding to the
1578      * keys (and name) associated with a given alias.
1579      */
1580     private void doCertReq(String alias, String sigAlgName, PrintStream out)
1581         throws Exception
1582     {
1583         if (alias == null) {
1584             alias = keyAlias;
</pre>
</td>
</tr>
</table>
<center><a href="../../timestamp/TSResponse.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../util/DerInputBuffer.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>