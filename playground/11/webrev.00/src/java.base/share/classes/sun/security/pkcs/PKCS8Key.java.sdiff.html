<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/pkcs/PKCS8Key.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="PKCS7.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SignerInfo.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/pkcs/PKCS8Key.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 91      * This method is also used by {@link #parseKey} to create a raw key.
 92      */
 93     protected PKCS8Key(byte[] input) throws InvalidKeyException {
 94         decode(new ByteArrayInputStream(input));
 95     }
 96 
 97     private void decode(InputStream is) throws InvalidKeyException {
 98         try {
 99             DerValue val = new DerValue(is);
100             if (val.tag != DerValue.tag_Sequence) {
101                 throw new InvalidKeyException(&quot;invalid key format&quot;);
102             }
103 
104             int version = val.data.getInteger();
105             if (version != V1 &amp;&amp; version != V2) {
106                 throw new InvalidKeyException(&quot;unknown version: &quot; + version);
107             }
108             algid = AlgorithmId.parse (val.data.getDerValue ());
109             key = val.data.getOctetString ();
110 
<span class="line-modified">111             DerValue next;</span>
<span class="line-modified">112             if (val.data.available() == 0) {</span>
<span class="line-removed">113                 return;</span>
114             }
<span class="line-modified">115             next = val.data.getDerValue();</span>
<span class="line-removed">116             if (next.isContextSpecific((byte)0)) {</span>
<span class="line-removed">117                 if (val.data.available() == 0) {</span>
<span class="line-removed">118                     return;</span>
<span class="line-removed">119                 }</span>
<span class="line-removed">120                 next = val.data.getDerValue();</span>
<span class="line-removed">121             }</span>
<span class="line-removed">122 </span>
<span class="line-removed">123             if (next.isContextSpecific((byte)1)) {</span>
124                 if (version == V1) {
125                     throw new InvalidKeyException(&quot;publicKey seen in v1&quot;);
126                 }
<span class="line-modified">127                 if (val.data.available() == 0) {</span>
<span class="line-removed">128                     return;</span>
<span class="line-removed">129                 }</span>
130             }
<span class="line-modified">131             throw new InvalidKeyException(&quot;Extra bytes&quot;);</span>
132         } catch (IOException e) {
133             throw new InvalidKeyException(&quot;IOException : &quot; + e.getMessage());
134         }
135     }
136 
137     /**
138      * Construct PKCS#8 subject public key from a DER value.  If a
139      * security provider supports the key algorithm with a specific class,
140      * a PrivateKey from the provider is returned.  Otherwise, a raw
141      * PKCS8Key object is returned.
142      *
143      * &lt;P&gt;This mechanism guarantees that keys (and algorithms) may be
144      * freely manipulated and transferred, without risk of losing
145      * information.  Also, when a key (or algorithm) needs some special
146      * handling, that specific need can be accommodated.
147      *
148      * @param in the DER-encoded SubjectPublicKeyInfo value
149      * @exception IOException on data format errors
150      */
151     public static PrivateKey parseKey(DerValue in) throws IOException {
</pre>
</td>
<td>
<hr />
<pre>
 91      * This method is also used by {@link #parseKey} to create a raw key.
 92      */
 93     protected PKCS8Key(byte[] input) throws InvalidKeyException {
 94         decode(new ByteArrayInputStream(input));
 95     }
 96 
 97     private void decode(InputStream is) throws InvalidKeyException {
 98         try {
 99             DerValue val = new DerValue(is);
100             if (val.tag != DerValue.tag_Sequence) {
101                 throw new InvalidKeyException(&quot;invalid key format&quot;);
102             }
103 
104             int version = val.data.getInteger();
105             if (version != V1 &amp;&amp; version != V2) {
106                 throw new InvalidKeyException(&quot;unknown version: &quot; + version);
107             }
108             algid = AlgorithmId.parse (val.data.getDerValue ());
109             key = val.data.getOctetString ();
110 
<span class="line-modified">111             if (val.data.seeOptionalContextSpecific(0)) {</span>
<span class="line-modified">112                 val.data.skipDerValue();</span>

113             }
<span class="line-modified">114             if (val.data.seeOptionalContextSpecific(1)) {</span>








115                 if (version == V1) {
116                     throw new InvalidKeyException(&quot;publicKey seen in v1&quot;);
117                 }
<span class="line-modified">118                 val.data.skipDerValue();</span>


119             }
<span class="line-modified">120             val.data.atEnd();</span>
121         } catch (IOException e) {
122             throw new InvalidKeyException(&quot;IOException : &quot; + e.getMessage());
123         }
124     }
125 
126     /**
127      * Construct PKCS#8 subject public key from a DER value.  If a
128      * security provider supports the key algorithm with a specific class,
129      * a PrivateKey from the provider is returned.  Otherwise, a raw
130      * PKCS8Key object is returned.
131      *
132      * &lt;P&gt;This mechanism guarantees that keys (and algorithms) may be
133      * freely manipulated and transferred, without risk of losing
134      * information.  Also, when a key (or algorithm) needs some special
135      * handling, that specific need can be accommodated.
136      *
137      * @param in the DER-encoded SubjectPublicKeyInfo value
138      * @exception IOException on data format errors
139      */
140     public static PrivateKey parseKey(DerValue in) throws IOException {
</pre>
</td>
</tr>
</table>
<center><a href="PKCS7.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SignerInfo.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>