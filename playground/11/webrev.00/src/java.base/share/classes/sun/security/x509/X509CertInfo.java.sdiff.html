<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/x509/X509CertInfo.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="X509CRLImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/jdk/sun/security/pkcs/pkcs8/PKCS8Test.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/x509/X509CertInfo.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
607             return(subjectUniqueId);
608         }
609         return null;
610     }
611 
612     /*
613      * Get the Issuer or Subject name
614      */
615     private Object getX500Name(String name, boolean getIssuer)
616         throws IOException {
617         if (name.equalsIgnoreCase(X509CertInfo.DN_NAME)) {
618             return getIssuer ? issuer : subject;
619         } else if (name.equalsIgnoreCase(&quot;x500principal&quot;)) {
620             return getIssuer ? issuer.asX500Principal()
621                              : subject.asX500Principal();
622         } else {
623             throw new IOException(&quot;Attribute name not recognized.&quot;);
624         }
625     }
626 
<span class="line-modified">627     /*</span>
628      * This routine unmarshals the certificate information.
















629      */
630     private void parse(DerValue val)
631     throws CertificateParsingException, IOException {
632         DerInputStream  in;
633         DerValue        tmp;
634 
635         if (val.tag != DerValue.tag_Sequence) {
636             throw new CertificateParsingException(&quot;signed fields invalid&quot;);
637         }
638         rawCertInfo = val.toByteArray();
639 
640         in = val.data;
641 
642         // Version
<span class="line-modified">643         tmp = in.getDerValue();</span>
<span class="line-modified">644         if (tmp.isContextSpecific((byte)0)) {</span>
<span class="line-modified">645             version = new CertificateVersion(tmp);</span>
<span class="line-modified">646             tmp = in.getDerValue();</span>

647         }
648 
649         // Serial number ... an integer
<span class="line-modified">650         serialNum = new CertificateSerialNumber(tmp);</span>
651 
652         // Algorithm Identifier
653         algId = new CertificateAlgorithmId(in);
654 
655         // Issuer name
656         issuer = new X500Name(in);
657         if (issuer.isEmpty()) {
658             throw new CertificateParsingException(
659                 &quot;Empty issuer DN not allowed in X509Certificates&quot;);
660         }
661 
662         // validity:  SEQUENCE { start date, end date }
663         interval = new CertificateValidity(in);
664 
665         // subject name
666         subject = new X500Name(in);
667         if ((version.compare(CertificateVersion.V1) == 0) &amp;&amp;
668                 subject.isEmpty()) {
669             throw new CertificateParsingException(
670                       &quot;Empty subject DN not allowed in v1 certificate&quot;);
671         }
672 
673         // public key
674         pubKey = new CertificateX509Key(in);
675 
676         // If more data available, make sure version is not v1.
677         if (in.available() != 0) {
678             if (version.compare(CertificateVersion.V1) == 0) {
679                 throw new CertificateParsingException(
680                           &quot;no more data allowed for version 1 certificate&quot;);
681             }
682         } else {
683             return;
684         }
685 
686         // Get the issuerUniqueId if present
<span class="line-modified">687         tmp = in.getDerValue();</span>
<span class="line-modified">688         if (tmp.isContextSpecific((byte)1)) {</span>
<span class="line-removed">689             issuerUniqueId = new UniqueIdentity(tmp);</span>
<span class="line-removed">690             if (in.available() == 0)</span>
<span class="line-removed">691                 return;</span>
<span class="line-removed">692             tmp = in.getDerValue();</span>
693         }
694 
695         // Get the subjectUniqueId if present.
<span class="line-modified">696         if (tmp.isContextSpecific((byte)2)) {</span>
<span class="line-modified">697             subjectUniqueId = new UniqueIdentity(tmp);</span>
<span class="line-removed">698             if (in.available() == 0)</span>
<span class="line-removed">699                 return;</span>
<span class="line-removed">700             tmp = in.getDerValue();</span>
701         }
702 
703         // Get the extensions.
<span class="line-modified">704         if (version.compare(CertificateVersion.V3) != 0) {</span>
<span class="line-modified">705             throw new CertificateParsingException(</span>
<span class="line-modified">706                       &quot;Extensions not allowed in v2 certificate&quot;);</span>
<span class="line-modified">707         }</span>
<span class="line-modified">708         if (tmp.isConstructed() &amp;&amp; tmp.isContextSpecific((byte)3)) {</span>
<span class="line-modified">709             extensions = new CertificateExtensions(tmp.data);</span>
710         }
711 
712         // verify X.509 V3 Certificate
713         verifyCert(subject, extensions);
714 
715     }
716 
717     /*
718      * Verify if X.509 V3 Certificate is compliant with RFC 5280.
719      */
720     private void verifyCert(X500Name subject,
721         CertificateExtensions extensions)
722         throws CertificateParsingException, IOException {
723 
724         // if SubjectName is empty, check for SubjectAlternativeNameExtension
725         if (subject.isEmpty()) {
726             if (extensions == null) {
727                 throw new CertificateParsingException(&quot;X.509 Certificate is &quot; +
728                         &quot;incomplete: subject field is empty, and certificate &quot; +
729                         &quot;has no extensions&quot;);
</pre>
</td>
<td>
<hr />
<pre>
607             return(subjectUniqueId);
608         }
609         return null;
610     }
611 
612     /*
613      * Get the Issuer or Subject name
614      */
615     private Object getX500Name(String name, boolean getIssuer)
616         throws IOException {
617         if (name.equalsIgnoreCase(X509CertInfo.DN_NAME)) {
618             return getIssuer ? issuer : subject;
619         } else if (name.equalsIgnoreCase(&quot;x500principal&quot;)) {
620             return getIssuer ? issuer.asX500Principal()
621                              : subject.asX500Principal();
622         } else {
623             throw new IOException(&quot;Attribute name not recognized.&quot;);
624         }
625     }
626 
<span class="line-modified">627     /**</span>
628      * This routine unmarshals the certificate information.
<span class="line-added">629      *</span>
<span class="line-added">630      *    TBSCertificate  ::=  SEQUENCE  {</span>
<span class="line-added">631      *         version         [0]  EXPLICIT Version DEFAULT v1,</span>
<span class="line-added">632      *         serialNumber         CertificateSerialNumber,</span>
<span class="line-added">633      *         signature            AlgorithmIdentifier,</span>
<span class="line-added">634      *         issuer               Name,</span>
<span class="line-added">635      *         validity             Validity,</span>
<span class="line-added">636      *         subject              Name,</span>
<span class="line-added">637      *         subjectPublicKeyInfo SubjectPublicKeyInfo,</span>
<span class="line-added">638      *         issuerUniqueID  [1]  IMPLICIT UniqueIdentifier OPTIONAL,</span>
<span class="line-added">639      *                              -- If present, version MUST be v2 or v3</span>
<span class="line-added">640      *         subjectUniqueID [2]  IMPLICIT UniqueIdentifier OPTIONAL,</span>
<span class="line-added">641      *                              -- If present, version MUST be v2 or v3</span>
<span class="line-added">642      *         extensions      [3]  EXPLICIT Extensions OPTIONAL</span>
<span class="line-added">643      *                              -- If present, version MUST be v3</span>
<span class="line-added">644      *         }</span>
645      */
646     private void parse(DerValue val)
647     throws CertificateParsingException, IOException {
648         DerInputStream  in;
649         DerValue        tmp;
650 
651         if (val.tag != DerValue.tag_Sequence) {
652             throw new CertificateParsingException(&quot;signed fields invalid&quot;);
653         }
654         rawCertInfo = val.toByteArray();
655 
656         in = val.data;
657 
658         // Version
<span class="line-modified">659         var v = in.getOptionalExplicitContextSpecific(0);</span>
<span class="line-modified">660         if (v.isPresent()) {</span>
<span class="line-modified">661             version = new CertificateVersion(v.get().getInteger());</span>
<span class="line-modified">662         } else {</span>
<span class="line-added">663             version = new CertificateVersion(CertificateVersion.V1);</span>
664         }
665 
666         // Serial number ... an integer
<span class="line-modified">667         serialNum = new CertificateSerialNumber(in.getBigInteger());</span>
668 
669         // Algorithm Identifier
670         algId = new CertificateAlgorithmId(in);
671 
672         // Issuer name
673         issuer = new X500Name(in);
674         if (issuer.isEmpty()) {
675             throw new CertificateParsingException(
676                 &quot;Empty issuer DN not allowed in X509Certificates&quot;);
677         }
678 
679         // validity:  SEQUENCE { start date, end date }
680         interval = new CertificateValidity(in);
681 
682         // subject name
683         subject = new X500Name(in);
684         if ((version.compare(CertificateVersion.V1) == 0) &amp;&amp;
685                 subject.isEmpty()) {
686             throw new CertificateParsingException(
687                       &quot;Empty subject DN not allowed in v1 certificate&quot;);
688         }
689 
690         // public key
691         pubKey = new CertificateX509Key(in);
692 
693         // If more data available, make sure version is not v1.
694         if (in.available() != 0) {
695             if (version.compare(CertificateVersion.V1) == 0) {
696                 throw new CertificateParsingException(
697                           &quot;no more data allowed for version 1 certificate&quot;);
698             }
699         } else {
700             return;
701         }
702 
703         // Get the issuerUniqueId if present
<span class="line-modified">704         if (in.seeOptionalContextSpecific(1)) {</span>
<span class="line-modified">705             issuerUniqueId = new UniqueIdentity(in.getDerValue());</span>




706         }
707 
708         // Get the subjectUniqueId if present.
<span class="line-modified">709         if (in.seeOptionalContextSpecific(2)) {</span>
<span class="line-modified">710             subjectUniqueId = new UniqueIdentity(in.getDerValue());</span>



711         }
712 
713         // Get the extensions.
<span class="line-modified">714         if (in.seeOptionalContextSpecific(3)) {</span>
<span class="line-modified">715             if (version.compare(CertificateVersion.V3) != 0) {</span>
<span class="line-modified">716                 throw new CertificateParsingException(</span>
<span class="line-modified">717                         &quot;Extensions not allowed in v2 certificate&quot;);</span>
<span class="line-modified">718             }</span>
<span class="line-modified">719             extensions = new CertificateExtensions(in.getDerValue().data);</span>
720         }
721 
722         // verify X.509 V3 Certificate
723         verifyCert(subject, extensions);
724 
725     }
726 
727     /*
728      * Verify if X.509 V3 Certificate is compliant with RFC 5280.
729      */
730     private void verifyCert(X500Name subject,
731         CertificateExtensions extensions)
732         throws CertificateParsingException, IOException {
733 
734         // if SubjectName is empty, check for SubjectAlternativeNameExtension
735         if (subject.isEmpty()) {
736             if (extensions == null) {
737                 throw new CertificateParsingException(&quot;X.509 Certificate is &quot; +
738                         &quot;incomplete: subject field is empty, and certificate &quot; +
739                         &quot;has no extensions&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="X509CRLImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/jdk/sun/security/pkcs/pkcs8/PKCS8Test.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>