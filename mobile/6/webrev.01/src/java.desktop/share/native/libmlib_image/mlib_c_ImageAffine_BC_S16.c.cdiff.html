<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.desktop/share/native/libmlib_image/mlib_c_ImageAffine_BC_S16.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="mlib_c_ImageAffine_BC.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="mlib_c_ImageAffine_BC_U16.c.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/native/libmlib_image/mlib_c_ImageAffine_BC_S16.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 66,539 ***</span>
  #define DTYPE           mlib_s16
  #define FILTER_BITS     9
  #define FUN_NAME(CHAN)  mlib_ImageAffine_s16_##CHAN##_bc
  
  /***************************************************************/
<span class="line-modified">! #ifdef __sparc /* for SPARC, using floating-point multiplies is faster */</span>
<span class="line-removed">- </span>
<span class="line-removed">- #undef  FILTER_ELEM_BITS</span>
<span class="line-removed">- #define FILTER_ELEM_BITS  4</span>
<span class="line-removed">- </span>
<span class="line-removed">- #ifdef MLIB_USE_FTOI_CLAMPING</span>
<span class="line-removed">- </span>
<span class="line-removed">- #define SAT16(DST)                                              \</span>
<span class="line-removed">-   DST = ((mlib_s32)val0) &gt;&gt; 16</span>
<span class="line-removed">- </span>
<span class="line-removed">- #else</span>
<span class="line-removed">- </span>
<span class="line-removed">- #define SAT16(DST)                                              \</span>
<span class="line-removed">-   if (val0 &gt;= MLIB_S32_MAX)                                     \</span>
<span class="line-removed">-     DST = MLIB_S16_MAX;                                         \</span>
<span class="line-removed">-   else if (val0 &lt;= MLIB_S32_MIN)                                \</span>
<span class="line-removed">-     DST = MLIB_S16_MIN;                                         \</span>
<span class="line-removed">-   else                                                          \</span>
<span class="line-removed">-     DST = ((mlib_s32)val0) &gt;&gt; 16</span>
<span class="line-removed">- </span>
<span class="line-removed">- #endif /* MLIB_USE_FTOI_CLAMPING */</span>
<span class="line-removed">- </span>
<span class="line-removed">- mlib_status FUN_NAME(1ch)(mlib_affine_param *param)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-   DECLAREVAR_BC();</span>
<span class="line-removed">-   DTYPE *dstLineEnd;</span>
<span class="line-removed">-   const mlib_f32 *mlib_filters_table;</span>
<span class="line-removed">- </span>
<span class="line-removed">-   if (filter == MLIB_BICUBIC) {</span>
<span class="line-removed">-     mlib_filters_table = mlib_filters_s16f_bc;</span>
<span class="line-removed">-   }</span>
<span class="line-removed">-   else {</span>
<span class="line-removed">-     mlib_filters_table = mlib_filters_s16f_bc2;</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- </span>
<span class="line-removed">-   for (j = yStart; j &lt;= yFinish; j++) {</span>
<span class="line-removed">-     mlib_d64 xf0, xf1, xf2, xf3;</span>
<span class="line-removed">-     mlib_d64 yf0, yf1, yf2, yf3;</span>
<span class="line-removed">-     mlib_d64 c0, c1, c2, c3, val0;</span>
<span class="line-removed">-     mlib_s32 filterpos;</span>
<span class="line-removed">-     mlib_f32 *fptr;</span>
<span class="line-removed">-     mlib_s32 s0, s1, s2, s3;</span>
<span class="line-removed">-     mlib_s32 s4, s5, s6, s7;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     CLIP(1);</span>
<span class="line-removed">-     dstLineEnd = (DTYPE *) dstData + xRight;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     filterpos = (X &gt;&gt; FILTER_SHIFT) &amp; FILTER_MASK;</span>
<span class="line-removed">-     fptr = (mlib_f32 *) ((mlib_u8 *) mlib_filters_table + filterpos);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     xf0 = fptr[0];</span>
<span class="line-removed">-     xf1 = fptr[1];</span>
<span class="line-removed">-     xf2 = fptr[2];</span>
<span class="line-removed">-     xf3 = fptr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-     filterpos = (Y &gt;&gt; FILTER_SHIFT) &amp; FILTER_MASK;</span>
<span class="line-removed">-     fptr = (mlib_f32 *) ((mlib_u8 *) mlib_filters_table + filterpos);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     yf0 = fptr[0];</span>
<span class="line-removed">-     yf1 = fptr[1];</span>
<span class="line-removed">-     yf2 = fptr[2];</span>
<span class="line-removed">-     yf3 = fptr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-     xSrc = (X &gt;&gt; MLIB_SHIFT) - 1;</span>
<span class="line-removed">-     ySrc = (Y &gt;&gt; MLIB_SHIFT) - 1;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     srcPixelPtr = ((DTYPE **) lineAddr)[ySrc] + xSrc;</span>
<span class="line-removed">-     s0 = srcPixelPtr[0];</span>
<span class="line-removed">-     s1 = srcPixelPtr[1];</span>
<span class="line-removed">-     s2 = srcPixelPtr[2];</span>
<span class="line-removed">-     s3 = srcPixelPtr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-     srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-     s4 = srcPixelPtr[0];</span>
<span class="line-removed">-     s5 = srcPixelPtr[1];</span>
<span class="line-removed">-     s6 = srcPixelPtr[2];</span>
<span class="line-removed">-     s7 = srcPixelPtr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-     for (; dstPixelPtr &lt;= (dstLineEnd - 1); dstPixelPtr++) {</span>
<span class="line-removed">- </span>
<span class="line-removed">-       X += dX;</span>
<span class="line-removed">-       Y += dY;</span>
<span class="line-removed">- </span>
<span class="line-removed">-       c0 = (s0 * xf0 + s1 * xf1 + s2 * xf2 + s3 * xf3);</span>
<span class="line-removed">-       c1 = (s4 * xf0 + s5 * xf1 + s6 * xf2 + s7 * xf3);</span>
<span class="line-removed">-       srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-       c2 = (srcPixelPtr[0] * xf0 + srcPixelPtr[1] * xf1 +</span>
<span class="line-removed">-             srcPixelPtr[2] * xf2 + srcPixelPtr[3] * xf3);</span>
<span class="line-removed">-       srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-       c3 = (srcPixelPtr[0] * xf0 + srcPixelPtr[1] * xf1 +</span>
<span class="line-removed">-             srcPixelPtr[2] * xf2 + srcPixelPtr[3] * xf3);</span>
<span class="line-removed">- </span>
<span class="line-removed">-       filterpos = (X &gt;&gt; FILTER_SHIFT) &amp; FILTER_MASK;</span>
<span class="line-removed">-       fptr = (mlib_f32 *) ((mlib_u8 *) mlib_filters_table + filterpos);</span>
<span class="line-removed">- </span>
<span class="line-removed">-       xf0 = fptr[0];</span>
<span class="line-removed">-       xf1 = fptr[1];</span>
<span class="line-removed">-       xf2 = fptr[2];</span>
<span class="line-removed">-       xf3 = fptr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-       val0 = (c0 * yf0 + c1 * yf1 + c2 * yf2 + c3 * yf3);</span>
<span class="line-removed">- </span>
<span class="line-removed">-       filterpos = (Y &gt;&gt; FILTER_SHIFT) &amp; FILTER_MASK;</span>
<span class="line-removed">-       fptr = (mlib_f32 *) ((mlib_u8 *) mlib_filters_table + filterpos);</span>
<span class="line-removed">- </span>
<span class="line-removed">-       yf0 = fptr[0];</span>
<span class="line-removed">-       yf1 = fptr[1];</span>
<span class="line-removed">-       yf2 = fptr[2];</span>
<span class="line-removed">-       yf3 = fptr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-       SAT16(dstPixelPtr[0]);</span>
<span class="line-removed">- </span>
<span class="line-removed">-       xSrc = (X &gt;&gt; MLIB_SHIFT) - 1;</span>
<span class="line-removed">-       ySrc = (Y &gt;&gt; MLIB_SHIFT) - 1;</span>
<span class="line-removed">- </span>
<span class="line-removed">-       srcPixelPtr = ((DTYPE **) lineAddr)[ySrc] + xSrc;</span>
<span class="line-removed">-       s0 = srcPixelPtr[0];</span>
<span class="line-removed">-       s1 = srcPixelPtr[1];</span>
<span class="line-removed">-       s2 = srcPixelPtr[2];</span>
<span class="line-removed">-       s3 = srcPixelPtr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-       srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-       s4 = srcPixelPtr[0];</span>
<span class="line-removed">-       s5 = srcPixelPtr[1];</span>
<span class="line-removed">-       s6 = srcPixelPtr[2];</span>
<span class="line-removed">-       s7 = srcPixelPtr[3];</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     c0 = (s0 * xf0 + s1 * xf1 + s2 * xf2 + s3 * xf3);</span>
<span class="line-removed">-     c1 = (s4 * xf0 + s5 * xf1 + s6 * xf2 + s7 * xf3);</span>
<span class="line-removed">-     srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-     c2 = (srcPixelPtr[0] * xf0 + srcPixelPtr[1] * xf1 +</span>
<span class="line-removed">-           srcPixelPtr[2] * xf2 + srcPixelPtr[3] * xf3);</span>
<span class="line-removed">-     srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-     c3 = (srcPixelPtr[0] * xf0 + srcPixelPtr[1] * xf1 +</span>
<span class="line-removed">-           srcPixelPtr[2] * xf2 + srcPixelPtr[3] * xf3);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     val0 = (c0 * yf0 + c1 * yf1 + c2 * yf2 + c3 * yf3);</span>
<span class="line-removed">-     SAT16(dstPixelPtr[0]);</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- </span>
<span class="line-removed">-   return MLIB_SUCCESS;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- mlib_status FUN_NAME(2ch)(mlib_affine_param *param)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-   DECLAREVAR_BC();</span>
<span class="line-removed">-   DTYPE *dstLineEnd;</span>
<span class="line-removed">-   const mlib_f32 *mlib_filters_table;</span>
<span class="line-removed">- </span>
<span class="line-removed">-   if (filter == MLIB_BICUBIC) {</span>
<span class="line-removed">-     mlib_filters_table = mlib_filters_s16f_bc;</span>
<span class="line-removed">-   }</span>
<span class="line-removed">-   else {</span>
<span class="line-removed">-     mlib_filters_table = mlib_filters_s16f_bc2;</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- </span>
<span class="line-removed">-   for (j = yStart; j &lt;= yFinish; j++) {</span>
<span class="line-removed">-     mlib_d64 xf0, xf1, xf2, xf3;</span>
<span class="line-removed">-     mlib_d64 yf0, yf1, yf2, yf3;</span>
<span class="line-removed">-     mlib_d64 c0, c1, c2, c3, val0;</span>
<span class="line-removed">-     mlib_s32 filterpos, k;</span>
<span class="line-removed">-     mlib_f32 *fptr;</span>
<span class="line-removed">-     mlib_s32 s0, s1, s2, s3;</span>
<span class="line-removed">-     mlib_s32 s4, s5, s6, s7;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     CLIP(2);</span>
<span class="line-removed">-     dstLineEnd = (DTYPE *) dstData + 2 * xRight;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     for (k = 0; k &lt; 2; k++) {</span>
<span class="line-removed">-       mlib_s32 X1 = X;</span>
<span class="line-removed">-       mlib_s32 Y1 = Y;</span>
<span class="line-removed">-       DTYPE *dPtr = dstPixelPtr + k;</span>
<span class="line-removed">- </span>
<span class="line-removed">-       filterpos = (X1 &gt;&gt; FILTER_SHIFT) &amp; FILTER_MASK;</span>
<span class="line-removed">-       fptr = (mlib_f32 *) ((mlib_u8 *) mlib_filters_table + filterpos);</span>
<span class="line-removed">- </span>
<span class="line-removed">-       xf0 = fptr[0];</span>
<span class="line-removed">-       xf1 = fptr[1];</span>
<span class="line-removed">-       xf2 = fptr[2];</span>
<span class="line-removed">-       xf3 = fptr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-       filterpos = (Y1 &gt;&gt; FILTER_SHIFT) &amp; FILTER_MASK;</span>
<span class="line-removed">-       fptr = (mlib_f32 *) ((mlib_u8 *) mlib_filters_table + filterpos);</span>
<span class="line-removed">- </span>
<span class="line-removed">-       yf0 = fptr[0];</span>
<span class="line-removed">-       yf1 = fptr[1];</span>
<span class="line-removed">-       yf2 = fptr[2];</span>
<span class="line-removed">-       yf3 = fptr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-       xSrc = (X1 &gt;&gt; MLIB_SHIFT) - 1;</span>
<span class="line-removed">-       ySrc = (Y1 &gt;&gt; MLIB_SHIFT) - 1;</span>
<span class="line-removed">- </span>
<span class="line-removed">-       srcPixelPtr = ((DTYPE **) lineAddr)[ySrc] + 2 * xSrc + k;</span>
<span class="line-removed">-       s0 = srcPixelPtr[0];</span>
<span class="line-removed">-       s1 = srcPixelPtr[2];</span>
<span class="line-removed">-       s2 = srcPixelPtr[4];</span>
<span class="line-removed">-       s3 = srcPixelPtr[6];</span>
<span class="line-removed">- </span>
<span class="line-removed">-       srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-       s4 = srcPixelPtr[0];</span>
<span class="line-removed">-       s5 = srcPixelPtr[2];</span>
<span class="line-removed">-       s6 = srcPixelPtr[4];</span>
<span class="line-removed">-       s7 = srcPixelPtr[6];</span>
<span class="line-removed">- </span>
<span class="line-removed">-       for (; dPtr &lt;= (dstLineEnd - 1); dPtr += 2) {</span>
<span class="line-removed">- </span>
<span class="line-removed">-         X1 += dX;</span>
<span class="line-removed">-         Y1 += dY;</span>
<span class="line-removed">- </span>
<span class="line-removed">-         c0 = (s0 * xf0 + s1 * xf1 + s2 * xf2 + s3 * xf3);</span>
<span class="line-removed">-         c1 = (s4 * xf0 + s5 * xf1 + s6 * xf2 + s7 * xf3);</span>
<span class="line-removed">-         srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-         c2 = (srcPixelPtr[0] * xf0 + srcPixelPtr[2] * xf1 +</span>
<span class="line-removed">-               srcPixelPtr[4] * xf2 + srcPixelPtr[6] * xf3);</span>
<span class="line-removed">-         srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-         c3 = (srcPixelPtr[0] * xf0 + srcPixelPtr[2] * xf1 +</span>
<span class="line-removed">-               srcPixelPtr[4] * xf2 + srcPixelPtr[6] * xf3);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         filterpos = (X1 &gt;&gt; FILTER_SHIFT) &amp; FILTER_MASK;</span>
<span class="line-removed">-         fptr = (mlib_f32 *) ((mlib_u8 *) mlib_filters_table + filterpos);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         xf0 = fptr[0];</span>
<span class="line-removed">-         xf1 = fptr[1];</span>
<span class="line-removed">-         xf2 = fptr[2];</span>
<span class="line-removed">-         xf3 = fptr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-         val0 = (c0 * yf0 + c1 * yf1 + c2 * yf2 + c3 * yf3);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         filterpos = (Y1 &gt;&gt; FILTER_SHIFT) &amp; FILTER_MASK;</span>
<span class="line-removed">-         fptr = (mlib_f32 *) ((mlib_u8 *) mlib_filters_table + filterpos);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         yf0 = fptr[0];</span>
<span class="line-removed">-         yf1 = fptr[1];</span>
<span class="line-removed">-         yf2 = fptr[2];</span>
<span class="line-removed">-         yf3 = fptr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-         SAT16(dPtr[0]);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         xSrc = (X1 &gt;&gt; MLIB_SHIFT) - 1;</span>
<span class="line-removed">-         ySrc = (Y1 &gt;&gt; MLIB_SHIFT) - 1;</span>
<span class="line-removed">- </span>
<span class="line-removed">-         srcPixelPtr = ((DTYPE **) lineAddr)[ySrc] + 2 * xSrc + k;</span>
<span class="line-removed">-         s0 = srcPixelPtr[0];</span>
<span class="line-removed">-         s1 = srcPixelPtr[2];</span>
<span class="line-removed">-         s2 = srcPixelPtr[4];</span>
<span class="line-removed">-         s3 = srcPixelPtr[6];</span>
<span class="line-removed">- </span>
<span class="line-removed">-         srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-         s4 = srcPixelPtr[0];</span>
<span class="line-removed">-         s5 = srcPixelPtr[2];</span>
<span class="line-removed">-         s6 = srcPixelPtr[4];</span>
<span class="line-removed">-         s7 = srcPixelPtr[6];</span>
<span class="line-removed">-       }</span>
<span class="line-removed">- </span>
<span class="line-removed">-       c0 = (s0 * xf0 + s1 * xf1 + s2 * xf2 + s3 * xf3);</span>
<span class="line-removed">-       c1 = (s4 * xf0 + s5 * xf1 + s6 * xf2 + s7 * xf3);</span>
<span class="line-removed">-       srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-       c2 = (srcPixelPtr[0] * xf0 + srcPixelPtr[2] * xf1 +</span>
<span class="line-removed">-             srcPixelPtr[4] * xf2 + srcPixelPtr[6] * xf3);</span>
<span class="line-removed">-       srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-       c3 = (srcPixelPtr[0] * xf0 + srcPixelPtr[2] * xf1 +</span>
<span class="line-removed">-             srcPixelPtr[4] * xf2 + srcPixelPtr[6] * xf3);</span>
<span class="line-removed">- </span>
<span class="line-removed">-       val0 = (c0 * yf0 + c1 * yf1 + c2 * yf2 + c3 * yf3);</span>
<span class="line-removed">-       SAT16(dPtr[0]);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- </span>
<span class="line-removed">-   return MLIB_SUCCESS;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- mlib_status FUN_NAME(3ch)(mlib_affine_param *param)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-   DECLAREVAR_BC();</span>
<span class="line-removed">-   DTYPE *dstLineEnd;</span>
<span class="line-removed">-   const mlib_f32 *mlib_filters_table;</span>
<span class="line-removed">- </span>
<span class="line-removed">-   if (filter == MLIB_BICUBIC) {</span>
<span class="line-removed">-     mlib_filters_table = mlib_filters_s16f_bc;</span>
<span class="line-removed">-   }</span>
<span class="line-removed">-   else {</span>
<span class="line-removed">-     mlib_filters_table = mlib_filters_s16f_bc2;</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- </span>
<span class="line-removed">-   for (j = yStart; j &lt;= yFinish; j++) {</span>
<span class="line-removed">-     mlib_d64 xf0, xf1, xf2, xf3;</span>
<span class="line-removed">-     mlib_d64 yf0, yf1, yf2, yf3;</span>
<span class="line-removed">-     mlib_d64 c0, c1, c2, c3, val0;</span>
<span class="line-removed">-     mlib_s32 filterpos, k;</span>
<span class="line-removed">-     mlib_f32 *fptr;</span>
<span class="line-removed">-     mlib_s32 s0, s1, s2, s3;</span>
<span class="line-removed">-     mlib_s32 s4, s5, s6, s7;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     CLIP(3);</span>
<span class="line-removed">-     dstLineEnd = (DTYPE *) dstData + 3 * xRight;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     for (k = 0; k &lt; 3; k++) {</span>
<span class="line-removed">-       mlib_s32 X1 = X;</span>
<span class="line-removed">-       mlib_s32 Y1 = Y;</span>
<span class="line-removed">-       DTYPE *dPtr = dstPixelPtr + k;</span>
<span class="line-removed">- </span>
<span class="line-removed">-       filterpos = (X1 &gt;&gt; FILTER_SHIFT) &amp; FILTER_MASK;</span>
<span class="line-removed">-       fptr = (mlib_f32 *) ((mlib_u8 *) mlib_filters_table + filterpos);</span>
<span class="line-removed">- </span>
<span class="line-removed">-       xf0 = fptr[0];</span>
<span class="line-removed">-       xf1 = fptr[1];</span>
<span class="line-removed">-       xf2 = fptr[2];</span>
<span class="line-removed">-       xf3 = fptr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-       filterpos = (Y1 &gt;&gt; FILTER_SHIFT) &amp; FILTER_MASK;</span>
<span class="line-removed">-       fptr = (mlib_f32 *) ((mlib_u8 *) mlib_filters_table + filterpos);</span>
<span class="line-removed">- </span>
<span class="line-removed">-       yf0 = fptr[0];</span>
<span class="line-removed">-       yf1 = fptr[1];</span>
<span class="line-removed">-       yf2 = fptr[2];</span>
<span class="line-removed">-       yf3 = fptr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-       xSrc = (X1 &gt;&gt; MLIB_SHIFT) - 1;</span>
<span class="line-removed">-       ySrc = (Y1 &gt;&gt; MLIB_SHIFT) - 1;</span>
<span class="line-removed">- </span>
<span class="line-removed">-       srcPixelPtr = ((DTYPE **) lineAddr)[ySrc] + 3 * xSrc + k;</span>
<span class="line-removed">-       s0 = srcPixelPtr[0];</span>
<span class="line-removed">-       s1 = srcPixelPtr[3];</span>
<span class="line-removed">-       s2 = srcPixelPtr[6];</span>
<span class="line-removed">-       s3 = srcPixelPtr[9];</span>
<span class="line-removed">- </span>
<span class="line-removed">-       srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-       s4 = srcPixelPtr[0];</span>
<span class="line-removed">-       s5 = srcPixelPtr[3];</span>
<span class="line-removed">-       s6 = srcPixelPtr[6];</span>
<span class="line-removed">-       s7 = srcPixelPtr[9];</span>
<span class="line-removed">- </span>
<span class="line-removed">-       for (; dPtr &lt;= (dstLineEnd - 1); dPtr += 3) {</span>
<span class="line-removed">- </span>
<span class="line-removed">-         X1 += dX;</span>
<span class="line-removed">-         Y1 += dY;</span>
<span class="line-removed">- </span>
<span class="line-removed">-         c0 = (s0 * xf0 + s1 * xf1 + s2 * xf2 + s3 * xf3);</span>
<span class="line-removed">-         c1 = (s4 * xf0 + s5 * xf1 + s6 * xf2 + s7 * xf3);</span>
<span class="line-removed">-         srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-         c2 = (srcPixelPtr[0] * xf0 + srcPixelPtr[3] * xf1 +</span>
<span class="line-removed">-               srcPixelPtr[6] * xf2 + srcPixelPtr[9] * xf3);</span>
<span class="line-removed">-         srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-         c3 = (srcPixelPtr[0] * xf0 + srcPixelPtr[3] * xf1 +</span>
<span class="line-removed">-               srcPixelPtr[6] * xf2 + srcPixelPtr[9] * xf3);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         filterpos = (X1 &gt;&gt; FILTER_SHIFT) &amp; FILTER_MASK;</span>
<span class="line-removed">-         fptr = (mlib_f32 *) ((mlib_u8 *) mlib_filters_table + filterpos);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         xf0 = fptr[0];</span>
<span class="line-removed">-         xf1 = fptr[1];</span>
<span class="line-removed">-         xf2 = fptr[2];</span>
<span class="line-removed">-         xf3 = fptr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-         val0 = (c0 * yf0 + c1 * yf1 + c2 * yf2 + c3 * yf3);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         filterpos = (Y1 &gt;&gt; FILTER_SHIFT) &amp; FILTER_MASK;</span>
<span class="line-removed">-         fptr = (mlib_f32 *) ((mlib_u8 *) mlib_filters_table + filterpos);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         yf0 = fptr[0];</span>
<span class="line-removed">-         yf1 = fptr[1];</span>
<span class="line-removed">-         yf2 = fptr[2];</span>
<span class="line-removed">-         yf3 = fptr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-         SAT16(dPtr[0]);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         xSrc = (X1 &gt;&gt; MLIB_SHIFT) - 1;</span>
<span class="line-removed">-         ySrc = (Y1 &gt;&gt; MLIB_SHIFT) - 1;</span>
<span class="line-removed">- </span>
<span class="line-removed">-         srcPixelPtr = ((DTYPE **) lineAddr)[ySrc] + 3 * xSrc + k;</span>
<span class="line-removed">-         s0 = srcPixelPtr[0];</span>
<span class="line-removed">-         s1 = srcPixelPtr[3];</span>
<span class="line-removed">-         s2 = srcPixelPtr[6];</span>
<span class="line-removed">-         s3 = srcPixelPtr[9];</span>
<span class="line-removed">- </span>
<span class="line-removed">-         srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-         s4 = srcPixelPtr[0];</span>
<span class="line-removed">-         s5 = srcPixelPtr[3];</span>
<span class="line-removed">-         s6 = srcPixelPtr[6];</span>
<span class="line-removed">-         s7 = srcPixelPtr[9];</span>
<span class="line-removed">-       }</span>
<span class="line-removed">- </span>
<span class="line-removed">-       c0 = (s0 * xf0 + s1 * xf1 + s2 * xf2 + s3 * xf3);</span>
<span class="line-removed">-       c1 = (s4 * xf0 + s5 * xf1 + s6 * xf2 + s7 * xf3);</span>
<span class="line-removed">-       srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-       c2 = (srcPixelPtr[0] * xf0 + srcPixelPtr[3] * xf1 +</span>
<span class="line-removed">-             srcPixelPtr[6] * xf2 + srcPixelPtr[9] * xf3);</span>
<span class="line-removed">-       srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-       c3 = (srcPixelPtr[0] * xf0 + srcPixelPtr[3] * xf1 +</span>
<span class="line-removed">-             srcPixelPtr[6] * xf2 + srcPixelPtr[9] * xf3);</span>
<span class="line-removed">- </span>
<span class="line-removed">-       val0 = (c0 * yf0 + c1 * yf1 + c2 * yf2 + c3 * yf3);</span>
<span class="line-removed">-       SAT16(dPtr[0]);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- </span>
<span class="line-removed">-   return MLIB_SUCCESS;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- mlib_status FUN_NAME(4ch)(mlib_affine_param *param)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-   DECLAREVAR_BC();</span>
<span class="line-removed">-   DTYPE *dstLineEnd;</span>
<span class="line-removed">-   const mlib_f32 *mlib_filters_table;</span>
<span class="line-removed">- </span>
<span class="line-removed">-   if (filter == MLIB_BICUBIC) {</span>
<span class="line-removed">-     mlib_filters_table = mlib_filters_s16f_bc;</span>
<span class="line-removed">-   }</span>
<span class="line-removed">-   else {</span>
<span class="line-removed">-     mlib_filters_table = mlib_filters_s16f_bc2;</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- </span>
<span class="line-removed">-   for (j = yStart; j &lt;= yFinish; j++) {</span>
<span class="line-removed">-     mlib_d64 xf0, xf1, xf2, xf3;</span>
<span class="line-removed">-     mlib_d64 yf0, yf1, yf2, yf3;</span>
<span class="line-removed">-     mlib_d64 c0, c1, c2, c3, val0;</span>
<span class="line-removed">-     mlib_s32 filterpos, k;</span>
<span class="line-removed">-     mlib_f32 *fptr;</span>
<span class="line-removed">-     mlib_s32 s0, s1, s2, s3;</span>
<span class="line-removed">-     mlib_s32 s4, s5, s6, s7;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     CLIP(4);</span>
<span class="line-removed">-     dstLineEnd = (DTYPE *) dstData + 4 * xRight;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     for (k = 0; k &lt; 4; k++) {</span>
<span class="line-removed">-       mlib_s32 X1 = X;</span>
<span class="line-removed">-       mlib_s32 Y1 = Y;</span>
<span class="line-removed">-       DTYPE *dPtr = dstPixelPtr + k;</span>
<span class="line-removed">- </span>
<span class="line-removed">-       filterpos = (X1 &gt;&gt; FILTER_SHIFT) &amp; FILTER_MASK;</span>
<span class="line-removed">-       fptr = (mlib_f32 *) ((mlib_u8 *) mlib_filters_table + filterpos);</span>
<span class="line-removed">- </span>
<span class="line-removed">-       xf0 = fptr[0];</span>
<span class="line-removed">-       xf1 = fptr[1];</span>
<span class="line-removed">-       xf2 = fptr[2];</span>
<span class="line-removed">-       xf3 = fptr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-       filterpos = (Y1 &gt;&gt; FILTER_SHIFT) &amp; FILTER_MASK;</span>
<span class="line-removed">-       fptr = (mlib_f32 *) ((mlib_u8 *) mlib_filters_table + filterpos);</span>
<span class="line-removed">- </span>
<span class="line-removed">-       yf0 = fptr[0];</span>
<span class="line-removed">-       yf1 = fptr[1];</span>
<span class="line-removed">-       yf2 = fptr[2];</span>
<span class="line-removed">-       yf3 = fptr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-       xSrc = (X1 &gt;&gt; MLIB_SHIFT) - 1;</span>
<span class="line-removed">-       ySrc = (Y1 &gt;&gt; MLIB_SHIFT) - 1;</span>
<span class="line-removed">- </span>
<span class="line-removed">-       srcPixelPtr = ((DTYPE **) lineAddr)[ySrc] + 4 * xSrc + k;</span>
<span class="line-removed">-       s0 = srcPixelPtr[0];</span>
<span class="line-removed">-       s1 = srcPixelPtr[4];</span>
<span class="line-removed">-       s2 = srcPixelPtr[8];</span>
<span class="line-removed">-       s3 = srcPixelPtr[12];</span>
<span class="line-removed">- </span>
<span class="line-removed">-       srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-       s4 = srcPixelPtr[0];</span>
<span class="line-removed">-       s5 = srcPixelPtr[4];</span>
<span class="line-removed">-       s6 = srcPixelPtr[8];</span>
<span class="line-removed">-       s7 = srcPixelPtr[12];</span>
<span class="line-removed">- </span>
<span class="line-removed">-       for (; dPtr &lt;= (dstLineEnd - 1); dPtr += 4) {</span>
<span class="line-removed">- </span>
<span class="line-removed">-         X1 += dX;</span>
<span class="line-removed">-         Y1 += dY;</span>
<span class="line-removed">- </span>
<span class="line-removed">-         c0 = (s0 * xf0 + s1 * xf1 + s2 * xf2 + s3 * xf3);</span>
<span class="line-removed">-         c1 = (s4 * xf0 + s5 * xf1 + s6 * xf2 + s7 * xf3);</span>
<span class="line-removed">-         srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-         c2 = (srcPixelPtr[0] * xf0 + srcPixelPtr[4] * xf1 +</span>
<span class="line-removed">-               srcPixelPtr[8] * xf2 + srcPixelPtr[12] * xf3);</span>
<span class="line-removed">-         srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-         c3 = (srcPixelPtr[0] * xf0 + srcPixelPtr[4] * xf1 +</span>
<span class="line-removed">-               srcPixelPtr[8] * xf2 + srcPixelPtr[12] * xf3);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         filterpos = (X1 &gt;&gt; FILTER_SHIFT) &amp; FILTER_MASK;</span>
<span class="line-removed">-         fptr = (mlib_f32 *) ((mlib_u8 *) mlib_filters_table + filterpos);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         xf0 = fptr[0];</span>
<span class="line-removed">-         xf1 = fptr[1];</span>
<span class="line-removed">-         xf2 = fptr[2];</span>
<span class="line-removed">-         xf3 = fptr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-         val0 = (c0 * yf0 + c1 * yf1 + c2 * yf2 + c3 * yf3);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         filterpos = (Y1 &gt;&gt; FILTER_SHIFT) &amp; FILTER_MASK;</span>
<span class="line-removed">-         fptr = (mlib_f32 *) ((mlib_u8 *) mlib_filters_table + filterpos);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         yf0 = fptr[0];</span>
<span class="line-removed">-         yf1 = fptr[1];</span>
<span class="line-removed">-         yf2 = fptr[2];</span>
<span class="line-removed">-         yf3 = fptr[3];</span>
<span class="line-removed">- </span>
<span class="line-removed">-         SAT16(dPtr[0]);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         xSrc = (X1 &gt;&gt; MLIB_SHIFT) - 1;</span>
<span class="line-removed">-         ySrc = (Y1 &gt;&gt; MLIB_SHIFT) - 1;</span>
<span class="line-removed">- </span>
<span class="line-removed">-         srcPixelPtr = ((DTYPE **) lineAddr)[ySrc] + 4 * xSrc + k;</span>
<span class="line-removed">-         s0 = srcPixelPtr[0];</span>
<span class="line-removed">-         s1 = srcPixelPtr[4];</span>
<span class="line-removed">-         s2 = srcPixelPtr[8];</span>
<span class="line-removed">-         s3 = srcPixelPtr[12];</span>
<span class="line-removed">- </span>
<span class="line-removed">-         srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-         s4 = srcPixelPtr[0];</span>
<span class="line-removed">-         s5 = srcPixelPtr[4];</span>
<span class="line-removed">-         s6 = srcPixelPtr[8];</span>
<span class="line-removed">-         s7 = srcPixelPtr[12];</span>
<span class="line-removed">-       }</span>
<span class="line-removed">- </span>
<span class="line-removed">-       c0 = (s0 * xf0 + s1 * xf1 + s2 * xf2 + s3 * xf3);</span>
<span class="line-removed">-       c1 = (s4 * xf0 + s5 * xf1 + s6 * xf2 + s7 * xf3);</span>
<span class="line-removed">-       srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-       c2 = (srcPixelPtr[0] * xf0 + srcPixelPtr[4] * xf1 +</span>
<span class="line-removed">-             srcPixelPtr[8] * xf2 + srcPixelPtr[12] * xf3);</span>
<span class="line-removed">-       srcPixelPtr = (DTYPE *) ((mlib_addr) srcPixelPtr + srcYStride);</span>
<span class="line-removed">-       c3 = (srcPixelPtr[0] * xf0 + srcPixelPtr[4] * xf1 +</span>
<span class="line-removed">-             srcPixelPtr[8] * xf2 + srcPixelPtr[12] * xf3);</span>
<span class="line-removed">- </span>
<span class="line-removed">-       val0 = (c0 * yf0 + c1 * yf1 + c2 * yf2 + c3 * yf3);</span>
<span class="line-removed">-       SAT16(dPtr[0]);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- </span>
<span class="line-removed">-   return MLIB_SUCCESS;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- #else       /* for x86, using integer multiplies is faster */</span>
  
  #define SHIFT_X  15
  #define ROUND_X  0 /* (1 &lt;&lt; (SHIFT_X - 1)) */
  
  #define SHIFT_Y  (15 + 15 - SHIFT_X)
<span class="line-new-header">--- 66,11 ---</span>
  #define DTYPE           mlib_s16
  #define FILTER_BITS     9
  #define FUN_NAME(CHAN)  mlib_ImageAffine_s16_##CHAN##_bc
  
  /***************************************************************/
<span class="line-modified">! /* for x86, using integer multiplies is faster */</span>
  
  #define SHIFT_X  15
  #define ROUND_X  0 /* (1 &lt;&lt; (SHIFT_X - 1)) */
  
  #define SHIFT_Y  (15 + 15 - SHIFT_X)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1116,8 ***</span>
    }
  
    return MLIB_SUCCESS;
  }
  
<span class="line-removed">- #endif /* __sparc ( for SPARC, using floating-point multiplies is faster ) */</span>
<span class="line-removed">- </span>
  /***************************************************************/
<span class="line-new-header">--- 588,6 ---</span>
</pre>
<center><a href="mlib_c_ImageAffine_BC.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="mlib_c_ImageAffine_BC_U16.c.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>