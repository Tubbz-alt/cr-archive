<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.desktop/share/classes/sun/font/TrueTypeGlyphMapper.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="TrueTypeFont.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="Type1Font.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/share/classes/sun/font/TrueTypeGlyphMapper.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2003, 2017, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2003, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -36,11 +36,10 @@</span>
      /* if running on Solaris and default Locale is ja_JP then
       * we map need to remap reverse solidus (backslash) to Yen as
       * apparently expected there.
       */
      static final boolean isJAlocale = Locale.JAPAN.equals(Locale.getDefault());
<span class="udiff-line-removed">-     private final boolean needsJAremapping;</span>
  
      TrueTypeFont font;
      CMap cmap;
      int numGlyphs;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -59,15 +58,10 @@</span>
          if (buffer != null &amp;&amp; buffer.capacity() &gt;= 6) {
              numGlyphs = buffer.getChar(4); // offset 4 bytes in MAXP table.
          } else {
              handleBadCMAP();
          }
<span class="udiff-line-removed">-         if (FontUtilities.isSolaris &amp;&amp; isJAlocale &amp;&amp; font.supportsJA()) {</span>
<span class="udiff-line-removed">-             needsJAremapping = true;</span>
<span class="udiff-line-removed">-         } else {</span>
<span class="udiff-line-removed">-             needsJAremapping = false;</span>
<span class="udiff-line-removed">-         }</span>
      }
  
      public int getNumGlyphs() {
          return numGlyphs;
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -139,66 +133,35 @@</span>
      private int remapJAIntChar(int unicode) {
          return (unicode == REVERSE_SOLIDUS) ? JA_YEN : unicode;
      }
  
      public int charToGlyph(char unicode) {
<span class="udiff-line-removed">-         if (needsJAremapping) {</span>
<span class="udiff-line-removed">-             unicode = remapJAChar(unicode);</span>
<span class="udiff-line-removed">-         }</span>
          int glyph = getGlyphFromCMAP(unicode);
<span class="udiff-line-removed">-         if (font.checkUseNatives() &amp;&amp; glyph &lt; font.glyphToCharMap.length) {</span>
<span class="udiff-line-removed">-             font.glyphToCharMap[glyph] = unicode;</span>
<span class="udiff-line-removed">-         }</span>
          return glyph;
      }
  
      public int charToGlyph(int unicode) {
<span class="udiff-line-removed">-         if (needsJAremapping) {</span>
<span class="udiff-line-removed">-             unicode = remapJAIntChar(unicode);</span>
<span class="udiff-line-removed">-         }</span>
          int glyph = getGlyphFromCMAP(unicode);
<span class="udiff-line-removed">-         if (font.checkUseNatives() &amp;&amp; glyph &lt; font.glyphToCharMap.length) {</span>
<span class="udiff-line-removed">-             font.glyphToCharMap[glyph] = (char)unicode;</span>
<span class="udiff-line-removed">-         }</span>
          return glyph;
      }
  
      @Override
      public int charToVariationGlyph(int unicode, int variationSelector) {
<span class="udiff-line-removed">-         if (needsJAremapping) {</span>
<span class="udiff-line-removed">-             unicode = remapJAIntChar(unicode);</span>
<span class="udiff-line-removed">-         }</span>
          int glyph = getGlyphFromCMAP(unicode, variationSelector);
<span class="udiff-line-removed">-         if (font.checkUseNatives() &amp;&amp; glyph &lt; font.glyphToCharMap.length) {</span>
<span class="udiff-line-removed">-             font.glyphToCharMap[glyph] = (char)unicode;</span>
<span class="udiff-line-removed">-         }</span>
          return glyph;
      }
  
      public void charsToGlyphs(int count, int[] unicodes, int[] glyphs) {
          for (int i=0;i&lt;count;i++) {
<span class="udiff-line-modified-removed">-             if (needsJAremapping) {</span>
<span class="udiff-line-removed">-                 glyphs[i] = getGlyphFromCMAP(remapJAIntChar(unicodes[i]));</span>
<span class="udiff-line-removed">-             } else {</span>
<span class="udiff-line-removed">-                 glyphs[i] = getGlyphFromCMAP(unicodes[i]);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             if (font.checkUseNatives() &amp;&amp;</span>
<span class="udiff-line-removed">-                 glyphs[i] &lt; font.glyphToCharMap.length) {</span>
<span class="udiff-line-removed">-                 font.glyphToCharMap[glyphs[i]] = (char)unicodes[i];</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-modified-added">+             glyphs[i] = getGlyphFromCMAP(unicodes[i]);</span>
          }
      }
  
      public void charsToGlyphs(int count, char[] unicodes, int[] glyphs) {
  
          for (int i=0; i&lt;count; i++) {
<span class="udiff-line-modified-removed">-             int code;</span>
<span class="udiff-line-removed">-             if (needsJAremapping) {</span>
<span class="udiff-line-removed">-                 code = remapJAChar(unicodes[i]);</span>
<span class="udiff-line-removed">-             } else {</span>
<span class="udiff-line-removed">-                 code = unicodes[i]; // char is unsigned.</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-modified-added">+             int code = unicodes[i]; // char is unsigned.</span>
  
              if (code &gt;= HI_SURROGATE_START &amp;&amp;
                  code &lt;= HI_SURROGATE_END &amp;&amp; i &lt; count - 1) {
                  char low = unicodes[i + 1];
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -213,15 +176,10 @@</span>
                      continue;
                  }
              }
              glyphs[i] = getGlyphFromCMAP(code);
  
<span class="udiff-line-removed">-             if (font.checkUseNatives() &amp;&amp;</span>
<span class="udiff-line-removed">-                 glyphs[i] &lt; font.glyphToCharMap.length) {</span>
<span class="udiff-line-removed">-                 font.glyphToCharMap[glyphs[i]] = (char)code;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">- </span>
          }
      }
  
      /* This variant checks if shaping is needed and immediately
       * returns true if it does. A caller of this method should be expecting
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -229,16 +187,11 @@</span>
       * the character data for display.
       */
      public boolean charsToGlyphsNS(int count, char[] unicodes, int[] glyphs) {
  
          for (int i=0; i&lt;count; i++) {
<span class="udiff-line-modified-removed">-             int code;</span>
<span class="udiff-line-removed">-             if (needsJAremapping) {</span>
<span class="udiff-line-removed">-                 code = remapJAChar(unicodes[i]);</span>
<span class="udiff-line-removed">-             } else {</span>
<span class="udiff-line-removed">-                 code = unicodes[i]; // char is unsigned.</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-modified-added">+             int code = unicodes[i]; // char is unsigned.</span>
  
              if (code &gt;= HI_SURROGATE_START &amp;&amp;
                  code &lt;= HI_SURROGATE_END &amp;&amp; i &lt; count - 1) {
                  char low = unicodes[i + 1];
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -249,14 +202,10 @@</span>
                      glyphs[i + 1] = INVISIBLE_GLYPH_ID;
                  }
              }
  
              glyphs[i] = getGlyphFromCMAP(code);
<span class="udiff-line-removed">-             if (font.checkUseNatives() &amp;&amp;</span>
<span class="udiff-line-removed">-                 glyphs[i] &lt; font.glyphToCharMap.length) {</span>
<span class="udiff-line-removed">-                 font.glyphToCharMap[glyphs[i]] = (char)code;</span>
<span class="udiff-line-removed">-             }</span>
  
              if (code &lt; FontUtilities.MIN_LAYOUT_CHARCODE) {
                  continue;
              }
              else if (FontUtilities.isComplexCharCode(code) ||
</pre>
<center><a href="TrueTypeFont.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="Type1Font.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>