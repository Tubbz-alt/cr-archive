<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/unix/native/libnet/ResolverConfigurationImpl.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="PlainSocketImpl.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="SdpSupport.c.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/unix/native/libnet/ResolverConfigurationImpl.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2002, 2012, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2002, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -26,47 +26,19 @@</span>
  #include &lt;stdio.h&gt;
  #include &lt;stdlib.h&gt;
  #include &lt;unistd.h&gt;
  #include &lt;errno.h&gt;
  
<span class="udiff-line-removed">- #ifdef __solaris__</span>
<span class="udiff-line-removed">- #include &lt;sys/systeminfo.h&gt;</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">- </span>
  #include &lt;string.h&gt;
  
  #include &quot;jni.h&quot;
  
  #ifndef MAXDNAME
  #define MAXDNAME                1025
  #endif
  
  
<span class="udiff-line-removed">- /*</span>
<span class="udiff-line-removed">-  * Class:     sun_net_dns_ResolverConfigurationImpl</span>
<span class="udiff-line-removed">-  * Method:    localDomain0</span>
<span class="udiff-line-removed">-  * Signature: ()Ljava/lang/String;</span>
<span class="udiff-line-removed">-  */</span>
<span class="udiff-line-removed">- JNIEXPORT jstring JNICALL</span>
<span class="udiff-line-removed">- Java_sun_net_dns_ResolverConfigurationImpl_localDomain0(JNIEnv *env, jclass cls)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     /*</span>
<span class="udiff-line-removed">-      * On Solaris the LOCALDOMAIN environment variable has absolute</span>
<span class="udiff-line-removed">-      * priority.</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">- #ifdef __solaris__</span>
<span class="udiff-line-removed">-     {</span>
<span class="udiff-line-removed">-         char *cp = getenv(&quot;LOCALDOMAIN&quot;);</span>
<span class="udiff-line-removed">-         if (cp != NULL) {</span>
<span class="udiff-line-removed">-             jstring s = (*env)-&gt;NewStringUTF(env, cp);</span>
<span class="udiff-line-removed">-             return s;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">-     return (jstring)NULL;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  /*
   * Class:     sun_net_dns_ResolverConfigurationImpl
   * Method:    loadConfig0
   * Signature: ()Ljava/lang/String;
   */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -74,40 +46,14 @@</span>
  Java_sun_net_dns_ResolverConfigurationImpl_fallbackDomain0(JNIEnv *env, jclass cls)
  {
      char buf[MAXDNAME];
  
      /*
<span class="udiff-line-modified-removed">-      * On Solaris if domain or search directives aren&#39;t specified</span>
<span class="udiff-line-removed">-      * in /etc/resolv.conf then sysinfo or gethostname is used to</span>
<span class="udiff-line-removed">-      * determine the domain name.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * On Linux if domain or search directives aren&#39;t specified</span>
<span class="udiff-line-modified-added">+      * If domain or search directives aren&#39;t specified</span>
       * then gethostname is used.
       */
  
<span class="udiff-line-removed">- #ifdef __solaris__</span>
<span class="udiff-line-removed">-     {</span>
<span class="udiff-line-removed">-         int ret = sysinfo(SI_SRPC_DOMAIN, buf, sizeof(buf));</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if ((ret &gt; 0) &amp;&amp; (ret&lt;sizeof(buf))) {</span>
<span class="udiff-line-removed">-             char *cp;</span>
<span class="udiff-line-removed">-             jstring s;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             if (buf[0] == &#39;+&#39;) {</span>
<span class="udiff-line-removed">-                 buf[0] = &#39;.&#39;;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             cp = strchr(buf, &#39;.&#39;);</span>
<span class="udiff-line-removed">-             if (cp == NULL) {</span>
<span class="udiff-line-removed">-                 s = (*env)-&gt;NewStringUTF(env, buf);</span>
<span class="udiff-line-removed">-             } else {</span>
<span class="udiff-line-removed">-                 s = (*env)-&gt;NewStringUTF(env, cp+1);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             return s;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">- </span>
      if (gethostname(buf, sizeof(buf)) == 0) {
          char *cp;
  
          /* gethostname doesn&#39;t null terminate if insufficient space */
          buf[sizeof(buf)-1] = &#39;\0&#39;;
</pre>
<center><a href="PlainSocketImpl.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="SdpSupport.c.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>