<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/unix/native/libnet/PlainDatagramSocketImpl.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="NetworkInterface.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="PlainSocketImpl.c.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/unix/native/libnet/PlainDatagramSocketImpl.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 1997, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 25,14 ***</span>
  #include &lt;errno.h&gt;
  #include &lt;stdlib.h&gt;
  #include &lt;string.h&gt;
  #include &lt;sys/ioctl.h&gt;
  
<span class="line-removed">- #if defined(__solaris__)</span>
<span class="line-removed">- #include &lt;sys/filio.h&gt;</span>
<span class="line-removed">- #endif</span>
<span class="line-removed">- </span>
  #include &quot;net_util.h&quot;
  
  #include &quot;java_net_PlainDatagramSocketImpl.h&quot;
  #include &quot;java_net_InetAddress.h&quot;
  #include &quot;java_net_NetworkInterface.h&quot;
<span class="line-new-header">--- 25,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 50,16 ***</span>
  #ifndef IP_MULTICAST_ALL
  #define IP_MULTICAST_ALL      49
  #endif
  #endif  //  __linux__
  
<span class="line-removed">- #ifdef __solaris__</span>
<span class="line-removed">- #ifndef BSD_COMP</span>
<span class="line-removed">- #define BSD_COMP</span>
<span class="line-removed">- #endif</span>
<span class="line-removed">- #endif</span>
<span class="line-removed">- </span>
  #ifndef IPTOS_TOS_MASK
  #define IPTOS_TOS_MASK 0x1e
  #endif
  #ifndef IPTOS_PREC_MASK
  #define IPTOS_PREC_MASK 0xe0
<span class="line-new-header">--- 46,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 496,18 ***</span>
      }
  
      n = NET_RecvFrom(fd, buf, 1, MSG_PEEK, &amp;rmtaddr.sa, &amp;slen);
  
      if (n == -1) {
<span class="line-removed">- </span>
<span class="line-removed">- #ifdef __solaris__</span>
<span class="line-removed">-         if (errno == ECONNREFUSED) {</span>
<span class="line-removed">-             int orig_errno = errno;</span>
<span class="line-removed">-             recv(fd, buf, 1, 0);</span>
<span class="line-removed">-             errno = orig_errno;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- #endif</span>
          if (errno == ECONNREFUSED) {
              JNU_ThrowByName(env, JNU_JAVANETPKG &quot;PortUnreachableException&quot;,
                              &quot;ICMP Port Unreachable&quot;);
          } else {
              if (errno == EBADF) {
<span class="line-new-header">--- 486,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 630,18 ***</span>
      /* truncate the data if the packet&#39;s length is too small */
      if (n &gt; packetBufferLen) {
          n = packetBufferLen;
      }
      if (n == -1) {
<span class="line-removed">- </span>
<span class="line-removed">- #ifdef __solaris__</span>
<span class="line-removed">-         if (errno == ECONNREFUSED) {</span>
<span class="line-removed">-             int orig_errno = errno;</span>
<span class="line-removed">-             (void) recv(fd, fullPacket, 1, 0);</span>
<span class="line-removed">-             errno = orig_errno;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- #endif</span>
          (*env)-&gt;SetIntField(env, packet, dp_offsetID, 0);
          (*env)-&gt;SetIntField(env, packet, dp_lengthID, 0);
          if (errno == ECONNREFUSED) {
              JNU_ThrowByName(env, JNU_JAVANETPKG &quot;PortUnreachableException&quot;,
                              &quot;ICMP Port Unreachable&quot;);
<span class="line-new-header">--- 612,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1851,14 ***</span>
   *
   * On Linux with IPv6 if we wish to join/leave an IPv4 multicast group then
   * we must use the IPv4 socket options. This is because the IPv6 socket options
   * don&#39;t support IPv4-mapped addresses. This is true as per 2.2.19 and 2.4.7
   * kernel releases. In the future it&#39;s possible that IP_ADD_MEMBERSHIP
<span class="line-modified">!  * will be updated to return ENOPROTOOPT if uses with an IPv6 socket (Solaris</span>
<span class="line-modified">!  * already does this). Thus to cater for this we first try with the IPv4</span>
<span class="line-modified">!  * socket options and if they fail we use the IPv6 socket options. This</span>
<span class="line-removed">-  * seems a reasonable failsafe solution.</span>
   */
  static void mcast_join_leave(JNIEnv *env, jobject this,
                               jobject iaObj, jobject niObj,
                               jboolean join) {
  
<span class="line-new-header">--- 1825,13 ---</span>
   *
   * On Linux with IPv6 if we wish to join/leave an IPv4 multicast group then
   * we must use the IPv4 socket options. This is because the IPv6 socket options
   * don&#39;t support IPv4-mapped addresses. This is true as per 2.2.19 and 2.4.7
   * kernel releases. In the future it&#39;s possible that IP_ADD_MEMBERSHIP
<span class="line-modified">!  * will be updated to return ENOPROTOOPT if uses with an IPv6 socket. Thus to</span>
<span class="line-modified">!  * cater for this we first try with the IPv4 socket options and if they fail we</span>
<span class="line-modified">!  * use the IPv6 socket options. This seems a reasonable failsafe solution.</span>
   */
  static void mcast_join_leave(JNIEnv *env, jobject this,
                               jobject iaObj, jobject niObj,
                               jboolean join) {
  
</pre>
<center><a href="NetworkInterface.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="PlainSocketImpl.c.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>