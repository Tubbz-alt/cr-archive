<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/runtime/Threads.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../gc/z/ZAddress.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../utilities/PlatformInfo.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/runtime/Threads.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 package sun.jvm.hotspot.runtime;
 26 
 27 import java.util.*;
 28 
 29 import sun.jvm.hotspot.debugger.*;
 30 import sun.jvm.hotspot.types.*;
<span class="line-removed"> 31 import sun.jvm.hotspot.runtime.solaris_sparc.SolarisSPARCJavaThreadPDAccess;</span>
<span class="line-removed"> 32 import sun.jvm.hotspot.runtime.solaris_x86.SolarisX86JavaThreadPDAccess;</span>
<span class="line-removed"> 33 import sun.jvm.hotspot.runtime.solaris_amd64.SolarisAMD64JavaThreadPDAccess;</span>
 34 import sun.jvm.hotspot.runtime.win32_amd64.Win32AMD64JavaThreadPDAccess;
 35 import sun.jvm.hotspot.runtime.win32_x86.Win32X86JavaThreadPDAccess;
 36 import sun.jvm.hotspot.runtime.linux_x86.LinuxX86JavaThreadPDAccess;
 37 import sun.jvm.hotspot.runtime.linux_amd64.LinuxAMD64JavaThreadPDAccess;
 38 import sun.jvm.hotspot.runtime.linux_aarch64.LinuxAARCH64JavaThreadPDAccess;
 39 import sun.jvm.hotspot.runtime.linux_ppc64.LinuxPPC64JavaThreadPDAccess;
<span class="line-removed"> 40 import sun.jvm.hotspot.runtime.linux_sparc.LinuxSPARCJavaThreadPDAccess;</span>
 41 import sun.jvm.hotspot.runtime.bsd_x86.BsdX86JavaThreadPDAccess;
 42 import sun.jvm.hotspot.runtime.bsd_amd64.BsdAMD64JavaThreadPDAccess;
 43 import sun.jvm.hotspot.utilities.*;
 44 import sun.jvm.hotspot.utilities.Observable;
 45 import sun.jvm.hotspot.utilities.Observer;
 46 
 47 class ThreadsList extends VMObject {
 48     private static AddressField  threadsField;
 49     private static CIntegerField lengthField;
 50 
 51     static {
 52         VM.registerVMInitializedObserver((o, d) -&gt; initialize(VM.getVM().getTypeDataBase()));
 53     }
 54 
 55     private static synchronized void initialize(TypeDataBase db) {
 56         Type type = db.lookupType(&quot;ThreadsList&quot;);
 57         lengthField = type.getCIntegerField(&quot;_length&quot;);
 58         threadsField = type.getAddressField(&quot;_threads&quot;);
 59     }
 60 
</pre>
<hr />
<pre>
 81     private static ThreadsList _list;
 82 
 83     static {
 84         VM.registerVMInitializedObserver(new Observer() {
 85             public void update(Observable o, Object data) {
 86                 initialize(VM.getVM().getTypeDataBase());
 87             }
 88         });
 89     }
 90 
 91     private static synchronized void initialize(TypeDataBase db) {
 92         Type type = db.lookupType(&quot;ThreadsSMRSupport&quot;);
 93         threadListField = type.getAddressField(&quot;_java_thread_list&quot;);
 94 
 95         // Instantiate appropriate platform-specific JavaThreadFactory
 96         String os  = VM.getVM().getOS();
 97         String cpu = VM.getVM().getCPU();
 98 
 99         access = null;
100         // FIXME: find the platform specific PD class by reflection?
<span class="line-modified">101         if (os.equals(&quot;solaris&quot;)) {</span>
<span class="line-removed">102             if (cpu.equals(&quot;sparc&quot;)) {</span>
<span class="line-removed">103                 access = new SolarisSPARCJavaThreadPDAccess();</span>
<span class="line-removed">104             } else if (cpu.equals(&quot;x86&quot;)) {</span>
<span class="line-removed">105                 access = new SolarisX86JavaThreadPDAccess();</span>
<span class="line-removed">106             } else if (cpu.equals(&quot;amd64&quot;)) {</span>
<span class="line-removed">107                 access = new SolarisAMD64JavaThreadPDAccess();</span>
<span class="line-removed">108             }</span>
<span class="line-removed">109         } else if (os.equals(&quot;win32&quot;)) {</span>
110             if (cpu.equals(&quot;x86&quot;)) {
111                 access =  new Win32X86JavaThreadPDAccess();
112             } else if (cpu.equals(&quot;amd64&quot;)) {
113                 access =  new Win32AMD64JavaThreadPDAccess();
114             }
115         } else if (os.equals(&quot;linux&quot;)) {
116             if (cpu.equals(&quot;x86&quot;)) {
117                 access = new LinuxX86JavaThreadPDAccess();
118             } else if (cpu.equals(&quot;amd64&quot;)) {
119                 access = new LinuxAMD64JavaThreadPDAccess();
<span class="line-removed">120             } else if (cpu.equals(&quot;sparc&quot;)) {</span>
<span class="line-removed">121                 access = new LinuxSPARCJavaThreadPDAccess();</span>
122             } else if (cpu.equals(&quot;ppc64&quot;)) {
123                 access = new LinuxPPC64JavaThreadPDAccess();
124             } else if (cpu.equals(&quot;aarch64&quot;)) {
125                 access = new LinuxAARCH64JavaThreadPDAccess();
126             } else {
127               try {
128                 access = (JavaThreadPDAccess)
129                   Class.forName(&quot;sun.jvm.hotspot.runtime.linux_&quot; +
130                      cpu.toLowerCase() + &quot;.Linux&quot; + cpu.toUpperCase() +
131                      &quot;JavaThreadPDAccess&quot;).getDeclaredConstructor().newInstance();
132               } catch (Exception e) {
133                 throw new RuntimeException(&quot;OS/CPU combination &quot; + os + &quot;/&quot; + cpu +
134                                            &quot; not yet supported&quot;);
135               }
136             }
137         } else if (os.equals(&quot;bsd&quot;)) {
138             if (cpu.equals(&quot;x86&quot;)) {
139                 access = new BsdX86JavaThreadPDAccess();
140             } else if (cpu.equals(&quot;amd64&quot;) || cpu.equals(&quot;x86_64&quot;)) {
141                 access = new BsdAMD64JavaThreadPDAccess();
</pre>
</td>
<td>
<hr />
<pre>
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 package sun.jvm.hotspot.runtime;
 26 
 27 import java.util.*;
 28 
 29 import sun.jvm.hotspot.debugger.*;
 30 import sun.jvm.hotspot.types.*;



 31 import sun.jvm.hotspot.runtime.win32_amd64.Win32AMD64JavaThreadPDAccess;
 32 import sun.jvm.hotspot.runtime.win32_x86.Win32X86JavaThreadPDAccess;
 33 import sun.jvm.hotspot.runtime.linux_x86.LinuxX86JavaThreadPDAccess;
 34 import sun.jvm.hotspot.runtime.linux_amd64.LinuxAMD64JavaThreadPDAccess;
 35 import sun.jvm.hotspot.runtime.linux_aarch64.LinuxAARCH64JavaThreadPDAccess;
 36 import sun.jvm.hotspot.runtime.linux_ppc64.LinuxPPC64JavaThreadPDAccess;

 37 import sun.jvm.hotspot.runtime.bsd_x86.BsdX86JavaThreadPDAccess;
 38 import sun.jvm.hotspot.runtime.bsd_amd64.BsdAMD64JavaThreadPDAccess;
 39 import sun.jvm.hotspot.utilities.*;
 40 import sun.jvm.hotspot.utilities.Observable;
 41 import sun.jvm.hotspot.utilities.Observer;
 42 
 43 class ThreadsList extends VMObject {
 44     private static AddressField  threadsField;
 45     private static CIntegerField lengthField;
 46 
 47     static {
 48         VM.registerVMInitializedObserver((o, d) -&gt; initialize(VM.getVM().getTypeDataBase()));
 49     }
 50 
 51     private static synchronized void initialize(TypeDataBase db) {
 52         Type type = db.lookupType(&quot;ThreadsList&quot;);
 53         lengthField = type.getCIntegerField(&quot;_length&quot;);
 54         threadsField = type.getAddressField(&quot;_threads&quot;);
 55     }
 56 
</pre>
<hr />
<pre>
 77     private static ThreadsList _list;
 78 
 79     static {
 80         VM.registerVMInitializedObserver(new Observer() {
 81             public void update(Observable o, Object data) {
 82                 initialize(VM.getVM().getTypeDataBase());
 83             }
 84         });
 85     }
 86 
 87     private static synchronized void initialize(TypeDataBase db) {
 88         Type type = db.lookupType(&quot;ThreadsSMRSupport&quot;);
 89         threadListField = type.getAddressField(&quot;_java_thread_list&quot;);
 90 
 91         // Instantiate appropriate platform-specific JavaThreadFactory
 92         String os  = VM.getVM().getOS();
 93         String cpu = VM.getVM().getCPU();
 94 
 95         access = null;
 96         // FIXME: find the platform specific PD class by reflection?
<span class="line-modified"> 97         if (os.equals(&quot;win32&quot;)) {</span>








 98             if (cpu.equals(&quot;x86&quot;)) {
 99                 access =  new Win32X86JavaThreadPDAccess();
100             } else if (cpu.equals(&quot;amd64&quot;)) {
101                 access =  new Win32AMD64JavaThreadPDAccess();
102             }
103         } else if (os.equals(&quot;linux&quot;)) {
104             if (cpu.equals(&quot;x86&quot;)) {
105                 access = new LinuxX86JavaThreadPDAccess();
106             } else if (cpu.equals(&quot;amd64&quot;)) {
107                 access = new LinuxAMD64JavaThreadPDAccess();


108             } else if (cpu.equals(&quot;ppc64&quot;)) {
109                 access = new LinuxPPC64JavaThreadPDAccess();
110             } else if (cpu.equals(&quot;aarch64&quot;)) {
111                 access = new LinuxAARCH64JavaThreadPDAccess();
112             } else {
113               try {
114                 access = (JavaThreadPDAccess)
115                   Class.forName(&quot;sun.jvm.hotspot.runtime.linux_&quot; +
116                      cpu.toLowerCase() + &quot;.Linux&quot; + cpu.toUpperCase() +
117                      &quot;JavaThreadPDAccess&quot;).getDeclaredConstructor().newInstance();
118               } catch (Exception e) {
119                 throw new RuntimeException(&quot;OS/CPU combination &quot; + os + &quot;/&quot; + cpu +
120                                            &quot; not yet supported&quot;);
121               }
122             }
123         } else if (os.equals(&quot;bsd&quot;)) {
124             if (cpu.equals(&quot;x86&quot;)) {
125                 access = new BsdX86JavaThreadPDAccess();
126             } else if (cpu.equals(&quot;amd64&quot;) || cpu.equals(&quot;x86_64&quot;)) {
127                 access = new BsdAMD64JavaThreadPDAccess();
</pre>
</td>
</tr>
</table>
<center><a href="../gc/z/ZAddress.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../utilities/PlatformInfo.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>