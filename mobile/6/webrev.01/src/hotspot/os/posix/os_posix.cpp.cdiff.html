<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/os/posix/os_posix.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="include/jvm_md.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="os_posix.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/os/posix/os_posix.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 456,11 ***</span>
  #if defined(AIX)
    st-&gt;print(&quot;, NPROC &quot;);
    st-&gt;print(&quot;%d&quot;, sysconf(_SC_CHILD_MAX));
  
    print_rlimit(st, &quot;, THREADS&quot;, RLIMIT_THREADS);
<span class="line-modified">! #elif !defined(SOLARIS)</span>
    print_rlimit(st, &quot;, NPROC&quot;, RLIMIT_NPROC);
  #endif
  
    print_rlimit(st, &quot;, NOFILE&quot;, RLIMIT_NOFILE);
    print_rlimit(st, &quot;, AS&quot;, RLIMIT_AS, true);
<span class="line-new-header">--- 456,11 ---</span>
  #if defined(AIX)
    st-&gt;print(&quot;, NPROC &quot;);
    st-&gt;print(&quot;%d&quot;, sysconf(_SC_CHILD_MAX));
  
    print_rlimit(st, &quot;, THREADS&quot;, RLIMIT_THREADS);
<span class="line-modified">! #else</span>
    print_rlimit(st, &quot;, NPROC&quot;, RLIMIT_NPROC);
  #endif
  
    print_rlimit(st, &quot;, NOFILE&quot;, RLIMIT_NOFILE);
    print_rlimit(st, &quot;, AS&quot;, RLIMIT_AS, true);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 474,16 ***</span>
    // maximum number of bytes of memory that may be locked into RAM
    // (rounded down to the nearest  multiple of system pagesize)
    print_rlimit(st, &quot;, MEMLOCK&quot;, RLIMIT_MEMLOCK, true);
  #endif
  
<span class="line-removed">- #if defined(SOLARIS)</span>
<span class="line-removed">-   // maximum size of mapped address space of a process in bytes;</span>
<span class="line-removed">-   // if the limit is exceeded, mmap and brk fail</span>
<span class="line-removed">-   print_rlimit(st, &quot;, VMEM&quot;, RLIMIT_VMEM, true);</span>
<span class="line-removed">- #endif</span>
<span class="line-removed">- </span>
    // MacOS; The maximum size (in bytes) to which a process&#39;s resident set size may grow.
  #if defined(__APPLE__)
    print_rlimit(st, &quot;, RSS&quot;, RLIMIT_RSS, true);
  #endif
  
<span class="line-new-header">--- 474,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1103,25 ***</span>
      { SIGSEGV, SEGV_KEYERR,  &quot;SEGV_KEYERR&quot;,  &quot;key error&quot; },
  #endif
  #if defined(IA64) &amp;&amp; !defined(AIX)
      { SIGSEGV, SEGV_PSTKOVF, &quot;SEGV_PSTKOVF&quot;, &quot;Paragraph stack overflow&quot; },
  #endif
<span class="line-removed">- #if defined(__sparc) &amp;&amp; defined(SOLARIS)</span>
<span class="line-removed">- // define Solaris Sparc M7 ADI SEGV signals</span>
<span class="line-removed">- #if !defined(SEGV_ACCADI)</span>
<span class="line-removed">- #define SEGV_ACCADI 3</span>
<span class="line-removed">- #endif</span>
<span class="line-removed">-     { SIGSEGV, SEGV_ACCADI,  &quot;SEGV_ACCADI&quot;,  &quot;ADI not enabled for mapped object.&quot; },</span>
<span class="line-removed">- #if !defined(SEGV_ACCDERR)</span>
<span class="line-removed">- #define SEGV_ACCDERR 4</span>
<span class="line-removed">- #endif</span>
<span class="line-removed">-     { SIGSEGV, SEGV_ACCDERR, &quot;SEGV_ACCDERR&quot;, &quot;ADI disrupting exception.&quot; },</span>
<span class="line-removed">- #if !defined(SEGV_ACCPERR)</span>
<span class="line-removed">- #define SEGV_ACCPERR 5</span>
<span class="line-removed">- #endif</span>
<span class="line-removed">-     { SIGSEGV, SEGV_ACCPERR, &quot;SEGV_ACCPERR&quot;, &quot;ADI precise exception.&quot; },</span>
<span class="line-removed">- #endif // defined(__sparc) &amp;&amp; defined(SOLARIS)</span>
      { SIGBUS,  BUS_ADRALN,   &quot;BUS_ADRALN&quot;,   &quot;Invalid address alignment.&quot; },
      { SIGBUS,  BUS_ADRERR,   &quot;BUS_ADRERR&quot;,   &quot;Nonexistent physical address.&quot; },
      { SIGBUS,  BUS_OBJERR,   &quot;BUS_OBJERR&quot;,   &quot;Object-specific hardware error.&quot; },
      { SIGTRAP, TRAP_BRKPT,   &quot;TRAP_BRKPT&quot;,   &quot;Process breakpoint.&quot; },
      { SIGTRAP, TRAP_TRACE,   &quot;TRAP_TRACE&quot;,   &quot;Process trace trap.&quot; },
<span class="line-new-header">--- 1097,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1276,17 ***</span>
  }
  
  bool os::signal_thread(Thread* thread, int sig, const char* reason) {
    OSThread* osthread = thread-&gt;osthread();
    if (osthread) {
<span class="line-removed">- #if defined (SOLARIS)</span>
<span class="line-removed">-     // Note: we cannot use pthread_kill on Solaris - not because</span>
<span class="line-removed">-     // its missing, but because we do not have the pthread_t id.</span>
<span class="line-removed">-     int status = thr_kill(osthread-&gt;thread_id(), sig);</span>
<span class="line-removed">- #else</span>
      int status = pthread_kill(osthread-&gt;pthread_id(), sig);
<span class="line-removed">- #endif</span>
      if (status == 0) {
        Events::log(Thread::current(), &quot;sent signal %d to Thread &quot; INTPTR_FORMAT &quot; because %s.&quot;,
                    sig, p2i(thread), reason);
        return true;
      }
<span class="line-new-header">--- 1255,11 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1303,12 ***</span>
     return Aix::ucontext_get_pc(ctx);
  #elif defined(BSD)
     return Bsd::ucontext_get_pc(ctx);
  #elif defined(LINUX)
     return Linux::ucontext_get_pc(ctx);
<span class="line-removed">- #elif defined(SOLARIS)</span>
<span class="line-removed">-    return Solaris::ucontext_get_pc(ctx);</span>
  #else
     VMError::report_and_die(&quot;unimplemented ucontext_get_pc&quot;);
  #endif
  }
  
<span class="line-new-header">--- 1276,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1317,12 ***</span>
     Aix::ucontext_set_pc(ctx, pc);
  #elif defined(BSD)
     Bsd::ucontext_set_pc(ctx, pc);
  #elif defined(LINUX)
     Linux::ucontext_set_pc(ctx, pc);
<span class="line-removed">- #elif defined(SOLARIS)</span>
<span class="line-removed">-    Solaris::ucontext_set_pc(ctx, pc);</span>
  #else
     VMError::report_and_die(&quot;unimplemented ucontext_get_pc&quot;);
  #endif
  }
  
<span class="line-new-header">--- 1288,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1423,11 ***</span>
  // platform (os/cpu) dependent constant.
  // To this, space for guard mechanisms is added, which depends on the
  // page size which again depends on the concrete system the VM is running
  // on. Space for libc guard pages is not included in this size.
  jint os::Posix::set_minimum_stack_sizes() {
<span class="line-modified">!   size_t os_min_stack_allowed = SOLARIS_ONLY(thr_min_stack()) NOT_SOLARIS(PTHREAD_STACK_MIN);</span>
  
    _java_thread_min_stack_allowed = _java_thread_min_stack_allowed +
                                     JavaThread::stack_guard_zone_size() +
                                     JavaThread::stack_shadow_zone_size();
  
<span class="line-new-header">--- 1392,11 ---</span>
  // platform (os/cpu) dependent constant.
  // To this, space for guard mechanisms is added, which depends on the
  // page size which again depends on the concrete system the VM is running
  // on. Space for libc guard pages is not included in this size.
  jint os::Posix::set_minimum_stack_sizes() {
<span class="line-modified">!   size_t os_min_stack_allowed = PTHREAD_STACK_MIN;</span>
  
    _java_thread_min_stack_allowed = _java_thread_min_stack_allowed +
                                     JavaThread::stack_guard_zone_size() +
                                     JavaThread::stack_shadow_zone_size();
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1633,15 ***</span>
      fatal(&quot;pthread_mutexattr_init: %s&quot;, os::strerror(status));
    }
    if ((status = pthread_mutexattr_settype(_mutexAttr, PTHREAD_MUTEX_NORMAL)) != 0) {
      fatal(&quot;pthread_mutexattr_settype: %s&quot;, os::strerror(status));
    }
<span class="line-modified">!   // Solaris has it&#39;s own PlatformMutex, distinct from the one for POSIX.</span>
<span class="line-removed">-   NOT_SOLARIS(os::PlatformMutex::init();)</span>
  }
  
<span class="line-removed">- #ifndef SOLARIS</span>
  sigset_t sigs;
  struct sigaction sigact[NSIG];
  
  struct sigaction* os::Posix::get_preinstalled_handler(int sig) {
    if (sigismember(&amp;sigs, sig)) {
<span class="line-new-header">--- 1602,13 ---</span>
      fatal(&quot;pthread_mutexattr_init: %s&quot;, os::strerror(status));
    }
    if ((status = pthread_mutexattr_settype(_mutexAttr, PTHREAD_MUTEX_NORMAL)) != 0) {
      fatal(&quot;pthread_mutexattr_settype: %s&quot;, os::strerror(status));
    }
<span class="line-modified">!   os::PlatformMutex::init();</span>
  }
  
  sigset_t sigs;
  struct sigaction sigact[NSIG];
  
  struct sigaction* os::Posix::get_preinstalled_handler(int sig) {
    if (sigismember(&amp;sigs, sig)) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1653,11 ***</span>
  void os::Posix::save_preinstalled_handler(int sig, struct sigaction&amp; oldAct) {
    assert(sig &gt; 0 &amp;&amp; sig &lt; NSIG, &quot;vm signal out of expected range&quot;);
    sigact[sig] = oldAct;
    sigaddset(&amp;sigs, sig);
  }
<span class="line-removed">- #endif</span>
  
  // Not all POSIX types and API&#39;s are available on all notionally &quot;posix&quot;
  // platforms. If we have build-time support then we will check for actual
  // runtime support via dlopen/dlsym lookup. This allows for running on an
  // older OS version compared to the build platform. But if there is no
<span class="line-new-header">--- 1620,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1738,11 ***</span>
  
    // Now do general initialization.
  
    pthread_init_common();
  
<span class="line-removed">- #ifndef SOLARIS</span>
    int status;
    if (_pthread_condattr_setclock != NULL &amp;&amp; _clock_gettime != NULL) {
      if ((status = _pthread_condattr_setclock(_condAttr, CLOCK_MONOTONIC)) != 0) {
        if (status == EINVAL) {
          _use_clock_monotonic_condattr = false;
<span class="line-new-header">--- 1704,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1753,39 ***</span>
        }
      } else {
        _use_clock_monotonic_condattr = true;
      }
    }
<span class="line-removed">- #endif // !SOLARIS</span>
<span class="line-removed">- </span>
  }
  
  void os::Posix::init_2(void) {
<span class="line-removed">- #ifndef SOLARIS</span>
    log_info(os)(&quot;Use of CLOCK_MONOTONIC is%s supported&quot;,
                 (_clock_gettime != NULL ? &quot;&quot; : &quot; not&quot;));
    log_info(os)(&quot;Use of pthread_condattr_setclock is%s supported&quot;,
                 (_pthread_condattr_setclock != NULL ? &quot;&quot; : &quot; not&quot;));
    log_info(os)(&quot;Relative timed-wait using pthread_cond_timedwait is associated with %s&quot;,
                 _use_clock_monotonic_condattr ? &quot;CLOCK_MONOTONIC&quot; : &quot;the default clock&quot;);
    sigemptyset(&amp;sigs);
<span class="line-removed">- #endif // !SOLARIS</span>
  }
  
  #else // !SUPPORTS_CLOCK_MONOTONIC
  
  void os::Posix::init(void) {
    pthread_init_common();
  }
  
  void os::Posix::init_2(void) {
<span class="line-removed">- #ifndef SOLARIS</span>
    log_info(os)(&quot;Use of CLOCK_MONOTONIC is not supported&quot;);
    log_info(os)(&quot;Use of pthread_condattr_setclock is not supported&quot;);
    log_info(os)(&quot;Relative timed-wait using pthread_cond_timedwait is associated with the default clock&quot;);
    sigemptyset(&amp;sigs);
<span class="line-removed">- #endif // !SOLARIS</span>
  }
  
  #endif // SUPPORTS_CLOCK_MONOTONIC
  
  // Utility to convert the given timeout to an absolute timespec
<span class="line-new-header">--- 1718,33 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1922,11 ***</span>
  }
  
  // Shared pthread_mutex/cond based PlatformEvent implementation.
  // Not currently usable by Solaris.
  
<span class="line-removed">- #ifndef SOLARIS</span>
  
  // PlatformEvent
  //
  // Assumption:
  //    Only one parker can exist on an event, which is why we allocate
<span class="line-new-header">--- 1881,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2354,7 ***</span>
      assert_status(status == 0 MACOS_ONLY(|| status == ETIMEDOUT),
                    status, &quot;cond_wait&quot;);
      return OS_OK;
    }
  }
<span class="line-removed">- </span>
<span class="line-removed">- #endif // !SOLARIS</span>
<span class="line-new-header">--- 2312,5 ---</span>
</pre>
<center><a href="include/jvm_md.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="os_posix.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>