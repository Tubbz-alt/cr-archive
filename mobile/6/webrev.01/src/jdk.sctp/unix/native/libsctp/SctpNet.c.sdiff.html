<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.sctp/unix/native/libsctp/SctpNet.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="SctpChannelImpl.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../jdk.security.auth/share/classes/com/sun/security/auth/module/Krb5LoginModule.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.sctp/unix/native/libsctp/SctpNet.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
341     if (isaCls == 0) {
342         initializeISA(env);
343         CHECK_NULL_RETURN(isaCls, NULL);
344     }
345 
346     return (*env)-&gt;NewObject(env, isaCls, isaCtrID, ia, port);
347 }
348 
349 /*
350  * Class:     sun_nio_ch_sctp_SctpNet
351  * Method:    getLocalAddresses0
352  * Signature: (I)[Ljava/net/SocketAddress;
353  */
354 JNIEXPORT jobjectArray JNICALL Java_sun_nio_ch_sctp_SctpNet_getLocalAddresses0
355   (JNIEnv *env, jclass klass, jint fd)
356 {
357     void *addr_buf, *laddr;
358     int i, addrCount;
359     jobjectArray isaa;
360 
<span class="line-removed">361 #ifdef __solaris__</span>
<span class="line-removed">362     if ((addrCount = nio_sctp_getladdrs(fd, 0, (void **)&amp;addr_buf)) == -1) {</span>
<span class="line-removed">363 #else /* __linux__ */</span>
364     if ((addrCount = nio_sctp_getladdrs(fd, 0, (struct sockaddr **)&amp;addr_buf)) == -1) {
<span class="line-removed">365 #endif</span>
366         handleSocketError(env, errno);
367         return NULL;
368     }
369 
370     if (addrCount &lt; 1)
371         return NULL;
372 
373     if (isaCls == 0) {
374         initializeISA(env);
375         CHECK_NULL_RETURN(isaCls, NULL);
376     }
377 
378     isaa = (*env)-&gt;NewObjectArray(env, addrCount, isaCls, NULL);
379     if (isaa == NULL) {
380         nio_sctp_freeladdrs(addr_buf);
381         return NULL;
382     }
383 
384     laddr = addr_buf;
385     for (i = 0; i &lt; addrCount; i++) {
</pre>
<hr />
<pre>
390             isa = (*env)-&gt;NewObject(env, isaCls, isaCtrID, ia, port);
391         if (isa == NULL)
392             break;
393         (*env)-&gt;SetObjectArrayElement(env, isaa, i, isa);
394 
395         if (((struct sockaddr *)addr_buf)-&gt;sa_family == AF_INET)
396             addr_buf = ((struct sockaddr_in *)addr_buf) + 1;
397         else
398             addr_buf = ((struct sockaddr_in6 *)addr_buf) + 1;
399     }
400 
401     nio_sctp_freeladdrs(laddr);
402     return isaa;
403 }
404 
405 jobjectArray getRemoteAddresses(JNIEnv *env, jint fd, sctp_assoc_t id) {
406     void *addr_buf, *paddr;
407     int i, addrCount;
408     jobjectArray isaa;
409 
<span class="line-removed">410 #if defined(__solaris__)</span>
<span class="line-removed">411     if ((addrCount = nio_sctp_getpaddrs(fd, id, (void **)&amp;addr_buf)) == -1) {</span>
<span class="line-removed">412 #else /* __linux__ */</span>
413     if ((addrCount = nio_sctp_getpaddrs(fd, id, (struct sockaddr **)&amp;addr_buf)) == -1) {
<span class="line-removed">414 #endif</span>
415         handleSocketError(env, errno);
416         return NULL;
417     }
418 
419     if (addrCount &lt; 1)
420         return NULL;
421 
422     if (isaCls == 0) {
423         initializeISA(env);
424         CHECK_NULL_RETURN(isaCls, NULL);
425     }
426 
427     isaa = (*env)-&gt;NewObjectArray(env, addrCount, isaCls, NULL);
428     if (isaa == NULL) {
429         nio_sctp_freepaddrs(addr_buf);
430         return NULL;
431     }
432 
433     paddr = addr_buf;
434     for (i = 0; i &lt; addrCount; i++) {
</pre>
</td>
<td>
<hr />
<pre>
341     if (isaCls == 0) {
342         initializeISA(env);
343         CHECK_NULL_RETURN(isaCls, NULL);
344     }
345 
346     return (*env)-&gt;NewObject(env, isaCls, isaCtrID, ia, port);
347 }
348 
349 /*
350  * Class:     sun_nio_ch_sctp_SctpNet
351  * Method:    getLocalAddresses0
352  * Signature: (I)[Ljava/net/SocketAddress;
353  */
354 JNIEXPORT jobjectArray JNICALL Java_sun_nio_ch_sctp_SctpNet_getLocalAddresses0
355   (JNIEnv *env, jclass klass, jint fd)
356 {
357     void *addr_buf, *laddr;
358     int i, addrCount;
359     jobjectArray isaa;
360 



361     if ((addrCount = nio_sctp_getladdrs(fd, 0, (struct sockaddr **)&amp;addr_buf)) == -1) {

362         handleSocketError(env, errno);
363         return NULL;
364     }
365 
366     if (addrCount &lt; 1)
367         return NULL;
368 
369     if (isaCls == 0) {
370         initializeISA(env);
371         CHECK_NULL_RETURN(isaCls, NULL);
372     }
373 
374     isaa = (*env)-&gt;NewObjectArray(env, addrCount, isaCls, NULL);
375     if (isaa == NULL) {
376         nio_sctp_freeladdrs(addr_buf);
377         return NULL;
378     }
379 
380     laddr = addr_buf;
381     for (i = 0; i &lt; addrCount; i++) {
</pre>
<hr />
<pre>
386             isa = (*env)-&gt;NewObject(env, isaCls, isaCtrID, ia, port);
387         if (isa == NULL)
388             break;
389         (*env)-&gt;SetObjectArrayElement(env, isaa, i, isa);
390 
391         if (((struct sockaddr *)addr_buf)-&gt;sa_family == AF_INET)
392             addr_buf = ((struct sockaddr_in *)addr_buf) + 1;
393         else
394             addr_buf = ((struct sockaddr_in6 *)addr_buf) + 1;
395     }
396 
397     nio_sctp_freeladdrs(laddr);
398     return isaa;
399 }
400 
401 jobjectArray getRemoteAddresses(JNIEnv *env, jint fd, sctp_assoc_t id) {
402     void *addr_buf, *paddr;
403     int i, addrCount;
404     jobjectArray isaa;
405 



406     if ((addrCount = nio_sctp_getpaddrs(fd, id, (struct sockaddr **)&amp;addr_buf)) == -1) {

407         handleSocketError(env, errno);
408         return NULL;
409     }
410 
411     if (addrCount &lt; 1)
412         return NULL;
413 
414     if (isaCls == 0) {
415         initializeISA(env);
416         CHECK_NULL_RETURN(isaCls, NULL);
417     }
418 
419     isaa = (*env)-&gt;NewObjectArray(env, addrCount, isaCls, NULL);
420     if (isaa == NULL) {
421         nio_sctp_freepaddrs(addr_buf);
422         return NULL;
423     }
424 
425     paddr = addr_buf;
426     for (i = 0; i &lt; addrCount; i++) {
</pre>
</td>
</tr>
</table>
<center><a href="SctpChannelImpl.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../jdk.security.auth/share/classes/com/sun/security/auth/module/Krb5LoginModule.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>