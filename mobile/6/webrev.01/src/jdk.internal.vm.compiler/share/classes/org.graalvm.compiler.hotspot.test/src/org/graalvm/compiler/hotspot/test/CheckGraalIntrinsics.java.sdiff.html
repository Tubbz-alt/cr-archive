<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.hotspot.test/src/org/graalvm/compiler/hotspot/test/CheckGraalIntrinsics.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AheadOfTimeCompilationTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/GraalHotSpotVMConfig.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.hotspot.test/src/org/graalvm/compiler/hotspot/test/CheckGraalIntrinsics.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 44 import org.graalvm.compiler.hotspot.meta.HotSpotGraphBuilderPlugins;
 45 import org.graalvm.compiler.hotspot.meta.HotSpotProviders;
 46 import org.graalvm.compiler.nodes.graphbuilderconf.GraphBuilderConfiguration.Plugins;
 47 import org.graalvm.compiler.nodes.graphbuilderconf.InvocationPlugin;
 48 import org.graalvm.compiler.nodes.graphbuilderconf.InvocationPlugins;
 49 import org.graalvm.compiler.nodes.graphbuilderconf.InvocationPlugins.Binding;
 50 import org.graalvm.compiler.runtime.RuntimeProvider;
 51 import org.graalvm.compiler.serviceprovider.JavaVersionUtil;
 52 import org.graalvm.compiler.test.GraalTest;
 53 import org.junit.Test;
 54 
 55 import jdk.vm.ci.aarch64.AArch64;
 56 import jdk.vm.ci.amd64.AMD64;
 57 import jdk.vm.ci.code.Architecture;
 58 import jdk.vm.ci.hotspot.HotSpotVMConfigStore;
 59 import jdk.vm.ci.hotspot.VMIntrinsicMethod;
 60 import jdk.vm.ci.meta.MetaAccessProvider;
 61 import jdk.vm.ci.meta.MetaUtil;
 62 import jdk.vm.ci.meta.MethodHandleAccessProvider.IntrinsicMethod;
 63 import jdk.vm.ci.meta.ResolvedJavaMethod;
<span class="line-removed"> 64 import jdk.vm.ci.sparc.SPARC;</span>
 65 
 66 /**
 67  * Checks the intrinsics implemented by Graal against the set of intrinsics declared by HotSpot. The
 68  * purpose of this test is to detect when new intrinsics are added to HotSpot and process them
 69  * appropriately in Graal. This will be achieved by working through {@link #toBeInvestigated} and
 70  * either implementing the intrinsic or moving it to {@link #ignore} .
 71  */
 72 public class CheckGraalIntrinsics extends GraalTest {
 73 
 74     public static boolean match(String type, Binding binding, VMIntrinsicMethod intrinsic) {
 75         if (intrinsic.name.equals(binding.name)) {
 76             if (intrinsic.descriptor.startsWith(binding.argumentsDescriptor)) {
 77                 if (type.equals(intrinsic.declaringClass)) {
 78                     return true;
 79                 }
 80             }
 81         }
 82         return false;
 83     }
 84 
</pre>
<hr />
<pre>
356 
357                             // handled by an intrinsic for StringUTF16.indexOfCharUnsafe
358                             &quot;java/lang/StringUTF16.indexOfChar([BIII)I&quot;,
359 
360                             // handled by an intrinsic for StringUTF16.indexOfLatin1Unsafe
361                             &quot;java/lang/StringUTF16.indexOfLatin1([BI[BII)I&quot;,
362                             &quot;java/lang/StringUTF16.indexOfLatin1([B[B)I&quot;);
363 
364             if (!config.useAESCTRIntrinsics) {
365                 add(ignore,
366                                 &quot;com/sun/crypto/provider/CounterMode.implCrypt([BII[BI)I&quot;);
367             }
368             if (!config.useGHASHIntrinsics()) {
369                 add(ignore,
370                                 &quot;com/sun/crypto/provider/GHASH.processBlocks([BII[J[J)V&quot;);
371             }
372             if (!config.useFMAIntrinsics) {
373                 add(ignore,
374                                 &quot;java/lang/Math.fma(DDD)D&quot;,
375                                 &quot;java/lang/Math.fma(FFF)F&quot;);
<span class="line-removed">376             } else if (arch instanceof SPARC) {</span>
<span class="line-removed">377                 add(toBeInvestigated,</span>
<span class="line-removed">378                                 &quot;java/lang/Math.fma(DDD)D&quot;,</span>
<span class="line-removed">379                                 &quot;java/lang/Math.fma(FFF)F&quot;);</span>
380             }
381         }
382 
383         if (isJDK10OrHigher()) {
384             add(toBeInvestigated,
385                             &quot;java/lang/Math.multiplyHigh(JJ)J&quot;);
386         }
387 
388         if (isJDK11OrHigher()) {
389             // Relevant for Java flight recorder
390             add(toBeInvestigated,
391                             &quot;java/lang/CharacterDataLatin1.isDigit(I)Z&quot;,
392                             &quot;java/lang/CharacterDataLatin1.isLowerCase(I)Z&quot;,
393                             &quot;java/lang/CharacterDataLatin1.isUpperCase(I)Z&quot;,
394                             &quot;java/lang/CharacterDataLatin1.isWhitespace(I)Z&quot;,
395                             &quot;jdk/jfr/internal/JVM.getEventWriter()Ljava/lang/Object;&quot;);
396             if (!config.useBase64Intrinsics()) {
397                 add(ignore,
398                                 &quot;java/util/Base64$Encoder.encodeBlock([BII[BIZ)V&quot;);
399             }
</pre>
</td>
<td>
<hr />
<pre>
 44 import org.graalvm.compiler.hotspot.meta.HotSpotGraphBuilderPlugins;
 45 import org.graalvm.compiler.hotspot.meta.HotSpotProviders;
 46 import org.graalvm.compiler.nodes.graphbuilderconf.GraphBuilderConfiguration.Plugins;
 47 import org.graalvm.compiler.nodes.graphbuilderconf.InvocationPlugin;
 48 import org.graalvm.compiler.nodes.graphbuilderconf.InvocationPlugins;
 49 import org.graalvm.compiler.nodes.graphbuilderconf.InvocationPlugins.Binding;
 50 import org.graalvm.compiler.runtime.RuntimeProvider;
 51 import org.graalvm.compiler.serviceprovider.JavaVersionUtil;
 52 import org.graalvm.compiler.test.GraalTest;
 53 import org.junit.Test;
 54 
 55 import jdk.vm.ci.aarch64.AArch64;
 56 import jdk.vm.ci.amd64.AMD64;
 57 import jdk.vm.ci.code.Architecture;
 58 import jdk.vm.ci.hotspot.HotSpotVMConfigStore;
 59 import jdk.vm.ci.hotspot.VMIntrinsicMethod;
 60 import jdk.vm.ci.meta.MetaAccessProvider;
 61 import jdk.vm.ci.meta.MetaUtil;
 62 import jdk.vm.ci.meta.MethodHandleAccessProvider.IntrinsicMethod;
 63 import jdk.vm.ci.meta.ResolvedJavaMethod;

 64 
 65 /**
 66  * Checks the intrinsics implemented by Graal against the set of intrinsics declared by HotSpot. The
 67  * purpose of this test is to detect when new intrinsics are added to HotSpot and process them
 68  * appropriately in Graal. This will be achieved by working through {@link #toBeInvestigated} and
 69  * either implementing the intrinsic or moving it to {@link #ignore} .
 70  */
 71 public class CheckGraalIntrinsics extends GraalTest {
 72 
 73     public static boolean match(String type, Binding binding, VMIntrinsicMethod intrinsic) {
 74         if (intrinsic.name.equals(binding.name)) {
 75             if (intrinsic.descriptor.startsWith(binding.argumentsDescriptor)) {
 76                 if (type.equals(intrinsic.declaringClass)) {
 77                     return true;
 78                 }
 79             }
 80         }
 81         return false;
 82     }
 83 
</pre>
<hr />
<pre>
355 
356                             // handled by an intrinsic for StringUTF16.indexOfCharUnsafe
357                             &quot;java/lang/StringUTF16.indexOfChar([BIII)I&quot;,
358 
359                             // handled by an intrinsic for StringUTF16.indexOfLatin1Unsafe
360                             &quot;java/lang/StringUTF16.indexOfLatin1([BI[BII)I&quot;,
361                             &quot;java/lang/StringUTF16.indexOfLatin1([B[B)I&quot;);
362 
363             if (!config.useAESCTRIntrinsics) {
364                 add(ignore,
365                                 &quot;com/sun/crypto/provider/CounterMode.implCrypt([BII[BI)I&quot;);
366             }
367             if (!config.useGHASHIntrinsics()) {
368                 add(ignore,
369                                 &quot;com/sun/crypto/provider/GHASH.processBlocks([BII[J[J)V&quot;);
370             }
371             if (!config.useFMAIntrinsics) {
372                 add(ignore,
373                                 &quot;java/lang/Math.fma(DDD)D&quot;,
374                                 &quot;java/lang/Math.fma(FFF)F&quot;);




375             }
376         }
377 
378         if (isJDK10OrHigher()) {
379             add(toBeInvestigated,
380                             &quot;java/lang/Math.multiplyHigh(JJ)J&quot;);
381         }
382 
383         if (isJDK11OrHigher()) {
384             // Relevant for Java flight recorder
385             add(toBeInvestigated,
386                             &quot;java/lang/CharacterDataLatin1.isDigit(I)Z&quot;,
387                             &quot;java/lang/CharacterDataLatin1.isLowerCase(I)Z&quot;,
388                             &quot;java/lang/CharacterDataLatin1.isUpperCase(I)Z&quot;,
389                             &quot;java/lang/CharacterDataLatin1.isWhitespace(I)Z&quot;,
390                             &quot;jdk/jfr/internal/JVM.getEventWriter()Ljava/lang/Object;&quot;);
391             if (!config.useBase64Intrinsics()) {
392                 add(ignore,
393                                 &quot;java/util/Base64$Encoder.encodeBlock([BII[BIZ)V&quot;);
394             }
</pre>
</td>
</tr>
</table>
<center><a href="AheadOfTimeCompilationTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/GraalHotSpotVMConfig.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>