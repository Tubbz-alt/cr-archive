<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/sun/security/tools/keytool/KeyToolTest.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../ssl/SSLSocketImpl/NotifyHandshakeTest.sh.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="fakegen/DefaultSignatureAlgorithm.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/security/tools/keytool/KeyToolTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
  23 
  24 /*
  25  * @test
  26  * @bug 6251120 8231950 8242151
  27  * @summary Testing keytool
  28  *
  29  * Run through autotest.sh and manualtest.sh
  30  *
  31  * Testing non-PKCS11 keystores:
  32  *       echo | java -Dfile KeyToolTest
  33  *
  34  * Testing NSS PKCS11 keystores:
  35  *       # testing NSS
  36  *       # make sure the NSS db files are in current directory and writable
  37  *       echo | java -Dnss -Dnss.lib=/path/to/libsoftokn3.so KeyToolTest
  38  *
<span class="line-removed">  39  * Testing Solaris Cryptography Framework PKCS11 keystores:</span>
<span class="line-removed">  40  *       # make sure you&#39;ve already run pktool and set test12 as pin</span>
<span class="line-removed">  41  *       echo | java -Dsolaris KeyToolTest</span>
<span class="line-removed">  42  *</span>
  43  * ATTENTION:
  44  * Exception in thread &quot;main&quot; java.security.ProviderException:
  45  *   sun.security.pkcs11.wrapper.PKCS11Exception: CKR_KEY_SIZE_RANGE
  46  *       at sun.security.pkcs11.P11Signature.engineSign(P11Signature.java:420)
  47  *       ...
  48  * Caused by: sun.security.pkcs11.wrapper.PKCS11Exception: CKR_KEY_SIZE_RANGE
  49  *       at sun.security.pkcs11.wrapper.PKCS11.C_SignFinal(Native Method)
  50  *       at sun.security.pkcs11.P11Signature.engineSign(P11Signature.java:391)
  51  *       ...
  52  * been observed. Possibly a Solaris bug
  53  *
  54  * ATTENTION:
  55  * NSS PKCS11 config file are changed, DSA not supported now.
  56  *
  57  * @library /test/lib
  58  * @modules java.base/sun.security.tools.keytool
  59  *          java.base/sun.security.util
  60  *          java.base/sun.security.x509
  61  * @run main/othervm/timeout=600 -Dfile KeyToolTest
  62  */
</pre>
<hr />
<pre>
  89 
  90     static final String NSS_P11_ARG =
  91             &quot;-keystore NONE -storetype PKCS11 -providerName SunPKCS11-nss &quot; +
  92             &quot;-addprovider SunPKCS11 &quot; +
  93             &quot;-providerArg p11-nss.txt &quot;;
  94     // Use -providerClass here, to confirm it still works for SunPKCS11.
  95     static final String NSS_SRC_P11_ARG =
  96             &quot;-srckeystore NONE -srcstoretype PKCS11 &quot; +
  97             &quot;-srcproviderName SunPKCS11-nss &quot; +
  98             &quot;-providerClass sun.security.pkcs11.SunPKCS11 &quot; +
  99             &quot;-providerArg p11-nss.txt &quot;;
 100     static final String NZZ_P11_ARG =
 101             &quot;-keystore NONE -storetype PKCS11 -providerName SunPKCS11-nzz &quot; +
 102             &quot;-addprovider SunPKCS11 &quot; +
 103             &quot;-providerArg p11-nzz.txt &quot;;
 104     static final String NZZ_SRC_P11_ARG =
 105             &quot;-srckeystore NONE -srcstoretype PKCS11 &quot; +
 106             &quot;-srcproviderName SunPKCS11-nzz &quot; +
 107             &quot;-addprovider SunPKCS11 &quot; +
 108             &quot;-providerArg p11-nzz.txt &quot;;
<span class="line-removed"> 109     static final String SUN_P11_ARG = &quot;-keystore NONE -storetype PKCS11 &quot;;</span>
<span class="line-removed"> 110     static final String SUN_SRC_P11_ARG =</span>
<span class="line-removed"> 111             &quot;-srckeystore NONE -srcstoretype PKCS11 &quot;;</span>
 112 
 113     String p11Arg, srcP11Arg;
 114 
 115     /** Creates a new instance of KeyToolTest */
 116     KeyToolTest() {
 117         // so that there is &quot;Warning&quot; and not translated into other language
 118         Locale.setDefault(Locale.US);
 119     }
 120 
 121     /**
 122      * Helper, removes a file
 123      */
 124     void remove(String filename) {
 125         if (debug) {
 126             System.err.println(&quot;Removing &quot; + filename);
 127         }
 128         try{
 129             FileUtils.deleteFileIfExistsWithRetry(Paths.get(filename));
 130         }catch(IOException e) {
 131             throw new RuntimeException(&quot;Error deleting &quot; + filename, e);
</pre>
<hr />
<pre>
1843 
1844             if (System.getProperty(&quot;nss&quot;) != null) {
1845                 t.srcP11Arg = NSS_SRC_P11_ARG;
1846                 t.p11Arg = NSS_P11_ARG;
1847 
1848                 t.testPKCS11();
1849 
1850                 // FAIL:
1851                 // 1. we still don&#39;t have srcprovidername yet
1852                 // 2. cannot store privatekey into NSS keystore
1853                 //    java.security.KeyStoreException: sun.security.pkcs11
1854                 //      .wrapper.PKCS11Exception: CKR_TEMPLATE_INCOMPLETE.
1855                 //t.testPKCS11ImportKeyStore();
1856 
1857                 t.i18nPKCS11Test();
1858                 //FAIL: currently PKCS11-NSS does not support
1859                 // 2 NSS KeyStores to be loaded at the same time
1860                 //t.sszzTest();
1861             }
1862 
<span class="line-removed">1863             if (System.getProperty(&quot;solaris&quot;) != null) {</span>
<span class="line-removed">1864                 // For Solaris Cryptography Framework</span>
<span class="line-removed">1865                 t.srcP11Arg = SUN_SRC_P11_ARG;</span>
<span class="line-removed">1866                 t.p11Arg = SUN_P11_ARG;</span>
<span class="line-removed">1867                 t.testPKCS11();</span>
<span class="line-removed">1868                 t.testPKCS11ImportKeyStore();</span>
<span class="line-removed">1869                 t.i18nPKCS11Test();</span>
<span class="line-removed">1870             }</span>
<span class="line-removed">1871 </span>
1872             System.out.println(&quot;Test pass!!!&quot;);
1873         } finally {
1874             // restore the reserved locale
1875             Locale.setDefault(reservedLocale);
1876         }
1877     }
1878 }
1879 
1880 class TestException extends Exception {
1881     public TestException(String e) {
1882         super(e);
1883     }
1884 }
1885 
1886 /**
1887  * HumanInputStream tries to act like a human sitting in front of a computer
1888  * terminal typing on the keyboard while the keytool program is running.
1889  *
1890  * keytool has called InputStream.read() and BufferedReader.readLine() in
1891  * various places. a call to B.readLine() will try to buffer as much input as
</pre>
</td>
<td>
<hr />
<pre>
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
  23 
  24 /*
  25  * @test
  26  * @bug 6251120 8231950 8242151
  27  * @summary Testing keytool
  28  *
  29  * Run through autotest.sh and manualtest.sh
  30  *
  31  * Testing non-PKCS11 keystores:
  32  *       echo | java -Dfile KeyToolTest
  33  *
  34  * Testing NSS PKCS11 keystores:
  35  *       # testing NSS
  36  *       # make sure the NSS db files are in current directory and writable
  37  *       echo | java -Dnss -Dnss.lib=/path/to/libsoftokn3.so KeyToolTest
  38  *




  39  * ATTENTION:
  40  * Exception in thread &quot;main&quot; java.security.ProviderException:
  41  *   sun.security.pkcs11.wrapper.PKCS11Exception: CKR_KEY_SIZE_RANGE
  42  *       at sun.security.pkcs11.P11Signature.engineSign(P11Signature.java:420)
  43  *       ...
  44  * Caused by: sun.security.pkcs11.wrapper.PKCS11Exception: CKR_KEY_SIZE_RANGE
  45  *       at sun.security.pkcs11.wrapper.PKCS11.C_SignFinal(Native Method)
  46  *       at sun.security.pkcs11.P11Signature.engineSign(P11Signature.java:391)
  47  *       ...
  48  * been observed. Possibly a Solaris bug
  49  *
  50  * ATTENTION:
  51  * NSS PKCS11 config file are changed, DSA not supported now.
  52  *
  53  * @library /test/lib
  54  * @modules java.base/sun.security.tools.keytool
  55  *          java.base/sun.security.util
  56  *          java.base/sun.security.x509
  57  * @run main/othervm/timeout=600 -Dfile KeyToolTest
  58  */
</pre>
<hr />
<pre>
  85 
  86     static final String NSS_P11_ARG =
  87             &quot;-keystore NONE -storetype PKCS11 -providerName SunPKCS11-nss &quot; +
  88             &quot;-addprovider SunPKCS11 &quot; +
  89             &quot;-providerArg p11-nss.txt &quot;;
  90     // Use -providerClass here, to confirm it still works for SunPKCS11.
  91     static final String NSS_SRC_P11_ARG =
  92             &quot;-srckeystore NONE -srcstoretype PKCS11 &quot; +
  93             &quot;-srcproviderName SunPKCS11-nss &quot; +
  94             &quot;-providerClass sun.security.pkcs11.SunPKCS11 &quot; +
  95             &quot;-providerArg p11-nss.txt &quot;;
  96     static final String NZZ_P11_ARG =
  97             &quot;-keystore NONE -storetype PKCS11 -providerName SunPKCS11-nzz &quot; +
  98             &quot;-addprovider SunPKCS11 &quot; +
  99             &quot;-providerArg p11-nzz.txt &quot;;
 100     static final String NZZ_SRC_P11_ARG =
 101             &quot;-srckeystore NONE -srcstoretype PKCS11 &quot; +
 102             &quot;-srcproviderName SunPKCS11-nzz &quot; +
 103             &quot;-addprovider SunPKCS11 &quot; +
 104             &quot;-providerArg p11-nzz.txt &quot;;



 105 
 106     String p11Arg, srcP11Arg;
 107 
 108     /** Creates a new instance of KeyToolTest */
 109     KeyToolTest() {
 110         // so that there is &quot;Warning&quot; and not translated into other language
 111         Locale.setDefault(Locale.US);
 112     }
 113 
 114     /**
 115      * Helper, removes a file
 116      */
 117     void remove(String filename) {
 118         if (debug) {
 119             System.err.println(&quot;Removing &quot; + filename);
 120         }
 121         try{
 122             FileUtils.deleteFileIfExistsWithRetry(Paths.get(filename));
 123         }catch(IOException e) {
 124             throw new RuntimeException(&quot;Error deleting &quot; + filename, e);
</pre>
<hr />
<pre>
1836 
1837             if (System.getProperty(&quot;nss&quot;) != null) {
1838                 t.srcP11Arg = NSS_SRC_P11_ARG;
1839                 t.p11Arg = NSS_P11_ARG;
1840 
1841                 t.testPKCS11();
1842 
1843                 // FAIL:
1844                 // 1. we still don&#39;t have srcprovidername yet
1845                 // 2. cannot store privatekey into NSS keystore
1846                 //    java.security.KeyStoreException: sun.security.pkcs11
1847                 //      .wrapper.PKCS11Exception: CKR_TEMPLATE_INCOMPLETE.
1848                 //t.testPKCS11ImportKeyStore();
1849 
1850                 t.i18nPKCS11Test();
1851                 //FAIL: currently PKCS11-NSS does not support
1852                 // 2 NSS KeyStores to be loaded at the same time
1853                 //t.sszzTest();
1854             }
1855 









1856             System.out.println(&quot;Test pass!!!&quot;);
1857         } finally {
1858             // restore the reserved locale
1859             Locale.setDefault(reservedLocale);
1860         }
1861     }
1862 }
1863 
1864 class TestException extends Exception {
1865     public TestException(String e) {
1866         super(e);
1867     }
1868 }
1869 
1870 /**
1871  * HumanInputStream tries to act like a human sitting in front of a computer
1872  * terminal typing on the keyboard while the keytool program is running.
1873  *
1874  * keytool has called InputStream.read() and BufferedReader.readLine() in
1875  * various places. a call to B.readLine() will try to buffer as much input as
</pre>
</td>
</tr>
</table>
<center><a href="../../ssl/SSLSocketImpl/NotifyHandshakeTest.sh.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="fakegen/DefaultSignatureAlgorithm.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>