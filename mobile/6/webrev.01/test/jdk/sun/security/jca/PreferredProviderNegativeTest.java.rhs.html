<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/sun/security/jca/PreferredProviderNegativeTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
    <script type="text/javascript" src="../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2015, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 import java.security.Security;
 25 import java.security.NoSuchAlgorithmException;
 26 import javax.crypto.Cipher;
 27 import javax.crypto.NoSuchPaddingException;
 28 
 29 /**
 30  * @test
 31  * @bug 8076359 8133151 8150512
 32  * @summary Test for jdk.security.provider.preferred security property
 33  * @run main/othervm  PreferredProviderNegativeTest preSet AES false
 34  * @run main/othervm  PreferredProviderNegativeTest preSet AES:SunNegative true
 35  * @run main/othervm  PreferredProviderNegativeTest afterSet AES:SunJGSS
 36  * @run main/othervm  PreferredProviderNegativeTest afterSet AES:SunECNegative
 37  * @run main/othervm  PreferredProviderNegativeTest invalidAlg AESInvalid:SunJCE
 38  */
 39 public class PreferredProviderNegativeTest {
 40 
 41     static final String SEC_PREF_PROP = &quot;jdk.security.provider.preferred&quot;;
 42 
 43     /*
 44      * Test security property could be set by valid and invalid provider
 45      * before JCE was loaded
 46      */
 47     public static void preJCESet(String value, boolean negativeProvider)
 48             throws NoSuchAlgorithmException, NoSuchPaddingException {
 49 
 50         Security.setProperty(SEC_PREF_PROP, value);
 51 
 52         if (!Security.getProperty(SEC_PREF_PROP).equals(value)) {
 53             throw new RuntimeException(&quot;Test Failed:The property wasn&#39;t set&quot;);
 54         }
 55 
 56         String[] arrays = value.split(&quot;:&quot;);
 57         Cipher cipher = Cipher.getInstance(arrays[0]);
 58         if (negativeProvider) {
 59             if (cipher.getProvider().getName().equals(arrays[1])) {
 60                 throw new RuntimeException(
 61                         &quot;Test Failed:The provider shouldn&#39;t be set.&quot;);
 62             }
 63         } else {
 64             if (!cipher.getProvider().getName().equals(arrays[1])) {
 65                 throw new RuntimeException(&quot;Test Failed:The provider could be &quot;
 66                         + &quot;set by valid provider.&quot;);
 67             }
 68         }
 69         System.out.println(&quot;Test Pass.&quot;);
 70     }
 71 
 72     /*
 73      * Test that the setting of the security property after Cipher.getInstance()
 74      * does not influence previously loaded instances
 75      */
 76     public static void afterJCESet(String value, String expected)
 77             throws NoSuchAlgorithmException, NoSuchPaddingException {
 78         String[] arrays = value.split(&quot;:&quot;);
 79         Cipher cipher = Cipher.getInstance(arrays[0]);
 80 
 81         Security.setProperty(SEC_PREF_PROP, value);
 82         if (!cipher.getProvider().getName().equals(expected)) {
 83             throw new RuntimeException(&quot;Test Failed:The security property can&#39;t&quot;
 84                     + &quot; be updated after JCE load.&quot;);
 85         }
 86         System.out.println(&quot;Test Pass&quot;);
 87     }
 88 
 89     /* Test the security property with negative algorithm */
 90     public static void invalidAlg(String value) throws NoSuchPaddingException {
 91         String[] arrays = value.split(&quot;:&quot;);
 92 
 93         try {
 94             Security.setProperty(SEC_PREF_PROP, value);
 95             Cipher.getInstance(arrays[0]);
 96         } catch (NoSuchAlgorithmException e) {
 97             System.out.println(
 98                     &quot;Test Pass:Got NoSuchAlgorithmException as expired&quot;);
 99             return;
100         }
101         throw new RuntimeException(
102                 &quot;Test Failed:Expected NoSuchAlgorithmException was not thrown&quot;);
103     }
104 
105     public static void main(String[] args)
106             throws NoSuchAlgorithmException, NoSuchPaddingException {
107 
108         String expected;
109         String value = args[1];
<a name="2" id="anc2"></a><span class="line-modified">110         expected = &quot;SunJCE&quot;;</span>





111 
112         if (args.length &gt;= 2) {
113             switch (args[0]) {
114                 case &quot;preSet&quot;:
115                     boolean negativeProvider = Boolean.valueOf(args[2]);
116                     if (!args[1].contains(&quot;:&quot;)) {
117                         value += &quot;:&quot; + expected;
118                     }
119                     PreferredProviderNegativeTest.preJCESet(
120                             value, negativeProvider);
121                     break;
122                 case &quot;afterSet&quot;:
123                     PreferredProviderNegativeTest.afterJCESet(args[1],
124                             expected);
125                     break;
126                 case &quot;invalidAlg&quot;:
127                     PreferredProviderNegativeTest.invalidAlg(args[1]);
128                     break;
129             }
130         } else {
131             throw new RuntimeException(
132                     &quot;Test Failed:Please pass the correct args&quot;);
133         }
134     }
135 }
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>