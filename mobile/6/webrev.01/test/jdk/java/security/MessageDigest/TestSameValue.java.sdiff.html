<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/security/MessageDigest/TestSameValue.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="TestSameLength.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../SecureRandom/DefaultProvider.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/security/MessageDigest/TestSameValue.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 43 
 44 public class TestSameValue {
 45 
 46     public static void main(String[] args) throws Exception {
 47         TestSameValue test1 = new TestSameValue();
 48         test1.run();
 49     }
 50 
 51     private void run() throws Exception {
 52 
 53         byte[] data = new byte[6706];
 54         MessageDigest md = null;
 55         // Initialize input data
 56         RandomFactory.getRandom().nextBytes(data);
 57 
 58         String[] algorithmArr = { &quot;SHA&quot;, &quot;Sha&quot;, &quot;MD5&quot;, &quot;md5&quot;, &quot;SHA-224&quot;,
 59                 &quot;SHA-256&quot;, &quot;SHA-384&quot;, &quot;SHA-512&quot;, &quot;SHA3-224&quot;, &quot;SHA3-256&quot;,
 60                 &quot;SHA3-384&quot;, &quot;SHA3-512&quot; };
 61 
 62         for (String algorithm : algorithmArr) {
<span class="line-modified"> 63             try {</span>
<span class="line-removed"> 64                 md = MessageDigest.getInstance(algorithm);</span>
 65 
<span class="line-modified"> 66                 for (UpdateDigestMethod updateMethod : UpdateDigestMethod</span>
<span class="line-modified"> 67                         .values()) {</span>
<span class="line-modified"> 68                     byte[] output = updateMethod.updateDigest(data, md);</span>
<span class="line-modified"> 69                     // Get the output and the &quot;correct&quot; one</span>
<span class="line-modified"> 70                     byte[] standard = md.digest(data);</span>
<span class="line-modified"> 71                     // Compare input and output</span>
<span class="line-modified"> 72                     if (!MessageDigest.isEqual(output, standard)) {</span>
<span class="line-modified"> 73                         throw new RuntimeException(</span>
<span class="line-modified"> 74                                 &quot;Test failed at algorithm/provider/numUpdate:&quot;</span>
<span class="line-modified"> 75                                         + algorithm + &quot;/&quot; + md.getProvider()</span>
<span class="line-modified"> 76                                         + &quot;/&quot; + updateMethod);</span>
<span class="line-removed"> 77                     }</span>
<span class="line-removed"> 78                 }</span>
<span class="line-removed"> 79             } catch (NoSuchAlgorithmException nae) {</span>
<span class="line-removed"> 80                 if (algorithm.startsWith(&quot;SHA3&quot;) &amp;&amp; !isSHA3supported()) {</span>
<span class="line-removed"> 81                     continue;</span>
<span class="line-removed"> 82                 } else {</span>
<span class="line-removed"> 83                     throw nae;</span>
 84                 }
 85             }
 86         }
 87 
 88         out.println(&quot;All &quot;
 89                 + algorithmArr.length * UpdateDigestMethod.values().length
 90                 + &quot; tests Passed&quot;);
 91     }
 92 
<span class="line-removed"> 93     // SHA-3 hash algorithms are only supported by &quot;SUN&quot; provider</span>
<span class="line-removed"> 94     // and &quot;OracleUcrypto&quot; provider on Solaris 12.0 or later</span>
<span class="line-removed"> 95     // This method checks if system supports SHA-3</span>
<span class="line-removed"> 96     private boolean isSHA3supported() {</span>
<span class="line-removed"> 97         if (Security.getProvider(&quot;SUN&quot;) != null) {</span>
<span class="line-removed"> 98             return true;</span>
<span class="line-removed"> 99         }</span>
<span class="line-removed">100         if (Security.getProvider(&quot;OracleUcrypto&quot;) != null</span>
<span class="line-removed">101                 &amp;&amp; &quot;SunOS&quot;.equals(System.getProperty(&quot;os.name&quot;))</span>
<span class="line-removed">102                 &amp;&amp; System.getProperty(&quot;os.version&quot;).compareTo(&quot;5.12&quot;) &gt;= 0) {</span>
<span class="line-removed">103             return true;</span>
<span class="line-removed">104         }</span>
<span class="line-removed">105         return false;</span>
<span class="line-removed">106     }</span>
<span class="line-removed">107 </span>
108     private static enum UpdateDigestMethod {
109 
110         /*
111          * update the data one by one using method update(byte input) then do
112          * digest (giving the output buffer, offset, and the number of bytes to
113          * put in the output buffer)
114          */
115         UPDATE_DIGEST_BUFFER {
116             @Override
117             public byte[] updateDigest(byte[] data, MessageDigest md)
118                     throws DigestException {
119                 for (byte element : data) {
120                     md.update(element);
121                 }
122                 byte[] output = new byte[md.getDigestLength()];
123                 int len = md.digest(output, 0, output.length);
124                 if (len != output.length) {
125                     throw new RuntimeException(
126                             &quot;ERROR&quot; + &quot;: digest length differs!&quot;);
127                 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 43 
 44 public class TestSameValue {
 45 
 46     public static void main(String[] args) throws Exception {
 47         TestSameValue test1 = new TestSameValue();
 48         test1.run();
 49     }
 50 
 51     private void run() throws Exception {
 52 
 53         byte[] data = new byte[6706];
 54         MessageDigest md = null;
 55         // Initialize input data
 56         RandomFactory.getRandom().nextBytes(data);
 57 
 58         String[] algorithmArr = { &quot;SHA&quot;, &quot;Sha&quot;, &quot;MD5&quot;, &quot;md5&quot;, &quot;SHA-224&quot;,
 59                 &quot;SHA-256&quot;, &quot;SHA-384&quot;, &quot;SHA-512&quot;, &quot;SHA3-224&quot;, &quot;SHA3-256&quot;,
 60                 &quot;SHA3-384&quot;, &quot;SHA3-512&quot; };
 61 
 62         for (String algorithm : algorithmArr) {
<span class="line-modified"> 63             md = MessageDigest.getInstance(algorithm);</span>

 64 
<span class="line-modified"> 65             for (UpdateDigestMethod updateMethod : UpdateDigestMethod</span>
<span class="line-modified"> 66                      .values()) {</span>
<span class="line-modified"> 67                 byte[] output = updateMethod.updateDigest(data, md);</span>
<span class="line-modified"> 68                 // Get the output and the &quot;correct&quot; one</span>
<span class="line-modified"> 69                 byte[] standard = md.digest(data);</span>
<span class="line-modified"> 70                 // Compare input and output</span>
<span class="line-modified"> 71                 if (!MessageDigest.isEqual(output, standard)) {</span>
<span class="line-modified"> 72                     throw new RuntimeException(</span>
<span class="line-modified"> 73                             &quot;Test failed at algorithm/provider/numUpdate:&quot;</span>
<span class="line-modified"> 74                                     + algorithm + &quot;/&quot; + md.getProvider()</span>
<span class="line-modified"> 75                                     + &quot;/&quot; + updateMethod);</span>







 76                 }
 77             }
 78         }
 79 
 80         out.println(&quot;All &quot;
 81                 + algorithmArr.length * UpdateDigestMethod.values().length
 82                 + &quot; tests Passed&quot;);
 83     }
 84 















 85     private static enum UpdateDigestMethod {
 86 
 87         /*
 88          * update the data one by one using method update(byte input) then do
 89          * digest (giving the output buffer, offset, and the number of bytes to
 90          * put in the output buffer)
 91          */
 92         UPDATE_DIGEST_BUFFER {
 93             @Override
 94             public byte[] updateDigest(byte[] data, MessageDigest md)
 95                     throws DigestException {
 96                 for (byte element : data) {
 97                     md.update(element);
 98                 }
 99                 byte[] output = new byte[md.getDigestLength()];
100                 int len = md.digest(output, 0, output.length);
101                 if (len != output.length) {
102                     throw new RuntimeException(
103                             &quot;ERROR&quot; + &quot;: digest length differs!&quot;);
104                 }
</pre>
</td>
</tr>
</table>
<center><a href="TestSameLength.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../SecureRandom/DefaultProvider.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>