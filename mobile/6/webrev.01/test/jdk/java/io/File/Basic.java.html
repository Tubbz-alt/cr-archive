<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/java/io/File/Basic.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 1998, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /* @test
 25  * @bug 4165666 4203706 4288670 4290024
 26  * @summary Basic heartbeat test for File methods that access the filesystem
 27  * @build Basic Util
 28  * @run main/othervm Basic
 29  */
 30 
 31 import java.io.FileOutputStream;
 32 import java.io.IOException;
 33 import java.io.File;
 34 import java.io.PrintStream;
 35 import java.io.RandomAccessFile;
 36 
 37 
 38 public class Basic {
 39 
 40     static PrintStream out = System.err;
 41 
 42     static File rwFile = new File(&quot;x.Basic.rw&quot;);
 43     static File bigFile = new File(&quot;x.Basic.big&quot;);
 44     static File roFile = new File(&quot;x.Basic.ro&quot;);
 45     static File thisDir = new File(&quot;.&quot;);
 46     static File dir = new File(&quot;x.Basic.dir&quot;);
 47     static File dir2 = new File(&quot;x.Basic.dir2&quot;);
 48     static byte bytes[] = new byte[] {1, 2, 3, 4, 5, 6};
 49 
 50     static void showBoolean(String what, boolean value) {
 51         out.println(&quot;  &quot; + what + &quot;: &quot; + value);
 52     }
 53 
 54     static void showLong(String what, long value) {
 55         out.println(&quot;  &quot; + what + &quot;: &quot; + value);
 56     }
 57 
 58     static void show(File f) throws Exception {
 59         out.println(f + &quot;: &quot;);
 60         showBoolean(&quot;exists&quot;, f.exists());
 61         showBoolean(&quot;isFile&quot;, f.isFile());
 62         showBoolean(&quot;isDirectory&quot;, f.isDirectory());
 63         showBoolean(&quot;canRead&quot;, f.canRead());
 64         showBoolean(&quot;canWrite&quot;, f.canWrite());
 65         showLong(&quot;lastModified&quot;, f.lastModified());
 66         showLong(&quot;length&quot;, f.length());
 67     }
 68 
 69     static void testFile(File f, boolean writeable, long length)
 70         throws Exception
 71     {
 72         if (!f.exists()) fail(f, &quot;does not exist&quot;);
 73         if (!f.isFile()) fail(f, &quot;is not a file&quot;);
 74         if (f.isDirectory()) fail(f, &quot;is a directory&quot;);
 75         if (!f.canRead()) fail(f, &quot;is not readable&quot;);
 76         if (!Util.isPrivileged() &amp;&amp; f.canWrite() != writeable)
 77             fail(f, writeable ? &quot;is not writeable&quot; : &quot;is writeable&quot;);
 78         if (f.length() != length) fail(f, &quot;has wrong length&quot;);
 79     }
 80 
 81     static void fail(File f, String why) throws Exception {
 82         throw new Exception(f + &quot; &quot; + why);
 83     }
 84 
 85     static void setup() throws Exception {
 86         rwFile.delete();
 87         bigFile.delete();
 88         roFile.delete();
 89         thisDir.delete();
 90         dir.delete();
 91         dir2.delete();
 92 
 93         try (FileOutputStream fos = new FileOutputStream(rwFile)) {
 94             fos.write(bytes);
 95         }
 96 
 97         roFile.createNewFile();
 98         roFile.setReadOnly();
 99     }
100 
101     public static void main(String[] args) throws Exception {
102         setup();
103 
104         show(rwFile);
105         testFile(rwFile, true, bytes.length);
106         rwFile.delete();
107         if (rwFile.exists()) {
108             fail(rwFile, &quot;could not delete&quot;);
109         }
110 
111         show(roFile);
112         testFile(roFile, false, 0);
113 
114         show(thisDir);
115         if (!thisDir.exists()) fail(thisDir, &quot;does not exist&quot;);
116         if (thisDir.isFile()) fail(thisDir, &quot;is a file&quot;);
117         if (!thisDir.isDirectory()) fail(thisDir, &quot;is not a directory&quot;);
118         if (!thisDir.canRead()) fail(thisDir, &quot;is readable&quot;);
119         if (!thisDir.canWrite()) fail(thisDir, &quot;is writeable&quot;);
120         String[] fs = thisDir.list();
121         if (fs == null) fail(thisDir, &quot;list() returned null&quot;);
122         out.print(&quot;  [&quot; + fs.length + &quot;]&quot;);
123         for (int i = 0; i &lt; fs.length; i++) {
124             out.print(&quot; &quot; + fs[i]);
125         }
126         out.println();
127         if (fs.length == 0) fail(thisDir, &quot;is empty&quot;);
128 
129         if (!dir.mkdir() || !dir.exists() || !dir.isDirectory()) {
130             fail(dir, &quot;could not create&quot;);
131         }
132         if (!dir.renameTo(dir2)) {
133             fail(dir, &quot;failed to rename&quot;);
134         }
135         if (dir.exists() || !dir2.exists() || !dir2.isDirectory()) {
136             fail(dir, &quot;not renamed&quot;);
137         }
138 
139         System.err.println(&quot;NOTE: Large files not supported on this system&quot;);
140     }
141 
142 }
    </pre>
  </body>
</html>