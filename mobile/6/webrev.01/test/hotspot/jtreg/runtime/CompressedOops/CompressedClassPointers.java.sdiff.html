<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/runtime/CompressedOops/CompressedClassPointers.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../CheckUnhandledOops/TestVerifyOops.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="UseCompressedOops.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/runtime/CompressedOops/CompressedClassPointers.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
242             &quot;-XX:-UseCompressedOops&quot;,
243             &quot;-XX:+UseCompressedClassPointers&quot;,
244             &quot;-XX:+UnlockDiagnosticVMOptions&quot;,
245             &quot;-XX:SharedArchiveFile=./CompressedClassPointers.jsa&quot;,
246             &quot;-Xmx128m&quot;,
247             &quot;-XX:SharedBaseAddress=8g&quot;,
248             &quot;-XX:+PrintCompressedOopsMode&quot;,
249             &quot;-Xshare:on&quot;,
250             &quot;-version&quot;);
251           output = new OutputAnalyzer(pb.start());
252           output.shouldContain(&quot;sharing&quot;);
253           output.shouldHaveExitValue(0);
254 
255         } catch (RuntimeException e) {
256           output.shouldContain(&quot;Unable to use shared archive&quot;);
257           output.shouldHaveExitValue(1);
258         }
259     }
260 
261     public static void main(String[] args) throws Exception {
<span class="line-removed">262         if (Platform.isSolaris()) {</span>
<span class="line-removed">263              String name = System.getProperty(&quot;os.version&quot;);</span>
<span class="line-removed">264              if (name.equals(&quot;5.10&quot;)) {</span>
<span class="line-removed">265                 throw new SkippedException(&quot;Solaris 10 can&#39;t mmap compressed oops space without a base&quot;);</span>
<span class="line-removed">266              }</span>
<span class="line-removed">267         }</span>
268         smallHeapTest();
269         smallHeapTestWith1G();
270         largeHeapTest();
271         largePagesTest();
272         heapBaseMinAddressTest();
273         sharingTest();
274 
<span class="line-modified">275         boolean ccpRequiresCoop = Platform.isAArch64() || Platform.isSparc();</span>
276 
277         if (!ccpRequiresCoop &amp;&amp; !Platform.isOSX()) {
278             // Testing compressed class pointers without compressed oops.
279             // This is only possible if the platform supports it. Notably,
280             // on macOS, when compressed oops is disabled and the heap is
281             // given an arbitrary address, that address occasionally collides
282             // with where we would ideally have placed the compressed class
283             // space. Therefore, macOS is omitted for now.
284             smallHeapTestNoCoop();
285             smallHeapTestWith1GNoCoop();
286             largeHeapTestNoCoop();
287             largePagesTestNoCoop();
288             heapBaseMinAddressTestNoCoop();
289             sharingTestNoCoop();
290         }
291     }
292 }
</pre>
</td>
<td>
<hr />
<pre>
242             &quot;-XX:-UseCompressedOops&quot;,
243             &quot;-XX:+UseCompressedClassPointers&quot;,
244             &quot;-XX:+UnlockDiagnosticVMOptions&quot;,
245             &quot;-XX:SharedArchiveFile=./CompressedClassPointers.jsa&quot;,
246             &quot;-Xmx128m&quot;,
247             &quot;-XX:SharedBaseAddress=8g&quot;,
248             &quot;-XX:+PrintCompressedOopsMode&quot;,
249             &quot;-Xshare:on&quot;,
250             &quot;-version&quot;);
251           output = new OutputAnalyzer(pb.start());
252           output.shouldContain(&quot;sharing&quot;);
253           output.shouldHaveExitValue(0);
254 
255         } catch (RuntimeException e) {
256           output.shouldContain(&quot;Unable to use shared archive&quot;);
257           output.shouldHaveExitValue(1);
258         }
259     }
260 
261     public static void main(String[] args) throws Exception {






262         smallHeapTest();
263         smallHeapTestWith1G();
264         largeHeapTest();
265         largePagesTest();
266         heapBaseMinAddressTest();
267         sharingTest();
268 
<span class="line-modified">269         boolean ccpRequiresCoop = Platform.isAArch64();</span>
270 
271         if (!ccpRequiresCoop &amp;&amp; !Platform.isOSX()) {
272             // Testing compressed class pointers without compressed oops.
273             // This is only possible if the platform supports it. Notably,
274             // on macOS, when compressed oops is disabled and the heap is
275             // given an arbitrary address, that address occasionally collides
276             // with where we would ideally have placed the compressed class
277             // space. Therefore, macOS is omitted for now.
278             smallHeapTestNoCoop();
279             smallHeapTestWith1GNoCoop();
280             largeHeapTestNoCoop();
281             largePagesTestNoCoop();
282             heapBaseMinAddressTestNoCoop();
283             sharingTestNoCoop();
284         }
285     }
286 }
</pre>
</td>
</tr>
</table>
<center><a href="../CheckUnhandledOops/TestVerifyOops.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="UseCompressedOops.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>