<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old make/scripts/compare.sh</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
  <body>
    <pre>
   1 #!/bin/bash
   2 #
   3 # Copyright (c) 2012, 2020, Oracle and/or its affiliates. All rights reserved.
   4 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   5 #
   6 # This code is free software; you can redistribute it and/or modify it
   7 # under the terms of the GNU General Public License version 2 only, as
   8 # published by the Free Software Foundation.
   9 #
  10 # This code is distributed in the hope that it will be useful, but WITHOUT
  11 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  12 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  13 # version 2 for more details (a copy is included in the LICENSE file that
  14 # accompanied this code).
  15 #
  16 # You should have received a copy of the GNU General Public License version
  17 # 2 along with this work; if not, write to the Free Software Foundation,
  18 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  19 #
  20 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  21 # or visit www.oracle.com if you need additional information or have any
  22 # questions.
  23 #
  24 
  25 # This script is processed by configure before it&#39;s usable. It is run from
  26 # the root of the build directory.
  27 
  28 
  29 ################################################################################
  30 
  31 # Check that we are run via the wrapper generated by configure
  32 if [ -z &quot;$TOPDIR&quot; ]; then
  33     echo &quot;Error: You must run this script using build/[conf]/compare.sh&quot;
  34     exit 1
  35 fi
  36 
  37 # Make sure all shell commands are executed with the C locale
  38 export LC_ALL=C
  39 
  40 if [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;macosx&quot; ]; then
  41     FULLDUMP_CMD=&quot;$OTOOL -v -V -h -X -d&quot;
  42     LDD_CMD=&quot;$OTOOL -L&quot;
  43     DIS_CMD=&quot;$OTOOL -v -V -t&quot;
  44     STAT_PRINT_SIZE=&quot;-f %z&quot;
  45 elif [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;windows&quot; ]; then
  46     FULLDUMP_CMD=&quot;$DUMPBIN -all&quot;
  47     LDD_CMD=&quot;$DUMPBIN -dependents&quot;
  48     DIS_CMD=&quot;$DUMPBIN -disasm:nobytes&quot;
  49     STAT_PRINT_SIZE=&quot;-c %s&quot;
  50 elif [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;aix&quot; ]; then
  51     FULLDUMP_CMD=&quot;dump -h -r -t -n -X64&quot;
  52     LDD_CMD=&quot;$LDD&quot;
  53     DIS_CMD=&quot;$OBJDUMP -d&quot;
  54     STAT_PRINT_SIZE=&quot;-c %s&quot;
  55 else
  56     FULLDUMP_CMD=&quot;$READELF -a&quot;
  57     LDD_CMD=&quot;$LDD&quot;
  58     DIS_CMD=&quot;$OBJDUMP -d&quot;
  59     STAT_PRINT_SIZE=&quot;-c %s&quot;
  60 fi
  61 
  62 COMPARE_EXCEPTIONS_INCLUDE=&quot;$TOPDIR/make/scripts/compare_exceptions.sh.incl&quot;
  63 if [ ! -e &quot;$COMPARE_EXCEPTIONS_INCLUDE&quot; ]; then
  64     echo &quot;Error: Cannot locate the exceptions file, it should have been here: $COMPARE_EXCEPTIONS_INCLUDE&quot;
  65     exit 1
  66 fi
  67 # Include exception definitions
  68 . &quot;$COMPARE_EXCEPTIONS_INCLUDE&quot;
  69 
  70 ################################################################################
  71 #
  72 # Disassembly diff filters. These filters try to filter out ephemeral parts of the
  73 # disassembly, such as hard-coded addresses, to be able to catch &quot;actual&quot; differences.
  74 
  75 if [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;solaris&quot; ]; then
  76   if [ &quot;$OPENJDK_TARGET_CPU&quot; = &quot;sparcv9&quot; ]; then
  77     DIS_DIFF_FILTER=&quot;$SED \
  78         -e &#39;s/^[0-9a-f]\{16\}/&lt;ADDR&gt;:/&#39; \
  79         -e &#39;s/^ *[0-9a-f]\{3,12\}:/  &lt;ADDR&gt;:/&#39; \
  80         -e &#39;s/:	[0-9a-f][0-9a-f]\( [0-9a-f][0-9a-f]\)\{2,10\}/:	&lt;NUMS&gt;/&#39; \
  81         -e &#39;s/\$[a-zA-Z0-9_\$]\{15\}\./&lt;SYM&gt;./&#39; \
  82         -e &#39;s/, [0-9a-fx\-]\{1,8\}/, &lt;ADDR&gt;/g&#39; \
  83         -e &#39;s/0x[0-9a-f]\{1,8\}/&lt;HEX&gt;/g&#39; \
  84         -e &#39;s/\! [0-9a-f]\{1,8\} /! &lt;ADDR&gt; /&#39; \
  85         -e &#39;s/call  [0-9a-f]\{4,7\}/call  &lt;ADDR&gt;/&#39; \
  86         -e &#39;s/%hi(0),/%hi(&lt;HEX&gt;),/&#39; \
  87         &quot;
  88   elif [ &quot;$OPENJDK_TARGET_CPU&quot; = &quot;x86_64&quot; ]; then
  89     # Random strings looking like this differ: &lt;.XAKoKoPIac2W0OA.
  90     DIS_DIFF_FILTER=&quot;$SED \
  91         -e &#39;s/&lt;\.[A-Za-z0-9]\{\15}\./&lt;.SYM./&#39; \
  92         &quot;
  93   fi
  94 elif [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;windows&quot; ]; then
  95   if [ &quot;$OPENJDK_TARGET_CPU&quot; = &quot;x86&quot; ]; then
  96     DIS_DIFF_FILTER=&quot;$SED -r \
  97         -e &#39;s/^  [0-9A-F]{16}: //&#39; \
  98         -e &#39;s/^  [0-9A-F]{8}: /  &lt;ADDR&gt;: /&#39; \
  99         -e &#39;s/(offset \?\?)_C@_.*/\1&lt;SYM&gt;/&#39; \
 100         -e &#39;s/[@?][A-Za-z0-9_]{1,25}/&lt;SYM&gt;/&#39; \
 101         -e &#39;s/([-,+])[0-9A-F]{2,16}/\1&lt;HEXSTR&gt;/g&#39; \
 102         -e &#39;s/\[[0-9A-F]{4,16}h\]/[&lt;HEXSTR&gt;]/&#39; \
 103         -e &#39;s/: ([a-z]{2}[a-z ]{2})        [0-9A-F]{2,16}h?$/: \1        &lt;HEXSTR&gt;/&#39; \
 104         -e &#39;s/_20[0-9]{2}_[0-1][0-9]_[0-9]{2}/_&lt;DATE&gt;/&#39; \
 105         &quot;
 106   elif [ &quot;$OPENJDK_TARGET_CPU&quot; = &quot;x86_64&quot; ]; then
 107     DIS_DIFF_FILTER=&quot;$SED -r \
 108         -e &#39;s/^  [0-9A-F]{16}: //&#39; \
 109         -e &#39;s/\[[0-9A-F]{4,16}h\]/[&lt;HEXSTR&gt;]/&#39; \
 110         -e &#39;s/([,+])[0-9A-F]{2,16}h/\1&lt;HEXSTR&gt;/&#39; \
 111         -e &#39;s/([a-z]{2}[a-z ]{2})        [0-9A-F]{4,16}$/\1        &lt;HEXSTR&gt;/&#39; \
 112         -e &#39;s/\[\?\?_C@_.*/[&lt;SYM&gt;]/&#39; \
 113         &quot;
 114   fi
 115 elif [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;macosx&quot; ]; then
 116   DIS_DIFF_FILTER=&quot;$SED \
 117       -e &#39;s/0x[0-9a-f]\{3,16\}/&lt;HEXSTR&gt;/g&#39; -e &#39;s/^[0-9a-f]\{12,20\}/&lt;ADDR&gt;/&#39; \
 118       -e &#39;s/-20[0-9][0-9]-[0-1][0-9]-[0-3][0-9]-[0-2][0-9]\{5\}/&lt;DATE&gt;/g&#39; \
 119       -e &#39;s/), built on .*/), &lt;DATE&gt;/&#39; \
 120       &quot;
 121 fi
 122 
 123 ################################################################################
 124 # Compare text files and ignore specific differences:
 125 #
 126 #  * Timestamps in Java sources generated by idl2java
 127 #  * Sorting order and cleanup style in .properties files
 128 
 129 diff_text() {
 130     OTHER_FILE=$1
 131     THIS_FILE=$2
 132 
 133     SUFFIX=&quot;${THIS_FILE##*.}&quot;
 134     NAME=&quot;${THIS_FILE##*/}&quot;
 135 
 136     TMP=$($DIFF $THIS_FILE $OTHER_FILE)
 137 
 138     if test &quot;x$SUFFIX&quot; = &quot;xclass&quot;; then
 139         if [ &quot;$NAME&quot; = &quot;SystemModules\$all.class&quot; ] \
 140            || [ &quot;$NAME&quot; = &quot;SystemModules\$default.class&quot; ]; then
 141             # The SystemModules\$*.classes are not comparable as they contain the
 142             # module hashes which would require a whole other level of
 143             # reproducible builds to get reproducible. There is also random
 144             # order of map initialization.
 145             TMP=&quot;&quot;
 146         elif [ &quot;$NAME&quot; = &quot;module-info.class&quot; ]; then
 147             # The module-info.class have several issues with random ordering of
 148             # elements in HashSets.
 149             MODULES_CLASS_FILTER=&quot;$SED \
 150                 -e &#39;s/,$//&#39; \
 151                 -e &#39;s/;$//&#39; \
 152                 -e &#39;s/^ *[0-9]*://&#39; \
 153                 -e &#39;s/#[0-9]* */#/&#39; \
 154                 -e &#39;s/ *\/\// \/\//&#39; \
 155                 -e &#39;s/aload *[0-9]*/aload X/&#39; \
 156                 -e &#39;s/ldc_w/ldc  /&#39; \
 157                 | $SORT \
 158                 &quot;
 159             $JAVAP -c -constants -l -p &quot;${OTHER_FILE}&quot; \
 160                 | eval &quot;$MODULES_CLASS_FILTER&quot; &gt;  ${OTHER_FILE}.javap &amp;
 161             $JAVAP -c -constants -l -p &quot;${THIS_FILE}&quot; \
 162                 | eval &quot;$MODULES_CLASS_FILTER&quot; &gt; ${THIS_FILE}.javap &amp;
 163             wait
 164             TMP=$($DIFF ${OTHER_FILE}.javap ${THIS_FILE}.javap)
 165         fi
 166     fi
 167 
 168     if test -n &quot;$TMP&quot;; then
 169         echo Files $OTHER_FILE and $THIS_FILE differ
 170         return 1
 171     fi
 172 
 173     return 0
 174 }
 175 
 176 ################################################################################
 177 # Compare directory structure
 178 
 179 compare_dirs() {
 180     THIS_DIR=$1
 181     OTHER_DIR=$2
 182     WORK_DIR=$3
 183 
 184     mkdir -p $WORK_DIR
 185 
 186     (cd $OTHER_DIR &amp;&amp; $FIND . -type d | $SORT &gt; $WORK_DIR/dirs_other)
 187     (cd $THIS_DIR &amp;&amp; $FIND . -type d | $SORT &gt; $WORK_DIR/dirs_this)
 188 
 189     $DIFF $WORK_DIR/dirs_other $WORK_DIR/dirs_this &gt; $WORK_DIR/dirs_diff
 190 
 191     echo -n Directory structure...
 192     if [ -s $WORK_DIR/dirs_diff ]; then
 193         echo Differences found.
 194         REGRESSIONS=true
 195         # Differences in directories found.
 196         ONLY_OTHER=$($GREP &#39;&lt;&#39; $WORK_DIR/dirs_diff)
 197         if [ &quot;$ONLY_OTHER&quot; ]; then
 198             echo Only in $OTHER
 199             $GREP &#39;&lt;&#39; $WORK_DIR/dirs_diff | $SED &#39;s|&lt; ./|    |g&#39;
 200         fi
 201         ONLY_THIS=$($GREP &#39;&gt;&#39; $WORK_DIR/dirs_diff)
 202         if [ &quot;$ONLY_THIS&quot; ]; then
 203             echo Only in $THIS
 204             $GREP &#39;&gt;&#39; $WORK_DIR/dirs_diff | $SED &#39;s|&gt; ./|    |g&#39;
 205         fi
 206     else
 207         echo Identical!
 208     fi
 209 }
 210 
 211 
 212 ################################################################################
 213 # Compare file structure
 214 
 215 compare_files() {
 216     THIS_DIR=$1
 217     OTHER_DIR=$2
 218     WORK_DIR=$3
 219 
 220     $MKDIR -p $WORK_DIR
 221 
 222     (cd $OTHER_DIR &amp;&amp; $FIND . ! -type d | $SORT &gt; $WORK_DIR/files_other)
 223     (cd $THIS_DIR &amp;&amp; $FIND . ! -type d | $SORT &gt; $WORK_DIR/files_this)
 224 
 225     $DIFF $WORK_DIR/files_other $WORK_DIR/files_this &gt; $WORK_DIR/files_diff
 226 
 227     echo -n File names...
 228     if [ -s $WORK_DIR/files_diff ]; then
 229         echo Differences found.
 230         REGRESSIONS=true
 231         # Differences in files found.
 232         ONLY_OTHER=$($GREP &#39;&lt;&#39; $WORK_DIR/files_diff)
 233         if [ &quot;$ONLY_OTHER&quot; ]; then
 234             echo Only in $OTHER
 235             $GREP &#39;&lt;&#39; $WORK_DIR/files_diff | $SED &#39;s|&lt; ./|    |g&#39;
 236         fi
 237         ONLY_THIS=$($GREP &#39;&gt;&#39; $WORK_DIR/files_diff)
 238         if [ &quot;$ONLY_THIS&quot; ]; then
 239             echo Only in $THIS
 240             $GREP &#39;&gt;&#39; $WORK_DIR/files_diff | $SED &#39;s|&gt; ./|    |g&#39;
 241         fi
 242     else
 243         echo Identical!
 244     fi
 245 }
 246 
 247 
 248 ################################################################################
 249 # Compare permissions
 250 
 251 compare_permissions() {
 252     THIS_DIR=$1
 253     OTHER_DIR=$2
 254     WORK_DIR=$3
 255 
 256     mkdir -p $WORK_DIR
 257 
 258     echo -n Permissions...
 259     found=&quot;&quot;
 260     for f in `cd $OTHER_DIR &amp;&amp; $FIND . -type f`
 261     do
 262         if [ ! -f ${OTHER_DIR}/$f ]; then continue; fi
 263         if [ ! -f ${THIS_DIR}/$f ]; then continue; fi
 264         OP=`ls -l ${OTHER_DIR}/$f | awk &#39;{printf(&quot;%.10s\n&quot;, $1);}&#39;`
 265         TP=`ls -l ${THIS_DIR}/$f | awk &#39;{printf(&quot;%.10s\n&quot;, $1);}&#39;`
 266         if [ &quot;$OP&quot; != &quot;$TP&quot; ]
 267         then
 268             if [ -z &quot;$found&quot; ]; then echo ; found=&quot;yes&quot;; fi
 269             $PRINTF &quot;\tother: ${OP} this: ${TP}\t$f\n&quot;
 270         fi
 271     done
 272     if [ -z &quot;$found&quot; ]; then
 273         echo &quot;Identical!&quot;
 274     else
 275         REGRESSIONS=true
 276     fi
 277 }
 278 
 279 ################################################################################
 280 # Compare file command output
 281 
 282 compare_file_types() {
 283     THIS_DIR=$1
 284     OTHER_DIR=$2
 285     WORK_DIR=$3
 286 
 287     $MKDIR -p $WORK_DIR
 288 
 289     FILE_TYPES_FILTER=&quot;$SED \
 290         -e &#39;s/BuildID[^,]*//&#39; \
 291         -e &#39;s/last modified: .*//&#39; \
 292         &quot;
 293 
 294     echo -n File types...
 295     found=&quot;&quot;
 296     # The file command does not know about jmod files and this sometimes results
 297     # in different types being detected more or less randomly.
 298     for f in $(cd $OTHER_DIR &amp;&amp; $FIND . ! -type d -a ! -name &quot;*.jmod&quot;)
 299     do
 300         if [ ! -f ${OTHER_DIR}/$f ]; then continue; fi
 301         if [ ! -f ${THIS_DIR}/$f ]; then continue; fi
 302         OF=$(cd ${OTHER_DIR} &amp;&amp; $FILE -h $f | eval $FILE_TYPES_FILTER)
 303         TF=$(cd ${THIS_DIR} &amp;&amp; $FILE -h $f | eval $FILE_TYPES_FILTER)
 304         if [ &quot;$OF&quot; != &quot;$TF&quot; ]
 305         then
 306             if [ &quot;`echo $OF | $GREP -c &#39;Zip archive data&#39;`&quot; -gt 0 ] \
 307                 &amp;&amp; [ &quot;`echo $TF | $GREP -c &#39;Zip archive data&#39;`&quot; -gt 0 ]
 308             then
 309                 # the way we produce zip-files make it so that directories are stored in
 310                 # old file but not in new (only files with full-path) this makes file
 311                 # report them as different
 312                 continue
 313             elif [ &quot;`echo $OF | $GREP -c &#39;MSVC program database ver 7.00&#39;`&quot; -gt 0 ] \
 314                      &amp;&amp; [ &quot;`echo $TF | $GREP -c &#39;MSVC program database ver 7.00&#39;`&quot; -gt 0 ]
 315             then
 316                 # For Windows pdb files the file command reports some kind of size data
 317                 # which may sometimes come out randomly different.
 318                 continue
 319             else
 320                 if [ -z &quot;$found&quot; ]; then echo ; found=&quot;yes&quot;; fi
 321                 $PRINTF &quot;\tother: ${OF}\n\tthis : ${TF}\n&quot;
 322             fi
 323         fi
 324     done
 325     if [ -z &quot;$found&quot; ]; then
 326         echo &quot;Identical!&quot;
 327     else
 328         REGRESSIONS=true
 329     fi
 330 }
 331 
 332 ################################################################################
 333 # Compare the rest of the files
 334 
 335 compare_general_files() {
 336     THIS_DIR=$1
 337     OTHER_DIR=$2
 338     WORK_DIR=$3
 339 
 340     GENERAL_FILES=$(cd $THIS_DIR &amp;&amp; $FIND . -type f ! -name &quot;*.so&quot; ! -name &quot;*.jar&quot; \
 341         ! -name &quot;*.zip&quot; ! -name &quot;*.debuginfo&quot; ! -name &quot;*.dylib&quot; ! -name &quot;jexec&quot; \
 342         ! -name &quot;modules&quot; ! -name &quot;ct.sym&quot; ! -name &quot;*.diz&quot; ! -name &quot;*.dll&quot; \
 343         ! -name &quot;*.cpl&quot; ! -name &quot;*.pdb&quot; ! -name &quot;*.exp&quot; ! -name &quot;*.ilk&quot; \
 344         ! -name &quot;*.lib&quot; ! -name &quot;*.jmod&quot; ! -name &quot;*.exe&quot; \
 345         ! -name &quot;*.obj&quot; ! -name &quot;*.o&quot; ! -name &quot;jspawnhelper&quot; ! -name &quot;*.a&quot; \
 346         ! -name &quot;*.tar.gz&quot; ! -name &quot;*.jsa&quot; ! -name &quot;gtestLauncher&quot; \
 347         ! -name &quot;*.map&quot; \
 348         | $GREP -v &quot;./bin/&quot;  | $SORT | $FILTER)
 349 
 350     echo Other files with binary differences...
 351     for f in $GENERAL_FILES
 352     do
 353         # Skip all files in test/*/native
 354         if [[ &quot;$f&quot; == */native/* ]]; then
 355             continue
 356         fi
 357         if [ -e $OTHER_DIR/$f ]; then
 358             SUFFIX=&quot;${f##*.}&quot;
 359             if [ &quot;$(basename $f)&quot; = &quot;release&quot; ]; then
 360                 # In release file, ignore differences in source rev numbers
 361                 OTHER_FILE=$WORK_DIR/$f.other
 362                 THIS_FILE=$WORK_DIR/$f.this
 363                 $MKDIR -p $(dirname $OTHER_FILE)
 364                 $MKDIR -p $(dirname $THIS_FILE)
 365                 RELEASE_FILTER=&quot;$SED -e &#39;s/SOURCE=&quot;.*&quot;/SOURCE=&lt;src-rev&gt;/g&#39;&quot;
 366                 $CAT $OTHER_DIR/$f | eval &quot;$RELEASE_FILTER&quot; &gt; $OTHER_FILE
 367                 $CAT $THIS_DIR/$f  | eval &quot;$RELEASE_FILTER&quot; &gt; $THIS_FILE
 368             elif [ &quot;$SUFFIX&quot; = &quot;svg&quot; ]; then
 369                 # GraphViz has non-determinism when generating svg files
 370                 OTHER_FILE=$WORK_DIR/$f.other
 371                 THIS_FILE=$WORK_DIR/$f.this
 372                 $MKDIR -p $(dirname $OTHER_FILE) $(dirname $THIS_FILE)
 373                 SVG_FILTER=&quot;$SED \
 374                     -e &#39;s/edge[0-9][0-9]*/edgeX/g&#39;
 375                     &quot;
 376                 $CAT $OTHER_DIR/$f | eval &quot;$SVG_FILTER&quot; &gt; $OTHER_FILE
 377                 $CAT $THIS_DIR/$f | eval &quot;$SVG_FILTER&quot; &gt; $THIS_FILE
 378             elif [[ &quot;$f&quot; = *&quot;/lib/classlist&quot; ]] || [ &quot;$SUFFIX&quot; = &quot;jar_contents&quot; ]; then
 379                 # The classlist files may have some lines in random order
 380                 OTHER_FILE=$WORK_DIR/$f.other
 381                 THIS_FILE=$WORK_DIR/$f.this
 382                 $MKDIR -p $(dirname $OTHER_FILE) $(dirname $THIS_FILE)
 383                 $RM $OTHER_FILE $THIS_FILE
 384                 $CAT $OTHER_DIR/$f | $SORT &gt; $OTHER_FILE
 385                 $CAT $THIS_DIR/$f  | $SORT &gt; $THIS_FILE
 386             else
 387                 OTHER_FILE=$OTHER_DIR/$f
 388                 THIS_FILE=$THIS_DIR/$f
 389             fi
 390             DIFF_OUT=$($DIFF $OTHER_FILE $THIS_FILE 2&gt;&amp;1)
 391             if [ -n &quot;$DIFF_OUT&quot; ]; then
 392                 echo $f
 393                 REGRESSIONS=true
 394                 if [ &quot;$SHOW_DIFFS&quot; = &quot;true&quot; ]; then
 395                     echo &quot;$DIFF_OUT&quot;
 396                 fi
 397             fi
 398         fi
 399     done
 400 
 401 
 402 }
 403 
 404 ################################################################################
 405 # Compare zip file
 406 
 407 compare_zip_file() {
 408     THIS_DIR=$1
 409     OTHER_DIR=$2
 410     WORK_DIR=$3
 411     ZIP_FILE=$4
 412     # Optionally provide different name for other zipfile
 413     OTHER_ZIP_FILE=$5
 414 
 415     THIS_ZIP=$THIS_DIR/$ZIP_FILE
 416     if [ -n &quot;$OTHER_ZIP_FILE&quot; ]; then
 417         OTHER_ZIP=$OTHER_DIR/$OTHER_ZIP_FILE
 418     else
 419         OTHER_ZIP=$OTHER_DIR/$ZIP_FILE
 420     fi
 421 
 422     THIS_SUFFIX=&quot;${THIS_ZIP##*.}&quot;
 423     OTHER_SUFFIX=&quot;${OTHER_ZIP##*.}&quot;
 424     if [ &quot;$THIS_SUFFIX&quot; != &quot;$OTHER_SUFFIX&quot; ]; then
 425         echo &quot;The files do not have the same suffix type! ($THIS_SUFFIX != $OTHER_SUFFIX)&quot;
 426         return 2
 427     fi
 428 
 429     TYPE=&quot;$THIS_SUFFIX&quot;
 430 
 431     if $CMP $OTHER_ZIP $THIS_ZIP &gt; /dev/null
 432     then
 433         return 0
 434     fi
 435     # Not quite identical, the might still contain the same data.
 436     # Unpack the jar/zip files in temp dirs
 437 
 438     THIS_UNZIPDIR=$WORK_DIR/$ZIP_FILE.this
 439     OTHER_UNZIPDIR=$WORK_DIR/$ZIP_FILE.other
 440     $RM -rf $THIS_UNZIPDIR $OTHER_UNZIPDIR
 441     $MKDIR -p $THIS_UNZIPDIR
 442     $MKDIR -p $OTHER_UNZIPDIR
 443     if [ &quot;$TYPE&quot; = &quot;jar&quot; -o &quot;$TYPE&quot; = &quot;war&quot; -o &quot;$TYPE&quot; = &quot;zip&quot; ]
 444     then
 445         (cd $THIS_UNZIPDIR &amp;&amp; $UNARCHIVE $THIS_ZIP)
 446         (cd $OTHER_UNZIPDIR &amp;&amp; $UNARCHIVE $OTHER_ZIP)
 447     elif [ &quot;$TYPE&quot; = &quot;gz&quot; ]
 448     then
 449         (cd $THIS_UNZIPDIR &amp;&amp; $GUNZIP -c $THIS_ZIP | $TAR xf -)
 450         (cd $OTHER_UNZIPDIR &amp;&amp; $GUNZIP -c $OTHER_ZIP | $TAR xf -)
 451     elif [ &quot;$TYPE&quot; = &quot;jmod&quot; ]
 452     then
 453         (cd $THIS_UNZIPDIR &amp;&amp; $JMOD extract $THIS_ZIP)
 454         (cd $OTHER_UNZIPDIR &amp;&amp; $JMOD extract $OTHER_ZIP)
 455     else
 456         (cd $THIS_UNZIPDIR &amp;&amp; $JIMAGE extract $THIS_ZIP)
 457         (cd $OTHER_UNZIPDIR &amp;&amp; $JIMAGE extract $OTHER_ZIP)
 458     fi
 459 
 460     CONTENTS_DIFF_FILE=$WORK_DIR/$ZIP_FILE.diff
 461     # On solaris, there is no -q option.
 462     if [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;solaris&quot; ]; then
 463         $DIFF -r $OTHER_UNZIPDIR $THIS_UNZIPDIR \
 464             | $GREP -v -e &quot;^&lt;&quot; -e &quot;^&gt;&quot; -e &quot;^Common subdirectories:&quot; \
 465             &gt; $CONTENTS_DIFF_FILE
 466     else
 467         $DIFF -rq $OTHER_UNZIPDIR $THIS_UNZIPDIR &gt; $CONTENTS_DIFF_FILE
 468     fi
 469 
 470     ONLY_OTHER=$($GREP &quot;^Only in $OTHER_UNZIPDIR&quot; $CONTENTS_DIFF_FILE)
 471     ONLY_THIS=$($GREP &quot;^Only in $THIS_UNZIPDIR&quot; $CONTENTS_DIFF_FILE)
 472 
 473     return_value=0
 474 
 475     if [ -n &quot;$ONLY_OTHER&quot; ]; then
 476         echo &quot;        Only OTHER $ZIP_FILE contains:&quot;
 477         echo &quot;$ONLY_OTHER&quot; | sed &quot;s|Only in $OTHER_UNZIPDIR|            |&quot;g | sed &#39;s|: |/|g&#39;
 478         return_value=1
 479     fi
 480 
 481     if [ -n &quot;$ONLY_THIS&quot; ]; then
 482         echo &quot;        Only THIS $ZIP_FILE contains:&quot;
 483         echo &quot;$ONLY_THIS&quot; | sed &quot;s|Only in $THIS_UNZIPDIR|            |&quot;g | sed &#39;s|: |/|g&#39;
 484         return_value=1
 485     fi
 486 
 487     if [ &quot;$CMP_ZIPS_CONTENTS&quot; = &quot;true&quot; ]; then
 488         if [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;solaris&quot; ]; then
 489             DIFFING_FILES=$($GREP -e &#39;differ$&#39; -e &#39;^diff &#39; $CONTENTS_DIFF_FILE \
 490                 | $SED -e &#39;s/^Files //g&#39; -e &#39;s/diff -r //g&#39; | $CUT -f 1 -d &#39; &#39; \
 491                 | $SED &quot;s|$OTHER_UNZIPDIR/||g&quot;)
 492         else
 493             DIFFING_FILES=$($GREP -e &quot;differ$&quot; $CONTENTS_DIFF_FILE \
 494                 | $CUT -f 2 -d &#39; &#39; | $SED &quot;s|$OTHER_UNZIPDIR/||g&quot;)
 495         fi
 496 
 497         # Separate executable/library files from other files in zip.
 498         DIFFING_TEXT_FILES=
 499         DIFFING_EXEC_FILES=
 500         for file in $DIFFING_FILES; do
 501             SUFFIX=&quot;${file##*.}&quot;
 502             if [ &quot;$SUFFIX&quot; = &quot;exe&quot; -o &quot;$SUFFIX&quot; = &quot;dll&quot; -o &quot;$SUFFIX&quot; = &quot;so&quot; \
 503                  -o &quot;$SUFFIX&quot; = &quot;dylib&quot; ]; then
 504                 DIFFING_EXEC_FILES=&quot;$DIFFING_EXEC_FILES $file&quot;
 505             else
 506                 DIFFING_TEXT_FILES=&quot;$DIFFING_TEXT_FILES $file&quot;
 507             fi
 508         done
 509 
 510         $RM -f $WORK_DIR/$ZIP_FILE.diffs
 511         for file in $DIFFING_TEXT_FILES; do
 512             if [[ &quot;$ACCEPTED_JARZIP_CONTENTS $EXCEPTIONS&quot; != *&quot;$file&quot;* ]]; then
 513                 diff_text $OTHER_UNZIPDIR/$file $THIS_UNZIPDIR/$file &gt;&gt; $WORK_DIR/$ZIP_FILE.diffs
 514             fi
 515         done
 516 
 517         if [ -s &quot;$WORK_DIR/$ZIP_FILE.diffs&quot; ]; then
 518             return_value=1
 519             echo &quot;        Differing files in $ZIP_FILE&quot;
 520             $CAT $WORK_DIR/$ZIP_FILE.diffs | $GREP &#39;differ$&#39; | cut -f 2 -d &#39; &#39; | \
 521                 $SED &quot;s|$OTHER_UNZIPDIR|            |g&quot; &gt; $WORK_DIR/$ZIP_FILE.difflist
 522             $CAT $WORK_DIR/$ZIP_FILE.difflist
 523 
 524             if [ -n &quot;$SHOW_DIFFS&quot; ]; then
 525                 for i in $(cat $WORK_DIR/$ZIP_FILE.difflist) ; do
 526                     if [ -f &quot;${OTHER_UNZIPDIR}/$i.javap&quot; ]; then
 527                         $DIFF ${OTHER_UNZIPDIR}/$i.javap ${THIS_UNZIPDIR}/$i.javap
 528                     elif [ -f &quot;${OTHER_UNZIPDIR}/$i.cleaned&quot; ]; then
 529                         $DIFF ${OTHER_UNZIPDIR}/$i.cleaned ${THIS_UNZIPDIR}/$i
 530                     else
 531                         $DIFF ${OTHER_UNZIPDIR}/$i ${THIS_UNZIPDIR}/$i
 532                     fi
 533                 done
 534             fi
 535         fi
 536 
 537         # Use the compare_bin_file function for comparing the executable files.
 538         for file in $DIFFING_EXEC_FILES; do
 539             compare_bin_file $THIS_UNZIPDIR $OTHER_UNZIPDIR $WORK_DIR/$ZIP_FILE.bin \
 540                              $file
 541             if [ &quot;$?&quot; != &quot;0&quot; ]; then
 542                 return_value=1
 543             fi
 544         done
 545     fi
 546 
 547     return $return_value
 548 }
 549 
 550 ################################################################################
 551 # Compare jmod file
 552 
 553 compare_jmod_file() {
 554     THIS_DIR=$1
 555     OTHER_DIR=$2
 556     WORK_DIR=$3
 557     JMOD_FILE=$4
 558 
 559     THIS_JMOD=$THIS_DIR/$JMOD_FILE
 560     OTHER_JMOD=$OTHER_DIR/$JMOD_FILE
 561 
 562     if $CMP $OTHER_JMOD $THIS_JMOD &gt; /dev/null; then
 563         return 0
 564     fi
 565 
 566     THIS_JMOD_LIST=$WORK_DIR/$JMOD_FILE.list.this
 567     OTHER_JMOD_LIST=$WORK_DIR/$JMOD_FILE.list.other
 568     mkdir -p $(dirname $THIS_JMOD_LIST) $(dirname $OTHER_JMOD_LIST)
 569 
 570     $JMOD list $THIS_JMOD | sort &gt; $THIS_JMOD_LIST
 571     $JMOD list $OTHER_JMOD | sort &gt; $OTHER_JMOD_LIST
 572     JMOD_LIST_DIFF_FILE=$WORK_DIR/$JMOD_FILE.list.diff
 573     $DIFF $THIS_JMOD_LIST $OTHER_JMOD_LIST &gt; $JMOD_LIST_DIFF_FILE
 574 
 575     ONLY_THIS=$($GREP &quot;^&lt;&quot; $JMOD_LIST_DIFF_FILE)
 576     ONLY_OTHER=$($GREP &quot;^&gt;&quot; $JMOD_LIST_DIFF_FILE)
 577 
 578     if [ -n &quot;$ONLY_OTHER&quot; ]; then
 579         echo &quot;        Only OTHER $JMOD_FILE contains:&quot;
 580         echo &quot;$ONLY_OTHER&quot; | sed &quot;s|^&gt;|            |&quot;g | sed &#39;s|: |/|g&#39;
 581         return_value=1
 582     fi
 583 
 584     if [ -n &quot;$ONLY_THIS&quot; ]; then
 585         echo &quot;        Only THIS $JMOD_FILE contains:&quot;
 586         echo &quot;$ONLY_THIS&quot; | sed &quot;s|^&lt;|            |&quot;g | sed &#39;s|: |/|g&#39;
 587         return_value=1
 588     fi
 589 
 590     return $return_value
 591 }
 592 
 593 ################################################################################
 594 # Compare all zip files
 595 
 596 compare_all_zip_files() {
 597     THIS_DIR=$1
 598     OTHER_DIR=$2
 599     WORK_DIR=$3
 600 
 601     ZIPS=$(cd $THIS_DIR &amp;&amp; $FIND . -type f -name &quot;*.zip&quot; -o -name &quot;*.tar.gz&quot; \
 602         | $SORT | $FILTER )
 603 
 604     if [ -n &quot;$ZIPS&quot; ]; then
 605         echo Zip/tar.gz files...
 606 
 607         return_value=0
 608         for f in $ZIPS; do
 609             if [ -f &quot;$OTHER_DIR/$f&quot; ]; then
 610                 compare_zip_file $THIS_DIR $OTHER_DIR $WORK_DIR $f
 611                 if [ &quot;$?&quot; != &quot;0&quot; ]; then
 612                     return_value=1
 613                     REGRESSIONS=true
 614                 fi
 615             fi
 616         done
 617     fi
 618 
 619     return $return_value
 620 }
 621 
 622 ################################################################################
 623 # Compare all jmod files
 624 
 625 compare_all_jmod_files() {
 626     THIS_DIR=$1
 627     OTHER_DIR=$2
 628     WORK_DIR=$3
 629 
 630     JMODS=$(cd $THIS_DIR &amp;&amp; $FIND . -type f -name &quot;*.jmod&quot; | $SORT | $FILTER )
 631 
 632     if [ -n &quot;$JMODS&quot; ]; then
 633         echo Jmod files...
 634 
 635         return_value=0
 636         for f in $JMODS; do
 637             if [ -f &quot;$OTHER_DIR/$f&quot; ]; then
 638                 compare_jmod_file $THIS_DIR $OTHER_DIR $WORK_DIR $f
 639                 if [ &quot;$?&quot; != &quot;0&quot; ]; then
 640                     return_value=1
 641                     REGRESSIONS=true
 642                 fi
 643             fi
 644         done
 645     fi
 646 
 647     return $return_value
 648 }
 649 
 650 ################################################################################
 651 # Compare all jar files
 652 
 653 compare_all_jar_files() {
 654     THIS_DIR=$1
 655     OTHER_DIR=$2
 656     WORK_DIR=$3
 657 
 658     # TODO filter?
 659     ZIPS=$(cd $THIS_DIR &amp;&amp; $FIND . -type f -name &quot;*.jar&quot; -o -name &quot;*.war&quot; \
 660         -o -name &quot;modules&quot; | $SORT | $FILTER)
 661 
 662     if [ -n &quot;$ZIPS&quot; ]; then
 663         echo Jar files...
 664 
 665         return_value=0
 666         for f in $ZIPS; do
 667             if [ -f &quot;$OTHER_DIR/$f&quot; ]; then
 668                 compare_zip_file $THIS_DIR $OTHER_DIR $WORK_DIR $f
 669                 if [ &quot;$?&quot; != &quot;0&quot; ]; then
 670                     return_value=1
 671                     REGRESSIONS=true
 672                 fi
 673             fi
 674         done
 675     fi
 676 
 677     return $return_value
 678 }
 679 
 680 ################################################################################
 681 # Compare binary (executable/library) file
 682 
 683 compare_bin_file() {
 684     THIS_DIR=$1
 685     OTHER_DIR=$2
 686     WORK_DIR=$3
 687     BIN_FILE=$4
 688     OTHER_BIN_FILE=$5
 689 
 690     THIS_FILE=$THIS_DIR/$BIN_FILE
 691     if [ -n &quot;$OTHER_BIN_FILE&quot; ]; then
 692         OTHER_FILE=$OTHER_DIR/$OTHER_BIN_FILE
 693     else
 694         OTHER_FILE=$OTHER_DIR/$BIN_FILE
 695     fi
 696     NAME=$(basename $BIN_FILE)
 697     WORK_FILE_BASE=$WORK_DIR/$BIN_FILE
 698     FILE_WORK_DIR=$(dirname $WORK_FILE_BASE)
 699 
 700     $MKDIR -p $FILE_WORK_DIR
 701 
 702     # Make soft links to original files from work dir to facilitate debugging
 703     $LN -f -s $THIS_FILE $WORK_FILE_BASE.this
 704     $LN -f -s $OTHER_FILE $WORK_FILE_BASE.other
 705 
 706     ORIG_THIS_FILE=&quot;$THIS_FILE&quot;
 707     ORIG_OTHER_FILE=&quot;$OTHER_FILE&quot;
 708 
 709     if [ &quot;$STRIP_ALL&quot; = &quot;true&quot; ] || [[ &quot;$STRIP_BEFORE_COMPARE&quot; = *&quot;$BIN_FILE&quot;* ]]; then
 710         THIS_STRIPPED_FILE=$FILE_WORK_DIR/this/$NAME
 711         OTHER_STRIPPED_FILE=$FILE_WORK_DIR/other/$NAME
 712         $MKDIR -p $FILE_WORK_DIR/this $FILE_WORK_DIR/other
 713         $CP $THIS_FILE $THIS_STRIPPED_FILE
 714         $CP $OTHER_FILE $OTHER_STRIPPED_FILE
 715         $STRIP $THIS_STRIPPED_FILE
 716         $STRIP $OTHER_STRIPPED_FILE
 717         THIS_FILE=&quot;$THIS_STRIPPED_FILE&quot;
 718         OTHER_FILE=&quot;$OTHER_STRIPPED_FILE&quot;
 719     fi
 720 
 721     if [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;windows&quot; ]; then
 722         unset _NT_SYMBOL_PATH
 723         if [ &quot;$(uname -o)&quot; = &quot;Cygwin&quot; ]; then
 724             THIS=$(cygpath -msa $THIS)
 725             OTHER=$(cygpath -msa $OTHER)
 726         fi
 727         # Build an _NT_SYMBOL_PATH that contains all known locations for
 728         # pdb files.
 729         PDB_DIRS=&quot;$(ls -d \
 730             {$OTHER,$THIS}/support/modules_{cmds,libs}/{*,*/*} \
 731             {$OTHER,$THIS}/support/native/jdk.incubator.jpackage/* \
 732             )&quot;
 733         export _NT_SYMBOL_PATH=&quot;$(echo $PDB_DIRS | tr &#39; &#39; &#39;;&#39;)&quot;
 734     fi
 735 
 736     if cmp $OTHER_FILE $THIS_FILE &gt; /dev/null; then
 737         # The files were bytewise identical.
 738         if [ -n &quot;$VERBOSE&quot; ]; then
 739             echo &quot;        :           :         :         :          :          : $BIN_FILE&quot;
 740         fi
 741         return 0
 742     fi
 743     if [ -z &quot;$SKIP_BIN_DIFF&quot; ]; then
 744         BIN_MSG=&quot; diff &quot;
 745         if [[ &quot;$ACCEPTED_BIN_DIFF&quot; != *&quot;$BIN_FILE&quot;* ]]; then
 746             DIFF_BIN=true
 747             if [[ &quot;$KNOWN_BIN_DIFF&quot; != *&quot;$BIN_FILE&quot;* ]]; then
 748                 BIN_MSG=&quot;*$BIN_MSG*&quot;
 749                 REGRESSIONS=true
 750             else
 751                 BIN_MSG=&quot; $BIN_MSG &quot;
 752             fi
 753         else
 754             BIN_MSG=&quot;($BIN_MSG)&quot;
 755             DIFF_BIN=
 756         fi
 757     else
 758         BIN_MSG=
 759         DIFF_BIN=
 760     fi
 761 
 762     if [ -n &quot;$STAT&quot; ]; then
 763         THIS_SIZE=$($STAT $STAT_PRINT_SIZE &quot;$THIS_FILE&quot;)
 764         OTHER_SIZE=$($STAT $STAT_PRINT_SIZE &quot;$OTHER_FILE&quot;)
 765     else
 766         THIS_SIZE=$(ls -l &quot;$THIS_FILE&quot; | awk &#39;{ print $5 }&#39;)
 767         OTHER_SIZE=$(ls -l &quot;$OTHER_FILE&quot; | awk &#39;{ print $5 }&#39;)
 768     fi
 769     if [ $THIS_SIZE -ne $OTHER_SIZE ]; then
 770         DIFF_SIZE_NUM=$($EXPR $THIS_SIZE - $OTHER_SIZE)
 771         DIFF_SIZE_REL=$($EXPR $THIS_SIZE \* 100 / $OTHER_SIZE)
 772         SIZE_MSG=$($PRINTF &quot;%3d%% %4d&quot; $DIFF_SIZE_REL $DIFF_SIZE_NUM)
 773         if [[ &quot;$ACCEPTED_SMALL_SIZE_DIFF&quot; = *&quot;$BIN_FILE&quot;* || &quot;$ACCEPTED_SMALL_SIZE_DIFF&quot; = &quot;true&quot; ]] \
 774             &amp;&amp; [ &quot;$DIFF_SIZE_REL&quot; -gt 98 ] \
 775             &amp;&amp; [ &quot;$DIFF_SIZE_REL&quot; -lt 102 ]; then
 776             SIZE_MSG=&quot;($SIZE_MSG)&quot;
 777             DIFF_SIZE=
 778         elif [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;windows&quot; ] \
 779             &amp;&amp; [[ &quot;$ACCEPTED_SMALL_SIZE_DIFF&quot; = *&quot;$BIN_FILE&quot;* ]] \
 780             &amp;&amp; [ &quot;$DIFF_SIZE_NUM&quot; = 512 ]; then
 781             # On windows, size of binaries increase in 512 increments.
 782             SIZE_MSG=&quot;($SIZE_MSG)&quot;
 783             DIFF_SIZE=
 784         elif [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;windows&quot; ] \
 785             &amp;&amp; [[ &quot;$ACCEPTED_SMALL_SIZE_DIFF&quot; = *&quot;$BIN_FILE&quot;* ]] \
 786             &amp;&amp; [ &quot;$DIFF_SIZE_NUM&quot; = -512 ]; then
 787             # On windows, size of binaries increase in 512 increments.
 788             SIZE_MSG=&quot;($SIZE_MSG)&quot;
 789             DIFF_SIZE=
 790         else
 791             if [[ &quot;$ACCEPTED_SIZE_DIFF&quot; != *&quot;$BIN_FILE&quot;* ]]; then
 792                 DIFF_SIZE=true
 793                 if [[ &quot;$KNOWN_SIZE_DIFF&quot; != *&quot;$BIN_FILE&quot;* ]]; then
 794                     SIZE_MSG=&quot;*$SIZE_MSG*&quot;
 795                     REGRESSIONS=true
 796                 else
 797                     SIZE_MSG=&quot; $SIZE_MSG &quot;
 798                 fi
 799             else
 800                 SIZE_MSG=&quot;($SIZE_MSG)&quot;
 801                 DIFF_SIZE=
 802             fi
 803         fi
 804     else
 805         SIZE_MSG=&quot;           &quot;
 806         DIFF_SIZE=
 807         if [[ &quot;$KNOWN_SIZE_DIFF $ACCEPTED_SIZE_DIFF&quot; = *&quot;$BIN_FILE&quot;* ]]; then
 808             SIZE_MSG=&quot;     !     &quot;
 809         fi
 810     fi
 811 
 812     if [ &quot;$SORT_ALL_SYMBOLS&quot; = &quot;true&quot; ] || [[ &quot;$SORT_SYMBOLS&quot; = *&quot;$BIN_FILE&quot;* ]]; then
 813         SYM_SORT_CMD=&quot;sort&quot;
 814     else
 815         SYM_SORT_CMD=&quot;cat&quot;
 816     fi
 817 
 818     if [ -n &quot;$SYMBOLS_DIFF_FILTER&quot; ] &amp;&amp; [ -z &quot;$NEED_SYMBOLS_DIFF_FILTER&quot; ] \
 819             || [[ &quot;$NEED_SYMBOLS_DIFF_FILTER&quot; = *&quot;$BIN_FILE&quot;* ]]; then
 820         this_SYMBOLS_DIFF_FILTER=&quot;$SYMBOLS_DIFF_FILTER&quot;
 821     else
 822         this_SYMBOLS_DIFF_FILTER=&quot;$CAT&quot;
 823     fi
 824 
 825     # Check symbols
 826     if [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;windows&quot; ]; then
 827         # The output from dumpbin on windows differs depending on if the debug symbol
 828         # files are still around at the location the binary is pointing too. Need
 829         # to filter out that extra information.
 830         $DUMPBIN -exports $OTHER_FILE | $GREP  -E &#39;^ +[0-9A-F]+ +[0-9A-F]+ [0-9A-F]+&#39; | sed &#39;s/ = .*//g&#39; | cut -c27- | $SYM_SORT_CMD &gt; $WORK_FILE_BASE.symbols.other
 831         $DUMPBIN -exports $THIS_FILE  | $GREP  -E &#39;^ +[0-9A-F]+ +[0-9A-F]+ [0-9A-F]+&#39; | sed &#39;s/ = .*//g&#39; | cut -c27- | $SYM_SORT_CMD &gt; $WORK_FILE_BASE.symbols.this
 832     elif [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;solaris&quot; ]; then
 833         # Some symbols get seemingly random 15 character prefixes. Filter them out.
 834         $NM -a $ORIG_OTHER_FILE 2&gt; /dev/null | $GREP -v $NAME | $AWK &#39;{print $2, $3, $4, $5}&#39; | $SED &#39;s/^\([a-zA-Z] [\.\$]\)[a-zA-Z0-9_\$]\{15,15\}\./\1./g&#39; | $SYM_SORT_CMD &gt; $WORK_FILE_BASE.symbols.other
 835         $NM -a $ORIG_THIS_FILE  2&gt; /dev/null | $GREP -v $NAME | $AWK &#39;{print $2, $3, $4, $5}&#39; | $SED &#39;s/^\([a-zA-Z] [\.\$]\)[a-zA-Z0-9_\$]\{15,15\}\./\1./g&#39; | $SYM_SORT_CMD &gt; $WORK_FILE_BASE.symbols.this
 836     elif [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;aix&quot; ]; then
 837         $OBJDUMP -T $ORIG_OTHER_FILE 2&gt; /dev/null | $GREP -v $NAME | $AWK &#39;{print $2, $3, $4, $5}&#39; | $SYM_SORT_CMD &gt; $WORK_FILE_BASE.symbols.other
 838         $OBJDUMP -T $ORIG_THIS_FILE  2&gt; /dev/null | $GREP -v $NAME | $AWK &#39;{print $2, $3, $4, $5}&#39; | $SYM_SORT_CMD &gt; $WORK_FILE_BASE.symbols.this
 839     elif [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;macosx&quot; ]; then
 840         $NM -j $ORIG_OTHER_FILE 2&gt; /dev/null | $SYM_SORT_CMD &gt; $WORK_FILE_BASE.symbols.other
 841         $NM -j $ORIG_THIS_FILE  2&gt; /dev/null | $SYM_SORT_CMD &gt; $WORK_FILE_BASE.symbols.this
 842     else
 843         $NM -a $ORIG_OTHER_FILE 2&gt; /dev/null | $GREP -v $NAME \
 844             | $AWK &#39;{print $2, $3, $4, $5}&#39; \
 845             | eval &quot;$this_SYMBOLS_DIFF_FILTER&quot; \
 846             | $SYM_SORT_CMD \
 847             &gt; $WORK_FILE_BASE.symbols.other
 848         $NM -a $ORIG_THIS_FILE  2&gt; /dev/null | $GREP -v $NAME \
 849             | $AWK &#39;{print $2, $3, $4, $5}&#39; \
 850             | eval &quot;$this_SYMBOLS_DIFF_FILTER&quot; \
 851             | $SYM_SORT_CMD \
 852             &gt; $WORK_FILE_BASE.symbols.this
 853     fi
 854 
 855     $DIFF $WORK_FILE_BASE.symbols.other $WORK_FILE_BASE.symbols.this &gt; $WORK_FILE_BASE.symbols.diff
 856     if [ -s $WORK_FILE_BASE.symbols.diff ]; then
 857         SYM_MSG=&quot; diff  &quot;
 858         if [[ &quot;$ACCEPTED_SYM_DIFF&quot; != *&quot;$BIN_FILE&quot;* ]]; then
 859             DIFF_SYM=true
 860             if [[ &quot;$KNOWN_SYM_DIFF&quot; != *&quot;$BIN_FILE&quot;* ]]; then
 861                 SYM_MSG=&quot;*$SYM_MSG*&quot;
 862                 REGRESSIONS=true
 863             else
 864                 SYM_MSG=&quot; $SYM_MSG &quot;
 865             fi
 866         else
 867             SYM_MSG=&quot;($SYM_MSG)&quot;
 868             DIFF_SYM=
 869         fi
 870     else
 871         SYM_MSG=&quot;         &quot;
 872         DIFF_SYM=
 873         if [[ &quot;$KNOWN_SYM_DIFF $ACCEPTED_SYM_DIFF&quot; = *&quot;$BIN_FILE&quot;* ]]; then
 874             SYM_MSG=&quot;    !    &quot;
 875         fi
 876     fi
 877 
 878     # Check dependencies
 879     if [ -n &quot;$LDD_CMD&quot; ]; then
 880         if [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;windows&quot; ]; then
 881             LDD_FILTER=&quot;$GREP \.dll&quot;
 882         else
 883             LDD_FILTER=&quot;$CAT&quot;
 884         fi
 885         (cd $FILE_WORK_DIR &amp;&amp; $CP $OTHER_FILE . &amp;&amp; $LDD_CMD $NAME 2&gt;/dev/null \
 886                     | $LDD_FILTER | $AWK &#39;{ print $1;}&#39; | $SORT \
 887                     | $TEE $WORK_FILE_BASE.deps.other \
 888                     | $UNIQ &gt; $WORK_FILE_BASE.deps.other.uniq)
 889         (cd $FILE_WORK_DIR &amp;&amp; $CP $THIS_FILE . &amp;&amp; $LDD_CMD $NAME 2&lt;/dev/null \
 890                     | $LDD_FILTER | $AWK &#39;{ print $1;}&#39; | $SORT \
 891                     | $TEE $WORK_FILE_BASE.deps.this \
 892                     | $UNIQ &gt; $WORK_FILE_BASE.deps.this.uniq)
 893         (cd $FILE_WORK_DIR &amp;&amp; $RM -f $NAME)
 894 
 895         $DIFF $WORK_FILE_BASE.deps.other $WORK_FILE_BASE.deps.this \
 896               &gt; $WORK_FILE_BASE.deps.diff
 897         $DIFF $WORK_FILE_BASE.deps.other.uniq $WORK_FILE_BASE.deps.this.uniq \
 898               &gt; $WORK_FILE_BASE.deps.diff.uniq
 899 
 900         if [ -s $WORK_FILE_BASE.deps.diff ]; then
 901             if [ -s $WORK_FILE_BASE.deps.diff.uniq ]; then
 902                 DEP_MSG=&quot; diff  &quot;
 903             else
 904                 DEP_MSG=&quot; redun &quot;
 905             fi
 906             if [[ &quot;$ACCEPTED_DEP_DIFF&quot; != *&quot;$BIN_FILE&quot;* ]]; then
 907                 DIFF_DEP=true
 908                 if [[ &quot;$KNOWN_DEP_DIFF&quot; != *&quot;$BIN_FILE&quot;* ]]; then
 909                     DEP_MSG=&quot;*$DEP_MSG*&quot;
 910                     REGRESSIONS=true
 911                 else
 912                     DEP_MSG=&quot; $DEP_MSG &quot;
 913                 fi
 914             else
 915                 DEP_MSG=&quot;($DEP_MSG)&quot;
 916                 DIFF_DEP=
 917             fi
 918         else
 919             DEP_MSG=&quot;         &quot;
 920             DIFF_DEP=
 921             if [[ &quot;$KNOWN_DEP_DIFF $ACCEPTED_DEP_DIFF&quot; = *&quot;$BIN_FILE&quot;* ]]; then
 922                 DEP_MSG=&quot;     !      &quot;
 923             fi
 924         fi
 925     else
 926         DEP_MSG=&quot;    -    &quot;
 927     fi
 928 
 929     # Some linux compilers add a unique Build ID
 930     if [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;linux&quot; ]; then
 931       BUILD_ID_FILTER=&quot;$SED -r &#39;s/(Build ID:) [0-9a-f]{40}/\1/&#39;&quot;
 932     else
 933       BUILD_ID_FILTER=&quot;$CAT&quot;
 934     fi
 935 
 936     # Compare fulldump output
 937     if [ -n &quot;$FULLDUMP_CMD&quot; ] &amp;&amp; [ -z &quot;$SKIP_FULLDUMP_DIFF&quot; ]; then
 938         if [ -z &quot;$FULLDUMP_DIFF_FILTER&quot; ]; then
 939             FULLDUMP_DIFF_FILTER=&quot;$CAT&quot;
 940         fi
 941         $FULLDUMP_CMD $OTHER_FILE | eval &quot;$BUILD_ID_FILTER&quot; | eval &quot;$FULLDUMP_DIFF_FILTER&quot; \
 942             &gt; $WORK_FILE_BASE.fulldump.other 2&gt;&amp;1 &amp;
 943         $FULLDUMP_CMD $THIS_FILE  | eval &quot;$BUILD_ID_FILTER&quot; | eval &quot;$FULLDUMP_DIFF_FILTER&quot; \
 944             &gt; $WORK_FILE_BASE.fulldump.this  2&gt;&amp;1 &amp;
 945         wait
 946 
 947         $DIFF $WORK_FILE_BASE.fulldump.other $WORK_FILE_BASE.fulldump.this \
 948             &gt; $WORK_FILE_BASE.fulldump.diff
 949 
 950         if [ -s $WORK_FILE_BASE.fulldump.diff ]; then
 951             FULLDUMP_DIFF_SIZE=$(ls -n $WORK_FILE_BASE.fulldump.diff | awk &#39;{print $5}&#39;)
 952             FULLDUMP_MSG=$($PRINTF &quot;%8d&quot; $FULLDUMP_DIFF_SIZE)
 953             if [[ &quot;$ACCEPTED_FULLDUMP_DIFF&quot; != *&quot;$BIN_FILE&quot;* ]]; then
 954                 DIFF_FULLDUMP=true
 955                 if [[ &quot;$KNOWN_FULLDUMP_DIFF&quot; != *&quot;$BIN_FILE&quot;* ]]; then
 956                     FULLDUMP_MSG=&quot;*$FULLDUMP_MSG*&quot;
 957                     REGRESSIONS=true
 958                 else
 959                     FULLDUMP_MSG=&quot; $FULLDUMP_MSG &quot;
 960                 fi
 961             else
 962                 FULLDUMP_MSG=&quot;($FULLDUMP_MSG)&quot;
 963                 DIFF_FULLDUMP=
 964             fi
 965         else
 966             FULLDUMP_MSG=&quot;          &quot;
 967             DIFF_FULLDUMP=
 968             if [[ &quot;$KNOWN_FULLDUMP_DIFF $ACCEPTED_FULLDUMP_DIFF&quot; = *&quot;$BIN_FILE&quot;* ]]; then
 969                 FULLDUMP_MSG=&quot;    !    &quot;
 970             fi
 971         fi
 972     fi
 973 
 974     # Compare disassemble output
 975     if [ -n &quot;$DIS_CMD&quot; ] &amp;&amp; [ -z &quot;$SKIP_DIS_DIFF&quot; ]; then
 976         this_DIS_DIFF_FILTER=&quot;$CAT&quot;
 977         if [ -n &quot;$DIS_DIFF_FILTER&quot; ]; then
 978             if [ -z &quot;$NEED_DIS_DIFF_FILTER&quot; ] \
 979                 || [[ &quot;$NEED_DIS_DIFF_FILTER&quot; = *&quot;$BIN_FILE&quot;* ]]; then
 980                 this_DIS_DIFF_FILTER=&quot;$DIS_DIFF_FILTER&quot;
 981             fi
 982         fi
 983         if [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;windows&quot; ]; then
 984             DIS_GREP_ARG=-a
 985         else
 986             DIS_GREP_ARG=
 987         fi
 988         $DIS_CMD $OTHER_FILE | $GREP $DIS_GREP_ARG -v $NAME \
 989             | eval &quot;$this_DIS_DIFF_FILTER&quot; &gt; $WORK_FILE_BASE.dis.other 2&gt;&amp;1 &amp;
 990         $DIS_CMD $THIS_FILE  | $GREP $DIS_GREP_ARG -v $NAME \
 991             | eval &quot;$this_DIS_DIFF_FILTER&quot; &gt; $WORK_FILE_BASE.dis.this  2&gt;&amp;1 &amp;
 992         wait
 993 
 994         $DIFF $WORK_FILE_BASE.dis.other $WORK_FILE_BASE.dis.this &gt; $WORK_FILE_BASE.dis.diff
 995 
 996         if [ -s $WORK_FILE_BASE.dis.diff ]; then
 997             DIS_DIFF_SIZE=$(ls -n $WORK_FILE_BASE.dis.diff | awk &#39;{print $5}&#39;)
 998             DIS_MSG=$($PRINTF &quot;%8d&quot; $DIS_DIFF_SIZE)
 999             if [[ &quot;$ACCEPTED_DIS_DIFF&quot; != *&quot;$BIN_FILE&quot;* ]]; then
1000                 DIFF_DIS=true
1001                 if [ &quot;$MAX_KNOWN_DIS_DIFF_SIZE&quot; = &quot;&quot; ]; then
1002                     MAX_KNOWN_DIS_DIFF_SIZE=&quot;0&quot;
1003                 fi
1004                 if [[ &quot;$KNOWN_DIS_DIFF&quot; = *&quot;$BIN_FILE&quot;* ]] \
1005                     &amp;&amp; [ &quot;$DIS_DIFF_SIZE&quot; -lt &quot;$MAX_KNOWN_DIS_DIFF_SIZE&quot; ]; then
1006                     DIS_MSG=&quot; $DIS_MSG &quot;
1007                 else
1008                     DIS_MSG=&quot;*$DIS_MSG*&quot;
1009                     REGRESSIONS=true
1010                 fi
1011             else
1012                 DIS_MSG=&quot;($DIS_MSG)&quot;
1013                 DIFF_DIS=
1014             fi
1015         else
1016             DIS_MSG=&quot;          &quot;
1017             DIFF_DIS=
1018             if [[ &quot;$KNOWN_DEP_DIFF $ACCEPTED_DEP_DIFF&quot; = *&quot;$BIN_FILE&quot;* ]]; then
1019                 DIS_MSG=&quot;    !    &quot;
1020             fi
1021         fi
1022     fi
1023 
1024 
1025     if [ -n &quot;$DIFF_BIN$DIFF_SIZE$DIFF_SYM$DIFF_DEP$DIFF_FULLDUMP$DIFF_DIS&quot; ] || [ -n &quot;$VERBOSE&quot; ]; then
1026         if [ -n &quot;$BIN_MSG&quot; ]; then echo -n &quot;$BIN_MSG:&quot;; fi
1027         if [ -n &quot;$SIZE_MSG&quot; ]; then echo -n &quot;$SIZE_MSG:&quot;; fi
1028         if [ -n &quot;$SYM_MSG&quot; ]; then echo -n &quot;$SYM_MSG:&quot;; fi
1029         if [ -n &quot;$DEP_MSG&quot; ]; then echo -n &quot;$DEP_MSG:&quot;; fi
1030         if [ -n &quot;$FULLDUMP_MSG&quot; ]; then echo -n &quot;$FULLDUMP_MSG:&quot;; fi
1031         if [ -n &quot;$DIS_MSG&quot; ]; then echo -n &quot;$DIS_MSG:&quot;; fi
1032         echo &quot; $BIN_FILE&quot;
1033         if [ &quot;$SHOW_DIFFS&quot; = &quot;true&quot; ]; then
1034             if [ -s &quot;$WORK_FILE_BASE.symbols.diff&quot; ]; then
1035                 echo &quot;Symbols diff:&quot;
1036                 $CAT $WORK_FILE_BASE.symbols.diff
1037             fi
1038             if [ -s &quot;$WORK_FILE_BASE.deps.diff&quot; ]; then
1039                 echo &quot;Deps diff:&quot;
1040                 $CAT $WORK_FILE_BASE.deps.diff
1041             fi
1042             if [ -s &quot;$WORK_FILE_BASE.fulldump.diff&quot; ]; then
1043                 echo &quot;Fulldump diff:&quot;
1044                 $CAT $WORK_FILE_BASE.fulldump.diff
1045             fi
1046             if [ -s &quot;$WORK_FILE_BASE.dis.diff&quot; ]; then
1047                 echo &quot;Disassembly diff:&quot;
1048                 $CAT $WORK_FILE_BASE.dis.diff
1049             fi
1050         fi
1051         return 1
1052     fi
1053     return 0
1054 }
1055 
1056 ################################################################################
1057 # Print binary diff header
1058 
1059 print_binary_diff_header() {
1060     if [ -z &quot;$SKIP_BIN_DIFF&quot; ]; then echo -n &quot; Binary :&quot;; fi
1061     if [ -z &quot;$SKIP_SIZE_DIFF&quot; ]; then echo -n &quot;   Size    :&quot;; fi
1062     if [ -z &quot;$SKIP_SYM_DIFF&quot; ]; then echo -n &quot; Symbols :&quot;; fi
1063     if [ -z &quot;$SKIP_DEP_DIFF&quot; ]; then echo -n &quot;  Deps   :&quot;; fi
1064     if [ -z &quot;$SKIP_FULLDUMP_DIFF&quot; ]; then echo -n &quot; Fulldump :&quot;; fi
1065     if [ -z &quot;$SKIP_DIS_DIFF&quot; ]; then echo -n &quot; Disass   :&quot;; fi
1066     echo
1067 }
1068 
1069 ################################################################################
1070 # Compare all libraries
1071 
1072 compare_all_libs() {
1073     THIS_DIR=$1
1074     OTHER_DIR=$2
1075     WORK_DIR=$3
1076 
1077     LIBS=$(cd $THIS_DIR &amp;&amp; $FIND . -type f \( -name &#39;lib*.so&#39; -o -name &#39;*.dylib&#39; \
1078         -o -name &#39;*.dll&#39; -o -name &#39;*.obj&#39; -o -name &#39;*.o&#39; -o -name &#39;*.a&#39; \
1079         -o -name &#39;*.cpl&#39; \) | $SORT | $FILTER)
1080 
1081     # On macos, filter out the dSYM debug symbols files as they are also
1082     # named *.dylib.
1083     if [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;macosx&quot; ]; then
1084         LIBS=$(echo &quot;$LIBS&quot; | $GREP -v &#39;\.dSYM/&#39;)
1085     fi
1086 
1087     if [ -n &quot;$LIBS&quot; ]; then
1088         echo Libraries...
1089         print_binary_diff_header
1090         for l in $LIBS; do
1091             if [ -f &quot;$OTHER_DIR/$l&quot; ]; then
1092                 compare_bin_file $THIS_DIR $OTHER_DIR $WORK_DIR $l
1093                 if [ &quot;$?&quot; != &quot;0&quot; ]; then
1094                     return_value=1
1095                 fi
1096             fi
1097         done
1098     fi
1099 
1100     return $return_value
1101 }
1102 
1103 ################################################################################
1104 # Compare all executables
1105 
1106 compare_all_execs() {
1107     THIS_DIR=$1
1108     OTHER_DIR=$2
1109     WORK_DIR=$3
1110 
1111     if [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;windows&quot; ]; then
1112         EXECS=$(cd $THIS_DIR &amp;&amp; $FIND . -type f -name &#39;*.exe&#39; | $SORT | $FILTER)
1113     else
1114         EXECS=$(cd $THIS_DIR &amp;&amp; $FIND . -name db -prune -o -type f -perm -100 \! \
1115             \( -name &#39;*.so&#39; -o -name &#39;*.dylib&#39; -o -name &#39;*.dll&#39; -o -name &#39;*.cgi&#39; \
1116             -o -name &#39;*.jar&#39; -o -name &#39;*.diz&#39; -o -name &#39;jcontrol&#39; -o -name &#39;*.properties&#39; \
1117             -o -name &#39;*.data&#39; -o -name &#39;*.bfc&#39; -o -name &#39;*.src&#39; -o -name &#39;*.txt&#39; \
1118             -o -name &#39;*.cfg&#39; -o -name &#39;meta-index&#39; -o -name &#39;*.properties.ja&#39; \
1119             -o -name &#39;*.xml&#39; -o -name &#39;*.html&#39; -o -name &#39;*.png&#39; -o -name &#39;README&#39; \
1120             -o -name &#39;*.zip&#39; -o -name &#39;*.jimage&#39; -o -name &#39;*.java&#39; -o -name &#39;*.mf&#39; \
1121             -o -name &#39;*.jpg&#39; -o -name &#39;*.wsdl&#39; -o -name &#39;*.js&#39; -o -name &#39;*.sh&#39; \
1122             -o -name &#39;*.bat&#39; -o -name &#39;*LICENSE&#39; -o -name &#39;*.d&#39; -o -name &#39;*store&#39; \
1123             -o -name &#39;blacklist&#39; -o -name &#39;*certs&#39; -o -name &#39;*.ttf&#39; \
1124             -o -name &#39;*.jfc&#39; -o -name &#39;*.dat&#39;  -o -name &#39;release&#39; -o -name &#39;*.dir&#39;\
1125             -o -name &#39;*.sym&#39; -o -name &#39;*.idl&#39; -o -name &#39;*.h&#39; -o -name &#39;*.access&#39; \
1126             -o -name &#39;*.template&#39; -o -name &#39;*.policy&#39; -o -name &#39;*.security&#39; \
1127             -o -name &#39;COPYRIGHT&#39; -o -name &#39;*.1&#39; -o -name &#39;*.debuginfo&#39; \
1128             -o -name &#39;classlist&#39; \) | $SORT | $FILTER)
1129     fi
1130 
1131     if [ -n &quot;$EXECS&quot; ]; then
1132         echo Executables...
1133         print_binary_diff_header
1134         for e in $EXECS; do
1135             if [ -f &quot;$OTHER_DIR/$e&quot; ]; then
1136                 compare_bin_file $THIS_DIR $OTHER_DIR $WORK_DIR $e
1137                 if [ &quot;$?&quot; != &quot;0&quot; ]; then
1138                     return_value=1
1139                 fi
1140             fi
1141         done
1142     fi
1143 
1144     return $return_value
1145 }
1146 
1147 ################################################################################
1148 # Initiate configuration
1149 
1150 THIS=&quot;$SCRIPT_DIR&quot;
1151 echo &quot;$THIS&quot;
1152 THIS_SCRIPT=&quot;$0&quot;
1153 
1154 if [ -z &quot;$1&quot; ] || [ &quot;$1&quot; = &quot;-h&quot; ] || [ &quot;$1&quot; = &quot;-?&quot; ] || [ &quot;$1&quot; = &quot;/h&quot; ] || [ &quot;$1&quot; = &quot;/?&quot; ] || [ &quot;$1&quot; = &quot;-help&quot; ] || [ &quot;$1&quot; = &quot;--help&quot; ]; then
1155     echo &quot;bash ./compare.sh [OPTIONS] [FILTER]&quot;
1156     echo &quot;&quot;
1157     echo &quot;-all                Compare all files in all known ways&quot;
1158     echo &quot;-names              Compare the file names and directory structure&quot;
1159     echo &quot;-perms              Compare the permission bits on all files and directories&quot;
1160     echo &quot;-types              Compare the output of the file command on all files&quot;
1161     echo &quot;-general            Compare the files not convered by the specialized comparisons&quot;
1162     echo &quot;-zips               Compare the contents of all zip files and files in them&quot;
1163     echo &quot;-zips-names         Compare the file names inside all zip files&quot;
1164     echo &quot;-jars               Compare the contents of all jar files&quot;
1165     echo &quot;-jmods              Compare the listings of all jmod files&quot;
1166     echo &quot;-libs               Compare all native libraries&quot;
1167     echo &quot;-execs              Compare all executables&quot;
1168     echo &quot;-v                  Verbose output, does not hide known differences&quot;
1169     echo &quot;-vv                 More verbose output, shows diff output of all comparisons&quot;
1170     echo &quot;-o [OTHER]          Compare with build in other directory. Will default to the old build directory&quot;
1171     echo &quot;&quot;
1172     echo &quot;--sort-symbols      Sort all symbols before comparing&quot;
1173     echo &quot;--strip             Strip all binaries before comparing&quot;
1174     echo &quot;--clean             Clean all previous comparison results first&quot;
1175     echo &quot;&quot;
1176     echo &quot;[FILTER]            List filenames in the image to compare, works for jars, zips, libs and execs&quot;
1177     echo &quot;Example:&quot;
1178     echo &quot;bash ./make/scripts/compareimages.sh CodePointIM.jar&quot;
1179     echo &quot;&quot;
1180     echo &quot;-2zips &lt;file1&gt; &lt;file2&gt; Compare two zip files only&quot;
1181     echo &quot;-2bins &lt;file1&gt; &lt;file2&gt; Compare two binary files only&quot;
1182     echo &quot;-2dirs &lt;dir1&gt; &lt;dir2&gt; Compare two directories as if they were images&quot;
1183     echo &quot;&quot;
1184     exit 10
1185 fi
1186 
1187 CMP_NAMES=false
1188 CMP_PERMS=false
1189 CMP_TYPES=false
1190 CMP_GENERAL=false
1191 CMP_ZIPS=false
1192 CMP_ZIPS_CONTENTS=true
1193 CMP_JARS=false
1194 CMP_JMODS=false
1195 CMP_LIBS=false
1196 CMP_EXECS=false
1197 
1198 while [ -n &quot;$1&quot; ]; do
1199     case &quot;$1&quot; in
1200         -v)
1201             VERBOSE=true
1202             ;;
1203         -vv)
1204             VERBOSE=true
1205             SHOW_DIFFS=true
1206             ;;
1207         -o)
1208             OTHER=&quot;$2&quot;
1209             shift
1210             ;;
1211         -all)
1212             CMP_NAMES=true
1213             if [ &quot;$OPENJDK_TARGET_OS&quot; != &quot;windows&quot; ]; then
1214                 CMP_PERMS=true
1215             fi
1216             CMP_TYPES=true
1217             CMP_GENERAL=true
1218             CMP_ZIPS=true
1219             CMP_JARS=true
1220             CMP_JMODS=true
1221             CMP_LIBS=true
1222             CMP_EXECS=true
1223             ;;
1224         -names)
1225             CMP_NAMES=true
1226             ;;
1227         -perms)
1228             CMP_PERMS=true
1229             ;;
1230         -types)
1231             CMP_TYPES=true
1232             ;;
1233         -general)
1234             CMP_GENERAL=true
1235             ;;
1236         -zips)
1237             CMP_ZIPS=true
1238             CMP_ZIPS_CONTENTS=true
1239             ;;
1240         -zips-names)
1241             CMP_ZIPS=true
1242             CMP_ZIPS_CONTENTS=false
1243             ;;
1244         -jars)
1245             CMP_JARS=true
1246             ;;
1247         -jmods)
1248             CMP_JMODS=true
1249             ;;
1250         -libs)
1251             CMP_LIBS=true
1252             ;;
1253         -execs)
1254             CMP_EXECS=true
1255             ;;
1256         -2dirs)
1257             THIS=&quot;$(cd &quot;$2&quot; &gt; /dev/null &amp;&amp; pwd )&quot;
1258             OTHER=&quot;$(cd &quot;$3&quot; &gt; /dev/null &amp;&amp; pwd )&quot;
1259             THIS_BASE_DIR=&quot;$THIS&quot;
1260             OTHER_BASE_DIR=&quot;$OTHER&quot;
1261             SKIP_DEFAULT=true
1262             shift
1263             shift
1264             ;;
1265         -2zips)
1266             CMP_2_ZIPS=true
1267             THIS_FILE=$2
1268             OTHER_FILE=$3
1269             shift
1270             shift
1271             ;;
1272         -2bins)
1273             CMP_2_BINS=true
1274             THIS_FILE=$2
1275             OTHER_FILE=$3
1276             shift
1277             shift
1278             ;;
1279         --sort-symbols)
1280             SORT_ALL_SYMBOLS=true
1281             ;;
1282         --strip)
1283             STRIP_ALL=true
1284             ;;
1285         --clean)
1286             CLEAN_OUTPUT=true
1287             ;;
1288         *)
1289             CMP_NAMES=false
1290             CMP_PERMS=false
1291             CMP_TYPES=false
1292             CMP_ZIPS=true
1293             CMP_JARS=true
1294             CMP_JMODS=true
1295             CMP_LIBS=true
1296             CMP_EXECS=true
1297 
1298             if [ -z &quot;$FILTER&quot; ]; then
1299                 FILTER=&quot;$GREP&quot;
1300             fi
1301             FILTER=&quot;$FILTER -e $1&quot;
1302             ;;
1303     esac
1304     shift
1305 done
1306 
1307 if [ &quot;$STRIP_ALL&quot; = &quot;true&quot; ] &amp;&amp; [ -z &quot;$STRIP&quot; ]; then
1308   echo Warning: Not stripping even with --strip, since strip is missing on this platform
1309   STRIP_ALL=false
1310 fi
1311 
1312 COMPARE_ROOT=$OUTPUTDIR/compare-support
1313 if [ &quot;$CLEAN_OUTPUT&quot; = &quot;true&quot; ]; then
1314     echo Cleaning old output in $COMPARE_ROOT.
1315     $RM -rf $COMPARE_ROOT
1316 fi
1317 $MKDIR -p $COMPARE_ROOT
1318 if [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;windows&quot; ]; then
1319     if [ &quot;$(uname -o)&quot; = &quot;Cygwin&quot; ]; then
1320         COMPARE_ROOT=$(cygpath -msa $COMPARE_ROOT)
1321     fi
1322 fi
1323 
1324 if [ &quot;$CMP_2_ZIPS&quot; = &quot;true&quot; ]; then
1325     THIS_DIR=&quot;$(dirname $THIS_FILE)&quot;
1326     THIS_DIR=&quot;$(cd &quot;$THIS_DIR&quot; &gt; /dev/null &amp;&amp; pwd )&quot;
1327     OTHER_DIR=&quot;$(dirname $OTHER_FILE)&quot;
1328     OTHER_DIR=&quot;$(cd &quot;$OTHER_DIR&quot; &gt; /dev/null &amp;&amp; pwd )&quot;
1329     THIS_FILE_NAME=&quot;$(basename $THIS_FILE)&quot;
1330     OTHER_FILE_NAME=&quot;$(basename $OTHER_FILE)&quot;
1331     echo Comparing $THIS_DIR/$THIS_FILE_NAME and $OTHER_DIR/$OTHER_FILE_NAME
1332     compare_zip_file $THIS_DIR $OTHER_DIR $COMPARE_ROOT/2zips $THIS_FILE_NAME $OTHER_FILE_NAME
1333     exit
1334 fi
1335 
1336 if [ &quot;$CMP_2_BINS&quot; = &quot;true&quot; ]; then
1337     THIS_DIR=&quot;$(dirname $THIS_FILE)&quot;
1338     THIS_DIR=&quot;$(cd &quot;$THIS_DIR&quot; &gt; /dev/null &amp;&amp; pwd )&quot;
1339     OTHER_DIR=&quot;$(dirname $OTHER_FILE)&quot;
1340     OTHER_DIR=&quot;$(cd &quot;$OTHER_DIR&quot; &gt; /dev/null &amp;&amp; pwd )&quot;
1341     THIS_FILE_NAME=&quot;$(basename $THIS_FILE)&quot;
1342     OTHER_FILE_NAME=&quot;$(basename $OTHER_FILE)&quot;
1343     echo Comparing $THIS_DIR/$THIS_FILE_NAME and $OTHER_DIR/$OTHER_FILE_NAME
1344     compare_bin_file $THIS_DIR $OTHER_DIR $COMPARE_ROOT/2bins $THIS_FILE_NAME $OTHER_FILE_NAME
1345     exit
1346 fi
1347 
1348 if [ &quot;$CMP_NAMES&quot; = &quot;false&quot; ] \
1349        &amp;&amp; [ &quot;$CMP_TYPES&quot; = &quot;false&quot; ] \
1350        &amp;&amp; [ &quot;$CMP_PERMS&quot; = &quot;false&quot; ] \
1351        &amp;&amp; [ &quot;$CMP_GENERAL&quot; = &quot;false&quot; ] \
1352        &amp;&amp; [ &quot;$CMP_ZIPS&quot; = &quot;false&quot; ] \
1353        &amp;&amp; [ &quot;$CMP_JARS&quot; = &quot;false&quot; ] \
1354        &amp;&amp; [ &quot;$CMP_JMODS&quot; = &quot;false&quot; ] \
1355        &amp;&amp; [ &quot;$CMP_LIBS&quot; = &quot;false&quot; ] \
1356        &amp;&amp; [ &quot;$CMP_EXECS&quot; = &quot;false&quot; ]; then
1357     CMP_NAMES=true
1358     CMP_PERMS=true
1359     CMP_TYPES=true
1360     CMP_GENERAL=true
1361     CMP_ZIPS=true
1362     CMP_JARS=true
1363     CMP_JMODS=true
1364     CMP_LIBS=true
1365     CMP_EXECS=true
1366 fi
1367 
1368 if [ -z &quot;$FILTER&quot; ]; then
1369     FILTER=&quot;$CAT&quot;
1370 fi
1371 
1372 if [ &quot;$SKIP_DEFAULT&quot; != &quot;true&quot; ]; then
1373     if [ -z &quot;$OTHER&quot; ]; then
1374         echo &quot;Nothing to compare to, set with -o&quot;
1375         exit 1
1376     else
1377         if [ ! -d &quot;$OTHER&quot; ]; then
1378             echo &quot;Other build directory does not exist:&quot;
1379             echo &quot;$OTHER&quot;
1380             exit 1
1381         fi
1382         OTHER=&quot;$( cd &quot;$OTHER&quot; &gt; /dev/null &amp;&amp; pwd )&quot;
1383         echo &quot;Comparing to:&quot;
1384         echo &quot;$OTHER&quot;
1385         echo
1386     fi
1387 
1388     # Find the common images to compare, prioritizing later build stages
1389     if [ -d &quot;$THIS/images/jdk&quot; ] &amp;&amp; [ -d &quot;$OTHER/images/jdk&quot; ]; then
1390         THIS_JDK=&quot;$THIS/images/jdk&quot;
1391         OTHER_JDK=&quot;$OTHER/images/jdk&quot;
1392         echo &quot;Selecting normal images for JDK compare&quot;
1393     elif [ -d &quot;$(ls -d $THIS/licensee-src/build/*/images/jdk 2&gt; /dev/null)&quot; ] \
1394         &amp;&amp; [ -d &quot;$(ls -d $OTHER/licensee-src/build/*/images/jdk 2&gt; /dev/null)&quot; ]
1395     then
1396         echo &quot;Selecting licensee images for compare&quot;
1397         # Simply override the THIS and OTHER dir with the build dir from
1398         # the nested licensee source build for the rest of the script
1399         # execution.
1400         OLD_THIS=&quot;$THIS&quot;
1401         OLD_OTHER=&quot;$OTHER&quot;
1402         THIS=&quot;$(ls -d $THIS/licensee-src/build/*)&quot;
1403         OTHER=&quot;$(ls -d $OTHER/licensee-src/build/*)&quot;
1404         THIS_JDK=&quot;$THIS/images/jdk&quot;
1405         OTHER_JDK=&quot;$OTHER/images/jdk&quot;
1406         # Rewrite the path to tools that are used from the build
1407         JIMAGE=&quot;$(echo &quot;$JIMAGE&quot; | $SED &quot;s|$OLD_THIS|$THIS|g&quot;)&quot;
1408         JMOD=&quot;$(echo &quot;$JMOD&quot; | $SED &quot;s|$OLD_THIS|$THIS|g&quot;)&quot;
1409         JAVAP=&quot;$(echo &quot;$JAVAP&quot; | $SED &quot;s|$OLD_THIS|$THIS|g&quot;)&quot;
1410     else
1411         echo &quot;No common images found.&quot;
1412         exit 1
1413     fi
1414     echo &quot;  $THIS_JDK&quot;
1415     echo &quot;  $OTHER_JDK&quot;
1416 
1417     if [ -d &quot;$THIS/images/jdk-bundle&quot; -o -d &quot;$THIS/deploy/images/jdk-bundle&quot; ] \
1418              &amp;&amp; [ -d &quot;$OTHER/images/jdk-bundle&quot; -o -d &quot;$OTHER/deploy/images/jdk-bundle&quot; ]; then
1419         if [ -d &quot;$THIS/deploy/images/jdk-bundle&quot; ]; then
1420             THIS_JDK_BUNDLE=&quot;$THIS/deploy/images/jdk-bundle&quot;
1421         else
1422             THIS_JDK_BUNDLE=&quot;$THIS/images/jdk-bundle&quot;
1423         fi
1424         if [ -d &quot;$OTHER/deploy/images/jdk-bundle&quot; ]; then
1425             OTHER_JDK_BUNDLE=&quot;$OTHER/deploy/images/jdk-bundle&quot;
1426         else
1427             OTHER_JDK_BUNDLE=&quot;$OTHER/images/jdk-bundle&quot;
1428         fi
1429         echo &quot;Also comparing jdk macosx bundles&quot;
1430         echo &quot;  $THIS_JDK_BUNDLE&quot;
1431         echo &quot;  $OTHER_JDK_BUNDLE&quot;
1432     fi
1433 
1434     THIS_SEC_DIR=&quot;$THIS/images&quot;
1435     OTHER_SEC_DIR=&quot;$OTHER/images&quot;
1436     if [ -f &quot;$THIS_SEC_DIR/sec-bin.zip&quot; ] &amp;&amp; [ -f &quot;$OTHER_SEC_DIR/sec-bin.zip&quot; ]; then
1437         OTHER_SEC_BIN=&quot;$OTHER_SEC_DIR/sec-bin.zip&quot;
1438         THIS_SEC_BIN=&quot;$THIS_SEC_DIR/sec-bin.zip&quot;
1439         if [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;windows&quot; ]; then
1440             if [ &quot;$OPENJDK_TARGET_CPU&quot; = &quot;x86_64&quot; ]; then
1441                 JGSS_WINDOWS_BIN=&quot;jgss-windows-x64-bin.zip&quot;
1442             else
1443                 JGSS_WINDOWS_BIN=&quot;jgss-windows-i586-bin.zip&quot;
1444             fi
1445             OTHER_SEC_WINDOWS_BIN=&quot;$OTHER_SEC_DIR/sec-windows-bin.zip&quot;
1446             OTHER_JGSS_WINDOWS_BIN=&quot;$OTHER_SEC_DIR/$JGSS_WINDOWS_BIN&quot;
1447             THIS_SEC_WINDOWS_BIN=&quot;$THIS_SEC_DIR/sec-windows-bin.zip&quot;
1448             THIS_JGSS_WINDOWS_BIN=&quot;$THIS_SEC_DIR/$JGSS_WINDOWS_BIN&quot;
1449         fi
1450     fi
1451 
1452     if [ -d &quot;$THIS/images/docs&quot; ] &amp;&amp; [ -d &quot;$OTHER/images/docs&quot; ]; then
1453         THIS_DOCS=&quot;$THIS/images/docs&quot;
1454         OTHER_DOCS=&quot;$OTHER/images/docs&quot;
1455         echo &quot;Also comparing docs&quot;
1456     else
1457         echo &quot;WARNING! Docs haven&#39;t been built and won&#39;t be compared.&quot;
1458     fi
1459 
1460     if [ -d &quot;$THIS/images/test&quot; ] &amp;&amp; [ -d &quot;$OTHER/images/test&quot; ]; then
1461         THIS_TEST=&quot;$THIS/images/test&quot;
1462         OTHER_TEST=&quot;$OTHER/images/test&quot;
1463         echo &quot;Also comparing test image&quot;
1464     else
1465         echo &quot;WARNING! Test haven&#39;t been built and won&#39;t be compared.&quot;
1466     fi
1467 fi
1468 
1469 ################################################################################
1470 # Do the work
1471 
1472 if [ &quot;$CMP_NAMES&quot; = &quot;true&quot; ]; then
1473     if [ -n &quot;$THIS_JDK&quot; ] &amp;&amp; [ -n &quot;$OTHER_JDK&quot; ]; then
1474         echo -n &quot;JDK &quot;
1475         compare_dirs $THIS_JDK $OTHER_JDK $COMPARE_ROOT/jdk
1476         echo -n &quot;JDK &quot;
1477         compare_files $THIS_JDK $OTHER_JDK $COMPARE_ROOT/jdk
1478     fi
1479     if [ -n &quot;$THIS_JDK_BUNDLE&quot; ] &amp;&amp; [ -n &quot;$OTHER_JDK_BUNDLE&quot; ]; then
1480         echo -n &quot;JDK Bundle &quot;
1481         compare_dirs $THIS_JDK_BUNDLE $OTHER_JDK_BUNDLE $COMPARE_ROOT/jdk-bundle
1482 
1483         echo -n &quot;JDK Bundle &quot;
1484         compare_files $THIS_JDK_BUNDLE $OTHER_JDK_BUNDLE $COMPARE_ROOT/jdk-bundle
1485     fi
1486     if [ -n &quot;$THIS_DOCS&quot; ] &amp;&amp; [ -n &quot;$OTHER_DOCS&quot; ]; then
1487         echo -n &quot;Docs &quot;
1488         compare_dirs $THIS_DOCS $OTHER_DOCS $COMPARE_ROOT/docs
1489         echo -n &quot;Docs &quot;
1490         compare_files $THIS_DOCS $OTHER_DOCS $COMPARE_ROOT/docs
1491     fi
1492     if [ -n &quot;$THIS_TEST&quot; ] &amp;&amp; [ -n &quot;$OTHER_TEST&quot; ]; then
1493         echo -n &quot;Test &quot;
1494         compare_dirs $THIS_TEST $OTHER_TEST $COMPARE_ROOT/test
1495         echo -n &quot;Test &quot;
1496         compare_files $THIS_TEST $OTHER_TEST $COMPARE_ROOT/test
1497     fi
1498     if [ -n &quot;$THIS_BASE_DIR&quot; ] &amp;&amp; [ -n &quot;$OTHER_BASE_DIR&quot; ]; then
1499         compare_dirs $THIS_BASE_DIR $OTHER_BASE_DIR $COMPARE_ROOT/base_dir
1500         compare_files $THIS_BASE_DIR $OTHER_BASE_DIR $COMPARE_ROOT/base_dir
1501     fi
1502 fi
1503 
1504 if [ &quot;$CMP_LIBS&quot; = &quot;true&quot; ]; then
1505     if [ -n &quot;$THIS_JDK&quot; ] &amp;&amp; [ -n &quot;$OTHER_JDK&quot; ]; then
1506         echo -n &quot;JDK &quot;
1507         compare_all_libs $THIS_JDK $OTHER_JDK $COMPARE_ROOT/jdk
1508     fi
1509     if [ -n &quot;$THIS_TEST&quot; ] &amp;&amp; [ -n &quot;$OTHER_TEST&quot; ]; then
1510         echo -n &quot;Test &quot;
1511         STRIP_ALL_bak=&quot;$STRIP_ALL&quot;
1512         if [ &quot;$STRIP_TESTS_BEFORE_COMPARE&quot; = &quot;true&quot; ]; then
1513           STRIP_ALL=&quot;true&quot;
1514         fi
1515         compare_all_libs $THIS_TEST $OTHER_TEST $COMPARE_ROOT/test
1516         STRIP_ALL=&quot;$STRIP_ALL_bak&quot;
1517     fi
1518     if [ -n &quot;$THIS_BASE_DIR&quot; ] &amp;&amp; [ -n &quot;$OTHER_BASE_DIR&quot; ]; then
1519         compare_all_libs $THIS_BASE_DIR $OTHER_BASE_DIR $COMPARE_ROOT/base_dir
1520     fi
1521 fi
1522 
1523 if [ &quot;$CMP_EXECS&quot; = &quot;true&quot; ]; then
1524     if [ -n &quot;$THIS_JDK&quot; ] &amp;&amp; [ -n &quot;$OTHER_JDK&quot; ]; then
1525         echo -n &quot;JDK &quot;
1526         compare_all_execs $THIS_JDK $OTHER_JDK $COMPARE_ROOT/jdk
1527     fi
1528     if [ -n &quot;$THIS_TEST&quot; ] &amp;&amp; [ -n &quot;$OTHER_TEST&quot; ]; then
1529         echo -n &quot;Test &quot;
1530         STRIP_ALL_bak=&quot;$STRIP_ALL&quot;
1531         if [ &quot;$STRIP_TESTS_BEFORE_COMPARE&quot; = &quot;true&quot; ]; then
1532           STRIP_ALL=&quot;true&quot;
1533         fi
1534         compare_all_execs $THIS_TEST $OTHER_TEST $COMPARE_ROOT/test
1535         STRIP_ALL=&quot;$STRIP_ALL_bak&quot;
1536     fi
1537     if [ -n &quot;$THIS_BASE_DIR&quot; ] &amp;&amp; [ -n &quot;$OTHER_BASE_DIR&quot; ]; then
1538         compare_all_execs $THIS_BASE_DIR $OTHER_BASE_DIR $COMPARE_ROOT/base_dir
1539     fi
1540 fi
1541 
1542 if [ &quot;$CMP_GENERAL&quot; = &quot;true&quot; ]; then
1543     if [ -n &quot;$THIS_JDK&quot; ] &amp;&amp; [ -n &quot;$OTHER_JDK&quot; ]; then
1544         echo -n &quot;JDK &quot;
1545         compare_general_files $THIS_JDK $OTHER_JDK $COMPARE_ROOT/jdk
1546     fi
1547     if [ -n &quot;$THIS_JDK_BUNDLE&quot; ] &amp;&amp; [ -n &quot;$OTHER_JDK_BUNDLE&quot; ]; then
1548         echo -n &quot;JDK Bundle &quot;
1549         compare_general_files $THIS_JDK_BUNDLE $OTHER_JDK_BUNDLE $COMPARE_ROOT/jdk-bundle
1550     fi
1551     if [ -n &quot;$THIS_DOCS&quot; ] &amp;&amp; [ -n &quot;$OTHER_DOCS&quot; ]; then
1552         echo -n &quot;Docs &quot;
1553         compare_general_files $THIS_DOCS $OTHER_DOCS $COMPARE_ROOT/docs
1554     fi
1555     if [ -n &quot;$THIS_TEST&quot; ] &amp;&amp; [ -n &quot;$OTHER_TEST&quot; ]; then
1556         echo -n &quot;Test &quot;
1557         compare_general_files $THIS_TEST $OTHER_TEST $COMPARE_ROOT/test
1558     fi
1559     if [ -n &quot;$THIS_BASE_DIR&quot; ] &amp;&amp; [ -n &quot;$OTHER_BASE_DIR&quot; ]; then
1560         compare_general_files $THIS_BASE_DIR $OTHER_BASE_DIR $COMPARE_ROOT/base_dir
1561     fi
1562 fi
1563 
1564 if [ &quot;$CMP_ZIPS&quot; = &quot;true&quot; ]; then
1565     if [ -n &quot;$THIS_JDK&quot; ] &amp;&amp; [ -n &quot;$OTHER_JDK&quot; ]; then
1566         echo -n &quot;JDK &quot;
1567         compare_all_zip_files $THIS_JDK $OTHER_JDK $COMPARE_ROOT/jdk
1568     fi
1569     if [ -n &quot;$THIS_TEST&quot; ] &amp;&amp; [ -n &quot;$OTHER_TEST&quot; ]; then
1570         echo -n &quot;Test &quot;
1571         compare_all_zip_files $THIS_TEST $OTHER_TEST $COMPARE_ROOT/test
1572     fi
1573     if [ -n &quot;$THIS_SEC_BIN&quot; ] &amp;&amp; [ -n &quot;$OTHER_SEC_BIN&quot; ]; then
1574         if [ -n &quot;$(echo $THIS_SEC_BIN | $FILTER)&quot; ]; then
1575             echo &quot;sec-bin.zip...&quot;
1576             compare_zip_file $THIS_SEC_DIR $OTHER_SEC_DIR $COMPARE_ROOT/sec-bin sec-bin.zip
1577         fi
1578     fi
1579     if [ -n &quot;$THIS_SEC_WINDOWS_BIN&quot; ] &amp;&amp; [ -n &quot;$OTHER_SEC_WINDOWS_BIN&quot; ]; then
1580         if [ -n &quot;$(echo $THIS_SEC_WINDOWS_BIN | $FILTER)&quot; ]; then
1581             echo &quot;sec-windows-bin.zip...&quot;
1582             compare_zip_file $THIS_SEC_DIR $OTHER_SEC_DIR $COMPARE_ROOT/sec-bin sec-windows-bin.zip
1583         fi
1584     fi
1585     if [ -n &quot;$THIS_JGSS_WINDOWS_BIN&quot; ] &amp;&amp; [ -n &quot;$OTHER_JGSS_WINDOWS_BIN&quot; ]; then
1586         if [ -n &quot;$(echo $THIS_JGSS_WINDOWS_BIN | $FILTER)&quot; ]; then
1587             echo &quot;$JGSS_WINDOWS_BIN...&quot;
1588             compare_zip_file $THIS_SEC_DIR $OTHER_SEC_DIR $COMPARE_ROOT/sec-bin $JGSS_WINDOWS_BIN
1589         fi
1590     fi
1591     if [ -n &quot;$THIS_BASE_DIR&quot; ] &amp;&amp; [ -n &quot;$OTHER_BASE_DIR&quot; ]; then
1592         compare_all_zip_files $THIS_BASE_DIR $OTHER_BASE_DIR $COMPARE_ROOT/base_dir
1593     fi
1594 fi
1595 
1596 if [ &quot;$CMP_JARS&quot; = &quot;true&quot; ]; then
1597     if [ -n &quot;$THIS_JDK&quot; ] &amp;&amp; [ -n &quot;$OTHER_JDK&quot; ]; then
1598         echo -n &quot;JDK &quot;
1599         compare_all_jar_files $THIS_JDK $OTHER_JDK $COMPARE_ROOT/jdk
1600     fi
1601     if [ -n &quot;$THIS_TEST&quot; ] &amp;&amp; [ -n &quot;$OTHER_TEST&quot; ]; then
1602         echo -n &quot;Test &quot;
1603         compare_all_jar_files $THIS_TEST $OTHER_TEST $COMPARE_ROOT/test
1604     fi
1605     if [ -n &quot;$THIS_BASE_DIR&quot; ] &amp;&amp; [ -n &quot;$OTHER_BASE_DIR&quot; ]; then
1606         compare_all_jar_files $THIS_BASE_DIR $OTHER_BASE_DIR $COMPARE_ROOT/base_dir
1607     fi
1608 fi
1609 
1610 if [ &quot;$CMP_JMODS&quot; = &quot;true&quot; ]; then
1611     if [ -n &quot;$THIS_JDK&quot; ] &amp;&amp; [ -n &quot;$OTHER_JDK&quot; ]; then
1612         compare_all_jmod_files $THIS_JDK $OTHER_JDK $COMPARE_ROOT/jdk
1613     fi
1614     if [ -n &quot;$THIS_BASE_DIR&quot; ] &amp;&amp; [ -n &quot;$OTHER_BASE_DIR&quot; ]; then
1615         compare_all_jmod_files $THIS_BASE_DIR $OTHER_BASE_DIR $COMPARE_ROOT/base_dir
1616     fi
1617 fi
1618 
1619 if [ &quot;$CMP_PERMS&quot; = &quot;true&quot; ]; then
1620     if [ -n &quot;$THIS_JDK&quot; ] &amp;&amp; [ -n &quot;$OTHER_JDK&quot; ]; then
1621         echo -n &quot;JDK &quot;
1622         compare_permissions $THIS_JDK $OTHER_JDK $COMPARE_ROOT/jdk
1623     fi
1624     if [ -n &quot;$THIS_BASE_DIR&quot; ] &amp;&amp; [ -n &quot;$OTHER_BASE_DIR&quot; ]; then
1625         compare_permissions $THIS_BASE_DIR $OTHER_BASE_DIR $COMPARE_ROOT/base_dir
1626     fi
1627 fi
1628 
1629 if [ &quot;$CMP_TYPES&quot; = &quot;true&quot; ]; then
1630     if [ -n &quot;$THIS_JDK&quot; ] &amp;&amp; [ -n &quot;$OTHER_JDK&quot; ]; then
1631         echo -n &quot;JDK &quot;
1632         compare_file_types $THIS_JDK $OTHER_JDK $COMPARE_ROOT/jdk
1633     fi
1634     if [ -n &quot;$THIS_JDK_BUNDLE&quot; ] &amp;&amp; [ -n &quot;$OTHER_JDK_BUNDLE&quot; ]; then
1635         echo -n &quot;JDK Bundle &quot;
1636         compare_file_types $THIS_JDK_BUNDLE $OTHER_JDK_BUNDLE $COMPARE_ROOT/jdk-bundle
1637     fi
1638     if [ -n &quot;$THIS_TEST&quot; ] &amp;&amp; [ -n &quot;$OTHER_TEST&quot; ]; then
1639         echo -n &quot;Test &quot;
1640         compare_file_types $THIS_JDK $OTHER_JDK $COMPARE_ROOT/jdk
1641     fi
1642     if [ -n &quot;$THIS_BASE_DIR&quot; ] &amp;&amp; [ -n &quot;$OTHER_BASE_DIR&quot; ]; then
1643         compare_file_types $THIS_BASE_DIR $OTHER_BASE_DIR $COMPARE_ROOT/base_dir
1644     fi
1645 fi
1646 
1647 echo
1648 
1649 if [ -n &quot;$REGRESSIONS&quot; ]; then
1650     echo &quot;REGRESSIONS FOUND!&quot;
1651     echo
1652     exit 1
1653 else
1654     echo &quot;No regressions found&quot;
1655     echo
1656     exit 0
1657 fi
    </pre>
  </body>
</html>