<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff make/scripts/compare.sh</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="../modules/jdk.sctp/Lib.gmk.cdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="compare_exceptions.sh.incl.cdiff.html" target="_top">next &gt;</a></center>    <h2>make/scripts/compare.sh</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 70,30 ***</span>
  ################################################################################
  #
  # Disassembly diff filters. These filters try to filter out ephemeral parts of the
  # disassembly, such as hard-coded addresses, to be able to catch &quot;actual&quot; differences.
  
<span class="line-modified">! if [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;solaris&quot; ]; then</span>
<span class="line-removed">-   if [ &quot;$OPENJDK_TARGET_CPU&quot; = &quot;sparcv9&quot; ]; then</span>
<span class="line-removed">-     DIS_DIFF_FILTER=&quot;$SED \</span>
<span class="line-removed">-         -e &#39;s/^[0-9a-f]\{16\}/&lt;ADDR&gt;:/&#39; \</span>
<span class="line-removed">-         -e &#39;s/^ *[0-9a-f]\{3,12\}:/  &lt;ADDR&gt;:/&#39; \</span>
<span class="line-removed">-         -e &#39;s/:	[0-9a-f][0-9a-f]\( [0-9a-f][0-9a-f]\)\{2,10\}/:	&lt;NUMS&gt;/&#39; \</span>
<span class="line-removed">-         -e &#39;s/\$[a-zA-Z0-9_\$]\{15\}\./&lt;SYM&gt;./&#39; \</span>
<span class="line-removed">-         -e &#39;s/, [0-9a-fx\-]\{1,8\}/, &lt;ADDR&gt;/g&#39; \</span>
<span class="line-removed">-         -e &#39;s/0x[0-9a-f]\{1,8\}/&lt;HEX&gt;/g&#39; \</span>
<span class="line-removed">-         -e &#39;s/\! [0-9a-f]\{1,8\} /! &lt;ADDR&gt; /&#39; \</span>
<span class="line-removed">-         -e &#39;s/call  [0-9a-f]\{4,7\}/call  &lt;ADDR&gt;/&#39; \</span>
<span class="line-removed">-         -e &#39;s/%hi(0),/%hi(&lt;HEX&gt;),/&#39; \</span>
<span class="line-removed">-         &quot;</span>
<span class="line-removed">-   elif [ &quot;$OPENJDK_TARGET_CPU&quot; = &quot;x86_64&quot; ]; then</span>
<span class="line-removed">-     # Random strings looking like this differ: &lt;.XAKoKoPIac2W0OA.</span>
<span class="line-removed">-     DIS_DIFF_FILTER=&quot;$SED \</span>
<span class="line-removed">-         -e &#39;s/&lt;\.[A-Za-z0-9]\{\15}\./&lt;.SYM./&#39; \</span>
<span class="line-removed">-         &quot;</span>
<span class="line-removed">-   fi</span>
<span class="line-removed">- elif [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;windows&quot; ]; then</span>
    if [ &quot;$OPENJDK_TARGET_CPU&quot; = &quot;x86&quot; ]; then
      DIS_DIFF_FILTER=&quot;$SED -r \
          -e &#39;s/^  [0-9A-F]{16}: //&#39; \
          -e &#39;s/^  [0-9A-F]{8}: /  &lt;ADDR&gt;: /&#39; \
          -e &#39;s/(offset \?\?)_C@_.*/\1&lt;SYM&gt;/&#39; \
<span class="line-new-header">--- 70,11 ---</span>
  ################################################################################
  #
  # Disassembly diff filters. These filters try to filter out ephemeral parts of the
  # disassembly, such as hard-coded addresses, to be able to catch &quot;actual&quot; differences.
  
<span class="line-modified">! if [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;windows&quot; ]; then</span>
    if [ &quot;$OPENJDK_TARGET_CPU&quot; = &quot;x86&quot; ]; then
      DIS_DIFF_FILTER=&quot;$SED -r \
          -e &#39;s/^  [0-9A-F]{16}: //&#39; \
          -e &#39;s/^  [0-9A-F]{8}: /  &lt;ADDR&gt;: /&#39; \
          -e &#39;s/(offset \?\?)_C@_.*/\1&lt;SYM&gt;/&#39; \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 456,18 ***</span>
          (cd $THIS_UNZIPDIR &amp;&amp; $JIMAGE extract $THIS_ZIP)
          (cd $OTHER_UNZIPDIR &amp;&amp; $JIMAGE extract $OTHER_ZIP)
      fi
  
      CONTENTS_DIFF_FILE=$WORK_DIR/$ZIP_FILE.diff
<span class="line-modified">!     # On solaris, there is no -q option.</span>
<span class="line-removed">-     if [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;solaris&quot; ]; then</span>
<span class="line-removed">-         $DIFF -r $OTHER_UNZIPDIR $THIS_UNZIPDIR \</span>
<span class="line-removed">-             | $GREP -v -e &quot;^&lt;&quot; -e &quot;^&gt;&quot; -e &quot;^Common subdirectories:&quot; \</span>
<span class="line-removed">-             &gt; $CONTENTS_DIFF_FILE</span>
<span class="line-removed">-     else</span>
<span class="line-removed">-         $DIFF -rq $OTHER_UNZIPDIR $THIS_UNZIPDIR &gt; $CONTENTS_DIFF_FILE</span>
<span class="line-removed">-     fi</span>
  
      ONLY_OTHER=$($GREP &quot;^Only in $OTHER_UNZIPDIR&quot; $CONTENTS_DIFF_FILE)
      ONLY_THIS=$($GREP &quot;^Only in $THIS_UNZIPDIR&quot; $CONTENTS_DIFF_FILE)
  
      return_value=0
<span class="line-new-header">--- 437,11 ---</span>
          (cd $THIS_UNZIPDIR &amp;&amp; $JIMAGE extract $THIS_ZIP)
          (cd $OTHER_UNZIPDIR &amp;&amp; $JIMAGE extract $OTHER_ZIP)
      fi
  
      CONTENTS_DIFF_FILE=$WORK_DIR/$ZIP_FILE.diff
<span class="line-modified">!     $DIFF -rq $OTHER_UNZIPDIR $THIS_UNZIPDIR &gt; $CONTENTS_DIFF_FILE</span>
  
      ONLY_OTHER=$($GREP &quot;^Only in $OTHER_UNZIPDIR&quot; $CONTENTS_DIFF_FILE)
      ONLY_THIS=$($GREP &quot;^Only in $THIS_UNZIPDIR&quot; $CONTENTS_DIFF_FILE)
  
      return_value=0
</pre>
<hr />
<pre>
<span class="line-old-header">*** 483,18 ***</span>
          echo &quot;$ONLY_THIS&quot; | sed &quot;s|Only in $THIS_UNZIPDIR|            |&quot;g | sed &#39;s|: |/|g&#39;
          return_value=1
      fi
  
      if [ &quot;$CMP_ZIPS_CONTENTS&quot; = &quot;true&quot; ]; then
<span class="line-modified">!         if [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;solaris&quot; ]; then</span>
<span class="line-modified">!             DIFFING_FILES=$($GREP -e &#39;differ$&#39; -e &#39;^diff &#39; $CONTENTS_DIFF_FILE \</span>
<span class="line-removed">-                 | $SED -e &#39;s/^Files //g&#39; -e &#39;s/diff -r //g&#39; | $CUT -f 1 -d &#39; &#39; \</span>
<span class="line-removed">-                 | $SED &quot;s|$OTHER_UNZIPDIR/||g&quot;)</span>
<span class="line-removed">-         else</span>
<span class="line-removed">-             DIFFING_FILES=$($GREP -e &quot;differ$&quot; $CONTENTS_DIFF_FILE \</span>
<span class="line-removed">-                 | $CUT -f 2 -d &#39; &#39; | $SED &quot;s|$OTHER_UNZIPDIR/||g&quot;)</span>
<span class="line-removed">-         fi</span>
  
          # Separate executable/library files from other files in zip.
          DIFFING_TEXT_FILES=
          DIFFING_EXEC_FILES=
          for file in $DIFFING_FILES; do
<span class="line-new-header">--- 457,12 ---</span>
          echo &quot;$ONLY_THIS&quot; | sed &quot;s|Only in $THIS_UNZIPDIR|            |&quot;g | sed &#39;s|: |/|g&#39;
          return_value=1
      fi
  
      if [ &quot;$CMP_ZIPS_CONTENTS&quot; = &quot;true&quot; ]; then
<span class="line-modified">!         DIFFING_FILES=$($GREP -e &quot;differ$&quot; $CONTENTS_DIFF_FILE \</span>
<span class="line-modified">!             | $CUT -f 2 -d &#39; &#39; | $SED &quot;s|$OTHER_UNZIPDIR/||g&quot;)</span>
  
          # Separate executable/library files from other files in zip.
          DIFFING_TEXT_FILES=
          DIFFING_EXEC_FILES=
          for file in $DIFFING_FILES; do
</pre>
<hr />
<pre>
<span class="line-old-header">*** 827,14 ***</span>
          # The output from dumpbin on windows differs depending on if the debug symbol
          # files are still around at the location the binary is pointing too. Need
          # to filter out that extra information.
          $DUMPBIN -exports $OTHER_FILE | $GREP  -E &#39;^ +[0-9A-F]+ +[0-9A-F]+ [0-9A-F]+&#39; | sed &#39;s/ = .*//g&#39; | cut -c27- | $SYM_SORT_CMD &gt; $WORK_FILE_BASE.symbols.other
          $DUMPBIN -exports $THIS_FILE  | $GREP  -E &#39;^ +[0-9A-F]+ +[0-9A-F]+ [0-9A-F]+&#39; | sed &#39;s/ = .*//g&#39; | cut -c27- | $SYM_SORT_CMD &gt; $WORK_FILE_BASE.symbols.this
<span class="line-removed">-     elif [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;solaris&quot; ]; then</span>
<span class="line-removed">-         # Some symbols get seemingly random 15 character prefixes. Filter them out.</span>
<span class="line-removed">-         $NM -a $ORIG_OTHER_FILE 2&gt; /dev/null | $GREP -v $NAME | $AWK &#39;{print $2, $3, $4, $5}&#39; | $SED &#39;s/^\([a-zA-Z] [\.\$]\)[a-zA-Z0-9_\$]\{15,15\}\./\1./g&#39; | $SYM_SORT_CMD &gt; $WORK_FILE_BASE.symbols.other</span>
<span class="line-removed">-         $NM -a $ORIG_THIS_FILE  2&gt; /dev/null | $GREP -v $NAME | $AWK &#39;{print $2, $3, $4, $5}&#39; | $SED &#39;s/^\([a-zA-Z] [\.\$]\)[a-zA-Z0-9_\$]\{15,15\}\./\1./g&#39; | $SYM_SORT_CMD &gt; $WORK_FILE_BASE.symbols.this</span>
      elif [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;aix&quot; ]; then
          $OBJDUMP -T $ORIG_OTHER_FILE 2&gt; /dev/null | $GREP -v $NAME | $AWK &#39;{print $2, $3, $4, $5}&#39; | $SYM_SORT_CMD &gt; $WORK_FILE_BASE.symbols.other
          $OBJDUMP -T $ORIG_THIS_FILE  2&gt; /dev/null | $GREP -v $NAME | $AWK &#39;{print $2, $3, $4, $5}&#39; | $SYM_SORT_CMD &gt; $WORK_FILE_BASE.symbols.this
      elif [ &quot;$OPENJDK_TARGET_OS&quot; = &quot;macosx&quot; ]; then
          $NM -j $ORIG_OTHER_FILE 2&gt; /dev/null | $SYM_SORT_CMD &gt; $WORK_FILE_BASE.symbols.other
<span class="line-new-header">--- 795,10 ---</span>
</pre>
<center><a href="../modules/jdk.sctp/Lib.gmk.cdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="compare_exceptions.sh.incl.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>