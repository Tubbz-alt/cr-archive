<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/flags-cflags.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="build-performance.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="flags-ldflags.m4.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/flags-cflags.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 ################################################################################
 27 #
 28 # Setup flags for C/C++ compiler
 29 #
 30 
 31 ###############################################################################
 32 #
 33 # How to compile shared libraries.
 34 #
 35 AC_DEFUN([FLAGS_SETUP_SHARED_LIBS],
 36 [
 37   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
<span class="line-removed"> 38     C_FLAG_REORDER=&#39;&#39;</span>
<span class="line-removed"> 39 </span>
 40     # Default works for linux, might work on other platforms as well.
 41     SHARED_LIBRARY_FLAGS=&#39;-shared&#39;
 42     SET_EXECUTABLE_ORIGIN=&#39;-Wl,-rpath,\$$ORIGIN[$]1&#39;
 43     SET_SHARED_LIBRARY_ORIGIN=&quot;-Wl,-z,origin $SET_EXECUTABLE_ORIGIN&quot;
 44     SET_SHARED_LIBRARY_NAME=&#39;-Wl,-soname=[$]1&#39;
 45     SET_SHARED_LIBRARY_MAPFILE=&#39;-Wl,-version-script=[$]1&#39;
 46 
 47   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
<span class="line-removed"> 48     C_FLAG_REORDER=&#39;&#39;</span>
<span class="line-removed"> 49 </span>
 50     if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
 51       # Linking is different on MacOSX
 52       SHARED_LIBRARY_FLAGS=&quot;-dynamiclib -compatibility_version 1.0.0 -current_version 1.0.0&quot;
 53       SET_EXECUTABLE_ORIGIN=&#39;-Wl,-rpath,@loader_path$(or [$]1,/.)&#39;
 54       SET_SHARED_LIBRARY_ORIGIN=&quot;$SET_EXECUTABLE_ORIGIN&quot;
 55       SET_SHARED_LIBRARY_NAME=&#39;-Wl,-install_name,@rpath/[$]1&#39;
 56       SET_SHARED_LIBRARY_MAPFILE=&#39;-Wl,-exported_symbols_list,[$]1&#39;
 57 
 58     else
 59       # Default works for linux, might work on other platforms as well.
 60       SHARED_LIBRARY_FLAGS=&#39;-shared&#39;
 61       SET_EXECUTABLE_ORIGIN=&#39;-Wl,-rpath,\$$ORIGIN[$]1&#39;
 62       SET_SHARED_LIBRARY_NAME=&#39;-Wl,-soname=[$]1&#39;
 63       SET_SHARED_LIBRARY_MAPFILE=&#39;-Wl,-version-script=[$]1&#39;
 64 
 65       # arm specific settings
 66       if test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xarm&quot;; then
 67         # &#39;-Wl,-z,origin&#39; isn&#39;t used on arm.
 68         SET_SHARED_LIBRARY_ORIGIN=&#39;-Wl,-rpath,\$$$$ORIGIN[$]1&#39;
 69       else
 70         SET_SHARED_LIBRARY_ORIGIN=&quot;-Wl,-z,origin $SET_EXECUTABLE_ORIGIN&quot;
 71       fi
 72     fi
 73 
<span class="line-removed"> 74   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed"> 75     C_FLAG_REORDER=&#39;-xF&#39;</span>
<span class="line-removed"> 76     SHARED_LIBRARY_FLAGS=&quot;-G&quot;</span>
<span class="line-removed"> 77     SET_EXECUTABLE_ORIGIN=&#39;-R\$$ORIGIN[$]1&#39;</span>
<span class="line-removed"> 78     SET_SHARED_LIBRARY_ORIGIN=&quot;$SET_EXECUTABLE_ORIGIN&quot;</span>
<span class="line-removed"> 79     SET_SHARED_LIBRARY_NAME=&#39;-h [$]1&#39;</span>
<span class="line-removed"> 80     SET_SHARED_LIBRARY_MAPFILE=&#39;-M[$]1&#39;</span>
<span class="line-removed"> 81 </span>
 82   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
<span class="line-removed"> 83     C_FLAG_REORDER=&#39;&#39;</span>
 84     SHARED_LIBRARY_FLAGS=&quot;-qmkshrobj -bM:SRE -bnoentry&quot;
 85     SET_EXECUTABLE_ORIGIN=&quot;&quot;
 86     SET_SHARED_LIBRARY_ORIGIN=&#39;&#39;
 87     SET_SHARED_LIBRARY_NAME=&#39;&#39;
 88     SET_SHARED_LIBRARY_MAPFILE=&#39;&#39;
 89 
 90   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
<span class="line-removed"> 91     C_FLAG_REORDER=&#39;&#39;</span>
 92     SHARED_LIBRARY_FLAGS=&quot;-dll&quot;
 93     SET_EXECUTABLE_ORIGIN=&#39;&#39;
 94     SET_SHARED_LIBRARY_ORIGIN=&#39;&#39;
 95     SET_SHARED_LIBRARY_NAME=&#39;&#39;
 96     SET_SHARED_LIBRARY_MAPFILE=&#39;-def:[$]1&#39;
 97   fi
 98 
<span class="line-removed"> 99   AC_SUBST(C_FLAG_REORDER)</span>
100   AC_SUBST(SET_EXECUTABLE_ORIGIN)
101   AC_SUBST(SET_SHARED_LIBRARY_ORIGIN)
102   AC_SUBST(SET_SHARED_LIBRARY_NAME)
103   AC_SUBST(SET_SHARED_LIBRARY_MAPFILE)
104   AC_SUBST(SHARED_LIBRARY_FLAGS)
105 ])
106 
107 AC_DEFUN([FLAGS_SETUP_DEBUG_SYMBOLS],
108 [
109   # By default don&#39;t set any specific assembler debug
110   # info flags for toolchains unless we know they work.
111   # See JDK-8207057.
112   ASFLAGS_DEBUG_SYMBOLS=&quot;&quot;
113   # Debug symbols
114   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
115     CFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
116     ASFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
117   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
118     CFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
119     ASFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
<span class="line-removed">120   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed">121     # -g0 enables debug symbols without disabling inlining.</span>
<span class="line-removed">122     CFLAGS_DEBUG_SYMBOLS=&quot;-g0 -xs&quot;</span>
123   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
124     CFLAGS_DEBUG_SYMBOLS=&quot;-g1&quot;
125   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
126     CFLAGS_DEBUG_SYMBOLS=&quot;-Z7&quot;
127   fi
128 
129   AC_SUBST(CFLAGS_DEBUG_SYMBOLS)
130   AC_SUBST(ASFLAGS_DEBUG_SYMBOLS)
131 ])
132 
133 AC_DEFUN([FLAGS_SETUP_WARNINGS],
134 [
135   # Set default value.
136   if test &quot;x$TOOLCHAIN_TYPE&quot; != xxlc; then
137     WARNINGS_AS_ERRORS_DEFAULT=true
138   else
139     WARNINGS_AS_ERRORS_DEFAULT=false
140   fi
141 
142   UTIL_ARG_ENABLE(NAME: warnings-as-errors, DEFAULT: $WARNINGS_AS_ERRORS_DEFAULT,
143       RESULT: WARNINGS_AS_ERRORS,
144       DEFAULT_DESC: [auto],
145       DESC: [consider native warnings to be an error])
146   AC_SUBST(WARNINGS_AS_ERRORS)
147 
148   case &quot;${TOOLCHAIN_TYPE}&quot; in
149     microsoft)
150       DISABLE_WARNING_PREFIX=&quot;-wd&quot;
151       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-WX&quot;
152 
153       WARNINGS_ENABLE_ALL=&quot;-W3&quot;
154       DISABLED_WARNINGS=&quot;4800&quot;
155       ;;
156 
<span class="line-removed">157     solstudio)</span>
<span class="line-removed">158       DISABLE_WARNING_PREFIX=&quot;-erroff=&quot;</span>
<span class="line-removed">159       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-errwarn=%all&quot;</span>
<span class="line-removed">160 </span>
<span class="line-removed">161       WARNINGS_ENABLE_ALL_CFLAGS=&quot;-v -fd -xtransition&quot;</span>
<span class="line-removed">162       WARNINGS_ENABLE_ALL_CXXFLAGS=&quot;+w +w2&quot;</span>
<span class="line-removed">163 </span>
<span class="line-removed">164       DISABLED_WARNINGS_C=&quot;E_OLD_STYLE_FUNC_DECL E_OLD_STYLE_FUNC_DEF E_SEMANTICS_OF_OP_CHG_IN_ANSI_C E_NO_REPLACEMENT_IN_STRING E_DECLARATION_IN_CODE&quot;</span>
<span class="line-removed">165       DISABLED_WARNINGS_CXX=&quot;inllargeuse inllargeint notused wemptydecl notemsource&quot;</span>
<span class="line-removed">166       ;;</span>
<span class="line-removed">167 </span>
168     gcc)
169       DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
170       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-Werror&quot;
171 
172       # Additional warnings that are not activated by -Wall and -Wextra
173       WARNINGS_ENABLE_ADDITIONAL=&quot;-Wpointer-arith -Wsign-compare \
174           -Wunused-function -Wundef -Wunused-value -Wreturn-type \
175           -Wtrampolines&quot;
176       WARNINGS_ENABLE_ADDITIONAL_CXX=&quot;-Woverloaded-virtual -Wreorder&quot;
177       WARNINGS_ENABLE_ALL_CFLAGS=&quot;-Wall -Wextra -Wformat=2 $WARNINGS_ENABLE_ADDITIONAL&quot;
178       WARNINGS_ENABLE_ALL_CXXFLAGS=&quot;$WARNINGS_ENABLE_ALL_CFLAGS $WARNINGS_ENABLE_ADDITIONAL_CXX&quot;
179 
180       DISABLED_WARNINGS=&quot;unused-parameter unused&quot;
181       BUILD_CC_DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
182       ;;
183 
184     clang)
185       DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
186       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-Werror&quot;
187 
</pre>
<hr />
<pre>
227     fastdebug )
228       # no adjustment
229       ;;
230     slowdebug )
231       # FIXME: By adding this to C(XX)FLAGS_DEBUG_OPTIONS/JVM_CFLAGS_SYMBOLS it
232       # get&#39;s added conditionally on whether we produce debug symbols or not.
233       # This is most likely not really correct.
234 
235       # Add runtime stack smashing and undefined behavior checks.
236       CFLAGS_DEBUG_OPTIONS=&quot;-fstack-protector-all --param ssp-buffer-size=1&quot;
237       CXXFLAGS_DEBUG_OPTIONS=&quot;-fstack-protector-all --param ssp-buffer-size=1&quot;
238 
239       JVM_CFLAGS_SYMBOLS=&quot;$JVM_CFLAGS_SYMBOLS -fstack-protector-all --param ssp-buffer-size=1&quot;
240       ;;
241     esac
242   fi
243 ])
244 
245 AC_DEFUN([FLAGS_SETUP_OPTIMIZATION],
246 [
<span class="line-modified">247   if test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed">248     CC_HIGHEST=&quot;-fns -fsimple -fsingle -xbuiltin=%all -xdepend -xrestrict -xlibmil&quot;</span>
<span class="line-removed">249 </span>
<span class="line-removed">250     C_O_FLAG_HIGHEST_JVM=&quot;-xO4&quot;</span>
<span class="line-removed">251     C_O_FLAG_DEBUG_JVM=&quot;&quot;</span>
<span class="line-removed">252     C_O_FLAG_SIZE=&quot;&quot;</span>
<span class="line-removed">253     C_O_FLAG_DEBUG=&quot;&quot;</span>
<span class="line-removed">254     C_O_FLAG_NONE=&quot;&quot;</span>
<span class="line-removed">255     if test &quot;x$OPENJDK_TARGET_CPU_ARCH&quot; = &quot;xx86&quot;; then</span>
<span class="line-removed">256       C_O_FLAG_HIGHEST=&quot;-xO4 -Wu,-O4~yz $CC_HIGHEST&quot;</span>
<span class="line-removed">257       C_O_FLAG_HI=&quot;-xO4 -Wu,-O4~yz&quot;</span>
<span class="line-removed">258       C_O_FLAG_NORM=&quot;-xO2 -Wu,-O2~yz&quot;</span>
<span class="line-removed">259     elif test &quot;x$OPENJDK_TARGET_CPU_ARCH&quot; = &quot;xsparc&quot;; then</span>
<span class="line-removed">260       C_O_FLAG_HIGHEST=&quot;-xO4 -Wc,-Qrm-s -Wc,-Qiselect-T0 \</span>
<span class="line-removed">261           -xprefetch=auto,explicit $CC_HIGHEST&quot;</span>
<span class="line-removed">262       C_O_FLAG_HI=&quot;-xO4 -Wc,-Qrm-s -Wc,-Qiselect-T0&quot;</span>
<span class="line-removed">263       C_O_FLAG_NORM=&quot;-xO2 -Wc,-Qrm-s -Wc,-Qiselect-T0&quot;</span>
<span class="line-removed">264     fi</span>
<span class="line-removed">265   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then</span>
266     C_O_FLAG_HIGHEST_JVM=&quot;-O3&quot;
267     C_O_FLAG_HIGHEST=&quot;-O3&quot;
268     C_O_FLAG_HI=&quot;-O3&quot;
269     C_O_FLAG_NORM=&quot;-O2&quot;
270     C_O_FLAG_SIZE=&quot;-Os&quot;
271     C_O_FLAG_DEBUG=&quot;-O0&quot;
272     C_O_FLAG_DEBUG_JVM=&quot;-O0&quot;
273     C_O_FLAG_NONE=&quot;-O0&quot;
274     # -D_FORTIFY_SOURCE=2 hardening option needs optimization (at least -O1) enabled
275     # set for lower O-levels -U_FORTIFY_SOURCE to overwrite previous settings
276     if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux -a &quot;x$DEBUG_LEVEL&quot; = &quot;xfastdebug&quot;; then
277       ENABLE_FORTIFY_CFLAGS=&quot;-D_FORTIFY_SOURCE=2&quot;
278       DISABLE_FORTIFY_CFLAGS=&quot;-U_FORTIFY_SOURCE&quot;
279       C_O_FLAG_HIGHEST_JVM=&quot;${C_O_FLAG_HIGHEST_JVM} ${ENABLE_FORTIFY_CFLAGS}&quot;
280       C_O_FLAG_HIGHEST=&quot;${C_O_FLAG_HIGHEST} ${ENABLE_FORTIFY_CFLAGS}&quot;
281       C_O_FLAG_HI=&quot;${C_O_FLAG_HI} ${ENABLE_FORTIFY_CFLAGS}&quot;
282       C_O_FLAG_NORM=&quot;${C_O_FLAG_NORM} ${ENABLE_FORTIFY_CFLAGS}&quot;
283       C_O_FLAG_SIZE=&quot;${C_O_FLAG_SIZE} ${DISABLE_FORTIFY_CFLAGS}&quot;
284       C_O_FLAG_DEBUG=&quot;${C_O_FLAG_DEBUG} ${DISABLE_FORTIFY_CFLAGS}&quot;
285       C_O_FLAG_DEBUG_JVM=&quot;${C_O_FLAG_DEBUG_JVM} ${DISABLE_FORTIFY_CFLAGS}&quot;
</pre>
<hr />
<pre>
317     C_O_FLAG_HIGHEST_JVM=&quot;-O2 -Oy-&quot;
318     C_O_FLAG_HIGHEST=&quot;-O2&quot;
319     C_O_FLAG_HI=&quot;-O1&quot;
320     C_O_FLAG_NORM=&quot;-O1&quot;
321     C_O_FLAG_DEBUG=&quot;-Od&quot;
322     C_O_FLAG_DEBUG_JVM=&quot;&quot;
323     C_O_FLAG_NONE=&quot;-Od&quot;
324     C_O_FLAG_SIZE=&quot;-Os&quot;
325   fi
326 
327   # Now copy to C++ flags
328   CXX_O_FLAG_HIGHEST_JVM=&quot;$C_O_FLAG_HIGHEST_JVM&quot;
329   CXX_O_FLAG_HIGHEST=&quot;$C_O_FLAG_HIGHEST&quot;
330   CXX_O_FLAG_HI=&quot;$C_O_FLAG_HI&quot;
331   CXX_O_FLAG_NORM=&quot;$C_O_FLAG_NORM&quot;
332   CXX_O_FLAG_DEBUG=&quot;$C_O_FLAG_DEBUG&quot;
333   CXX_O_FLAG_DEBUG_JVM=&quot;$C_O_FLAG_DEBUG_JVM&quot;
334   CXX_O_FLAG_NONE=&quot;$C_O_FLAG_NONE&quot;
335   CXX_O_FLAG_SIZE=&quot;$C_O_FLAG_SIZE&quot;
336 
<span class="line-removed">337   if test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed">338     # In solstudio, also add this to C (but not C++) flags...</span>
<span class="line-removed">339     C_O_FLAG_HIGHEST=&quot;$C_O_FLAG_HIGHEST -xalias_level=basic&quot;</span>
<span class="line-removed">340   fi</span>
<span class="line-removed">341 </span>
342   # Adjust optimization flags according to debug level.
343   case $DEBUG_LEVEL in
344     release )
345       # no adjustment
346       ;;
347     fastdebug )
348       # Not quite so much optimization
349       C_O_FLAG_HI=&quot;$C_O_FLAG_NORM&quot;
350       CXX_O_FLAG_HI=&quot;$CXX_O_FLAG_NORM&quot;
351       ;;
352     slowdebug )
353       # Disable optimization
354       C_O_FLAG_HIGHEST_JVM=&quot;$C_O_FLAG_DEBUG_JVM&quot;
355       C_O_FLAG_HIGHEST=&quot;$C_O_FLAG_DEBUG&quot;
356       C_O_FLAG_HI=&quot;$C_O_FLAG_DEBUG&quot;
357       C_O_FLAG_NORM=&quot;$C_O_FLAG_DEBUG&quot;
358       C_O_FLAG_SIZE=&quot;$C_O_FLAG_DEBUG&quot;
359       CXX_O_FLAG_HIGHEST_JVM=&quot;$CXX_O_FLAG_DEBUG_JVM&quot;
360       CXX_O_FLAG_HIGHEST=&quot;$CXX_O_FLAG_DEBUG&quot;
361       CXX_O_FLAG_HI=&quot;$CXX_O_FLAG_DEBUG&quot;
</pre>
<hr />
<pre>
414   FLAGS_CPU_ENDIAN=$OPENJDK_BUILD_CPU_ENDIAN
415   FLAGS_CPU_LEGACY=$OPENJDK_BUILD_CPU_LEGACY
416   FLAGS_CPU_LEGACY_LIB=$OPENJDK_BUILD_CPU_LEGACY_LIB
417 
418   FLAGS_SETUP_CFLAGS_CPU_DEP([BUILD], [OPENJDK_BUILD_], [BUILD_])
419 
420   CC=&quot;$CC_OLD&quot;
421   CXX=&quot;$CXX_OLD&quot;
422   CFLAGS=&quot;$CFLAGS_OLD&quot;
423   CXXFLAGS=&quot;$CXXFLAGS_OLD&quot;
424 ])
425 
426 ################################################################################
427 # platform independent
428 AC_DEFUN([FLAGS_SETUP_CFLAGS_HELPER],
429 [
430   #### OS DEFINES, these should be independent on toolchain
431   if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
432     CFLAGS_OS_DEF_JVM=&quot;-DLINUX&quot;
433     CFLAGS_OS_DEF_JDK=&quot;-D_GNU_SOURCE -D_REENTRANT -D_LARGEFILE64_SOURCE&quot;
<span class="line-removed">434   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris; then</span>
<span class="line-removed">435     CFLAGS_OS_DEF_JVM=&quot;-DSOLARIS&quot;</span>
<span class="line-removed">436     CFLAGS_OS_DEF_JDK=&quot;-D__solaris__&quot;</span>
437   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
438     CFLAGS_OS_DEF_JVM=&quot;-D_ALLBSD_SOURCE -D_DARWIN_C_SOURCE -D_XOPEN_SOURCE&quot;
439     CFLAGS_OS_DEF_JDK=&quot;-D_ALLBSD_SOURCE -D_DARWIN_UNLIMITED_SELECT&quot;
440   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xios; then
441     CFLAGS_OS_DEF_JDK=&quot;-DMACOSX -D_ALLBSD_SOURCE -DTARGET_IOS -D_DARWIN_UNLIMITED_SELECT&quot;
442   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xandroid; then
443     CFLAGS_OS_DEF_JDK=&quot;-target aarch64-linux-android -D__USE_BSD&quot;
444   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
445     CFLAGS_OS_DEF_JVM=&quot;-DAIX&quot;
446   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xbsd; then
447     CFLAGS_OS_DEF_JDK=&quot;-D_ALLBSD_SOURCE&quot;
448   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xwindows; then
449     CFLAGS_OS_DEF_JVM=&quot;-D_WINDOWS -DWIN32 -D_JNI_IMPLEMENTATION_&quot;
450   fi
451 
452   CFLAGS_OS_DEF_JDK=&quot;$CFLAGS_OS_DEF_JDK -D$OPENJDK_TARGET_OS_UPPERCASE&quot;
453 
454   #### GLOBAL DEFINES
455   # Set some common defines. These works for all compilers, but assume
456   # -D is universally accepted.
</pre>
<hr />
<pre>
459   ALWAYS_CFLAGS_JVM=&quot;-D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -D__STDC_CONSTANT_MACROS&quot;
460 
461   # Setup some hard coded includes
462   ALWAYS_CFLAGS_JDK=&quot; \
463       -I\$(SUPPORT_OUTPUTDIR)/modules_include/java.base \
464       -I\$(SUPPORT_OUTPUTDIR)/modules_include/java.base/\$(OPENJDK_TARGET_OS_INCLUDE_SUBDIR) \
465       -I${TOPDIR}/src/java.base/share/native/libjava \
466       -I${TOPDIR}/src/java.base/$OPENJDK_TARGET_OS_TYPE/native/libjava \
467       -I${TOPDIR}/src/hotspot/share/include \
468       -I${TOPDIR}/src/hotspot/os/${HOTSPOT_TARGET_OS_TYPE}/include&quot;
469 
470   if test &quot;x$OPENJDK_TARGET_OS&quot; = xios; then
471     ALWAYS_CFLAGS_JDK=&quot;$ALWAYS_CFLAGS_JDK -I${TOPDIR}/src/java.base/macosx/native/libjava&quot;
472   fi
473   ###############################################################################
474 
475   # Adjust flags according to debug level.
476   # Setup debug/release defines
477   if test &quot;x$DEBUG_LEVEL&quot; = xrelease; then
478     DEBUG_CFLAGS_JDK=&quot;-DNDEBUG&quot;
<span class="line-removed">479     if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris; then</span>
<span class="line-removed">480       DEBUG_CFLAGS_JDK=&quot;$DEBUG_CFLAGS_JDK -DTRIMMED&quot;</span>
<span class="line-removed">481     fi</span>
482   else
483     DEBUG_CFLAGS_JDK=&quot;-DDEBUG&quot;
484 
485     if test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
486       # We need &#39;-qminimaltoc&#39; or &#39;-qpic=large -bbigtoc&#39; if the TOC overflows.
487       # Hotspot now overflows its 64K TOC (currently only for debug),
488       # so for debug we build with &#39;-qpic=large -bbigtoc&#39;.
489       DEBUG_CFLAGS_JVM=&quot;-qpic=large&quot;
490     fi
491   fi
492 
493   if test &quot;x$DEBUG_LEVEL&quot; != xrelease; then
494     DEBUG_OPTIONS_FLAGS_JDK=&quot;$CFLAGS_DEBUG_OPTIONS&quot;
495     DEBUG_SYMBOLS_CFLAGS_JDK=&quot;$CFLAGS_DEBUG_SYMBOLS&quot;
496   fi
497 
498   #### TOOLCHAIN DEFINES
499 
500   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
501     ALWAYS_DEFINES_JVM=&quot;-D_GNU_SOURCE -D_REENTRANT&quot;
502   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
503     ALWAYS_DEFINES_JVM=&quot;-D_GNU_SOURCE&quot;
<span class="line-removed">504   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed">505     ALWAYS_DEFINES_JVM=&quot;-DSPARC_WORKS -D_Crun_inline_placement&quot;</span>
<span class="line-removed">506     ALWAYS_DEFINES_JDK=&quot;-DTRACING -DMACRO_MEMSYS_OPS -DBREAKPTS&quot;</span>
<span class="line-removed">507     ALWAYS_DEFINES_JDK_CXXONLY=&quot;-DCC_NOEX&quot;</span>
508   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
509     ALWAYS_DEFINES_JVM=&quot;-D_REENTRANT&quot;
510     ALWAYS_DEFINES_JDK=&quot;-D_GNU_SOURCE -D_REENTRANT -D_LARGEFILE64_SOURCE -DSTDC&quot;
511   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
512     ALWAYS_DEFINES_JDK=&quot;-DWIN32_LEAN_AND_MEAN -D_CRT_SECURE_NO_DEPRECATE \
513         -D_CRT_NONSTDC_NO_DEPRECATE -DWIN32 -DIAL&quot;
514     ALWAYS_DEFINES_JVM=&quot;-DNOMINMAX -DWIN32_LEAN_AND_MEAN&quot;
515   fi
516 
517   ###############################################################################
518   #
519   #
520   # CFLAGS BASIC
521   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
522     # COMMON to gcc and clang
523     TOOLCHAIN_CFLAGS_JVM=&quot;-pipe -fno-rtti -fno-exceptions \
524         -fvisibility=hidden -fno-strict-aliasing -fno-omit-frame-pointer&quot;
525   fi
526 
527   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
</pre>
<hr />
<pre>
544     # too big object files and speed the build up a little bit
545     # (see http://llvm.org/bugs/show_bug.cgi?id=7554)
546     TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -flimit-debug-info&quot;
547 
548     # In principle the stack alignment below is cpu- and ABI-dependent and
549     # should agree with values of StackAlignmentInBytes in various
550     # src/hotspot/cpu/*/globalDefinitions_*.hpp files, but this value currently
551     # works for all platforms.
552     TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -mno-omit-leaf-frame-pointer -mstack-alignment=16&quot;
553 
554     if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
555       if test &quot;x$DEBUG_LEVEL&quot; = xrelease; then
556         # Clang does not inline as much as GCC does for functions with &quot;inline&quot; keyword by default.
557         # This causes noticeable slowdown in pause time for G1, and possibly in other areas.
558         # Increasing the inline hint threshold avoids the slowdown for Clang-built JVM.
559         TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -mllvm -inlinehint-threshold=100000&quot;
560       fi
561       TOOLCHAIN_CFLAGS_JDK=&quot;-pipe&quot;
562       TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;-fno-strict-aliasing&quot; # technically NOT for CXX
563     fi
<span class="line-removed">564   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed">565     TOOLCHAIN_FLAGS=&quot;-errtags -errfmt&quot;</span>
<span class="line-removed">566     TOOLCHAIN_CFLAGS=&quot;-errshort=tags&quot;</span>
<span class="line-removed">567 </span>
<span class="line-removed">568     TOOLCHAIN_CFLAGS_JDK=&quot;-mt $TOOLCHAIN_FLAGS&quot;</span>
<span class="line-removed">569     TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;-W0,-noglobal $TOOLCHAIN_CFLAGS&quot; # C only</span>
<span class="line-removed">570     TOOLCHAIN_CFLAGS_JDK_CXXONLY=&quot;-features=no%except -norunpath -xnolib&quot; # CXX only</span>
<span class="line-removed">571     TOOLCHAIN_CFLAGS_JVM=&quot;-template=no%extdef -features=no%split_init \</span>
<span class="line-removed">572         -library=stlport4 -mt -features=no%except $TOOLCHAIN_FLAGS&quot;</span>
<span class="line-removed">573     if test &quot;x$DEBUG_LEVEL&quot; = xslowdebug; then</span>
<span class="line-removed">574       # Previously -g was used instead of -g0 for slowdebug; this is equivalent</span>
<span class="line-removed">575       # to setting +d.</span>
<span class="line-removed">576       TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM +d&quot;</span>
<span class="line-removed">577     fi</span>
578 
579   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
580     # Suggested additions: -qsrcmsg to get improved error reporting
581     # set -qtbtable=full for a better traceback table/better stacks in hs_err when xlc16 is used
582     TOOLCHAIN_CFLAGS_JDK=&quot;-qtbtable=full -qchars=signed -qfullpath -qsaveopt -qstackprotect&quot;  # add on both CFLAGS
583     TOOLCHAIN_CFLAGS_JVM=&quot;-qtbtable=full -qtune=balanced \
584         -qalias=noansi -qstrict -qtls=default -qnortti -qnoeh -qignerrno -qstackprotect&quot;
585   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
586     TOOLCHAIN_CFLAGS_JVM=&quot;-nologo -MD -MP&quot;
587     TOOLCHAIN_CFLAGS_JDK=&quot;-nologo -MD -Zc:wchar_t-&quot;
588   fi
589 
590   # CFLAGS C language level for JDK sources (hotspot only uses C++)
591   # Ideally we would have a common level across all toolchains so that all sources
592   # are sure to conform to the same standard. Unfortunately neither our sources nor
593   # our toolchains are in a condition to support that. But what we loosely aim for is
594   # C99 level.
595   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang || test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
596     # Explicitly set C99. clang and xlclang support the same flag.
597     LANGSTD_CFLAGS=&quot;-std=c99&quot;
<span class="line-removed">598   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed">599     # We can&#39;t turn on -std=c99 without breaking compilation of the splashscreen/png</span>
<span class="line-removed">600     # utilities. But we can enable c99 as below (previously achieved by using -Xa).</span>
<span class="line-removed">601     # It is the no_lib that makes the difference.</span>
<span class="line-removed">602     LANGSTD_CFLAGS=&quot;-xc99=all,no_lib&quot;</span>
603   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
604     # MSVC doesn&#39;t support C99/C11 explicitly, unless you compile as C++:
605     # LANGSTD_CFLAGS=&quot;-TP&quot;
606     # but that requires numerous changes to the sources files. So we are limited
607     # to C89/C90 plus whatever extensions Visual Studio has decided to implement.
608     # This is the lowest bar for shared code.
609     LANGSTD_CFLAGS=&quot;&quot;
610   fi
611   TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;$LANGSTD_CFLAGS $TOOLCHAIN_CFLAGS_JDK_CONLY&quot;
612 
613   # CFLAGS WARNINGS STUFF
614   # Set JVM_CFLAGS warning handling
615   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
616     WARNING_CFLAGS_JDK_CONLY=&quot;$WARNINGS_ENABLE_ALL_CFLAGS&quot;
617     WARNING_CFLAGS_JDK_CXXONLY=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;
618     WARNING_CFLAGS_JVM=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;
619 
620   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
621     WARNING_CFLAGS=&quot;$WARNINGS_ENABLE_ALL&quot;
622 
<span class="line-removed">623   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed">624     WARNING_CFLAGS_JDK_CONLY=&quot;$WARNINGS_ENABLE_ALL_CFLAGS&quot;</span>
<span class="line-removed">625     WARNING_CFLAGS_JDK_CXXONLY=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;</span>
<span class="line-removed">626     WARNING_CFLAGS_JVM=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;</span>
<span class="line-removed">627 </span>
628   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
629     WARNING_CFLAGS=&quot;$WARNINGS_ENABLE_ALL&quot;
630 
631   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
632     WARNING_CFLAGS=&quot;&quot;  # currently left empty
633   fi
634 
635   # Set some additional per-OS defines.
636 
637   # Additional macosx handling
638   if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
639     OS_CFLAGS=&quot;-DMAC_OS_X_VERSION_MIN_REQUIRED=$MACOSX_VERSION_MIN_NODOTS \
640         -mmacosx-version-min=$MACOSX_VERSION_MIN&quot;
641 
642     if test -n &quot;$MACOSX_VERSION_MAX&quot;; then
643         OS_CFLAGS=&quot;$OS_CFLAGS \
644             -DMAC_OS_X_VERSION_MAX_ALLOWED=$MACOSX_VERSION_MAX_NODOTS&quot;
645     fi
646   fi
647 
648   # Where does this really belong??
649   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
650     PICFLAG=&quot;-fPIC&quot;
651     PIEFLAG=&quot;-fPIE&quot;
<span class="line-removed">652   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed">653     PICFLAG=&quot;-KPIC&quot;</span>
654   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
655     # &#39;-qpic&#39; defaults to &#39;qpic=small&#39;. This means that the compiler generates only
656     # one instruction for accessing the TOC. If the TOC grows larger than 64K, the linker
657     # will have to patch this single instruction with a call to some out-of-order code which
658     # does the load from the TOC. This is of course slower, and we also would have
659     # to use &#39;-bbigtoc&#39; for linking anyway so we could also change the PICFLAG to &#39;qpic=large&#39;.
660     # With &#39;qpic=large&#39; the compiler will by default generate a two-instruction sequence which
661     # can be patched directly by the linker and does not require a jump to out-of-order code.
662     #
663     # Since large TOC causes perf. overhead, only pay it where we must. Currently this is
664     # for all libjvm variants (both gtest and normal) but no other binaries. So, build
665     # libjvm with -qpic=large and link with -bbigtoc.
666     JVM_PICFLAG=&quot;-qpic=large&quot;
667     JDK_PICFLAG=&quot;-qpic&quot;
668   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
669     PICFLAG=&quot;&quot;
670   fi
671 
672   if test &quot;x$TOOLCHAIN_TYPE&quot; != xxlc; then
673     JVM_PICFLAG=&quot;$PICFLAG&quot;
</pre>
<hr />
<pre>
715     RELAX_RELOCATIONS_FLAG=&quot;-Xassembler -mrelax-relocations=no&quot;
716     FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${RELAX_RELOCATIONS_FLAG}],
717         IF_TRUE: [STATIC_LIBS_CFLAGS=&quot;$STATIC_LIBS_CFLAGS ${RELAX_RELOCATIONS_FLAG}&quot;])
718   fi
719   AC_SUBST(STATIC_LIBS_CFLAGS)
720 ])
721 
722 ################################################################################
723 # $1 - Either BUILD or TARGET to pick the correct OS/CPU variables to check
724 #      conditionals against.
725 # $2 - Optional prefix for each variable defined.
726 # $3 - Optional prefix for compiler variables (either BUILD_ or nothing).
727 AC_DEFUN([FLAGS_SETUP_CFLAGS_CPU_DEP],
728 [
729   #### CPU DEFINES, these should (in theory) be independent on toolchain
730 
731   # Setup target CPU
732   # Setup endianness
733   if test &quot;x$FLAGS_CPU_ENDIAN&quot; = xlittle; then
734     $1_DEFINES_CPU_JVM=&quot;-DVM_LITTLE_ENDIAN&quot;
<span class="line-modified">735   fi</span>
<span class="line-removed">736   if test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed">737     # The macro _LITTLE_ENDIAN needs to be defined the same to avoid the</span>
<span class="line-removed">738     #   Sun C compiler warning message: warning: macro redefined: _LITTLE_ENDIAN</span>
<span class="line-removed">739     if test &quot;x$FLAGS_CPU_ENDIAN&quot; = xlittle; then</span>
<span class="line-removed">740       $1_DEFINES_CPU_JDK=&quot;-D_LITTLE_ENDIAN=&quot;</span>
<span class="line-removed">741     else</span>
<span class="line-removed">742       $1_DEFINES_CPU_JDK=&quot;-D_BIG_ENDIAN=&quot;</span>
<span class="line-removed">743     fi</span>
744   else
<span class="line-modified">745     if test &quot;x$FLAGS_CPU_ENDIAN&quot; = xlittle; then</span>
<span class="line-removed">746       $1_DEFINES_CPU_JDK=&quot;-D_LITTLE_ENDIAN&quot;</span>
<span class="line-removed">747     else</span>
<span class="line-removed">748       $1_DEFINES_CPU_JDK=&quot;-D_BIG_ENDIAN&quot;</span>
<span class="line-removed">749     fi</span>
750   fi
751 
752   # setup CPU bit size
753   $1_DEFINES_CPU_JDK=&quot;${$1_DEFINES_CPU_JDK} -DARCH=&#39;\&quot;$FLAGS_CPU_LEGACY\&quot;&#39; \
754       -D$FLAGS_CPU_LEGACY&quot;
755 
756   if test &quot;x$FLAGS_CPU_BITS&quot; = x64; then
757     # -D_LP64=1 is only set on linux and mac. Setting on windows causes diff in
758     # unpack200.exe.
759     if test &quot;x$FLAGS_OS&quot; = xlinux || test &quot;x$FLAGS_OS&quot; = xmacosx; then
760       $1_DEFINES_CPU_JDK=&quot;${$1_DEFINES_CPU_JDK} -D_LP64=1&quot;
761     fi
<span class="line-modified">762     if test &quot;x$FLAGS_OS&quot; != xsolaris &amp;&amp; test &quot;x$FLAGS_OS&quot; != xaix; then</span>
<span class="line-removed">763       # Solaris does not have _LP64=1 in the old build.</span>
764       # xlc on AIX defines _LP64=1 by default and issues a warning if we redefine it.
765       $1_DEFINES_CPU_JVM=&quot;${$1_DEFINES_CPU_JVM} -D_LP64=1&quot;
766     fi
767   fi
768 
769   # toolchain dependend, per-cpu
<span class="line-modified">770   if test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed">771     if test &quot;x$FLAGS_CPU_ARCH&quot; = xx86; then</span>
<span class="line-removed">772       $1_DEFINES_CPU_JDK=&quot;${$1_DEFINES_CPU_JDK} -DcpuIntel -Di586 -D$FLAGS_CPU_LEGACY_LIB&quot;</span>
<span class="line-removed">773     fi</span>
<span class="line-removed">774   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then</span>
775     if test &quot;x$FLAGS_CPU&quot; = xx86_64; then
776       $1_DEFINES_CPU_JDK=&quot;${$1_DEFINES_CPU_JDK} -D_AMD64_ -Damd64&quot;
777     else
778       $1_DEFINES_CPU_JDK=&quot;${$1_DEFINES_CPU_JDK} -D_X86_ -Dx86&quot;
779     fi
780   fi
781 
782   # CFLAGS PER CPU
783   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
784     # COMMON to gcc and clang
785     if test &quot;x$FLAGS_CPU&quot; = xx86; then
786       # Force compatibility with i586 on 32 bit intel platforms.
787       $1_CFLAGS_CPU=&quot;-march=i586&quot;
788     fi
789   fi
790 
791   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
792     if test &quot;x$FLAGS_CPU&quot; = xaarch64; then
793       # -Wno-psabi to get rid of annoying &quot;note: parameter passing for argument of type &#39;&lt;type&gt; changed in GCC 9.1&quot;
794       $1_CFLAGS_CPU=&quot;-Wno-psabi&quot;
</pre>
<hr />
<pre>
815       # for all archs except arm and ppc, prevent gcc to omit frame pointer
816       $1_CFLAGS_CPU_JDK=&quot;${$1_CFLAGS_CPU_JDK} -fno-omit-frame-pointer&quot;
817     fi
818 
819     $1_CXXSTD_CXXFLAG=&quot;-std=gnu++98&quot;
820     FLAGS_CXX_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${$1_CXXSTD_CXXFLAG}],
821         PREFIX: $3, IF_FALSE: [$1_CXXSTD_CXXFLAG=&quot;&quot;])
822     $1_TOOLCHAIN_CFLAGS_JDK_CXXONLY=&quot;${$1_CXXSTD_CXXFLAG}&quot;
823     $1_TOOLCHAIN_CFLAGS_JVM=&quot;${$1_TOOLCHAIN_CFLAGS_JVM} ${$1_CXXSTD_CXXFLAG}&quot;
824     $2ADLC_CXXFLAG=&quot;${$1_CXXSTD_CXXFLAG}&quot;
825 
826   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
827     if test &quot;x$FLAGS_OS&quot; = xlinux; then
828       # ppc test not really needed for clang
829       if test &quot;x$FLAGS_CPU_ARCH&quot; != xarm &amp;&amp;  test &quot;x$FLAGS_CPU_ARCH&quot; != xppc; then
830         # for all archs except arm and ppc, prevent gcc to omit frame pointer
831         $1_CFLAGS_CPU_JDK=&quot;${$1_CFLAGS_CPU_JDK} -fno-omit-frame-pointer&quot;
832       fi
833     fi
834 
<span class="line-removed">835   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed">836     if test &quot;x$FLAGS_CPU&quot; = xx86_64; then</span>
<span class="line-removed">837       # NOTE: -xregs=no%frameptr is supposed to be default on x64</span>
<span class="line-removed">838       $1_CFLAGS_CPU_JDK=&quot;-xregs=no%frameptr&quot;</span>
<span class="line-removed">839     elif test &quot;x$FLAGS_CPU&quot; = xsparcv9; then</span>
<span class="line-removed">840       $1_CFLAGS_CPU_JVM=&quot;-xarch=sparc&quot;</span>
<span class="line-removed">841       $1_CFLAGS_CPU_JDK_LIBONLY=&quot;-xregs=no%appl&quot;</span>
<span class="line-removed">842     fi</span>
<span class="line-removed">843 </span>
844   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
845     if test &quot;x$FLAGS_CPU&quot; = xppc64; then
846       $1_CFLAGS_CPU_JVM=&quot;-qarch=ppc64&quot;
847     fi
848 
849   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
850     if test &quot;x$FLAGS_CPU&quot; = xx86; then
851       $1_CFLAGS_CPU_JVM=&quot;-arch:IA32&quot;
852     elif test &quot;x$OPENJDK_TARGET_CPU&quot; = xx86_64; then
853       if test &quot;x$DEBUG_LEVEL&quot; != xrelease; then
854         # NOTE: This is probably redundant; -homeparams is default on
855         # non-release builds.
856         $1_CFLAGS_CPU_JVM=&quot;-homeparams&quot;
857       fi
858     fi
859   fi
860 
861   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
862     FLAGS_SETUP_GCC6_COMPILER_FLAGS($1, $3)
863     $1_TOOLCHAIN_CFLAGS=&quot;${$1_GCC6_CFLAGS}&quot;
</pre>
<hr />
<pre>
945 ])
946 
947 # FLAGS_SETUP_GCC6_COMPILER_FLAGS([PREFIX])
948 # Arguments:
949 # $1 - Prefix for each variable defined.
950 # $2 - Prefix for compiler variables (either BUILD_ or nothing).
951 AC_DEFUN([FLAGS_SETUP_GCC6_COMPILER_FLAGS],
952 [
953   # These flags are required for GCC 6 builds as undefined behaviour in OpenJDK code
954   # runs afoul of the more aggressive versions of these optimisations.
955   # Notably, value range propagation now assumes that the this pointer of C++
956   # member functions is non-null.
957   NO_DELETE_NULL_POINTER_CHECKS_CFLAG=&quot;-fno-delete-null-pointer-checks&quot;
958   FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [$NO_DELETE_NULL_POINTER_CHECKS_CFLAG],
959       PREFIX: $2, IF_FALSE: [NO_DELETE_NULL_POINTER_CHECKS_CFLAG=&quot;&quot;])
960   NO_LIFETIME_DSE_CFLAG=&quot;-fno-lifetime-dse&quot;
961   FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [$NO_LIFETIME_DSE_CFLAG],
962       PREFIX: $2, IF_FALSE: [NO_LIFETIME_DSE_CFLAG=&quot;&quot;])
963   $1_GCC6_CFLAGS=&quot;${NO_DELETE_NULL_POINTER_CHECKS_CFLAG} ${NO_LIFETIME_DSE_CFLAG}&quot;
964 ])
<span class="line-removed">965 </span>
<span class="line-removed">966 # Documentation on common flags used for solstudio in HIGHEST.</span>
<span class="line-removed">967 #</span>
<span class="line-removed">968 # WARNING: Use of OPTIMIZATION_LEVEL=HIGHEST in your Makefile needs to be</span>
<span class="line-removed">969 #          done with care, there are some assumptions below that need to</span>
<span class="line-removed">970 #          be understood about the use of pointers, and IEEE behavior.</span>
<span class="line-removed">971 #</span>
<span class="line-removed">972 # -fns: Use non-standard floating point mode (not IEEE 754)</span>
<span class="line-removed">973 # -fsimple: Do some simplification of floating point arithmetic (not IEEE 754)</span>
<span class="line-removed">974 # -fsingle: Use single precision floating point with &#39;float&#39;</span>
<span class="line-removed">975 # -xalias_level=basic: Assume memory references via basic pointer types do not alias</span>
<span class="line-removed">976 #   (Source with excessing pointer casting and data access with mixed</span>
<span class="line-removed">977 #    pointer types are not recommended)</span>
<span class="line-removed">978 # -xbuiltin=%all: Use intrinsic or inline versions for math/std functions</span>
<span class="line-removed">979 #   (If you expect perfect errno behavior, do not use this)</span>
<span class="line-removed">980 # -xdepend: Loop data dependency optimizations (need -xO3 or higher)</span>
<span class="line-removed">981 # -xrestrict: Pointer parameters to functions do not overlap</span>
<span class="line-removed">982 #   (Similar to -xalias_level=basic usage, but less obvious sometimes.</span>
<span class="line-removed">983 #    If you pass in multiple pointers to the same data, do not use this)</span>
<span class="line-removed">984 # -xlibmil: Inline some library routines</span>
<span class="line-removed">985 #   (If you expect perfect errno behavior, do not use this)</span>
<span class="line-removed">986 # -xlibmopt: Use optimized math routines (CURRENTLY DISABLED)</span>
<span class="line-removed">987 #   (If you expect perfect errno behavior, do not use this)</span>
<span class="line-removed">988 #  Can cause undefined external on Solaris 8 X86 on __sincos, removing for now</span>
</pre>
</td>
<td>
<hr />
<pre>
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 ################################################################################
 27 #
 28 # Setup flags for C/C++ compiler
 29 #
 30 
 31 ###############################################################################
 32 #
 33 # How to compile shared libraries.
 34 #
 35 AC_DEFUN([FLAGS_SETUP_SHARED_LIBS],
 36 [
 37   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then


 38     # Default works for linux, might work on other platforms as well.
 39     SHARED_LIBRARY_FLAGS=&#39;-shared&#39;
 40     SET_EXECUTABLE_ORIGIN=&#39;-Wl,-rpath,\$$ORIGIN[$]1&#39;
 41     SET_SHARED_LIBRARY_ORIGIN=&quot;-Wl,-z,origin $SET_EXECUTABLE_ORIGIN&quot;
 42     SET_SHARED_LIBRARY_NAME=&#39;-Wl,-soname=[$]1&#39;
 43     SET_SHARED_LIBRARY_MAPFILE=&#39;-Wl,-version-script=[$]1&#39;
 44 
 45   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then


 46     if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
 47       # Linking is different on MacOSX
 48       SHARED_LIBRARY_FLAGS=&quot;-dynamiclib -compatibility_version 1.0.0 -current_version 1.0.0&quot;
 49       SET_EXECUTABLE_ORIGIN=&#39;-Wl,-rpath,@loader_path$(or [$]1,/.)&#39;
 50       SET_SHARED_LIBRARY_ORIGIN=&quot;$SET_EXECUTABLE_ORIGIN&quot;
 51       SET_SHARED_LIBRARY_NAME=&#39;-Wl,-install_name,@rpath/[$]1&#39;
 52       SET_SHARED_LIBRARY_MAPFILE=&#39;-Wl,-exported_symbols_list,[$]1&#39;
 53 
 54     else
 55       # Default works for linux, might work on other platforms as well.
 56       SHARED_LIBRARY_FLAGS=&#39;-shared&#39;
 57       SET_EXECUTABLE_ORIGIN=&#39;-Wl,-rpath,\$$ORIGIN[$]1&#39;
 58       SET_SHARED_LIBRARY_NAME=&#39;-Wl,-soname=[$]1&#39;
 59       SET_SHARED_LIBRARY_MAPFILE=&#39;-Wl,-version-script=[$]1&#39;
 60 
 61       # arm specific settings
 62       if test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xarm&quot;; then
 63         # &#39;-Wl,-z,origin&#39; isn&#39;t used on arm.
 64         SET_SHARED_LIBRARY_ORIGIN=&#39;-Wl,-rpath,\$$$$ORIGIN[$]1&#39;
 65       else
 66         SET_SHARED_LIBRARY_ORIGIN=&quot;-Wl,-z,origin $SET_EXECUTABLE_ORIGIN&quot;
 67       fi
 68     fi
 69 








 70   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then

 71     SHARED_LIBRARY_FLAGS=&quot;-qmkshrobj -bM:SRE -bnoentry&quot;
 72     SET_EXECUTABLE_ORIGIN=&quot;&quot;
 73     SET_SHARED_LIBRARY_ORIGIN=&#39;&#39;
 74     SET_SHARED_LIBRARY_NAME=&#39;&#39;
 75     SET_SHARED_LIBRARY_MAPFILE=&#39;&#39;
 76 
 77   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then

 78     SHARED_LIBRARY_FLAGS=&quot;-dll&quot;
 79     SET_EXECUTABLE_ORIGIN=&#39;&#39;
 80     SET_SHARED_LIBRARY_ORIGIN=&#39;&#39;
 81     SET_SHARED_LIBRARY_NAME=&#39;&#39;
 82     SET_SHARED_LIBRARY_MAPFILE=&#39;-def:[$]1&#39;
 83   fi
 84 

 85   AC_SUBST(SET_EXECUTABLE_ORIGIN)
 86   AC_SUBST(SET_SHARED_LIBRARY_ORIGIN)
 87   AC_SUBST(SET_SHARED_LIBRARY_NAME)
 88   AC_SUBST(SET_SHARED_LIBRARY_MAPFILE)
 89   AC_SUBST(SHARED_LIBRARY_FLAGS)
 90 ])
 91 
 92 AC_DEFUN([FLAGS_SETUP_DEBUG_SYMBOLS],
 93 [
 94   # By default don&#39;t set any specific assembler debug
 95   # info flags for toolchains unless we know they work.
 96   # See JDK-8207057.
 97   ASFLAGS_DEBUG_SYMBOLS=&quot;&quot;
 98   # Debug symbols
 99   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
100     CFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
101     ASFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
102   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
103     CFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
104     ASFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;



105   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
106     CFLAGS_DEBUG_SYMBOLS=&quot;-g1&quot;
107   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
108     CFLAGS_DEBUG_SYMBOLS=&quot;-Z7&quot;
109   fi
110 
111   AC_SUBST(CFLAGS_DEBUG_SYMBOLS)
112   AC_SUBST(ASFLAGS_DEBUG_SYMBOLS)
113 ])
114 
115 AC_DEFUN([FLAGS_SETUP_WARNINGS],
116 [
117   # Set default value.
118   if test &quot;x$TOOLCHAIN_TYPE&quot; != xxlc; then
119     WARNINGS_AS_ERRORS_DEFAULT=true
120   else
121     WARNINGS_AS_ERRORS_DEFAULT=false
122   fi
123 
124   UTIL_ARG_ENABLE(NAME: warnings-as-errors, DEFAULT: $WARNINGS_AS_ERRORS_DEFAULT,
125       RESULT: WARNINGS_AS_ERRORS,
126       DEFAULT_DESC: [auto],
127       DESC: [consider native warnings to be an error])
128   AC_SUBST(WARNINGS_AS_ERRORS)
129 
130   case &quot;${TOOLCHAIN_TYPE}&quot; in
131     microsoft)
132       DISABLE_WARNING_PREFIX=&quot;-wd&quot;
133       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-WX&quot;
134 
135       WARNINGS_ENABLE_ALL=&quot;-W3&quot;
136       DISABLED_WARNINGS=&quot;4800&quot;
137       ;;
138 











139     gcc)
140       DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
141       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-Werror&quot;
142 
143       # Additional warnings that are not activated by -Wall and -Wextra
144       WARNINGS_ENABLE_ADDITIONAL=&quot;-Wpointer-arith -Wsign-compare \
145           -Wunused-function -Wundef -Wunused-value -Wreturn-type \
146           -Wtrampolines&quot;
147       WARNINGS_ENABLE_ADDITIONAL_CXX=&quot;-Woverloaded-virtual -Wreorder&quot;
148       WARNINGS_ENABLE_ALL_CFLAGS=&quot;-Wall -Wextra -Wformat=2 $WARNINGS_ENABLE_ADDITIONAL&quot;
149       WARNINGS_ENABLE_ALL_CXXFLAGS=&quot;$WARNINGS_ENABLE_ALL_CFLAGS $WARNINGS_ENABLE_ADDITIONAL_CXX&quot;
150 
151       DISABLED_WARNINGS=&quot;unused-parameter unused&quot;
152       BUILD_CC_DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
153       ;;
154 
155     clang)
156       DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
157       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-Werror&quot;
158 
</pre>
<hr />
<pre>
198     fastdebug )
199       # no adjustment
200       ;;
201     slowdebug )
202       # FIXME: By adding this to C(XX)FLAGS_DEBUG_OPTIONS/JVM_CFLAGS_SYMBOLS it
203       # get&#39;s added conditionally on whether we produce debug symbols or not.
204       # This is most likely not really correct.
205 
206       # Add runtime stack smashing and undefined behavior checks.
207       CFLAGS_DEBUG_OPTIONS=&quot;-fstack-protector-all --param ssp-buffer-size=1&quot;
208       CXXFLAGS_DEBUG_OPTIONS=&quot;-fstack-protector-all --param ssp-buffer-size=1&quot;
209 
210       JVM_CFLAGS_SYMBOLS=&quot;$JVM_CFLAGS_SYMBOLS -fstack-protector-all --param ssp-buffer-size=1&quot;
211       ;;
212     esac
213   fi
214 ])
215 
216 AC_DEFUN([FLAGS_SETUP_OPTIMIZATION],
217 [
<span class="line-modified">218   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then</span>


















219     C_O_FLAG_HIGHEST_JVM=&quot;-O3&quot;
220     C_O_FLAG_HIGHEST=&quot;-O3&quot;
221     C_O_FLAG_HI=&quot;-O3&quot;
222     C_O_FLAG_NORM=&quot;-O2&quot;
223     C_O_FLAG_SIZE=&quot;-Os&quot;
224     C_O_FLAG_DEBUG=&quot;-O0&quot;
225     C_O_FLAG_DEBUG_JVM=&quot;-O0&quot;
226     C_O_FLAG_NONE=&quot;-O0&quot;
227     # -D_FORTIFY_SOURCE=2 hardening option needs optimization (at least -O1) enabled
228     # set for lower O-levels -U_FORTIFY_SOURCE to overwrite previous settings
229     if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux -a &quot;x$DEBUG_LEVEL&quot; = &quot;xfastdebug&quot;; then
230       ENABLE_FORTIFY_CFLAGS=&quot;-D_FORTIFY_SOURCE=2&quot;
231       DISABLE_FORTIFY_CFLAGS=&quot;-U_FORTIFY_SOURCE&quot;
232       C_O_FLAG_HIGHEST_JVM=&quot;${C_O_FLAG_HIGHEST_JVM} ${ENABLE_FORTIFY_CFLAGS}&quot;
233       C_O_FLAG_HIGHEST=&quot;${C_O_FLAG_HIGHEST} ${ENABLE_FORTIFY_CFLAGS}&quot;
234       C_O_FLAG_HI=&quot;${C_O_FLAG_HI} ${ENABLE_FORTIFY_CFLAGS}&quot;
235       C_O_FLAG_NORM=&quot;${C_O_FLAG_NORM} ${ENABLE_FORTIFY_CFLAGS}&quot;
236       C_O_FLAG_SIZE=&quot;${C_O_FLAG_SIZE} ${DISABLE_FORTIFY_CFLAGS}&quot;
237       C_O_FLAG_DEBUG=&quot;${C_O_FLAG_DEBUG} ${DISABLE_FORTIFY_CFLAGS}&quot;
238       C_O_FLAG_DEBUG_JVM=&quot;${C_O_FLAG_DEBUG_JVM} ${DISABLE_FORTIFY_CFLAGS}&quot;
</pre>
<hr />
<pre>
270     C_O_FLAG_HIGHEST_JVM=&quot;-O2 -Oy-&quot;
271     C_O_FLAG_HIGHEST=&quot;-O2&quot;
272     C_O_FLAG_HI=&quot;-O1&quot;
273     C_O_FLAG_NORM=&quot;-O1&quot;
274     C_O_FLAG_DEBUG=&quot;-Od&quot;
275     C_O_FLAG_DEBUG_JVM=&quot;&quot;
276     C_O_FLAG_NONE=&quot;-Od&quot;
277     C_O_FLAG_SIZE=&quot;-Os&quot;
278   fi
279 
280   # Now copy to C++ flags
281   CXX_O_FLAG_HIGHEST_JVM=&quot;$C_O_FLAG_HIGHEST_JVM&quot;
282   CXX_O_FLAG_HIGHEST=&quot;$C_O_FLAG_HIGHEST&quot;
283   CXX_O_FLAG_HI=&quot;$C_O_FLAG_HI&quot;
284   CXX_O_FLAG_NORM=&quot;$C_O_FLAG_NORM&quot;
285   CXX_O_FLAG_DEBUG=&quot;$C_O_FLAG_DEBUG&quot;
286   CXX_O_FLAG_DEBUG_JVM=&quot;$C_O_FLAG_DEBUG_JVM&quot;
287   CXX_O_FLAG_NONE=&quot;$C_O_FLAG_NONE&quot;
288   CXX_O_FLAG_SIZE=&quot;$C_O_FLAG_SIZE&quot;
289 





290   # Adjust optimization flags according to debug level.
291   case $DEBUG_LEVEL in
292     release )
293       # no adjustment
294       ;;
295     fastdebug )
296       # Not quite so much optimization
297       C_O_FLAG_HI=&quot;$C_O_FLAG_NORM&quot;
298       CXX_O_FLAG_HI=&quot;$CXX_O_FLAG_NORM&quot;
299       ;;
300     slowdebug )
301       # Disable optimization
302       C_O_FLAG_HIGHEST_JVM=&quot;$C_O_FLAG_DEBUG_JVM&quot;
303       C_O_FLAG_HIGHEST=&quot;$C_O_FLAG_DEBUG&quot;
304       C_O_FLAG_HI=&quot;$C_O_FLAG_DEBUG&quot;
305       C_O_FLAG_NORM=&quot;$C_O_FLAG_DEBUG&quot;
306       C_O_FLAG_SIZE=&quot;$C_O_FLAG_DEBUG&quot;
307       CXX_O_FLAG_HIGHEST_JVM=&quot;$CXX_O_FLAG_DEBUG_JVM&quot;
308       CXX_O_FLAG_HIGHEST=&quot;$CXX_O_FLAG_DEBUG&quot;
309       CXX_O_FLAG_HI=&quot;$CXX_O_FLAG_DEBUG&quot;
</pre>
<hr />
<pre>
362   FLAGS_CPU_ENDIAN=$OPENJDK_BUILD_CPU_ENDIAN
363   FLAGS_CPU_LEGACY=$OPENJDK_BUILD_CPU_LEGACY
364   FLAGS_CPU_LEGACY_LIB=$OPENJDK_BUILD_CPU_LEGACY_LIB
365 
366   FLAGS_SETUP_CFLAGS_CPU_DEP([BUILD], [OPENJDK_BUILD_], [BUILD_])
367 
368   CC=&quot;$CC_OLD&quot;
369   CXX=&quot;$CXX_OLD&quot;
370   CFLAGS=&quot;$CFLAGS_OLD&quot;
371   CXXFLAGS=&quot;$CXXFLAGS_OLD&quot;
372 ])
373 
374 ################################################################################
375 # platform independent
376 AC_DEFUN([FLAGS_SETUP_CFLAGS_HELPER],
377 [
378   #### OS DEFINES, these should be independent on toolchain
379   if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
380     CFLAGS_OS_DEF_JVM=&quot;-DLINUX&quot;
381     CFLAGS_OS_DEF_JDK=&quot;-D_GNU_SOURCE -D_REENTRANT -D_LARGEFILE64_SOURCE&quot;



382   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
383     CFLAGS_OS_DEF_JVM=&quot;-D_ALLBSD_SOURCE -D_DARWIN_C_SOURCE -D_XOPEN_SOURCE&quot;
384     CFLAGS_OS_DEF_JDK=&quot;-D_ALLBSD_SOURCE -D_DARWIN_UNLIMITED_SELECT&quot;
385   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xios; then
386     CFLAGS_OS_DEF_JDK=&quot;-DMACOSX -D_ALLBSD_SOURCE -DTARGET_IOS -D_DARWIN_UNLIMITED_SELECT&quot;
387   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xandroid; then
388     CFLAGS_OS_DEF_JDK=&quot;-target aarch64-linux-android -D__USE_BSD&quot;
389   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
390     CFLAGS_OS_DEF_JVM=&quot;-DAIX&quot;
391   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xbsd; then
392     CFLAGS_OS_DEF_JDK=&quot;-D_ALLBSD_SOURCE&quot;
393   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xwindows; then
394     CFLAGS_OS_DEF_JVM=&quot;-D_WINDOWS -DWIN32 -D_JNI_IMPLEMENTATION_&quot;
395   fi
396 
397   CFLAGS_OS_DEF_JDK=&quot;$CFLAGS_OS_DEF_JDK -D$OPENJDK_TARGET_OS_UPPERCASE&quot;
398 
399   #### GLOBAL DEFINES
400   # Set some common defines. These works for all compilers, but assume
401   # -D is universally accepted.
</pre>
<hr />
<pre>
404   ALWAYS_CFLAGS_JVM=&quot;-D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -D__STDC_CONSTANT_MACROS&quot;
405 
406   # Setup some hard coded includes
407   ALWAYS_CFLAGS_JDK=&quot; \
408       -I\$(SUPPORT_OUTPUTDIR)/modules_include/java.base \
409       -I\$(SUPPORT_OUTPUTDIR)/modules_include/java.base/\$(OPENJDK_TARGET_OS_INCLUDE_SUBDIR) \
410       -I${TOPDIR}/src/java.base/share/native/libjava \
411       -I${TOPDIR}/src/java.base/$OPENJDK_TARGET_OS_TYPE/native/libjava \
412       -I${TOPDIR}/src/hotspot/share/include \
413       -I${TOPDIR}/src/hotspot/os/${HOTSPOT_TARGET_OS_TYPE}/include&quot;
414 
415   if test &quot;x$OPENJDK_TARGET_OS&quot; = xios; then
416     ALWAYS_CFLAGS_JDK=&quot;$ALWAYS_CFLAGS_JDK -I${TOPDIR}/src/java.base/macosx/native/libjava&quot;
417   fi
418   ###############################################################################
419 
420   # Adjust flags according to debug level.
421   # Setup debug/release defines
422   if test &quot;x$DEBUG_LEVEL&quot; = xrelease; then
423     DEBUG_CFLAGS_JDK=&quot;-DNDEBUG&quot;



424   else
425     DEBUG_CFLAGS_JDK=&quot;-DDEBUG&quot;
426 
427     if test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
428       # We need &#39;-qminimaltoc&#39; or &#39;-qpic=large -bbigtoc&#39; if the TOC overflows.
429       # Hotspot now overflows its 64K TOC (currently only for debug),
430       # so for debug we build with &#39;-qpic=large -bbigtoc&#39;.
431       DEBUG_CFLAGS_JVM=&quot;-qpic=large&quot;
432     fi
433   fi
434 
435   if test &quot;x$DEBUG_LEVEL&quot; != xrelease; then
436     DEBUG_OPTIONS_FLAGS_JDK=&quot;$CFLAGS_DEBUG_OPTIONS&quot;
437     DEBUG_SYMBOLS_CFLAGS_JDK=&quot;$CFLAGS_DEBUG_SYMBOLS&quot;
438   fi
439 
440   #### TOOLCHAIN DEFINES
441 
442   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
443     ALWAYS_DEFINES_JVM=&quot;-D_GNU_SOURCE -D_REENTRANT&quot;
444   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
445     ALWAYS_DEFINES_JVM=&quot;-D_GNU_SOURCE&quot;




446   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
447     ALWAYS_DEFINES_JVM=&quot;-D_REENTRANT&quot;
448     ALWAYS_DEFINES_JDK=&quot;-D_GNU_SOURCE -D_REENTRANT -D_LARGEFILE64_SOURCE -DSTDC&quot;
449   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
450     ALWAYS_DEFINES_JDK=&quot;-DWIN32_LEAN_AND_MEAN -D_CRT_SECURE_NO_DEPRECATE \
451         -D_CRT_NONSTDC_NO_DEPRECATE -DWIN32 -DIAL&quot;
452     ALWAYS_DEFINES_JVM=&quot;-DNOMINMAX -DWIN32_LEAN_AND_MEAN&quot;
453   fi
454 
455   ###############################################################################
456   #
457   #
458   # CFLAGS BASIC
459   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
460     # COMMON to gcc and clang
461     TOOLCHAIN_CFLAGS_JVM=&quot;-pipe -fno-rtti -fno-exceptions \
462         -fvisibility=hidden -fno-strict-aliasing -fno-omit-frame-pointer&quot;
463   fi
464 
465   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
</pre>
<hr />
<pre>
482     # too big object files and speed the build up a little bit
483     # (see http://llvm.org/bugs/show_bug.cgi?id=7554)
484     TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -flimit-debug-info&quot;
485 
486     # In principle the stack alignment below is cpu- and ABI-dependent and
487     # should agree with values of StackAlignmentInBytes in various
488     # src/hotspot/cpu/*/globalDefinitions_*.hpp files, but this value currently
489     # works for all platforms.
490     TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -mno-omit-leaf-frame-pointer -mstack-alignment=16&quot;
491 
492     if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
493       if test &quot;x$DEBUG_LEVEL&quot; = xrelease; then
494         # Clang does not inline as much as GCC does for functions with &quot;inline&quot; keyword by default.
495         # This causes noticeable slowdown in pause time for G1, and possibly in other areas.
496         # Increasing the inline hint threshold avoids the slowdown for Clang-built JVM.
497         TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -mllvm -inlinehint-threshold=100000&quot;
498       fi
499       TOOLCHAIN_CFLAGS_JDK=&quot;-pipe&quot;
500       TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;-fno-strict-aliasing&quot; # technically NOT for CXX
501     fi














502 
503   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
504     # Suggested additions: -qsrcmsg to get improved error reporting
505     # set -qtbtable=full for a better traceback table/better stacks in hs_err when xlc16 is used
506     TOOLCHAIN_CFLAGS_JDK=&quot;-qtbtable=full -qchars=signed -qfullpath -qsaveopt -qstackprotect&quot;  # add on both CFLAGS
507     TOOLCHAIN_CFLAGS_JVM=&quot;-qtbtable=full -qtune=balanced \
508         -qalias=noansi -qstrict -qtls=default -qnortti -qnoeh -qignerrno -qstackprotect&quot;
509   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
510     TOOLCHAIN_CFLAGS_JVM=&quot;-nologo -MD -MP&quot;
511     TOOLCHAIN_CFLAGS_JDK=&quot;-nologo -MD -Zc:wchar_t-&quot;
512   fi
513 
514   # CFLAGS C language level for JDK sources (hotspot only uses C++)
515   # Ideally we would have a common level across all toolchains so that all sources
516   # are sure to conform to the same standard. Unfortunately neither our sources nor
517   # our toolchains are in a condition to support that. But what we loosely aim for is
518   # C99 level.
519   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang || test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
520     # Explicitly set C99. clang and xlclang support the same flag.
521     LANGSTD_CFLAGS=&quot;-std=c99&quot;





522   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
523     # MSVC doesn&#39;t support C99/C11 explicitly, unless you compile as C++:
524     # LANGSTD_CFLAGS=&quot;-TP&quot;
525     # but that requires numerous changes to the sources files. So we are limited
526     # to C89/C90 plus whatever extensions Visual Studio has decided to implement.
527     # This is the lowest bar for shared code.
528     LANGSTD_CFLAGS=&quot;&quot;
529   fi
530   TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;$LANGSTD_CFLAGS $TOOLCHAIN_CFLAGS_JDK_CONLY&quot;
531 
532   # CFLAGS WARNINGS STUFF
533   # Set JVM_CFLAGS warning handling
534   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
535     WARNING_CFLAGS_JDK_CONLY=&quot;$WARNINGS_ENABLE_ALL_CFLAGS&quot;
536     WARNING_CFLAGS_JDK_CXXONLY=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;
537     WARNING_CFLAGS_JVM=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;
538 
539   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
540     WARNING_CFLAGS=&quot;$WARNINGS_ENABLE_ALL&quot;
541 





542   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
543     WARNING_CFLAGS=&quot;$WARNINGS_ENABLE_ALL&quot;
544 
545   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
546     WARNING_CFLAGS=&quot;&quot;  # currently left empty
547   fi
548 
549   # Set some additional per-OS defines.
550 
551   # Additional macosx handling
552   if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
553     OS_CFLAGS=&quot;-DMAC_OS_X_VERSION_MIN_REQUIRED=$MACOSX_VERSION_MIN_NODOTS \
554         -mmacosx-version-min=$MACOSX_VERSION_MIN&quot;
555 
556     if test -n &quot;$MACOSX_VERSION_MAX&quot;; then
557         OS_CFLAGS=&quot;$OS_CFLAGS \
558             -DMAC_OS_X_VERSION_MAX_ALLOWED=$MACOSX_VERSION_MAX_NODOTS&quot;
559     fi
560   fi
561 
562   # Where does this really belong??
563   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
564     PICFLAG=&quot;-fPIC&quot;
565     PIEFLAG=&quot;-fPIE&quot;


566   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
567     # &#39;-qpic&#39; defaults to &#39;qpic=small&#39;. This means that the compiler generates only
568     # one instruction for accessing the TOC. If the TOC grows larger than 64K, the linker
569     # will have to patch this single instruction with a call to some out-of-order code which
570     # does the load from the TOC. This is of course slower, and we also would have
571     # to use &#39;-bbigtoc&#39; for linking anyway so we could also change the PICFLAG to &#39;qpic=large&#39;.
572     # With &#39;qpic=large&#39; the compiler will by default generate a two-instruction sequence which
573     # can be patched directly by the linker and does not require a jump to out-of-order code.
574     #
575     # Since large TOC causes perf. overhead, only pay it where we must. Currently this is
576     # for all libjvm variants (both gtest and normal) but no other binaries. So, build
577     # libjvm with -qpic=large and link with -bbigtoc.
578     JVM_PICFLAG=&quot;-qpic=large&quot;
579     JDK_PICFLAG=&quot;-qpic&quot;
580   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
581     PICFLAG=&quot;&quot;
582   fi
583 
584   if test &quot;x$TOOLCHAIN_TYPE&quot; != xxlc; then
585     JVM_PICFLAG=&quot;$PICFLAG&quot;
</pre>
<hr />
<pre>
627     RELAX_RELOCATIONS_FLAG=&quot;-Xassembler -mrelax-relocations=no&quot;
628     FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${RELAX_RELOCATIONS_FLAG}],
629         IF_TRUE: [STATIC_LIBS_CFLAGS=&quot;$STATIC_LIBS_CFLAGS ${RELAX_RELOCATIONS_FLAG}&quot;])
630   fi
631   AC_SUBST(STATIC_LIBS_CFLAGS)
632 ])
633 
634 ################################################################################
635 # $1 - Either BUILD or TARGET to pick the correct OS/CPU variables to check
636 #      conditionals against.
637 # $2 - Optional prefix for each variable defined.
638 # $3 - Optional prefix for compiler variables (either BUILD_ or nothing).
639 AC_DEFUN([FLAGS_SETUP_CFLAGS_CPU_DEP],
640 [
641   #### CPU DEFINES, these should (in theory) be independent on toolchain
642 
643   # Setup target CPU
644   # Setup endianness
645   if test &quot;x$FLAGS_CPU_ENDIAN&quot; = xlittle; then
646     $1_DEFINES_CPU_JVM=&quot;-DVM_LITTLE_ENDIAN&quot;
<span class="line-modified">647     $1_DEFINES_CPU_JDK=&quot;-D_LITTLE_ENDIAN&quot;</span>








648   else
<span class="line-modified">649     $1_DEFINES_CPU_JDK=&quot;-D_BIG_ENDIAN&quot;</span>




650   fi
651 
652   # setup CPU bit size
653   $1_DEFINES_CPU_JDK=&quot;${$1_DEFINES_CPU_JDK} -DARCH=&#39;\&quot;$FLAGS_CPU_LEGACY\&quot;&#39; \
654       -D$FLAGS_CPU_LEGACY&quot;
655 
656   if test &quot;x$FLAGS_CPU_BITS&quot; = x64; then
657     # -D_LP64=1 is only set on linux and mac. Setting on windows causes diff in
658     # unpack200.exe.
659     if test &quot;x$FLAGS_OS&quot; = xlinux || test &quot;x$FLAGS_OS&quot; = xmacosx; then
660       $1_DEFINES_CPU_JDK=&quot;${$1_DEFINES_CPU_JDK} -D_LP64=1&quot;
661     fi
<span class="line-modified">662     if test &quot;x$FLAGS_OS&quot; != xaix; then</span>

663       # xlc on AIX defines _LP64=1 by default and issues a warning if we redefine it.
664       $1_DEFINES_CPU_JVM=&quot;${$1_DEFINES_CPU_JVM} -D_LP64=1&quot;
665     fi
666   fi
667 
668   # toolchain dependend, per-cpu
<span class="line-modified">669   if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then</span>




670     if test &quot;x$FLAGS_CPU&quot; = xx86_64; then
671       $1_DEFINES_CPU_JDK=&quot;${$1_DEFINES_CPU_JDK} -D_AMD64_ -Damd64&quot;
672     else
673       $1_DEFINES_CPU_JDK=&quot;${$1_DEFINES_CPU_JDK} -D_X86_ -Dx86&quot;
674     fi
675   fi
676 
677   # CFLAGS PER CPU
678   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
679     # COMMON to gcc and clang
680     if test &quot;x$FLAGS_CPU&quot; = xx86; then
681       # Force compatibility with i586 on 32 bit intel platforms.
682       $1_CFLAGS_CPU=&quot;-march=i586&quot;
683     fi
684   fi
685 
686   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
687     if test &quot;x$FLAGS_CPU&quot; = xaarch64; then
688       # -Wno-psabi to get rid of annoying &quot;note: parameter passing for argument of type &#39;&lt;type&gt; changed in GCC 9.1&quot;
689       $1_CFLAGS_CPU=&quot;-Wno-psabi&quot;
</pre>
<hr />
<pre>
710       # for all archs except arm and ppc, prevent gcc to omit frame pointer
711       $1_CFLAGS_CPU_JDK=&quot;${$1_CFLAGS_CPU_JDK} -fno-omit-frame-pointer&quot;
712     fi
713 
714     $1_CXXSTD_CXXFLAG=&quot;-std=gnu++98&quot;
715     FLAGS_CXX_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${$1_CXXSTD_CXXFLAG}],
716         PREFIX: $3, IF_FALSE: [$1_CXXSTD_CXXFLAG=&quot;&quot;])
717     $1_TOOLCHAIN_CFLAGS_JDK_CXXONLY=&quot;${$1_CXXSTD_CXXFLAG}&quot;
718     $1_TOOLCHAIN_CFLAGS_JVM=&quot;${$1_TOOLCHAIN_CFLAGS_JVM} ${$1_CXXSTD_CXXFLAG}&quot;
719     $2ADLC_CXXFLAG=&quot;${$1_CXXSTD_CXXFLAG}&quot;
720 
721   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
722     if test &quot;x$FLAGS_OS&quot; = xlinux; then
723       # ppc test not really needed for clang
724       if test &quot;x$FLAGS_CPU_ARCH&quot; != xarm &amp;&amp;  test &quot;x$FLAGS_CPU_ARCH&quot; != xppc; then
725         # for all archs except arm and ppc, prevent gcc to omit frame pointer
726         $1_CFLAGS_CPU_JDK=&quot;${$1_CFLAGS_CPU_JDK} -fno-omit-frame-pointer&quot;
727       fi
728     fi
729 









730   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
731     if test &quot;x$FLAGS_CPU&quot; = xppc64; then
732       $1_CFLAGS_CPU_JVM=&quot;-qarch=ppc64&quot;
733     fi
734 
735   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
736     if test &quot;x$FLAGS_CPU&quot; = xx86; then
737       $1_CFLAGS_CPU_JVM=&quot;-arch:IA32&quot;
738     elif test &quot;x$OPENJDK_TARGET_CPU&quot; = xx86_64; then
739       if test &quot;x$DEBUG_LEVEL&quot; != xrelease; then
740         # NOTE: This is probably redundant; -homeparams is default on
741         # non-release builds.
742         $1_CFLAGS_CPU_JVM=&quot;-homeparams&quot;
743       fi
744     fi
745   fi
746 
747   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
748     FLAGS_SETUP_GCC6_COMPILER_FLAGS($1, $3)
749     $1_TOOLCHAIN_CFLAGS=&quot;${$1_GCC6_CFLAGS}&quot;
</pre>
<hr />
<pre>
831 ])
832 
833 # FLAGS_SETUP_GCC6_COMPILER_FLAGS([PREFIX])
834 # Arguments:
835 # $1 - Prefix for each variable defined.
836 # $2 - Prefix for compiler variables (either BUILD_ or nothing).
837 AC_DEFUN([FLAGS_SETUP_GCC6_COMPILER_FLAGS],
838 [
839   # These flags are required for GCC 6 builds as undefined behaviour in OpenJDK code
840   # runs afoul of the more aggressive versions of these optimisations.
841   # Notably, value range propagation now assumes that the this pointer of C++
842   # member functions is non-null.
843   NO_DELETE_NULL_POINTER_CHECKS_CFLAG=&quot;-fno-delete-null-pointer-checks&quot;
844   FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [$NO_DELETE_NULL_POINTER_CHECKS_CFLAG],
845       PREFIX: $2, IF_FALSE: [NO_DELETE_NULL_POINTER_CHECKS_CFLAG=&quot;&quot;])
846   NO_LIFETIME_DSE_CFLAG=&quot;-fno-lifetime-dse&quot;
847   FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [$NO_LIFETIME_DSE_CFLAG],
848       PREFIX: $2, IF_FALSE: [NO_LIFETIME_DSE_CFLAG=&quot;&quot;])
849   $1_GCC6_CFLAGS=&quot;${NO_DELETE_NULL_POINTER_CHECKS_CFLAG} ${NO_LIFETIME_DSE_CFLAG}&quot;
850 ])
























</pre>
</td>
</tr>
</table>
<center><a href="build-performance.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="flags-ldflags.m4.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>