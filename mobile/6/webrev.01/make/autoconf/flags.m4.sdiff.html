<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/flags.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="flags-other.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="hotspot.m4.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/flags.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
188 
189   AC_ARG_WITH(extra-ldflags, [AS_HELP_STRING([--with-extra-ldflags],
190       [extra flags to be used when linking jdk])])
191 
192   AC_ARG_WITH(extra-asflags, [AS_HELP_STRING([--with-extra-asflags],
193       [extra flags to be passed to the assembler])])
194 
195   USER_CFLAGS=&quot;$with_extra_cflags&quot;
196   USER_CXXFLAGS=&quot;$with_extra_cxxflags&quot;
197   USER_LDFLAGS=&quot;$with_extra_ldflags&quot;
198   USER_ASFLAGS=&quot;$with_extra_asflags&quot;
199 ])
200 
201 # Setup the sysroot flags and add them to global CFLAGS and LDFLAGS so
202 # that configure can use them while detecting compilers.
203 # TOOLCHAIN_TYPE is available here.
204 # Param 1 - Optional prefix to all variables. (e.g BUILD_)
205 AC_DEFUN([FLAGS_SETUP_SYSROOT_FLAGS],
206 [
207   if test &quot;x[$]$1SYSROOT&quot; != &quot;x&quot;; then
<span class="line-modified">208     if test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed">209       if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris; then</span>
<span class="line-removed">210         # Solaris Studio does not have a concept of sysroot. Instead we must</span>
<span class="line-removed">211         # make sure the default include and lib dirs are appended to each</span>
<span class="line-removed">212         # compile and link command line. Must also add -I-xbuiltin to enable</span>
<span class="line-removed">213         # inlining of system functions and intrinsics.</span>
<span class="line-removed">214         $1SYSROOT_CFLAGS=&quot;-I-xbuiltin -I[$]$1SYSROOT/usr/include&quot;</span>
<span class="line-removed">215         $1SYSROOT_LDFLAGS=&quot;-L[$]$1SYSROOT/usr/lib$OPENJDK_TARGET_CPU_ISADIR \</span>
<span class="line-removed">216             -L[$]$1SYSROOT/lib$OPENJDK_TARGET_CPU_ISADIR&quot;</span>
<span class="line-removed">217         # If the devkit contains the ld linker, make sure we use it.</span>
<span class="line-removed">218         AC_PATH_PROG(SOLARIS_LD, ld, , $DEVKIT_TOOLCHAIN_PATH:$DEVKIT_EXTRA_PATH)</span>
<span class="line-removed">219         # Make sure this ld is runnable.</span>
<span class="line-removed">220         if test -f &quot;$SOLARIS_LD&quot;; then</span>
<span class="line-removed">221           if &quot;$SOLARIS_LD&quot; -V &gt; /dev/null 2&gt; /dev/null; then</span>
<span class="line-removed">222             $1SYSROOT_LDFLAGS=&quot;[$]$1SYSROOT_LDFLAGS -Yl,$(dirname $SOLARIS_LD)&quot;</span>
<span class="line-removed">223           else</span>
<span class="line-removed">224             AC_MSG_WARN([Could not run $SOLARIS_LD found in devkit, reverting to system ld])</span>
<span class="line-removed">225           fi</span>
<span class="line-removed">226         fi</span>
<span class="line-removed">227       fi</span>
<span class="line-removed">228     elif test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then</span>
229       $1SYSROOT_CFLAGS=&quot;--sysroot=[$]$1SYSROOT&quot;
230       $1SYSROOT_LDFLAGS=&quot;--sysroot=[$]$1SYSROOT&quot;
231     elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
232       $1SYSROOT_CFLAGS=&quot;-isysroot [$]$1SYSROOT&quot;
233       $1SYSROOT_LDFLAGS=&quot;-isysroot [$]$1SYSROOT&quot;
234     fi
235   fi
236 
237   if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
238     # We also need -iframework&lt;path&gt;/System/Library/Frameworks
239     $1SYSROOT_CFLAGS=&quot;[$]$1SYSROOT_CFLAGS -iframework [$]$1SYSROOT/System/Library/Frameworks&quot;
240     $1SYSROOT_LDFLAGS=&quot;[$]$1SYSROOT_LDFLAGS -iframework [$]$1SYSROOT/System/Library/Frameworks&quot;
241     # These always need to be set, or we can&#39;t find the frameworks embedded in JavaVM.framework
242     # set this here so it doesn&#39;t have to be peppered throughout the forest
243     $1SYSROOT_CFLAGS=&quot;[$]$1SYSROOT_CFLAGS -F [$]$1SYSROOT/System/Library/Frameworks/JavaVM.framework/Frameworks&quot;
244     $1SYSROOT_LDFLAGS=&quot;[$]$1SYSROOT_LDFLAGS -F [$]$1SYSROOT/System/Library/Frameworks/JavaVM.framework/Frameworks&quot;
245   fi
246 
247   AC_SUBST($1SYSROOT_CFLAGS)
248   AC_SUBST($1SYSROOT_LDFLAGS)
249 ])
250 
251 AC_DEFUN_ONCE([FLAGS_PRE_TOOLCHAIN],
252 [
253   # We should always include user supplied flags
254   FLAGS_SETUP_USER_SUPPLIED_FLAGS
255   # The sysroot flags are needed for configure to be able to run the compilers
256   FLAGS_SETUP_SYSROOT_FLAGS
257 
<span class="line-modified">258   # For solstudio and xlc, the word size flag is required for correct behavior.</span>
259   # For clang/gcc, the flag is only strictly required for reduced builds, but
<span class="line-modified">260   # set it always where possible (x86, sparc and ppc).</span>
261   if test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
262     MACHINE_FLAG=&quot;-q${OPENJDK_TARGET_CPU_BITS}&quot;
<span class="line-removed">263   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed">264     MACHINE_FLAG=&quot;-m${OPENJDK_TARGET_CPU_BITS}&quot;</span>
265   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
266     if test &quot;x$OPENJDK_TARGET_CPU_ARCH&quot; = xx86 &amp;&amp;
267         test &quot;x$OPENJDK_TARGET_CPU&quot; != xx32 ||
<span class="line-removed">268         test &quot;x$OPENJDK_TARGET_CPU_ARCH&quot; = xsparc ||</span>
269         test &quot;x$OPENJDK_TARGET_CPU_ARCH&quot; = xppc; then
270       MACHINE_FLAG=&quot;-m${OPENJDK_TARGET_CPU_BITS}&quot;
271     fi
272   fi
273 
274   # FIXME: global flags are not used yet...
275   # The &quot;global&quot; flags will *always* be set. Without them, it is not possible to
276   # get a working compilation.
277   GLOBAL_CFLAGS=&quot;$MACHINE_FLAG $SYSROOT_CFLAGS $USER_CFLAGS&quot;
278   GLOBAL_CXXFLAGS=&quot;$MACHINE_FLAG $SYSROOT_CFLAGS $USER_CXXFLAGS&quot;
279   GLOBAL_LDFLAGS=&quot;$MACHINE_FLAG $SYSROOT_LDFLAGS $USER_LDFLAGS&quot;
280   # FIXME: Don&#39;t really know how to do with this, but this was the old behavior
281   if test &quot;x$OPENJDK_TARGET_OS&quot; = xios; then
282     GLOBAL_CPPFLAGS=&quot;$MACHINE_FLAG $USER_CFLAGS $SYSROOT_CFLAGS&quot;
283   else
284     GLOBAL_CPPFLAGS=&quot;$SYSROOT_CFLAGS&quot;
285   fi
286   AC_SUBST(GLOBAL_CFLAGS)
287   AC_SUBST(GLOBAL_CXXFLAGS)
288   AC_SUBST(GLOBAL_LDFLAGS)
</pre>
<hr />
<pre>
305   CXXFLAGS=&quot;$GLOBAL_CXXFLAGS&quot;
306   LDFLAGS=&quot;$GLOBAL_LDFLAGS&quot;
307   CPPFLAGS=&quot;$GLOBAL_CPPFLAGS&quot;
308 ])
309 
310 AC_DEFUN([FLAGS_SETUP_TOOLCHAIN_CONTROL],
311 [
312   # COMPILER_TARGET_BITS_FLAG  : option for selecting 32- or 64-bit output
313   # COMPILER_COMMAND_FILE_FLAG : option for passing a command file to the compiler
314   # COMPILER_BINDCMD_FILE_FLAG : option for specifying a file which saves the binder
315   #                              commands produced by the link step (currently AIX only)
316   if test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
317     COMPILER_TARGET_BITS_FLAG=&quot;-q&quot;
318     COMPILER_COMMAND_FILE_FLAG=&quot;-f&quot;
319     COMPILER_BINDCMD_FILE_FLAG=&quot;-bloadmap:&quot;
320   else
321     COMPILER_TARGET_BITS_FLAG=&quot;-m&quot;
322     COMPILER_COMMAND_FILE_FLAG=&quot;@&quot;
323     COMPILER_BINDCMD_FILE_FLAG=&quot;&quot;
324 
<span class="line-removed">325     # The solstudio linker does not support @-files.</span>
<span class="line-removed">326     if test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed">327       COMPILER_COMMAND_FILE_FLAG=</span>
<span class="line-removed">328     fi</span>
<span class="line-removed">329 </span>
330     # Check if @file is supported by gcc
331     if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
332       AC_MSG_CHECKING([if @file is supported by gcc])
333       # Extra emtpy &quot;&quot; to prevent ECHO from interpreting &#39;--version&#39; as argument
334       $ECHO &quot;&quot; &quot;--version&quot; &gt; command.file
335       if $CXX @command.file 2&gt;&amp;AS_MESSAGE_LOG_FD &gt;&amp;AS_MESSAGE_LOG_FD; then
336         AC_MSG_RESULT(yes)
337         COMPILER_COMMAND_FILE_FLAG=&quot;@&quot;
338       else
339         AC_MSG_RESULT(no)
340         COMPILER_COMMAND_FILE_FLAG=
341       fi
342       $RM command.file
343     fi
344   fi
345 
346   AC_SUBST(COMPILER_TARGET_BITS_FLAG)
347   AC_SUBST(COMPILER_COMMAND_FILE_FLAG)
348   AC_SUBST(COMPILER_BINDCMD_FILE_FLAG)
349 
</pre>
<hr />
<pre>
363     # When compiling, how to specify the to be created object file.
364     CC_OUT_OPTION=&#39;-o$(SPACE)&#39;
365     # When linking, how to specify the output
366     LD_OUT_OPTION=&#39;-o$(SPACE)&#39;
367     # When archiving, how to specify the destination static archive.
368     if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
369       AR_OUT_OPTION=&#39;-r -cs$(SPACE)&#39;
370     else
371       AR_OUT_OPTION=&#39;-rcs$(SPACE)&#39;
372     fi
373   fi
374   AC_SUBST(CC_OUT_OPTION)
375   AC_SUBST(LD_OUT_OPTION)
376   AC_SUBST(AR_OUT_OPTION)
377 
378   # Generate make dependency files
379   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
380     C_FLAG_DEPS=&quot;-MMD -MF&quot;
381   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
382     C_FLAG_DEPS=&quot;-MMD -MF&quot;
<span class="line-removed">383   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed">384     C_FLAG_DEPS=&quot;-xMMD -xMF&quot;</span>
385   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
386     C_FLAG_DEPS=&quot;-qmakedep=gcc -MF&quot;
387   fi
388   CXX_FLAG_DEPS=&quot;$C_FLAG_DEPS&quot;
389   AC_SUBST(C_FLAG_DEPS)
390   AC_SUBST(CXX_FLAG_DEPS)
391 ])
392 
393 AC_DEFUN_ONCE([FLAGS_POST_TOOLCHAIN],
394 [
395   FLAGS_SETUP_TOOLCHAIN_CONTROL
396 
397   if test &quot;x$BUILD_SYSROOT&quot; != x; then
398     FLAGS_SETUP_SYSROOT_FLAGS([BUILD_])
399   else
400     if test &quot;x$COMPILE_TYPE&quot; != &quot;xcross&quot;; then
401       BUILD_SYSROOT_CFLAGS=&quot;$SYSROOT_CFLAGS&quot;
402       BUILD_SYSROOT_LDFLAGS=&quot;$SYSROOT_LDFLAGS&quot;
403     fi
404   fi
</pre>
</td>
<td>
<hr />
<pre>
188 
189   AC_ARG_WITH(extra-ldflags, [AS_HELP_STRING([--with-extra-ldflags],
190       [extra flags to be used when linking jdk])])
191 
192   AC_ARG_WITH(extra-asflags, [AS_HELP_STRING([--with-extra-asflags],
193       [extra flags to be passed to the assembler])])
194 
195   USER_CFLAGS=&quot;$with_extra_cflags&quot;
196   USER_CXXFLAGS=&quot;$with_extra_cxxflags&quot;
197   USER_LDFLAGS=&quot;$with_extra_ldflags&quot;
198   USER_ASFLAGS=&quot;$with_extra_asflags&quot;
199 ])
200 
201 # Setup the sysroot flags and add them to global CFLAGS and LDFLAGS so
202 # that configure can use them while detecting compilers.
203 # TOOLCHAIN_TYPE is available here.
204 # Param 1 - Optional prefix to all variables. (e.g BUILD_)
205 AC_DEFUN([FLAGS_SETUP_SYSROOT_FLAGS],
206 [
207   if test &quot;x[$]$1SYSROOT&quot; != &quot;x&quot;; then
<span class="line-modified">208     if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then</span>




















209       $1SYSROOT_CFLAGS=&quot;--sysroot=[$]$1SYSROOT&quot;
210       $1SYSROOT_LDFLAGS=&quot;--sysroot=[$]$1SYSROOT&quot;
211     elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
212       $1SYSROOT_CFLAGS=&quot;-isysroot [$]$1SYSROOT&quot;
213       $1SYSROOT_LDFLAGS=&quot;-isysroot [$]$1SYSROOT&quot;
214     fi
215   fi
216 
217   if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
218     # We also need -iframework&lt;path&gt;/System/Library/Frameworks
219     $1SYSROOT_CFLAGS=&quot;[$]$1SYSROOT_CFLAGS -iframework [$]$1SYSROOT/System/Library/Frameworks&quot;
220     $1SYSROOT_LDFLAGS=&quot;[$]$1SYSROOT_LDFLAGS -iframework [$]$1SYSROOT/System/Library/Frameworks&quot;
221     # These always need to be set, or we can&#39;t find the frameworks embedded in JavaVM.framework
222     # set this here so it doesn&#39;t have to be peppered throughout the forest
223     $1SYSROOT_CFLAGS=&quot;[$]$1SYSROOT_CFLAGS -F [$]$1SYSROOT/System/Library/Frameworks/JavaVM.framework/Frameworks&quot;
224     $1SYSROOT_LDFLAGS=&quot;[$]$1SYSROOT_LDFLAGS -F [$]$1SYSROOT/System/Library/Frameworks/JavaVM.framework/Frameworks&quot;
225   fi
226 
227   AC_SUBST($1SYSROOT_CFLAGS)
228   AC_SUBST($1SYSROOT_LDFLAGS)
229 ])
230 
231 AC_DEFUN_ONCE([FLAGS_PRE_TOOLCHAIN],
232 [
233   # We should always include user supplied flags
234   FLAGS_SETUP_USER_SUPPLIED_FLAGS
235   # The sysroot flags are needed for configure to be able to run the compilers
236   FLAGS_SETUP_SYSROOT_FLAGS
237 
<span class="line-modified">238   # For xlc, the word size flag is required for correct behavior.</span>
239   # For clang/gcc, the flag is only strictly required for reduced builds, but
<span class="line-modified">240   # set it always where possible (x86 and ppc).</span>
241   if test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
242     MACHINE_FLAG=&quot;-q${OPENJDK_TARGET_CPU_BITS}&quot;


243   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
244     if test &quot;x$OPENJDK_TARGET_CPU_ARCH&quot; = xx86 &amp;&amp;
245         test &quot;x$OPENJDK_TARGET_CPU&quot; != xx32 ||

246         test &quot;x$OPENJDK_TARGET_CPU_ARCH&quot; = xppc; then
247       MACHINE_FLAG=&quot;-m${OPENJDK_TARGET_CPU_BITS}&quot;
248     fi
249   fi
250 
251   # FIXME: global flags are not used yet...
252   # The &quot;global&quot; flags will *always* be set. Without them, it is not possible to
253   # get a working compilation.
254   GLOBAL_CFLAGS=&quot;$MACHINE_FLAG $SYSROOT_CFLAGS $USER_CFLAGS&quot;
255   GLOBAL_CXXFLAGS=&quot;$MACHINE_FLAG $SYSROOT_CFLAGS $USER_CXXFLAGS&quot;
256   GLOBAL_LDFLAGS=&quot;$MACHINE_FLAG $SYSROOT_LDFLAGS $USER_LDFLAGS&quot;
257   # FIXME: Don&#39;t really know how to do with this, but this was the old behavior
258   if test &quot;x$OPENJDK_TARGET_OS&quot; = xios; then
259     GLOBAL_CPPFLAGS=&quot;$MACHINE_FLAG $USER_CFLAGS $SYSROOT_CFLAGS&quot;
260   else
261     GLOBAL_CPPFLAGS=&quot;$SYSROOT_CFLAGS&quot;
262   fi
263   AC_SUBST(GLOBAL_CFLAGS)
264   AC_SUBST(GLOBAL_CXXFLAGS)
265   AC_SUBST(GLOBAL_LDFLAGS)
</pre>
<hr />
<pre>
282   CXXFLAGS=&quot;$GLOBAL_CXXFLAGS&quot;
283   LDFLAGS=&quot;$GLOBAL_LDFLAGS&quot;
284   CPPFLAGS=&quot;$GLOBAL_CPPFLAGS&quot;
285 ])
286 
287 AC_DEFUN([FLAGS_SETUP_TOOLCHAIN_CONTROL],
288 [
289   # COMPILER_TARGET_BITS_FLAG  : option for selecting 32- or 64-bit output
290   # COMPILER_COMMAND_FILE_FLAG : option for passing a command file to the compiler
291   # COMPILER_BINDCMD_FILE_FLAG : option for specifying a file which saves the binder
292   #                              commands produced by the link step (currently AIX only)
293   if test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
294     COMPILER_TARGET_BITS_FLAG=&quot;-q&quot;
295     COMPILER_COMMAND_FILE_FLAG=&quot;-f&quot;
296     COMPILER_BINDCMD_FILE_FLAG=&quot;-bloadmap:&quot;
297   else
298     COMPILER_TARGET_BITS_FLAG=&quot;-m&quot;
299     COMPILER_COMMAND_FILE_FLAG=&quot;@&quot;
300     COMPILER_BINDCMD_FILE_FLAG=&quot;&quot;
301 





302     # Check if @file is supported by gcc
303     if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
304       AC_MSG_CHECKING([if @file is supported by gcc])
305       # Extra emtpy &quot;&quot; to prevent ECHO from interpreting &#39;--version&#39; as argument
306       $ECHO &quot;&quot; &quot;--version&quot; &gt; command.file
307       if $CXX @command.file 2&gt;&amp;AS_MESSAGE_LOG_FD &gt;&amp;AS_MESSAGE_LOG_FD; then
308         AC_MSG_RESULT(yes)
309         COMPILER_COMMAND_FILE_FLAG=&quot;@&quot;
310       else
311         AC_MSG_RESULT(no)
312         COMPILER_COMMAND_FILE_FLAG=
313       fi
314       $RM command.file
315     fi
316   fi
317 
318   AC_SUBST(COMPILER_TARGET_BITS_FLAG)
319   AC_SUBST(COMPILER_COMMAND_FILE_FLAG)
320   AC_SUBST(COMPILER_BINDCMD_FILE_FLAG)
321 
</pre>
<hr />
<pre>
335     # When compiling, how to specify the to be created object file.
336     CC_OUT_OPTION=&#39;-o$(SPACE)&#39;
337     # When linking, how to specify the output
338     LD_OUT_OPTION=&#39;-o$(SPACE)&#39;
339     # When archiving, how to specify the destination static archive.
340     if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
341       AR_OUT_OPTION=&#39;-r -cs$(SPACE)&#39;
342     else
343       AR_OUT_OPTION=&#39;-rcs$(SPACE)&#39;
344     fi
345   fi
346   AC_SUBST(CC_OUT_OPTION)
347   AC_SUBST(LD_OUT_OPTION)
348   AC_SUBST(AR_OUT_OPTION)
349 
350   # Generate make dependency files
351   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
352     C_FLAG_DEPS=&quot;-MMD -MF&quot;
353   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
354     C_FLAG_DEPS=&quot;-MMD -MF&quot;


355   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
356     C_FLAG_DEPS=&quot;-qmakedep=gcc -MF&quot;
357   fi
358   CXX_FLAG_DEPS=&quot;$C_FLAG_DEPS&quot;
359   AC_SUBST(C_FLAG_DEPS)
360   AC_SUBST(CXX_FLAG_DEPS)
361 ])
362 
363 AC_DEFUN_ONCE([FLAGS_POST_TOOLCHAIN],
364 [
365   FLAGS_SETUP_TOOLCHAIN_CONTROL
366 
367   if test &quot;x$BUILD_SYSROOT&quot; != x; then
368     FLAGS_SETUP_SYSROOT_FLAGS([BUILD_])
369   else
370     if test &quot;x$COMPILE_TYPE&quot; != &quot;xcross&quot;; then
371       BUILD_SYSROOT_CFLAGS=&quot;$SYSROOT_CFLAGS&quot;
372       BUILD_SYSROOT_LDFLAGS=&quot;$SYSROOT_LDFLAGS&quot;
373     fi
374   fi
</pre>
</td>
</tr>
</table>
<center><a href="flags-other.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="hotspot.m4.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>