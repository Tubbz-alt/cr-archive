<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/flags-ldflags.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="flags-cflags.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="flags-other.m4.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/flags-ldflags.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 71 
 72     # Add -z,defs, to forbid undefined symbols in object files.
 73     # add -z,relro (mark relocations read only) for all libs
 74     # add -z,now (&quot;full relro&quot; - more of the Global Offset Table GOT is marked read only)
 75     BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -Wl,-z,defs -Wl,-z,relro -Wl,-z,now&quot;
 76     # Linux : remove unused code+data in link step
 77     if test &quot;x$ENABLE_LINKTIME_GC&quot; = xtrue; then
 78       if test &quot;x$OPENJDK_TARGET_CPU&quot; = xs390x; then
 79         BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -Wl,--gc-sections -Wl,--print-gc-sections&quot;
 80       else
 81         BASIC_LDFLAGS_JDK_ONLY=&quot;$BASIC_LDFLAGS_JDK_ONLY -Wl,--gc-sections&quot;
 82       fi
 83     fi
 84 
 85     BASIC_LDFLAGS_JVM_ONLY=&quot;-Wl,-O1&quot;
 86 
 87   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
 88     BASIC_LDFLAGS_JVM_ONLY=&quot;-mno-omit-leaf-frame-pointer -mstack-alignment=16 \
 89         -fPIC&quot;
 90 
<span class="line-removed"> 91   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed"> 92     BASIC_LDFLAGS=&quot;-Wl,-z,defs&quot;</span>
<span class="line-removed"> 93     BASIC_LDFLAGS_ONLYCXX=&quot;-norunpath&quot;</span>
<span class="line-removed"> 94     BASIC_LDFLAGS_ONLYCXX_JDK_ONLY=&quot;-xnolib&quot;</span>
<span class="line-removed"> 95 </span>
<span class="line-removed"> 96     BASIC_LDFLAGS_JDK_ONLY=&quot;-ztext&quot;</span>
<span class="line-removed"> 97     BASIC_LDFLAGS_JVM_ONLY=&quot;-library=%none -mt -z noversion&quot;</span>
<span class="line-removed"> 98 </span>
 99   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
100     BASIC_LDFLAGS=&quot;-b64 -brtl -bnorwexec -bnolibpath -bexpall -bernotok -btextpsize:64K \
101         -bdatapsize:64K -bstackpsize:64K&quot;
102     # libjvm.so has gotten too large for normal TOC size; compile with qpic=large and link with bigtoc
103     BASIC_LDFLAGS_JVM_ONLY=&quot;-Wl,-lC_r -bbigtoc&quot;
104 
105   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
106     BASIC_LDFLAGS=&quot;-nologo -opt:ref&quot;
107     BASIC_LDFLAGS_JDK_ONLY=&quot;-incremental:no&quot;
108     BASIC_LDFLAGS_JVM_ONLY=&quot;-opt:icf,8 -subsystem:windows&quot;
109   fi
110 
111   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
112     if test -n &quot;$HAS_NOEXECSTACK&quot;; then
113       BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -Wl,-z,noexecstack&quot;
114     fi
115   fi
116 
117   # Setup OS-dependent LDFLAGS
118   if test &quot;x$TOOLCHAIN_TYPE&quot; = xclang || test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
</pre>
<hr />
<pre>
124     fi
125   fi
126 
127   # Setup debug level-dependent LDFLAGS
128   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
129     if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
130       if test x$DEBUG_LEVEL = xrelease; then
131         DEBUGLEVEL_LDFLAGS_JDK_ONLY=&quot;$DEBUGLEVEL_LDFLAGS_JDK_ONLY -Wl,-O1&quot;
132       fi
133     fi
134 
135   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
136     # We need &#39;-qminimaltoc&#39; or &#39;-qpic=large -bbigtoc&#39; if the TOC overflows.
137     # Hotspot now overflows its 64K TOC (currently only for debug),
138     # so we build with &#39;-qpic=large -bbigtoc&#39;.
139     if test &quot;x$DEBUG_LEVEL&quot; != xrelease; then
140       DEBUGLEVEL_LDFLAGS_JVM_ONLY=&quot;$DEBUGLEVEL_LDFLAGS_JVM_ONLY -bbigtoc&quot;
141     fi
142   fi
143 
<span class="line-removed">144   # Setup warning flags</span>
<span class="line-removed">145   if test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed">146     LDFLAGS_WARNINGS_ARE_ERRORS=&quot;-Wl,-z,fatal-warnings&quot;</span>
<span class="line-removed">147   else</span>
<span class="line-removed">148     LDFLAGS_WARNINGS_ARE_ERRORS=&quot;&quot;</span>
<span class="line-removed">149   fi</span>
<span class="line-removed">150   AC_SUBST(LDFLAGS_WARNINGS_ARE_ERRORS)</span>
<span class="line-removed">151 </span>
152   # Setup LDFLAGS for linking executables
153   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
154     EXECUTABLE_LDFLAGS=&quot;$EXECUTABLE_LDFLAGS -Wl,--allow-shlib-undefined&quot;
155     # Enabling pie on 32 bit builds prevents the JVM from allocating a continuous
156     # java heap.
157     if test &quot;x$OPENJDK_TARGET_CPU_BITS&quot; != &quot;x32&quot;; then
158       EXECUTABLE_LDFLAGS=&quot;$EXECUTABLE_LDFLAGS -pie&quot;
159     fi
160   fi
161 
162   if test &quot;x$ALLOW_ABSOLUTE_PATHS_IN_OUTPUT&quot; = &quot;xfalse&quot;; then
163     if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
164       BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -pdbaltpath:%_PDB%&quot;
165     fi
166   fi
167 
168   # Export some intermediate variables for compatibility
169   LDFLAGS_CXX_JDK=&quot;$BASIC_LDFLAGS_ONLYCXX $BASIC_LDFLAGS_ONLYCXX_JDK_ONLY $DEBUGLEVEL_LDFLAGS_JDK_ONLY&quot;
170   AC_SUBST(LDFLAGS_CXX_JDK)
171   AC_SUBST(LIBJSIG_HASHSTYLE_LDFLAGS)
172   AC_SUBST(LIBJSIG_NOEXECSTACK_LDFLAGS)
173 ])
174 
175 ################################################################################
176 # $1 - Either BUILD or TARGET to pick the correct OS/CPU variables to check
177 #      conditionals against.
178 # $2 - Optional prefix for each variable defined.
179 AC_DEFUN([FLAGS_SETUP_LDFLAGS_CPU_DEP],
180 [
181   # Setup CPU-dependent basic LDFLAGS. These can differ between the target and
182   # build toolchain.
183   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
184     if test &quot;x${OPENJDK_$1_CPU}&quot; = xx86; then
185       $1_CPU_LDFLAGS_JVM_ONLY=&quot;-march=i586&quot;
186     elif test &quot;x$OPENJDK_$1_CPU&quot; = xarm; then
187       $1_CPU_LDFLAGS_JVM_ONLY=&quot;${$1_CPU_LDFLAGS_JVM_ONLY} -fsigned-char&quot;
188       $1_CPU_LDFLAGS=&quot;$ARM_ARCH_TYPE_FLAGS $ARM_FLOAT_TYPE_FLAGS&quot;
189     fi
190 
<span class="line-removed">191   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed">192     if test &quot;x${OPENJDK_$1_CPU}&quot; = &quot;xsparcv9&quot;; then</span>
<span class="line-removed">193       $1_CPU_LDFLAGS_JVM_ONLY=&quot;-xarch=sparc&quot;</span>
<span class="line-removed">194     fi</span>
<span class="line-removed">195 </span>
196   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
197     if test &quot;x${OPENJDK_$1_CPU}&quot; = &quot;xx86&quot;; then
198       $1_CPU_LDFLAGS=&quot;-safeseh&quot;
199       # NOTE: Old build added -machine. Probably not needed.
200       $1_CPU_LDFLAGS_JVM_ONLY=&quot;-machine:I386&quot;
201       $1_CPU_EXECUTABLE_LDFLAGS=&quot;-stack:327680&quot;
202     else
203       $1_CPU_LDFLAGS_JVM_ONLY=&quot;-machine:AMD64&quot;
204       $1_CPU_EXECUTABLE_LDFLAGS=&quot;-stack:1048576&quot;
205     fi
206   fi
207 
208   # JVM_VARIANT_PATH depends on if this is build or target...
209   if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
210     $1_LDFLAGS_JDK_LIBPATH=&quot;-libpath:${OUTPUTDIR}/support/modules_libs/java.base&quot;
211   else
212     $1_LDFLAGS_JDK_LIBPATH=&quot;-L\$(SUPPORT_OUTPUTDIR)/modules_libs/java.base \
213         -L\$(SUPPORT_OUTPUTDIR)/modules_libs/java.base/${$1_JVM_VARIANT_PATH}&quot;
214   fi
215 
</pre>
</td>
<td>
<hr />
<pre>
 71 
 72     # Add -z,defs, to forbid undefined symbols in object files.
 73     # add -z,relro (mark relocations read only) for all libs
 74     # add -z,now (&quot;full relro&quot; - more of the Global Offset Table GOT is marked read only)
 75     BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -Wl,-z,defs -Wl,-z,relro -Wl,-z,now&quot;
 76     # Linux : remove unused code+data in link step
 77     if test &quot;x$ENABLE_LINKTIME_GC&quot; = xtrue; then
 78       if test &quot;x$OPENJDK_TARGET_CPU&quot; = xs390x; then
 79         BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -Wl,--gc-sections -Wl,--print-gc-sections&quot;
 80       else
 81         BASIC_LDFLAGS_JDK_ONLY=&quot;$BASIC_LDFLAGS_JDK_ONLY -Wl,--gc-sections&quot;
 82       fi
 83     fi
 84 
 85     BASIC_LDFLAGS_JVM_ONLY=&quot;-Wl,-O1&quot;
 86 
 87   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
 88     BASIC_LDFLAGS_JVM_ONLY=&quot;-mno-omit-leaf-frame-pointer -mstack-alignment=16 \
 89         -fPIC&quot;
 90 








 91   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
 92     BASIC_LDFLAGS=&quot;-b64 -brtl -bnorwexec -bnolibpath -bexpall -bernotok -btextpsize:64K \
 93         -bdatapsize:64K -bstackpsize:64K&quot;
 94     # libjvm.so has gotten too large for normal TOC size; compile with qpic=large and link with bigtoc
 95     BASIC_LDFLAGS_JVM_ONLY=&quot;-Wl,-lC_r -bbigtoc&quot;
 96 
 97   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 98     BASIC_LDFLAGS=&quot;-nologo -opt:ref&quot;
 99     BASIC_LDFLAGS_JDK_ONLY=&quot;-incremental:no&quot;
100     BASIC_LDFLAGS_JVM_ONLY=&quot;-opt:icf,8 -subsystem:windows&quot;
101   fi
102 
103   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
104     if test -n &quot;$HAS_NOEXECSTACK&quot;; then
105       BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -Wl,-z,noexecstack&quot;
106     fi
107   fi
108 
109   # Setup OS-dependent LDFLAGS
110   if test &quot;x$TOOLCHAIN_TYPE&quot; = xclang || test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
</pre>
<hr />
<pre>
116     fi
117   fi
118 
119   # Setup debug level-dependent LDFLAGS
120   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
121     if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
122       if test x$DEBUG_LEVEL = xrelease; then
123         DEBUGLEVEL_LDFLAGS_JDK_ONLY=&quot;$DEBUGLEVEL_LDFLAGS_JDK_ONLY -Wl,-O1&quot;
124       fi
125     fi
126 
127   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
128     # We need &#39;-qminimaltoc&#39; or &#39;-qpic=large -bbigtoc&#39; if the TOC overflows.
129     # Hotspot now overflows its 64K TOC (currently only for debug),
130     # so we build with &#39;-qpic=large -bbigtoc&#39;.
131     if test &quot;x$DEBUG_LEVEL&quot; != xrelease; then
132       DEBUGLEVEL_LDFLAGS_JVM_ONLY=&quot;$DEBUGLEVEL_LDFLAGS_JVM_ONLY -bbigtoc&quot;
133     fi
134   fi
135 








136   # Setup LDFLAGS for linking executables
137   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
138     EXECUTABLE_LDFLAGS=&quot;$EXECUTABLE_LDFLAGS -Wl,--allow-shlib-undefined&quot;
139     # Enabling pie on 32 bit builds prevents the JVM from allocating a continuous
140     # java heap.
141     if test &quot;x$OPENJDK_TARGET_CPU_BITS&quot; != &quot;x32&quot;; then
142       EXECUTABLE_LDFLAGS=&quot;$EXECUTABLE_LDFLAGS -pie&quot;
143     fi
144   fi
145 
146   if test &quot;x$ALLOW_ABSOLUTE_PATHS_IN_OUTPUT&quot; = &quot;xfalse&quot;; then
147     if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
148       BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -pdbaltpath:%_PDB%&quot;
149     fi
150   fi
151 
152   # Export some intermediate variables for compatibility
153   LDFLAGS_CXX_JDK=&quot;$BASIC_LDFLAGS_ONLYCXX $BASIC_LDFLAGS_ONLYCXX_JDK_ONLY $DEBUGLEVEL_LDFLAGS_JDK_ONLY&quot;
154   AC_SUBST(LDFLAGS_CXX_JDK)
155   AC_SUBST(LIBJSIG_HASHSTYLE_LDFLAGS)
156   AC_SUBST(LIBJSIG_NOEXECSTACK_LDFLAGS)
157 ])
158 
159 ################################################################################
160 # $1 - Either BUILD or TARGET to pick the correct OS/CPU variables to check
161 #      conditionals against.
162 # $2 - Optional prefix for each variable defined.
163 AC_DEFUN([FLAGS_SETUP_LDFLAGS_CPU_DEP],
164 [
165   # Setup CPU-dependent basic LDFLAGS. These can differ between the target and
166   # build toolchain.
167   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
168     if test &quot;x${OPENJDK_$1_CPU}&quot; = xx86; then
169       $1_CPU_LDFLAGS_JVM_ONLY=&quot;-march=i586&quot;
170     elif test &quot;x$OPENJDK_$1_CPU&quot; = xarm; then
171       $1_CPU_LDFLAGS_JVM_ONLY=&quot;${$1_CPU_LDFLAGS_JVM_ONLY} -fsigned-char&quot;
172       $1_CPU_LDFLAGS=&quot;$ARM_ARCH_TYPE_FLAGS $ARM_FLOAT_TYPE_FLAGS&quot;
173     fi
174 





175   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
176     if test &quot;x${OPENJDK_$1_CPU}&quot; = &quot;xx86&quot;; then
177       $1_CPU_LDFLAGS=&quot;-safeseh&quot;
178       # NOTE: Old build added -machine. Probably not needed.
179       $1_CPU_LDFLAGS_JVM_ONLY=&quot;-machine:I386&quot;
180       $1_CPU_EXECUTABLE_LDFLAGS=&quot;-stack:327680&quot;
181     else
182       $1_CPU_LDFLAGS_JVM_ONLY=&quot;-machine:AMD64&quot;
183       $1_CPU_EXECUTABLE_LDFLAGS=&quot;-stack:1048576&quot;
184     fi
185   fi
186 
187   # JVM_VARIANT_PATH depends on if this is build or target...
188   if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
189     $1_LDFLAGS_JDK_LIBPATH=&quot;-libpath:${OUTPUTDIR}/support/modules_libs/java.base&quot;
190   else
191     $1_LDFLAGS_JDK_LIBPATH=&quot;-L\$(SUPPORT_OUTPUTDIR)/modules_libs/java.base \
192         -L\$(SUPPORT_OUTPUTDIR)/modules_libs/java.base/${$1_JVM_VARIANT_PATH}&quot;
193   fi
194 
</pre>
</td>
</tr>
</table>
<center><a href="flags-cflags.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="flags-other.m4.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>