<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames make/autoconf/flags.m4</title>
    <link rel="stylesheet" href="../../style.css" />
    <script type="text/javascript" src="../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 #
  2 # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 m4_include([flags-cflags.m4])
 27 m4_include([flags-ldflags.m4])
 28 m4_include([flags-other.m4])
 29 
 30 ################################################################################
 31 #
 32 # Setup ABI profile (for arm)
 33 #
 34 AC_DEFUN([FLAGS_SETUP_ABI_PROFILE],
 35 [
 36   AC_ARG_WITH(abi-profile, [AS_HELP_STRING([--with-abi-profile],
 37       [specify ABI profile for ARM builds (arm-vfp-sflt,arm-vfp-hflt,arm-sflt, armv5-vfp-sflt,armv6-vfp-hflt,aarch64) @&lt;:@toolchain dependent@:&gt;@ ])])
 38 
 39   if test &quot;x$with_abi_profile&quot; != x; then
 40     if test &quot;x$OPENJDK_TARGET_CPU&quot; != xarm &amp;&amp; \
 41         test &quot;x$OPENJDK_TARGET_CPU&quot; != xaarch64; then
 42       AC_MSG_ERROR([--with-abi-profile only available on arm/aarch64])
 43     fi
 44 
 45     OPENJDK_TARGET_ABI_PROFILE=$with_abi_profile
 46     AC_MSG_CHECKING([for ABI profle])
 47     AC_MSG_RESULT([$OPENJDK_TARGET_ABI_PROFILE])
 48 
 49     # --- Arm-sflt CFLAGS and ASFLAGS ---
 50     # Armv5te is required for assembler, because pld insn used in arm32 hotspot is only in v5E and above.
 51     # However, there is also a GCC bug which generates unaligned strd/ldrd instructions on armv5te:
 52     # https://gcc.gnu.org/bugzilla/show_bug.cgi?id=82445, and it was fixed in gcc 7.1.
 53     # The resulting compromise is to enable v5TE for assembler and let GCC generate code for v5T.
 54     if test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; = xarm-vfp-sflt; then
 55       ARM_FLOAT_TYPE=vfp-sflt
 56       ARM_ARCH_TYPE_FLAGS=&#39;-march=armv7-a -mthumb&#39;
 57       ARM_ARCH_TYPE_ASFLAGS=&#39;-march=armv7-a -mthumb&#39;
 58     elif test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; = xarm-vfp-hflt; then
 59       ARM_FLOAT_TYPE=vfp-hflt
 60       ARM_ARCH_TYPE_FLAGS=&#39;-march=armv7-a -mthumb&#39;
 61       ARM_ARCH_TYPE_ASFLAGS=&#39;-march=armv7-a -mthumb&#39;
 62     elif test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; = xarm-sflt; then
 63       ARM_FLOAT_TYPE=sflt
 64       ARM_ARCH_TYPE_FLAGS=&#39;-march=armv5t -marm&#39;
 65       ARM_ARCH_TYPE_ASFLAGS=&#39;-march=armv5te&#39;
 66     elif test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; = xarmv5-vfp-sflt; then
 67       ARM_FLOAT_TYPE=vfp-sflt
 68       ARM_ARCH_TYPE_FLAGS=&#39;-march=armv5t -marm&#39;
 69       ARM_ARCH_TYPE_ASFLAGS=&#39;-march=armv5te&#39;
 70     elif test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; = xarmv6-vfp-hflt; then
 71       ARM_FLOAT_TYPE=vfp-hflt
 72       ARM_ARCH_TYPE_FLAGS=&#39;-march=armv6 -marm&#39;
 73       ARM_ARCH_TYPE_ASFLAGS=&#39;-march=armv6&#39;
 74     elif test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; = xaarch64; then
 75       # No special flags, just need to trigger setting JDK_ARCH_ABI_PROP_NAME
 76       ARM_FLOAT_TYPE=
 77       ARM_ARCH_TYPE_FLAGS=
 78       ARM_ARCH_TYPE_ASFLAGS=
 79     else
 80       AC_MSG_ERROR([Invalid ABI profile: &quot;$OPENJDK_TARGET_ABI_PROFILE&quot;])
 81     fi
 82 
 83     if test &quot;x$ARM_FLOAT_TYPE&quot; = xvfp-sflt; then
 84       ARM_FLOAT_TYPE_FLAGS=&#39;-mfloat-abi=softfp -mfpu=vfp -DFLOAT_ARCH=-vfp-sflt&#39;
 85       ARM_FLOAT_TYPE_ASFLAGS=&quot;-mfloat-abi=softfp -mfpu=vfp&quot;
 86     elif test &quot;x$ARM_FLOAT_TYPE&quot; = xvfp-hflt; then
 87       ARM_FLOAT_TYPE_FLAGS=&#39;-mfloat-abi=hard -mfpu=vfp -DFLOAT_ARCH=-vfp-hflt&#39;
 88       ARM_FLOAT_TYPE_ASFLAGS=&quot;-mfloat-abi=hard -mfpu=vfp&quot;
 89     elif test &quot;x$ARM_FLOAT_TYPE&quot; = xsflt; then
 90       ARM_FLOAT_TYPE_FLAGS=&#39;-msoft-float -mfpu=vfp&#39;
 91       ARM_FLOAT_TYPE_ASFLAGS=&quot;-mfloat-abi=soft -mfpu=vfp&quot;
 92     fi
 93     AC_MSG_CHECKING([for $ARM_FLOAT_TYPE floating point flags])
 94     AC_MSG_RESULT([$ARM_FLOAT_TYPE_FLAGS])
 95     AC_MSG_CHECKING([for $ARM_FLOAT_TYPE floating point flags for assembler])
 96     AC_MSG_RESULT([$ARM_FLOAT_TYPE_ASFLAGS])
 97 
 98     AC_MSG_CHECKING([for arch type flags])
 99     AC_MSG_RESULT([$ARM_ARCH_TYPE_FLAGS])
100     AC_MSG_CHECKING([for arch type flags for assembler])
101     AC_MSG_RESULT([$ARM_ARCH_TYPE_ASFLAGS])
102 
103     # Now set JDK_ARCH_ABI_PROP_NAME. This is equivalent to the last part of the
104     # autoconf target triplet.
105     [ JDK_ARCH_ABI_PROP_NAME=`$ECHO $OPENJDK_TARGET_AUTOCONF_NAME | $SED -e &#39;s/.*-\([^-]*\)$/\1/&#39;` ]
106     # Sanity check that it is a known ABI.
107     if test &quot;x$JDK_ARCH_ABI_PROP_NAME&quot; != xgnu &amp;&amp; \
108         test &quot;x$JDK_ARCH_ABI_PROP_NAME&quot; != xgnueabi  &amp;&amp; \
109         test &quot;x$JDK_ARCH_ABI_PROP_NAME&quot; != xgnueabihf; then
110           AC_MSG_WARN([Unknown autoconf target triplet ABI: &quot;$JDK_ARCH_ABI_PROP_NAME&quot;])
111     fi
112     AC_MSG_CHECKING([for ABI property name])
113     AC_MSG_RESULT([$JDK_ARCH_ABI_PROP_NAME])
114     AC_SUBST(JDK_ARCH_ABI_PROP_NAME)
115   fi
116 
117   # When building with an abi profile, the name of that profile is appended on the
118   # bundle platform, which is used in bundle names.
119   if test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; != x; then
120     OPENJDK_TARGET_BUNDLE_PLATFORM=&quot;$OPENJDK_TARGET_OS_BUNDLE-$OPENJDK_TARGET_ABI_PROFILE&quot;
121   fi
122 ])
123 
124 AC_DEFUN([FLAGS_SETUP_MACOSX_VERSION],
125 [
126   # Additional macosx handling
127   if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
128     # MACOSX_VERSION_MIN specifies the lowest version of Macosx that the built
129     # binaries should be compatible with, even if compiled on a newer version
130     # of the OS. It currently has a hard coded value. Setting this also limits
131     # exposure to API changes in header files. Bumping this is likely to
132     # require code changes to build.
133     MACOSX_VERSION_MIN=10.9.0
134     MACOSX_VERSION_MIN_NODOTS=${MACOSX_VERSION_MIN//\./}
135 
136     AC_SUBST(MACOSX_VERSION_MIN)
137 
138     # Setting --with-macosx-version-max=&lt;version&gt; makes it an error to build or
139     # link to macosx APIs that are newer than the given OS version. The expected
140     # format for &lt;version&gt; is either nn.n.n or nn.nn.nn. See /usr/include/AvailabilityMacros.h.
141     AC_ARG_WITH([macosx-version-max], [AS_HELP_STRING([--with-macosx-version-max],
142         [error on use of newer functionality. @&lt;:@macosx@:&gt;@])],
143         [
144           if echo &quot;$with_macosx_version_max&quot; | $GREP -q &quot;^[[0-9]][[0-9]]\.[[0-9]]\.[[0-9]]\$&quot;; then
145               MACOSX_VERSION_MAX=$with_macosx_version_max
146           elif echo &quot;$with_macosx_version_max&quot; | $GREP -q &quot;^[[0-9]][[0-9]]\.[[0-9]][[0-9]]\.[[0-9]][[0-9]]\$&quot;; then
147               MACOSX_VERSION_MAX=$with_macosx_version_max
148           elif test &quot;x$with_macosx_version_max&quot; = &quot;xno&quot;; then
149               # Use build system default
150               MACOSX_VERSION_MAX=
151           else
152               AC_MSG_ERROR([osx version format must be nn.n.n or nn.nn.nn])
153           fi
154         ],
155         [MACOSX_VERSION_MAX=]
156     )
157     MACOSX_VERSION_MAX_NODOTS=${MACOSX_VERSION_MAX//\./}
158 
159     AC_SUBST(MACOSX_VERSION_MAX)
160   fi
161 ])
162 
163 # Reset the global CFLAGS/LDFLAGS variables and initialize them with the
164 # corresponding configure arguments instead
165 AC_DEFUN_ONCE([FLAGS_SETUP_USER_SUPPLIED_FLAGS],
166 [
167   if test &quot;x$CFLAGS&quot; != &quot;x&quot;; then
168     AC_MSG_WARN([Ignoring CFLAGS($CFLAGS) found in environment. Use --with-extra-cflags])
169   fi
170 
171   if test &quot;x$CXXFLAGS&quot; != &quot;x&quot;; then
172     AC_MSG_WARN([Ignoring CXXFLAGS($CXXFLAGS) found in environment. Use --with-extra-cxxflags])
173   fi
174 
175   if test &quot;x$LDFLAGS&quot; != &quot;x&quot;; then
176     AC_MSG_WARN([Ignoring LDFLAGS($LDFLAGS) found in environment. Use --with-extra-ldflags])
177   fi
178 
179   if test &quot;x$ASFLAGS&quot; != &quot;x&quot;; then
180     AC_MSG_WARN([Ignoring ASFLAGS($ASFLAGS) found in environment. Use --with-extra-asflags])
181   fi
182 
183   AC_ARG_WITH(extra-cflags, [AS_HELP_STRING([--with-extra-cflags],
184       [extra flags to be used when compiling jdk c-files])])
185 
186   AC_ARG_WITH(extra-cxxflags, [AS_HELP_STRING([--with-extra-cxxflags],
187       [extra flags to be used when compiling jdk c++-files])])
188 
189   AC_ARG_WITH(extra-ldflags, [AS_HELP_STRING([--with-extra-ldflags],
190       [extra flags to be used when linking jdk])])
191 
192   AC_ARG_WITH(extra-asflags, [AS_HELP_STRING([--with-extra-asflags],
193       [extra flags to be passed to the assembler])])
194 
195   USER_CFLAGS=&quot;$with_extra_cflags&quot;
196   USER_CXXFLAGS=&quot;$with_extra_cxxflags&quot;
197   USER_LDFLAGS=&quot;$with_extra_ldflags&quot;
198   USER_ASFLAGS=&quot;$with_extra_asflags&quot;
199 ])
200 
201 # Setup the sysroot flags and add them to global CFLAGS and LDFLAGS so
202 # that configure can use them while detecting compilers.
203 # TOOLCHAIN_TYPE is available here.
204 # Param 1 - Optional prefix to all variables. (e.g BUILD_)
205 AC_DEFUN([FLAGS_SETUP_SYSROOT_FLAGS],
206 [
207   if test &quot;x[$]$1SYSROOT&quot; != &quot;x&quot;; then
<a name="1" id="anc1"></a><span class="line-modified">208     if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then</span>




















209       $1SYSROOT_CFLAGS=&quot;--sysroot=[$]$1SYSROOT&quot;
210       $1SYSROOT_LDFLAGS=&quot;--sysroot=[$]$1SYSROOT&quot;
211     elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
212       $1SYSROOT_CFLAGS=&quot;-isysroot [$]$1SYSROOT&quot;
213       $1SYSROOT_LDFLAGS=&quot;-isysroot [$]$1SYSROOT&quot;
214     fi
215   fi
216 
217   if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
218     # We also need -iframework&lt;path&gt;/System/Library/Frameworks
219     $1SYSROOT_CFLAGS=&quot;[$]$1SYSROOT_CFLAGS -iframework [$]$1SYSROOT/System/Library/Frameworks&quot;
220     $1SYSROOT_LDFLAGS=&quot;[$]$1SYSROOT_LDFLAGS -iframework [$]$1SYSROOT/System/Library/Frameworks&quot;
221     # These always need to be set, or we can&#39;t find the frameworks embedded in JavaVM.framework
222     # set this here so it doesn&#39;t have to be peppered throughout the forest
223     $1SYSROOT_CFLAGS=&quot;[$]$1SYSROOT_CFLAGS -F [$]$1SYSROOT/System/Library/Frameworks/JavaVM.framework/Frameworks&quot;
224     $1SYSROOT_LDFLAGS=&quot;[$]$1SYSROOT_LDFLAGS -F [$]$1SYSROOT/System/Library/Frameworks/JavaVM.framework/Frameworks&quot;
225   fi
226 
227   AC_SUBST($1SYSROOT_CFLAGS)
228   AC_SUBST($1SYSROOT_LDFLAGS)
229 ])
230 
231 AC_DEFUN_ONCE([FLAGS_PRE_TOOLCHAIN],
232 [
233   # We should always include user supplied flags
234   FLAGS_SETUP_USER_SUPPLIED_FLAGS
235   # The sysroot flags are needed for configure to be able to run the compilers
236   FLAGS_SETUP_SYSROOT_FLAGS
237 
<a name="2" id="anc2"></a><span class="line-modified">238   # For xlc, the word size flag is required for correct behavior.</span>
239   # For clang/gcc, the flag is only strictly required for reduced builds, but
<a name="3" id="anc3"></a><span class="line-modified">240   # set it always where possible (x86 and ppc).</span>
241   if test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
242     MACHINE_FLAG=&quot;-q${OPENJDK_TARGET_CPU_BITS}&quot;
<a name="4" id="anc4"></a>

243   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
244     if test &quot;x$OPENJDK_TARGET_CPU_ARCH&quot; = xx86 &amp;&amp;
245         test &quot;x$OPENJDK_TARGET_CPU&quot; != xx32 ||
<a name="5" id="anc5"></a>
246         test &quot;x$OPENJDK_TARGET_CPU_ARCH&quot; = xppc; then
247       MACHINE_FLAG=&quot;-m${OPENJDK_TARGET_CPU_BITS}&quot;
248     fi
249   fi
250 
251   # FIXME: global flags are not used yet...
252   # The &quot;global&quot; flags will *always* be set. Without them, it is not possible to
253   # get a working compilation.
254   GLOBAL_CFLAGS=&quot;$MACHINE_FLAG $SYSROOT_CFLAGS $USER_CFLAGS&quot;
255   GLOBAL_CXXFLAGS=&quot;$MACHINE_FLAG $SYSROOT_CFLAGS $USER_CXXFLAGS&quot;
256   GLOBAL_LDFLAGS=&quot;$MACHINE_FLAG $SYSROOT_LDFLAGS $USER_LDFLAGS&quot;
257   # FIXME: Don&#39;t really know how to do with this, but this was the old behavior
258   if test &quot;x$OPENJDK_TARGET_OS&quot; = xios; then
259     GLOBAL_CPPFLAGS=&quot;$MACHINE_FLAG $USER_CFLAGS $SYSROOT_CFLAGS&quot;
260   else
261     GLOBAL_CPPFLAGS=&quot;$SYSROOT_CFLAGS&quot;
262   fi
263   AC_SUBST(GLOBAL_CFLAGS)
264   AC_SUBST(GLOBAL_CXXFLAGS)
265   AC_SUBST(GLOBAL_LDFLAGS)
266   AC_SUBST(GLOBAL_CPPFLAGS)
267 
268   # FIXME: For compatilibity, export this as EXTRA_CFLAGS for now.
269   EXTRA_CFLAGS=&quot;$MACHINE_FLAG $USER_CFLAGS&quot;
270   EXTRA_CXXFLAGS=&quot;$MACHINE_FLAG $USER_CXXFLAGS&quot;
271   EXTRA_LDFLAGS=&quot;$MACHINE_FLAG $USER_LDFLAGS&quot;
272   EXTRA_ASFLAGS=&quot;$USER_ASFLAGS&quot;
273 
274   AC_SUBST(EXTRA_CFLAGS)
275   AC_SUBST(EXTRA_CXXFLAGS)
276   AC_SUBST(EXTRA_LDFLAGS)
277   AC_SUBST(EXTRA_ASFLAGS)
278 
279   # For autoconf testing to work, the global flags must also be stored in the
280   # &quot;unnamed&quot; CFLAGS etc.
281   CFLAGS=&quot;$GLOBAL_CFLAGS&quot;
282   CXXFLAGS=&quot;$GLOBAL_CXXFLAGS&quot;
283   LDFLAGS=&quot;$GLOBAL_LDFLAGS&quot;
284   CPPFLAGS=&quot;$GLOBAL_CPPFLAGS&quot;
285 ])
286 
287 AC_DEFUN([FLAGS_SETUP_TOOLCHAIN_CONTROL],
288 [
289   # COMPILER_TARGET_BITS_FLAG  : option for selecting 32- or 64-bit output
290   # COMPILER_COMMAND_FILE_FLAG : option for passing a command file to the compiler
291   # COMPILER_BINDCMD_FILE_FLAG : option for specifying a file which saves the binder
292   #                              commands produced by the link step (currently AIX only)
293   if test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
294     COMPILER_TARGET_BITS_FLAG=&quot;-q&quot;
295     COMPILER_COMMAND_FILE_FLAG=&quot;-f&quot;
296     COMPILER_BINDCMD_FILE_FLAG=&quot;-bloadmap:&quot;
297   else
298     COMPILER_TARGET_BITS_FLAG=&quot;-m&quot;
299     COMPILER_COMMAND_FILE_FLAG=&quot;@&quot;
300     COMPILER_BINDCMD_FILE_FLAG=&quot;&quot;
301 
<a name="6" id="anc6"></a>




302     # Check if @file is supported by gcc
303     if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
304       AC_MSG_CHECKING([if @file is supported by gcc])
305       # Extra emtpy &quot;&quot; to prevent ECHO from interpreting &#39;--version&#39; as argument
306       $ECHO &quot;&quot; &quot;--version&quot; &gt; command.file
307       if $CXX @command.file 2&gt;&amp;AS_MESSAGE_LOG_FD &gt;&amp;AS_MESSAGE_LOG_FD; then
308         AC_MSG_RESULT(yes)
309         COMPILER_COMMAND_FILE_FLAG=&quot;@&quot;
310       else
311         AC_MSG_RESULT(no)
312         COMPILER_COMMAND_FILE_FLAG=
313       fi
314       $RM command.file
315     fi
316   fi
317 
318   AC_SUBST(COMPILER_TARGET_BITS_FLAG)
319   AC_SUBST(COMPILER_COMMAND_FILE_FLAG)
320   AC_SUBST(COMPILER_BINDCMD_FILE_FLAG)
321 
322   # Check that the compiler supports -mX (or -qX on AIX) flags
323   # Set COMPILER_SUPPORTS_TARGET_BITS_FLAG to &#39;true&#39; if it does
324   FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${COMPILER_TARGET_BITS_FLAG}${OPENJDK_TARGET_CPU_BITS}],
325       IF_TRUE: [COMPILER_SUPPORTS_TARGET_BITS_FLAG=true],
326       IF_FALSE: [COMPILER_SUPPORTS_TARGET_BITS_FLAG=false])
327   AC_SUBST(COMPILER_SUPPORTS_TARGET_BITS_FLAG)
328 
329   if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
330     CC_OUT_OPTION=-Fo
331     LD_OUT_OPTION=-out:
332     AR_OUT_OPTION=-out:
333   else
334     # The option used to specify the target .o,.a or .so file.
335     # When compiling, how to specify the to be created object file.
336     CC_OUT_OPTION=&#39;-o$(SPACE)&#39;
337     # When linking, how to specify the output
338     LD_OUT_OPTION=&#39;-o$(SPACE)&#39;
339     # When archiving, how to specify the destination static archive.
340     if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
341       AR_OUT_OPTION=&#39;-r -cs$(SPACE)&#39;
342     else
343       AR_OUT_OPTION=&#39;-rcs$(SPACE)&#39;
344     fi
345   fi
346   AC_SUBST(CC_OUT_OPTION)
347   AC_SUBST(LD_OUT_OPTION)
348   AC_SUBST(AR_OUT_OPTION)
349 
350   # Generate make dependency files
351   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
352     C_FLAG_DEPS=&quot;-MMD -MF&quot;
353   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
354     C_FLAG_DEPS=&quot;-MMD -MF&quot;
<a name="7" id="anc7"></a>

355   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
356     C_FLAG_DEPS=&quot;-qmakedep=gcc -MF&quot;
357   fi
358   CXX_FLAG_DEPS=&quot;$C_FLAG_DEPS&quot;
359   AC_SUBST(C_FLAG_DEPS)
360   AC_SUBST(CXX_FLAG_DEPS)
361 ])
362 
363 AC_DEFUN_ONCE([FLAGS_POST_TOOLCHAIN],
364 [
365   FLAGS_SETUP_TOOLCHAIN_CONTROL
366 
367   if test &quot;x$BUILD_SYSROOT&quot; != x; then
368     FLAGS_SETUP_SYSROOT_FLAGS([BUILD_])
369   else
370     if test &quot;x$COMPILE_TYPE&quot; != &quot;xcross&quot;; then
371       BUILD_SYSROOT_CFLAGS=&quot;$SYSROOT_CFLAGS&quot;
372       BUILD_SYSROOT_LDFLAGS=&quot;$SYSROOT_LDFLAGS&quot;
373     fi
374   fi
375   AC_SUBST(BUILD_SYSROOT_CFLAGS)
376   AC_SUBST(BUILD_SYSROOT_LDFLAGS)
377 
378 ])
379 
380 AC_DEFUN([FLAGS_SETUP_FLAGS],
381 [
382   FLAGS_SETUP_MACOSX_VERSION
383   FLAGS_SETUP_ABI_PROFILE
384 
385   FLAGS_SETUP_SHARED_LIBS
386   FLAGS_SETUP_DEBUG_SYMBOLS
387   FLAGS_SETUP_WARNINGS
388   FLAGS_SETUP_QUALITY_CHECKS
389   FLAGS_SETUP_OPTIMIZATION
390 
391   FLAGS_SETUP_CFLAGS
392   FLAGS_SETUP_LDFLAGS
393 
394   FLAGS_SETUP_ARFLAGS
395   FLAGS_SETUP_STRIPFLAGS
396   FLAGS_SETUP_RCFLAGS
397 
398   FLAGS_SETUP_ASFLAGS
399   FLAGS_SETUP_ASFLAGS_CPU_DEP([TARGET])
400   FLAGS_SETUP_ASFLAGS_CPU_DEP([BUILD], [OPENJDK_BUILD_])
401 ])
402 
403 # FLAGS_C_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [ARGUMENT], IF_TRUE: [RUN-IF-TRUE],
404 #                                  IF_FALSE: [RUN-IF-FALSE])
405 # ------------------------------------------------------------
406 # Check that the C compiler supports an argument
407 UTIL_DEFUN_NAMED([FLAGS_C_COMPILER_CHECK_ARGUMENTS],
408     [*ARGUMENT IF_TRUE IF_FALSE PREFIX], [$@],
409 [
410   AC_MSG_CHECKING([if ARG_PREFIX[CC] supports &quot;ARG_ARGUMENT&quot;])
411   supports=yes
412 
413   saved_cflags=&quot;$CFLAGS&quot;
414   saved_cc=&quot;$CC&quot;
415   CFLAGS=&quot;$CFLAGS $CFLAGS_WARNINGS_ARE_ERRORS ARG_ARGUMENT&quot;
416   CC=&quot;$ARG_PREFIX[CC]&quot;
417   AC_LANG_PUSH([C])
418   AC_COMPILE_IFELSE([AC_LANG_SOURCE([[int i;]])], [],
419       [supports=no])
420   AC_LANG_POP([C])
421   CC=&quot;$saved_cc&quot;
422   CFLAGS=&quot;$saved_cflags&quot;
423 
424   AC_MSG_RESULT([$supports])
425   if test &quot;x$supports&quot; = &quot;xyes&quot; ; then
426     :
427     ARG_IF_TRUE
428   else
429     :
430     ARG_IF_FALSE
431   fi
432 ])
433 
434 # FLAGS_CXX_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [ARGUMENT], IF_TRUE: [RUN-IF-TRUE],
435 #                                    IF_FALSE: [RUN-IF-FALSE])
436 # ------------------------------------------------------------
437 # Check that the C++ compiler supports an argument
438 UTIL_DEFUN_NAMED([FLAGS_CXX_COMPILER_CHECK_ARGUMENTS],
439     [*ARGUMENT IF_TRUE IF_FALSE PREFIX], [$@],
440 [
441   AC_MSG_CHECKING([if ARG_PREFIX[CXX] supports &quot;ARG_ARGUMENT&quot;])
442   supports=yes
443 
444   saved_cxxflags=&quot;$CXXFLAGS&quot;
445   saved_cxx=&quot;$CXX&quot;
446   CXXFLAGS=&quot;$CXXFLAG $CFLAGS_WARNINGS_ARE_ERRORS ARG_ARGUMENT&quot;
447   CXX=&quot;$ARG_PREFIX[CXX]&quot;
448   AC_LANG_PUSH([C++])
449   AC_COMPILE_IFELSE([AC_LANG_SOURCE([[int i;]])], [],
450       [supports=no])
451   AC_LANG_POP([C++])
452   CXX=&quot;$saved_cxx&quot;
453   CXXFLAGS=&quot;$saved_cxxflags&quot;
454 
455   AC_MSG_RESULT([$supports])
456   if test &quot;x$supports&quot; = &quot;xyes&quot; ; then
457     :
458     ARG_IF_TRUE
459   else
460     :
461     ARG_IF_FALSE
462   fi
463 ])
464 
465 # FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [ARGUMENT], IF_TRUE: [RUN-IF-TRUE],
466 #                                IF_FALSE: [RUN-IF-FALSE])
467 # ------------------------------------------------------------
468 # Check that the C and C++ compilers support an argument
469 UTIL_DEFUN_NAMED([FLAGS_COMPILER_CHECK_ARGUMENTS],
470     [*ARGUMENT IF_TRUE IF_FALSE PREFIX], [$@],
471 [
472   FLAGS_C_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [ARG_ARGUMENT],
473       IF_TRUE: [C_COMP_SUPPORTS=&quot;yes&quot;],
474       IF_FALSE: [C_COMP_SUPPORTS=&quot;no&quot;],
475       PREFIX: [ARG_PREFIX])
476   FLAGS_CXX_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [ARG_ARGUMENT],
477       IF_TRUE: [CXX_COMP_SUPPORTS=&quot;yes&quot;],
478       IF_FALSE: [CXX_COMP_SUPPORTS=&quot;no&quot;],
479       PREFIX: [ARG_PREFIX])
480 
481   AC_MSG_CHECKING([if both ARG_PREFIX[CC] and ARG_PREFIX[CXX] support &quot;ARG_ARGUMENT&quot;])
482   supports=no
483   if test &quot;x$C_COMP_SUPPORTS&quot; = &quot;xyes&quot; -a &quot;x$CXX_COMP_SUPPORTS&quot; = &quot;xyes&quot;; then
484     supports=yes;
485   fi
486 
487   AC_MSG_RESULT([$supports])
488   if test &quot;x$supports&quot; = &quot;xyes&quot; ; then
489     :
490     ARG_IF_TRUE
491   else
492     :
493     ARG_IF_FALSE
494   fi
495 ])
496 
497 # FLAGS_LINKER_CHECK_ARGUMENTS(ARGUMENT: [ARGUMENT], IF_TRUE: [RUN-IF-TRUE],
498 #                                   IF_FALSE: [RUN-IF-FALSE])
499 # ------------------------------------------------------------
500 # Check that the linker support an argument
501 UTIL_DEFUN_NAMED([FLAGS_LINKER_CHECK_ARGUMENTS],
502     [*ARGUMENT IF_TRUE IF_FALSE], [$@],
503 [
504   AC_MSG_CHECKING([if linker supports &quot;ARG_ARGUMENT&quot;])
505   supports=yes
506 
507   saved_ldflags=&quot;$LDFLAGS&quot;
508   LDFLAGS=&quot;$LDFLAGS ARG_ARGUMENT&quot;
509   AC_LANG_PUSH([C])
510   AC_LINK_IFELSE([AC_LANG_PROGRAM([[]],[[]])],
511       [], [supports=no])
512   AC_LANG_POP([C])
513   LDFLAGS=&quot;$saved_ldflags&quot;
514 
515   AC_MSG_RESULT([$supports])
516   if test &quot;x$supports&quot; = &quot;xyes&quot; ; then
517     :
518     ARG_IF_TRUE
519   else
520     :
521     ARG_IF_FALSE
522   fi
523 ])
<a name="8" id="anc8"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="8" type="hidden" />
</body>
</html>