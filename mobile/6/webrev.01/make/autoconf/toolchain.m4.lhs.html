<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames make/autoconf/toolchain.m4</title>
    <link rel="stylesheet" href="../../style.css" />
    <script type="text/javascript" src="../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 #
   2 # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.
   3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4 #
   5 # This code is free software; you can redistribute it and/or modify it
   6 # under the terms of the GNU General Public License version 2 only, as
   7 # published by the Free Software Foundation.  Oracle designates this
   8 # particular file as subject to the &quot;Classpath&quot; exception as provided
   9 # by Oracle in the LICENSE file that accompanied this code.
  10 #
  11 # This code is distributed in the hope that it will be useful, but WITHOUT
  12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14 # version 2 for more details (a copy is included in the LICENSE file that
  15 # accompanied this code).
  16 #
  17 # You should have received a copy of the GNU General Public License version
  18 # 2 along with this work; if not, write to the Free Software Foundation,
  19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20 #
  21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22 # or visit www.oracle.com if you need additional information or have any
  23 # questions.
  24 #
  25 
  26 ########################################################################
  27 # This file is responsible for detecting, verifying and setting up the
  28 # toolchain, i.e. the compiler, linker and related utilities. It will setup
  29 # proper paths to the binaries, but it will not setup any flags.
  30 #
  31 # The binaries used is determined by the toolchain type, which is the family of
  32 # compilers and related tools that are used.
  33 ########################################################################
  34 
  35 m4_include([toolchain_windows.m4])
  36 
  37 # All valid toolchains, regardless of platform (used by help.m4)
<a name="1" id="anc1"></a><span class="line-modified">  38 VALID_TOOLCHAINS_all=&quot;gcc clang solstudio xlc microsoft&quot;</span>
  39 
  40 # These toolchains are valid on different platforms
  41 VALID_TOOLCHAINS_linux=&quot;gcc clang&quot;
<a name="2" id="anc2"></a><span class="line-removed">  42 VALID_TOOLCHAINS_solaris=&quot;solstudio&quot;</span>
  43 VALID_TOOLCHAINS_macosx=&quot;gcc clang&quot;
  44 VALID_TOOLCHAINS_aix=&quot;xlc&quot;
  45 VALID_TOOLCHAINS_windows=&quot;microsoft&quot;
  46 
  47 # Toolchain descriptions
  48 TOOLCHAIN_DESCRIPTION_clang=&quot;clang/LLVM&quot;
  49 TOOLCHAIN_DESCRIPTION_gcc=&quot;GNU Compiler Collection&quot;
  50 TOOLCHAIN_DESCRIPTION_microsoft=&quot;Microsoft Visual Studio&quot;
<a name="3" id="anc3"></a><span class="line-removed">  51 TOOLCHAIN_DESCRIPTION_solstudio=&quot;Oracle Solaris Studio&quot;</span>
  52 TOOLCHAIN_DESCRIPTION_xlc=&quot;IBM XL C/C++&quot;
  53 
  54 # Minimum supported versions, empty means unspecified
  55 TOOLCHAIN_MINIMUM_VERSION_clang=&quot;3.2&quot;
  56 TOOLCHAIN_MINIMUM_VERSION_gcc=&quot;5.0&quot;
  57 TOOLCHAIN_MINIMUM_VERSION_microsoft=&quot;16.00.30319.01&quot; # VS2010
<a name="4" id="anc4"></a><span class="line-removed">  58 TOOLCHAIN_MINIMUM_VERSION_solstudio=&quot;5.13&quot;</span>
  59 TOOLCHAIN_MINIMUM_VERSION_xlc=&quot;&quot;
  60 
  61 # Minimum supported linker versions, empty means unspecified
  62 TOOLCHAIN_MINIMUM_LD_VERSION_gcc=&quot;2.18&quot;
  63 
  64 # Prepare the system so that TOOLCHAIN_CHECK_COMPILER_VERSION can be called.
  65 # Must have CC_VERSION_NUMBER and CXX_VERSION_NUMBER.
  66 # $1 - optional variable prefix for compiler and version variables (BUILD_)
  67 # $2 - optional variable prefix for comparable variable (OPENJDK_BUILD_)
  68 # $3 - optional human readable description for the type of compilers (&quot;build &quot; or &quot;&quot;)
  69 AC_DEFUN([TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS],
  70 [
  71   if test &quot;x[$]$1CC_VERSION_NUMBER&quot; != &quot;x[$]$1CXX_VERSION_NUMBER&quot;; then
  72     AC_MSG_WARN([The $3C and C++ compilers have different version numbers, [$]$1CC_VERSION_NUMBER vs [$]$1CXX_VERSION_NUMBER.])
  73     AC_MSG_WARN([This typically indicates a broken setup, and is not supported])
  74   fi
  75 
  76   # We only check CC_VERSION_NUMBER since we assume CXX_VERSION_NUMBER is equal.
  77   if [ [[ &quot;[$]$1CC_VERSION_NUMBER&quot; =~ (.*\.){4} ]] ]; then
  78     AC_MSG_WARN([C compiler version number has more than four parts (W.X.Y.Z): [$]$1CC_VERSION_NUMBER. Comparisons might be wrong.])
  79   fi
  80 
  81   if [ [[  &quot;[$]$1CC_VERSION_NUMBER&quot; =~ [0-9]{6} ]] ]; then
  82     AC_MSG_WARN([C compiler version number has a part larger than 99999: [$]$1CC_VERSION_NUMBER. Comparisons might be wrong.])
  83   fi
  84 
  85   $2COMPARABLE_ACTUAL_VERSION=`$AWK -F. &#39;{ printf(&quot;%05d%05d%05d%05d\n&quot;, [$]1, [$]2, [$]3, [$]4) }&#39; &lt;&lt;&lt; &quot;[$]$1CC_VERSION_NUMBER&quot;`
  86 ])
  87 
  88 # Check if the configured compiler (C and C++) is of a specific version or
  89 # newer. TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS must have been called before.
  90 #
  91 # Arguments:
  92 #   VERSION:   The version string to check against the found version
  93 #   IF_AT_LEAST:   block to run if the compiler is at least this version (&gt;=)
  94 #   IF_OLDER_THAN:   block to run if the compiler is older than this version (&lt;)
  95 #   PREFIX:   Optional variable prefix for compiler to compare version for (OPENJDK_BUILD_)
  96 UTIL_DEFUN_NAMED([TOOLCHAIN_CHECK_COMPILER_VERSION],
  97     [*VERSION PREFIX IF_AT_LEAST IF_OLDER_THAN], [$@],
  98 [
  99   # Need to assign to a variable since m4 is blocked from modifying parts in [].
 100   REFERENCE_VERSION=ARG_VERSION
 101 
 102   if [ [[ &quot;$REFERENCE_VERSION&quot; =~ (.*\.){4} ]] ]; then
 103     AC_MSG_ERROR([Internal error: Cannot compare to ARG_VERSION, only four parts (W.X.Y.Z) is supported])
 104   fi
 105 
 106   if [ [[ &quot;$REFERENCE_VERSION&quot; =~ [0-9]{6} ]] ]; then
 107     AC_MSG_ERROR([Internal error: Cannot compare to ARG_VERSION, only parts &lt; 99999 is supported])
 108   fi
 109 
 110   # Version comparison method inspired by http://stackoverflow.com/a/24067243
 111   COMPARABLE_REFERENCE_VERSION=`$AWK -F. &#39;{ printf(&quot;%05d%05d%05d%05d\n&quot;, [$]1, [$]2, [$]3, [$]4) }&#39; &lt;&lt;&lt; &quot;$REFERENCE_VERSION&quot;`
 112 
 113   if test [$]ARG_PREFIX[COMPARABLE_ACTUAL_VERSION] -ge $COMPARABLE_REFERENCE_VERSION ; then
 114     :
 115     ARG_IF_AT_LEAST
 116   else
 117     :
 118     ARG_IF_OLDER_THAN
 119   fi
 120 ])
 121 
 122 # Prepare the system so that TOOLCHAIN_CHECK_COMPILER_VERSION can be called.
 123 # Must have LD_VERSION_NUMBER.
 124 # $1 - optional variable prefix for compiler and version variables (BUILD_)
 125 # $2 - optional variable prefix for comparable variable (OPENJDK_BUILD_)
 126 AC_DEFUN([TOOLCHAIN_PREPARE_FOR_LD_VERSION_COMPARISONS],
 127 [
 128   if [ [[ &quot;[$]$1LD_VERSION_NUMBER&quot; =~ (.*\.){4} ]] ]; then
 129     AC_MSG_WARN([Linker version number has more than four parts (W.X.Y.Z): [$]$1LD_VERSION_NUMBER. Comparisons might be wrong.])
 130   fi
 131 
 132   if [ [[  &quot;[$]$1LD_VERSION_NUMBER&quot; =~ [0-9]{6} ]] ]; then
 133     AC_MSG_WARN([Linker version number has a part larger than 99999: [$]$1LD_VERSION_NUMBER. Comparisons might be wrong.])
 134   fi
 135 
 136   $2COMPARABLE_ACTUAL_LD_VERSION=`$AWK -F. &#39;{ printf(&quot;%05d%05d%05d%05d\n&quot;, [$]1, [$]2, [$]3, [$]4) }&#39; &lt;&lt;&lt; &quot;[$]$1LD_VERSION_NUMBER&quot;`
 137 ])
 138 
 139 # Check if the configured linker is of a specific version or
 140 # newer. TOOLCHAIN_PREPARE_FOR_LD_VERSION_COMPARISONS must have been called before.
 141 #
 142 # Arguments:
 143 #   VERSION:   The version string to check against the found version
 144 #   IF_AT_LEAST:   block to run if the compiler is at least this version (&gt;=)
 145 #   IF_OLDER_THAN:   block to run if the compiler is older than this version (&lt;)
 146 #   PREFIX:   Optional variable prefix for compiler to compare version for (OPENJDK_BUILD_)
 147 UTIL_DEFUN_NAMED([TOOLCHAIN_CHECK_LINKER_VERSION],
 148     [*VERSION PREFIX IF_AT_LEAST IF_OLDER_THAN], [$@],
 149 [
 150   # Need to assign to a variable since m4 is blocked from modifying parts in [].
 151   REFERENCE_VERSION=ARG_VERSION
 152 
 153   if [ [[ &quot;$REFERENCE_VERSION&quot; =~ (.*\.){4} ]] ]; then
 154     AC_MSG_ERROR([Internal error: Cannot compare to ARG_VERSION, only four parts (W.X.Y.Z) is supported])
 155   fi
 156 
 157   if [ [[ &quot;$REFERENCE_VERSION&quot; =~ [0-9]{6} ]] ]; then
 158     AC_MSG_ERROR([Internal error: Cannot compare to ARG_VERSION, only parts &lt; 99999 is supported])
 159   fi
 160 
 161   # Version comparison method inspired by http://stackoverflow.com/a/24067243
 162   COMPARABLE_REFERENCE_VERSION=`$AWK -F. &#39;{ printf(&quot;%05d%05d%05d%05d\n&quot;, [$]1, [$]2, [$]3, [$]4) }&#39; &lt;&lt;&lt; &quot;$REFERENCE_VERSION&quot;`
 163 
 164   if test [$]ARG_PREFIX[COMPARABLE_ACTUAL_LD_VERSION] -ge $COMPARABLE_REFERENCE_VERSION ; then
 165     :
 166     ARG_IF_AT_LEAST
 167   else
 168     :
 169     ARG_IF_OLDER_THAN
 170   fi
 171 ])
 172 
 173 # Setup a number of variables describing how native output files are
 174 # named on this platform/toolchain.
 175 AC_DEFUN([TOOLCHAIN_SETUP_FILENAME_PATTERNS],
 176 [
 177   # Define filename patterns
 178   if test &quot;x$OPENJDK_TARGET_OS&quot; = xwindows; then
 179     LIBRARY_PREFIX=
 180     SHARED_LIBRARY_SUFFIX=&#39;.dll&#39;
 181     STATIC_LIBRARY_SUFFIX=&#39;.lib&#39;
 182     SHARED_LIBRARY=&#39;[$]1.dll&#39;
 183     STATIC_LIBRARY=&#39;[$]1.lib&#39;
 184     OBJ_SUFFIX=&#39;.obj&#39;
 185   else
 186     LIBRARY_PREFIX=lib
 187     SHARED_LIBRARY_SUFFIX=&#39;.so&#39;
 188     STATIC_LIBRARY_SUFFIX=&#39;.a&#39;
 189     SHARED_LIBRARY=&#39;lib[$]1.so&#39;
 190     STATIC_LIBRARY=&#39;lib[$]1.a&#39;
 191     OBJ_SUFFIX=&#39;.o&#39;
 192     if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xmacosx&quot; || test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xios&quot; ; then
 193       # For full static builds, we&#39;re overloading the SHARED_LIBRARY
 194       # variables in order to limit the amount of changes required.
 195       # It would be better to remove SHARED and just use LIBRARY and
 196       # LIBRARY_SUFFIX for libraries that can be built either
 197       # shared or static and use STATIC_* for libraries that are
 198       # always built statically.
 199       if test &quot;x$STATIC_BUILD&quot; = xtrue; then
 200         SHARED_LIBRARY=&#39;lib[$]1.a&#39;
 201         SHARED_LIBRARY_SUFFIX=&#39;.a&#39;
 202       else
 203         SHARED_LIBRARY=&#39;lib[$]1.dylib&#39;
 204         SHARED_LIBRARY_SUFFIX=&#39;.dylib&#39;
 205       fi
 206     fi
 207   fi
 208 
 209   AC_SUBST(LIBRARY_PREFIX)
 210   AC_SUBST(SHARED_LIBRARY_SUFFIX)
 211   AC_SUBST(STATIC_LIBRARY_SUFFIX)
 212   AC_SUBST(SHARED_LIBRARY)
 213   AC_SUBST(STATIC_LIBRARY)
 214   AC_SUBST(OBJ_SUFFIX)
 215 ])
 216 
 217 # Determine which toolchain type to use, and make sure it is valid for this
 218 # platform. Setup various information about the selected toolchain.
 219 AC_DEFUN_ONCE([TOOLCHAIN_DETERMINE_TOOLCHAIN_TYPE],
 220 [
 221   AC_ARG_WITH(toolchain-type, [AS_HELP_STRING([--with-toolchain-type],
 222       [the toolchain type (or family) to use, use &#39;--help&#39; to show possible values @&lt;:@platform dependent@:&gt;@])])
 223 
 224   # Use indirect variable referencing
 225   toolchain_var_name=VALID_TOOLCHAINS_$OPENJDK_BUILD_OS
 226   VALID_TOOLCHAINS=${!toolchain_var_name}
 227 
 228   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xmacosx&quot; || test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xios&quot; ; then
 229     if test -n &quot;$XCODEBUILD&quot;; then
 230       # On Mac OS X, default toolchain to clang after Xcode 5
 231       XCODE_VERSION_OUTPUT=`&quot;$XCODEBUILD&quot; -version 2&gt;&amp;1 | $HEAD -n 1`
 232       $ECHO &quot;$XCODE_VERSION_OUTPUT&quot; | $GREP &quot;Xcode &quot; &gt; /dev/null
 233       if test $? -ne 0; then
 234         AC_MSG_NOTICE([xcodebuild output: $XCODE_VERSION_OUTPUT])
 235         AC_MSG_ERROR([Failed to determine Xcode version.])
 236       fi
 237       XCODE_MAJOR_VERSION=`$ECHO $XCODE_VERSION_OUTPUT | \
 238           $SED -e &#39;s/^Xcode \(@&lt;:@1-9@:&gt;@@&lt;:@0-9.@:&gt;@*\)/\1/&#39; | \
 239           $CUT -f 1 -d .`
 240       AC_MSG_NOTICE([Xcode major version: $XCODE_MAJOR_VERSION])
 241       if test $XCODE_MAJOR_VERSION -ge 5; then
 242           DEFAULT_TOOLCHAIN=&quot;clang&quot;
 243       else
 244           DEFAULT_TOOLCHAIN=&quot;gcc&quot;
 245       fi
 246     else
 247       # If Xcode is not installed, but the command line tools are
 248       # then we can&#39;t run xcodebuild. On these systems we should
 249       # default to clang
 250       DEFAULT_TOOLCHAIN=&quot;clang&quot;
 251     fi
 252   else
 253     # First toolchain type in the list is the default
 254     DEFAULT_TOOLCHAIN=${VALID_TOOLCHAINS%% *}
 255   fi
 256 
 257   if test &quot;x$with_toolchain_type&quot; = xlist; then
 258     # List all toolchains
 259     AC_MSG_NOTICE([The following toolchains are valid on this platform:])
 260     for toolchain in $VALID_TOOLCHAINS; do
 261       toolchain_var_name=TOOLCHAIN_DESCRIPTION_$toolchain
 262       TOOLCHAIN_DESCRIPTION=${!toolchain_var_name}
 263       $PRINTF &quot;  %-10s  %s\n&quot; $toolchain &quot;$TOOLCHAIN_DESCRIPTION&quot;
 264     done
 265 
 266     exit 0
 267   elif test &quot;x$with_toolchain_type&quot; != x; then
 268     # User override; check that it is valid
 269     if test &quot;x${VALID_TOOLCHAINS/$with_toolchain_type/}&quot; = &quot;x${VALID_TOOLCHAINS}&quot;; then
 270       AC_MSG_NOTICE([Toolchain type $with_toolchain_type is not valid on this platform.])
 271       AC_MSG_NOTICE([Valid toolchains: $VALID_TOOLCHAINS.])
 272       AC_MSG_ERROR([Cannot continue.])
 273     fi
 274     TOOLCHAIN_TYPE=$with_toolchain_type
 275   else
 276     # No flag given, use default
 277     TOOLCHAIN_TYPE=$DEFAULT_TOOLCHAIN
 278   fi
 279   AC_SUBST(TOOLCHAIN_TYPE)
 280 
 281   # on AIX, check for xlclang++ on the PATH and TOOLCHAIN_PATH and use it if it is available
 282   if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
 283     if test &quot;x$TOOLCHAIN_PATH&quot; != x; then
 284       XLC_TEST_PATH=${TOOLCHAIN_PATH}/
 285     fi
 286 
 287     XLCLANG_VERSION_OUTPUT=`${XLC_TEST_PATH}xlclang++ -qversion 2&gt;&amp;1 | $HEAD -n 1`
 288     $ECHO &quot;$XLCLANG_VERSION_OUTPUT&quot; | $GREP &quot;IBM XL C/C++ for AIX&quot; &gt; /dev/null
 289     if test $? -eq 0; then
 290       AC_MSG_NOTICE([xlclang++ output: $XLCLANG_VERSION_OUTPUT])
 291     else
 292       AC_MSG_ERROR([xlclang++ version output check failed, output: $XLCLANG_VERSION_OUTPUT])
 293     fi
 294   fi
 295 
 296   TOOLCHAIN_CC_BINARY_clang=&quot;clang&quot;
 297   TOOLCHAIN_CC_BINARY_gcc=&quot;gcc&quot;
 298   TOOLCHAIN_CC_BINARY_microsoft=&quot;cl$EXE_SUFFIX&quot;
<a name="5" id="anc5"></a><span class="line-removed"> 299   TOOLCHAIN_CC_BINARY_solstudio=&quot;cc&quot;</span>
 300   TOOLCHAIN_CC_BINARY_xlc=&quot;xlclang&quot;
 301 
 302   TOOLCHAIN_CXX_BINARY_clang=&quot;clang++&quot;
 303   TOOLCHAIN_CXX_BINARY_gcc=&quot;g++&quot;
 304   TOOLCHAIN_CXX_BINARY_microsoft=&quot;cl$EXE_SUFFIX&quot;
<a name="6" id="anc6"></a><span class="line-removed"> 305   TOOLCHAIN_CXX_BINARY_solstudio=&quot;CC&quot;</span>
 306   TOOLCHAIN_CXX_BINARY_xlc=&quot;xlclang++&quot;
 307 
 308   # Use indirect variable referencing
 309   toolchain_var_name=TOOLCHAIN_DESCRIPTION_$TOOLCHAIN_TYPE
 310   TOOLCHAIN_DESCRIPTION=${!toolchain_var_name}
 311   toolchain_var_name=TOOLCHAIN_MINIMUM_VERSION_$TOOLCHAIN_TYPE
 312   TOOLCHAIN_MINIMUM_VERSION=${!toolchain_var_name}
 313   toolchain_var_name=TOOLCHAIN_MINIMUM_LD_VERSION_$TOOLCHAIN_TYPE
 314   TOOLCHAIN_MINIMUM_LD_VERSION=${!toolchain_var_name}
 315   toolchain_var_name=TOOLCHAIN_CC_BINARY_$TOOLCHAIN_TYPE
 316   TOOLCHAIN_CC_BINARY=${!toolchain_var_name}
 317   toolchain_var_name=TOOLCHAIN_CXX_BINARY_$TOOLCHAIN_TYPE
 318   TOOLCHAIN_CXX_BINARY=${!toolchain_var_name}
 319 
 320   TOOLCHAIN_SETUP_FILENAME_PATTERNS
 321 
 322   if test &quot;x$TOOLCHAIN_TYPE&quot; = &quot;x$DEFAULT_TOOLCHAIN&quot;; then
 323     AC_MSG_NOTICE([Using default toolchain $TOOLCHAIN_TYPE ($TOOLCHAIN_DESCRIPTION)])
 324   else
 325     AC_MSG_NOTICE([Using user selected toolchain $TOOLCHAIN_TYPE ($TOOLCHAIN_DESCRIPTION). Default toolchain is $DEFAULT_TOOLCHAIN.])
 326   fi
 327 ])
 328 
 329 # Before we start detecting the toolchain executables, we might need some
 330 # special setup, e.g. additional paths etc.
 331 AC_DEFUN_ONCE([TOOLCHAIN_PRE_DETECTION],
 332 [
 333   # FIXME: Is this needed?
 334   AC_LANG(C++)
 335 
 336   # Store the CFLAGS etc passed to the configure script.
 337   ORG_CFLAGS=&quot;$CFLAGS&quot;
 338   ORG_CXXFLAGS=&quot;$CXXFLAGS&quot;
 339 
 340   # autoconf magic only relies on PATH, so update it if tools dir is specified
 341   OLD_PATH=&quot;$PATH&quot;
 342 
 343   # On Windows, we need to detect the visual studio installation first.
 344   # This will change the PATH, but we need to keep that new PATH even
 345   # after toolchain detection is done, since the compiler (on x86) uses
 346   # it for DLL resolution in runtime.
 347   if test &quot;x$OPENJDK_BUILD_OS&quot; = &quot;xwindows&quot; \
 348       &amp;&amp; test &quot;x$TOOLCHAIN_TYPE&quot; = &quot;xmicrosoft&quot;; then
 349     TOOLCHAIN_SETUP_VISUAL_STUDIO_ENV
 350     if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
 351       # Append VS_PATH. In WSL, VS_PATH will not contain the WSL env path needed
 352       # for using basic Unix tools, so need to keep the original PATH.
 353       UTIL_APPEND_TO_PATH(PATH, $VS_PATH)
 354       UTIL_APPEND_TO_PATH(WSLENV, &quot;PATH/l:LIB:INCLUDE&quot;)
 355       export WSLENV
 356     else
 357       # Reset path to VS_PATH. It will include everything that was on PATH at the time we
 358       # ran TOOLCHAIN_SETUP_VISUAL_STUDIO_ENV.
 359       PATH=&quot;$VS_PATH&quot;
 360     fi
 361     # The microsoft toolchain also requires INCLUDE and LIB to be set.
 362     export INCLUDE=&quot;$VS_INCLUDE&quot;
 363     export LIB=&quot;$VS_LIB&quot;
 364   else
 365     if test &quot;x$XCODE_VERSION_OUTPUT&quot; != x; then
 366       # For Xcode, we set the Xcode version as TOOLCHAIN_VERSION
 367       TOOLCHAIN_VERSION=`$ECHO $XCODE_VERSION_OUTPUT | $CUT -f 2 -d &#39; &#39;`
 368       TOOLCHAIN_DESCRIPTION=&quot;$TOOLCHAIN_DESCRIPTION from Xcode $TOOLCHAIN_VERSION&quot;
 369     else
 370       # Currently we do not define this for other toolchains. This might change as the need arise.
 371       TOOLCHAIN_VERSION=
 372     fi
 373   fi
 374   AC_SUBST(TOOLCHAIN_VERSION)
 375 
 376   # Finally add TOOLCHAIN_PATH at the beginning, to allow --with-tools-dir to
 377   # override all other locations.
 378   if test &quot;x$TOOLCHAIN_PATH&quot; != x; then
 379     PATH=$TOOLCHAIN_PATH:$PATH
 380   fi
 381 ])
 382 
 383 # Restore path, etc
 384 AC_DEFUN_ONCE([TOOLCHAIN_POST_DETECTION],
 385 [
 386   # Restore old path, except for the microsoft toolchain, which requires VS_PATH
 387   # to remain in place. Otherwise the compiler will not work in some siutations
 388   # in later configure checks.
 389   if test &quot;x$TOOLCHAIN_TYPE&quot; != &quot;xmicrosoft&quot;; then
 390     PATH=&quot;$OLD_PATH&quot;
 391   fi
 392 
 393   # Restore the flags to the user specified values.
 394   # This is necessary since AC_PROG_CC defaults CFLAGS to &quot;-g -O2&quot;
 395   CFLAGS=&quot;$ORG_CFLAGS&quot;
 396   CXXFLAGS=&quot;$ORG_CXXFLAGS&quot;
 397 ])
 398 
 399 # Check if a compiler is of the toolchain type we expect, and save the version
 400 # information from it. If the compiler does not match the expected type,
 401 # this function will abort using AC_MSG_ERROR. If it matches, the version will
 402 # be stored in CC_VERSION_NUMBER/CXX_VERSION_NUMBER (as a dotted number), and
 403 # the full version string in CC_VERSION_STRING/CXX_VERSION_STRING.
 404 #
 405 # $1 = compiler to test (CC or CXX)
 406 # $2 = human readable name of compiler (C or C++)
 407 AC_DEFUN([TOOLCHAIN_EXTRACT_COMPILER_VERSION],
 408 [
 409   COMPILER=[$]$1
 410   COMPILER_NAME=$2
 411 
<a name="7" id="anc7"></a><span class="line-modified"> 412   if test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed"> 413     # cc -V output typically looks like</span>
<span class="line-removed"> 414     #     cc: Sun C 5.12 Linux_i386 2011/11/16</span>
<span class="line-removed"> 415     # or</span>
<span class="line-removed"> 416     #     cc: Studio 12.5 Sun C 5.14 SunOS_sparc 2016/05/31</span>
<span class="line-removed"> 417     COMPILER_VERSION_OUTPUT=`$COMPILER -V 2&gt;&amp;1`</span>
<span class="line-removed"> 418     # Check that this is likely to be the Solaris Studio cc.</span>
<span class="line-removed"> 419     $ECHO &quot;$COMPILER_VERSION_OUTPUT&quot; | $GREP &quot;^.* Sun $COMPILER_NAME&quot; &gt; /dev/null</span>
<span class="line-removed"> 420     if test $? -ne 0; then</span>
<span class="line-removed"> 421       ALT_VERSION_OUTPUT=`$COMPILER --version 2&gt;&amp;1`</span>
<span class="line-removed"> 422       AC_MSG_NOTICE([The $COMPILER_NAME compiler (located as $COMPILER) does not seem to be the required $TOOLCHAIN_TYPE compiler.])</span>
<span class="line-removed"> 423       AC_MSG_NOTICE([The result from running with -V was: &quot;$COMPILER_VERSION_OUTPUT&quot;])</span>
<span class="line-removed"> 424       AC_MSG_NOTICE([The result from running with --version was: &quot;$ALT_VERSION_OUTPUT&quot;])</span>
<span class="line-removed"> 425       AC_MSG_ERROR([A $TOOLCHAIN_TYPE compiler is required. Try setting --with-tools-dir.])</span>
<span class="line-removed"> 426     fi</span>
<span class="line-removed"> 427     # Remove usage instructions (if present), and</span>
<span class="line-removed"> 428     # collapse compiler output into a single line</span>
<span class="line-removed"> 429     COMPILER_VERSION_STRING=`$ECHO $COMPILER_VERSION_OUTPUT | \</span>
<span class="line-removed"> 430         $SED -e &#39;s/ *@&lt;:@Uu@:&gt;@sage:.*//&#39;`</span>
<span class="line-removed"> 431     COMPILER_VERSION_NUMBER=`$ECHO $COMPILER_VERSION_OUTPUT | \</span>
<span class="line-removed"> 432         $SED -e &quot;s/^.*@&lt;:@ ,\t@:&gt;@$COMPILER_NAME@&lt;:@ ,\t@:&gt;@\(@&lt;:@1-9@:&gt;@\.@&lt;:@0-9@:&gt;@@&lt;:@0-9@:&gt;@*\).*/\1/&quot;`</span>
<span class="line-removed"> 433   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then</span>
 434     # xlc -qversion output typically looks like
 435     #     IBM XL C/C++ for AIX, V11.1 (5724-X13)
 436     #     Version: 11.01.0000.0015
 437     COMPILER_VERSION_OUTPUT=`$COMPILER -qversion 2&gt;&amp;1`
 438     # Check that this is likely to be the IBM XL C compiler.
 439     $ECHO &quot;$COMPILER_VERSION_OUTPUT&quot; | $GREP &quot;IBM XL C&quot; &gt; /dev/null
 440     if test $? -ne 0; then
 441       ALT_VERSION_OUTPUT=`$COMPILER --version 2&gt;&amp;1`
 442       AC_MSG_NOTICE([The $COMPILER_NAME compiler (located as $COMPILER) does not seem to be the required $TOOLCHAIN_TYPE compiler.])
 443       AC_MSG_NOTICE([The result from running with -qversion was: &quot;$COMPILER_VERSION_OUTPUT&quot;])
 444       AC_MSG_NOTICE([The result from running with --version was: &quot;$ALT_VERSION_OUTPUT&quot;])
 445       AC_MSG_ERROR([A $TOOLCHAIN_TYPE compiler is required. Try setting --with-tools-dir.])
 446     fi
 447     # Collapse compiler output into a single line
 448     COMPILER_VERSION_STRING=`$ECHO $COMPILER_VERSION_OUTPUT`
 449     COMPILER_VERSION_NUMBER=`$ECHO $COMPILER_VERSION_OUTPUT | \
 450         $SED -e &#39;s/^.*, V\(@&lt;:@1-9@:&gt;@@&lt;:@0-9.@:&gt;@*\).*$/\1/&#39;`
 451   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 452     # There is no specific version flag, but all output starts with a version string.
 453     # First line typically looks something like:
 454     # Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 16.00.40219.01 for 80x86
 455     # but the compiler name may vary depending on locale.
 456     COMPILER_VERSION_OUTPUT=`&quot;$COMPILER&quot; 2&gt;&amp;1 | $GREP -v &#39;ERROR.*UtilTranslatePathList&#39; | $HEAD -n 1 | $TR -d &#39;\r&#39;`
 457     # Check that this is likely to be Microsoft CL.EXE.
 458     $ECHO &quot;$COMPILER_VERSION_OUTPUT&quot; | $GREP &quot;Microsoft&quot; &gt; /dev/null
 459     if test $? -ne 0; then
 460       AC_MSG_NOTICE([The $COMPILER_NAME compiler (located as $COMPILER) does not seem to be the required $TOOLCHAIN_TYPE compiler.])
 461       AC_MSG_NOTICE([The result from running it was: &quot;$COMPILER_VERSION_OUTPUT&quot;])
 462       AC_MSG_ERROR([A $TOOLCHAIN_TYPE compiler is required. Try setting --with-tools-dir.])
 463     fi
 464     # Collapse compiler output into a single line
 465     COMPILER_VERSION_STRING=`$ECHO $COMPILER_VERSION_OUTPUT`
 466     COMPILER_VERSION_NUMBER=`$ECHO $COMPILER_VERSION_OUTPUT | \
 467         $SED -e &#39;s/^.*ersion.\(@&lt;:@1-9@:&gt;@@&lt;:@0-9.@:&gt;@*\) .*$/\1/&#39;`
 468   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
 469     # gcc --version output typically looks like
 470     #     gcc (Ubuntu/Linaro 4.8.1-10ubuntu9) 4.8.1
 471     #     Copyright (C) 2013 Free Software Foundation, Inc.
 472     #     This is free software; see the source for copying conditions.  There is NO
 473     #     warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 474     COMPILER_VERSION_OUTPUT=`$COMPILER --version 2&gt;&amp;1`
 475     # Check that this is likely to be GCC.
 476     $ECHO &quot;$COMPILER_VERSION_OUTPUT&quot; | $GREP &quot;Free Software Foundation&quot; &gt; /dev/null
 477     if test $? -ne 0; then
 478       AC_MSG_NOTICE([The $COMPILER_NAME compiler (located as $COMPILER) does not seem to be the required $TOOLCHAIN_TYPE compiler.])
 479       AC_MSG_NOTICE([The result from running with --version was: &quot;$COMPILER_VERSION&quot;])
 480       AC_MSG_ERROR([A $TOOLCHAIN_TYPE compiler is required. Try setting --with-tools-dir.])
 481     fi
 482     # Remove Copyright and legalese from version string, and
 483     # collapse into a single line
 484     COMPILER_VERSION_STRING=`$ECHO $COMPILER_VERSION_OUTPUT | \
 485         $SED -e &#39;s/ *Copyright .*//&#39;`
 486     COMPILER_VERSION_NUMBER=`$ECHO $COMPILER_VERSION_OUTPUT | \
 487         $SED -e &#39;s/^.* \(@&lt;:@1-9@:&gt;@&lt;:@0-9@:&gt;@*\.@&lt;:@0-9.@:&gt;@*\)@&lt;:@^0-9.@:&gt;@.*$/\1/&#39;`
 488   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
 489     # clang --version output typically looks like
 490     #    Apple LLVM version 5.0 (clang-500.2.79) (based on LLVM 3.3svn)
 491     #    clang version 3.3 (tags/RELEASE_33/final)
 492     # or
 493     #    Debian clang version 3.2-7ubuntu1 (tags/RELEASE_32/final) (based on LLVM 3.2)
 494     #    Target: x86_64-pc-linux-gnu
 495     #    Thread model: posix
 496     COMPILER_VERSION_OUTPUT=`$COMPILER --version 2&gt;&amp;1`
 497     # Check that this is likely to be clang
 498     $ECHO &quot;$COMPILER_VERSION_OUTPUT&quot; | $GREP &quot;clang&quot; &gt; /dev/null
 499     if test $? -ne 0; then
 500       AC_MSG_NOTICE([The $COMPILER_NAME compiler (located as $COMPILER) does not seem to be the required $TOOLCHAIN_TYPE compiler.])
 501       AC_MSG_NOTICE([The result from running with --version was: &quot;$COMPILER_VERSION_OUTPUT&quot;])
 502       AC_MSG_ERROR([A $TOOLCHAIN_TYPE compiler is required. Try setting --with-tools-dir.])
 503     fi
 504     # Collapse compiler output into a single line
 505     COMPILER_VERSION_STRING=`$ECHO $COMPILER_VERSION_OUTPUT`
 506     COMPILER_VERSION_NUMBER=`$ECHO $COMPILER_VERSION_OUTPUT | \
 507         $SED -e &#39;s/^.* version \(@&lt;:@1-9@:&gt;@@&lt;:@0-9.@:&gt;@*\).*$/\1/&#39;`
 508   else
 509       AC_MSG_ERROR([Unknown toolchain type $TOOLCHAIN_TYPE.])
 510   fi
 511   # This sets CC_VERSION_NUMBER or CXX_VERSION_NUMBER. (This comment is a grep marker)
 512   $1_VERSION_NUMBER=&quot;$COMPILER_VERSION_NUMBER&quot;
 513   # This sets CC_VERSION_STRING or CXX_VERSION_STRING. (This comment is a grep marker)
 514   $1_VERSION_STRING=&quot;$COMPILER_VERSION_STRING&quot;
 515 
 516   AC_MSG_NOTICE([Using $TOOLCHAIN_TYPE $COMPILER_NAME compiler version $COMPILER_VERSION_NUMBER @&lt;:@$COMPILER_VERSION_STRING@:&gt;@])
 517 ])
 518 
 519 # Try to locate the given C or C++ compiler in the path, or otherwise.
 520 #
 521 # $1 = compiler to test (CC or CXX)
 522 # $2 = human readable name of compiler (C or C++)
 523 # $3 = compiler name to search for
 524 AC_DEFUN([TOOLCHAIN_FIND_COMPILER],
 525 [
 526   COMPILER_NAME=$2
 527   SEARCH_LIST=&quot;$3&quot;
 528 
 529   if test &quot;x[$]$1&quot; != x; then
 530     # User has supplied compiler name already, always let that override.
 531     AC_MSG_NOTICE([Will use user supplied compiler $1=[$]$1])
 532     if test &quot;x`basename [$]$1`&quot; = &quot;x[$]$1&quot;; then
 533       # A command without a complete path is provided, search $PATH.
 534 
 535       AC_PATH_PROGS(POTENTIAL_$1, [$]$1)
 536       if test &quot;x$POTENTIAL_$1&quot; != x; then
 537         $1=$POTENTIAL_$1
 538       else
 539         AC_MSG_ERROR([User supplied compiler $1=[$]$1 could not be found])
 540       fi
 541     else
 542       # Otherwise it might already be a complete path
 543       if test ! -x &quot;[$]$1&quot;; then
 544         AC_MSG_ERROR([User supplied compiler $1=[$]$1 does not exist])
 545       fi
 546     fi
 547   else
 548     # No user supplied value. Locate compiler ourselves.
 549 
 550     # If we are cross compiling, assume cross compilation tools follows the
 551     # cross compilation standard where they are prefixed with the autoconf
 552     # standard name for the target. For example the binary
 553     # i686-sun-solaris2.10-gcc will cross compile for i686-sun-solaris2.10.
 554     # If we are not cross compiling, then the default compiler name will be
 555     # used.
 556 
 557     $1=
 558     # If TOOLCHAIN_PATH is set, check for all compiler names in there first
 559     # before checking the rest of the PATH.
 560     # FIXME: Now that we prefix the TOOLS_DIR to the PATH in the PRE_DETECTION
 561     # step, this should not be necessary.
 562     if test -n &quot;$TOOLCHAIN_PATH&quot;; then
 563       PATH_save=&quot;$PATH&quot;
 564       PATH=&quot;$TOOLCHAIN_PATH&quot;
 565       AC_PATH_TOOL(TOOLCHAIN_PATH_$1, $SEARCH_LIST)
 566       $1=$TOOLCHAIN_PATH_$1
 567       PATH=&quot;$PATH_save&quot;
 568     fi
 569 
 570     # AC_PATH_TOOL can&#39;t be run multiple times with the same variable,
 571     # so create a new name for this run.
 572     if test &quot;x[$]$1&quot; = x; then
 573       AC_PATH_TOOL(POTENTIAL_$1, $SEARCH_LIST)
 574       $1=$POTENTIAL_$1
 575     fi
 576 
 577     if test &quot;x[$]$1&quot; = x; then
 578       HELP_MSG_MISSING_DEPENDENCY([devkit])
 579       AC_MSG_ERROR([Could not find a $COMPILER_NAME compiler. $HELP_MSG])
 580     fi
 581   fi
 582 
 583   # Now we have a compiler binary in $1. Make sure it&#39;s okay.
 584   UTIL_FIXUP_EXECUTABLE($1)
 585   TEST_COMPILER=&quot;[$]$1&quot;
 586 
 587   AC_MSG_CHECKING([resolved symbolic links for $1])
 588   SYMLINK_ORIGINAL=&quot;$TEST_COMPILER&quot;
 589   UTIL_REMOVE_SYMBOLIC_LINKS(SYMLINK_ORIGINAL)
 590   if test &quot;x$TEST_COMPILER&quot; = &quot;x$SYMLINK_ORIGINAL&quot;; then
 591     AC_MSG_RESULT([no symlink])
 592   else
 593     AC_MSG_RESULT([$SYMLINK_ORIGINAL])
 594 
 595     # We can&#39;t handle ccache by gcc wrappers, since we need to know if we&#39;re
 596     # using ccache. Instead ccache usage must be controlled by a configure option.
 597     COMPILER_BASENAME=`$BASENAME &quot;$SYMLINK_ORIGINAL&quot;`
 598     if test &quot;x$COMPILER_BASENAME&quot; = &quot;xccache&quot;; then
 599       AC_MSG_NOTICE([Please use --enable-ccache instead of providing a wrapped compiler.])
 600       AC_MSG_ERROR([$TEST_COMPILER is a symbolic link to ccache. This is not supported.])
 601     fi
 602   fi
 603 
 604   TOOLCHAIN_EXTRACT_COMPILER_VERSION([$1], [$COMPILER_NAME])
 605 ])
 606 
 607 # Retrieve the linker version number and store it in LD_VERSION_NUMBER
 608 # (as a dotted number), and
 609 # the full version string in LD_VERSION_STRING.
 610 #
 611 # $1 = linker to test (LD or BUILD_LD)
 612 # $2 = human readable name of linker (Linker or BuildLinker)
 613 AC_DEFUN([TOOLCHAIN_EXTRACT_LD_VERSION],
 614 [
 615   LINKER=[$]$1
 616   LINKER_NAME=&quot;$2&quot;
 617 
<a name="8" id="anc8"></a><span class="line-modified"> 618   if test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-removed"> 619     # cc -Wl,-V output typically looks like</span>
<span class="line-removed"> 620     #   ld: Software Generation Utilities - Solaris Link Editors: 5.11-1.2329</span>
<span class="line-removed"> 621 </span>
<span class="line-removed"> 622     # solstudio cc requires us to have an existing file to pass as argument,</span>
<span class="line-removed"> 623     # but it need not be a syntactically correct C file, so just use</span>
<span class="line-removed"> 624     # ourself. :) The intermediate &#39;cat&#39; is needed to stop ld from leaving</span>
<span class="line-removed"> 625     # a lingering a.out (!).</span>
<span class="line-removed"> 626     LINKER_VERSION_STRING=`$LD -Wl,-V $TOPDIR/configure 2&gt;&amp;1 | $CAT | $HEAD -n 1 | $SED -e &#39;s/ld: //&#39;`</span>
<span class="line-removed"> 627     # Extract version number</span>
<span class="line-removed"> 628     [ LINKER_VERSION_NUMBER=`$ECHO $LINKER_VERSION_STRING | \</span>
<span class="line-removed"> 629         $SED -e &#39;s/.* \([0-9][0-9]*\.[0-9][0-9]*\)-\([0-9][0-9]*\.[0-9][0-9]*\)/\1.\2/&#39;` ]</span>
<span class="line-removed"> 630   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then</span>
 631     LINKER_VERSION_STRING=&quot;Unknown&quot;
 632     LINKER_VERSION_NUMBER=&quot;0.0&quot;
 633   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 634     # There is no specific version flag, but all output starts with a version string.
 635     # First line typically looks something like:
 636     #   Microsoft (R) Incremental Linker Version 12.00.31101.0
 637     # Reset PATH since it can contain a mix of WSL/linux paths and Windows paths from VS,
 638     # which, in combination with WSLENV, will make the WSL layer complain
 639     old_path=&quot;$PATH&quot;
 640     PATH=
 641     LINKER_VERSION_STRING=`$LD 2&gt;&amp;1 | $HEAD -n 1 | $TR -d &#39;\r&#39;`
 642     PATH=&quot;$old_path&quot;
 643     # Extract version number
 644     [ LINKER_VERSION_NUMBER=`$ECHO $LINKER_VERSION_STRING | \
 645         $SED -e &#39;s/.* \([0-9][0-9]*\(\.[0-9][0-9]*\)*\).*/\1/&#39;` ]
 646   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
 647     # gcc -Wl,-version output typically looks like:
 648     #   GNU ld (GNU Binutils for Ubuntu) 2.26.1
 649     #   Copyright (C) 2015 Free Software Foundation, Inc.
 650     #   This program is free software; [...]
 651     # If using gold it will look like:
 652     #   GNU gold (GNU Binutils 2.30) 1.15
 653     LINKER_VERSION_STRING=`$LD -Wl,--version 2&gt; /dev/null | $HEAD -n 1`
 654     # Extract version number
 655     if [ [[ &quot;$LINKER_VERSION_STRING&quot; == *gold* ]] ]; then
 656       [ LINKER_VERSION_NUMBER=`$ECHO $LINKER_VERSION_STRING | \
 657           $SED -e &#39;s/.* \([0-9][0-9]*\(\.[0-9][0-9]*\)*\).*) .*/\1/&#39;` ]
 658     else
 659       [ LINKER_VERSION_NUMBER=`$ECHO $LINKER_VERSION_STRING | \
 660           $SED -e &#39;s/.* \([0-9][0-9]*\(\.[0-9][0-9]*\)*\).*/\1/&#39;` ]
 661     fi
 662   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
 663     # clang -Wl,-v output typically looks like
 664     #   @(#)PROGRAM:ld  PROJECT:ld64-305
 665     #   configured to support archs: armv6 armv7 armv7s arm64 i386 x86_64 x86_64h armv6m armv7k armv7m armv7em (tvOS)
 666     #   Library search paths: [...]
 667     # or
 668     #   GNU ld (GNU Binutils for Ubuntu) 2.26.1
 669 
 670     LINKER_VERSION_STRING=`$LD -Wl,-v 2&gt;&amp;1 | $HEAD -n 1`
 671     # Check if we&#39;re using the GNU ld
 672     $ECHO &quot;$LINKER_VERSION_STRING&quot; | $GREP &quot;GNU&quot; &gt; /dev/null
 673     if test $? -eq 0; then
 674       # Extract version number
 675       [ LINKER_VERSION_NUMBER=`$ECHO $LINKER_VERSION_STRING | \
 676           $SED -e &#39;s/.* \([0-9][0-9]*\(\.[0-9][0-9]*\)*\).*/\1/&#39;` ]
 677     else
 678       # Extract version number
 679       [ LINKER_VERSION_NUMBER=`$ECHO $LINKER_VERSION_STRING | \
 680           $SED -e &#39;s/.*-\([0-9][0-9]*\)/\1/&#39;` ]
 681     fi
 682   fi
 683 
 684   $1_VERSION_NUMBER=&quot;$LINKER_VERSION_NUMBER&quot;
 685   $1_VERSION_STRING=&quot;$LINKER_VERSION_STRING&quot;
 686 
 687   AC_MSG_NOTICE([Using $TOOLCHAIN_TYPE $LINKER_NAME version $LINKER_VERSION_NUMBER @&lt;:@$LINKER_VERSION_STRING@:&gt;@])
 688 ])
 689 
 690 # Detect the core components of the toolchain, i.e. the compilers (CC and CXX),
 691 # preprocessor (CPP and CXXCPP), the linker (LD), the assembler (AS) and the
 692 # archiver (AR). Verify that the compilers are correct according to the
 693 # toolchain type.
 694 AC_DEFUN_ONCE([TOOLCHAIN_DETECT_TOOLCHAIN_CORE],
 695 [
 696   #
 697   # Setup the compilers (CC and CXX)
 698   #
 699   TOOLCHAIN_FIND_COMPILER([CC], [C], $TOOLCHAIN_CC_BINARY)
 700   # Now that we have resolved CC ourself, let autoconf have its go at it
 701   AC_PROG_CC([$CC])
 702 
 703   TOOLCHAIN_FIND_COMPILER([CXX], [C++], $TOOLCHAIN_CXX_BINARY)
 704   # Now that we have resolved CXX ourself, let autoconf have its go at it
 705   AC_PROG_CXX([$CXX])
 706 
 707   # This is the compiler version number on the form X.Y[.Z]
 708   AC_SUBST(CC_VERSION_NUMBER)
 709   AC_SUBST(CXX_VERSION_NUMBER)
 710 
 711   TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS
 712 
 713   if test &quot;x$TOOLCHAIN_MINIMUM_VERSION&quot; != x; then
 714     TOOLCHAIN_CHECK_COMPILER_VERSION(VERSION: $TOOLCHAIN_MINIMUM_VERSION,
 715         IF_OLDER_THAN: [
 716           AC_MSG_WARN([You are using $TOOLCHAIN_TYPE older than $TOOLCHAIN_MINIMUM_VERSION. This is not a supported configuration.])
 717         ]
 718     )
 719   fi
 720 
 721   #
 722   # Setup the preprocessor (CPP and CXXCPP)
 723   #
 724   AC_PROG_CPP
 725   UTIL_FIXUP_EXECUTABLE(CPP)
 726   AC_PROG_CXXCPP
 727   UTIL_FIXUP_EXECUTABLE(CXXCPP)
 728 
 729   #
 730   # Setup the linker (LD)
 731   #
 732   if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 733     # In the Microsoft toolchain we have a separate LD command &quot;link&quot;.
 734     # Make sure we reject /usr/bin/link (as determined in CYGWIN_LINK), which is
 735     # a cygwin program for something completely different.
 736     AC_CHECK_PROG([LD], [link$EXE_SUFFIX],[link$EXE_SUFFIX],,, [$CYGWIN_LINK])
 737     UTIL_FIXUP_EXECUTABLE(LD)
 738     # Verify that we indeed succeeded with this trick.
 739     AC_MSG_CHECKING([if the found link.exe is actually the Visual Studio linker])
 740 
 741     # Reset PATH since it can contain a mix of WSL/linux paths and Windows paths from VS,
 742     # which, in combination with WSLENV, will make the WSL layer complain
 743     old_path=&quot;$PATH&quot;
 744     PATH=
 745 
 746     &quot;$LD&quot; --version &gt; /dev/null
 747 
 748     if test $? -eq 0 ; then
 749       AC_MSG_RESULT([no])
 750       AC_MSG_ERROR([This is the Cygwin link tool. Please check your PATH and rerun configure.])
 751     else
 752       AC_MSG_RESULT([yes])
 753     fi
 754 
 755     PATH=&quot;$old_path&quot;
 756 
 757     LDCXX=&quot;$LD&quot;
 758     # jaotc being a windows program expects the linker to be supplied with exe suffix.
 759     LD_JAOTC=&quot;$LD$EXE_SUFFIX&quot;
 760   else
 761     # All other toolchains use the compiler to link.
 762     LD=&quot;$CC&quot;
 763     LDCXX=&quot;$CXX&quot;
 764     # jaotc expects &#39;ld&#39; as the linker rather than the compiler.
 765     UTIL_CHECK_TOOLS([LD_JAOTC], ld)
 766     UTIL_FIXUP_EXECUTABLE(LD_JAOTC)
 767   fi
 768   AC_SUBST(LD)
 769   AC_SUBST(LD_JAOTC)
 770   # FIXME: it should be CXXLD, according to standard (cf CXXCPP)
 771   AC_SUBST(LDCXX)
 772 
 773   TOOLCHAIN_EXTRACT_LD_VERSION([LD], [linker])
 774   TOOLCHAIN_PREPARE_FOR_LD_VERSION_COMPARISONS
 775 
 776   if test &quot;x$TOOLCHAIN_MINIMUM_LD_VERSION&quot; != x; then
 777     TOOLCHAIN_CHECK_LINKER_VERSION(VERSION: $TOOLCHAIN_MINIMUM_LD_VERSION,
 778         IF_OLDER_THAN: [
 779           AC_MSG_WARN([You are using a linker older than $TOOLCHAIN_MINIMUM_LD_VERSION. This is not a supported configuration.])
 780         ]
 781     )
 782   fi
 783 
 784   #
 785   # Setup the assembler (AS)
 786   #
<a name="9" id="anc9"></a><span class="line-modified"> 787   if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris; then</span>
<span class="line-modified"> 788     UTIL_PATH_PROGS(AS, as)</span>
<span class="line-removed"> 789     UTIL_FIXUP_EXECUTABLE(AS)</span>
<span class="line-removed"> 790     if test &quot;x$AS&quot; = x; then</span>
<span class="line-removed"> 791       AC_MSG_ERROR([Solaris assembler (as) is required. Please install via &quot;pkg install pkg:/developer/assembler&quot;.])</span>
<span class="line-removed"> 792     fi</span>
<span class="line-removed"> 793   else</span>
<span class="line-removed"> 794     # FIXME: is this correct for microsoft?</span>
<span class="line-removed"> 795     AS=&quot;$CC -c&quot;</span>
<span class="line-removed"> 796   fi</span>
 797   AC_SUBST(AS)
 798 
 799   #
 800   # Setup the archiver (AR)
 801   #
 802   if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 803     # The corresponding ar tool is lib.exe (used to create static libraries)
 804     AC_CHECK_PROG([AR], [lib$EXE_SUFFIX],[lib$EXE_SUFFIX],,,)
 805   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
 806     UTIL_CHECK_TOOLS(AR, ar gcc-ar)
 807   else
 808     UTIL_CHECK_TOOLS(AR, ar)
 809   fi
 810   UTIL_FIXUP_EXECUTABLE(AR)
 811 ])
 812 
 813 # Setup additional tools that is considered a part of the toolchain, but not the
 814 # core part. Many of these are highly platform-specific and do not exist,
 815 # and/or are not needed on all platforms.
 816 AC_DEFUN_ONCE([TOOLCHAIN_DETECT_TOOLCHAIN_EXTRA],
 817 [
 818   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xmacosx&quot;; then
 819     UTIL_PATH_PROGS(LIPO, lipo)
 820     UTIL_FIXUP_EXECUTABLE(LIPO)
 821     UTIL_REQUIRE_PROGS(OTOOL, otool)
 822     UTIL_FIXUP_EXECUTABLE(OTOOL)
 823     UTIL_REQUIRE_PROGS(INSTALL_NAME_TOOL, install_name_tool)
 824     UTIL_FIXUP_EXECUTABLE(INSTALL_NAME_TOOL)
 825   fi
 826 
 827   if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 828     AC_CHECK_PROG([MT], [mt$EXE_SUFFIX], [mt$EXE_SUFFIX],,, [/usr/bin/mt])
 829     UTIL_FIXUP_EXECUTABLE(MT)
 830     # Setup the resource compiler (RC)
 831     AC_CHECK_PROG([RC], [rc$EXE_SUFFIX], [rc$EXE_SUFFIX],,, [/usr/bin/rc])
 832     UTIL_FIXUP_EXECUTABLE(RC)
 833     AC_CHECK_PROG([DUMPBIN], [dumpbin$EXE_SUFFIX], [dumpbin$EXE_SUFFIX],,,)
 834     UTIL_FIXUP_EXECUTABLE(DUMPBIN)
 835     # We need to check for &#39;msbuild.exe&#39; because at the place where we expect to
 836     # find &#39;msbuild.exe&#39; there&#39;s also a directory called &#39;msbuild&#39; and configure
 837     # won&#39;t find the &#39;msbuild.exe&#39; executable in that case (and the
 838     # &#39;ac_executable_extensions&#39; is unusable due to performance reasons).
 839     # Notice that we intentionally don&#39;t fix up the path to MSBUILD because we
 840     # will call it in a DOS shell during freetype detection on Windows (see
 841     # &#39;LIB_SETUP_FREETYPE&#39; in &quot;libraries.m4&quot;
 842     AC_CHECK_PROG([MSBUILD], [msbuild$EXE_SUFFIX], [msbuild$EXE_SUFFIX],,,)
 843   fi
 844 
<a name="10" id="anc10"></a><span class="line-modified"> 845   if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris; then</span>
<span class="line-removed"> 846     UTIL_PATH_PROGS(STRIP, strip)</span>
<span class="line-removed"> 847     UTIL_FIXUP_EXECUTABLE(STRIP)</span>
<span class="line-removed"> 848     UTIL_PATH_PROGS(NM, nm)</span>
<span class="line-removed"> 849     UTIL_FIXUP_EXECUTABLE(NM)</span>
<span class="line-removed"> 850     UTIL_PATH_PROGS(GNM, gnm)</span>
<span class="line-removed"> 851     UTIL_FIXUP_EXECUTABLE(GNM)</span>
<span class="line-removed"> 852   elif test &quot;x$OPENJDK_TARGET_OS&quot; != xwindows; then</span>
<span class="line-removed"> 853     # FIXME: we should unify this with the solaris case above.</span>
 854     UTIL_CHECK_TOOLS(STRIP, strip)
 855     UTIL_FIXUP_EXECUTABLE(STRIP)
 856     if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
 857       UTIL_CHECK_TOOLS(NM, nm gcc-nm)
 858     else
 859       UTIL_CHECK_TOOLS(NM, nm)
 860     fi
 861     UTIL_FIXUP_EXECUTABLE(NM)
 862     GNM=&quot;$NM&quot;
 863     AC_SUBST(GNM)
 864   fi
 865 
 866   # objcopy is used for moving debug symbols to separate files when
 867   # full debug symbols are enabled.
<a name="11" id="anc11"></a><span class="line-modified"> 868   if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then</span>
 869     UTIL_CHECK_TOOLS(OBJCOPY, [gobjcopy objcopy])
 870     # Only call fixup if objcopy was found.
 871     if test -n &quot;$OBJCOPY&quot;; then
 872       UTIL_FIXUP_EXECUTABLE(OBJCOPY)
<a name="12" id="anc12"></a><span class="line-removed"> 873       if test &quot;x$OPENJDK_BUILD_OS&quot; = xsolaris; then</span>
<span class="line-removed"> 874         # objcopy prior to 2.21.1 on solaris is broken and is not usable.</span>
<span class="line-removed"> 875         # Rewrite objcopy version output to VALID_VERSION or BAD_VERSION.</span>
<span class="line-removed"> 876         # - version number is last blank separate word on first line</span>
<span class="line-removed"> 877         # - version number formats that have been seen:</span>
<span class="line-removed"> 878         #   - &lt;major&gt;.&lt;minor&gt;</span>
<span class="line-removed"> 879         #   - &lt;major&gt;.&lt;minor&gt;.&lt;micro&gt;</span>
<span class="line-removed"> 880         OBJCOPY_VERSION=`$OBJCOPY --version | $HEAD -n 1`</span>
<span class="line-removed"> 881         # The outer [ ] is to prevent m4 from eating the [] in the sed expression.</span>
<span class="line-removed"> 882         [ OBJCOPY_VERSION_CHECK=`$ECHO $OBJCOPY_VERSION | $SED -n \</span>
<span class="line-removed"> 883               -e &#39;s/.* //&#39; \</span>
<span class="line-removed"> 884               -e &#39;/^[01]\./b bad&#39; \</span>
<span class="line-removed"> 885               -e &#39;/^2\./{&#39; \</span>
<span class="line-removed"> 886               -e &#39;  s/^2\.//&#39; \</span>
<span class="line-removed"> 887               -e &#39;  /^[0-9]$/b bad&#39; \</span>
<span class="line-removed"> 888               -e &#39;  /^[0-9]\./b bad&#39; \</span>
<span class="line-removed"> 889               -e &#39;  /^1[0-9]$/b bad&#39; \</span>
<span class="line-removed"> 890               -e &#39;  /^1[0-9]\./b bad&#39; \</span>
<span class="line-removed"> 891               -e &#39;  /^20\./b bad&#39; \</span>
<span class="line-removed"> 892               -e &#39;  /^21\.0$/b bad&#39; \</span>
<span class="line-removed"> 893               -e &#39;  /^21\.0\./b bad&#39; \</span>
<span class="line-removed"> 894               -e &#39;}&#39; \</span>
<span class="line-removed"> 895               -e &#39;:good&#39; \</span>
<span class="line-removed"> 896               -e &#39;s/.*/VALID_VERSION/p&#39; \</span>
<span class="line-removed"> 897               -e &#39;q&#39; \</span>
<span class="line-removed"> 898               -e &#39;:bad&#39; \</span>
<span class="line-removed"> 899               -e &#39;s/.*/BAD_VERSION/p&#39; \</span>
<span class="line-removed"> 900               -e &#39;q&#39;` ]</span>
<span class="line-removed"> 901         if test &quot;x$OBJCOPY_VERSION_CHECK&quot; = xBAD_VERSION; then</span>
<span class="line-removed"> 902           OBJCOPY=</span>
<span class="line-removed"> 903           AC_MSG_WARN([Ignoring found objcopy since it is broken (prior to 2.21.1). No debug symbols will be generated.])</span>
<span class="line-removed"> 904           AC_MSG_NOTICE([objcopy reports version $OBJCOPY_VERSION])</span>
<span class="line-removed"> 905           AC_MSG_NOTICE([Note: patch 149063-01 or newer contains the correct Solaris 10 SPARC version])</span>
<span class="line-removed"> 906           AC_MSG_NOTICE([Note: patch 149064-01 or newer contains the correct Solaris 10 X86 version])</span>
<span class="line-removed"> 907           AC_MSG_NOTICE([Note: Solaris 11 Update 1 contains the correct version])</span>
<span class="line-removed"> 908         fi</span>
<span class="line-removed"> 909       fi</span>
 910     fi
 911   fi
 912 
 913   UTIL_CHECK_TOOLS(OBJDUMP, [gobjdump objdump])
 914   if test &quot;x$OBJDUMP&quot; != x; then
 915     # Only used for compare.sh; we can live without it. UTIL_FIXUP_EXECUTABLE
 916     # bails if argument is missing.
 917     UTIL_FIXUP_EXECUTABLE(OBJDUMP)
 918   fi
 919 
 920   case $TOOLCHAIN_TYPE in
<a name="13" id="anc13"></a><span class="line-modified"> 921     gcc|clang|solstudio)</span>
 922       UTIL_CHECK_TOOLS(CXXFILT, [c++filt])
 923       UTIL_CHECK_NONEMPTY(CXXFILT)
 924       UTIL_FIXUP_EXECUTABLE(CXXFILT)
 925       ;;
 926   esac
 927 ])
 928 
 929 # Setup the build tools (i.e, the compiler and linker used to build programs
 930 # that should be run on the build platform, not the target platform, as a build
 931 # helper). Since the non-cross-compile case uses the normal, target compilers
 932 # for this, we can only do this after these have been setup.
 933 AC_DEFUN_ONCE([TOOLCHAIN_SETUP_BUILD_COMPILERS],
 934 [
 935   if test &quot;x$COMPILE_TYPE&quot; = &quot;xcross&quot;; then
 936     # Now we need to find a C/C++ compiler that can build executables for the
 937     # build platform. We can&#39;t use the AC_PROG_CC macro, since it can only be
 938     # used once. Also, we need to do this without adding a tools dir to the
 939     # path, otherwise we might pick up cross-compilers which don&#39;t use standard
 940     # naming.
 941 
 942     OLDPATH=&quot;$PATH&quot;
 943 
 944     AC_ARG_WITH(build-devkit, [AS_HELP_STRING([--with-build-devkit],
 945         [Devkit to use for the build platform toolchain])])
 946     if test &quot;x$with_build_devkit&quot; = &quot;xyes&quot;; then
 947       AC_MSG_ERROR([--with-build-devkit must have a value])
 948     elif test -n &quot;$with_build_devkit&quot;; then
 949       if test ! -d &quot;$with_build_devkit&quot;; then
 950         AC_MSG_ERROR([--with-build-devkit points to non existing dir: $with_build_devkit])
 951       else
 952         UTIL_FIXUP_PATH([with_build_devkit])
 953         BUILD_DEVKIT_ROOT=&quot;$with_build_devkit&quot;
 954         # Check for a meta data info file in the root of the devkit
 955         if test -f &quot;$BUILD_DEVKIT_ROOT/devkit.info&quot;; then
 956           # Process devkit.info so that existing devkit variables are not
 957           # modified by this
 958           $SED -e &quot;s/^DEVKIT_/BUILD_DEVKIT_/g&quot; \
 959               -e &quot;s/\$DEVKIT_ROOT/\$BUILD_DEVKIT_ROOT/g&quot; \
 960               -e &quot;s/\$host/\$build/g&quot; \
 961               $BUILD_DEVKIT_ROOT/devkit.info \
 962               &gt; $CONFIGURESUPPORT_OUTPUTDIR/build-devkit.info
 963           . $CONFIGURESUPPORT_OUTPUTDIR/build-devkit.info
 964           # This potentially sets the following:
 965           # A descriptive name of the devkit
 966           BASIC_EVAL_DEVKIT_VARIABLE([BUILD_DEVKIT_NAME])
 967           # Corresponds to --with-extra-path
 968           BASIC_EVAL_DEVKIT_VARIABLE([BUILD_DEVKIT_EXTRA_PATH])
 969           # Corresponds to --with-toolchain-path
 970           BASIC_EVAL_DEVKIT_VARIABLE([BUILD_DEVKIT_TOOLCHAIN_PATH])
 971           # Corresponds to --with-sysroot
 972           BASIC_EVAL_DEVKIT_VARIABLE([BUILD_DEVKIT_SYSROOT])
 973           # Skip the Window specific parts
 974         fi
 975 
 976         AC_MSG_CHECKING([for build platform devkit])
 977         if test &quot;x$BUILD_DEVKIT_NAME&quot; != x; then
 978           AC_MSG_RESULT([$BUILD_DEVKIT_NAME in $BUILD_DEVKIT_ROOT])
 979         else
 980           AC_MSG_RESULT([$BUILD_DEVKIT_ROOT])
 981         fi
 982 
 983         BUILD_SYSROOT=&quot;$BUILD_DEVKIT_SYSROOT&quot;
 984 
 985          # Fallback default of just /bin if DEVKIT_PATH is not defined
 986         if test &quot;x$BUILD_DEVKIT_TOOLCHAIN_PATH&quot; = x; then
 987           BUILD_DEVKIT_TOOLCHAIN_PATH=&quot;$BUILD_DEVKIT_ROOT/bin&quot;
 988         fi
 989         PATH=&quot;$BUILD_DEVKIT_TOOLCHAIN_PATH:$BUILD_DEVKIT_EXTRA_PATH&quot;
 990       fi
 991     fi
 992 
 993     # FIXME: we should list the discovered compilers as an exclude pattern!
 994     # If we do that, we can do this detection before POST_DETECTION, and still
 995     # find the build compilers in the tools dir, if needed.
 996     UTIL_REQUIRE_PROGS(BUILD_CC, [cl cc gcc])
 997     UTIL_FIXUP_EXECUTABLE(BUILD_CC)
 998     UTIL_REQUIRE_PROGS(BUILD_CXX, [cl CC g++])
 999     UTIL_FIXUP_EXECUTABLE(BUILD_CXX)
1000     UTIL_PATH_PROGS(BUILD_NM, nm gcc-nm)
1001     UTIL_FIXUP_EXECUTABLE(BUILD_NM)
1002     UTIL_PATH_PROGS(BUILD_AR, ar gcc-ar)
1003     UTIL_FIXUP_EXECUTABLE(BUILD_AR)
1004     UTIL_PATH_PROGS(BUILD_OBJCOPY, objcopy)
1005     UTIL_FIXUP_EXECUTABLE(BUILD_OBJCOPY)
1006     UTIL_PATH_PROGS(BUILD_STRIP, strip)
1007     UTIL_FIXUP_EXECUTABLE(BUILD_STRIP)
1008     # Assume the C compiler is the assembler
1009     BUILD_AS=&quot;$BUILD_CC -c&quot;
1010     # Just like for the target compiler, use the compiler as linker
1011     BUILD_LD=&quot;$BUILD_CC&quot;
1012     BUILD_LDCXX=&quot;$BUILD_CXX&quot;
1013 
1014     PATH=&quot;$OLDPATH&quot;
1015 
1016     if test &quot;x$OPENJDK_TARGET_OS&quot; != &quot;xandroid&quot;; then
1017       TOOLCHAIN_EXTRACT_COMPILER_VERSION(BUILD_CC, [BuildC])
1018       TOOLCHAIN_EXTRACT_COMPILER_VERSION(BUILD_CXX, [BuildC++])
1019       TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS([BUILD_], [OPENJDK_BUILD_], [build ])
1020       TOOLCHAIN_EXTRACT_LD_VERSION(BUILD_LD, [build linker])
1021       TOOLCHAIN_PREPARE_FOR_LD_VERSION_COMPARISONS([BUILD_], [OPENJDK_BUILD_])
1022     fi
1023   else
1024     # If we are not cross compiling, use the normal target compilers for
1025     # building the build platform executables.
1026     BUILD_CC=&quot;$CC&quot;
1027     BUILD_CXX=&quot;$CXX&quot;
1028     BUILD_LD=&quot;$LD&quot;
1029     BUILD_LDCXX=&quot;$LDCXX&quot;
1030     BUILD_NM=&quot;$NM&quot;
1031     BUILD_AS=&quot;$AS&quot;
1032     BUILD_OBJCOPY=&quot;$OBJCOPY&quot;
1033     BUILD_STRIP=&quot;$STRIP&quot;
1034     BUILD_AR=&quot;$AR&quot;
1035 
1036     TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS([], [OPENJDK_BUILD_], [build ])
1037     TOOLCHAIN_PREPARE_FOR_LD_VERSION_COMPARISONS([BUILD_], [OPENJDK_BUILD_])
1038   fi
1039 
1040   AC_SUBST(BUILD_CC)
1041   AC_SUBST(BUILD_CXX)
1042   AC_SUBST(BUILD_LD)
1043   AC_SUBST(BUILD_LDCXX)
1044   AC_SUBST(BUILD_NM)
1045   AC_SUBST(BUILD_AS)
1046   AC_SUBST(BUILD_AR)
1047 ])
1048 
1049 # Do some additional checks on the detected tools.
1050 AC_DEFUN_ONCE([TOOLCHAIN_MISC_CHECKS],
1051 [
1052   # Check for extra potential brokenness.
1053   if test  &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
1054     # On Windows, double-check that we got the right compiler.
1055     CC_VERSION_OUTPUT=`$CC 2&gt;&amp;1 | $GREP -v &#39;ERROR.*UtilTranslatePathList&#39; | $HEAD -n 1 | $TR -d &#39;\r&#39;`
1056     COMPILER_CPU_TEST=`$ECHO $CC_VERSION_OUTPUT | $SED -n &quot;s/^.* \(.*\)$/\1/p&quot;`
1057     if test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86&quot;; then
1058       if test &quot;x$COMPILER_CPU_TEST&quot; != &quot;x80x86&quot; -a &quot;x$COMPILER_CPU_TEST&quot; != &quot;xx86&quot;; then
1059         AC_MSG_ERROR([Target CPU mismatch. We are building for $OPENJDK_TARGET_CPU but CL is for &quot;$COMPILER_CPU_TEST&quot;; expected &quot;80x86&quot; or &quot;x86&quot;.])
1060       fi
1061     elif test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86_64&quot;; then
1062       if test &quot;x$COMPILER_CPU_TEST&quot; != &quot;xx64&quot;; then
1063         AC_MSG_ERROR([Target CPU mismatch. We are building for $OPENJDK_TARGET_CPU but CL is for &quot;$COMPILER_CPU_TEST&quot;; expected &quot;x64&quot;.])
1064       fi
1065     fi
1066   fi
1067 
1068   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
1069     # If this is a --hash-style=gnu system, use --hash-style=both, why?
1070     HAS_GNU_HASH=`$CC -dumpspecs 2&gt;/dev/null | $GREP &#39;hash-style=gnu&#39;`
1071     # This is later checked when setting flags.
1072   fi
1073 
1074   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
1075     # Check if linker has -z noexecstack.
1076     HAS_NOEXECSTACK=`$CC -Wl,--help 2&gt;/dev/null | $GREP &#39;z noexecstack&#39;`
1077     # This is later checked when setting flags.
1078   fi
1079 
1080   # Setup hotspot lecagy names for toolchains
1081   HOTSPOT_TOOLCHAIN_TYPE=$TOOLCHAIN_TYPE
1082   if test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
1083     HOTSPOT_TOOLCHAIN_TYPE=gcc
1084   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
1085     HOTSPOT_TOOLCHAIN_TYPE=visCPP
1086   fi
1087   AC_SUBST(HOTSPOT_TOOLCHAIN_TYPE)
1088 ])
1089 
1090 # Setup the JTReg Regression Test Harness.
1091 AC_DEFUN_ONCE([TOOLCHAIN_SETUP_JTREG],
1092 [
1093   AC_ARG_WITH(jtreg, [AS_HELP_STRING([--with-jtreg],
1094       [Regression Test Harness @&lt;:@probed@:&gt;@])])
1095 
1096   if test &quot;x$with_jtreg&quot; = xno; then
1097     # jtreg disabled
1098     AC_MSG_CHECKING([for jtreg test harness])
1099     AC_MSG_RESULT([no, disabled])
1100   elif test &quot;x$with_jtreg&quot; != xyes &amp;&amp; test &quot;x$with_jtreg&quot; != x; then
1101     # An explicit path is specified, use it.
1102     JT_HOME=&quot;$with_jtreg&quot;
1103     UTIL_FIXUP_PATH([JT_HOME])
1104     if test ! -d &quot;$JT_HOME&quot;; then
1105       AC_MSG_ERROR([jtreg home directory from --with-jtreg=$with_jtreg does not exist])
1106     fi
1107 
1108     if test ! -e &quot;$JT_HOME/lib/jtreg.jar&quot;; then
1109       AC_MSG_ERROR([jtreg home directory from --with-jtreg=$with_jtreg is not a valid jtreg home])
1110     fi
1111 
1112     AC_MSG_CHECKING([for jtreg test harness])
1113     AC_MSG_RESULT([$JT_HOME])
1114   else
1115     # Try to locate jtreg using the JT_HOME environment variable
1116     if test &quot;x$JT_HOME&quot; != x; then
1117       # JT_HOME set in environment, use it
1118       if test ! -d &quot;$JT_HOME&quot;; then
1119         AC_MSG_WARN([Ignoring JT_HOME pointing to invalid directory: $JT_HOME])
1120         JT_HOME=
1121       else
1122         if test ! -e &quot;$JT_HOME/lib/jtreg.jar&quot;; then
1123           AC_MSG_WARN([Ignoring JT_HOME which is not a valid jtreg home: $JT_HOME])
1124           JT_HOME=
1125         else
1126           AC_MSG_NOTICE([Located jtreg using JT_HOME from environment])
1127         fi
1128       fi
1129     fi
1130 
1131     if test &quot;x$JT_HOME&quot; = x; then
1132       # JT_HOME is not set in environment, or was deemed invalid.
1133       # Try to find jtreg on path
1134       UTIL_PATH_PROGS(JTREGEXE, jtreg)
1135       if test &quot;x$JTREGEXE&quot; != x; then
1136         # That&#39;s good, now try to derive JT_HOME
1137         JT_HOME=`(cd $($DIRNAME $JTREGEXE)/.. &amp;&amp; pwd)`
1138         if test ! -e &quot;$JT_HOME/lib/jtreg.jar&quot;; then
1139           AC_MSG_WARN([Ignoring jtreg from path since a valid jtreg home cannot be found])
1140           JT_HOME=
1141         else
1142           AC_MSG_NOTICE([Located jtreg using jtreg executable in path])
1143         fi
1144       fi
1145     fi
1146 
1147     AC_MSG_CHECKING([for jtreg test harness])
1148     if test &quot;x$JT_HOME&quot; != x; then
1149       AC_MSG_RESULT([$JT_HOME])
1150     else
1151       AC_MSG_RESULT([no, not found])
1152 
1153       if test &quot;x$with_jtreg&quot; = xyes; then
1154         AC_MSG_ERROR([--with-jtreg was specified, but no jtreg found.])
1155       fi
1156     fi
1157   fi
1158 
1159   UTIL_FIXUP_PATH(JT_HOME)
1160   AC_SUBST(JT_HOME)
1161 ])
1162 
1163 # Setup the JIB dependency resolver
1164 AC_DEFUN_ONCE([TOOLCHAIN_SETUP_JIB],
1165 [
1166   AC_ARG_WITH(jib, [AS_HELP_STRING([--with-jib],
1167       [Jib dependency management tool @&lt;:@not used@:&gt;@])])
1168 
1169   if test &quot;x$with_jib&quot; = xno || test &quot;x$with_jib&quot; = x; then
1170     # jib disabled
1171     AC_MSG_CHECKING([for jib])
1172     AC_MSG_RESULT(no)
1173   elif test &quot;x$with_jib&quot; = xyes; then
1174     AC_MSG_ERROR([Must supply a value to --with-jib])
1175   else
1176     JIB_HOME=&quot;${with_jib}&quot;
1177     AC_MSG_CHECKING([for jib])
1178     AC_MSG_RESULT(${JIB_HOME})
1179     if test ! -d &quot;${JIB_HOME}&quot;; then
1180       AC_MSG_ERROR([--with-jib must be a directory])
1181     fi
1182     JIB_JAR=$(ls ${JIB_HOME}/lib/jib-*.jar)
1183     if test ! -f &quot;${JIB_JAR}&quot;; then
1184       AC_MSG_ERROR([Could not find jib jar file in ${JIB_HOME}])
1185     fi
1186   fi
1187 
1188   AC_SUBST(JIB_HOME)
1189 ])
<a name="14" id="anc14"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="14" type="hidden" />
</body>
</html>