<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff make/hotspot/gensrc/GensrcDtrace.gmk</title>
    <link rel="stylesheet" href="../../../style.css" />
  </head>
<body>
<center><a href="GensrcAdlc.gmk.udiff.html" target="_top">&lt; prev</a> <a href="../../../index.html" target="_top">index</a> <a href="../lib/CompileGtest.gmk.udiff.html" target="_top">next &gt;</a></center>    <h2>make/hotspot/gensrc/GensrcDtrace.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  #
<span class="udiff-line-modified-removed">- # Copyright (c) 2013, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+ # Copyright (c) 2013, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
  # published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -26,14 +26,11 @@</span>
  ################################################################################
  # Gensrc support for dtrace. The files generated here are included by dtrace.hpp
  
  ifeq ($(call check-jvm-feature, dtrace), true)
  
<span class="udiff-line-modified-removed">-   ifeq ($(call isTargetOs, solaris), true)</span>
<span class="udiff-line-removed">-     DTRACE_FLAGS := -64</span>
<span class="udiff-line-removed">-     DTRACE_CPP_FLAGS := -D_LP64</span>
<span class="udiff-line-removed">-   else ifeq ($(call isTargetOs, macosx), true)</span>
<span class="udiff-line-modified-added">+   ifeq ($(call isTargetOs, macosx), true)</span>
      DTRACE_CPP_FLAGS := -D_LP64 -x c
    else ifeq ($(call isTargetOs, linux), true)
      DTRACE_CPP_FLAGS := -x c
    endif
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -52,63 +49,6 @@</span>
    # Process all .d files in DTRACE_SOURCE_DIR. They are:
    # hotspot_jni.d hotspot.d hs_private.d
    TARGETS += $(patsubst $(DTRACE_SOURCE_DIR)/%.d, \
        $(DTRACE_GENSRC_DIR)/%.h, $(wildcard $(DTRACE_SOURCE_DIR)/*.d))
  
<span class="udiff-line-removed">-   ifeq ($(call isTargetOs, solaris), true)</span>
<span class="udiff-line-removed">-     ############################################################################</span>
<span class="udiff-line-removed">-     # First we need to generate the dtraceGenOffsets tool. When run, this will</span>
<span class="udiff-line-removed">-     # produce two header files and a C++ file. Note that generateJvmOffsets.cpp</span>
<span class="udiff-line-removed">-     # is using the same JVM_CFLAGS as libjvm.so.</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     # Include support files that will setup JVM compiler flags.</span>
<span class="udiff-line-removed">-     include lib/JvmFeatures.gmk</span>
<span class="udiff-line-removed">-     include lib/JvmFlags.gmk</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     # We cannot compile until the JVMTI and JFR gensrc has finished.</span>
<span class="udiff-line-removed">-     # JFR_FILES is defined in GensrcJfr.gmk.</span>
<span class="udiff-line-removed">-     JVMTI_H := $(JVM_VARIANT_OUTPUTDIR)/gensrc/jvmtifiles/jvmti.h</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     $(eval $(call SetupNativeCompilation, BUILD_DTRACE_GEN_OFFSETS, \</span>
<span class="udiff-line-removed">-         NAME := dtraceGenOffsets, \</span>
<span class="udiff-line-removed">-         TYPE := EXECUTABLE, \</span>
<span class="udiff-line-removed">-         SRC := $(TOPDIR)/make/hotspot/src/native/dtrace, \</span>
<span class="udiff-line-removed">-         TOOLCHAIN := $(TOOLCHAIN_BUILD), \</span>
<span class="udiff-line-removed">-         LDFLAGS := -m64, \</span>
<span class="udiff-line-removed">-         CFLAGS := -m64 $(JVM_CFLAGS), \</span>
<span class="udiff-line-removed">-         DISABLED_WARNINGS_solstudio := hidef w_novirtualdescr unknownpragma \</span>
<span class="udiff-line-removed">-             doubunder nokeyworddefine wunreachable, \</span>
<span class="udiff-line-removed">-         EXTRA_DEPS := $(JVMTI_H) $(JFR_FILES), \</span>
<span class="udiff-line-removed">-         OBJECT_DIR := $(JVM_VARIANT_OUTPUTDIR)/tools/dtrace-gen-offsets/objs, \</span>
<span class="udiff-line-removed">-         OUTPUT_DIR := $(JVM_VARIANT_OUTPUTDIR)/tools/dtrace-gen-offsets, \</span>
<span class="udiff-line-removed">-     ))</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     DTRACE_GEN_OFFSETS_TOOL := $(BUILD_DTRACE_GEN_OFFSETS_TARGET)</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     # Argument 1: Output filename</span>
<span class="udiff-line-removed">-     # Argument 2: dtrace-gen-offset tool command line option</span>
<span class="udiff-line-removed">-     define SetupDtraceOffsetsGeneration</span>
<span class="udiff-line-removed">-       $$(eval $$(call SetupExecute, dtrace_offset_$$(strip $2), \</span>
<span class="udiff-line-removed">-           INFO := Generating dtrace $2 file, \</span>
<span class="udiff-line-removed">-           DEPS := $$(BUILD_DTRACE_GEN_OFFSETS), \</span>
<span class="udiff-line-removed">-           OUTPUT_FILE := $1, \</span>
<span class="udiff-line-removed">-           COMMAND := ( $$(DTRACE_GEN_OFFSETS_TOOL) -$$(strip $2) &gt; $1 ), \</span>
<span class="udiff-line-removed">-       ))</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-       TARGETS += $$(dtrace_offset_$$(strip $2)_TARGET)</span>
<span class="udiff-line-removed">-     endef</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     JVM_OFFSETS_H := $(DTRACE_GENSRC_DIR)/JvmOffsets.h</span>
<span class="udiff-line-removed">-     JVM_OFFSETS_CPP := $(DTRACE_GENSRC_DIR)/JvmOffsets.cpp</span>
<span class="udiff-line-removed">-     JVM_OFFSETS_INDEX_H := $(DTRACE_GENSRC_DIR)/JvmOffsetsIndex.h</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     ############################################################################</span>
<span class="udiff-line-removed">-     # Run the dtrace-gen-offset tool to generate these three files.</span>
<span class="udiff-line-removed">-     # The generated JvmOffsets.cpp is compiled with the rest of libjvm.</span>
<span class="udiff-line-removed">-     # The header files are used by libjvm_db and jhelper.d, respectively.</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     $(eval $(call SetupDtraceOffsetsGeneration, $(JVM_OFFSETS_H), header))</span>
<span class="udiff-line-removed">-     $(eval $(call SetupDtraceOffsetsGeneration, $(JVM_OFFSETS_INDEX_H), index))</span>
<span class="udiff-line-removed">-     $(eval $(call SetupDtraceOffsetsGeneration, $(JVM_OFFSETS_CPP), table))</span>
<span class="udiff-line-removed">-   endif</span>
<span class="udiff-line-removed">- </span>
  endif
</pre>
<center><a href="GensrcAdlc.gmk.udiff.html" target="_top">&lt; prev</a> <a href="../../../index.html" target="_top">index</a> <a href="../lib/CompileGtest.gmk.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>