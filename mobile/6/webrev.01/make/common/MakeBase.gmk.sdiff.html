<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/common/MakeBase.gmk</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="../autoconf/toolchain.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="Modules.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/common/MakeBase.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
244     $(strip \
245         $(eval MakeDir_dirs_to_make := $(strip $(foreach d, $1, \
246           $(if $(findstring ?, $d), &#39;$(call DecodeSpace, $d)&#39;, \
247             $(if $(wildcard $d), , $d) \
248           ) \
249         ))) \
250         $(if $(MakeDir_dirs_to_make), $(shell $(MKDIR) -p $(MakeDir_dirs_to_make))) \
251     )
252 
253 # Make directory for target file. Should handle spaces in filenames. Just
254 # calling $(call MakeDir $(@D)) will not work if the directory contains a space
255 # and the target file already exists. In that case, the target file will have
256 # its wildcard ? resolved and the $(@D) will evaluate each space separated dir
257 # part on its own.
258 MakeTargetDir = \
259     $(call MakeDir, $(dir $(call EncodeSpace, $@)))
260 
261 ################################################################################
262 # All install-file and related macros automatically call DecodeSpace when needed.
263 
<span class="line-modified">264 ifeq ($(call isTargetOs, solaris), true)</span>
<span class="line-removed">265   # On Solaris, if the target is a symlink and exists, cp won&#39;t overwrite.</span>
<span class="line-removed">266   # Cp has to operate in recursive mode to allow for -P flag, to preserve soft links. If the</span>
<span class="line-removed">267   # name of the target file differs from the source file, rename after copy.</span>
<span class="line-removed">268   # If the source and target parent directories are the same, recursive copy doesn&#39;t work</span>
<span class="line-removed">269   # so we fall back on regular copy, which isn&#39;t preserving symlinks.</span>
<span class="line-removed">270   define install-file</span>
<span class="line-removed">271 	$(call MakeTargetDir)</span>
<span class="line-removed">272 	$(RM) &#39;$(call DecodeSpace, $@)&#39;</span>
<span class="line-removed">273 	if [ &#39;$(call DecodeSpace, $(dir $(call EncodeSpace, $@)))&#39; != \</span>
<span class="line-removed">274 	    &#39;$(call DecodeSpace, $(dir $(call EncodeSpace, $&lt;)))&#39; ]; then \</span>
<span class="line-removed">275 	  $(CP) -f -r -P &#39;$(call DecodeSpace, $&lt;)&#39; \</span>
<span class="line-removed">276 	      &#39;$(call DecodeSpace, $(dir $(call EncodeSpace, $@)))&#39;; \</span>
<span class="line-removed">277 	  if [ &#39;$(call DecodeSpace, $(notdir $(call EncodeSpace, $@)))&#39; != \</span>
<span class="line-removed">278 	      &#39;$(call DecodeSpace, $(notdir $(call EncodeSpace, $(&lt;))))&#39; ]; then \</span>
<span class="line-removed">279 	    $(MV) &#39;$(call DecodeSpace, $(dir $(call EncodeSpace, $@))/$(notdir $(call EncodeSpace, $&lt;)))&#39; \</span>
<span class="line-removed">280 	        &#39;$(call DecodeSpace, $@)&#39;; \</span>
<span class="line-removed">281 	  fi; \</span>
<span class="line-removed">282 	else \</span>
<span class="line-removed">283 	  if [ -L &#39;$(call DecodeSpace, $&lt;)&#39; ]; then \</span>
<span class="line-removed">284 	    $(ECHO) &quot;Source file is a symlink and target is in the same directory: $&lt; $@&quot; ; \</span>
<span class="line-removed">285 	    exit 1; \</span>
<span class="line-removed">286 	  fi; \</span>
<span class="line-removed">287 	  $(CP) -f &#39;$(call DecodeSpace, $&lt;)&#39; &#39;$(call DecodeSpace, $@)&#39;; \</span>
<span class="line-removed">288 	fi</span>
<span class="line-removed">289   endef</span>
<span class="line-removed">290 else ifeq ($(call isTargetOs, macosx), true)</span>
291   # On mac, extended attributes sometimes creep into the source files, which may later
292   # cause the creation of ._* files which confuses testing. Clear these with xattr if
293   # set. Some files get their write permissions removed after being copied to the
294   # output dir. When these are copied again to images, xattr would fail. By only clearing
295   # attributes when they are present, failing on this is avoided.
296   #
297   # If copying a soft link to a directory, need to delete the target first to avoid
298   # weird errors.
299   define install-file
300 	$(call MakeTargetDir)
301 	$(RM) &#39;$(call DecodeSpace, $@)&#39;
302         # Work around a weirdness with cp on Macosx. When copying a symlink, if
303         # the target of the link is write protected (e.g. 444), cp will add
304         # write permission for the user on the target file (644). Avoid this by
305         # using ln to create a new link instead.
306 	if [ -h &#39;$(call DecodeSpace, $&lt;)&#39; ]; then \
307 	  $(LN) -s &quot;`$(READLINK) &#39;$(call DecodeSpace, $&lt;)&#39;`&quot; &#39;$(call DecodeSpace, $@)&#39;; \
308 	else \
309 	  $(CP) -fRP &#39;$(call DecodeSpace, $&lt;)&#39; &#39;$(call DecodeSpace, $@)&#39;; \
310 	fi
</pre>
</td>
<td>
<hr />
<pre>
244     $(strip \
245         $(eval MakeDir_dirs_to_make := $(strip $(foreach d, $1, \
246           $(if $(findstring ?, $d), &#39;$(call DecodeSpace, $d)&#39;, \
247             $(if $(wildcard $d), , $d) \
248           ) \
249         ))) \
250         $(if $(MakeDir_dirs_to_make), $(shell $(MKDIR) -p $(MakeDir_dirs_to_make))) \
251     )
252 
253 # Make directory for target file. Should handle spaces in filenames. Just
254 # calling $(call MakeDir $(@D)) will not work if the directory contains a space
255 # and the target file already exists. In that case, the target file will have
256 # its wildcard ? resolved and the $(@D) will evaluate each space separated dir
257 # part on its own.
258 MakeTargetDir = \
259     $(call MakeDir, $(dir $(call EncodeSpace, $@)))
260 
261 ################################################################################
262 # All install-file and related macros automatically call DecodeSpace when needed.
263 
<span class="line-modified">264 ifeq ($(call isTargetOs, macosx), true)</span>


























265   # On mac, extended attributes sometimes creep into the source files, which may later
266   # cause the creation of ._* files which confuses testing. Clear these with xattr if
267   # set. Some files get their write permissions removed after being copied to the
268   # output dir. When these are copied again to images, xattr would fail. By only clearing
269   # attributes when they are present, failing on this is avoided.
270   #
271   # If copying a soft link to a directory, need to delete the target first to avoid
272   # weird errors.
273   define install-file
274 	$(call MakeTargetDir)
275 	$(RM) &#39;$(call DecodeSpace, $@)&#39;
276         # Work around a weirdness with cp on Macosx. When copying a symlink, if
277         # the target of the link is write protected (e.g. 444), cp will add
278         # write permission for the user on the target file (644). Avoid this by
279         # using ln to create a new link instead.
280 	if [ -h &#39;$(call DecodeSpace, $&lt;)&#39; ]; then \
281 	  $(LN) -s &quot;`$(READLINK) &#39;$(call DecodeSpace, $&lt;)&#39;`&quot; &#39;$(call DecodeSpace, $@)&#39;; \
282 	else \
283 	  $(CP) -fRP &#39;$(call DecodeSpace, $&lt;)&#39; &#39;$(call DecodeSpace, $@)&#39;; \
284 	fi
</pre>
</td>
</tr>
</table>
<center><a href="../autoconf/toolchain.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="Modules.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>