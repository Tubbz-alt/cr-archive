<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff make/common/MakeBase.gmk</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="../autoconf/toolchain.m4.cdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="Modules.gmk.cdiff.html" target="_top">next &gt;</a></center>    <h2>make/common/MakeBase.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 259,37 ***</span>
      $(call MakeDir, $(dir $(call EncodeSpace, $@)))
  
  ################################################################################
  # All install-file and related macros automatically call DecodeSpace when needed.
  
<span class="line-modified">! ifeq ($(call isTargetOs, solaris), true)</span>
<span class="line-removed">-   # On Solaris, if the target is a symlink and exists, cp won&#39;t overwrite.</span>
<span class="line-removed">-   # Cp has to operate in recursive mode to allow for -P flag, to preserve soft links. If the</span>
<span class="line-removed">-   # name of the target file differs from the source file, rename after copy.</span>
<span class="line-removed">-   # If the source and target parent directories are the same, recursive copy doesn&#39;t work</span>
<span class="line-removed">-   # so we fall back on regular copy, which isn&#39;t preserving symlinks.</span>
<span class="line-removed">-   define install-file</span>
<span class="line-removed">- 	$(call MakeTargetDir)</span>
<span class="line-removed">- 	$(RM) &#39;$(call DecodeSpace, $@)&#39;</span>
<span class="line-removed">- 	if [ &#39;$(call DecodeSpace, $(dir $(call EncodeSpace, $@)))&#39; != \</span>
<span class="line-removed">- 	    &#39;$(call DecodeSpace, $(dir $(call EncodeSpace, $&lt;)))&#39; ]; then \</span>
<span class="line-removed">- 	  $(CP) -f -r -P &#39;$(call DecodeSpace, $&lt;)&#39; \</span>
<span class="line-removed">- 	      &#39;$(call DecodeSpace, $(dir $(call EncodeSpace, $@)))&#39;; \</span>
<span class="line-removed">- 	  if [ &#39;$(call DecodeSpace, $(notdir $(call EncodeSpace, $@)))&#39; != \</span>
<span class="line-removed">- 	      &#39;$(call DecodeSpace, $(notdir $(call EncodeSpace, $(&lt;))))&#39; ]; then \</span>
<span class="line-removed">- 	    $(MV) &#39;$(call DecodeSpace, $(dir $(call EncodeSpace, $@))/$(notdir $(call EncodeSpace, $&lt;)))&#39; \</span>
<span class="line-removed">- 	        &#39;$(call DecodeSpace, $@)&#39;; \</span>
<span class="line-removed">- 	  fi; \</span>
<span class="line-removed">- 	else \</span>
<span class="line-removed">- 	  if [ -L &#39;$(call DecodeSpace, $&lt;)&#39; ]; then \</span>
<span class="line-removed">- 	    $(ECHO) &quot;Source file is a symlink and target is in the same directory: $&lt; $@&quot; ; \</span>
<span class="line-removed">- 	    exit 1; \</span>
<span class="line-removed">- 	  fi; \</span>
<span class="line-removed">- 	  $(CP) -f &#39;$(call DecodeSpace, $&lt;)&#39; &#39;$(call DecodeSpace, $@)&#39;; \</span>
<span class="line-removed">- 	fi</span>
<span class="line-removed">-   endef</span>
<span class="line-removed">- else ifeq ($(call isTargetOs, macosx), true)</span>
    # On mac, extended attributes sometimes creep into the source files, which may later
    # cause the creation of ._* files which confuses testing. Clear these with xattr if
    # set. Some files get their write permissions removed after being copied to the
    # output dir. When these are copied again to images, xattr would fail. By only clearing
    # attributes when they are present, failing on this is avoided.
<span class="line-new-header">--- 259,11 ---</span>
      $(call MakeDir, $(dir $(call EncodeSpace, $@)))
  
  ################################################################################
  # All install-file and related macros automatically call DecodeSpace when needed.
  
<span class="line-modified">! ifeq ($(call isTargetOs, macosx), true)</span>
    # On mac, extended attributes sometimes creep into the source files, which may later
    # cause the creation of ._* files which confuses testing. Clear these with xattr if
    # set. Some files get their write permissions removed after being copied to the
    # output dir. When these are copied again to images, xattr would fail. By only clearing
    # attributes when they are present, failing on this is avoided.
</pre>
<center><a href="../autoconf/toolchain.m4.cdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="Modules.gmk.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>