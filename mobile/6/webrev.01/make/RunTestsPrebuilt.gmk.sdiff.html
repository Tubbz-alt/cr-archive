<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/RunTestsPrebuilt.gmk</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="RunTests.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="RunTestsPrebuiltSpec.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/RunTestsPrebuilt.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
146 include $(TOPDIR)/make/common/MakeBase.gmk
147 
148 ################################################################################
149 # Determine what platform we&#39;re running on
150 ################################################################################
151 UNAME := uname
152 
153 # Get OS name from uname (Cygwin inexplicably adds _NT-x.x)
154 UNAME_OS := $(shell $(UNAME) -s | $(CUT) -f1 -d_)
155 
156 ifeq ($(UNAME_OS), CYGWIN)
157   OPENJDK_TARGET_OS := windows
158   OPENJDK_TARGET_OS_TYPE := windows
159   OPENJDK_TARGET_OS_ENV := windows.cygwin
160 else
161   OPENJDK_TARGET_OS_TYPE:=unix
162   ifeq ($(UNAME_OS), Linux)
163     OPENJDK_TARGET_OS := linux
164   else ifeq ($(UNAME_OS), Darwin)
165     OPENJDK_TARGET_OS := macosx
<span class="line-removed">166   else ifeq ($(UNAME_OS), SunOS)</span>
<span class="line-removed">167     OPENJDK_TARGET_OS := solaris</span>
168   else
169     OPENJDK_TARGET_OS := $(UNAME_OS)
170   endif
171   OPENJDK_TARGET_OS_ENV := $(OPENJDK_TARGET_OS)
172 endif
173 
174 # Assume little endian unless otherwise specified
175 OPENJDK_TARGET_CPU_ENDIAN := little
176 
<span class="line-modified">177 ifeq ($(OPENJDK_TARGET_OS), solaris)</span>
<span class="line-modified">178   # On solaris, use uname -p</span>
<span class="line-modified">179   UNAME_CPU := $(shell $(UNAME) -p)</span>
<span class="line-modified">180   # Assume 64-bit platform</span>
<span class="line-removed">181   OPENJDK_TARGET_CPU_BITS := 64</span>
<span class="line-removed">182   ifeq ($(UNAME_CPU), i386)</span>
<span class="line-removed">183     OPENJDK_TARGET_CPU := x86_64</span>
<span class="line-removed">184   else ifeq ($(UNAME_CPU), sparc)</span>
<span class="line-removed">185     OPENJDK_TARGET_CPU := sparcv9</span>
<span class="line-removed">186     OPENJDK_TARGET_CPU_ENDIAN := big</span>
<span class="line-removed">187   else</span>
<span class="line-removed">188     OPENJDK_TARGET_CPU := $(UNAME_CPU)</span>
<span class="line-removed">189   endif</span>
190 else
<span class="line-modified">191   # ... all others use uname -m</span>
<span class="line-modified">192   UNAME_CPU := $(shell $(UNAME) -m)</span>
<span class="line-modified">193   ifeq ($(UNAME_CPU), i686)</span>
<span class="line-modified">194     OPENJDK_TARGET_CPU := x86</span>
<span class="line-removed">195     OPENJDK_TARGET_CPU_BITS := 32</span>
<span class="line-removed">196   else</span>
<span class="line-removed">197     # Assume all others are 64-bit. We use the same CPU name as uname for</span>
<span class="line-removed">198     # at least x86_64 and aarch64.</span>
<span class="line-removed">199     OPENJDK_TARGET_CPU := $(UNAME_CPU)</span>
<span class="line-removed">200     OPENJDK_TARGET_CPU_BITS := 64</span>
<span class="line-removed">201   endif</span>
202 endif
203 
204 OPENJDK_TARGET_CPU_ARCH := $(OPENJDK_TARGET_CPU)
205 ifeq ($(OPENJDK_TARGET_CPU), x86_64)
206   OPENJDK_TARGET_CPU_ARCH := x86
<span class="line-removed">207 else ifeq ($(OPENJDK_TARGET_CPU), sparcv9)</span>
<span class="line-removed">208   OPENJDK_TARGET_CPU_ARCH := sparc</span>
209 endif
210 
211 ifeq ($(OPENJDK_TARGET_OS), windows)
212   ifeq ($(wildcard $(TEST_IMAGE_DIR)/bin/fixpath.exe), )
213     $(info Error: fixpath is missing from test image &#39;$(TEST_IMAGE_DIR)&#39;)
214     $(error Cannot continue.)
215   endif
216   FIXPATH := $(TEST_IMAGE_DIR)/bin/fixpath.exe -c
217   PATH_SEP:=;
218 else
219   FIXPATH :=
220   PATH_SEP:=:
221 endif
222 
223 # Check number of cores and memory in MB
224 ifeq ($(OPENJDK_TARGET_OS), linux)
225   NUM_CORES := $(shell $(CAT) /proc/cpuinfo  | $(GREP) -c processor)
226   MEMORY_SIZE := $(shell \
227       $(EXPR) `$(CAT) /proc/meminfo | $(GREP) MemTotal | $(AWK) &#39;{print $$2}&#39;` / 1024 \
228   )
229 else ifeq ($(OPENJDK_TARGET_OS), macosx)
230   NUM_CORES := $(shell /usr/sbin/sysctl -n hw.ncpu)
231   MEMORY_SIZE := $(shell $(EXPR) `/usr/sbin/sysctl -n hw.memsize` / 1024 / 1024)
<span class="line-removed">232 else ifeq ($(OPENJDK_TARGET_OS), solaris)</span>
<span class="line-removed">233   NUM_CORES := $(shell /usr/sbin/psrinfo -v | $(GREP) -c on-line)</span>
<span class="line-removed">234   MEMORY_SIZE := $(shell \</span>
<span class="line-removed">235       /usr/sbin/prtconf 2&gt; /dev/null | $(GREP) &quot;^Memory [Ss]ize&quot; | $(AWK) &#39;{print $$3}&#39; \</span>
<span class="line-removed">236   )</span>
237 else ifeq ($(OPENJDK_TARGET_OS), windows)
238   NUM_CORES := $(NUMBER_OF_PROCESSORS)
239   MEMORY_SIZE := $(shell \
240       $(EXPR) `wmic computersystem get totalphysicalmemory -value \
241           | $(GREP) = | $(SED) &#39;s/\\r//g&#39; \
242           | $(CUT) -d &quot;=&quot; -f 2-` / 1024 / 1024 \
243   )
244 endif
245 ifeq ($(NUM_CORES), )
246   $(warn Could not find number of CPUs, assuming 1)
247   NUM_CORES := 1
248 endif
249 ifeq ($(MEMORY_SIZE), )
250   $(warn Could not find memory size, assuming 1024 MB)
251   MEMORY_SIZE := 1024
252 endif
253 
254 # Setup LD for AOT support
255 ifneq ($(DEVKIT_HOME), )
256   ifeq ($(OPENJDK_TARGET_OS), windows)
257     LD_JAOTC := $(DEVKIT_HOME)/VC/bin/x64/link.exe
258     LIBRARY_PREFIX :=
259     SHARED_LIBRARY_SUFFIX := .dll
260   else ifeq ($(OPENJDK_TARGET_OS), linux)
261     LD_JAOTC := $(DEVKIT_HOME)/bin/ld
262     LIBRARY_PREFIX := lib
263     SHARED_LIBRARY_SUFFIX := .so
264   else ifeq ($(OPENJDK_TARGET_OS), macosx)
265     LD_JAOTC := $(DEVKIT_HOME)/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ld
266     LIBRARY_PREFIX := lib
267     SHARED_LIBRARY_SUFFIX := .dylib
<span class="line-removed">268   else ifeq ($(OPENJDK_TARGET_OS), solaris)</span>
<span class="line-removed">269     # Prefer system linker for AOT on Solaris.</span>
<span class="line-removed">270     LD_JAOTC := ld</span>
<span class="line-removed">271     LIBRARY_PREFIX := lib</span>
<span class="line-removed">272     SHARED_LIBRARY_SUFFIX := .so</span>
273   endif
274 else
275   LD := ld
276 endif
277 
278 ifneq ($(wildcard $(JDK_IMAGE_DIR)/template.xml), )
279   TEST_OPTS_JCOV := true
280   JCOV_IMAGE_DIR := $(JDK_IMAGE_DIR)
281 else
282   TEST_OPTS_JCOV := false
283   JCOV_IMAGE_DIR :=
284 endif
285 
286 ################################################################################
287 # Generate the ephemeral spec file
288 ################################################################################
289 
290 # Now we can include additional custom support.
291 # This might define CUSTOM_NEW_SPEC_LINE
292 ifneq ($(CUSTOM_MAKE_DIR), )
</pre>
</td>
<td>
<hr />
<pre>
146 include $(TOPDIR)/make/common/MakeBase.gmk
147 
148 ################################################################################
149 # Determine what platform we&#39;re running on
150 ################################################################################
151 UNAME := uname
152 
153 # Get OS name from uname (Cygwin inexplicably adds _NT-x.x)
154 UNAME_OS := $(shell $(UNAME) -s | $(CUT) -f1 -d_)
155 
156 ifeq ($(UNAME_OS), CYGWIN)
157   OPENJDK_TARGET_OS := windows
158   OPENJDK_TARGET_OS_TYPE := windows
159   OPENJDK_TARGET_OS_ENV := windows.cygwin
160 else
161   OPENJDK_TARGET_OS_TYPE:=unix
162   ifeq ($(UNAME_OS), Linux)
163     OPENJDK_TARGET_OS := linux
164   else ifeq ($(UNAME_OS), Darwin)
165     OPENJDK_TARGET_OS := macosx


166   else
167     OPENJDK_TARGET_OS := $(UNAME_OS)
168   endif
169   OPENJDK_TARGET_OS_ENV := $(OPENJDK_TARGET_OS)
170 endif
171 
172 # Assume little endian unless otherwise specified
173 OPENJDK_TARGET_CPU_ENDIAN := little
174 
<span class="line-modified">175 UNAME_CPU := $(shell $(UNAME) -m)</span>
<span class="line-modified">176 ifeq ($(UNAME_CPU), i686)</span>
<span class="line-modified">177   OPENJDK_TARGET_CPU := x86</span>
<span class="line-modified">178   OPENJDK_TARGET_CPU_BITS := 32</span>









179 else
<span class="line-modified">180   # Assume all others are 64-bit. We use the same CPU name as uname for</span>
<span class="line-modified">181   # at least x86_64 and aarch64.</span>
<span class="line-modified">182   OPENJDK_TARGET_CPU := $(UNAME_CPU)</span>
<span class="line-modified">183   OPENJDK_TARGET_CPU_BITS := 64</span>







184 endif
185 
186 OPENJDK_TARGET_CPU_ARCH := $(OPENJDK_TARGET_CPU)
187 ifeq ($(OPENJDK_TARGET_CPU), x86_64)
188   OPENJDK_TARGET_CPU_ARCH := x86


189 endif
190 
191 ifeq ($(OPENJDK_TARGET_OS), windows)
192   ifeq ($(wildcard $(TEST_IMAGE_DIR)/bin/fixpath.exe), )
193     $(info Error: fixpath is missing from test image &#39;$(TEST_IMAGE_DIR)&#39;)
194     $(error Cannot continue.)
195   endif
196   FIXPATH := $(TEST_IMAGE_DIR)/bin/fixpath.exe -c
197   PATH_SEP:=;
198 else
199   FIXPATH :=
200   PATH_SEP:=:
201 endif
202 
203 # Check number of cores and memory in MB
204 ifeq ($(OPENJDK_TARGET_OS), linux)
205   NUM_CORES := $(shell $(CAT) /proc/cpuinfo  | $(GREP) -c processor)
206   MEMORY_SIZE := $(shell \
207       $(EXPR) `$(CAT) /proc/meminfo | $(GREP) MemTotal | $(AWK) &#39;{print $$2}&#39;` / 1024 \
208   )
209 else ifeq ($(OPENJDK_TARGET_OS), macosx)
210   NUM_CORES := $(shell /usr/sbin/sysctl -n hw.ncpu)
211   MEMORY_SIZE := $(shell $(EXPR) `/usr/sbin/sysctl -n hw.memsize` / 1024 / 1024)





212 else ifeq ($(OPENJDK_TARGET_OS), windows)
213   NUM_CORES := $(NUMBER_OF_PROCESSORS)
214   MEMORY_SIZE := $(shell \
215       $(EXPR) `wmic computersystem get totalphysicalmemory -value \
216           | $(GREP) = | $(SED) &#39;s/\\r//g&#39; \
217           | $(CUT) -d &quot;=&quot; -f 2-` / 1024 / 1024 \
218   )
219 endif
220 ifeq ($(NUM_CORES), )
221   $(warn Could not find number of CPUs, assuming 1)
222   NUM_CORES := 1
223 endif
224 ifeq ($(MEMORY_SIZE), )
225   $(warn Could not find memory size, assuming 1024 MB)
226   MEMORY_SIZE := 1024
227 endif
228 
229 # Setup LD for AOT support
230 ifneq ($(DEVKIT_HOME), )
231   ifeq ($(OPENJDK_TARGET_OS), windows)
232     LD_JAOTC := $(DEVKIT_HOME)/VC/bin/x64/link.exe
233     LIBRARY_PREFIX :=
234     SHARED_LIBRARY_SUFFIX := .dll
235   else ifeq ($(OPENJDK_TARGET_OS), linux)
236     LD_JAOTC := $(DEVKIT_HOME)/bin/ld
237     LIBRARY_PREFIX := lib
238     SHARED_LIBRARY_SUFFIX := .so
239   else ifeq ($(OPENJDK_TARGET_OS), macosx)
240     LD_JAOTC := $(DEVKIT_HOME)/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ld
241     LIBRARY_PREFIX := lib
242     SHARED_LIBRARY_SUFFIX := .dylib





243   endif
244 else
245   LD := ld
246 endif
247 
248 ifneq ($(wildcard $(JDK_IMAGE_DIR)/template.xml), )
249   TEST_OPTS_JCOV := true
250   JCOV_IMAGE_DIR := $(JDK_IMAGE_DIR)
251 else
252   TEST_OPTS_JCOV := false
253   JCOV_IMAGE_DIR :=
254 endif
255 
256 ################################################################################
257 # Generate the ephemeral spec file
258 ################################################################################
259 
260 # Now we can include additional custom support.
261 # This might define CUSTOM_NEW_SPEC_LINE
262 ifneq ($(CUSTOM_MAKE_DIR), )
</pre>
</td>
</tr>
</table>
<center><a href="RunTests.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="RunTestsPrebuiltSpec.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>