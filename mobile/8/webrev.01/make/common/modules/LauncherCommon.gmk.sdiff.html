<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/common/modules/LauncherCommon.gmk</title>
    <link rel="stylesheet" href="../../../style.css" />
  </head>
<body>
<center><a href="../NativeCompilation.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../../index.html" target="_top">index</a> <a href="LibCommon.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/common/modules/LauncherCommon.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 36 # On AIX/xlc we need at least xlc 13.1 for the symbol hiding (see JDK-8214063)
 37 # Also provide an override for non-conformant libraries.
 38 ifeq ($(TOOLCHAIN_TYPE), gcc)
 39   LAUNCHER_CFLAGS += -fvisibility=hidden
 40   LDFLAGS_JDKEXE += -Wl,--exclude-libs,ALL
 41 else ifeq ($(TOOLCHAIN_TYPE), clang)
 42   LAUNCHER_CFLAGS += -fvisibility=hidden
 43 endif
 44 
 45 LAUNCHER_SRC := $(TOPDIR)/src/java.base/share/native/launcher
 46 LAUNCHER_CFLAGS += -I$(TOPDIR)/src/java.base/share/native/launcher \
 47     -I$(TOPDIR)/src/java.base/share/native/libjli \
 48     -I$(TOPDIR)/src/java.base/$(OPENJDK_TARGET_OS_TYPE)/native/libjli \
 49     -I$(TOPDIR)/src/java.base/$(OPENJDK_TARGET_OS)/native/libjli \
 50     #
 51 
 52 ifeq ($(call isTargetOs, ios), true)
 53   LAUNCHER_CFLAGS += -I$(TOPDIR)/src/java.base/macosx/native/libjli
 54 fi
 55 
<span class="line-removed"> 56 GLOBAL_VERSION_INFO_RESOURCE := $(TOPDIR)/src/java.base/windows/native/common/version.rc</span>
 57 MACOSX_PLIST_DIR := $(TOPDIR)/src/java.base/macosx/native/launcher
 58 JAVA_MANIFEST := $(TOPDIR)/src/java.base/windows/native/launcher/java.manifest
 59 
 60 ################################################################################
 61 # Build standard launcher.
 62 
 63 # Setup make rules for building a standard launcher.
 64 #
 65 # Parameter 1 is the name of the rule. This name is used as variable prefix,
 66 # and the targets generated are listed in a variable by that name. It is also
 67 # used as the name of the executable.
 68 #
 69 # Remaining parameters are named arguments. These include:
 70 # MAIN_MODULE  The module of the main class to launch if different from the
 71 #     current module
 72 # MAIN_CLASS   The Java main class to launch
 73 # JAVA_ARGS   Processed into a -DJAVA_ARGS and added to CFLAGS
 74 # EXTRA_JAVA_ARGS Processed into a -DEXTRA_JAVA_ARGS and is prepended
 75 #     before JAVA_ARGS to CFLAGS, primarily to allow long string literal
 76 #     compile time defines exceeding Visual Studio 2013 limitations.
 77 # CFLAGS   Additional CFLAGS
 78 # CFLAGS_windows   Additional CFLAGS_windows
<span class="line-modified"> 79 # EXTRA_RC_FLAGS   Additional EXTRA_RC_FLAGS</span>
 80 # MACOSX_PRIVILEGED   On macosx, allow to access other processes
 81 # OPTIMIZATION   Override default optimization level (LOW)
 82 # OUTPUT_DIR   Override default output directory
 83 # VERSION_INFO_RESOURCE   Override default Windows resource file
 84 SetupBuildLauncher = $(NamedParamsMacroTemplate)
 85 define SetupBuildLauncherBody
 86   # Setup default values (unless overridden)
 87   ifeq ($$($1_OPTIMIZATION), )
 88     $1_OPTIMIZATION := LOW
 89   endif
 90 
 91   ifeq ($$($1_MAIN_MODULE), )
 92     $1_MAIN_MODULE := $(MODULE)
 93   endif
 94 
 95   $1_JAVA_ARGS += -ms8m
 96   ifneq ($$($1_MAIN_CLASS), )
 97     $1_LAUNCHER_CLASS := -m $$($1_MAIN_MODULE)/$$($1_MAIN_CLASS)
 98   endif
 99 
</pre>
<hr />
<pre>
148           $$($1_CFLAGS), \
149       CFLAGS_windows := $$($1_CFLAGS_windows), \
150       DISABLED_WARNINGS_gcc := unused-function, \
151       LDFLAGS := $$(LDFLAGS_JDKEXE) \
152           $$(call SET_EXECUTABLE_ORIGIN) \
153           $$($1_LDFLAGS), \
154       LDFLAGS_linux := $$(call SET_EXECUTABLE_ORIGIN,/../lib) \
155           -L$(call FindLibDirForModule, java.base), \
156       LDFLAGS_macosx := $$(call SET_EXECUTABLE_ORIGIN,/../lib) \
157           -L$(call FindLibDirForModule, java.base), \
158       LDFLAGS_aix := -L$(SUPPORT_OUTPUTDIR)/native/java.base, \
159       LIBS := $(JDKEXE_LIBS) $$($1_LIBS), \
160       LIBS_linux := -ljli -lpthread $(LIBDL), \
161       LIBS_macosx := -ljli -framework Cocoa -framework Security \
162           -framework ApplicationServices, \
163       LIBS_aix := -ljli_static, \
164       LIBS_windows := $$($1_WINDOWS_JLI_LIB) \
165           $(SUPPORT_OUTPUTDIR)/native/java.base/libjava/java.lib, \
166       OUTPUT_DIR := $$($1_OUTPUT_DIR), \
167       VERSIONINFO_RESOURCE := $$($1_VERSION_INFO_RESOURCE), \
<span class="line-modified">168       EXTRA_RC_FLAGS := $$($1_EXTRA_RC_FLAGS), \</span>
169       MANIFEST := $(JAVA_MANIFEST), \
170       MANIFEST_VERSION := $(VERSION_NUMBER_FOUR_POSITIONS), \
171   ))
172 
173   $1 += $$(BUILD_LAUNCHER_$1)
174   TARGETS += $$($1)
175 
176   ifeq ($(call isTargetOs, aix), true)
177     $$(BUILD_LAUNCHER_$1): $(call FindStaticLib, java.base, jli_static)
178   endif
179 
180   ifeq ($(call isTargetOs, windows), true)
181     $$(BUILD_LAUNCHER_$1): $(call FindStaticLib, java.base, java, /libjava) \
182         $$($1_WINDOWS_JLI_LIB)
183   endif
184 endef
185 
186 ################################################################################
187 # Create man pages for jmod to pick up. There should be a one-to-one
188 # relationship between executables and man pages (even if this is not always
</pre>
</td>
<td>
<hr />
<pre>
 36 # On AIX/xlc we need at least xlc 13.1 for the symbol hiding (see JDK-8214063)
 37 # Also provide an override for non-conformant libraries.
 38 ifeq ($(TOOLCHAIN_TYPE), gcc)
 39   LAUNCHER_CFLAGS += -fvisibility=hidden
 40   LDFLAGS_JDKEXE += -Wl,--exclude-libs,ALL
 41 else ifeq ($(TOOLCHAIN_TYPE), clang)
 42   LAUNCHER_CFLAGS += -fvisibility=hidden
 43 endif
 44 
 45 LAUNCHER_SRC := $(TOPDIR)/src/java.base/share/native/launcher
 46 LAUNCHER_CFLAGS += -I$(TOPDIR)/src/java.base/share/native/launcher \
 47     -I$(TOPDIR)/src/java.base/share/native/libjli \
 48     -I$(TOPDIR)/src/java.base/$(OPENJDK_TARGET_OS_TYPE)/native/libjli \
 49     -I$(TOPDIR)/src/java.base/$(OPENJDK_TARGET_OS)/native/libjli \
 50     #
 51 
 52 ifeq ($(call isTargetOs, ios), true)
 53   LAUNCHER_CFLAGS += -I$(TOPDIR)/src/java.base/macosx/native/libjli
 54 fi
 55 

 56 MACOSX_PLIST_DIR := $(TOPDIR)/src/java.base/macosx/native/launcher
 57 JAVA_MANIFEST := $(TOPDIR)/src/java.base/windows/native/launcher/java.manifest
 58 
 59 ################################################################################
 60 # Build standard launcher.
 61 
 62 # Setup make rules for building a standard launcher.
 63 #
 64 # Parameter 1 is the name of the rule. This name is used as variable prefix,
 65 # and the targets generated are listed in a variable by that name. It is also
 66 # used as the name of the executable.
 67 #
 68 # Remaining parameters are named arguments. These include:
 69 # MAIN_MODULE  The module of the main class to launch if different from the
 70 #     current module
 71 # MAIN_CLASS   The Java main class to launch
 72 # JAVA_ARGS   Processed into a -DJAVA_ARGS and added to CFLAGS
 73 # EXTRA_JAVA_ARGS Processed into a -DEXTRA_JAVA_ARGS and is prepended
 74 #     before JAVA_ARGS to CFLAGS, primarily to allow long string literal
 75 #     compile time defines exceeding Visual Studio 2013 limitations.
 76 # CFLAGS   Additional CFLAGS
 77 # CFLAGS_windows   Additional CFLAGS_windows
<span class="line-modified"> 78 # EXTRA_RCFLAGS   Additional EXTRA_RCFLAGS</span>
 79 # MACOSX_PRIVILEGED   On macosx, allow to access other processes
 80 # OPTIMIZATION   Override default optimization level (LOW)
 81 # OUTPUT_DIR   Override default output directory
 82 # VERSION_INFO_RESOURCE   Override default Windows resource file
 83 SetupBuildLauncher = $(NamedParamsMacroTemplate)
 84 define SetupBuildLauncherBody
 85   # Setup default values (unless overridden)
 86   ifeq ($$($1_OPTIMIZATION), )
 87     $1_OPTIMIZATION := LOW
 88   endif
 89 
 90   ifeq ($$($1_MAIN_MODULE), )
 91     $1_MAIN_MODULE := $(MODULE)
 92   endif
 93 
 94   $1_JAVA_ARGS += -ms8m
 95   ifneq ($$($1_MAIN_CLASS), )
 96     $1_LAUNCHER_CLASS := -m $$($1_MAIN_MODULE)/$$($1_MAIN_CLASS)
 97   endif
 98 
</pre>
<hr />
<pre>
147           $$($1_CFLAGS), \
148       CFLAGS_windows := $$($1_CFLAGS_windows), \
149       DISABLED_WARNINGS_gcc := unused-function, \
150       LDFLAGS := $$(LDFLAGS_JDKEXE) \
151           $$(call SET_EXECUTABLE_ORIGIN) \
152           $$($1_LDFLAGS), \
153       LDFLAGS_linux := $$(call SET_EXECUTABLE_ORIGIN,/../lib) \
154           -L$(call FindLibDirForModule, java.base), \
155       LDFLAGS_macosx := $$(call SET_EXECUTABLE_ORIGIN,/../lib) \
156           -L$(call FindLibDirForModule, java.base), \
157       LDFLAGS_aix := -L$(SUPPORT_OUTPUTDIR)/native/java.base, \
158       LIBS := $(JDKEXE_LIBS) $$($1_LIBS), \
159       LIBS_linux := -ljli -lpthread $(LIBDL), \
160       LIBS_macosx := -ljli -framework Cocoa -framework Security \
161           -framework ApplicationServices, \
162       LIBS_aix := -ljli_static, \
163       LIBS_windows := $$($1_WINDOWS_JLI_LIB) \
164           $(SUPPORT_OUTPUTDIR)/native/java.base/libjava/java.lib, \
165       OUTPUT_DIR := $$($1_OUTPUT_DIR), \
166       VERSIONINFO_RESOURCE := $$($1_VERSION_INFO_RESOURCE), \
<span class="line-modified">167       EXTRA_RCFLAGS := $$($1_EXTRA_RCFLAGS), \</span>
168       MANIFEST := $(JAVA_MANIFEST), \
169       MANIFEST_VERSION := $(VERSION_NUMBER_FOUR_POSITIONS), \
170   ))
171 
172   $1 += $$(BUILD_LAUNCHER_$1)
173   TARGETS += $$($1)
174 
175   ifeq ($(call isTargetOs, aix), true)
176     $$(BUILD_LAUNCHER_$1): $(call FindStaticLib, java.base, jli_static)
177   endif
178 
179   ifeq ($(call isTargetOs, windows), true)
180     $$(BUILD_LAUNCHER_$1): $(call FindStaticLib, java.base, java, /libjava) \
181         $$($1_WINDOWS_JLI_LIB)
182   endif
183 endef
184 
185 ################################################################################
186 # Create man pages for jmod to pick up. There should be a one-to-one
187 # relationship between executables and man pages (even if this is not always
</pre>
</td>
</tr>
</table>
<center><a href="../NativeCompilation.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../../index.html" target="_top">index</a> <a href="LibCommon.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>