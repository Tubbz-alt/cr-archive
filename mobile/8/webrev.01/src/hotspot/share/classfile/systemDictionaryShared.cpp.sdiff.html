<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/classfile/systemDictionaryShared.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="packageEntry.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../compiler/compileBroker.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/classfile/systemDictionaryShared.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 855       //   If a shared InstanceKlass k is loaded from the class path, let
 856       //
 857       //     index = k-&gt;shared_classpath_index():
 858       //
 859       //   FileMap::_shared_path_table[index] identifies the JAR file that contains k.
 860       //
 861       //   k&#39;s protection domain is:
 862       //
 863       //     ProtectionDomain pd = _shared_protection_domains[index];
 864       //
 865       //   and k&#39;s Package is initialized using
 866       //
 867       //     manifest = _shared_jar_manifests[index];
 868       //     url = _shared_jar_urls[index];
 869       //     define_shared_package(class_name, class_loader, manifest, url, CHECK_(pd));
 870       //
 871       //   Note that if an element of these 3 _shared_xxx arrays is NULL, it will be initialized by
 872       //   the corresponding SystemDictionaryShared::get_shared_xxx() function.
 873       Handle manifest = get_shared_jar_manifest(index, CHECK_(pd));
 874       Handle url = get_shared_jar_url(index, CHECK_(pd));
<span class="line-modified"> 875       define_shared_package(class_name, class_loader, manifest, url, CHECK_(pd));</span>












 876       pd = get_shared_protection_domain(class_loader, index, url, CHECK_(pd));
 877     }
 878   }
 879   return pd;
 880 }
 881 
 882 bool SystemDictionaryShared::is_sharing_possible(ClassLoaderData* loader_data) {
 883   oop class_loader = loader_data-&gt;class_loader();
 884   return (class_loader == NULL ||
 885           SystemDictionary::is_system_class_loader(class_loader) ||
 886           SystemDictionary::is_platform_class_loader(class_loader));
 887 }
 888 
 889 bool SystemDictionaryShared::has_platform_or_app_classes() {
 890   if (FileMapInfo::current_info()-&gt;has_platform_or_app_classes()) {
 891     return true;
 892   }
 893   if (DynamicArchive::is_mapped() &amp;&amp;
 894       FileMapInfo::dynamic_info()-&gt;has_platform_or_app_classes()) {
 895     return true;
</pre>
</td>
<td>
<hr />
<pre>
 855       //   If a shared InstanceKlass k is loaded from the class path, let
 856       //
 857       //     index = k-&gt;shared_classpath_index():
 858       //
 859       //   FileMap::_shared_path_table[index] identifies the JAR file that contains k.
 860       //
 861       //   k&#39;s protection domain is:
 862       //
 863       //     ProtectionDomain pd = _shared_protection_domains[index];
 864       //
 865       //   and k&#39;s Package is initialized using
 866       //
 867       //     manifest = _shared_jar_manifests[index];
 868       //     url = _shared_jar_urls[index];
 869       //     define_shared_package(class_name, class_loader, manifest, url, CHECK_(pd));
 870       //
 871       //   Note that if an element of these 3 _shared_xxx arrays is NULL, it will be initialized by
 872       //   the corresponding SystemDictionaryShared::get_shared_xxx() function.
 873       Handle manifest = get_shared_jar_manifest(index, CHECK_(pd));
 874       Handle url = get_shared_jar_url(index, CHECK_(pd));
<span class="line-modified"> 875       int index_offset = index - ClassLoaderExt::app_class_paths_start_index();</span>
<span class="line-added"> 876       if (index_offset &lt; PackageEntry::max_index_for_defined_in_class_path()) {</span>
<span class="line-added"> 877         if (pkg_entry == NULL || !pkg_entry-&gt;is_defined_by_cds_in_class_path(index_offset)) {</span>
<span class="line-added"> 878           // define_shared_package only needs to be called once for each package in a jar specified</span>
<span class="line-added"> 879           // in the shared class path.</span>
<span class="line-added"> 880           define_shared_package(class_name, class_loader, manifest, url, CHECK_(pd));</span>
<span class="line-added"> 881           if (pkg_entry != NULL) {</span>
<span class="line-added"> 882             pkg_entry-&gt;set_defined_by_cds_in_class_path(index_offset);</span>
<span class="line-added"> 883           }</span>
<span class="line-added"> 884         }</span>
<span class="line-added"> 885       } else {</span>
<span class="line-added"> 886         define_shared_package(class_name, class_loader, manifest, url, CHECK_(pd));</span>
<span class="line-added"> 887       }</span>
 888       pd = get_shared_protection_domain(class_loader, index, url, CHECK_(pd));
 889     }
 890   }
 891   return pd;
 892 }
 893 
 894 bool SystemDictionaryShared::is_sharing_possible(ClassLoaderData* loader_data) {
 895   oop class_loader = loader_data-&gt;class_loader();
 896   return (class_loader == NULL ||
 897           SystemDictionary::is_system_class_loader(class_loader) ||
 898           SystemDictionary::is_platform_class_loader(class_loader));
 899 }
 900 
 901 bool SystemDictionaryShared::has_platform_or_app_classes() {
 902   if (FileMapInfo::current_info()-&gt;has_platform_or_app_classes()) {
 903     return true;
 904   }
 905   if (DynamicArchive::is_mapped() &amp;&amp;
 906       FileMapInfo::dynamic_info()-&gt;has_platform_or_app_classes()) {
 907     return true;
</pre>
</td>
</tr>
</table>
<center><a href="packageEntry.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../compiler/compileBroker.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>