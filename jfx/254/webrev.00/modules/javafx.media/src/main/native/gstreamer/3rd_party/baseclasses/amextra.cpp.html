<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.media/src/main/native/gstreamer/3rd_party/baseclasses/amextra.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 //------------------------------------------------------------------------------
  2 // File: AMExtra.cpp
  3 //
  4 // Desc: DirectShow base classes - implements CRenderedInputPin class.
  5 //
  6 // Copyright (c) 1992-2001 Microsoft Corporation.  All rights reserved.
  7 //------------------------------------------------------------------------------
  8 
  9 
 10 #include &lt;streams.h&gt;        // DirectShow base class definitions
 11 #include &lt;mmsystem.h&gt;       // Needed for definition of timeGetTime
 12 #include &lt;limits.h&gt;         // Standard data type limit definitions
 13 #include &lt;measure.h&gt;        // Used for time critical log functions
 14 
 15 #include &quot;amextra.h&quot;
 16 
 17 #pragma warning(disable:4355)
 18 
 19 //  Implements CRenderedInputPin class
 20 
 21 CRenderedInputPin::CRenderedInputPin(__in_opt LPCTSTR pObjectName,
 22                                      __in CBaseFilter *pFilter,
 23                                      __in CCritSec *pLock,
 24                                      __inout HRESULT *phr,
 25                                      __in_opt LPCWSTR pName) :
 26     CBaseInputPin(pObjectName, pFilter, pLock, phr, pName),
 27     m_bAtEndOfStream(FALSE),
 28     m_bCompleteNotified(FALSE)
 29 {
 30 }
 31 #ifdef UNICODE
 32 CRenderedInputPin::CRenderedInputPin(__in_opt LPCSTR pObjectName,
 33                                      __in CBaseFilter *pFilter,
 34                                      __in CCritSec *pLock,
 35                                      __inout HRESULT *phr,
 36                                      __in_opt LPCWSTR pName) :
 37     CBaseInputPin(pObjectName, pFilter, pLock, phr, pName),
 38     m_bAtEndOfStream(FALSE),
 39     m_bCompleteNotified(FALSE)
 40 {
 41 }
 42 #endif
 43 
 44 // Flush end of stream condition - caller should do any
 45 // necessary stream level locking before calling this
 46 
 47 STDMETHODIMP CRenderedInputPin::EndOfStream()
 48 {
 49     HRESULT hr = CheckStreaming();
 50 
 51     //  Do EC_COMPLETE handling for rendered pins
 52     if (S_OK == hr  &amp;&amp; !m_bAtEndOfStream) {
 53         m_bAtEndOfStream = TRUE;
 54         FILTER_STATE fs;
 55         EXECUTE_ASSERT(SUCCEEDED(m_pFilter-&gt;GetState(0, &amp;fs)));
 56         if (fs == State_Running) {
 57             DoCompleteHandling();
 58         }
 59     }
 60     return hr;
 61 }
 62 
 63 
 64 // Called to complete the flush
 65 
 66 STDMETHODIMP CRenderedInputPin::EndFlush()
 67 {
 68     CAutoLock lck(m_pLock);
 69 
 70     // Clean up renderer state
 71     m_bAtEndOfStream = FALSE;
 72     m_bCompleteNotified = FALSE;
 73 
 74     return CBaseInputPin::EndFlush();
 75 }
 76 
 77 
 78 // Notify of Run() from filter
 79 
 80 HRESULT CRenderedInputPin::Run(REFERENCE_TIME tStart)
 81 {
 82     UNREFERENCED_PARAMETER(tStart);
 83     m_bCompleteNotified = FALSE;
 84     if (m_bAtEndOfStream) {
 85         DoCompleteHandling();
 86     }
 87     return S_OK;
 88 }
 89 
 90 
 91 //  Clear status on going into paused state
 92 
 93 HRESULT CRenderedInputPin::Active()
 94 {
 95     m_bAtEndOfStream = FALSE;
 96     m_bCompleteNotified = FALSE;
 97     return CBaseInputPin::Active();
 98 }
 99 
100 
101 //  Do stuff to deliver end of stream
102 
103 void CRenderedInputPin::DoCompleteHandling()
104 {
105     ASSERT(m_bAtEndOfStream);
106     if (!m_bCompleteNotified) {
107         m_bCompleteNotified = TRUE;
108         m_pFilter-&gt;NotifyEvent(EC_COMPLETE, S_OK, (LONG_PTR)(IBaseFilter *)m_pFilter);
109     }
110 }
111 
    </pre>
  </body>
</html>