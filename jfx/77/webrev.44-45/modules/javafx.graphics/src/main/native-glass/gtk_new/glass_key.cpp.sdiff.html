<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.graphics/src/main/native-glass/gtk_new/glass_key.cpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="glass_general.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="glass_screen.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.graphics/src/main/native-glass/gtk_new/glass_key.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
227 
228 static void init_keymap() {
229     if (!key_initialized) {
230         initialize_key();
231         key_initialized = TRUE;
232     }
233 }
234 
235 jint gdk_keyval_to_glass(guint keyval)
236 {
237     init_keymap();
238     return GPOINTER_TO_INT(g_hash_table_lookup(keymap, GINT_TO_POINTER(keyval)));
239 }
240 
241 jint get_glass_key(GdkEventKey* e) {
242     init_keymap();
243 
244     guint keyValue;
245     guint state = e-&gt;state &amp; GDK_MOD2_MASK; //NumLock test
246 
<span class="line-modified">247     gdk_keymap_translate_keyboard_state(gdk_keymap_get_default(),</span>
248             e-&gt;hardware_keycode, static_cast&lt;GdkModifierType&gt;(state), e-&gt;group,
249             &amp;keyValue, NULL, NULL, NULL);
250 
251     jint key = GPOINTER_TO_INT(g_hash_table_lookup(keymap,
252             GINT_TO_POINTER(keyValue)));
253 
254     if (!key) {
255         // We failed to find a keyval in our keymap, this may happen with
256         // non-latin layouts(e.g. Cyrillic). So here we try to find a keyval
257         // from a default layout(we assume that it is a US-like one).
258         GdkKeymapKey kk;
259         kk.keycode = e-&gt;hardware_keycode;
260         kk.group = kk.level = 0;
261 
<span class="line-modified">262         keyValue = gdk_keymap_lookup_key(gdk_keymap_get_default(), &amp;kk);</span>
263 
264         key = GPOINTER_TO_INT(g_hash_table_lookup(keymap,
265                 GINT_TO_POINTER(keyValue)));
266     }
267 
268     return key;
269 }
270 
271 gint find_gdk_keyval_for_glass_keycode(jint code) {
272     gint result = -1;
273     GHashTableIter iter;
274     gpointer key, value;
275     init_keymap();
276     g_hash_table_iter_init(&amp;iter, keymap);
277     while (g_hash_table_iter_next(&amp;iter, &amp;key, &amp;value)) {
278         if (code == GPOINTER_TO_INT(value)) {
279             result = GPOINTER_TO_INT(key);
280             break;
281         }
282     }
</pre>
</td>
<td>
<hr />
<pre>
227 
228 static void init_keymap() {
229     if (!key_initialized) {
230         initialize_key();
231         key_initialized = TRUE;
232     }
233 }
234 
235 jint gdk_keyval_to_glass(guint keyval)
236 {
237     init_keymap();
238     return GPOINTER_TO_INT(g_hash_table_lookup(keymap, GINT_TO_POINTER(keyval)));
239 }
240 
241 jint get_glass_key(GdkEventKey* e) {
242     init_keymap();
243 
244     guint keyValue;
245     guint state = e-&gt;state &amp; GDK_MOD2_MASK; //NumLock test
246 
<span class="line-modified">247     gdk_keymap_translate_keyboard_state(gdk_keymap_get_for_display(gdk_display_get_default()),</span>
248             e-&gt;hardware_keycode, static_cast&lt;GdkModifierType&gt;(state), e-&gt;group,
249             &amp;keyValue, NULL, NULL, NULL);
250 
251     jint key = GPOINTER_TO_INT(g_hash_table_lookup(keymap,
252             GINT_TO_POINTER(keyValue)));
253 
254     if (!key) {
255         // We failed to find a keyval in our keymap, this may happen with
256         // non-latin layouts(e.g. Cyrillic). So here we try to find a keyval
257         // from a default layout(we assume that it is a US-like one).
258         GdkKeymapKey kk;
259         kk.keycode = e-&gt;hardware_keycode;
260         kk.group = kk.level = 0;
261 
<span class="line-modified">262         keyValue = gdk_keymap_lookup_key(gdk_keymap_get_for_display(gdk_display_get_default()), &amp;kk);</span>
263 
264         key = GPOINTER_TO_INT(g_hash_table_lookup(keymap,
265                 GINT_TO_POINTER(keyValue)));
266     }
267 
268     return key;
269 }
270 
271 gint find_gdk_keyval_for_glass_keycode(jint code) {
272     gint result = -1;
273     GHashTableIter iter;
274     gpointer key, value;
275     init_keymap();
276     g_hash_table_iter_init(&amp;iter, keymap);
277     while (g_hash_table_iter_next(&amp;iter, &amp;key, &amp;value)) {
278         if (code == GPOINTER_TO_INT(value)) {
279             result = GPOINTER_TO_INT(key);
280             break;
281         }
282     }
</pre>
</td>
</tr>
</table>
<center><a href="glass_general.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="glass_screen.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>