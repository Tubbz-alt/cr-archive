<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/ThirdParty/libxml/src/configure.ac</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 dnl Process this file with autoconf to produce a configure script.
   2 AC_PREREQ([2.63])
   3 AC_INIT
   4 AC_CONFIG_SRCDIR([entities.c])
   5 AC_CONFIG_HEADERS([config.h])
   6 AM_MAINTAINER_MODE([enable])
   7 AC_CONFIG_MACRO_DIR([m4])
   8 AC_CANONICAL_HOST
   9 
  10 LIBXML_MAJOR_VERSION=2
  11 LIBXML_MINOR_VERSION=9
<a name="1" id="anc1"></a><span class="line-modified">  12 LIBXML_MICRO_VERSION=10</span>
  13 LIBXML_MICRO_VERSION_SUFFIX=
  14 LIBXML_VERSION=$LIBXML_MAJOR_VERSION.$LIBXML_MINOR_VERSION.$LIBXML_MICRO_VERSION$LIBXML_MICRO_VERSION_SUFFIX
  15 LIBXML_VERSION_INFO=`expr $LIBXML_MAJOR_VERSION + $LIBXML_MINOR_VERSION`:$LIBXML_MICRO_VERSION:$LIBXML_MINOR_VERSION
  16 
  17 LIBXML_VERSION_NUMBER=`expr $LIBXML_MAJOR_VERSION \* 10000 + $LIBXML_MINOR_VERSION \* 100 + $LIBXML_MICRO_VERSION`
  18 
  19 if test -f CVS/Entries ; then
  20   extra=`grep ChangeLog CVS/Entries | grep -v LIBXML | sed -e s\%/ChangeLog/1\.%% -e s\%/.*$%%`
  21   echo extra=$extra
  22   if test &quot;$extra&quot; != &quot;&quot;
  23   then
  24       LIBXML_VERSION_EXTRA=&quot;-CVS$extra&quot;
  25   fi
  26 else if test -d .svn ; then
  27   extra=`svn info | grep Revision | sed &#39;s+Revision: ++&#39;`
  28   echo extra=$extra
  29   if test &quot;$extra&quot; != &quot;&quot;
  30   then
  31       LIBXML_VERSION_EXTRA=&quot;-SVN$extra&quot;
  32   fi
  33 else if test -d .git ; then
  34   extra=`git describe 2&gt;/dev/null | sed &#39;s+LIBXML[[0-9.]]*-++&#39;`
  35   echo extra=$extra
  36   if test &quot;$extra&quot; != &quot;&quot;
  37   then
  38       LIBXML_VERSION_EXTRA=&quot;-GIT$extra&quot;
  39   fi
  40 fi
  41 fi
  42 fi
  43 AC_SUBST(LIBXML_MAJOR_VERSION)
  44 AC_SUBST(LIBXML_MINOR_VERSION)
  45 AC_SUBST(LIBXML_MICRO_VERSION)
  46 AC_SUBST(LIBXML_VERSION)
  47 AC_SUBST(LIBXML_VERSION_INFO)
  48 AC_SUBST(LIBXML_VERSION_NUMBER)
  49 AC_SUBST(LIBXML_VERSION_EXTRA)
  50 
  51 VERSION=${LIBXML_VERSION}
  52 
  53 AM_INIT_AUTOMAKE(libxml2, $VERSION)
  54 
  55 # Support silent build rules, requires at least automake-1.11. Disable
  56 # by either passing --disable-silent-rules to configure or passing V=1
  57 # to make
  58 m4_ifdef([AM_SILENT_RULES], [AM_SILENT_RULES([yes])])
  59 
  60 dnl Checks for programs.
  61 AC_PROG_CC
  62 AC_PROG_INSTALL
  63 AC_PROG_LN_S
  64 AC_PROG_MKDIR_P
  65 AC_PROG_CPP
  66 AC_PATH_PROG(MV, mv, /bin/mv)
  67 AC_PATH_PROG(TAR, tar, /bin/tar)
  68 AC_PATH_PROG(PERL, perl, /usr/bin/perl)
  69 AC_PATH_PROG(WGET, wget, /usr/bin/wget)
  70 AC_PATH_PROG(XMLLINT, xmllint, /usr/bin/xmllint)
  71 AC_PATH_PROG(XSLTPROC, xsltproc, /usr/bin/xsltproc)
  72 PKG_PROG_PKG_CONFIG
  73 
  74 LT_INIT
  75 
  76 dnl
  77 dnl if the system support linker version scripts for symbol versioning
  78 dnl then add it
  79 dnl
  80 VERSION_SCRIPT_FLAGS=
  81 # lt_cv_prog_gnu_ld is from libtool 2.+
  82 if test &quot;$lt_cv_prog_gnu_ld&quot; = yes; then
  83   VERSION_SCRIPT_FLAGS=-Wl,--version-script=
  84 else
  85   case $host in
  86   *-*-sunos*) VERSION_SCRIPT_FLAGS=&quot;-Wl,-M -Wl,&quot;;;
  87   esac
  88 fi
  89 AC_SUBST(VERSION_SCRIPT_FLAGS)
  90 AM_CONDITIONAL([USE_VERSION_SCRIPT], [test -n &quot;$VERSION_SCRIPT_FLAGS&quot;])
  91 
  92 dnl
  93 dnl We process the AC_ARG_WITH first so that later we can modify
  94 dnl some of them to try to prevent impossible combinations.  This
  95 dnl also allows up so alphabetize the choices
  96 dnl
  97 
  98 dnl
  99 dnl zlib option might change flags, so we save them initially
 100 dnl
 101 _cppflags=&quot;${CPPFLAGS}&quot;
 102 _libs=&quot;${LIBS}&quot;
 103 
 104 AC_ARG_WITH(c14n,
 105 [  --with-c14n             add the Canonicalization support (on)])
 106 AC_ARG_WITH(catalog,
 107 [  --with-catalog          add the Catalog support (on)])
 108 AC_ARG_WITH(debug,
 109 [  --with-debug            add the debugging module (on)])
 110 AC_ARG_WITH(docbook,
 111 [  --with-docbook          add Docbook SGML support (on)])
 112 AC_ARG_WITH(fexceptions,
 113 [  --with-fexceptions      add GCC flag -fexceptions for C++ exceptions (off)])
 114 AC_ARG_WITH(ftp,
 115 [  --with-ftp              add the FTP support (on)])
 116 AC_ARG_WITH(history,
 117 [  --with-history          add history support to xmllint shell(off)])
 118 AC_ARG_WITH(html,
 119 [  --with-html             add the HTML support (on)])
 120 dnl Specific dir for HTML output ?
 121 AC_ARG_WITH(html-dir, AS_HELP_STRING([--with-html-dir=path],
 122             [path to base html directory, default $datadir/doc/html]),
 123             [HTML_DIR=$withval], [HTML_DIR=&#39;$(datadir)/doc&#39;])
 124 
 125 AC_ARG_WITH(html-subdir, AS_HELP_STRING([--with-html-subdir=path],
 126             [directory used under html-dir, default $PACKAGE-$VERSION/html]),
 127             [test &quot;x$withval&quot; != &quot;x&quot; &amp;&amp; HTML_DIR=&quot;$HTML_DIR/$withval&quot;],
 128             [HTML_DIR=&quot;$HTML_DIR/\$(PACKAGE)-\$(VERSION)/html&quot;])
 129 AC_SUBST(HTML_DIR)
 130 AC_ARG_WITH(http,
 131 [  --with-http             add the HTTP support (on)])
 132 AC_ARG_WITH(iconv,
 133 [  --with-iconv[[=DIR]]      add ICONV support (on)])
 134 AC_ARG_WITH(icu,
 135 [  --with-icu                add ICU support (off)])
 136 AC_ARG_WITH(iso8859x,
 137 [  --with-iso8859x         add ISO8859X support if no iconv (on)])
 138 AC_ARG_WITH(legacy,
 139 [  --with-legacy           add deprecated APIs for compatibility (on)])
 140 AC_ARG_WITH(mem_debug,
 141 [  --with-mem-debug        add the memory debugging module (off)])
 142 AC_ARG_WITH(minimum,
 143 [  --with-minimum          build a minimally sized library (off)])
 144 AC_ARG_WITH(output,
 145 [  --with-output           add the serialization support (on)])
 146 AC_ARG_WITH(pattern,
 147 [  --with-pattern          add the xmlPattern selection interface (on)])
 148 AC_ARG_WITH(push,
 149 [  --with-push             add the PUSH parser interfaces (on)])
 150 AC_ARG_WITH(python,
 151 [  --with-python[[=DIR]]     build Python bindings if found])
 152 AC_ARG_WITH(python_install_dir,
 153 [  --with-python-install-dir=DIR
 154                           install Python bindings in DIR])
 155 AC_ARG_WITH(reader,
 156 [  --with-reader           add the xmlReader parsing interface (on)])
 157 AC_ARG_WITH(readline,
 158 [  --with-readline=DIR     use readline in DIR],[
 159   if test &quot;$withval&quot; != &quot;no&quot; -a &quot;$withval&quot; != &quot;yes&quot;; then
 160     RDL_DIR=$withval
 161     CPPFLAGS=&quot;${CPPFLAGS} -I$withval/include&quot;
 162     LDFLAGS=&quot;${LDFLAGS} -L$withval/lib&quot;
 163   fi
 164 ])
 165 AC_ARG_WITH(regexps,
 166 [  --with-regexps          add Regular Expressions support (on)])
 167 AC_ARG_WITH(run_debug,
 168 [  --with-run-debug        add the runtime debugging module (off)])
 169 AC_ARG_WITH(sax1,
 170 [  --with-sax1             add the older SAX1 interface (on)])
 171 AC_ARG_WITH(schemas,
 172 [  --with-schemas          add Relax-NG and Schemas support (on)])
 173 AC_ARG_WITH(schematron,
 174 [  --with-schematron       add Schematron support (on)])
 175 AC_ARG_WITH(threads,
 176 [  --with-threads          add multithread support(on)])
 177 AC_ARG_WITH(thread-alloc,
 178 [  --with-thread-alloc     add per-thread memory(off)])
 179 AC_ARG_WITH(tree,
 180 [  --with-tree             add the DOM like tree manipulation APIs (on)])
 181 AC_ARG_WITH(valid,
 182 [  --with-valid            add the DTD validation support (on)])
 183 AC_ARG_WITH(writer,
 184 [  --with-writer           add the xmlWriter saving interface (on)])
 185 AC_ARG_WITH(xinclude,
 186 [  --with-xinclude         add the XInclude support (on)])
 187 AC_ARG_WITH(xpath,
 188 [  --with-xpath            add the XPATH support (on)])
 189 AC_ARG_WITH(xptr,
 190 [  --with-xptr             add the XPointer support (on)])
 191 AC_ARG_WITH(modules,
 192 [  --with-modules          add the dynamic modules support (on)])
 193 AC_ARG_WITH(zlib,
 194 [  --with-zlib[[=DIR]]       use libz in DIR],[
 195   if test &quot;$withval&quot; != &quot;no&quot; -a &quot;$withval&quot; != &quot;yes&quot;; then
 196     Z_DIR=$withval
 197     CPPFLAGS=&quot;${CPPFLAGS} -I$withval/include&quot;
 198     LDFLAGS=&quot;${LDFLAGS} -L$withval/lib&quot;
 199   fi
 200 ])
 201 AC_ARG_WITH(lzma,
 202 [  --with-lzma[[=DIR]]       use liblzma in DIR],[
 203   if test &quot;$withval&quot; != &quot;no&quot; -a &quot;$withval&quot; != &quot;yes&quot;; then
 204     LZMA_DIR=$withval
 205     CPPFLAGS=&quot;${CPPFLAGS} -I$withval/include&quot;
 206     LDFLAGS=&quot;${LDFLAGS} -L$withval/lib&quot;
 207   fi
 208 ])
 209 AC_ARG_WITH(coverage,
 210 [  --with-coverage         build for code coverage with GCC (off)])
 211 
 212 AC_ARG_ENABLE(rebuild-docs,
 213 [  --enable-rebuild-docs[[=yes/no]]  rebuild some generated docs [[default=no]]])
 214 if test &quot;$enable_rebuild_docs&quot; = &quot;yes&quot; -a &quot;$srcdir&quot; != &quot;.&quot;; then
 215   AC_MSG_ERROR([cannot rebuild docs when builddir != srcdir])
 216 fi
 217 AM_CONDITIONAL([REBUILD_DOCS], [test &quot;$enable_rebuild_docs&quot; = &quot;yes&quot; -o &quot;$USER&quot; = &quot;veillard&quot;])
 218 
 219 dnl
<a name="2" id="anc2"></a><span class="line-modified"> 220 dnl hard dependencies on options</span>
 221 dnl
 222 if test &quot;$with_schemas&quot; = &quot;yes&quot;
 223 then
 224     with_pattern=yes
 225     with_regexps=yes
 226 fi
 227 if test &quot;$with_schematron&quot; = &quot;yes&quot;
 228 then
 229     with_pattern=yes
 230     with_tree=yes
 231     with_xpath=yes
 232 fi
 233 if test &quot;$with_reader&quot; = &quot;yes&quot;
 234 then
 235     with_push=yes
 236 fi
 237 if test &quot;$with_xptr&quot; = &quot;yes&quot;
 238 then
 239     with_xpath=yes
 240 fi
 241 dnl
 242 dnl option to build a minimal libxml2 library
 243 dnl
 244 if test &quot;$with_minimum&quot; = &quot;yes&quot;
 245 then
 246     echo &quot;Configuring for a minimal library&quot;
 247     if test &quot;$with_c14n&quot; = &quot;&quot;
 248     then
 249       with_c14n=no
 250     fi
 251     if test &quot;$with_catalog&quot; = &quot;&quot;
 252     then
 253       with_catalog=no
 254     fi
 255     echo So far so good!
 256     if test &quot;$with_debug&quot; = &quot;&quot;
 257     then
 258       with_debug=no
 259     fi
 260     if test &quot;$with_docbook&quot; = &quot;&quot;
 261     then
 262       with_docbook=no
 263     fi
 264     if test &quot;$with_fexceptions&quot; = &quot;&quot;
 265     then
 266       with_fexceptions=no
 267     fi
 268     if test &quot;$with_ftp&quot; = &quot;&quot;
 269     then
 270       with_ftp=no 
 271     fi
 272     if test &quot;$with_history&quot; = &quot;&quot;
 273     then
 274       with_history=no
 275     fi
 276     if test &quot;$with_html&quot; = &quot;&quot;
 277     then
 278       with_html=no
 279     fi
 280     if test &quot;$with_http&quot; = &quot;&quot;
 281     then
 282       with_http=no 
 283     fi
 284     if test &quot;$with_iconv&quot; = &quot;&quot;
 285     then
 286       with_iconv=no
 287     fi
 288     if test &quot;$with_iso8859x&quot; = &quot;&quot;
 289     then
 290       with_iso8859x=no
 291     fi
 292     if test &quot;$with_legacy&quot; = &quot;&quot;
 293     then
 294       with_legacy=no
 295     fi
 296     if test &quot;$with_mem_debug&quot; = &quot;&quot;
 297     then 
 298       with_mem_debug=no
 299     fi
 300     if test &quot;$with_output&quot; = &quot;&quot;
 301     then
 302       with_output=no
 303     fi
 304     if test &quot;$with_pattern&quot; = &quot;&quot;
 305     then
 306       with_pattern=no
 307     fi
 308     if test &quot;$with_push&quot; = &quot;&quot;
 309     then
 310       with_push=no
 311     fi
 312     if test &quot;$with_python&quot; = &quot;&quot;
 313     then
 314       with_python=no
 315     fi
 316     if test &quot;$with_reader&quot; = &quot;&quot;
 317     then
 318       with_reader=no
 319     fi
 320     if test &quot;$with_readline&quot; = &quot;&quot;
 321     then
 322       with_readline=no
 323     fi
 324     if test &quot;$with_regexps&quot; = &quot;&quot;
 325     then
 326       with_regexps=no
 327     fi
 328     if test &quot;$with_run_debug&quot; = &quot;&quot;
 329     then
 330       with_run_debug=no
 331     fi
 332     if test &quot;$with_sax1&quot; = &quot;&quot;
 333     then
 334       with_sax1=no
 335     fi
 336     if test &quot;$with_schemas&quot; = &quot;&quot;
 337     then
 338       with_schemas=no
 339     fi
 340     if test &quot;$with_schematron&quot; = &quot;&quot;
 341     then
 342       with_schematron=no
 343     fi
 344     if test &quot;$with_threads&quot; = &quot;&quot;
 345     then
 346       with_threads=no
 347     fi
 348     if test &quot;$with_thread_alloc&quot; = &quot;&quot;
 349     then
 350       with_thread_alloc=no
 351    fi
 352     if test &quot;$with_tree&quot; = &quot;&quot;
 353     then
 354       with_tree=no
 355     fi
 356     if test &quot;$with_valid&quot; = &quot;&quot;
 357     then
 358       with_valid=no
 359     fi
 360     if test &quot;$with_writer&quot; = &quot;&quot;
 361     then
 362       with_writer=no
 363     fi
 364     if test &quot;$with_xinclude&quot; = &quot;&quot;
 365     then
 366       with_xinclude=no
 367     fi
 368     if test &quot;$with_xpath&quot; = &quot;&quot;
 369     then
 370       with_xpath=no
 371     fi
 372     if test &quot;$with_xptr&quot; = &quot;&quot;
 373     then
 374       with_xptr=no
 375     fi
 376     if test &quot;$with_zlib&quot; = &quot;&quot;
 377     then
 378       with_zlib=no
 379     fi
 380     if test &quot;$with_modules&quot; = &quot;&quot;
 381     then
 382       with_modules=no
 383     fi
 384 fi
 385 
 386 echo Checking zlib
 387 
 388 dnl Checks for zlib library.
 389 
 390 WITH_ZLIB=0
 391 if test &quot;$with_zlib&quot; = &quot;no&quot;; then
 392     echo &quot;Disabling zlib compression support&quot;
 393 else
 394     # Don&#39;t run pkg-config if with_zlib contains a path.
 395     if test &quot;x$Z_DIR&quot; = &quot;x&quot;; then
 396         # Try pkg-config first so that static linking works.
 397         PKG_CHECK_MODULES([Z],[zlib],
 398             [WITH_ZLIB=1],
<a name="3" id="anc3"></a><span class="line-modified"> 399             [:])</span>
 400     fi
 401 
 402     if test &quot;$WITH_ZLIB&quot; = &quot;0&quot;; then
 403         AC_CHECK_HEADERS(zlib.h,
 404             AC_CHECK_LIB(z, gzread,[
 405                 WITH_ZLIB=1
 406                 if test &quot;x${Z_DIR}&quot; != &quot;x&quot;; then
 407                     Z_CFLAGS=&quot;-I${Z_DIR}/include&quot;
 408                     Z_LIBS=&quot;-L${Z_DIR}/lib -lz&quot;
 409                     [case ${host} in
 410                         *-*-solaris*)
 411                             Z_LIBS=&quot;-L${Z_DIR}/lib -R${Z_DIR}/lib -lz&quot;
 412                             ;;
 413                     esac]
 414                 else
 415                     Z_LIBS=&quot;-lz&quot;
 416                 fi])
 417             )
 418     fi
 419 fi
 420 
 421 AC_SUBST(Z_CFLAGS)
 422 AC_SUBST(Z_LIBS)
 423 AC_SUBST(WITH_ZLIB)
 424 
 425 echo Checking lzma
 426 
 427 dnl Checks for lzma library.
 428 
 429 WITH_LZMA=0
 430 if test &quot;$with_lzma&quot; = &quot;no&quot;; then
 431     echo &quot;Disabling lzma compression support&quot;
 432 else
 433     # Don&#39;t run pkg-config if with_lzma contains a path.
 434     if test &quot;x$LZMA_DIR&quot; = &quot;x&quot;; then
 435         # Try pkg-config first so that static linking works.
 436         PKG_CHECK_MODULES([LZMA],[liblzma],
 437             [WITH_LZMA=1],
<a name="4" id="anc4"></a><span class="line-modified"> 438             [:])</span>
 439     fi
 440 
 441     # If pkg-config failed, fall back to AC_CHECK_LIB. This
 442     # will not pick up the necessary LIBS flags for liblzma&#39;s
 443     # private dependencies, though, so static linking may fail.
 444     if test &quot;$WITH_LZMA&quot; = &quot;0&quot;; then
 445         AC_CHECK_HEADERS(lzma.h,
 446             AC_CHECK_LIB(lzma, lzma_code,[
 447                 WITH_LZMA=1
 448                 if test &quot;x${LZMA_DIR}&quot; != &quot;x&quot;; then
 449                     LZMA_CFLAGS=&quot;-I${LZMA_DIR}/include&quot;
 450                     LZMA_LIBS=&quot;-L${LZMA_DIR}/lib -llzma&quot;
 451                 else
 452                     LZMA_LIBS=&quot;-llzma&quot;
 453                 fi])
 454             )
 455     fi
 456 fi
 457 
 458 AC_SUBST(LZMA_CFLAGS)
 459 AC_SUBST(LZMA_LIBS)
 460 AC_SUBST(WITH_LZMA)
 461 
 462 CPPFLAGS=${_cppflags}
 463 LIBS=${_libs}
 464 
 465 echo Checking headers
 466 
 467 dnl Checks for header files.
 468 AC_HEADER_DIRENT
 469 AC_HEADER_STDC
 470 AC_CHECK_HEADERS([fcntl.h])
 471 AC_CHECK_HEADERS([unistd.h])
 472 AC_CHECK_HEADERS([ctype.h])
 473 AC_CHECK_HEADERS([dirent.h])
 474 AC_CHECK_HEADERS([errno.h])
 475 AC_CHECK_HEADERS([malloc.h])
 476 AC_CHECK_HEADERS([stdarg.h])
 477 AC_CHECK_HEADERS([sys/stat.h])
 478 AC_CHECK_HEADERS([sys/types.h])
 479 AC_CHECK_HEADERS([stdint.h])
 480 AC_CHECK_HEADERS([inttypes.h])
 481 AC_CHECK_HEADERS([time.h])
 482 AC_CHECK_HEADERS([math.h])
 483 AC_CHECK_HEADERS([limits.h])
 484 AC_CHECK_HEADERS([float.h])
 485 AC_CHECK_HEADERS([stdlib.h])
 486 AC_CHECK_HEADERS([sys/socket.h], [], [],
 487 [#if HAVE_SYS_TYPES_H
 488 # include &lt;sys/types.h&gt;
 489 # endif
 490 ])
 491 AC_CHECK_HEADERS([netinet/in.h], [], [],
 492 [#if HAVE_SYS_TYPES_H
 493 # include &lt;sys/types.h&gt;
 494 # endif
 495 ])
 496 AC_CHECK_HEADERS([arpa/inet.h], [], [],
 497 [#if HAVE_SYS_TYPES_H
 498 # include &lt;sys/types.h&gt;
 499 # endif
 500 #if HAVE_ARPA_INET_H
 501 # include &lt;arpa/inet.h&gt;
 502 # endif
 503 ])
 504 AC_CHECK_HEADERS([netdb.h])
 505 AC_CHECK_HEADERS([sys/time.h])
 506 AC_CHECK_HEADERS([sys/select.h])
 507 AC_CHECK_HEADERS([poll.h])
 508 AC_CHECK_HEADERS([sys/mman.h])
 509 AC_CHECK_HEADERS([sys/timeb.h])
 510 AC_CHECK_HEADERS([signal.h])
 511 AC_CHECK_HEADERS([arpa/nameser.h], [], [],
 512 [#if HAVE_SYS_TYPES_H
 513 # include &lt;sys/types.h&gt;
 514 # endif
 515 ])
 516 AC_CHECK_HEADERS([resolv.h], [], [],
 517 [#if HAVE_SYS_TYPES_H
 518 # include &lt;sys/types.h&gt;
 519 # endif
 520 #if HAVE_NETINET_IN_H
 521 # include &lt;netinet/in.h&gt;
 522 # endif
 523 #if HAVE_ARPA_NAMESER_H
 524 # include &lt;arpa/nameser.h&gt;
 525 # endif
 526 ])
 527 AC_CHECK_HEADERS([dl.h])
 528 AC_CHECK_HEADERS([dlfcn.h])
 529 
 530 
 531 echo Checking types
 532 
 533 AC_TYPE_UINT32_T
 534 
 535 
 536 echo Checking libraries
 537 
 538 dnl Checks for library functions.
 539 AC_FUNC_STRFTIME
 540 AC_CHECK_FUNCS(strftime localtime gettimeofday ftime)
 541 AC_CHECK_FUNCS(stat signal)
 542 AC_CHECK_FUNCS(rand rand_r srand time)
 543 AC_CHECK_FUNCS(isascii mmap munmap putenv)
 544 
 545 AH_VERBATIM([HAVE_MUNMAP_AFTER],[/* mmap() is no good without munmap() */
 546 #if defined(HAVE_MMAP) &amp;&amp; !defined(HAVE_MUNMAP)
 547 #  undef /**/ HAVE_MMAP
 548 #endif])
 549 
 550 dnl Checking for va_copy availability
 551 AC_MSG_CHECKING([for va_copy])
 552 AC_LINK_IFELSE([AC_LANG_PROGRAM([[#include &lt;stdarg.h&gt;
 553 va_list ap1,ap2;]], [[va_copy(ap1,ap2);]])],
 554 have_va_copy=yes,
 555 have_va_copy=no)
 556 AC_MSG_RESULT($have_va_copy)
 557 if test x&quot;$have_va_copy&quot; = x&quot;yes&quot;; then
 558     AC_DEFINE(HAVE_VA_COPY,1,[Whether va_copy() is available])
 559 else
 560     AC_MSG_CHECKING([for __va_copy])
 561     AC_LINK_IFELSE([AC_LANG_PROGRAM([[#include &lt;stdarg.h&gt;
 562     va_list ap1,ap2;]], [[__va_copy(ap1,ap2);]])],
 563     have___va_copy=yes,
 564     have___va_copy=no)
 565     AC_MSG_RESULT($have___va_copy)
 566     if test x&quot;$have___va_copy&quot; = x&quot;yes&quot;; then
 567         AC_DEFINE(HAVE___VA_COPY,1,[Whether __va_copy() is available])
 568     fi
 569 fi
 570 
 571 dnl Checking whether va_list is an array type
 572 AC_MSG_CHECKING([whether va_list is an array type])
 573 AC_TRY_COMPILE2([
 574 #include &lt;stdarg.h&gt;
 575 void a(va_list * ap) {}],[
 576 va_list ap1, ap2; a(&amp;ap1); ap2 = (va_list) ap1],[
 577   AC_MSG_RESULT(no)],[
 578   AC_MSG_RESULT(yes)
 579   AC_DEFINE([VA_LIST_IS_ARRAY], [1],[Define if va_list is an array type])])
 580 
 581 dnl Checks for inet libraries:
 582 AC_SEARCH_LIBS(gethostent, [nsl])
 583 AC_SEARCH_LIBS(setsockopt, [socket net network])
 584 AC_SEARCH_LIBS(connect, [inet])
 585 
 586 dnl Determine what socket length (socklen_t) data type is
 587 AC_MSG_CHECKING([for type of socket length (socklen_t)])
 588 AC_TRY_COMPILE2([
 589 #include &lt;stddef.h&gt;
 590 #include &lt;sys/types.h&gt;
 591 #include &lt;sys/socket.h&gt;],[
 592 (void)getsockopt (1, 1, 1, NULL, (socklen_t *)NULL)],[
 593   AC_MSG_RESULT(socklen_t *)
 594   XML_SOCKLEN_T=socklen_t],[
 595   AC_TRY_COMPILE2([
 596 #include &lt;stddef.h&gt;
 597 #include &lt;sys/types.h&gt;
 598 #include &lt;sys/socket.h&gt;],[
 599 (void)getsockopt (1, 1, 1, NULL, (size_t *)NULL)],[
 600     AC_MSG_RESULT(size_t *)
 601     XML_SOCKLEN_T=size_t],[
 602     AC_TRY_COMPILE2([
 603 #include &lt;stddef.h&gt;
 604 #include &lt;sys/types.h&gt;
 605 #include &lt;sys/socket.h&gt;],[
 606 (void)getsockopt (1, 1, 1, NULL, (int *)NULL)],[
 607       AC_MSG_RESULT(int *)
 608       XML_SOCKLEN_T=int],[
 609       AC_MSG_WARN(could not determine)
 610       XML_SOCKLEN_T=&quot;int&quot;])])])
 611 AC_DEFINE_UNQUOTED(XML_SOCKLEN_T, $XML_SOCKLEN_T, [Determine what socket length (socklen_t) data type is])
 612 
 613 dnl Checking if gethostbyname() argument is const.
 614 AC_MSG_CHECKING([for const gethostbyname() argument])
 615 AC_LINK_IFELSE([AC_LANG_PROGRAM([[#include &lt;netdb.h&gt;]],
 616     [[(void)gethostbyname((const char *)&quot;&quot;);]])],
 617 have_gethostbyname_const_arg=yes,
 618 have_gethostbyname_const_arg=no)
 619 AC_MSG_RESULT($have_gethostbyname_const_arg)
 620 if test x&quot;$have_gethostbyname_const_arg&quot; = x&quot;yes&quot;; then
 621     AC_DEFINE([GETHOSTBYNAME_ARG_CAST], [],
 622       [Type cast for the gethostbyname() argument])
 623 else
 624     AC_DEFINE([GETHOSTBYNAME_ARG_CAST], [(char *)],
 625       [Type cast for the gethostbyname() argument])
 626 fi
 627 
 628 dnl Checking if send() second argument is const.
 629 AC_MSG_CHECKING([for const send() second argument])
 630 AC_LINK_IFELSE([AC_LANG_PROGRAM([[#include &lt;sys/types.h&gt;
 631 #include &lt;sys/socket.h&gt;]],
 632     [[(void)send(1,(const char *)&quot;&quot;,1,1);]])],
 633 have_send_const_arg2=yes,
 634 have_send_const_arg2=no)
 635 AC_MSG_RESULT($have_send_const_arg2)
 636 if test x&quot;$have_send_const_arg2&quot; = x&quot;yes&quot;; then
 637     AC_DEFINE([SEND_ARG2_CAST], [],
 638       [Type cast for the send() function 2nd arg])
 639 else
 640     AC_DEFINE([SEND_ARG2_CAST], [(char *)],
 641       [Type cast for the send() function 2nd arg])
 642 fi
 643 
 644 dnl ***********************Checking for availability of IPv6*******************
 645 
 646 AC_MSG_CHECKING([whether to enable IPv6])
 647 AC_ARG_ENABLE(ipv6, [  --enable-ipv6[[=yes/no]]  enables compilation of IPv6 code [[default=yes]]],, enable_ipv6=yes)
 648 if test &quot;$with_minimum&quot; = &quot;yes&quot;
 649 then
 650     enable_ipv6=no
 651 fi
 652 if test $enable_ipv6 = yes; then
 653   have_ipv6=no
 654   AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
 655 #   include &lt;sys/types.h&gt;
 656 #   include &lt;sys/socket.h&gt;
 657     ]], [[
 658     struct sockaddr_storage ss;
 659     socket(AF_INET6, SOCK_STREAM, 0)
 660     ]])],
 661     have_ipv6=yes,
 662     have_ipv6=no
 663   )
 664   AC_MSG_RESULT($have_ipv6)
 665 
 666   if test $have_ipv6 = yes; then
 667     AC_DEFINE([SUPPORT_IP6], [], [Support for IPv6])
 668     have_broken_ss_family=no
 669 
 670     dnl *********************************************************************
 671     dnl on some platforms (like AIX 5L), the structure sockaddr doesn&#39;t have
 672     dnl a ss_family member, but rather __ss_family. Let&#39;s detect that
 673     dnl and define the HAVE_BROKEN_SS_FAMILY when we are on one of these
 674     dnl platforms.  However, we should only do this if ss_family is not
 675     dnl present.
 676     dnl ********************************************************************
 677     AC_MSG_CHECKING([struct sockaddr::ss_family])
 678     AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
 679 #     include &lt;sys/types.h&gt;
 680 #     include &lt;sys/socket.h&gt;
 681       ]], [[
 682       struct sockaddr_storage ss ;
 683       ss.ss_family = 0 ;
 684       ]])],
 685       have_ss_family=yes,
 686       have_ss_family=no
 687     )
 688     AC_MSG_RESULT($have_ss_family)
 689     if test x$have_ss_family = xno ; then
 690       AC_MSG_CHECKING([broken struct sockaddr::ss_family])
 691       AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
 692 #       include &lt;sys/types.h&gt;
 693 #       include &lt;sys/socket.h&gt;
 694         ]], [[
 695         struct sockaddr_storage ss ;
 696         ss.__ss_family = 0 ;
 697         ]])],
 698         have_broken_ss_family=yes,
 699         have_broken_ss_family=no
 700       )
 701       AC_MSG_RESULT($have_broken_ss_family)
 702       if test x$have_broken_ss_family = xyes ; then
 703         AC_DEFINE(HAVE_BROKEN_SS_FAMILY, [],
 704 	  [Whether struct sockaddr::__ss_family exists]) 
 705         AC_DEFINE(ss_family, __ss_family,
 706 	  [ss_family is not defined here, use __ss_family instead])
 707       else
 708         AC_MSG_WARN(ss_family and __ss_family not found)
 709       fi
 710     fi
 711 
 712     have_getaddrinfo=no
 713     AC_CHECK_FUNC(getaddrinfo, have_getaddrinfo=yes)
 714     if test $have_getaddrinfo != yes; then
 715       for lib in bsd socket inet; do
 716         AC_CHECK_LIB($lib, getaddrinfo, [LIBS=&quot;$LIBS -l$lib&quot;;have_getaddrinfo=yes;break])
 717       done
 718     fi
 719 
 720     if test $have_getaddrinfo = yes; then
 721       AC_DEFINE([HAVE_GETADDRINFO], [], [Define if getaddrinfo is there])
 722     fi
 723   fi
 724 fi 
 725 
 726 dnl ******************************End IPv6 checks******************************
 727 
 728 dnl Checks for isnan in libm if not in libc
 729 AC_CHECK_FUNC(isnan, AC_DEFINE([HAVE_ISNAN],[], [Define if isnan is there]) , AC_CHECK_LIB(m, isnan,
 730   [AC_DEFINE([HAVE_ISNAN],[], [Define if isnan is there])]))
 731 
 732 AC_CHECK_FUNC(isinf, AC_DEFINE([HAVE_ISINF], [], [Define if isinf is there]) , AC_CHECK_LIB(m, isinf,
 733   [AC_DEFINE([HAVE_ISINF], [], [Define if isinf is there])]))
 734 
 735 XML_LIBDIR=&#39;-L${libdir}&#39;
 736 XML_INCLUDEDIR=&#39;-I${includedir}/libxml2&#39;
 737 
 738 dnl
 739 dnl Extra flags
 740 dnl
 741 XML_CFLAGS=&quot;&quot;
 742 RDL_LIBS=&quot;&quot;
 743 
 744 dnl
 745 dnl Workaround for native compilers
 746 dnl  HP  : http://bugs.gnome.org/db/31/3163.html
 747 dnl  DEC : Enable NaN/Inf
 748 dnl
 749 if test &quot;${GCC}&quot; != &quot;yes&quot; ; then
 750     case &quot;${host}&quot; in
 751           hppa*-*-hpux* )
 752 	       EXTRA_CFLAGS=&quot;${EXTRA_CFLAGS} -Wp,-H30000&quot;
 753 	       ;;
 754           *-dec-osf* )
 755                EXTRA_CFLAGS=&quot;${EXTRA_CFLAGS} -ieee&quot;
 756                ;;
 757 	  alpha*-*-linux* )
 758 	       EXTRA_CFLAGS=&quot;${EXTRA_CFLAGS} -ieee&quot;
 759 	       ;;
 760     esac
 761 else
 762     if test &quot;$with_fexceptions&quot; = &quot;yes&quot;
 763     then
 764         #
 765 	# Not activated by default because this inflates the code size
 766 	# Used to allow propagation of C++ exceptions through the library
 767 	#
 768 	EXTRA_CFLAGS=&quot;${EXTRA_CFLAGS} -fexceptions&quot;
 769     fi
 770 
 771     # warnings we&#39;d like to see
 772     EXTRA_CFLAGS=&quot;${EXTRA_CFLAGS} -pedantic -Wall -Wextra -Wshadow -Wpointer-arith -Wcast-align -Wwrite-strings -Waggregate-return -Wstrict-prototypes -Wmissing-prototypes -Wnested-externs -Winline -Wredundant-decls&quot;
 773     # warnings we&#39;d like to supress
<a name="5" id="anc5"></a><span class="line-modified"> 774     EXTRA_CFLAGS=&quot;${EXTRA_CFLAGS} -Wno-long-long -Wno-format-extra-args&quot;</span>
 775     case &quot;${host}&quot; in
 776           alpha*-*-linux* )
 777 	       EXTRA_CFLAGS=&quot;${EXTRA_CFLAGS} -mieee&quot;
 778 	       ;;
 779 	  alpha*-*-osf* )
 780 	       EXTRA_CFLAGS=&quot;${EXTRA_CFLAGS} -mieee&quot;
 781 	       ;;
 782     esac
 783 fi
 784 case ${host} in
 785     *-*-solaris*)
 786         XML_LIBDIR=&quot;${XML_LIBDIR} -R${libdir}&quot;
 787         ;;
 788     hppa*-hp-mpeix)
 789         NEED_TRIO=1
 790 	;;
 791     *-*-mingw* | *-*-cygwin* | *-*-msvc* )
 792         # If the host is Windows, and shared libraries are disabled, we
 793         # need to add -DLIBXML_STATIC to EXTRA_CFLAGS in order for linking to
 794         # work properly (without it, xmlexports.h would force the use of
 795         # DLL imports, which obviously aren&#39;t present in a static
 796         # library).
 797         if test &quot;x$enable_shared&quot; = &quot;xno&quot;; then
 798             XML_CFLAGS=&quot;$XML_CFLAGS -DLIBXML_STATIC&quot;
 799             EXTRA_CFLAGS=&quot;$EXTRA_CFLAGS -DLIBXML_STATIC&quot;
 800         fi
 801         ;;
 802 esac
 803 
 804 
 805 dnl
 806 dnl check for python
 807 dnl
 808 
 809 PYTHON_VERSION=
 810 PYTHON_INCLUDES=
 811 PYTHON_SITE_PACKAGES=
 812 PYTHON_TESTS=
 813 pythondir=
 814 if test &quot;$with_python&quot; != &quot;no&quot; ; then
 815     if test -x &quot;$with_python/bin/python&quot;
 816     then
 817         echo Found python in $with_python/bin/python
 818         PYTHON=&quot;$with_python/bin/python&quot;
 819     else
 820         if test -x &quot;$with_python/python.exe&quot;
 821         then
 822             echo Found python in $with_python/python.exe
 823             PYTHON=&quot;$with_python/python.exe&quot;
 824         else
 825             if test -x &quot;$with_python&quot;
 826             then
 827                 echo Found python in $with_python
 828                 PYTHON=&quot;$with_python&quot;
 829             else
 830                 if test -x &quot;$PYTHON&quot;
 831                 then
 832                     echo Found python in environment PYTHON=$PYTHON
 833                     with_python=`$PYTHON -c &quot;import sys; print(sys.exec_prefix)&quot;`
 834                 else
 835                     AC_PATH_PROG(PYTHON, python python2.6 python2.5 python2.4 python2.3 python2.2 python2.1 python2.0 python1.6 python1.5)
 836 		fi
 837 	    fi
 838 	fi
 839     fi
 840     if test &quot;$PYTHON&quot; != &quot;&quot;
 841     then
 842         PYTHON_VERSION=`$PYTHON -c &quot;from distutils import sysconfig; print(sysconfig.get_python_version())&quot;`
 843 	PYTHON_INCLUDES=`$PYTHON -c &quot;from distutils import sysconfig; print(sysconfig.get_python_inc())&quot;`
 844 # does not work as it produce a /usr/lib/python path instead of/usr/lib64/python
 845 #
 846 #	PYTHON_SITE_PACKAGES=`$PYTHON -c &quot;from distutils import sysconfig; print(sysconfig.get_python_lib())&quot;`
 847 	echo Found Python version $PYTHON_VERSION
 848     fi
 849     if test &quot;$PYTHON_VERSION&quot; != &quot;&quot; -a &quot;$PYTHON_INCLUDES&quot; = &quot;&quot;
 850     then
 851 	if test -r $with_python/include/python$PYTHON_VERSION/Python.h
 852 	then
 853 	    PYTHON_INCLUDES=$with_python/include/python$PYTHON_VERSION
 854 	else
 855 	    if test -r $prefix/include/python$PYTHON_VERSION/Python.h
 856 	    then
 857 	        PYTHON_INCLUDES=$prefix/include/python$PYTHON_VERSION
 858 	    else
 859 		if test -r /usr/include/python$PYTHON_VERSION/Python.h
 860 		then
 861 		    PYTHON_INCLUDES=/usr/include/python$PYTHON_VERSION
 862 		else
 863 	            if test -r $with_python/include/Python.h
 864 	            then
 865 	                PYTHON_INCLUDES=$with_python/include
 866 	            else
 867 		        echo could not find python$PYTHON_VERSION/Python.h or $with_python/include/Python.h
 868 		    fi
 869 		fi
 870 	    fi
 871 	fi
 872     fi
 873     if test &quot;$with_python_install_dir&quot; != &quot;&quot;
 874     then
 875 	PYTHON_SITE_PACKAGES=&quot;$with_python_install_dir&quot;
 876     fi
 877     if test &quot;$PYTHON_VERSION&quot; != &quot;&quot; -a &quot;$PYTHON_SITE_PACKAGES&quot; = &quot;&quot;
 878     then
 879 	if test -d $libdir/python$PYTHON_VERSION/site-packages
 880 	then
 881 	    PYTHON_SITE_PACKAGES=$libdir/python$PYTHON_VERSION/site-packages
 882 	else
 883 	    if test -d $with_python/lib/site-packages
 884 	    then
 885 		PYTHON_SITE_PACKAGES=$with_python/lib/site-packages
 886 	    else
 887 		PYTHON_SITE_PACKAGES=`$PYTHON -c &quot;from distutils import sysconfig; print(sysconfig.get_python_lib())&quot;`
 888 	    fi
 889 	fi
 890     fi
 891     pythondir=&#39;$(PYTHON_SITE_PACKAGES)&#39;
 892     PYTHON_LIBS=`python$PYTHON_VERSION-config --ldflags`
 893 else
 894     PYTHON=
 895 fi
 896 AM_CONDITIONAL(WITH_PYTHON, test &quot;$PYTHON_INCLUDES&quot; != &quot;&quot;)
 897 if test &quot;$PYTHON_INCLUDES&quot; != &quot;&quot;
 898 then
 899     PYTHON_SUBDIR=python
 900 else
 901     PYTHON_SUBDIR=
 902 fi
 903 AC_SUBST(pythondir)
 904 AC_SUBST(PYTHON_SUBDIR)
 905 AC_SUBST(PYTHON_LIBS)
 906 
 907 dnl check for dso support
 908 WITH_MODULES=0
 909 TEST_MODULES=
 910 
 911 if test &quot;$with_modules&quot; != &quot;no&quot; ; then
 912  case &quot;$host&quot; in
 913   *-*-cygwin*)
 914   MODULE_EXTENSION=&quot;.dll&quot;
 915   AC_CHECK_LIB(cygwin, dlopen, [
 916     WITH_MODULES=1
 917     MODULE_PLATFORM_LIBS=
 918     AC_DEFINE([HAVE_DLOPEN], [], [Have dlopen based dso])
 919   ])
 920   ;;
 921   *-*-mingw*)
 922   MODULE_EXTENSION=&quot;.dll&quot;
 923   WITH_MODULES=1
 924   ;;
 925   *)
 926   AC_CHECK_FUNC(shl_load, libxml_have_shl_load=yes, [
 927     AC_CHECK_LIB(dld, shl_load, [
 928       MODULE_PLATFORM_LIBS=&quot;-ldld&quot;
 929       libxml_have_shl_load=yes], [
 930       AC_CHECK_FUNC(dlopen, libxml_have_dlopen=yes, [
 931         AC_CHECK_LIB(dl, dlopen, [
 932           MODULE_PLATFORM_LIBS=&quot;-ldl&quot;
 933           libxml_have_dlopen=yes])])])])
 934 
 935   if test &quot;${libxml_have_shl_load}&quot; = &quot;yes&quot;; then
 936     MODULE_EXTENSION=&quot;.sl&quot;
 937     WITH_MODULES=1
 938     AC_DEFINE([HAVE_SHLLOAD], [], [Have shl_load based dso])
 939   fi
 940  
 941   if test &quot;${libxml_have_dlopen}&quot; = &quot;yes&quot;; then
 942     case &quot;${host}&quot; in
 943       *-*-hpux* )
 944 	MODULE_EXTENSION=&quot;.sl&quot;
 945 	;;
 946       * )
 947 	MODULE_EXTENSION=&quot;.so&quot;
 948 	;;
 949     esac
 950 
 951     WITH_MODULES=1
 952     AC_DEFINE([HAVE_DLOPEN], [], [Have dlopen based dso])
 953   fi
 954  ;;
 955  esac
 956 fi
 957 
 958 if test &quot;${WITH_MODULES}&quot; = &quot;1&quot;; then
 959   TEST_MODULES=&quot;ModuleTests&quot;
 960 fi  
 961 
 962 AC_SUBST(WITH_MODULES)
 963 AC_SUBST(MODULE_PLATFORM_LIBS)
 964 AC_SUBST(MODULE_EXTENSION)
 965 AC_SUBST(TEST_MODULES)
 966 
 967 dnl
 968 dnl Tester makes use of readline if present
 969 dnl
 970 
 971 dnl
 972 dnl specific tests to setup DV and Bill&#39;s devel environments with debug etc ...
 973 dnl (-Wunreachable-code)
 974 dnl
 975 if [[ &quot;${LOGNAME}&quot; = &quot;veillard&quot; -a &quot;`pwd`&quot; = &quot;/u/veillard/XML&quot; ]] || \
 976    [[ &quot;${LOGNAME}&quot; = &quot;veillard&quot; -a &quot;`pwd`&quot; = &quot;/home/veillard/libxml2&quot; ]] || \
 977    [[ &quot;${LOGNAME}&quot; = &quot;bill&quot; -a &quot;`pwd`&quot; = &quot;/home/bill/gnomesvn/libxml2&quot; ]]
 978    then
 979     if test &quot;$with_minimum&quot; != &quot;yes&quot;
 980     then
 981 	if test &quot;${with_mem_debug}&quot; = &quot;&quot; ; then
 982 	    echo Activating memory debugging
 983 	    with_mem_debug=&quot;yes&quot;
 984 	    with_run_debug=&quot;yes&quot;
 985 	fi
 986 	if test &quot;${with_docbook}&quot; = &quot;&quot; ; then
 987 	    with_docbook=&quot;yes&quot;
 988 	fi
 989     fi
 990     if test &quot;${GCC}&quot; = &quot;yes&quot; ; then
 991     EXTRA_CFLAGS=&quot;-g -O -pedantic -W -Wformat -Wno-format-extra-args -Wunused -Wimplicit -Wreturn-type -Wswitch -Wcomment -Wtrigraphs -Wchar-subscripts -Wuninitialized -Wparentheses -Wshadow -Wpointer-arith -Wcast-align -Wwrite-strings -Waggregate-return -Wstrict-prototypes -Wmissing-prototypes -Wnested-externs -Winline -Wredundant-decls -Wall&quot;
 992     fi
 993     STATIC_BINARIES=&quot;-static&quot;
 994 dnl -Wcast-qual -ansi
 995 else
 996     STATIC_BINARIES=
 997 fi
 998 AC_SUBST(STATIC_BINARIES)
 999 
1000 dnl
1001 dnl Check for trio string functions
1002 dnl
1003 
1004 if test &quot;${NEED_TRIO}&quot; = &quot;1&quot; ; then
1005     echo Adding trio library for string functions
1006     WITH_TRIO=1
1007 else    
1008     WITH_TRIO=0
1009 fi
1010 AM_CONDITIONAL(WITH_TRIO_SOURCES, test &quot;${NEED_TRIO}&quot; = &quot;1&quot;)
1011 AC_SUBST(WITH_TRIO)
1012 
1013 dnl
1014 dnl Allow to enable/disable various pieces
1015 dnl
1016 echo Checking configuration requirements
1017 
1018 dnl
1019 dnl Thread-related stuff
1020 dnl
1021 THREAD_LIBS=&quot;&quot;
1022 BASE_THREAD_LIBS=&quot;&quot;
1023 WITH_THREADS=0
1024 THREAD_CFLAGS=&quot;&quot;
1025 TEST_THREADS=&quot;&quot;
1026 THREADS_W32=&quot;&quot;
1027 WITH_THREAD_ALLOC=0
1028 
1029 if test &quot;$with_threads&quot; = &quot;no&quot; ; then
1030     echo Disabling multithreaded support
1031 else
1032     echo Enabling multithreaded support
1033 
1034     dnl Default to native threads on Windows
1035     case $host_os in
1036        *mingw*) if test &quot;$with_threads&quot; != &quot;pthread&quot; &amp;&amp; test &quot;$with_threads&quot; != &quot;no&quot;; then
1037                WITH_THREADS=&quot;1&quot;
1038                THREADS_W32=&quot;1&quot;
1039                THREAD_CFLAGS=&quot;$THREAD_CFLAGS -DHAVE_WIN32_THREADS&quot;
1040            fi
1041        ;;
1042     esac
1043 
1044     dnl Use pthread by default in other cases
1045     if test -z &quot;$THREADS_W32&quot;; then
1046         if test &quot;$with_threads&quot; = &quot;pthread&quot; || test &quot;$with_threads&quot; = &quot;&quot; || test &quot;$with_threads&quot; = &quot;yes&quot; ; then
1047             AC_CHECK_HEADER(pthread.h,
1048                 AC_CHECK_LIB(pthread, pthread_join,[
1049                 THREAD_LIBS=&quot;-lpthread&quot;
1050                 AC_DEFINE([HAVE_LIBPTHREAD], [], [Define if pthread library is there (-lpthread)])
1051                 AC_DEFINE([HAVE_PTHREAD_H], [], [Define if &lt;pthread.h&gt; is there])
1052                 WITH_THREADS=&quot;1&quot;]))
1053         fi
1054     fi
1055 
1056     case $host_os in
1057        *cygwin*) THREAD_LIBS=&quot;&quot;
1058        ;;
1059        *beos*) WITH_THREADS=&quot;1&quot;
1060 	   THREAD_CFLAGS=&quot;$THREAD_CFLAGS -DHAVE_BEOS_THREADS&quot;
1061        ;;
1062        *linux*)
1063            if test &quot;${GCC}&quot; = &quot;yes&quot; ; then
1064 	       GCC_VERSION=`${CC} --version | head -1 | awk &#39;{print $3}&#39;`
1065 	       GCC_MAJOR=`echo ${GCC_VERSION} | sed &#39;s+\..*++&#39;`
1066 	       GCC_MEDIUM=`echo ${GCC_VERSION} | sed &#39;s+[[0-9]]*\.++&#39; | sed &#39;s+\..*++&#39;`
1067 	       if test &quot;${THREAD_LIBS}&quot; = &quot;-lpthread&quot; ; then
1068 	           if expr ${GCC_MEDIUM} \&gt; 2 \&amp; ${GCC_MAJOR} = 3 &gt; /dev/null
1069 		   then
1070 		       THREAD_LIBS=&quot;&quot;
1071 		       BASE_THREAD_LIBS=&quot;-lpthread&quot;
1072 		   else
1073 		   if expr ${GCC_MAJOR} \&gt; 3 &gt; /dev/null
1074 		   then
1075 		       THREAD_LIBS=&quot;&quot;
1076 		       BASE_THREAD_LIBS=&quot;-lpthread&quot;
1077 		   else
1078 		       echo old GCC disabling weak symbols for pthread
1079 		   fi
1080 		   fi
1081 	       fi
1082 	   fi
1083        ;;
1084     esac
1085     if test &quot;$WITH_THREADS&quot; = &quot;1&quot; ; then
1086 	THREAD_CFLAGS=&quot;$THREAD_CFLAGS -D_REENTRANT&quot;
1087 	TEST_THREADS=&quot;Threadtests&quot;
1088     fi
1089 fi
1090 if test &quot;$with_thread_alloc&quot; = &quot;yes&quot; -a &quot;$WITH_THREADS&quot; = &quot;1&quot; ; then
1091     WITH_THREAD_ALLOC=1
1092 fi
1093 
1094 AC_SUBST(THREAD_LIBS)
1095 AC_SUBST(BASE_THREAD_LIBS)
1096 AC_SUBST(WITH_THREADS)
1097 AC_SUBST(THREAD_CFLAGS)
1098 AC_SUBST(TEST_THREADS)
1099 AC_SUBST(WITH_THREAD_ALLOC)
1100 AM_CONDITIONAL([THREADS_W32],[test -n &quot;$THREADS_W32&quot;])
1101 
1102 dnl
1103 dnl xmllint shell history
1104 dnl
1105 if test &quot;$with_history&quot; = &quot;yes&quot; ; then
1106     echo Enabling xmllint shell history
1107     dnl check for terminal library. this is a very cool solution
1108     dnl from octave&#39;s configure.in
1109     unset tcap
1110     for termlib in ncurses curses termcap terminfo termlib; do
1111 	AC_CHECK_LIB(${termlib}, tputs, [tcap=&quot;-l$termlib&quot;])
1112 	test -n &quot;$tcap&quot; &amp;&amp; break
1113     done
1114 
1115     AC_CHECK_HEADER(readline/history.h,
1116 	AC_CHECK_LIB(history, append_history,[
1117 	   RDL_LIBS=&quot;-lhistory&quot;
1118 	   AC_DEFINE([HAVE_LIBHISTORY], [], [Define if history library is there (-lhistory)])]))
1119     AC_CHECK_HEADER(readline/readline.h,
1120 	AC_CHECK_LIB(readline, readline,[
1121 	   RDL_LIBS=&quot;-lreadline $RDL_LIBS $tcap&quot;
1122 	   AC_DEFINE([HAVE_LIBREADLINE], [], [Define if readline library is there (-lreadline)])], , $tcap))
1123     if test -n &quot;$RDL_DIR&quot; -a -n &quot;$RDL_LIBS&quot;; then
1124 	CPPFLAGS=&quot;$CPPFLAGS -I${RDL_DIR}/include&quot;
1125 	RDL_LIBS=&quot;-L${RDL_DIR}/lib $RDL_LIBS&quot;
1126     fi
1127 fi
1128 
1129 dnl
1130 dnl Tree functions
1131 dnl
1132 if test &quot;$with_tree&quot; = &quot;no&quot; ; then
1133     echo Disabling DOM like tree manipulation APIs
1134     WITH_TREE=0
1135 else    
1136     WITH_TREE=1
1137 fi
1138 AC_SUBST(WITH_TREE)
1139 
1140 if test &quot;$with_ftp&quot; = &quot;no&quot; ; then
1141     echo Disabling FTP support
1142     WITH_FTP=0
1143     FTP_OBJ=
1144 else    
1145     WITH_FTP=1
1146     FTP_OBJ=nanoftp.o
1147 fi
1148 AC_SUBST(WITH_FTP)
1149 AC_SUBST(FTP_OBJ)
1150 
1151 if test &quot;$with_http&quot; = &quot;no&quot; ; then
1152     echo Disabling HTTP support
1153     WITH_HTTP=0
1154     HTTP_OBJ=
1155 else    
1156     WITH_HTTP=1
1157     HTTP_OBJ=nanohttp.o
1158 fi
1159 AC_SUBST(WITH_HTTP)
1160 AC_SUBST(HTTP_OBJ)
1161 
1162 if test &quot;$with_legacy&quot; = &quot;no&quot; ; then
1163     echo Disabling deprecated APIs
1164     WITH_LEGACY=0
1165 else    
1166     WITH_LEGACY=1
1167 fi
1168 AC_SUBST(WITH_LEGACY)
1169 
1170 if test &quot;$with_reader&quot; = &quot;no&quot; ; then
1171     echo Disabling the xmlReader parsing interface
1172     WITH_READER=0
1173     READER_TEST=
1174 else    
1175     WITH_READER=1
1176     READER_TEST=Readertests
1177     if test &quot;$with_push&quot; = &quot;no&quot; ; then
1178         echo xmlReader requires Push interface - enabling it
1179 	with_push=yes
1180     fi
1181 fi
1182 AC_SUBST(WITH_READER)
1183 AC_SUBST(READER_TEST)
1184 
1185 if test &quot;$with_writer&quot; = &quot;no&quot; ; then
1186     echo Disabling the xmlWriter saving interface
1187     WITH_WRITER=0
1188 #    WRITER_TEST=
1189 else    
1190     WITH_WRITER=1
1191 #    WRITER_TEST=Writertests
1192     if test &quot;$with_push&quot; = &quot;no&quot; ; then
1193         echo xmlWriter requires Push interface - enabling it
1194 	with_push=yes
1195     fi
1196     if test &quot;$with_output&quot; = &quot;no&quot; ; then
1197         echo xmlWriter requires Output interface - enabling it
1198 	with_output=yes
1199     fi
1200 fi
1201 AC_SUBST(WITH_WRITER)
1202 #AC_SUBST(WRITER_TEST)
1203 
1204 if test &quot;$with_pattern&quot; = &quot;no&quot; ; then
1205     echo Disabling the xmlPattern parsing interface
1206     WITH_PATTERN=0
1207     TEST_PATTERN=
1208 else    
1209     WITH_PATTERN=1
1210     TEST_PATTERN=Patterntests
1211 fi
1212 AC_SUBST(WITH_PATTERN)
1213 AC_SUBST(TEST_PATTERN)
1214 
1215 if test &quot;$with_sax1&quot; = &quot;no&quot; ; then
1216     echo Disabling the older SAX1 interface
1217     WITH_SAX1=0
1218     TEST_SAX=
1219 else    
1220     WITH_SAX1=1
1221     TEST_SAX=SAXtests
1222 fi
1223 AC_SUBST(WITH_SAX1)
1224 AM_CONDITIONAL(WITH_SAX1_SOURCES, test &quot;${WITH_TRIO}&quot; = &quot;1&quot;)
1225 AC_SUBST(TEST_SAX)
1226 
1227 if test &quot;$with_push&quot; = &quot;no&quot; ; then
1228     echo Disabling the PUSH parser interfaces
1229     WITH_PUSH=0
1230     TEST_PUSH=
1231 else    
1232     WITH_PUSH=1
1233     TEST_PUSH=&quot;XMLPushtests&quot;
1234 fi
1235 AC_SUBST(WITH_PUSH)
1236 AC_SUBST(TEST_PUSH)
1237 
1238 if test &quot;$with_html&quot; = &quot;no&quot; ; then
1239     echo Disabling HTML support
1240     WITH_HTML=0
1241     HTML_OBJ=
1242     TEST_HTML=
1243 else    
1244     WITH_HTML=1
1245     HTML_OBJ=&quot;HTMLparser.o HTMLtree.o&quot;
1246     TEST_HTML=HTMLtests
1247     if test &quot;$with_push&quot; != &quot;no&quot; ; then
1248         TEST_PHTML=HTMLPushtests
1249     else
1250         TEST_PHTML=
1251     fi
1252 fi
1253 AC_SUBST(WITH_HTML)
1254 AC_SUBST(HTML_OBJ)
1255 AC_SUBST(TEST_HTML)
1256 AC_SUBST(TEST_PHTML)
1257 
1258 if test &quot;$with_valid&quot; = &quot;no&quot; ; then
1259     echo Disabling DTD validation support
1260     WITH_VALID=0
1261     TEST_VALID=
1262     TEST_VTIME=
1263 else    
1264     WITH_VALID=1
1265     TEST_VALID=Validtests
1266     TEST_VTIME=VTimingtests
1267 fi
1268 AC_SUBST(WITH_VALID)
1269 AC_SUBST(TEST_VALID)
1270 AC_SUBST(TEST_VTIME)
1271 
1272 if test &quot;$with_catalog&quot; = &quot;no&quot; ; then
1273     echo Disabling Catalog support
1274     WITH_CATALOG=0
1275     CATALOG_OBJ=
1276     TEST_CATALOG=
1277 else    
1278     WITH_CATALOG=1
1279     CATALOG_OBJ=&quot;catalog.o&quot;
1280     TEST_CATALOG=Catatests
1281 fi
1282 AC_SUBST(WITH_CATALOG)
1283 AC_SUBST(CATALOG_OBJ)
1284 AC_SUBST(TEST_CATALOG)
1285 
1286 if test &quot;$with_docbook&quot; = &quot;no&quot; ; then
1287     echo Disabling Docbook support
1288     WITH_DOCB=0
1289     DOCB_OBJ=
1290 else    
1291     WITH_DOCB=1
1292     DOCB_OBJ=&quot;DOCBparser.o&quot;
1293 fi
1294 AC_SUBST(WITH_DOCB)
1295 AC_SUBST(DOCB_OBJ)
1296 
1297 
1298 if test &quot;$with_xptr&quot; = &quot;no&quot; ; then
1299     echo Disabling XPointer support
1300     WITH_XPTR=0
1301     XPTR_OBJ=
1302     TEST_XPTR=
1303 else    
1304     WITH_XPTR=1
1305     XPTR_OBJ=xpointer.o
1306     TEST_XPTR=XPtrtests
1307     if test &quot;$with_xpath&quot; = &quot;no&quot; ; then
1308         echo XPointer requires XPath support - enabling it
1309 	with_xpath=yes
1310     fi
1311 fi
1312 AC_SUBST(WITH_XPTR)
1313 AC_SUBST(XPTR_OBJ)
1314 AC_SUBST(TEST_XPTR)
1315 
1316 if test &quot;$with_c14n&quot; = &quot;no&quot; ; then
1317     echo Disabling C14N support
1318     WITH_C14N=0
1319     C14N_OBJ=
1320     TEST_C14N=
1321 else    
1322     WITH_C14N=1
1323     C14N_OBJ=&quot;c14n.c&quot;
1324     TEST_C14N=C14Ntests
1325     if test &quot;$with_xpath&quot; = &quot;no&quot; ; then
1326         echo C14N requires XPath support - enabling it
1327 	with_xpath=yes
1328     fi
1329 fi
1330 AC_SUBST(WITH_C14N)
1331 AC_SUBST(C14N_OBJ)
1332 AC_SUBST(TEST_C14N)
1333 
1334 if test &quot;$with_xinclude&quot; = &quot;no&quot; ; then
1335     echo Disabling XInclude support
1336     WITH_XINCLUDE=0
1337     XINCLUDE_OBJ=
1338     with_xinclude=&quot;no&quot;
1339     TEST_XINCLUDE=
1340 else    
1341     WITH_XINCLUDE=1
1342     XINCLUDE_OBJ=xinclude.o
1343     TEST_XINCLUDE=XIncludetests
1344     if test &quot;$with_xpath&quot; = &quot;no&quot; ; then
1345         echo XInclude requires XPath support - enabling it
1346 	with_xpath=yes
1347     fi
1348 fi
1349 AC_SUBST(WITH_XINCLUDE)
1350 AC_SUBST(XINCLUDE_OBJ)
1351 AC_SUBST(TEST_XINCLUDE)
1352 
1353 if test &quot;$with_xptr&quot; = &quot;&quot; -a &quot;$with_xpath&quot; = &quot;no&quot; ; then
1354     with_xptr=no
1355 fi
1356 
1357 if test &quot;$with_schematron&quot; = &quot;&quot; -a &quot;$with_xpath&quot; = &quot;no&quot; ; then
1358     with_schematron=no
1359 fi
1360 
1361 if test &quot;$with_schematron&quot; = &quot;no&quot; ; then
1362     echo &quot;Disabling Schematron support&quot;
1363     WITH_SCHEMATRON=0
1364     TEST_SCHEMATRON=
1365 else 
1366     echo &quot;Enabled Schematron support&quot;
1367     WITH_SCHEMATRON=1
1368     TEST_SCHEMATRON=&quot;Schematrontests&quot;
1369     with_xpath=yes
1370     with_pattern=yes
1371     with_schematron=yes
1372 fi
1373 AC_SUBST(WITH_SCHEMATRON)
1374 AC_SUBST(TEST_SCHEMATRON)
1375 
1376 if test &quot;$with_xpath&quot; = &quot;no&quot; ; then
1377     echo Disabling XPATH support
1378     WITH_XPATH=0
1379     XPATH_OBJ=
1380     TEST_XPATH=
1381 else    
1382     WITH_XPATH=1
1383     XPATH_OBJ=xpath.o
1384     TEST_XPATH=XPathtests
1385 fi
1386 AC_SUBST(WITH_XPATH)
1387 AC_SUBST(XPATH_OBJ)
1388 AC_SUBST(TEST_XPATH)
1389 
1390 dnl
1391 dnl output functions
1392 dnl
1393 if test &quot;$with_output&quot; = &quot;no&quot; ; then
1394     echo Disabling serialization/saving support
1395     WITH_OUTPUT=0
1396 else    
1397     WITH_OUTPUT=1
1398 fi
1399 AC_SUBST(WITH_OUTPUT)
1400 
1401 WITH_ICONV=0
1402 if test &quot;$with_iconv&quot; = &quot;no&quot; ; then
1403     echo Disabling ICONV support
1404 else
1405     if test &quot;$with_iconv&quot; != &quot;yes&quot; -a &quot;$with_iconv&quot; != &quot;&quot; ; then
1406 	CPPFLAGS=&quot;${CPPFLAGS} -I$with_iconv/include&quot;
1407 	# Export this since our headers include iconv.h
1408 	XML_INCLUDEDIR=&quot;${XML_INCLUDEDIR} -I$with_iconv/include&quot;
1409 	ICONV_LIBS=&quot;-L$with_iconv/lib&quot;
1410     fi
1411 
1412     AC_CHECK_HEADER(iconv.h,
1413 	AC_MSG_CHECKING(for iconv)
1414 	AC_LINK_IFELSE([AC_LANG_PROGRAM([[#include &lt;stdlib.h&gt;
1415 #include &lt;iconv.h&gt;]],[[
1416 iconv_t cd = iconv_open (&quot;&quot;,&quot;&quot;);
1417 iconv (cd, NULL, NULL, NULL, NULL);]])],[
1418 	    AC_MSG_RESULT(yes)
1419 	    WITH_ICONV=1],[
1420 	    AC_MSG_RESULT(no)
1421 	    AC_MSG_CHECKING(for iconv in -liconv)
1422 
1423 	    _ldflags=&quot;${LDFLAGS}&quot;
1424 	    _libs=&quot;${LIBS}&quot;
1425 	    LDFLAGS=&quot;${LDFLAGS} ${ICONV_LIBS}&quot;
1426 	    LIBS=&quot;${LIBS} -liconv&quot;
1427 
1428 	    AC_LINK_IFELSE([AC_LANG_PROGRAM([[#include &lt;stdlib.h&gt;
1429 #include &lt;iconv.h&gt;]],[[
1430 iconv_t cd = iconv_open (&quot;&quot;,&quot;&quot;);
1431 iconv (cd, NULL, NULL, NULL, NULL);]])],[
1432 		AC_MSG_RESULT(yes)
1433 		WITH_ICONV=1
1434 		ICONV_LIBS=&quot;${ICONV_LIBS} -liconv&quot;
1435 		LIBS=&quot;${_libs}&quot;
1436 		LDFLAGS=&quot;${_ldflags}&quot;],[
1437 		AC_MSG_RESULT(no)
1438 		LIBS=&quot;${_libs}&quot;
1439 		LDFLAGS=&quot;${_ldflags}&quot;])]))
1440 
1441 	if test &quot;$WITH_ICONV&quot; = &quot;1&quot; ; then
1442 		AC_MSG_CHECKING([for iconv declaration])
1443 		AC_CACHE_VAL(xml_cv_iconv_arg2, [
1444 			AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[#include &lt;stdlib.h&gt;
1445 #include &lt;iconv.h&gt;
1446 extern
1447 #ifdef __cplusplus
1448 &quot;C&quot;
1449 #endif
1450 #if defined(__STDC__) || defined(__cplusplus)
1451 size_t iconv (iconv_t cd, char * *inbuf, size_t *inbytesleft, char * *outbuf, size_t *outbytesleft);
1452 #else
1453 size_t iconv();
1454 #endif
1455 ]], [])], xml_cv_iconv_arg2=&quot;&quot;, xml_cv_iconv_arg2=&quot;const&quot;)])
1456 
1457 		xml_cv_iconv_decl=&quot;extern size_t iconv (iconv_t cd, $xml_cv_iconv_arg2 char * *inbuf, size_t *inbytesleft, char * *outbuf, size_t *outbytesleft);&quot;
1458 		AC_MSG_RESULT([${xml_xxx:-
1459 	}$xml_cv_iconv_decl])
1460 		AC_DEFINE_UNQUOTED(ICONV_CONST, $xml_cv_iconv_arg2,
1461 			[Define as const if the declaration of iconv() needs const.])
1462 	fi
1463 fi
1464 case &quot;$host&quot; in
1465 	*mingw*) M_LIBS=&quot;&quot;
1466 	;;
1467 	*beos*) M_LIBS=&quot;&quot;
1468 	;;
1469         *haiku*) M_LIBS=&quot;&quot;
1470         ;;
1471 	*) M_LIBS=&quot;-lm&quot;
1472 	;;
1473 esac
1474 AC_SUBST(WITH_ICONV)
1475 
1476 WITH_ICU=0
1477 ICU_LIBS=&quot;&quot;
1478 if test &quot;$with_icu&quot; != &quot;yes&quot; ; then
1479     echo Disabling ICU support
1480 else
1481     # Try pkg-config first so that static linking works.
1482     # If this succeeeds, we ignore the WITH_ICU directory.
1483     PKG_CHECK_MODULES([ICU],[icu-i18n],
1484         [have_libicu=yes],
1485         [have_libicu=no])
1486 
1487     # If pkg-config failed, fall back to AC_CHECK_LIB. This
1488     # will not pick up the necessary LIBS flags for liblzma&#39;s
1489     # private dependencies, though, so static linking may fail.
1490     if test &quot;x$have_libicu&quot; = &quot;xno&quot;; then
1491         ICU_CONFIG=icu-config
1492         if ${ICU_CONFIG} --cflags &gt;/dev/null 2&gt;&amp;1
1493         then
1494             ICU_LIBS=`${ICU_CONFIG} --ldflags`
1495             have_libicu=yes
1496             echo Enabling ICU support
1497         else
1498             if test &quot;$with_icu&quot; != &quot;yes&quot; -a &quot;$with_iconv&quot; != &quot;&quot; ; then
1499                 CPPFLAGS=&quot;${CPPFLAGS} -I$with_icu&quot;
1500                 # Export this since our headers include icu.h
1501                 XML_INCLUDEDIR=&quot;${XML_INCLUDEDIR} -I$with_icu&quot;
1502             fi
1503 
1504             AC_CHECK_HEADER(unicode/ucnv.h,
1505             AC_MSG_CHECKING(for icu)
1506             AC_TRY_LINK([#include &lt;unicode/ucnv.h&gt;],[
1507         UConverter *utf = ucnv_open(&quot;UTF-8&quot;, NULL);],[
1508                 AC_MSG_RESULT(yes)
1509                 have_libicu=yes],[
1510                 AC_MSG_RESULT(no)
1511                 AC_MSG_CHECKING(for icu in -licucore)
1512 
1513                 _ldflags=&quot;${LDFLAGS}&quot;
1514                 _libs=&quot;${LIBS}&quot;
1515                 LDFLAGS=&quot;${LDFLAGS} ${ICU_LIBS}&quot;
1516                 LIBS=&quot;${LIBS} -licucore&quot;
1517 
1518                 AC_TRY_LINK([#include &lt;unicode/ucnv.h&gt;],[
1519         UConverter *utf = ucnv_open(&quot;UTF-8&quot;, NULL);],[
1520                     AC_MSG_RESULT(yes)
1521                     have_libicu=yes
1522                     ICU_LIBS=&quot;${ICU_LIBS} -licucore&quot;
1523                     LIBS=&quot;${_libs}&quot;
1524                     LDFLAGS=&quot;${_ldflags}&quot;],[
1525                     AC_MSG_RESULT(no)
1526                     LIBS=&quot;${_libs}&quot;
1527                 LDFLAGS=&quot;${_ldflags}&quot;])]))
1528         fi
1529     fi
1530 
1531     # Found the library via either method?
1532     if test &quot;x$have_libicu&quot; = &quot;xyes&quot;; then
1533         WITH_ICU=1
1534     fi
1535 fi
<a name="6" id="anc6"></a><span class="line-modified">1536 XML_LIBS=&quot;-lxml2&quot;</span>
<span class="line-added">1537 XML_PRIVATE_LIBS=&quot;$Z_LIBS $LZMA_LIBS $THREAD_LIBS $ICONV_LIBS $ICU_LIBS $M_LIBS $LIBS&quot;</span>
1538 XML_LIBTOOLLIBS=&quot;libxml2.la&quot;
1539 AC_SUBST(WITH_ICU)
1540 
1541 WITH_ISO8859X=1
1542 if test &quot;$WITH_ICONV&quot; != &quot;1&quot; ; then
1543 if test &quot;$with_iso8859x&quot; = &quot;no&quot; ; then
1544     echo Disabling ISO8859X support
1545     WITH_ISO8859X=0
1546 fi
1547 fi
1548 AC_SUBST(WITH_ISO8859X)
1549 
1550 if test &quot;$with_schemas&quot; = &quot;no&quot; ; then
1551     echo &quot;Disabling Schemas/Relax-NG support&quot;
1552     WITH_SCHEMAS=0
1553     TEST_SCHEMAS=
1554 else    
1555     echo &quot;Enabled Schemas/Relax-NG support&quot;
1556     WITH_SCHEMAS=1
1557     TEST_SCHEMAS=&quot;Schemastests Relaxtests&quot;
1558     if test &quot;$PYTHON_INCLUDES&quot; != &quot;&quot; ; then
1559         PYTHON_TESTS=&quot;$PYTHON_TESTS RelaxNGPythonTests SchemasPythonTests&quot;
1560     fi
1561     with_regexps=yes
1562 fi
1563 AC_SUBST(WITH_SCHEMAS)
1564 AC_SUBST(TEST_SCHEMAS)
1565 
1566 if test &quot;$with_regexps&quot; = &quot;no&quot; ; then
1567     echo Disabling Regexps support
1568     WITH_REGEXPS=0
1569     TEST_REGEXPS=
1570 else    
1571     WITH_REGEXPS=1
1572     TEST_REGEXPS=&quot;Regexptests Automatatests&quot;
1573 fi
1574 AC_SUBST(WITH_REGEXPS)
1575 AC_SUBST(TEST_REGEXPS)
1576 
1577 if test &quot;$with_debug&quot; = &quot;no&quot; ; then
1578     echo Disabling DEBUG support
1579     WITH_DEBUG=0
1580     DEBUG_OBJ=
1581     TEST_DEBUG=
1582 else    
1583     WITH_DEBUG=1
1584     DEBUG_OBJ=debugXML.o
1585     TEST_DEBUG=Scripttests
1586 fi
1587 AC_SUBST(WITH_DEBUG)
1588 AC_SUBST(DEBUG_OBJ)
1589 AC_SUBST(TEST_DEBUG)
1590 
1591 if test &quot;$with_mem_debug&quot; = &quot;yes&quot; ; then
1592     if test &quot;$with_thread_alloc&quot; = &quot;yes&quot; ; then
1593         echo Disabling memory debug - cannot use mem-debug with thread-alloc!
1594 	WITH_MEM_DEBUG=0
1595     else
1596         echo Enabling memory debug support
1597         WITH_MEM_DEBUG=1
1598     fi
1599 else    
1600     WITH_MEM_DEBUG=0
1601 fi
1602 AC_SUBST(WITH_MEM_DEBUG)
1603 
1604 if test &quot;$with_run_debug&quot; = &quot;yes&quot; ; then
1605     echo Enabling runtime debug support
1606     WITH_RUN_DEBUG=1
1607 else    
1608     WITH_RUN_DEBUG=0
1609 fi
1610 AC_SUBST(WITH_RUN_DEBUG)
1611 
1612 WIN32_EXTRA_LIBADD=
1613 WIN32_EXTRA_LDFLAGS=
1614 CYGWIN_EXTRA_LDFLAGS=
1615 CYGWIN_EXTRA_PYTHON_LIBADD=
1616 WIN32_EXTRA_PYTHON_LIBADD=
1617 case &quot;$host&quot; in
1618  *-*-mingw*)
1619  CPPFLAGS=&quot;$CPPFLAGS -DWIN32&quot;
1620  WIN32_EXTRA_LIBADD=&quot;-lws2_32&quot;
1621  WIN32_EXTRA_LDFLAGS=&quot;-no-undefined&quot;
1622  if test &quot;${PYTHON}&quot; != &quot;&quot;
1623  then
<a name="7" id="anc7"></a><span class="line-added">1624    case &quot;$host&quot; in</span>
<span class="line-added">1625      *-w64-mingw*)</span>
<span class="line-added">1626        WIN32_EXTRA_PYTHON_LIBADD=&quot;-shrext .pyd -L${pythondir}/../../lib -lpython${PYTHON_VERSION}&quot;</span>
<span class="line-added">1627        ;;</span>
<span class="line-added">1628      *)</span>
1629    WIN32_EXTRA_PYTHON_LIBADD=&quot;-L${pythondir}/../../libs -lpython$(echo ${PYTHON_VERSION} | tr -d .)&quot;
<a name="8" id="anc8"></a><span class="line-added">1630        ;;</span>
<span class="line-added">1631    esac</span>
1632  fi
1633  ;;
1634  *-*-cygwin*)
1635  CYGWIN_EXTRA_LDFLAGS=&quot;-no-undefined&quot;
1636  if test &quot;${PYTHON}&quot; != &quot;&quot;
1637  then
1638    CYGWIN_EXTRA_PYTHON_LIBADD=&quot;-L/usr/lib/python${PYTHON_VERSION}/config -lpython${PYTHON_VERSION}&quot;
1639  fi
1640  ;;
1641 esac
1642 AC_SUBST(WIN32_EXTRA_LIBADD)
1643 AC_SUBST(WIN32_EXTRA_LDFLAGS)
1644 AC_SUBST(WIN32_EXTRA_PYTHON_LIBADD)
1645 AC_SUBST(CYGWIN_EXTRA_LDFLAGS)
1646 AC_SUBST(CYGWIN_EXTRA_PYTHON_LIBADD)
1647 
1648 dnl Checking the standard string functions availability
1649 dnl
1650 dnl Note mingw* has C99 implementation that produce expected xml numbers
1651 dnl if code use {v}snprintf functions.
1652 dnl If you like to activate at run-time C99 compatible number output
1653 dnl see release note for mingw runtime 3.15:
1654 dnl  http://sourceforge.net/project/shownotes.php?release_id=24832
1655 dnl
1656 dnl Also *win32*config.h files redefine them for various MSC compilers.
1657 dnl
1658 dnl So do not redefine {v}snprintf to _{v}snprintf like follwing:
1659 dnl  AC_DEFINE([snprintf],[_snprintf],[Win32 Std C name mangling work-around])
1660 dnl  AC_DEFINE([vsnprintf],[_vsnprintf],[Win32 Std C name mangling work-around])
1661 dnl and do not redefine those functions is C-source files.
1662 dnl
1663 AC_CHECK_FUNCS(printf sprintf fprintf snprintf vfprintf vsprintf vsnprintf sscanf,,
1664 	NEED_TRIO=1)
1665 
1666 if test &quot;$with_coverage&quot; = &quot;yes&quot; -a &quot;${GCC}&quot; = &quot;yes&quot;
1667 then
1668     echo Enabling code coverage for GCC
1669     EXTRA_CFLAGS=&quot;$EXTRA_CFLAGS -fprofile-arcs -ftest-coverage&quot;
1670     LDFLAGS=&quot;$LDFLAGS -fprofile-arcs -ftest-coverage&quot;
1671 else
1672     echo Disabling code coverage for GCC
1673 fi
1674 
1675 AC_SUBST(CPPFLAGS)
1676 AC_SUBST(EXTRA_CFLAGS)
1677 AC_SUBST(LDFLAGS)
1678 AC_SUBST(XML_CFLAGS)
1679 
1680 AC_SUBST(XML_LIBDIR)
1681 AC_SUBST(XML_LIBS)
<a name="9" id="anc9"></a><span class="line-added">1682 AC_SUBST(XML_PRIVATE_LIBS)</span>
1683 AC_SUBST(XML_LIBTOOLLIBS)
1684 AC_SUBST(ICONV_LIBS)
1685 AC_SUBST(ICU_LIBS)
1686 AC_SUBST(XML_INCLUDEDIR)
1687 AC_SUBST(HTML_DIR)
1688 AC_SUBST(HAVE_ISNAN)
1689 AC_SUBST(HAVE_ISINF)
1690 AC_SUBST(PYTHON)
1691 AC_SUBST(PYTHON_VERSION)
1692 AC_SUBST(PYTHON_INCLUDES)
1693 AC_SUBST(PYTHON_SITE_PACKAGES)
1694 
1695 AC_SUBST(M_LIBS)
1696 AC_SUBST(RDL_LIBS)
1697 
1698 dnl for the spec file
1699 RELDATE=`date +&#39;%a %b %e %Y&#39;`
1700 AC_SUBST(RELDATE)
1701 AC_SUBST(PYTHON_TESTS)
1702 
1703 rm -f COPYING.LIB COPYING
1704 ln -s $srcdir/Copyright COPYING
1705 
1706 # keep on one line for cygwin c.f. #130896
1707 AC_CONFIG_FILES([libxml2.spec:libxml.spec.in Makefile include/Makefile include/libxml/Makefile doc/Makefile doc/examples/Makefile doc/devhelp/Makefile example/Makefile python/Makefile python/tests/Makefile xstc/Makefile include/libxml/xmlversion.h libxml-2.0.pc libxml-2.0-uninstalled.pc libxml2-config.cmake])
1708 AC_CONFIG_FILES([python/setup.py], [chmod +x python/setup.py])
1709 AC_CONFIG_FILES([xml2-config], [chmod +x xml2-config])
1710 AC_OUTPUT
1711 
1712 echo Done configuring
<a name="10" id="anc10"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="10" type="hidden" />
</body>
</html>