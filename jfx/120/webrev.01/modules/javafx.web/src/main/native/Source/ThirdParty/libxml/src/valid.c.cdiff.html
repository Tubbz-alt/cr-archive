<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/ThirdParty/libxml/src/valid.c</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="uri.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="win32/Makefile.bcb.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/libxml/src/valid.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1097,18 ***</span>
   *
   * Free an element content structure. The whole subtree is removed.
   */
  void
  xmlFreeDocElementContent(xmlDocPtr doc, xmlElementContentPtr cur) {
<span class="line-removed">-     xmlElementContentPtr next;</span>
      xmlDictPtr dict = NULL;
  
      if (doc != NULL)
          dict = doc-&gt;dict;
  
<span class="line-modified">!     while (cur != NULL) {</span>
<span class="line-modified">!         next = cur-&gt;c2;</span>
      switch (cur-&gt;type) {
          case XML_ELEMENT_CONTENT_PCDATA:
          case XML_ELEMENT_CONTENT_ELEMENT:
          case XML_ELEMENT_CONTENT_SEQ:
          case XML_ELEMENT_CONTENT_OR:
<span class="line-new-header">--- 1097,26 ---</span>
   *
   * Free an element content structure. The whole subtree is removed.
   */
  void
  xmlFreeDocElementContent(xmlDocPtr doc, xmlElementContentPtr cur) {
      xmlDictPtr dict = NULL;
<span class="line-added">+     size_t depth = 0;</span>
  
<span class="line-added">+     if (cur == NULL)</span>
<span class="line-added">+         return;</span>
      if (doc != NULL)
          dict = doc-&gt;dict;
  
<span class="line-modified">!     while (1) {</span>
<span class="line-modified">!         xmlElementContentPtr parent;</span>
<span class="line-added">+ </span>
<span class="line-added">+         while ((cur-&gt;c1 != NULL) || (cur-&gt;c2 != NULL)) {</span>
<span class="line-added">+             cur = (cur-&gt;c1 != NULL) ? cur-&gt;c1 : cur-&gt;c2;</span>
<span class="line-added">+             depth += 1;</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
      switch (cur-&gt;type) {
          case XML_ELEMENT_CONTENT_PCDATA:
          case XML_ELEMENT_CONTENT_ELEMENT:
          case XML_ELEMENT_CONTENT_SEQ:
          case XML_ELEMENT_CONTENT_OR:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1117,22 ***</span>
          xmlErrValid(NULL, XML_ERR_INTERNAL_ERROR,
              &quot;Internal: ELEMENT content corrupted invalid type\n&quot;,
              NULL);
          return;
      }
<span class="line-removed">-     if (cur-&gt;c1 != NULL) xmlFreeDocElementContent(doc, cur-&gt;c1);</span>
      if (dict) {
          if ((cur-&gt;name != NULL) &amp;&amp; (!xmlDictOwns(dict, cur-&gt;name)))
              xmlFree((xmlChar *) cur-&gt;name);
          if ((cur-&gt;prefix != NULL) &amp;&amp; (!xmlDictOwns(dict, cur-&gt;prefix)))
              xmlFree((xmlChar *) cur-&gt;prefix);
      } else {
          if (cur-&gt;name != NULL) xmlFree((xmlChar *) cur-&gt;name);
          if (cur-&gt;prefix != NULL) xmlFree((xmlChar *) cur-&gt;prefix);
      }
      xmlFree(cur);
<span class="line-modified">!     cur = next;</span>
      }
  }
  
  /**
   * xmlFreeElementContent:
<span class="line-new-header">--- 1125,36 ---</span>
          xmlErrValid(NULL, XML_ERR_INTERNAL_ERROR,
              &quot;Internal: ELEMENT content corrupted invalid type\n&quot;,
              NULL);
          return;
      }
      if (dict) {
          if ((cur-&gt;name != NULL) &amp;&amp; (!xmlDictOwns(dict, cur-&gt;name)))
              xmlFree((xmlChar *) cur-&gt;name);
          if ((cur-&gt;prefix != NULL) &amp;&amp; (!xmlDictOwns(dict, cur-&gt;prefix)))
              xmlFree((xmlChar *) cur-&gt;prefix);
      } else {
          if (cur-&gt;name != NULL) xmlFree((xmlChar *) cur-&gt;name);
          if (cur-&gt;prefix != NULL) xmlFree((xmlChar *) cur-&gt;prefix);
      }
<span class="line-added">+         parent = cur-&gt;parent;</span>
<span class="line-added">+         if ((depth == 0) || (parent == NULL)) {</span>
<span class="line-added">+             xmlFree(cur);</span>
<span class="line-added">+             break;</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (cur == parent-&gt;c1)</span>
<span class="line-added">+             parent-&gt;c1 = NULL;</span>
<span class="line-added">+         else</span>
<span class="line-added">+             parent-&gt;c2 = NULL;</span>
      xmlFree(cur);
<span class="line-modified">! </span>
<span class="line-added">+         if (parent-&gt;c2 != NULL) {</span>
<span class="line-added">+         cur = parent-&gt;c2;</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             depth -= 1;</span>
<span class="line-added">+             cur = parent;</span>
<span class="line-added">+         }</span>
      }
  }
  
  /**
   * xmlFreeElementContent:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1145,86 ***</span>
  xmlFreeElementContent(xmlElementContentPtr cur) {
      xmlFreeDocElementContent(NULL, cur);
  }
  
  #ifdef LIBXML_OUTPUT_ENABLED
  /**
   * xmlDumpElementContent:
   * @buf:  An XML buffer
   * @content:  An element table
<span class="line-removed">-  * @glob: 1 if one must print the englobing parenthesis, 0 otherwise</span>
   *
   * This will dump the content of the element table as an XML DTD definition
   */
  static void
<span class="line-modified">! xmlDumpElementContent(xmlBufferPtr buf, xmlElementContentPtr content, int glob) {</span>
      if (content == NULL) return;
  
<span class="line-modified">!     if (glob) xmlBufferWriteChar(buf, &quot;(&quot;);</span>
<span class="line-modified">!     switch (content-&gt;type) {</span>
          case XML_ELEMENT_CONTENT_PCDATA:
              xmlBufferWriteChar(buf, &quot;#PCDATA&quot;);
          break;
      case XML_ELEMENT_CONTENT_ELEMENT:
<span class="line-modified">!         if (content-&gt;prefix != NULL) {</span>
<span class="line-modified">!         xmlBufferWriteCHAR(buf, content-&gt;prefix);</span>
          xmlBufferWriteChar(buf, &quot;:&quot;);
          }
<span class="line-modified">!         xmlBufferWriteCHAR(buf, content-&gt;name);</span>
          break;
      case XML_ELEMENT_CONTENT_SEQ:
<span class="line-removed">-         if ((content-&gt;c1 != NULL) &amp;&amp;</span>
<span class="line-removed">-             ((content-&gt;c1-&gt;type == XML_ELEMENT_CONTENT_OR) ||</span>
<span class="line-removed">-              (content-&gt;c1-&gt;type == XML_ELEMENT_CONTENT_SEQ)))</span>
<span class="line-removed">-         xmlDumpElementContent(buf, content-&gt;c1, 1);</span>
<span class="line-removed">-         else</span>
<span class="line-removed">-         xmlDumpElementContent(buf, content-&gt;c1, 0);</span>
<span class="line-removed">-             xmlBufferWriteChar(buf, &quot; , &quot;);</span>
<span class="line-removed">-         if ((content-&gt;c2 != NULL) &amp;&amp;</span>
<span class="line-removed">-             ((content-&gt;c2-&gt;type == XML_ELEMENT_CONTENT_OR) ||</span>
<span class="line-removed">-              ((content-&gt;c2-&gt;type == XML_ELEMENT_CONTENT_SEQ) &amp;&amp;</span>
<span class="line-removed">-           (content-&gt;c2-&gt;ocur != XML_ELEMENT_CONTENT_ONCE))))</span>
<span class="line-removed">-         xmlDumpElementContent(buf, content-&gt;c2, 1);</span>
<span class="line-removed">-         else</span>
<span class="line-removed">-         xmlDumpElementContent(buf, content-&gt;c2, 0);</span>
<span class="line-removed">-         break;</span>
      case XML_ELEMENT_CONTENT_OR:
<span class="line-modified">!         if ((content-&gt;c1 != NULL) &amp;&amp;</span>
<span class="line-modified">!             ((content-&gt;c1-&gt;type == XML_ELEMENT_CONTENT_OR) ||</span>
<span class="line-modified">!              (content-&gt;c1-&gt;type == XML_ELEMENT_CONTENT_SEQ)))</span>
<span class="line-modified">!         xmlDumpElementContent(buf, content-&gt;c1, 1);</span>
<span class="line-modified">!         else</span>
<span class="line-modified">!         xmlDumpElementContent(buf, content-&gt;c1, 0);</span>
<span class="line-modified">!             xmlBufferWriteChar(buf, &quot; | &quot;);</span>
<span class="line-removed">-         if ((content-&gt;c2 != NULL) &amp;&amp;</span>
<span class="line-removed">-             ((content-&gt;c2-&gt;type == XML_ELEMENT_CONTENT_SEQ) ||</span>
<span class="line-removed">-              ((content-&gt;c2-&gt;type == XML_ELEMENT_CONTENT_OR) &amp;&amp;</span>
<span class="line-removed">-           (content-&gt;c2-&gt;ocur != XML_ELEMENT_CONTENT_ONCE))))</span>
<span class="line-removed">-         xmlDumpElementContent(buf, content-&gt;c2, 1);</span>
<span class="line-removed">-         else</span>
<span class="line-removed">-         xmlDumpElementContent(buf, content-&gt;c2, 0);</span>
<span class="line-removed">-         break;</span>
      default:
          xmlErrValid(NULL, XML_ERR_INTERNAL_ERROR,
<span class="line-modified">!             &quot;Internal: ELEMENT content corrupted invalid type\n&quot;,</span>
              NULL);
      }
<span class="line-modified">!     if (glob)</span>
          xmlBufferWriteChar(buf, &quot;)&quot;);
<span class="line-modified">!     switch (content-&gt;ocur) {</span>
<span class="line-modified">!         case XML_ELEMENT_CONTENT_ONCE:</span>
<span class="line-modified">!         break;</span>
<span class="line-modified">!         case XML_ELEMENT_CONTENT_OPT:</span>
<span class="line-modified">!         xmlBufferWriteChar(buf, &quot;?&quot;);</span>
<span class="line-modified">!         break;</span>
<span class="line-modified">!         case XML_ELEMENT_CONTENT_MULT:</span>
<span class="line-modified">!         xmlBufferWriteChar(buf, &quot;*&quot;);</span>
<span class="line-modified">!         break;</span>
<span class="line-removed">-         case XML_ELEMENT_CONTENT_PLUS:</span>
<span class="line-removed">-         xmlBufferWriteChar(buf, &quot;+&quot;);</span>
          break;
      }
  }
  
  /**
   * xmlSprintfElementContent:
   * @buf:  an output buffer
<span class="line-new-header">--- 1167,107 ---</span>
  xmlFreeElementContent(xmlElementContentPtr cur) {
      xmlFreeDocElementContent(NULL, cur);
  }
  
  #ifdef LIBXML_OUTPUT_ENABLED
<span class="line-added">+ /**</span>
<span class="line-added">+  * xmlDumpElementOccur:</span>
<span class="line-added">+  * @buf:  An XML buffer</span>
<span class="line-added">+  * @cur:  An element table</span>
<span class="line-added">+  *</span>
<span class="line-added">+  * Dump the occurence operator of an element.</span>
<span class="line-added">+  */</span>
<span class="line-added">+ static void</span>
<span class="line-added">+ xmlDumpElementOccur(xmlBufferPtr buf, xmlElementContentPtr cur) {</span>
<span class="line-added">+     switch (cur-&gt;ocur) {</span>
<span class="line-added">+         case XML_ELEMENT_CONTENT_ONCE:</span>
<span class="line-added">+             break;</span>
<span class="line-added">+         case XML_ELEMENT_CONTENT_OPT:</span>
<span class="line-added">+             xmlBufferWriteChar(buf, &quot;?&quot;);</span>
<span class="line-added">+             break;</span>
<span class="line-added">+         case XML_ELEMENT_CONTENT_MULT:</span>
<span class="line-added">+             xmlBufferWriteChar(buf, &quot;*&quot;);</span>
<span class="line-added">+             break;</span>
<span class="line-added">+         case XML_ELEMENT_CONTENT_PLUS:</span>
<span class="line-added">+             xmlBufferWriteChar(buf, &quot;+&quot;);</span>
<span class="line-added">+             break;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  /**
   * xmlDumpElementContent:
   * @buf:  An XML buffer
   * @content:  An element table
   *
   * This will dump the content of the element table as an XML DTD definition
   */
  static void
<span class="line-modified">! xmlDumpElementContent(xmlBufferPtr buf, xmlElementContentPtr content) {</span>
<span class="line-added">+     xmlElementContentPtr cur;</span>
<span class="line-added">+ </span>
      if (content == NULL) return;
  
<span class="line-modified">!     xmlBufferWriteChar(buf, &quot;(&quot;);</span>
<span class="line-modified">!     cur = content;</span>
<span class="line-added">+ </span>
<span class="line-added">+     do {</span>
<span class="line-added">+         if (cur == NULL) return;</span>
<span class="line-added">+ </span>
<span class="line-added">+         switch (cur-&gt;type) {</span>
          case XML_ELEMENT_CONTENT_PCDATA:
              xmlBufferWriteChar(buf, &quot;#PCDATA&quot;);
          break;
      case XML_ELEMENT_CONTENT_ELEMENT:
<span class="line-modified">!                 if (cur-&gt;prefix != NULL) {</span>
<span class="line-modified">!                     xmlBufferWriteCHAR(buf, cur-&gt;prefix);</span>
          xmlBufferWriteChar(buf, &quot;:&quot;);
          }
<span class="line-modified">!                 xmlBufferWriteCHAR(buf, cur-&gt;name);</span>
          break;
      case XML_ELEMENT_CONTENT_SEQ:
      case XML_ELEMENT_CONTENT_OR:
<span class="line-modified">!                 if ((cur != content) &amp;&amp;</span>
<span class="line-modified">!                     (cur-&gt;parent != NULL) &amp;&amp;</span>
<span class="line-modified">!                     ((cur-&gt;type != cur-&gt;parent-&gt;type) ||</span>
<span class="line-modified">!                      (cur-&gt;ocur != XML_ELEMENT_CONTENT_ONCE)))</span>
<span class="line-modified">!                     xmlBufferWriteChar(buf, &quot;(&quot;);</span>
<span class="line-modified">!                 cur = cur-&gt;c1;</span>
<span class="line-modified">!                 continue;</span>
      default:
          xmlErrValid(NULL, XML_ERR_INTERNAL_ERROR,
<span class="line-modified">!                         &quot;Internal: ELEMENT cur corrupted invalid type\n&quot;,</span>
              NULL);
      }
<span class="line-modified">! </span>
<span class="line-added">+         while (cur != content) {</span>
<span class="line-added">+             xmlElementContentPtr parent = cur-&gt;parent;</span>
<span class="line-added">+ </span>
<span class="line-added">+             if (parent == NULL) return;</span>
<span class="line-added">+ </span>
<span class="line-added">+             if (((cur-&gt;type == XML_ELEMENT_CONTENT_OR) ||</span>
<span class="line-added">+                  (cur-&gt;type == XML_ELEMENT_CONTENT_SEQ)) &amp;&amp;</span>
<span class="line-added">+                 ((cur-&gt;type != parent-&gt;type) ||</span>
<span class="line-added">+                  (cur-&gt;ocur != XML_ELEMENT_CONTENT_ONCE)))</span>
          xmlBufferWriteChar(buf, &quot;)&quot;);
<span class="line-modified">!             xmlDumpElementOccur(buf, cur);</span>
<span class="line-modified">! </span>
<span class="line-modified">!             if (cur == parent-&gt;c1) {</span>
<span class="line-modified">!                 if (parent-&gt;type == XML_ELEMENT_CONTENT_SEQ)</span>
<span class="line-modified">!                     xmlBufferWriteChar(buf, &quot; , &quot;);</span>
<span class="line-modified">!                 else if (parent-&gt;type == XML_ELEMENT_CONTENT_OR)</span>
<span class="line-modified">!                     xmlBufferWriteChar(buf, &quot; | &quot;);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 cur = parent-&gt;c2;</span>
          break;
      }
<span class="line-added">+ </span>
<span class="line-added">+             cur = parent;</span>
<span class="line-added">+         }</span>
<span class="line-added">+     } while (cur != content);</span>
<span class="line-added">+ </span>
<span class="line-added">+     xmlBufferWriteChar(buf, &quot;)&quot;);</span>
<span class="line-added">+     xmlDumpElementOccur(buf, content);</span>
  }
  
  /**
   * xmlSprintfElementContent:
   * @buf:  an output buffer
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1701,22 ***</span>
          xmlBufferWriteCHAR(buf, elem-&gt;prefix);
          xmlBufferWriteChar(buf, &quot;:&quot;);
          }
          xmlBufferWriteCHAR(buf, elem-&gt;name);
          xmlBufferWriteChar(buf, &quot; &quot;);
<span class="line-modified">!         xmlDumpElementContent(buf, elem-&gt;content, 1);</span>
          xmlBufferWriteChar(buf, &quot;&gt;\n&quot;);
          break;
      case XML_ELEMENT_TYPE_ELEMENT:
          xmlBufferWriteChar(buf, &quot;&lt;!ELEMENT &quot;);
          if (elem-&gt;prefix != NULL) {
          xmlBufferWriteCHAR(buf, elem-&gt;prefix);
          xmlBufferWriteChar(buf, &quot;:&quot;);
          }
          xmlBufferWriteCHAR(buf, elem-&gt;name);
          xmlBufferWriteChar(buf, &quot; &quot;);
<span class="line-modified">!         xmlDumpElementContent(buf, elem-&gt;content, 1);</span>
          xmlBufferWriteChar(buf, &quot;&gt;\n&quot;);
          break;
      default:
          xmlErrValid(NULL, XML_ERR_INTERNAL_ERROR,
              &quot;Internal: ELEMENT struct corrupted invalid type\n&quot;,
<span class="line-new-header">--- 1744,22 ---</span>
          xmlBufferWriteCHAR(buf, elem-&gt;prefix);
          xmlBufferWriteChar(buf, &quot;:&quot;);
          }
          xmlBufferWriteCHAR(buf, elem-&gt;name);
          xmlBufferWriteChar(buf, &quot; &quot;);
<span class="line-modified">!         xmlDumpElementContent(buf, elem-&gt;content);</span>
          xmlBufferWriteChar(buf, &quot;&gt;\n&quot;);
          break;
      case XML_ELEMENT_TYPE_ELEMENT:
          xmlBufferWriteChar(buf, &quot;&lt;!ELEMENT &quot;);
          if (elem-&gt;prefix != NULL) {
          xmlBufferWriteCHAR(buf, elem-&gt;prefix);
          xmlBufferWriteChar(buf, &quot;:&quot;);
          }
          xmlBufferWriteCHAR(buf, elem-&gt;name);
          xmlBufferWriteChar(buf, &quot; &quot;);
<span class="line-modified">!         xmlDumpElementContent(buf, elem-&gt;content);</span>
          xmlBufferWriteChar(buf, &quot;&gt;\n&quot;);
          break;
      default:
          xmlErrValid(NULL, XML_ERR_INTERNAL_ERROR,
              &quot;Internal: ELEMENT struct corrupted invalid type\n&quot;,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2638,11 ***</span>
       */
      ret-&gt;value = xmlStrdup(value);
      ret-&gt;doc = doc;
      if ((ctxt != NULL) &amp;&amp; (ctxt-&gt;vstateNr != 0)) {
      /*
<span class="line-modified">!      * Operating in streaming mode, attr is gonna disapear</span>
       */
      if (doc-&gt;dict != NULL)
          ret-&gt;name = xmlDictLookup(doc-&gt;dict, attr-&gt;name, -1);
      else
          ret-&gt;name = xmlStrdup(attr-&gt;name);
<span class="line-new-header">--- 2681,11 ---</span>
       */
      ret-&gt;value = xmlStrdup(value);
      ret-&gt;doc = doc;
      if ((ctxt != NULL) &amp;&amp; (ctxt-&gt;vstateNr != 0)) {
      /*
<span class="line-modified">!      * Operating in streaming mode, attr is gonna disappear</span>
       */
      if (doc-&gt;dict != NULL)
          ret-&gt;name = xmlDictLookup(doc-&gt;dict, attr-&gt;name, -1);
      else
          ret-&gt;name = xmlStrdup(attr-&gt;name);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2966,11 ***</span>
       * fill the structure.
       */
      ret-&gt;value = xmlStrdup(value);
      if ((ctxt != NULL) &amp;&amp; (ctxt-&gt;vstateNr != 0)) {
      /*
<span class="line-modified">!      * Operating in streaming mode, attr is gonna disapear</span>
       */
      ret-&gt;name = xmlStrdup(attr-&gt;name);
      ret-&gt;attr = NULL;
      } else {
      ret-&gt;name = NULL;
<span class="line-new-header">--- 3009,11 ---</span>
       * fill the structure.
       */
      ret-&gt;value = xmlStrdup(value);
      if ((ctxt != NULL) &amp;&amp; (ctxt-&gt;vstateNr != 0)) {
      /*
<span class="line-modified">!      * Operating in streaming mode, attr is gonna disappear</span>
       */
      ret-&gt;name = xmlStrdup(attr-&gt;name);
      ret-&gt;attr = NULL;
      } else {
      ret-&gt;name = NULL;
</pre>
<center><a href="uri.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="win32/Makefile.bcb.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>