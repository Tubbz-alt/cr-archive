<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/page/TextIndicator.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SuspendableTimer.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="UserContentURLPattern.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/page/TextIndicator.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 289,10 ***</span>
<span class="line-new-header">--- 289,20 ---</span>
          hasOnlyLegibleTextColors = textColorIsLegibleAgainstBackgroundColor(Color::black, backgroundColor);
  
      return !hasOnlyLegibleTextColors || textColors.isEmpty();
  }
  
<span class="line-added">+ static bool containsOnlyWhiteSpaceText(const Range&amp; range)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     auto* stop = range.pastLastNode();</span>
<span class="line-added">+     for (auto* node = range.firstNode(); node &amp;&amp; node != stop; node = NodeTraversal::next(*node)) {</span>
<span class="line-added">+         if (!is&lt;RenderText&gt;(node-&gt;renderer()))</span>
<span class="line-added">+             return false;</span>
<span class="line-added">+     }</span>
<span class="line-added">+     return plainTextReplacingNoBreakSpace(&amp;range).stripWhiteSpace().isEmpty();</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  static bool initializeIndicator(TextIndicatorData&amp; data, Frame&amp; frame, const Range&amp; range, FloatSize margin, bool indicatesCurrentSelection)
  {
      if (auto* document = frame.document())
          document-&gt;updateLayoutIgnorePendingStylesheets();
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 310,11 ***</span>
      if (indicatesCurrentSelection &amp;&amp; !(data.options &amp; TextIndicatorOptionIncludeMarginIfRangeMatchesSelection))
          margin = FloatSize();
  
      FrameSelection::TextRectangleHeight textRectHeight = (data.options &amp; TextIndicatorOptionTightlyFitContent) ? FrameSelection::TextRectangleHeight::TextHeight : FrameSelection::TextRectangleHeight::SelectionHeight;
  
<span class="line-modified">!     if ((data.options &amp; TextIndicatorOptionUseBoundingRectAndPaintAllContentForComplexRanges) &amp;&amp; (hasNonInlineOrReplacedElements(range) || treatRangeAsComplexDueToIllegibleTextColors))</span>
          data.options |= TextIndicatorOptionPaintAllContent;
  #if PLATFORM(IOS_FAMILY)
      else if (data.options &amp; TextIndicatorOptionUseSelectionRectForSizing)
          getSelectionRectsForRange(textRects, range);
  #endif
<span class="line-new-header">--- 320,18 ---</span>
      if (indicatesCurrentSelection &amp;&amp; !(data.options &amp; TextIndicatorOptionIncludeMarginIfRangeMatchesSelection))
          margin = FloatSize();
  
      FrameSelection::TextRectangleHeight textRectHeight = (data.options &amp; TextIndicatorOptionTightlyFitContent) ? FrameSelection::TextRectangleHeight::TextHeight : FrameSelection::TextRectangleHeight::SelectionHeight;
  
<span class="line-modified">!     bool useBoundingRectAndPaintAllContentForComplexRanges = data.options &amp; TextIndicatorOptionUseBoundingRectAndPaintAllContentForComplexRanges;</span>
<span class="line-added">+     if (useBoundingRectAndPaintAllContentForComplexRanges &amp;&amp; containsOnlyWhiteSpaceText(range)) {</span>
<span class="line-added">+         auto commonAncestorContainer = makeRefPtr(range.commonAncestorContainer());</span>
<span class="line-added">+         if (auto* containerRenderer = commonAncestorContainer-&gt;renderer()) {</span>
<span class="line-added">+             data.options |= TextIndicatorOptionPaintAllContent;</span>
<span class="line-added">+             textRects.append(containerRenderer-&gt;absoluteBoundingBoxRect());</span>
<span class="line-added">+         }</span>
<span class="line-added">+     } else if (useBoundingRectAndPaintAllContentForComplexRanges &amp;&amp; (treatRangeAsComplexDueToIllegibleTextColors || hasNonInlineOrReplacedElements(range)))</span>
          data.options |= TextIndicatorOptionPaintAllContent;
  #if PLATFORM(IOS_FAMILY)
      else if (data.options &amp; TextIndicatorOptionUseSelectionRectForSizing)
          getSelectionRectsForRange(textRects, range);
  #endif
</pre>
<center><a href="SuspendableTimer.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="UserContentURLPattern.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>