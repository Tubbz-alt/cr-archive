<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSWorkletGlobalScopeBase.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2018 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  *
 25  */
 26 
 27 #include &quot;config.h&quot;
 28 #include &quot;JSWorkletGlobalScopeBase.h&quot;
 29 
 30 #if ENABLE(CSS_PAINTING_API)
 31 
 32 #include &quot;DOMWrapperWorld.h&quot;
 33 #include &quot;JSDOMGlobalObjectTask.h&quot;
<a name="1" id="anc1"></a>
 34 #include &quot;JSWorkletGlobalScope.h&quot;
 35 #include &quot;WorkletGlobalScope.h&quot;
 36 #include &quot;WorkletScriptController.h&quot;
 37 #include &lt;JavaScriptCore/JSCInlines.h&gt;
 38 #include &lt;JavaScriptCore/JSCJSValueInlines.h&gt;
 39 #include &lt;wtf/Language.h&gt;
 40 
 41 namespace WebCore {
 42 
 43 using namespace JSC;
 44 
 45 const ClassInfo JSWorkletGlobalScopeBase::s_info = { &quot;WorkletGlobalScope&quot;, &amp;JSDOMGlobalObject::s_info, nullptr, nullptr, CREATE_METHOD_TABLE(JSWorkletGlobalScopeBase) };
 46 
 47 const GlobalObjectMethodTable JSWorkletGlobalScopeBase::s_globalObjectMethodTable = {
 48     &amp;supportsRichSourceInfo,
 49     &amp;shouldInterruptScript,
 50     &amp;javaScriptRuntimeFlags,
<a name="2" id="anc2"></a><span class="line-modified"> 51     nullptr, // queueTaskToEventLoop</span>
 52     &amp;shouldInterruptScriptBeforeTimeout,
 53     nullptr, // moduleLoaderImportModule
 54     nullptr, // moduleLoaderResolve
 55     nullptr, // moduleLoaderFetch
 56     nullptr, // moduleLoaderCreateImportMetaProperties
 57     nullptr, // moduleLoaderEvaluate
 58     &amp;promiseRejectionTracker,
 59     &amp;defaultLanguage,
 60     nullptr, // compileStreaming
 61     nullptr, // instantiateStreaming
 62 };
 63 
 64 JSWorkletGlobalScopeBase::JSWorkletGlobalScopeBase(JSC::VM&amp; vm, JSC::Structure* structure, RefPtr&lt;WorkletGlobalScope&gt;&amp;&amp; impl)
 65     : JSDOMGlobalObject(vm, structure, normalWorld(vm), &amp;s_globalObjectMethodTable)
 66     , m_wrapped(WTFMove(impl))
 67 {
 68 }
 69 
 70 void JSWorkletGlobalScopeBase::finishCreation(VM&amp; vm, JSProxy* proxy)
 71 {
 72     m_proxy.set(vm, this, proxy);
 73 
 74     Base::finishCreation(vm, m_proxy.get());
 75     ASSERT(inherits(vm, info()));
 76 }
 77 
 78 void JSWorkletGlobalScopeBase::clearDOMGuardedObjects()
 79 {
 80     auto guardedObjects = m_guardedObjects;
 81     for (auto&amp; guarded : guardedObjects)
 82         guarded-&gt;clear();
 83 }
 84 
 85 void JSWorkletGlobalScopeBase::visitChildren(JSCell* cell, SlotVisitor&amp; visitor)
 86 {
 87     auto* thisObject = jsCast&lt;JSWorkletGlobalScopeBase*&gt;(cell);
 88     ASSERT_GC_OBJECT_INHERITS(thisObject, info());
 89     Base::visitChildren(thisObject, visitor);
 90     visitor.append(thisObject-&gt;m_proxy);
 91 }
 92 
 93 void JSWorkletGlobalScopeBase::destroy(JSCell* cell)
 94 {
 95     static_cast&lt;JSWorkletGlobalScopeBase*&gt;(cell)-&gt;JSWorkletGlobalScopeBase::~JSWorkletGlobalScopeBase();
 96 }
 97 
 98 ScriptExecutionContext* JSWorkletGlobalScopeBase::scriptExecutionContext() const
 99 {
100     return m_wrapped.get();
101 }
102 
103 bool JSWorkletGlobalScopeBase::supportsRichSourceInfo(const JSGlobalObject* object)
104 {
105     return JSGlobalObject::supportsRichSourceInfo(object);
106 }
107 
108 bool JSWorkletGlobalScopeBase::shouldInterruptScript(const JSGlobalObject* object)
109 {
110     return JSGlobalObject::shouldInterruptScript(object);
111 }
112 
113 bool JSWorkletGlobalScopeBase::shouldInterruptScriptBeforeTimeout(const JSGlobalObject* object)
114 {
115     return JSGlobalObject::shouldInterruptScriptBeforeTimeout(object);
116 }
117 
118 RuntimeFlags JSWorkletGlobalScopeBase::javaScriptRuntimeFlags(const JSGlobalObject* object)
119 {
120     auto* thisObject = jsCast&lt;const JSWorkletGlobalScopeBase*&gt;(object);
121     return thisObject-&gt;m_wrapped-&gt;jsRuntimeFlags();
122 }
123 
<a name="3" id="anc3"></a><span class="line-modified">124 JSValue toJS(ExecState* exec, JSDOMGlobalObject*, WorkletGlobalScope&amp; workletGlobalScope)</span>
125 {
<a name="4" id="anc4"></a><span class="line-modified">126     return toJS(exec, workletGlobalScope);</span>
127 }
128 
<a name="5" id="anc5"></a><span class="line-modified">129 JSValue toJS(ExecState*, WorkletGlobalScope&amp; workletGlobalScope)</span>
130 {
131     if (!workletGlobalScope.script())
132         return jsUndefined();
133     auto* contextWrapper = workletGlobalScope.script()-&gt;workletGlobalScopeWrapper();
134     if (!contextWrapper)
135         return jsUndefined();
136     return contextWrapper-&gt;proxy();
137 }
138 
139 JSWorkletGlobalScope* toJSWorkletGlobalScope(VM&amp; vm, JSValue value)
140 {
141     if (!value.isObject())
142         return nullptr;
143     auto* classInfo = asObject(value)-&gt;classInfo(vm);
144 
145     if (classInfo == JSProxy::info())
146         return jsDynamicCast&lt;JSWorkletGlobalScope*&gt;(vm, jsCast&lt;JSProxy*&gt;(asObject(value))-&gt;target());
147 
148     return nullptr;
149 }
150 
151 } // namespace WebCore
152 #endif
<a name="6" id="anc6"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="6" type="hidden" />
</body>
</html>