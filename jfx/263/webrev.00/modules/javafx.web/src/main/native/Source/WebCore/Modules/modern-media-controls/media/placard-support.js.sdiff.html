<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/Modules/modern-media-controls/media/placard-support.js</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="pip-support.js.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../notifications/Notification.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/modern-media-controls/media/placard-support.js</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 27 {
 28 
 29     constructor(mediaController)
 30     {
 31         super(mediaController);
 32         this._updatePlacard();
 33     }
 34 
 35     // Protected
 36 
 37     get mediaEvents()
 38     {
 39         return [&quot;loadstart&quot;, &quot;error&quot;, &quot;webkitpresentationmodechanged&quot;, &quot;webkitcurrentplaybacktargetiswirelesschanged&quot;];
 40     }
 41 
 42     handleEvent(event)
 43     {
 44         this._updatePlacard();
 45     }
 46 







 47     disable()
 48     {
<span class="line-modified"> 49         // We should not allow disabling Placard support when playing inline as it would prevent the</span>
<span class="line-modified"> 50         // PiP placard from being shown if the controls are disabled.</span>
<span class="line-modified"> 51         if (this.mediaController.isFullscreen)</span>
<span class="line-removed"> 52             super.disable();</span>
 53     }
 54 
 55     // Private
 56 
 57     _updatePlacard()
 58     {
 59         const controls = this.mediaController.controls;
 60         const media = this.mediaController.media;
 61 
 62         let placard = null;
 63         if (media.webkitPresentationMode === &quot;picture-in-picture&quot;)
 64             placard = controls.pipPlacard;
 65         else if (media.webkitCurrentPlaybackTargetIsWireless) {
 66             this._updateAirPlayPlacard();
 67             placard = controls.airplayPlacard;
<span class="line-modified"> 68         } else if (media instanceof HTMLVideoElement &amp;&amp; media.error !== null &amp;&amp; media.played.length === 0)</span>
 69             placard = controls.invalidPlacard;
 70 
 71         controls.placard = placard;
 72     }
 73     
 74     _updateAirPlayPlacard()
 75     {
 76         var deviceName = &quot;&quot;;
 77         
 78         if (!this.mediaController.host)
 79             return;
 80         
 81         switch(this.mediaController.host.externalDeviceType) {
 82             case &#39;airplay&#39;:
<span class="line-modified"> 83                 deviceName = UIString(&quot;This video is playing on “%s”.&quot;, this.mediaController.host.externalDeviceDisplayName || UIString(&quot;Apple TV&quot;));</span>
 84                 break;
 85             case &#39;tvout&#39;:
 86                 deviceName = UIString(&quot;This video is playing on the TV.&quot;);
 87                 break;
 88         }
 89         this.mediaController.controls.airplayPlacard.description = deviceName;
 90     }
 91 
 92 }







</pre>
</td>
<td>
<hr />
<pre>
 27 {
 28 
 29     constructor(mediaController)
 30     {
 31         super(mediaController);
 32         this._updatePlacard();
 33     }
 34 
 35     // Protected
 36 
 37     get mediaEvents()
 38     {
 39         return [&quot;loadstart&quot;, &quot;error&quot;, &quot;webkitpresentationmodechanged&quot;, &quot;webkitcurrentplaybacktargetiswirelesschanged&quot;];
 40     }
 41 
 42     handleEvent(event)
 43     {
 44         this._updatePlacard();
 45     }
 46 
<span class="line-added"> 47     enable()</span>
<span class="line-added"> 48     {</span>
<span class="line-added"> 49         super.enable();</span>
<span class="line-added"> 50         this._isDisabled = false;</span>
<span class="line-added"> 51         this._updatePlacard();</span>
<span class="line-added"> 52     }</span>
<span class="line-added"> 53 </span>
 54     disable()
 55     {
<span class="line-modified"> 56         // Never disable the plackard, just remeber whether the placard should be visible or not</span>
<span class="line-modified"> 57         this._isDisabled = true;</span>
<span class="line-modified"> 58         this._updatePlacard();</span>

 59     }
 60 
 61     // Private
 62 
 63     _updatePlacard()
 64     {
 65         const controls = this.mediaController.controls;
 66         const media = this.mediaController.media;
 67 
 68         let placard = null;
 69         if (media.webkitPresentationMode === &quot;picture-in-picture&quot;)
 70             placard = controls.pipPlacard;
 71         else if (media.webkitCurrentPlaybackTargetIsWireless) {
 72             this._updateAirPlayPlacard();
 73             placard = controls.airplayPlacard;
<span class="line-modified"> 74         } else if (!this._isDisabled &amp;&amp; media instanceof HTMLVideoElement &amp;&amp; media.error !== null &amp;&amp; media.played.length === 0)</span>
 75             placard = controls.invalidPlacard;
 76 
 77         controls.placard = placard;
 78     }
 79     
 80     _updateAirPlayPlacard()
 81     {
 82         var deviceName = &quot;&quot;;
 83         
 84         if (!this.mediaController.host)
 85             return;
 86         
 87         switch(this.mediaController.host.externalDeviceType) {
 88             case &#39;airplay&#39;:
<span class="line-modified"> 89                 deviceName = UIString(&quot;This video is playing on “%s”.&quot;, escapeHTML(this.mediaController.host.externalDeviceDisplayName) || UIString(&quot;Apple TV&quot;));</span>
 90                 break;
 91             case &#39;tvout&#39;:
 92                 deviceName = UIString(&quot;This video is playing on the TV.&quot;);
 93                 break;
 94         }
 95         this.mediaController.controls.airplayPlacard.description = deviceName;
 96     }
 97 
 98 }
<span class="line-added"> 99 </span>
<span class="line-added">100 function escapeHTML(unsafeString)</span>
<span class="line-added">101 {</span>
<span class="line-added">102     var div = document.createElement(&quot;div&quot;);</span>
<span class="line-added">103     div.textContent = unsafeString;</span>
<span class="line-added">104     return div.innerHTML;</span>
<span class="line-added">105 }</span>
</pre>
</td>
</tr>
</table>
<center><a href="pip-support.js.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../notifications/Notification.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>