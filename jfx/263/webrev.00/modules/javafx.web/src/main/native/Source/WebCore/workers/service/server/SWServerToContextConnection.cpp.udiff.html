<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/workers/service/server/SWServerToContextConnection.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SWServerRegistration.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="SWServerToContextConnection.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/workers/service/server/SWServerToContextConnection.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -38,45 +38,30 @@</span>
  static SWServerToContextConnectionIdentifier generateServerToContextConnectionIdentifier()
  {
      return SWServerToContextConnectionIdentifier::generate();
  }
  
<span class="udiff-line-modified-removed">- static HashMap&lt;RegistrableDomain, SWServerToContextConnection*&gt;&amp; allConnectionsByRegistrableDomain()</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     static NeverDestroyed&lt;HashMap&lt;RegistrableDomain, SWServerToContextConnection*&gt;&gt; connectionsByOrigin;</span>
<span class="udiff-line-removed">-     return connectionsByOrigin;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- SWServerToContextConnection::SWServerToContextConnection(const RegistrableDomain&amp; registrableDomain)</span>
<span class="udiff-line-modified-added">+ SWServerToContextConnection::SWServerToContextConnection(RegistrableDomain&amp;&amp; registrableDomain)</span>
      : m_identifier(generateServerToContextConnectionIdentifier())
<span class="udiff-line-modified-removed">-     , m_registrableDomain(registrableDomain)</span>
<span class="udiff-line-modified-added">+     , m_registrableDomain(WTFMove(registrableDomain))</span>
  {
<span class="udiff-line-removed">-     auto result = allConnectionsByRegistrableDomain().add(m_registrableDomain, this);</span>
<span class="udiff-line-removed">-     ASSERT_UNUSED(result, result.isNewEntry);</span>
  }
  
  SWServerToContextConnection::~SWServerToContextConnection()
  {
<span class="udiff-line-removed">-     auto result = allConnectionsByRegistrableDomain().remove(m_registrableDomain);</span>
<span class="udiff-line-removed">-     ASSERT_UNUSED(result, result);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- SWServerToContextConnection* SWServerToContextConnection::connectionForRegistrableDomain(const RegistrableDomain&amp; registrableDomain)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     return allConnectionsByRegistrableDomain().get(registrableDomain);</span>
  }
  
  void SWServerToContextConnection::scriptContextFailedToStart(const Optional&lt;ServiceWorkerJobDataIdentifier&gt;&amp; jobDataIdentifier, ServiceWorkerIdentifier serviceWorkerIdentifier, const String&amp; message)
  {
      if (auto* worker = SWServerWorker::existingWorkerForIdentifier(serviceWorkerIdentifier))
          worker-&gt;scriptContextFailedToStart(jobDataIdentifier, message);
  }
  
<span class="udiff-line-modified-removed">- void SWServerToContextConnection::scriptContextStarted(const Optional&lt;ServiceWorkerJobDataIdentifier&gt;&amp; jobDataIdentifier, ServiceWorkerIdentifier serviceWorkerIdentifier)</span>
<span class="udiff-line-modified-added">+ void SWServerToContextConnection::scriptContextStarted(const Optional&lt;ServiceWorkerJobDataIdentifier&gt;&amp; jobDataIdentifier, ServiceWorkerIdentifier serviceWorkerIdentifier, bool doesHandleFetch)</span>
  {
      if (auto* worker = SWServerWorker::existingWorkerForIdentifier(serviceWorkerIdentifier))
<span class="udiff-line-modified-removed">-         worker-&gt;scriptContextStarted(jobDataIdentifier);</span>
<span class="udiff-line-modified-added">+         worker-&gt;scriptContextStarted(jobDataIdentifier, doesHandleFetch);</span>
  }
  
  void SWServerToContextConnection::didFinishInstall(const Optional&lt;ServiceWorkerJobDataIdentifier&gt;&amp; jobDataIdentifier, ServiceWorkerIdentifier serviceWorkerIdentifier, bool wasSuccessful)
  {
      if (auto* worker = SWServerWorker::existingWorkerForIdentifier(serviceWorkerIdentifier))
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -122,22 +107,28 @@</span>
          worker-&gt;claim();
          worker-&gt;contextConnection()-&gt;claimCompleted(requestIdentifier);
      }
  }
  
<span class="udiff-line-modified-removed">- void SWServerToContextConnection::skipWaiting(ServiceWorkerIdentifier serviceWorkerIdentifier, uint64_t callbackID)</span>
<span class="udiff-line-modified-added">+ void SWServerToContextConnection::skipWaiting(ServiceWorkerIdentifier serviceWorkerIdentifier, CompletionHandler&lt;void()&gt;&amp;&amp; completionHandler)</span>
  {
      if (auto* worker = SWServerWorker::existingWorkerForIdentifier(serviceWorkerIdentifier))
          worker-&gt;skipWaiting();
  
<span class="udiff-line-modified-removed">-     didFinishSkipWaiting(callbackID);</span>
<span class="udiff-line-modified-added">+     completionHandler();</span>
  }
  
  void SWServerToContextConnection::setScriptResource(ServiceWorkerIdentifier serviceWorkerIdentifier, URL&amp;&amp; scriptURL, String&amp;&amp; script, URL&amp;&amp; responseURL, String&amp;&amp; mimeType)
  {
      if (auto* worker = SWServerWorker::existingWorkerForIdentifier(serviceWorkerIdentifier))
          worker-&gt;setScriptResource(WTFMove(scriptURL), ServiceWorkerContextData::ImportedScript { WTFMove(script), WTFMove(responseURL), WTFMove(mimeType) });
  }
  
<span class="udiff-line-added">+ void SWServerToContextConnection::didFailHeartBeatCheck(ServiceWorkerIdentifier identifier)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (auto* worker = SWServerWorker::existingWorkerForIdentifier(identifier))</span>
<span class="udiff-line-added">+         worker-&gt;didFailHeartBeatCheck();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  } // namespace WebCore
  
  #endif // ENABLE(SERVICE_WORKER)
</pre>
<center><a href="SWServerRegistration.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="SWServerToContextConnection.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>