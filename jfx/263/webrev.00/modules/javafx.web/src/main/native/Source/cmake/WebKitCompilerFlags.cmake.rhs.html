<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/cmake/WebKitCompilerFlags.cmake</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 # Prepends flags to CMAKE_C_FLAGS if supported by the C compiler. Almost all
  2 # flags should be prepended to allow the user to override them.
  3 macro(WEBKIT_PREPEND_GLOBAL_C_FLAGS)
  4     foreach (_flag ${ARGN})
  5         check_c_compiler_flag(&quot;${_flag}&quot; C_COMPILER_SUPPORTS_${_flag})
  6         if (C_COMPILER_SUPPORTS_${_flag})
  7             set(CMAKE_C_FLAGS &quot;${_flag} ${CMAKE_C_FLAGS}&quot;)
  8         endif ()
  9     endforeach ()
 10 endmacro()
 11 
 12 # Appends flags to CMAKE_C_FLAGS if supported by the C compiler. This macro
 13 # should be used sparingly. Only append flags if the user must not be allowed to
 14 # override them.
 15 macro(WEBKIT_APPEND_GLOBAL_C_FLAGS)
 16     foreach (_flag ${ARGN})
 17         check_c_compiler_flag(&quot;${_flag}&quot; C_COMPILER_SUPPORTS_${_flag})
 18         if (C_COMPILER_SUPPORTS_${_flag})
 19             set(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} ${_flag}&quot;)
 20         endif ()
 21     endforeach ()
 22 endmacro()
 23 
 24 # Prepends flags to CMAKE_CXX_FLAGS if supported by the C++ compiler. Almost all
 25 # flags should be prepended to allow the user to override them.
 26 macro(WEBKIT_PREPEND_GLOBAL_CXX_FLAGS)
 27     foreach (_flag ${ARGN})
 28         check_cxx_compiler_flag(&quot;${_flag}&quot; CXX_COMPILER_SUPPORTS_${_flag})
 29         if (CXX_COMPILER_SUPPORTS_${_flag})
 30             set(CMAKE_CXX_FLAGS &quot;${_flag} ${CMAKE_CXX_FLAGS}&quot;)
 31         endif ()
 32     endforeach ()
 33 endmacro()
 34 
 35 # Appends flags to CMAKE_CXX_FLAGS if supported by the C++ compiler. This macro
 36 # should be used sparingly. Only append flags if the user must not be allowed to
 37 # override them.
 38 macro(WEBKIT_APPEND_GLOBAL_CXX_FLAGS)
 39     foreach (_flag ${ARGN})
 40         check_cxx_compiler_flag(&quot;${_flag}&quot; CXX_COMPILER_SUPPORTS_${_flag})
 41         if (CXX_COMPILER_SUPPORTS_${_flag})
 42             set(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} ${_flag}&quot;)
 43         endif ()
 44     endforeach ()
 45 endmacro()
 46 
 47 # Prepends flags to CMAKE_C_FLAGS and CMAKE_CXX_FLAGS if supported by the C
 48 # or C++ compiler, respectively. Almost all flags should be prepended to allow
 49 # the user to override them.
 50 macro(WEBKIT_PREPEND_GLOBAL_COMPILER_FLAGS)
 51     WEBKIT_PREPEND_GLOBAL_C_FLAGS(${ARGN})
 52     WEBKIT_PREPEND_GLOBAL_CXX_FLAGS(${ARGN})
 53 endmacro()
 54 
 55 # Appends flags to CMAKE_C_FLAGS and CMAKE_CXX_FLAGS if supported by the C or
 56 # C++ compiler, respectively. This macro should be used sparingly. Only append
 57 # flags if the user must not be allowed to override them.
 58 macro(WEBKIT_APPEND_GLOBAL_COMPILER_FLAGS)
 59     WEBKIT_APPEND_GLOBAL_C_FLAGS(${ARGN})
 60     WEBKIT_APPEND_GLOBAL_CXX_FLAGS(${ARGN})
 61 endmacro()
 62 
 63 # Appends flags to COMPILE_FLAGS of _target if supported by the C compiler.
 64 # Note that it is simply not possible to pass different C and C++ flags, unless
 65 # we drop support for the Visual Studio backend and use the COMPILE_LANGUAGE
 66 # generator expression. This is a very serious limitation.
 67 macro(WEBKIT_ADD_TARGET_C_FLAGS _target)
 68     foreach (_flag ${ARGN})
 69         check_c_compiler_flag(&quot;${_flag}&quot; C_COMPILER_SUPPORTS_${_flag})
 70         if (C_COMPILER_SUPPORTS_${_flag})
 71             target_compile_options(${_target} PRIVATE ${_flag})
 72         endif ()
 73     endforeach ()
 74 endmacro()
 75 
 76 # Appends flags to COMPILE_FLAGS of _target if supported by the C++ compiler.
 77 # Note that it is simply not possible to pass different C and C++ flags, unless
 78 # we drop support for the Visual Studio backend and use the COMPILE_LANGUAGE
 79 # generator expression. This is a very serious limitation.
 80 macro(WEBKIT_ADD_TARGET_CXX_FLAGS _target)
 81     foreach (_flag ${ARGN})
 82         check_cxx_compiler_flag(&quot;${_flag}&quot; CXX_COMPILER_SUPPORTS_${_flag})
 83         if (CXX_COMPILER_SUPPORTS_${_flag})
 84             target_compile_options(${_target} PRIVATE ${_flag})
 85         endif ()
 86     endforeach ()
 87 endmacro()
 88 
 89 
 90 if (COMPILER_IS_GCC_OR_CLANG)
 91     WEBKIT_APPEND_GLOBAL_COMPILER_FLAGS(-fno-strict-aliasing)
 92 
 93     # clang-cl.exe impersonates cl.exe so some clang arguments like -fno-rtti are
 94     # represented using cl.exe&#39;s options and should not be passed as flags, so
 95     # we do not add -fno-rtti or -fno-exceptions for clang-cl
 96     if (COMPILER_IS_CLANG_CL)
 97         # FIXME: These warnings should be addressed
 98         WEBKIT_PREPEND_GLOBAL_COMPILER_FLAGS(-Wno-undef
 99                                              -Wno-macro-redefined
100                                              -Wno-unknown-pragmas
101                                              -Wno-nonportable-include-path
102                                              -Wno-unknown-argument)
103     else ()
104         WEBKIT_APPEND_GLOBAL_COMPILER_FLAGS(-fno-exceptions)
105         WEBKIT_APPEND_GLOBAL_CXX_FLAGS(-fno-rtti)
106 
107         if (WIN32)
108             WEBKIT_APPEND_GLOBAL_COMPILER_FLAGS(-mno-ms-bitfields)
109             WEBKIT_PREPEND_GLOBAL_COMPILER_FLAGS(-Wno-unknown-pragmas)
110             add_definitions(-D__USE_MINGW_ANSI_STDIO=1)
111         endif ()
112     endif ()
113 
114     # Warnings to be enabled
115     WEBKIT_PREPEND_GLOBAL_COMPILER_FLAGS(-Wcast-align
116                                          -Wformat-security
117                                          -Wmissing-format-attribute
118                                          -Wpointer-arith
119                                          -Wundef
120                                          -Wwrite-strings)
121 
122     # Warnings to be disabled
123     # FIXME: We should probably not be disabling -Wno-maybe-uninitialized?
124     WEBKIT_PREPEND_GLOBAL_COMPILER_FLAGS(-Qunused-arguments
125                                          -Wno-maybe-uninitialized
<a name="1" id="anc1"></a>
126                                          -Wno-parentheses-equality
127                                          -Wno-psabi)
128 
<a name="2" id="anc2"></a><span class="line-added">129     WEBKIT_PREPEND_GLOBAL_CXX_FLAGS(-Wno-noexcept-type)</span>
<span class="line-added">130 </span>
131     # https://gcc.gnu.org/bugzilla/show_bug.cgi?id=80947
132     if (${CMAKE_CXX_COMPILER_VERSION} VERSION_LESS &quot;8.0&quot; AND NOT CMAKE_CXX_COMPILER_ID MATCHES &quot;Clang&quot;)
133         WEBKIT_PREPEND_GLOBAL_CXX_FLAGS(-Wno-attributes)
134     endif ()
135 
136     # -Wexpansion-to-defined produces false positives with GCC but not Clang
137     # https://bugs.webkit.org/show_bug.cgi?id=167643#c13
138     if (CMAKE_COMPILER_IS_GNUCXX)
139         WEBKIT_PREPEND_GLOBAL_COMPILER_FLAGS(-Wno-expansion-to-defined)
140     endif ()
141 
142     # Force SSE2 fp on x86 builds.
143     if (WTF_CPU_X86 AND NOT CMAKE_CROSSCOMPILING)
144         WEBKIT_PREPEND_GLOBAL_COMPILER_FLAGS(-msse2 -mfpmath=sse)
145         include(DetectSSE2)
146         if (NOT SSE2_SUPPORT_FOUND)
147             message(FATAL_ERROR &quot;SSE2 support is required to compile WebKit&quot;)
148         endif ()
149     endif ()
150 endif ()
151 
152 if (COMPILER_IS_GCC_OR_CLANG AND NOT MSVC)
153     # Don&#39;t give -Wall to clang-cl because clang-cl treats /Wall and -Wall as -Weverything.
154     # -Wall and -Wextra should be specified before -Wno-* for Clang.
155     WEBKIT_PREPEND_GLOBAL_COMPILER_FLAGS(-Wall -Wextra)
156 endif ()
157 
158 # Ninja tricks compilers into turning off color support.
159 if (CMAKE_GENERATOR STREQUAL &quot;Ninja&quot;)
160     WEBKIT_PREPEND_GLOBAL_COMPILER_FLAGS(-fcolor-diagnostics
161                                          -fdiagnostics-color=always)
162 endif ()
163 
164 
165 string(TOLOWER ${CMAKE_HOST_SYSTEM_PROCESSOR} LOWERCASE_CMAKE_HOST_SYSTEM_PROCESSOR)
166 if (&quot;${CMAKE_CXX_COMPILER_ID}&quot; STREQUAL &quot;GNU&quot; AND NOT &quot;${LOWERCASE_CMAKE_HOST_SYSTEM_PROCESSOR}&quot; MATCHES &quot;x86_64&quot;)
167     # To avoid out of memory when building with debug option in 32bit system.
168     # See https://bugs.webkit.org/show_bug.cgi?id=77327
169     set(CMAKE_SHARED_LINKER_FLAGS_DEBUG &quot;-Wl,--no-keep-memory ${CMAKE_SHARED_LINKER_FLAGS_DEBUG}&quot;)
170 endif ()
171 
172 if (LTO_MODE AND COMPILER_IS_CLANG)
173     set(CMAKE_C_FLAGS &quot;-flto=${LTO_MODE} ${CMAKE_C_FLAGS}&quot;)
174     set(CMAKE_CXX_FLAGS &quot;-flto=${LTO_MODE} ${CMAKE_CXX_FLAGS}&quot;)
175     set(CMAKE_EXE_LINKER_FLAGS &quot;-flto=${LTO_MODE} ${CMAKE_EXE_LINKER_FLAGS}&quot;)
176     set(CMAKE_SHARED_LINKER_FLAGS &quot;-flto=${LTO_MODE} ${CMAKE_SHARED_LINKER_FLAGS}&quot;)
177     set(CMAKE_MODULE_LINKER_FLAGS &quot;-flto=${LTO_MODE} ${CMAKE_MODULE_LINKER_FLAGS}&quot;)
178 endif ()
179 
180 if (COMPILER_IS_GCC_OR_CLANG)
181     # Careful: this needs to be above where ENABLED_COMPILER_SANITIZERS is set.
182     # Also, it&#39;s not possible to use the normal prepend/append macros for
183     # -fsanitize=* flags, because check_cxx_compiler_flag will report it&#39;s
184     # unsupported, because it causes the build to fail if not used when linking.
185     if (ENABLE_SANITIZERS)
186         if (MSVC AND WTF_CPU_X86_64)
187             find_library(CLANG_ASAN_LIBRARY clang_rt.asan_dynamic_runtime_thunk-x86_64 ${CLANG_LIB_PATH})
188             find_library(CLANG_ASAN_RT_LIBRARY clang_rt.asan_dynamic-x86_64 PATHS ${CLANG_LIB_PATH})
189             set(SANITIZER_LINK_FLAGS &quot;\&quot;${CLANG_ASAN_LIBRARY}\&quot; \&quot;${CLANG_ASAN_RT_LIBRARY}\&quot;&quot;)
190         else ()
191             set(SANITIZER_LINK_FLAGS &quot;-lpthread&quot;)
192         endif ()
193 
194         foreach (SANITIZER ${ENABLE_SANITIZERS})
195             if (${SANITIZER} MATCHES &quot;address&quot;)
196                 WEBKIT_PREPEND_GLOBAL_COMPILER_FLAGS(&quot;-fno-omit-frame-pointer -fno-optimize-sibling-calls&quot;)
197                 set(SANITIZER_COMPILER_FLAGS &quot;-fsanitize=address ${SANITIZER_COMPILER_FLAGS}&quot;)
198                 set(SANITIZER_LINK_FLAGS &quot;-fsanitize=address ${SANITIZER_LINK_FLAGS}&quot;)
199 
200             elseif (${SANITIZER} MATCHES &quot;undefined&quot;)
201                 WEBKIT_PREPEND_GLOBAL_COMPILER_FLAGS(&quot;-fno-omit-frame-pointer -fno-optimize-sibling-calls&quot;)
202                 # -fsanitize=vptr is incompatible with -fno-rtti
203                 set(SANITIZER_COMPILER_FLAGS &quot;-fsanitize=undefined -frtti ${SANITIZER_COMPILER_FLAGS}&quot;)
204                 set(SANITIZER_LINK_FLAGS &quot;-fsanitize=undefined ${SANITIZER_LINK_FLAGS}&quot;)
205 
206             elseif (${SANITIZER} MATCHES &quot;thread&quot; AND NOT MSVC)
207                 set(SANITIZER_COMPILER_FLAGS &quot;-fsanitize=thread ${SANITIZER_COMPILER_FLAGS}&quot;)
208                 set(SANITIZER_LINK_FLAGS &quot;-fsanitize=thread ${SANITIZER_LINK_FLAGS}&quot;)
209 
210             elseif (${SANITIZER} MATCHES &quot;memory&quot; AND COMPILER_IS_CLANG AND NOT MSVC)
211                 set(SANITIZER_COMPILER_FLAGS &quot;-fsanitize=memory ${SANITIZER_COMPILER_FLAGS}&quot;)
212                 set(SANITIZER_LINK_FLAGS &quot;-fsanitize=memory ${SANITIZER_LINK_FLAGS}&quot;)
213 
214             elseif (${SANITIZER} MATCHES &quot;leak&quot; AND NOT MSVC)
215                 set(SANITIZER_COMPILER_FLAGS &quot;-fsanitize=leak ${SANITIZER_COMPILER_FLAGS}&quot;)
216                 set(SANITIZER_LINK_FLAGS &quot;-fsanitize=leak ${SANITIZER_LINK_FLAGS}&quot;)
217 
218             else ()
219                 message(FATAL_ERROR &quot;Unsupported sanitizer: ${SANITIZER}&quot;)
220             endif ()
221         endforeach ()
222 
223         set(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} ${SANITIZER_COMPILER_FLAGS}&quot;)
224         set(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} ${SANITIZER_COMPILER_FLAGS}&quot;)
225         set(CMAKE_EXE_LINKER_FLAGS &quot;${CMAKE_EXE_LINKER_FLAGS} ${SANITIZER_LINK_FLAGS}&quot;)
226         set(CMAKE_SHARED_LINKER_FLAGS &quot;${CMAKE_SHARED_LINKER_FLAGS} ${SANITIZER_LINK_FLAGS}&quot;)
227         set(CMAKE_MODULE_LINKER_FLAGS &quot;${CMAKE_MODULE_LINKER_FLAGS} ${SANITIZER_LINK_FLAGS}&quot;)
228     endif ()
229 endif ()
230 
231 if (NOT MSVC)
232     string(REGEX MATCHALL &quot;-fsanitize=[^ ]*&quot; ENABLED_COMPILER_SANITIZERS ${CMAKE_CXX_FLAGS})
233 endif ()
234 
235 if (UNIX AND NOT APPLE AND NOT ENABLED_COMPILER_SANITIZERS)
236     set(CMAKE_SHARED_LINKER_FLAGS &quot;-Wl,--no-undefined ${CMAKE_SHARED_LINKER_FLAGS}&quot;)
237 endif ()
238 
239 
240 # CODE_GENERATOR_PREPROCESSOR_WITH_LINEMARKERS only matters with GCC &gt;= 4.7.0.  Since this
241 # version, -P does not output empty lines, which currently breaks make_names.pl in
242 # WebCore. Investigating whether make_names.pl should be changed instead is left as an exercise to
243 # the reader.
244 if (MSVC)
245     set(CODE_GENERATOR_PREPROCESSOR_ARGUMENTS &quot;/nologo /EP /TP&quot;)
246     set(CODE_GENERATOR_PREPROCESSOR_WITH_LINEMARKERS_ARGUMENTS ${CODE_GENERATOR_PREPROCESSOR_ARGUMENTS})
247 else ()
248     set(CODE_GENERATOR_PREPROCESSOR_ARGUMENTS &quot;-E -P -x c++&quot;)
249     set(CODE_GENERATOR_PREPROCESSOR_WITH_LINEMARKERS_ARGUMENTS &quot;-E -x c++&quot;)
250 endif ()
251 
252 set(CODE_GENERATOR_PREPROCESSOR &quot;\&quot;${CMAKE_CXX_COMPILER}\&quot; ${CODE_GENERATOR_PREPROCESSOR_ARGUMENTS}&quot;)
253 set(CODE_GENERATOR_PREPROCESSOR_WITH_LINEMARKERS &quot;\&quot;${CMAKE_CXX_COMPILER}\&quot; ${CODE_GENERATOR_PREPROCESSOR_WITH_LINEMARKERS_ARGUMENTS}&quot;)
254 
255 
256 # Ensure that the default include system directories are added to the list of CMake implicit includes.
257 # This workarounds an issue that happens when using GCC 6 and using system includes (-isystem).
258 # For more details check: https://bugs.webkit.org/show_bug.cgi?id=161697
259 macro(DETERMINE_GCC_SYSTEM_INCLUDE_DIRS _lang _compiler _flags _result)
260     file(WRITE &quot;${CMAKE_BINARY_DIR}/CMakeFiles/dummy&quot; &quot;\n&quot;)
261     separate_arguments(_buildFlags UNIX_COMMAND &quot;${_flags}&quot;)
262     execute_process(COMMAND ${_compiler} ${_buildFlags} -v -E -x ${_lang} -dD dummy
263                     WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/CMakeFiles OUTPUT_QUIET
264                     ERROR_VARIABLE _gccOutput)
265     file(REMOVE &quot;${CMAKE_BINARY_DIR}/CMakeFiles/dummy&quot;)
266     if (&quot;${_gccOutput}&quot; MATCHES &quot;&gt; search starts here[^\n]+\n *(.+) *\n *End of (search) list&quot;)
267         set(${_result} ${CMAKE_MATCH_1})
268         string(REPLACE &quot;\n&quot; &quot; &quot; ${_result} &quot;${${_result}}&quot;)
269         separate_arguments(${_result})
270     endif ()
271 endmacro()
272 
273 if (COMPILER_IS_GCC_OR_CLANG)
274    DETERMINE_GCC_SYSTEM_INCLUDE_DIRS(&quot;c&quot; &quot;${CMAKE_C_COMPILER}&quot; &quot;${CMAKE_C_FLAGS}&quot; SYSTEM_INCLUDE_DIRS)
275    set(CMAKE_C_IMPLICIT_INCLUDE_DIRECTORIES ${CMAKE_C_IMPLICIT_INCLUDE_DIRECTORIES} ${SYSTEM_INCLUDE_DIRS})
276    DETERMINE_GCC_SYSTEM_INCLUDE_DIRS(&quot;c++&quot; &quot;${CMAKE_CXX_COMPILER}&quot; &quot;${CMAKE_CXX_FLAGS}&quot; SYSTEM_INCLUDE_DIRS)
277    set(CMAKE_CXX_IMPLICIT_INCLUDE_DIRECTORIES ${CMAKE_CXX_IMPLICIT_INCLUDE_DIRECTORIES} ${SYSTEM_INCLUDE_DIRS})
278 endif ()
279 
280 if (COMPILER_IS_GCC_OR_CLANG)
281     set(ATOMIC_TEST_SOURCE &quot;
282         #include &lt;atomic&gt;
283         int main() { std::atomic&lt;int64_t&gt; i(0); i++; return 0; }
284     &quot;)
285     check_cxx_source_compiles(&quot;${ATOMIC_TEST_SOURCE}&quot; ATOMIC_INT64_IS_BUILTIN)
286     if (NOT ATOMIC_INT64_IS_BUILTIN)
287         set(CMAKE_REQUIRED_LIBRARIES atomic)
288         check_cxx_source_compiles(&quot;${ATOMIC_TEST_SOURCE}&quot; ATOMIC_INT64_REQUIRES_LIBATOMIC)
289         unset(CMAKE_REQUIRED_LIBRARIES)
290     endif ()
291 endif ()
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>