<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/inspector/InspectorAuditAccessibilityObject.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DOMPatchSupport.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InspectorCanvas.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/inspector/InspectorAuditAccessibilityObject.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 14  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 15  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 17  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 18  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 19  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 20  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 21  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 23  * THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 
 27 #include &quot;config.h&quot;
 28 #include &quot;InspectorAuditAccessibilityObject.h&quot;
 29 
 30 #include &quot;AXObjectCache.h&quot;
 31 #include &quot;AccessibilityNodeObject.h&quot;
<span class="line-modified"> 32 #include &quot;AccessibilityObject.h&quot;</span>
 33 #include &quot;ContainerNode.h&quot;
 34 #include &quot;Document.h&quot;
 35 #include &quot;Element.h&quot;
 36 #include &quot;ElementDescendantIterator.h&quot;
 37 #include &quot;HTMLNames.h&quot;
 38 #include &quot;Node.h&quot;
 39 #include &quot;SpaceSplitString.h&quot;
 40 #include &lt;wtf/Vector.h&gt;
 41 #include &lt;wtf/text/WTFString.h&gt;
 42 
 43 namespace WebCore {
 44 
 45 using namespace Inspector;
 46 
 47 #define ERROR_IF_NO_ACTIVE_AUDIT() \
 48     if (!m_auditAgent.hasActiveAudit()) \
 49         return Exception { NotAllowedError, &quot;Cannot be called outside of a Web Inspector Audit&quot;_s };
 50 
 51 InspectorAuditAccessibilityObject::InspectorAuditAccessibilityObject(InspectorAuditAgent&amp; auditAgent)
 52     : m_auditAgent(auditAgent)
 53 {
 54 }
 55 
<span class="line-modified"> 56 static AccessibilityObject* accessiblityObjectForNode(Node&amp; node)</span>
 57 {
 58     if (!AXObjectCache::accessibilityEnabled())
 59         AXObjectCache::enableAccessibility();
 60 
 61     if (AXObjectCache* axObjectCache = node.document().axObjectCache())
 62         return axObjectCache-&gt;getOrCreate(&amp;node);
 63 
 64     return nullptr;
 65 }
 66 
 67 ExceptionOr&lt;Vector&lt;Ref&lt;Node&gt;&gt;&gt; InspectorAuditAccessibilityObject::getElementsByComputedRole(Document&amp; document, const String&amp; role, Node* container)
 68 {
 69     ERROR_IF_NO_ACTIVE_AUDIT();
 70 
 71     Vector&lt;Ref&lt;Node&gt;&gt; nodes;
 72 
 73     for (Element&amp; element : elementDescendants(is&lt;ContainerNode&gt;(container) ? downcast&lt;ContainerNode&gt;(*container) : document)) {
<span class="line-modified"> 74         if (AccessibilityObject* axObject = accessiblityObjectForNode(element)) {</span>
 75             if (axObject-&gt;computedRoleString() == role)
 76                 nodes.append(element);
 77         }
 78     }
 79 
 80     return nodes;
 81 }
 82 
 83 ExceptionOr&lt;RefPtr&lt;Node&gt;&gt; InspectorAuditAccessibilityObject::getActiveDescendant(Node&amp; node)
 84 {
 85     ERROR_IF_NO_ACTIVE_AUDIT();
 86 
<span class="line-modified"> 87     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
<span class="line-modified"> 88         if (AccessibilityObject* activeDescendant = axObject-&gt;activeDescendant())</span>
 89             return activeDescendant-&gt;node();
 90     }
 91 
 92     return nullptr;
 93 }
 94 
<span class="line-modified"> 95 static void addChildren(AccessibilityObject&amp; parentObject, Vector&lt;RefPtr&lt;Node&gt;&gt;&amp; childNodes)</span>
 96 {
<span class="line-modified"> 97     for (const RefPtr&lt;AccessibilityObject&gt;&amp; childObject : parentObject.children()) {</span>
 98         if (Node* childNode = childObject-&gt;node())
 99             childNodes.append(childNode);
100         else
101             addChildren(*childObject, childNodes);
102     }
103 }
104 
105 ExceptionOr&lt;Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt;&gt; InspectorAuditAccessibilityObject::getChildNodes(Node&amp; node)
106 {
107     ERROR_IF_NO_ACTIVE_AUDIT();
108 
109     Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
110 
<span class="line-modified">111     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
112         Vector&lt;RefPtr&lt;Node&gt;&gt; childNodes;
113         addChildren(*axObject, childNodes);
114         result = WTFMove(childNodes);
115     }
116 
117     return result;
118 }
119 
120 ExceptionOr&lt;Optional&lt;InspectorAuditAccessibilityObject::ComputedProperties&gt;&gt; InspectorAuditAccessibilityObject::getComputedProperties(Node&amp; node)
121 {
122     ERROR_IF_NO_ACTIVE_AUDIT();
123 
124     Optional&lt;InspectorAuditAccessibilityObject::ComputedProperties&gt; result;
125 
<span class="line-modified">126     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
127         ComputedProperties computedProperties;
128 
<span class="line-modified">129         AccessibilityObject* current = axObject;</span>
130         while (current &amp;&amp; (!computedProperties.busy || !computedProperties.busy.value())) {
131             computedProperties.busy = current-&gt;isBusy();
132             current = current-&gt;parentObject();
133         }
134 
135         if (axObject-&gt;supportsChecked()) {
136             AccessibilityButtonState checkValue = axObject-&gt;checkboxOrRadioValue();
137             if (checkValue == AccessibilityButtonState::On)
138                 computedProperties.checked = &quot;true&quot;_s;
139             else if (checkValue == AccessibilityButtonState::Mixed)
140                 computedProperties.checked = &quot;mixed&quot;_s;
141             else if (axObject-&gt;isChecked())
142                 computedProperties.checked = &quot;true&quot;_s;
143             else
144                 computedProperties.checked = &quot;false&quot;_s;
145         }
146 
147         switch (axObject-&gt;currentState()) {
148         case AccessibilityCurrentState::False:
149             computedProperties.currentState = &quot;false&quot;_s;
</pre>
<hr />
<pre>
230             computedProperties.readonly = !axObject-&gt;canSetValueAttribute();
231 
232         if (axObject-&gt;supportsRequiredAttribute())
233             computedProperties.required = axObject-&gt;isRequired();
234 
235         computedProperties.role = axObject-&gt;computedRoleString();
236         computedProperties.selected = axObject-&gt;isSelected();
237 
238         result = computedProperties;
239     }
240 
241     return result;
242 }
243 
244 ExceptionOr&lt;Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt;&gt; InspectorAuditAccessibilityObject::getControlledNodes(Node&amp; node)
245 {
246     ERROR_IF_NO_ACTIVE_AUDIT();
247 
248     Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
249 
<span class="line-modified">250     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
251         Vector&lt;RefPtr&lt;Node&gt;&gt; controlledNodes;
252 
253         Vector&lt;Element*&gt; controlledElements;
254         axObject-&gt;elementsFromAttribute(controlledElements, HTMLNames::aria_controlsAttr);
255         for (Element* controlledElement : controlledElements) {
256             if (controlledElement)
257                 controlledNodes.append(controlledElement);
258         }
259 
260         result = WTFMove(controlledNodes);
261     }
262 
263     return result;
264 }
265 
266 ExceptionOr&lt;Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt;&gt; InspectorAuditAccessibilityObject::getFlowedNodes(Node&amp; node)
267 {
268     ERROR_IF_NO_ACTIVE_AUDIT();
269 
270     Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
271 
<span class="line-modified">272     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
273         Vector&lt;RefPtr&lt;Node&gt;&gt; flowedNodes;
274 
275         Vector&lt;Element*&gt; flowedElements;
276         axObject-&gt;elementsFromAttribute(flowedElements, HTMLNames::aria_flowtoAttr);
277         for (Element* flowedElement : flowedElements) {
278             if (flowedElement)
279                 flowedNodes.append(flowedElement);
280         }
281 
282         result = WTFMove(flowedNodes);
283     }
284 
285     return result;
286 }
287 
288 ExceptionOr&lt;RefPtr&lt;Node&gt;&gt; InspectorAuditAccessibilityObject::getMouseEventNode(Node&amp; node)
289 {
290     ERROR_IF_NO_ACTIVE_AUDIT();
291 
<span class="line-modified">292     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
293         if (is&lt;AccessibilityNodeObject&gt;(axObject))
294             return downcast&lt;AccessibilityNodeObject&gt;(axObject)-&gt;mouseButtonListener(MouseButtonListenerResultFilter::IncludeBodyElement);
295     }
296 
297     return nullptr;
298 }
299 
300 ExceptionOr&lt;Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt;&gt; InspectorAuditAccessibilityObject::getOwnedNodes(Node&amp; node)
301 {
302     ERROR_IF_NO_ACTIVE_AUDIT();
303 
304     Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
305 
<span class="line-modified">306     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
307         if (axObject-&gt;supportsARIAOwns()) {
308             Vector&lt;RefPtr&lt;Node&gt;&gt; ownedNodes;
309 
310             Vector&lt;Element*&gt; ownedElements;
311             axObject-&gt;elementsFromAttribute(ownedElements, HTMLNames::aria_ownsAttr);
312             for (Element* ownedElement : ownedElements) {
313                 if (ownedElement)
314                     ownedNodes.append(ownedElement);
315             }
316 
317             result = WTFMove(ownedNodes);
318         }
319     }
320 
321     return result;
322 }
323 
324 ExceptionOr&lt;RefPtr&lt;Node&gt;&gt; InspectorAuditAccessibilityObject::getParentNode(Node&amp; node)
325 {
326     ERROR_IF_NO_ACTIVE_AUDIT();
327 
<span class="line-modified">328     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
<span class="line-modified">329         if (AccessibilityObject* parentObject = axObject-&gt;parentObjectUnignored())</span>
330             return parentObject-&gt;node();
331     }
332 
333     return nullptr;
334 }
335 
336 ExceptionOr&lt;Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt;&gt; InspectorAuditAccessibilityObject::getSelectedChildNodes(Node&amp; node)
337 {
338     ERROR_IF_NO_ACTIVE_AUDIT();
339 
340     Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
341 
<span class="line-modified">342     if (AccessibilityObject* axObject = accessiblityObjectForNode(node)) {</span>
343         Vector&lt;RefPtr&lt;Node&gt;&gt; selectedChildNodes;
344 
<span class="line-modified">345         AccessibilityObject::AccessibilityChildrenVector selectedChildren;</span>
346         axObject-&gt;selectedChildren(selectedChildren);
<span class="line-modified">347         for (RefPtr&lt;AccessibilityObject&gt;&amp; selectedChildObject : selectedChildren) {</span>
348             if (Node* selectedChildNode = selectedChildObject-&gt;node())
349                 selectedChildNodes.append(selectedChildNode);
350         }
351 
352         result = WTFMove(selectedChildNodes);
353     }
354 
355     return result;
356 }
357 
358 } // namespace WebCore
</pre>
</td>
<td>
<hr />
<pre>
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 14  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 15  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 17  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 18  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 19  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 20  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 21  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 23  * THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 
 27 #include &quot;config.h&quot;
 28 #include &quot;InspectorAuditAccessibilityObject.h&quot;
 29 
 30 #include &quot;AXObjectCache.h&quot;
 31 #include &quot;AccessibilityNodeObject.h&quot;
<span class="line-modified"> 32 #include &quot;AccessibilityObjectInterface.h&quot;</span>
 33 #include &quot;ContainerNode.h&quot;
 34 #include &quot;Document.h&quot;
 35 #include &quot;Element.h&quot;
 36 #include &quot;ElementDescendantIterator.h&quot;
 37 #include &quot;HTMLNames.h&quot;
 38 #include &quot;Node.h&quot;
 39 #include &quot;SpaceSplitString.h&quot;
 40 #include &lt;wtf/Vector.h&gt;
 41 #include &lt;wtf/text/WTFString.h&gt;
 42 
 43 namespace WebCore {
 44 
 45 using namespace Inspector;
 46 
 47 #define ERROR_IF_NO_ACTIVE_AUDIT() \
 48     if (!m_auditAgent.hasActiveAudit()) \
 49         return Exception { NotAllowedError, &quot;Cannot be called outside of a Web Inspector Audit&quot;_s };
 50 
 51 InspectorAuditAccessibilityObject::InspectorAuditAccessibilityObject(InspectorAuditAgent&amp; auditAgent)
 52     : m_auditAgent(auditAgent)
 53 {
 54 }
 55 
<span class="line-modified"> 56 static AXCoreObject* accessiblityObjectForNode(Node&amp; node)</span>
 57 {
 58     if (!AXObjectCache::accessibilityEnabled())
 59         AXObjectCache::enableAccessibility();
 60 
 61     if (AXObjectCache* axObjectCache = node.document().axObjectCache())
 62         return axObjectCache-&gt;getOrCreate(&amp;node);
 63 
 64     return nullptr;
 65 }
 66 
 67 ExceptionOr&lt;Vector&lt;Ref&lt;Node&gt;&gt;&gt; InspectorAuditAccessibilityObject::getElementsByComputedRole(Document&amp; document, const String&amp; role, Node* container)
 68 {
 69     ERROR_IF_NO_ACTIVE_AUDIT();
 70 
 71     Vector&lt;Ref&lt;Node&gt;&gt; nodes;
 72 
 73     for (Element&amp; element : elementDescendants(is&lt;ContainerNode&gt;(container) ? downcast&lt;ContainerNode&gt;(*container) : document)) {
<span class="line-modified"> 74         if (AXCoreObject* axObject = accessiblityObjectForNode(element)) {</span>
 75             if (axObject-&gt;computedRoleString() == role)
 76                 nodes.append(element);
 77         }
 78     }
 79 
 80     return nodes;
 81 }
 82 
 83 ExceptionOr&lt;RefPtr&lt;Node&gt;&gt; InspectorAuditAccessibilityObject::getActiveDescendant(Node&amp; node)
 84 {
 85     ERROR_IF_NO_ACTIVE_AUDIT();
 86 
<span class="line-modified"> 87     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
<span class="line-modified"> 88         if (AXCoreObject* activeDescendant = axObject-&gt;activeDescendant())</span>
 89             return activeDescendant-&gt;node();
 90     }
 91 
 92     return nullptr;
 93 }
 94 
<span class="line-modified"> 95 static void addChildren(AXCoreObject&amp; parentObject, Vector&lt;RefPtr&lt;Node&gt;&gt;&amp; childNodes)</span>
 96 {
<span class="line-modified"> 97     for (const auto&amp; childObject : parentObject.children()) {</span>
 98         if (Node* childNode = childObject-&gt;node())
 99             childNodes.append(childNode);
100         else
101             addChildren(*childObject, childNodes);
102     }
103 }
104 
105 ExceptionOr&lt;Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt;&gt; InspectorAuditAccessibilityObject::getChildNodes(Node&amp; node)
106 {
107     ERROR_IF_NO_ACTIVE_AUDIT();
108 
109     Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
110 
<span class="line-modified">111     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
112         Vector&lt;RefPtr&lt;Node&gt;&gt; childNodes;
113         addChildren(*axObject, childNodes);
114         result = WTFMove(childNodes);
115     }
116 
117     return result;
118 }
119 
120 ExceptionOr&lt;Optional&lt;InspectorAuditAccessibilityObject::ComputedProperties&gt;&gt; InspectorAuditAccessibilityObject::getComputedProperties(Node&amp; node)
121 {
122     ERROR_IF_NO_ACTIVE_AUDIT();
123 
124     Optional&lt;InspectorAuditAccessibilityObject::ComputedProperties&gt; result;
125 
<span class="line-modified">126     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
127         ComputedProperties computedProperties;
128 
<span class="line-modified">129         AXCoreObject* current = axObject;</span>
130         while (current &amp;&amp; (!computedProperties.busy || !computedProperties.busy.value())) {
131             computedProperties.busy = current-&gt;isBusy();
132             current = current-&gt;parentObject();
133         }
134 
135         if (axObject-&gt;supportsChecked()) {
136             AccessibilityButtonState checkValue = axObject-&gt;checkboxOrRadioValue();
137             if (checkValue == AccessibilityButtonState::On)
138                 computedProperties.checked = &quot;true&quot;_s;
139             else if (checkValue == AccessibilityButtonState::Mixed)
140                 computedProperties.checked = &quot;mixed&quot;_s;
141             else if (axObject-&gt;isChecked())
142                 computedProperties.checked = &quot;true&quot;_s;
143             else
144                 computedProperties.checked = &quot;false&quot;_s;
145         }
146 
147         switch (axObject-&gt;currentState()) {
148         case AccessibilityCurrentState::False:
149             computedProperties.currentState = &quot;false&quot;_s;
</pre>
<hr />
<pre>
230             computedProperties.readonly = !axObject-&gt;canSetValueAttribute();
231 
232         if (axObject-&gt;supportsRequiredAttribute())
233             computedProperties.required = axObject-&gt;isRequired();
234 
235         computedProperties.role = axObject-&gt;computedRoleString();
236         computedProperties.selected = axObject-&gt;isSelected();
237 
238         result = computedProperties;
239     }
240 
241     return result;
242 }
243 
244 ExceptionOr&lt;Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt;&gt; InspectorAuditAccessibilityObject::getControlledNodes(Node&amp; node)
245 {
246     ERROR_IF_NO_ACTIVE_AUDIT();
247 
248     Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
249 
<span class="line-modified">250     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
251         Vector&lt;RefPtr&lt;Node&gt;&gt; controlledNodes;
252 
253         Vector&lt;Element*&gt; controlledElements;
254         axObject-&gt;elementsFromAttribute(controlledElements, HTMLNames::aria_controlsAttr);
255         for (Element* controlledElement : controlledElements) {
256             if (controlledElement)
257                 controlledNodes.append(controlledElement);
258         }
259 
260         result = WTFMove(controlledNodes);
261     }
262 
263     return result;
264 }
265 
266 ExceptionOr&lt;Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt;&gt; InspectorAuditAccessibilityObject::getFlowedNodes(Node&amp; node)
267 {
268     ERROR_IF_NO_ACTIVE_AUDIT();
269 
270     Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
271 
<span class="line-modified">272     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
273         Vector&lt;RefPtr&lt;Node&gt;&gt; flowedNodes;
274 
275         Vector&lt;Element*&gt; flowedElements;
276         axObject-&gt;elementsFromAttribute(flowedElements, HTMLNames::aria_flowtoAttr);
277         for (Element* flowedElement : flowedElements) {
278             if (flowedElement)
279                 flowedNodes.append(flowedElement);
280         }
281 
282         result = WTFMove(flowedNodes);
283     }
284 
285     return result;
286 }
287 
288 ExceptionOr&lt;RefPtr&lt;Node&gt;&gt; InspectorAuditAccessibilityObject::getMouseEventNode(Node&amp; node)
289 {
290     ERROR_IF_NO_ACTIVE_AUDIT();
291 
<span class="line-modified">292     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
293         if (is&lt;AccessibilityNodeObject&gt;(axObject))
294             return downcast&lt;AccessibilityNodeObject&gt;(axObject)-&gt;mouseButtonListener(MouseButtonListenerResultFilter::IncludeBodyElement);
295     }
296 
297     return nullptr;
298 }
299 
300 ExceptionOr&lt;Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt;&gt; InspectorAuditAccessibilityObject::getOwnedNodes(Node&amp; node)
301 {
302     ERROR_IF_NO_ACTIVE_AUDIT();
303 
304     Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
305 
<span class="line-modified">306     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
307         if (axObject-&gt;supportsARIAOwns()) {
308             Vector&lt;RefPtr&lt;Node&gt;&gt; ownedNodes;
309 
310             Vector&lt;Element*&gt; ownedElements;
311             axObject-&gt;elementsFromAttribute(ownedElements, HTMLNames::aria_ownsAttr);
312             for (Element* ownedElement : ownedElements) {
313                 if (ownedElement)
314                     ownedNodes.append(ownedElement);
315             }
316 
317             result = WTFMove(ownedNodes);
318         }
319     }
320 
321     return result;
322 }
323 
324 ExceptionOr&lt;RefPtr&lt;Node&gt;&gt; InspectorAuditAccessibilityObject::getParentNode(Node&amp; node)
325 {
326     ERROR_IF_NO_ACTIVE_AUDIT();
327 
<span class="line-modified">328     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
<span class="line-modified">329         if (AXCoreObject* parentObject = axObject-&gt;parentObjectUnignored())</span>
330             return parentObject-&gt;node();
331     }
332 
333     return nullptr;
334 }
335 
336 ExceptionOr&lt;Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt;&gt; InspectorAuditAccessibilityObject::getSelectedChildNodes(Node&amp; node)
337 {
338     ERROR_IF_NO_ACTIVE_AUDIT();
339 
340     Optional&lt;Vector&lt;RefPtr&lt;Node&gt;&gt;&gt; result;
341 
<span class="line-modified">342     if (AXCoreObject* axObject = accessiblityObjectForNode(node)) {</span>
343         Vector&lt;RefPtr&lt;Node&gt;&gt; selectedChildNodes;
344 
<span class="line-modified">345         AXCoreObject::AccessibilityChildrenVector selectedChildren;</span>
346         axObject-&gt;selectedChildren(selectedChildren);
<span class="line-modified">347         for (auto&amp; selectedChildObject : selectedChildren) {</span>
348             if (Node* selectedChildNode = selectedChildObject-&gt;node())
349                 selectedChildNodes.append(selectedChildNode);
350         }
351 
352         result = WTFMove(selectedChildNodes);
353     }
354 
355     return result;
356 }
357 
358 } // namespace WebCore
</pre>
</td>
</tr>
</table>
<center><a href="DOMPatchSupport.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InspectorCanvas.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>