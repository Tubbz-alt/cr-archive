<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/displaylists/DisplayListRecorder.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DisplayListItems.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="DisplayListRecorder.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/displaylists/DisplayListRecorder.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -60,11 +60,11 @@</span>
          GraphicsContextStateChange&amp; stateChanges = currentState().stateChange;
          GraphicsContextState::StateChangeFlags changesFromLastState = stateChanges.changesFromState(currentState().lastDrawingState);
          if (changesFromLastState) {
              LOG_WITH_STREAM(DisplayLists, stream &lt;&lt; &quot;pre-drawing, saving state &quot; &lt;&lt; GraphicsContextStateChange(stateChanges.m_state, changesFromLastState));
              m_displayList.append(SetState::create(stateChanges.m_state, changesFromLastState));
<span class="udiff-line-modified-removed">-             stateChanges.m_changeFlags = 0;</span>
<span class="udiff-line-modified-added">+             stateChanges.m_changeFlags = { };</span>
              currentState().lastDrawingState = stateChanges.m_state;
          }
          currentState().wasUsedForDrawing = true;
      }
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -194,19 +194,20 @@</span>
  {
      currentState().concatCTM(transform);
      appendItem(ConcatenateCTM::create(transform));
  }
  
<span class="udiff-line-modified-removed">- void Recorder::setCTM(const AffineTransform&amp;)</span>
<span class="udiff-line-modified-added">+ void Recorder::setCTM(const AffineTransform&amp; transform)</span>
  {
<span class="udiff-line-modified-removed">-     WTFLogAlways(&quot;GraphicsContext::setCTM() is not compatible with DisplayList::Recorder.&quot;);</span>
<span class="udiff-line-modified-added">+     currentState().setCTM(transform);</span>
<span class="udiff-line-added">+     appendItem(SetCTM::create(transform));</span>
  }
  
  AffineTransform Recorder::getCTM(GraphicsContext::IncludeDeviceScale)
  {
<span class="udiff-line-modified-removed">-     WTFLogAlways(&quot;GraphicsContext::getCTM() is not yet compatible with DisplayList::Recorder.&quot;);</span>
<span class="udiff-line-modified-removed">-     return { };</span>
<span class="udiff-line-modified-added">+     // FIXME: Respect the given value of IncludeDeviceScale.</span>
<span class="udiff-line-modified-added">+     return currentState().ctm;</span>
  }
  
  void Recorder::beginTransparencyLayer(float opacity)
  {
      DrawingItem&amp; newItem = downcast&lt;DrawingItem&gt;(appendItem(BeginTransparencyLayer::create(opacity)));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -481,10 +482,22 @@</span>
  {
      ctm.scale(size);
      clipBounds.scale(1 / size.width(), 1 / size.height());
  }
  
<span class="udiff-line-added">+ void Recorder::ContextState::setCTM(const AffineTransform&amp; matrix)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     Optional&lt;AffineTransform&gt; inverseTransformForClipBounds;</span>
<span class="udiff-line-added">+     if (auto originalCTMInverse = ctm.inverse())</span>
<span class="udiff-line-added">+         inverseTransformForClipBounds = originalCTMInverse-&gt;multiply(matrix).inverse();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     ctm = matrix;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if (inverseTransformForClipBounds)</span>
<span class="udiff-line-added">+         clipBounds = inverseTransformForClipBounds-&gt;mapRect(clipBounds);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  void Recorder::ContextState::concatCTM(const AffineTransform&amp; matrix)
  {
      ctm *= matrix;
  
      if (Optional&lt;AffineTransform&gt; inverse = matrix.inverse())
</pre>
<center><a href="DisplayListItems.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="DisplayListRecorder.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>