<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/rendering/RenderLineBreak.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="RenderLayoutState.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RenderLineBreak.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/rendering/RenderLineBreak.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -25,15 +25,15 @@</span>
  #include &quot;Document.h&quot;
  #include &quot;FontMetrics.h&quot;
  #include &quot;HTMLElement.h&quot;
  #include &quot;HTMLWBRElement.h&quot;
  #include &quot;InlineElementBox.h&quot;
<span class="udiff-line-added">+ #include &quot;LineLayoutTraversal.h&quot;</span>
  #include &quot;LogicalSelectionOffsetCaches.h&quot;
  #include &quot;RenderBlock.h&quot;
  #include &quot;RenderView.h&quot;
  #include &quot;RootInlineBox.h&quot;
<span class="udiff-line-removed">- #include &quot;SimpleLineLayoutFunctions.h&quot;</span>
  #include &quot;VisiblePosition.h&quot;
  #include &lt;wtf/IsoMallocInlines.h&gt;
  
  #if PLATFORM(IOS_FAMILY)
  #include &quot;SelectionRect.h&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -43,17 +43,10 @@</span>
  
  WTF_MAKE_ISO_ALLOCATED_IMPL(RenderLineBreak);
  
  static const int invalidLineHeight = -1;
  
<span class="udiff-line-removed">- static const SimpleLineLayout::Layout* simpleLineLayout(const RenderLineBreak&amp; renderer)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     if (!is&lt;RenderBlockFlow&gt;(*renderer.parent()))</span>
<span class="udiff-line-removed">-         return nullptr;</span>
<span class="udiff-line-removed">-     return downcast&lt;RenderBlockFlow&gt;(*renderer.parent()).simpleLineLayout();</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  RenderLineBreak::RenderLineBreak(HTMLElement&amp; element, RenderStyle&amp;&amp; style)
      : RenderBoxModelObject(element, WTFMove(style), 0)
      , m_inlineBoxWrapper(nullptr)
      , m_cachedLineHeight(invalidLineHeight)
      , m_isWBR(is&lt;HTMLWBRElement&gt;(element))
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -131,16 +124,10 @@</span>
      if (!is&lt;RenderBlockFlow&gt;(*parent()))
          return;
      downcast&lt;RenderBlockFlow&gt;(*parent()).ensureLineBoxes();
  }
  
<span class="udiff-line-removed">- void RenderLineBreak::deleteLineBoxesBeforeSimpleLineLayout()</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     delete m_inlineBoxWrapper;</span>
<span class="udiff-line-removed">-     m_inlineBoxWrapper = nullptr;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  int RenderLineBreak::caretMinOffset() const
  {
      return 0;
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -181,49 +168,57 @@</span>
      return rootBox.computeCaretRect(inlineBox-&gt;logicalLeft(), caretWidth, extraWidthToEndOfLine);
  }
  
  IntRect RenderLineBreak::linesBoundingBox() const
  {
<span class="udiff-line-modified-removed">-     if (auto* layout = simpleLineLayout(*this))</span>
<span class="udiff-line-modified-removed">-         return SimpleLineLayout::computeBoundingBox(*this, *layout);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-removed">-     if (!m_inlineBoxWrapper)</span>
<span class="udiff-line-removed">-         return IntRect();</span>
<span class="udiff-line-modified-added">+     auto box = LineLayoutTraversal::elementBoxFor(*this);</span>
<span class="udiff-line-modified-added">+     if (!box)</span>
<span class="udiff-line-modified-added">+         return { };</span>
  
<span class="udiff-line-modified-removed">-     float logicalLeftSide = m_inlineBoxWrapper-&gt;logicalLeft();</span>
<span class="udiff-line-modified-removed">-     float logicalRightSide = m_inlineBoxWrapper-&gt;logicalRight();</span>
<span class="udiff-line-modified-added">+     return enclosingIntRect(box-&gt;rect());</span>
<span class="udiff-line-modified-added">+ }</span>
  
<span class="udiff-line-modified-removed">-     bool isHorizontal = style().isHorizontalWritingMode();</span>
<span class="udiff-line-modified-added">+ IntRect RenderLineBreak::boundingBoxForRenderTreeDump() const</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     auto box = LineLayoutTraversal::elementBoxFor(*this);</span>
<span class="udiff-line-added">+     if (!box)</span>
<span class="udiff-line-added">+         return { };</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     auto rect = box-&gt;rect();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     // FIXME: Remove and rebase the tests.</span>
<span class="udiff-line-added">+     bool inQuirksMode = !document().inNoQuirksMode();</span>
<span class="udiff-line-added">+     if (inQuirksMode &amp;&amp; !isWBR() &amp;&amp; box-&gt;useLineBreakBoxRenderTreeDumpQuirk()) {</span>
<span class="udiff-line-added">+         if (!box-&gt;isHorizontal()) {</span>
<span class="udiff-line-added">+             auto baseline = style().isFlippedBlocksWritingMode() ? rect.x() + box-&gt;baselineOffset() : rect.maxX() - box-&gt;baselineOffset();</span>
<span class="udiff-line-added">+             return enclosingIntRect(FloatRect(FloatPoint(baseline, rect.y()), FloatSize(0, rect.height())));</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         auto baseline = rect.y() + box-&gt;baselineOffset();</span>
<span class="udiff-line-added">+         return enclosingIntRect(FloatRect(FloatPoint(rect.x(), baseline), FloatSize(rect.width(), 0)));</span>
<span class="udiff-line-added">+     }</span>
  
<span class="udiff-line-modified-removed">-     float x = isHorizontal ? logicalLeftSide : m_inlineBoxWrapper-&gt;x();</span>
<span class="udiff-line-removed">-     float y = isHorizontal ? m_inlineBoxWrapper-&gt;y() : logicalLeftSide;</span>
<span class="udiff-line-removed">-     float width = isHorizontal ? logicalRightSide - logicalLeftSide : m_inlineBoxWrapper-&gt;logicalBottom() - x;</span>
<span class="udiff-line-removed">-     float height = isHorizontal ? m_inlineBoxWrapper-&gt;logicalBottom() - y : logicalRightSide - logicalLeftSide;</span>
<span class="udiff-line-removed">-     return enclosingIntRect(FloatRect(x, y, width, height));</span>
<span class="udiff-line-modified-added">+     return enclosingIntRect(rect);</span>
  }
  
  void RenderLineBreak::absoluteRects(Vector&lt;IntRect&gt;&amp; rects, const LayoutPoint&amp; accumulatedOffset) const
  {
<span class="udiff-line-modified-removed">-     if (auto* layout = simpleLineLayout(*this)) {</span>
<span class="udiff-line-modified-removed">-         rects.appendVector(SimpleLineLayout::collectAbsoluteRects(*this, *layout, accumulatedOffset));</span>
<span class="udiff-line-modified-added">+     auto box = LineLayoutTraversal::elementBoxFor(*this);</span>
<span class="udiff-line-modified-added">+     if (!box)</span>
          return;
<span class="udiff-line-removed">-     }</span>
  
<span class="udiff-line-modified-removed">-     if (!m_inlineBoxWrapper)</span>
<span class="udiff-line-modified-removed">-         return;</span>
<span class="udiff-line-removed">-     rects.append(enclosingIntRect(FloatRect(accumulatedOffset + m_inlineBoxWrapper-&gt;topLeft(), m_inlineBoxWrapper-&gt;size())));</span>
<span class="udiff-line-modified-added">+     auto rect = box-&gt;rect();</span>
<span class="udiff-line-modified-added">+     rects.append(enclosingIntRect(FloatRect(accumulatedOffset + rect.location(), rect.size())));</span>
  }
  
  void RenderLineBreak::absoluteQuads(Vector&lt;FloatQuad&gt;&amp; quads, bool* wasFixed) const
  {
<span class="udiff-line-modified-removed">-     if (auto* layout = simpleLineLayout(*this)) {</span>
<span class="udiff-line-modified-removed">-         quads.appendVector(SimpleLineLayout::collectAbsoluteQuads(*this, *layout, wasFixed));</span>
<span class="udiff-line-removed">-         return;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     if (!m_inlineBoxWrapper)</span>
<span class="udiff-line-modified-added">+     auto box = LineLayoutTraversal::elementBoxFor(*this);</span>
<span class="udiff-line-modified-added">+     if (!box)</span>
          return;
<span class="udiff-line-modified-removed">-     quads.append(localToAbsoluteQuad(FloatRect(m_inlineBoxWrapper-&gt;topLeft(), m_inlineBoxWrapper-&gt;size()), UseTransforms, wasFixed));</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+     auto rect = box-&gt;rect();</span>
<span class="udiff-line-added">+     quads.append(localToAbsoluteQuad(FloatRect(rect.location(), rect.size()), UseTransforms, wasFixed));</span>
  }
  
  void RenderLineBreak::updateFromStyle()
  {
      m_cachedLineHeight = invalidLineHeight;
</pre>
<center><a href="RenderLayoutState.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RenderLineBreak.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>