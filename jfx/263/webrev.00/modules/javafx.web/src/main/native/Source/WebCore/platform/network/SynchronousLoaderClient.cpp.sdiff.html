<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/platform/network/SynchronousLoaderClient.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="StoredCredentialsPolicy.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="SynchronousLoaderClient.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/network/SynchronousLoaderClient.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 16  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 17  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 18  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 19  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 20  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 21  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 23  * THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;SynchronousLoaderClient.h&quot;
 28 
 29 #include &quot;AuthenticationChallenge.h&quot;
 30 #include &quot;ResourceHandle.h&quot;
 31 #include &quot;ResourceRequest.h&quot;
 32 #include &lt;wtf/CompletionHandler.h&gt;
 33 
 34 namespace WebCore {
 35 



 36 SynchronousLoaderClient::~SynchronousLoaderClient() = default;
 37 
 38 void SynchronousLoaderClient::willSendRequestAsync(ResourceHandle* handle, ResourceRequest&amp;&amp; request, ResourceResponse&amp;&amp;, CompletionHandler&lt;void(ResourceRequest&amp;&amp;)&gt;&amp;&amp; completionHandler)
 39 {
 40     // FIXME: This needs to be fixed to follow the redirect correctly even for cross-domain requests.
 41     if (protocolHostAndPortAreEqual(handle-&gt;firstRequest().url(), request.url())) {
 42         completionHandler(WTFMove(request));
 43         return;
 44     }
 45 
 46     ASSERT(m_error.isNull());
 47     m_error = platformBadResponseError();
 48     completionHandler({ });
 49 }
 50 
 51 bool SynchronousLoaderClient::shouldUseCredentialStorage(ResourceHandle*)
 52 {
 53     // FIXME: We should ask FrameLoaderClient whether using credential storage is globally forbidden.
 54     return m_allowStoredCredentials;
 55 }
 56 
 57 #if USE(PROTECTION_SPACE_AUTH_CALLBACK)
 58 void SynchronousLoaderClient::canAuthenticateAgainstProtectionSpaceAsync(ResourceHandle*, const ProtectionSpace&amp;, CompletionHandler&lt;void(bool)&gt;&amp;&amp; completionHandler)
 59 {
 60     // FIXME: We should ask FrameLoaderClient. &lt;http://webkit.org/b/65196&gt;
 61     completionHandler(true);
 62 }
 63 #endif
 64 
 65 void SynchronousLoaderClient::didReceiveResponseAsync(ResourceHandle*, ResourceResponse&amp;&amp; response, CompletionHandler&lt;void()&gt;&amp;&amp; completionHandler)
 66 {
 67     m_response = WTFMove(response);
 68     completionHandler();
 69 }
 70 
 71 void SynchronousLoaderClient::didReceiveData(ResourceHandle*, const char* data, unsigned length, int /*encodedDataLength*/)
 72 {
 73     m_data.append(data, length);
 74 }
 75 
<span class="line-modified"> 76 void SynchronousLoaderClient::didFinishLoading(ResourceHandle*)</span>
 77 {
<span class="line-modified"> 78     m_messageQueue.kill();</span>






 79 }
 80 
<span class="line-modified"> 81 void SynchronousLoaderClient::didFail(ResourceHandle*, const ResourceError&amp; error)</span>
 82 {
 83     ASSERT(m_error.isNull());
 84 
 85     m_error = error;
 86 
<span class="line-modified"> 87     m_messageQueue.kill();</span>






 88 }
 89 
 90 }
</pre>
</td>
<td>
<hr />
<pre>
 16  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 17  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 18  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 19  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 20  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 21  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 23  * THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;SynchronousLoaderClient.h&quot;
 28 
 29 #include &quot;AuthenticationChallenge.h&quot;
 30 #include &quot;ResourceHandle.h&quot;
 31 #include &quot;ResourceRequest.h&quot;
 32 #include &lt;wtf/CompletionHandler.h&gt;
 33 
 34 namespace WebCore {
 35 
<span class="line-added"> 36 SynchronousLoaderClient::SynchronousLoaderClient()</span>
<span class="line-added"> 37     : m_messageQueue(SynchronousLoaderMessageQueue::create()) { }</span>
<span class="line-added"> 38 </span>
 39 SynchronousLoaderClient::~SynchronousLoaderClient() = default;
 40 
 41 void SynchronousLoaderClient::willSendRequestAsync(ResourceHandle* handle, ResourceRequest&amp;&amp; request, ResourceResponse&amp;&amp;, CompletionHandler&lt;void(ResourceRequest&amp;&amp;)&gt;&amp;&amp; completionHandler)
 42 {
 43     // FIXME: This needs to be fixed to follow the redirect correctly even for cross-domain requests.
 44     if (protocolHostAndPortAreEqual(handle-&gt;firstRequest().url(), request.url())) {
 45         completionHandler(WTFMove(request));
 46         return;
 47     }
 48 
 49     ASSERT(m_error.isNull());
 50     m_error = platformBadResponseError();
 51     completionHandler({ });
 52 }
 53 
 54 bool SynchronousLoaderClient::shouldUseCredentialStorage(ResourceHandle*)
 55 {
 56     // FIXME: We should ask FrameLoaderClient whether using credential storage is globally forbidden.
 57     return m_allowStoredCredentials;
 58 }
 59 
 60 #if USE(PROTECTION_SPACE_AUTH_CALLBACK)
 61 void SynchronousLoaderClient::canAuthenticateAgainstProtectionSpaceAsync(ResourceHandle*, const ProtectionSpace&amp;, CompletionHandler&lt;void(bool)&gt;&amp;&amp; completionHandler)
 62 {
 63     // FIXME: We should ask FrameLoaderClient. &lt;http://webkit.org/b/65196&gt;
 64     completionHandler(true);
 65 }
 66 #endif
 67 
 68 void SynchronousLoaderClient::didReceiveResponseAsync(ResourceHandle*, ResourceResponse&amp;&amp; response, CompletionHandler&lt;void()&gt;&amp;&amp; completionHandler)
 69 {
 70     m_response = WTFMove(response);
 71     completionHandler();
 72 }
 73 
 74 void SynchronousLoaderClient::didReceiveData(ResourceHandle*, const char* data, unsigned length, int /*encodedDataLength*/)
 75 {
 76     m_data.append(data, length);
 77 }
 78 
<span class="line-modified"> 79 void SynchronousLoaderClient::didFinishLoading(ResourceHandle* handle)</span>
 80 {
<span class="line-modified"> 81     m_messageQueue-&gt;kill();</span>
<span class="line-added"> 82 #if PLATFORM(COCOA)</span>
<span class="line-added"> 83     if (handle)</span>
<span class="line-added"> 84         handle-&gt;releaseDelegate();</span>
<span class="line-added"> 85 #else</span>
<span class="line-added"> 86     UNUSED_PARAM(handle);</span>
<span class="line-added"> 87 #endif</span>
 88 }
 89 
<span class="line-modified"> 90 void SynchronousLoaderClient::didFail(ResourceHandle* handle, const ResourceError&amp; error)</span>
 91 {
 92     ASSERT(m_error.isNull());
 93 
 94     m_error = error;
 95 
<span class="line-modified"> 96     m_messageQueue-&gt;kill();</span>
<span class="line-added"> 97 #if PLATFORM(COCOA)</span>
<span class="line-added"> 98     if (handle)</span>
<span class="line-added"> 99         handle-&gt;releaseDelegate();</span>
<span class="line-added">100 #else</span>
<span class="line-added">101     UNUSED_PARAM(handle);</span>
<span class="line-added">102 #endif</span>
103 }
104 
105 }
</pre>
</td>
</tr>
</table>
<center><a href="StoredCredentialsPolicy.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="SynchronousLoaderClient.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>