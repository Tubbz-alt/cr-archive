<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/JavaScriptCore/dfg/DFGCombinedLiveness.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2015-2018 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;DFGCombinedLiveness.h&quot;
 28 
 29 #if ENABLE(DFG_JIT)
 30 
 31 #include &quot;DFGAvailabilityMap.h&quot;
 32 #include &quot;DFGBlockMapInlines.h&quot;
 33 #include &quot;FullBytecodeLiveness.h&quot;
 34 #include &quot;JSCInlines.h&quot;
 35 
 36 namespace JSC { namespace DFG {
 37 
 38 static void addBytecodeLiveness(Graph&amp; graph, AvailabilityMap&amp; availabilityMap, NodeSet&amp; seen, Node* node)
 39 {
 40     graph.forAllLiveInBytecode(
 41         node-&gt;origin.forExit,
<a name="1" id="anc1"></a><span class="line-modified"> 42         [&amp;] (VirtualRegister reg) {</span>
 43             availabilityMap.closeStartingWithLocal(
 44                 reg,
 45                 [&amp;] (Node* node) -&gt; bool {
 46                     return seen.contains(node);
 47                 },
 48                 [&amp;] (Node* node) -&gt; bool {
 49                     return seen.add(node).isNewEntry;
 50                 });
 51         });
 52 }
 53 
 54 NodeSet liveNodesAtHead(Graph&amp; graph, BasicBlock* block)
 55 {
 56     NodeSet seen;
 57     for (NodeFlowProjection node : block-&gt;ssa-&gt;liveAtHead) {
 58         if (node.kind() == NodeFlowProjection::Primary)
 59             seen.addVoid(node.node());
 60     }
 61 
 62     addBytecodeLiveness(graph, block-&gt;ssa-&gt;availabilityAtHead, seen, block-&gt;at(0));
 63     return seen;
 64 }
 65 
 66 CombinedLiveness::CombinedLiveness(Graph&amp; graph)
 67     : liveAtHead(graph)
 68     , liveAtTail(graph)
 69 {
 70     // First compute
 71     // - The liveAtHead for each block.
 72     // - The liveAtTail for blocks that won&#39;t properly propagate
 73     //   the information based on their empty successor list.
 74     for (BasicBlock* block : graph.blocksInNaturalOrder()) {
 75         liveAtHead[block] = liveNodesAtHead(graph, block);
 76 
 77         // If we don&#39;t have successors, we can&#39;t rely on the propagation below. This doesn&#39;t usually
 78         // do anything for terminal blocks, since the last node is usually a return, so nothing is live
 79         // after it. However, we may also have the end of the basic block be:
 80         //
 81         // ForceOSRExit
 82         // Unreachable
 83         //
 84         // And things may definitely be live in bytecode at that point in the program.
 85         if (!block-&gt;numSuccessors()) {
 86             NodeSet seen;
 87             addBytecodeLiveness(graph, block-&gt;ssa-&gt;availabilityAtTail, seen, block-&gt;last());
 88             liveAtTail[block] = seen;
 89         }
 90     }
 91 
 92     // Now compute the liveAtTail by unifying the liveAtHead of the successors.
 93     for (BasicBlock* block : graph.blocksInNaturalOrder()) {
 94         for (BasicBlock* successor : block-&gt;successors()) {
 95             for (Node* node : liveAtHead[successor])
 96                 liveAtTail[block].addVoid(node);
 97         }
 98     }
 99 }
100 
101 } } // namespace JSC::DFG
102 
103 #endif // ENABLE(DFG_JIT)
104 
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>