<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/jit/RegisterSet.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="RegisterAtOffsetList.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RegisterSet.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/jit/RegisterSet.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (C) 2013-2017 Apple Inc. All rights reserved.</span>
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
</pre>
<hr />
<pre>
 44         MacroAssembler::framePointerRegister);
 45 }
 46 
 47 RegisterSet RegisterSet::reservedHardwareRegisters()
 48 {
 49     RegisterSet result;
 50 
 51 #define SET_IF_RESERVED(id, name, isReserved, isCalleeSaved)    \
 52     if (isReserved)                                             \
 53         result.set(RegisterNames::id);
 54     FOR_EACH_GP_REGISTER(SET_IF_RESERVED)
 55     FOR_EACH_FP_REGISTER(SET_IF_RESERVED)
 56 #undef SET_IF_RESERVED
 57 
 58     return result;
 59 }
 60 
 61 RegisterSet RegisterSet::runtimeTagRegisters()
 62 {
 63 #if USE(JSVALUE64)
<span class="line-modified"> 64     return RegisterSet(GPRInfo::tagTypeNumberRegister, GPRInfo::tagMaskRegister);</span>
 65 #else
 66     return { };
 67 #endif
 68 }
 69 
 70 RegisterSet RegisterSet::specialRegisters()
 71 {
 72     return RegisterSet(
 73         stackRegisters(), reservedHardwareRegisters(), runtimeTagRegisters());
 74 }
 75 
 76 RegisterSet RegisterSet::volatileRegistersForJSCall()
 77 {
 78     RegisterSet volatileRegisters = allRegisters();
 79     volatileRegisters.exclude(RegisterSet::stackRegisters());
 80     volatileRegisters.exclude(RegisterSet::reservedHardwareRegisters());
 81     volatileRegisters.exclude(RegisterSet::vmCalleeSaveRegisters());
 82     return volatileRegisters;
 83 }
 84 
</pre>
<hr />
<pre>
139     result.set(GPRInfo::regCS0);
140     result.set(GPRInfo::regCS1);
141     result.set(GPRInfo::regCS2);
142     result.set(GPRInfo::regCS3);
143     result.set(GPRInfo::regCS4);
144     result.set(GPRInfo::regCS5);
145     result.set(GPRInfo::regCS6);
146     result.set(GPRInfo::regCS7);
147     result.set(GPRInfo::regCS8);
148     result.set(GPRInfo::regCS9);
149     result.set(FPRInfo::fpRegCS0);
150     result.set(FPRInfo::fpRegCS1);
151     result.set(FPRInfo::fpRegCS2);
152     result.set(FPRInfo::fpRegCS3);
153     result.set(FPRInfo::fpRegCS4);
154     result.set(FPRInfo::fpRegCS5);
155     result.set(FPRInfo::fpRegCS6);
156     result.set(FPRInfo::fpRegCS7);
157 #elif CPU(ARM_THUMB2) || CPU(MIPS)
158     result.set(GPRInfo::regCS0);

159 #endif
160     return result;
161 }
162 
163 RegisterAtOffsetList* RegisterSet::vmCalleeSaveRegisterOffsets()
164 {
165     static RegisterAtOffsetList* result;
166     static std::once_flag calleeSavesFlag;
167     std::call_once(calleeSavesFlag, [] () {
168         result = new RegisterAtOffsetList(vmCalleeSaveRegisters(), RegisterAtOffsetList::ZeroBased);
169     });
170     return result;
171 }
172 
173 RegisterSet RegisterSet::llintBaselineCalleeSaveRegisters()
174 {
175     RegisterSet result;
176 #if CPU(X86)
177 #elif CPU(X86_64)
178 #if !OS(WINDOWS)
179     result.set(GPRInfo::regCS1);
180     result.set(GPRInfo::regCS2);
<span class="line-modified">181     ASSERT(GPRInfo::regCS3 == GPRInfo::tagTypeNumberRegister);</span>
<span class="line-modified">182     ASSERT(GPRInfo::regCS4 == GPRInfo::tagMaskRegister);</span>
183     result.set(GPRInfo::regCS3);
184     result.set(GPRInfo::regCS4);
185 #else
186     result.set(GPRInfo::regCS3);
187     result.set(GPRInfo::regCS4);
<span class="line-modified">188     ASSERT(GPRInfo::regCS5 == GPRInfo::tagTypeNumberRegister);</span>
<span class="line-modified">189     ASSERT(GPRInfo::regCS6 == GPRInfo::tagMaskRegister);</span>
190     result.set(GPRInfo::regCS5);
191     result.set(GPRInfo::regCS6);
192 #endif
193 #elif CPU(ARM_THUMB2)
194     result.set(GPRInfo::regCS0);

195 #elif CPU(ARM64)
196     result.set(GPRInfo::regCS6);
197     result.set(GPRInfo::regCS7);
<span class="line-modified">198     ASSERT(GPRInfo::regCS8 == GPRInfo::tagTypeNumberRegister);</span>
<span class="line-modified">199     ASSERT(GPRInfo::regCS9 == GPRInfo::tagMaskRegister);</span>
200     result.set(GPRInfo::regCS8);
201     result.set(GPRInfo::regCS9);
202 #elif CPU(MIPS)
203     result.set(GPRInfo::regCS0);

204 #else
205     UNREACHABLE_FOR_PLATFORM();
206 #endif
207     return result;
208 }
209 
210 RegisterSet RegisterSet::dfgCalleeSaveRegisters()
211 {
212     RegisterSet result;
213 #if CPU(X86)
214 #elif CPU(X86_64)
215     result.set(GPRInfo::regCS0);
216     result.set(GPRInfo::regCS1);
217     result.set(GPRInfo::regCS2);
218 #if !OS(WINDOWS)
<span class="line-modified">219     ASSERT(GPRInfo::regCS3 == GPRInfo::tagTypeNumberRegister);</span>
<span class="line-modified">220     ASSERT(GPRInfo::regCS4 == GPRInfo::tagMaskRegister);</span>
221     result.set(GPRInfo::regCS3);
222     result.set(GPRInfo::regCS4);
223 #else
224     result.set(GPRInfo::regCS3);
225     result.set(GPRInfo::regCS4);
<span class="line-modified">226     ASSERT(GPRInfo::regCS5 == GPRInfo::tagTypeNumberRegister);</span>
<span class="line-modified">227     ASSERT(GPRInfo::regCS6 == GPRInfo::tagMaskRegister);</span>
228     result.set(GPRInfo::regCS5);
229     result.set(GPRInfo::regCS6);
230 #endif
231 #elif CPU(ARM_THUMB2)

232 #elif CPU(ARM64)
<span class="line-modified">233     ASSERT(GPRInfo::regCS8 == GPRInfo::tagTypeNumberRegister);</span>
<span class="line-modified">234     ASSERT(GPRInfo::regCS9 == GPRInfo::tagMaskRegister);</span>
235     result.set(GPRInfo::regCS8);
236     result.set(GPRInfo::regCS9);
237 #elif CPU(MIPS)
238 #else
239     UNREACHABLE_FOR_PLATFORM();
240 #endif
241     return result;
242 }
243 
244 RegisterSet RegisterSet::ftlCalleeSaveRegisters()
245 {
246     RegisterSet result;
247 #if ENABLE(FTL_JIT)
248 #if CPU(X86_64) &amp;&amp; !OS(WINDOWS)
249     result.set(GPRInfo::regCS0);
250     result.set(GPRInfo::regCS1);
251     result.set(GPRInfo::regCS2);
<span class="line-modified">252     ASSERT(GPRInfo::regCS3 == GPRInfo::tagTypeNumberRegister);</span>
<span class="line-modified">253     ASSERT(GPRInfo::regCS4 == GPRInfo::tagMaskRegister);</span>
254     result.set(GPRInfo::regCS3);
255     result.set(GPRInfo::regCS4);
256 #elif CPU(ARM64)
257     // B3 might save and use all ARM64 callee saves specified in the ABI.
258     result.set(GPRInfo::regCS0);
259     result.set(GPRInfo::regCS1);
260     result.set(GPRInfo::regCS2);
261     result.set(GPRInfo::regCS3);
262     result.set(GPRInfo::regCS4);
263     result.set(GPRInfo::regCS5);
264     result.set(GPRInfo::regCS6);
265     result.set(GPRInfo::regCS7);
<span class="line-modified">266     ASSERT(GPRInfo::regCS8 == GPRInfo::tagTypeNumberRegister);</span>
<span class="line-modified">267     ASSERT(GPRInfo::regCS9 == GPRInfo::tagMaskRegister);</span>
268     result.set(GPRInfo::regCS8);
269     result.set(GPRInfo::regCS9);
270     result.set(FPRInfo::fpRegCS0);
271     result.set(FPRInfo::fpRegCS1);
272     result.set(FPRInfo::fpRegCS2);
273     result.set(FPRInfo::fpRegCS3);
274     result.set(FPRInfo::fpRegCS4);
275     result.set(FPRInfo::fpRegCS5);
276     result.set(FPRInfo::fpRegCS6);
277     result.set(FPRInfo::fpRegCS7);
278 #else
279     UNREACHABLE_FOR_PLATFORM();
280 #endif
281 #endif
282     return result;
283 }
284 
285 RegisterSet RegisterSet::argumentGPRS()
286 {
287     RegisterSet result;
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (C) 2013-2019 Apple Inc. All rights reserved.</span>
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
</pre>
<hr />
<pre>
 44         MacroAssembler::framePointerRegister);
 45 }
 46 
 47 RegisterSet RegisterSet::reservedHardwareRegisters()
 48 {
 49     RegisterSet result;
 50 
 51 #define SET_IF_RESERVED(id, name, isReserved, isCalleeSaved)    \
 52     if (isReserved)                                             \
 53         result.set(RegisterNames::id);
 54     FOR_EACH_GP_REGISTER(SET_IF_RESERVED)
 55     FOR_EACH_FP_REGISTER(SET_IF_RESERVED)
 56 #undef SET_IF_RESERVED
 57 
 58     return result;
 59 }
 60 
 61 RegisterSet RegisterSet::runtimeTagRegisters()
 62 {
 63 #if USE(JSVALUE64)
<span class="line-modified"> 64     return RegisterSet(GPRInfo::numberTagRegister, GPRInfo::notCellMaskRegister);</span>
 65 #else
 66     return { };
 67 #endif
 68 }
 69 
 70 RegisterSet RegisterSet::specialRegisters()
 71 {
 72     return RegisterSet(
 73         stackRegisters(), reservedHardwareRegisters(), runtimeTagRegisters());
 74 }
 75 
 76 RegisterSet RegisterSet::volatileRegistersForJSCall()
 77 {
 78     RegisterSet volatileRegisters = allRegisters();
 79     volatileRegisters.exclude(RegisterSet::stackRegisters());
 80     volatileRegisters.exclude(RegisterSet::reservedHardwareRegisters());
 81     volatileRegisters.exclude(RegisterSet::vmCalleeSaveRegisters());
 82     return volatileRegisters;
 83 }
 84 
</pre>
<hr />
<pre>
139     result.set(GPRInfo::regCS0);
140     result.set(GPRInfo::regCS1);
141     result.set(GPRInfo::regCS2);
142     result.set(GPRInfo::regCS3);
143     result.set(GPRInfo::regCS4);
144     result.set(GPRInfo::regCS5);
145     result.set(GPRInfo::regCS6);
146     result.set(GPRInfo::regCS7);
147     result.set(GPRInfo::regCS8);
148     result.set(GPRInfo::regCS9);
149     result.set(FPRInfo::fpRegCS0);
150     result.set(FPRInfo::fpRegCS1);
151     result.set(FPRInfo::fpRegCS2);
152     result.set(FPRInfo::fpRegCS3);
153     result.set(FPRInfo::fpRegCS4);
154     result.set(FPRInfo::fpRegCS5);
155     result.set(FPRInfo::fpRegCS6);
156     result.set(FPRInfo::fpRegCS7);
157 #elif CPU(ARM_THUMB2) || CPU(MIPS)
158     result.set(GPRInfo::regCS0);
<span class="line-added">159     result.set(GPRInfo::regCS1);</span>
160 #endif
161     return result;
162 }
163 
164 RegisterAtOffsetList* RegisterSet::vmCalleeSaveRegisterOffsets()
165 {
166     static RegisterAtOffsetList* result;
167     static std::once_flag calleeSavesFlag;
168     std::call_once(calleeSavesFlag, [] () {
169         result = new RegisterAtOffsetList(vmCalleeSaveRegisters(), RegisterAtOffsetList::ZeroBased);
170     });
171     return result;
172 }
173 
174 RegisterSet RegisterSet::llintBaselineCalleeSaveRegisters()
175 {
176     RegisterSet result;
177 #if CPU(X86)
178 #elif CPU(X86_64)
179 #if !OS(WINDOWS)
180     result.set(GPRInfo::regCS1);
181     result.set(GPRInfo::regCS2);
<span class="line-modified">182     static_assert(GPRInfo::regCS3 == GPRInfo::numberTagRegister, &quot;&quot;);</span>
<span class="line-modified">183     static_assert(GPRInfo::regCS4 == GPRInfo::notCellMaskRegister, &quot;&quot;);</span>
184     result.set(GPRInfo::regCS3);
185     result.set(GPRInfo::regCS4);
186 #else
187     result.set(GPRInfo::regCS3);
188     result.set(GPRInfo::regCS4);
<span class="line-modified">189     static_assert(GPRInfo::regCS5 == GPRInfo::numberTagRegister, &quot;&quot;);</span>
<span class="line-modified">190     static_assert(GPRInfo::regCS6 == GPRInfo::notCellMaskRegister, &quot;&quot;);</span>
191     result.set(GPRInfo::regCS5);
192     result.set(GPRInfo::regCS6);
193 #endif
194 #elif CPU(ARM_THUMB2)
195     result.set(GPRInfo::regCS0);
<span class="line-added">196     result.set(GPRInfo::regCS1);</span>
197 #elif CPU(ARM64)
198     result.set(GPRInfo::regCS6);
199     result.set(GPRInfo::regCS7);
<span class="line-modified">200     static_assert(GPRInfo::regCS8 == GPRInfo::numberTagRegister, &quot;&quot;);</span>
<span class="line-modified">201     static_assert(GPRInfo::regCS9 == GPRInfo::notCellMaskRegister, &quot;&quot;);</span>
202     result.set(GPRInfo::regCS8);
203     result.set(GPRInfo::regCS9);
204 #elif CPU(MIPS)
205     result.set(GPRInfo::regCS0);
<span class="line-added">206     result.set(GPRInfo::regCS1);</span>
207 #else
208     UNREACHABLE_FOR_PLATFORM();
209 #endif
210     return result;
211 }
212 
213 RegisterSet RegisterSet::dfgCalleeSaveRegisters()
214 {
215     RegisterSet result;
216 #if CPU(X86)
217 #elif CPU(X86_64)
218     result.set(GPRInfo::regCS0);
219     result.set(GPRInfo::regCS1);
220     result.set(GPRInfo::regCS2);
221 #if !OS(WINDOWS)
<span class="line-modified">222     static_assert(GPRInfo::regCS3 == GPRInfo::numberTagRegister, &quot;&quot;);</span>
<span class="line-modified">223     static_assert(GPRInfo::regCS4 == GPRInfo::notCellMaskRegister, &quot;&quot;);</span>
224     result.set(GPRInfo::regCS3);
225     result.set(GPRInfo::regCS4);
226 #else
227     result.set(GPRInfo::regCS3);
228     result.set(GPRInfo::regCS4);
<span class="line-modified">229     static_assert(GPRInfo::regCS5 == GPRInfo::numberTagRegister, &quot;&quot;);</span>
<span class="line-modified">230     static_assert(GPRInfo::regCS6 == GPRInfo::notCellMaskRegister, &quot;&quot;);</span>
231     result.set(GPRInfo::regCS5);
232     result.set(GPRInfo::regCS6);
233 #endif
234 #elif CPU(ARM_THUMB2)
<span class="line-added">235     result.set(GPRInfo::regCS1);</span>
236 #elif CPU(ARM64)
<span class="line-modified">237     static_assert(GPRInfo::regCS8 == GPRInfo::numberTagRegister, &quot;&quot;);</span>
<span class="line-modified">238     static_assert(GPRInfo::regCS9 == GPRInfo::notCellMaskRegister, &quot;&quot;);</span>
239     result.set(GPRInfo::regCS8);
240     result.set(GPRInfo::regCS9);
241 #elif CPU(MIPS)
242 #else
243     UNREACHABLE_FOR_PLATFORM();
244 #endif
245     return result;
246 }
247 
248 RegisterSet RegisterSet::ftlCalleeSaveRegisters()
249 {
250     RegisterSet result;
251 #if ENABLE(FTL_JIT)
252 #if CPU(X86_64) &amp;&amp; !OS(WINDOWS)
253     result.set(GPRInfo::regCS0);
254     result.set(GPRInfo::regCS1);
255     result.set(GPRInfo::regCS2);
<span class="line-modified">256     static_assert(GPRInfo::regCS3 == GPRInfo::numberTagRegister, &quot;&quot;);</span>
<span class="line-modified">257     static_assert(GPRInfo::regCS4 == GPRInfo::notCellMaskRegister, &quot;&quot;);</span>
258     result.set(GPRInfo::regCS3);
259     result.set(GPRInfo::regCS4);
260 #elif CPU(ARM64)
261     // B3 might save and use all ARM64 callee saves specified in the ABI.
262     result.set(GPRInfo::regCS0);
263     result.set(GPRInfo::regCS1);
264     result.set(GPRInfo::regCS2);
265     result.set(GPRInfo::regCS3);
266     result.set(GPRInfo::regCS4);
267     result.set(GPRInfo::regCS5);
268     result.set(GPRInfo::regCS6);
269     result.set(GPRInfo::regCS7);
<span class="line-modified">270     static_assert(GPRInfo::regCS8 == GPRInfo::numberTagRegister, &quot;&quot;);</span>
<span class="line-modified">271     static_assert(GPRInfo::regCS9 == GPRInfo::notCellMaskRegister, &quot;&quot;);</span>
272     result.set(GPRInfo::regCS8);
273     result.set(GPRInfo::regCS9);
274     result.set(FPRInfo::fpRegCS0);
275     result.set(FPRInfo::fpRegCS1);
276     result.set(FPRInfo::fpRegCS2);
277     result.set(FPRInfo::fpRegCS3);
278     result.set(FPRInfo::fpRegCS4);
279     result.set(FPRInfo::fpRegCS5);
280     result.set(FPRInfo::fpRegCS6);
281     result.set(FPRInfo::fpRegCS7);
282 #else
283     UNREACHABLE_FOR_PLATFORM();
284 #endif
285 #endif
286     return result;
287 }
288 
289 RegisterSet RegisterSet::argumentGPRS()
290 {
291     RegisterSet result;
</pre>
</td>
</tr>
</table>
<center><a href="RegisterAtOffsetList.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RegisterSet.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>