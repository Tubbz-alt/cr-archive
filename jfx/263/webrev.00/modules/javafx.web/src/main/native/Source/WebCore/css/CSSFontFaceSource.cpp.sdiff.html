<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/css/CSSFontFaceSource.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CSSFontFaceSet.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CSSFontFaceSource.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/css/CSSFontFaceSource.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
162                     m_inDocumentCustomPlatformData = createFontCustomPlatformData(*m_generatedOTFBuffer, String());
163                     success = static_cast&lt;bool&gt;(m_inDocumentCustomPlatformData);
164                 }
165             }
166         } else
167 #endif
168         if (m_immediateSource) {
169             ASSERT(!m_immediateFontCustomPlatformData);
170             bool wrapping;
171             auto buffer = SharedBuffer::create(static_cast&lt;const char*&gt;(m_immediateSource-&gt;baseAddress()), m_immediateSource-&gt;byteLength());
172             m_immediateFontCustomPlatformData = CachedFont::createCustomFontData(buffer.get(), String(), wrapping);
173             success = static_cast&lt;bool&gt;(m_immediateFontCustomPlatformData);
174         } else {
175             // We are only interested in whether or not fontForFamily() returns null or not. Luckily, none of
176             // the values in the FontDescription other than the family name can cause the function to return
177             // null if it wasn&#39;t going to otherwise (and vice-versa).
178             FontCascadeDescription fontDescription;
179             fontDescription.setOneFamily(m_familyNameOrURI);
180             fontDescription.setComputedSize(1);
181             fontDescription.setShouldAllowUserInstalledFonts(m_face.allowUserInstalledFonts());
<span class="line-modified">182             fontDescription.setShouldAllowDesignSystemUIFonts(m_face.shouldAllowDesignSystemUIFonts());</span>
<span class="line-removed">183             success = FontCache::singleton().fontForFamily(fontDescription, m_familyNameOrURI, nullptr, nullptr, FontSelectionSpecifiedCapabilities(), true);</span>
184             if (RuntimeEnabledFeatures::sharedFeatures().webAPIStatisticsEnabled()) {
185                 if (auto* document = fontSelector-&gt;document())
186                     ResourceLoadObserver::shared().logFontLoad(*document, m_familyNameOrURI.string(), success);
187             }
188         }
189         setStatus(success ? Status::Success : Status::Failure);
190     }
191 }
192 
<span class="line-modified">193 RefPtr&lt;Font&gt; CSSFontFaceSource::font(const FontDescription&amp; fontDescription, bool syntheticBold, bool syntheticItalic, const FontFeatureSettings&amp; fontFaceFeatures, const FontVariantSettings&amp; fontFaceVariantSettings, FontSelectionSpecifiedCapabilities fontFaceCapabilities)</span>
194 {
195     ASSERT(status() == Status::Success);
196 
197 #if ENABLE(SVG_FONTS)
198     bool usesInDocumentSVGFont = m_hasSVGFontFaceElement;
199 #else
200     bool usesInDocumentSVGFont = false;
201 #endif
202 
203     if (!m_font &amp;&amp; !usesInDocumentSVGFont) {
204         if (m_immediateSource) {
205             if (!m_immediateFontCustomPlatformData)
206                 return nullptr;
<span class="line-modified">207             return Font::create(CachedFont::platformDataFromCustomData(*m_immediateFontCustomPlatformData, fontDescription, syntheticBold, syntheticItalic, fontFaceFeatures, fontFaceVariantSettings, fontFaceCapabilities), Font::Origin::Remote);</span>
208         }
209 
210         // We&#39;re local. Just return a Font from the normal cache.
211         // We don&#39;t want to check alternate font family names here, so pass true as the checkingAlternateName parameter.
<span class="line-modified">212         return FontCache::singleton().fontForFamily(fontDescription, m_familyNameOrURI, &amp;fontFaceFeatures, &amp;fontFaceVariantSettings, fontFaceCapabilities, true);</span>
213     }
214 
215     if (m_font) {
216         auto success = m_font-&gt;ensureCustomFontData(m_familyNameOrURI);
217         ASSERT_UNUSED(success, success);
218 
219         ASSERT(status() == Status::Success);
<span class="line-modified">220         auto result = m_font-&gt;createFont(fontDescription, m_familyNameOrURI, syntheticBold, syntheticItalic, fontFaceFeatures, fontFaceVariantSettings, fontFaceCapabilities);</span>
221         ASSERT(result);
222         return result;
223     }
224 
225     if (!usesInDocumentSVGFont)
226         return nullptr;
227 
228 #if ENABLE(SVG_FONTS)
229     if (!m_svgFontFaceElement || !is&lt;SVGFontElement&gt;(m_svgFontFaceElement-&gt;parentNode()))
230         return nullptr;
231     if (!m_inDocumentCustomPlatformData)
232         return nullptr;
<span class="line-modified">233     return Font::create(m_inDocumentCustomPlatformData-&gt;fontPlatformData(fontDescription, syntheticBold, syntheticItalic, fontFaceFeatures, fontFaceVariantSettings, fontFaceCapabilities), Font::Origin::Remote);</span>
234 #endif
235 
236     ASSERT_NOT_REACHED();
237     return nullptr;
238 }
239 
240 #if ENABLE(SVG_FONTS)
241 bool CSSFontFaceSource::isSVGFontFaceSource() const
242 {
243     return m_hasSVGFontFaceElement || is&lt;CachedSVGFont&gt;(m_font.get());
244 }
245 #endif
246 
247 }
</pre>
</td>
<td>
<hr />
<pre>
162                     m_inDocumentCustomPlatformData = createFontCustomPlatformData(*m_generatedOTFBuffer, String());
163                     success = static_cast&lt;bool&gt;(m_inDocumentCustomPlatformData);
164                 }
165             }
166         } else
167 #endif
168         if (m_immediateSource) {
169             ASSERT(!m_immediateFontCustomPlatformData);
170             bool wrapping;
171             auto buffer = SharedBuffer::create(static_cast&lt;const char*&gt;(m_immediateSource-&gt;baseAddress()), m_immediateSource-&gt;byteLength());
172             m_immediateFontCustomPlatformData = CachedFont::createCustomFontData(buffer.get(), String(), wrapping);
173             success = static_cast&lt;bool&gt;(m_immediateFontCustomPlatformData);
174         } else {
175             // We are only interested in whether or not fontForFamily() returns null or not. Luckily, none of
176             // the values in the FontDescription other than the family name can cause the function to return
177             // null if it wasn&#39;t going to otherwise (and vice-versa).
178             FontCascadeDescription fontDescription;
179             fontDescription.setOneFamily(m_familyNameOrURI);
180             fontDescription.setComputedSize(1);
181             fontDescription.setShouldAllowUserInstalledFonts(m_face.allowUserInstalledFonts());
<span class="line-modified">182             success = FontCache::singleton().fontForFamily(fontDescription, m_familyNameOrURI, nullptr, FontSelectionSpecifiedCapabilities(), true);</span>

183             if (RuntimeEnabledFeatures::sharedFeatures().webAPIStatisticsEnabled()) {
184                 if (auto* document = fontSelector-&gt;document())
185                     ResourceLoadObserver::shared().logFontLoad(*document, m_familyNameOrURI.string(), success);
186             }
187         }
188         setStatus(success ? Status::Success : Status::Failure);
189     }
190 }
191 
<span class="line-modified">192 RefPtr&lt;Font&gt; CSSFontFaceSource::font(const FontDescription&amp; fontDescription, bool syntheticBold, bool syntheticItalic, const FontFeatureSettings&amp; fontFaceFeatures, FontSelectionSpecifiedCapabilities fontFaceCapabilities)</span>
193 {
194     ASSERT(status() == Status::Success);
195 
196 #if ENABLE(SVG_FONTS)
197     bool usesInDocumentSVGFont = m_hasSVGFontFaceElement;
198 #else
199     bool usesInDocumentSVGFont = false;
200 #endif
201 
202     if (!m_font &amp;&amp; !usesInDocumentSVGFont) {
203         if (m_immediateSource) {
204             if (!m_immediateFontCustomPlatformData)
205                 return nullptr;
<span class="line-modified">206             return Font::create(CachedFont::platformDataFromCustomData(*m_immediateFontCustomPlatformData, fontDescription, syntheticBold, syntheticItalic, fontFaceFeatures, fontFaceCapabilities), Font::Origin::Remote);</span>
207         }
208 
209         // We&#39;re local. Just return a Font from the normal cache.
210         // We don&#39;t want to check alternate font family names here, so pass true as the checkingAlternateName parameter.
<span class="line-modified">211         return FontCache::singleton().fontForFamily(fontDescription, m_familyNameOrURI, &amp;fontFaceFeatures, fontFaceCapabilities, true);</span>
212     }
213 
214     if (m_font) {
215         auto success = m_font-&gt;ensureCustomFontData(m_familyNameOrURI);
216         ASSERT_UNUSED(success, success);
217 
218         ASSERT(status() == Status::Success);
<span class="line-modified">219         auto result = m_font-&gt;createFont(fontDescription, m_familyNameOrURI, syntheticBold, syntheticItalic, fontFaceFeatures, fontFaceCapabilities);</span>
220         ASSERT(result);
221         return result;
222     }
223 
224     if (!usesInDocumentSVGFont)
225         return nullptr;
226 
227 #if ENABLE(SVG_FONTS)
228     if (!m_svgFontFaceElement || !is&lt;SVGFontElement&gt;(m_svgFontFaceElement-&gt;parentNode()))
229         return nullptr;
230     if (!m_inDocumentCustomPlatformData)
231         return nullptr;
<span class="line-modified">232     return Font::create(m_inDocumentCustomPlatformData-&gt;fontPlatformData(fontDescription, syntheticBold, syntheticItalic, fontFaceFeatures, fontFaceCapabilities), Font::Origin::Remote);</span>
233 #endif
234 
235     ASSERT_NOT_REACHED();
236     return nullptr;
237 }
238 
239 #if ENABLE(SVG_FONTS)
240 bool CSSFontFaceSource::isSVGFontFaceSource() const
241 {
242     return m_hasSVGFontFaceElement || is&lt;CachedSVGFont&gt;(m_font.get());
243 }
244 #endif
245 
246 }
</pre>
</td>
</tr>
</table>
<center><a href="CSSFontFaceSet.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CSSFontFaceSource.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>