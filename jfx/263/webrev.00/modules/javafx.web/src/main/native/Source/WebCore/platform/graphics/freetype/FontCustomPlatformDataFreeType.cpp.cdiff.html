<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/freetype/FontCustomPlatformDataFreeType.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="FontCacheFreeType.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="FontPlatformDataFreeType.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/freetype/FontCustomPlatformDataFreeType.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 54,11 ***</span>
      // this cairo_font_face_t is destroyed, it cleans up the FreeType face as well.
      cairo_font_face_set_user_data(m_fontFace.get(), &amp;freeTypeFaceKey, freeTypeFace,
          reinterpret_cast&lt;cairo_destroy_func_t&gt;(reinterpret_cast&lt;void(*)(void)&gt;(FT_Done_Face)));
  }
  
<span class="line-modified">! static FcPattern* defaultFontconfigOptions()</span>
  {
      // Get some generic default settings from fontconfig for web fonts. Strategy
      // from Behdad Esfahbod in https://code.google.com/p/chromium/issues/detail?id=173207#c35
      // For web fonts, the hint style is overridden in FontCustomPlatformData::FontCustomPlatformData
      // so Fontconfig will not affect the hint style, but it may disable hinting completely.
<span class="line-new-header">--- 54,11 ---</span>
      // this cairo_font_face_t is destroyed, it cleans up the FreeType face as well.
      cairo_font_face_set_user_data(m_fontFace.get(), &amp;freeTypeFaceKey, freeTypeFace,
          reinterpret_cast&lt;cairo_destroy_func_t&gt;(reinterpret_cast&lt;void(*)(void)&gt;(FT_Done_Face)));
  }
  
<span class="line-modified">! static RefPtr&lt;FcPattern&gt; defaultFontconfigOptions()</span>
  {
      // Get some generic default settings from fontconfig for web fonts. Strategy
      // from Behdad Esfahbod in https://code.google.com/p/chromium/issues/detail?id=173207#c35
      // For web fonts, the hint style is overridden in FontCustomPlatformData::FontCustomPlatformData
      // so Fontconfig will not affect the hint style, but it may disable hinting completely.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 70,26 ***</span>
          cairo_ft_font_options_substitute(getDefaultCairoFontOptions(), pattern);
          FcDefaultSubstitute(pattern);
          FcPatternDel(pattern, FC_FAMILY);
          FcConfigSubstitute(nullptr, pattern, FcMatchFont);
      }, pattern);
<span class="line-modified">!     return pattern;</span>
  }
  
<span class="line-modified">! FontPlatformData FontCustomPlatformData::fontPlatformData(const FontDescription&amp; description, bool bold, bool italic, const FontFeatureSettings&amp;, const FontVariantSettings&amp;, FontSelectionSpecifiedCapabilities)</span>
  {
      auto* freeTypeFace = static_cast&lt;FT_Face&gt;(cairo_font_face_get_user_data(m_fontFace.get(), &amp;freeTypeFaceKey));
      ASSERT(freeTypeFace);
      RefPtr&lt;FcPattern&gt; pattern = defaultFontconfigOptions();
  #if ENABLE(VARIATION_FONTS)
      auto variants = buildVariationSettings(freeTypeFace, description);
      if (!variants.isEmpty()) {
<span class="line-removed">-         pattern = adoptRef(FcPatternDuplicate(pattern.get()));</span>
          FcPatternAddString(pattern.get(), FC_FONT_VARIATIONS, reinterpret_cast&lt;const FcChar8*&gt;(variants.utf8().data()));
      }
  #endif
<span class="line-modified">!     return FontPlatformData(m_fontFace.get(), pattern.get(), description.computedPixelSize(), freeTypeFace-&gt;face_flags &amp; FT_FACE_FLAG_FIXED_WIDTH, bold, italic, description.orientation());</span>
  }
  
  static bool initializeFreeTypeLibrary(FT_Library&amp; library)
  {
      // https://www.freetype.org/freetype2/docs/design/design-4.html
<span class="line-new-header">--- 70,26 ---</span>
          cairo_ft_font_options_substitute(getDefaultCairoFontOptions(), pattern);
          FcDefaultSubstitute(pattern);
          FcPatternDel(pattern, FC_FAMILY);
          FcConfigSubstitute(nullptr, pattern, FcMatchFont);
      }, pattern);
<span class="line-modified">!     return adoptRef(FcPatternDuplicate(pattern));</span>
  }
  
<span class="line-modified">! FontPlatformData FontCustomPlatformData::fontPlatformData(const FontDescription&amp; description, bool bold, bool italic, const FontFeatureSettings&amp;, FontSelectionSpecifiedCapabilities)</span>
  {
      auto* freeTypeFace = static_cast&lt;FT_Face&gt;(cairo_font_face_get_user_data(m_fontFace.get(), &amp;freeTypeFaceKey));
      ASSERT(freeTypeFace);
      RefPtr&lt;FcPattern&gt; pattern = defaultFontconfigOptions();
<span class="line-added">+     FcPatternAddString(pattern.get(), FC_FAMILY, reinterpret_cast&lt;const FcChar8*&gt;(freeTypeFace-&gt;family_name));</span>
  #if ENABLE(VARIATION_FONTS)
      auto variants = buildVariationSettings(freeTypeFace, description);
      if (!variants.isEmpty()) {
          FcPatternAddString(pattern.get(), FC_FONT_VARIATIONS, reinterpret_cast&lt;const FcChar8*&gt;(variants.utf8().data()));
      }
  #endif
<span class="line-modified">!     return FontPlatformData(m_fontFace.get(), WTFMove(pattern), description.computedPixelSize(), freeTypeFace-&gt;face_flags &amp; FT_FACE_FLAG_FIXED_WIDTH, bold, italic, description.orientation());</span>
  }
  
  static bool initializeFreeTypeLibrary(FT_Library&amp; library)
  {
      // https://www.freetype.org/freetype2/docs/design/design-4.html
</pre>
<center><a href="FontCacheFreeType.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="FontPlatformDataFreeType.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>