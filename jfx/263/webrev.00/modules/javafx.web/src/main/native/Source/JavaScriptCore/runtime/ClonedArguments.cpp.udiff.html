<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/ClonedArguments.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ClassInfo.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ClonedArguments.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/ClonedArguments.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -72,21 +72,21 @@</span>
      result-&gt;m_callee.set(vm, result, callee);
      result-&gt;putDirect(vm, clonedArgumentsLengthPropertyOffset, jsNumber(length));
      return result;
  }
  
<span class="udiff-line-modified-removed">- ClonedArguments* ClonedArguments::createEmpty(ExecState* exec, JSFunction* callee, unsigned length)</span>
<span class="udiff-line-modified-added">+ ClonedArguments* ClonedArguments::createEmpty(JSGlobalObject* globalObject, JSFunction* callee, unsigned length)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      // NB. Some clients might expect that the global object of of this object is the global object
      // of the callee. We don&#39;t do this for now, but maybe we should.
<span class="udiff-line-modified-removed">-     ClonedArguments* result = createEmpty(vm, exec-&gt;lexicalGlobalObject()-&gt;clonedArgumentsStructure(), callee, length);</span>
<span class="udiff-line-modified-added">+     ClonedArguments* result = createEmpty(vm, globalObject-&gt;clonedArgumentsStructure(), callee, length);</span>
      ASSERT(!result-&gt;needsSlowPutIndexing(vm) || shouldUseSlowPut(result-&gt;structure(vm)-&gt;indexingType()));
      return result;
  }
  
<span class="udiff-line-modified-removed">- ClonedArguments* ClonedArguments::createWithInlineFrame(ExecState* myFrame, ExecState* targetFrame, InlineCallFrame* inlineCallFrame, ArgumentsMode mode)</span>
<span class="udiff-line-modified-added">+ ClonedArguments* ClonedArguments::createWithInlineFrame(JSGlobalObject* globalObject, CallFrame* targetFrame, InlineCallFrame* inlineCallFrame, ArgumentsMode mode)</span>
  {
      JSFunction* callee;
  
      if (inlineCallFrame)
          callee = jsCast&lt;JSFunction*&gt;(inlineCallFrame-&gt;calleeRecovery.recover(targetFrame));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -102,62 +102,62 @@</span>
              if (inlineCallFrame-&gt;argumentCountRegister.isValid())
                  length = targetFrame-&gt;r(inlineCallFrame-&gt;argumentCountRegister).unboxedInt32();
              else
                  length = inlineCallFrame-&gt;argumentCountIncludingThis;
              length--;
<span class="udiff-line-modified-removed">-             result = createEmpty(myFrame, callee, length);</span>
<span class="udiff-line-modified-added">+             result = createEmpty(globalObject, callee, length);</span>
  
              for (unsigned i = length; i--;)
<span class="udiff-line-modified-removed">-                 result-&gt;putDirectIndex(myFrame, i, inlineCallFrame-&gt;argumentsWithFixup[i + 1].recover(targetFrame));</span>
<span class="udiff-line-modified-added">+                 result-&gt;putDirectIndex(globalObject, i, inlineCallFrame-&gt;argumentsWithFixup[i + 1].recover(targetFrame));</span>
          } else {
              length = targetFrame-&gt;argumentCount();
<span class="udiff-line-modified-removed">-             result = createEmpty(myFrame, callee, length);</span>
<span class="udiff-line-modified-added">+             result = createEmpty(globalObject, callee, length);</span>
  
              for (unsigned i = length; i--;)
<span class="udiff-line-modified-removed">-                 result-&gt;putDirectIndex(myFrame, i, targetFrame-&gt;uncheckedArgument(i));</span>
<span class="udiff-line-modified-added">+                 result-&gt;putDirectIndex(globalObject, i, targetFrame-&gt;uncheckedArgument(i));</span>
          }
          break;
      }
  
      case ArgumentsMode::FakeValues: {
<span class="udiff-line-modified-removed">-         result = createEmpty(myFrame, callee, 0);</span>
<span class="udiff-line-modified-added">+         result = createEmpty(globalObject, callee, 0);</span>
          break;
      } }
  
<span class="udiff-line-modified-removed">-     ASSERT(myFrame-&gt;lexicalGlobalObject()-&gt;clonedArgumentsStructure() == result-&gt;structure(myFrame-&gt;vm()));</span>
<span class="udiff-line-modified-removed">-     ASSERT(!result-&gt;needsSlowPutIndexing(myFrame-&gt;vm()) || shouldUseSlowPut(result-&gt;structure(myFrame-&gt;vm())-&gt;indexingType()));</span>
<span class="udiff-line-modified-added">+     ASSERT(globalObject-&gt;clonedArgumentsStructure() == result-&gt;structure(globalObject-&gt;vm()));</span>
<span class="udiff-line-modified-added">+     ASSERT(!result-&gt;needsSlowPutIndexing(globalObject-&gt;vm()) || shouldUseSlowPut(result-&gt;structure(globalObject-&gt;vm())-&gt;indexingType()));</span>
      return result;
  }
  
<span class="udiff-line-modified-removed">- ClonedArguments* ClonedArguments::createWithMachineFrame(ExecState* myFrame, ExecState* targetFrame, ArgumentsMode mode)</span>
<span class="udiff-line-modified-added">+ ClonedArguments* ClonedArguments::createWithMachineFrame(JSGlobalObject* globalObject, CallFrame* targetFrame, ArgumentsMode mode)</span>
  {
<span class="udiff-line-modified-removed">-     ClonedArguments* result = createWithInlineFrame(myFrame, targetFrame, nullptr, mode);</span>
<span class="udiff-line-modified-removed">-     ASSERT(!result-&gt;needsSlowPutIndexing(myFrame-&gt;vm()) || shouldUseSlowPut(result-&gt;structure(myFrame-&gt;vm())-&gt;indexingType()));</span>
<span class="udiff-line-modified-added">+     ClonedArguments* result = createWithInlineFrame(globalObject, targetFrame, nullptr, mode);</span>
<span class="udiff-line-modified-added">+     ASSERT(!result-&gt;needsSlowPutIndexing(globalObject-&gt;vm()) || shouldUseSlowPut(result-&gt;structure(globalObject-&gt;vm())-&gt;indexingType()));</span>
      return result;
  }
  
  ClonedArguments* ClonedArguments::createByCopyingFrom(
<span class="udiff-line-modified-removed">-     ExecState* exec, Structure* structure, Register* argumentStart, unsigned length,</span>
<span class="udiff-line-modified-added">+     JSGlobalObject* globalObject, Structure* structure, Register* argumentStart, unsigned length,</span>
      JSFunction* callee)
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      ClonedArguments* result = createEmpty(vm, structure, callee, length);
  
      for (unsigned i = length; i--;)
<span class="udiff-line-modified-removed">-         result-&gt;putDirectIndex(exec, i, argumentStart[i].jsValue());</span>
<span class="udiff-line-modified-added">+         result-&gt;putDirectIndex(globalObject, i, argumentStart[i].jsValue());</span>
      ASSERT(!result-&gt;needsSlowPutIndexing(vm) || shouldUseSlowPut(result-&gt;structure(vm)-&gt;indexingType()));
      return result;
  }
  
  Structure* ClonedArguments::createStructure(VM&amp; vm, JSGlobalObject* globalObject, JSValue prototype, IndexingType indexingType)
  {
      Structure* structure = Structure::create(vm, globalObject, prototype, TypeInfo(ClonedArgumentsType, StructureFlags), info(), indexingType);
      structure-&gt;addPropertyWithoutTransition(
          vm, vm.propertyNames-&gt;length, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum),
<span class="udiff-line-modified-removed">-         [&amp;] (const GCSafeConcurrentJSLocker&amp;, PropertyOffset offset, PropertyOffset newLastOffset) {</span>
<span class="udiff-line-modified-added">+         [&amp;] (const GCSafeConcurrentJSLocker&amp;, PropertyOffset offset, PropertyOffset newMaxOffset) {</span>
              RELEASE_ASSERT(offset == clonedArgumentsLengthPropertyOffset);
<span class="udiff-line-modified-removed">-             structure-&gt;setLastOffset(newLastOffset);</span>
<span class="udiff-line-modified-added">+             structure-&gt;setMaxOffset(vm, newMaxOffset);</span>
          });
      return structure;
  }
  
  Structure* ClonedArguments::createStructure(VM&amp; vm, JSGlobalObject* globalObject, JSValue prototype)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -169,14 +169,14 @@</span>
  Structure* ClonedArguments::createSlowPutStructure(VM&amp; vm, JSGlobalObject* globalObject, JSValue prototype)
  {
      return createStructure(vm, globalObject, prototype, NonArrayWithSlowPutArrayStorage);
  }
  
<span class="udiff-line-modified-removed">- bool ClonedArguments::getOwnPropertySlot(JSObject* object, ExecState* exec, PropertyName ident, PropertySlot&amp; slot)</span>
<span class="udiff-line-modified-added">+ bool ClonedArguments::getOwnPropertySlot(JSObject* object, JSGlobalObject* globalObject, PropertyName ident, PropertySlot&amp; slot)</span>
  {
      ClonedArguments* thisObject = jsCast&lt;ClonedArguments*&gt;(object);
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
  
      if (!thisObject-&gt;specialsMaterialized()) {
          FunctionExecutable* executable = jsCast&lt;FunctionExecutable*&gt;(thisObject-&gt;m_callee-&gt;executable());
          bool isStrictMode = executable-&gt;isStrictMode();
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -193,81 +193,81 @@</span>
              slot.setValue(thisObject, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum), thisObject-&gt;globalObject(vm)-&gt;arrayProtoValuesFunction());
              return true;
          }
      }
  
<span class="udiff-line-modified-removed">-     return Base::getOwnPropertySlot(thisObject, exec, ident, slot);</span>
<span class="udiff-line-modified-added">+     return Base::getOwnPropertySlot(thisObject, globalObject, ident, slot);</span>
  }
  
<span class="udiff-line-modified-removed">- void ClonedArguments::getOwnPropertyNames(JSObject* object, ExecState* exec, PropertyNameArray&amp; array, EnumerationMode mode)</span>
<span class="udiff-line-modified-added">+ void ClonedArguments::getOwnPropertyNames(JSObject* object, JSGlobalObject* globalObject, PropertyNameArray&amp; array, EnumerationMode mode)</span>
  {
      ClonedArguments* thisObject = jsCast&lt;ClonedArguments*&gt;(object);
<span class="udiff-line-modified-removed">-     thisObject-&gt;materializeSpecialsIfNecessary(exec);</span>
<span class="udiff-line-modified-removed">-     Base::getOwnPropertyNames(thisObject, exec, array, mode);</span>
<span class="udiff-line-modified-added">+     thisObject-&gt;materializeSpecialsIfNecessary(globalObject);</span>
<span class="udiff-line-modified-added">+     Base::getOwnPropertyNames(thisObject, globalObject, array, mode);</span>
  }
  
<span class="udiff-line-modified-removed">- bool ClonedArguments::put(JSCell* cell, ExecState* exec, PropertyName ident, JSValue value, PutPropertySlot&amp; slot)</span>
<span class="udiff-line-modified-added">+ bool ClonedArguments::put(JSCell* cell, JSGlobalObject* globalObject, PropertyName ident, JSValue value, PutPropertySlot&amp; slot)</span>
  {
      ClonedArguments* thisObject = jsCast&lt;ClonedArguments*&gt;(cell);
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
  
      if (ident == vm.propertyNames-&gt;callee
          || ident == vm.propertyNames-&gt;iteratorSymbol) {
<span class="udiff-line-modified-removed">-         thisObject-&gt;materializeSpecialsIfNecessary(exec);</span>
<span class="udiff-line-modified-added">+         thisObject-&gt;materializeSpecialsIfNecessary(globalObject);</span>
          PutPropertySlot dummy = slot; // Shadow the given PutPropertySlot to prevent caching.
<span class="udiff-line-modified-removed">-         return Base::put(thisObject, exec, ident, value, dummy);</span>
<span class="udiff-line-modified-added">+         return Base::put(thisObject, globalObject, ident, value, dummy);</span>
      }
  
<span class="udiff-line-modified-removed">-     return Base::put(thisObject, exec, ident, value, slot);</span>
<span class="udiff-line-modified-added">+     return Base::put(thisObject, globalObject, ident, value, slot);</span>
  }
  
<span class="udiff-line-modified-removed">- bool ClonedArguments::deleteProperty(JSCell* cell, ExecState* exec, PropertyName ident)</span>
<span class="udiff-line-modified-added">+ bool ClonedArguments::deleteProperty(JSCell* cell, JSGlobalObject* globalObject, PropertyName ident)</span>
  {
      ClonedArguments* thisObject = jsCast&lt;ClonedArguments*&gt;(cell);
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
  
      if (ident == vm.propertyNames-&gt;callee
          || ident == vm.propertyNames-&gt;iteratorSymbol)
<span class="udiff-line-modified-removed">-         thisObject-&gt;materializeSpecialsIfNecessary(exec);</span>
<span class="udiff-line-modified-added">+         thisObject-&gt;materializeSpecialsIfNecessary(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     return Base::deleteProperty(thisObject, exec, ident);</span>
<span class="udiff-line-modified-added">+     return Base::deleteProperty(thisObject, globalObject, ident);</span>
  }
  
<span class="udiff-line-modified-removed">- bool ClonedArguments::defineOwnProperty(JSObject* object, ExecState* exec, PropertyName ident, const PropertyDescriptor&amp; descriptor, bool shouldThrow)</span>
<span class="udiff-line-modified-added">+ bool ClonedArguments::defineOwnProperty(JSObject* object, JSGlobalObject* globalObject, PropertyName ident, const PropertyDescriptor&amp; descriptor, bool shouldThrow)</span>
  {
      ClonedArguments* thisObject = jsCast&lt;ClonedArguments*&gt;(object);
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
  
      if (ident == vm.propertyNames-&gt;callee
          || ident == vm.propertyNames-&gt;iteratorSymbol)
<span class="udiff-line-modified-removed">-         thisObject-&gt;materializeSpecialsIfNecessary(exec);</span>
<span class="udiff-line-modified-added">+         thisObject-&gt;materializeSpecialsIfNecessary(globalObject);</span>
  
<span class="udiff-line-modified-removed">-     return Base::defineOwnProperty(object, exec, ident, descriptor, shouldThrow);</span>
<span class="udiff-line-modified-added">+     return Base::defineOwnProperty(object, globalObject, ident, descriptor, shouldThrow);</span>
  }
  
<span class="udiff-line-modified-removed">- void ClonedArguments::materializeSpecials(ExecState* exec)</span>
<span class="udiff-line-modified-added">+ void ClonedArguments::materializeSpecials(JSGlobalObject* globalObject)</span>
  {
      RELEASE_ASSERT(!specialsMaterialized());
<span class="udiff-line-modified-removed">-     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
  
      FunctionExecutable* executable = jsCast&lt;FunctionExecutable*&gt;(m_callee-&gt;executable());
      bool isStrictMode = executable-&gt;isStrictMode();
  
      if (isStrictMode)
<span class="udiff-line-modified-removed">-         putDirectAccessor(exec, vm.propertyNames-&gt;callee, globalObject(vm)-&gt;throwTypeErrorArgumentsCalleeAndCallerGetterSetter(), PropertyAttribute::DontDelete | PropertyAttribute::DontEnum | PropertyAttribute::Accessor);</span>
<span class="udiff-line-modified-added">+         putDirectAccessor(globalObject, vm.propertyNames-&gt;callee, this-&gt;globalObject(vm)-&gt;throwTypeErrorArgumentsCalleeAndCallerGetterSetter(), PropertyAttribute::DontDelete | PropertyAttribute::DontEnum | PropertyAttribute::Accessor);</span>
      else
          putDirect(vm, vm.propertyNames-&gt;callee, JSValue(m_callee.get()));
  
<span class="udiff-line-modified-removed">-     putDirect(vm, vm.propertyNames-&gt;iteratorSymbol, globalObject(vm)-&gt;arrayProtoValuesFunction(), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
<span class="udiff-line-modified-added">+     putDirect(vm, vm.propertyNames-&gt;iteratorSymbol, this-&gt;globalObject(vm)-&gt;arrayProtoValuesFunction(), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
  
      m_callee.clear();
  }
  
<span class="udiff-line-modified-removed">- void ClonedArguments::materializeSpecialsIfNecessary(ExecState* exec)</span>
<span class="udiff-line-modified-added">+ void ClonedArguments::materializeSpecialsIfNecessary(JSGlobalObject* globalObject)</span>
  {
      if (!specialsMaterialized())
<span class="udiff-line-modified-removed">-         materializeSpecials(exec);</span>
<span class="udiff-line-modified-added">+         materializeSpecials(globalObject);</span>
  }
  
  void ClonedArguments::visitChildren(JSCell* cell, SlotVisitor&amp; visitor)
  {
      ClonedArguments* thisObject = jsCast&lt;ClonedArguments*&gt;(cell);
</pre>
<center><a href="ClassInfo.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ClonedArguments.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>