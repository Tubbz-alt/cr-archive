<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/rendering/RenderFlexibleBox.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="RenderEmbeddedObject.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RenderFlexibleBox.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/rendering/RenderFlexibleBox.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -35,14 +35,14 @@</span>
  #include &quot;LayoutRepainter.h&quot;
  #include &quot;RenderChildIterator.h&quot;
  #include &quot;RenderLayer.h&quot;
  #include &quot;RenderLayoutState.h&quot;
  #include &quot;RenderView.h&quot;
<span class="udiff-line-removed">- #include &quot;RuntimeEnabledFeatures.h&quot;</span>
  #include &lt;limits&gt;
  #include &lt;wtf/IsoMallocInlines.h&gt;
  #include &lt;wtf/MathExtras.h&gt;
<span class="udiff-line-added">+ #include &lt;wtf/SetForScope.h&gt;</span>
  
  namespace WebCore {
  
  WTF_MAKE_ISO_ALLOCATED_IMPL(RenderFlexibleBox);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -261,10 +261,11 @@</span>
      if (!relayoutChildren &amp;&amp; simplifiedLayout())
          return;
  
      LayoutRepainter repainter(*this, checkForRepaintDuringLayout());
  
<span class="udiff-line-added">+     resetLogicalHeightBeforeLayoutIfNeeded();</span>
      m_relaidOutChildren.clear();
  
      bool oldInLayout = m_inLayout;
      m_inLayout = true;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1532,10 +1533,37 @@</span>
      if (isHorizontalFlow())
          return child.style().overflowY();
      return child.style().overflowX();
  }
  
<span class="udiff-line-added">+ bool RenderFlexibleBox::hasPercentHeightDescendants(const RenderBox&amp; renderer) const</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     // FIXME: This function can be removed soon after webkit.org/b/204318 is fixed.</span>
<span class="udiff-line-added">+     if (!is&lt;RenderBlock&gt;(renderer))</span>
<span class="udiff-line-added">+         return false;</span>
<span class="udiff-line-added">+     auto&amp; renderBlock = downcast&lt;RenderBlock&gt;(renderer);</span>
<span class="udiff-line-added">+     if (!renderBlock.hasPercentHeightDescendants())</span>
<span class="udiff-line-added">+         return false;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     auto* percentHeightDescendants = renderBlock.percentHeightDescendants();</span>
<span class="udiff-line-added">+     if (!percentHeightDescendants)</span>
<span class="udiff-line-added">+         return false;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     for (auto it = percentHeightDescendants-&gt;begin(), end = percentHeightDescendants-&gt;end(); it != end; ++it) {</span>
<span class="udiff-line-added">+         bool hasOutOfFlowAncestor = false;</span>
<span class="udiff-line-added">+         for (auto* ancestor = (*it)-&gt;containingBlock(); ancestor &amp;&amp; ancestor != &amp;renderBlock; ancestor = ancestor-&gt;containingBlock()) {</span>
<span class="udiff-line-added">+             if (ancestor-&gt;isOutOfFlowPositioned()) {</span>
<span class="udiff-line-added">+                 hasOutOfFlowAncestor = true;</span>
<span class="udiff-line-added">+                 break;</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (!hasOutOfFlowAncestor)</span>
<span class="udiff-line-added">+             return true;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     return false;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  void RenderFlexibleBox::layoutAndPlaceChildren(LayoutUnit&amp; crossAxisOffset, Vector&lt;FlexItem&gt;&amp; children, LayoutUnit availableFreeSpace, bool relayoutChildren, Vector&lt;LineContext&gt;&amp; lineContexts)
  {
      ContentPosition position = style().resolvedJustifyContentPosition(contentAlignmentNormalBehavior());
      ContentDistribution distribution = style().resolvedJustifyContentDistribution(contentAlignmentNormalBehavior());
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1568,11 +1596,11 @@</span>
              resetAutoMarginsAndLogicalTopInCrossAxis(child);
          }
          // We may have already forced relayout for orthogonal flowing children in
          // computeInnerFlexBaseSizeForChild.
          bool forceChildRelayout = relayoutChildren &amp;&amp; !m_relaidOutChildren.contains(&amp;child);
<span class="udiff-line-modified-removed">-         if (child.isRenderBlock() &amp;&amp; downcast&lt;RenderBlock&gt;(child).hasPercentHeightDescendants()) {</span>
<span class="udiff-line-modified-added">+         if (!forceChildRelayout &amp;&amp; hasPercentHeightDescendants(child)) {</span>
              // Have to force another relayout even though the child is sized
              // correctly, because its descendants are not sized correctly yet. Our
              // previous layout of the child was done without an override height set.
              // So, redo it here.
              forceChildRelayout = true;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1811,14 +1839,14 @@</span>
              childNeedsRelayout = true;
          }
          if (childNeedsRelayout || !child.hasOverrideContentLogicalHeight())
              child.setOverrideContentLogicalHeight(desiredLogicalHeight - child.borderAndPaddingLogicalHeight());
          if (childNeedsRelayout) {
<span class="udiff-line-modified-removed">-             child.setLogicalHeight(0_lu);</span>
<span class="udiff-line-modified-added">+             SetForScope&lt;bool&gt; resetChildLogicalHeight(m_shouldResetChildLogicalHeightBeforeLayout, true);</span>
              // We cache the child&#39;s intrinsic content logical height to avoid it being
              // reset to the stretched height.
<span class="udiff-line-modified-removed">-             // FIXME: This is fragile. RendertBoxes should be smart enough to</span>
<span class="udiff-line-modified-added">+             // FIXME: This is fragile. RenderBoxes should be smart enough to</span>
              // determine their intrinsic content logical height correctly even when
              // there&#39;s an overrideHeight.
              LayoutUnit childIntrinsicContentLogicalHeight = cachedChildIntrinsicContentLogicalHeight(child);
              child.setChildNeedsLayout(MarkOnlyThis);
  
</pre>
<center><a href="RenderEmbeddedObject.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RenderFlexibleBox.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>