<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/builtins/AsyncFromSyncIteratorPrototype.js</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ArrayPrototype.js.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="AsyncFunctionPrototype.js.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/builtins/AsyncFromSyncIteratorPrototype.js</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
  2  * Copyright (C) 2017 Oleksandr Skachkov &lt;gskachkov@gmail.com&gt;.

  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 function next(value)
 27 {
 28     &quot;use strict&quot;;
 29 
<span class="line-modified"> 30     const promiseCapability = @newPromiseCapability(@Promise);</span>
 31 
 32     if (!@isObject(this) || !@isObject(@getByIdDirectPrivate(this, &quot;syncIterator&quot;))) {
<span class="line-modified"> 33         promiseCapability.@reject.@call(@undefined, @makeTypeError(&#39;Iterator is not an object.&#39;));</span>
<span class="line-modified"> 34         return promiseCapability.@promise;</span>
 35     }
 36 
<span class="line-modified"> 37     const syncIterator = @getByIdDirectPrivate(this, &quot;syncIterator&quot;);</span>
 38 
 39     try {
<span class="line-modified"> 40         const { value: nextValue, done: nextDone } = @getByIdDirectPrivate(this, &quot;nextMethod&quot;).@call(syncIterator, value);</span>
<span class="line-modified"> 41         const valueWrapperCapability = @newPromiseCapability(@Promise);</span>
<span class="line-modified"> 42         valueWrapperCapability.@resolve.@call(@undefined, nextValue);</span>
<span class="line-modified"> 43         valueWrapperCapability.@promise.@then(</span>
<span class="line-modified"> 44             function (result) { promiseCapability.@resolve.@call(@undefined, { value: result, done: !!nextDone }); },</span>
<span class="line-modified"> 45             function (error) { promiseCapability.@reject.@call(@undefined, error); });</span>
<span class="line-modified"> 46      } catch(e) {</span>
<span class="line-modified"> 47          promiseCapability.@reject.@call(@undefined, e);</span>
<span class="line-modified"> 48      }</span>
<span class="line-modified"> 49 </span>
<span class="line-modified"> 50     return promiseCapability.@promise;</span>
 51 }
 52 
 53 function return(value)
 54 {
 55     &quot;use strict&quot;;
 56 
<span class="line-modified"> 57     const promiseCapability = @newPromiseCapability(@Promise);</span>
 58 
 59     if (!@isObject(this) || !@isObject(@getByIdDirectPrivate(this, &quot;syncIterator&quot;))) {
<span class="line-modified"> 60         promiseCapability.@reject.@call(@undefined, @makeTypeError(&#39;Iterator is not an object.&#39;));</span>
<span class="line-modified"> 61         return promiseCapability.@promise;</span>
 62     }
 63 
<span class="line-modified"> 64     const syncIterator = @getByIdDirectPrivate(this, &quot;syncIterator&quot;);</span>
 65 
<span class="line-modified"> 66     let returnMethod;</span>
 67 
 68     try {
 69         returnMethod = syncIterator.return;
 70     } catch (e) {
<span class="line-modified"> 71         promiseCapability.@reject.@call(@undefined, e);</span>
<span class="line-modified"> 72         return promiseCapability.@promise;</span>
 73     }
 74 
 75     if (returnMethod === @undefined) {
<span class="line-modified"> 76         promiseCapability.@resolve.@call(@undefined, { value, done: true });</span>
<span class="line-modified"> 77         return promiseCapability.@promise;</span>
 78     }
 79     
 80     try {
<span class="line-modified"> 81         const returnResult = returnMethod.@call(syncIterator, value);</span>
 82 
 83         if (!@isObject(returnResult)) {
<span class="line-modified"> 84             promiseCapability.@reject.@call(@undefined, @makeTypeError(&#39;Iterator result interface is not an object.&#39;));</span>
<span class="line-modified"> 85             return promiseCapability.@promise;</span>
 86         }
 87 
<span class="line-modified"> 88         const { value: resultValue, done: resultDone } = returnResult;</span>
<span class="line-modified"> 89         const valueWrapperCapability = @newPromiseCapability(@Promise);</span>
<span class="line-modified"> 90 </span>
<span class="line-modified"> 91         valueWrapperCapability.@resolve.@call(@undefined, resultValue);</span>
<span class="line-modified"> 92         valueWrapperCapability.@promise.@then(</span>
<span class="line-removed"> 93             function (result) { promiseCapability.@resolve.@call(@undefined, { value: result, done: resultDone }); },</span>
<span class="line-removed"> 94             function (error) { promiseCapability.@reject.@call(@undefined, error); });</span>
 95     } catch (e) {
<span class="line-modified"> 96         promiseCapability.@reject.@call(@undefined, e);</span>
 97     }
 98 
<span class="line-modified"> 99     return promiseCapability.@promise;</span>
100 }
101 
102 function throw(exception)
103 {
104     &quot;use strict&quot;;
105 
<span class="line-modified">106     const promiseCapability = @newPromiseCapability(@Promise);</span>
107 
108     if (!@isObject(this) || !@isObject(@getByIdDirectPrivate(this, &quot;syncIterator&quot;))) {
<span class="line-modified">109         promiseCapability.@reject.@call(@undefined, @makeTypeError(&#39;Iterator is not an object.&#39;));</span>
<span class="line-modified">110         return promiseCapability.@promise;</span>
111     }
112 
<span class="line-modified">113     const syncIterator = @getByIdDirectPrivate(this, &quot;syncIterator&quot;);</span>
114 
<span class="line-modified">115     let throwMethod;</span>
116 
117     try {
118         throwMethod = syncIterator.throw;
119     } catch (e) {
<span class="line-modified">120         promiseCapability.@reject.@call(@undefined, e);</span>
<span class="line-modified">121         return promiseCapability.@promise;</span>
122     }
123 
124     if (throwMethod === @undefined) {
<span class="line-modified">125         promiseCapability.@reject.@call(@undefined, exception);</span>
<span class="line-modified">126         return promiseCapability.@promise;</span>
127     }
128     
129     try {
<span class="line-modified">130         const throwResult = throwMethod.@call(syncIterator, exception);</span>
131         
132         if (!@isObject(throwResult)) {
<span class="line-modified">133             promiseCapability.@reject.@call(@undefined, @makeTypeError(&#39;Iterator result interface is not an object.&#39;));</span>
<span class="line-modified">134             return promiseCapability.@promise;</span>
135         }
136         
<span class="line-modified">137         const { value: throwValue, done: throwDone } = throwResult;</span>
<span class="line-modified">138         const valueWrapperCapability = @newPromiseCapability(@Promise);</span>
<span class="line-modified">139         </span>
<span class="line-modified">140         valueWrapperCapability.@resolve.@call(@undefined, throwValue);</span>
<span class="line-modified">141         valueWrapperCapability.@promise.@then(</span>
<span class="line-removed">142             function (result) { promiseCapability.@resolve.@call(@undefined, { value: result, done: throwDone }); },</span>
<span class="line-removed">143             function (error) { promiseCapability.@reject.@call(@undefined, error); });</span>
144     } catch (e) {
<span class="line-modified">145         promiseCapability.@reject.@call(@undefined, e);</span>
146     }
147     
<span class="line-modified">148     return promiseCapability.@promise;</span>
149 }
150 
151 @globalPrivate
152 function createAsyncFromSyncIterator(syncIterator, nextMethod)
153 {
154     &quot;use strict&quot;;
155 
156     if (!@isObject(syncIterator))
157         @throwTypeError(&#39;Only objects can be wrapped by async-from-sync wrapper&#39;);
158 
159     return new @AsyncFromSyncIterator(syncIterator, nextMethod);
160 }
161 
162 @globalPrivate
163 @constructor
164 function AsyncFromSyncIterator(syncIterator, nextMethod)
165 {
166     &quot;use strict&quot;;
167 
168     @putByIdDirectPrivate(this, &quot;syncIterator&quot;, syncIterator);
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
  2  * Copyright (C) 2017 Oleksandr Skachkov &lt;gskachkov@gmail.com&gt;.
<span class="line-added">  3  * Copyright (C) 2019 Apple Inc. All rights reserved.</span>
  4  *
  5  * Redistribution and use in source and binary forms, with or without
  6  * modification, are permitted provided that the following conditions
  7  * are met:
  8  * 1. Redistributions of source code must retain the above copyright
  9  *    notice, this list of conditions and the following disclaimer.
 10  * 2. Redistributions in binary form must reproduce the above copyright
 11  *    notice, this list of conditions and the following disclaimer in the
 12  *    documentation and/or other materials provided with the distribution.
 13  *
 14  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 15  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 16  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 17  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 18  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 19  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 20  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 21  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 22  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 23  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 24  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 25  */
 26 
 27 function next(value)
 28 {
 29     &quot;use strict&quot;;
 30 
<span class="line-modified"> 31     var promise = @newPromise();</span>
 32 
 33     if (!@isObject(this) || !@isObject(@getByIdDirectPrivate(this, &quot;syncIterator&quot;))) {
<span class="line-modified"> 34         @rejectPromiseWithFirstResolvingFunctionCallCheck(promise, @makeTypeError(&#39;Iterator is not an object.&#39;));</span>
<span class="line-modified"> 35         return promise;</span>
 36     }
 37 
<span class="line-modified"> 38     var syncIterator = @getByIdDirectPrivate(this, &quot;syncIterator&quot;);</span>
 39 
 40     try {
<span class="line-modified"> 41         var nextResult = @getByIdDirectPrivate(this, &quot;nextMethod&quot;).@call(syncIterator, value);</span>
<span class="line-modified"> 42         var nextDone = !!nextResult.done;</span>
<span class="line-modified"> 43         var nextValue = nextResult.value;</span>
<span class="line-modified"> 44         @resolveWithoutPromise(nextValue,</span>
<span class="line-modified"> 45             function (result) { @resolvePromiseWithFirstResolvingFunctionCallCheck(promise, { value: result, done: nextDone }); },</span>
<span class="line-modified"> 46             function (error) { @rejectPromiseWithFirstResolvingFunctionCallCheck(promise, error); });</span>
<span class="line-modified"> 47     } catch (e) {</span>
<span class="line-modified"> 48         @rejectPromiseWithFirstResolvingFunctionCallCheck(promise, e);</span>
<span class="line-modified"> 49     }</span>
<span class="line-modified"> 50 </span>
<span class="line-modified"> 51     return promise;</span>
 52 }
 53 
 54 function return(value)
 55 {
 56     &quot;use strict&quot;;
 57 
<span class="line-modified"> 58     var promise = @newPromise();</span>
 59 
 60     if (!@isObject(this) || !@isObject(@getByIdDirectPrivate(this, &quot;syncIterator&quot;))) {
<span class="line-modified"> 61         @rejectPromiseWithFirstResolvingFunctionCallCheck(promise, @makeTypeError(&#39;Iterator is not an object.&#39;));</span>
<span class="line-modified"> 62         return promise;</span>
 63     }
 64 
<span class="line-modified"> 65     var syncIterator = @getByIdDirectPrivate(this, &quot;syncIterator&quot;);</span>
 66 
<span class="line-modified"> 67     var returnMethod;</span>
 68 
 69     try {
 70         returnMethod = syncIterator.return;
 71     } catch (e) {
<span class="line-modified"> 72         @rejectPromiseWithFirstResolvingFunctionCallCheck(promise, e);</span>
<span class="line-modified"> 73         return promise;</span>
 74     }
 75 
 76     if (returnMethod === @undefined) {
<span class="line-modified"> 77         @resolvePromiseWithFirstResolvingFunctionCallCheck(promise, { value, done: true });</span>
<span class="line-modified"> 78         return promise;</span>
 79     }
 80     
 81     try {
<span class="line-modified"> 82         var returnResult = returnMethod.@call(syncIterator, value);</span>
 83 
 84         if (!@isObject(returnResult)) {
<span class="line-modified"> 85             @rejectPromiseWithFirstResolvingFunctionCallCheck(promise, @makeTypeError(&#39;Iterator result interface is not an object.&#39;));</span>
<span class="line-modified"> 86             return promise;</span>
 87         }
 88 
<span class="line-modified"> 89         var resultDone = !!returnResult.done;</span>
<span class="line-modified"> 90         var resultValue = returnResult.value;</span>
<span class="line-modified"> 91         @resolveWithoutPromise(resultValue,</span>
<span class="line-modified"> 92             function (result) { @resolvePromiseWithFirstResolvingFunctionCallCheck(promise, { value: result, done: resultDone }); },</span>
<span class="line-modified"> 93             function (error) { @rejectPromiseWithFirstResolvingFunctionCallCheck(promise, error); });</span>


 94     } catch (e) {
<span class="line-modified"> 95         @rejectPromiseWithFirstResolvingFunctionCallCheck(promise, e);</span>
 96     }
 97 
<span class="line-modified"> 98     return promise;</span>
 99 }
100 
101 function throw(exception)
102 {
103     &quot;use strict&quot;;
104 
<span class="line-modified">105     var promise = @newPromise();</span>
106 
107     if (!@isObject(this) || !@isObject(@getByIdDirectPrivate(this, &quot;syncIterator&quot;))) {
<span class="line-modified">108         @rejectPromiseWithFirstResolvingFunctionCallCheck(promise, @makeTypeError(&#39;Iterator is not an object.&#39;));</span>
<span class="line-modified">109         return promise;</span>
110     }
111 
<span class="line-modified">112     var syncIterator = @getByIdDirectPrivate(this, &quot;syncIterator&quot;);</span>
113 
<span class="line-modified">114     var throwMethod;</span>
115 
116     try {
117         throwMethod = syncIterator.throw;
118     } catch (e) {
<span class="line-modified">119         @rejectPromiseWithFirstResolvingFunctionCallCheck(promise, e);</span>
<span class="line-modified">120         return promise;</span>
121     }
122 
123     if (throwMethod === @undefined) {
<span class="line-modified">124         @rejectPromiseWithFirstResolvingFunctionCallCheck(promise, exception);</span>
<span class="line-modified">125         return promise;</span>
126     }
127     
128     try {
<span class="line-modified">129         var throwResult = throwMethod.@call(syncIterator, exception);</span>
130         
131         if (!@isObject(throwResult)) {
<span class="line-modified">132             @rejectPromiseWithFirstResolvingFunctionCallCheck(promise, @makeTypeError(&#39;Iterator result interface is not an object.&#39;));</span>
<span class="line-modified">133             return promise;</span>
134         }
135         
<span class="line-modified">136         var throwDone = !!throwResult.done;</span>
<span class="line-modified">137         var throwValue = throwResult.value;</span>
<span class="line-modified">138         @resolveWithoutPromise(throwValue,</span>
<span class="line-modified">139             function (result) { @resolvePromiseWithFirstResolvingFunctionCallCheck(promise, { value: result, done: throwDone }); },</span>
<span class="line-modified">140             function (error) { @rejectPromiseWithFirstResolvingFunctionCallCheck(promise, error); });</span>


141     } catch (e) {
<span class="line-modified">142         @rejectPromiseWithFirstResolvingFunctionCallCheck(promise, e);</span>
143     }
144     
<span class="line-modified">145     return promise;</span>
146 }
147 
148 @globalPrivate
149 function createAsyncFromSyncIterator(syncIterator, nextMethod)
150 {
151     &quot;use strict&quot;;
152 
153     if (!@isObject(syncIterator))
154         @throwTypeError(&#39;Only objects can be wrapped by async-from-sync wrapper&#39;);
155 
156     return new @AsyncFromSyncIterator(syncIterator, nextMethod);
157 }
158 
159 @globalPrivate
160 @constructor
161 function AsyncFromSyncIterator(syncIterator, nextMethod)
162 {
163     &quot;use strict&quot;;
164 
165     @putByIdDirectPrivate(this, &quot;syncIterator&quot;, syncIterator);
</pre>
</td>
</tr>
</table>
<center><a href="ArrayPrototype.js.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="AsyncFunctionPrototype.js.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>