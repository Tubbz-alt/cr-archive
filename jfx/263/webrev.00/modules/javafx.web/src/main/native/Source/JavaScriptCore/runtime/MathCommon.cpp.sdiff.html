<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/MathCommon.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MapPrototype.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MathObject.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/MathCommon.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;MathCommon.h&quot;
 28 
 29 #include &quot;PureNaN.h&quot;
 30 
 31 namespace JSC {
 32 
<span class="line-modified"> 33 #if PLATFORM(IOS_FAMILY) &amp;&amp; CPU(ARM_THUMB2)</span>
 34 
 35 // The following code is taken from netlib.org:
 36 //   http://www.netlib.org/fdlibm/fdlibm.h
 37 //   http://www.netlib.org/fdlibm/e_pow.c
 38 //   http://www.netlib.org/fdlibm/s_scalbn.c
 39 //
 40 // And was originally distributed under the following license:
 41 
 42 /*
 43  * ====================================================
 44  * Copyright (C) 1993 by Sun Microsystems, Inc. All rights reserved.
 45  *
 46  * Developed at SunSoft, a Sun Microsystems, Inc. business.
 47  * Permission to use, copy, modify, and distribute this
 48  * software is freely granted, provided that this notice
 49  * is preserved.
 50  * ====================================================
 51  */
 52 /*
 53  * ====================================================
</pre>
<hr />
<pre>
462 
463 #if HAVE(ARM_IDIV_INSTRUCTIONS)
464 static inline bool isStrictInt32(double value)
465 {
466     int32_t valueAsInt32 = static_cast&lt;int32_t&gt;(value);
467     if (value != valueAsInt32)
468         return false;
469 
470     if (!valueAsInt32) {
471         if (std::signbit(value))
472             return false;
473     }
474     return true;
475 }
476 #endif
477 
478 extern &quot;C&quot; {
479 double jsRound(double value)
480 {
481     double integer = ceil(value);
<span class="line-modified">482     return integer - (integer - value &gt; 0.5);</span>
483 }
484 
485 #if CALLING_CONVENTION_IS_STDCALL || CPU(ARM_THUMB2)
486 double jsMod(double x, double y)
487 {
488 #if HAVE(ARM_IDIV_INSTRUCTIONS)
489     // fmod() does not have exact results for integer on ARMv7.
490     // When DFG/FTL use IDIV, the result of op_mod can change if we use fmod().
491     //
492     // We implement here the same algorithm and conditions as the upper tier to keep
493     // a stable result when tiering up.
494     if (y) {
495         if (isStrictInt32(x) &amp;&amp; isStrictInt32(y)) {
496             int32_t xAsInt32 = static_cast&lt;int32_t&gt;(x);
497             int32_t yAsInt32 = static_cast&lt;int32_t&gt;(y);
498             int32_t quotient = xAsInt32 / yAsInt32;
499             if (!productOverflows&lt;int32_t&gt;(quotient, yAsInt32)) {
500                 int32_t remainder = xAsInt32 - (quotient * yAsInt32);
501                 if (remainder || xAsInt32 &gt;= 0)
502                     return remainder;
</pre>
</td>
<td>
<hr />
<pre>
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;MathCommon.h&quot;
 28 
 29 #include &quot;PureNaN.h&quot;
 30 
 31 namespace JSC {
 32 
<span class="line-modified"> 33 #if OS(DARWIN) &amp;&amp; CPU(ARM_THUMB2)</span>
 34 
 35 // The following code is taken from netlib.org:
 36 //   http://www.netlib.org/fdlibm/fdlibm.h
 37 //   http://www.netlib.org/fdlibm/e_pow.c
 38 //   http://www.netlib.org/fdlibm/s_scalbn.c
 39 //
 40 // And was originally distributed under the following license:
 41 
 42 /*
 43  * ====================================================
 44  * Copyright (C) 1993 by Sun Microsystems, Inc. All rights reserved.
 45  *
 46  * Developed at SunSoft, a Sun Microsystems, Inc. business.
 47  * Permission to use, copy, modify, and distribute this
 48  * software is freely granted, provided that this notice
 49  * is preserved.
 50  * ====================================================
 51  */
 52 /*
 53  * ====================================================
</pre>
<hr />
<pre>
462 
463 #if HAVE(ARM_IDIV_INSTRUCTIONS)
464 static inline bool isStrictInt32(double value)
465 {
466     int32_t valueAsInt32 = static_cast&lt;int32_t&gt;(value);
467     if (value != valueAsInt32)
468         return false;
469 
470     if (!valueAsInt32) {
471         if (std::signbit(value))
472             return false;
473     }
474     return true;
475 }
476 #endif
477 
478 extern &quot;C&quot; {
479 double jsRound(double value)
480 {
481     double integer = ceil(value);
<span class="line-modified">482     return integer - (integer - 0.5 &gt; value);</span>
483 }
484 
485 #if CALLING_CONVENTION_IS_STDCALL || CPU(ARM_THUMB2)
486 double jsMod(double x, double y)
487 {
488 #if HAVE(ARM_IDIV_INSTRUCTIONS)
489     // fmod() does not have exact results for integer on ARMv7.
490     // When DFG/FTL use IDIV, the result of op_mod can change if we use fmod().
491     //
492     // We implement here the same algorithm and conditions as the upper tier to keep
493     // a stable result when tiering up.
494     if (y) {
495         if (isStrictInt32(x) &amp;&amp; isStrictInt32(y)) {
496             int32_t xAsInt32 = static_cast&lt;int32_t&gt;(x);
497             int32_t yAsInt32 = static_cast&lt;int32_t&gt;(y);
498             int32_t quotient = xAsInt32 / yAsInt32;
499             if (!productOverflows&lt;int32_t&gt;(quotient, yAsInt32)) {
500                 int32_t remainder = xAsInt32 - (quotient * yAsInt32);
501                 if (remainder || xAsInt32 &gt;= 0)
502                     return remainder;
</pre>
</td>
</tr>
</table>
<center><a href="MapPrototype.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MathObject.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>