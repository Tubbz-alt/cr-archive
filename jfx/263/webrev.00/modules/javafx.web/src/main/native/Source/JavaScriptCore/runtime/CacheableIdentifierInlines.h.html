<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/CacheableIdentifierInlines.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2020 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;CacheableIdentifier.h&quot;
 29 
 30 #include &quot;Identifier.h&quot;
 31 #include &quot;JSCJSValueInlines.h&quot;
 32 #include &quot;JSCell.h&quot;
 33 #include &quot;VM.h&quot;
 34 #include &lt;wtf/text/UniquedStringImpl.h&gt;
 35 
 36 namespace JSC {
 37 
 38 inline CacheableIdentifier::CacheableIdentifier(const Identifier&amp; identifier)
 39 {
 40     setUidBits(identifier.impl());
 41 }
 42 
 43 inline CacheableIdentifier::CacheableIdentifier(JSCell* identifier)
 44 {
 45     setCellBits(identifier);
 46 }
 47 
 48 inline JSCell* CacheableIdentifier::cell() const
 49 {
 50     ASSERT(isCell());
 51     return bitwise_cast&lt;JSCell*&gt;(m_bits);
 52 }
 53 
 54 inline UniquedStringImpl* CacheableIdentifier::uid() const
 55 {
 56     if (!m_bits)
 57         return nullptr;
 58     if (isUid())
 59         return bitwise_cast&lt;UniquedStringImpl*&gt;(m_bits &amp; ~s_uidTag);
 60     if (isSymbolCell())
 61         return &amp;jsCast&lt;Symbol*&gt;(cell())-&gt;uid();
 62     ASSERT(isStringCell());
 63     JSString* string = jsCast&lt;JSString*&gt;(cell());
 64     return bitwise_cast&lt;UniquedStringImpl*&gt;(string-&gt;getValueImpl());
 65 }
 66 
 67 inline bool CacheableIdentifier::isCacheableIdentifierCell(JSCell* cell)
 68 {
 69     if (cell-&gt;isSymbol())
 70         return true;
 71     if (!cell-&gt;isString())
 72         return false;
 73     JSString* string = jsCast&lt;JSString*&gt;(cell);
 74     if (const StringImpl* impl = string-&gt;tryGetValueImpl())
 75         return impl-&gt;isAtom();
 76     return false;
 77 }
 78 
 79 inline bool CacheableIdentifier::isCacheableIdentifierCell(JSValue value)
 80 {
 81     if (!value.isCell())
 82         return false;
 83     return isCacheableIdentifierCell(value.asCell());
 84 }
 85 
 86 inline bool CacheableIdentifier::isSymbolCell() const
 87 {
 88     return isCell() &amp;&amp; cell()-&gt;isSymbol();
 89 }
 90 
 91 inline bool CacheableIdentifier::isStringCell() const
 92 {
 93     return isCell() &amp;&amp; cell()-&gt;isString();
 94 }
 95 
 96 inline void CacheableIdentifier::setCellBits(JSCell* cell)
 97 {
 98     RELEASE_ASSERT(isCacheableIdentifierCell(cell));
 99     m_bits = bitwise_cast&lt;uintptr_t&gt;(cell);
100 }
101 
102 inline void CacheableIdentifier::setUidBits(UniquedStringImpl* uid)
103 {
104     m_bits = bitwise_cast&lt;uintptr_t&gt;(uid) | s_uidTag;
105 }
106 
107 inline void CacheableIdentifier::visitAggregate(SlotVisitor&amp; visitor) const
108 {
109     if (m_bits &amp;&amp; isCell())
110         visitor.appendUnbarriered(cell());
111 }
112 
113 
114 inline bool CacheableIdentifier::operator==(const CacheableIdentifier&amp; other) const
115 {
116     return uid() == other.uid();
117 }
118 
119 inline bool CacheableIdentifier::operator!=(const CacheableIdentifier&amp; other) const
120 {
121     return uid() != other.uid();
122 }
123 
124 inline bool CacheableIdentifier::operator==(const Identifier&amp; other) const
125 {
126     return uid() == other.impl();
127 }
128 
129 } // namespace JSC
    </pre>
  </body>
</html>