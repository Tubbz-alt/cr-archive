<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/JavaScriptCore/builtins/TypedArrayConstructor.js</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2015 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 // According to the spec we are supposed to crawl the prototype chain looking
 27 // for the a TypedArray constructor. The way we implement this is with a
 28 // private function, @alloctateTypedArray, on each of the prototypes.
 29 // This enables us to optimize this lookup in the inline cache.
 30 
 31 function of(/* items... */)
 32 {
 33     &quot;use strict&quot;;
 34     var len = arguments.length;
 35     var constructFunction = @getByIdDirectPrivate(this, &quot;allocateTypedArray&quot;);
 36     if (constructFunction === @undefined)
 37         @throwTypeError(&quot;TypedArray.of requires its this argument to subclass a TypedArray constructor&quot;);
 38 
 39     var result = constructFunction(len);
 40 
 41     for (var i = 0; i &lt; len; i++)
 42         result[i] = arguments[i];
 43 
 44     return result;
 45 }
 46 
 47 function from(items /* [ , mapfn [ , thisArg ] ] */)
 48 {
 49     &quot;use strict&quot;;
 50 
 51     var mapFn = @argument(1);
 52 
 53     var thisArg;
 54 
 55     if (mapFn !== @undefined) {
 56         if (typeof mapFn !== &quot;function&quot;)
 57             @throwTypeError(&quot;TypedArray.from requires that the second argument, when provided, be a function&quot;);
 58 
 59         thisArg = @argument(2);
 60     }
 61 
 62     var arrayLike = @toObject(items, &quot;TypedArray.from requires an array-like object - not null or undefined&quot;);
 63 
 64     var iteratorMethod = items.@iteratorSymbol;
 65     if (iteratorMethod != null) {
 66         if (typeof iteratorMethod !== &quot;function&quot;)
 67             @throwTypeError(&quot;TypedArray.from requires that the property of the first argument, items[Symbol.iterator], when exists, be a function&quot;);
 68 
 69         var accumulator = [];
 70 
 71         var k = 0;
 72         var iterator = iteratorMethod.@call(items);
 73 
 74         // Since for-of loop once more looks up the @@iterator property of a given iterable,
 75         // it could be observable if the user defines a getter for @@iterator.
 76         // To avoid this situation, we define a wrapper object that @@iterator just returns a given iterator.
 77         var wrapper = {};
 78         wrapper.@iteratorSymbol = function() { return iterator; }
 79 
 80         for (var value of wrapper) {
 81             if (mapFn)
 82                 @putByValDirect(accumulator, k, thisArg === @undefined ? mapFn(value, k) : mapFn.@call(thisArg, value, k));
 83             else
 84                 @putByValDirect(accumulator, k, value);
 85             k++;
 86         }
 87 
 88         var constructFunction = @getByIdDirectPrivate(this, &quot;allocateTypedArray&quot;);
 89         if (constructFunction === @undefined)
 90             @throwTypeError(&quot;TypedArray.from requires its this argument subclass a TypedArray constructor&quot;);
 91 
 92         var result = constructFunction(k);
 93 
 94         for (var i = 0; i &lt; k; i++)
 95             result[i] = accumulator[i];
 96 
 97 
 98         return result;
 99     }
100 
101     var arrayLikeLength = @toLength(arrayLike.length);
102 
103     var constructFunction = @getByIdDirectPrivate(this, &quot;allocateTypedArray&quot;);
104     if (constructFunction === @undefined)
105         @throwTypeError(&quot;this does not subclass a TypedArray constructor&quot;);
106 
107     var result = constructFunction(arrayLikeLength);
108 
109     var k = 0;
110     while (k &lt; arrayLikeLength) {
111         var value = arrayLike[k];
112         if (mapFn)
113             result[k] = thisArg === @undefined ? mapFn(value, k) : mapFn.@call(thisArg, value, k);
114         else
115             result[k] = value;
116         k++;
117     }
118 
119     return result;
120 }
121 
122 function allocateInt8Array(length)
123 {
124     return new @Int8Array(length);
125 }
126 
127 function allocateInt16Array(length)
128 {
129     return new @Int16Array(length);    
130 }
131 
132 function allocateInt32Array(length)
133 {
134     return new @Int32Array(length);   
135 }
136 
137 function allocateUint32Array(length)
138 {
139     return new @Uint32Array(length);
140 }
141 
142 function allocateUint16Array(length)
143 {
144     return new @Uint16Array(length);   
145 }
146 
147 function allocateUint8Array(length)
148 {
149     return new @Uint8Array(length);   
150 }
151 
152 function allocateUint8ClampedArray(length)
153 {
154     return new @Uint8ClampedArray(length);
155 }
156 
157 function allocateFloat32Array(length)
158 {
159     return new @Float32Array(length);
160 }
161 
162 function allocateFloat64Array(length)
163 {
164     return new @Float64Array(length);
165 }
    </pre>
  </body>
</html>