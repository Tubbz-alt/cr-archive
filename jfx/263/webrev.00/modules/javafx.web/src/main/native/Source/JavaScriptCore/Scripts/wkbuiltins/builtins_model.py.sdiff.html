<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/Scripts/wkbuiltins/builtins_model.py</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="builtins_generator.py.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="builtins_templates.py.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/Scripts/wkbuiltins/builtins_model.py</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 27 import re
 28 import os
 29 
 30 from builtins_templates import BuiltinsGeneratorTemplates as Templates
 31 
 32 log = logging.getLogger(&#39;global&#39;)
 33 
 34 _FRAMEWORK_CONFIG_MAP = {
 35     &quot;JavaScriptCore&quot;: {
 36         &quot;macro_prefix&quot;: &quot;JSC&quot;,
 37         &quot;namespace&quot;: &quot;JSC&quot;,
 38     },
 39     &quot;WebCore&quot;: {
 40         &quot;macro_prefix&quot;: &quot;WEBCORE&quot;,
 41         &quot;namespace&quot;: &quot;WebCore&quot;,
 42     },
 43 }
 44 
 45 functionHeadRegExp = re.compile(r&quot;(?:@[\w|=\[\] \&quot;\.]+\s*\n)*(?:async\s+)?function\s+\w+\s*\(.*?\)&quot;, re.MULTILINE | re.DOTALL)
 46 functionGlobalPrivateRegExp = re.compile(r&quot;.*^@globalPrivate&quot;, re.MULTILINE | re.DOTALL)

 47 functionIntrinsicRegExp = re.compile(r&quot;.*^@intrinsic=(\w+)&quot;, re.MULTILINE | re.DOTALL)
 48 functionIsConstructorRegExp = re.compile(r&quot;.*^@constructor&quot;, re.MULTILINE | re.DOTALL)
 49 functionIsGetterRegExp = re.compile(r&quot;.*^@getter&quot;, re.MULTILINE | re.DOTALL)
 50 functionIsAsyncRegExp = re.compile(r&quot;(async)?\s*function&quot;, re.MULTILINE | re.DOTALL)
 51 functionNameRegExp = re.compile(r&quot;function\s+(\w+)\s*\(&quot;, re.MULTILINE | re.DOTALL)
 52 functionOverriddenNameRegExp = re.compile(r&quot;.*^@overriddenName=(\&quot;.+\&quot;)$&quot;, re.MULTILINE | re.DOTALL)
 53 functionParameterFinder = re.compile(r&quot;^(?:async\s+)?function\s+(?:\w+)\s*\(((?:\s*\w+)?\s*(?:\s*,\s*\w+)*)?\s*\)&quot;, re.MULTILINE | re.DOTALL)
 54 
 55 multilineCommentRegExp = re.compile(r&quot;\/\*.*?\*\/&quot;, re.MULTILINE | re.DOTALL)
 56 singleLineCommentRegExp = re.compile(r&quot;\/\/.*?\n&quot;, re.MULTILINE | re.DOTALL)
 57 keyValueAnnotationCommentRegExp = re.compile(r&quot;^\/\/ @(\w+)=([^=]+?)\n&quot;, re.MULTILINE | re.DOTALL)
 58 flagAnnotationCommentRegExp = re.compile(r&quot;^\/\/ @(\w+)[^=]*?\n&quot;, re.MULTILINE | re.DOTALL)
 59 lineWithOnlySingleLineCommentRegExp = re.compile(r&quot;^\s*\/\/\n&quot;, re.MULTILINE | re.DOTALL)
 60 lineWithTrailingSingleLineCommentRegExp = re.compile(r&quot;\s*\/\/\n&quot;, re.MULTILINE | re.DOTALL)
 61 leadingWhitespaceRegExp = re.compile(r&quot;^ +&quot;, re.MULTILINE | re.DOTALL)
 62 multipleEmptyLinesRegExp = re.compile(r&quot;\n{2,}&quot;, re.MULTILINE | re.DOTALL)
 63 
 64 class ParseException(Exception):
 65     pass
 66 
</pre>
<hr />
<pre>
 84         raise ParseException(&quot;Unknown framework: %s&quot; % frameworkString)
 85 
 86 
 87 class Frameworks:
 88     JavaScriptCore = Framework(&quot;JavaScriptCore&quot;)
 89     WebCore = Framework(&quot;WebCore&quot;)
 90 
 91 
 92 class BuiltinObject:
 93     def __init__(self, object_name, annotations, functions):
 94         self.object_name = object_name
 95         self.annotations = annotations
 96         self.functions = functions
 97         self.collection = None  # Set by the owning BuiltinsCollection
 98 
 99         for function in self.functions:
100             function.object = self
101 
102 
103 class BuiltinFunction:
<span class="line-modified">104     def __init__(self, function_name, function_source, parameters, is_async, is_constructor, is_global_private, intrinsic, overridden_name):</span>
105         self.function_name = function_name
106         self.function_source = function_source
107         self.parameters = parameters
108         self.is_async = is_async
109         self.is_constructor = is_constructor

110         self.is_global_private = is_global_private
111         self.intrinsic = intrinsic
112         self.overridden_name = overridden_name
113         self.object = None  # Set by the owning BuiltinObject
114 
115     @staticmethod
116     def fromString(function_string):
117         function_source = multilineCommentRegExp.sub(&quot;&quot;, function_string)
118 
119         intrinsic = &quot;NoIntrinsic&quot;
120         intrinsicMatch = functionIntrinsicRegExp.search(function_source)
121         if intrinsicMatch:
122             intrinsic = intrinsicMatch.group(1)
123             function_source = functionIntrinsicRegExp.sub(&quot;&quot;, function_source)
124 
125         overridden_name = None
126         overriddenNameMatch = functionOverriddenNameRegExp.search(function_source)
127         if overriddenNameMatch:
128             overridden_name = overriddenNameMatch.group(1)
129             function_source = functionOverriddenNameRegExp.sub(&quot;&quot;, function_source)
130 
131         if not os.getenv(&quot;CONFIGURATION&quot;, &quot;Debug&quot;).startswith(&quot;Debug&quot;):
132             function_source = lineWithOnlySingleLineCommentRegExp.sub(&quot;&quot;, function_source)
133             function_source = lineWithTrailingSingleLineCommentRegExp.sub(&quot;\n&quot;, function_source)
134             function_source = leadingWhitespaceRegExp.sub(&quot;&quot;, function_source)
135             function_source = multipleEmptyLinesRegExp.sub(&quot;\n&quot;, function_source)
136 
137         function_name = functionNameRegExp.findall(function_source)[0]
138         async_match = functionIsAsyncRegExp.match(function_source)
139         is_async = async_match != None and async_match.group(1) == &quot;async&quot;
140         is_constructor = functionIsConstructorRegExp.match(function_source) != None
141         is_getter = functionIsGetterRegExp.match(function_source) != None
142         is_global_private = functionGlobalPrivateRegExp.match(function_source) != None



143         parameters = [s.strip() for s in functionParameterFinder.findall(function_source)[0].split(&#39;,&#39;)]
144         if len(parameters[0]) == 0:
145             parameters = []
146 
147         if is_getter and not overridden_name:
148             overridden_name = &quot;\&quot;get %s\&quot;&quot; % (function_name)
149 
150         if not overridden_name:
151             overridden_name = &quot;static_cast&lt;const char*&gt;(nullptr)&quot;
152 
<span class="line-modified">153         return BuiltinFunction(function_name, function_source, parameters, is_async, is_constructor, is_global_private, intrinsic, overridden_name)</span>
154 
155     def __str__(self):
156         interface = &quot;%s(%s)&quot; % (self.function_name, &#39;, &#39;.join(self.parameters))
157         if self.is_constructor:
158             interface = interface + &quot; [Constructor]&quot;
159 
160         if self.is_async:
161             interface = &quot;async &quot; + interface
162 
163         return interface
164 
165     def __lt__(self, other):
166         return self.function_name &lt; other.function_name
167 
168 
169 class BuiltinsCollection:
170     def __init__(self, framework_name):
171         self._copyright_lines = set()
172         self.objects = []
173         self.framework = Framework.fromString(framework_name)
</pre>
</td>
<td>
<hr />
<pre>
 27 import re
 28 import os
 29 
 30 from builtins_templates import BuiltinsGeneratorTemplates as Templates
 31 
 32 log = logging.getLogger(&#39;global&#39;)
 33 
 34 _FRAMEWORK_CONFIG_MAP = {
 35     &quot;JavaScriptCore&quot;: {
 36         &quot;macro_prefix&quot;: &quot;JSC&quot;,
 37         &quot;namespace&quot;: &quot;JSC&quot;,
 38     },
 39     &quot;WebCore&quot;: {
 40         &quot;macro_prefix&quot;: &quot;WEBCORE&quot;,
 41         &quot;namespace&quot;: &quot;WebCore&quot;,
 42     },
 43 }
 44 
 45 functionHeadRegExp = re.compile(r&quot;(?:@[\w|=\[\] \&quot;\.]+\s*\n)*(?:async\s+)?function\s+\w+\s*\(.*?\)&quot;, re.MULTILINE | re.DOTALL)
 46 functionGlobalPrivateRegExp = re.compile(r&quot;.*^@globalPrivate&quot;, re.MULTILINE | re.DOTALL)
<span class="line-added"> 47 functionNakedConstructorRegExp = re.compile(r&quot;.*^@nakedConstructor&quot;, re.MULTILINE | re.DOTALL)</span>
 48 functionIntrinsicRegExp = re.compile(r&quot;.*^@intrinsic=(\w+)&quot;, re.MULTILINE | re.DOTALL)
 49 functionIsConstructorRegExp = re.compile(r&quot;.*^@constructor&quot;, re.MULTILINE | re.DOTALL)
 50 functionIsGetterRegExp = re.compile(r&quot;.*^@getter&quot;, re.MULTILINE | re.DOTALL)
 51 functionIsAsyncRegExp = re.compile(r&quot;(async)?\s*function&quot;, re.MULTILINE | re.DOTALL)
 52 functionNameRegExp = re.compile(r&quot;function\s+(\w+)\s*\(&quot;, re.MULTILINE | re.DOTALL)
 53 functionOverriddenNameRegExp = re.compile(r&quot;.*^@overriddenName=(\&quot;.+\&quot;)$&quot;, re.MULTILINE | re.DOTALL)
 54 functionParameterFinder = re.compile(r&quot;^(?:async\s+)?function\s+(?:\w+)\s*\(((?:\s*\w+)?\s*(?:\s*,\s*\w+)*)?\s*\)&quot;, re.MULTILINE | re.DOTALL)
 55 
 56 multilineCommentRegExp = re.compile(r&quot;\/\*.*?\*\/&quot;, re.MULTILINE | re.DOTALL)
 57 singleLineCommentRegExp = re.compile(r&quot;\/\/.*?\n&quot;, re.MULTILINE | re.DOTALL)
 58 keyValueAnnotationCommentRegExp = re.compile(r&quot;^\/\/ @(\w+)=([^=]+?)\n&quot;, re.MULTILINE | re.DOTALL)
 59 flagAnnotationCommentRegExp = re.compile(r&quot;^\/\/ @(\w+)[^=]*?\n&quot;, re.MULTILINE | re.DOTALL)
 60 lineWithOnlySingleLineCommentRegExp = re.compile(r&quot;^\s*\/\/\n&quot;, re.MULTILINE | re.DOTALL)
 61 lineWithTrailingSingleLineCommentRegExp = re.compile(r&quot;\s*\/\/\n&quot;, re.MULTILINE | re.DOTALL)
 62 leadingWhitespaceRegExp = re.compile(r&quot;^ +&quot;, re.MULTILINE | re.DOTALL)
 63 multipleEmptyLinesRegExp = re.compile(r&quot;\n{2,}&quot;, re.MULTILINE | re.DOTALL)
 64 
 65 class ParseException(Exception):
 66     pass
 67 
</pre>
<hr />
<pre>
 85         raise ParseException(&quot;Unknown framework: %s&quot; % frameworkString)
 86 
 87 
 88 class Frameworks:
 89     JavaScriptCore = Framework(&quot;JavaScriptCore&quot;)
 90     WebCore = Framework(&quot;WebCore&quot;)
 91 
 92 
 93 class BuiltinObject:
 94     def __init__(self, object_name, annotations, functions):
 95         self.object_name = object_name
 96         self.annotations = annotations
 97         self.functions = functions
 98         self.collection = None  # Set by the owning BuiltinsCollection
 99 
100         for function in self.functions:
101             function.object = self
102 
103 
104 class BuiltinFunction:
<span class="line-modified">105     def __init__(self, function_name, function_source, parameters, is_async, is_constructor, is_global_private, is_naked_constructor, intrinsic, overridden_name):</span>
106         self.function_name = function_name
107         self.function_source = function_source
108         self.parameters = parameters
109         self.is_async = is_async
110         self.is_constructor = is_constructor
<span class="line-added">111         self.is_naked_constructor = is_naked_constructor</span>
112         self.is_global_private = is_global_private
113         self.intrinsic = intrinsic
114         self.overridden_name = overridden_name
115         self.object = None  # Set by the owning BuiltinObject
116 
117     @staticmethod
118     def fromString(function_string):
119         function_source = multilineCommentRegExp.sub(&quot;&quot;, function_string)
120 
121         intrinsic = &quot;NoIntrinsic&quot;
122         intrinsicMatch = functionIntrinsicRegExp.search(function_source)
123         if intrinsicMatch:
124             intrinsic = intrinsicMatch.group(1)
125             function_source = functionIntrinsicRegExp.sub(&quot;&quot;, function_source)
126 
127         overridden_name = None
128         overriddenNameMatch = functionOverriddenNameRegExp.search(function_source)
129         if overriddenNameMatch:
130             overridden_name = overriddenNameMatch.group(1)
131             function_source = functionOverriddenNameRegExp.sub(&quot;&quot;, function_source)
132 
133         if not os.getenv(&quot;CONFIGURATION&quot;, &quot;Debug&quot;).startswith(&quot;Debug&quot;):
134             function_source = lineWithOnlySingleLineCommentRegExp.sub(&quot;&quot;, function_source)
135             function_source = lineWithTrailingSingleLineCommentRegExp.sub(&quot;\n&quot;, function_source)
136             function_source = leadingWhitespaceRegExp.sub(&quot;&quot;, function_source)
137             function_source = multipleEmptyLinesRegExp.sub(&quot;\n&quot;, function_source)
138 
139         function_name = functionNameRegExp.findall(function_source)[0]
140         async_match = functionIsAsyncRegExp.match(function_source)
141         is_async = async_match != None and async_match.group(1) == &quot;async&quot;
142         is_constructor = functionIsConstructorRegExp.match(function_source) != None
143         is_getter = functionIsGetterRegExp.match(function_source) != None
144         is_global_private = functionGlobalPrivateRegExp.match(function_source) != None
<span class="line-added">145         is_naked_constructor = functionNakedConstructorRegExp.match(function_source) != None</span>
<span class="line-added">146         if is_naked_constructor:</span>
<span class="line-added">147             is_constructor = True</span>
148         parameters = [s.strip() for s in functionParameterFinder.findall(function_source)[0].split(&#39;,&#39;)]
149         if len(parameters[0]) == 0:
150             parameters = []
151 
152         if is_getter and not overridden_name:
153             overridden_name = &quot;\&quot;get %s\&quot;&quot; % (function_name)
154 
155         if not overridden_name:
156             overridden_name = &quot;static_cast&lt;const char*&gt;(nullptr)&quot;
157 
<span class="line-modified">158         return BuiltinFunction(function_name, function_source, parameters, is_async, is_constructor, is_global_private, is_naked_constructor, intrinsic, overridden_name)</span>
159 
160     def __str__(self):
161         interface = &quot;%s(%s)&quot; % (self.function_name, &#39;, &#39;.join(self.parameters))
162         if self.is_constructor:
163             interface = interface + &quot; [Constructor]&quot;
164 
165         if self.is_async:
166             interface = &quot;async &quot; + interface
167 
168         return interface
169 
170     def __lt__(self, other):
171         return self.function_name &lt; other.function_name
172 
173 
174 class BuiltinsCollection:
175     def __init__(self, framework_name):
176         self._copyright_lines = set()
177         self.objects = []
178         self.framework = Framework.fromString(framework_name)
</pre>
</td>
</tr>
</table>
<center><a href="builtins_generator.py.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="builtins_templates.py.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>