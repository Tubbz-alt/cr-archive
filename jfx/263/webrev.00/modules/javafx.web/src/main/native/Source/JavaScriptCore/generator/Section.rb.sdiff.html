<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/generator/Section.rb</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Options.rb.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../heap/AlignedMemoryAllocator.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/generator/Section.rb</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 26 require_relative &#39;Opcode&#39;
 27 require_relative &#39;OpcodeGroup&#39;
 28 
 29 class Section
 30   attr_reader :name
 31   attr_reader :config
 32   attr_reader :opcodes
 33 
 34   def initialize(name, config)
 35     @name = name
 36     @config = config
 37     @opcodes = []
 38     @opcode_groups = []
 39   end
 40 
 41   def add_opcode(name, config)
 42       @opcodes &lt;&lt; create_opcode(name, config)
 43   end
 44 
 45   def create_opcode(name, config)
<span class="line-modified"> 46       Opcode.new(self, name, config[:args], config[:metadata], config[:metadata_initializers])</span>
 47   end
 48 
 49   def add_opcode_group(name, opcodes, config)
 50       opcodes = opcodes.map { |opcode| create_opcode(opcode, config) }
 51       @opcode_groups &lt;&lt; OpcodeGroup.new(self, name, opcodes, config)
 52       @opcodes += opcodes
 53   end
 54 
 55   def sort!
 56       @opcodes = @opcodes.sort { |a, b| a.metadata.empty? ? b.metadata.empty? ? 0 : 1 : -1 }
 57       @opcodes.each(&amp;:create_id!)
 58   end
 59 




 60   def header_helpers(num_opcodes)
 61       out = StringIO.new
 62       if config[:emit_in_h_file]
 63           out.write(&quot;#define FOR_EACH_#{config[:macro_name_component]}_ID(macro) \\\n&quot;)
 64           opcodes.each { |opcode| out.write(&quot;    macro(#{opcode.name}, #{opcode.length}) \\\n&quot;) }
 65           out &lt;&lt; &quot;\n&quot;
 66 
 67           out.write(&quot;#define NUMBER_OF_#{config[:macro_name_component]}_IDS #{opcodes.length}\n&quot;)

 68       end
 69 
 70       if config[:emit_in_structs_file]
 71           out.write(&quot;#define FOR_EACH_#{config[:macro_name_component]}_METADATA_SIZE(macro) \\\n&quot;)
 72           i = 0
 73           while true
 74               if opcodes[i].metadata.empty?
 75                   out &lt;&lt; &quot;\n&quot;
 76                   out &lt;&lt; &quot;#define NUMBER_OF_#{config[:macro_name_component]}_WITH_METADATA #{i}\n&quot;
 77                   break
 78               end
 79 
 80               out.write(&quot;    macro(sizeof(#{opcodes[i].capitalized_name}::Metadata))\\\n&quot;)
 81               i += 1
 82           end
 83           out &lt;&lt; &quot;\n&quot;
 84 
 85           out.write(&quot;#define FOR_EACH_#{config[:macro_name_component]}_METADATA_ALIGNMENT(macro) \\\n&quot;)
 86           i = 0
 87           while true
</pre>
<hr />
<pre>
 91               end
 92 
 93               out.write(&quot;    macro(alignof(#{opcodes[i].capitalized_name}::Metadata))\\\n&quot;)
 94               i += 1
 95           end
 96       end
 97 
 98       if config[:emit_opcode_id_string_values_in_h_file]
 99           opcodes.each { |opcode|
100               out.write(&quot;#define #{opcode.name}_value_string \&quot;#{opcode.id}\&quot;\n&quot;)
101           }
102           opcodes.each { |opcode|
103               out.write(&quot;#define #{opcode.name}_wide16_value_string \&quot;#{num_opcodes + opcode.id}\&quot;\n&quot;)
104           }
105           opcodes.each { |opcode|
106               out.write(&quot;#define #{opcode.name}_wide32_value_string \&quot;#{num_opcodes * 2 + opcode.id}\&quot;\n&quot;)
107           }
108       end
109       out.string
110   end










111 end
</pre>
</td>
<td>
<hr />
<pre>
 26 require_relative &#39;Opcode&#39;
 27 require_relative &#39;OpcodeGroup&#39;
 28 
 29 class Section
 30   attr_reader :name
 31   attr_reader :config
 32   attr_reader :opcodes
 33 
 34   def initialize(name, config)
 35     @name = name
 36     @config = config
 37     @opcodes = []
 38     @opcode_groups = []
 39   end
 40 
 41   def add_opcode(name, config)
 42       @opcodes &lt;&lt; create_opcode(name, config)
 43   end
 44 
 45   def create_opcode(name, config)
<span class="line-modified"> 46       Opcode.new(self, name, config[:extras], config[:args], config[:metadata], config[:metadata_initializers], config[:tmps], config[:checkpoints])</span>
 47   end
 48 
 49   def add_opcode_group(name, opcodes, config)
 50       opcodes = opcodes.map { |opcode| create_opcode(opcode, config) }
 51       @opcode_groups &lt;&lt; OpcodeGroup.new(self, name, opcodes, config)
 52       @opcodes += opcodes
 53   end
 54 
 55   def sort!
 56       @opcodes = @opcodes.sort { |a, b| a.metadata.empty? ? b.metadata.empty? ? 0 : 1 : -1 }
 57       @opcodes.each(&amp;:create_id!)
 58   end
 59 
<span class="line-added"> 60   def is_wasm?</span>
<span class="line-added"> 61     @name == :Wasm</span>
<span class="line-added"> 62   end</span>
<span class="line-added"> 63 </span>
 64   def header_helpers(num_opcodes)
 65       out = StringIO.new
 66       if config[:emit_in_h_file]
 67           out.write(&quot;#define FOR_EACH_#{config[:macro_name_component]}_ID(macro) \\\n&quot;)
 68           opcodes.each { |opcode| out.write(&quot;    macro(#{opcode.name}, #{opcode.length}) \\\n&quot;) }
 69           out &lt;&lt; &quot;\n&quot;
 70 
 71           out.write(&quot;#define NUMBER_OF_#{config[:macro_name_component]}_IDS #{opcodes.length}\n&quot;)
<span class="line-added"> 72           out.write(&quot;#define MAX_LENGTH_OF_#{config[:macro_name_component]}_IDS #{(opcodes.max {|a, b| a.length &lt;=&gt; b.length }).length}\n&quot;)</span>
 73       end
 74 
 75       if config[:emit_in_structs_file]
 76           out.write(&quot;#define FOR_EACH_#{config[:macro_name_component]}_METADATA_SIZE(macro) \\\n&quot;)
 77           i = 0
 78           while true
 79               if opcodes[i].metadata.empty?
 80                   out &lt;&lt; &quot;\n&quot;
 81                   out &lt;&lt; &quot;#define NUMBER_OF_#{config[:macro_name_component]}_WITH_METADATA #{i}\n&quot;
 82                   break
 83               end
 84 
 85               out.write(&quot;    macro(sizeof(#{opcodes[i].capitalized_name}::Metadata))\\\n&quot;)
 86               i += 1
 87           end
 88           out &lt;&lt; &quot;\n&quot;
 89 
 90           out.write(&quot;#define FOR_EACH_#{config[:macro_name_component]}_METADATA_ALIGNMENT(macro) \\\n&quot;)
 91           i = 0
 92           while true
</pre>
<hr />
<pre>
 96               end
 97 
 98               out.write(&quot;    macro(alignof(#{opcodes[i].capitalized_name}::Metadata))\\\n&quot;)
 99               i += 1
100           end
101       end
102 
103       if config[:emit_opcode_id_string_values_in_h_file]
104           opcodes.each { |opcode|
105               out.write(&quot;#define #{opcode.name}_value_string \&quot;#{opcode.id}\&quot;\n&quot;)
106           }
107           opcodes.each { |opcode|
108               out.write(&quot;#define #{opcode.name}_wide16_value_string \&quot;#{num_opcodes + opcode.id}\&quot;\n&quot;)
109           }
110           opcodes.each { |opcode|
111               out.write(&quot;#define #{opcode.name}_wide32_value_string \&quot;#{num_opcodes * 2 + opcode.id}\&quot;\n&quot;)
112           }
113       end
114       out.string
115   end
<span class="line-added">116 </span>
<span class="line-added">117     def for_each_struct</span>
<span class="line-added">118         &lt;&lt;-EOF</span>
<span class="line-added">119 #define FOR_EACH_#{config[:macro_name_component]}_STRUCT(macro) \\</span>
<span class="line-added">120 #{opcodes.map do |op|</span>
<span class="line-added">121     &quot;    macro(#{op.capitalized_name}) \\&quot;</span>
<span class="line-added">122 end.join(&quot;\n&quot;)}</span>
<span class="line-added">123 EOF</span>
<span class="line-added">124     end</span>
<span class="line-added">125 </span>
126 end
</pre>
</td>
</tr>
</table>
<center><a href="Options.rb.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../heap/AlignedMemoryAllocator.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>