<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSDOMBuiltinConstructor.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSDOMBindingSecurity.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="JSDOMBuiltinConstructorBase.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSDOMBuiltinConstructor.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 23,11 ***</span>
  #include &quot;JSDOMExceptionHandling.h&quot;
  #include &quot;JSDOMWrapperCache.h&quot;
  
  namespace WebCore {
  
<span class="line-modified">! template&lt;typename JSClass&gt; class JSDOMBuiltinConstructor : public JSDOMBuiltinConstructorBase {</span>
  public:
      using Base = JSDOMBuiltinConstructorBase;
  
      static JSDOMBuiltinConstructor* create(JSC::VM&amp;, JSC::Structure*, JSDOMGlobalObject&amp;);
      static JSC::Structure* createStructure(JSC::VM&amp;, JSC::JSGlobalObject&amp;, JSC::JSValue prototype);
<span class="line-new-header">--- 23,11 ---</span>
  #include &quot;JSDOMExceptionHandling.h&quot;
  #include &quot;JSDOMWrapperCache.h&quot;
  
  namespace WebCore {
  
<span class="line-modified">! template&lt;typename JSClass&gt; class JSDOMBuiltinConstructor final : public JSDOMBuiltinConstructorBase {</span>
  public:
      using Base = JSDOMBuiltinConstructorBase;
  
      static JSDOMBuiltinConstructor* create(JSC::VM&amp;, JSC::Structure*, JSDOMGlobalObject&amp;);
      static JSC::Structure* createStructure(JSC::VM&amp;, JSC::JSGlobalObject&amp;, JSC::JSValue prototype);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 43,14 ***</span>
      {
      }
  
      void finishCreation(JSC::VM&amp;, JSDOMGlobalObject&amp;);
      static JSC::ConstructType getConstructData(JSC::JSCell*, JSC::ConstructData&amp;);
<span class="line-modified">!     static JSC::EncodedJSValue JSC_HOST_CALL construct(JSC::ExecState*);</span>
  
<span class="line-modified">!     JSC::EncodedJSValue callConstructor(JSC::ExecState&amp;, JSC::JSObject&amp;);</span>
<span class="line-modified">!     JSC::EncodedJSValue callConstructor(JSC::ExecState&amp;, JSC::JSObject*);</span>
  
      // Usually defined for each specialization class.
      void initializeProperties(JSC::VM&amp;, JSDOMGlobalObject&amp;) { }
      // Must be defined for each specialization class.
      JSC::FunctionExecutable* initializeExecutable(JSC::VM&amp;);
<span class="line-new-header">--- 43,14 ---</span>
      {
      }
  
      void finishCreation(JSC::VM&amp;, JSDOMGlobalObject&amp;);
      static JSC::ConstructType getConstructData(JSC::JSCell*, JSC::ConstructData&amp;);
<span class="line-modified">!     static JSC::EncodedJSValue JSC_HOST_CALL construct(JSC::JSGlobalObject*, JSC::CallFrame*);</span>
  
<span class="line-modified">!     JSC::EncodedJSValue callConstructor(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, JSC::JSObject&amp;);</span>
<span class="line-modified">!     JSC::EncodedJSValue callConstructor(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;, JSC::JSObject*);</span>
  
      // Usually defined for each specialization class.
      void initializeProperties(JSC::VM&amp;, JSDOMGlobalObject&amp;) { }
      // Must be defined for each specialization class.
      JSC::FunctionExecutable* initializeExecutable(JSC::VM&amp;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 74,23 ***</span>
      ASSERT(inherits(vm, info()));
      setInitializeFunction(vm, *JSC::JSFunction::create(vm, initializeExecutable(vm), &amp;globalObject));
      initializeProperties(vm, globalObject);
  }
  
<span class="line-modified">! template&lt;typename JSClass&gt; inline JSC::EncodedJSValue JSDOMBuiltinConstructor&lt;JSClass&gt;::callConstructor(JSC::ExecState&amp; state, JSC::JSObject&amp; object)</span>
  {
<span class="line-modified">!     Base::callFunctionWithCurrentArguments(state, object, *initializeFunction());</span>
      return JSC::JSValue::encode(&amp;object);
  }
  
<span class="line-modified">! template&lt;typename JSClass&gt; inline JSC::EncodedJSValue JSDOMBuiltinConstructor&lt;JSClass&gt;::callConstructor(JSC::ExecState&amp; state, JSC::JSObject* object)</span>
  {
<span class="line-modified">!     JSC::VM&amp; vm = state.vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
      if (!object)
<span class="line-modified">!         return throwConstructorScriptExecutionContextUnavailableError(state, scope, info()-&gt;className);</span>
<span class="line-modified">!     return callConstructor(state, *object);</span>
  }
  
  template&lt;typename JSClass&gt;
  typename std::enable_if&lt;JSDOMObjectInspector&lt;JSClass&gt;::isSimpleWrapper, JSC::JSObject&amp;&gt;::type createJSObject(JSDOMBuiltinConstructor&lt;JSClass&gt;&amp; constructor)
  {
<span class="line-new-header">--- 74,23 ---</span>
      ASSERT(inherits(vm, info()));
      setInitializeFunction(vm, *JSC::JSFunction::create(vm, initializeExecutable(vm), &amp;globalObject));
      initializeProperties(vm, globalObject);
  }
  
<span class="line-modified">! template&lt;typename JSClass&gt; inline JSC::EncodedJSValue JSDOMBuiltinConstructor&lt;JSClass&gt;::callConstructor(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, JSC::JSObject&amp; object)</span>
  {
<span class="line-modified">!     Base::callFunctionWithCurrentArguments(lexicalGlobalObject, callFrame, object, *initializeFunction());</span>
      return JSC::JSValue::encode(&amp;object);
  }
  
<span class="line-modified">! template&lt;typename JSClass&gt; inline JSC::EncodedJSValue JSDOMBuiltinConstructor&lt;JSClass&gt;::callConstructor(JSC::JSGlobalObject&amp; lexicalGlobalObject, JSC::CallFrame&amp; callFrame, JSC::JSObject* object)</span>
  {
<span class="line-modified">!     JSC::VM&amp; vm = JSC::getVM(&amp;lexicalGlobalObject);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
      if (!object)
<span class="line-modified">!         return throwConstructorScriptExecutionContextUnavailableError(lexicalGlobalObject, scope, info()-&gt;className);</span>
<span class="line-modified">!     return callConstructor(lexicalGlobalObject, callFrame, *object);</span>
  }
  
  template&lt;typename JSClass&gt;
  typename std::enable_if&lt;JSDOMObjectInspector&lt;JSClass&gt;::isSimpleWrapper, JSC::JSObject&amp;&gt;::type createJSObject(JSDOMBuiltinConstructor&lt;JSClass&gt;&amp; constructor)
  {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 109,15 ***</span>
  {
      auto* context = constructor.scriptExecutionContext();
      return context ? createWrapper&lt;typename JSClass::DOMWrapped&gt;(constructor.globalObject(), JSClass::DOMWrapped::create(*context)) : nullptr;
  }
  
<span class="line-modified">! template&lt;typename JSClass&gt; inline JSC::EncodedJSValue JSC_HOST_CALL JSDOMBuiltinConstructor&lt;JSClass&gt;::construct(JSC::ExecState* state)</span>
  {
<span class="line-modified">!     ASSERT(state);</span>
<span class="line-modified">!     auto* castedThis = JSC::jsCast&lt;JSDOMBuiltinConstructor*&gt;(state-&gt;jsCallee());</span>
<span class="line-modified">!     return castedThis-&gt;callConstructor(*state, createJSObject(*castedThis));</span>
  }
  
  template&lt;typename JSClass&gt; inline JSC::ConstructType JSDOMBuiltinConstructor&lt;JSClass&gt;::getConstructData(JSC::JSCell*, JSC::ConstructData&amp; constructData)
  {
      constructData.native.function = construct;
<span class="line-new-header">--- 109,15 ---</span>
  {
      auto* context = constructor.scriptExecutionContext();
      return context ? createWrapper&lt;typename JSClass::DOMWrapped&gt;(constructor.globalObject(), JSClass::DOMWrapped::create(*context)) : nullptr;
  }
  
<span class="line-modified">! template&lt;typename JSClass&gt; inline JSC::EncodedJSValue JSC_HOST_CALL JSDOMBuiltinConstructor&lt;JSClass&gt;::construct(JSC::JSGlobalObject* lexicalGlobalObject, JSC::CallFrame* callFrame)</span>
  {
<span class="line-modified">!     ASSERT(callFrame);</span>
<span class="line-modified">!     auto* castedThis = JSC::jsCast&lt;JSDOMBuiltinConstructor*&gt;(callFrame-&gt;jsCallee());</span>
<span class="line-modified">!     return castedThis-&gt;callConstructor(*lexicalGlobalObject, *callFrame, createJSObject(*castedThis));</span>
  }
  
  template&lt;typename JSClass&gt; inline JSC::ConstructType JSDOMBuiltinConstructor&lt;JSClass&gt;::getConstructData(JSC::JSCell*, JSC::ConstructData&amp; constructData)
  {
      constructData.native.function = construct;
</pre>
<center><a href="JSDOMBindingSecurity.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="JSDOMBuiltinConstructorBase.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>