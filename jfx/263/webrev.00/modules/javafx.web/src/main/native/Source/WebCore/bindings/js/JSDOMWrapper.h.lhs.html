<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSDOMWrapper.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  *  Copyright (C) 1999-2001 Harri Porten (porten@kde.org)
  3  *  Copyright (C) 2003-2018 Apple Inc. All rights reserved.
  4  *  Copyright (C) 2007 Samuel Weinig &lt;sam@webkit.org&gt;
  5  *  Copyright (C) 2009 Google, Inc. All rights reserved.
  6  *
  7  *  This library is free software; you can redistribute it and/or
  8  *  modify it under the terms of the GNU Lesser General Public
  9  *  License as published by the Free Software Foundation; either
 10  *  version 2 of the License, or (at your option) any later version.
 11  *
 12  *  This library is distributed in the hope that it will be useful,
 13  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 14  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 15  *  Lesser General Public License for more details.
 16  *
 17  *  You should have received a copy of the GNU Lesser General Public
 18  *  License along with this library; if not, write to the Free Software
 19  *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
 20  */
 21 
 22 #pragma once
 23 
 24 #include &quot;JSDOMGlobalObject.h&quot;
 25 #include &quot;NodeConstants.h&quot;
 26 #include &lt;JavaScriptCore/JSDestructibleObject.h&gt;
 27 
 28 namespace WebCore {
 29 
 30 class ScriptExecutionContext;
 31 
<a name="1" id="anc1"></a><span class="line-modified"> 32 // JSC allows us to extend JSType. If the highest bit is set, we can add any Object types and they are</span>
 33 // recognized as OtherObj in JSC. And we encode Node type into JSType if the given JSType is subclass of Node.
<a name="2" id="anc2"></a><span class="line-modified"> 34 // offset | 7 | 6 | 5   4 | 3   2   1   0  |</span>
<span class="line-modified"> 35 // value  | 1 | 0 |  Non-node DOM types    |</span>
 36 // If the given JSType is a subclass of Node, the format is the following.
<a name="3" id="anc3"></a><span class="line-modified"> 37 // offset | 7 | 6 | 5   4 | 3   2   1   0  |</span>
<span class="line-modified"> 38 // value  | 1 | 1 |  Kind |       NodeType |</span>
<span class="line-removed"> 39 static const uint8_t JSNodeTypeMask                  = 0b00001111;</span>
 40 
<a name="4" id="anc4"></a><span class="line-modified"> 41 static const uint8_t JSDOMWrapperType                = 0b10000000;</span>
<span class="line-modified"> 42 static const uint8_t JSEventType                     = 0b10000001;</span>
<span class="line-modified"> 43 static const uint8_t JSNodeType                      = 0b11000000;</span>

 44 static const uint8_t JSTextNodeType                  = JSNodeType | NodeConstants::TEXT_NODE;
 45 static const uint8_t JSProcessingInstructionNodeType = JSNodeType | NodeConstants::PROCESSING_INSTRUCTION_NODE;
 46 static const uint8_t JSDocumentTypeNodeType          = JSNodeType | NodeConstants::DOCUMENT_TYPE_NODE;
 47 static const uint8_t JSDocumentFragmentNodeType      = JSNodeType | NodeConstants::DOCUMENT_FRAGMENT_NODE;
 48 static const uint8_t JSDocumentWrapperType           = JSNodeType | NodeConstants::DOCUMENT_NODE;
 49 static const uint8_t JSCommentNodeType               = JSNodeType | NodeConstants::COMMENT_NODE;
 50 static const uint8_t JSCDATASectionNodeType          = JSNodeType | NodeConstants::CDATA_SECTION_NODE;
 51 static const uint8_t JSAttrNodeType                  = JSNodeType | NodeConstants::ATTRIBUTE_NODE;
<a name="5" id="anc5"></a><span class="line-modified"> 52 static const uint8_t JSElementType                   = 0b11010000 | NodeConstants::ELEMENT_NODE;</span>
 53 
 54 static_assert(JSDOMWrapperType &gt; JSC::LastJSCObjectType, &quot;JSC::JSType offers the highest bit.&quot;);
 55 static_assert(NodeConstants::LastNodeType &lt;= JSNodeTypeMask, &quot;NodeType should be represented in 4bit.&quot;);
 56 
 57 class JSDOMObject : public JSC::JSDestructibleObject {
 58 public:
 59     typedef JSC::JSDestructibleObject Base;
 60     static constexpr bool isDOMWrapper = false;
 61 
 62     JSDOMGlobalObject* globalObject() const { return JSC::jsCast&lt;JSDOMGlobalObject*&gt;(JSC::JSNonFinalObject::globalObject()); }
 63     ScriptExecutionContext* scriptExecutionContext() const { return globalObject()-&gt;scriptExecutionContext(); }
 64 
 65 protected:
 66     WEBCORE_EXPORT JSDOMObject(JSC::Structure*, JSC::JSGlobalObject&amp;);
 67 };
 68 
 69 WEBCORE_EXPORT JSC::CompleteSubspace* outputConstraintSubspaceFor(JSC::VM&amp;);
<a name="6" id="anc6"></a><span class="line-removed"> 70 WEBCORE_EXPORT JSC::CompleteSubspace* globalObjectOutputConstraintSubspaceFor(JSC::VM&amp;);</span>
 71 
 72 template&lt;typename ImplementationClass&gt; class JSDOMWrapper : public JSDOMObject {
 73 public:
 74     typedef JSDOMObject Base;
 75     typedef ImplementationClass DOMWrapped;
 76     static constexpr bool isDOMWrapper = true;
 77 
 78     ImplementationClass&amp; wrapped() const { return m_wrapped; }
 79     static ptrdiff_t offsetOfWrapped() { return OBJECT_OFFSETOF(JSDOMWrapper&lt;ImplementationClass&gt;, m_wrapped); }
 80 
 81 protected:
 82     JSDOMWrapper(JSC::Structure* structure, JSC::JSGlobalObject&amp; globalObject, Ref&lt;ImplementationClass&gt;&amp;&amp; impl)
 83         : Base(structure, globalObject)
 84         , m_wrapped(WTFMove(impl)) { }
 85 
 86 private:
 87     Ref&lt;ImplementationClass&gt; m_wrapped;
 88 };
 89 
 90 template&lt;typename ImplementationClass&gt; struct JSDOMWrapperConverterTraits;
 91 
 92 template&lt;typename JSClass, typename Enable = void&gt;
 93 struct JSDOMObjectInspector {
 94 public:
 95     static constexpr bool isSimpleWrapper = false;
 96     static constexpr bool isComplexWrapper = false;
 97     static constexpr bool isBuiltin = true;
 98 };
 99 
100 template&lt;typename JSClass&gt;
101 struct JSDOMObjectInspector&lt;JSClass, typename std::enable_if&lt;JSClass::isDOMWrapper&gt;::type&gt; {
102 private:
103     template&lt;typename T&gt; static constexpr auto test(int) -&gt; decltype(T::create(), bool()) { return true; }
104     template&lt;typename T&gt; static constexpr bool test(...) { return false; }
105 
106 public:
107     static constexpr bool isSimpleWrapper = test&lt;typename JSClass::DOMWrapped&gt;(0);
108     static constexpr bool isComplexWrapper = !isSimpleWrapper;
109     static constexpr bool isBuiltin = false;
110 };
111 
<a name="7" id="anc7"></a><span class="line-modified">112 JSC::JSValue cloneAcrossWorlds(JSC::ExecState&amp;, const JSDOMObject&amp; owner, JSC::JSValue);</span>
113 
114 } // namespace WebCore
<a name="8" id="anc8"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="8" type="hidden" />
</body>
</html>