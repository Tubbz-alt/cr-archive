<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/StructureStubClearingWatchpoint.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="StructureStubClearingWatchpoint.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="StructureStubInfo.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/StructureStubClearingWatchpoint.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -23,31 +23,31 @@</span>
   * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   */
  
  #pragma once
  
<span class="udiff-line-removed">- #include &quot;ObjectPropertyCondition.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;Watchpoint.h&quot;</span>
<span class="udiff-line-removed">- </span>
  #if ENABLE(JIT)
  
<span class="udiff-line-added">+ #include &quot;AdaptiveInferredPropertyValueWatchpointBase.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;ObjectPropertyCondition.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;Watchpoint.h&quot;</span>
  #include &lt;wtf/Bag.h&gt;
  #include &lt;wtf/FastMalloc.h&gt;
  #include &lt;wtf/Noncopyable.h&gt;
  
  namespace JSC {
  
  class CodeBlock;
  class StructureStubInfo;
  class WatchpointsOnStructureStubInfo;
  
<span class="udiff-line-modified-removed">- class StructureStubClearingWatchpoint final : public Watchpoint {</span>
<span class="udiff-line-modified-removed">-     WTF_MAKE_NONCOPYABLE(StructureStubClearingWatchpoint);</span>
<span class="udiff-line-modified-added">+ class StructureTransitionStructureStubClearingWatchpoint final : public Watchpoint {</span>
<span class="udiff-line-modified-added">+     WTF_MAKE_NONCOPYABLE(StructureTransitionStructureStubClearingWatchpoint);</span>
      WTF_MAKE_FAST_ALLOCATED;
  public:
<span class="udiff-line-modified-removed">-     StructureStubClearingWatchpoint(const ObjectPropertyCondition&amp; key, WatchpointsOnStructureStubInfo&amp; holder)</span>
<span class="udiff-line-modified-removed">-         : Watchpoint(Watchpoint::Type::StructureStubClearing)</span>
<span class="udiff-line-modified-added">+     StructureTransitionStructureStubClearingWatchpoint(const ObjectPropertyCondition&amp; key, WatchpointsOnStructureStubInfo&amp; holder)</span>
<span class="udiff-line-modified-added">+         : Watchpoint(Watchpoint::Type::StructureTransitionStructureStubClearing)</span>
          , m_holder(&amp;holder)
          , m_key(key)
      {
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -57,35 +57,62 @@</span>
      // Own destructor may not be called. Keep members trivially destructible.
      JSC_WATCHPOINT_FIELD(PackedPtr&lt;WatchpointsOnStructureStubInfo&gt;, m_holder);
      JSC_WATCHPOINT_FIELD(ObjectPropertyCondition, m_key);
  };
  
<span class="udiff-line-added">+ class AdaptiveValueStructureStubClearingWatchpoint final : public AdaptiveInferredPropertyValueWatchpointBase {</span>
<span class="udiff-line-added">+     using Base = AdaptiveInferredPropertyValueWatchpointBase;</span>
<span class="udiff-line-added">+     WTF_MAKE_NONCOPYABLE(AdaptiveValueStructureStubClearingWatchpoint);</span>
<span class="udiff-line-added">+     WTF_MAKE_FAST_ALLOCATED;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     void handleFire(VM&amp;, const FireDetail&amp;) override;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ public:</span>
<span class="udiff-line-added">+     AdaptiveValueStructureStubClearingWatchpoint(const ObjectPropertyCondition&amp; key, WatchpointsOnStructureStubInfo&amp; holder)</span>
<span class="udiff-line-added">+         : Base(key)</span>
<span class="udiff-line-added">+         , m_holder(&amp;holder)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         RELEASE_ASSERT(key.condition().kind() == PropertyCondition::Equivalence);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ private:</span>
<span class="udiff-line-added">+     PackedPtr&lt;WatchpointsOnStructureStubInfo&gt; m_holder;</span>
<span class="udiff-line-added">+ };</span>
<span class="udiff-line-added">+ </span>
  class WatchpointsOnStructureStubInfo {
      WTF_MAKE_NONCOPYABLE(WatchpointsOnStructureStubInfo);
      WTF_MAKE_FAST_ALLOCATED;
  public:
      WatchpointsOnStructureStubInfo(CodeBlock* codeBlock, StructureStubInfo* stubInfo)
          : m_codeBlock(codeBlock)
          , m_stubInfo(stubInfo)
      {
      }
  
<span class="udiff-line-modified-removed">-     StructureStubClearingWatchpoint* addWatchpoint(const ObjectPropertyCondition&amp; key);</span>
<span class="udiff-line-modified-added">+     using Node = Variant&lt;StructureTransitionStructureStubClearingWatchpoint, AdaptiveValueStructureStubClearingWatchpoint&gt;;</span>
  
<span class="udiff-line-modified-removed">-     static StructureStubClearingWatchpoint* ensureReferenceAndAddWatchpoint(</span>
<span class="udiff-line-modified-added">+     Node&amp; addWatchpoint(const ObjectPropertyCondition&amp; key);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     static void ensureReferenceAndInstallWatchpoint(</span>
          std::unique_ptr&lt;WatchpointsOnStructureStubInfo&gt;&amp; holderRef,
          CodeBlock*, StructureStubInfo*, const ObjectPropertyCondition&amp; key);
<span class="udiff-line-added">+     static Watchpoint* ensureReferenceAndAddWatchpoint(</span>
<span class="udiff-line-added">+         std::unique_ptr&lt;WatchpointsOnStructureStubInfo&gt;&amp; holderRef,</span>
<span class="udiff-line-added">+         CodeBlock*, StructureStubInfo*);</span>
  
      CodeBlock* codeBlock() const { return m_codeBlock; }
      StructureStubInfo* stubInfo() const { return m_stubInfo; }
  
      bool isValid() const;
  
  private:
      CodeBlock* m_codeBlock;
      StructureStubInfo* m_stubInfo;
<span class="udiff-line-modified-removed">-     Bag&lt;StructureStubClearingWatchpoint&gt; m_watchpoints;</span>
<span class="udiff-line-modified-added">+     // FIXME: use less memory for the entries in this Bag:</span>
<span class="udiff-line-added">+     // https://bugs.webkit.org/show_bug.cgi?id=202380</span>
<span class="udiff-line-added">+     Bag&lt;WTF::Variant&lt;StructureTransitionStructureStubClearingWatchpoint, AdaptiveValueStructureStubClearingWatchpoint&gt;&gt; m_watchpoints;</span>
  };
  
  } // namespace JSC
  
  #endif // ENABLE(JIT)
</pre>
<center><a href="StructureStubClearingWatchpoint.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="StructureStubInfo.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>