<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/platform/mock/MockRealtimeVideoSource.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MockRealtimeMediaSourceCenter.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MockRealtimeVideoSource.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/mock/MockRealtimeVideoSource.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 54,11 ***</span>
  {
  #ifndef NDEBUG
      auto device = MockRealtimeMediaSourceCenter::mockDeviceWithPersistentID(deviceID);
      ASSERT(device);
      if (!device)
<span class="line-modified">!         return { };</span>
  #endif
  
      auto source = adoptRef(*new MockRealtimeVideoSource(WTFMove(deviceID), WTFMove(name), WTFMove(hashSalt)));
      if (constraints &amp;&amp; source-&gt;applyConstraints(*constraints))
          return { };
<span class="line-new-header">--- 54,11 ---</span>
  {
  #ifndef NDEBUG
      auto device = MockRealtimeMediaSourceCenter::mockDeviceWithPersistentID(deviceID);
      ASSERT(device);
      if (!device)
<span class="line-modified">!         return { &quot;No mock camera device&quot;_s };</span>
  #endif
  
      auto source = adoptRef(*new MockRealtimeVideoSource(WTFMove(deviceID), WTFMove(name), WTFMove(hashSalt)));
      if (constraints &amp;&amp; source-&gt;applyConstraints(*constraints))
          return { };
</pre>
<hr />
<pre>
<span class="line-old-header">*** 187,12 ***</span>
  }
  
  void MockRealtimeVideoSource::setFrameRateWithPreset(double, RefPtr&lt;VideoPreset&gt; preset)
  {
      m_preset = WTFMove(preset);
<span class="line-modified">!     if (preset)</span>
<span class="line-modified">!         setIntrinsicSize(preset-&gt;size);</span>
  }
  
  IntSize MockRealtimeVideoSource::captureSize() const
  {
      return m_preset ? m_preset-&gt;size : this-&gt;size();
<span class="line-new-header">--- 187,12 ---</span>
  }
  
  void MockRealtimeVideoSource::setFrameRateWithPreset(double, RefPtr&lt;VideoPreset&gt; preset)
  {
      m_preset = WTFMove(preset);
<span class="line-modified">!     if (m_preset)</span>
<span class="line-modified">!         setIntrinsicSize(m_preset-&gt;size);</span>
  }
  
  IntSize MockRealtimeVideoSource::captureSize() const
  {
      return m_preset ? m_preset-&gt;size : this-&gt;size();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 260,16 ***</span>
      context.fillPath(m_path);
  }
  
  void MockRealtimeVideoSource::drawBoxes(GraphicsContext&amp; context)
  {
<span class="line-modified">!     static const RGBA32 magenta = 0xffff00ff;</span>
<span class="line-modified">!     static const RGBA32 yellow = 0xffffff00;</span>
<span class="line-modified">!     static const RGBA32 blue = 0xff0000ff;</span>
<span class="line-modified">!     static const RGBA32 red = 0xffff0000;</span>
<span class="line-removed">-     static const RGBA32 green = 0xff008000;</span>
<span class="line-removed">-     static const RGBA32 cyan = 0xFF00FFFF;</span>
  
      IntSize size = captureSize();
      float boxSize = size.width() * .035;
      float boxTop = size.height() * .6;
  
<span class="line-new-header">--- 260,14 ---</span>
      context.fillPath(m_path);
  }
  
  void MockRealtimeVideoSource::drawBoxes(GraphicsContext&amp; context)
  {
<span class="line-modified">!     constexpr SimpleColor magenta { 0xffff00ff };</span>
<span class="line-modified">!     constexpr SimpleColor blue { 0xff0000ff };</span>
<span class="line-modified">!     constexpr SimpleColor red { 0xffff0000 };</span>
<span class="line-modified">!     constexpr SimpleColor darkGreen { 0xff008000 };</span>
  
      IntSize size = captureSize();
      float boxSize = size.width() * .035;
      float boxTop = size.height() * .6;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 315,13 ***</span>
          m_path.addLineTo(FloatPoint(boxLeft + boxSize - 1, boxTop + 8 * i));
      }
  
      boxTop += boxSize + 2;
      boxLeft = boxSize;
<span class="line-modified">!     Color boxColors[] = { Color::white, yellow, cyan, green, magenta, red, blue };</span>
<span class="line-modified">!     for (unsigned i = 0; i &lt; sizeof(boxColors) / sizeof(boxColors[0]); i++) {</span>
<span class="line-modified">!         context.fillRect(FloatRect(boxLeft, boxTop, boxSize + 1, boxSize + 1), boxColors[i]);</span>
          boxLeft += boxSize + 1;
      }
      context.strokePath(m_path);
  }
  
<span class="line-new-header">--- 313,13 ---</span>
          m_path.addLineTo(FloatPoint(boxLeft + boxSize - 1, boxTop + 8 * i));
      }
  
      boxTop += boxSize + 2;
      boxLeft = boxSize;
<span class="line-modified">!     constexpr SimpleColor boxColors[] = { Color::white, Color::yellow, Color::cyan, darkGreen, magenta, red, blue };</span>
<span class="line-modified">!     for (auto&amp; boxColor : boxColors) {</span>
<span class="line-modified">!         context.fillRect(FloatRect(boxLeft, boxTop, boxSize + 1, boxSize + 1), boxColor);</span>
          boxLeft += boxSize + 1;
      }
      context.strokePath(m_path);
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 456,15 ***</span>
  ImageBuffer* MockRealtimeVideoSource::imageBuffer() const
  {
      if (m_imageBuffer)
          return m_imageBuffer.get();
  
<span class="line-modified">!     m_imageBuffer = ImageBuffer::create(captureSize(), Unaccelerated);</span>
      if (!m_imageBuffer)
          return nullptr;
  
<span class="line-modified">!     m_imageBuffer-&gt;context().setImageInterpolationQuality(InterpolationDefault);</span>
      m_imageBuffer-&gt;context().setStrokeThickness(1);
  
      return m_imageBuffer.get();
  }
  
<span class="line-new-header">--- 454,15 ---</span>
  ImageBuffer* MockRealtimeVideoSource::imageBuffer() const
  {
      if (m_imageBuffer)
          return m_imageBuffer.get();
  
<span class="line-modified">!     m_imageBuffer = ImageBuffer::create(captureSize(), RenderingMode::Unaccelerated);</span>
      if (!m_imageBuffer)
          return nullptr;
  
<span class="line-modified">!     m_imageBuffer-&gt;context().setImageInterpolationQuality(InterpolationQuality::Default);</span>
      m_imageBuffer-&gt;context().setStrokeThickness(1);
  
      return m_imageBuffer.get();
  }
  
</pre>
<center><a href="MockRealtimeMediaSourceCenter.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MockRealtimeVideoSource.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>