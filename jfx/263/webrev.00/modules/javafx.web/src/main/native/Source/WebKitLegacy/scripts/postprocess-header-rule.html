<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebKitLegacy/scripts/postprocess-header-rule</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
 1 #!/bin/bash
 2 #
 3 # Copyright (C) 2019 Apple Inc. All rights reserved.
 4 #
 5 # Redistribution and use in source and binary forms, with or without
 6 # modification, are permitted provided that the following conditions
 7 # are met:
 8 # 1. Redistributions of source code must retain the above copyright
 9 #    notice, this list of conditions and the following disclaimer.
10 # 2. Redistributions in binary form must reproduce the above copyright
11 #    notice, this list of conditions and the following disclaimer in the
12 #    documentation and/or other materials provided with the distribution.
13 #
14 # THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
15 # AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
16 # THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
17 # PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
18 # BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
19 # CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
20 # SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
21 # INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
22 # CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
23 # ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
24 # THE POSSIBILITY OF SUCH DAMAGE.
25 #
26 
27 if [[ -z &quot;${SCRIPT_HEADER_VISIBILITY}&quot; ]]; then
28     exit 0
29 fi
30 
31 ditto &quot;${SCRIPT_INPUT_FILE}&quot; &quot;${SCRIPT_OUTPUT_FILE_0}&quot;
32 header=&quot;${SCRIPT_OUTPUT_FILE_0}&quot;
33 
34 if [[ ${USE_INTERNAL_SDK} == &quot;YES&quot; ]]; then
35     USE_APPLE_INTERNAL_SDK=1
36 else
37     USE_APPLE_INTERNAL_SDK=0
38 fi
39 
40 if [[ ${WK_PLATFORM_NAME} == macosx ]]; then
41     unifdefOptions=&quot;-DTARGET_OS_IPHONE=0 -DTARGET_OS_SIMULATOR=0&quot;
42 elif [[ ${WK_PLATFORM_NAME} == *simulator* ]]; then
43     unifdefOptions=&quot;-DTARGET_OS_IPHONE=1 -DTARGET_OS_SIMULATOR=1 -DUSE_APPLE_INTERNAL_SDK=${USE_APPLE_INTERNAL_SDK}&quot;
44 else
45     unifdefOptions=&quot;-DTARGET_OS_IPHONE=1 -DTARGET_OS_SIMULATOR=0 -DUSE_APPLE_INTERNAL_SDK=${USE_APPLE_INTERNAL_SDK}&quot;
46 fi
47 
48 # FIXME: We should consider making this logic general purpose so as to support keeping or removing
49 # code guarded by an arbitrary feature define. For now it&#39;s sufficient to process touch- and gesture-
50 # guarded code.
51 for featureDefine in &quot;ENABLE_TOUCH_EVENTS&quot; &quot;ENABLE_IOS_GESTURE_EVENTS&quot;
52 do
53     # We assume a disabled feature is either undefined or has the empty string as its value.
54     eval &quot;isFeatureEnabled=\$$featureDefine&quot;
55     if [[ -z $isFeatureEnabled ]]; then
56         unifdefOptions=&quot;$unifdefOptions -D$featureDefine=0&quot;
57     else
58         unifdefOptions=&quot;$unifdefOptions -D$featureDefine=1&quot;
59     fi
60 done
61 
62 unifdef -B ${unifdefOptions} -o &quot;${header}.unifdef&quot; &quot;${header}&quot;
63 case $? in
64     0) rm &quot;${header}&quot;.unifdef ;;
65     1) mv &quot;${header}&quot;{.unifdef,} ;;
66     *) exit 1 ;;
67 esac
68 
69 if [[ &quot;${header}&quot; == &quot;./WebKitAvailability.h&quot; ]]; then
70     exit 0
71 fi
72 
73 if [[ ${WK_PLATFORM_NAME} != macosx ]]; then
74     sed -E -e &quot;s/ *WEBKIT_((CLASS_|ENUM_)?(AVAILABLE|DEPRECATED))_MAC\([^)]+\)//g&quot; &lt; &quot;${header}&quot; &gt; &quot;${header}.sed&quot;
75     if cmp -s &quot;${header}&quot; &quot;${header}.sed&quot;; then
76         rm &quot;${header}.sed&quot;
77     else
78         mv &quot;${header}.sed&quot; &quot;${header}&quot;
79     fi
80 fi
    </pre>
  </body>
</html>