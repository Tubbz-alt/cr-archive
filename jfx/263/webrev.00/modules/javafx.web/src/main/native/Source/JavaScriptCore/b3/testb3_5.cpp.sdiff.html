<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/b3/testb3_5.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="testb3_4.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="testb3_6.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/b3/testb3_5.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 915             AllowMacroScratchRegisterUsage allowScratch(jit);
 916             jit.move(params[0].gpr(), GPRInfo::returnValueGPR);
 917             jit.emitFunctionEpilogue();
 918             jit.ret();
 919         });
 920 
 921     // Make sure the arg is not the destination of the operation.
 922     PatchpointValue* opaqueUse = root-&gt;appendNew&lt;PatchpointValue&gt;(proc, Void, Origin());
 923     opaqueUse-&gt;append(ConstrainedValue(arg, ValueRep::SomeRegister));
 924     opaqueUse-&gt;setGenerator([&amp;] (CCallHelpers&amp;, const StackmapGenerationParams&amp;) { });
 925 
 926     root-&gt;appendNewControlValue(proc, Return, Origin(), checkAdd);
 927 
 928     auto code = compileProc(proc);
 929 
 930     CHECK(invoke&lt;int32_t&gt;(*code, 0ll) == 0);
 931     CHECK(invoke&lt;int32_t&gt;(*code, 1ll) == 2);
 932     CHECK(invoke&lt;int32_t&gt;(*code, std::numeric_limits&lt;int32_t&gt;::max()) == std::numeric_limits&lt;int32_t&gt;::max());
 933 }
 934 








































































 935 void testCheckSubImm()
 936 {
 937     Procedure proc;
 938     if (proc.optLevel() &lt; 1)
 939         return;
 940     BasicBlock* root = proc.addBlock();
 941     Value* arg1 = root-&gt;appendNew&lt;Value&gt;(
 942         proc, Trunc, Origin(),
 943         root-&gt;appendNew&lt;ArgumentRegValue&gt;(proc, Origin(), GPRInfo::argumentGPR0));
 944     Value* arg2 = root-&gt;appendNew&lt;Const32Value&gt;(proc, Origin(), 42);
 945     CheckValue* checkSub = root-&gt;appendNew&lt;CheckValue&gt;(proc, CheckSub, Origin(), arg1, arg2);
 946     checkSub-&gt;append(arg1);
 947     checkSub-&gt;append(arg2);
 948     checkSub-&gt;setGenerator(
 949         [&amp;] (CCallHelpers&amp; jit, const StackmapGenerationParams&amp; params) {
 950             AllowMacroScratchRegisterUsage allowScratch(jit);
 951             CHECK(params.size() == 2);
 952             CHECK(params[0].isGPR());
 953             CHECK(params[1].isConstant());
 954             CHECK(params[1].value() == 42);
</pre>
</td>
<td>
<hr />
<pre>
 915             AllowMacroScratchRegisterUsage allowScratch(jit);
 916             jit.move(params[0].gpr(), GPRInfo::returnValueGPR);
 917             jit.emitFunctionEpilogue();
 918             jit.ret();
 919         });
 920 
 921     // Make sure the arg is not the destination of the operation.
 922     PatchpointValue* opaqueUse = root-&gt;appendNew&lt;PatchpointValue&gt;(proc, Void, Origin());
 923     opaqueUse-&gt;append(ConstrainedValue(arg, ValueRep::SomeRegister));
 924     opaqueUse-&gt;setGenerator([&amp;] (CCallHelpers&amp;, const StackmapGenerationParams&amp;) { });
 925 
 926     root-&gt;appendNewControlValue(proc, Return, Origin(), checkAdd);
 927 
 928     auto code = compileProc(proc);
 929 
 930     CHECK(invoke&lt;int32_t&gt;(*code, 0ll) == 0);
 931     CHECK(invoke&lt;int32_t&gt;(*code, 1ll) == 2);
 932     CHECK(invoke&lt;int32_t&gt;(*code, std::numeric_limits&lt;int32_t&gt;::max()) == std::numeric_limits&lt;int32_t&gt;::max());
 933 }
 934 
<span class="line-added"> 935 void testCheckAddRemoveCheckWithSExt8(int8_t value)</span>
<span class="line-added"> 936 {</span>
<span class="line-added"> 937     Procedure proc;</span>
<span class="line-added"> 938     BasicBlock* root = proc.addBlock();</span>
<span class="line-added"> 939     Value* arg = root-&gt;appendNew&lt;Value&gt;(proc, SExt32, Origin(), root-&gt;appendNew&lt;Value&gt;(proc, SExt8, Origin(), root-&gt;appendNew&lt;Value&gt;(proc, Trunc, Origin(), root-&gt;appendNew&lt;ArgumentRegValue&gt;(proc, Origin(), GPRInfo::argumentGPR0))));</span>
<span class="line-added"> 940     CheckValue* checkAdd = root-&gt;appendNew&lt;CheckValue&gt;(proc, CheckAdd, Origin(), arg, arg);</span>
<span class="line-added"> 941     checkAdd-&gt;setGenerator(</span>
<span class="line-added"> 942         [&amp;] (CCallHelpers&amp; jit, const StackmapGenerationParams&amp;) {</span>
<span class="line-added"> 943             AllowMacroScratchRegisterUsage allowScratch(jit);</span>
<span class="line-added"> 944             jit.abortWithReason(B3Oops);</span>
<span class="line-added"> 945         });</span>
<span class="line-added"> 946     root-&gt;appendNewControlValue(proc, Return, Origin(), checkAdd);</span>
<span class="line-added"> 947 </span>
<span class="line-added"> 948     auto code = compileProc(proc);</span>
<span class="line-added"> 949 </span>
<span class="line-added"> 950     CHECK(invoke&lt;int64_t&gt;(*code, value) == 2ll * static_cast&lt;int32_t&gt;(value));</span>
<span class="line-added"> 951 }</span>
<span class="line-added"> 952 </span>
<span class="line-added"> 953 void testCheckAddRemoveCheckWithSExt16(int16_t value)</span>
<span class="line-added"> 954 {</span>
<span class="line-added"> 955     Procedure proc;</span>
<span class="line-added"> 956     BasicBlock* root = proc.addBlock();</span>
<span class="line-added"> 957     Value* arg = root-&gt;appendNew&lt;Value&gt;(proc, SExt32, Origin(), root-&gt;appendNew&lt;Value&gt;(proc, SExt16, Origin(), root-&gt;appendNew&lt;Value&gt;(proc, Trunc, Origin(), root-&gt;appendNew&lt;ArgumentRegValue&gt;(proc, Origin(), GPRInfo::argumentGPR0))));</span>
<span class="line-added"> 958     CheckValue* checkAdd = root-&gt;appendNew&lt;CheckValue&gt;(proc, CheckAdd, Origin(), arg, arg);</span>
<span class="line-added"> 959     checkAdd-&gt;setGenerator(</span>
<span class="line-added"> 960         [&amp;] (CCallHelpers&amp; jit, const StackmapGenerationParams&amp;) {</span>
<span class="line-added"> 961             AllowMacroScratchRegisterUsage allowScratch(jit);</span>
<span class="line-added"> 962             jit.abortWithReason(B3Oops);</span>
<span class="line-added"> 963         });</span>
<span class="line-added"> 964     root-&gt;appendNewControlValue(proc, Return, Origin(), checkAdd);</span>
<span class="line-added"> 965 </span>
<span class="line-added"> 966     auto code = compileProc(proc);</span>
<span class="line-added"> 967 </span>
<span class="line-added"> 968     CHECK(invoke&lt;int64_t&gt;(*code, value) == 2ll * static_cast&lt;int32_t&gt;(value));</span>
<span class="line-added"> 969 }</span>
<span class="line-added"> 970 </span>
<span class="line-added"> 971 void testCheckAddRemoveCheckWithSExt32(int32_t value)</span>
<span class="line-added"> 972 {</span>
<span class="line-added"> 973     Procedure proc;</span>
<span class="line-added"> 974     BasicBlock* root = proc.addBlock();</span>
<span class="line-added"> 975     Value* arg = root-&gt;appendNew&lt;Value&gt;(proc, SExt32, Origin(), root-&gt;appendNew&lt;Value&gt;(proc, Trunc, Origin(), root-&gt;appendNew&lt;ArgumentRegValue&gt;(proc, Origin(), GPRInfo::argumentGPR0)));</span>
<span class="line-added"> 976     CheckValue* checkAdd = root-&gt;appendNew&lt;CheckValue&gt;(proc, CheckAdd, Origin(), arg, arg);</span>
<span class="line-added"> 977     checkAdd-&gt;setGenerator(</span>
<span class="line-added"> 978         [&amp;] (CCallHelpers&amp; jit, const StackmapGenerationParams&amp;) {</span>
<span class="line-added"> 979             AllowMacroScratchRegisterUsage allowScratch(jit);</span>
<span class="line-added"> 980             jit.abortWithReason(B3Oops);</span>
<span class="line-added"> 981         });</span>
<span class="line-added"> 982     root-&gt;appendNewControlValue(proc, Return, Origin(), checkAdd);</span>
<span class="line-added"> 983 </span>
<span class="line-added"> 984     auto code = compileProc(proc);</span>
<span class="line-added"> 985 </span>
<span class="line-added"> 986     CHECK(invoke&lt;int64_t&gt;(*code, value) == 2ll * value);</span>
<span class="line-added"> 987 }</span>
<span class="line-added"> 988 </span>
<span class="line-added"> 989 void testCheckAddRemoveCheckWithZExt32(int32_t value)</span>
<span class="line-added"> 990 {</span>
<span class="line-added"> 991     Procedure proc;</span>
<span class="line-added"> 992     BasicBlock* root = proc.addBlock();</span>
<span class="line-added"> 993     Value* arg = root-&gt;appendNew&lt;Value&gt;(proc, ZExt32, Origin(), root-&gt;appendNew&lt;Value&gt;(proc, Trunc, Origin(), root-&gt;appendNew&lt;ArgumentRegValue&gt;(proc, Origin(), GPRInfo::argumentGPR0)));</span>
<span class="line-added"> 994     CheckValue* checkAdd = root-&gt;appendNew&lt;CheckValue&gt;(proc, CheckAdd, Origin(), arg, arg);</span>
<span class="line-added"> 995     checkAdd-&gt;setGenerator(</span>
<span class="line-added"> 996         [&amp;] (CCallHelpers&amp; jit, const StackmapGenerationParams&amp;) {</span>
<span class="line-added"> 997             AllowMacroScratchRegisterUsage allowScratch(jit);</span>
<span class="line-added"> 998             jit.abortWithReason(B3Oops);</span>
<span class="line-added"> 999         });</span>
<span class="line-added">1000     root-&gt;appendNewControlValue(proc, Return, Origin(), checkAdd);</span>
<span class="line-added">1001 </span>
<span class="line-added">1002     auto code = compileProc(proc);</span>
<span class="line-added">1003 </span>
<span class="line-added">1004     CHECK(invoke&lt;uint64_t&gt;(*code, value) == static_cast&lt;uint64_t&gt;(2 * static_cast&lt;uint64_t&gt;(static_cast&lt;uint32_t&gt;(value))));</span>
<span class="line-added">1005 }</span>
<span class="line-added">1006 </span>
1007 void testCheckSubImm()
1008 {
1009     Procedure proc;
1010     if (proc.optLevel() &lt; 1)
1011         return;
1012     BasicBlock* root = proc.addBlock();
1013     Value* arg1 = root-&gt;appendNew&lt;Value&gt;(
1014         proc, Trunc, Origin(),
1015         root-&gt;appendNew&lt;ArgumentRegValue&gt;(proc, Origin(), GPRInfo::argumentGPR0));
1016     Value* arg2 = root-&gt;appendNew&lt;Const32Value&gt;(proc, Origin(), 42);
1017     CheckValue* checkSub = root-&gt;appendNew&lt;CheckValue&gt;(proc, CheckSub, Origin(), arg1, arg2);
1018     checkSub-&gt;append(arg1);
1019     checkSub-&gt;append(arg2);
1020     checkSub-&gt;setGenerator(
1021         [&amp;] (CCallHelpers&amp; jit, const StackmapGenerationParams&amp; params) {
1022             AllowMacroScratchRegisterUsage allowScratch(jit);
1023             CHECK(params.size() == 2);
1024             CHECK(params[0].isGPR());
1025             CHECK(params[1].isConstant());
1026             CHECK(params[1].value() == 42);
</pre>
</td>
</tr>
</table>
<center><a href="testb3_4.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="testb3_6.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>