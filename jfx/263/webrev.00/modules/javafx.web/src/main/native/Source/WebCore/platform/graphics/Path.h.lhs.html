<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/Path.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2003, 2006, 2009, 2016 Apple Inc. All rights reserved.
  3  * Copyright (C) 2006 Rob Buis &lt;buis@kde.org&gt;
  4  * Copyright (C) 2007-2008 Torch Mobile, Inc.
  5  *
  6  * Redistribution and use in source and binary forms, with or without
  7  * modification, are permitted provided that the following conditions
  8  * are met:
  9  * 1. Redistributions of source code must retain the above copyright
 10  *    notice, this list of conditions and the following disclaimer.
 11  * 2. Redistributions in binary form must reproduce the above copyright
 12  *    notice, this list of conditions and the following disclaimer in the
 13  *    documentation and/or other materials provided with the distribution.
 14  *
 15  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 16  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 17  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 18  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 19  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 20  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 21  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 22  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 23  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 24  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 25  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 26  */
 27 
 28 #ifndef Path_h
 29 #define Path_h
 30 
 31 #include &quot;FloatRect.h&quot;
 32 #include &quot;WindRule.h&quot;
 33 #include &lt;wtf/FastMalloc.h&gt;
 34 #include &lt;wtf/Function.h&gt;
 35 #include &lt;wtf/Forward.h&gt;
 36 
 37 #if USE(CG)
 38 
 39 #include &lt;wtf/RetainPtr.h&gt;
 40 #include &lt;CoreGraphics/CGPath.h&gt;
 41 typedef struct CGPath PlatformPath;
 42 
 43 #elif USE(DIRECT2D)
 44 #include &quot;COMPtr.h&quot;
 45 
 46 interface ID2D1Geometry;
 47 interface ID2D1GeometryGroup;
 48 interface ID2D1PathGeometry;
 49 interface ID2D1GeometrySink;
 50 
 51 typedef ID2D1GeometryGroup PlatformPath;
 52 
<a name="1" id="anc1"></a>



 53 #elif USE(CAIRO)
 54 
 55 namespace WebCore {
 56 class CairoPath;
 57 }
 58 typedef WebCore::CairoPath PlatformPath;
 59 
 60 #elif USE(WINGDI)
 61 
 62 namespace WebCore {
 63 class PlatformPath;
 64 }
 65 typedef WebCore::PlatformPath PlatformPath;
 66 
 67 #elif PLATFORM(JAVA)
 68 #include &lt;wtf/RefPtr.h&gt;
 69 #include &quot;RQRef.h&quot;
 70 typedef RefPtr&lt;WebCore::RQRef&gt; PlatformPath;
 71 
 72 #else
 73 
 74 typedef void PlatformPath;
 75 
 76 #endif
 77 
 78 #if PLATFORM(JAVA)
 79 typedef RefPtr&lt;WebCore::RQRef&gt; PlatformPathPtr;
 80 #else
 81 typedef PlatformPath* PlatformPathPtr;
 82 #endif
 83 
 84 namespace WTF {
 85 class TextStream;
 86 }
 87 
 88 namespace WebCore {
 89 
<a name="2" id="anc2"></a><span class="line-modified"> 90     class AffineTransform;</span>
<span class="line-modified"> 91     class FloatPoint;</span>
<span class="line-modified"> 92     class FloatRoundedRect;</span>
<span class="line-modified"> 93     class FloatSize;</span>
<span class="line-modified"> 94     class GraphicsContext;</span>
<span class="line-modified"> 95     class PathTraversalState;</span>
<span class="line-modified"> 96     class RoundedRect;</span>
<span class="line-modified"> 97     class StrokeStyleApplier;</span>
<span class="line-modified"> 98 </span>
<span class="line-modified"> 99     enum PathElementType {</span>
<span class="line-modified">100         PathElementMoveToPoint, // The points member will contain 1 value.</span>
<span class="line-modified">101         PathElementAddLineToPoint, // The points member will contain 1 value.</span>
<span class="line-modified">102         PathElementAddQuadCurveToPoint, // The points member will contain 2 values.</span>
<span class="line-modified">103         PathElementAddCurveToPoint, // The points member will contain 3 values.</span>
<span class="line-modified">104         PathElementCloseSubpath // The points member will contain no values.</span>




105     };
106 
<a name="3" id="anc3"></a><span class="line-modified">107     // The points in the structure are the same as those that would be used with the</span>
<span class="line-modified">108     // add... method. For example, a line returns the endpoint, while a cubic returns</span>
<span class="line-modified">109     // two tangent points and the endpoint.</span>
<span class="line-removed">110     struct PathElement {</span>
<span class="line-removed">111         PathElementType type;</span>
<span class="line-removed">112         FloatPoint* points;</span>
<span class="line-removed">113     };</span>
114 
<a name="4" id="anc4"></a><span class="line-modified">115     using PathApplierFunction = WTF::Function&lt;void (const PathElement&amp;)&gt;;</span>
116 
<a name="5" id="anc5"></a><span class="line-modified">117     class Path {</span>
<span class="line-modified">118         WTF_MAKE_FAST_ALLOCATED;</span>
<span class="line-modified">119     public:</span>
<span class="line-modified">120         WEBCORE_EXPORT Path();</span>
121 #if USE(CG)
<a name="6" id="anc6"></a><span class="line-modified">122         Path(RetainPtr&lt;CGMutablePathRef&gt;);</span>
123 #endif
<a name="7" id="anc7"></a><span class="line-modified">124         WEBCORE_EXPORT ~Path();</span>
<span class="line-modified">125 </span>
<span class="line-modified">126         WEBCORE_EXPORT Path(const Path&amp;);</span>
<span class="line-modified">127         WEBCORE_EXPORT Path(Path&amp;&amp;);</span>
<span class="line-modified">128         WEBCORE_EXPORT Path&amp; operator=(const Path&amp;);</span>
<span class="line-modified">129         WEBCORE_EXPORT Path&amp; operator=(Path&amp;&amp;);</span>
<span class="line-modified">130 </span>
<span class="line-modified">131         static Path polygonPathFromPoints(const Vector&lt;FloatPoint&gt;&amp;);</span>
<span class="line-modified">132 </span>
<span class="line-modified">133         bool contains(const FloatPoint&amp;, WindRule = WindRule::NonZero) const;</span>
<span class="line-modified">134         bool strokeContains(StrokeStyleApplier*, const FloatPoint&amp;) const;</span>
<span class="line-modified">135         // fastBoundingRect() should equal or contain boundingRect(); boundingRect()</span>
<span class="line-modified">136         // should perfectly bound the points within the path.</span>
<span class="line-modified">137         FloatRect boundingRect() const;</span>
<span class="line-modified">138         WEBCORE_EXPORT FloatRect fastBoundingRect() const;</span>
<span class="line-modified">139         FloatRect strokeBoundingRect(StrokeStyleApplier* = 0) const;</span>
<span class="line-modified">140 </span>
<span class="line-modified">141         float length() const;</span>
<span class="line-modified">142         PathTraversalState traversalStateAtLength(float length, bool&amp; success) const;</span>
<span class="line-modified">143         FloatPoint pointAtLength(float length, bool&amp; success) const;</span>
<span class="line-modified">144         float normalAngleAtLength(float length, bool&amp; success) const;</span>
<span class="line-modified">145 </span>
<span class="line-modified">146         WEBCORE_EXPORT void clear();</span>
<span class="line-modified">147         bool isNull() const { return !m_path; }</span>
<span class="line-modified">148         bool isEmpty() const;</span>
<span class="line-modified">149         // Gets the current point of the current path, which is conceptually the final point reached by the path so far.</span>
<span class="line-modified">150         // Note the Path can be empty (isEmpty() == true) and still have a current point.</span>
<span class="line-modified">151         bool hasCurrentPoint() const;</span>
<span class="line-modified">152         FloatPoint currentPoint() const;</span>
<span class="line-modified">153 </span>
<span class="line-modified">154         WEBCORE_EXPORT void moveTo(const FloatPoint&amp;);</span>
<span class="line-modified">155         WEBCORE_EXPORT void addLineTo(const FloatPoint&amp;);</span>
<span class="line-modified">156         WEBCORE_EXPORT void addQuadCurveTo(const FloatPoint&amp; controlPoint, const FloatPoint&amp; endPoint);</span>
<span class="line-modified">157         WEBCORE_EXPORT void addBezierCurveTo(const FloatPoint&amp; controlPoint1, const FloatPoint&amp; controlPoint2, const FloatPoint&amp; endPoint);</span>
<span class="line-modified">158         void addArcTo(const FloatPoint&amp;, const FloatPoint&amp;, float radius);</span>
<span class="line-modified">159         WEBCORE_EXPORT void closeSubpath();</span>
<span class="line-modified">160 </span>
<span class="line-modified">161         void addArc(const FloatPoint&amp;, float radius, float startAngle, float endAngle, bool anticlockwise);</span>
<span class="line-modified">162         void addRect(const FloatRect&amp;);</span>
<span class="line-modified">163         void addEllipse(FloatPoint, float radiusX, float radiusY, float rotation, float startAngle, float endAngle, bool anticlockwise);</span>
<span class="line-modified">164         void addEllipse(const FloatRect&amp;);</span>
<span class="line-modified">165 </span>
<span class="line-modified">166         enum RoundedRectStrategy {</span>
<span class="line-modified">167             PreferNativeRoundedRect,</span>
<span class="line-modified">168             PreferBezierRoundedRect</span>
<span class="line-modified">169         };</span>
<span class="line-modified">170 </span>
<span class="line-modified">171         WEBCORE_EXPORT void addRoundedRect(const FloatRect&amp;, const FloatSize&amp; roundingRadii, RoundedRectStrategy = PreferNativeRoundedRect);</span>
<span class="line-modified">172         WEBCORE_EXPORT void addRoundedRect(const FloatRoundedRect&amp;, RoundedRectStrategy = PreferNativeRoundedRect);</span>
<span class="line-modified">173         void addRoundedRect(const RoundedRect&amp;);</span>
<span class="line-modified">174 </span>
<span class="line-modified">175         void addPath(const Path&amp;, const AffineTransform&amp;);</span>
<span class="line-modified">176 </span>
<span class="line-modified">177         void translate(const FloatSize&amp;);</span>
<span class="line-modified">178 </span>
<span class="line-modified">179         // To keep Path() cheap, it does not allocate a PlatformPath immediately</span>
<span class="line-removed">180         // meaning Path::platformPath() can return null.</span>
181 #if USE(DIRECT2D)
<a name="8" id="anc8"></a><span class="line-modified">182         PlatformPathPtr platformPath() const { return m_path.get(); }</span>

183 #else
<a name="9" id="anc9"></a><span class="line-modified">184         PlatformPathPtr platformPath() const { return m_path; }</span>
185 #endif
<a name="10" id="anc10"></a><span class="line-modified">186         // ensurePlatformPath() will allocate a PlatformPath if it has not yet been and will never return null.</span>
<span class="line-modified">187         WEBCORE_EXPORT PlatformPathPtr ensurePlatformPath();</span>
188 
<a name="11" id="anc11"></a><span class="line-modified">189         WEBCORE_EXPORT void apply(const PathApplierFunction&amp;) const;</span>
<span class="line-modified">190         void transform(const AffineTransform&amp;);</span>
191 
<a name="12" id="anc12"></a><span class="line-modified">192         static float circleControlPoint()</span>
<span class="line-modified">193         {</span>
<span class="line-modified">194             // Approximation of control point positions on a bezier to simulate a quarter of a circle.</span>
<span class="line-modified">195             // This is 1-kappa, where kappa = 4 * (sqrt(2) - 1) / 3</span>
<span class="line-modified">196             return 0.447715;</span>
<span class="line-modified">197         }</span>
198 
<a name="13" id="anc13"></a><span class="line-modified">199         void addBeziersForRoundedRect(const FloatRect&amp;, const FloatSize&amp; topLeftRadius, const FloatSize&amp; topRightRadius, const FloatSize&amp; bottomLeftRadius, const FloatSize&amp; bottomRightRadius);</span>
200 
201 #if USE(CG) || USE(DIRECT2D)
<a name="14" id="anc14"></a><span class="line-modified">202         void platformAddPathForRoundedRect(const FloatRect&amp;, const FloatSize&amp; topLeftRadius, const FloatSize&amp; topRightRadius, const FloatSize&amp; bottomLeftRadius, const FloatSize&amp; bottomRightRadius);</span>
203 #endif
204 
205 #if USE(DIRECT2D)
<a name="15" id="anc15"></a><span class="line-modified">206         ID2D1GeometrySink* activePath() const { return m_activePath.get(); }</span>
<span class="line-modified">207         void appendGeometry(ID2D1Geometry*);</span>
<span class="line-modified">208         void createGeometryWithFillMode(WindRule, COMPtr&lt;ID2D1GeometryGroup&gt;&amp;) const;</span>
<span class="line-modified">209         void drawDidComplete();</span>
<span class="line-modified">210 </span>
<span class="line-modified">211         HRESULT initializePathState();</span>
<span class="line-removed">212         void openFigureAtCurrentPointIfNecessary();</span>
<span class="line-removed">213         void closeAnyOpenGeometries();</span>
214 #endif
215 
216 #ifndef NDEBUG
<a name="16" id="anc16"></a><span class="line-modified">217         void dump() const;</span>
218 #endif
219 
<a name="17" id="anc17"></a><span class="line-modified">220     private:</span>



221 #if USE(DIRECT2D)
<a name="18" id="anc18"></a><span class="line-modified">222         COMPtr&lt;ID2D1GeometryGroup&gt; m_path;</span>
<span class="line-modified">223         COMPtr&lt;ID2D1PathGeometry&gt; m_activePathGeometry;</span>
<span class="line-modified">224         COMPtr&lt;ID2D1GeometrySink&gt; m_activePath;</span>
<span class="line-modified">225         size_t m_openFigureCount { 0 };</span>
226 #else
<a name="19" id="anc19"></a><span class="line-modified">227         PlatformPathPtr m_path { nullptr };</span>
228 #endif
<a name="20" id="anc20"></a><span class="line-modified">229     };</span>
230 
231 WTF::TextStream&amp; operator&lt;&lt;(WTF::TextStream&amp;, const Path&amp;);
232 
<a name="21" id="anc21"></a>



































































































233 }
234 
235 #endif
<a name="22" id="anc22"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="22" type="hidden" />
</body>
</html>