<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/editing/EditorCommand.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Editor.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="FontAttributeChanges.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/editing/EditorCommand.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
1065 static bool executeSelectWord(Frame&amp; frame, Event*, EditorCommandSource, const String&amp;)
1066 {
1067     return expandSelectionToGranularity(frame, WordGranularity);
1068 }
1069 
1070 static bool executeSetMark(Frame&amp; frame, Event*, EditorCommandSource, const String&amp;)
1071 {
1072     frame.editor().setMark(frame.selection().selection());
1073     return true;
1074 }
1075 
1076 static TextDecorationChange textDecorationChangeForToggling(Editor&amp; editor, CSSPropertyID propertyID, const char* onValue)
1077 {
1078     return isStylePresent(editor, propertyID, onValue) ? TextDecorationChange::Remove : TextDecorationChange::Add;
1079 }
1080 
1081 static bool executeStrikethrough(Frame&amp; frame, Event*, EditorCommandSource source, const String&amp;)
1082 {
1083     Ref&lt;EditingStyle&gt; style = EditingStyle::create();
1084     style-&gt;setStrikeThroughChange(textDecorationChangeForToggling(frame.editor(), CSSPropertyWebkitTextDecorationsInEffect, &quot;line-through&quot;_s));
<span class="line-modified">1085     // FIXME: Needs a new EditAction!</span>
<span class="line-removed">1086     return applyCommandToFrame(frame, source, EditAction::Underline, WTFMove(style));</span>
1087 }
1088 
1089 static bool executeStyleWithCSS(Frame&amp; frame, Event*, EditorCommandSource, const String&amp; value)
1090 {
1091     frame.editor().setShouldStyleWithCSS(!equalLettersIgnoringASCIICase(value, &quot;false&quot;));
1092     return true;
1093 }
1094 
1095 static bool executeUseCSS(Frame&amp; frame, Event*, EditorCommandSource, const String&amp; value)
1096 {
1097     frame.editor().setShouldStyleWithCSS(equalLettersIgnoringASCIICase(value, &quot;false&quot;));
1098     return true;
1099 }
1100 
1101 static bool executeSubscript(Frame&amp; frame, Event*, EditorCommandSource source, const String&amp;)
1102 {
1103     return executeToggleStyle(frame, source, EditAction::Subscript, CSSPropertyVerticalAlign, &quot;baseline&quot;_s, &quot;sub&quot;_s);
1104 }
1105 
1106 static bool executeSuperscript(Frame&amp; frame, Event*, EditorCommandSource source, const String&amp;)
</pre>
<hr />
<pre>
1218         return true;
1219     case ClipboardAccessPolicy::Deny:
1220         return false;
1221     }
1222 
1223     ASSERT_NOT_REACHED();
1224     return false;
1225 }
1226 
1227 static bool supportedCopyCut(Frame* frame)
1228 {
1229     if (!frame)
1230         return false;
1231 
1232     bool defaultValue = defaultValueForSupportedCopyCut(*frame);
1233 
1234     EditorClient* client = frame-&gt;editor().client();
1235     return client ? client-&gt;canCopyCut(frame, defaultValue) : defaultValue;
1236 }
1237 









1238 static bool supportedPaste(Frame* frame)
1239 {
1240     if (!frame)
1241         return false;
1242 
<span class="line-modified">1243     auto&amp; settings = frame-&gt;settings();</span>
<span class="line-removed">1244     bool defaultValue = (settings.javaScriptCanAccessClipboard() &amp;&amp; settings.DOMPasteAllowed()) || settings.domPasteAccessRequestsEnabled();</span>
1245 
1246     EditorClient* client = frame-&gt;editor().client();
1247     return client ? client-&gt;canPaste(frame, defaultValue) : defaultValue;
1248 }
1249 
1250 // Enabled functions
1251 
1252 static bool enabled(Frame&amp;, Event*, EditorCommandSource)
1253 {
1254     return true;
1255 }
1256 
1257 static bool enabledVisibleSelection(Frame&amp; frame, Event* event, EditorCommandSource)
1258 {
1259     // The term &quot;visible&quot; here includes a caret in editable text or a range in any text.
1260     const VisibleSelection&amp; selection = frame.editor().selectionForCommand(event);
1261     return (selection.isCaret() &amp;&amp; selection.isContentEditable()) || selection.isRange();
1262 }
1263 
1264 static bool caretBrowsingEnabled(Frame&amp; frame)
</pre>
<hr />
<pre>
1353         // &quot;Delete&quot; from DOM is like delete/backspace keypress, affects selected range if non-empty,
1354         // otherwise removes a character
1355         return enabledInEditableText(frame, event, source);
1356     }
1357     ASSERT_NOT_REACHED();
1358     return false;
1359 }
1360 
1361 static bool enabledInEditableTextOrCaretBrowsing(Frame&amp; frame, Event* event, EditorCommandSource)
1362 {
1363     // The EditorCommandSource parameter is unused in enabledInEditableText, so just pass a dummy variable
1364     return caretBrowsingEnabled(frame) || enabledInEditableText(frame, event, dummyEditorCommandSource);
1365 }
1366 
1367 static bool enabledInRichlyEditableText(Frame&amp; frame, Event*, EditorCommandSource)
1368 {
1369     const VisibleSelection&amp; selection = frame.selection().selection();
1370     return selection.isCaretOrRange() &amp;&amp; selection.isContentRichlyEditable() &amp;&amp; selection.rootEditableElement();
1371 }
1372 
<span class="line-modified">1373 static bool enabledPaste(Frame&amp; frame, Event*, EditorCommandSource)</span>









1374 {
<span class="line-modified">1375     return frame.editor().canPaste();</span>








1376 }
1377 
1378 static bool enabledRangeInEditableText(Frame&amp; frame, Event*, EditorCommandSource)
1379 {
1380     return frame.selection().isRange() &amp;&amp; frame.selection().selection().isContentEditable();
1381 }
1382 
1383 static bool enabledRangeInRichlyEditableText(Frame&amp; frame, Event*, EditorCommandSource)
1384 {
1385     return frame.selection().isRange() &amp;&amp; frame.selection().selection().isContentRichlyEditable();
1386 }
1387 
1388 static bool enabledRedo(Frame&amp; frame, Event*, EditorCommandSource)
1389 {
1390     return frame.editor().canRedo();
1391 }
1392 
1393 #if PLATFORM(COCOA)
1394 
1395 static bool enabledTakeFindStringFromSelection(Frame&amp; frame, Event*, EditorCommandSource)
</pre>
</td>
<td>
<hr />
<pre>
1065 static bool executeSelectWord(Frame&amp; frame, Event*, EditorCommandSource, const String&amp;)
1066 {
1067     return expandSelectionToGranularity(frame, WordGranularity);
1068 }
1069 
1070 static bool executeSetMark(Frame&amp; frame, Event*, EditorCommandSource, const String&amp;)
1071 {
1072     frame.editor().setMark(frame.selection().selection());
1073     return true;
1074 }
1075 
1076 static TextDecorationChange textDecorationChangeForToggling(Editor&amp; editor, CSSPropertyID propertyID, const char* onValue)
1077 {
1078     return isStylePresent(editor, propertyID, onValue) ? TextDecorationChange::Remove : TextDecorationChange::Add;
1079 }
1080 
1081 static bool executeStrikethrough(Frame&amp; frame, Event*, EditorCommandSource source, const String&amp;)
1082 {
1083     Ref&lt;EditingStyle&gt; style = EditingStyle::create();
1084     style-&gt;setStrikeThroughChange(textDecorationChangeForToggling(frame.editor(), CSSPropertyWebkitTextDecorationsInEffect, &quot;line-through&quot;_s));
<span class="line-modified">1085     return applyCommandToFrame(frame, source, EditAction::StrikeThrough, WTFMove(style));</span>

1086 }
1087 
1088 static bool executeStyleWithCSS(Frame&amp; frame, Event*, EditorCommandSource, const String&amp; value)
1089 {
1090     frame.editor().setShouldStyleWithCSS(!equalLettersIgnoringASCIICase(value, &quot;false&quot;));
1091     return true;
1092 }
1093 
1094 static bool executeUseCSS(Frame&amp; frame, Event*, EditorCommandSource, const String&amp; value)
1095 {
1096     frame.editor().setShouldStyleWithCSS(equalLettersIgnoringASCIICase(value, &quot;false&quot;));
1097     return true;
1098 }
1099 
1100 static bool executeSubscript(Frame&amp; frame, Event*, EditorCommandSource source, const String&amp;)
1101 {
1102     return executeToggleStyle(frame, source, EditAction::Subscript, CSSPropertyVerticalAlign, &quot;baseline&quot;_s, &quot;sub&quot;_s);
1103 }
1104 
1105 static bool executeSuperscript(Frame&amp; frame, Event*, EditorCommandSource source, const String&amp;)
</pre>
<hr />
<pre>
1217         return true;
1218     case ClipboardAccessPolicy::Deny:
1219         return false;
1220     }
1221 
1222     ASSERT_NOT_REACHED();
1223     return false;
1224 }
1225 
1226 static bool supportedCopyCut(Frame* frame)
1227 {
1228     if (!frame)
1229         return false;
1230 
1231     bool defaultValue = defaultValueForSupportedCopyCut(*frame);
1232 
1233     EditorClient* client = frame-&gt;editor().client();
1234     return client ? client-&gt;canCopyCut(frame, defaultValue) : defaultValue;
1235 }
1236 
<span class="line-added">1237 static bool defaultValueForSupportedPaste(Frame&amp; frame)</span>
<span class="line-added">1238 {</span>
<span class="line-added">1239     auto&amp; settings = frame.settings();</span>
<span class="line-added">1240     if (settings.javaScriptCanAccessClipboard() &amp;&amp; settings.DOMPasteAllowed())</span>
<span class="line-added">1241         return true;</span>
<span class="line-added">1242 </span>
<span class="line-added">1243     return settings.domPasteAccessRequestsEnabled();</span>
<span class="line-added">1244 }</span>
<span class="line-added">1245 </span>
1246 static bool supportedPaste(Frame* frame)
1247 {
1248     if (!frame)
1249         return false;
1250 
<span class="line-modified">1251     bool defaultValue = defaultValueForSupportedPaste(*frame);</span>

1252 
1253     EditorClient* client = frame-&gt;editor().client();
1254     return client ? client-&gt;canPaste(frame, defaultValue) : defaultValue;
1255 }
1256 
1257 // Enabled functions
1258 
1259 static bool enabled(Frame&amp;, Event*, EditorCommandSource)
1260 {
1261     return true;
1262 }
1263 
1264 static bool enabledVisibleSelection(Frame&amp; frame, Event* event, EditorCommandSource)
1265 {
1266     // The term &quot;visible&quot; here includes a caret in editable text or a range in any text.
1267     const VisibleSelection&amp; selection = frame.editor().selectionForCommand(event);
1268     return (selection.isCaret() &amp;&amp; selection.isContentEditable()) || selection.isRange();
1269 }
1270 
1271 static bool caretBrowsingEnabled(Frame&amp; frame)
</pre>
<hr />
<pre>
1360         // &quot;Delete&quot; from DOM is like delete/backspace keypress, affects selected range if non-empty,
1361         // otherwise removes a character
1362         return enabledInEditableText(frame, event, source);
1363     }
1364     ASSERT_NOT_REACHED();
1365     return false;
1366 }
1367 
1368 static bool enabledInEditableTextOrCaretBrowsing(Frame&amp; frame, Event* event, EditorCommandSource)
1369 {
1370     // The EditorCommandSource parameter is unused in enabledInEditableText, so just pass a dummy variable
1371     return caretBrowsingEnabled(frame) || enabledInEditableText(frame, event, dummyEditorCommandSource);
1372 }
1373 
1374 static bool enabledInRichlyEditableText(Frame&amp; frame, Event*, EditorCommandSource)
1375 {
1376     const VisibleSelection&amp; selection = frame.selection().selection();
1377     return selection.isCaretOrRange() &amp;&amp; selection.isContentRichlyEditable() &amp;&amp; selection.rootEditableElement();
1378 }
1379 
<span class="line-modified">1380 static bool allowPasteFromDOM(Frame&amp; frame)</span>
<span class="line-added">1381 {</span>
<span class="line-added">1382     auto&amp; settings = frame.settings();</span>
<span class="line-added">1383     if (settings.javaScriptCanAccessClipboard() &amp;&amp; settings.DOMPasteAllowed())</span>
<span class="line-added">1384         return true;</span>
<span class="line-added">1385 </span>
<span class="line-added">1386     return settings.domPasteAccessRequestsEnabled() &amp;&amp; UserGestureIndicator::processingUserGesture();</span>
<span class="line-added">1387 }</span>
<span class="line-added">1388 </span>
<span class="line-added">1389 static bool enabledPaste(Frame&amp; frame, Event*, EditorCommandSource source)</span>
1390 {
<span class="line-modified">1391     switch (source) {</span>
<span class="line-added">1392     case CommandFromMenuOrKeyBinding:</span>
<span class="line-added">1393         return frame.editor().canDHTMLPaste() || frame.editor().canPaste();</span>
<span class="line-added">1394     case CommandFromDOM:</span>
<span class="line-added">1395     case CommandFromDOMWithUserInterface:</span>
<span class="line-added">1396         return allowPasteFromDOM(frame) &amp;&amp; (frame.editor().canDHTMLPaste() || frame.editor().canPaste());</span>
<span class="line-added">1397     }</span>
<span class="line-added">1398     ASSERT_NOT_REACHED();</span>
<span class="line-added">1399     return false;</span>
1400 }
1401 
1402 static bool enabledRangeInEditableText(Frame&amp; frame, Event*, EditorCommandSource)
1403 {
1404     return frame.selection().isRange() &amp;&amp; frame.selection().selection().isContentEditable();
1405 }
1406 
1407 static bool enabledRangeInRichlyEditableText(Frame&amp; frame, Event*, EditorCommandSource)
1408 {
1409     return frame.selection().isRange() &amp;&amp; frame.selection().selection().isContentRichlyEditable();
1410 }
1411 
1412 static bool enabledRedo(Frame&amp; frame, Event*, EditorCommandSource)
1413 {
1414     return frame.editor().canRedo();
1415 }
1416 
1417 #if PLATFORM(COCOA)
1418 
1419 static bool enabledTakeFindStringFromSelection(Frame&amp; frame, Event*, EditorCommandSource)
</pre>
</td>
</tr>
</table>
<center><a href="Editor.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="FontAttributeChanges.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>