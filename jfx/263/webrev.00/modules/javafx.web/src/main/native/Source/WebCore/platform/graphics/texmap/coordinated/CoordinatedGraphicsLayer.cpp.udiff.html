<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/texmap/coordinated/CoordinatedGraphicsLayer.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../TextureMapperShaderProgram.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="CoordinatedGraphicsLayer.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/texmap/coordinated/CoordinatedGraphicsLayer.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -104,13 +104,14 @@</span>
          downcast&lt;CoordinatedGraphicsLayer&gt;(child.get()).setShouldUpdateVisibleRect();
      if (replicaLayer())
          downcast&lt;CoordinatedGraphicsLayer&gt;(*replicaLayer()).setShouldUpdateVisibleRect();
  }
  
<span class="udiff-line-modified-removed">- void CoordinatedGraphicsLayer::didChangeGeometry()</span>
<span class="udiff-line-modified-added">+ void CoordinatedGraphicsLayer::didChangeGeometry(FlushNotification flushNotification)</span>
  {
<span class="udiff-line-modified-removed">-     notifyFlushRequired();</span>
<span class="udiff-line-modified-added">+     if (flushNotification == FlushNotification::Required)</span>
<span class="udiff-line-added">+         notifyFlushRequired();</span>
      setShouldUpdateVisibleRect();
  }
  
  CoordinatedGraphicsLayer::CoordinatedGraphicsLayer(Type layerType, GraphicsLayerClient&amp; client)
      : GraphicsLayer(layerType, client)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -236,10 +237,19 @@</span>
      GraphicsLayer::setPosition(p);
      m_nicosia.delta.positionChanged = true;
      didChangeGeometry();
  }
  
<span class="udiff-line-added">+ void CoordinatedGraphicsLayer::syncPosition(const FloatPoint&amp; p)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (position() == p)</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     GraphicsLayer::syncPosition(p);</span>
<span class="udiff-line-added">+     didChangeGeometry(FlushNotification::NotRequired);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  void CoordinatedGraphicsLayer::setAnchorPoint(const FloatPoint3D&amp; p)
  {
      if (anchorPoint() == p)
          return;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -259,10 +269,29 @@</span>
      if (maskLayer())
          maskLayer()-&gt;setSize(size);
      didChangeGeometry();
  }
  
<span class="udiff-line-added">+ void CoordinatedGraphicsLayer::setBoundsOrigin(const FloatPoint&amp; boundsOrigin)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (this-&gt;boundsOrigin() == boundsOrigin)</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     GraphicsLayer::setBoundsOrigin(boundsOrigin);</span>
<span class="udiff-line-added">+     m_nicosia.delta.boundsOriginChanged = true;</span>
<span class="udiff-line-added">+     didChangeGeometry();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ void CoordinatedGraphicsLayer::syncBoundsOrigin(const FloatPoint&amp; boundsOrigin)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (this-&gt;boundsOrigin() == boundsOrigin)</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     GraphicsLayer::syncBoundsOrigin(boundsOrigin);</span>
<span class="udiff-line-added">+     didChangeGeometry(FlushNotification::NotRequired);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  void CoordinatedGraphicsLayer::setTransform(const TransformationMatrix&amp; t)
  {
      if (transform() == t)
          return;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -792,11 +821,11 @@</span>
                  !image.currentFrameKnownToBeOpaque() ? Nicosia::Buffer::SupportsAlpha : Nicosia::Buffer::NoFlags);
              Nicosia::PaintingContext::paint(buffer,
                  [&amp;image](GraphicsContext&amp; context)
                  {
                      IntRect rect { { }, IntSize { image.size() } };
<span class="udiff-line-modified-removed">-                     context.drawImage(image, rect, rect, ImagePaintingOptions(CompositeCopy));</span>
<span class="udiff-line-modified-added">+                     context.drawImage(image, rect, rect, ImagePaintingOptions(CompositeOperator::Copy));</span>
                  });
              layerState.nativeImageID = nativeImageID;
              layerState.update.buffer = WTFMove(buffer);
              m_nicosia.delta.imageBackingChanged = true;
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -841,11 +870,11 @@</span>
                      state.solidColor = m_solidColor;
  
                  if (localDelta.filtersChanged)
                      state.filters = filters();
                  if (localDelta.animationsChanged)
<span class="udiff-line-modified-removed">-                     state.animations = m_animations.getActiveAnimations();</span>
<span class="udiff-line-modified-added">+                     state.animations = m_animations;</span>
  
                  if (localDelta.childrenChanged) {
                      state.children = WTF::map(children(),
                          [](auto&amp; child)
                          {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1130,11 +1159,11 @@</span>
  
  FloatPoint CoordinatedGraphicsLayer::computePositionRelativeToBase()
  {
      FloatPoint offset;
      for (const GraphicsLayer* currLayer = this; currLayer; currLayer = currLayer-&gt;parent())
<span class="udiff-line-modified-removed">-         offset += currLayer-&gt;position();</span>
<span class="udiff-line-modified-added">+         offset += (currLayer-&gt;position() - currLayer-&gt;boundsOrigin());</span>
  
      return offset;
  }
  
  void CoordinatedGraphicsLayer::computePixelAlignment(FloatPoint&amp; position, FloatSize&amp; size, FloatPoint3D&amp; anchorPoint, FloatSize&amp; alignmentOffset)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1206,11 +1235,12 @@</span>
      setNeedsVisibleRectAdjustment();
  }
  
  bool CoordinatedGraphicsLayer::shouldHaveBackingStore() const
  {
<span class="udiff-line-modified-removed">-     return drawsContent() &amp;&amp; contentsAreVisible() &amp;&amp; !m_size.isEmpty();</span>
<span class="udiff-line-modified-added">+     return drawsContent() &amp;&amp; contentsAreVisible() &amp;&amp; !m_size.isEmpty()</span>
<span class="udiff-line-added">+         &amp;&amp; (!!opacity() || m_animations.hasActiveAnimationsOfType(AnimatedPropertyOpacity));</span>
  }
  
  bool CoordinatedGraphicsLayer::selfOrAncestorHasActiveTransformAnimation() const
  {
      if (m_animations.hasActiveAnimationsOfType(AnimatedPropertyTransform))
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1300,10 +1330,17 @@</span>
  bool CoordinatedGraphicsLayer::usesContentsLayer() const
  {
      return m_nicosia.contentLayer || m_compositedImage;
  }
  
<span class="udiff-line-added">+ #if USE(NICOSIA)</span>
<span class="udiff-line-added">+ PlatformLayer* CoordinatedGraphicsLayer::platformLayer() const</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     return m_nicosia.layer.get();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
  } // namespace WebCore
  
  SPECIALIZE_TYPE_TRAITS_ANIMATEDBACKINGSTORECLIENT(WebCore::CoordinatedAnimatedBackingStoreClient, type() == Nicosia::AnimatedBackingStoreClient::Type::Coordinated)
  
  #endif // USE(COORDINATED_GRAPHICS)
</pre>
<center><a href="../TextureMapperShaderProgram.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="CoordinatedGraphicsLayer.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>