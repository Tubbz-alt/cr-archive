<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/dom/SecurityContext.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2011 Google Inc. All Rights Reserved.
  3  * Copyright (C) 2017 Apple Inc. All rights reserved.
  4  *
  5  * Redistribution and use in source and binary forms, with or without
  6  * modification, are permitted provided that the following conditions
  7  * are met:
  8  * 1. Redistributions of source code must retain the above copyright
  9  *    notice, this list of conditions and the following disclaimer.
 10  * 2. Redistributions in binary form must reproduce the above copyright
 11  *    notice, this list of conditions and the following disclaimer in the
 12  *    documentation and/or other materials provided with the distribution.
 13  *
 14  * THIS SOFTWARE IS PROVIDED BY GOOGLE, INC. ``AS IS&#39;&#39; AND ANY
 15  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 16  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 17  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 18  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 19  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 20  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 21  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 22  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 23  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 24  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 25  *
 26  */
 27 
 28 #pragma once
 29 
 30 #include &lt;memory&gt;
 31 #include &lt;wtf/Forward.h&gt;
 32 #include &lt;wtf/OptionSet.h&gt;
 33 #include &lt;wtf/RefPtr.h&gt;
 34 
 35 namespace WebCore {
 36 
 37 class SecurityOrigin;
 38 class SecurityOriginPolicy;
 39 class ContentSecurityPolicy;
 40 
 41 enum SandboxFlag {
 42     // See http://www.whatwg.org/specs/web-apps/current-work/#attr-iframe-sandbox for a list of the sandbox flags.
 43     SandboxNone                 = 0,
 44     SandboxNavigation           = 1,
 45     SandboxPlugins              = 1 &lt;&lt; 1,
 46     SandboxOrigin               = 1 &lt;&lt; 2,
 47     SandboxForms                = 1 &lt;&lt; 3,
 48     SandboxScripts              = 1 &lt;&lt; 4,
 49     SandboxTopNavigation        = 1 &lt;&lt; 5,
 50     SandboxPopups               = 1 &lt;&lt; 6, // See https://www.w3.org/Bugs/Public/show_bug.cgi?id=12393
 51     SandboxAutomaticFeatures    = 1 &lt;&lt; 7,
 52     SandboxPointerLock          = 1 &lt;&lt; 8,
 53     SandboxPropagatesToAuxiliaryBrowsingContexts = 1 &lt;&lt; 9,
 54     SandboxTopNavigationByUserActivation = 1 &lt;&lt; 10,
 55     SandboxDocumentDomain       = 1 &lt;&lt; 11,
 56     SandboxModals               = 1 &lt;&lt; 12,
 57     SandboxStorageAccessByUserActivation = 1 &lt;&lt; 13,
 58     SandboxAll                  = -1 // Mask with all bits set to 1.
 59 };
 60 
 61 typedef int SandboxFlags;
 62 
 63 class SecurityContext {
 64 public:
 65     SandboxFlags sandboxFlags() const { return m_sandboxFlags; }
 66     ContentSecurityPolicy* contentSecurityPolicy() { return m_contentSecurityPolicy.get(); }
 67 
 68     bool isSecureTransitionTo(const URL&amp;) const;
 69 
 70     void enforceSandboxFlags(SandboxFlags mask);
 71     bool isSandboxed(SandboxFlags mask) const { return m_sandboxFlags &amp; mask; }
 72 
 73     SecurityOriginPolicy* securityOriginPolicy() const { return m_securityOriginPolicy.get(); }
 74 
 75     // Explicitly override the security origin for this security context.
 76     // Note: It is dangerous to change the security origin of a script context
 77     //       that already contains content.
 78     void setSecurityOriginPolicy(RefPtr&lt;SecurityOriginPolicy&gt;&amp;&amp;);
 79 
 80     // Explicitly override the content security policy for this security context.
 81     // Note: It is dangerous to change the content security policy of a script
 82     //       context that already contains content.
 83     void setContentSecurityPolicy(std::unique_ptr&lt;ContentSecurityPolicy&gt;&amp;&amp;);
 84 
 85     WEBCORE_EXPORT SecurityOrigin* securityOrigin() const;
 86 
 87     static SandboxFlags parseSandboxPolicy(const String&amp; policy, String&amp; invalidTokensErrorMessage);
 88     static bool isSupportedSandboxPolicy(StringView);
 89 
 90     enum MixedContentType {
 91         Inactive = 1 &lt;&lt; 0,
 92         Active = 1 &lt;&lt; 1,
 93     };
 94 
 95     const OptionSet&lt;MixedContentType&gt;&amp; foundMixedContent() const { return m_mixedContentTypes; }
 96     void setFoundMixedContent(MixedContentType type) { m_mixedContentTypes.add(type); }
 97     bool geolocationAccessed() const { return m_geolocationAccessed; }
 98     void setGeolocationAccessed() { m_geolocationAccessed = true; }
 99     bool secureCookiesAccessed() const { return m_secureCookiesAccessed; }
100     void setSecureCookiesAccessed() { m_secureCookiesAccessed = true; }
101 
102     bool isStrictMixedContentMode() const { return m_isStrictMixedContentMode; }
103     void setStrictMixedContentMode(bool strictMixedContentMode) { m_isStrictMixedContentMode = strictMixedContentMode; }
104 
105     // This method implements the &quot;Is the environment settings object settings a secure context?&quot; algorithm from
106     // the Secure Context spec: https://w3c.github.io/webappsec-secure-contexts/#settings-object (Editor&#39;s Draft, 17 November 2016)
107     virtual bool isSecureContext() const = 0;
108 
109 protected:
110     SecurityContext();
111     virtual ~SecurityContext();
112 
113     // It&#39;s only appropriate to call this during security context initialization; it&#39;s needed for
114     // flags that can&#39;t be disabled with allow-* attributes, such as SandboxNavigation.
115     void disableSandboxFlags(SandboxFlags mask) { m_sandboxFlags &amp;= ~mask; }
116 
117     void didFailToInitializeSecurityOrigin() { m_haveInitializedSecurityOrigin = false; }
118     bool haveInitializedSecurityOrigin() const { return m_haveInitializedSecurityOrigin; }
119 
120 private:
121     RefPtr&lt;SecurityOriginPolicy&gt; m_securityOriginPolicy;
122     std::unique_ptr&lt;ContentSecurityPolicy&gt; m_contentSecurityPolicy;
123     SandboxFlags m_sandboxFlags { SandboxNone };
124     OptionSet&lt;MixedContentType&gt; m_mixedContentTypes;
125     bool m_haveInitializedSecurityOrigin { false };
126     bool m_geolocationAccessed { false };
127     bool m_secureCookiesAccessed { false };
128     bool m_isStrictMixedContentMode { false };
129 };
130 
131 } // namespace WebCore
    </pre>
  </body>
</html>