<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/Modules/modern-media-controls/controls/slider.js</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2016 Apple Inc. All Rights Reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 class Slider extends LayoutNode
 27 {
 28 
 29     constructor(cssClassName = &quot;&quot;)
 30     {
 31         super(`&lt;div class=&quot;slider ${cssClassName}&quot;&gt;&lt;/div&gt;`);
 32 
 33         this._container = new LayoutNode(`&lt;div class=&quot;custom-slider&quot;&gt;&lt;/div&gt;`);
 34         this._track = new LayoutNode(`&lt;div class=&quot;track fill&quot;&gt;&lt;/div&gt;`);
 35         this._primaryFill = new LayoutNode(`&lt;div class=&quot;primary fill&quot;&gt;&lt;/div&gt;`);
 36         this._secondaryFill = new LayoutNode(`&lt;div class=&quot;secondary fill&quot;&gt;&lt;/div&gt;`);
 37         this._knob = new LayoutNode(`&lt;div class=&quot;knob&quot;&gt;&lt;/div&gt;`);
 38         this._container.children = [this._track, this._primaryFill, this._secondaryFill, this._knob];
 39 
 40         this._input = new LayoutNode(`&lt;input type=&quot;range&quot; min=&quot;0&quot; max=&quot;1&quot; step=&quot;0.001&quot; /&gt;`);
<a name="1" id="anc1"></a><span class="line-modified"> 41         this._input.element.addEventListener(&quot;pointerdown&quot;, this);</span>
 42         this._input.element.addEventListener(&quot;input&quot;, this);
 43         this._input.element.addEventListener(&quot;change&quot;, this);
 44 
 45         this.value = 0;
 46         this.height = 16;
 47         this.enabled = true;
 48         this.isActive = false;
 49         this._secondaryValue = 0;
 50         this._disabled = false;
 51 
 52         this.children = [this._container, this._input];
 53     }
 54 
 55     // Public
 56 
 57     set inputAccessibleLabel(timeValue)
 58     {
 59         this._input.element.setAttribute(&quot;aria-valuetext&quot;, formattedStringForDuration(timeValue));
 60     }
 61 
 62     get disabled()
 63     {
 64         return this._disabled;
 65     }
 66 
 67     set disabled(flag)
 68     {
 69         if (this._disabled === flag)
 70             return;
 71 
 72         this._disabled = flag;
 73         this.markDirtyProperty(&quot;disabled&quot;);
 74     }
 75 
 76     get value()
 77     {
 78         if (this._value !== undefined)
 79             return this._value;
 80         return parseFloat(this._input.element.value);
 81     }
 82 
 83     set value(value)
 84     {
 85         if (this.isActive)
 86             return;
 87 
 88         this._value = value;
 89         this.markDirtyProperty(&quot;value&quot;);
 90         this.needsLayout = true;
 91     }
 92 
 93     get secondaryValue()
 94     {
 95         return this._secondaryValue;
 96     }
 97 
 98     set secondaryValue(secondaryValue)
 99     {
100         if (this._secondaryValue === secondaryValue)
101             return;
102 
103         this._secondaryValue = secondaryValue;
104         this.needsLayout = true;
105     }
106 
107     // Protected
108 
109     handleEvent(event)
110     {
111         switch (event.type) {
<a name="2" id="anc2"></a><span class="line-modified">112         case &quot;pointerdown&quot;:</span>
<span class="line-modified">113             this._handlePointerdownEvent();</span>
114             break;
<a name="3" id="anc3"></a><span class="line-modified">115         case &quot;pointerup&quot;:</span>
<span class="line-modified">116             this._handlePointerupEvent();</span>






117             break;
118         case &quot;change&quot;:
119         case &quot;input&quot;:
120             this._valueDidChange();
121             break;
122         }
123     }
124 
125     commitProperty(propertyName)
126     {
127         switch (propertyName) {
128         case &quot;value&quot;:
129             this._input.element.value = this._value;
130             delete this._value;
131             break;
132         case &quot;disabled&quot;:
133             this.element.classList.toggle(&quot;disabled&quot;, this._disabled);
134             break;
135         default :
136             super.commitProperty(propertyName);
137             break;
138         }
139     }
140 
141     commit()
142     {
143         super.commit();
144 
145         const scrubberRadius = 4.5;
146         const scrubberCenterX = scrubberRadius + Math.round((this.width - (scrubberRadius * 2)) * this.value);
147         this._primaryFill.element.style.width = `${scrubberCenterX}px`;
148         this._secondaryFill.element.style.left = `${scrubberCenterX}px`;
149         this._secondaryFill.element.style.right = `${(1 - this._secondaryValue) * 100}%`;
150         this._knob.element.style.left = `${scrubberCenterX}px`;
151     }
152 
153     // Private
154 
<a name="4" id="anc4"></a><span class="line-modified">155     _handlePointerdownEvent()</span>
156     {
<a name="5" id="anc5"></a><span class="line-modified">157         this._pointerupTarget = this._interactionEndTarget();</span>
<span class="line-modified">158         this._pointerupTarget.addEventListener(&quot;pointerup&quot;, this, true);</span>
159 
160         this._valueWillStartChanging();
161     }
162 
163     _interactionEndTarget()
164     {
165         const mediaControls = this.parentOfType(MediaControls);
166         return (!mediaControls || mediaControls instanceof MacOSInlineMediaControls) ? window : mediaControls.element;
167     }
168 
<a name="6" id="anc6"></a>













169     _valueWillStartChanging()
170     {
171         // We should no longer cache the value since we&#39;ll be interacting with the &lt;input&gt;
172         // so the value should be read back from it dynamically.
173         delete this._value;
174 
175         if (this.uiDelegate &amp;&amp; typeof this.uiDelegate.controlValueWillStartChanging === &quot;function&quot;)
176             this.uiDelegate.controlValueWillStartChanging(this);
177         this.isActive = true;
178         this.needsLayout = true;
179     }
180 
181     _valueDidChange()
182     {
183         if (this.uiDelegate &amp;&amp; typeof this.uiDelegate.controlValueDidChange === &quot;function&quot;)
184             this.uiDelegate.controlValueDidChange(this);
185 
186         this.needsLayout = true;
187     }
188 
189     _valueDidStopChanging()
190     {
191         this.isActive = false;
192         if (this.uiDelegate &amp;&amp; typeof this.uiDelegate.controlValueDidStopChanging === &quot;function&quot;)
193             this.uiDelegate.controlValueDidStopChanging(this);
194 
195         this.needsLayout = true;
196     }
197 
<a name="7" id="anc7"></a><span class="line-modified">198     _handlePointerupEvent()</span>
199     {
<a name="8" id="anc8"></a><span class="line-modified">200         this._pointerupTarget.removeEventListener(&quot;pointerup&quot;, this, true);</span>
<span class="line-modified">201         delete this._pointerupTarget;</span>
202 
203         this._valueDidStopChanging();
204     }
<a name="9" id="anc9"></a>












205 }
<a name="10" id="anc10"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="10" type="hidden" />
</body>
</html>