<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/BytecodeList.rb</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
   1 # Copyright (C) 2018-2019 Apple Inc. All rights reserved.
   2 #
   3 # Redistribution and use in source and binary forms, with or without
   4 # modification, are permitted provided that the following conditions
   5 # are met:
   6 # 1. Redistributions of source code must retain the above copyright
   7 #    notice, this list of conditions and the following disclaimer.
   8 # 2. Redistributions in binary form must reproduce the above copyright
   9 #    notice, this list of conditions and the following disclaimer in the
  10 #    documentation and/or other materials provided with the distribution.
  11 #
  12 # THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
  13 # EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  14 # IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  15 # PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
  16 # CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  17 # EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  18 # PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  19 # PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
  20 # OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  21 # (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  22 # OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  23 
  24 types [
  25     :VirtualRegister,
  26 
  27     :BasicBlockLocation,
  28     :BoundLabel,
  29     :DebugHookType,
  30     :ErrorType,
  31     :GetByIdMode,
  32     :GetByIdModeMetadata,
  33     :GetByValHistory,
  34     :GetPutInfo,
  35     :IndexingType,
  36     :JSCell,
  37     :JSGlobalLexicalEnvironment,
  38     :JSGlobalObject,
  39     :JSModuleEnvironment,
  40     :JSObject,
  41     :JSScope,
  42     :JSType,
  43     :JSValue,
  44     :LLIntCallLinkInfo,
  45     :ResultType,
  46     :OperandTypes,
  47     :ProfileTypeBytecodeFlag,
  48     :PropertyOffset,
  49     :PutByIdFlags,
  50     :ResolveType,
  51     :Structure,
  52     :StructureID,
  53     :StructureChain,
  54     :SymbolTable,
  55     :SymbolTableOrScopeDepth,
  56     :ToThisStatus,
  57     :TypeLocation,
  58     :WasmBoundLabel,
  59     :WatchpointSet,
  60 
  61     :ValueProfile,
  62     :ValueProfileAndVirtualRegisterBuffer,
  63     :UnaryArithProfile,
  64     :BinaryArithProfile,
  65     :ArrayProfile,
  66     :ArrayAllocationProfile,
  67     :ObjectAllocationProfile,
  68 ]
  69 
  70 templates [
  71     :WriteBarrier,
  72     :WriteBarrierBase,
  73 ]
  74 
  75 
  76 begin_section :Bytecode,
  77     emit_in_h_file: true,
  78     emit_in_structs_file: true,
  79     emit_in_asm_file: true,
  80     emit_opcode_id_string_values_in_h_file: true,
  81     macro_name_component: :BYTECODE,
  82     asm_prefix: &quot;llint_&quot;,
  83     op_prefix: &quot;op_&quot;
  84 
  85 op :wide16
  86 op :wide32
  87 
  88 op :enter
  89 
  90 op :get_scope,
  91     args: {
  92         dst: VirtualRegister
  93     }
  94 
  95 op :create_direct_arguments,
  96     args: {
  97         dst: VirtualRegister,
  98     }
  99 
 100 op :create_scoped_arguments,
 101     args: {
 102         dst: VirtualRegister,
 103         scope: VirtualRegister,
 104     }
 105 
 106 op :create_cloned_arguments,
 107     args: {
 108         dst: VirtualRegister,
 109     }
 110 
 111 op :create_arguments_butterfly,
 112     args: {
 113         dst: VirtualRegister,
 114     }
 115 
 116 op :create_this,
 117     args: {
 118         dst: VirtualRegister,
 119         callee: VirtualRegister,
 120         inlineCapacity: unsigned,
 121     },
 122     metadata: {
 123         cachedCallee: WriteBarrier[JSCell]
 124     }
 125 
 126 op :create_promise,
 127     args: {
 128         dst: VirtualRegister,
 129         callee: VirtualRegister,
 130         isInternalPromise: bool,
 131     },
 132     metadata: {
 133         cachedCallee: WriteBarrier[JSCell]
 134     }
 135 
 136 op :new_promise,
 137     args: {
 138         dst: VirtualRegister,
 139         isInternalPromise: bool,
 140     }
 141 
 142 op :new_generator,
 143     args: {
 144         dst: VirtualRegister,
 145     }
 146 
 147 op_group :CreateInternalFieldObjectOp,
 148     [
 149         :create_generator,
 150         :create_async_generator,
 151     ],
 152     args: {
 153         dst: VirtualRegister,
 154         callee: VirtualRegister,
 155     },
 156     metadata: {
 157         cachedCallee: WriteBarrier[JSCell]
 158     }
 159 
 160 op :get_argument,
 161     args: {
 162         dst: VirtualRegister,
 163         index: int,
 164     },
 165     metadata: {
 166         profile: ValueProfile,
 167     }
 168 
 169 op :argument_count,
 170     args: {
 171         dst: VirtualRegister,
 172     }
 173 
 174 op :to_this,
 175     args: {
 176         srcDst: VirtualRegister,
 177     },
 178     metadata: {
 179         cachedStructureID: StructureID,
 180         toThisStatus: ToThisStatus,
 181         profile: ValueProfile,
 182     }
 183 
 184 op :check_tdz,
 185     args: {
 186         targetVirtualRegister: VirtualRegister,
 187     }
 188 
 189 op :new_object,
 190     args: {
 191         dst: VirtualRegister,
 192         inlineCapacity: unsigned,
 193     },
 194     metadata: {
 195         objectAllocationProfile: ObjectAllocationProfile,
 196     }
 197 
 198 op :new_array,
 199     args: {
 200         dst: VirtualRegister,
 201         argv: VirtualRegister,
 202         argc: unsigned,
 203         recommendedIndexingType: IndexingType,
 204     },
 205     metadata: {
 206         arrayAllocationProfile: ArrayAllocationProfile,
 207     }
 208 
 209 op :new_array_with_size,
 210     args: {
 211         dst: VirtualRegister,
 212         length: VirtualRegister,
 213     },
 214     metadata: {
 215         arrayAllocationProfile: ArrayAllocationProfile,
 216     }
 217 
 218 op :new_array_buffer,
 219     args: {
 220         dst: VirtualRegister,
 221         immutableButterfly: VirtualRegister,
 222         recommendedIndexingType: IndexingType
 223     },
 224     metadata: {
 225         arrayAllocationProfile: ArrayAllocationProfile,
 226     }
 227 
 228 op :new_array_with_spread,
 229     args: {
 230         dst: VirtualRegister,
 231         argv: VirtualRegister,
 232         argc: unsigned,
 233         bitVector: unsigned,
 234     }
 235 
 236 op :spread,
 237     args: {
 238         dst: VirtualRegister,
 239         argument: VirtualRegister,
 240     }
 241 
 242 op :new_regexp,
 243     args: {
 244         dst: VirtualRegister,
 245         regexp: VirtualRegister,
 246     }
 247 
 248 op :mov,
 249     args: {
 250         dst: VirtualRegister,
 251         src: VirtualRegister,
 252     }
 253 
 254 op_group :BinaryOp,
 255     [
 256         :eq,
 257         :neq,
 258         :stricteq,
 259         :nstricteq,
 260         :less,
 261         :lesseq,
 262         :greater,
 263         :greatereq,
 264         :below,
 265         :beloweq,
 266         :mod,
 267         :pow,
 268         :urshift,
 269     ],
 270     args: {
 271         dst: VirtualRegister,
 272         lhs: VirtualRegister,
 273         rhs: VirtualRegister,
 274     }
 275 
 276 op_group :ProfiledBinaryOp,
 277     [
 278         :add,
 279         :mul,
 280         :div,
 281         :sub,
 282     ],
 283     args: {
 284         dst: VirtualRegister,
 285         lhs: VirtualRegister,
 286         rhs: VirtualRegister,
 287         operandTypes: OperandTypes,
 288     },
 289     metadata: {
 290         arithProfile: BinaryArithProfile
 291     }
 292 
 293 op_group :ValueProfiledBinaryOp,
 294     [
 295         :bitand,
 296         :bitor,
 297         :bitxor,
 298         :lshift,
 299         :rshift,
 300     ],
 301     args: {
 302         dst: VirtualRegister,
 303         lhs: VirtualRegister,
 304         rhs: VirtualRegister,
 305     },
 306     metadata: {
 307         profile: ValueProfile
 308     }
 309 
 310 op :bitnot,
 311     args: {
 312         dst: VirtualRegister,
 313         operand: VirtualRegister,
 314     },
 315     metadata: {
 316         profile: ValueProfile
 317     }
 318 
 319 op_group :UnaryOp,
 320     [
 321         :eq_null,
 322         :neq_null,
 323         :to_string,
 324         :unsigned,
 325         :is_empty,
 326         :is_undefined,
 327         :is_undefined_or_null,
 328         :is_boolean,
 329         :is_number,
 330         :is_object,
 331         :is_object_or_null,
 332         :is_function,
 333     ],
 334     args: {
 335         dst: VirtualRegister,
 336         operand: VirtualRegister,
 337     }
 338 
 339 op_group :UnaryInPlaceProfiledOp,
 340     [
 341         :inc,
 342         :dec,
 343     ],
 344     args: {
 345         srcDst: VirtualRegister,
 346     },
 347     metadata: {
 348         arithProfile: UnaryArithProfile
 349     }
 350 
 351 op :to_object,
 352     args: {
 353         dst: VirtualRegister,
 354         operand: VirtualRegister,
 355         message: unsigned,
 356     },
 357     metadata: {
 358         profile: ValueProfile,
 359     }
 360 
 361 op_group :ValueProfiledUnaryOp,
 362     [
 363         :to_number,
 364         :to_numeric,
 365     ],
 366     args: {
 367         dst: VirtualRegister,
 368         operand: VirtualRegister,
 369     },
 370     metadata: {
 371         profile: ValueProfile,
 372     }
 373 
 374 op :negate,
 375     args: {
 376         dst: VirtualRegister,
 377         operand: VirtualRegister,
 378         resultType: ResultType,
 379     },
 380     metadata: {
 381         arithProfile: UnaryArithProfile,
 382     }
 383 
 384 op :not,
 385     args: {
 386         dst: VirtualRegister,
 387         operand: VirtualRegister,
 388     }
 389 
 390 
 391 op :identity_with_profile,
 392     args: {
 393         srcDst: VirtualRegister,
 394         topProfile: unsigned,
 395         bottomProfile: unsigned,
 396     }
 397 
 398 op :overrides_has_instance,
 399     args: {
 400         dst: VirtualRegister,
 401         constructor: VirtualRegister,
 402         hasInstanceValue: VirtualRegister,
 403     }
 404 
 405 op :instanceof,
 406     args: {
 407         dst: VirtualRegister,
 408         value: VirtualRegister,
 409         prototype: VirtualRegister,
 410     }
 411 
 412 op :instanceof_custom,
 413     args: {
 414         dst: VirtualRegister,
 415         value: VirtualRegister,
 416         constructor: VirtualRegister,
 417         hasInstanceValue: VirtualRegister,
 418     }
 419 
 420 op :typeof,
 421     args: {
 422         dst: VirtualRegister,
 423         value: VirtualRegister,
 424     }
 425 
 426 op :is_cell_with_type,
 427     args: {
 428         dst: VirtualRegister,
 429         operand: VirtualRegister,
 430         type: JSType,
 431     }
 432 
 433 op :in_by_val,
 434     args: {
 435         dst: VirtualRegister,
 436         base: VirtualRegister,
 437         property: VirtualRegister,
 438     },
 439     metadata: {
 440         arrayProfile: ArrayProfile,
 441     }
 442 
 443 op :in_by_id,
 444     args: {
 445         dst: VirtualRegister,
 446         base: VirtualRegister,
 447         property: unsigned,
 448     }
 449 
 450 op :get_by_id,
 451     args: {
 452         dst: VirtualRegister,
 453         base: VirtualRegister,
 454         property: unsigned,
 455     },
 456     metadata: {
 457         modeMetadata: GetByIdModeMetadata,
 458         profile: ValueProfile,
 459     }
 460 
 461 op :get_by_id_with_this,
 462     args: {
 463         dst: VirtualRegister,
 464         base: VirtualRegister,
 465         thisValue: VirtualRegister,
 466         property: unsigned,
 467     },
 468     metadata: {
 469         profile: ValueProfile,
 470     }
 471 
 472 op :get_by_val_with_this,
 473     args: {
 474         dst: VirtualRegister,
 475         base: VirtualRegister,
 476         thisValue: VirtualRegister,
 477         property: VirtualRegister,
 478     },
 479     metadata: {
 480         profile: ValueProfile,
 481     }
 482 
 483 op :get_by_id_direct,
 484     args: {
 485         dst: VirtualRegister,
 486         base: VirtualRegister,
 487         property: unsigned,
 488     },
 489     metadata: {
 490         profile: ValueProfile, # not used in llint
 491         structureID: StructureID,
 492         offset: unsigned,
 493     }
 494 
 495 op :try_get_by_id,
 496     args: {
 497         dst: VirtualRegister,
 498         base: VirtualRegister,
 499         property: unsigned,
 500     },
 501     metadata: {
 502         profile: ValueProfile,
 503     }
 504 
 505 op :put_by_id,
 506     args: {
 507         base: VirtualRegister,
 508         property: unsigned,
 509         value: VirtualRegister,
 510         flags: PutByIdFlags,
 511     },
 512     metadata: {
 513         oldStructureID: StructureID,
 514         offset: unsigned,
 515         newStructureID: StructureID,
 516         structureChain: WriteBarrierBase[StructureChain],
 517     }
 518 
 519 op :put_by_id_with_this,
 520     args: {
 521         base: VirtualRegister,
 522         thisValue: VirtualRegister,
 523         property: unsigned,
 524         value: VirtualRegister,
 525     }
 526 
 527 op :del_by_id,
 528     args: {
 529         dst: VirtualRegister,
 530         base: VirtualRegister,
 531         property: unsigned,
 532     }
 533 
 534 op :get_by_val,
 535     args: {
 536         dst: VirtualRegister,
 537         base: VirtualRegister,
 538         property: VirtualRegister,
 539     },
 540     metadata: {
 541         profile: ValueProfile,
 542         arrayProfile: ArrayProfile,
 543         seenIdentifiers: GetByValHistory,
 544     }
 545 
 546 op :put_by_val,
 547     args: {
 548         base: VirtualRegister,
 549         property: VirtualRegister,
 550         value: VirtualRegister,
 551     },
 552     metadata: {
 553         arrayProfile: ArrayProfile,
 554     }
 555 
 556 op :put_by_val_with_this,
 557     args: {
 558         base: VirtualRegister,
 559         thisValue: VirtualRegister,
 560         property: VirtualRegister,
 561         value: VirtualRegister,
 562     }
 563 
 564 op :put_by_val_direct,
 565     args: {
 566         base: VirtualRegister,
 567         property: VirtualRegister,
 568         value: VirtualRegister,
 569     },
 570     metadata: {
 571         arrayProfile: ArrayProfile,
 572     }
 573 
 574 op :del_by_val,
 575     args: {
 576         dst: VirtualRegister,
 577         base: VirtualRegister,
 578         property: VirtualRegister,
 579     }
 580 
 581 op :put_getter_by_id,
 582     args: {
 583         base: VirtualRegister,
 584         property: unsigned,
 585         attributes: unsigned,
 586         accessor: VirtualRegister,
 587     }
 588 
 589 op :put_setter_by_id,
 590     args: {
 591         base: VirtualRegister,
 592         property: unsigned,
 593         attributes: unsigned,
 594         accessor: VirtualRegister,
 595     }
 596 
 597 op :put_getter_setter_by_id,
 598     args: {
 599         base: VirtualRegister,
 600         property: unsigned,
 601         attributes: unsigned,
 602         getter: VirtualRegister,
 603         setter: VirtualRegister,
 604     }
 605 
 606 op :put_getter_by_val,
 607     args: {
 608         base: VirtualRegister,
 609         property: VirtualRegister,
 610         attributes: unsigned,
 611         accessor: VirtualRegister,
 612     }
 613 
 614 op :put_setter_by_val,
 615     args: {
 616         base: VirtualRegister,
 617         property: VirtualRegister,
 618         attributes: unsigned,
 619         accessor: VirtualRegister,
 620     }
 621 
 622 op :define_data_property,
 623     args: {
 624         base: VirtualRegister,
 625         property: VirtualRegister,
 626         value: VirtualRegister,
 627         attributes: VirtualRegister,
 628     }
 629 
 630 op :define_accessor_property,
 631     args: {
 632         base: VirtualRegister,
 633         property: VirtualRegister,
 634         getter: VirtualRegister,
 635         setter: VirtualRegister,
 636         attributes: VirtualRegister,
 637     }
 638 
 639 op :jmp,
 640     args: {
 641         targetLabel: BoundLabel,
 642     }
 643 
 644 op :jtrue,
 645     args: {
 646         condition: VirtualRegister,
 647         targetLabel: BoundLabel,
 648     }
 649 
 650 op :jfalse,
 651     args: {
 652         condition: VirtualRegister,
 653         targetLabel: BoundLabel,
 654     }
 655 
 656 op :jeq_null,
 657     args: {
 658         value: VirtualRegister,
 659         targetLabel: BoundLabel,
 660     }
 661 
 662 op :jneq_null,
 663     args: {
 664         value: VirtualRegister,
 665         targetLabel: BoundLabel,
 666     }
 667 
 668 op :jundefined_or_null,
 669     args: {
 670         value: VirtualRegister,
 671         targetLabel: BoundLabel,
 672     }
 673 
 674 op :jnundefined_or_null,
 675     args: {
 676         value: VirtualRegister,
 677         targetLabel: BoundLabel,
 678     }
 679 
 680 op :jneq_ptr,
 681     args: {
 682         value: VirtualRegister,
 683         specialPointer: VirtualRegister,
 684         targetLabel: BoundLabel,
 685     },
 686     metadata: {
 687         hasJumped: bool,
 688     }
 689 
 690 op_group :BinaryJmp,
 691     [
 692         :jeq,
 693         :jstricteq,
 694         :jneq,
 695         :jnstricteq,
 696         :jless,
 697         :jlesseq,
 698         :jgreater,
 699         :jgreatereq,
 700         :jnless,
 701         :jnlesseq,
 702         :jngreater,
 703         :jngreatereq,
 704         :jbelow,
 705         :jbeloweq,
 706     ],
 707     args: {
 708         lhs: VirtualRegister,
 709         rhs: VirtualRegister,
 710         targetLabel: BoundLabel,
 711     }
 712 
 713 op :loop_hint
 714 
 715 op_group :SwitchValue,
 716     [
 717         :switch_imm,
 718         :switch_char,
 719         :switch_string,
 720     ],
 721     args: {
 722         tableIndex: unsigned,
 723         defaultOffset: BoundLabel,
 724         scrutinee: VirtualRegister,
 725     }
 726 
 727 op_group :NewFunction,
 728     [
 729         :new_func,
 730         :new_func_exp,
 731         :new_generator_func,
 732         :new_generator_func_exp,
 733         :new_async_func,
 734         :new_async_func_exp,
 735         :new_async_generator_func,
 736         :new_async_generator_func_exp,
 737     ],
 738     args: {
 739         dst: VirtualRegister,
 740         scope: VirtualRegister,
 741         functionDecl: unsigned,
 742     }
 743 
 744 op :set_function_name,
 745     args: {
 746         function: VirtualRegister,
 747         name: VirtualRegister,
 748     }
 749 
 750 # op_call variations
 751 op :call,
 752     args: {
 753         dst: VirtualRegister,
 754         callee: VirtualRegister,
 755         argc: unsigned,
 756         argv: unsigned,
 757     },
 758     metadata: {
 759         callLinkInfo: LLIntCallLinkInfo,
 760         profile: ValueProfile,
 761     }
 762 
 763 op :tail_call,
 764     args: {
 765         dst: VirtualRegister,
 766         callee: VirtualRegister,
 767         argc: unsigned,
 768         argv: unsigned,
 769     },
 770     metadata: {
 771         callLinkInfo: LLIntCallLinkInfo,
 772         profile: ValueProfile,
 773     }
 774 
 775 op :call_eval,
 776     args: {
 777         dst: VirtualRegister,
 778         callee: VirtualRegister,
 779         argc: unsigned,
 780         argv: unsigned,
 781     },
 782     metadata: {
 783         callLinkInfo: LLIntCallLinkInfo,
 784         profile: ValueProfile,
 785     }
 786 
 787 op :call_varargs,
 788     args: {
 789         dst: VirtualRegister,
 790         callee: VirtualRegister,
 791         thisValue?: VirtualRegister,
 792         arguments?: VirtualRegister,
 793         firstFree: VirtualRegister,
 794         firstVarArg: int,
 795     },
 796     metadata: {
 797         arrayProfile: ArrayProfile,
 798         profile: ValueProfile,
 799     },
 800     tmps: {
 801         argCountIncludingThis: unsigned,
 802     },
 803     checkpoints: {
 804         determiningArgCount: nil,
 805         makeCall: nil,
 806     }
 807 
 808 op :tail_call_varargs,
 809     args: {
 810         dst: VirtualRegister,
 811         callee: VirtualRegister,
 812         thisValue?: VirtualRegister,
 813         arguments?: VirtualRegister,
 814         firstFree: VirtualRegister,
 815         firstVarArg: int,
 816     },
 817     metadata: {
 818         arrayProfile: ArrayProfile,
 819         profile: ValueProfile,
 820     },
 821     tmps: {
 822         argCountIncludingThis: unsigned
 823     },
 824     checkpoints: {
 825         determiningArgCount: nil,
 826         makeCall: nil,
 827     }
 828 
 829 op :tail_call_forward_arguments,
 830     args: {
 831         dst: VirtualRegister,
 832         callee: VirtualRegister,
 833         thisValue?: VirtualRegister,
 834         arguments?: VirtualRegister,
 835         firstFree: VirtualRegister,
 836         firstVarArg: int,
 837     },
 838     metadata: {
 839         arrayProfile: ArrayProfile,
 840         profile: ValueProfile,
 841     }
 842 
 843 op :construct,
 844     args: {
 845         dst: VirtualRegister,
 846         callee: VirtualRegister,
 847         argc: unsigned,
 848         argv: unsigned,
 849     },
 850     metadata: {
 851         callLinkInfo: LLIntCallLinkInfo,
 852         profile: ValueProfile,
 853     }
 854 
 855 op :construct_varargs,
 856     args: {
 857         dst: VirtualRegister,
 858         callee: VirtualRegister,
 859         thisValue?: VirtualRegister,
 860         arguments?: VirtualRegister,
 861         firstFree: VirtualRegister,
 862         firstVarArg: int,
 863     },
 864     metadata: {
 865         arrayProfile: ArrayProfile,
 866         profile: ValueProfile,
 867     },
 868     tmps: {
 869         argCountIncludingThis: unsigned
 870     },
 871     checkpoints: {
 872         determiningArgCount: nil,
 873         makeCall: nil,
 874     }
 875 
 876 op :ret,
 877     args: {
 878         value: VirtualRegister,
 879     }
 880 
 881 op :strcat,
 882     args: {
 883         dst: VirtualRegister,
 884         src: VirtualRegister,
 885         count: int,
 886     }
 887 
 888 op :to_primitive,
 889     args: {
 890         dst: VirtualRegister,
 891         src: VirtualRegister,
 892     }
 893 
 894 op :to_property_key,
 895     args: {
 896         dst: VirtualRegister,
 897         src: VirtualRegister,
 898     }
 899 
 900 op :resolve_scope,
 901     args: {
 902         dst: VirtualRegister, # offset 1
 903         scope: VirtualRegister, # offset 2
 904         var: unsigned, # offset 3
 905         # $begin: :private,
 906         resolveType: ResolveType,
 907         localScopeDepth: unsigned,
 908     },
 909     metadata: {
 910         resolveType: ResolveType, # offset 4
 911         _0: { # offset 5
 912             localScopeDepth: unsigned,
 913             globalLexicalBindingEpoch: unsigned,
 914         },
 915         _1: { # offset 6
 916              # written during linking
 917              lexicalEnvironment: WriteBarrierBase[JSCell], # lexicalEnvironment &amp;&amp; type == ModuleVar
 918              symbolTable: WriteBarrierBase[SymbolTable], # lexicalEnvironment &amp;&amp; type != ModuleVar
 919 
 920              constantScope: WriteBarrierBase[JSScope],
 921 
 922              # written from the slow path
 923              globalLexicalEnvironment: WriteBarrierBase[JSGlobalLexicalEnvironment],
 924              globalObject: WriteBarrierBase[JSGlobalObject],
 925         },
 926     }
 927 
 928 op :get_from_scope,
 929     args: {
 930         dst: VirtualRegister, # offset  1
 931         scope: VirtualRegister, # offset 2
 932         var: unsigned, # offset 3
 933         # $begin: :private,
 934         getPutInfo: GetPutInfo,
 935         localScopeDepth: unsigned,
 936         offset: unsigned,
 937     },
 938     metadata: {
 939         getPutInfo: GetPutInfo, # offset 4
 940         _: { #previously offset 5
 941             watchpointSet: WatchpointSet.*,
 942             structure: WriteBarrierBase[Structure],
 943         },
 944         operand: uintptr_t, #offset 6
 945         profile: ValueProfile, # offset 7
 946     },
 947     metadata_initializers: {
 948         getPutInfo: :getPutInfo,
 949         operand: :offset,
 950     }
 951 
 952 op :put_to_scope,
 953     args: {
 954         scope: VirtualRegister, # offset 1
 955         var: unsigned, # offset 2
 956         value: VirtualRegister, # offset 3
 957         # $begin: :private,
 958         getPutInfo: GetPutInfo,
 959         symbolTableOrScopeDepth: SymbolTableOrScopeDepth,
 960         offset: unsigned,
 961     },
 962     metadata: {
 963         getPutInfo: GetPutInfo, # offset 4
 964         _: { # offset 5
 965             structure: WriteBarrierBase[Structure],
 966             watchpointSet: WatchpointSet.*,
 967         },
 968         operand: uintptr_t, # offset 6
 969     },
 970     metadata_initializers: {
 971         getPutInfo: :getPutInfo,
 972         operand: :offset,
 973     }
 974 
 975 op :get_from_arguments,
 976     args: {
 977         dst: VirtualRegister,
 978         arguments: VirtualRegister,
 979         index: unsigned,
 980     },
 981     metadata: {
 982         profile: ValueProfile,
 983     }
 984 
 985 op :put_to_arguments,
 986     args: {
 987         arguments: VirtualRegister,
 988         index: unsigned,
 989         value: VirtualRegister,
 990     }
 991 
 992 op :push_with_scope,
 993     args: {
 994         dst: VirtualRegister,
 995         currentScope: VirtualRegister,
 996         newScope: VirtualRegister,
 997     }
 998 
 999 op :create_lexical_environment,
1000     args: {
1001         dst: VirtualRegister,
1002         scope: VirtualRegister,
1003         symbolTable: VirtualRegister,
1004         initialValue: VirtualRegister,
1005     }
1006 
1007 op :create_generator_frame_environment,
1008     args: {
1009         dst: VirtualRegister,
1010         scope: VirtualRegister,
1011         symbolTable: VirtualRegister,
1012         initialValue: VirtualRegister,
1013     }
1014 
1015 op :get_parent_scope,
1016     args: {
1017         dst: VirtualRegister,
1018         scope: VirtualRegister,
1019     }
1020 
1021 op :catch,
1022     args: {
1023         exception: VirtualRegister,
1024         thrownValue: VirtualRegister,
1025     },
1026     metadata: {
1027         buffer: ValueProfileAndVirtualRegisterBuffer.*,
1028     }
1029 
1030 op :throw,
1031     args: {
1032         value: VirtualRegister,
1033     }
1034 
1035 op :throw_static_error,
1036     args: {
1037         message: VirtualRegister,
1038         errorType: ErrorType,
1039     }
1040 
1041 op :debug,
1042     args: {
1043         debugHookType: DebugHookType,
1044         hasBreakpoint: bool,
1045     }
1046 
1047 op :end,
1048     args: {
1049         value: VirtualRegister,
1050     }
1051 
1052 op :profile_type,
1053     args: {
1054         targetVirtualRegister: VirtualRegister,
1055         symbolTableOrScopeDepth: SymbolTableOrScopeDepth,
1056         flag: ProfileTypeBytecodeFlag,
1057         identifier?: unsigned,
1058         resolveType: ResolveType,
1059     },
1060     metadata: {
1061         typeLocation: TypeLocation.*,
1062     }
1063 
1064 op :profile_control_flow,
1065     args: {
1066         textOffset: int,
1067     },
1068     metadata: {
1069         basicBlockLocation: BasicBlockLocation.*,
1070     }
1071 
1072 op :get_enumerable_length,
1073     args: {
1074         dst: VirtualRegister,
1075         base: VirtualRegister,
1076     }
1077 
1078 op :has_indexed_property,
1079     args: {
1080         dst: VirtualRegister,
1081         base: VirtualRegister,
1082         property: VirtualRegister,
1083     },
1084     metadata: {
1085         arrayProfile: ArrayProfile,
1086     }
1087 
1088 op :has_structure_property,
1089     args: {
1090         dst: VirtualRegister,
1091         base: VirtualRegister,
1092         property: VirtualRegister,
1093         enumerator: VirtualRegister,
1094     }
1095 
1096 op :has_generic_property,
1097     args: {
1098         dst: VirtualRegister,
1099         base: VirtualRegister,
1100         property: VirtualRegister,
1101     }
1102 
1103 op :get_direct_pname,
1104     args: {
1105         dst: VirtualRegister,
1106         base: VirtualRegister,
1107         property: VirtualRegister,
1108         index: VirtualRegister,
1109         enumerator: VirtualRegister,
1110     },
1111     metadata: {
1112         profile: ValueProfile,
1113     }
1114 
1115 op :get_property_enumerator,
1116     args: {
1117         dst: VirtualRegister,
1118         base: VirtualRegister,
1119     }
1120 
1121 op :enumerator_structure_pname,
1122     args: {
1123         dst: VirtualRegister,
1124         enumerator: VirtualRegister,
1125         index: VirtualRegister,
1126     }
1127 
1128 op :enumerator_generic_pname,
1129     args: {
1130         dst: VirtualRegister,
1131         enumerator: VirtualRegister,
1132         index: VirtualRegister,
1133     }
1134 
1135 op :to_index_string,
1136     args: {
1137         dst: VirtualRegister,
1138         index: VirtualRegister,
1139     }
1140 
1141 op :unreachable
1142 
1143 op :create_rest,
1144     args: {
1145         dst: VirtualRegister,
1146         arraySize: VirtualRegister,
1147         numParametersToSkip: unsigned,
1148     }
1149 
1150 op :get_rest_length,
1151     args: {
1152         dst: VirtualRegister,
1153         numParametersToSkip: unsigned,
1154     }
1155 
1156 op :yield,
1157     args: {
1158         generator: VirtualRegister,
1159         yieldPoint: unsigned,
1160         argument: VirtualRegister,
1161     }
1162 
1163 op :check_traps
1164 
1165 op :log_shadow_chicken_prologue,
1166     args: {
1167         scope: VirtualRegister,
1168     }
1169 
1170 op :log_shadow_chicken_tail,
1171     args: {
1172         thisValue: VirtualRegister,
1173         scope: VirtualRegister,
1174     }
1175 
1176 op :resolve_scope_for_hoisting_func_decl_in_eval,
1177     args: {
1178         dst: VirtualRegister,
1179         scope: VirtualRegister,
1180         property: unsigned,
1181     }
1182 
1183 op :get_internal_field,
1184     args: {
1185         dst: VirtualRegister,
1186         base: VirtualRegister,
1187         index: unsigned,
1188     },
1189     metadata: {
1190         profile: ValueProfile,
1191     }
1192 
1193 op :put_internal_field,
1194     args: {
1195         base: VirtualRegister,
1196         index: unsigned,
1197         value: VirtualRegister,
1198     }
1199 
1200 op :nop
1201 
1202 op :super_sampler_begin
1203 
1204 op :super_sampler_end
1205 
1206 end_section :Bytecode
1207 
1208 begin_section :CLoopHelpers,
1209     emit_in_h_file: true,
1210     macro_name_component: :CLOOP_BYTECODE_HELPER
1211 
1212 op :llint_entry
1213 op :getHostCallReturnValue
1214 op :llint_return_to_host
1215 op :llint_vm_entry_to_javascript
1216 op :llint_vm_entry_to_native
1217 op :llint_cloop_did_return_from_js_1
1218 op :llint_cloop_did_return_from_js_2
1219 op :llint_cloop_did_return_from_js_3
1220 op :llint_cloop_did_return_from_js_4
1221 op :llint_cloop_did_return_from_js_5
1222 op :llint_cloop_did_return_from_js_6
1223 op :llint_cloop_did_return_from_js_7
1224 op :llint_cloop_did_return_from_js_8
1225 op :llint_cloop_did_return_from_js_9
1226 op :llint_cloop_did_return_from_js_10
1227 op :llint_cloop_did_return_from_js_11
1228 op :llint_cloop_did_return_from_js_12
1229 op :llint_cloop_did_return_from_js_13
1230 op :llint_cloop_did_return_from_js_14
1231 op :llint_cloop_did_return_from_js_15
1232 op :llint_cloop_did_return_from_js_16
1233 op :llint_cloop_did_return_from_js_17
1234 op :llint_cloop_did_return_from_js_18
1235 op :llint_cloop_did_return_from_js_19
1236 op :llint_cloop_did_return_from_js_20
1237 op :llint_cloop_did_return_from_js_21
1238 op :llint_cloop_did_return_from_js_22
1239 op :llint_cloop_did_return_from_js_23
1240 op :llint_cloop_did_return_from_js_24
1241 op :llint_cloop_did_return_from_js_25
1242 op :llint_cloop_did_return_from_js_26
1243 op :llint_cloop_did_return_from_js_27
1244 op :llint_cloop_did_return_from_js_28
1245 op :llint_cloop_did_return_from_js_29
1246 op :llint_cloop_did_return_from_js_30
1247 op :llint_cloop_did_return_from_js_31
1248 op :llint_cloop_did_return_from_js_32
1249 op :llint_cloop_did_return_from_js_33
1250 op :llint_cloop_did_return_from_js_34
1251 
1252 end_section :CLoopHelpers
1253 
1254 begin_section :NativeHelpers,
1255     emit_in_h_file: true,
1256     emit_in_asm_file: true,
1257     macro_name_component: :BYTECODE_HELPER
1258 
1259 op :llint_program_prologue
1260 op :llint_eval_prologue
1261 op :llint_module_program_prologue
1262 op :llint_function_for_call_prologue
1263 op :llint_function_for_construct_prologue
1264 op :llint_function_for_call_arity_check
1265 op :llint_function_for_construct_arity_check
1266 op :llint_generic_return_point
1267 op :llint_throw_from_slow_path_trampoline
1268 op :llint_throw_during_call_trampoline
1269 op :llint_native_call_trampoline
1270 op :llint_native_construct_trampoline
1271 op :llint_internal_function_call_trampoline
1272 op :llint_internal_function_construct_trampoline
1273 op :checkpoint_osr_exit_from_inlined_call_trampoline
1274 op :checkpoint_osr_exit_trampoline
1275 op :handleUncaughtException
1276 op :op_call_return_location
1277 op :op_construct_return_location
1278 op :op_call_varargs_slow_return_location
1279 op :op_construct_varargs_slow_return_location
1280 op :op_get_by_id_return_location
1281 op :op_get_by_val_return_location
1282 op :op_put_by_id_return_location
1283 op :op_put_by_val_return_location
1284 op :wasm_function_prologue
1285 op :wasm_function_prologue_no_tls
1286 
1287 end_section :NativeHelpers
1288 
1289 begin_section :Wasm,
1290     emit_in_h_file: true,
1291     emit_in_structs_file: true,
1292     macro_name_component: :WASM,
1293     op_prefix: &quot;wasm_&quot;
1294 
1295 autogenerate_wasm_opcodes
1296 
1297 # Helpers
1298 
1299 op :throw_from_slow_path_trampoline
1300 
1301 # FIXME: Wasm and JS LLInt should share common opcodes
1302 # https://bugs.webkit.org/show_bug.cgi?id=203656
1303 
1304 op :wide16
1305 op :wide32
1306 
1307 op :enter
1308 op :nop
1309 op :loop_hint
1310 
1311 op :mov,
1312     args: {
1313         dst: VirtualRegister,
1314         src: VirtualRegister,
1315     }
1316 
1317 op_group :ConditionalJump,
1318     [
1319         :jtrue,
1320         :jfalse,
1321     ],
1322     args: {
1323         condition: VirtualRegister,
1324         targetLabel: WasmBoundLabel,
1325     }
1326 
1327 op :jmp,
1328     args: {
1329         targetLabel: WasmBoundLabel,
1330     }
1331 
1332 op :ret
1333 
1334 op :switch,
1335     args: {
1336         scrutinee: VirtualRegister,
1337         tableIndex: unsigned,
1338     }
1339 
1340 # Wasm specific bytecodes
1341 
1342 op :unreachable
1343 op :ret_void
1344 
1345 op :drop_keep,
1346     args: {
1347         startOffset: unsigned,
1348         dropCount: unsigned,
1349         keepCount: unsigned,
1350     }
1351 
1352 op :ref_is_null,
1353     args: {
1354         dst: VirtualRegister,
1355         ref: VirtualRegister,
1356     }
1357 
1358 op :ref_func,
1359     args: {
1360         dst: VirtualRegister,
1361         functionIndex: unsigned,
1362     }
1363 
1364 op :get_global,
1365     args: {
1366         dst: VirtualRegister,
1367         globalIndex: unsigned,
1368     }
1369 
1370 op :set_global,
1371     args: {
1372         globalIndex: unsigned,
1373         value: VirtualRegister,
1374     }
1375 
1376 op :set_global_ref,
1377     args: {
1378         globalIndex: unsigned,
1379         value: VirtualRegister,
1380     }
1381 
1382 op :get_global_portable_binding,
1383     args: {
1384         dst: VirtualRegister,
1385         globalIndex: unsigned,
1386     }
1387 
1388 op :set_global_portable_binding,
1389     args: {
1390         globalIndex: unsigned,
1391         value: VirtualRegister,
1392     }
1393 
1394 op :set_global_ref_portable_binding,
1395     args: {
1396         globalIndex: unsigned,
1397         value: VirtualRegister,
1398     }
1399 
1400 op :table_get,
1401     args: {
1402         dst: VirtualRegister,
1403         index: VirtualRegister,
1404         tableIndex: unsigned,
1405     }
1406 
1407 op :table_set,
1408     args: {
1409         index: VirtualRegister,
1410         value: VirtualRegister,
1411         tableIndex: unsigned,
1412     }
1413 
1414 op :table_size,
1415     args: {
1416         dst: VirtualRegister,
1417         tableIndex: unsigned,
1418     }
1419 
1420 op :table_grow,
1421     args: {
1422         dst: VirtualRegister,
1423         fill: VirtualRegister,
1424         size: VirtualRegister,
1425         tableIndex: unsigned,
1426     }
1427 
1428 op :table_fill,
1429     args: {
1430         offset: VirtualRegister,
1431         fill: VirtualRegister,
1432         size: VirtualRegister,
1433         tableIndex: unsigned,
1434     }
1435 
1436 op :call,
1437     args: {
1438         functionIndex: unsigned,
1439         stackOffset: unsigned,
1440         numberOfStackArgs: unsigned,
1441     }
1442 
1443 op :call_no_tls,
1444     args: {
1445         functionIndex: unsigned,
1446         stackOffset: unsigned,
1447         numberOfStackArgs: unsigned,
1448     }
1449 
1450 op :call_indirect,
1451     args: {
1452         functionIndex: VirtualRegister,
1453         signatureIndex: unsigned,
1454         stackOffset: unsigned,
1455         numberOfStackArgs: unsigned,
1456         tableIndex: unsigned,
1457     }
1458 
1459 op :call_indirect_no_tls,
1460     args: {
1461         functionIndex: VirtualRegister,
1462         signatureIndex: unsigned,
1463         stackOffset: unsigned,
1464         numberOfStackArgs: unsigned,
1465         tableIndex: unsigned,
1466     }
1467 
1468 op :current_memory,
1469     args: {
1470         dst: VirtualRegister,
1471     }
1472 
1473 op :grow_memory,
1474     args: {
1475         dst: VirtualRegister,
1476         delta: VirtualRegister
1477     }
1478 
1479 op :select,
1480     args: {
1481         dst: VirtualRegister,
1482         condition: VirtualRegister,
1483         nonZero: VirtualRegister,
1484         zero: VirtualRegister,
1485     }
1486 
1487 op_group :Load,
1488     [
1489         :load8_u,
1490         :load16_u,
1491         :load32_u,
1492         :load64_u,
1493         :i32_load8_s,
1494         :i64_load8_s,
1495         :i32_load16_s,
1496         :i64_load16_s,
1497         :i64_load32_s,
1498     ],
1499     args: {
1500         dst: VirtualRegister,
1501         pointer: VirtualRegister,
1502         offset: unsigned,
1503     }
1504 
1505 op_group :Store,
1506     [
1507         :store8,
1508         :store16,
1509         :store32,
1510         :store64,
1511     ],
1512     args: {
1513         pointer: VirtualRegister,
1514         value: VirtualRegister,
1515         offset: unsigned,
1516     }
1517 
1518 end_section :Wasm
    </pre>
  </body>
</html>