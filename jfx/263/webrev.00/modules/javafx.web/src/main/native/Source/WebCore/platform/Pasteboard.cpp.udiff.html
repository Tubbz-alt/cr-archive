<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/platform/Pasteboard.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="PODRedBlackTree.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Pasteboard.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/Pasteboard.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -28,12 +28,10 @@</span>
  
  #include &quot;PasteboardStrategy.h&quot;
  #include &quot;PlatformStrategies.h&quot;
  #include &quot;Settings.h&quot;
  #include &quot;SharedBuffer.h&quot;
<span class="udiff-line-removed">- #include &lt;wtf/URLParser.h&gt;</span>
<span class="udiff-line-removed">- #include &lt;wtf/persistence/PersistentCoders.h&gt;</span>
  #include &lt;wtf/text/StringHash.h&gt;
  
  namespace WebCore {
  
  // Making this non-inline so that WebKit 2&#39;s decoding doesn&#39;t have to include Image.h.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -49,53 +47,60 @@</span>
  {
      URL url({ }, urlString);
      return url.protocolIsInHTTPFamily() || url.protocolIsBlob() || url.protocolIsData();
  }
  
<span class="udiff-line-modified-removed">- Ref&lt;SharedBuffer&gt; PasteboardCustomData::createSharedBuffer() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     const static unsigned currentCustomDataSerializationVersion = 1;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     WTF::Persistence::Encoder encoder;</span>
<span class="udiff-line-removed">-     encoder &lt;&lt; currentCustomDataSerializationVersion;</span>
<span class="udiff-line-removed">-     encoder &lt;&lt; origin;</span>
<span class="udiff-line-removed">-     encoder &lt;&lt; sameOriginCustomData;</span>
<span class="udiff-line-removed">-     encoder &lt;&lt; orderedTypes;</span>
<span class="udiff-line-removed">-     return SharedBuffer::create(encoder.buffer(), encoder.bufferSize());</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-modified-added">+ #if !PLATFORM(COCOA)</span>
  
<span class="udiff-line-modified-removed">- PasteboardCustomData PasteboardCustomData::fromSharedBuffer(const SharedBuffer&amp; buffer)</span>
<span class="udiff-line-modified-added">+ Vector&lt;String&gt; Pasteboard::readAllStrings(const String&amp; type)</span>
  {
<span class="udiff-line-modified-removed">-     const static unsigned maxSupportedDataSerializationVersionNumber = 1;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-removed">-     PasteboardCustomData result;</span>
<span class="udiff-line-removed">-     WTF::Persistence::Decoder decoder { reinterpret_cast&lt;const uint8_t*&gt;(buffer.data()), buffer.size() };</span>
<span class="udiff-line-removed">-     unsigned version;</span>
<span class="udiff-line-removed">-     if (!decoder.decode(version) || version &gt; maxSupportedDataSerializationVersionNumber)</span>
<span class="udiff-line-removed">-         return { };</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if (!decoder.decode(result.origin))</span>
<span class="udiff-line-modified-added">+     auto result = readString(type);</span>
<span class="udiff-line-modified-added">+     if (result.isEmpty())</span>
          return { };
  
<span class="udiff-line-modified-removed">-     if (!decoder.decode(result.sameOriginCustomData))</span>
<span class="udiff-line-modified-removed">-         return { };</span>
<span class="udiff-line-modified-added">+     return { result };</span>
<span class="udiff-line-modified-added">+ }</span>
  
<span class="udiff-line-modified-removed">-     if (!decoder.decode(result.orderedTypes))</span>
<span class="udiff-line-removed">-         return { };</span>
<span class="udiff-line-modified-added">+ #endif</span>
  
<span class="udiff-line-modified-removed">-     return result;</span>
<span class="udiff-line-modified-added">+ Optional&lt;Vector&lt;PasteboardItemInfo&gt;&gt; Pasteboard::allPasteboardItemInfo() const</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+ #if PLATFORM(COCOA)</span>
<span class="udiff-line-added">+     if (auto* strategy = platformStrategies()-&gt;pasteboardStrategy())</span>
<span class="udiff-line-added">+         return strategy-&gt;allPasteboardItemInfo(name(), m_changeCount);</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+     return WTF::nullopt;</span>
  }
  
<span class="udiff-line-modified-removed">- #if !PLATFORM(COCOA)</span>
<span class="udiff-line-modified-added">+ Optional&lt;PasteboardItemInfo&gt; Pasteboard::pasteboardItemInfo(size_t index) const</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+ #if PLATFORM(COCOA)</span>
<span class="udiff-line-added">+     if (auto* strategy = platformStrategies()-&gt;pasteboardStrategy())</span>
<span class="udiff-line-added">+         return strategy-&gt;informationForItemAtIndex(index, name(), m_changeCount);</span>
<span class="udiff-line-added">+ #else</span>
<span class="udiff-line-added">+     UNUSED_PARAM(index);</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+     return WTF::nullopt;</span>
<span class="udiff-line-added">+ }</span>
  
<span class="udiff-line-modified-removed">- Vector&lt;String&gt; Pasteboard::readAllStrings(const String&amp; type)</span>
<span class="udiff-line-modified-added">+ String Pasteboard::readString(size_t index, const String&amp; type)</span>
  {
<span class="udiff-line-modified-removed">-     auto result = readString(type);</span>
<span class="udiff-line-modified-removed">-     if (result.isEmpty())</span>
<span class="udiff-line-modified-removed">-         return { };</span>
<span class="udiff-line-modified-added">+     if (auto* strategy = platformStrategies()-&gt;pasteboardStrategy())</span>
<span class="udiff-line-modified-added">+         return strategy-&gt;readStringFromPasteboard(index, type, name());</span>
<span class="udiff-line-modified-added">+     return { };</span>
<span class="udiff-line-added">+ }</span>
  
<span class="udiff-line-modified-removed">-     return { result };</span>
<span class="udiff-line-modified-added">+ RefPtr&lt;WebCore::SharedBuffer&gt; Pasteboard::readBuffer(size_t index, const String&amp; type)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (auto* strategy = platformStrategies()-&gt;pasteboardStrategy())</span>
<span class="udiff-line-added">+         return strategy-&gt;readBufferFromPasteboard(index, type, name());</span>
<span class="udiff-line-added">+     return nullptr;</span>
  }
  
<span class="udiff-line-modified-removed">- #endif</span>
<span class="udiff-line-modified-added">+ URL Pasteboard::readURL(size_t index, String&amp; title)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (auto* strategy = platformStrategies()-&gt;pasteboardStrategy())</span>
<span class="udiff-line-added">+         return strategy-&gt;readURLFromPasteboard(index, name(), title);</span>
<span class="udiff-line-added">+     return { };</span>
<span class="udiff-line-added">+ }</span>
  
  };
</pre>
<center><a href="PODRedBlackTree.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Pasteboard.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>