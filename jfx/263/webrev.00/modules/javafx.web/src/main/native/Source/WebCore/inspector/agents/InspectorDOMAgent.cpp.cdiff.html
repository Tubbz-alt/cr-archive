<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/inspector/agents/InspectorDOMAgent.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="InspectorCanvasAgent.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="InspectorDOMAgent.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/inspector/agents/InspectorDOMAgent.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 33,18 ***</span>
<span class="line-new-header">--- 33,22 ---</span>
  
  #include &quot;AXObjectCache.h&quot;
  #include &quot;AccessibilityNodeObject.h&quot;
  #include &quot;Attr.h&quot;
  #include &quot;CSSComputedStyleDeclaration.h&quot;
<span class="line-added">+ #include &quot;CSSParser.h&quot;</span>
  #include &quot;CSSPropertyNames.h&quot;
  #include &quot;CSSPropertySourceData.h&quot;
  #include &quot;CSSRule.h&quot;
  #include &quot;CSSRuleList.h&quot;
<span class="line-added">+ #include &quot;CSSSelector.h&quot;</span>
<span class="line-added">+ #include &quot;CSSSelectorList.h&quot;</span>
  #include &quot;CSSStyleRule.h&quot;
  #include &quot;CSSStyleSheet.h&quot;
  #include &quot;CharacterData.h&quot;
  #include &quot;CommandLineAPIHost.h&quot;
<span class="line-added">+ #include &quot;ComposedTreeIterator.h&quot;</span>
  #include &quot;ContainerNode.h&quot;
  #include &quot;Cookie.h&quot;
  #include &quot;CookieJar.h&quot;
  #include &quot;DOMEditor.h&quot;
  #include &quot;DOMException.h&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 90,10 ***</span>
<span class="line-new-header">--- 94,11 ---</span>
  #include &quot;Pasteboard.h&quot;
  #include &quot;PseudoElement.h&quot;
  #include &quot;RenderStyle.h&quot;
  #include &quot;RenderStyleConstants.h&quot;
  #include &quot;ScriptState.h&quot;
<span class="line-added">+ #include &quot;SelectorChecker.h&quot;</span>
  #include &quot;ShadowRoot.h&quot;
  #include &quot;StaticNodeList.h&quot;
  #include &quot;StyleProperties.h&quot;
  #include &quot;StyleResolver.h&quot;
  #include &quot;StyleSheetList.h&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 107,10 ***</span>
<span class="line-new-header">--- 112,11 ---</span>
  #include &lt;JavaScriptCore/IdentifiersFactory.h&gt;
  #include &lt;JavaScriptCore/InjectedScript.h&gt;
  #include &lt;JavaScriptCore/InjectedScriptManager.h&gt;
  #include &lt;JavaScriptCore/JSCInlines.h&gt;
  #include &lt;pal/crypto/CryptoDigest.h&gt;
<span class="line-added">+ #include &lt;wtf/Function.h&gt;</span>
  #include &lt;wtf/text/Base64.h&gt;
  #include &lt;wtf/text/CString.h&gt;
  #include &lt;wtf/text/WTFString.h&gt;
  
  namespace WebCore {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 215,11 ***</span>
      explicit InspectableNode(Node* node)
          : m_node(node)
      {
      }
  
<span class="line-modified">!     JSC::JSValue get(JSC::ExecState&amp; state) final</span>
      {
          return InspectorDOMAgent::nodeAsScriptValue(state, m_node.get());
      }
  private:
      RefPtr&lt;Node&gt; m_node;
<span class="line-new-header">--- 221,11 ---</span>
      explicit InspectableNode(Node* node)
          : m_node(node)
      {
      }
  
<span class="line-modified">!     JSC::JSValue get(JSC::JSGlobalObject&amp; state) final</span>
      {
          return InspectorDOMAgent::nodeAsScriptValue(state, m_node.get());
      }
  private:
      RefPtr&lt;Node&gt; m_node;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 459,11 ***</span>
  Node* InspectorDOMAgent::assertEditableNode(ErrorString&amp; errorString, int nodeId)
  {
      Node* node = assertNode(errorString, nodeId);
      if (!node)
          return nullptr;
<span class="line-modified">!     if (node-&gt;isInUserAgentShadowTree()) {</span>
          errorString = &quot;Node for given nodeId is in a shadow tree&quot;_s;
          return nullptr;
      }
      if (node-&gt;isPseudoElement()) {
          errorString = &quot;Node for given nodeId is a pseudo-element&quot;_s;
<span class="line-new-header">--- 465,11 ---</span>
  Node* InspectorDOMAgent::assertEditableNode(ErrorString&amp; errorString, int nodeId)
  {
      Node* node = assertNode(errorString, nodeId);
      if (!node)
          return nullptr;
<span class="line-modified">!     if (node-&gt;isInUserAgentShadowTree() &amp;&amp; !m_allowEditingUserAgentShadowTrees) {</span>
          errorString = &quot;Node for given nodeId is in a shadow tree&quot;_s;
          return nullptr;
      }
      if (node-&gt;isPseudoElement()) {
          errorString = &quot;Node for given nodeId is a pseudo-element&quot;_s;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 539,21 ***</span>
      m_eventListenerEntries.clear();
      releaseDanglingNodes();
      m_childrenRequested.clear();
  }
  
  int InspectorDOMAgent::pushNodeToFrontend(ErrorString&amp; errorString, int documentNodeId, Node* nodeToPush)
  {
      Document* document = assertDocument(errorString, documentNodeId);
      if (!document)
          return 0;
      if (&amp;nodeToPush-&gt;document() != document) {
          errorString = &quot;nodeToPush is not part of the document with given documentNodeId&quot;_s;
          return 0;
      }
  
<span class="line-modified">!     return pushNodePathToFrontend(nodeToPush);</span>
  }
  
  Node* InspectorDOMAgent::nodeForId(int id)
  {
      if (!m_idToNode.isValidKey(id))
<span class="line-new-header">--- 545,30 ---</span>
      m_eventListenerEntries.clear();
      releaseDanglingNodes();
      m_childrenRequested.clear();
  }
  
<span class="line-added">+ int InspectorDOMAgent::pushNodeToFrontend(Node* nodeToPush)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     if (!nodeToPush)</span>
<span class="line-added">+         return 0;</span>
<span class="line-added">+ </span>
<span class="line-added">+     ErrorString ignored;</span>
<span class="line-added">+     return pushNodeToFrontend(ignored, boundNodeId(&amp;nodeToPush-&gt;document()), nodeToPush);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  int InspectorDOMAgent::pushNodeToFrontend(ErrorString&amp; errorString, int documentNodeId, Node* nodeToPush)
  {
      Document* document = assertDocument(errorString, documentNodeId);
      if (!document)
          return 0;
      if (&amp;nodeToPush-&gt;document() != document) {
          errorString = &quot;nodeToPush is not part of the document with given documentNodeId&quot;_s;
          return 0;
      }
  
<span class="line-modified">!     return pushNodePathToFrontend(errorString, nodeToPush);</span>
  }
  
  Node* InspectorDOMAgent::nodeForId(int id)
  {
      if (!m_idToNode.isValidKey(id))
</pre>
<hr />
<pre>
<span class="line-old-header">*** 596,11 ***</span>
          errorString = &quot;DOM Error while querying with given selectors&quot;_s;
          return;
      }
  
      if (auto* element = queryResult.releaseReturnValue())
<span class="line-modified">!         *elementId = pushNodePathToFrontend(element);</span>
  }
  
  void InspectorDOMAgent::querySelectorAll(ErrorString&amp; errorString, int nodeId, const String&amp; selectors, RefPtr&lt;JSON::ArrayOf&lt;int&gt;&gt;&amp; result)
  {
      Node* node = assertNode(errorString, nodeId);
<span class="line-new-header">--- 611,11 ---</span>
          errorString = &quot;DOM Error while querying with given selectors&quot;_s;
          return;
      }
  
      if (auto* element = queryResult.releaseReturnValue())
<span class="line-modified">!         *elementId = pushNodePathToFrontend(errorString, element);</span>
  }
  
  void InspectorDOMAgent::querySelectorAll(ErrorString&amp; errorString, int nodeId, const String&amp; selectors, RefPtr&lt;JSON::ArrayOf&lt;int&gt;&gt;&amp; result)
  {
      Node* node = assertNode(errorString, nodeId);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 622,17 ***</span>
      for (unsigned i = 0; i &lt; nodes-&gt;length(); ++i)
          result-&gt;addItem(pushNodePathToFrontend(nodes-&gt;item(i)));
  }
  
  int InspectorDOMAgent::pushNodePathToFrontend(Node* nodeToPush)
  {
      ASSERT(nodeToPush);  // Invalid input
  
<span class="line-modified">!     if (!m_document)</span>
          return 0;
<span class="line-modified">!     if (!m_documentNodeToIdMap.contains(m_document))</span>
          return 0;
  
      // Return id in case the node is known.
      int result = m_documentNodeToIdMap.get(nodeToPush);
      if (result)
          return result;
<span class="line-new-header">--- 637,28 ---</span>
      for (unsigned i = 0; i &lt; nodes-&gt;length(); ++i)
          result-&gt;addItem(pushNodePathToFrontend(nodes-&gt;item(i)));
  }
  
  int InspectorDOMAgent::pushNodePathToFrontend(Node* nodeToPush)
<span class="line-added">+ {</span>
<span class="line-added">+     ErrorString ignored;</span>
<span class="line-added">+     return pushNodePathToFrontend(ignored, nodeToPush);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ int InspectorDOMAgent::pushNodePathToFrontend(ErrorString errorString, Node* nodeToPush)</span>
  {
      ASSERT(nodeToPush);  // Invalid input
  
<span class="line-modified">!     if (!m_document) {</span>
<span class="line-added">+         errorString = &quot;Missing document&quot;_s;</span>
          return 0;
<span class="line-modified">!     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     if (!m_documentNodeToIdMap.contains(m_document)) {</span>
<span class="line-added">+         errorString = &quot;Document must have been requested&quot;_s;</span>
          return 0;
<span class="line-added">+     }</span>
  
      // Return id in case the node is known.
      int result = m_documentNodeToIdMap.get(nodeToPush);
      if (result)
          return result;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 773,11 ***</span>
      if (!m_domEditor-&gt;insertBefore(*parent, newElement.copyRef(), oldNode-&gt;nextSibling(), errorString))
          return;
      if (!m_domEditor-&gt;removeChild(*parent, *oldNode, errorString))
          return;
  
<span class="line-modified">!     *newId = pushNodePathToFrontend(newElement.ptr());</span>
      if (m_childrenRequested.contains(nodeId))
          pushChildNodesToFrontend(*newId);
  }
  
  void InspectorDOMAgent::getOuterHTML(ErrorString&amp; errorString, int nodeId, WTF::String* outerHTML)
<span class="line-new-header">--- 799,11 ---</span>
      if (!m_domEditor-&gt;insertBefore(*parent, newElement.copyRef(), oldNode-&gt;nextSibling(), errorString))
          return;
      if (!m_domEditor-&gt;removeChild(*parent, *oldNode, errorString))
          return;
  
<span class="line-modified">!     *newId = pushNodePathToFrontend(errorString, newElement.ptr());</span>
      if (m_childrenRequested.contains(nodeId))
          pushChildNodesToFrontend(*newId);
  }
  
  void InspectorDOMAgent::getOuterHTML(ErrorString&amp; errorString, int nodeId, WTF::String* outerHTML)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 813,11 ***</span>
      if (!newNode) {
          // The only child node has been deleted.
          return;
      }
  
<span class="line-modified">!     int newId = pushNodePathToFrontend(newNode);</span>
  
      bool childrenRequested = m_childrenRequested.contains(nodeId);
      if (childrenRequested)
          pushChildNodesToFrontend(newId);
  }
<span class="line-new-header">--- 839,11 ---</span>
      if (!newNode) {
          // The only child node has been deleted.
          return;
      }
  
<span class="line-modified">!     int newId = pushNodePathToFrontend(errorString, newNode);</span>
  
      bool childrenRequested = m_childrenRequested.contains(nodeId);
      if (childrenRequested)
          pushChildNodesToFrontend(newId);
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1110,11 ***</span>
  
      Frame* frame = node-&gt;document().frame();
      if (!frame)
          return;
  
<span class="line-modified">!     JSC::ExecState* scriptState = mainWorldExecState(frame);</span>
      InjectedScript injectedScript = m_injectedScriptManager.injectedScriptFor(scriptState);
      if (injectedScript.hasNoValue())
          return;
  
      injectedScript.inspectObject(nodeAsScriptValue(*scriptState, node.get()));
<span class="line-new-header">--- 1136,11 ---</span>
  
      Frame* frame = node-&gt;document().frame();
      if (!frame)
          return;
  
<span class="line-modified">!     JSC::JSGlobalObject* scriptState = mainWorldExecState(frame);</span>
      InjectedScript injectedScript = m_injectedScriptManager.injectedScriptFor(scriptState);
      if (injectedScript.hasNoValue())
          return;
  
      injectedScript.inspectObject(nodeAsScriptValue(*scriptState, node.get()));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1211,10 ***</span>
<span class="line-new-header">--- 1237,14 ---</span>
      m_overlay-&gt;highlightQuad(WTFMove(quad), *highlightConfig);
  }
  
  void InspectorDOMAgent::highlightSelector(ErrorString&amp; errorString, const JSON::Object&amp; highlightInspectorObject, const String&amp; selectorString, const String* frameId)
  {
<span class="line-added">+     auto highlightConfig = highlightConfigFromInspectorObject(errorString, &amp;highlightInspectorObject);</span>
<span class="line-added">+     if (!highlightConfig)</span>
<span class="line-added">+         return;</span>
<span class="line-added">+ </span>
      RefPtr&lt;Document&gt; document;
  
      if (frameId) {
          auto* pageAgent = m_instrumentingAgents.inspectorPageAgent();
          if (!pageAgent) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1233,22 ***</span>
      if (!document) {
          errorString = &quot;Missing document of frame for given frameId&quot;_s;
          return;
      }
  
<span class="line-modified">!     auto queryResult = document-&gt;querySelectorAll(selectorString);</span>
<span class="line-modified">!     // FIXME: &lt;https://webkit.org/b/146161&gt; Web Inspector: DOM.highlightSelector should work for &quot;a:visited&quot;</span>
<span class="line-modified">!     if (queryResult.hasException()) {</span>
<span class="line-removed">-         errorString = &quot;DOM Error while querying with given selectorString&quot;_s;</span>
<span class="line-removed">-         return;</span>
<span class="line-removed">-     }</span>
  
<span class="line-modified">!     auto highlightConfig = highlightConfigFromInspectorObject(errorString, &amp;highlightInspectorObject);</span>
<span class="line-removed">-     if (!highlightConfig)</span>
<span class="line-removed">-         return;</span>
  
<span class="line-modified">!     m_overlay-&gt;highlightNodeList(queryResult.releaseReturnValue(), *highlightConfig);</span>
  }
  
  void InspectorDOMAgent::highlightNode(ErrorString&amp; errorString, const JSON::Object&amp; highlightInspectorObject, const int* nodeId, const String* objectId)
  {
      Node* node = nullptr;
<span class="line-new-header">--- 1263,70 ---</span>
      if (!document) {
          errorString = &quot;Missing document of frame for given frameId&quot;_s;
          return;
      }
  
<span class="line-modified">!     CSSParser parser(*document);</span>
<span class="line-modified">!     CSSSelectorList selectorList;</span>
<span class="line-modified">!     parser.parseSelector(selectorString, selectorList);</span>
  
<span class="line-modified">!     SelectorChecker selectorChecker(*document);</span>
  
<span class="line-modified">!     Vector&lt;Ref&lt;Node&gt;&gt; nodeList;</span>
<span class="line-added">+     HashSet&lt;Node*&gt; seenNodes;</span>
<span class="line-added">+ </span>
<span class="line-added">+     for (auto&amp; descendant : composedTreeDescendants(*document)) {</span>
<span class="line-added">+         if (!is&lt;Element&gt;(descendant))</span>
<span class="line-added">+             continue;</span>
<span class="line-added">+ </span>
<span class="line-added">+         auto&amp; descendantElement = downcast&lt;Element&gt;(descendant);</span>
<span class="line-added">+ </span>
<span class="line-added">+         auto isInUserAgentShadowTree = descendantElement.isInUserAgentShadowTree();</span>
<span class="line-added">+         auto pseudoId = descendantElement.pseudoId();</span>
<span class="line-added">+         auto&amp; pseudo = descendantElement.pseudo();</span>
<span class="line-added">+ </span>
<span class="line-added">+         for (const auto* selector = selectorList.first(); selector; selector = CSSSelectorList::next(selector)) {</span>
<span class="line-added">+             if (isInUserAgentShadowTree &amp;&amp; (selector-&gt;match() != CSSSelector::PseudoElement || selector-&gt;value() != pseudo))</span>
<span class="line-added">+                 continue;</span>
<span class="line-added">+ </span>
<span class="line-added">+             SelectorChecker::CheckingContext context(SelectorChecker::Mode::ResolvingStyle);</span>
<span class="line-added">+             context.pseudoId = pseudoId;</span>
<span class="line-added">+ </span>
<span class="line-added">+             unsigned ignoredSpecificity;</span>
<span class="line-added">+             if (selectorChecker.match(*selector, descendantElement, context, ignoredSpecificity)) {</span>
<span class="line-added">+                 if (seenNodes.add(&amp;descendantElement))</span>
<span class="line-added">+                     nodeList.append(descendantElement);</span>
<span class="line-added">+             }</span>
<span class="line-added">+ </span>
<span class="line-added">+             if (context.pseudoIDSet) {</span>
<span class="line-added">+                 auto pseudoIDs = PseudoIdSet::fromMask(context.pseudoIDSet.data());</span>
<span class="line-added">+ </span>
<span class="line-added">+                 if (pseudoIDs.has(PseudoId::Before)) {</span>
<span class="line-added">+                     pseudoIDs.remove(PseudoId::Before);</span>
<span class="line-added">+                     if (auto* beforePseudoElement = descendantElement.beforePseudoElement()) {</span>
<span class="line-added">+                         if (seenNodes.add(beforePseudoElement))</span>
<span class="line-added">+                             nodeList.append(*beforePseudoElement);</span>
<span class="line-added">+                     }</span>
<span class="line-added">+                 }</span>
<span class="line-added">+ </span>
<span class="line-added">+                 if (pseudoIDs.has(PseudoId::After)) {</span>
<span class="line-added">+                     pseudoIDs.remove(PseudoId::After);</span>
<span class="line-added">+                     if (auto* afterPseudoElement = descendantElement.afterPseudoElement()) {</span>
<span class="line-added">+                         if (seenNodes.add(afterPseudoElement))</span>
<span class="line-added">+                             nodeList.append(*afterPseudoElement);</span>
<span class="line-added">+                     }</span>
<span class="line-added">+                 }</span>
<span class="line-added">+ </span>
<span class="line-added">+                 if (pseudoIDs) {</span>
<span class="line-added">+                     if (seenNodes.add(&amp;descendantElement))</span>
<span class="line-added">+                         nodeList.append(descendantElement);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     m_overlay-&gt;highlightNodeList(StaticNodeList::create(WTFMove(nodeList)), *highlightConfig);</span>
  }
  
  void InspectorDOMAgent::highlightNode(ErrorString&amp; errorString, const JSON::Object&amp; highlightInspectorObject, const int* nodeId, const String* objectId)
  {
      Node* node = nullptr;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1353,11 ***</span>
      }
  
      if (!m_domEditor-&gt;insertBefore(*targetElement, *node, anchorNode, errorString))
          return;
  
<span class="line-modified">!     *newNodeId = pushNodePathToFrontend(node);</span>
  }
  
  void InspectorDOMAgent::undo(ErrorString&amp; errorString)
  {
      auto result = m_history-&gt;undo();
<span class="line-new-header">--- 1431,11 ---</span>
      }
  
      if (!m_domEditor-&gt;insertBefore(*targetElement, *node, anchorNode, errorString))
          return;
  
<span class="line-modified">!     *newNodeId = pushNodePathToFrontend(errorString, node);</span>
  }
  
  void InspectorDOMAgent::undo(ErrorString&amp; errorString)
  {
      auto result = m_history-&gt;undo();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1393,11 ***</span>
  {
      Node* node = assertNode(errorString, nodeId);
      if (!node)
          return;
  
<span class="line-modified">!     if (node-&gt;isInUserAgentShadowTree()) {</span>
          errorString = &quot;Node for given nodeId is in a shadow tree&quot;_s;
          return;
      }
  
      m_inspectedNode = node;
<span class="line-new-header">--- 1471,11 ---</span>
  {
      Node* node = assertNode(errorString, nodeId);
      if (!node)
          return;
  
<span class="line-modified">!     if (node-&gt;isInUserAgentShadowTree() &amp;&amp; !m_allowEditingUserAgentShadowTrees) {</span>
          errorString = &quot;Node for given nodeId is in a shadow tree&quot;_s;
          return;
      }
  
      m_inspectedNode = node;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1429,15 ***</span>
          return;
  
      result = buildArrayForElementAttributes(element);
  }
  
<span class="line-modified">! void InspectorDOMAgent::requestNode(ErrorString&amp;, const String&amp; objectId, int* nodeId)</span>
  {
      Node* node = nodeForObjectId(objectId);
      if (node)
<span class="line-modified">!         *nodeId = pushNodePathToFrontend(node);</span>
      else
          *nodeId = 0;
  }
  
  String InspectorDOMAgent::documentURLString(Document* document)
<span class="line-new-header">--- 1507,15 ---</span>
          return;
  
      result = buildArrayForElementAttributes(element);
  }
  
<span class="line-modified">! void InspectorDOMAgent::requestNode(ErrorString&amp; errorString, const String&amp; objectId, int* nodeId)</span>
  {
      Node* node = nodeForObjectId(objectId);
      if (node)
<span class="line-modified">!         *nodeId = pushNodePathToFrontend(errorString, node);</span>
      else
          *nodeId = 0;
  }
  
  String InspectorDOMAgent::documentURLString(Document* document)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1685,11 ***</span>
                  document = downcast&lt;Document&gt;(scriptExecutionContext);
          } else if (is&lt;Node&gt;(eventTarget))
              document = &amp;downcast&lt;Node&gt;(eventTarget).document();
  
          JSC::JSObject* handlerObject = nullptr;
<span class="line-modified">!         JSC::ExecState* exec = nullptr;</span>
  
          JSC::JSLockHolder lock(scriptListener.isolatedWorld().vm());
  
          if (document) {
              handlerObject = scriptListener.jsFunction(*document);
<span class="line-new-header">--- 1763,11 ---</span>
                  document = downcast&lt;Document&gt;(scriptExecutionContext);
          } else if (is&lt;Node&gt;(eventTarget))
              document = &amp;downcast&lt;Node&gt;(eventTarget).document();
  
          JSC::JSObject* handlerObject = nullptr;
<span class="line-modified">!         JSC::JSGlobalObject* exec = nullptr;</span>
  
          JSC::JSLockHolder lock(scriptListener.isolatedWorld().vm());
  
          if (document) {
              handlerObject = scriptListener.jsFunction(*document);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1759,11 ***</span>
      if (hasBreakpoint)
          value-&gt;setHasBreakpoint(hasBreakpoint);
      return value;
  }
  
<span class="line-modified">! void InspectorDOMAgent::processAccessibilityChildren(AccessibilityObject&amp; axObject, JSON::ArrayOf&lt;int&gt;&amp; childNodeIds)</span>
  {
      const auto&amp; children = axObject.children();
      if (!children.size())
          return;
  
<span class="line-new-header">--- 1837,11 ---</span>
      if (hasBreakpoint)
          value-&gt;setHasBreakpoint(hasBreakpoint);
      return value;
  }
  
<span class="line-modified">! void InspectorDOMAgent::processAccessibilityChildren(AXCoreObject&amp; axObject, JSON::ArrayOf&lt;int&gt;&amp; childNodeIds)</span>
  {
      const auto&amp; children = axObject.children();
      if (!children.size())
          return;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1822,17 ***</span>
      int headingLevel = 0;
      unsigned hierarchicalLevel = 0;
      unsigned level = 0;
  
      if (AXObjectCache* axObjectCache = node-&gt;document().axObjectCache()) {
<span class="line-modified">!         if (AccessibilityObject* axObject = axObjectCache-&gt;getOrCreate(node)) {</span>
  
<span class="line-modified">!             if (AccessibilityObject* activeDescendant = axObject-&gt;activeDescendant())</span>
                  activeDescendantNode = activeDescendant-&gt;node();
  
              // An AX object is &quot;busy&quot; if it or any ancestor has aria-busy=&quot;true&quot; set.
<span class="line-modified">!             AccessibilityObject* current = axObject;</span>
              while (!busy &amp;&amp; current) {
                  busy = current-&gt;isBusy();
                  current = current-&gt;parentObject();
              }
  
<span class="line-new-header">--- 1900,17 ---</span>
      int headingLevel = 0;
      unsigned hierarchicalLevel = 0;
      unsigned level = 0;
  
      if (AXObjectCache* axObjectCache = node-&gt;document().axObjectCache()) {
<span class="line-modified">!         if (AXCoreObject* axObject = axObjectCache-&gt;getOrCreate(node)) {</span>
  
<span class="line-modified">!             if (AXCoreObject* activeDescendant = axObject-&gt;activeDescendant())</span>
                  activeDescendantNode = activeDescendant-&gt;node();
  
              // An AX object is &quot;busy&quot; if it or any ancestor has aria-busy=&quot;true&quot; set.
<span class="line-modified">!             AXCoreObject* current = axObject;</span>
              while (!busy &amp;&amp; current) {
                  busy = current-&gt;isBusy();
                  current = current-&gt;parentObject();
              }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1969,11 ***</span>
                      for (Element* ownedElement : ownedElements)
                          ownedNodeIds-&gt;addItem(pushNodePathToFrontend(ownedElement));
                  }
              }
  
<span class="line-modified">!             if (AccessibilityObject* parentObject = axObject-&gt;parentObjectUnignored())</span>
                  parentNode = parentObject-&gt;node();
  
              supportsPressed = axObject-&gt;pressedIsPresent();
              if (supportsPressed)
                  pressed = axObject-&gt;isPressed();
<span class="line-new-header">--- 2047,11 ---</span>
                      for (Element* ownedElement : ownedElements)
                          ownedNodeIds-&gt;addItem(pushNodePathToFrontend(ownedElement));
                  }
              }
  
<span class="line-modified">!             if (AXCoreObject* parentObject = axObject-&gt;parentObjectUnignored())</span>
                  parentNode = parentObject-&gt;node();
  
              supportsPressed = axObject-&gt;pressedIsPresent();
              if (supportsPressed)
                  pressed = axObject-&gt;isPressed();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1986,11 ***</span>
                  required = axObject-&gt;isRequired();
  
              role = axObject-&gt;computedRoleString();
              selected = axObject-&gt;isSelected();
  
<span class="line-modified">!             AccessibilityObject::AccessibilityChildrenVector selectedChildren;</span>
              axObject-&gt;selectedChildren(selectedChildren);
              if (selectedChildren.size()) {
                  selectedChildNodeIds = JSON::ArrayOf&lt;int&gt;::create();
                  for (auto&amp; selectedChildObject : selectedChildren) {
                      if (Node* selectedChildNode = selectedChildObject-&gt;node())
<span class="line-new-header">--- 2064,11 ---</span>
                  required = axObject-&gt;isRequired();
  
              role = axObject-&gt;computedRoleString();
              selected = axObject-&gt;isSelected();
  
<span class="line-modified">!             AXCoreObject::AccessibilityChildrenVector selectedChildren;</span>
              axObject-&gt;selectedChildren(selectedChildren);
              if (selectedChildren.size()) {
                  selectedChildNodeIds = JSON::ArrayOf&lt;int&gt;::create();
                  for (auto&amp; selectedChildObject : selectedChildren) {
                      if (Node* selectedChildNode = selectedChildObject-&gt;node())
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2577,11 ***</span>
  }
  
  void InspectorDOMAgent::pushNodeByPathToFrontend(ErrorString&amp; errorString, const String&amp; path, int* nodeId)
  {
      if (Node* node = nodeForPath(path))
<span class="line-modified">!         *nodeId = pushNodePathToFrontend(node);</span>
      else
          errorString = &quot;Missing node for given path&quot;_s;
  }
  
  RefPtr&lt;Inspector::Protocol::Runtime::RemoteObject&gt; InspectorDOMAgent::resolveNode(Node* node, const String&amp; objectGroup)
<span class="line-new-header">--- 2655,11 ---</span>
  }
  
  void InspectorDOMAgent::pushNodeByPathToFrontend(ErrorString&amp; errorString, const String&amp; path, int* nodeId)
  {
      if (Node* node = nodeForPath(path))
<span class="line-modified">!         *nodeId = pushNodePathToFrontend(errorString, node);</span>
      else
          errorString = &quot;Missing node for given path&quot;_s;
  }
  
  RefPtr&lt;Inspector::Protocol::Runtime::RemoteObject&gt; InspectorDOMAgent::resolveNode(Node* node, const String&amp; objectGroup)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2606,12 ***</span>
      if (!value || !value.isObject())
          return nullptr;
      return JSNode::toWrapped(value.getObject()-&gt;vm(), value.getObject());
  }
  
<span class="line-modified">! JSC::JSValue InspectorDOMAgent::nodeAsScriptValue(JSC::ExecState&amp; state, Node* node)</span>
  {
      JSC::JSLockHolder lock(&amp;state);
      return toJS(&amp;state, deprecatedGlobalObjectForPrototype(&amp;state), BindingSecurity::checkSecurityForNode(state, node));
  }
  
  } // namespace WebCore
<span class="line-new-header">--- 2684,17 ---</span>
      if (!value || !value.isObject())
          return nullptr;
      return JSNode::toWrapped(value.getObject()-&gt;vm(), value.getObject());
  }
  
<span class="line-modified">! JSC::JSValue InspectorDOMAgent::nodeAsScriptValue(JSC::JSGlobalObject&amp; state, Node* node)</span>
  {
      JSC::JSLockHolder lock(&amp;state);
      return toJS(&amp;state, deprecatedGlobalObjectForPrototype(&amp;state), BindingSecurity::checkSecurityForNode(state, node));
  }
  
<span class="line-added">+ void InspectorDOMAgent::setAllowEditingUserAgentShadowTrees(ErrorString&amp;, bool allow)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     m_allowEditingUserAgentShadowTrees = allow;</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  } // namespace WebCore
</pre>
<center><a href="InspectorCanvasAgent.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="InspectorDOMAgent.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>