<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/JavaScriptCore/dfg/DFGMayExit.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2014-2016 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;DFGMayExit.h&quot;
 28 
 29 #if ENABLE(DFG_JIT)
 30 
 31 #include &quot;DFGAtTailAbstractState.h&quot;
 32 #include &quot;DFGGraph.h&quot;
 33 #include &quot;DFGNode.h&quot;
 34 #include &quot;DFGNullAbstractState.h&quot;
 35 #include &quot;Operations.h&quot;
 36 
 37 namespace JSC { namespace DFG {
 38 
 39 namespace {
 40 
 41 template&lt;typename StateType&gt;
 42 ExitMode mayExitImpl(Graph&amp; graph, Node* node, StateType&amp; state)
 43 {
 44     ExitMode result = DoesNotExit;
 45 
 46     switch (node-&gt;op()) {
 47     // This is a carefully curated list of nodes that definitely do not exit. We try to be very
 48     // conservative when maintaining this list, because adding new node types to it doesn&#39;t
 49     // generally make things a lot better but it might introduce subtle bugs.
 50     case SetArgumentDefinitely:
 51     case SetArgumentMaybe:
 52     case JSConstant:
 53     case DoubleConstant:
 54     case LazyJSConstant:
 55     case Int52Constant:
 56     case MovHint:
 57     case InitializeEntrypointArguments:
 58     case SetLocal:
 59     case Flush:
 60     case Phantom:
 61     case Check:
 62     case CheckVarargs:
 63     case Identity:
 64     case IdentityWithProfile:
 65     case GetLocal:
 66     case LoopHint:
 67     case Phi:
 68     case Upsilon:
 69     case ZombieHint:
 70     case ExitOK:
 71     case BottomValue:
 72     case PutHint:
 73     case PhantomNewObject:
<a name="1" id="anc1"></a><span class="line-added"> 74     case PhantomNewArrayIterator:</span>
 75     case PutStack:
 76     case KillStack:
 77     case GetStack:
 78     case GetCallee:
 79     case SetCallee:
 80     case GetArgumentCountIncludingThis:
 81     case SetArgumentCountIncludingThis:
 82     case GetRestLength:
 83     case GetScope:
 84     case PhantomLocal:
 85     case CountExecution:
 86     case SuperSamplerBegin:
 87     case SuperSamplerEnd:
 88     case Jump:
 89     case EntrySwitch:
 90     case Branch:
 91     case Unreachable:
 92     case DoubleRep:
 93     case Int52Rep:
 94     case ValueRep:
 95     case ExtractOSREntryLocal:
 96     case ExtractCatchLocal:
 97     case ClearCatchLocals:
 98     case LogicalNot:
 99     case NotifyWrite:
100     case PutStructure:
101     case StoreBarrier:
102     case FencedStoreBarrier:
103     case PutByOffset:
104     case PutClosureVar:
<a name="2" id="anc2"></a><span class="line-added">105     case PutInternalField:</span>
106     case RecordRegExpCachedResult:
107     case NukeStructureAndSetButterfly:
108     case FilterCallLinkStatus:
<a name="3" id="anc3"></a><span class="line-modified">109     case FilterGetByStatus:</span>
110     case FilterPutByIdStatus:
111     case FilterInByIdStatus:
112         break;
113 
114     case StrCat:
115     case Call:
116     case Construct:
117     case CallVarargs:
118     case CallEval:
119     case ConstructVarargs:
120     case CallForwardVarargs:
121     case ConstructForwardVarargs:
122     case CreateActivation:
123     case MaterializeCreateActivation:
124     case MaterializeNewObject:
<a name="4" id="anc4"></a><span class="line-added">125     case MaterializeNewInternalFieldObject:</span>
126     case NewFunction:
127     case NewGeneratorFunction:
128     case NewAsyncFunction:
129     case NewAsyncGeneratorFunction:
130     case NewStringObject:
131     case NewSymbol:
<a name="5" id="anc5"></a><span class="line-added">132     case NewArrayIterator:</span>
133     case NewRegexp:
134     case ToNumber:
<a name="6" id="anc6"></a><span class="line-added">135     case ToNumeric:</span>
136     case RegExpExecNonGlobalOrSticky:
137     case RegExpMatchFastGlobal:
138         result = ExitsForExceptions;
139         break;
140 
141     case SetRegExpObjectLastIndex:
142         if (node-&gt;ignoreLastIndexIsWritable())
143             break;
144         return Exits;
145 
146     default:
147         // If in doubt, return true.
148         return Exits;
149     }
150 
151     graph.doToChildren(
152         node,
153         [&amp;] (Edge&amp; edge) {
154             if (state) {
155                 // Ignore the Check flag on the edge. This is important because that flag answers
156                 // the question: &quot;would this edge have had a check if it executed wherever it
157                 // currently resides in control flow?&quot; But when a state is passed, we want to ask a
158                 // different question: &quot;would this edge have a check if it executed wherever this
159                 // state is?&quot; Using the Check flag for this purpose wouldn&#39;t even be conservatively
160                 // correct. It would be wrong in both directions.
161                 if (mayHaveTypeCheck(edge.useKind())
162                     &amp;&amp; (state.forNode(edge).m_type &amp; ~typeFilterFor(edge.useKind()))) {
163                     result = Exits;
164                     return;
165                 }
166             } else {
167                 // FIXME: Maybe this should call mayHaveTypeCheck(edge.useKind()) instead.
168                 // https://bugs.webkit.org/show_bug.cgi?id=148545
169                 if (edge.willHaveCheck()) {
170                     result = Exits;
171                     return;
172                 }
173             }
174 
175             switch (edge.useKind()) {
176             // These are shady because nodes that have these use kinds will typically exit for
177             // unrelated reasons. For example CompareEq doesn&#39;t usually exit, but if it uses
178             // ObjectUse then it will.
179             case ObjectUse:
180             case ObjectOrOtherUse:
181                 result = Exits;
182                 break;
183 
184             default:
185                 break;
186             }
187         });
188 
189     return result;
190 }
191 
192 } // anonymous namespace
193 
194 ExitMode mayExit(Graph&amp; graph, Node* node)
195 {
196     NullAbstractState state;
197     return mayExitImpl(graph, node, state);
198 }
199 
200 ExitMode mayExit(Graph&amp; graph, Node* node, AtTailAbstractState&amp; state)
201 {
202     return mayExitImpl(graph, node, state);
203 }
204 
205 } } // namespace JSC::DFG
206 
207 namespace WTF {
208 
209 using namespace JSC::DFG;
210 
211 void printInternal(PrintStream&amp; out, ExitMode mode)
212 {
213     switch (mode) {
214     case DoesNotExit:
215         out.print(&quot;DoesNotExit&quot;);
216         return;
217     case ExitsForExceptions:
218         out.print(&quot;ExitsForExceptions&quot;);
219         return;
220     case Exits:
221         out.print(&quot;Exits&quot;);
222         return;
223     }
224     RELEASE_ASSERT_NOT_REACHED();
225 }
226 
227 } // namespace WTF
228 
229 #endif // ENABLE(DFG_JIT)
<a name="7" id="anc7"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="7" type="hidden" />
</body>
</html>