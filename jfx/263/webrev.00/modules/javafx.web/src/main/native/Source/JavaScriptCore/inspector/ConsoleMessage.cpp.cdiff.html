<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/inspector/ConsoleMessage.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../heap/WeakSetInlines.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ConsoleMessage.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/inspector/ConsoleMessage.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 50,21 ***</span>
      , m_url()
      , m_requestId(IdentifiersFactory::requestId(requestIdentifier))
  {
  }
  
<span class="line-modified">! ConsoleMessage::ConsoleMessage(MessageSource source, MessageType type, MessageLevel level, const String&amp; message, const String&amp; url, unsigned line, unsigned column, JSC::ExecState* state, unsigned long requestIdentifier)</span>
      : m_source(source)
      , m_type(type)
      , m_level(level)
      , m_message(message)
      , m_url(url)
      , m_line(line)
      , m_column(column)
      , m_requestId(IdentifiersFactory::requestId(requestIdentifier))
  {
<span class="line-modified">!     autogenerateMetadata(state);</span>
  }
  
  ConsoleMessage::ConsoleMessage(MessageSource source, MessageType type, MessageLevel level, const String&amp; message, Ref&lt;ScriptCallStack&gt;&amp;&amp; callStack, unsigned long requestIdentifier)
      : m_source(source)
      , m_type(type)
<span class="line-new-header">--- 50,21 ---</span>
      , m_url()
      , m_requestId(IdentifiersFactory::requestId(requestIdentifier))
  {
  }
  
<span class="line-modified">! ConsoleMessage::ConsoleMessage(MessageSource source, MessageType type, MessageLevel level, const String&amp; message, const String&amp; url, unsigned line, unsigned column, JSC::JSGlobalObject* globalObject, unsigned long requestIdentifier)</span>
      : m_source(source)
      , m_type(type)
      , m_level(level)
      , m_message(message)
      , m_url(url)
      , m_line(line)
      , m_column(column)
      , m_requestId(IdentifiersFactory::requestId(requestIdentifier))
  {
<span class="line-modified">!     autogenerateMetadata(globalObject);</span>
  }
  
  ConsoleMessage::ConsoleMessage(MessageSource source, MessageType type, MessageLevel level, const String&amp; message, Ref&lt;ScriptCallStack&gt;&amp;&amp; callStack, unsigned long requestIdentifier)
      : m_source(source)
      , m_type(type)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 98,30 ***</span>
          m_line = frame-&gt;lineNumber();
          m_column = frame-&gt;columnNumber();
      }
  }
  
<span class="line-modified">! ConsoleMessage::ConsoleMessage(MessageSource source, MessageType type, MessageLevel level, const String&amp; message, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments, JSC::ExecState* state, unsigned long requestIdentifier)</span>
      : m_source(source)
      , m_type(type)
      , m_level(level)
      , m_message(message)
      , m_arguments(WTFMove(arguments))
      , m_url()
      , m_requestId(IdentifiersFactory::requestId(requestIdentifier))
  {
<span class="line-modified">!     autogenerateMetadata(state);</span>
  }
  
<span class="line-modified">! ConsoleMessage::ConsoleMessage(MessageSource source, MessageType type, MessageLevel level, Vector&lt;JSONLogValue&gt;&amp;&amp; messages, JSC::ExecState* state, unsigned long requestIdentifier)</span>
      : m_source(source)
      , m_type(type)
      , m_level(level)
      , m_url()
<span class="line-removed">-     , m_scriptState(state)</span>
      , m_requestId(IdentifiersFactory::requestId(requestIdentifier))
  {
      if (!messages.size())
          return;
  
      m_jsonLogValues.reserveInitialCapacity(messages.size());
  
<span class="line-new-header">--- 98,32 ---</span>
          m_line = frame-&gt;lineNumber();
          m_column = frame-&gt;columnNumber();
      }
  }
  
<span class="line-modified">! ConsoleMessage::ConsoleMessage(MessageSource source, MessageType type, MessageLevel level, const String&amp; message, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments, JSC::JSGlobalObject* globalObject, unsigned long requestIdentifier)</span>
      : m_source(source)
      , m_type(type)
      , m_level(level)
      , m_message(message)
      , m_arguments(WTFMove(arguments))
      , m_url()
      , m_requestId(IdentifiersFactory::requestId(requestIdentifier))
  {
<span class="line-modified">!     autogenerateMetadata(globalObject);</span>
  }
  
<span class="line-modified">! ConsoleMessage::ConsoleMessage(MessageSource source, MessageType type, MessageLevel level, Vector&lt;JSONLogValue&gt;&amp;&amp; messages, JSC::JSGlobalObject* globalObject, unsigned long requestIdentifier)</span>
      : m_source(source)
      , m_type(type)
      , m_level(level)
      , m_url()
      , m_requestId(IdentifiersFactory::requestId(requestIdentifier))
  {
<span class="line-added">+     if (globalObject)</span>
<span class="line-added">+         m_globalObject = { globalObject-&gt;vm(), globalObject };</span>
<span class="line-added">+ </span>
      if (!messages.size())
          return;
  
      m_jsonLogValues.reserveInitialCapacity(messages.size());
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 151,20 ***</span>
  
  ConsoleMessage::~ConsoleMessage()
  {
  }
  
<span class="line-modified">! void ConsoleMessage::autogenerateMetadata(JSC::ExecState* state)</span>
  {
<span class="line-modified">!     if (!state)</span>
          return;
  
      if (m_type == MessageType::EndGroup)
          return;
  
      // FIXME: Should this really be using &quot;for console&quot; in the generic ConsoleMessage autogeneration? This can skip the first frame.
<span class="line-modified">!     m_callStack = createScriptCallStackForConsole(state);</span>
  
      if (const ScriptCallFrame* frame = m_callStack-&gt;firstNonNativeCallFrame()) {
          m_url = frame-&gt;sourceURL();
          m_line = frame-&gt;lineNumber();
          m_column = frame-&gt;columnNumber();
<span class="line-new-header">--- 153,20 ---</span>
  
  ConsoleMessage::~ConsoleMessage()
  {
  }
  
<span class="line-modified">! void ConsoleMessage::autogenerateMetadata(JSC::JSGlobalObject* globalObject)</span>
  {
<span class="line-modified">!     if (!globalObject)</span>
          return;
  
      if (m_type == MessageType::EndGroup)
          return;
  
      // FIXME: Should this really be using &quot;for console&quot; in the generic ConsoleMessage autogeneration? This can skip the first frame.
<span class="line-modified">!     m_callStack = createScriptCallStackForConsole(globalObject);</span>
  
      if (const ScriptCallFrame* frame = m_callStack-&gt;firstNonNativeCallFrame()) {
          m_url = frame-&gt;sourceURL();
          m_line = frame-&gt;lineNumber();
          m_column = frame-&gt;columnNumber();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 243,11 ***</span>
  
      if (m_source == MessageSource::Network &amp;&amp; !m_requestId.isEmpty())
          messageObject-&gt;setNetworkRequestId(m_requestId);
  
      if ((m_arguments &amp;&amp; m_arguments-&gt;argumentCount()) || m_jsonLogValues.size()) {
<span class="line-modified">!         InjectedScript injectedScript = injectedScriptManager.injectedScriptFor(scriptState());</span>
          if (!injectedScript.hasNoValue()) {
              auto argumentsObject = JSON::ArrayOf&lt;Protocol::Runtime::RemoteObject&gt;::create();
              if (m_arguments &amp;&amp; m_arguments-&gt;argumentCount()) {
                  if (m_type == MessageType::Table &amp;&amp; generatePreview &amp;&amp; m_arguments-&gt;argumentCount()) {
                      auto table = m_arguments-&gt;argumentAt(0);
<span class="line-new-header">--- 245,11 ---</span>
  
      if (m_source == MessageSource::Network &amp;&amp; !m_requestId.isEmpty())
          messageObject-&gt;setNetworkRequestId(m_requestId);
  
      if ((m_arguments &amp;&amp; m_arguments-&gt;argumentCount()) || m_jsonLogValues.size()) {
<span class="line-modified">!         InjectedScript injectedScript = injectedScriptManager.injectedScriptFor(globalObject());</span>
          if (!injectedScript.hasNoValue()) {
              auto argumentsObject = JSON::ArrayOf&lt;Protocol::Runtime::RemoteObject&gt;::create();
              if (m_arguments &amp;&amp; m_arguments-&gt;argumentCount()) {
                  if (m_type == MessageType::Table &amp;&amp; generatePreview &amp;&amp; m_arguments-&gt;argumentCount()) {
                      auto table = m_arguments-&gt;argumentAt(0);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 338,19 ***</span>
      if (!m_message)
          m_message = &quot;&lt;message collected&gt;&quot;_s;
  
      if (m_arguments)
          m_arguments = nullptr;
  }
  
<span class="line-modified">! JSC::ExecState* ConsoleMessage::scriptState() const</span>
  {
      if (m_arguments)
<span class="line-modified">!         return m_arguments-&gt;globalState();</span>
  
<span class="line-modified">!     if (m_scriptState)</span>
<span class="line-modified">!         return m_scriptState;</span>
  
      return nullptr;
  }
  
  unsigned ConsoleMessage::argumentCount() const
<span class="line-new-header">--- 340,22 ---</span>
      if (!m_message)
          m_message = &quot;&lt;message collected&gt;&quot;_s;
  
      if (m_arguments)
          m_arguments = nullptr;
<span class="line-added">+ </span>
<span class="line-added">+     if (m_globalObject)</span>
<span class="line-added">+         m_globalObject.clear();</span>
  }
  
<span class="line-modified">! JSC::JSGlobalObject* ConsoleMessage::globalObject() const</span>
  {
      if (m_arguments)
<span class="line-modified">!         return m_arguments-&gt;globalObject();</span>
  
<span class="line-modified">!     if (m_globalObject)</span>
<span class="line-modified">!         return m_globalObject.get();</span>
  
      return nullptr;
  }
  
  unsigned ConsoleMessage::argumentCount() const
</pre>
<center><a href="../heap/WeakSetInlines.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ConsoleMessage.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>