<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSDOMWindowBase.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSDOMWindowBase.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="JSDOMWindowCustom.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSDOMWindowBase.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 31 #include &lt;JavaScriptCore/Lookup.h&gt;
 32 #include &lt;JavaScriptCore/ObjectConstructor.h&gt;
 33 #include &lt;JavaScriptCore/SlotVisitorInlines.h&gt;
 34 #include &lt;JavaScriptCore/StructureInlines.h&gt;
 35 #include &lt;JavaScriptCore/WriteBarrier.h&gt;
 36 #include &lt;cstddef&gt;
 37 #include &lt;wtf/Forward.h&gt;
 38 #include &lt;wtf/GetPtr.h&gt;
 39 #include &lt;wtf/Vector.h&gt;
 40 
 41 namespace WebCore {
 42 
 43 class DOMWrapperWorld;
 44 class Frame;
 45 class FetchResponse;
 46 class JSDOMWindow;
 47 class JSDOMWindowBasePrivate;
 48 class JSWindowProxy;
 49 
 50 class WEBCORE_EXPORT JSDOMWindowBase : public JSDOMGlobalObject {
<span class="line-modified"> 51     typedef JSDOMGlobalObject Base;</span>
<span class="line-modified"> 52 protected:</span>
<span class="line-removed"> 53     JSDOMWindowBase(JSC::VM&amp;, JSC::Structure*, RefPtr&lt;DOMWindow&gt;&amp;&amp;, JSWindowProxy*);</span>
<span class="line-removed"> 54     void finishCreation(JSC::VM&amp;, JSWindowProxy*);</span>
 55 
 56     static void destroy(JSCell*);
 57 
<span class="line-modified"> 58 public:</span>


 59     void updateDocument();
 60 
 61     DOMWindow&amp; wrapped() const { return *m_wrapped; }
 62     ScriptExecutionContext* scriptExecutionContext() const;
 63 
 64     // Called just before removing this window from the JSWindowProxy.
 65     void willRemoveFromWindowProxy();
 66 
 67     DECLARE_INFO;
 68 
 69     static JSC::Structure* createStructure(JSC::VM&amp; vm, JSC::JSValue prototype)
 70     {
 71         return JSC::Structure::create(vm, 0, prototype, JSC::TypeInfo(JSC::GlobalObjectType, StructureFlags), info());
 72     }
 73 
 74     static const JSC::GlobalObjectMethodTable s_globalObjectMethodTable;
 75 
 76     static bool supportsRichSourceInfo(const JSC::JSGlobalObject*);
 77     static bool shouldInterruptScript(const JSC::JSGlobalObject*);
 78     static bool shouldInterruptScriptBeforeTimeout(const JSC::JSGlobalObject*);
 79     static JSC::RuntimeFlags javaScriptRuntimeFlags(const JSC::JSGlobalObject*);
<span class="line-modified"> 80     static void queueTaskToEventLoop(JSC::JSGlobalObject&amp;, Ref&lt;JSC::Microtask&gt;&amp;&amp;);</span>
 81 
 82     void printErrorMessage(const String&amp;) const;
 83 
 84     JSWindowProxy* proxy() const;
 85 
 86     static void fireFrameClearedWatchpointsForWindow(DOMWindow*);
 87 
 88 protected:



 89     JSC::WatchpointSet m_windowCloseWatchpoints;
 90 
 91 private:
 92     using ResponseCallback = WTF::Function&lt;void(const char*, size_t)&gt;;
 93 
<span class="line-modified"> 94     static JSC::Identifier moduleLoaderResolve(JSC::JSGlobalObject*, JSC::ExecState*, JSC::JSModuleLoader*, JSC::JSValue, JSC::JSValue, JSC::JSValue);</span>
<span class="line-modified"> 95     static JSC::JSInternalPromise* moduleLoaderFetch(JSC::JSGlobalObject*, JSC::ExecState*, JSC::JSModuleLoader*, JSC::JSValue, JSC::JSValue, JSC::JSValue);</span>
<span class="line-modified"> 96     static JSC::JSValue moduleLoaderEvaluate(JSC::JSGlobalObject*, JSC::ExecState*, JSC::JSModuleLoader*, JSC::JSValue, JSC::JSValue, JSC::JSValue);</span>
<span class="line-modified"> 97     static JSC::JSInternalPromise* moduleLoaderImportModule(JSC::JSGlobalObject*, JSC::ExecState*, JSC::JSModuleLoader*, JSC::JSString*, JSC::JSValue, const JSC::SourceOrigin&amp;);</span>
<span class="line-modified"> 98     static JSC::JSObject* moduleLoaderCreateImportMetaProperties(JSC::JSGlobalObject*, JSC::ExecState*, JSC::JSModuleLoader*, JSC::JSValue, JSC::JSModuleRecord*, JSC::JSValue);</span>
 99 
100 #if ENABLE(WEBASSEMBLY)
<span class="line-modified">101     static void compileStreaming(JSC::JSGlobalObject*, JSC::ExecState*, JSC::JSPromiseDeferred*, JSC::JSValue);</span>
<span class="line-modified">102     static void instantiateStreaming(JSC::JSGlobalObject*, JSC::ExecState*, JSC::JSPromiseDeferred*, JSC::JSValue, JSC::JSObject*);</span>
103 #endif
104 
105     RefPtr&lt;DOMWindow&gt; m_wrapped;
106     JSWindowProxy* m_proxy;
107 };
108 
<span class="line-modified">109 WEBCORE_EXPORT JSC::JSValue toJS(JSC::ExecState*, DOMWindow&amp;);</span>
110 // The following return a JSWindowProxy or jsNull()
111 // JSDOMGlobalObject* is ignored, accessing a window in any context will use that DOMWindow&#39;s prototype chain.
<span class="line-modified">112 inline JSC::JSValue toJS(JSC::ExecState* state, JSDOMGlobalObject*, DOMWindow&amp; window) { return toJS(state, window); }</span>
<span class="line-modified">113 inline JSC::JSValue toJS(JSC::ExecState* state, JSDOMGlobalObject* globalObject, DOMWindow* window) { return window ? toJS(state, globalObject, *window) : JSC::jsNull(); }</span>
<span class="line-modified">114 inline JSC::JSValue toJS(JSC::ExecState* state, DOMWindow* window) { return window ? toJS(state, *window) : JSC::jsNull(); }</span>
115 
116 // The following return a JSDOMWindow or nullptr.
117 JSDOMWindow* toJSDOMWindow(Frame&amp;, DOMWrapperWorld&amp;);
118 inline JSDOMWindow* toJSDOMWindow(Frame* frame, DOMWrapperWorld&amp; world) { return frame ? toJSDOMWindow(*frame, world) : nullptr; }
119 WEBCORE_EXPORT JSDOMWindow* toJSDOMWindow(JSC::VM&amp;, JSC::JSValue);
120 
121 // DOMWindow associated with global object of the &quot;most-recently-entered author function or script
122 // on the stack, or the author function or script that originally scheduled the currently-running callback.&quot;
123 // (&lt;https://html.spec.whatwg.org/multipage/webappapis.html#concept-incumbent-everything&gt;, 27 April 2017)
124 // FIXME: Make this work for an &quot;author function or script that originally scheduled the currently-running callback.&quot;
125 // See &lt;https://bugs.webkit.org/show_bug.cgi?id=163412&gt;.
<span class="line-modified">126 DOMWindow&amp; incumbentDOMWindow(JSC::ExecState&amp;);</span>
127 
<span class="line-modified">128 DOMWindow&amp; activeDOMWindow(JSC::ExecState&amp;);</span>
<span class="line-modified">129 DOMWindow&amp; firstDOMWindow(JSC::ExecState&amp;);</span>
130 
131 // FIXME: This should probably be removed in favor of one of the other DOMWindow accessors. It is intended
132 //        to provide the document specfied as the &#39;responsible document&#39; in the algorithm for document.open()
133 //        (https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#document-open-steps steps 4
134 //        and 23 and https://html.spec.whatwg.org/multipage/webappapis.html#responsible-document). It is only
135 //        used by JSDocument.
<span class="line-modified">136 Document* responsibleDocument(JSC::ExecState&amp;);</span>
137 
138 } // namespace WebCore
</pre>
</td>
<td>
<hr />
<pre>
 31 #include &lt;JavaScriptCore/Lookup.h&gt;
 32 #include &lt;JavaScriptCore/ObjectConstructor.h&gt;
 33 #include &lt;JavaScriptCore/SlotVisitorInlines.h&gt;
 34 #include &lt;JavaScriptCore/StructureInlines.h&gt;
 35 #include &lt;JavaScriptCore/WriteBarrier.h&gt;
 36 #include &lt;cstddef&gt;
 37 #include &lt;wtf/Forward.h&gt;
 38 #include &lt;wtf/GetPtr.h&gt;
 39 #include &lt;wtf/Vector.h&gt;
 40 
 41 namespace WebCore {
 42 
 43 class DOMWrapperWorld;
 44 class Frame;
 45 class FetchResponse;
 46 class JSDOMWindow;
 47 class JSDOMWindowBasePrivate;
 48 class JSWindowProxy;
 49 
 50 class WEBCORE_EXPORT JSDOMWindowBase : public JSDOMGlobalObject {
<span class="line-modified"> 51 public:</span>
<span class="line-modified"> 52     using Base = JSDOMGlobalObject;</span>


 53 
 54     static void destroy(JSCell*);
 55 
<span class="line-modified"> 56     template&lt;typename, JSC::SubspaceAccess&gt;</span>
<span class="line-added"> 57     static void subspaceFor(JSC::VM&amp;) { RELEASE_ASSERT_NOT_REACHED(); }</span>
<span class="line-added"> 58 </span>
 59     void updateDocument();
 60 
 61     DOMWindow&amp; wrapped() const { return *m_wrapped; }
 62     ScriptExecutionContext* scriptExecutionContext() const;
 63 
 64     // Called just before removing this window from the JSWindowProxy.
 65     void willRemoveFromWindowProxy();
 66 
 67     DECLARE_INFO;
 68 
 69     static JSC::Structure* createStructure(JSC::VM&amp; vm, JSC::JSValue prototype)
 70     {
 71         return JSC::Structure::create(vm, 0, prototype, JSC::TypeInfo(JSC::GlobalObjectType, StructureFlags), info());
 72     }
 73 
 74     static const JSC::GlobalObjectMethodTable s_globalObjectMethodTable;
 75 
 76     static bool supportsRichSourceInfo(const JSC::JSGlobalObject*);
 77     static bool shouldInterruptScript(const JSC::JSGlobalObject*);
 78     static bool shouldInterruptScriptBeforeTimeout(const JSC::JSGlobalObject*);
 79     static JSC::RuntimeFlags javaScriptRuntimeFlags(const JSC::JSGlobalObject*);
<span class="line-modified"> 80     static void queueMicrotaskToEventLoop(JSC::JSGlobalObject&amp;, Ref&lt;JSC::Microtask&gt;&amp;&amp;);</span>
 81 
 82     void printErrorMessage(const String&amp;) const;
 83 
 84     JSWindowProxy* proxy() const;
 85 
 86     static void fireFrameClearedWatchpointsForWindow(DOMWindow*);
 87 
 88 protected:
<span class="line-added"> 89     JSDOMWindowBase(JSC::VM&amp;, JSC::Structure*, RefPtr&lt;DOMWindow&gt;&amp;&amp;, JSWindowProxy*);</span>
<span class="line-added"> 90     void finishCreation(JSC::VM&amp;, JSWindowProxy*);</span>
<span class="line-added"> 91 </span>
 92     JSC::WatchpointSet m_windowCloseWatchpoints;
 93 
 94 private:
 95     using ResponseCallback = WTF::Function&lt;void(const char*, size_t)&gt;;
 96 
<span class="line-modified"> 97     static JSC::Identifier moduleLoaderResolve(JSC::JSGlobalObject*, JSC::JSModuleLoader*, JSC::JSValue, JSC::JSValue, JSC::JSValue);</span>
<span class="line-modified"> 98     static JSC::JSInternalPromise* moduleLoaderFetch(JSC::JSGlobalObject*, JSC::JSModuleLoader*, JSC::JSValue, JSC::JSValue, JSC::JSValue);</span>
<span class="line-modified"> 99     static JSC::JSValue moduleLoaderEvaluate(JSC::JSGlobalObject*, JSC::JSModuleLoader*, JSC::JSValue, JSC::JSValue, JSC::JSValue);</span>
<span class="line-modified">100     static JSC::JSInternalPromise* moduleLoaderImportModule(JSC::JSGlobalObject*, JSC::JSModuleLoader*, JSC::JSString*, JSC::JSValue, const JSC::SourceOrigin&amp;);</span>
<span class="line-modified">101     static JSC::JSObject* moduleLoaderCreateImportMetaProperties(JSC::JSGlobalObject*, JSC::JSModuleLoader*, JSC::JSValue, JSC::JSModuleRecord*, JSC::JSValue);</span>
102 
103 #if ENABLE(WEBASSEMBLY)
<span class="line-modified">104     static void compileStreaming(JSC::JSGlobalObject*, JSC::JSPromise*, JSC::JSValue);</span>
<span class="line-modified">105     static void instantiateStreaming(JSC::JSGlobalObject*, JSC::JSPromise*, JSC::JSValue, JSC::JSObject*);</span>
106 #endif
107 
108     RefPtr&lt;DOMWindow&gt; m_wrapped;
109     JSWindowProxy* m_proxy;
110 };
111 
<span class="line-modified">112 WEBCORE_EXPORT JSC::JSValue toJS(JSC::JSGlobalObject*, DOMWindow&amp;);</span>
113 // The following return a JSWindowProxy or jsNull()
114 // JSDOMGlobalObject* is ignored, accessing a window in any context will use that DOMWindow&#39;s prototype chain.
<span class="line-modified">115 inline JSC::JSValue toJS(JSC::JSGlobalObject* lexicalGlobalObject, JSDOMGlobalObject*, DOMWindow&amp; window) { return toJS(lexicalGlobalObject, window); }</span>
<span class="line-modified">116 inline JSC::JSValue toJS(JSC::JSGlobalObject* lexicalGlobalObject, JSDOMGlobalObject* globalObject, DOMWindow* window) { return window ? toJS(lexicalGlobalObject, globalObject, *window) : JSC::jsNull(); }</span>
<span class="line-modified">117 inline JSC::JSValue toJS(JSC::JSGlobalObject* lexicalGlobalObject, DOMWindow* window) { return window ? toJS(lexicalGlobalObject, *window) : JSC::jsNull(); }</span>
118 
119 // The following return a JSDOMWindow or nullptr.
120 JSDOMWindow* toJSDOMWindow(Frame&amp;, DOMWrapperWorld&amp;);
121 inline JSDOMWindow* toJSDOMWindow(Frame* frame, DOMWrapperWorld&amp; world) { return frame ? toJSDOMWindow(*frame, world) : nullptr; }
122 WEBCORE_EXPORT JSDOMWindow* toJSDOMWindow(JSC::VM&amp;, JSC::JSValue);
123 
124 // DOMWindow associated with global object of the &quot;most-recently-entered author function or script
125 // on the stack, or the author function or script that originally scheduled the currently-running callback.&quot;
126 // (&lt;https://html.spec.whatwg.org/multipage/webappapis.html#concept-incumbent-everything&gt;, 27 April 2017)
127 // FIXME: Make this work for an &quot;author function or script that originally scheduled the currently-running callback.&quot;
128 // See &lt;https://bugs.webkit.org/show_bug.cgi?id=163412&gt;.
<span class="line-modified">129 DOMWindow&amp; incumbentDOMWindow(JSC::JSGlobalObject&amp;, JSC::CallFrame&amp;);</span>
130 
<span class="line-modified">131 DOMWindow&amp; activeDOMWindow(JSC::JSGlobalObject&amp;);</span>
<span class="line-modified">132 DOMWindow&amp; firstDOMWindow(JSC::JSGlobalObject&amp;);</span>
133 
134 // FIXME: This should probably be removed in favor of one of the other DOMWindow accessors. It is intended
135 //        to provide the document specfied as the &#39;responsible document&#39; in the algorithm for document.open()
136 //        (https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#document-open-steps steps 4
137 //        and 23 and https://html.spec.whatwg.org/multipage/webappapis.html#responsible-document). It is only
138 //        used by JSDocument.
<span class="line-modified">139 Document* responsibleDocument(JSC::VM&amp;, JSC::CallFrame&amp;);</span>
140 
141 } // namespace WebCore
</pre>
</td>
</tr>
</table>
<center><a href="JSDOMWindowBase.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="JSDOMWindowCustom.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>