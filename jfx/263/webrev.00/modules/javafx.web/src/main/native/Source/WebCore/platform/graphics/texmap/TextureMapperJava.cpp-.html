<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/texmap/TextureMapperJava.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;TextureMapperJava.h&quot;
 28 
 29 #include &quot;PlatformContextJava.h&quot;
 30 #include &quot;BitmapTexturePool.h&quot;
 31 #include &quot;GraphicsLayer.h&quot;
 32 #include &quot;NotImplemented.h&quot;
 33 #include &lt;wtf/RandomNumber.h&gt;
 34 
 35 #include &quot;com_sun_webkit_graphics_GraphicsDecoder.h&quot;
 36 
 37 #if USE(TEXTURE_MAPPER)
 38 namespace WebCore {
 39 
 40 static const int s_maximumAllowedImageBufferDimension = 256;
 41 
 42 std::unique_ptr&lt;TextureMapper&gt; TextureMapper::platformCreateAccelerated()
 43 {
 44     return std::make_unique&lt;TextureMapperJava&gt;();
 45 }
 46 
 47 TextureMapperJava::TextureMapperJava()
 48 {
 49     m_texturePool = std::make_unique&lt;BitmapTexturePool&gt;();
 50 }
 51 
 52 IntSize TextureMapperJava::maxTextureSize() const
 53 {
 54     return IntSize(s_maximumAllowedImageBufferDimension, s_maximumAllowedImageBufferDimension);
 55 }
 56 
 57 void TextureMapperJava::beginClip(const TransformationMatrix&amp; matrix, const FloatRect&amp; rect)
 58 {
 59     GraphicsContext* context = currentContext();
 60     if (!context)
 61         return;
 62     auto previousTransform = context-&gt;getCTM();
 63     context-&gt;save();
 64     context-&gt;concatCTM(matrix.toAffineTransform());
 65     context-&gt;clip(rect);
 66     context-&gt;setCTM(previousTransform);
 67 }
 68 
 69 void TextureMapperJava::drawTexture(const BitmapTexture&amp; texture, const FloatRect&amp; targetRect, const TransformationMatrix&amp; transform, float opacity, unsigned /* exposedEdges */)
 70 {
 71     GraphicsContext* context = currentContext();
 72     if (!context)
 73         return;
 74 
 75     const BitmapTextureJava&amp; textureImageBuffer = static_cast&lt;const BitmapTextureJava&amp;&gt;(texture);
 76     ImageBuffer* image = textureImageBuffer.image();
 77     context-&gt;save();
 78     context-&gt;setCompositeOperation(isInMaskMode() ? CompositeDestinationIn : CompositeSourceOver);
 79     context-&gt;setAlpha(opacity);
 80     context-&gt;platformContext()-&gt;rq().freeSpace(68)
 81         &lt;&lt; (jint)com_sun_webkit_graphics_GraphicsDecoder_SET_PERSPECTIVE_TRANSFORM
 82         &lt;&lt; (float)transform.m11() &lt;&lt; (float)transform.m12() &lt;&lt; (float)transform.m13() &lt;&lt; (float)transform.m14()
 83         &lt;&lt; (float)transform.m21() &lt;&lt; (float)transform.m22() &lt;&lt; (float)transform.m23() &lt;&lt; (float)transform.m24()
 84         &lt;&lt; (float)transform.m31() &lt;&lt; (float)transform.m32() &lt;&lt; (float)transform.m33() &lt;&lt; (float)transform.m34()
 85         &lt;&lt; (float)transform.m41() &lt;&lt; (float)transform.m42() &lt;&lt; (float)transform.m43() &lt;&lt; (float)transform.m44();
 86     context-&gt;drawImageBuffer(*image, targetRect);
 87     context-&gt;restore();
 88 }
 89 
 90 void TextureMapperJava::drawSolidColor(const FloatRect&amp; rect, const TransformationMatrix&amp; transform, const Color&amp; color, bool)
 91 {
 92     GraphicsContext* context = currentContext();
 93     if (!context)
 94         return;
 95 
 96     context-&gt;save();
 97     context-&gt;setCompositeOperation(isInMaskMode() ? CompositeDestinationIn : CompositeSourceOver);
 98     context-&gt;platformContext()-&gt;rq().freeSpace(68)
 99         &lt;&lt; (jint)com_sun_webkit_graphics_GraphicsDecoder_SET_PERSPECTIVE_TRANSFORM
100         &lt;&lt; (float)transform.m11() &lt;&lt; (float)transform.m12() &lt;&lt; (float)transform.m13() &lt;&lt; (float)transform.m14()
101         &lt;&lt; (float)transform.m21() &lt;&lt; (float)transform.m22() &lt;&lt; (float)transform.m23() &lt;&lt; (float)transform.m24()
102         &lt;&lt; (float)transform.m31() &lt;&lt; (float)transform.m32() &lt;&lt; (float)transform.m33() &lt;&lt; (float)transform.m34()
103         &lt;&lt; (float)transform.m41() &lt;&lt; (float)transform.m42() &lt;&lt; (float)transform.m43() &lt;&lt; (float)transform.m44();
104 
105     context-&gt;fillRect(rect, color);
106     context-&gt;restore();
107 }
108 
109 void TextureMapperJava::drawBorder(const Color&amp;, float /* borderWidth */, const FloatRect&amp;, const TransformationMatrix&amp;)
110 {
111     notImplemented();
112 }
113 
114 void TextureMapperJava::drawNumber(int /* number */, const Color&amp;, const FloatPoint&amp;, const TransformationMatrix&amp;)
115 {
116     notImplemented();
117 }
118 
119 void TextureMapperJava::clearColor(const Color&amp;)
120 {
121     notImplemented();
122 }
123 
124 }
125 #endif
    </pre>
  </body>
</html>