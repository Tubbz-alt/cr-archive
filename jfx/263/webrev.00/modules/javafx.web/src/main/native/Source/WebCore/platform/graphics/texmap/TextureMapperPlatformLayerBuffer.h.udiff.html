<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/texmap/TextureMapperPlatformLayerBuffer.h</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="TextureMapperPlatformLayerBuffer.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="TextureMapperPlatformLayerProxy.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/texmap/TextureMapperPlatformLayerBuffer.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -29,21 +29,40 @@</span>
  
  #include &quot;BitmapTextureGL.h&quot;
  #include &quot;TextureMapperGLHeaders.h&quot;
  #include &quot;TextureMapperPlatformLayer.h&quot;
  #include &lt;wtf/MonotonicTime.h&gt;
<span class="udiff-line-added">+ #include &lt;wtf/Variant.h&gt;</span>
  
  namespace WebCore {
  
  class TextureMapperPlatformLayerBuffer : public TextureMapperPlatformLayer {
      WTF_MAKE_NONCOPYABLE(TextureMapperPlatformLayerBuffer);
      WTF_MAKE_FAST_ALLOCATED();
  public:
      TextureMapperPlatformLayerBuffer(RefPtr&lt;BitmapTexture&gt;&amp;&amp;, TextureMapperGL::Flags = 0);
<span class="udiff-line-added">+ </span>
      TextureMapperPlatformLayerBuffer(GLuint textureID, const IntSize&amp;, TextureMapperGL::Flags, GLint internalFormat);
  
<span class="udiff-line-modified-removed">-     virtual ~TextureMapperPlatformLayerBuffer() = default;</span>
<span class="udiff-line-modified-added">+     struct RGBTexture {</span>
<span class="udiff-line-added">+         GLuint id;</span>
<span class="udiff-line-added">+     };</span>
<span class="udiff-line-added">+     struct YUVTexture {</span>
<span class="udiff-line-added">+         unsigned numberOfPlanes;</span>
<span class="udiff-line-added">+         std::array&lt;GLuint, 3&gt; planes;</span>
<span class="udiff-line-added">+         std::array&lt;unsigned, 3&gt; yuvPlane;</span>
<span class="udiff-line-added">+         std::array&lt;unsigned, 3&gt; yuvPlaneOffset;</span>
<span class="udiff-line-added">+         std::array&lt;GLfloat, 9&gt; yuvToRgbMatrix;</span>
<span class="udiff-line-added">+     };</span>
<span class="udiff-line-added">+     struct ExternalOESTexture {</span>
<span class="udiff-line-added">+         GLuint id;</span>
<span class="udiff-line-added">+     };</span>
<span class="udiff-line-added">+     using TextureVariant = WTF::Variant&lt;RGBTexture, YUVTexture, ExternalOESTexture&gt;;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     TextureMapperPlatformLayerBuffer(TextureVariant&amp;&amp;, const IntSize&amp;, TextureMapperGL::Flags, GLint internalFormat);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     virtual ~TextureMapperPlatformLayerBuffer();</span>
  
      void paintToTextureMapper(TextureMapper&amp;, const FloatRect&amp;, const TransformationMatrix&amp; modelViewMatrix = TransformationMatrix(), float opacity = 1.0) final;
  
      bool canReuseWithoutReset(const IntSize&amp;, GLint internalFormat);
      BitmapTextureGL&amp; textureGL() { return static_cast&lt;BitmapTextureGL&amp;&gt;(*m_texture); }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -55,10 +74,14 @@</span>
          WTF_MAKE_NONCOPYABLE(UnmanagedBufferDataHolder);
          WTF_MAKE_FAST_ALLOCATED();
      public:
          UnmanagedBufferDataHolder() = default;
          virtual ~UnmanagedBufferDataHolder() = default;
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #if USE(GSTREAMER_GL)</span>
<span class="udiff-line-added">+         virtual void waitForCPUSync() = 0;</span>
<span class="udiff-line-added">+ #endif // USE(GSTREAMER_GL)</span>
      };
  
      bool hasManagedTexture() const { return m_hasManagedTexture; }
      void setUnmanagedBufferDataHolder(std::unique_ptr&lt;UnmanagedBufferDataHolder&gt; holder) { m_unmanagedBufferDataHolder = WTFMove(holder); }
      void setExtraFlags(TextureMapperGL::Flags flags) { m_extraFlags = flags; }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -72,16 +95,18 @@</span>
          virtual void setVideoRectangle(const IntRect&amp;) = 0;
      };
  
      void setHolePunchClient(std::unique_ptr&lt;HolePunchClient&gt;&amp;&amp; client) { m_holePunchClient = WTFMove(client); }
  
<span class="udiff-line-added">+     const TextureVariant&amp; textureVariant() { return m_variant; }</span>
<span class="udiff-line-added">+ </span>
  private:
  
      RefPtr&lt;BitmapTexture&gt; m_texture;
      MonotonicTime m_timeLastUsed;
  
<span class="udiff-line-modified-removed">-     GLuint m_textureID;</span>
<span class="udiff-line-modified-added">+     TextureVariant m_variant;</span>
      IntSize m_size;
      GLint m_internalFormat;
      TextureMapperGL::Flags m_extraFlags;
      bool m_hasManagedTexture;
      std::unique_ptr&lt;UnmanagedBufferDataHolder&gt; m_unmanagedBufferDataHolder;
</pre>
<center><a href="TextureMapperPlatformLayerBuffer.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="TextureMapperPlatformLayerProxy.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>