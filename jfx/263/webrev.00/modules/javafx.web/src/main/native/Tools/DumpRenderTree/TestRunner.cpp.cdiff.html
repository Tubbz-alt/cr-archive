<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Tools/DumpRenderTree/TestRunner.cpp</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="TestOptions.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="TestRunner.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Tools/DumpRenderTree/TestRunner.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 37,10 ***</span>
<span class="line-new-header">--- 37,11 ---</span>
  #include &lt;JavaScriptCore/ArrayBufferView.h&gt;
  #include &lt;JavaScriptCore/HeapInlines.h&gt;
  #include &lt;JavaScriptCore/JSArrayBufferView.h&gt;
  #include &lt;JavaScriptCore/JSCTestRunnerUtils.h&gt;
  #include &lt;JavaScriptCore/JSContextRef.h&gt;
<span class="line-added">+ #include &lt;JavaScriptCore/JSGlobalObjectInlines.h&gt;</span>
  #include &lt;JavaScriptCore/JSObjectRef.h&gt;
  #include &lt;JavaScriptCore/JSRetainPtr.h&gt;
  #include &lt;JavaScriptCore/TypedArrayInlines.h&gt;
  #include &lt;JavaScriptCore/VMInlines.h&gt;
  #include &lt;WebCore/LogInitialization.h&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 583,10 ***</span>
<span class="line-new-header">--- 584,13 ---</span>
      auto key = adopt(JSValueToStringCopy(context, arguments[0], exception));
      ASSERT(!*exception);
      auto value = adopt(JSValueToStringCopy(context, arguments[1], exception));
      ASSERT(!*exception);
  
<span class="line-added">+     // Should use `&lt;!-- webkit-test-runner [ enableBackForwardCache=true ] --&gt;` instead.</span>
<span class="line-added">+     RELEASE_ASSERT(!JSStringIsEqualToUTF8CString(key.get(), &quot;WebKitUsesBackForwardCachePreferenceKey&quot;));</span>
<span class="line-added">+ </span>
      TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
      controller-&gt;overridePreference(key.get(), value.get());
  
      return JSValueMakeUndefined(context);
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1128,10 ***</span>
<span class="line-new-header">--- 1132,34 ---</span>
      controller-&gt;setPrivateBrowsingEnabled(JSValueToBoolean(context, arguments[0]));
  
      return JSValueMakeUndefined(context);
  }
  
<span class="line-added">+ static JSValueRef setShouldSwapToEphemeralSessionOnNextNavigationCallback(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     // Has mac &amp; windows implementation</span>
<span class="line-added">+     if (argumentCount &lt; 1)</span>
<span class="line-added">+         return JSValueMakeUndefined(context);</span>
<span class="line-added">+ </span>
<span class="line-added">+     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));</span>
<span class="line-added">+     controller-&gt;setShouldSwapToEphemeralSessionOnNextNavigation(JSValueToBoolean(context, arguments[0]));</span>
<span class="line-added">+ </span>
<span class="line-added">+     return JSValueMakeUndefined(context);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ static JSValueRef setShouldSwapToDefaultSessionOnNextNavigationCallback(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     // Has mac &amp; windows implementation</span>
<span class="line-added">+     if (argumentCount &lt; 1)</span>
<span class="line-added">+         return JSValueMakeUndefined(context);</span>
<span class="line-added">+ </span>
<span class="line-added">+     TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));</span>
<span class="line-added">+     controller-&gt;setShouldSwapToDefaultSessionOnNextNavigation(JSValueToBoolean(context, arguments[0]));</span>
<span class="line-added">+ </span>
<span class="line-added">+     return JSValueMakeUndefined(context);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  static JSValueRef setJavaScriptCanAccessClipboardCallback(JSContextRef context, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
  {
      // Has mac &amp; windows implementation
      if (argumentCount &lt; 1)
          return JSValueMakeUndefined(context);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2006,16 ***</span>
  
      auto channel = adopt(JSValueToStringCopy(context, arguments[0], exception));
      ASSERT(!*exception);
  
      TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
<span class="line-removed">- #if OS(WINDOWS) &amp;&amp; PLATFORM(JAVA)</span>
<span class="line-removed">-     // FIXME : error LNK2019: unresolved external symbol</span>
<span class="line-removed">-     // controller-&gt;setAccummulateLogsForChannel(channel.get());</span>
<span class="line-removed">- #else</span>
      controller-&gt;setAccummulateLogsForChannel(channel.get());
<span class="line-modified">! #endif</span>
      return JSValueMakeUndefined(context);
  }
  
  static JSValueRef runUIScriptCallback(JSContextRef context, JSObjectRef, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
  {
<span class="line-new-header">--- 2034,12 ---</span>
  
      auto channel = adopt(JSValueToStringCopy(context, arguments[0], exception));
      ASSERT(!*exception);
  
      TestRunner* controller = static_cast&lt;TestRunner*&gt;(JSObjectGetPrivate(thisObject));
      controller-&gt;setAccummulateLogsForChannel(channel.get());
<span class="line-modified">! </span>
      return JSValueMakeUndefined(context);
  }
  
  static JSValueRef runUIScriptCallback(JSContextRef context, JSObjectRef, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
  {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2223,11 ***</span>
          { &quot;setPOSIXLocale&quot;, setPOSIXLocaleCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
          { &quot;setPersistentUserStyleSheetLocation&quot;, setPersistentUserStyleSheetLocationCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
          { &quot;setPopupBlockingEnabled&quot;, setPopupBlockingEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
          { &quot;setPluginsEnabled&quot;, setPluginsEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
          { &quot;setPrinting&quot;, setPrintingCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
<span class="line-modified">!         { &quot;setPrivateBrowsingEnabled&quot;, setPrivateBrowsingEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },</span>
          { &quot;setSerializeHTTPLoads&quot;, setSerializeHTTPLoadsCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
          { &quot;setSpatialNavigationEnabled&quot;, setSpatialNavigationEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
          { &quot;setStopProvisionalFrameLoads&quot;, setStopProvisionalFrameLoadsCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
          { &quot;setTabKeyCyclesThroughElements&quot;, setTabKeyCyclesThroughElementsCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
  #if PLATFORM(IOS_FAMILY)
<span class="line-new-header">--- 2247,13 ---</span>
          { &quot;setPOSIXLocale&quot;, setPOSIXLocaleCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
          { &quot;setPersistentUserStyleSheetLocation&quot;, setPersistentUserStyleSheetLocationCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
          { &quot;setPopupBlockingEnabled&quot;, setPopupBlockingEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
          { &quot;setPluginsEnabled&quot;, setPluginsEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
          { &quot;setPrinting&quot;, setPrintingCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
<span class="line-modified">!         { &quot;setPrivateBrowsingEnabled_DEPRECATED&quot;, setPrivateBrowsingEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },</span>
<span class="line-added">+         { &quot;setShouldSwapToEphemeralSessionOnNextNavigation&quot;, setShouldSwapToEphemeralSessionOnNextNavigationCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },</span>
<span class="line-added">+         { &quot;setShouldSwapToDefaultSessionOnNextNavigation&quot;, setShouldSwapToDefaultSessionOnNextNavigationCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },</span>
          { &quot;setSerializeHTTPLoads&quot;, setSerializeHTTPLoadsCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
          { &quot;setSpatialNavigationEnabled&quot;, setSpatialNavigationEnabledCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
          { &quot;setStopProvisionalFrameLoads&quot;, setStopProvisionalFrameLoadsCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
          { &quot;setTabKeyCyclesThroughElements&quot;, setTabKeyCyclesThroughElementsCallback, kJSPropertyAttributeReadOnly | kJSPropertyAttributeDontDelete },
  #if PLATFORM(IOS_FAMILY)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2387,16 ***</span>
  {
      size_t maxLength = JSStringGetMaximumUTF8CStringSize(channel);
      auto buffer = makeUniqueArray&lt;char&gt;(maxLength + 1);
      JSStringGetUTF8CString(channel, buffer.get(), maxLength + 1);
  
<span class="line-removed">- #if OS(WINDOWS) &amp;&amp; PLATFORM(JAVA)</span>
<span class="line-removed">-     // FIXME : error LNK2019: unresolved external symbol</span>
<span class="line-removed">-     // WebCoreTestSupport::setLogChannelToAccumulate({ buffer.get() });</span>
<span class="line-removed">- #else</span>
      WebCoreTestSupport::setLogChannelToAccumulate({ buffer.get() });
<span class="line-removed">- #endif</span>
  }
  
  typedef WTF::HashMap&lt;unsigned, JSValueRef&gt; CallbackMap;
  static CallbackMap&amp; callbackMap()
  {
<span class="line-new-header">--- 2413,11 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2493,16 ***</span>
      callUIScriptCallback(callbackID, stringRef.get());
  }
  
  void TestRunner::setAllowsAnySSLCertificate(bool allowsAnySSLCertificate)
  {
<span class="line-removed">- #if OS(WINDOWS) &amp;&amp; PLATFORM(JAVA)</span>
<span class="line-removed">-     // FIXME : error LNK2019: unresolved external symbol</span>
<span class="line-removed">-     // WebCoreTestSupport::setAllowsAnySSLCertificate(allowsAnySSLCertificate);</span>
<span class="line-removed">- #else</span>
      WebCoreTestSupport::setAllowsAnySSLCertificate(allowsAnySSLCertificate);
<span class="line-removed">- #endif</span>
  }
  
  void TestRunner::setOpenPanelFiles(JSContextRef context, JSValueRef filesValue)
  {
      if (!JSValueIsArray(context, filesValue))
<span class="line-new-header">--- 2514,11 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2549,5 ***</span>
<span class="line-new-header">--- 2565,15 ---</span>
  
  void TestRunner::cleanup()
  {
      clearTestRunnerCallbacks();
  }
<span class="line-added">+ </span>
<span class="line-added">+ void TestRunner::willNavigate()</span>
<span class="line-added">+ {</span>
<span class="line-added">+     if (m_shouldSwapToEphemeralSessionOnNextNavigation || m_shouldSwapToDefaultSessionOnNextNavigation) {</span>
<span class="line-added">+         ASSERT(m_shouldSwapToEphemeralSessionOnNextNavigation != m_shouldSwapToDefaultSessionOnNextNavigation);</span>
<span class="line-added">+         setPrivateBrowsingEnabled(m_shouldSwapToEphemeralSessionOnNextNavigation);</span>
<span class="line-added">+         m_shouldSwapToEphemeralSessionOnNextNavigation = false;</span>
<span class="line-added">+         m_shouldSwapToDefaultSessionOnNextNavigation = false;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ }</span>
</pre>
<center><a href="TestOptions.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="TestRunner.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>