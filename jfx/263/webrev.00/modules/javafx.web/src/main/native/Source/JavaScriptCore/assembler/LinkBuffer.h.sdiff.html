<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/assembler/LinkBuffer.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="LinkBuffer.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MIPSAssembler.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/assembler/LinkBuffer.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 26 #pragma once
 27 
 28 #if ENABLE(ASSEMBLER)
 29 
 30 #define DUMP_LINK_STATISTICS 0
 31 #define DUMP_CODE 0
 32 
 33 #define GLOBAL_THUNK_ID reinterpret_cast&lt;void*&gt;(static_cast&lt;intptr_t&gt;(-1))
 34 #define REGEXP_CODE_ID reinterpret_cast&lt;void*&gt;(static_cast&lt;intptr_t&gt;(-2))
 35 #define CSS_CODE_ID reinterpret_cast&lt;void*&gt;(static_cast&lt;intptr_t&gt;(-3))
 36 
 37 #include &quot;JITCompilationEffort.h&quot;
 38 #include &quot;MacroAssembler.h&quot;
 39 #include &quot;MacroAssemblerCodeRef.h&quot;
 40 #include &lt;wtf/DataLog.h&gt;
 41 #include &lt;wtf/FastMalloc.h&gt;
 42 #include &lt;wtf/Noncopyable.h&gt;
 43 
 44 namespace JSC {
 45 




 46 class CodeBlock;
 47 
 48 // LinkBuffer:
 49 //
 50 // This class assists in linking code generated by the macro assembler, once code generation
 51 // has been completed, and the code has been copied to is final location in memory.  At this
 52 // time pointers to labels within the code may be resolved, and relative offsets to external
 53 // addresses may be fixed.
 54 //
 55 // Specifically:
 56 //   * Jump objects may be linked to external targets,
 57 //   * The address of Jump objects may taken, such that it can later be relinked.
 58 //   * The return address of a Call may be acquired.
 59 //   * The address of a Label pointing into the code may be resolved.
 60 //   * The value referenced by a DataLabel may be set.
 61 //
 62 class LinkBuffer {
 63     WTF_MAKE_NONCOPYABLE(LinkBuffer); WTF_MAKE_FAST_ALLOCATED;
 64 
 65     template&lt;PtrTag tag&gt; using CodePtr = MacroAssemblerCodePtr&lt;tag&gt;;
</pre>
<hr />
<pre>
377 //
378 // Generated JIT code for my super thingy number 42:
379 //     Code at [0x123456, 0x234567]:
380 //         0x123456: mov $0, 0
381 //         0x12345a: ret
382 //
383 // ... and so on.
384 //
385 // Note that the format string and print arguments are only evaluated when dumpDisassembly
386 // is true, so you can hide expensive disassembly-only computations inside there.
387 
388 #define FINALIZE_CODE(linkBufferReference, resultPtrTag, ...)  \
389     FINALIZE_CODE_IF((JSC::Options::asyncDisassembly() || JSC::Options::dumpDisassembly()), linkBufferReference, resultPtrTag, __VA_ARGS__)
390 
391 #define FINALIZE_DFG_CODE(linkBufferReference, resultPtrTag, ...)  \
392     FINALIZE_CODE_IF((JSC::Options::asyncDisassembly() || JSC::Options::dumpDisassembly() || Options::dumpDFGDisassembly()), linkBufferReference, resultPtrTag, __VA_ARGS__)
393 
394 #define FINALIZE_REGEXP_CODE(linkBufferReference, resultPtrTag, dataLogFArgumentsForHeading)  \
395     FINALIZE_CODE_IF(JSC::Options::asyncDisassembly() || JSC::Options::dumpDisassembly() || Options::dumpRegExpDisassembly(), linkBufferReference, resultPtrTag, dataLogFArgumentsForHeading)
396 










397 } // namespace JSC
398 
399 #endif // ENABLE(ASSEMBLER)
</pre>
</td>
<td>
<hr />
<pre>
 26 #pragma once
 27 
 28 #if ENABLE(ASSEMBLER)
 29 
 30 #define DUMP_LINK_STATISTICS 0
 31 #define DUMP_CODE 0
 32 
 33 #define GLOBAL_THUNK_ID reinterpret_cast&lt;void*&gt;(static_cast&lt;intptr_t&gt;(-1))
 34 #define REGEXP_CODE_ID reinterpret_cast&lt;void*&gt;(static_cast&lt;intptr_t&gt;(-2))
 35 #define CSS_CODE_ID reinterpret_cast&lt;void*&gt;(static_cast&lt;intptr_t&gt;(-3))
 36 
 37 #include &quot;JITCompilationEffort.h&quot;
 38 #include &quot;MacroAssembler.h&quot;
 39 #include &quot;MacroAssemblerCodeRef.h&quot;
 40 #include &lt;wtf/DataLog.h&gt;
 41 #include &lt;wtf/FastMalloc.h&gt;
 42 #include &lt;wtf/Noncopyable.h&gt;
 43 
 44 namespace JSC {
 45 
<span class="line-added"> 46 namespace Wasm {</span>
<span class="line-added"> 47 enum class CompilationMode : uint8_t;</span>
<span class="line-added"> 48 }</span>
<span class="line-added"> 49 </span>
 50 class CodeBlock;
 51 
 52 // LinkBuffer:
 53 //
 54 // This class assists in linking code generated by the macro assembler, once code generation
 55 // has been completed, and the code has been copied to is final location in memory.  At this
 56 // time pointers to labels within the code may be resolved, and relative offsets to external
 57 // addresses may be fixed.
 58 //
 59 // Specifically:
 60 //   * Jump objects may be linked to external targets,
 61 //   * The address of Jump objects may taken, such that it can later be relinked.
 62 //   * The return address of a Call may be acquired.
 63 //   * The address of a Label pointing into the code may be resolved.
 64 //   * The value referenced by a DataLabel may be set.
 65 //
 66 class LinkBuffer {
 67     WTF_MAKE_NONCOPYABLE(LinkBuffer); WTF_MAKE_FAST_ALLOCATED;
 68 
 69     template&lt;PtrTag tag&gt; using CodePtr = MacroAssemblerCodePtr&lt;tag&gt;;
</pre>
<hr />
<pre>
381 //
382 // Generated JIT code for my super thingy number 42:
383 //     Code at [0x123456, 0x234567]:
384 //         0x123456: mov $0, 0
385 //         0x12345a: ret
386 //
387 // ... and so on.
388 //
389 // Note that the format string and print arguments are only evaluated when dumpDisassembly
390 // is true, so you can hide expensive disassembly-only computations inside there.
391 
392 #define FINALIZE_CODE(linkBufferReference, resultPtrTag, ...)  \
393     FINALIZE_CODE_IF((JSC::Options::asyncDisassembly() || JSC::Options::dumpDisassembly()), linkBufferReference, resultPtrTag, __VA_ARGS__)
394 
395 #define FINALIZE_DFG_CODE(linkBufferReference, resultPtrTag, ...)  \
396     FINALIZE_CODE_IF((JSC::Options::asyncDisassembly() || JSC::Options::dumpDisassembly() || Options::dumpDFGDisassembly()), linkBufferReference, resultPtrTag, __VA_ARGS__)
397 
398 #define FINALIZE_REGEXP_CODE(linkBufferReference, resultPtrTag, dataLogFArgumentsForHeading)  \
399     FINALIZE_CODE_IF(JSC::Options::asyncDisassembly() || JSC::Options::dumpDisassembly() || Options::dumpRegExpDisassembly(), linkBufferReference, resultPtrTag, dataLogFArgumentsForHeading)
400 
<span class="line-added">401 bool shouldDumpDisassemblyFor(Wasm::CompilationMode);</span>
<span class="line-added">402 </span>
<span class="line-added">403 #define FINALIZE_WASM_CODE(linkBufferReference, resultPtrTag, ...)  \</span>
<span class="line-added">404     FINALIZE_CODE_IF((JSC::Options::asyncDisassembly() || JSC::Options::dumpDisassembly() || Options::dumpWasmDisassembly()), linkBufferReference, resultPtrTag, __VA_ARGS__)</span>
<span class="line-added">405 </span>
<span class="line-added">406 #define FINALIZE_WASM_CODE_FOR_MODE(mode, linkBufferReference, resultPtrTag, ...)  \</span>
<span class="line-added">407     FINALIZE_CODE_IF(shouldDumpDisassemblyFor(mode), linkBufferReference, resultPtrTag, __VA_ARGS__)</span>
<span class="line-added">408 </span>
<span class="line-added">409 </span>
<span class="line-added">410 </span>
411 } // namespace JSC
412 
413 #endif // ENABLE(ASSEMBLER)
</pre>
</td>
</tr>
</table>
<center><a href="LinkBuffer.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MIPSAssembler.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>