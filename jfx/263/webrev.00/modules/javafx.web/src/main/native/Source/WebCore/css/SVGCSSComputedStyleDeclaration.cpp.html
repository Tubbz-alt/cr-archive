<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/css/SVGCSSComputedStyleDeclaration.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2     Copyright (C) 2007 Eric Seidel &lt;eric@webkit.org&gt;
  3     Copyright (C) 2007 Alexey Proskuryakov &lt;ap@webkit.org&gt;
  4     Copyright (C) 2019 Apple Inc. All rights reserved.
  5 
  6     This library is free software; you can redistribute it and/or
  7     modify it under the terms of the GNU Library General Public
  8     License as published by the Free Software Foundation; either
  9     version 2 of the License, or (at your option) any later version.
 10 
 11     This library is distributed in the hope that it will be useful,
 12     but WITHOUT ANY WARRANTY; without even the implied warranty of
 13     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 14     Library General Public License for more details.
 15 
 16     You should have received a copy of the GNU Library General Public License
 17     along with this library; see the file COPYING.LIB.  If not, write to
 18     the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 19     Boston, MA 02110-1301, USA.
 20  */
 21 
 22 #include &quot;config.h&quot;
 23 #include &quot;CSSComputedStyleDeclaration.h&quot;
 24 
 25 #include &quot;CSSPrimitiveValueMappings.h&quot;
 26 #include &quot;CSSPropertyNames.h&quot;
 27 #include &quot;CSSValueList.h&quot;
 28 #include &quot;Document.h&quot;
 29 #include &quot;Element.h&quot;
 30 #include &quot;RenderStyle.h&quot;
 31 
 32 namespace WebCore {
 33 
 34 static RefPtr&lt;CSSPrimitiveValue&gt; glyphOrientationToCSSPrimitiveValue(GlyphOrientation orientation)
 35 {
 36     switch (orientation) {
 37     case GlyphOrientation::Degrees0:
 38         return CSSPrimitiveValue::create(0.0f, CSSUnitType::CSS_DEG);
 39     case GlyphOrientation::Degrees90:
 40         return CSSPrimitiveValue::create(90.0f, CSSUnitType::CSS_DEG);
 41     case GlyphOrientation::Degrees180:
 42         return CSSPrimitiveValue::create(180.0f, CSSUnitType::CSS_DEG);
 43     case GlyphOrientation::Degrees270:
 44         return CSSPrimitiveValue::create(270.0f, CSSUnitType::CSS_DEG);
 45     case GlyphOrientation::Auto:
 46         return nullptr;
 47     }
 48 
 49     RELEASE_ASSERT_NOT_REACHED();
 50 }
 51 
 52 static Ref&lt;CSSValue&gt; strokeDashArrayToCSSValueList(const Vector&lt;SVGLengthValue&gt;&amp; dashes)
 53 {
 54     if (dashes.isEmpty())
 55         return CSSPrimitiveValue::createIdentifier(CSSValueNone);
 56 
 57     auto list = CSSValueList::createCommaSeparated();
 58     for (auto&amp; length : dashes)
 59         list-&gt;append(SVGLengthValue::toCSSPrimitiveValue(length));
 60 
 61     return list;
 62 }
 63 
 64 Ref&lt;CSSValue&gt; ComputedStyleExtractor::adjustSVGPaintForCurrentColor(SVGPaintType paintType, const String&amp; url, const Color&amp; color, const Color&amp; currentColor) const
 65 {
 66     if (paintType &gt;= SVGPaintType::URINone) {
 67         auto values = CSSValueList::createSpaceSeparated();
 68         values-&gt;append(CSSPrimitiveValue::create(url, CSSUnitType::CSS_URI));
 69         if (paintType == SVGPaintType::URINone)
 70             values-&gt;append(CSSPrimitiveValue::createIdentifier(CSSValueNone));
 71         else if (paintType == SVGPaintType::URICurrentColor)
 72             values-&gt;append(CSSPrimitiveValue::create(currentColor));
 73         else if (paintType == SVGPaintType::URIRGBColor)
 74             values-&gt;append(CSSPrimitiveValue::create(color));
 75         return values;
 76     }
 77     if (paintType == SVGPaintType::None)
 78         return CSSPrimitiveValue::createIdentifier(CSSValueNone);
 79     if (paintType == SVGPaintType::CurrentColor)
 80         return CSSPrimitiveValue::create(currentColor);
 81 
 82     return CSSPrimitiveValue::create(color);
 83 }
 84 
 85 RefPtr&lt;CSSValue&gt; ComputedStyleExtractor::svgPropertyValue(CSSPropertyID propertyID)
 86 {
 87     if (!m_element)
 88         return nullptr;
 89 
 90     auto* style = m_element-&gt;computedStyle();
 91     if (!style)
 92         return nullptr;
 93 
 94     const SVGRenderStyle&amp; svgStyle = style-&gt;svgStyle();
 95 
 96     switch (propertyID) {
 97     case CSSPropertyClipRule:
 98         return CSSPrimitiveValue::create(svgStyle.clipRule());
 99     case CSSPropertyFloodOpacity:
100         return CSSPrimitiveValue::create(svgStyle.floodOpacity(), CSSUnitType::CSS_NUMBER);
101     case CSSPropertyStopOpacity:
102         return CSSPrimitiveValue::create(svgStyle.stopOpacity(), CSSUnitType::CSS_NUMBER);
103     case CSSPropertyColorInterpolation:
104         return CSSPrimitiveValue::create(svgStyle.colorInterpolation());
105     case CSSPropertyColorInterpolationFilters:
106         return CSSPrimitiveValue::create(svgStyle.colorInterpolationFilters());
107     case CSSPropertyFillOpacity:
108         return CSSPrimitiveValue::create(svgStyle.fillOpacity(), CSSUnitType::CSS_NUMBER);
109     case CSSPropertyFillRule:
110         return CSSPrimitiveValue::create(svgStyle.fillRule());
111     case CSSPropertyColorRendering:
112         return CSSPrimitiveValue::create(svgStyle.colorRendering());
113     case CSSPropertyShapeRendering:
114         return CSSPrimitiveValue::create(svgStyle.shapeRendering());
115     case CSSPropertyStrokeOpacity:
116         return CSSPrimitiveValue::create(svgStyle.strokeOpacity(), CSSUnitType::CSS_NUMBER);
117     case CSSPropertyAlignmentBaseline:
118         return CSSPrimitiveValue::create(svgStyle.alignmentBaseline());
119     case CSSPropertyDominantBaseline:
120         return CSSPrimitiveValue::create(svgStyle.dominantBaseline());
121     case CSSPropertyTextAnchor:
122         return CSSPrimitiveValue::create(svgStyle.textAnchor());
123     case CSSPropertyMask:
124         if (!svgStyle.maskerResource().isEmpty())
125             return CSSPrimitiveValue::create(svgStyle.maskerResource(), CSSUnitType::CSS_URI);
126         return CSSPrimitiveValue::createIdentifier(CSSValueNone);
127     case CSSPropertyFloodColor:
128         return currentColorOrValidColor(style, svgStyle.floodColor());
129     case CSSPropertyLightingColor:
130         return currentColorOrValidColor(style, svgStyle.lightingColor());
131     case CSSPropertyStopColor:
132         return currentColorOrValidColor(style, svgStyle.stopColor());
133     case CSSPropertyFill:
134         return adjustSVGPaintForCurrentColor(svgStyle.fillPaintType(), svgStyle.fillPaintUri(), svgStyle.fillPaintColor(), style-&gt;color());
135     case CSSPropertyKerning:
136         return SVGLengthValue::toCSSPrimitiveValue(svgStyle.kerning());
137     case CSSPropertyMarkerEnd:
138         if (!svgStyle.markerEndResource().isEmpty())
139             return CSSPrimitiveValue::create(svgStyle.markerEndResource(), CSSUnitType::CSS_URI);
140         return CSSPrimitiveValue::createIdentifier(CSSValueNone);
141     case CSSPropertyMarkerMid:
142         if (!svgStyle.markerMidResource().isEmpty())
143             return CSSPrimitiveValue::create(svgStyle.markerMidResource(), CSSUnitType::CSS_URI);
144         return CSSPrimitiveValue::createIdentifier(CSSValueNone);
145     case CSSPropertyMarkerStart:
146         if (!svgStyle.markerStartResource().isEmpty())
147             return CSSPrimitiveValue::create(svgStyle.markerStartResource(), CSSUnitType::CSS_URI);
148         return CSSPrimitiveValue::createIdentifier(CSSValueNone);
149     case CSSPropertyStroke:
150         return adjustSVGPaintForCurrentColor(svgStyle.strokePaintType(), svgStyle.strokePaintUri(), svgStyle.strokePaintColor(), style-&gt;color());
151     case CSSPropertyStrokeDasharray:
152         return strokeDashArrayToCSSValueList(svgStyle.strokeDashArray());
153     case CSSPropertyBaselineShift: {
154         switch (svgStyle.baselineShift()) {
155         case BaselineShift::Baseline:
156             return CSSPrimitiveValue::createIdentifier(CSSValueBaseline);
157         case BaselineShift::Super:
158             return CSSPrimitiveValue::createIdentifier(CSSValueSuper);
159         case BaselineShift::Sub:
160             return CSSPrimitiveValue::createIdentifier(CSSValueSub);
161         case BaselineShift::Length:
162             return SVGLengthValue::toCSSPrimitiveValue(svgStyle.baselineShiftValue());
163         }
164         ASSERT_NOT_REACHED();
165         return nullptr;
166     }
167     case CSSPropertyBufferedRendering:
168         return CSSPrimitiveValue::create(svgStyle.bufferedRendering());
169     case CSSPropertyGlyphOrientationHorizontal:
170         return glyphOrientationToCSSPrimitiveValue(svgStyle.glyphOrientationHorizontal());
171     case CSSPropertyGlyphOrientationVertical: {
172         if (RefPtr&lt;CSSPrimitiveValue&gt; value = glyphOrientationToCSSPrimitiveValue(svgStyle.glyphOrientationVertical()))
173             return value;
174 
175         if (svgStyle.glyphOrientationVertical() == GlyphOrientation::Auto)
176             return CSSPrimitiveValue::createIdentifier(CSSValueAuto);
177 
178         return nullptr;
179     }
180     case CSSPropertyVectorEffect:
181         return CSSPrimitiveValue::create(svgStyle.vectorEffect());
182     case CSSPropertyMaskType:
183         return CSSPrimitiveValue::create(svgStyle.maskType());
184     case CSSPropertyMarker:
185     case CSSPropertyEnableBackground:
186     case CSSPropertyColorProfile:
187         // the above properties are not yet implemented in the engine
188         break;
189     default:
190         // If you crash here, it&#39;s because you added a css property and are not handling it
191         // in either this switch statement or the one in CSSComputedStyleDelcaration::getPropertyCSSValue
192         ASSERT_WITH_MESSAGE(0, &quot;unimplemented propertyID: %d&quot;, propertyID);
193     }
194     return nullptr;
195 }
196 
197 }
    </pre>
  </body>
</html>