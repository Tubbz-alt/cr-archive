<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/JavaScriptCore/builtins/StringPrototype.js</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2015 Andy VanWagoner &lt;andy@vanwagoner.family&gt;.
  3  * Copyright (C) 2016 Yusuke Suzuki &lt;utatane.tea@gmail.com&gt;
  4  * Copyright (C) 2016-2018 Apple Inc. All rights reserved.
  5  *
  6  * Redistribution and use in source and binary forms, with or without
  7  * modification, are permitted provided that the following conditions
  8  * are met:
  9  * 1. Redistributions of source code must retain the above copyright
 10  *    notice, this list of conditions and the following disclaimer.
 11  * 2. Redistributions in binary form must reproduce the above copyright
 12  *    notice, this list of conditions and the following disclaimer in the
 13  *    documentation and/or other materials provided with the distribution.
 14  *
 15  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 16  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 17  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 18  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 19  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 20  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 21  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 22  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 23  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 24  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 25  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 26  */
 27 
 28 function match(regexp)
 29 {
 30     &quot;use strict&quot;;
 31 
 32     if (@isUndefinedOrNull(this))
 33         @throwTypeError(&quot;String.prototype.match requires that |this| not be null or undefined&quot;);
 34 
 35     if (regexp != null) {
 36         var matcher = regexp.@matchSymbol;
 37         if (matcher != @undefined)
 38             return matcher.@call(regexp, this);
 39     }
 40 
 41     var thisString = @toString(this);
 42     var createdRegExp = @regExpCreate(regexp, @undefined);
 43     return createdRegExp.@matchSymbol(thisString);
 44 }
 45 
 46 function matchAll(arg)
 47 {
 48     &quot;use strict&quot;;
 49 
 50     if (@isUndefinedOrNull(this))
 51         @throwTypeError(&quot;String.prototype.matchAll requires |this| not to be null nor undefined&quot;);
 52 
 53     if (!@isUndefinedOrNull(arg)) {
 54         if (@isRegExp(arg) &amp;&amp; !@stringIncludesInternal.@call(@toString(arg.flags), &quot;g&quot;))
 55             @throwTypeError(&quot;String.prototype.matchAll argument must not be a non-global regular expression&quot;);
 56 
 57         var matcher = arg.@matchAllSymbol;
 58         if (!@isUndefinedOrNull(matcher))
 59             return matcher.@call(arg, this);
 60     }
 61 
 62     var string = @toString(this);
 63     var regExp = @regExpCreate(arg, &quot;g&quot;);
 64     return regExp.@matchAllSymbol(string);
 65 }
 66 
 67 @globalPrivate
 68 function repeatSlowPath(string, count)
 69 {
 70     &quot;use strict&quot;;
 71 
 72     // Return an empty string.
 73     if (count === 0 || string.length === 0)
 74         return &quot;&quot;;
 75 
 76     // Return the original string.
 77     if (count === 1)
 78         return string;
 79 
 80     if (string.length * count &gt; @MAX_STRING_LENGTH)
 81         @throwOutOfMemoryError();
 82 
 83     // Bit operation onto |count| is safe because |count| should be within Int32 range,
 84     // Repeat log N times to generate the repeated string rope.
 85     var result = &quot;&quot;;
 86     var operand = string;
 87     while (true) {
 88         if (count &amp; 1)
 89             result += operand;
 90         count &gt;&gt;= 1;
 91         if (!count)
 92             return result;
 93         operand += operand;
 94     }
 95 }
 96 
 97 @globalPrivate
 98 function repeatCharactersSlowPath(string, count)
 99 {
100     &quot;use strict&quot;;
101     var repeatCount = (count / string.length) | 0;
102     var remainingCharacters = count - repeatCount * string.length;
103     var result = &quot;&quot;;
104     var operand = string;
105     // Bit operation onto |repeatCount| is safe because |repeatCount| should be within Int32 range,
106     // Repeat log N times to generate the repeated string rope.
107     while (true) {
108         if (repeatCount &amp; 1)
109             result += operand;
110         repeatCount &gt;&gt;= 1;
111         if (!repeatCount)
112             break;
113         operand += operand;
114     }
115     if (remainingCharacters)
116         result += @stringSubstrInternal.@call(string, 0, remainingCharacters);
117     return result;
118 }
119 
120 
121 function repeat(count)
122 {
123     &quot;use strict&quot;;
124 
125     if (@isUndefinedOrNull(this))
126         @throwTypeError(&quot;String.prototype.repeat requires that |this| not be null or undefined&quot;);
127 
128     var string = @toString(this);
129     count = @toInteger(count);
130 
131     if (count &lt; 0 || count === @Infinity)
132         @throwRangeError(&quot;String.prototype.repeat argument must be greater than or equal to 0 and not be Infinity&quot;);
133 
134     if (string.length === 1)
135         return @repeatCharacter(string, count);
136 
137     return @repeatSlowPath(string, count);
138 }
139 
140 function padStart(maxLength/*, fillString*/)
141 {
142     &quot;use strict&quot;;
143 
144     if (@isUndefinedOrNull(this))
145         @throwTypeError(&quot;String.prototype.padStart requires that |this| not be null or undefined&quot;);
146 
147     var string = @toString(this);
148     maxLength = @toLength(maxLength);
149 
150     var stringLength = string.length;
151     if (maxLength &lt;= stringLength)
152         return string;
153 
154     var filler;
155     var fillString = @argument(1);
156     if (fillString === @undefined)
157         filler = &quot; &quot;;
158     else {
159         filler = @toString(fillString);
160         if (filler === &quot;&quot;)
161             return string;
162     }
163 
164     if (maxLength &gt; @MAX_STRING_LENGTH)
165         @throwOutOfMemoryError();
166 
167     var fillLength = maxLength - stringLength;
168     var truncatedStringFiller;
169 
170     if (filler.length === 1)
171         truncatedStringFiller = @repeatCharacter(filler, fillLength);
172     else
173         truncatedStringFiller = @repeatCharactersSlowPath(filler, fillLength);
174     return truncatedStringFiller + string;
175 }
176 
177 function padEnd(maxLength/*, fillString*/)
178 {
179     &quot;use strict&quot;;
180 
181     if (@isUndefinedOrNull(this))
182         @throwTypeError(&quot;String.prototype.padEnd requires that |this| not be null or undefined&quot;);
183 
184     var string = @toString(this);
185     maxLength = @toLength(maxLength);
186 
187     var stringLength = string.length;
188     if (maxLength &lt;= stringLength)
189         return string;
190 
191     var filler;
192     var fillString = @argument(1);
193     if (fillString === @undefined)
194         filler = &quot; &quot;;
195     else {
196         filler = @toString(fillString);
197         if (filler === &quot;&quot;)
198             return string;
199     }
200 
201     if (maxLength &gt; @MAX_STRING_LENGTH)
202         @throwOutOfMemoryError();
203 
204     var fillLength = maxLength - stringLength;
205     var truncatedStringFiller;
206 
207     if (filler.length === 1)
208         truncatedStringFiller = @repeatCharacter(filler, fillLength);
209     else
210         truncatedStringFiller = @repeatCharactersSlowPath(filler, fillLength);
211     return string + truncatedStringFiller;
212 }
213 
214 @globalPrivate
215 function hasObservableSideEffectsForStringReplace(regexp, replacer)
216 {
217     &quot;use strict&quot;;
218 
219     if (!@isRegExpObject(regexp))
220         return true;
221 
222     if (replacer !== @regExpPrototypeSymbolReplace)
223         return true;
224     
225     var regexpExec = @tryGetById(regexp, &quot;exec&quot;);
226     if (regexpExec !== @regExpBuiltinExec)
227         return true;
228 
229     var regexpGlobal = @tryGetById(regexp, &quot;global&quot;);
230     if (regexpGlobal !== @regExpProtoGlobalGetter)
231         return true;
232 
233     var regexpUnicode = @tryGetById(regexp, &quot;unicode&quot;);
234     if (regexpUnicode !== @regExpProtoUnicodeGetter)
235         return true;
236 
237     return typeof regexp.lastIndex !== &quot;number&quot;;
238 }
239 
240 @intrinsic=StringPrototypeReplaceIntrinsic
241 function replace(search, replace)
242 {
243     &quot;use strict&quot;;
244 
245     if (@isUndefinedOrNull(this))
246         @throwTypeError(&quot;String.prototype.replace requires that |this| not be null or undefined&quot;);
247 
248     if (search != null) {
249         var replacer = search.@replaceSymbol;
250         if (replacer !== @undefined) {
251             if (!@hasObservableSideEffectsForStringReplace(search, replacer))
252                 return @toString(this).@replaceUsingRegExp(search, replace);
253             return replacer.@call(search, this, replace);
254         }
255     }
256 
257     var thisString = @toString(this);
258     var searchString = @toString(search);
259     return thisString.@replaceUsingStringSearch(searchString, replace);
260 }
261 
262 function replaceAll(search, replace)
263 {
264     &quot;use strict&quot;;
265 
266     if (@isUndefinedOrNull(this))
267         @throwTypeError(&quot;String.prototype.replaceAll requires |this| not to be null nor undefined&quot;);
268 
269     if (search != null) {
270         if (@isRegExp(search) &amp;&amp; !@stringIncludesInternal.@call(@toString(search.flags), &quot;g&quot;))
271             @throwTypeError(&quot;String.prototype.replaceAll argument must not be a non-global regular expression&quot;);
272 
273         var replacer = search.@replaceSymbol;
274         if (replacer !== @undefined) {
275             if (!@hasObservableSideEffectsForStringReplace(search, replacer))
276                 return @toString(this).@replaceUsingRegExp(search, replace);
277             return replacer.@call(search, this, replace);
278         }
279     }
280 
281     var thisString = @toString(this);
282     var searchString = @toString(search);
283     return thisString.@replaceAllUsingStringSearch(searchString, replace);
284 }
285 
286 function search(regexp)
287 {
288     &quot;use strict&quot;;
289 
290     if (@isUndefinedOrNull(this))
291         @throwTypeError(&quot;String.prototype.search requires that |this| not be null or undefined&quot;);
292 
293     if (regexp != null) {
294         var searcher = regexp.@searchSymbol;
295         if (searcher != @undefined)
296             return searcher.@call(regexp, this);
297     }
298 
299     var thisString = @toString(this);
300     var createdRegExp = @regExpCreate(regexp, @undefined);
301     return createdRegExp.@searchSymbol(thisString);
302 }
303 
304 function split(separator, limit)
305 {
306     &quot;use strict&quot;;
307     
308     if (@isUndefinedOrNull(this))
309         @throwTypeError(&quot;String.prototype.split requires that |this| not be null or undefined&quot;);
310     
311     if (separator != null) {
312         var splitter = separator.@splitSymbol;
313         if (splitter != @undefined)
314             return splitter.@call(separator, this, limit);
315     }
316     
317     return @stringSplitFast.@call(this, separator, limit);
318 }
319 
320 @globalPrivate
321 function stringConcatSlowPath()
322 {
323     &quot;use strict&quot;;
324 
325     var result = @toString(this);
326     for (var i = 0, length = arguments.length; i &lt; length; ++i)
327         result += @toString(arguments[i]);
328     return result;
329 }
330 
331 function concat(arg /* ... */)
332 {
333     &quot;use strict&quot;;
334 
335     if (@isUndefinedOrNull(this))
336         @throwTypeError(&quot;String.prototype.concat requires that |this| not be null or undefined&quot;);
337 
338     if (@argumentCount() === 1)
339         return @toString(this) + @toString(arg);
340     return @tailCallForwardArguments(@stringConcatSlowPath, this);
341 }
342 
343 @globalPrivate
344 function createHTML(func, string, tag, attribute, value)
345 {
346     &quot;use strict&quot;;
347     if (@isUndefinedOrNull(string))
348         @throwTypeError(`${func} requires that |this| not be null or undefined`);
349     var S = @toString(string);
350     var p1 = &quot;&lt;&quot; + tag;
351     if (attribute) {
352         var V = @toString(value);
353         var escapedV = V.@replaceUsingRegExp(/&quot;/g, &#39;&amp;quot;&#39;);
354         p1 = p1 + &quot; &quot; + @toString(attribute) + &#39;=&quot;&#39; + escapedV + &#39;&quot;&#39;
355     }
356     var p2 = p1 + &quot;&gt;&quot;
357     var p3 = p2 + S;
358     var p4 = p3 + &quot;&lt;/&quot; + tag + &quot;&gt;&quot;;
359     return p4;
360 }
361 
362 function anchor(url)
363 {
364     &quot;use strict&quot;;
365     return @createHTML(&quot;String.prototype.link&quot;, this, &quot;a&quot;, &quot;name&quot;, url)
366 }
367 
368 function big()
369 {
370     &quot;use strict&quot;;
371     return @createHTML(&quot;String.prototype.big&quot;, this, &quot;big&quot;, &quot;&quot;, &quot;&quot;);
372 }
373 
374 function blink()
375 {
376     &quot;use strict&quot;;
377     return @createHTML(&quot;String.prototype.blink&quot;, this, &quot;blink&quot;, &quot;&quot;, &quot;&quot;);
378 }
379 
380 function bold()
381 {
382     &quot;use strict&quot;;
383     return @createHTML(&quot;String.prototype.bold&quot;, this, &quot;b&quot;, &quot;&quot;, &quot;&quot;);
384 }
385 
386 function fixed()
387 {
388     &quot;use strict&quot;;
389     return @createHTML(&quot;String.prototype.fixed&quot;, this, &quot;tt&quot;, &quot;&quot;, &quot;&quot;);
390 }
391 
392 function fontcolor(color)
393 {
394     &quot;use strict&quot;;
395     return @createHTML(&quot;String.prototype.fontcolor&quot;, this, &quot;font&quot;, &quot;color&quot;, color);
396 }
397 
398 function fontsize(size)
399 {
400     &quot;use strict&quot;;
401     return @createHTML(&quot;String.prototype.fontsize&quot;, this, &quot;font&quot;, &quot;size&quot;, size);
402 }
403 
404 function italics()
405 {
406     &quot;use strict&quot;;
407     return @createHTML(&quot;String.prototype.italics&quot;, this, &quot;i&quot;, &quot;&quot;, &quot;&quot;);
408 }
409 
410 function link(url)
411 {
412     &quot;use strict&quot;;
413     return @createHTML(&quot;String.prototype.link&quot;, this, &quot;a&quot;, &quot;href&quot;, url)
414 }
415 
416 function small()
417 {
418     &quot;use strict&quot;;
419     return @createHTML(&quot;String.prototype.small&quot;, this, &quot;small&quot;, &quot;&quot;, &quot;&quot;);
420 }
421 
422 function strike()
423 {
424     &quot;use strict&quot;;
425     return @createHTML(&quot;String.prototype.strike&quot;, this, &quot;strike&quot;, &quot;&quot;, &quot;&quot;);
426 }
427 
428 function sub()
429 {
430     &quot;use strict&quot;;
431     return @createHTML(&quot;String.prototype.sub&quot;, this, &quot;sub&quot;, &quot;&quot;, &quot;&quot;);
432 }
433 
434 function sup()
435 {
436     &quot;use strict&quot;;
437     return @createHTML(&quot;String.prototype.sup&quot;, this, &quot;sup&quot;, &quot;&quot;, &quot;&quot;);
438 }
    </pre>
  </body>
</html>