<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSDOMMapLike.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2017 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY CANON INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL CANON INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;JSDOMBinding.h&quot;
 29 #include &quot;JSDOMConvert.h&quot;
 30 #include &quot;JSDOMGuardedObject.h&quot;
 31 #include &lt;JavaScriptCore/BuiltinNames.h&gt;
 32 #include &lt;JavaScriptCore/CommonIdentifiers.h&gt;
 33 #include &lt;JavaScriptCore/JSMap.h&gt;
 34 
 35 namespace WebCore {
 36 
 37 JSC::JSMap&amp; createBackingMap(JSC::ExecState&amp;, JSC::JSGlobalObject&amp;, JSC::JSObject&amp;);
 38 void initializeBackingMap(JSC::VM&amp;, JSC::JSObject&amp;, JSC::JSMap&amp;);
 39 JSC::JSValue forwardAttributeGetterToBackingMap(JSC::ExecState&amp;, JSC::JSObject&amp;, const JSC::Identifier&amp;);
 40 JSC::JSValue forwardFunctionCallToBackingMap(JSC::ExecState&amp;, JSC::JSObject&amp;, const JSC::Identifier&amp;);
 41 JSC::JSValue forwardForEachCallToBackingMap(JSC::ExecState&amp;, JSDOMGlobalObject&amp;, JSC::JSObject&amp;);
 42 
 43 template&lt;typename WrapperClass&gt; void synchronizeBackingMap(JSC::ExecState&amp;, JSDOMGlobalObject&amp;, WrapperClass&amp;);
 44 template&lt;typename WrapperClass&gt; JSC::JSValue forwardSizeToMapLike(JSC::ExecState&amp;, WrapperClass&amp;);
 45 template&lt;typename WrapperClass&gt; JSC::JSValue forwardEntriesToMapLike(JSC::ExecState&amp;, WrapperClass&amp;);
 46 template&lt;typename WrapperClass&gt; JSC::JSValue forwardKeysToMapLike(JSC::ExecState&amp;, WrapperClass&amp;);
 47 template&lt;typename WrapperClass&gt; JSC::JSValue forwardValuesToMapLike(JSC::ExecState&amp;, WrapperClass&amp;);
 48 template&lt;typename WrapperClass&gt; JSC::JSValue forwardClearToMapLike(JSC::ExecState&amp;, WrapperClass&amp;);
 49 template&lt;typename WrapperClass, typename Callback&gt; JSC::JSValue forwardForEachToMapLike(JSC::ExecState&amp;, WrapperClass&amp;, Callback&amp;&amp;);
 50 template&lt;typename WrapperClass, typename ItemType&gt; JSC::JSValue forwardGetToMapLike(JSC::ExecState&amp;, WrapperClass&amp;, ItemType&amp;&amp;);
 51 template&lt;typename WrapperClass, typename ItemType&gt; JSC::JSValue forwardHasToMapLike(JSC::ExecState&amp;, WrapperClass&amp;, ItemType&amp;&amp;);
 52 template&lt;typename WrapperClass, typename ItemType&gt; JSC::JSValue forwardAddToMapLike(JSC::ExecState&amp;, WrapperClass&amp;, ItemType&amp;&amp;);
 53 template&lt;typename WrapperClass, typename ItemType&gt; JSC::JSValue forwardDeleteToMapLike(JSC::ExecState&amp;, WrapperClass&amp;, ItemType&amp;&amp;);
 54 
 55 class DOMMapLike final : public DOMGuarded&lt;JSC::JSMap&gt; {
 56 public:
 57     static Ref&lt;DOMMapLike&gt; create(JSDOMGlobalObject&amp; globalObject, JSC::JSMap&amp; map) { return adoptRef(*new DOMMapLike(globalObject, map)); }
 58 
 59     template&lt;typename Key, typename Value&gt; void set(typename Key::ParameterType&amp;&amp;, typename Value::ParameterType&amp;&amp;);
 60 
 61     JSC::JSMap* backingMap() { return guarded(); }
 62 
 63 protected:
 64     DOMMapLike(JSDOMGlobalObject&amp; globalObject, JSC::JSMap&amp; map) : DOMGuarded&lt;JSC::JSMap&gt;(globalObject, map) { }
 65 };
 66 
 67 template&lt;typename Key, typename Value&gt; inline void DOMMapLike::set(typename Key::ParameterType&amp;&amp; key, typename Value::ParameterType&amp;&amp; value)
 68 {
 69     if (isEmpty())
 70         return;
 71     auto* state = globalObject()-&gt;globalExec();
 72     JSC::JSLockHolder locker(state);
 73     backingMap()-&gt;set(state,
 74         toJS&lt;Key&gt;(*state, *globalObject(), std::forward&lt;typename Key::ParameterType&gt;(key)),
 75         toJS&lt;Value&gt;(*state, *globalObject(), std::forward&lt;typename Value::ParameterType&gt;(value)));
 76 }
 77 
 78 template&lt;typename WrapperClass&gt; inline void synchronizeBackingMap(JSC::ExecState&amp; state, JSDOMGlobalObject&amp; globalObject, WrapperClass&amp; mapLike)
 79 {
 80     auto backingMap = mapLike.wrapped().backingMap();
 81     if (backingMap) {
 82         ASSERT(backingMap-&gt;backingMap());
 83         initializeBackingMap(state.vm(), mapLike, *backingMap-&gt;backingMap());
 84         return;
 85     }
 86     auto&amp; map = createBackingMap(state, globalObject, mapLike);
 87     mapLike.wrapped().synchronizeBackingMap(DOMMapLike::create(globalObject, map));
 88 }
 89 
 90 template&lt;typename WrapperClass&gt; inline JSC::JSValue forwardSizeToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike)
 91 {
 92     JSC::VM&amp; vm = state.vm();
 93     return forwardAttributeGetterToBackingMap(state, mapLike, vm.propertyNames-&gt;size);
 94 }
 95 
 96 template&lt;typename WrapperClass&gt; inline JSC::JSValue forwardEntriesToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike)
 97 {
 98     JSC::VM&amp; vm = state.vm();
 99     return forwardFunctionCallToBackingMap(state, mapLike, vm.propertyNames-&gt;builtinNames().entriesPublicName());
100 }
101 
102 template&lt;typename WrapperClass&gt; inline JSC::JSValue forwardKeysToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike)
103 {
104     JSC::VM&amp; vm = state.vm();
105     return forwardFunctionCallToBackingMap(state, mapLike, vm.propertyNames-&gt;builtinNames().keysPublicName());
106 }
107 
108 template&lt;typename WrapperClass&gt; inline JSC::JSValue forwardValuesToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike)
109 {
110     JSC::VM&amp; vm = state.vm();
111     return forwardFunctionCallToBackingMap(state, mapLike, vm.propertyNames-&gt;builtinNames().valuesPublicName());
112 }
113 
114 template&lt;typename WrapperClass&gt; inline JSC::JSValue forwardClearToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike)
115 {
116     mapLike.wrapped().clear();
117     return forwardFunctionCallToBackingMap(state, mapLike, state.vm().propertyNames-&gt;clear);
118 }
119 
120 template&lt;typename WrapperClass, typename Callback&gt; inline JSC::JSValue forwardForEachToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike, Callback&amp;&amp;)
121 {
122     return forwardForEachCallToBackingMap(state, *mapLike.globalObject(), mapLike);
123 }
124 
125 template&lt;typename WrapperClass, typename ItemType&gt; inline JSC::JSValue forwardGetToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike, ItemType&amp;&amp;)
126 {
127     JSC::VM&amp; vm = state.vm();
128     return forwardFunctionCallToBackingMap(state, mapLike, vm.propertyNames-&gt;builtinNames().getPublicName());
129 }
130 
131 template&lt;typename WrapperClass, typename ItemType&gt; inline JSC::JSValue forwardHasToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike, ItemType&amp;&amp;)
132 {
133     JSC::VM&amp; vm = state.vm();
134     return forwardFunctionCallToBackingMap(state, mapLike, vm.propertyNames-&gt;builtinNames().hasPublicName());
135 }
136 
137 template&lt;typename WrapperClass, typename ItemType&gt; inline JSC::JSValue forwardAddToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike, ItemType&amp;&amp; item)
138 {
139     if (mapLike.wrapped().addFromMapLike(std::forward&lt;ItemType&gt;(item)))
140         forwardFunctionCallToBackingMap(state, mapLike, state.vm().propertyNames-&gt;add);
141     return &amp;mapLike;
142 }
143 
144 template&lt;typename WrapperClass, typename ItemType&gt; inline JSC::JSValue forwardDeleteToMapLike(JSC::ExecState&amp; state, WrapperClass&amp; mapLike, ItemType&amp;&amp; item)
145 {
146     auto isDeleted = mapLike.wrapped().remove(std::forward&lt;ItemType&gt;(item));
147     UNUSED_PARAM(isDeleted);
148     auto result = forwardFunctionCallToBackingMap(state, mapLike, state.vm().propertyNames-&gt;deleteKeyword);
149     ASSERT_UNUSED(result, result.asBoolean() == isDeleted);
150     return result;
151 }
152 
153 }
    </pre>
  </body>
</html>