<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/JavaScriptCore/builtins/TypedArrayPrototype.js</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2015-2016 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 // Note that the intrisic @typedArrayLength checks that the argument passed is a typed array
 27 // and throws if it is not.
 28 
 29 
 30 // Typed Arrays have their own species constructor function since they need
 31 // to look up their default constructor, which is expensive. If we used the
 32 // normal speciesConstructor helper we would need to look up the default
 33 // constructor every time.
 34 @globalPrivate
 35 function typedArraySpeciesConstructor(value)
 36 {
 37     &quot;use strict&quot;;
<a name="1" id="anc1"></a><span class="line-modified"> 38     var constructor = value.constructor;</span>
 39     if (constructor === @undefined)
 40         return @typedArrayGetOriginalConstructor(value);
 41 
 42     if (!@isObject(constructor))
 43         @throwTypeError(&quot;|this|.constructor is not an Object or undefined&quot;);
 44 
 45     constructor = constructor.@speciesSymbol;
 46     if (@isUndefinedOrNull(constructor))
 47         return @typedArrayGetOriginalConstructor(value);
 48     // The lack of an @isConstructor(constructor) check here is not observable because
 49     // the first thing we will do with the value is attempt to construct the result with it.
 50     // If any user of this function does not immediately construct the result they need to
 51     // verify that the result is a constructor.
 52     return constructor;
 53 }
 54 
 55 @globalPrivate
 56 function typedArrayClampArgumentToStartOrEnd(value, length, undefinedValue)
 57 {
 58     &quot;use strict&quot;;
 59 
 60     if (value === @undefined)
 61         return undefinedValue;
 62 
<a name="2" id="anc2"></a><span class="line-modified"> 63     var int = @toInteger(value);</span>
 64     if (int &lt; 0) {
 65         int += length;
 66         return int &lt; 0 ? 0 : int;
 67     }
 68     return int &gt; length ? length : int;
 69 }
 70 
<a name="3" id="anc3"></a>




















 71 function every(callback /*, thisArg */)
 72 {
 73     &quot;use strict&quot;;
 74     var length = @typedArrayLength(this);
 75     var thisArg = @argument(1);
 76 
 77     if (typeof callback !== &quot;function&quot;)
 78         @throwTypeError(&quot;TypedArray.prototype.every callback must be a function&quot;);
 79 
 80     for (var i = 0; i &lt; length; i++) {
 81         if (!callback.@call(thisArg, this[i], i, this))
 82             return false;
 83     }
 84 
 85     return true;
 86 }
 87 
 88 function fill(value /* [, start [, end]] */)
 89 {
 90     &quot;use strict&quot;;
 91 
<a name="4" id="anc4"></a><span class="line-modified"> 92     var length = @typedArrayLength(this);</span>
 93 
<a name="5" id="anc5"></a><span class="line-modified"> 94     var start = @argument(1);</span>
<span class="line-modified"> 95     var end = @argument(2);</span>
 96 
 97     start = @typedArrayClampArgumentToStartOrEnd(start, length, 0);
 98     end = @typedArrayClampArgumentToStartOrEnd(end, length, length);
 99 
<a name="6" id="anc6"></a><span class="line-modified">100     for (var i = start; i &lt; end; i++)</span>
101         this[i] = value;
102     return this;
103 }
104 
105 function find(callback /* [, thisArg] */)
106 {
107     &quot;use strict&quot;;
108     var length = @typedArrayLength(this);
109     var thisArg = @argument(1);
110 
111     if (typeof callback !== &quot;function&quot;)
112         @throwTypeError(&quot;TypedArray.prototype.find callback must be a function&quot;);
113 
114     for (var i = 0; i &lt; length; i++) {
<a name="7" id="anc7"></a><span class="line-modified">115         var elem = this[i];</span>
116         if (callback.@call(thisArg, elem, i, this))
117             return elem;
118     }
119     return @undefined;
120 }
121 
122 function findIndex(callback /* [, thisArg] */)
123 {
124     &quot;use strict&quot;;
125     var length = @typedArrayLength(this);
126     var thisArg = @argument(1);
127 
128     if (typeof callback !== &quot;function&quot;)
129         @throwTypeError(&quot;TypedArray.prototype.findIndex callback must be a function&quot;);
130 
131     for (var i = 0; i &lt; length; i++) {
132         if (callback.@call(thisArg, this[i], i, this))
133             return i;
134     }
135     return -1;
136 }
137 
138 function forEach(callback /* [, thisArg] */)
139 {
140     &quot;use strict&quot;;
141     var length = @typedArrayLength(this);
142     var thisArg = @argument(1);
143 
144     if (typeof callback !== &quot;function&quot;)
145         @throwTypeError(&quot;TypedArray.prototype.forEach callback must be a function&quot;);
146 
147     for (var i = 0; i &lt; length; i++)
148         callback.@call(thisArg, this[i], i, this);
149 }
150 
151 function some(callback /* [, thisArg] */)
152 {
153     // 22.2.3.24
154     &quot;use strict&quot;;
155     var length = @typedArrayLength(this);
156     var thisArg = @argument(1);
157 
158     if (typeof callback !== &quot;function&quot;)
159         @throwTypeError(&quot;TypedArray.prototype.some callback must be a function&quot;);
160 
161     for (var i = 0; i &lt; length; i++) {
162         if (callback.@call(thisArg, this[i], i, this))
163             return true;
164     }
165 
166     return false;
167 }
168 
169 function sort(comparator)
170 {
171     // 22.2.3.25
172     &quot;use strict&quot;;
173 
174     function min(a, b)
175     {
176         return a &lt; b ? a : b;
177     }
178 
179     function merge(dst, src, srcIndex, srcEnd, width, comparator)
180     {
181         var left = srcIndex;
182         var leftEnd = min(left + width, srcEnd);
183         var right = leftEnd;
184         var rightEnd = min(right + width, srcEnd);
185 
186         for (var dstIndex = left; dstIndex &lt; rightEnd; ++dstIndex) {
187             if (right &lt; rightEnd) {
188                 if (left &gt;= leftEnd || comparator(src[right], src[left]) &lt; 0) {
189                     dst[dstIndex] = src[right++];
190                     continue;
191                 }
192             }
193 
194             dst[dstIndex] = src[left++];
195         }
196     }
197 
198     function mergeSort(array, valueCount, comparator)
199     {
200         var buffer = [ ];
201         buffer.length = valueCount;
202 
203         var dst = buffer;
204         var src = array;
205 
206         for (var width = 1; width &lt; valueCount; width *= 2) {
207             for (var srcIndex = 0; srcIndex &lt; valueCount; srcIndex += 2 * width)
208                 merge(dst, src, srcIndex, valueCount, width, comparator);
209 
210             var tmp = src;
211             src = dst;
212             dst = tmp;
213         }
214 
215         if (src != array) {
216             for(var i = 0; i &lt; valueCount; i++)
217                 array[i] = src[i];
218         }
219     }
220 
221     var length = @typedArrayLength(this);
222 
223     if (length &lt; 2)
224         return;
225 
226     if (typeof comparator == &quot;function&quot;)
227         mergeSort(this, length, comparator);
228     else
229         @typedArraySort(this);
230     
231     return this;
232 }
233 
234 function subarray(begin, end)
235 {
236     &quot;use strict&quot;;
237 
238     if (!@isTypedArrayView(this))
239         @throwTypeError(&quot;|this| should be a typed array view&quot;);
240 
<a name="8" id="anc8"></a><span class="line-modified">241     var start = @toInteger(begin);</span>
<span class="line-modified">242     var finish;</span>
243     if (end !== @undefined)
244         finish = @toInteger(end);
245 
<a name="9" id="anc9"></a><span class="line-modified">246     var constructor = @typedArraySpeciesConstructor(this);</span>
247 
248     return @typedArraySubarrayCreate.@call(this, start, finish, constructor);
249 }
250 
251 function reduce(callback /* [, initialValue] */)
252 {
253     // 22.2.3.19
254     &quot;use strict&quot;;
255 
256     var length = @typedArrayLength(this);
257 
258     if (typeof callback !== &quot;function&quot;)
259         @throwTypeError(&quot;TypedArray.prototype.reduce callback must be a function&quot;);
260 
261     var argumentCount = @argumentCount();
262     if (length === 0 &amp;&amp; argumentCount &lt; 2)
263         @throwTypeError(&quot;TypedArray.prototype.reduce of empty array with no initial value&quot;);
264 
265     var accumulator, k = 0;
266     if (argumentCount &gt; 1)
267         accumulator = @argument(1);
268     else
269         accumulator = this[k++];
270 
271     for (; k &lt; length; k++)
272         accumulator = callback.@call(@undefined, accumulator, this[k], k, this);
273 
274     return accumulator;
275 }
276 
277 function reduceRight(callback /* [, initialValue] */)
278 {
279     // 22.2.3.20
280     &quot;use strict&quot;;
281 
282     var length = @typedArrayLength(this);
283 
284     if (typeof callback !== &quot;function&quot;)
285         @throwTypeError(&quot;TypedArray.prototype.reduceRight callback must be a function&quot;);
286 
287     var argumentCount = @argumentCount();
288     if (length === 0 &amp;&amp; argumentCount &lt; 2)
289         @throwTypeError(&quot;TypedArray.prototype.reduceRight of empty array with no initial value&quot;);
290 
291     var accumulator, k = length - 1;
292     if (argumentCount &gt; 1)
293         accumulator = @argument(1);
294     else
295         accumulator = this[k--];
296 
297     for (; k &gt;= 0; k--)
298         accumulator = callback.@call(@undefined, accumulator, this[k], k, this);
299 
300     return accumulator;
301 }
302 
303 function map(callback /*, thisArg */)
304 {
305     // 22.2.3.18
306     &quot;use strict&quot;;
307 
308     var length = @typedArrayLength(this);
309 
310     if (typeof callback !== &quot;function&quot;)
311         @throwTypeError(&quot;TypedArray.prototype.map callback must be a function&quot;);
312 
313     var thisArg = @argument(1);
314 
315     // Do species construction
316     var constructor = this.constructor;
317     var result;
318     if (constructor === @undefined)
319         result = new (@typedArrayGetOriginalConstructor(this))(length);
320     else {
321         var speciesConstructor = constructor.@speciesSymbol;
322         if (@isUndefinedOrNull(speciesConstructor))
323             result = new (@typedArrayGetOriginalConstructor(this))(length);
324         else {
325             result = new speciesConstructor(length);
326             // typedArrayLength throws if it doesn&#39;t get a view.
327             @typedArrayLength(result);
328         }
329     }
330 
331     for (var i = 0; i &lt; length; i++) {
332         var mappedValue = callback.@call(thisArg, this[i], i, this);
333         result[i] = mappedValue;
334     }
335     return result;
336 }
337 
338 function filter(callback /*, thisArg */)
339 {
340     &quot;use strict&quot;;
341 
342     var length = @typedArrayLength(this);
343 
344     if (typeof callback !== &quot;function&quot;)
345         @throwTypeError(&quot;TypedArray.prototype.filter callback must be a function&quot;);
346 
347     var thisArg = @argument(1);
348     var kept = [];
349 
350     for (var i = 0; i &lt; length; i++) {
351         var value = this[i];
352         if (callback.@call(thisArg, value, i, this))
353             kept.@push(value);
354     }
355 
356     var constructor = this.constructor;
357     var result;
358     var resultLength = kept.length;
359     if (constructor === @undefined)
360         result = new (@typedArrayGetOriginalConstructor(this))(resultLength);
361     else {
362         var speciesConstructor = constructor.@speciesSymbol;
363         if (@isUndefinedOrNull(speciesConstructor))
364             result = new (@typedArrayGetOriginalConstructor(this))(resultLength);
365         else {
366             result = new speciesConstructor(resultLength);
367             // typedArrayLength throws if it doesn&#39;t get a view.
368             @typedArrayLength(result);
369         }
370     }
371 
372     for (var i = 0; i &lt; kept.length; i++)
373         result[i] = kept[i];
374 
375     return result;
376 }
377 
378 function toLocaleString(/* locale, options */)
379 {
380     &quot;use strict&quot;;
381 
382     var length = @typedArrayLength(this);
383 
384     if (length == 0)
385         return &quot;&quot;;
386 
387     var string = this[0].toLocaleString(@argument(0), @argument(1));
388     for (var i = 1; i &lt; length; i++)
389         string += &quot;,&quot; + this[i].toLocaleString(@argument(0), @argument(1));
390 
391     return string;
392 }
<a name="10" id="anc10"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="10" type="hidden" />
</body>
</html>