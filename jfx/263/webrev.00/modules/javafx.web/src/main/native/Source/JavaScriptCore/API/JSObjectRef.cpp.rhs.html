<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/JavaScriptCore/API/JSObjectRef.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (C) 2006-2020 Apple Inc. All rights reserved.</span>
  3  * Copyright (C) 2008 Kelvin W Sherlock (ksherlock@gmail.com)
  4  *
  5  * Redistribution and use in source and binary forms, with or without
  6  * modification, are permitted provided that the following conditions
  7  * are met:
  8  * 1. Redistributions of source code must retain the above copyright
  9  *    notice, this list of conditions and the following disclaimer.
 10  * 2. Redistributions in binary form must reproduce the above copyright
 11  *    notice, this list of conditions and the following disclaimer in the
 12  *    documentation and/or other materials provided with the distribution.
 13  *
 14  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 15  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 16  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 17  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 18  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 19  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 20  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 21  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 22  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 23  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 24  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 25  */
 26 
 27 #include &quot;config.h&quot;
 28 #include &quot;JSObjectRef.h&quot;
 29 #include &quot;JSObjectRefPrivate.h&quot;
 30 
 31 #include &quot;APICast.h&quot;
 32 #include &quot;APIUtils.h&quot;
 33 #include &quot;DateConstructor.h&quot;
 34 #include &quot;ErrorConstructor.h&quot;
 35 #include &quot;Exception.h&quot;
 36 #include &quot;FunctionConstructor.h&quot;
 37 #include &quot;Identifier.h&quot;
 38 #include &quot;InitializeThreading.h&quot;
 39 #include &quot;JSAPIWrapperObject.h&quot;
 40 #include &quot;JSArray.h&quot;
 41 #include &quot;JSCInlines.h&quot;
 42 #include &quot;JSCallbackConstructor.h&quot;
 43 #include &quot;JSCallbackFunction.h&quot;
 44 #include &quot;JSCallbackObject.h&quot;
 45 #include &quot;JSClassRef.h&quot;
 46 #include &quot;JSFunction.h&quot;
 47 #include &quot;JSGlobalObject.h&quot;
 48 #include &quot;JSObject.h&quot;
 49 #include &quot;JSPromise.h&quot;
<a name="2" id="anc2"></a>
 50 #include &quot;JSRetainPtr.h&quot;
 51 #include &quot;JSString.h&quot;
 52 #include &quot;JSValueRef.h&quot;
 53 #include &quot;ObjectConstructor.h&quot;
 54 #include &quot;ObjectPrototype.h&quot;
 55 #include &quot;PropertyNameArray.h&quot;
 56 #include &quot;ProxyObject.h&quot;
 57 #include &quot;RegExpConstructor.h&quot;
 58 
 59 #if ENABLE(REMOTE_INSPECTOR)
 60 #include &quot;JSGlobalObjectInspectorController.h&quot;
 61 #endif
 62 
 63 using namespace JSC;
 64 
 65 JSClassRef JSClassCreate(const JSClassDefinition* definition)
 66 {
 67     initializeThreading();
 68     auto jsClass = (definition-&gt;attributes &amp; kJSClassAttributeNoAutomaticPrototype)
 69         ? OpaqueJSClass::createNoAutomaticPrototype(definition)
 70         : OpaqueJSClass::create(definition);
 71 
 72     return &amp;jsClass.leakRef();
 73 }
 74 
 75 JSClassRef JSClassRetain(JSClassRef jsClass)
 76 {
 77     jsClass-&gt;ref();
 78     return jsClass;
 79 }
 80 
 81 void JSClassRelease(JSClassRef jsClass)
 82 {
 83     jsClass-&gt;deref();
 84 }
 85 
 86 JSObjectRef JSObjectMake(JSContextRef ctx, JSClassRef jsClass, void* data)
 87 {
 88     if (!ctx) {
 89         ASSERT_NOT_REACHED();
 90         return 0;
 91     }
<a name="3" id="anc3"></a><span class="line-modified"> 92     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified"> 93     VM&amp; vm = globalObject-&gt;vm();</span>
 94     JSLockHolder locker(vm);
 95 
 96     if (!jsClass)
<a name="4" id="anc4"></a><span class="line-modified"> 97         return toRef(constructEmptyObject(globalObject));</span>
 98 
<a name="5" id="anc5"></a><span class="line-modified"> 99     JSCallbackObject&lt;JSNonFinalObject&gt;* object = JSCallbackObject&lt;JSNonFinalObject&gt;::create(globalObject, globalObject-&gt;callbackObjectStructure(), jsClass, data);</span>
<span class="line-modified">100     if (JSObject* prototype = jsClass-&gt;prototype(globalObject))</span>
101         object-&gt;setPrototypeDirect(vm, prototype);
102 
103     return toRef(object);
104 }
105 
106 JSObjectRef JSObjectMakeFunctionWithCallback(JSContextRef ctx, JSStringRef name, JSObjectCallAsFunctionCallback callAsFunction)
107 {
108     if (!ctx) {
109         ASSERT_NOT_REACHED();
110         return 0;
111     }
<a name="6" id="anc6"></a><span class="line-modified">112     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">113     VM&amp; vm = globalObject-&gt;vm();</span>
114     JSLockHolder locker(vm);
<a name="7" id="anc7"></a><span class="line-modified">115     return toRef(JSCallbackFunction::create(vm, globalObject, callAsFunction, name ? name-&gt;string() : &quot;anonymous&quot;_s));</span>
116 }
117 
118 JSObjectRef JSObjectMakeConstructor(JSContextRef ctx, JSClassRef jsClass, JSObjectCallAsConstructorCallback callAsConstructor)
119 {
120     if (!ctx) {
121         ASSERT_NOT_REACHED();
122         return 0;
123     }
<a name="8" id="anc8"></a><span class="line-modified">124     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">125     VM&amp; vm = globalObject-&gt;vm();</span>
126     JSLockHolder locker(vm);
127 
<a name="9" id="anc9"></a><span class="line-modified">128     JSValue jsPrototype = jsClass ? jsClass-&gt;prototype(globalObject) : 0;</span>
129     if (!jsPrototype)
<a name="10" id="anc10"></a><span class="line-modified">130         jsPrototype = globalObject-&gt;objectPrototype();</span>
131 
<a name="11" id="anc11"></a><span class="line-modified">132     JSCallbackConstructor* constructor = JSCallbackConstructor::create(globalObject, globalObject-&gt;callbackConstructorStructure(), jsClass, callAsConstructor);</span>
133     constructor-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, jsPrototype, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly);
134     return toRef(constructor);
135 }
136 
137 JSObjectRef JSObjectMakeFunction(JSContextRef ctx, JSStringRef name, unsigned parameterCount, const JSStringRef parameterNames[], JSStringRef body, JSStringRef sourceURL, int startingLineNumber, JSValueRef* exception)
138 {
139     if (!ctx) {
140         ASSERT_NOT_REACHED();
141         return 0;
142     }
<a name="12" id="anc12"></a><span class="line-modified">143     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">144     VM&amp; vm = globalObject-&gt;vm();</span>
145     JSLockHolder locker(vm);
146     auto scope = DECLARE_CATCH_SCOPE(vm);
147 
148     startingLineNumber = std::max(1, startingLineNumber);
149     Identifier nameID = name ? name-&gt;identifier(&amp;vm) : Identifier::fromString(vm, &quot;anonymous&quot;);
150 
151     MarkedArgumentBuffer args;
152     for (unsigned i = 0; i &lt; parameterCount; i++)
153         args.append(jsString(vm, parameterNames[i]-&gt;string()));
154     args.append(jsString(vm, body-&gt;string()));
155     if (UNLIKELY(args.hasOverflowed())) {
156         auto throwScope = DECLARE_THROW_SCOPE(vm);
<a name="13" id="anc13"></a><span class="line-modified">157         throwOutOfMemoryError(globalObject, throwScope);</span>
<span class="line-modified">158         handleExceptionIfNeeded(scope, ctx, exception);</span>
159         return 0;
160     }
161 
162     auto sourceURLString = sourceURL ? sourceURL-&gt;string() : String();
<a name="14" id="anc14"></a><span class="line-modified">163     JSObject* result = constructFunction(globalObject, args, nameID, SourceOrigin { sourceURLString }, sourceURLString, TextPosition(OrdinalNumber::fromOneBasedInt(startingLineNumber), OrdinalNumber()));</span>
<span class="line-modified">164     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
165         result = 0;
166     return toRef(result);
167 }
168 
169 JSObjectRef JSObjectMakeArray(JSContextRef ctx, size_t argumentCount, const JSValueRef arguments[],  JSValueRef* exception)
170 {
171     if (!ctx) {
172         ASSERT_NOT_REACHED();
173         return 0;
174     }
<a name="15" id="anc15"></a><span class="line-modified">175     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">176     VM&amp; vm = globalObject-&gt;vm();</span>
177     JSLockHolder locker(vm);
178     auto scope = DECLARE_CATCH_SCOPE(vm);
179 
180     JSObject* result;
181     if (argumentCount) {
182         MarkedArgumentBuffer argList;
183         for (size_t i = 0; i &lt; argumentCount; ++i)
<a name="16" id="anc16"></a><span class="line-modified">184             argList.append(toJS(globalObject, arguments[i]));</span>
185         if (UNLIKELY(argList.hasOverflowed())) {
186             auto throwScope = DECLARE_THROW_SCOPE(vm);
<a name="17" id="anc17"></a><span class="line-modified">187             throwOutOfMemoryError(globalObject, throwScope);</span>
<span class="line-modified">188             handleExceptionIfNeeded(scope, ctx, exception);</span>
189             return 0;
190         }
191 
<a name="18" id="anc18"></a><span class="line-modified">192         result = constructArray(globalObject, static_cast&lt;ArrayAllocationProfile*&gt;(0), argList);</span>
193     } else
<a name="19" id="anc19"></a><span class="line-modified">194         result = constructEmptyArray(globalObject, 0);</span>
195 
<a name="20" id="anc20"></a><span class="line-modified">196     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
197         result = 0;
198 
199     return toRef(result);
200 }
201 
202 JSObjectRef JSObjectMakeDate(JSContextRef ctx, size_t argumentCount, const JSValueRef arguments[],  JSValueRef* exception)
203 {
204     if (!ctx) {
205         ASSERT_NOT_REACHED();
206         return 0;
207     }
<a name="21" id="anc21"></a><span class="line-modified">208     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">209     VM&amp; vm = globalObject-&gt;vm();</span>
210     JSLockHolder locker(vm);
211     auto scope = DECLARE_CATCH_SCOPE(vm);
212 
213     MarkedArgumentBuffer argList;
214     for (size_t i = 0; i &lt; argumentCount; ++i)
<a name="22" id="anc22"></a><span class="line-modified">215         argList.append(toJS(globalObject, arguments[i]));</span>
216     if (UNLIKELY(argList.hasOverflowed())) {
217         auto throwScope = DECLARE_THROW_SCOPE(vm);
<a name="23" id="anc23"></a><span class="line-modified">218         throwOutOfMemoryError(globalObject, throwScope);</span>
<span class="line-modified">219         handleExceptionIfNeeded(scope, ctx, exception);</span>
220         return 0;
221     }
222 
<a name="24" id="anc24"></a><span class="line-modified">223     JSObject* result = constructDate(globalObject, JSValue(), argList);</span>
<span class="line-modified">224     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
225         result = 0;
226 
227     return toRef(result);
228 }
229 
230 JSObjectRef JSObjectMakeError(JSContextRef ctx, size_t argumentCount, const JSValueRef arguments[],  JSValueRef* exception)
231 {
232     if (!ctx) {
233         ASSERT_NOT_REACHED();
234         return 0;
235     }
<a name="25" id="anc25"></a><span class="line-modified">236     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">237     VM&amp; vm = globalObject-&gt;vm();</span>
238     JSLockHolder locker(vm);
239     auto scope = DECLARE_CATCH_SCOPE(vm);
240 
<a name="26" id="anc26"></a><span class="line-modified">241     JSValue message = argumentCount ? toJS(globalObject, arguments[0]) : jsUndefined();</span>
<span class="line-modified">242     Structure* errorStructure = globalObject-&gt;errorStructure();</span>
<span class="line-modified">243     JSObject* result = ErrorInstance::create(globalObject, errorStructure, message);</span>
244 
<a name="27" id="anc27"></a><span class="line-modified">245     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
246         result = 0;
247 
248     return toRef(result);
249 }
250 
251 JSObjectRef JSObjectMakeRegExp(JSContextRef ctx, size_t argumentCount, const JSValueRef arguments[],  JSValueRef* exception)
252 {
253     if (!ctx) {
254         ASSERT_NOT_REACHED();
255         return 0;
256     }
<a name="28" id="anc28"></a><span class="line-modified">257     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">258     VM&amp; vm = globalObject-&gt;vm();</span>
259     JSLockHolder locker(vm);
260     auto scope = DECLARE_CATCH_SCOPE(vm);
261 
262     MarkedArgumentBuffer argList;
263     for (size_t i = 0; i &lt; argumentCount; ++i)
<a name="29" id="anc29"></a><span class="line-modified">264         argList.append(toJS(globalObject, arguments[i]));</span>
265     if (UNLIKELY(argList.hasOverflowed())) {
266         auto throwScope = DECLARE_THROW_SCOPE(vm);
<a name="30" id="anc30"></a><span class="line-modified">267         throwOutOfMemoryError(globalObject, throwScope);</span>
<span class="line-modified">268         handleExceptionIfNeeded(scope, ctx, exception);</span>
269         return 0;
270     }
271 
<a name="31" id="anc31"></a><span class="line-modified">272     JSObject* result = constructRegExp(globalObject, argList);</span>
<span class="line-modified">273     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
274         result = 0;
275 
276     return toRef(result);
277 }
278 
279 JSObjectRef JSObjectMakeDeferredPromise(JSContextRef ctx, JSObjectRef* resolve, JSObjectRef* reject, JSValueRef* exception)
280 {
281     if (!ctx) {
282         ASSERT_NOT_REACHED();
283         return nullptr;
284     }
285 
<a name="32" id="anc32"></a><span class="line-modified">286     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">287     VM&amp; vm = globalObject-&gt;vm();</span>
<span class="line-modified">288     JSLockHolder locker(globalObject);</span>
289     auto scope = DECLARE_CATCH_SCOPE(vm);
290 
<a name="33" id="anc33"></a><span class="line-modified">291     JSPromise::DeferredData data = JSPromise::createDeferredData(globalObject, globalObject-&gt;promiseConstructor());</span>
<span class="line-modified">292     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>

293         return nullptr;
294 
295     if (resolve)
296         *resolve = toRef(data.resolve);
297     if (reject)
298         *reject = toRef(data.reject);
299     return toRef(data.promise);
300 }
301 
302 JSValueRef JSObjectGetPrototype(JSContextRef ctx, JSObjectRef object)
303 {
304     if (!ctx) {
305         ASSERT_NOT_REACHED();
306         return 0;
307     }
<a name="34" id="anc34"></a><span class="line-modified">308     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">309     JSLockHolder locker(globalObject);</span>
310 
311     JSObject* jsObject = toJS(object);
<a name="35" id="anc35"></a><span class="line-modified">312     return toRef(globalObject, jsObject-&gt;getPrototypeDirect(globalObject-&gt;vm()));</span>
313 }
314 
315 void JSObjectSetPrototype(JSContextRef ctx, JSObjectRef object, JSValueRef value)
316 {
317     if (!ctx) {
318         ASSERT_NOT_REACHED();
319         return;
320     }
<a name="36" id="anc36"></a><span class="line-modified">321     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">322     VM&amp; vm = globalObject-&gt;vm();</span>
323     JSLockHolder locker(vm);
324     auto scope = DECLARE_CATCH_SCOPE(vm);
325 
326     JSObject* jsObject = toJS(object);
<a name="37" id="anc37"></a><span class="line-modified">327     JSValue jsValue = toJS(globalObject, value);</span>
<span class="line-modified">328     jsObject-&gt;setPrototype(vm, globalObject, jsValue.isObject() ? jsValue : jsNull());</span>
<span class="line-modified">329     handleExceptionIfNeeded(scope, ctx, nullptr);</span>
330 }
331 
332 bool JSObjectHasProperty(JSContextRef ctx, JSObjectRef object, JSStringRef propertyName)
333 {
334     if (!ctx) {
335         ASSERT_NOT_REACHED();
336         return false;
337     }
<a name="38" id="anc38"></a><span class="line-modified">338     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">339     VM&amp; vm = globalObject-&gt;vm();</span>
340     JSLockHolder locker(vm);
341 
342     JSObject* jsObject = toJS(object);
343 
<a name="39" id="anc39"></a><span class="line-modified">344     return jsObject-&gt;hasProperty(globalObject, propertyName-&gt;identifier(&amp;vm));</span>
345 }
346 
347 JSValueRef JSObjectGetProperty(JSContextRef ctx, JSObjectRef object, JSStringRef propertyName, JSValueRef* exception)
348 {
<a name="40" id="anc40"></a><span class="line-modified">349     if (!ctx || !object) {</span>
350         ASSERT_NOT_REACHED();
351         return 0;
352     }
<a name="41" id="anc41"></a><span class="line-modified">353     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">354     VM&amp; vm = globalObject-&gt;vm();</span>
355     JSLockHolder locker(vm);
356     auto scope = DECLARE_CATCH_SCOPE(vm);
357 
358     JSObject* jsObject = toJS(object);
359 
<a name="42" id="anc42"></a><span class="line-modified">360     JSValue jsValue = jsObject-&gt;get(globalObject, propertyName-&gt;identifier(&amp;vm));</span>
<span class="line-modified">361     handleExceptionIfNeeded(scope, ctx, exception);</span>
<span class="line-modified">362     return toRef(globalObject, jsValue);</span>
363 }
364 
365 void JSObjectSetProperty(JSContextRef ctx, JSObjectRef object, JSStringRef propertyName, JSValueRef value, JSPropertyAttributes attributes, JSValueRef* exception)
366 {
367     if (!ctx) {
368         ASSERT_NOT_REACHED();
369         return;
370     }
<a name="43" id="anc43"></a><span class="line-modified">371     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">372     VM&amp; vm = globalObject-&gt;vm();</span>
373     JSLockHolder locker(vm);
374     auto scope = DECLARE_CATCH_SCOPE(vm);
375 
376     JSObject* jsObject = toJS(object);
377     Identifier name(propertyName-&gt;identifier(&amp;vm));
<a name="44" id="anc44"></a><span class="line-modified">378     JSValue jsValue = toJS(globalObject, value);</span>
379 
<a name="45" id="anc45"></a><span class="line-modified">380     bool doesNotHaveProperty = attributes &amp;&amp; !jsObject-&gt;hasProperty(globalObject, name);</span>
381     if (LIKELY(!scope.exception())) {
382         if (doesNotHaveProperty) {
383             PropertyDescriptor desc(jsValue, attributes);
<a name="46" id="anc46"></a><span class="line-modified">384             jsObject-&gt;methodTable(vm)-&gt;defineOwnProperty(jsObject, globalObject, name, desc, false);</span>
385         } else {
386             PutPropertySlot slot(jsObject);
<a name="47" id="anc47"></a><span class="line-modified">387             jsObject-&gt;methodTable(vm)-&gt;put(jsObject, globalObject, name, jsValue, slot);</span>
388         }
389     }
<a name="48" id="anc48"></a><span class="line-modified">390     handleExceptionIfNeeded(scope, ctx, exception);</span>
391 }
392 
393 bool JSObjectHasPropertyForKey(JSContextRef ctx, JSObjectRef object, JSValueRef key, JSValueRef* exception)
394 {
395     if (!ctx) {
396         ASSERT_NOT_REACHED();
397         return false;
398     }
<a name="49" id="anc49"></a><span class="line-modified">399     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">400     VM&amp; vm = globalObject-&gt;vm();</span>
401     JSLockHolder locker(vm);
402     auto scope = DECLARE_CATCH_SCOPE(vm);
403 
404     JSObject* jsObject = toJS(object);
<a name="50" id="anc50"></a><span class="line-modified">405     Identifier ident = toJS(globalObject, key).toPropertyKey(globalObject);</span>
<span class="line-modified">406     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
407         return false;
408 
<a name="51" id="anc51"></a><span class="line-modified">409     bool result = jsObject-&gt;hasProperty(globalObject, ident);</span>
<span class="line-modified">410     handleExceptionIfNeeded(scope, ctx, exception);</span>
411     return result;
412 }
413 
414 JSValueRef JSObjectGetPropertyForKey(JSContextRef ctx, JSObjectRef object, JSValueRef key, JSValueRef* exception)
415 {
416     if (!ctx) {
417         ASSERT_NOT_REACHED();
418         return nullptr;
419     }
<a name="52" id="anc52"></a><span class="line-modified">420     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">421     VM&amp; vm = globalObject-&gt;vm();</span>
422     JSLockHolder locker(vm);
423     auto scope = DECLARE_CATCH_SCOPE(vm);
424 
425     JSObject* jsObject = toJS(object);
<a name="53" id="anc53"></a><span class="line-modified">426     Identifier ident = toJS(globalObject, key).toPropertyKey(globalObject);</span>
<span class="line-modified">427     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
428         return nullptr;
429 
<a name="54" id="anc54"></a><span class="line-modified">430     JSValue jsValue = jsObject-&gt;get(globalObject, ident);</span>
<span class="line-modified">431     handleExceptionIfNeeded(scope, ctx, exception);</span>
<span class="line-modified">432     return toRef(globalObject, jsValue);</span>
433 }
434 
435 void JSObjectSetPropertyForKey(JSContextRef ctx, JSObjectRef object, JSValueRef key, JSValueRef value, JSPropertyAttributes attributes, JSValueRef* exception)
436 {
437     if (!ctx) {
438         ASSERT_NOT_REACHED();
439         return;
440     }
<a name="55" id="anc55"></a><span class="line-modified">441     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">442     VM&amp; vm = globalObject-&gt;vm();</span>
443     JSLockHolder locker(vm);
444     auto scope = DECLARE_CATCH_SCOPE(vm);
445 
446     JSObject* jsObject = toJS(object);
<a name="56" id="anc56"></a><span class="line-modified">447     JSValue jsValue = toJS(globalObject, value);</span>
448 
<a name="57" id="anc57"></a><span class="line-modified">449     Identifier ident = toJS(globalObject, key).toPropertyKey(globalObject);</span>
<span class="line-modified">450     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
451         return;
452 
<a name="58" id="anc58"></a><span class="line-modified">453     bool doesNotHaveProperty = attributes &amp;&amp; !jsObject-&gt;hasProperty(globalObject, ident);</span>
454     if (LIKELY(!scope.exception())) {
455         if (doesNotHaveProperty) {
456             PropertyDescriptor desc(jsValue, attributes);
<a name="59" id="anc59"></a><span class="line-modified">457             jsObject-&gt;methodTable(vm)-&gt;defineOwnProperty(jsObject, globalObject, ident, desc, false);</span>
458         } else {
459             PutPropertySlot slot(jsObject);
<a name="60" id="anc60"></a><span class="line-modified">460             jsObject-&gt;methodTable(vm)-&gt;put(jsObject, globalObject, ident, jsValue, slot);</span>
461         }
462     }
<a name="61" id="anc61"></a><span class="line-modified">463     handleExceptionIfNeeded(scope, ctx, exception);</span>
464 }
465 
466 bool JSObjectDeletePropertyForKey(JSContextRef ctx, JSObjectRef object, JSValueRef key, JSValueRef* exception)
467 {
468     if (!ctx) {
469         ASSERT_NOT_REACHED();
470         return false;
471     }
<a name="62" id="anc62"></a><span class="line-modified">472     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">473     VM&amp; vm = globalObject-&gt;vm();</span>
474     JSLockHolder locker(vm);
475     auto scope = DECLARE_CATCH_SCOPE(vm);
476 
477     JSObject* jsObject = toJS(object);
<a name="63" id="anc63"></a><span class="line-modified">478     Identifier ident = toJS(globalObject, key).toPropertyKey(globalObject);</span>
<span class="line-modified">479     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
480         return false;
481 
<a name="64" id="anc64"></a><span class="line-modified">482     bool result = jsObject-&gt;methodTable(vm)-&gt;deleteProperty(jsObject, globalObject, ident);</span>
<span class="line-modified">483     handleExceptionIfNeeded(scope, ctx, exception);</span>
484     return result;
485 }
486 
487 JSValueRef JSObjectGetPropertyAtIndex(JSContextRef ctx, JSObjectRef object, unsigned propertyIndex, JSValueRef* exception)
488 {
489     if (!ctx) {
490         ASSERT_NOT_REACHED();
491         return 0;
492     }
<a name="65" id="anc65"></a><span class="line-modified">493     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">494     VM&amp; vm = globalObject-&gt;vm();</span>
495     JSLockHolder locker(vm);
496     auto scope = DECLARE_CATCH_SCOPE(vm);
497 
498     JSObject* jsObject = toJS(object);
499 
<a name="66" id="anc66"></a><span class="line-modified">500     JSValue jsValue = jsObject-&gt;get(globalObject, propertyIndex);</span>
<span class="line-modified">501     handleExceptionIfNeeded(scope, ctx, exception);</span>
<span class="line-modified">502     return toRef(globalObject, jsValue);</span>
503 }
504 
505 
506 void JSObjectSetPropertyAtIndex(JSContextRef ctx, JSObjectRef object, unsigned propertyIndex, JSValueRef value, JSValueRef* exception)
507 {
508     if (!ctx) {
509         ASSERT_NOT_REACHED();
510         return;
511     }
<a name="67" id="anc67"></a><span class="line-modified">512     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">513     VM&amp; vm = globalObject-&gt;vm();</span>
514     JSLockHolder locker(vm);
515     auto scope = DECLARE_CATCH_SCOPE(vm);
516 
517     JSObject* jsObject = toJS(object);
<a name="68" id="anc68"></a><span class="line-modified">518     JSValue jsValue = toJS(globalObject, value);</span>
519 
<a name="69" id="anc69"></a><span class="line-modified">520     jsObject-&gt;methodTable(vm)-&gt;putByIndex(jsObject, globalObject, propertyIndex, jsValue, false);</span>
<span class="line-modified">521     handleExceptionIfNeeded(scope, ctx, exception);</span>
522 }
523 
524 bool JSObjectDeleteProperty(JSContextRef ctx, JSObjectRef object, JSStringRef propertyName, JSValueRef* exception)
525 {
526     if (!ctx) {
527         ASSERT_NOT_REACHED();
528         return false;
529     }
<a name="70" id="anc70"></a><span class="line-modified">530     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">531     VM&amp; vm = globalObject-&gt;vm();</span>
532     JSLockHolder locker(vm);
533     auto scope = DECLARE_CATCH_SCOPE(vm);
534 
535     JSObject* jsObject = toJS(object);
536 
<a name="71" id="anc71"></a><span class="line-modified">537     bool result = jsObject-&gt;methodTable(vm)-&gt;deleteProperty(jsObject, globalObject, propertyName-&gt;identifier(&amp;vm));</span>
<span class="line-modified">538     handleExceptionIfNeeded(scope, ctx, exception);</span>
539     return result;
540 }
541 
542 // API objects have private properties, which may get accessed during destruction. This
543 // helper lets us get the ClassInfo of an API object from a function that may get called
544 // during destruction.
545 static const ClassInfo* classInfoPrivate(JSObject* jsObject)
546 {
547     VM&amp; vm = jsObject-&gt;vm();
548 
549     if (vm.currentlyDestructingCallbackObject != jsObject)
550         return jsObject-&gt;classInfo(vm);
551 
552     return vm.currentlyDestructingCallbackObjectClassInfo;
553 }
554 
555 void* JSObjectGetPrivate(JSObjectRef object)
556 {
557     JSObject* jsObject = uncheckedToJS(object);
558     VM&amp; vm = jsObject-&gt;vm();
559 
560     const ClassInfo* classInfo = classInfoPrivate(jsObject);
561 
562     // Get wrapped object if proxied
563     if (classInfo-&gt;isSubClassOf(JSProxy::info())) {
564         jsObject = static_cast&lt;JSProxy*&gt;(jsObject)-&gt;target();
565         classInfo = jsObject-&gt;classInfo(vm);
566     }
567 
568     if (classInfo-&gt;isSubClassOf(JSCallbackObject&lt;JSGlobalObject&gt;::info()))
569         return static_cast&lt;JSCallbackObject&lt;JSGlobalObject&gt;*&gt;(jsObject)-&gt;getPrivate();
<a name="72" id="anc72"></a><span class="line-modified">570     if (classInfo-&gt;isSubClassOf(JSCallbackObject&lt;JSNonFinalObject&gt;::info()))</span>
<span class="line-modified">571         return static_cast&lt;JSCallbackObject&lt;JSNonFinalObject&gt;*&gt;(jsObject)-&gt;getPrivate();</span>
572 #if JSC_OBJC_API_ENABLED
573     if (classInfo-&gt;isSubClassOf(JSCallbackObject&lt;JSAPIWrapperObject&gt;::info()))
574         return static_cast&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;*&gt;(jsObject)-&gt;getPrivate();
575 #endif
576 
577     return 0;
578 }
579 
580 bool JSObjectSetPrivate(JSObjectRef object, void* data)
581 {
582     JSObject* jsObject = uncheckedToJS(object);
583     VM&amp; vm = jsObject-&gt;vm();
584 
585     const ClassInfo* classInfo = classInfoPrivate(jsObject);
586 
587     // Get wrapped object if proxied
588     if (classInfo-&gt;isSubClassOf(JSProxy::info())) {
589         jsObject = static_cast&lt;JSProxy*&gt;(jsObject)-&gt;target();
590         classInfo = jsObject-&gt;classInfo(vm);
591     }
592 
593     if (classInfo-&gt;isSubClassOf(JSCallbackObject&lt;JSGlobalObject&gt;::info())) {
594         static_cast&lt;JSCallbackObject&lt;JSGlobalObject&gt;*&gt;(jsObject)-&gt;setPrivate(data);
595         return true;
596     }
<a name="73" id="anc73"></a><span class="line-modified">597     if (classInfo-&gt;isSubClassOf(JSCallbackObject&lt;JSNonFinalObject&gt;::info())) {</span>
<span class="line-modified">598         static_cast&lt;JSCallbackObject&lt;JSNonFinalObject&gt;*&gt;(jsObject)-&gt;setPrivate(data);</span>
599         return true;
600     }
601 #if JSC_OBJC_API_ENABLED
602     if (classInfo-&gt;isSubClassOf(JSCallbackObject&lt;JSAPIWrapperObject&gt;::info())) {
603         static_cast&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;*&gt;(jsObject)-&gt;setPrivate(data);
604         return true;
605     }
606 #endif
607 
608     return false;
609 }
610 
611 JSValueRef JSObjectGetPrivateProperty(JSContextRef ctx, JSObjectRef object, JSStringRef propertyName)
612 {
<a name="74" id="anc74"></a><span class="line-modified">613     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">614     VM&amp; vm = globalObject-&gt;vm();</span>
615     JSLockHolder locker(vm);
616     JSObject* jsObject = toJS(object);
617     JSValue result;
618     Identifier name(propertyName-&gt;identifier(&amp;vm));
619 
620 
621     // Get wrapped object if proxied
622     if (jsObject-&gt;inherits&lt;JSProxy&gt;(vm))
623         jsObject = jsCast&lt;JSProxy*&gt;(jsObject)-&gt;target();
624 
625     if (jsObject-&gt;inherits&lt;JSCallbackObject&lt;JSGlobalObject&gt;&gt;(vm))
626         result = jsCast&lt;JSCallbackObject&lt;JSGlobalObject&gt;*&gt;(jsObject)-&gt;getPrivateProperty(name);
<a name="75" id="anc75"></a><span class="line-modified">627     else if (jsObject-&gt;inherits&lt;JSCallbackObject&lt;JSNonFinalObject&gt;&gt;(vm))</span>
<span class="line-modified">628         result = jsCast&lt;JSCallbackObject&lt;JSNonFinalObject&gt;*&gt;(jsObject)-&gt;getPrivateProperty(name);</span>
629 #if JSC_OBJC_API_ENABLED
630     else if (jsObject-&gt;inherits&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;&gt;(vm))
631         result = jsCast&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;*&gt;(jsObject)-&gt;getPrivateProperty(name);
632 #endif
<a name="76" id="anc76"></a><span class="line-modified">633     return toRef(globalObject, result);</span>
634 }
635 
636 bool JSObjectSetPrivateProperty(JSContextRef ctx, JSObjectRef object, JSStringRef propertyName, JSValueRef value)
637 {
<a name="77" id="anc77"></a><span class="line-modified">638     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">639     VM&amp; vm = globalObject-&gt;vm();</span>
640     JSLockHolder locker(vm);
641     JSObject* jsObject = toJS(object);
<a name="78" id="anc78"></a><span class="line-modified">642     JSValue jsValue = value ? toJS(globalObject, value) : JSValue();</span>
643     Identifier name(propertyName-&gt;identifier(&amp;vm));
644 
645     // Get wrapped object if proxied
646     if (jsObject-&gt;inherits&lt;JSProxy&gt;(vm))
647         jsObject = jsCast&lt;JSProxy*&gt;(jsObject)-&gt;target();
648 
649     if (jsObject-&gt;inherits&lt;JSCallbackObject&lt;JSGlobalObject&gt;&gt;(vm)) {
650         jsCast&lt;JSCallbackObject&lt;JSGlobalObject&gt;*&gt;(jsObject)-&gt;setPrivateProperty(vm, name, jsValue);
651         return true;
652     }
<a name="79" id="anc79"></a><span class="line-modified">653     if (jsObject-&gt;inherits&lt;JSCallbackObject&lt;JSNonFinalObject&gt;&gt;(vm)) {</span>
<span class="line-modified">654         jsCast&lt;JSCallbackObject&lt;JSNonFinalObject&gt;*&gt;(jsObject)-&gt;setPrivateProperty(vm, name, jsValue);</span>
655         return true;
656     }
657 #if JSC_OBJC_API_ENABLED
658     if (jsObject-&gt;inherits&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;&gt;(vm)) {
659         jsCast&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;*&gt;(jsObject)-&gt;setPrivateProperty(vm, name, jsValue);
660         return true;
661     }
662 #endif
663     return false;
664 }
665 
666 bool JSObjectDeletePrivateProperty(JSContextRef ctx, JSObjectRef object, JSStringRef propertyName)
667 {
<a name="80" id="anc80"></a><span class="line-modified">668     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">669     VM&amp; vm = globalObject-&gt;vm();</span>
670     JSLockHolder locker(vm);
671     JSObject* jsObject = toJS(object);
672     Identifier name(propertyName-&gt;identifier(&amp;vm));
673 
674     // Get wrapped object if proxied
675     if (jsObject-&gt;inherits&lt;JSProxy&gt;(vm))
676         jsObject = jsCast&lt;JSProxy*&gt;(jsObject)-&gt;target();
677 
678     if (jsObject-&gt;inherits&lt;JSCallbackObject&lt;JSGlobalObject&gt;&gt;(vm)) {
679         jsCast&lt;JSCallbackObject&lt;JSGlobalObject&gt;*&gt;(jsObject)-&gt;deletePrivateProperty(name);
680         return true;
681     }
<a name="81" id="anc81"></a><span class="line-modified">682     if (jsObject-&gt;inherits&lt;JSCallbackObject&lt;JSNonFinalObject&gt;&gt;(vm)) {</span>
<span class="line-modified">683         jsCast&lt;JSCallbackObject&lt;JSNonFinalObject&gt;*&gt;(jsObject)-&gt;deletePrivateProperty(name);</span>
684         return true;
685     }
686 #if JSC_OBJC_API_ENABLED
687     if (jsObject-&gt;inherits&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;&gt;(vm)) {
688         jsCast&lt;JSCallbackObject&lt;JSAPIWrapperObject&gt;*&gt;(jsObject)-&gt;deletePrivateProperty(name);
689         return true;
690     }
691 #endif
692     return false;
693 }
694 
695 bool JSObjectIsFunction(JSContextRef ctx, JSObjectRef object)
696 {
697     if (!object)
698         return false;
<a name="82" id="anc82"></a><span class="line-modified">699     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">700     VM&amp; vm = globalObject-&gt;vm();</span>
701     JSLockHolder locker(vm);
702     CallData callData;
703     JSCell* cell = toJS(object);
704     return cell-&gt;methodTable(vm)-&gt;getCallData(cell, callData) != CallType::None;
705 }
706 
707 JSValueRef JSObjectCallAsFunction(JSContextRef ctx, JSObjectRef object, JSObjectRef thisObject, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
708 {
<a name="83" id="anc83"></a><span class="line-modified">709     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">710     VM&amp; vm = globalObject-&gt;vm();</span>
711     JSLockHolder locker(vm);
712     auto scope = DECLARE_CATCH_SCOPE(vm);
713 
714     if (!object)
715         return 0;
716 
717     JSObject* jsObject = toJS(object);
718     JSObject* jsThisObject = toJS(thisObject);
719 
720     if (!jsThisObject)
<a name="84" id="anc84"></a><span class="line-modified">721         jsThisObject = globalObject-&gt;globalThis();</span>
722 
723     MarkedArgumentBuffer argList;
724     for (size_t i = 0; i &lt; argumentCount; i++)
<a name="85" id="anc85"></a><span class="line-modified">725         argList.append(toJS(globalObject, arguments[i]));</span>
726     if (UNLIKELY(argList.hasOverflowed())) {
727         auto throwScope = DECLARE_THROW_SCOPE(vm);
<a name="86" id="anc86"></a><span class="line-modified">728         throwOutOfMemoryError(globalObject, throwScope);</span>
<span class="line-modified">729         handleExceptionIfNeeded(scope, ctx, exception);</span>
730         return 0;
731     }
732 
733     CallData callData;
734     CallType callType = jsObject-&gt;methodTable(vm)-&gt;getCallData(jsObject, callData);
735     if (callType == CallType::None)
736         return 0;
737 
<a name="87" id="anc87"></a><span class="line-modified">738     JSValueRef result = toRef(globalObject, profiledCall(globalObject, ProfilingReason::API, jsObject, callType, callData, jsThisObject, argList));</span>
<span class="line-modified">739     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
740         result = 0;
741     return result;
742 }
743 
744 bool JSObjectIsConstructor(JSContextRef ctx, JSObjectRef object)
745 {
<a name="88" id="anc88"></a><span class="line-modified">746     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">747     VM&amp; vm = globalObject-&gt;vm();</span>
748     JSLockHolder locker(vm);
749     if (!object)
750         return false;
751     return toJS(object)-&gt;isConstructor(vm);
752 }
753 
754 JSObjectRef JSObjectCallAsConstructor(JSContextRef ctx, JSObjectRef object, size_t argumentCount, const JSValueRef arguments[], JSValueRef* exception)
755 {
<a name="89" id="anc89"></a><span class="line-modified">756     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">757     VM&amp; vm = globalObject-&gt;vm();</span>
758     JSLockHolder locker(vm);
759     auto scope = DECLARE_CATCH_SCOPE(vm);
760 
761     if (!object)
762         return 0;
763 
764     JSObject* jsObject = toJS(object);
765 
766     ConstructData constructData;
767     ConstructType constructType = jsObject-&gt;methodTable(vm)-&gt;getConstructData(jsObject, constructData);
768     if (constructType == ConstructType::None)
769         return 0;
770 
771     MarkedArgumentBuffer argList;
772     for (size_t i = 0; i &lt; argumentCount; i++)
<a name="90" id="anc90"></a><span class="line-modified">773         argList.append(toJS(globalObject, arguments[i]));</span>
774     if (UNLIKELY(argList.hasOverflowed())) {
775         auto throwScope = DECLARE_THROW_SCOPE(vm);
<a name="91" id="anc91"></a><span class="line-modified">776         throwOutOfMemoryError(globalObject, throwScope);</span>
<span class="line-modified">777         handleExceptionIfNeeded(scope, ctx, exception);</span>
778         return 0;
779     }
780 
<a name="92" id="anc92"></a><span class="line-modified">781     JSObjectRef result = toRef(profiledConstruct(globalObject, ProfilingReason::API, jsObject, constructType, constructData, argList));</span>
<span class="line-modified">782     if (handleExceptionIfNeeded(scope, ctx, exception) == ExceptionStatus::DidThrow)</span>
783         result = 0;
784     return result;
785 }
786 
787 struct OpaqueJSPropertyNameArray {
788     WTF_MAKE_FAST_ALLOCATED;
789 public:
790     // FIXME: Why not inherit from RefCounted?
791     OpaqueJSPropertyNameArray(VM* vm)
792         : refCount(0)
793         , vm(vm)
794     {
795     }
796 
797     unsigned refCount;
798     VM* vm;
799     Vector&lt;Ref&lt;OpaqueJSString&gt;&gt; array;
800 };
801 
802 JSPropertyNameArrayRef JSObjectCopyPropertyNames(JSContextRef ctx, JSObjectRef object)
803 {
804     if (!ctx) {
805         ASSERT_NOT_REACHED();
806         return 0;
807     }
<a name="93" id="anc93"></a><span class="line-modified">808     JSGlobalObject* globalObject = toJS(ctx);</span>
<span class="line-modified">809     JSLockHolder locker(globalObject);</span>
810 
<a name="94" id="anc94"></a><span class="line-modified">811     VM&amp; vm = globalObject-&gt;vm();</span>
812 
813     JSObject* jsObject = toJS(object);
814     JSPropertyNameArrayRef propertyNames = new OpaqueJSPropertyNameArray(&amp;vm);
815     PropertyNameArray array(vm, PropertyNameMode::Strings, PrivateSymbolMode::Exclude);
<a name="95" id="anc95"></a><span class="line-modified">816     jsObject-&gt;methodTable(vm)-&gt;getPropertyNames(jsObject, globalObject, array, EnumerationMode());</span>
817 
818     size_t size = array.size();
819     propertyNames-&gt;array.reserveInitialCapacity(size);
820     for (size_t i = 0; i &lt; size; ++i)
821         propertyNames-&gt;array.uncheckedAppend(OpaqueJSString::tryCreate(array[i].string()).releaseNonNull());
822 
823     return JSPropertyNameArrayRetain(propertyNames);
824 }
825 
826 JSPropertyNameArrayRef JSPropertyNameArrayRetain(JSPropertyNameArrayRef array)
827 {
828     ++array-&gt;refCount;
829     return array;
830 }
831 
832 void JSPropertyNameArrayRelease(JSPropertyNameArrayRef array)
833 {
834     if (--array-&gt;refCount == 0) {
835         JSLockHolder locker(array-&gt;vm);
836         delete array;
837     }
838 }
839 
840 size_t JSPropertyNameArrayGetCount(JSPropertyNameArrayRef array)
841 {
842     return array-&gt;array.size();
843 }
844 
845 JSStringRef JSPropertyNameArrayGetNameAtIndex(JSPropertyNameArrayRef array, size_t index)
846 {
847     return array-&gt;array[static_cast&lt;unsigned&gt;(index)].ptr();
848 }
849 
850 void JSPropertyNameAccumulatorAddName(JSPropertyNameAccumulatorRef array, JSStringRef propertyName)
851 {
852     PropertyNameArray* propertyNames = toJS(array);
853     VM&amp; vm = propertyNames-&gt;vm();
854     JSLockHolder locker(vm);
855     propertyNames-&gt;add(propertyName-&gt;identifier(&amp;vm));
856 }
857 
858 JSObjectRef JSObjectGetProxyTarget(JSObjectRef objectRef)
859 {
860     JSObject* object = toJS(objectRef);
861     if (!object)
862         return nullptr;
863     VM&amp; vm = object-&gt;vm();
864     JSLockHolder locker(vm);
865     JSObject* result = nullptr;
866     if (JSProxy* proxy = jsDynamicCast&lt;JSProxy*&gt;(vm, object))
867         result = proxy-&gt;target();
868     else if (ProxyObject* proxy = jsDynamicCast&lt;ProxyObject*&gt;(vm, object))
869         result = proxy-&gt;target();
870     return toRef(result);
871 }
872 
873 JSGlobalContextRef JSObjectGetGlobalContext(JSObjectRef objectRef)
874 {
875     JSObject* object = toJS(objectRef);
876     if (!object)
877         return nullptr;
<a name="96" id="anc96"></a><span class="line-modified">878     return reinterpret_cast&lt;JSGlobalContextRef&gt;(object-&gt;globalObject());</span>
879 }
880 
<a name="97" id="anc97"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="97" type="hidden" />
</body>
</html>