<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/jit/PolymorphicCallStubRoutine.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="PCToCodeOriginMap.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PolymorphicCallStubRoutine.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/jit/PolymorphicCallStubRoutine.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -43,13 +43,11 @@</span>
  }
  
  void PolymorphicCallNode::unlink(VM&amp; vm)
  {
      if (m_callLinkInfo) {
<span class="udiff-line-modified-removed">-         if (Options::dumpDisassembly())</span>
<span class="udiff-line-removed">-             dataLog(&quot;Unlinking polymorphic call at &quot;, m_callLinkInfo-&gt;callReturnLocation(), &quot;, &quot;, m_callLinkInfo-&gt;codeOrigin(), &quot;\n&quot;);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-modified-added">+         dataLogLnIf(Options::dumpDisassembly(), &quot;Unlinking polymorphic call at &quot;, m_callLinkInfo-&gt;callReturnLocation(), &quot;, &quot;, m_callLinkInfo-&gt;codeOrigin());</span>
          m_callLinkInfo-&gt;unlink(vm);
      }
  
      if (isOnList())
          remove();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -64,24 +62,25 @@</span>
  {
      out.print(&quot;&lt;variant = &quot;, m_variant, &quot;, codeBlock = &quot;, pointerDump(m_codeBlock), &quot;&gt;&quot;);
  }
  
  PolymorphicCallStubRoutine::PolymorphicCallStubRoutine(
<span class="udiff-line-modified-removed">-     const MacroAssemblerCodeRef&lt;JITStubRoutinePtrTag&gt;&amp; codeRef, VM&amp; vm, const JSCell* owner, ExecState* callerFrame,</span>
<span class="udiff-line-modified-added">+     const MacroAssemblerCodeRef&lt;JITStubRoutinePtrTag&gt;&amp; codeRef, VM&amp; vm, const JSCell* owner, CallFrame* callerFrame,</span>
      CallLinkInfo&amp; info, const Vector&lt;PolymorphicCallCase&gt;&amp; cases,
      UniqueArray&lt;uint32_t&gt;&amp;&amp; fastCounts)
      : GCAwareJITStubRoutine(codeRef, vm)
<span class="udiff-line-added">+     , m_variants(cases.size())</span>
      , m_fastCounts(WTFMove(fastCounts))
  {
<span class="udiff-line-modified-removed">-     for (PolymorphicCallCase callCase : cases) {</span>
<span class="udiff-line-modified-removed">-         m_variants.append(WriteBarrier&lt;JSCell&gt;(vm, owner, callCase.variant().rawCalleeCell()));</span>
<span class="udiff-line-modified-added">+     for (unsigned index = 0; index &lt; cases.size(); ++index) {</span>
<span class="udiff-line-modified-added">+         const PolymorphicCallCase&amp; callCase = cases[index];</span>
<span class="udiff-line-added">+         m_variants[index].set(vm, owner, callCase.variant().rawCalleeCell());</span>
          if (shouldDumpDisassemblyFor(callerFrame-&gt;codeBlock()))
              dataLog(&quot;Linking polymorphic call in &quot;, FullCodeOrigin(callerFrame-&gt;codeBlock(), callerFrame-&gt;codeOrigin()), &quot; to &quot;, callCase.variant(), &quot;, codeBlock = &quot;, pointerDump(callCase.codeBlock()), &quot;\n&quot;);
          if (CodeBlock* codeBlock = callCase.codeBlock())
              codeBlock-&gt;linkIncomingPolymorphicCall(callerFrame, m_callNodes.add(&amp;info));
      }
<span class="udiff-line-removed">-     m_variants.shrinkToFit();</span>
      WTF::storeStoreFence();
  }
  
  PolymorphicCallStubRoutine::~PolymorphicCallStubRoutine() { }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -127,15 +126,15 @@</span>
      }
  }
  
  bool PolymorphicCallStubRoutine::visitWeak(VM&amp; vm)
  {
<span class="udiff-line-modified-removed">-     for (auto&amp; variant : m_variants) {</span>
<span class="udiff-line-modified-removed">-         if (!vm.heap.isMarked(variant.get()))</span>
<span class="udiff-line-modified-removed">-             return false;</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-removed">-     return true;</span>
<span class="udiff-line-modified-added">+     bool isStillLive = true;</span>
<span class="udiff-line-modified-added">+     forEachDependentCell([&amp;](JSCell* cell) {</span>
<span class="udiff-line-modified-added">+         isStillLive &amp;= vm.heap.isMarked(cell);</span>
<span class="udiff-line-modified-added">+     });</span>
<span class="udiff-line-modified-added">+     return isStillLive;</span>
  }
  
  void PolymorphicCallStubRoutine::markRequiredObjectsInternal(SlotVisitor&amp; visitor)
  {
      for (auto&amp; variant : m_variants)
</pre>
<center><a href="PCToCodeOriginMap.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PolymorphicCallStubRoutine.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>