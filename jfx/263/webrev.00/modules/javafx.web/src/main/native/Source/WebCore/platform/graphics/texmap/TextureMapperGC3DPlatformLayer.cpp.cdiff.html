<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/texmap/TextureMapperGC3DPlatformLayer.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="BitmapTextureJava.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="TextureMapperGC3DPlatformLayer.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/texmap/TextureMapperGC3DPlatformLayer.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 18,28 ***</span>
   */
  
  #include &quot;config.h&quot;
  #include &quot;TextureMapperGC3DPlatformLayer.h&quot;
  
<span class="line-modified">! #if ENABLE(GRAPHICS_CONTEXT_3D) &amp;&amp; USE(TEXTURE_MAPPER) &amp;&amp; !USE(NICOSIA)</span>
  
  #include &quot;BitmapTextureGL.h&quot;
  #include &quot;GLContext.h&quot;
  #include &quot;TextureMapperGLHeaders.h&quot;
  #include &quot;TextureMapperPlatformLayerBuffer.h&quot;
  #include &quot;TextureMapperPlatformLayerProxy.h&quot;
  
  namespace WebCore {
  
<span class="line-modified">! TextureMapperGC3DPlatformLayer::TextureMapperGC3DPlatformLayer(GraphicsContext3D&amp; context, GraphicsContext3D::RenderStyle renderStyle)</span>
      : m_context(context)
  {
<span class="line-modified">!     switch (renderStyle) {</span>
<span class="line-modified">!     case GraphicsContext3D::RenderOffscreen:</span>
          m_glContext = GLContext::createOffscreenContext(&amp;PlatformDisplay::sharedDisplayForCompositing());
          break;
<span class="line-modified">!     case GraphicsContext3D::RenderDirectlyToHostWindow:</span>
          ASSERT_NOT_REACHED();
          break;
      }
  
  #if USE(COORDINATED_GRAPHICS)
<span class="line-new-header">--- 18,28 ---</span>
   */
  
  #include &quot;config.h&quot;
  #include &quot;TextureMapperGC3DPlatformLayer.h&quot;
  
<span class="line-modified">! #if ENABLE(GRAPHICS_CONTEXT_GL) &amp;&amp; USE(TEXTURE_MAPPER) &amp;&amp; !USE(NICOSIA)</span>
  
  #include &quot;BitmapTextureGL.h&quot;
  #include &quot;GLContext.h&quot;
  #include &quot;TextureMapperGLHeaders.h&quot;
  #include &quot;TextureMapperPlatformLayerBuffer.h&quot;
  #include &quot;TextureMapperPlatformLayerProxy.h&quot;
  
  namespace WebCore {
  
<span class="line-modified">! TextureMapperGC3DPlatformLayer::TextureMapperGC3DPlatformLayer(GraphicsContextGLOpenGL&amp; context, GraphicsContextGLOpenGL::Destination destination)</span>
      : m_context(context)
  {
<span class="line-modified">!     switch (destination) {</span>
<span class="line-modified">!     case GraphicsContextGLOpenGL::Destination::Offscreen:</span>
          m_glContext = GLContext::createOffscreenContext(&amp;PlatformDisplay::sharedDisplayForCompositing());
          break;
<span class="line-modified">!     case GraphicsContextGLOpenGL::Destination::DirectlyToHostWindow:</span>
          ASSERT_NOT_REACHED();
          break;
      }
  
  #if USE(COORDINATED_GRAPHICS)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 59,11 ***</span>
  {
      ASSERT(m_glContext);
      return m_glContext-&gt;makeContextCurrent();
  }
  
<span class="line-modified">! PlatformGraphicsContext3D TextureMapperGC3DPlatformLayer::platformContext()</span>
  {
      ASSERT(m_glContext);
      return m_glContext-&gt;platformContext();
  }
  
<span class="line-new-header">--- 59,11 ---</span>
  {
      ASSERT(m_glContext);
      return m_glContext-&gt;makeContextCurrent();
  }
  
<span class="line-modified">! PlatformGraphicsContextGL TextureMapperGC3DPlatformLayer::platformContext() const</span>
  {
      ASSERT(m_glContext);
      return m_glContext-&gt;platformContext();
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 95,28 ***</span>
      ASSERT(m_glContext);
  
      m_context.markLayerComposited();
  
  #if USE(TEXTURE_MAPPER_GL)
<span class="line-modified">!     if (m_context.m_attrs.antialias &amp;&amp; m_context.m_state.boundFBO == m_context.m_multisampleFBO) {</span>
          GLContext* previousActiveContext = GLContext::current();
          if (previousActiveContext != m_glContext.get())
              m_context.makeContextCurrent();
  
          m_context.resolveMultisamplingIfNecessary();
<span class="line-modified">!         ::glBindFramebuffer(GraphicsContext3D::FRAMEBUFFER, m_context.m_state.boundFBO);</span>
  
          if (previousActiveContext &amp;&amp; previousActiveContext != m_glContext.get())
              previousActiveContext-&gt;makeContextCurrent();
      }
  
      TextureMapperGL&amp; texmapGL = static_cast&lt;TextureMapperGL&amp;&gt;(textureMapper);
<span class="line-modified">!     TextureMapperGL::Flags flags = TextureMapperGL::ShouldFlipTexture | (m_context.m_attrs.alpha ? TextureMapperGL::ShouldBlend : 0);</span>
      IntSize textureSize(m_context.m_currentWidth, m_context.m_currentHeight);
      texmapGL.drawTexture(m_context.m_texture, flags, textureSize, targetRect, matrix, opacity);
  #endif // USE(TEXTURE_MAPPER_GL)
  }
  #endif // USE(COORDINATED_GRAPHICS)
  
  } // namespace WebCore
  
<span class="line-modified">! #endif // ENABLE(GRAPHICS_CONTEXT_3D) &amp;&amp; USE(TEXTURE_MAPPER)</span>
<span class="line-new-header">--- 95,29 ---</span>
      ASSERT(m_glContext);
  
      m_context.markLayerComposited();
  
  #if USE(TEXTURE_MAPPER_GL)
<span class="line-modified">!     auto attrs = m_context.contextAttributes();</span>
<span class="line-added">+     if (attrs.antialias &amp;&amp; m_context.m_state.boundFBO == m_context.m_multisampleFBO) {</span>
          GLContext* previousActiveContext = GLContext::current();
          if (previousActiveContext != m_glContext.get())
              m_context.makeContextCurrent();
  
          m_context.resolveMultisamplingIfNecessary();
<span class="line-modified">!         ::glBindFramebuffer(GraphicsContextGLOpenGL::FRAMEBUFFER, m_context.m_state.boundFBO);</span>
  
          if (previousActiveContext &amp;&amp; previousActiveContext != m_glContext.get())
              previousActiveContext-&gt;makeContextCurrent();
      }
  
      TextureMapperGL&amp; texmapGL = static_cast&lt;TextureMapperGL&amp;&gt;(textureMapper);
<span class="line-modified">!     TextureMapperGL::Flags flags = TextureMapperGL::ShouldFlipTexture | (attrs.alpha ? TextureMapperGL::ShouldBlend : 0);</span>
      IntSize textureSize(m_context.m_currentWidth, m_context.m_currentHeight);
      texmapGL.drawTexture(m_context.m_texture, flags, textureSize, targetRect, matrix, opacity);
  #endif // USE(TEXTURE_MAPPER_GL)
  }
  #endif // USE(COORDINATED_GRAPHICS)
  
  } // namespace WebCore
  
<span class="line-modified">! #endif // ENABLE(GRAPHICS_CONTEXT_GL) &amp;&amp; USE(TEXTURE_MAPPER)</span>
</pre>
<center><a href="BitmapTextureJava.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="TextureMapperGC3DPlatformLayer.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>