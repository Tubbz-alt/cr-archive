<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/GetByIdVariant.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="FullBytecodeLiveness.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="GetByIdVariant.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/GetByIdVariant.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (C) 2014-2018 Apple Inc. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (C) 2014-2020 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   * 1. Redistributions of source code must retain the above copyright
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -24,30 +24,33 @@</span>
   */
  
  #include &quot;config.h&quot;
  #include &quot;GetByIdVariant.h&quot;
  
<span class="udiff-line-added">+ #include &quot;CacheableIdentifierInlines.h&quot;</span>
  #include &quot;CallLinkStatus.h&quot;
  #include &quot;JSCInlines.h&quot;
  #include &lt;wtf/ListDump.h&gt;
  
  namespace JSC {
  
  GetByIdVariant::GetByIdVariant(
<span class="udiff-line-added">+     CacheableIdentifier identifier,</span>
      const StructureSet&amp; structureSet, PropertyOffset offset,
      const ObjectPropertyConditionSet&amp; conditionSet,
      std::unique_ptr&lt;CallLinkStatus&gt; callLinkStatus,
      JSFunction* intrinsicFunction,
      FunctionPtr&lt;OperationPtrTag&gt; customAccessorGetter,
<span class="udiff-line-modified-removed">-     Optional&lt;DOMAttributeAnnotation&gt; domAttribute)</span>
<span class="udiff-line-modified-added">+     std::unique_ptr&lt;DOMAttributeAnnotation&gt; domAttribute)</span>
      : m_structureSet(structureSet)
      , m_conditionSet(conditionSet)
      , m_offset(offset)
      , m_callLinkStatus(WTFMove(callLinkStatus))
      , m_intrinsicFunction(intrinsicFunction)
      , m_customAccessorGetter(customAccessorGetter)
<span class="udiff-line-modified-removed">-     , m_domAttribute(domAttribute)</span>
<span class="udiff-line-modified-added">+     , m_domAttribute(WTFMove(domAttribute))</span>
<span class="udiff-line-added">+     , m_identifier(WTFMove(identifier))</span>
  {
      if (!structureSet.size()) {
          ASSERT(offset == invalidOffset);
          ASSERT(conditionSet.isEmpty());
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -56,23 +59,27 @@</span>
  }
  
  GetByIdVariant::~GetByIdVariant() { }
  
  GetByIdVariant::GetByIdVariant(const GetByIdVariant&amp; other)
<span class="udiff-line-modified-removed">-     : GetByIdVariant()</span>
<span class="udiff-line-modified-added">+     : GetByIdVariant(other.m_identifier)</span>
  {
      *this = other;
  }
  
  GetByIdVariant&amp; GetByIdVariant::operator=(const GetByIdVariant&amp; other)
  {
<span class="udiff-line-added">+     m_identifier = other.m_identifier;</span>
      m_structureSet = other.m_structureSet;
      m_conditionSet = other.m_conditionSet;
      m_offset = other.m_offset;
      m_intrinsicFunction = other.m_intrinsicFunction;
      m_customAccessorGetter = other.m_customAccessorGetter;
<span class="udiff-line-modified-removed">-     m_domAttribute = other.m_domAttribute;</span>
<span class="udiff-line-modified-added">+     if (other.m_domAttribute)</span>
<span class="udiff-line-added">+         m_domAttribute = WTF::makeUnique&lt;DOMAttributeAnnotation&gt;(*other.m_domAttribute);</span>
<span class="udiff-line-added">+     else</span>
<span class="udiff-line-added">+         m_domAttribute = nullptr;</span>
      if (other.m_callLinkStatus)
          m_callLinkStatus = makeUnique&lt;CallLinkStatus&gt;(*other.m_callLinkStatus);
      else
          m_callLinkStatus = nullptr;
      return *this;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -99,10 +106,16 @@</span>
      RELEASE_ASSERT_NOT_REACHED();
  }
  
  bool GetByIdVariant::attemptToMerge(const GetByIdVariant&amp; other)
  {
<span class="udiff-line-added">+     if (!!m_identifier != !!other.m_identifier)</span>
<span class="udiff-line-added">+         return false;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if (m_identifier &amp;&amp; (m_identifier != other.m_identifier))</span>
<span class="udiff-line-added">+         return false;</span>
<span class="udiff-line-added">+ </span>
      if (m_offset != other.m_offset)
          return false;
  
      if (m_callLinkStatus || other.m_callLinkStatus) {
          if (!(m_callLinkStatus &amp;&amp; other.m_callLinkStatus))
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -142,10 +155,15 @@</span>
          m_callLinkStatus-&gt;merge(*other.m_callLinkStatus);
  
      return true;
  }
  
<span class="udiff-line-added">+ void GetByIdVariant::visitAggregate(SlotVisitor&amp; visitor)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     m_identifier.visitAggregate(visitor);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  void GetByIdVariant::markIfCheap(SlotVisitor&amp; visitor)
  {
      m_structureSet.markIfCheap(visitor);
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -167,17 +185,17 @@</span>
      dumpInContext(out, 0);
  }
  
  void GetByIdVariant::dumpInContext(PrintStream&amp; out, DumpContext* context) const
  {
<span class="udiff-line-added">+     out.print(&quot;&lt;&quot;);</span>
<span class="udiff-line-added">+     out.print(&quot;id=&#39;&quot;, m_identifier, &quot;&#39;, &quot;);</span>
      if (!isSet()) {
<span class="udiff-line-modified-removed">-         out.print(&quot;&lt;empty&gt;&quot;);</span>
<span class="udiff-line-modified-added">+         out.print(&quot;empty&gt;&quot;);</span>
          return;
      }
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-removed">-     out.print(</span>
<span class="udiff-line-removed">-         &quot;&lt;&quot;, inContext(structureSet(), context), &quot;, &quot;, inContext(m_conditionSet, context));</span>
<span class="udiff-line-modified-added">+     out.print(inContext(structureSet(), context), &quot;, &quot;, inContext(m_conditionSet, context));</span>
      out.print(&quot;, offset = &quot;, offset());
      if (m_callLinkStatus)
          out.print(&quot;, call = &quot;, *m_callLinkStatus);
      if (m_intrinsicFunction)
          out.print(&quot;, intrinsic = &quot;, *m_intrinsicFunction);
</pre>
<center><a href="FullBytecodeLiveness.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="GetByIdVariant.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>