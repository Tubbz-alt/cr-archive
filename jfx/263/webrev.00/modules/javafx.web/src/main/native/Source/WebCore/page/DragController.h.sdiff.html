<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/page/DragController.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DragController.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="EditorClient.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/page/DragController.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;DragActions.h&quot;
 29 #include &quot;DragImage.h&quot;
 30 #include &quot;IntPoint.h&quot;
 31 #include &quot;IntRect.h&quot;
 32 #include &lt;wtf/URL.h&gt;
 33 
 34 namespace WebCore {
 35 
 36 class DataTransfer;
 37 class Document;
 38 class DragClient;
 39 class DragData;
 40 class Element;
 41 class Frame;
 42 class FrameSelection;

 43 class HTMLInputElement;
 44 class IntRect;
 45 class Page;
 46 class PlatformMouseEvent;
 47 
 48 struct DragItem;
 49 struct DragState;
 50 struct PromisedAttachmentInfo;
 51 
 52     class DragController {
 53         WTF_MAKE_NONCOPYABLE(DragController); WTF_MAKE_FAST_ALLOCATED;
 54     public:
<span class="line-modified"> 55         DragController(Page&amp;, DragClient&amp;);</span>
 56         ~DragController();
 57 
<span class="line-removed"> 58         static std::unique_ptr&lt;DragController&gt; create(Page&amp;, DragClient&amp;);</span>
 59         static DragOperation platformGenericDragOperation();
 60 
<span class="line-removed"> 61         DragClient&amp; client() const { return m_client; }</span>
<span class="line-removed"> 62 </span>
 63         WEBCORE_EXPORT DragOperation dragEntered(const DragData&amp;);
 64         WEBCORE_EXPORT void dragExited(const DragData&amp;);
 65         WEBCORE_EXPORT DragOperation dragUpdated(const DragData&amp;);
 66         WEBCORE_EXPORT bool performDragOperation(const DragData&amp;);
 67         WEBCORE_EXPORT void dragCancelled();
 68 
 69         bool mouseIsOverFileInput() const { return m_fileInputElementUnderMouse; }
 70         unsigned numberOfItemsToBeAccepted() const { return m_numberOfItemsToBeAccepted; }
 71 
 72         // FIXME: It should be possible to remove a number of these accessors once all
 73         // drag logic is in WebCore.
 74         void setDidInitiateDrag(bool initiated) { m_didInitiateDrag = initiated; }
 75         bool didInitiateDrag() const { return m_didInitiateDrag; }
 76         DragOperation sourceDragOperation() const { return m_sourceDragOperation; }
 77         const URL&amp; draggingImageURL() const { return m_draggingImageURL; }
 78         void setDragOffset(const IntPoint&amp; offset) { m_dragOffset = offset; }
 79         const IntPoint&amp; dragOffset() const { return m_dragOffset; }
 80         DragSourceAction dragSourceAction() const { return m_dragSourceAction; }
 81         DragHandlingMethod dragHandlingMethod() const { return m_dragHandlingMethod; }
 82 
 83         Document* documentUnderMouse() const { return m_documentUnderMouse.get(); }
 84         DragDestinationAction dragDestinationAction() const { return m_dragDestinationAction; }
 85         DragSourceAction delegateDragSourceAction(const IntPoint&amp; rootViewPoint);
 86 
 87         Element* draggableElement(const Frame*, Element* start, const IntPoint&amp;, DragState&amp;) const;
 88         WEBCORE_EXPORT void dragEnded();
 89 
 90         WEBCORE_EXPORT void placeDragCaret(const IntPoint&amp;);
 91 






 92         bool startDrag(Frame&amp; src, const DragState&amp;, DragOperation srcOp, const PlatformMouseEvent&amp; dragEvent, const IntPoint&amp; dragOrigin, HasNonDefaultPasteboardData);
 93         static const IntSize&amp; maxDragImageSize();
 94 
 95         static const int MaxOriginalImageArea;
 96         static const int DragIconRightInset;
 97         static const int DragIconBottomInset;
 98         static const float DragImageAlpha;
 99 
100     private:
101         void updateSupportedTypeIdentifiersForDragHandlingMethod(DragHandlingMethod, const DragData&amp;) const;
102         bool dispatchTextInputEventFor(Frame*, const DragData&amp;);
103         bool canProcessDrag(const DragData&amp;);
104         bool concludeEditDrag(const DragData&amp;);
105         DragOperation dragEnteredOrUpdated(const DragData&amp;);
106         DragOperation operationForLoad(const DragData&amp;);
107         DragHandlingMethod tryDocumentDrag(const DragData&amp;, DragDestinationAction, DragOperation&amp;);
108         bool tryDHTMLDrag(const DragData&amp;, DragOperation&amp;);
109         DragOperation dragOperation(const DragData&amp;);
110         void clearDragCaret();
111         bool dragIsMove(FrameSelection&amp;, const DragData&amp;);
112         bool isCopyKeyDown(const DragData&amp;);
113 
114         void mouseMovedIntoDocument(Document*);
115         bool shouldUseCachedImageForDragImage(const Image&amp;) const;
116 
117         void doImageDrag(Element&amp;, const IntPoint&amp;, const IntRect&amp;, Frame&amp;, IntPoint&amp;, const DragState&amp;, PromisedAttachmentInfo&amp;&amp;);
118         void doSystemDrag(DragImage, const IntPoint&amp;, const IntPoint&amp;, Frame&amp;, const DragState&amp;, PromisedAttachmentInfo&amp;&amp;);
119 
120         void beginDrag(DragItem, Frame&amp;, const IntPoint&amp; mouseDownPoint, const IntPoint&amp; mouseDraggedPoint, DataTransfer&amp;, DragSourceAction);
121 
122         bool canLoadDataFromDraggingPasteboard() const
123         {
124 #if ENABLE(DATA_INTERACTION)
125             return m_isPerformingDrop;
126 #else
127             return true;
128 #endif
129         }
130 





131         String platformContentTypeForBlobType(const String&amp; type) const;
132 
133         void cleanupAfterSystemDrag();
134         void declareAndWriteDragImage(DataTransfer&amp;, Element&amp;, const URL&amp;, const String&amp; label);
135 
136 #if ENABLE(ATTACHMENT_ELEMENT)
137         PromisedAttachmentInfo promisedAttachmentInfo(Frame&amp;, Element&amp;);
138 #endif
139         Page&amp; m_page;
<span class="line-modified">140         DragClient&amp; m_client;</span>
141 
142         RefPtr&lt;Document&gt; m_documentUnderMouse; // The document the mouse was last dragged over.
143         RefPtr&lt;Document&gt; m_dragInitiator; // The Document (if any) that initiated the drag.
144         RefPtr&lt;HTMLInputElement&gt; m_fileInputElementUnderMouse;
145         unsigned m_numberOfItemsToBeAccepted { 0 };
146         DragHandlingMethod m_dragHandlingMethod { DragHandlingMethod::None };
147 
148         DragDestinationAction m_dragDestinationAction { DragDestinationActionNone };
149         DragSourceAction m_dragSourceAction { DragSourceActionNone };
150         bool m_didInitiateDrag { false };
151         DragOperation m_sourceDragOperation { DragOperationNone }; // Set in startDrag when a drag starts from a mouse down within WebKit
152         IntPoint m_dragOffset;
153         URL m_draggingImageURL;
154         bool m_isPerformingDrop { false };


155     };
156 
157     WEBCORE_EXPORT bool isDraggableLink(const Element&amp;);
158 
159 } // namespace WebCore
</pre>
</td>
<td>
<hr />
<pre>
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;DragActions.h&quot;
 29 #include &quot;DragImage.h&quot;
 30 #include &quot;IntPoint.h&quot;
 31 #include &quot;IntRect.h&quot;
 32 #include &lt;wtf/URL.h&gt;
 33 
 34 namespace WebCore {
 35 
 36 class DataTransfer;
 37 class Document;
 38 class DragClient;
 39 class DragData;
 40 class Element;
 41 class Frame;
 42 class FrameSelection;
<span class="line-added"> 43 class HTMLImageElement;</span>
 44 class HTMLInputElement;
 45 class IntRect;
 46 class Page;
 47 class PlatformMouseEvent;
 48 
 49 struct DragItem;
 50 struct DragState;
 51 struct PromisedAttachmentInfo;
 52 
 53     class DragController {
 54         WTF_MAKE_NONCOPYABLE(DragController); WTF_MAKE_FAST_ALLOCATED;
 55     public:
<span class="line-modified"> 56         DragController(Page&amp;, std::unique_ptr&lt;DragClient&gt;&amp;&amp;);</span>
 57         ~DragController();
 58 

 59         static DragOperation platformGenericDragOperation();
 60 


 61         WEBCORE_EXPORT DragOperation dragEntered(const DragData&amp;);
 62         WEBCORE_EXPORT void dragExited(const DragData&amp;);
 63         WEBCORE_EXPORT DragOperation dragUpdated(const DragData&amp;);
 64         WEBCORE_EXPORT bool performDragOperation(const DragData&amp;);
 65         WEBCORE_EXPORT void dragCancelled();
 66 
 67         bool mouseIsOverFileInput() const { return m_fileInputElementUnderMouse; }
 68         unsigned numberOfItemsToBeAccepted() const { return m_numberOfItemsToBeAccepted; }
 69 
 70         // FIXME: It should be possible to remove a number of these accessors once all
 71         // drag logic is in WebCore.
 72         void setDidInitiateDrag(bool initiated) { m_didInitiateDrag = initiated; }
 73         bool didInitiateDrag() const { return m_didInitiateDrag; }
 74         DragOperation sourceDragOperation() const { return m_sourceDragOperation; }
 75         const URL&amp; draggingImageURL() const { return m_draggingImageURL; }
 76         void setDragOffset(const IntPoint&amp; offset) { m_dragOffset = offset; }
 77         const IntPoint&amp; dragOffset() const { return m_dragOffset; }
 78         DragSourceAction dragSourceAction() const { return m_dragSourceAction; }
 79         DragHandlingMethod dragHandlingMethod() const { return m_dragHandlingMethod; }
 80 
 81         Document* documentUnderMouse() const { return m_documentUnderMouse.get(); }
 82         DragDestinationAction dragDestinationAction() const { return m_dragDestinationAction; }
 83         DragSourceAction delegateDragSourceAction(const IntPoint&amp; rootViewPoint);
 84 
 85         Element* draggableElement(const Frame*, Element* start, const IntPoint&amp;, DragState&amp;) const;
 86         WEBCORE_EXPORT void dragEnded();
 87 
 88         WEBCORE_EXPORT void placeDragCaret(const IntPoint&amp;);
 89 
<span class="line-added"> 90         const Vector&lt;Ref&lt;HTMLImageElement&gt;&gt;&amp; droppedImagePlaceholders() const { return m_droppedImagePlaceholders; }</span>
<span class="line-added"> 91         const RefPtr&lt;Range&gt;&amp; droppedImagePlaceholderRange() const { return m_droppedImagePlaceholderRange; }</span>
<span class="line-added"> 92 </span>
<span class="line-added"> 93         WEBCORE_EXPORT void finalizeDroppedImagePlaceholder(HTMLImageElement&amp;);</span>
<span class="line-added"> 94         WEBCORE_EXPORT void insertDroppedImagePlaceholdersAtCaret(const Vector&lt;IntSize&gt;&amp; imageSizes);</span>
<span class="line-added"> 95 </span>
 96         bool startDrag(Frame&amp; src, const DragState&amp;, DragOperation srcOp, const PlatformMouseEvent&amp; dragEvent, const IntPoint&amp; dragOrigin, HasNonDefaultPasteboardData);
 97         static const IntSize&amp; maxDragImageSize();
 98 
 99         static const int MaxOriginalImageArea;
100         static const int DragIconRightInset;
101         static const int DragIconBottomInset;
102         static const float DragImageAlpha;
103 
104     private:
105         void updateSupportedTypeIdentifiersForDragHandlingMethod(DragHandlingMethod, const DragData&amp;) const;
106         bool dispatchTextInputEventFor(Frame*, const DragData&amp;);
107         bool canProcessDrag(const DragData&amp;);
108         bool concludeEditDrag(const DragData&amp;);
109         DragOperation dragEnteredOrUpdated(const DragData&amp;);
110         DragOperation operationForLoad(const DragData&amp;);
111         DragHandlingMethod tryDocumentDrag(const DragData&amp;, DragDestinationAction, DragOperation&amp;);
112         bool tryDHTMLDrag(const DragData&amp;, DragOperation&amp;);
113         DragOperation dragOperation(const DragData&amp;);
114         void clearDragCaret();
115         bool dragIsMove(FrameSelection&amp;, const DragData&amp;);
116         bool isCopyKeyDown(const DragData&amp;);
117 
118         void mouseMovedIntoDocument(Document*);
119         bool shouldUseCachedImageForDragImage(const Image&amp;) const;
120 
121         void doImageDrag(Element&amp;, const IntPoint&amp;, const IntRect&amp;, Frame&amp;, IntPoint&amp;, const DragState&amp;, PromisedAttachmentInfo&amp;&amp;);
122         void doSystemDrag(DragImage, const IntPoint&amp;, const IntPoint&amp;, Frame&amp;, const DragState&amp;, PromisedAttachmentInfo&amp;&amp;);
123 
124         void beginDrag(DragItem, Frame&amp;, const IntPoint&amp; mouseDownPoint, const IntPoint&amp; mouseDraggedPoint, DataTransfer&amp;, DragSourceAction);
125 
126         bool canLoadDataFromDraggingPasteboard() const
127         {
128 #if ENABLE(DATA_INTERACTION)
129             return m_isPerformingDrop;
130 #else
131             return true;
132 #endif
133         }
134 
<span class="line-added">135         DragClient&amp; client() const { return *m_client; }</span>
<span class="line-added">136 </span>
<span class="line-added">137         bool tryToUpdateDroppedImagePlaceholders(const DragData&amp;);</span>
<span class="line-added">138         void removeAllDroppedImagePlaceholders();</span>
<span class="line-added">139 </span>
140         String platformContentTypeForBlobType(const String&amp; type) const;
141 
142         void cleanupAfterSystemDrag();
143         void declareAndWriteDragImage(DataTransfer&amp;, Element&amp;, const URL&amp;, const String&amp; label);
144 
145 #if ENABLE(ATTACHMENT_ELEMENT)
146         PromisedAttachmentInfo promisedAttachmentInfo(Frame&amp;, Element&amp;);
147 #endif
148         Page&amp; m_page;
<span class="line-modified">149         std::unique_ptr&lt;DragClient&gt; m_client;</span>
150 
151         RefPtr&lt;Document&gt; m_documentUnderMouse; // The document the mouse was last dragged over.
152         RefPtr&lt;Document&gt; m_dragInitiator; // The Document (if any) that initiated the drag.
153         RefPtr&lt;HTMLInputElement&gt; m_fileInputElementUnderMouse;
154         unsigned m_numberOfItemsToBeAccepted { 0 };
155         DragHandlingMethod m_dragHandlingMethod { DragHandlingMethod::None };
156 
157         DragDestinationAction m_dragDestinationAction { DragDestinationActionNone };
158         DragSourceAction m_dragSourceAction { DragSourceActionNone };
159         bool m_didInitiateDrag { false };
160         DragOperation m_sourceDragOperation { DragOperationNone }; // Set in startDrag when a drag starts from a mouse down within WebKit
161         IntPoint m_dragOffset;
162         URL m_draggingImageURL;
163         bool m_isPerformingDrop { false };
<span class="line-added">164         Vector&lt;Ref&lt;HTMLImageElement&gt;&gt; m_droppedImagePlaceholders;</span>
<span class="line-added">165         RefPtr&lt;Range&gt; m_droppedImagePlaceholderRange;</span>
166     };
167 
168     WEBCORE_EXPORT bool isDraggableLink(const Element&amp;);
169 
170 } // namespace WebCore
</pre>
</td>
</tr>
</table>
<center><a href="DragController.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="EditorClient.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>