<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/SpeculatedType.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SpeculatedType.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="StructureStubClearingWatchpoint.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/bytecode/SpeculatedType.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (C) 2011-2017 Apple Inc. All rights reserved.</span>
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  *
  8  * 1.  Redistributions of source code must retain the above copyright
  9  *     notice, this list of conditions and the following disclaimer.
 10  * 2.  Redistributions in binary form must reproduce the above copyright
 11  *     notice, this list of conditions and the following disclaimer in the
 12  *     documentation and/or other materials provided with the distribution.
 13  * 3.  Neither the name of Apple Inc. (&quot;Apple&quot;) nor the names of
 14  *     its contributors may be used to endorse or promote products derived
 15  *     from this software without specific prior written permission.
 16  *
 17  * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS &quot;AS IS&quot; AND ANY
 18  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 19  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 20  * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 21  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 22  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 23  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 24  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 25  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 26  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 27  */
 28 
 29 #pragma once
 30 
 31 #include &quot;CPU.h&quot;
 32 #include &quot;JSCJSValue.h&quot;
 33 #include &quot;TypedArrayType.h&quot;
 34 #include &lt;wtf/PrintStream.h&gt;
 35 
 36 namespace JSC {
 37 
 38 class Structure;
 39 
 40 typedef uint64_t SpeculatedType;
<span class="line-modified"> 41 static const SpeculatedType SpecNone                              = 0; // We don&#39;t know anything yet.</span>
<span class="line-modified"> 42 static const SpeculatedType SpecFinalObject                       = 1ull &lt;&lt; 0; // It&#39;s definitely a JSFinalObject.</span>
<span class="line-modified"> 43 static const SpeculatedType SpecArray                             = 1ull &lt;&lt; 1; // It&#39;s definitely a JSArray.</span>
<span class="line-modified"> 44 static const SpeculatedType SpecFunctionWithDefaultHasInstance    = 1ull &lt;&lt; 2; // It&#39;s definitely a JSFunction that has its ImplementsDefaultHasInstance type info flags bit set.</span>
<span class="line-modified"> 45 static const SpeculatedType SpecFunctionWithNonDefaultHasInstance = 1ull &lt;&lt; 3; // It&#39;s definitely a JSFunction that does not have its ImplementsDefaultHasInstance type info flags bit set.</span>
<span class="line-modified"> 46 static const SpeculatedType SpecFunction                          = SpecFunctionWithDefaultHasInstance | SpecFunctionWithNonDefaultHasInstance; // It&#39;s definitely a JSFunction.</span>
<span class="line-modified"> 47 static const SpeculatedType SpecInt8Array                         = 1ull &lt;&lt; 4; // It&#39;s definitely an Int8Array or one of its subclasses.</span>
<span class="line-modified"> 48 static const SpeculatedType SpecInt16Array                        = 1ull &lt;&lt; 5; // It&#39;s definitely an Int16Array or one of its subclasses.</span>
<span class="line-modified"> 49 static const SpeculatedType SpecInt32Array                        = 1ull &lt;&lt; 6; // It&#39;s definitely an Int32Array or one of its subclasses.</span>
<span class="line-modified"> 50 static const SpeculatedType SpecUint8Array                        = 1ull &lt;&lt; 7; // It&#39;s definitely an Uint8Array or one of its subclasses.</span>
<span class="line-modified"> 51 static const SpeculatedType SpecUint8ClampedArray                 = 1ull &lt;&lt; 8; // It&#39;s definitely an Uint8ClampedArray or one of its subclasses.</span>
<span class="line-modified"> 52 static const SpeculatedType SpecUint16Array                       = 1ull &lt;&lt; 9; // It&#39;s definitely an Uint16Array or one of its subclasses.</span>
<span class="line-modified"> 53 static const SpeculatedType SpecUint32Array                       = 1ull &lt;&lt; 10; // It&#39;s definitely an Uint32Array or one of its subclasses.</span>
<span class="line-modified"> 54 static const SpeculatedType SpecFloat32Array                      = 1ull &lt;&lt; 11; // It&#39;s definitely an Uint16Array or one of its subclasses.</span>
<span class="line-modified"> 55 static const SpeculatedType SpecFloat64Array                      = 1ull &lt;&lt; 12; // It&#39;s definitely an Uint16Array or one of its subclasses.</span>
<span class="line-modified"> 56 static const SpeculatedType SpecTypedArrayView                    = SpecInt8Array | SpecInt16Array | SpecInt32Array | SpecUint8Array | SpecUint8ClampedArray | SpecUint16Array | SpecUint32Array | SpecFloat32Array | SpecFloat64Array;</span>
<span class="line-modified"> 57 static const SpeculatedType SpecDirectArguments                   = 1ull &lt;&lt; 13; // It&#39;s definitely a DirectArguments object.</span>
<span class="line-modified"> 58 static const SpeculatedType SpecScopedArguments                   = 1ull &lt;&lt; 14; // It&#39;s definitely a ScopedArguments object.</span>
<span class="line-modified"> 59 static const SpeculatedType SpecStringObject                      = 1ull &lt;&lt; 15; // It&#39;s definitely a StringObject.</span>
<span class="line-modified"> 60 static const SpeculatedType SpecRegExpObject                      = 1ull &lt;&lt; 16; // It&#39;s definitely a RegExpObject (and not any subclass of RegExpObject).</span>
<span class="line-modified"> 61 static const SpeculatedType SpecMapObject                         = 1ull &lt;&lt; 17; // It&#39;s definitely a Map object or one of its subclasses.</span>
<span class="line-modified"> 62 static const SpeculatedType SpecSetObject                         = 1ull &lt;&lt; 18; // It&#39;s definitely a Set object or one of its subclasses.</span>
<span class="line-modified"> 63 static const SpeculatedType SpecWeakMapObject                     = 1ull &lt;&lt; 19; // It&#39;s definitely a WeakMap object or one of its subclasses.</span>
<span class="line-modified"> 64 static const SpeculatedType SpecWeakSetObject                     = 1ull &lt;&lt; 20; // It&#39;s definitely a WeakSet object or one of its subclasses.</span>
<span class="line-modified"> 65 static const SpeculatedType SpecProxyObject                       = 1ull &lt;&lt; 21; // It&#39;s definitely a Proxy object or one of its subclasses.</span>
<span class="line-modified"> 66 static const SpeculatedType SpecDerivedArray                      = 1ull &lt;&lt; 22; // It&#39;s definitely a DerivedArray object.</span>
<span class="line-modified"> 67 static const SpeculatedType SpecObjectOther                       = 1ull &lt;&lt; 23; // It&#39;s definitely an object but not JSFinalObject, JSArray, or JSFunction.</span>
<span class="line-modified"> 68 static const SpeculatedType SpecStringIdent                       = 1ull &lt;&lt; 24; // It&#39;s definitely a JSString, and it&#39;s an identifier.</span>
<span class="line-modified"> 69 static const SpeculatedType SpecStringVar                         = 1ull &lt;&lt; 25; // It&#39;s definitely a JSString, and it&#39;s not an identifier.</span>
<span class="line-modified"> 70 static const SpeculatedType SpecString                            = SpecStringIdent | SpecStringVar; // It&#39;s definitely a JSString.</span>
<span class="line-modified"> 71 static const SpeculatedType SpecSymbol                            = 1ull &lt;&lt; 26; // It&#39;s definitely a Symbol.</span>
<span class="line-modified"> 72 static const SpeculatedType SpecCellOther                         = 1ull &lt;&lt; 27; // It&#39;s definitely a JSCell but not a subclass of JSObject and definitely not a JSString, BigInt, or Symbol.</span>
<span class="line-modified"> 73 static const SpeculatedType SpecBoolInt32                         = 1ull &lt;&lt; 28; // It&#39;s definitely an Int32 with value 0 or 1.</span>
<span class="line-modified"> 74 static const SpeculatedType SpecNonBoolInt32                      = 1ull &lt;&lt; 29; // It&#39;s definitely an Int32 with value other than 0 or 1.</span>
<span class="line-modified"> 75 static const SpeculatedType SpecInt32Only                         = SpecBoolInt32 | SpecNonBoolInt32; // It&#39;s definitely an Int32.</span>
<span class="line-modified"> 76 </span>
<span class="line-modified"> 77 static const SpeculatedType SpecInt32AsInt52                      = 1ull &lt;&lt; 30; // It&#39;s an Int52 and it can fit in an int32.</span>
<span class="line-modified"> 78 static const SpeculatedType SpecNonInt32AsInt52                   = 1ull &lt;&lt; 31; // It&#39;s an Int52 and it can&#39;t fit in an int32.</span>
<span class="line-modified"> 79 static const SpeculatedType SpecInt52Any                          = SpecInt32AsInt52 | SpecNonInt32AsInt52; // It&#39;s any kind of Int52.</span>
<span class="line-modified"> 80 </span>
<span class="line-modified"> 81 static const SpeculatedType SpecAnyIntAsDouble                    = 1ull &lt;&lt; 32; // It&#39;s definitely an Int52 and it&#39;s inside a double.</span>
<span class="line-modified"> 82 static const SpeculatedType SpecNonIntAsDouble                    = 1ull &lt;&lt; 33; // It&#39;s definitely not an Int52 but it&#39;s a real number and it&#39;s a double.</span>
<span class="line-modified"> 83 static const SpeculatedType SpecDoubleReal                        = SpecNonIntAsDouble | SpecAnyIntAsDouble; // It&#39;s definitely a non-NaN double.</span>
<span class="line-modified"> 84 static const SpeculatedType SpecDoublePureNaN                     = 1ull &lt;&lt; 34; // It&#39;s definitely a NaN that is safe to tag (i.e. pure).</span>
<span class="line-modified"> 85 static const SpeculatedType SpecDoubleImpureNaN                   = 1ull &lt;&lt; 35; // It&#39;s definitely a NaN that is unsafe to tag (i.e. impure).</span>
<span class="line-modified"> 86 static const SpeculatedType SpecDoubleNaN                         = SpecDoublePureNaN | SpecDoubleImpureNaN; // It&#39;s definitely some kind of NaN.</span>
<span class="line-modified"> 87 static const SpeculatedType SpecBytecodeDouble                    = SpecDoubleReal | SpecDoublePureNaN; // It&#39;s either a non-NaN or a NaN double, but it&#39;s definitely not impure NaN.</span>
<span class="line-modified"> 88 static const SpeculatedType SpecFullDouble                        = SpecDoubleReal | SpecDoubleNaN; // It&#39;s either a non-NaN or a NaN double.</span>
<span class="line-modified"> 89 static const SpeculatedType SpecBytecodeRealNumber                = SpecInt32Only | SpecDoubleReal; // It&#39;s either an Int32 or a DoubleReal.</span>
<span class="line-modified"> 90 static const SpeculatedType SpecFullRealNumber                    = SpecInt32Only | SpecInt52Any | SpecDoubleReal; // It&#39;s either an Int32 or a DoubleReal, or an Int52.</span>
<span class="line-modified"> 91 static const SpeculatedType SpecBytecodeNumber                    = SpecInt32Only | SpecBytecodeDouble; // It&#39;s either an Int32 or a Double, and the Double cannot be an impure NaN.</span>
<span class="line-modified"> 92 static const SpeculatedType SpecIntAnyFormat                      = SpecInt52Any | SpecInt32Only | SpecAnyIntAsDouble;</span>
<span class="line-modified"> 93 </span>
<span class="line-modified"> 94 static const SpeculatedType SpecFullNumber                        = SpecIntAnyFormat | SpecFullDouble; // It&#39;s either an Int32, Int52, or a Double, and the Double can be impure NaN.</span>
<span class="line-modified"> 95 static const SpeculatedType SpecBoolean                           = 1ull &lt;&lt; 36; // It&#39;s definitely a Boolean.</span>
<span class="line-modified"> 96 static const SpeculatedType SpecOther                             = 1ull &lt;&lt; 37; // It&#39;s definitely either Null or Undefined.</span>
<span class="line-modified"> 97 static const SpeculatedType SpecMisc                              = SpecBoolean | SpecOther; // It&#39;s definitely either a boolean, Null, or Undefined.</span>
<span class="line-modified"> 98 static const SpeculatedType SpecEmpty                             = 1ull &lt;&lt; 38; // It&#39;s definitely an empty value marker.</span>
<span class="line-modified"> 99 static const SpeculatedType SpecBigInt                            = 1ull &lt;&lt; 39; // It&#39;s definitely a BigInt.</span>
<span class="line-modified">100 static const SpeculatedType SpecDataViewObject                    = 1ull &lt;&lt; 40; // It&#39;s definitely a JSDataView.</span>
<span class="line-modified">101 static const SpeculatedType SpecPrimitive                         = SpecString | SpecSymbol | SpecBytecodeNumber | SpecMisc | SpecBigInt; // It&#39;s any non-Object JSValue.</span>
<span class="line-modified">102 static const SpeculatedType SpecObject                            = SpecFinalObject | SpecArray | SpecFunction | SpecTypedArrayView | SpecDirectArguments | SpecScopedArguments | SpecStringObject | SpecRegExpObject | SpecMapObject | SpecSetObject | SpecWeakMapObject | SpecWeakSetObject | SpecProxyObject | SpecDerivedArray | SpecObjectOther | SpecDataViewObject; // Bitmask used for testing for any kind of object prediction.</span>
<span class="line-modified">103 static const SpeculatedType SpecCell                              = SpecObject | SpecString | SpecSymbol | SpecCellOther | SpecBigInt; // It&#39;s definitely a JSCell.</span>
<span class="line-modified">104 static const SpeculatedType SpecHeapTop                           = SpecCell | SpecBytecodeNumber | SpecMisc; // It can be any of the above, except for SpecInt52Only and SpecDoubleImpureNaN.</span>
<span class="line-modified">105 static const SpeculatedType SpecBytecodeTop                       = SpecHeapTop | SpecEmpty; // It can be any of the above, except for SpecInt52Only and SpecDoubleImpureNaN. Corresponds to what could be found in a bytecode local.</span>
<span class="line-modified">106 static const SpeculatedType SpecFullTop                           = SpecBytecodeTop | SpecFullNumber; // It can be anything that bytecode could see plus exotic encodings of numbers.</span>


107 
108 // SpecCellCheck is the type set representing the values that can flow through a cell check.
109 // On 64-bit platforms, the empty value passes a cell check. Also, ~SpecCellCheck is the type
110 // set that representing the values that flow through when testing that something is not a cell.
<span class="line-modified">111 static const SpeculatedType SpecCellCheck          = is64Bit() ? (SpecCell | SpecEmpty) : SpecCell;</span>
112 
113 typedef bool (*SpeculatedTypeChecker)(SpeculatedType);
114 
115 // Dummy prediction checker, only useful if someone insists on requiring a prediction checker.
116 inline bool isAnySpeculation(SpeculatedType)
117 {
118     return true;
119 }
120 
121 inline bool isCellSpeculation(SpeculatedType value)
122 {
123     return !!(value &amp; SpecCell) &amp;&amp; !(value &amp; ~SpecCell);
124 }
125 
126 inline bool isCellOrOtherSpeculation(SpeculatedType value)
127 {
128     return !!value &amp;&amp; !(value &amp; ~(SpecCell | SpecOther));
129 }
130 
131 inline bool isNotCellSpeculation(SpeculatedType value)
</pre>
<hr />
<pre>
325     return value == SpecBoolInt32;
326 }
327 
328 inline bool isInt32Speculation(SpeculatedType value)
329 {
330     return value &amp;&amp; !(value &amp; ~SpecInt32Only);
331 }
332 
333 inline bool isNotInt32Speculation(SpeculatedType value)
334 {
335     return value &amp;&amp; !(value &amp; SpecInt32Only);
336 }
337 
338 inline bool isInt32OrBooleanSpeculation(SpeculatedType value)
339 {
340     return value &amp;&amp; !(value &amp; ~(SpecBoolean | SpecInt32Only));
341 }
342 
343 inline bool isInt32SpeculationForArithmetic(SpeculatedType value)
344 {
<span class="line-modified">345     return !(value &amp; (SpecFullDouble | SpecNonInt32AsInt52));</span>
346 }
347 
348 inline bool isInt32OrBooleanSpeculationForArithmetic(SpeculatedType value)
349 {
<span class="line-modified">350     return !(value &amp; (SpecFullDouble | SpecNonInt32AsInt52));</span>
351 }
352 
353 inline bool isInt32OrBooleanSpeculationExpectingDefined(SpeculatedType value)
354 {
355     return isInt32OrBooleanSpeculation(value &amp; ~SpecOther);
356 }
357 
358 inline bool isAnyInt52Speculation(SpeculatedType value)
359 {
360     return !!value &amp;&amp; (value &amp; SpecInt52Any) == value;
361 }
362 
363 inline bool isInt32OrInt52Speculation(SpeculatedType value)
364 {
365     return !!value &amp;&amp; (value &amp; (SpecInt32Only | SpecInt52Any)) == value;
366 }
367 
368 inline bool isIntAnyFormat(SpeculatedType value)
369 {
370     return !!value &amp;&amp; (value &amp; SpecIntAnyFormat) == value;
</pre>
<hr />
<pre>
479 inline bool mergeSpeculation(T&amp; left, SpeculatedType right)
480 {
481     SpeculatedType newSpeculation = static_cast&lt;T&gt;(mergeSpeculations(static_cast&lt;SpeculatedType&gt;(left), right));
482     bool result = newSpeculation != static_cast&lt;SpeculatedType&gt;(left);
483     left = newSpeculation;
484     return result;
485 }
486 
487 inline bool speculationChecked(SpeculatedType actual, SpeculatedType desired)
488 {
489     return (actual | desired) == desired;
490 }
491 
492 SpeculatedType speculationFromClassInfo(const ClassInfo*);
493 SpeculatedType speculationFromStructure(Structure*);
494 SpeculatedType speculationFromCell(JSCell*);
495 JS_EXPORT_PRIVATE SpeculatedType speculationFromValue(JSValue);
496 // If it&#39;s an anyInt(), it&#39;ll return speculated types from the Int52 lattice.
497 // Otherwise, it&#39;ll return types from the JSValue lattice.
498 JS_EXPORT_PRIVATE SpeculatedType int52AwareSpeculationFromValue(JSValue);
<span class="line-modified">499 SpeculatedType speculationFromJSType(JSType);</span>
500 
501 SpeculatedType speculationFromTypedArrayType(TypedArrayType); // only valid for typed views.
502 TypedArrayType typedArrayTypeFromSpeculation(SpeculatedType);
503 
504 SpeculatedType leastUpperBoundOfStrictlyEquivalentSpeculations(SpeculatedType);
505 
506 bool valuesCouldBeEqual(SpeculatedType, SpeculatedType);
507 
508 // Precise computation of the type of the result of a double computation after we
509 // already know that the inputs are doubles and that the result must be a double. Use
510 // the closest one of these that applies.
511 SpeculatedType typeOfDoubleSum(SpeculatedType, SpeculatedType);
512 SpeculatedType typeOfDoubleDifference(SpeculatedType, SpeculatedType);

513 SpeculatedType typeOfDoubleProduct(SpeculatedType, SpeculatedType);
514 SpeculatedType typeOfDoubleQuotient(SpeculatedType, SpeculatedType);
515 SpeculatedType typeOfDoubleMinMax(SpeculatedType, SpeculatedType);
516 SpeculatedType typeOfDoubleNegation(SpeculatedType);
517 SpeculatedType typeOfDoubleAbs(SpeculatedType);
518 SpeculatedType typeOfDoubleRounding(SpeculatedType);
519 SpeculatedType typeOfDoublePow(SpeculatedType, SpeculatedType);
520 
521 // This conservatively models the behavior of arbitrary double operations.
522 SpeculatedType typeOfDoubleBinaryOp(SpeculatedType, SpeculatedType);
523 SpeculatedType typeOfDoubleUnaryOp(SpeculatedType);
524 
525 // This is mostly for debugging so we can fill profiles from strings.
526 SpeculatedType speculationFromString(const char*);
527 
528 } // namespace JSC
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (C) 2011-2019 Apple Inc. All rights reserved.</span>
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  *
  8  * 1.  Redistributions of source code must retain the above copyright
  9  *     notice, this list of conditions and the following disclaimer.
 10  * 2.  Redistributions in binary form must reproduce the above copyright
 11  *     notice, this list of conditions and the following disclaimer in the
 12  *     documentation and/or other materials provided with the distribution.
 13  * 3.  Neither the name of Apple Inc. (&quot;Apple&quot;) nor the names of
 14  *     its contributors may be used to endorse or promote products derived
 15  *     from this software without specific prior written permission.
 16  *
 17  * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS &quot;AS IS&quot; AND ANY
 18  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 19  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 20  * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 21  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 22  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 23  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 24  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 25  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 26  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 27  */
 28 
 29 #pragma once
 30 
 31 #include &quot;CPU.h&quot;
 32 #include &quot;JSCJSValue.h&quot;
 33 #include &quot;TypedArrayType.h&quot;
 34 #include &lt;wtf/PrintStream.h&gt;
 35 
 36 namespace JSC {
 37 
 38 class Structure;
 39 
 40 typedef uint64_t SpeculatedType;
<span class="line-modified"> 41 static constexpr SpeculatedType SpecNone                              = 0; // We don&#39;t know anything yet.</span>
<span class="line-modified"> 42 static constexpr SpeculatedType SpecFinalObject                       = 1ull &lt;&lt; 0; // It&#39;s definitely a JSFinalObject.</span>
<span class="line-modified"> 43 static constexpr SpeculatedType SpecArray                             = 1ull &lt;&lt; 1; // It&#39;s definitely a JSArray.</span>
<span class="line-modified"> 44 static constexpr SpeculatedType SpecFunctionWithDefaultHasInstance    = 1ull &lt;&lt; 2; // It&#39;s definitely a JSFunction that has its ImplementsDefaultHasInstance type info flags bit set.</span>
<span class="line-modified"> 45 static constexpr SpeculatedType SpecFunctionWithNonDefaultHasInstance = 1ull &lt;&lt; 3; // It&#39;s definitely a JSFunction that does not have its ImplementsDefaultHasInstance type info flags bit set.</span>
<span class="line-modified"> 46 static constexpr SpeculatedType SpecFunction                          = SpecFunctionWithDefaultHasInstance | SpecFunctionWithNonDefaultHasInstance; // It&#39;s definitely a JSFunction.</span>
<span class="line-modified"> 47 static constexpr SpeculatedType SpecInt8Array                         = 1ull &lt;&lt; 4; // It&#39;s definitely an Int8Array or one of its subclasses.</span>
<span class="line-modified"> 48 static constexpr SpeculatedType SpecInt16Array                        = 1ull &lt;&lt; 5; // It&#39;s definitely an Int16Array or one of its subclasses.</span>
<span class="line-modified"> 49 static constexpr SpeculatedType SpecInt32Array                        = 1ull &lt;&lt; 6; // It&#39;s definitely an Int32Array or one of its subclasses.</span>
<span class="line-modified"> 50 static constexpr SpeculatedType SpecUint8Array                        = 1ull &lt;&lt; 7; // It&#39;s definitely an Uint8Array or one of its subclasses.</span>
<span class="line-modified"> 51 static constexpr SpeculatedType SpecUint8ClampedArray                 = 1ull &lt;&lt; 8; // It&#39;s definitely an Uint8ClampedArray or one of its subclasses.</span>
<span class="line-modified"> 52 static constexpr SpeculatedType SpecUint16Array                       = 1ull &lt;&lt; 9; // It&#39;s definitely an Uint16Array or one of its subclasses.</span>
<span class="line-modified"> 53 static constexpr SpeculatedType SpecUint32Array                       = 1ull &lt;&lt; 10; // It&#39;s definitely an Uint32Array or one of its subclasses.</span>
<span class="line-modified"> 54 static constexpr SpeculatedType SpecFloat32Array                      = 1ull &lt;&lt; 11; // It&#39;s definitely an Uint16Array or one of its subclasses.</span>
<span class="line-modified"> 55 static constexpr SpeculatedType SpecFloat64Array                      = 1ull &lt;&lt; 12; // It&#39;s definitely an Uint16Array or one of its subclasses.</span>
<span class="line-modified"> 56 static constexpr SpeculatedType SpecTypedArrayView                    = SpecInt8Array | SpecInt16Array | SpecInt32Array | SpecUint8Array | SpecUint8ClampedArray | SpecUint16Array | SpecUint32Array | SpecFloat32Array | SpecFloat64Array;</span>
<span class="line-modified"> 57 static constexpr SpeculatedType SpecDirectArguments                   = 1ull &lt;&lt; 13; // It&#39;s definitely a DirectArguments object.</span>
<span class="line-modified"> 58 static constexpr SpeculatedType SpecScopedArguments                   = 1ull &lt;&lt; 14; // It&#39;s definitely a ScopedArguments object.</span>
<span class="line-modified"> 59 static constexpr SpeculatedType SpecStringObject                      = 1ull &lt;&lt; 15; // It&#39;s definitely a StringObject.</span>
<span class="line-modified"> 60 static constexpr SpeculatedType SpecRegExpObject                      = 1ull &lt;&lt; 16; // It&#39;s definitely a RegExpObject (and not any subclass of RegExpObject).</span>
<span class="line-modified"> 61 static constexpr SpeculatedType SpecDateObject                        = 1ull &lt;&lt; 17; // It&#39;s definitely a Date object or one of its subclasses.</span>
<span class="line-modified"> 62 static constexpr SpeculatedType SpecPromiseObject                     = 1ull &lt;&lt; 18; // It&#39;s definitely a Promise object or one of its subclasses.</span>
<span class="line-modified"> 63 static constexpr SpeculatedType SpecMapObject                         = 1ull &lt;&lt; 19; // It&#39;s definitely a Map object or one of its subclasses.</span>
<span class="line-modified"> 64 static constexpr SpeculatedType SpecSetObject                         = 1ull &lt;&lt; 20; // It&#39;s definitely a Set object or one of its subclasses.</span>
<span class="line-modified"> 65 static constexpr SpeculatedType SpecWeakMapObject                     = 1ull &lt;&lt; 21; // It&#39;s definitely a WeakMap object or one of its subclasses.</span>
<span class="line-modified"> 66 static constexpr SpeculatedType SpecWeakSetObject                     = 1ull &lt;&lt; 22; // It&#39;s definitely a WeakSet object or one of its subclasses.</span>
<span class="line-modified"> 67 static constexpr SpeculatedType SpecProxyObject                       = 1ull &lt;&lt; 23; // It&#39;s definitely a Proxy object or one of its subclasses.</span>
<span class="line-modified"> 68 static constexpr SpeculatedType SpecDerivedArray                      = 1ull &lt;&lt; 24; // It&#39;s definitely a DerivedArray object.</span>
<span class="line-modified"> 69 static constexpr SpeculatedType SpecObjectOther                       = 1ull &lt;&lt; 25; // It&#39;s definitely an object but not JSFinalObject, JSArray, or JSFunction.</span>
<span class="line-modified"> 70 static constexpr SpeculatedType SpecStringIdent                       = 1ull &lt;&lt; 26; // It&#39;s definitely a JSString, and it&#39;s an identifier.</span>
<span class="line-modified"> 71 static constexpr SpeculatedType SpecStringVar                         = 1ull &lt;&lt; 27; // It&#39;s definitely a JSString, and it&#39;s not an identifier.</span>
<span class="line-modified"> 72 static constexpr SpeculatedType SpecString                            = SpecStringIdent | SpecStringVar; // It&#39;s definitely a JSString.</span>
<span class="line-modified"> 73 static constexpr SpeculatedType SpecSymbol                            = 1ull &lt;&lt; 28; // It&#39;s definitely a Symbol.</span>
<span class="line-modified"> 74 static constexpr SpeculatedType SpecCellOther                         = 1ull &lt;&lt; 29; // It&#39;s definitely a JSCell but not a subclass of JSObject and definitely not a JSString, BigInt, or Symbol.</span>
<span class="line-modified"> 75 static constexpr SpeculatedType SpecBoolInt32                         = 1ull &lt;&lt; 30; // It&#39;s definitely an Int32 with value 0 or 1.</span>
<span class="line-modified"> 76 static constexpr SpeculatedType SpecNonBoolInt32                      = 1ull &lt;&lt; 31; // It&#39;s definitely an Int32 with value other than 0 or 1.</span>
<span class="line-modified"> 77 static constexpr SpeculatedType SpecInt32Only                         = SpecBoolInt32 | SpecNonBoolInt32; // It&#39;s definitely an Int32.</span>
<span class="line-modified"> 78 </span>
<span class="line-modified"> 79 static constexpr SpeculatedType SpecInt32AsInt52                      = 1ull &lt;&lt; 32; // It&#39;s an Int52 and it can fit in an int32.</span>
<span class="line-modified"> 80 static constexpr SpeculatedType SpecNonInt32AsInt52                   = 1ull &lt;&lt; 33; // It&#39;s an Int52 and it can&#39;t fit in an int32.</span>
<span class="line-modified"> 81 static constexpr SpeculatedType SpecInt52Any                          = SpecInt32AsInt52 | SpecNonInt32AsInt52; // It&#39;s any kind of Int52.</span>
<span class="line-modified"> 82 </span>
<span class="line-modified"> 83 static constexpr SpeculatedType SpecAnyIntAsDouble                    = 1ull &lt;&lt; 34; // It&#39;s definitely an Int52 and it&#39;s inside a double.</span>
<span class="line-modified"> 84 static constexpr SpeculatedType SpecNonIntAsDouble                    = 1ull &lt;&lt; 35; // It&#39;s definitely not an Int52 but it&#39;s a real number and it&#39;s a double.</span>
<span class="line-modified"> 85 static constexpr SpeculatedType SpecDoubleReal                        = SpecNonIntAsDouble | SpecAnyIntAsDouble; // It&#39;s definitely a non-NaN double.</span>
<span class="line-modified"> 86 static constexpr SpeculatedType SpecDoublePureNaN                     = 1ull &lt;&lt; 36; // It&#39;s definitely a NaN that is safe to tag (i.e. pure).</span>
<span class="line-modified"> 87 static constexpr SpeculatedType SpecDoubleImpureNaN                   = 1ull &lt;&lt; 37; // It&#39;s definitely a NaN that is unsafe to tag (i.e. impure).</span>
<span class="line-modified"> 88 static constexpr SpeculatedType SpecDoubleNaN                         = SpecDoublePureNaN | SpecDoubleImpureNaN; // It&#39;s definitely some kind of NaN.</span>
<span class="line-modified"> 89 static constexpr SpeculatedType SpecBytecodeDouble                    = SpecDoubleReal | SpecDoublePureNaN; // It&#39;s either a non-NaN or a NaN double, but it&#39;s definitely not impure NaN.</span>
<span class="line-modified"> 90 static constexpr SpeculatedType SpecFullDouble                        = SpecDoubleReal | SpecDoubleNaN; // It&#39;s either a non-NaN or a NaN double.</span>
<span class="line-modified"> 91 static constexpr SpeculatedType SpecBytecodeRealNumber                = SpecInt32Only | SpecDoubleReal; // It&#39;s either an Int32 or a DoubleReal.</span>
<span class="line-modified"> 92 static constexpr SpeculatedType SpecFullRealNumber                    = SpecInt32Only | SpecInt52Any | SpecDoubleReal; // It&#39;s either an Int32 or a DoubleReal, or an Int52.</span>
<span class="line-modified"> 93 static constexpr SpeculatedType SpecBytecodeNumber                    = SpecInt32Only | SpecBytecodeDouble; // It&#39;s either an Int32 or a Double, and the Double cannot be an impure NaN.</span>
<span class="line-modified"> 94 static constexpr SpeculatedType SpecIntAnyFormat                      = SpecInt52Any | SpecInt32Only | SpecAnyIntAsDouble;</span>
<span class="line-modified"> 95 </span>
<span class="line-modified"> 96 static constexpr SpeculatedType SpecFullNumber                        = SpecIntAnyFormat | SpecFullDouble; // It&#39;s either an Int32, Int52, or a Double, and the Double can be impure NaN.</span>
<span class="line-modified"> 97 static constexpr SpeculatedType SpecBoolean                           = 1ull &lt;&lt; 38; // It&#39;s definitely a Boolean.</span>
<span class="line-modified"> 98 static constexpr SpeculatedType SpecOther                             = 1ull &lt;&lt; 39; // It&#39;s definitely either Null or Undefined.</span>
<span class="line-modified"> 99 static constexpr SpeculatedType SpecMisc                              = SpecBoolean | SpecOther; // It&#39;s definitely either a boolean, Null, or Undefined.</span>
<span class="line-modified">100 static constexpr SpeculatedType SpecEmpty                             = 1ull &lt;&lt; 40; // It&#39;s definitely an empty value marker.</span>
<span class="line-modified">101 static constexpr SpeculatedType SpecBigInt                            = 1ull &lt;&lt; 41; // It&#39;s definitely a BigInt.</span>
<span class="line-modified">102 static constexpr SpeculatedType SpecDataViewObject                    = 1ull &lt;&lt; 42; // It&#39;s definitely a JSDataView.</span>
<span class="line-modified">103 static constexpr SpeculatedType SpecPrimitive                         = SpecString | SpecSymbol | SpecBytecodeNumber | SpecMisc | SpecBigInt; // It&#39;s any non-Object JSValue.</span>
<span class="line-modified">104 static constexpr SpeculatedType SpecObject                            = SpecFinalObject | SpecArray | SpecFunction | SpecTypedArrayView | SpecDirectArguments | SpecScopedArguments | SpecStringObject | SpecRegExpObject | SpecDateObject | SpecPromiseObject | SpecMapObject | SpecSetObject | SpecWeakMapObject | SpecWeakSetObject | SpecProxyObject | SpecDerivedArray | SpecObjectOther | SpecDataViewObject; // Bitmask used for testing for any kind of object prediction.</span>
<span class="line-modified">105 static constexpr SpeculatedType SpecCell                              = SpecObject | SpecString | SpecSymbol | SpecCellOther | SpecBigInt; // It&#39;s definitely a JSCell.</span>
<span class="line-modified">106 static constexpr SpeculatedType SpecHeapTop                           = SpecCell | SpecBytecodeNumber | SpecMisc; // It can be any of the above, except for SpecInt52Only and SpecDoubleImpureNaN.</span>
<span class="line-added">107 static constexpr SpeculatedType SpecBytecodeTop                       = SpecHeapTop | SpecEmpty; // It can be any of the above, except for SpecInt52Only and SpecDoubleImpureNaN. Corresponds to what could be found in a bytecode local.</span>
<span class="line-added">108 static constexpr SpeculatedType SpecFullTop                           = SpecBytecodeTop | SpecFullNumber; // It can be anything that bytecode could see plus exotic encodings of numbers.</span>
109 
110 // SpecCellCheck is the type set representing the values that can flow through a cell check.
111 // On 64-bit platforms, the empty value passes a cell check. Also, ~SpecCellCheck is the type
112 // set that representing the values that flow through when testing that something is not a cell.
<span class="line-modified">113 static constexpr SpeculatedType SpecCellCheck          = is64Bit() ? (SpecCell | SpecEmpty) : SpecCell;</span>
114 
115 typedef bool (*SpeculatedTypeChecker)(SpeculatedType);
116 
117 // Dummy prediction checker, only useful if someone insists on requiring a prediction checker.
118 inline bool isAnySpeculation(SpeculatedType)
119 {
120     return true;
121 }
122 
123 inline bool isCellSpeculation(SpeculatedType value)
124 {
125     return !!(value &amp; SpecCell) &amp;&amp; !(value &amp; ~SpecCell);
126 }
127 
128 inline bool isCellOrOtherSpeculation(SpeculatedType value)
129 {
130     return !!value &amp;&amp; !(value &amp; ~(SpecCell | SpecOther));
131 }
132 
133 inline bool isNotCellSpeculation(SpeculatedType value)
</pre>
<hr />
<pre>
327     return value == SpecBoolInt32;
328 }
329 
330 inline bool isInt32Speculation(SpeculatedType value)
331 {
332     return value &amp;&amp; !(value &amp; ~SpecInt32Only);
333 }
334 
335 inline bool isNotInt32Speculation(SpeculatedType value)
336 {
337     return value &amp;&amp; !(value &amp; SpecInt32Only);
338 }
339 
340 inline bool isInt32OrBooleanSpeculation(SpeculatedType value)
341 {
342     return value &amp;&amp; !(value &amp; ~(SpecBoolean | SpecInt32Only));
343 }
344 
345 inline bool isInt32SpeculationForArithmetic(SpeculatedType value)
346 {
<span class="line-modified">347     return !(value &amp; (SpecFullDouble | SpecNonInt32AsInt52 | SpecBigInt));</span>
348 }
349 
350 inline bool isInt32OrBooleanSpeculationForArithmetic(SpeculatedType value)
351 {
<span class="line-modified">352     return !(value &amp; (SpecFullDouble | SpecNonInt32AsInt52 | SpecBigInt));</span>
353 }
354 
355 inline bool isInt32OrBooleanSpeculationExpectingDefined(SpeculatedType value)
356 {
357     return isInt32OrBooleanSpeculation(value &amp; ~SpecOther);
358 }
359 
360 inline bool isAnyInt52Speculation(SpeculatedType value)
361 {
362     return !!value &amp;&amp; (value &amp; SpecInt52Any) == value;
363 }
364 
365 inline bool isInt32OrInt52Speculation(SpeculatedType value)
366 {
367     return !!value &amp;&amp; (value &amp; (SpecInt32Only | SpecInt52Any)) == value;
368 }
369 
370 inline bool isIntAnyFormat(SpeculatedType value)
371 {
372     return !!value &amp;&amp; (value &amp; SpecIntAnyFormat) == value;
</pre>
<hr />
<pre>
481 inline bool mergeSpeculation(T&amp; left, SpeculatedType right)
482 {
483     SpeculatedType newSpeculation = static_cast&lt;T&gt;(mergeSpeculations(static_cast&lt;SpeculatedType&gt;(left), right));
484     bool result = newSpeculation != static_cast&lt;SpeculatedType&gt;(left);
485     left = newSpeculation;
486     return result;
487 }
488 
489 inline bool speculationChecked(SpeculatedType actual, SpeculatedType desired)
490 {
491     return (actual | desired) == desired;
492 }
493 
494 SpeculatedType speculationFromClassInfo(const ClassInfo*);
495 SpeculatedType speculationFromStructure(Structure*);
496 SpeculatedType speculationFromCell(JSCell*);
497 JS_EXPORT_PRIVATE SpeculatedType speculationFromValue(JSValue);
498 // If it&#39;s an anyInt(), it&#39;ll return speculated types from the Int52 lattice.
499 // Otherwise, it&#39;ll return types from the JSValue lattice.
500 JS_EXPORT_PRIVATE SpeculatedType int52AwareSpeculationFromValue(JSValue);
<span class="line-modified">501 Optional&lt;SpeculatedType&gt; speculationFromJSType(JSType);</span>
502 
503 SpeculatedType speculationFromTypedArrayType(TypedArrayType); // only valid for typed views.
504 TypedArrayType typedArrayTypeFromSpeculation(SpeculatedType);
505 
506 SpeculatedType leastUpperBoundOfStrictlyEquivalentSpeculations(SpeculatedType);
507 
508 bool valuesCouldBeEqual(SpeculatedType, SpeculatedType);
509 
510 // Precise computation of the type of the result of a double computation after we
511 // already know that the inputs are doubles and that the result must be a double. Use
512 // the closest one of these that applies.
513 SpeculatedType typeOfDoubleSum(SpeculatedType, SpeculatedType);
514 SpeculatedType typeOfDoubleDifference(SpeculatedType, SpeculatedType);
<span class="line-added">515 SpeculatedType typeOfDoubleIncOrDec(SpeculatedType);</span>
516 SpeculatedType typeOfDoubleProduct(SpeculatedType, SpeculatedType);
517 SpeculatedType typeOfDoubleQuotient(SpeculatedType, SpeculatedType);
518 SpeculatedType typeOfDoubleMinMax(SpeculatedType, SpeculatedType);
519 SpeculatedType typeOfDoubleNegation(SpeculatedType);
520 SpeculatedType typeOfDoubleAbs(SpeculatedType);
521 SpeculatedType typeOfDoubleRounding(SpeculatedType);
522 SpeculatedType typeOfDoublePow(SpeculatedType, SpeculatedType);
523 
524 // This conservatively models the behavior of arbitrary double operations.
525 SpeculatedType typeOfDoubleBinaryOp(SpeculatedType, SpeculatedType);
526 SpeculatedType typeOfDoubleUnaryOp(SpeculatedType);
527 
528 // This is mostly for debugging so we can fill profiles from strings.
529 SpeculatedType speculationFromString(const char*);
530 
531 } // namespace JSC
</pre>
</td>
</tr>
</table>
<center><a href="SpeculatedType.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="StructureStubClearingWatchpoint.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>