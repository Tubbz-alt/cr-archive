<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSFunction.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSFunction.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSFunctionInlines.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSFunction.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 47,11 ***</span>
  namespace DOMJIT {
  class Signature;
  }
  
  
<span class="line-modified">! JS_EXPORT_PRIVATE EncodedJSValue JSC_HOST_CALL callHostFunctionAsConstructor(ExecState*);</span>
  
  JS_EXPORT_PRIVATE String getCalculatedDisplayName(VM&amp;, JSObject*);
  
  class JSFunction : public JSCallee {
      friend class JIT;
<span class="line-new-header">--- 47,11 ---</span>
  namespace DOMJIT {
  class Signature;
  }
  
  
<span class="line-modified">! JS_EXPORT_PRIVATE EncodedJSValue JSC_HOST_CALL callHostFunctionAsConstructor(JSGlobalObject*, CallFrame*);</span>
  
  JS_EXPORT_PRIVATE String getCalculatedDisplayName(VM&amp;, JSObject*);
  
  class JSFunction : public JSCallee {
      friend class JIT;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 59,19 ***</span>
      friend class DFG::JITCompiler;
      friend class VM;
      friend class InternalFunction;
  
  public:
  
      template&lt;typename CellType, SubspaceAccess&gt;
      static IsoSubspace* subspaceFor(VM&amp; vm)
      {
          return &amp;vm.functionSpace;
      }
  
      typedef JSCallee Base;
<span class="line-modified">!     const static unsigned StructureFlags = Base::StructureFlags | OverridesGetOwnPropertySlot | OverridesGetPropertyNames | OverridesGetCallData;</span>
  
      static size_t allocationSize(Checked&lt;size_t&gt; inlineCapacity)
      {
          ASSERT_UNUSED(inlineCapacity, !inlineCapacity);
          return sizeof(JSFunction);
<span class="line-new-header">--- 59,20 ---</span>
      friend class DFG::JITCompiler;
      friend class VM;
      friend class InternalFunction;
  
  public:
<span class="line-added">+     static constexpr uintptr_t rareDataTag = 0x1;</span>
  
      template&lt;typename CellType, SubspaceAccess&gt;
      static IsoSubspace* subspaceFor(VM&amp; vm)
      {
          return &amp;vm.functionSpace;
      }
  
      typedef JSCallee Base;
<span class="line-modified">!     static constexpr unsigned StructureFlags = Base::StructureFlags | OverridesGetOwnPropertySlot | OverridesGetPropertyNames | OverridesGetCallData;</span>
  
      static size_t allocationSize(Checked&lt;size_t&gt; inlineCapacity)
      {
          ASSERT_UNUSED(inlineCapacity, !inlineCapacity);
          return sizeof(JSFunction);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 89,11 ***</span>
  
      JS_EXPORT_PRIVATE String name(VM&amp;);
      JS_EXPORT_PRIVATE String displayName(VM&amp;);
      JS_EXPORT_PRIVATE const String calculatedDisplayName(VM&amp;);
  
<span class="line-modified">!     ExecutableBase* executable() const { return m_executable.get(); }</span>
  
      // To call any of these methods include JSFunctionInlines.h
      bool isHostFunction() const;
      FunctionExecutable* jsExecutable() const;
      Intrinsic intrinsic() const;
<span class="line-new-header">--- 90,17 ---</span>
  
      JS_EXPORT_PRIVATE String name(VM&amp;);
      JS_EXPORT_PRIVATE String displayName(VM&amp;);
      JS_EXPORT_PRIVATE const String calculatedDisplayName(VM&amp;);
  
<span class="line-modified">!     ExecutableBase* executable() const</span>
<span class="line-added">+     {</span>
<span class="line-added">+         uintptr_t executableOrRareData = m_executableOrRareData;</span>
<span class="line-added">+         if (executableOrRareData &amp; rareDataTag)</span>
<span class="line-added">+             return bitwise_cast&lt;FunctionRareData*&gt;(executableOrRareData &amp; ~rareDataTag)-&gt;executable();</span>
<span class="line-added">+         return bitwise_cast&lt;ExecutableBase*&gt;(executableOrRareData);</span>
<span class="line-added">+     }</span>
  
      // To call any of these methods include JSFunctionInlines.h
      bool isHostFunction() const;
      FunctionExecutable* jsExecutable() const;
      Intrinsic intrinsic() const;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 109,78 ***</span>
      }
  
      TaggedNativeFunction nativeFunction();
      TaggedNativeFunction nativeConstructor();
  
<span class="line-modified">!     static ConstructType getConstructData(JSCell*, ConstructData&amp;);</span>
<span class="line-modified">!     static CallType getCallData(JSCell*, CallData&amp;);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     static inline ptrdiff_t offsetOfExecutable()</span>
<span class="line-removed">-     {</span>
<span class="line-removed">-         return OBJECT_OFFSETOF(JSFunction, m_executable);</span>
<span class="line-removed">-     }</span>
  
<span class="line-modified">!     static inline ptrdiff_t offsetOfRareData()</span>
      {
<span class="line-modified">!         return OBJECT_OFFSETOF(JSFunction, m_rareData);</span>
      }
  
<span class="line-modified">!     FunctionRareData* rareData(VM&amp; vm)</span>
      {
<span class="line-modified">!         if (UNLIKELY(!m_rareData))</span>
              return allocateRareData(vm);
<span class="line-modified">!         return m_rareData.get();</span>
      }
  
<span class="line-modified">!     FunctionRareData* ensureRareDataAndAllocationProfile(ExecState*, unsigned inlineCapacity);</span>
  
<span class="line-modified">!     FunctionRareData* rareData()</span>
      {
<span class="line-modified">!         FunctionRareData* rareData = m_rareData.get();</span>
<span class="line-modified">! </span>
<span class="line-modified">!         // The JS thread may be concurrently creating the rare data</span>
<span class="line-modified">!         // If we see it, we want to ensure it has been properly created</span>
<span class="line-removed">-         WTF::loadLoadFence();</span>
<span class="line-removed">- </span>
<span class="line-removed">-         return rareData;</span>
      }
  
      bool isHostOrBuiltinFunction() const;
      bool isBuiltinFunction() const;
<span class="line-removed">-     bool isAnonymousBuiltinFunction() const;</span>
      JS_EXPORT_PRIVATE bool isHostFunctionNonInline() const;
      bool isClassConstructorFunction() const;
  
<span class="line-modified">!     void setFunctionName(ExecState*, JSValue name);</span>
  
      // Returns the __proto__ for the |this| value if this JSFunction were to be constructed.
<span class="line-modified">!     JSObject* prototypeForConstruction(VM&amp;, ExecState*);</span>
  
      bool canUseAllocationProfile();
      bool canUseAllocationProfileNonInline();
  
      enum class PropertyStatus {
          Eager,
          Lazy,
          Reified,
      };
<span class="line-modified">!     PropertyStatus reifyLazyPropertyIfNeeded(VM&amp;, ExecState*, PropertyName);</span>
  
  protected:
<span class="line-modified">!     JS_EXPORT_PRIVATE JSFunction(VM&amp;, JSGlobalObject*, Structure*);</span>
      JSFunction(VM&amp;, FunctionExecutable*, JSScope*, Structure*);
  
      void finishCreation(VM&amp;, NativeExecutable*, int length, const String&amp; name);
      void finishCreation(VM&amp;);
  
<span class="line-modified">!     static bool getOwnPropertySlot(JSObject*, ExecState*, PropertyName, PropertySlot&amp;);</span>
<span class="line-modified">!     static void getOwnNonIndexPropertyNames(JSObject*, ExecState*, PropertyNameArray&amp;, EnumerationMode = EnumerationMode());</span>
<span class="line-modified">!     static bool defineOwnProperty(JSObject*, ExecState*, PropertyName, const PropertyDescriptor&amp;, bool shouldThrow);</span>
  
<span class="line-modified">!     static bool put(JSCell*, ExecState*, PropertyName, JSValue, PutPropertySlot&amp;);</span>
  
<span class="line-modified">!     static bool deleteProperty(JSCell*, ExecState*, PropertyName);</span>
  
      static void visitChildren(JSCell*, SlotVisitor&amp;);
  
  private:
      static JSFunction* createImpl(VM&amp; vm, FunctionExecutable* executable, JSScope* scope, Structure* structure)
<span class="line-new-header">--- 116,72 ---</span>
      }
  
      TaggedNativeFunction nativeFunction();
      TaggedNativeFunction nativeConstructor();
  
<span class="line-modified">!     JS_EXPORT_PRIVATE static ConstructType getConstructData(JSCell*, ConstructData&amp;);</span>
<span class="line-modified">!     JS_EXPORT_PRIVATE static CallType getCallData(JSCell*, CallData&amp;);</span>
  
<span class="line-modified">!     static inline ptrdiff_t offsetOfExecutableOrRareData()</span>
      {
<span class="line-modified">!         return OBJECT_OFFSETOF(JSFunction, m_executableOrRareData);</span>
      }
  
<span class="line-modified">!     FunctionRareData* ensureRareData(VM&amp; vm)</span>
      {
<span class="line-modified">!         uintptr_t executableOrRareData = m_executableOrRareData;</span>
<span class="line-added">+         if (UNLIKELY(!(executableOrRareData &amp; rareDataTag)))</span>
              return allocateRareData(vm);
<span class="line-modified">!         return bitwise_cast&lt;FunctionRareData*&gt;(executableOrRareData &amp; ~rareDataTag);</span>
      }
  
<span class="line-modified">!     FunctionRareData* ensureRareDataAndAllocationProfile(JSGlobalObject*, unsigned inlineCapacity);</span>
  
<span class="line-modified">!     FunctionRareData* rareData() const</span>
      {
<span class="line-modified">!         uintptr_t executableOrRareData = m_executableOrRareData;</span>
<span class="line-modified">!         if (executableOrRareData &amp; rareDataTag)</span>
<span class="line-modified">!             return bitwise_cast&lt;FunctionRareData*&gt;(executableOrRareData &amp; ~rareDataTag);</span>
<span class="line-modified">!         return nullptr;</span>
      }
  
      bool isHostOrBuiltinFunction() const;
      bool isBuiltinFunction() const;
      JS_EXPORT_PRIVATE bool isHostFunctionNonInline() const;
      bool isClassConstructorFunction() const;
  
<span class="line-modified">!     void setFunctionName(JSGlobalObject*, JSValue name);</span>
  
      // Returns the __proto__ for the |this| value if this JSFunction were to be constructed.
<span class="line-modified">!     JSObject* prototypeForConstruction(VM&amp;, JSGlobalObject*);</span>
  
      bool canUseAllocationProfile();
      bool canUseAllocationProfileNonInline();
  
      enum class PropertyStatus {
          Eager,
          Lazy,
          Reified,
      };
<span class="line-modified">!     PropertyStatus reifyLazyPropertyIfNeeded(VM&amp;, JSGlobalObject*, PropertyName);</span>
<span class="line-added">+ </span>
<span class="line-added">+     bool areNameAndLengthOriginal(VM&amp;);</span>
  
  protected:
<span class="line-modified">!     JS_EXPORT_PRIVATE JSFunction(VM&amp;, NativeExecutable*, JSGlobalObject*, Structure*);</span>
      JSFunction(VM&amp;, FunctionExecutable*, JSScope*, Structure*);
  
      void finishCreation(VM&amp;, NativeExecutable*, int length, const String&amp; name);
      void finishCreation(VM&amp;);
  
<span class="line-modified">!     static bool getOwnPropertySlot(JSObject*, JSGlobalObject*, PropertyName, PropertySlot&amp;);</span>
<span class="line-modified">!     static void getOwnNonIndexPropertyNames(JSObject*, JSGlobalObject*, PropertyNameArray&amp;, EnumerationMode = EnumerationMode());</span>
<span class="line-modified">!     static bool defineOwnProperty(JSObject*, JSGlobalObject*, PropertyName, const PropertyDescriptor&amp;, bool shouldThrow);</span>
  
<span class="line-modified">!     static bool put(JSCell*, JSGlobalObject*, PropertyName, JSValue, PutPropertySlot&amp;);</span>
  
<span class="line-modified">!     static bool deleteProperty(JSCell*, JSGlobalObject*, PropertyName);</span>
  
      static void visitChildren(JSCell*, SlotVisitor&amp;);
  
  private:
      static JSFunction* createImpl(VM&amp; vm, FunctionExecutable* executable, JSScope* scope, Structure* structure)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 190,42 ***</span>
          function-&gt;finishCreation(vm);
          return function;
      }
  
      FunctionRareData* allocateRareData(VM&amp;);
<span class="line-modified">!     FunctionRareData* allocateAndInitializeRareData(ExecState*, size_t inlineCapacity);</span>
<span class="line-modified">!     FunctionRareData* initializeRareData(ExecState*, size_t inlineCapacity);</span>
  
      bool hasReifiedLength() const;
      bool hasReifiedName() const;
      void reifyLength(VM&amp;);
<span class="line-modified">!     void reifyName(VM&amp;, ExecState*);</span>
<span class="line-modified">!     void reifyName(VM&amp;, ExecState*, String name);</span>
  
      static bool isLazy(PropertyStatus property) { return property == PropertyStatus::Lazy || property == PropertyStatus::Reified; }
      static bool isReified(PropertyStatus property) { return property == PropertyStatus::Reified; }
  
<span class="line-modified">!     PropertyStatus reifyLazyPropertyForHostOrBuiltinIfNeeded(VM&amp;, ExecState*, PropertyName);</span>
<span class="line-modified">!     PropertyStatus reifyLazyLengthIfNeeded(VM&amp;, ExecState*, PropertyName);</span>
<span class="line-modified">!     PropertyStatus reifyLazyNameIfNeeded(VM&amp;, ExecState*, PropertyName);</span>
<span class="line-modified">!     PropertyStatus reifyLazyBoundNameIfNeeded(VM&amp;, ExecState*, PropertyName);</span>
  
<span class="line-modified">! #if ASSERT_DISABLED</span>
<span class="line-removed">-     void assertTypeInfoFlagInvariants() { }</span>
<span class="line-removed">- #else</span>
      void assertTypeInfoFlagInvariants();
  #endif
  
      friend class LLIntOffsetsExtractor;
  
<span class="line-modified">!     static EncodedJSValue argumentsGetter(ExecState*, EncodedJSValue, PropertyName);</span>
<span class="line-modified">!     static EncodedJSValue callerGetter(ExecState*, EncodedJSValue, PropertyName);</span>
<span class="line-removed">-     static EncodedJSValue lengthGetter(ExecState*, EncodedJSValue, PropertyName);</span>
<span class="line-removed">-     static EncodedJSValue nameGetter(ExecState*, EncodedJSValue, PropertyName);</span>
  
<span class="line-modified">!     WriteBarrier&lt;ExecutableBase&gt; m_executable;</span>
<span class="line-removed">-     WriteBarrier&lt;FunctionRareData&gt; m_rareData;</span>
  };
  
  class JSStrictFunction final : public JSFunction {
  public:
      using Base = JSFunction;
<span class="line-new-header">--- 191,39 ---</span>
          function-&gt;finishCreation(vm);
          return function;
      }
  
      FunctionRareData* allocateRareData(VM&amp;);
<span class="line-modified">!     FunctionRareData* allocateAndInitializeRareData(JSGlobalObject*, size_t inlineCapacity);</span>
<span class="line-modified">!     FunctionRareData* initializeRareData(JSGlobalObject*, size_t inlineCapacity);</span>
  
      bool hasReifiedLength() const;
      bool hasReifiedName() const;
      void reifyLength(VM&amp;);
<span class="line-modified">!     void reifyName(VM&amp;, JSGlobalObject*);</span>
<span class="line-modified">!     void reifyName(VM&amp;, JSGlobalObject*, String name);</span>
  
      static bool isLazy(PropertyStatus property) { return property == PropertyStatus::Lazy || property == PropertyStatus::Reified; }
      static bool isReified(PropertyStatus property) { return property == PropertyStatus::Reified; }
  
<span class="line-modified">!     PropertyStatus reifyLazyPropertyForHostOrBuiltinIfNeeded(VM&amp;, JSGlobalObject*, PropertyName);</span>
<span class="line-modified">!     PropertyStatus reifyLazyLengthIfNeeded(VM&amp;, JSGlobalObject*, PropertyName);</span>
<span class="line-modified">!     PropertyStatus reifyLazyNameIfNeeded(VM&amp;, JSGlobalObject*, PropertyName);</span>
<span class="line-modified">!     PropertyStatus reifyLazyBoundNameIfNeeded(VM&amp;, JSGlobalObject*, PropertyName);</span>
  
<span class="line-modified">! #if ASSERT_ENABLED</span>
      void assertTypeInfoFlagInvariants();
<span class="line-added">+ #else</span>
<span class="line-added">+     void assertTypeInfoFlagInvariants() { }</span>
  #endif
  
      friend class LLIntOffsetsExtractor;
  
<span class="line-modified">!     static EncodedJSValue argumentsGetter(JSGlobalObject*, EncodedJSValue, PropertyName);</span>
<span class="line-modified">!     static EncodedJSValue callerGetter(JSGlobalObject*, EncodedJSValue, PropertyName);</span>
  
<span class="line-modified">!     uintptr_t m_executableOrRareData;</span>
  };
  
  class JSStrictFunction final : public JSFunction {
  public:
      using Base = JSFunction;
</pre>
<center><a href="JSFunction.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSFunctionInlines.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>