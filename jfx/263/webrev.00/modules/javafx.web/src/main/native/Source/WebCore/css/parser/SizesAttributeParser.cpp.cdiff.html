<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/css/parser/SizesAttributeParser.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MediaQueryParser.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="SizesAttributeParser.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/css/parser/SizesAttributeParser.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 42,11 ***</span>
  #include &quot;SizesCalcParser.h&quot;
  #include &quot;StyleScope.h&quot;
  
  namespace WebCore {
  
<span class="line-modified">! float SizesAttributeParser::computeLength(double value, CSSPrimitiveValue::UnitType type, const Document&amp; document)</span>
  {
      auto* renderer = document.renderView();
      if (!renderer)
          return 0;
      auto&amp; style = renderer-&gt;style();
<span class="line-new-header">--- 42,11 ---</span>
  #include &quot;SizesCalcParser.h&quot;
  #include &quot;StyleScope.h&quot;
  
  namespace WebCore {
  
<span class="line-modified">! float SizesAttributeParser::computeLength(double value, CSSUnitType type, const Document&amp; document)</span>
  {
      auto* renderer = document.renderView();
      if (!renderer)
          return 0;
      auto&amp; style = renderer-&gt;style();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 56,25 ***</span>
      // Because we evaluate &quot;sizes&quot; at parse time (before style has been resolved), the font metrics used for these specific units
      // are not available. The font selector&#39;s internal consistency isn&#39;t guaranteed just yet, so we can just temporarily clear
      // the pointer to it for the duration of the unit evaluation. This is acceptible because the style always comes from the
      // RenderView, which has its font information hardcoded in resolveForDocument() to be -webkit-standard, whose operations
      // don&#39;t require a font selector.
<span class="line-modified">!     if (type == CSSPrimitiveValue::CSS_EXS || type == CSSPrimitiveValue::CSS_CHS) {</span>
          RefPtr&lt;FontSelector&gt; fontSelector = style.fontCascade().fontSelector();
          style.fontCascade().update(nullptr);
          float result = CSSPrimitiveValue::computeNonCalcLengthDouble(conversionData, type, value);
          style.fontCascade().update(fontSelector.get());
          return result;
      }
  
      return clampTo&lt;float&gt;(CSSPrimitiveValue::computeNonCalcLengthDouble(conversionData, type, value));
  }
  
<span class="line-modified">! SizesAttributeParser::SizesAttributeParser(const String&amp; attribute, const Document&amp; document)</span>
      : m_document(document)
<span class="line-modified">!     , m_length(0)</span>
<span class="line-removed">-     , m_lengthWasSet(false)</span>
  {
      m_isValid = parse(CSSTokenizer(attribute).tokenRange());
  }
  
  float SizesAttributeParser::length()
<span class="line-new-header">--- 56,24 ---</span>
      // Because we evaluate &quot;sizes&quot; at parse time (before style has been resolved), the font metrics used for these specific units
      // are not available. The font selector&#39;s internal consistency isn&#39;t guaranteed just yet, so we can just temporarily clear
      // the pointer to it for the duration of the unit evaluation. This is acceptible because the style always comes from the
      // RenderView, which has its font information hardcoded in resolveForDocument() to be -webkit-standard, whose operations
      // don&#39;t require a font selector.
<span class="line-modified">!     if (type == CSSUnitType::CSS_EXS || type == CSSUnitType::CSS_CHS) {</span>
          RefPtr&lt;FontSelector&gt; fontSelector = style.fontCascade().fontSelector();
          style.fontCascade().update(nullptr);
          float result = CSSPrimitiveValue::computeNonCalcLengthDouble(conversionData, type, value);
          style.fontCascade().update(fontSelector.get());
          return result;
      }
  
      return clampTo&lt;float&gt;(CSSPrimitiveValue::computeNonCalcLengthDouble(conversionData, type, value));
  }
  
<span class="line-modified">! SizesAttributeParser::SizesAttributeParser(const String&amp; attribute, const Document&amp; document, MediaQueryDynamicResults* mediaQueryDynamicResults)</span>
      : m_document(document)
<span class="line-modified">!     , m_mediaQueryDynamicResults(mediaQueryDynamicResults)</span>
  {
      m_isValid = parse(CSSTokenizer(attribute).tokenRange());
  }
  
  float SizesAttributeParser::length()
</pre>
<hr />
<pre>
<span class="line-old-header">*** 113,11 ***</span>
      // A Media Condition cannot have a media type other than screen.
      auto* renderer = m_document.renderView();
      if (!renderer)
          return false;
      auto&amp; style = renderer-&gt;style();
<span class="line-modified">!     return MediaQueryEvaluator { &quot;screen&quot;, m_document, &amp;style }.evaluate(mediaCondition, const_cast&lt;Style::Scope&amp;&gt;(m_document.styleScope()).resolverIfExists());</span>
  }
  
  bool SizesAttributeParser::parse(CSSParserTokenRange range)
  {
      // Split on a comma token and parse the result tokens as (media-condition, length) pairs
<span class="line-new-header">--- 112,11 ---</span>
      // A Media Condition cannot have a media type other than screen.
      auto* renderer = m_document.renderView();
      if (!renderer)
          return false;
      auto&amp; style = renderer-&gt;style();
<span class="line-modified">!     return MediaQueryEvaluator { &quot;screen&quot;, m_document, &amp;style }.evaluate(mediaCondition, m_mediaQueryDynamicResults);</span>
  }
  
  bool SizesAttributeParser::parse(CSSParserTokenRange range)
  {
      // Split on a comma token and parse the result tokens as (media-condition, length) pairs
</pre>
<hr />
<pre>
<span class="line-old-header">*** 158,9 ***</span>
  {
      auto* renderer = m_document.renderView();
      if (!renderer)
          return 0;
      auto&amp; style = renderer-&gt;style();
<span class="line-modified">!     return clampTo&lt;float&gt;(CSSPrimitiveValue::computeNonCalcLengthDouble({ &amp;style, &amp;style, renderer }, CSSPrimitiveValue::CSS_VW, 100.0));</span>
  }
  
  } // namespace WebCore
<span class="line-new-header">--- 157,9 ---</span>
  {
      auto* renderer = m_document.renderView();
      if (!renderer)
          return 0;
      auto&amp; style = renderer-&gt;style();
<span class="line-modified">!     return clampTo&lt;float&gt;(CSSPrimitiveValue::computeNonCalcLengthDouble({ &amp;style, &amp;style, renderer }, CSSUnitType::CSS_VW, 100.0));</span>
  }
  
  } // namespace WebCore
</pre>
<center><a href="MediaQueryParser.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="SizesAttributeParser.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>