<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/rendering/RenderTreeAsText.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="RenderThemeWin.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RenderVTTCue.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/rendering/RenderTreeAsText.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 33,11 ***</span>
  #include &quot;FrameView.h&quot;
  #include &quot;HTMLElement.h&quot;
  #include &quot;HTMLNames.h&quot;
  #include &quot;HTMLSpanElement.h&quot;
  #include &quot;InlineTextBox.h&quot;
<span class="line-modified">! #include &quot;LineLayoutInterfaceTextBoxes.h&quot;</span>
  #include &quot;Logging.h&quot;
  #include &quot;PrintContext.h&quot;
  #include &quot;PseudoElement.h&quot;
  #include &quot;RenderBlockFlow.h&quot;
  #include &quot;RenderCounter.h&quot;
<span class="line-new-header">--- 33,11 ---</span>
  #include &quot;FrameView.h&quot;
  #include &quot;HTMLElement.h&quot;
  #include &quot;HTMLNames.h&quot;
  #include &quot;HTMLSpanElement.h&quot;
  #include &quot;InlineTextBox.h&quot;
<span class="line-modified">! #include &quot;LineLayoutTraversal.h&quot;</span>
  #include &quot;Logging.h&quot;
  #include &quot;PrintContext.h&quot;
  #include &quot;PseudoElement.h&quot;
  #include &quot;RenderBlockFlow.h&quot;
  #include &quot;RenderCounter.h&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 158,11 ***</span>
          else {
              if (c &gt;= 0x20 &amp;&amp; c &lt; 0x7F)
                  result.append(c);
              else {
                  result.appendLiteral(&quot;\\x{&quot;);
<span class="line-modified">!                 appendUnsignedAsHex(c, result);</span>
                  result.append(&#39;}&#39;);
              }
          }
      }
      result.append(&#39;&quot;&#39;);
<span class="line-new-header">--- 158,11 ---</span>
          else {
              if (c &gt;= 0x20 &amp;&amp; c &lt; 0x7F)
                  result.append(c);
              else {
                  result.appendLiteral(&quot;\\x{&quot;);
<span class="line-modified">!                 result.append(hex(c));</span>
                  result.append(&#39;}&#39;);
              }
          }
      }
      result.append(&#39;&quot;&#39;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 174,12 ***</span>
      ts &lt;&lt; o.renderName();
  
      if (behavior.contains(RenderAsTextFlag::ShowAddresses))
          ts &lt;&lt; &quot; &quot; &lt;&lt; static_cast&lt;const void*&gt;(&amp;o);
  
<span class="line-modified">!     if (o.style().zIndex())</span>
<span class="line-modified">!         ts &lt;&lt; &quot; zI: &quot; &lt;&lt; o.style().zIndex();</span>
  
      if (o.node()) {
          String tagName = getTagName(o.node());
          // FIXME: Temporary hack to make tests pass by simulating the old generated content output.
          if (o.isPseudoElement() || (o.parent() &amp;&amp; o.parent()-&gt;isPseudoElement()))
<span class="line-new-header">--- 174,12 ---</span>
      ts &lt;&lt; o.renderName();
  
      if (behavior.contains(RenderAsTextFlag::ShowAddresses))
          ts &lt;&lt; &quot; &quot; &lt;&lt; static_cast&lt;const void*&gt;(&amp;o);
  
<span class="line-modified">!     if (o.style().usedZIndex()) // FIXME: This should use !hasAutoUsedZIndex().</span>
<span class="line-modified">!         ts &lt;&lt; &quot; zI: &quot; &lt;&lt; o.style().usedZIndex();</span>
  
      if (o.node()) {
          String tagName = getTagName(o.node());
          // FIXME: Temporary hack to make tests pass by simulating the old generated content output.
          if (o.isPseudoElement() || (o.parent() &amp;&amp; o.parent()-&gt;isPseudoElement()))
</pre>
<hr />
<pre>
<span class="line-old-header">*** 200,16 ***</span>
      if (is&lt;RenderText&gt;(o)) {
          // FIXME: Would be better to dump the bounding box x and y rather than the first run&#39;s x and y, but that would involve updating
          // many test results.
          const RenderText&amp; text = downcast&lt;RenderText&gt;(o);
          r = IntRect(text.firstRunLocation(), text.linesBoundingBox().size());
<span class="line-modified">!         auto textBoxes = LineLayoutInterface::textBoxes(text);</span>
<span class="line-removed">-         if (textBoxes.begin() == textBoxes.end())</span>
              adjustForTableCells = false;
      } else if (o.isBR()) {
          const RenderLineBreak&amp; br = downcast&lt;RenderLineBreak&gt;(o);
<span class="line-modified">!         IntRect linesBox = br.linesBoundingBox();</span>
          r = IntRect(linesBox.x(), linesBox.y(), linesBox.width(), linesBox.height());
          if (!br.inlineBoxWrapper())
              adjustForTableCells = false;
      } else if (is&lt;RenderInline&gt;(o)) {
          const RenderInline&amp; inlineFlow = downcast&lt;RenderInline&gt;(o);
<span class="line-new-header">--- 200,15 ---</span>
      if (is&lt;RenderText&gt;(o)) {
          // FIXME: Would be better to dump the bounding box x and y rather than the first run&#39;s x and y, but that would involve updating
          // many test results.
          const RenderText&amp; text = downcast&lt;RenderText&gt;(o);
          r = IntRect(text.firstRunLocation(), text.linesBoundingBox().size());
<span class="line-modified">!         if (!LineLayoutTraversal::firstTextBoxFor(text))</span>
              adjustForTableCells = false;
      } else if (o.isBR()) {
          const RenderLineBreak&amp; br = downcast&lt;RenderLineBreak&gt;(o);
<span class="line-modified">!         IntRect linesBox = br.boundingBoxForRenderTreeDump();</span>
          r = IntRect(linesBox.x(), linesBox.y(), linesBox.width(), linesBox.height());
          if (!br.inlineBoxWrapper())
              adjustForTableCells = false;
      } else if (is&lt;RenderInline&gt;(o)) {
          const RenderInline&amp; inlineFlow = downcast&lt;RenderInline&gt;(o);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 243,21 ***</span>
                  ts &lt;&lt; &quot; [color=&quot; &lt;&lt; color.nameForRenderTreeAsText() &lt;&lt; &quot;]&quot;;
  
              // Do not dump invalid or transparent backgrounds, since that is the default.
              Color backgroundColor = o.style().visitedDependentColor(CSSPropertyBackgroundColor);
              if (o.parent()-&gt;style().visitedDependentColor(CSSPropertyBackgroundColor).rgb() != backgroundColor.rgb()
<span class="line-modified">!                 &amp;&amp; backgroundColor.isValid() &amp;&amp; backgroundColor.rgb())</span>
                  ts &lt;&lt; &quot; [bgcolor=&quot; &lt;&lt; backgroundColor.nameForRenderTreeAsText() &lt;&lt; &quot;]&quot;;
  
              Color textFillColor = o.style().visitedDependentColor(CSSPropertyWebkitTextFillColor);
              if (o.parent()-&gt;style().visitedDependentColor(CSSPropertyWebkitTextFillColor).rgb() != textFillColor.rgb()
<span class="line-modified">!                 &amp;&amp; textFillColor.isValid() &amp;&amp; textFillColor.rgb() != color.rgb() &amp;&amp; textFillColor.rgb())</span>
                  ts &lt;&lt; &quot; [textFillColor=&quot; &lt;&lt; textFillColor.nameForRenderTreeAsText() &lt;&lt; &quot;]&quot;;
  
              Color textStrokeColor = o.style().visitedDependentColor(CSSPropertyWebkitTextStrokeColor);
              if (o.parent()-&gt;style().visitedDependentColor(CSSPropertyWebkitTextStrokeColor).rgb() != textStrokeColor.rgb()
<span class="line-modified">!                 &amp;&amp; textStrokeColor.isValid() &amp;&amp; textStrokeColor.rgb() != color.rgb() &amp;&amp; textStrokeColor.rgb())</span>
                  ts &lt;&lt; &quot; [textStrokeColor=&quot; &lt;&lt; textStrokeColor.nameForRenderTreeAsText() &lt;&lt; &quot;]&quot;;
  
              if (o.parent()-&gt;style().textStrokeWidth() != o.style().textStrokeWidth() &amp;&amp; o.style().textStrokeWidth() &gt; 0)
                  ts &lt;&lt; &quot; [textStrokeWidth=&quot; &lt;&lt; o.style().textStrokeWidth() &lt;&lt; &quot;]&quot;;
          }
<span class="line-new-header">--- 242,21 ---</span>
                  ts &lt;&lt; &quot; [color=&quot; &lt;&lt; color.nameForRenderTreeAsText() &lt;&lt; &quot;]&quot;;
  
              // Do not dump invalid or transparent backgrounds, since that is the default.
              Color backgroundColor = o.style().visitedDependentColor(CSSPropertyBackgroundColor);
              if (o.parent()-&gt;style().visitedDependentColor(CSSPropertyBackgroundColor).rgb() != backgroundColor.rgb()
<span class="line-modified">!                 &amp;&amp; backgroundColor.rgb() != Color::transparent)</span>
                  ts &lt;&lt; &quot; [bgcolor=&quot; &lt;&lt; backgroundColor.nameForRenderTreeAsText() &lt;&lt; &quot;]&quot;;
  
              Color textFillColor = o.style().visitedDependentColor(CSSPropertyWebkitTextFillColor);
              if (o.parent()-&gt;style().visitedDependentColor(CSSPropertyWebkitTextFillColor).rgb() != textFillColor.rgb()
<span class="line-modified">!                 &amp;&amp; textFillColor.rgb() != color.rgb() &amp;&amp; textFillColor.rgb() != Color::transparent)</span>
                  ts &lt;&lt; &quot; [textFillColor=&quot; &lt;&lt; textFillColor.nameForRenderTreeAsText() &lt;&lt; &quot;]&quot;;
  
              Color textStrokeColor = o.style().visitedDependentColor(CSSPropertyWebkitTextStrokeColor);
              if (o.parent()-&gt;style().visitedDependentColor(CSSPropertyWebkitTextStrokeColor).rgb() != textStrokeColor.rgb()
<span class="line-modified">!                 &amp;&amp; textStrokeColor.rgb() != color.rgb() &amp;&amp; textStrokeColor.rgb() != Color::transparent)</span>
                  ts &lt;&lt; &quot; [textStrokeColor=&quot; &lt;&lt; textStrokeColor.nameForRenderTreeAsText() &lt;&lt; &quot;]&quot;;
  
              if (o.parent()-&gt;style().textStrokeWidth() != o.style().textStrokeWidth() &amp;&amp; o.style().textStrokeWidth() &gt; 0)
                  ts &lt;&lt; &quot; [textStrokeWidth=&quot; &lt;&lt; o.style().textStrokeWidth() &lt;&lt; &quot;]&quot;;
          }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 476,21 ***</span>
              }
          }
      }
  }
  
<span class="line-modified">! static void writeTextBox(TextStream&amp; ts, const RenderText&amp; o, const LineLayoutInterface::TextBox&amp; textBox)</span>
  {
      auto rect = textBox.rect();
<span class="line-removed">-     auto logicalRect = textBox.logicalRect();</span>
<span class="line-removed">- </span>
      int x = rect.x();
      int y = rect.y();
<span class="line-modified">! </span>
<span class="line-modified">!     // FIXME: Mixing logical and physical here doesn&#39;t make sense.</span>
<span class="line-removed">-     int logicalWidth = ceilf(rect.x() + logicalRect.width()) - x;</span>
<span class="line-removed">- </span>
      // FIXME: Table cell adjustment is temporary until results can be updated.
      if (is&lt;RenderTableCell&gt;(*o.containingBlock()))
          y -= floorToInt(downcast&lt;RenderTableCell&gt;(*o.containingBlock()).intrinsicPaddingBefore());
  
      ts &lt;&lt; &quot;text run at (&quot; &lt;&lt; x &lt;&lt; &quot;,&quot; &lt;&lt; y &lt;&lt; &quot;) width &quot; &lt;&lt; logicalWidth;
<span class="line-new-header">--- 475,17 ---</span>
              }
          }
      }
  }
  
<span class="line-modified">! static void writeTextBox(TextStream&amp; ts, const RenderText&amp; o, const LineLayoutTraversal::TextBox&amp; textBox)</span>
  {
      auto rect = textBox.rect();
      int x = rect.x();
      int y = rect.y();
<span class="line-modified">!     // FIXME: Use non-logical width. webkit.org/b/206809.</span>
<span class="line-modified">!     int logicalWidth = ceilf(rect.x() + (textBox.isHorizontal() ? rect.width() : rect.height())) - x;</span>
      // FIXME: Table cell adjustment is temporary until results can be updated.
      if (is&lt;RenderTableCell&gt;(*o.containingBlock()))
          y -= floorToInt(downcast&lt;RenderTableCell&gt;(*o.containingBlock()).intrinsicPaddingBefore());
  
      ts &lt;&lt; &quot;text run at (&quot; &lt;&lt; x &lt;&lt; &quot;,&quot; &lt;&lt; y &lt;&lt; &quot;) width &quot; &lt;&lt; logicalWidth;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 548,11 ***</span>
  
      TextStream::IndentScope indentScope(ts);
  
      if (is&lt;RenderText&gt;(o)) {
          auto&amp; text = downcast&lt;RenderText&gt;(o);
<span class="line-modified">!         for (auto textBox : LineLayoutInterface::textBoxes(text)) {</span>
              ts &lt;&lt; indent;
              writeTextBox(ts, text, textBox);
          }
      } else {
          for (auto&amp; child : childrenOfType&lt;RenderObject&gt;(downcast&lt;RenderElement&gt;(o))) {
<span class="line-new-header">--- 543,11 ---</span>
  
      TextStream::IndentScope indentScope(ts);
  
      if (is&lt;RenderText&gt;(o)) {
          auto&amp; text = downcast&lt;RenderText&gt;(o);
<span class="line-modified">!         for (auto&amp; textBox : LineLayoutTraversal::textBoxesFor(text)) {</span>
              ts &lt;&lt; indent;
              writeTextBox(ts, text, textBox);
          }
      } else {
          for (auto&amp; child : childrenOfType&lt;RenderObject&gt;(downcast&lt;RenderElement&gt;(o))) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 637,11 ***</span>
  
  #if ENABLE(CSS_COMPOSITING)
      if (layer.isolatesBlending())
          ts &lt;&lt; &quot; isolatesBlending&quot;;
      if (layer.hasBlendMode())
<span class="line-modified">!         ts &lt;&lt; &quot; blendMode: &quot; &lt;&lt; compositeOperatorName(CompositeSourceOver, layer.blendMode());</span>
  #endif
  
      ts &lt;&lt; &quot;\n&quot;;
  }
  
<span class="line-new-header">--- 632,11 ---</span>
  
  #if ENABLE(CSS_COMPOSITING)
      if (layer.isolatesBlending())
          ts &lt;&lt; &quot; isolatesBlending&quot;;
      if (layer.hasBlendMode())
<span class="line-modified">!         ts &lt;&lt; &quot; blendMode: &quot; &lt;&lt; compositeOperatorName(CompositeOperator::SourceOver, layer.blendMode());</span>
  #endif
  
      ts &lt;&lt; &quot;\n&quot;;
  }
  
</pre>
<center><a href="RenderThemeWin.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RenderVTTCue.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>