<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/Modules/webgpu/WHLSL/Metal/WHLSLMetalCodeGenerator.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="WHLSLFunctionWriter.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="WHLSLNativeFunctionWriter.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/webgpu/WHLSL/Metal/WHLSLMetalCodeGenerator.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;WHLSLMetalCodeGenerator.h&quot;
 28 
 29 #if ENABLE(WEBGPU)
 30 
 31 #include &quot;WHLSLFunctionWriter.h&quot;
 32 #include &quot;WHLSLTypeNamer.h&quot;
 33 #include &lt;wtf/DataLog.h&gt;
 34 #include &lt;wtf/text/StringBuilder.h&gt;
 35 
 36 namespace WebCore {
 37 
 38 namespace WHLSL {
 39 
 40 namespace Metal {
 41 
 42 static constexpr bool dumpMetalCode = false;
 43 
<span class="line-modified"> 44 static StringView metalCodeProlog()</span>
 45 {
 46     return StringView {
 47         &quot;#include &lt;metal_stdlib&gt;\n&quot;
 48         &quot;#include &lt;metal_atomic&gt;\n&quot;
 49         &quot;#include &lt;metal_math&gt;\n&quot;
 50         &quot;#include &lt;metal_relational&gt;\n&quot;
 51         &quot;#include &lt;metal_compute&gt;\n&quot;
 52         &quot;#include &lt;metal_texture&gt;\n&quot;
 53         &quot;\n&quot;
 54         &quot;using namespace metal;\n&quot;
 55         &quot;\n&quot;
















































 56     };

 57 }
 58 
 59 static void dumpMetalCodeIfNeeded(StringBuilder&amp; stringBuilder)
 60 {
 61     if (dumpMetalCode) {
 62         dataLogLn(&quot;Generated Metal code: &quot;);
 63         dataLogLn(stringBuilder.toString());
 64     }
 65 }
 66 
 67 RenderMetalCode generateMetalCode(Program&amp; program, MatchedRenderSemantics&amp;&amp; matchedSemantics, Layout&amp; layout)
 68 {
 69     StringBuilder stringBuilder;
<span class="line-modified"> 70     stringBuilder.append(metalCodeProlog());</span>
 71 
 72     TypeNamer typeNamer(program);
 73     typeNamer.emitMetalTypes(stringBuilder);
 74 
 75     auto metalFunctionEntryPoints = Metal::emitMetalFunctions(stringBuilder, program, typeNamer, WTFMove(matchedSemantics), layout);
 76 
 77     dumpMetalCodeIfNeeded(stringBuilder);
 78 
 79     return { WTFMove(stringBuilder), WTFMove(metalFunctionEntryPoints.mangledVertexEntryPointName), WTFMove(metalFunctionEntryPoints.mangledFragmentEntryPointName) };
 80 }
 81 
 82 ComputeMetalCode generateMetalCode(Program&amp; program, MatchedComputeSemantics&amp;&amp; matchedSemantics, Layout&amp; layout)
 83 {
 84     StringBuilder stringBuilder;
<span class="line-modified"> 85     stringBuilder.append(metalCodeProlog());</span>
 86 
 87     TypeNamer typeNamer(program);
 88     typeNamer.emitMetalTypes(stringBuilder);
 89 
 90     auto metalFunctionEntryPoints = Metal::emitMetalFunctions(stringBuilder, program, typeNamer, WTFMove(matchedSemantics), layout);
 91 
 92     dumpMetalCodeIfNeeded(stringBuilder);
 93 
 94     return { WTFMove(stringBuilder), WTFMove(metalFunctionEntryPoints.mangledEntryPointName) };
 95 }
 96 
 97 }
 98 
 99 }
100 
101 }
102 
103 #endif
</pre>
</td>
<td>
<hr />
<pre>
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;WHLSLMetalCodeGenerator.h&quot;
 28 
 29 #if ENABLE(WEBGPU)
 30 
 31 #include &quot;WHLSLFunctionWriter.h&quot;
 32 #include &quot;WHLSLTypeNamer.h&quot;
 33 #include &lt;wtf/DataLog.h&gt;
 34 #include &lt;wtf/text/StringBuilder.h&gt;
 35 
 36 namespace WebCore {
 37 
 38 namespace WHLSL {
 39 
 40 namespace Metal {
 41 
 42 static constexpr bool dumpMetalCode = false;
 43 
<span class="line-modified"> 44 static StringView metalCodePrologue()</span>
 45 {
 46     return StringView {
 47         &quot;#include &lt;metal_stdlib&gt;\n&quot;
 48         &quot;#include &lt;metal_atomic&gt;\n&quot;
 49         &quot;#include &lt;metal_math&gt;\n&quot;
 50         &quot;#include &lt;metal_relational&gt;\n&quot;
 51         &quot;#include &lt;metal_compute&gt;\n&quot;
 52         &quot;#include &lt;metal_texture&gt;\n&quot;
 53         &quot;\n&quot;
 54         &quot;using namespace metal;\n&quot;
 55         &quot;\n&quot;
<span class="line-added"> 56         &quot;template &lt;typename T, int Cols, int Rows&gt;\n&quot;</span>
<span class="line-added"> 57         &quot;struct WSLMatrix\n&quot;</span>
<span class="line-added"> 58         &quot;{\n&quot;</span>
<span class="line-added"> 59         &quot;    vec&lt;T, Rows&gt; columns[Cols];\n&quot;</span>
<span class="line-added"> 60         &quot;    private:\n&quot;</span>
<span class="line-added"> 61         &quot;    public:\n&quot;</span>
<span class="line-added"> 62         &quot;    inline WSLMatrix() thread = default;\n&quot;</span>
<span class="line-added"> 63         &quot;    inline WSLMatrix() constant = default;\n&quot;</span>
<span class="line-added"> 64         &quot;    inline WSLMatrix(const thread WSLMatrix&lt;T, Cols, Rows&gt; &amp;that) thread = default;\n&quot;</span>
<span class="line-added"> 65         &quot;    inline WSLMatrix(const device WSLMatrix&lt;T, Cols, Rows&gt; &amp;that) thread = default;\n&quot;</span>
<span class="line-added"> 66         &quot;    inline WSLMatrix(const constant WSLMatrix&lt;T, Cols, Rows&gt; &amp;that) thread = default;\n&quot;</span>
<span class="line-added"> 67         &quot;    inline WSLMatrix(const threadgroup WSLMatrix&lt;T, Cols, Rows&gt; &amp;that) thread = default;\n&quot;</span>
<span class="line-added"> 68         &quot;    inline WSLMatrix(const thread WSLMatrix&lt;T, Cols, Rows&gt; &amp;that) constant = default;\n&quot;</span>
<span class="line-added"> 69         &quot;    inline WSLMatrix(const device WSLMatrix&lt;T, Cols, Rows&gt; &amp;that) constant = default;\n&quot;</span>
<span class="line-added"> 70         &quot;    inline WSLMatrix(const constant WSLMatrix&lt;T, Cols, Rows&gt; &amp;that) constant = default;\n&quot;</span>
<span class="line-added"> 71         &quot;    inline WSLMatrix(const threadgroup WSLMatrix&lt;T, Cols, Rows&gt; &amp;that) constant = default;\n&quot;</span>
<span class="line-added"> 72         &quot;    public:\n&quot;</span>
<span class="line-added"> 73         &quot;    inline thread vec&lt;T, Rows&gt; &amp;operator[](int r) thread\n&quot;</span>
<span class="line-added"> 74         &quot;    {\n&quot;</span>
<span class="line-added"> 75         &quot;        return columns[r];\n&quot;</span>
<span class="line-added"> 76         &quot;    }\n&quot;</span>
<span class="line-added"> 77         &quot;    inline device vec&lt;T, Rows&gt; &amp;operator[](int r) device\n&quot;</span>
<span class="line-added"> 78         &quot;    {\n&quot;</span>
<span class="line-added"> 79         &quot;        return columns[r];\n&quot;</span>
<span class="line-added"> 80         &quot;    }\n&quot;</span>
<span class="line-added"> 81         &quot;    inline threadgroup vec&lt;T, Rows&gt; &amp;operator[](int r) threadgroup\n&quot;</span>
<span class="line-added"> 82         &quot;    {\n&quot;</span>
<span class="line-added"> 83         &quot;        return columns[r];\n&quot;</span>
<span class="line-added"> 84         &quot;    }\n&quot;</span>
<span class="line-added"> 85         &quot;    inline const thread vec&lt;T, Rows&gt; &amp;operator[](int r) const thread\n&quot;</span>
<span class="line-added"> 86         &quot;    {\n&quot;</span>
<span class="line-added"> 87         &quot;        return columns[r];\n&quot;</span>
<span class="line-added"> 88         &quot;    }\n&quot;</span>
<span class="line-added"> 89         &quot;    inline const device vec&lt;T, Rows&gt; &amp;operator[](int r) const device\n&quot;</span>
<span class="line-added"> 90         &quot;    {\n&quot;</span>
<span class="line-added"> 91         &quot;        return columns[r];\n&quot;</span>
<span class="line-added"> 92         &quot;    }\n&quot;</span>
<span class="line-added"> 93         &quot;    inline const constant vec&lt;T, Rows&gt; &amp;operator[](int r) const constant\n&quot;</span>
<span class="line-added"> 94         &quot;    {\n&quot;</span>
<span class="line-added"> 95         &quot;        return columns[r];\n&quot;</span>
<span class="line-added"> 96         &quot;    }\n&quot;</span>
<span class="line-added"> 97         &quot;    inline const threadgroup vec&lt;T, Rows&gt; &amp;operator[](int r) const threadgroup\n&quot;</span>
<span class="line-added"> 98         &quot;    {\n&quot;</span>
<span class="line-added"> 99         &quot;        return columns[r];\n&quot;</span>
<span class="line-added">100         &quot;    }\n&quot;</span>
<span class="line-added">101         &quot;};\n&quot;</span>
<span class="line-added">102 </span>
<span class="line-added">103 </span>
104     };
<span class="line-added">105 </span>
106 }
107 
108 static void dumpMetalCodeIfNeeded(StringBuilder&amp; stringBuilder)
109 {
110     if (dumpMetalCode) {
111         dataLogLn(&quot;Generated Metal code: &quot;);
112         dataLogLn(stringBuilder.toString());
113     }
114 }
115 
116 RenderMetalCode generateMetalCode(Program&amp; program, MatchedRenderSemantics&amp;&amp; matchedSemantics, Layout&amp; layout)
117 {
118     StringBuilder stringBuilder;
<span class="line-modified">119     stringBuilder.append(metalCodePrologue());</span>
120 
121     TypeNamer typeNamer(program);
122     typeNamer.emitMetalTypes(stringBuilder);
123 
124     auto metalFunctionEntryPoints = Metal::emitMetalFunctions(stringBuilder, program, typeNamer, WTFMove(matchedSemantics), layout);
125 
126     dumpMetalCodeIfNeeded(stringBuilder);
127 
128     return { WTFMove(stringBuilder), WTFMove(metalFunctionEntryPoints.mangledVertexEntryPointName), WTFMove(metalFunctionEntryPoints.mangledFragmentEntryPointName) };
129 }
130 
131 ComputeMetalCode generateMetalCode(Program&amp; program, MatchedComputeSemantics&amp;&amp; matchedSemantics, Layout&amp; layout)
132 {
133     StringBuilder stringBuilder;
<span class="line-modified">134     stringBuilder.append(metalCodePrologue());</span>
135 
136     TypeNamer typeNamer(program);
137     typeNamer.emitMetalTypes(stringBuilder);
138 
139     auto metalFunctionEntryPoints = Metal::emitMetalFunctions(stringBuilder, program, typeNamer, WTFMove(matchedSemantics), layout);
140 
141     dumpMetalCodeIfNeeded(stringBuilder);
142 
143     return { WTFMove(stringBuilder), WTFMove(metalFunctionEntryPoints.mangledEntryPointName) };
144 }
145 
146 }
147 
148 }
149 
150 }
151 
152 #endif
</pre>
</td>
</tr>
</table>
<center><a href="WHLSLFunctionWriter.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="WHLSLNativeFunctionWriter.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>