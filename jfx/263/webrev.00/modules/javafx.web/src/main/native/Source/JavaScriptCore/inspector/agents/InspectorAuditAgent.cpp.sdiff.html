<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/inspector/agents/InspectorAuditAgent.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="InspectorAgent.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="InspectorAuditAgent.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/inspector/agents/InspectorAuditAgent.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 52 
 53 void InspectorAuditAgent::didCreateFrontendAndBackend(FrontendRouter*, BackendDispatcher*)
 54 {
 55 }
 56 
 57 void InspectorAuditAgent::willDestroyFrontendAndBackend(DisconnectReason)
 58 {
 59 }
 60 
 61 void InspectorAuditAgent::setup(ErrorString&amp; errorString, const int* executionContextId)
 62 {
 63     if (hasActiveAudit()) {
 64         errorString = &quot;Must call teardown before calling setup again&quot;_s;
 65         return;
 66     }
 67 
 68     InjectedScript injectedScript = injectedScriptForEval(errorString, executionContextId);
 69     if (injectedScript.hasNoValue())
 70         return;
 71 
<span class="line-modified"> 72     JSC::ExecState* execState = injectedScript.scriptState();</span>
<span class="line-modified"> 73     if (!execState) {</span>
 74         errorString = &quot;Missing execution state of injected script for given executionContextId&quot;_s;
 75         return;
 76     }
 77 
<span class="line-modified"> 78     VM&amp; vm = execState-&gt;vm();</span>
 79 
<span class="line-modified"> 80     JSC::JSLockHolder lock(execState);</span>
 81 
<span class="line-modified"> 82     m_injectedWebInspectorAuditValue.set(vm, constructEmptyObject(execState));</span>
 83     if (!m_injectedWebInspectorAuditValue) {
 84         errorString = &quot;Unable to construct injected WebInspectorAudit object.&quot;_s;
 85         return;
 86     }
 87 
<span class="line-modified"> 88     populateAuditObject(execState, m_injectedWebInspectorAuditValue);</span>
 89 }
 90 
 91 void InspectorAuditAgent::run(ErrorString&amp; errorString, const String&amp; test, const int* executionContextId, RefPtr&lt;Protocol::Runtime::RemoteObject&gt;&amp; result, Optional&lt;bool&gt;&amp; wasThrown)
 92 {
 93     InjectedScript injectedScript = injectedScriptForEval(errorString, executionContextId);
 94     if (injectedScript.hasNoValue())
 95         return;
 96 
 97     StringBuilder functionString;
 98     functionString.appendLiteral(&quot;(function(WebInspectorAudit) { \&quot;use strict\&quot;; return eval(`(&quot;);
 99     functionString.append(test.isolatedCopy().replace(&#39;`&#39;, &quot;\\`&quot;));
100     functionString.appendLiteral(&quot;)`)(WebInspectorAudit); })&quot;);
101 
102     InjectedScript::ExecuteOptions options;
103     options.objectGroup = &quot;audit&quot;_s;
104     if (m_injectedWebInspectorAuditValue)
105         options.args = { m_injectedWebInspectorAuditValue.get() };
106 
107     Optional&lt;int&gt; savedResultIndex;
108 
</pre>
<hr />
<pre>
115 
116     unmuteConsole();
117     m_scriptDebugServer.setPauseOnExceptionsState(previousPauseOnExceptionsState);
118 }
119 
120 void InspectorAuditAgent::teardown(ErrorString&amp; errorString)
121 {
122     if (!hasActiveAudit()) {
123         errorString = &quot;Must call setup before calling teardown&quot;_s;
124         return;
125     }
126 
127     m_injectedWebInspectorAuditValue.clear();
128 }
129 
130 bool InspectorAuditAgent::hasActiveAudit() const
131 {
132     return !!m_injectedWebInspectorAuditValue;
133 }
134 
<span class="line-modified">135 void InspectorAuditAgent::populateAuditObject(JSC::ExecState* execState, JSC::Strong&lt;JSC::JSObject&gt;&amp; auditObject)</span>
136 {
<span class="line-modified">137     ASSERT(execState);</span>
<span class="line-modified">138     if (!execState)</span>
139         return;
140 
<span class="line-modified">141     JSC::VM&amp; vm = execState-&gt;vm();</span>
142     JSC::JSLockHolder lock(vm);
143 
144     auditObject-&gt;putDirect(vm, JSC::Identifier::fromString(vm, &quot;Version&quot;), JSC::JSValue(Inspector::Protocol::Audit::VERSION));
145 }
146 
147 } // namespace Inspector
</pre>
</td>
<td>
<hr />
<pre>
 52 
 53 void InspectorAuditAgent::didCreateFrontendAndBackend(FrontendRouter*, BackendDispatcher*)
 54 {
 55 }
 56 
 57 void InspectorAuditAgent::willDestroyFrontendAndBackend(DisconnectReason)
 58 {
 59 }
 60 
 61 void InspectorAuditAgent::setup(ErrorString&amp; errorString, const int* executionContextId)
 62 {
 63     if (hasActiveAudit()) {
 64         errorString = &quot;Must call teardown before calling setup again&quot;_s;
 65         return;
 66     }
 67 
 68     InjectedScript injectedScript = injectedScriptForEval(errorString, executionContextId);
 69     if (injectedScript.hasNoValue())
 70         return;
 71 
<span class="line-modified"> 72     JSC::JSGlobalObject* globalObject = injectedScript.globalObject();</span>
<span class="line-modified"> 73     if (!globalObject) {</span>
 74         errorString = &quot;Missing execution state of injected script for given executionContextId&quot;_s;
 75         return;
 76     }
 77 
<span class="line-modified"> 78     VM&amp; vm = globalObject-&gt;vm();</span>
 79 
<span class="line-modified"> 80     JSC::JSLockHolder lock(globalObject);</span>
 81 
<span class="line-modified"> 82     m_injectedWebInspectorAuditValue.set(vm, constructEmptyObject(globalObject));</span>
 83     if (!m_injectedWebInspectorAuditValue) {
 84         errorString = &quot;Unable to construct injected WebInspectorAudit object.&quot;_s;
 85         return;
 86     }
 87 
<span class="line-modified"> 88     populateAuditObject(globalObject, m_injectedWebInspectorAuditValue);</span>
 89 }
 90 
 91 void InspectorAuditAgent::run(ErrorString&amp; errorString, const String&amp; test, const int* executionContextId, RefPtr&lt;Protocol::Runtime::RemoteObject&gt;&amp; result, Optional&lt;bool&gt;&amp; wasThrown)
 92 {
 93     InjectedScript injectedScript = injectedScriptForEval(errorString, executionContextId);
 94     if (injectedScript.hasNoValue())
 95         return;
 96 
 97     StringBuilder functionString;
 98     functionString.appendLiteral(&quot;(function(WebInspectorAudit) { \&quot;use strict\&quot;; return eval(`(&quot;);
 99     functionString.append(test.isolatedCopy().replace(&#39;`&#39;, &quot;\\`&quot;));
100     functionString.appendLiteral(&quot;)`)(WebInspectorAudit); })&quot;);
101 
102     InjectedScript::ExecuteOptions options;
103     options.objectGroup = &quot;audit&quot;_s;
104     if (m_injectedWebInspectorAuditValue)
105         options.args = { m_injectedWebInspectorAuditValue.get() };
106 
107     Optional&lt;int&gt; savedResultIndex;
108 
</pre>
<hr />
<pre>
115 
116     unmuteConsole();
117     m_scriptDebugServer.setPauseOnExceptionsState(previousPauseOnExceptionsState);
118 }
119 
120 void InspectorAuditAgent::teardown(ErrorString&amp; errorString)
121 {
122     if (!hasActiveAudit()) {
123         errorString = &quot;Must call setup before calling teardown&quot;_s;
124         return;
125     }
126 
127     m_injectedWebInspectorAuditValue.clear();
128 }
129 
130 bool InspectorAuditAgent::hasActiveAudit() const
131 {
132     return !!m_injectedWebInspectorAuditValue;
133 }
134 
<span class="line-modified">135 void InspectorAuditAgent::populateAuditObject(JSC::JSGlobalObject* globalObject, JSC::Strong&lt;JSC::JSObject&gt;&amp; auditObject)</span>
136 {
<span class="line-modified">137     ASSERT(globalObject);</span>
<span class="line-modified">138     if (!globalObject)</span>
139         return;
140 
<span class="line-modified">141     JSC::VM&amp; vm = globalObject-&gt;vm();</span>
142     JSC::JSLockHolder lock(vm);
143 
144     auditObject-&gt;putDirect(vm, JSC::Identifier::fromString(vm, &quot;Version&quot;), JSC::JSValue(Inspector::Protocol::Audit::VERSION));
145 }
146 
147 } // namespace Inspector
</pre>
</td>
</tr>
</table>
<center><a href="InspectorAgent.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="InspectorAuditAgent.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>