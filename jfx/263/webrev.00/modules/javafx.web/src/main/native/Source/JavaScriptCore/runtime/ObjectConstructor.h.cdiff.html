<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/ObjectConstructor.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ObjectConstructor.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ObjectInitializationScope.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/ObjectConstructor.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,8 ***</span>
  /*
   *  Copyright (C) 1999-2000 Harri Porten (porten@kde.org)
<span class="line-modified">!  *  Copyright (C) 2008, 2016-2017 Apple Inc. All rights reserved.</span>
   *
   *  This library is free software; you can redistribute it and/or
   *  modify it under the terms of the GNU Lesser General Public
   *  License as published by the Free Software Foundation; either
   *  version 2 of the License, or (at your option) any later version.
<span class="line-new-header">--- 1,8 ---</span>
  /*
   *  Copyright (C) 1999-2000 Harri Porten (porten@kde.org)
<span class="line-modified">!  *  Copyright (C) 2008-2019 Apple Inc. All rights reserved.</span>
   *
   *  This library is free software; you can redistribute it and/or
   *  modify it under the terms of the GNU Lesser General Public
   *  License as published by the Free Software Foundation; either
   *  version 2 of the License, or (at your option) any later version.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 24,22 ***</span>
  #include &quot;JSGlobalObject.h&quot;
  #include &quot;ObjectPrototype.h&quot;
  
  namespace JSC {
  
<span class="line-modified">! EncodedJSValue JSC_HOST_CALL objectConstructorGetOwnPropertyDescriptor(ExecState*);</span>
<span class="line-modified">! EncodedJSValue JSC_HOST_CALL objectConstructorGetOwnPropertyDescriptors(ExecState*);</span>
<span class="line-modified">! EncodedJSValue JSC_HOST_CALL objectConstructorGetOwnPropertySymbols(ExecState*);</span>
<span class="line-modified">! EncodedJSValue JSC_HOST_CALL objectConstructorGetOwnPropertyNames(ExecState*);</span>
<span class="line-modified">! EncodedJSValue JSC_HOST_CALL objectConstructorKeys(ExecState*);</span>
  
  class ObjectPrototype;
  
  class ObjectConstructor final : public InternalFunction {
  public:
      typedef InternalFunction Base;
<span class="line-modified">!     static const unsigned StructureFlags = Base::StructureFlags | HasStaticPropertyTable;</span>
  
      static ObjectConstructor* create(VM&amp; vm, JSGlobalObject* globalObject, Structure* structure, ObjectPrototype* objectPrototype)
      {
          ObjectConstructor* constructor = new (NotNull, allocateCell&lt;ObjectConstructor&gt;(vm.heap)) ObjectConstructor(vm, structure);
          constructor-&gt;finishCreation(vm, globalObject, objectPrototype);
<span class="line-new-header">--- 24,22 ---</span>
  #include &quot;JSGlobalObject.h&quot;
  #include &quot;ObjectPrototype.h&quot;
  
  namespace JSC {
  
<span class="line-modified">! EncodedJSValue JSC_HOST_CALL objectConstructorGetOwnPropertyDescriptor(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified">! EncodedJSValue JSC_HOST_CALL objectConstructorGetOwnPropertyDescriptors(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified">! EncodedJSValue JSC_HOST_CALL objectConstructorGetOwnPropertySymbols(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified">! EncodedJSValue JSC_HOST_CALL objectConstructorGetOwnPropertyNames(JSGlobalObject*, CallFrame*);</span>
<span class="line-modified">! EncodedJSValue JSC_HOST_CALL objectConstructorKeys(JSGlobalObject*, CallFrame*);</span>
  
  class ObjectPrototype;
  
  class ObjectConstructor final : public InternalFunction {
  public:
      typedef InternalFunction Base;
<span class="line-modified">!     static constexpr unsigned StructureFlags = Base::StructureFlags | HasStaticPropertyTable;</span>
  
      static ObjectConstructor* create(VM&amp; vm, JSGlobalObject* globalObject, Structure* structure, ObjectPrototype* objectPrototype)
      {
          ObjectConstructor* constructor = new (NotNull, allocateCell&lt;ObjectConstructor&gt;(vm.heap)) ObjectConstructor(vm, structure);
          constructor-&gt;finishCreation(vm, globalObject, objectPrototype);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 57,48 ***</span>
      void finishCreation(VM&amp;, JSGlobalObject*, ObjectPrototype*);
  
  private:
      ObjectConstructor(VM&amp;, Structure*);
  };
  
<span class="line-modified">! inline JSFinalObject* constructEmptyObject(ExecState* exec, Structure* structure)</span>
  {
<span class="line-modified">!     return JSFinalObject::create(exec, structure);</span>
  }
  
<span class="line-modified">! inline JSFinalObject* constructEmptyObject(ExecState* exec, JSObject* prototype, unsigned inlineCapacity)</span>
  {
<span class="line-modified">!     JSGlobalObject* globalObject = exec-&gt;lexicalGlobalObject();</span>
<span class="line-modified">!     StructureCache&amp; structureCache = globalObject-&gt;vm().structureCache;</span>
      Structure* structure = structureCache.emptyObjectStructureForPrototype(globalObject, prototype, inlineCapacity);
<span class="line-modified">!     return constructEmptyObject(exec, structure);</span>
  }
  
<span class="line-modified">! inline JSFinalObject* constructEmptyObject(ExecState* exec, JSObject* prototype)</span>
  {
<span class="line-modified">!     return constructEmptyObject(exec, prototype, JSFinalObject::defaultInlineCapacity());</span>
  }
  
<span class="line-modified">! inline JSFinalObject* constructEmptyObject(ExecState* exec)</span>
  {
<span class="line-modified">!     return constructEmptyObject(exec, exec-&gt;lexicalGlobalObject()-&gt;objectStructureForObjectConstructor());</span>
  }
  
<span class="line-modified">! inline JSObject* constructObject(ExecState* exec, JSGlobalObject* globalObject, JSValue arg)</span>
  {
      if (arg.isUndefinedOrNull())
<span class="line-modified">!         return constructEmptyObject(exec, globalObject-&gt;objectPrototype());</span>
<span class="line-modified">!     return arg.toObject(exec, globalObject);</span>
  }
  
  // Section 6.2.4.4 of the ES6 specification.
  // https://tc39.github.io/ecma262/#sec-frompropertydescriptor
<span class="line-modified">! inline JSObject* constructObjectFromPropertyDescriptor(ExecState* exec, const PropertyDescriptor&amp; descriptor)</span>
  {
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">!     JSObject* description = constructEmptyObject(exec);</span>
      RETURN_IF_EXCEPTION(scope, nullptr);
  
      if (!descriptor.isAccessorDescriptor()) {
          description-&gt;putDirect(vm, vm.propertyNames-&gt;value, descriptor.value() ? descriptor.value() : jsUndefined(), 0);
          description-&gt;putDirect(vm, vm.propertyNames-&gt;writable, jsBoolean(descriptor.writable()), 0);
<span class="line-new-header">--- 57,49 ---</span>
      void finishCreation(VM&amp;, JSGlobalObject*, ObjectPrototype*);
  
  private:
      ObjectConstructor(VM&amp;, Structure*);
  };
<span class="line-added">+ STATIC_ASSERT_ISO_SUBSPACE_SHARABLE(ObjectConstructor, InternalFunction);</span>
  
<span class="line-modified">! inline JSFinalObject* constructEmptyObject(VM&amp; vm, Structure* structure)</span>
  {
<span class="line-modified">!     return JSFinalObject::create(vm, structure);</span>
  }
  
<span class="line-modified">! inline JSFinalObject* constructEmptyObject(JSGlobalObject* globalObject, JSObject* prototype, unsigned inlineCapacity)</span>
  {
<span class="line-modified">!     VM&amp; vm = getVM(globalObject);</span>
<span class="line-modified">!     StructureCache&amp; structureCache = vm.structureCache;</span>
      Structure* structure = structureCache.emptyObjectStructureForPrototype(globalObject, prototype, inlineCapacity);
<span class="line-modified">!     return constructEmptyObject(vm, structure);</span>
  }
  
<span class="line-modified">! inline JSFinalObject* constructEmptyObject(JSGlobalObject* globalObject, JSObject* prototype)</span>
  {
<span class="line-modified">!     return constructEmptyObject(globalObject, prototype, JSFinalObject::defaultInlineCapacity());</span>
  }
  
<span class="line-modified">! inline JSFinalObject* constructEmptyObject(JSGlobalObject* globalObject)</span>
  {
<span class="line-modified">!     return constructEmptyObject(getVM(globalObject), globalObject-&gt;objectStructureForObjectConstructor());</span>
  }
  
<span class="line-modified">! inline JSObject* constructObject(JSGlobalObject* globalObject, JSValue arg)</span>
  {
      if (arg.isUndefinedOrNull())
<span class="line-modified">!         return constructEmptyObject(globalObject, globalObject-&gt;objectPrototype());</span>
<span class="line-modified">!     return arg.toObject(globalObject);</span>
  }
  
  // Section 6.2.4.4 of the ES6 specification.
  // https://tc39.github.io/ecma262/#sec-frompropertydescriptor
<span class="line-modified">! inline JSObject* constructObjectFromPropertyDescriptor(JSGlobalObject* globalObject, const PropertyDescriptor&amp; descriptor)</span>
  {
<span class="line-modified">!     VM&amp; vm = getVM(globalObject);</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
<span class="line-modified">!     JSObject* description = constructEmptyObject(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, nullptr);
  
      if (!descriptor.isAccessorDescriptor()) {
          description-&gt;putDirect(vm, vm.propertyNames-&gt;value, descriptor.value() ? descriptor.value() : jsUndefined(), 0);
          description-&gt;putDirect(vm, vm.propertyNames-&gt;writable, jsBoolean(descriptor.writable()), 0);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 115,13 ***</span>
  
      return description;
  }
  
  
<span class="line-modified">! JS_EXPORT_PRIVATE JSObject* objectConstructorFreeze(ExecState*, JSObject*);</span>
<span class="line-modified">! JS_EXPORT_PRIVATE JSObject* objectConstructorSeal(ExecState*, JSObject*);</span>
<span class="line-modified">! JSValue objectConstructorGetOwnPropertyDescriptor(ExecState*, JSObject*, const Identifier&amp;);</span>
<span class="line-modified">! JSValue objectConstructorGetOwnPropertyDescriptors(ExecState*, JSObject*);</span>
<span class="line-modified">! JSArray* ownPropertyKeys(ExecState*, JSObject*, PropertyNameMode, DontEnumPropertiesMode);</span>
<span class="line-modified">! bool toPropertyDescriptor(ExecState*, JSValue, PropertyDescriptor&amp;);</span>
  
  } // namespace JSC
<span class="line-new-header">--- 116,13 ---</span>
  
      return description;
  }
  
  
<span class="line-modified">! JS_EXPORT_PRIVATE JSObject* objectConstructorFreeze(JSGlobalObject*, JSObject*);</span>
<span class="line-modified">! JS_EXPORT_PRIVATE JSObject* objectConstructorSeal(JSGlobalObject*, JSObject*);</span>
<span class="line-modified">! JSValue objectConstructorGetOwnPropertyDescriptor(JSGlobalObject*, JSObject*, const Identifier&amp;);</span>
<span class="line-modified">! JSValue objectConstructorGetOwnPropertyDescriptors(JSGlobalObject*, JSObject*);</span>
<span class="line-modified">! JSArray* ownPropertyKeys(JSGlobalObject*, JSObject*, PropertyNameMode, DontEnumPropertiesMode);</span>
<span class="line-modified">! bool toPropertyDescriptor(JSGlobalObject*, JSValue, PropertyDescriptor&amp;);</span>
  
  } // namespace JSC
</pre>
<center><a href="ObjectConstructor.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ObjectInitializationScope.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>