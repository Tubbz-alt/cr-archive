<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/assembler/MacroAssemblerARMv7.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MacroAssemblerARM64E.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MacroAssemblerCodeRef.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/assembler/MacroAssemblerARMv7.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (C) 2009-2018 Apple Inc. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (C) 2009-2019 Apple Inc. All rights reserved.</span>
   * Copyright (C) 2010 University of Szeged
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -34,19 +34,19 @@</span>
  namespace JSC {
  
  using Assembler = TARGET_ASSEMBLER;
  
  class MacroAssemblerARMv7 : public AbstractMacroAssembler&lt;Assembler&gt; {
<span class="udiff-line-modified-removed">-     static const RegisterID dataTempRegister = ARMRegisters::ip;</span>
<span class="udiff-line-modified-removed">-     static const RegisterID addressTempRegister = ARMRegisters::r6;</span>
<span class="udiff-line-modified-added">+     static constexpr RegisterID dataTempRegister = ARMRegisters::ip;</span>
<span class="udiff-line-modified-added">+     static constexpr RegisterID addressTempRegister = ARMRegisters::r6;</span>
  
<span class="udiff-line-modified-removed">-     static const ARMRegisters::FPDoubleRegisterID fpTempRegister = ARMRegisters::d7;</span>
<span class="udiff-line-modified-added">+     static constexpr ARMRegisters::FPDoubleRegisterID fpTempRegister = ARMRegisters::d7;</span>
      inline ARMRegisters::FPSingleRegisterID fpTempRegisterAsSingle() { return ARMRegisters::asSingle(fpTempRegister); }
  
  public:
<span class="udiff-line-modified-removed">-     static const unsigned numGPRs = 16;</span>
<span class="udiff-line-modified-removed">-     static const unsigned numFPRs = 16;</span>
<span class="udiff-line-modified-added">+     static constexpr unsigned numGPRs = 16;</span>
<span class="udiff-line-modified-added">+     static constexpr unsigned numFPRs = 16;</span>
  
      MacroAssemblerARMv7()
          : m_makeJumpPatchable(false)
      {
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -54,12 +54,12 @@</span>
      typedef ARMv7Assembler::LinkRecord LinkRecord;
      typedef ARMv7Assembler::JumpType JumpType;
      typedef ARMv7Assembler::JumpLinkType JumpLinkType;
      typedef ARMv7Assembler::Condition Condition;
  
<span class="udiff-line-modified-removed">-     static const ARMv7Assembler::Condition DefaultCondition = ARMv7Assembler::ConditionInvalid;</span>
<span class="udiff-line-modified-removed">-     static const ARMv7Assembler::JumpType DefaultJump = ARMv7Assembler::JumpNoConditionFixedSize;</span>
<span class="udiff-line-modified-added">+     static constexpr ARMv7Assembler::Condition DefaultCondition = ARMv7Assembler::ConditionInvalid;</span>
<span class="udiff-line-modified-added">+     static constexpr ARMv7Assembler::JumpType DefaultJump = ARMv7Assembler::JumpNoConditionFixedSize;</span>
  
      static bool isCompactPtrAlignedAddressOffset(ptrdiff_t value)
      {
          return value &gt;= -255 &amp;&amp; value &lt;= 255;
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -67,12 +67,12 @@</span>
      Vector&lt;LinkRecord, 0, UnsafeVectorOverflow&gt;&amp; jumpsToLink() { return m_assembler.jumpsToLink(); }
      static bool canCompact(JumpType jumpType) { return ARMv7Assembler::canCompact(jumpType); }
      static JumpLinkType computeJumpType(JumpType jumpType, const uint8_t* from, const uint8_t* to) { return ARMv7Assembler::computeJumpType(jumpType, from, to); }
      static JumpLinkType computeJumpType(LinkRecord&amp; record, const uint8_t* from, const uint8_t* to) { return ARMv7Assembler::computeJumpType(record, from, to); }
      static int jumpSizeDelta(JumpType jumpType, JumpLinkType jumpLinkType) { return ARMv7Assembler::jumpSizeDelta(jumpType, jumpLinkType); }
<span class="udiff-line-modified-removed">-     template &lt;typename CopyFunction&gt;</span>
<span class="udiff-line-modified-removed">-     static void link(LinkRecord&amp; record, uint8_t* from, const uint8_t* fromInstruction, uint8_t* to, CopyFunction copy) { return ARMv7Assembler::link(record, from, fromInstruction, to, copy); }</span>
<span class="udiff-line-modified-added">+     template &lt;Assembler::CopyFunction copy&gt;</span>
<span class="udiff-line-modified-added">+     static void link(LinkRecord&amp; record, uint8_t* from, const uint8_t* fromInstruction, uint8_t* to) { return ARMv7Assembler::link&lt;copy&gt;(record, from, fromInstruction, to); }</span>
  
      struct ArmAddress {
          enum AddressType {
              HasOffset,
              HasIndex,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -101,11 +101,11 @@</span>
              u.scale = scale;
          }
      };
  
  public:
<span class="udiff-line-modified-removed">-     static const Scale ScalePtr = TimesFour;</span>
<span class="udiff-line-modified-added">+     static constexpr Scale ScalePtr = TimesFour;</span>
  
      enum RelationalCondition {
          Equal = ARMv7Assembler::ConditionEQ,
          NotEqual = ARMv7Assembler::ConditionNE,
          Above = ARMv7Assembler::ConditionHI,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -141,13 +141,13 @@</span>
          DoubleGreaterThanOrEqualOrUnordered = ARMv7Assembler::ConditionHS,
          DoubleLessThanOrUnordered = ARMv7Assembler::ConditionLT,
          DoubleLessThanOrEqualOrUnordered = ARMv7Assembler::ConditionLE,
      };
  
<span class="udiff-line-modified-removed">-     static const RegisterID stackPointerRegister = ARMRegisters::sp;</span>
<span class="udiff-line-modified-removed">-     static const RegisterID framePointerRegister = ARMRegisters::fp;</span>
<span class="udiff-line-modified-removed">-     static const RegisterID linkRegister = ARMRegisters::lr;</span>
<span class="udiff-line-modified-added">+     static constexpr RegisterID stackPointerRegister = ARMRegisters::sp;</span>
<span class="udiff-line-modified-added">+     static constexpr RegisterID framePointerRegister = ARMRegisters::fp;</span>
<span class="udiff-line-modified-added">+     static constexpr RegisterID linkRegister = ARMRegisters::lr;</span>
  
      // Integer arithmetic operations:
      //
      // Operations are typically two operand - operation(source, srcDst)
      // For many operations the source may be an TrustedImm32, the srcDst operand
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -364,10 +364,28 @@</span>
      void or32(RegisterID src, RegisterID dest)
      {
          m_assembler.orr(dest, dest, src);
      }
  
<span class="udiff-line-added">+     void or16(TrustedImm32 imm, AbsoluteAddress dest)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         ARMThumbImmediate armImm = ARMThumbImmediate::makeEncodedImm(imm.m_value);</span>
<span class="udiff-line-added">+         if (armImm.isValid()) {</span>
<span class="udiff-line-added">+             move(TrustedImmPtr(dest.m_ptr), addressTempRegister);</span>
<span class="udiff-line-added">+             load16(addressTempRegister, dataTempRegister);</span>
<span class="udiff-line-added">+             m_assembler.orr(dataTempRegister, dataTempRegister, armImm);</span>
<span class="udiff-line-added">+             store16(dataTempRegister, addressTempRegister);</span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+             move(TrustedImmPtr(dest.m_ptr), addressTempRegister);</span>
<span class="udiff-line-added">+             load16(addressTempRegister, dataTempRegister);</span>
<span class="udiff-line-added">+             move(imm, addressTempRegister);</span>
<span class="udiff-line-added">+             m_assembler.orr(dataTempRegister, dataTempRegister, addressTempRegister);</span>
<span class="udiff-line-added">+             move(TrustedImmPtr(dest.m_ptr), addressTempRegister);</span>
<span class="udiff-line-added">+             store16(dataTempRegister, addressTempRegister);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      void or32(RegisterID src, AbsoluteAddress dest)
      {
          move(TrustedImmPtr(dest.m_ptr), addressTempRegister);
          load32(addressTempRegister, dataTempRegister);
          or32(src, dataTempRegister);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -780,10 +798,16 @@</span>
  
          m_assembler.ldr(dest, base, address.offset, true, false);
          return label;
      }
  
<span class="udiff-line-added">+     void load16(const void* address, RegisterID dest)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         move(TrustedImmPtr(address), addressTempRegister);</span>
<span class="udiff-line-added">+         m_assembler.ldrh(dest, addressTempRegister, ARMThumbImmediate::makeUInt16(0));</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      void load16(BaseIndex address, RegisterID dest)
      {
          m_assembler.ldrh(dest, makeBaseIndexBase(address), address.index, address.scale);
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -887,10 +911,22 @@</span>
      void store16(RegisterID src, BaseIndex address)
      {
          store16(src, setupArmAddress(address));
      }
  
<span class="udiff-line-added">+     void store16(RegisterID src, const void* address)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         move(TrustedImmPtr(address), addressTempRegister);</span>
<span class="udiff-line-added">+         m_assembler.strh(src, addressTempRegister, ARMThumbImmediate::makeUInt12(0));</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     void store16(TrustedImm32 imm, const void* address)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         move(imm, dataTempRegister);</span>
<span class="udiff-line-added">+         store16(dataTempRegister, address);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      // Possibly clobbers src, but not on this architecture.
      void moveDoubleToInts(FPRegisterID src, RegisterID dest1, RegisterID dest2)
      {
          m_assembler.vmov(dest1, dest2, src);
      }
</pre>
<center><a href="MacroAssemblerARM64E.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MacroAssemblerCodeRef.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>