<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old modules/javafx.web/src/main/native/Source/WebCore/platform/libwpe/PlatformPasteboardLibWPE.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2015 Igalia S.L.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 14  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 15  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 17  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 18  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 19  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 20  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 21  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 23  * THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;PlatformPasteboard.h&quot;
 28 
 29 #if USE(LIBWPE)
 30 
 31 #include &quot;Pasteboard.h&quot;
 32 #include &lt;wpe/wpe.h&gt;
 33 #include &lt;wtf/Assertions.h&gt;
 34 #include &lt;wtf/text/WTFString.h&gt;
 35 
 36 namespace WebCore {
 37 
 38 PlatformPasteboard::PlatformPasteboard(const String&amp;)
 39     : m_pasteboard(wpe_pasteboard_get_singleton())
 40 {
 41     ASSERT(m_pasteboard);
 42 }
 43 
 44 PlatformPasteboard::PlatformPasteboard()
 45     : m_pasteboard(wpe_pasteboard_get_singleton())
 46 {
 47     ASSERT(m_pasteboard);
 48 }
 49 
 50 void PlatformPasteboard::getTypes(Vector&lt;String&gt;&amp; types)
 51 {
 52     struct wpe_pasteboard_string_vector pasteboardTypes = { nullptr, 0 };
 53     wpe_pasteboard_get_types(m_pasteboard, &amp;pasteboardTypes);
 54 
 55     for (unsigned i = 0; i &lt; pasteboardTypes.length; ++i) {
 56         auto&amp; typeString = pasteboardTypes.strings[i];
 57         types.append(String(typeString.data, typeString.length));
 58     }
 59 
 60     wpe_pasteboard_string_vector_free(&amp;pasteboardTypes);
 61 }
 62 
 63 String PlatformPasteboard::readString(int, const String&amp; type) const
 64 {
 65     struct wpe_pasteboard_string string = { nullptr, 0 };
 66     wpe_pasteboard_get_string(m_pasteboard, type.utf8().data(), &amp;string);
 67     if (!string.length)
 68         return String();
 69 
 70     String returnValue(string.data, string.length);
 71 
 72     wpe_pasteboard_string_free(&amp;string);
 73     return returnValue;
 74 }
 75 
 76 void PlatformPasteboard::write(const PasteboardWebContent&amp; content)
 77 {
 78     static const char plainText[] = &quot;text/plain;charset=utf-8&quot;;
 79     static const char htmlText[] = &quot;text/html;charset=utf-8&quot;;
 80 
 81     CString textString = content.text.utf8();
 82     CString markupString = content.markup.utf8();
 83 
 84     struct wpe_pasteboard_string_pair pairs[] = {
 85         { { nullptr, 0 }, { nullptr, 0 } },
 86         { { nullptr, 0 }, { nullptr, 0 } },
 87     };
 88     wpe_pasteboard_string_initialize(&amp;pairs[0].type, plainText, strlen(plainText));
 89     wpe_pasteboard_string_initialize(&amp;pairs[0].string, textString.data(), textString.length());
 90     wpe_pasteboard_string_initialize(&amp;pairs[1].type, htmlText, strlen(htmlText));
 91     wpe_pasteboard_string_initialize(&amp;pairs[1].string, markupString.data(), markupString.length());
 92     struct wpe_pasteboard_string_map map = { pairs, 2 };
 93 
 94     wpe_pasteboard_write(m_pasteboard, &amp;map);
 95 
 96     wpe_pasteboard_string_free(&amp;pairs[0].type);
 97     wpe_pasteboard_string_free(&amp;pairs[0].string);
 98     wpe_pasteboard_string_free(&amp;pairs[1].type);
 99     wpe_pasteboard_string_free(&amp;pairs[1].string);
100 }
101 
102 void PlatformPasteboard::write(const String&amp; type, const String&amp; string)
103 {
104     struct wpe_pasteboard_string_pair pairs[] = {
105         { { nullptr, 0 }, { nullptr, 0 } },
106     };
107 
108     auto typeUTF8 = type.utf8();
109     auto stringUTF8 = string.utf8();
110     wpe_pasteboard_string_initialize(&amp;pairs[0].type, typeUTF8.data(), typeUTF8.length());
111     wpe_pasteboard_string_initialize(&amp;pairs[0].string, stringUTF8.data(), stringUTF8.length());
112     struct wpe_pasteboard_string_map map = { pairs, 1 };
113 
114     wpe_pasteboard_write(m_pasteboard, &amp;map);
115 
116     wpe_pasteboard_string_free(&amp;pairs[0].type);
117     wpe_pasteboard_string_free(&amp;pairs[0].string);
118 }
119 
120 Vector&lt;String&gt; PlatformPasteboard::typesSafeForDOMToReadAndWrite(const String&amp;) const
121 {
122     return { };
123 }
124 
125 long PlatformPasteboard::write(const PasteboardCustomData&amp;)
126 {
127     return 0;
128 }
129 
130 } // namespace WebCore
131 
132 #endif // USE(LIBWPE)
    </pre>
  </body>
</html>