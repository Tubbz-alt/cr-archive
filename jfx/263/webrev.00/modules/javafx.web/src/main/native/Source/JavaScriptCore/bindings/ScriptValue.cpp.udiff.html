<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/bindings/ScriptValue.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ScriptObject.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ScriptValue.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/bindings/ScriptValue.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -33,16 +33,15 @@</span>
  #include &quot;APICast.h&quot;
  #include &quot;CatchScope.h&quot;
  #include &quot;JSCInlines.h&quot;
  #include &quot;JSLock.h&quot;
  
<span class="udiff-line-removed">- using namespace JSC;</span>
<span class="udiff-line-removed">- using namespace Inspector;</span>
<span class="udiff-line-removed">- </span>
  namespace Inspector {
  
<span class="udiff-line-modified-removed">- static RefPtr&lt;JSON::Value&gt; jsToInspectorValue(ExecState&amp; scriptState, JSValue value, int maxDepth)</span>
<span class="udiff-line-modified-added">+ using namespace JSC;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ static RefPtr&lt;JSON::Value&gt; jsToInspectorValue(JSGlobalObject* globalObject, JSValue value, int maxDepth)</span>
  {
      if (!value) {
          ASSERT_NOT_REACHED();
          return nullptr;
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -59,32 +58,32 @@</span>
      if (value.isNumber() &amp;&amp; value.isDouble())
          return JSON::Value::create(value.asNumber());
      if (value.isNumber() &amp;&amp; value.isAnyInt())
          return JSON::Value::create(static_cast&lt;int&gt;(value.asAnyInt()));
      if (value.isString())
<span class="udiff-line-modified-removed">-         return JSON::Value::create(asString(value)-&gt;value(&amp;scriptState));</span>
<span class="udiff-line-modified-added">+         return JSON::Value::create(asString(value)-&gt;value(globalObject));</span>
  
      if (value.isObject()) {
          if (isJSArray(value)) {
              auto inspectorArray = JSON::Array::create();
              auto&amp; array = *asArray(value);
              unsigned length = array.length();
              for (unsigned i = 0; i &lt; length; i++) {
<span class="udiff-line-modified-removed">-                 auto elementValue = jsToInspectorValue(scriptState, array.getIndex(&amp;scriptState, i), maxDepth);</span>
<span class="udiff-line-modified-added">+                 auto elementValue = jsToInspectorValue(globalObject, array.getIndex(globalObject, i), maxDepth);</span>
                  if (!elementValue)
                      return nullptr;
                  inspectorArray-&gt;pushValue(WTFMove(elementValue));
              }
              return inspectorArray;
          }
<span class="udiff-line-modified-removed">-         VM&amp; vm = scriptState.vm();</span>
<span class="udiff-line-modified-added">+         VM&amp; vm = globalObject-&gt;vm();</span>
          auto inspectorObject = JSON::Object::create();
          auto&amp; object = *value.getObject();
          PropertyNameArray propertyNames(vm, PropertyNameMode::Strings, PrivateSymbolMode::Exclude);
<span class="udiff-line-modified-removed">-         object.methodTable(vm)-&gt;getOwnPropertyNames(&amp;object, &amp;scriptState, propertyNames, EnumerationMode());</span>
<span class="udiff-line-modified-added">+         object.methodTable(vm)-&gt;getOwnPropertyNames(&amp;object, globalObject, propertyNames, EnumerationMode());</span>
          for (auto&amp; name : propertyNames) {
<span class="udiff-line-modified-removed">-             auto inspectorValue = jsToInspectorValue(scriptState, object.get(&amp;scriptState, name), maxDepth);</span>
<span class="udiff-line-modified-added">+             auto inspectorValue = jsToInspectorValue(globalObject, object.get(globalObject, name), maxDepth);</span>
              if (!inspectorValue)
                  return nullptr;
              inspectorObject-&gt;setValue(name.string(), WTFMove(inspectorValue));
          }
          return inspectorObject;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -92,14 +91,14 @@</span>
  
      ASSERT_NOT_REACHED();
      return nullptr;
  }
  
<span class="udiff-line-modified-removed">- RefPtr&lt;JSON::Value&gt; toInspectorValue(ExecState&amp; state, JSValue value)</span>
<span class="udiff-line-modified-added">+ RefPtr&lt;JSON::Value&gt; toInspectorValue(JSGlobalObject* globalObject, JSValue value)</span>
  {
      // FIXME: Maybe we should move the JSLockHolder stuff to the callers since this function takes a JSValue directly.
      // Doing the locking here made sense when we were trying to abstract the difference between multiple JavaScript engines.
<span class="udiff-line-modified-removed">-     JSLockHolder holder(&amp;state);</span>
<span class="udiff-line-modified-removed">-     return jsToInspectorValue(state, value, JSON::Value::maxDepth);</span>
<span class="udiff-line-modified-added">+     JSLockHolder holder(globalObject);</span>
<span class="udiff-line-modified-added">+     return jsToInspectorValue(globalObject, value, JSON::Value::maxDepth);</span>
  }
  
  } // namespace Inspector
</pre>
<center><a href="ScriptObject.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ScriptValue.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>