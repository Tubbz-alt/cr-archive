<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/IntlDateTimeFormatPrototype.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="IntlDateTimeFormatConstructor.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="IntlDateTimeFormatPrototype.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/IntlDateTimeFormatPrototype.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -39,15 +39,15 @@</span>
  #include &quot;JSObjectInlines.h&quot;
  #include &lt;wtf/DateMath.h&gt;
  
  namespace JSC {
  
<span class="udiff-line-modified-removed">- static EncodedJSValue JSC_HOST_CALL IntlDateTimeFormatPrototypeGetterFormat(ExecState*);</span>
<span class="udiff-line-modified-added">+ static EncodedJSValue JSC_HOST_CALL IntlDateTimeFormatPrototypeGetterFormat(JSGlobalObject*, CallFrame*);</span>
  #if JSC_ICU_HAS_UFIELDPOSITER
<span class="udiff-line-modified-removed">- static EncodedJSValue JSC_HOST_CALL IntlDateTimeFormatPrototypeFuncFormatToParts(ExecState*);</span>
<span class="udiff-line-modified-added">+ static EncodedJSValue JSC_HOST_CALL IntlDateTimeFormatPrototypeFuncFormatToParts(JSGlobalObject*, CallFrame*);</span>
  #endif
<span class="udiff-line-modified-removed">- static EncodedJSValue JSC_HOST_CALL IntlDateTimeFormatPrototypeFuncResolvedOptions(ExecState*);</span>
<span class="udiff-line-modified-added">+ static EncodedJSValue JSC_HOST_CALL IntlDateTimeFormatPrototypeFuncResolvedOptions(JSGlobalObject*, CallFrame*);</span>
  
  }
  
  #include &quot;IntlDateTimeFormatPrototype.lut.h&quot;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -87,120 +87,120 @@</span>
      putDirectWithoutTransition(vm, vm.propertyNames-&gt;formatToParts, formatToPartsFunction, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
  #else
      UNUSED_PARAM(globalObject);
  #endif
  
<span class="udiff-line-modified-removed">-     putDirectWithoutTransition(vm, vm.propertyNames-&gt;toStringTagSymbol, jsString(vm, &quot;Object&quot;), PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);</span>
<span class="udiff-line-modified-added">+     putDirectWithoutTransition(vm, vm.propertyNames-&gt;toStringTagSymbol, jsNontrivialString(vm, &quot;Object&quot;_s), PropertyAttribute::DontEnum | PropertyAttribute::ReadOnly);</span>
  }
  
<span class="udiff-line-modified-removed">- static EncodedJSValue JSC_HOST_CALL IntlDateTimeFormatFuncFormatDateTime(ExecState* state)</span>
<span class="udiff-line-modified-added">+ static EncodedJSValue JSC_HOST_CALL IntlDateTimeFormatFuncFormatDateTime(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = state-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
      // 12.1.7 DateTime Format Functions (ECMA-402)
      // https://tc39.github.io/ecma402/#sec-formatdatetime
  
<span class="udiff-line-modified-removed">-     IntlDateTimeFormat* format = jsCast&lt;IntlDateTimeFormat*&gt;(state-&gt;thisValue());</span>
<span class="udiff-line-modified-added">+     IntlDateTimeFormat* format = jsCast&lt;IntlDateTimeFormat*&gt;(callFrame-&gt;thisValue());</span>
  
<span class="udiff-line-modified-removed">-     JSValue date = state-&gt;argument(0);</span>
<span class="udiff-line-modified-added">+     JSValue date = callFrame-&gt;argument(0);</span>
      double value;
  
      if (date.isUndefined())
<span class="udiff-line-modified-removed">-         value = JSValue::decode(dateNow(state)).toNumber(state);</span>
<span class="udiff-line-modified-added">+         value = dateNowImpl().toNumber(globalObject);</span>
      else {
<span class="udiff-line-modified-removed">-         value = WTF::timeClip(date.toNumber(state));</span>
<span class="udiff-line-modified-added">+         value = WTF::timeClip(date.toNumber(globalObject));</span>
          RETURN_IF_EXCEPTION(scope, encodedJSValue());
      }
  
<span class="udiff-line-modified-removed">-     RELEASE_AND_RETURN(scope, JSValue::encode(format-&gt;format(*state, value)));</span>
<span class="udiff-line-modified-added">+     RELEASE_AND_RETURN(scope, JSValue::encode(format-&gt;format(globalObject, value)));</span>
  }
  
<span class="udiff-line-modified-removed">- EncodedJSValue JSC_HOST_CALL IntlDateTimeFormatPrototypeGetterFormat(ExecState* state)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JSC_HOST_CALL IntlDateTimeFormatPrototypeGetterFormat(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = state-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      // 12.3.3 Intl.DateTimeFormat.prototype.format (ECMA-402 2.0)
      // 1. Let dtf be this DateTimeFormat object.
<span class="udiff-line-modified-removed">-     IntlDateTimeFormat* dtf = jsDynamicCast&lt;IntlDateTimeFormat*&gt;(vm, state-&gt;thisValue());</span>
<span class="udiff-line-modified-added">+     IntlDateTimeFormat* dtf = jsDynamicCast&lt;IntlDateTimeFormat*&gt;(vm, callFrame-&gt;thisValue());</span>
  
      // FIXME: Workaround to provide compatibility with ECMA-402 1.0 call/apply patterns.
      // https://bugs.webkit.org/show_bug.cgi?id=153679
      if (!dtf) {
<span class="udiff-line-modified-removed">-         JSValue value = state-&gt;thisValue().get(state, vm.propertyNames-&gt;builtinNames().intlSubstituteValuePrivateName());</span>
<span class="udiff-line-modified-added">+         JSValue value = callFrame-&gt;thisValue().get(globalObject, vm.propertyNames-&gt;builtinNames().intlSubstituteValuePrivateName());</span>
          RETURN_IF_EXCEPTION(scope, encodedJSValue());
          dtf = jsDynamicCast&lt;IntlDateTimeFormat*&gt;(vm, value);
      }
  
      // 2. ReturnIfAbrupt(dtf).
      if (!dtf)
<span class="udiff-line-modified-removed">-         return JSValue::encode(throwTypeError(state, scope, &quot;Intl.DateTimeFormat.prototype.format called on value that&#39;s not an object initialized as a DateTimeFormat&quot;_s));</span>
<span class="udiff-line-modified-added">+         return JSValue::encode(throwTypeError(globalObject, scope, &quot;Intl.DateTimeFormat.prototype.format called on value that&#39;s not an object initialized as a DateTimeFormat&quot;_s));</span>
  
      JSBoundFunction* boundFormat = dtf-&gt;boundFormat();
      // 3. If the [[boundFormat]] internal slot of this DateTimeFormat object is undefined,
      if (!boundFormat) {
          JSGlobalObject* globalObject = dtf-&gt;globalObject(vm);
          // a. Let F be a new built-in function object as defined in 12.3.4.
          // b. The value of F’s length property is 1. (Note: F’s length property was 0 in ECMA-402 1.0)
          JSFunction* targetObject = JSFunction::create(vm, globalObject, 1, &quot;format&quot;_s, IntlDateTimeFormatFuncFormatDateTime, NoIntrinsic);
          // c. Let bf be BoundFunctionCreate(F, «this value»).
<span class="udiff-line-modified-removed">-         boundFormat = JSBoundFunction::create(vm, state, globalObject, targetObject, dtf, nullptr, 1, &quot;format&quot;_s);</span>
<span class="udiff-line-modified-added">+         boundFormat = JSBoundFunction::create(vm, globalObject, targetObject, dtf, nullptr, 1, nullptr);</span>
          RETURN_IF_EXCEPTION(scope, encodedJSValue());
          // d. Set dtf.[[boundFormat]] to bf.
          dtf-&gt;setBoundFormat(vm, boundFormat);
      }
      // 4. Return dtf.[[boundFormat]].
      return JSValue::encode(boundFormat);
  }
  
  #if JSC_ICU_HAS_UFIELDPOSITER
<span class="udiff-line-modified-removed">- EncodedJSValue JSC_HOST_CALL IntlDateTimeFormatPrototypeFuncFormatToParts(ExecState* state)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JSC_HOST_CALL IntlDateTimeFormatPrototypeFuncFormatToParts(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = state-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      // 15.4 Intl.DateTimeFormat.prototype.formatToParts (ECMA-402 4.0)
      // https://tc39.github.io/ecma402/#sec-Intl.DateTimeFormat.prototype.formatToParts
  
<span class="udiff-line-modified-removed">-     IntlDateTimeFormat* dateTimeFormat = jsDynamicCast&lt;IntlDateTimeFormat*&gt;(vm, state-&gt;thisValue());</span>
<span class="udiff-line-modified-added">+     IntlDateTimeFormat* dateTimeFormat = jsDynamicCast&lt;IntlDateTimeFormat*&gt;(vm, callFrame-&gt;thisValue());</span>
      if (!dateTimeFormat)
<span class="udiff-line-modified-removed">-         return JSValue::encode(throwTypeError(state, scope, &quot;Intl.DateTimeFormat.prototype.formatToParts called on value that&#39;s not an object initialized as a DateTimeFormat&quot;_s));</span>
<span class="udiff-line-modified-added">+         return JSValue::encode(throwTypeError(globalObject, scope, &quot;Intl.DateTimeFormat.prototype.formatToParts called on value that&#39;s not an object initialized as a DateTimeFormat&quot;_s));</span>
  
<span class="udiff-line-modified-removed">-     JSValue date = state-&gt;argument(0);</span>
<span class="udiff-line-modified-added">+     JSValue date = callFrame-&gt;argument(0);</span>
      double value;
  
      if (date.isUndefined())
<span class="udiff-line-modified-removed">-         value = JSValue::decode(dateNow(state)).toNumber(state);</span>
<span class="udiff-line-modified-added">+         value = dateNowImpl().toNumber(globalObject);</span>
      else {
<span class="udiff-line-modified-removed">-         value = WTF::timeClip(date.toNumber(state));</span>
<span class="udiff-line-modified-added">+         value = WTF::timeClip(date.toNumber(globalObject));</span>
          RETURN_IF_EXCEPTION(scope, encodedJSValue());
      }
  
<span class="udiff-line-modified-removed">-     RELEASE_AND_RETURN(scope, JSValue::encode(dateTimeFormat-&gt;formatToParts(*state, value)));</span>
<span class="udiff-line-modified-added">+     RELEASE_AND_RETURN(scope, JSValue::encode(dateTimeFormat-&gt;formatToParts(globalObject, value)));</span>
  }
  #endif
  
<span class="udiff-line-modified-removed">- EncodedJSValue JSC_HOST_CALL IntlDateTimeFormatPrototypeFuncResolvedOptions(ExecState* state)</span>
<span class="udiff-line-modified-added">+ EncodedJSValue JSC_HOST_CALL IntlDateTimeFormatPrototypeFuncResolvedOptions(JSGlobalObject* globalObject, CallFrame* callFrame)</span>
  {
<span class="udiff-line-modified-removed">-     VM&amp; vm = state-&gt;vm();</span>
<span class="udiff-line-modified-added">+     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      // 12.3.5 Intl.DateTimeFormat.prototype.resolvedOptions() (ECMA-402 2.0)
<span class="udiff-line-modified-removed">-     IntlDateTimeFormat* dateTimeFormat = jsDynamicCast&lt;IntlDateTimeFormat*&gt;(vm, state-&gt;thisValue());</span>
<span class="udiff-line-modified-added">+     IntlDateTimeFormat* dateTimeFormat = jsDynamicCast&lt;IntlDateTimeFormat*&gt;(vm, callFrame-&gt;thisValue());</span>
  
      // FIXME: Workaround to provide compatibility with ECMA-402 1.0 call/apply patterns.
      // https://bugs.webkit.org/show_bug.cgi?id=153679
      if (!dateTimeFormat) {
<span class="udiff-line-modified-removed">-         JSValue value = state-&gt;thisValue().get(state, vm.propertyNames-&gt;builtinNames().intlSubstituteValuePrivateName());</span>
<span class="udiff-line-modified-added">+         JSValue value = callFrame-&gt;thisValue().get(globalObject, vm.propertyNames-&gt;builtinNames().intlSubstituteValuePrivateName());</span>
          RETURN_IF_EXCEPTION(scope, encodedJSValue());
          dateTimeFormat = jsDynamicCast&lt;IntlDateTimeFormat*&gt;(vm, value);
      }
  
      if (!dateTimeFormat)
<span class="udiff-line-modified-removed">-         return JSValue::encode(throwTypeError(state, scope, &quot;Intl.DateTimeFormat.prototype.resolvedOptions called on value that&#39;s not an object initialized as a DateTimeFormat&quot;_s));</span>
<span class="udiff-line-modified-added">+         return JSValue::encode(throwTypeError(globalObject, scope, &quot;Intl.DateTimeFormat.prototype.resolvedOptions called on value that&#39;s not an object initialized as a DateTimeFormat&quot;_s));</span>
  
<span class="udiff-line-modified-removed">-     RELEASE_AND_RETURN(scope, JSValue::encode(dateTimeFormat-&gt;resolvedOptions(*state)));</span>
<span class="udiff-line-modified-added">+     RELEASE_AND_RETURN(scope, JSValue::encode(dateTimeFormat-&gt;resolvedOptions(globalObject)));</span>
  }
  
  } // namespace JSC
  
  #endif // ENABLE(INTL)
</pre>
<center><a href="IntlDateTimeFormatConstructor.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="IntlDateTimeFormatPrototype.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>