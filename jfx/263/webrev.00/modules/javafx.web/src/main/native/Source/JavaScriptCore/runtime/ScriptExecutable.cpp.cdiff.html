<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/ScriptExecutable.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ScopedArgumentsTable.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ScriptExecutable.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/ScriptExecutable.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 194,12 ***</span>
  
      if (genericCodeBlock) {
          RELEASE_ASSERT(genericCodeBlock-&gt;ownerExecutable() == this);
          RELEASE_ASSERT(JITCode::isExecutableScript(genericCodeBlock-&gt;jitType()));
  
<span class="line-modified">!         if (UNLIKELY(Options::verboseOSR()))</span>
<span class="line-removed">-             dataLog(&quot;Installing &quot;, *genericCodeBlock, &quot;\n&quot;);</span>
  
          if (UNLIKELY(vm.m_perBytecodeProfiler))
              vm.m_perBytecodeProfiler-&gt;ensureBytecodesFor(genericCodeBlock);
  
          Debugger* debugger = genericCodeBlock-&gt;globalObject()-&gt;debugger();
<span class="line-new-header">--- 194,11 ---</span>
  
      if (genericCodeBlock) {
          RELEASE_ASSERT(genericCodeBlock-&gt;ownerExecutable() == this);
          RELEASE_ASSERT(JITCode::isExecutableScript(genericCodeBlock-&gt;jitType()));
  
<span class="line-modified">!         dataLogLnIf(Options::verboseOSR(), &quot;Installing &quot;, *genericCodeBlock);</span>
  
          if (UNLIKELY(vm.m_perBytecodeProfiler))
              vm.m_perBytecodeProfiler-&gt;ensureBytecodesFor(genericCodeBlock);
  
          Debugger* debugger = genericCodeBlock-&gt;globalObject()-&gt;debugger();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 254,11 ***</span>
  
      ASSERT(vm.heap.isDeferred());
      ASSERT(endColumn() != UINT_MAX);
  
      JSGlobalObject* globalObject = scope-&gt;globalObject(vm);
<span class="line-removed">-     ExecState* exec = globalObject-&gt;globalExec();</span>
  
      if (classInfo(vm) == EvalExecutable::info()) {
          EvalExecutable* executable = jsCast&lt;EvalExecutable*&gt;(this);
          RELEASE_ASSERT(kind == CodeForCall);
          RELEASE_ASSERT(!executable-&gt;m_evalCodeBlock);
<span class="line-new-header">--- 253,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 266,12 ***</span>
          auto codeBlock = EvalCodeBlock::create(vm,
              executable, executable-&gt;m_unlinkedEvalCodeBlock.get(), scope);
          EXCEPTION_ASSERT(throwScope.exception() || codeBlock);
          if (!codeBlock) {
              exception = throwException(
<span class="line-modified">!                 exec, throwScope,</span>
<span class="line-modified">!                 createOutOfMemoryError(exec));</span>
              return nullptr;
          }
          return codeBlock;
      }
  
<span class="line-new-header">--- 264,12 ---</span>
          auto codeBlock = EvalCodeBlock::create(vm,
              executable, executable-&gt;m_unlinkedEvalCodeBlock.get(), scope);
          EXCEPTION_ASSERT(throwScope.exception() || codeBlock);
          if (!codeBlock) {
              exception = throwException(
<span class="line-modified">!                 globalObject, throwScope,</span>
<span class="line-modified">!                 createOutOfMemoryError(globalObject));</span>
              return nullptr;
          }
          return codeBlock;
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 283,12 ***</span>
          auto codeBlock = ProgramCodeBlock::create(vm,
              executable, executable-&gt;m_unlinkedProgramCodeBlock.get(), scope);
          EXCEPTION_ASSERT(throwScope.exception() || codeBlock);
          if (!codeBlock) {
              exception = throwException(
<span class="line-modified">!                 exec, throwScope,</span>
<span class="line-modified">!                 createOutOfMemoryError(exec));</span>
              return nullptr;
          }
          return codeBlock;
      }
  
<span class="line-new-header">--- 281,12 ---</span>
          auto codeBlock = ProgramCodeBlock::create(vm,
              executable, executable-&gt;m_unlinkedProgramCodeBlock.get(), scope);
          EXCEPTION_ASSERT(throwScope.exception() || codeBlock);
          if (!codeBlock) {
              exception = throwException(
<span class="line-modified">!                 globalObject, throwScope,</span>
<span class="line-modified">!                 createOutOfMemoryError(globalObject));</span>
              return nullptr;
          }
          return codeBlock;
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 300,12 ***</span>
          auto codeBlock = ModuleProgramCodeBlock::create(vm,
              executable, executable-&gt;m_unlinkedModuleProgramCodeBlock.get(), scope);
          EXCEPTION_ASSERT(throwScope.exception() || codeBlock);
          if (!codeBlock) {
              exception = throwException(
<span class="line-modified">!                 exec, throwScope,</span>
<span class="line-modified">!                 createOutOfMemoryError(exec));</span>
              return nullptr;
          }
          return codeBlock;
      }
  
<span class="line-new-header">--- 298,12 ---</span>
          auto codeBlock = ModuleProgramCodeBlock::create(vm,
              executable, executable-&gt;m_unlinkedModuleProgramCodeBlock.get(), scope);
          EXCEPTION_ASSERT(throwScope.exception() || codeBlock);
          if (!codeBlock) {
              exception = throwException(
<span class="line-modified">!                 globalObject, throwScope,</span>
<span class="line-modified">!                 createOutOfMemoryError(globalObject));</span>
              return nullptr;
          }
          return codeBlock;
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 332,11 ***</span>
          executable-&gt;m_unlinkedExecutable-&gt;features(),
          executable-&gt;m_unlinkedExecutable-&gt;hasCapturedVariables(),
          lastLine(), endColumn());
      if (!unlinkedCodeBlock) {
          exception = throwException(
<span class="line-modified">!             globalObject-&gt;globalExec(), throwScope,</span>
              error.toErrorObject(globalObject, executable-&gt;source()));
          return nullptr;
      }
  
      RELEASE_AND_RETURN(throwScope, FunctionCodeBlock::create(vm, executable, unlinkedCodeBlock, scope));
<span class="line-new-header">--- 330,11 ---</span>
          executable-&gt;m_unlinkedExecutable-&gt;features(),
          executable-&gt;m_unlinkedExecutable-&gt;hasCapturedVariables(),
          lastLine(), endColumn());
      if (!unlinkedCodeBlock) {
          exception = throwException(
<span class="line-modified">!             globalObject, throwScope,</span>
              error.toErrorObject(globalObject, executable-&gt;source()));
          return nullptr;
      }
  
      RELEASE_AND_RETURN(throwScope, FunctionCodeBlock::create(vm, executable, unlinkedCodeBlock, scope));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 411,12 ***</span>
  {
      auto throwScope = DECLARE_THROW_SCOPE(vm);
      DeferGCForAWhile deferGC(vm.heap);
  
      if (UNLIKELY(vm.getAndClearFailNextNewCodeBlock())) {
<span class="line-modified">!         auto&amp; state = *scope-&gt;globalObject(vm)-&gt;globalExec();</span>
<span class="line-modified">!         return throwException(&amp;state, throwScope, createError(&amp;state, &quot;Forced Failure&quot;_s));</span>
      }
  
      Exception* exception = nullptr;
      CodeBlock* codeBlock = newCodeBlockFor(kind, function, scope, exception);
      resultCodeBlock = codeBlock;
<span class="line-new-header">--- 409,12 ---</span>
  {
      auto throwScope = DECLARE_THROW_SCOPE(vm);
      DeferGCForAWhile deferGC(vm.heap);
  
      if (UNLIKELY(vm.getAndClearFailNextNewCodeBlock())) {
<span class="line-modified">!         JSGlobalObject* globalObject = scope-&gt;globalObject(vm);</span>
<span class="line-modified">!         return throwException(globalObject, throwScope, createError(globalObject, &quot;Forced Failure&quot;_s));</span>
      }
  
      Exception* exception = nullptr;
      CodeBlock* codeBlock = newCodeBlockFor(kind, function, scope, exception);
      resultCodeBlock = codeBlock;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 444,24 ***</span>
      default:
          return this;
      }
  }
  
<span class="line-modified">! JSArray* ScriptExecutable::createTemplateObject(ExecState* exec, JSTemplateObjectDescriptor* descriptor)</span>
  {
<span class="line-modified">!     VM&amp; vm = exec-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      TemplateObjectMap&amp; templateObjectMap = ensureTemplateObjectMap(vm);
      TemplateObjectMap::AddResult result;
      {
          auto locker = holdLock(cellLock());
          result = templateObjectMap.add(descriptor-&gt;endOffset(), WriteBarrier&lt;JSArray&gt;());
      }
      if (JSArray* array = result.iterator-&gt;value.get())
          return array;
<span class="line-modified">!     JSArray* templateObject = descriptor-&gt;createTemplateObject(exec);</span>
      RETURN_IF_EXCEPTION(scope, nullptr);
      result.iterator-&gt;value.set(vm, this, templateObject);
      return templateObject;
  }
  
<span class="line-new-header">--- 442,24 ---</span>
      default:
          return this;
      }
  }
  
<span class="line-modified">! JSArray* ScriptExecutable::createTemplateObject(JSGlobalObject* globalObject, JSTemplateObjectDescriptor* descriptor)</span>
  {
<span class="line-modified">!     VM&amp; vm = globalObject-&gt;vm();</span>
      auto scope = DECLARE_THROW_SCOPE(vm);
  
      TemplateObjectMap&amp; templateObjectMap = ensureTemplateObjectMap(vm);
      TemplateObjectMap::AddResult result;
      {
          auto locker = holdLock(cellLock());
          result = templateObjectMap.add(descriptor-&gt;endOffset(), WriteBarrier&lt;JSArray&gt;());
      }
      if (JSArray* array = result.iterator-&gt;value.get())
          return array;
<span class="line-modified">!     JSArray* templateObject = descriptor-&gt;createTemplateObject(globalObject);</span>
      RETURN_IF_EXCEPTION(scope, nullptr);
      result.iterator-&gt;value.set(vm, this, templateObject);
      return templateObject;
  }
  
</pre>
<center><a href="ScopedArgumentsTable.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ScriptExecutable.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>