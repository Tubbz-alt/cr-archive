<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/accessibility/atk/WebKitAccessibleInterfaceText.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="WebKitAccessibleInterfaceSelection.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="WebKitAccessibleUtil.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/accessibility/atk/WebKitAccessibleInterfaceText.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 317     AccessibilityObject* coreObject = core(text);
 318 
 319     IntRect extents = coreObject-&gt;doAXBoundsForRange(PlainTextRange(startOffset, rangeLength));
 320     switch (coords) {
 321     case ATK_XY_SCREEN:
 322         if (Document* document = coreObject-&gt;document())
 323             extents = document-&gt;view()-&gt;contentsToScreen(extents);
 324         break;
 325     case ATK_XY_WINDOW:
 326         // No-op
 327         break;
 328 #if ATK_CHECK_VERSION(2, 30, 0)
 329     case ATK_XY_PARENT:
 330         RELEASE_ASSERT_NOT_REACHED();
 331 #endif
 332     }
 333 
 334     return extents;
 335 }
 336 
<span class="line-modified"> 337 static int offsetAdjustmentForListItem(const AccessibilityObject* object)</span>
 338 {
 339     // We need to adjust the offsets for the list item marker in
 340     // Left-To-Right text, since we expose it together with the text.
 341     RenderObject* renderer = object-&gt;renderer();
 342     if (is&lt;RenderListItem&gt;(renderer) &amp;&amp; renderer-&gt;style().direction() == TextDirection::LTR)
 343         return downcast&lt;RenderListItem&gt;(*renderer).markerTextWithSuffix().length();
 344 
 345     return 0;
 346 }
 347 
<span class="line-modified"> 348 static int webCoreOffsetToAtkOffset(const AccessibilityObject* object, int offset)</span>
 349 {
 350     if (!object-&gt;isListItem())
 351         return offset;
 352 
 353     return offset + offsetAdjustmentForListItem(object);
 354 }
 355 
 356 static int atkOffsetToWebCoreOffset(AtkText* text, int offset)
 357 {
 358     AccessibilityObject* coreObject = core(text);
 359     if (!coreObject || !coreObject-&gt;isListItem())
 360         return offset;
 361 
 362     return offset - offsetAdjustmentForListItem(coreObject);
 363 }
 364 
 365 static Node* getNodeForAccessibilityObject(AccessibilityObject* coreObject)
 366 {
 367     if (!coreObject-&gt;isNativeTextControl())
 368         return coreObject-&gt;node();
</pre>
<hr />
<pre>
 973 
 974     return webkitAccessibleTextGetTextForOffset(text, offset, boundaryType, GetTextPositionBefore, startOffset, endOffset);
 975 }
 976 
 977 static gunichar webkitAccessibleTextGetCharacterAtOffset(AtkText* text, gint)
 978 {
 979     g_return_val_if_fail(ATK_TEXT(text), 0);
 980     returnValIfWebKitAccessibleIsInvalid(WEBKIT_ACCESSIBLE(text), 0);
 981 
 982     notImplemented();
 983     return 0;
 984 }
 985 
 986 static gint webkitAccessibleTextGetCaretOffset(AtkText* text)
 987 {
 988     g_return_val_if_fail(ATK_TEXT(text), 0);
 989     returnValIfWebKitAccessibleIsInvalid(WEBKIT_ACCESSIBLE(text), 0);
 990 
 991     // coreObject is the unignored object whose offset the caller is requesting.
 992     // focusedObject is the object with the caret. It is likely ignored -- unless it&#39;s a link.
<span class="line-modified"> 993     AccessibilityObject* coreObject = core(text);</span>
 994     if (!coreObject-&gt;isAccessibilityRenderObject())
 995         return 0;
 996 
 997     // We need to make sure we pass a valid object as reference.
 998     if (coreObject-&gt;accessibilityIsIgnored())
 999         coreObject = coreObject-&gt;parentObjectUnignored();
1000     if (!coreObject)
1001         return 0;
1002 
1003     int offset;
1004     if (!objectFocusedAndCaretOffsetUnignored(coreObject, offset))
1005         return 0;
1006 
1007     return webCoreOffsetToAtkOffset(coreObject, offset);
1008 }
1009 
1010 static AtkAttributeSet* webkitAccessibleTextGetRunAttributes(AtkText* text, gint offset, gint* startOffset, gint* endOffset)
1011 {
1012     g_return_val_if_fail(ATK_TEXT(text), 0);
1013     returnValIfWebKitAccessibleIsInvalid(WEBKIT_ACCESSIBLE(text), 0);
</pre>
</td>
<td>
<hr />
<pre>
 317     AccessibilityObject* coreObject = core(text);
 318 
 319     IntRect extents = coreObject-&gt;doAXBoundsForRange(PlainTextRange(startOffset, rangeLength));
 320     switch (coords) {
 321     case ATK_XY_SCREEN:
 322         if (Document* document = coreObject-&gt;document())
 323             extents = document-&gt;view()-&gt;contentsToScreen(extents);
 324         break;
 325     case ATK_XY_WINDOW:
 326         // No-op
 327         break;
 328 #if ATK_CHECK_VERSION(2, 30, 0)
 329     case ATK_XY_PARENT:
 330         RELEASE_ASSERT_NOT_REACHED();
 331 #endif
 332     }
 333 
 334     return extents;
 335 }
 336 
<span class="line-modified"> 337 static int offsetAdjustmentForListItem(const AXCoreObject* object)</span>
 338 {
 339     // We need to adjust the offsets for the list item marker in
 340     // Left-To-Right text, since we expose it together with the text.
 341     RenderObject* renderer = object-&gt;renderer();
 342     if (is&lt;RenderListItem&gt;(renderer) &amp;&amp; renderer-&gt;style().direction() == TextDirection::LTR)
 343         return downcast&lt;RenderListItem&gt;(*renderer).markerTextWithSuffix().length();
 344 
 345     return 0;
 346 }
 347 
<span class="line-modified"> 348 static int webCoreOffsetToAtkOffset(const AXCoreObject* object, int offset)</span>
 349 {
 350     if (!object-&gt;isListItem())
 351         return offset;
 352 
 353     return offset + offsetAdjustmentForListItem(object);
 354 }
 355 
 356 static int atkOffsetToWebCoreOffset(AtkText* text, int offset)
 357 {
 358     AccessibilityObject* coreObject = core(text);
 359     if (!coreObject || !coreObject-&gt;isListItem())
 360         return offset;
 361 
 362     return offset - offsetAdjustmentForListItem(coreObject);
 363 }
 364 
 365 static Node* getNodeForAccessibilityObject(AccessibilityObject* coreObject)
 366 {
 367     if (!coreObject-&gt;isNativeTextControl())
 368         return coreObject-&gt;node();
</pre>
<hr />
<pre>
 973 
 974     return webkitAccessibleTextGetTextForOffset(text, offset, boundaryType, GetTextPositionBefore, startOffset, endOffset);
 975 }
 976 
 977 static gunichar webkitAccessibleTextGetCharacterAtOffset(AtkText* text, gint)
 978 {
 979     g_return_val_if_fail(ATK_TEXT(text), 0);
 980     returnValIfWebKitAccessibleIsInvalid(WEBKIT_ACCESSIBLE(text), 0);
 981 
 982     notImplemented();
 983     return 0;
 984 }
 985 
 986 static gint webkitAccessibleTextGetCaretOffset(AtkText* text)
 987 {
 988     g_return_val_if_fail(ATK_TEXT(text), 0);
 989     returnValIfWebKitAccessibleIsInvalid(WEBKIT_ACCESSIBLE(text), 0);
 990 
 991     // coreObject is the unignored object whose offset the caller is requesting.
 992     // focusedObject is the object with the caret. It is likely ignored -- unless it&#39;s a link.
<span class="line-modified"> 993     AXCoreObject* coreObject = core(text);</span>
 994     if (!coreObject-&gt;isAccessibilityRenderObject())
 995         return 0;
 996 
 997     // We need to make sure we pass a valid object as reference.
 998     if (coreObject-&gt;accessibilityIsIgnored())
 999         coreObject = coreObject-&gt;parentObjectUnignored();
1000     if (!coreObject)
1001         return 0;
1002 
1003     int offset;
1004     if (!objectFocusedAndCaretOffsetUnignored(coreObject, offset))
1005         return 0;
1006 
1007     return webCoreOffsetToAtkOffset(coreObject, offset);
1008 }
1009 
1010 static AtkAttributeSet* webkitAccessibleTextGetRunAttributes(AtkText* text, gint offset, gint* startOffset, gint* endOffset)
1011 {
1012     g_return_val_if_fail(ATK_TEXT(text), 0);
1013     returnValIfWebKitAccessibleIsInvalid(WEBKIT_ACCESSIBLE(text), 0);
</pre>
</td>
</tr>
</table>
<center><a href="WebKitAccessibleInterfaceSelection.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="WebKitAccessibleUtil.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>