<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/testing/MockWebAuthenticationConfiguration.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2018 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 14  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 15  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 17  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 18  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 19  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 20  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 21  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 23  * THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #if ENABLE(WEB_AUTHN)
 29 
 30 #include &lt;wtf/Forward.h&gt;
 31 #include &lt;wtf/text/WTFString.h&gt;
 32 
 33 namespace WebCore {
 34 
 35 struct MockWebAuthenticationConfiguration {
 36     enum class HidStage : bool {
 37         Info,
 38         Request
 39     };
 40 
 41     enum class HidSubStage : bool {
 42         Init,
 43         Msg
 44     };
 45 
 46     enum class HidError : uint8_t {
 47         Success,
 48         DataNotSent,
 49         EmptyReport,
 50         WrongChannelId,
 51         MaliciousPayload,
 52         UnsupportedOptions,
 53         WrongNonce
 54     };
 55 
 56     enum class NfcError : uint8_t {
 57         Success,
 58         NoTags,
 59         WrongTagType,
 60         NoConnections,
 61         MaliciousPayload
 62     };
 63 
 64     struct LocalConfiguration {
 65         bool acceptAuthentication { false };
 66         bool acceptAttestation { false };
 67         String privateKeyBase64;
 68         String userCertificateBase64;
 69         String intermediateCACertificateBase64;
 70         String preferredUserhandleBase64;
 71 
 72         template&lt;class Encoder&gt; void encode(Encoder&amp;) const;
 73         template&lt;class Decoder&gt; static Optional&lt;LocalConfiguration&gt; decode(Decoder&amp;);
 74     };
 75 
 76     struct HidConfiguration {
 77         Vector&lt;String&gt; payloadBase64;
 78         HidStage stage { HidStage::Info };
 79         HidSubStage subStage { HidSubStage::Init };
 80         HidError error { HidError::Success };
 81         bool isU2f { false };
 82         bool keepAlive { false };
 83         bool fastDataArrival { false };
 84         bool continueAfterErrorData { false };
 85         bool canDowngrade { false };
 86         bool expectCancel { false };
 87         bool supportClientPin { false };
 88 
 89         template&lt;class Encoder&gt; void encode(Encoder&amp;) const;
 90         template&lt;class Decoder&gt; static Optional&lt;HidConfiguration&gt; decode(Decoder&amp;);
 91     };
 92 
 93     struct NfcConfiguration {
 94         NfcError error { NfcError::Success };
 95         Vector&lt;String&gt; payloadBase64;
 96         bool multipleTags { false };
 97         bool multiplePhysicalTags { false };
 98 
 99         template&lt;class Encoder&gt; void encode(Encoder&amp;) const;
100         template&lt;class Decoder&gt; static Optional&lt;NfcConfiguration&gt; decode(Decoder&amp;);
101     };
102 
103     bool silentFailure { false };
104     Optional&lt;LocalConfiguration&gt; local;
105     Optional&lt;HidConfiguration&gt; hid;
106     Optional&lt;NfcConfiguration&gt; nfc;
107 
108     template&lt;class Encoder&gt; void encode(Encoder&amp;) const;
109     template&lt;class Decoder&gt; static Optional&lt;MockWebAuthenticationConfiguration&gt; decode(Decoder&amp;);
110 };
111 
112 template&lt;class Encoder&gt;
113 void MockWebAuthenticationConfiguration::LocalConfiguration::encode(Encoder&amp; encoder) const
114 {
115     encoder &lt;&lt; acceptAuthentication &lt;&lt; acceptAttestation &lt;&lt; privateKeyBase64 &lt;&lt; userCertificateBase64 &lt;&lt; intermediateCACertificateBase64 &lt;&lt; preferredUserhandleBase64;
116 }
117 
118 template&lt;class Decoder&gt;
119 Optional&lt;MockWebAuthenticationConfiguration::LocalConfiguration&gt; MockWebAuthenticationConfiguration::LocalConfiguration::decode(Decoder&amp; decoder)
120 {
121     MockWebAuthenticationConfiguration::LocalConfiguration result;
122 
123     Optional&lt;bool&gt; acceptAuthentication;
124     decoder &gt;&gt; acceptAuthentication;
125     if (!acceptAuthentication)
126         return WTF::nullopt;
127     result.acceptAuthentication = *acceptAuthentication;
128 
129     Optional&lt;bool&gt; acceptAttestation;
130     decoder &gt;&gt; acceptAttestation;
131     if (!acceptAttestation)
132         return WTF::nullopt;
133     result.acceptAttestation = *acceptAttestation;
134 
135     Optional&lt;String&gt; privateKeyBase64;
136     decoder &gt;&gt; privateKeyBase64;
137     if (!privateKeyBase64)
138         return WTF::nullopt;
139     result.privateKeyBase64 = WTFMove(*privateKeyBase64);
140 
141     Optional&lt;String&gt; userCertificateBase64;
142     decoder &gt;&gt; userCertificateBase64;
143     if (!userCertificateBase64)
144         return WTF::nullopt;
145     result.userCertificateBase64 = WTFMove(*userCertificateBase64);
146 
147     Optional&lt;String&gt; intermediateCACertificateBase64;
148     decoder &gt;&gt; intermediateCACertificateBase64;
149     if (!intermediateCACertificateBase64)
150         return WTF::nullopt;
151     result.intermediateCACertificateBase64 = WTFMove(*intermediateCACertificateBase64);
152 
153     Optional&lt;String&gt; preferredUserhandleBase64;
154     decoder &gt;&gt; preferredUserhandleBase64;
155     if (!preferredUserhandleBase64)
156         return WTF::nullopt;
157     result.preferredUserhandleBase64 = WTFMove(*preferredUserhandleBase64);
158 
159     return result;
160 }
161 
162 template&lt;class Encoder&gt;
163 void MockWebAuthenticationConfiguration::HidConfiguration::encode(Encoder&amp; encoder) const
164 {
165     encoder &lt;&lt; payloadBase64 &lt;&lt; stage &lt;&lt; subStage &lt;&lt; error &lt;&lt; isU2f &lt;&lt; keepAlive &lt;&lt; fastDataArrival &lt;&lt; continueAfterErrorData &lt;&lt; canDowngrade &lt;&lt; expectCancel &lt;&lt; supportClientPin;
166 }
167 
168 template&lt;class Decoder&gt;
169 Optional&lt;MockWebAuthenticationConfiguration::HidConfiguration&gt; MockWebAuthenticationConfiguration::HidConfiguration::decode(Decoder&amp; decoder)
170 {
171     MockWebAuthenticationConfiguration::HidConfiguration result;
172     if (!decoder.decode(result.payloadBase64))
173         return WTF::nullopt;
174     if (!decoder.decodeEnum(result.stage))
175         return WTF::nullopt;
176     if (!decoder.decodeEnum(result.subStage))
177         return WTF::nullopt;
178     if (!decoder.decodeEnum(result.error))
179         return WTF::nullopt;
180     if (!decoder.decode(result.isU2f))
181         return WTF::nullopt;
182     if (!decoder.decode(result.keepAlive))
183         return WTF::nullopt;
184     if (!decoder.decode(result.fastDataArrival))
185         return WTF::nullopt;
186     if (!decoder.decode(result.continueAfterErrorData))
187         return WTF::nullopt;
188     if (!decoder.decode(result.canDowngrade))
189         return WTF::nullopt;
190     if (!decoder.decode(result.expectCancel))
191         return WTF::nullopt;
192     if (!decoder.decode(result.supportClientPin))
193         return WTF::nullopt;
194     return result;
195 }
196 
197 template&lt;class Encoder&gt;
198 void MockWebAuthenticationConfiguration::NfcConfiguration::encode(Encoder&amp; encoder) const
199 {
200     encoder &lt;&lt; error &lt;&lt; payloadBase64 &lt;&lt; multipleTags &lt;&lt; multiplePhysicalTags;
201 }
202 
203 template&lt;class Decoder&gt;
204 Optional&lt;MockWebAuthenticationConfiguration::NfcConfiguration&gt; MockWebAuthenticationConfiguration::NfcConfiguration::decode(Decoder&amp; decoder)
205 {
206     MockWebAuthenticationConfiguration::NfcConfiguration result;
207     if (!decoder.decodeEnum(result.error))
208         return WTF::nullopt;
209     if (!decoder.decode(result.payloadBase64))
210         return WTF::nullopt;
211     if (!decoder.decode(result.multipleTags))
212         return WTF::nullopt;
213     if (!decoder.decode(result.multiplePhysicalTags))
214         return WTF::nullopt;
215     return result;
216 }
217 
218 template&lt;class Encoder&gt;
219 void MockWebAuthenticationConfiguration::encode(Encoder&amp; encoder) const
220 {
221     encoder &lt;&lt; silentFailure &lt;&lt; local &lt;&lt; hid &lt;&lt; nfc;
222 }
223 
224 template&lt;class Decoder&gt;
225 Optional&lt;MockWebAuthenticationConfiguration&gt; MockWebAuthenticationConfiguration::decode(Decoder&amp; decoder)
226 {
227     MockWebAuthenticationConfiguration result;
228 
229     Optional&lt;bool&gt; silentFailure;
230     decoder &gt;&gt; silentFailure;
231     if (!silentFailure)
232         return WTF::nullopt;
233     result.silentFailure = *silentFailure;
234 
235     Optional&lt;Optional&lt;LocalConfiguration&gt;&gt; local;
236     decoder &gt;&gt; local;
237     if (!local)
238         return WTF::nullopt;
239     result.local = WTFMove(*local);
240 
241     Optional&lt;Optional&lt;HidConfiguration&gt;&gt; hid;
242     decoder &gt;&gt; hid;
243     if (!hid)
244         return WTF::nullopt;
245     result.hid = WTFMove(*hid);
246 
247     Optional&lt;Optional&lt;NfcConfiguration&gt;&gt; nfc;
248     decoder &gt;&gt; nfc;
249     if (!nfc)
250         return WTF::nullopt;
251     result.nfc = WTFMove(*nfc);
252 
253     return result;
254 }
255 
256 } // namespace WebCore
257 
258 namespace WTF {
259 
260 template&lt;&gt; struct EnumTraits&lt;WebCore::MockWebAuthenticationConfiguration::HidStage&gt; {
261     using values = EnumValues&lt;
262         WebCore::MockWebAuthenticationConfiguration::HidStage,
263         WebCore::MockWebAuthenticationConfiguration::HidStage::Info,
264         WebCore::MockWebAuthenticationConfiguration::HidStage::Request
265     &gt;;
266 };
267 
268 template&lt;&gt; struct EnumTraits&lt;WebCore::MockWebAuthenticationConfiguration::HidSubStage&gt; {
269     using values = EnumValues&lt;
270         WebCore::MockWebAuthenticationConfiguration::HidSubStage,
271         WebCore::MockWebAuthenticationConfiguration::HidSubStage::Init,
272         WebCore::MockWebAuthenticationConfiguration::HidSubStage::Msg
273     &gt;;
274 };
275 
276 template&lt;&gt; struct EnumTraits&lt;WebCore::MockWebAuthenticationConfiguration::HidError&gt; {
277     using values = EnumValues&lt;
278         WebCore::MockWebAuthenticationConfiguration::HidError,
279         WebCore::MockWebAuthenticationConfiguration::HidError::Success,
280         WebCore::MockWebAuthenticationConfiguration::HidError::DataNotSent,
281         WebCore::MockWebAuthenticationConfiguration::HidError::EmptyReport,
282         WebCore::MockWebAuthenticationConfiguration::HidError::WrongChannelId,
283         WebCore::MockWebAuthenticationConfiguration::HidError::MaliciousPayload,
284         WebCore::MockWebAuthenticationConfiguration::HidError::UnsupportedOptions,
285         WebCore::MockWebAuthenticationConfiguration::HidError::WrongNonce
286     &gt;;
287 };
288 
289 template&lt;&gt; struct EnumTraits&lt;WebCore::MockWebAuthenticationConfiguration::NfcError&gt; {
290     using values = EnumValues&lt;
291         WebCore::MockWebAuthenticationConfiguration::NfcError,
292         WebCore::MockWebAuthenticationConfiguration::NfcError::Success,
293         WebCore::MockWebAuthenticationConfiguration::NfcError::NoTags,
294         WebCore::MockWebAuthenticationConfiguration::NfcError::WrongTagType,
295         WebCore::MockWebAuthenticationConfiguration::NfcError::NoConnections,
296         WebCore::MockWebAuthenticationConfiguration::NfcError::MaliciousPayload
297     &gt;;
298 };
299 
300 } // namespace WTF
301 
302 #endif // ENABLE(WEB_AUTHN)
    </pre>
  </body>
</html>