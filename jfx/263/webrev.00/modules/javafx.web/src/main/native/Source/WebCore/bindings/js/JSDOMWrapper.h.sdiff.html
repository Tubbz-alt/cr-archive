<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSDOMWrapper.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSDOMWrapper.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="JSDOMWrapperCache.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/bindings/js/JSDOMWrapper.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 12  *  This library is distributed in the hope that it will be useful,
 13  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 14  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 15  *  Lesser General Public License for more details.
 16  *
 17  *  You should have received a copy of the GNU Lesser General Public
 18  *  License along with this library; if not, write to the Free Software
 19  *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
 20  */
 21 
 22 #pragma once
 23 
 24 #include &quot;JSDOMGlobalObject.h&quot;
 25 #include &quot;NodeConstants.h&quot;
 26 #include &lt;JavaScriptCore/JSDestructibleObject.h&gt;
 27 
 28 namespace WebCore {
 29 
 30 class ScriptExecutionContext;
 31 
<span class="line-modified"> 32 // JSC allows us to extend JSType. If the highest bit is set, we can add any Object types and they are</span>
 33 // recognized as OtherObj in JSC. And we encode Node type into JSType if the given JSType is subclass of Node.
<span class="line-modified"> 34 // offset | 7 | 6 | 5   4 | 3   2   1   0  |</span>
<span class="line-modified"> 35 // value  | 1 | 0 |  Non-node DOM types    |</span>
 36 // If the given JSType is a subclass of Node, the format is the following.
<span class="line-modified"> 37 // offset | 7 | 6 | 5   4 | 3   2   1   0  |</span>
<span class="line-modified"> 38 // value  | 1 | 1 |  Kind |       NodeType |</span>
<span class="line-removed"> 39 static const uint8_t JSNodeTypeMask                  = 0b00001111;</span>
 40 
<span class="line-modified"> 41 static const uint8_t JSDOMWrapperType                = 0b10000000;</span>
<span class="line-modified"> 42 static const uint8_t JSEventType                     = 0b10000001;</span>
<span class="line-modified"> 43 static const uint8_t JSNodeType                      = 0b11000000;</span>

 44 static const uint8_t JSTextNodeType                  = JSNodeType | NodeConstants::TEXT_NODE;
 45 static const uint8_t JSProcessingInstructionNodeType = JSNodeType | NodeConstants::PROCESSING_INSTRUCTION_NODE;
 46 static const uint8_t JSDocumentTypeNodeType          = JSNodeType | NodeConstants::DOCUMENT_TYPE_NODE;
 47 static const uint8_t JSDocumentFragmentNodeType      = JSNodeType | NodeConstants::DOCUMENT_FRAGMENT_NODE;
 48 static const uint8_t JSDocumentWrapperType           = JSNodeType | NodeConstants::DOCUMENT_NODE;
 49 static const uint8_t JSCommentNodeType               = JSNodeType | NodeConstants::COMMENT_NODE;
 50 static const uint8_t JSCDATASectionNodeType          = JSNodeType | NodeConstants::CDATA_SECTION_NODE;
 51 static const uint8_t JSAttrNodeType                  = JSNodeType | NodeConstants::ATTRIBUTE_NODE;
<span class="line-modified"> 52 static const uint8_t JSElementType                   = 0b11010000 | NodeConstants::ELEMENT_NODE;</span>
 53 
 54 static_assert(JSDOMWrapperType &gt; JSC::LastJSCObjectType, &quot;JSC::JSType offers the highest bit.&quot;);
 55 static_assert(NodeConstants::LastNodeType &lt;= JSNodeTypeMask, &quot;NodeType should be represented in 4bit.&quot;);
 56 
 57 class JSDOMObject : public JSC::JSDestructibleObject {
 58 public:
 59     typedef JSC::JSDestructibleObject Base;
 60     static constexpr bool isDOMWrapper = false;
 61 
 62     JSDOMGlobalObject* globalObject() const { return JSC::jsCast&lt;JSDOMGlobalObject*&gt;(JSC::JSNonFinalObject::globalObject()); }
 63     ScriptExecutionContext* scriptExecutionContext() const { return globalObject()-&gt;scriptExecutionContext(); }
 64 
 65 protected:
 66     WEBCORE_EXPORT JSDOMObject(JSC::Structure*, JSC::JSGlobalObject&amp;);
 67 };
 68 
 69 WEBCORE_EXPORT JSC::CompleteSubspace* outputConstraintSubspaceFor(JSC::VM&amp;);
<span class="line-removed"> 70 WEBCORE_EXPORT JSC::CompleteSubspace* globalObjectOutputConstraintSubspaceFor(JSC::VM&amp;);</span>
 71 
 72 template&lt;typename ImplementationClass&gt; class JSDOMWrapper : public JSDOMObject {
 73 public:
 74     typedef JSDOMObject Base;
 75     typedef ImplementationClass DOMWrapped;
 76     static constexpr bool isDOMWrapper = true;
 77 
 78     ImplementationClass&amp; wrapped() const { return m_wrapped; }
 79     static ptrdiff_t offsetOfWrapped() { return OBJECT_OFFSETOF(JSDOMWrapper&lt;ImplementationClass&gt;, m_wrapped); }
 80 
 81 protected:
 82     JSDOMWrapper(JSC::Structure* structure, JSC::JSGlobalObject&amp; globalObject, Ref&lt;ImplementationClass&gt;&amp;&amp; impl)
 83         : Base(structure, globalObject)
 84         , m_wrapped(WTFMove(impl)) { }
 85 
 86 private:
 87     Ref&lt;ImplementationClass&gt; m_wrapped;
 88 };
 89 
 90 template&lt;typename ImplementationClass&gt; struct JSDOMWrapperConverterTraits;
</pre>
<hr />
<pre>
 92 template&lt;typename JSClass, typename Enable = void&gt;
 93 struct JSDOMObjectInspector {
 94 public:
 95     static constexpr bool isSimpleWrapper = false;
 96     static constexpr bool isComplexWrapper = false;
 97     static constexpr bool isBuiltin = true;
 98 };
 99 
100 template&lt;typename JSClass&gt;
101 struct JSDOMObjectInspector&lt;JSClass, typename std::enable_if&lt;JSClass::isDOMWrapper&gt;::type&gt; {
102 private:
103     template&lt;typename T&gt; static constexpr auto test(int) -&gt; decltype(T::create(), bool()) { return true; }
104     template&lt;typename T&gt; static constexpr bool test(...) { return false; }
105 
106 public:
107     static constexpr bool isSimpleWrapper = test&lt;typename JSClass::DOMWrapped&gt;(0);
108     static constexpr bool isComplexWrapper = !isSimpleWrapper;
109     static constexpr bool isBuiltin = false;
110 };
111 
<span class="line-modified">112 JSC::JSValue cloneAcrossWorlds(JSC::ExecState&amp;, const JSDOMObject&amp; owner, JSC::JSValue);</span>
113 
114 } // namespace WebCore
</pre>
</td>
<td>
<hr />
<pre>
 12  *  This library is distributed in the hope that it will be useful,
 13  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 14  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 15  *  Lesser General Public License for more details.
 16  *
 17  *  You should have received a copy of the GNU Lesser General Public
 18  *  License along with this library; if not, write to the Free Software
 19  *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
 20  */
 21 
 22 #pragma once
 23 
 24 #include &quot;JSDOMGlobalObject.h&quot;
 25 #include &quot;NodeConstants.h&quot;
 26 #include &lt;JavaScriptCore/JSDestructibleObject.h&gt;
 27 
 28 namespace WebCore {
 29 
 30 class ScriptExecutionContext;
 31 
<span class="line-modified"> 32 // JSC allows us to extend JSType. If the highest 3 bits are set, we can add any Object types and they are</span>
 33 // recognized as OtherObj in JSC. And we encode Node type into JSType if the given JSType is subclass of Node.
<span class="line-modified"> 34 // offset | 7 | 6 | 5 | 4   3   2   1   0  |</span>
<span class="line-modified"> 35 // value  | 1 | 1 | 1 | Non-node DOM types |</span>
 36 // If the given JSType is a subclass of Node, the format is the following.
<span class="line-modified"> 37 // offset | 7 | 6 | 5 | 4 | 3   2   1   0  |</span>
<span class="line-modified"> 38 // value  | 1 | 1 | 1 | 1 |    NodeType    |</span>

 39 
<span class="line-modified"> 40 static const uint8_t JSDOMWrapperType                = 0b11101110;</span>
<span class="line-modified"> 41 static const uint8_t JSEventType                     = 0b11101111;</span>
<span class="line-modified"> 42 static const uint8_t JSNodeType                      = 0b11110000;</span>
<span class="line-added"> 43 static const uint8_t JSNodeTypeMask                  = 0b00001111;</span>
 44 static const uint8_t JSTextNodeType                  = JSNodeType | NodeConstants::TEXT_NODE;
 45 static const uint8_t JSProcessingInstructionNodeType = JSNodeType | NodeConstants::PROCESSING_INSTRUCTION_NODE;
 46 static const uint8_t JSDocumentTypeNodeType          = JSNodeType | NodeConstants::DOCUMENT_TYPE_NODE;
 47 static const uint8_t JSDocumentFragmentNodeType      = JSNodeType | NodeConstants::DOCUMENT_FRAGMENT_NODE;
 48 static const uint8_t JSDocumentWrapperType           = JSNodeType | NodeConstants::DOCUMENT_NODE;
 49 static const uint8_t JSCommentNodeType               = JSNodeType | NodeConstants::COMMENT_NODE;
 50 static const uint8_t JSCDATASectionNodeType          = JSNodeType | NodeConstants::CDATA_SECTION_NODE;
 51 static const uint8_t JSAttrNodeType                  = JSNodeType | NodeConstants::ATTRIBUTE_NODE;
<span class="line-modified"> 52 static const uint8_t JSElementType                   = 0b11110000 | NodeConstants::ELEMENT_NODE;</span>
 53 
 54 static_assert(JSDOMWrapperType &gt; JSC::LastJSCObjectType, &quot;JSC::JSType offers the highest bit.&quot;);
 55 static_assert(NodeConstants::LastNodeType &lt;= JSNodeTypeMask, &quot;NodeType should be represented in 4bit.&quot;);
 56 
 57 class JSDOMObject : public JSC::JSDestructibleObject {
 58 public:
 59     typedef JSC::JSDestructibleObject Base;
 60     static constexpr bool isDOMWrapper = false;
 61 
 62     JSDOMGlobalObject* globalObject() const { return JSC::jsCast&lt;JSDOMGlobalObject*&gt;(JSC::JSNonFinalObject::globalObject()); }
 63     ScriptExecutionContext* scriptExecutionContext() const { return globalObject()-&gt;scriptExecutionContext(); }
 64 
 65 protected:
 66     WEBCORE_EXPORT JSDOMObject(JSC::Structure*, JSC::JSGlobalObject&amp;);
 67 };
 68 
 69 WEBCORE_EXPORT JSC::CompleteSubspace* outputConstraintSubspaceFor(JSC::VM&amp;);

 70 
 71 template&lt;typename ImplementationClass&gt; class JSDOMWrapper : public JSDOMObject {
 72 public:
 73     typedef JSDOMObject Base;
 74     typedef ImplementationClass DOMWrapped;
 75     static constexpr bool isDOMWrapper = true;
 76 
 77     ImplementationClass&amp; wrapped() const { return m_wrapped; }
 78     static ptrdiff_t offsetOfWrapped() { return OBJECT_OFFSETOF(JSDOMWrapper&lt;ImplementationClass&gt;, m_wrapped); }
 79 
 80 protected:
 81     JSDOMWrapper(JSC::Structure* structure, JSC::JSGlobalObject&amp; globalObject, Ref&lt;ImplementationClass&gt;&amp;&amp; impl)
 82         : Base(structure, globalObject)
 83         , m_wrapped(WTFMove(impl)) { }
 84 
 85 private:
 86     Ref&lt;ImplementationClass&gt; m_wrapped;
 87 };
 88 
 89 template&lt;typename ImplementationClass&gt; struct JSDOMWrapperConverterTraits;
</pre>
<hr />
<pre>
 91 template&lt;typename JSClass, typename Enable = void&gt;
 92 struct JSDOMObjectInspector {
 93 public:
 94     static constexpr bool isSimpleWrapper = false;
 95     static constexpr bool isComplexWrapper = false;
 96     static constexpr bool isBuiltin = true;
 97 };
 98 
 99 template&lt;typename JSClass&gt;
100 struct JSDOMObjectInspector&lt;JSClass, typename std::enable_if&lt;JSClass::isDOMWrapper&gt;::type&gt; {
101 private:
102     template&lt;typename T&gt; static constexpr auto test(int) -&gt; decltype(T::create(), bool()) { return true; }
103     template&lt;typename T&gt; static constexpr bool test(...) { return false; }
104 
105 public:
106     static constexpr bool isSimpleWrapper = test&lt;typename JSClass::DOMWrapped&gt;(0);
107     static constexpr bool isComplexWrapper = !isSimpleWrapper;
108     static constexpr bool isBuiltin = false;
109 };
110 
<span class="line-modified">111 JSC::JSValue cloneAcrossWorlds(JSC::JSGlobalObject&amp;, const JSDOMObject&amp; owner, JSC::JSValue);</span>
112 
113 } // namespace WebCore
</pre>
</td>
</tr>
</table>
<center><a href="JSDOMWrapper.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="JSDOMWrapperCache.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>