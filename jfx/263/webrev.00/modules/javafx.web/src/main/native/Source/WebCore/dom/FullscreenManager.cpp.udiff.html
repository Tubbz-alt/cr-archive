<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/dom/FullscreenManager.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="FocusEvent.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="FullscreenManager.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/dom/FullscreenManager.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -28,15 +28,13 @@</span>
  
  #if ENABLE(FULLSCREEN_API)
  
  #include &quot;Chrome.h&quot;
  #include &quot;ChromeClient.h&quot;
<span class="udiff-line-removed">- #include &quot;Document.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;Element.h&quot;</span>
  #include &quot;EventNames.h&quot;
  #include &quot;Frame.h&quot;
<span class="udiff-line-modified-removed">- #include &quot;HTMLFrameOwnerElement.h&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;HTMLIFrameElement.h&quot;</span>
  #include &quot;HTMLMediaElement.h&quot;
  #include &quot;Page.h&quot;
  #include &quot;QualifiedName.h&quot;
  #include &quot;RenderFullScreen.h&quot;
  #include &quot;RenderTreeBuilder.h&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -44,33 +42,17 @@</span>
  
  namespace WebCore {
  
  using namespace HTMLNames;
  
<span class="udiff-line-removed">- static bool isAttributeOnAllOwners(const QualifiedName&amp; attribute, const QualifiedName&amp; prefixedAttribute, const HTMLFrameOwnerElement* owner)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     if (!owner)</span>
<span class="udiff-line-removed">-         return true;</span>
<span class="udiff-line-removed">-     do {</span>
<span class="udiff-line-removed">-         if (!(owner-&gt;hasAttribute(attribute) || owner-&gt;hasAttribute(prefixedAttribute)))</span>
<span class="udiff-line-removed">-             return false;</span>
<span class="udiff-line-removed">-     } while ((owner = owner-&gt;document().ownerElement()));</span>
<span class="udiff-line-removed">-     return true;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  FullscreenManager::FullscreenManager(Document&amp; document)
      : m_document { document }
  {
  }
  
  FullscreenManager::~FullscreenManager() = default;
  
<span class="udiff-line-removed">- bool FullscreenManager::fullscreenIsAllowedForElement(Element&amp; element) const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     return isAttributeOnAllOwners(allowfullscreenAttr, webkitallowfullscreenAttr, element.document().ownerElement());</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  void FullscreenManager::requestFullscreenForElement(Element* element, FullscreenCheckType checkType)
  {
      if (!element)
          element = documentElement();
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -142,11 +124,11 @@</span>
              return;
          }
  
          // The context object&#39;s node document, or an ancestor browsing context&#39;s document does not have
          // the fullscreen enabled flag set.
<span class="udiff-line-modified-removed">-         if (checkType == EnforceIFrameAllowFullscreenRequirement &amp;&amp; !fullscreenIsAllowedForElement(*element)) {</span>
<span class="udiff-line-modified-added">+         if (checkType == EnforceIFrameAllowFullscreenRequirement &amp;&amp; !isFeaturePolicyAllowedByDocumentAndAllOwners(FeaturePolicy::Type::Fullscreen, document())) {</span>
              failedPreflights(WTFMove(element));
              return;
          }
  
          // The context object&#39;s node document fullscreen element stack is not empty and its top element
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -345,11 +327,11 @@</span>
  {
      // 4. The fullscreenEnabled attribute must return true if the context object and all ancestor
      // browsing context&#39;s documents have their fullscreen enabled flag set, or false otherwise.
  
      // Top-level browsing contexts are implied to have their allowFullscreen attribute set.
<span class="udiff-line-modified-removed">-     return isAttributeOnAllOwners(allowfullscreenAttr, webkitallowfullscreenAttr, document().ownerElement());</span>
<span class="udiff-line-modified-added">+     return isFeaturePolicyAllowedByDocumentAndAllOwners(FeaturePolicy::Type::Fullscreen, document());</span>
  }
  
  static void unwrapFullscreenRenderer(RenderFullScreen* fullscreenRenderer, Element* fullscreenElement)
  {
      if (!fullscreenRenderer)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -361,11 +343,11 @@</span>
          fullscreenElement-&gt;parentElement()-&gt;invalidateStyleAndRenderersForSubtree();
  }
  
  void FullscreenManager::willEnterFullscreen(Element&amp; element)
  {
<span class="udiff-line-modified-removed">-     if (!document().hasLivingRenderTree() || document().pageCacheState() != Document::NotInPageCache)</span>
<span class="udiff-line-modified-added">+     if (!document().hasLivingRenderTree() || document().backForwardCacheState() != Document::NotInBackForwardCache)</span>
          return;
  
      // Protect against being called after the document has been removed from the page.
      if (!page())
          return;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -386,11 +368,11 @@</span>
      ASSERT(&amp;element == m_pendingFullscreenElement);
      m_pendingFullscreenElement = nullptr;
      m_fullscreenElement = &amp;element;
  
  #if USE(NATIVE_FULLSCREEN_VIDEO)
<span class="udiff-line-modified-removed">-     if (element.isMediaElement())</span>
<span class="udiff-line-modified-added">+     if (is&lt;HTMLMediaElement&gt;(element))</span>
          return;
  #endif
  
      // Create a placeholder block for a the full-screen element, to keep the page from reflowing
      // when the element is removed from the normal flow. Only do this for a RenderBox, as only
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -415,11 +397,11 @@</span>
  void FullscreenManager::didEnterFullscreen()
  {
      if (!m_fullscreenElement)
          return;
  
<span class="udiff-line-modified-removed">-     if (!hasLivingRenderTree() || pageCacheState() != Document::NotInPageCache)</span>
<span class="udiff-line-modified-added">+     if (!hasLivingRenderTree() || backForwardCacheState() != Document::NotInBackForwardCache)</span>
          return;
  
      m_fullscreenElement-&gt;didBecomeFullscreenElement();
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -427,11 +409,11 @@</span>
  {
      auto fullscreenElement = fullscreenOrPendingElement();
      if (!fullscreenElement)
          return;
  
<span class="udiff-line-modified-removed">-     if (!hasLivingRenderTree() || pageCacheState() != Document::NotInPageCache)</span>
<span class="udiff-line-modified-added">+     if (!hasLivingRenderTree() || backForwardCacheState() != Document::NotInBackForwardCache)</span>
          return;
  
      fullscreenElement-&gt;willStopBeingFullscreenElement();
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -439,11 +421,11 @@</span>
  {
      auto fullscreenElement = fullscreenOrPendingElement();
      if (!fullscreenElement)
          return;
  
<span class="udiff-line-modified-removed">-     if (!hasLivingRenderTree() || pageCacheState() != Document::NotInPageCache)</span>
<span class="udiff-line-modified-added">+     if (!hasLivingRenderTree() || backForwardCacheState() != Document::NotInBackForwardCache)</span>
          return;
      fullscreenElement-&gt;setContainsFullScreenElementOnAncestorsCrossingFrameBoundaries(false);
  
      m_areKeysEnabledInFullscreen = false;
  
</pre>
<center><a href="FocusEvent.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="FullscreenManager.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>