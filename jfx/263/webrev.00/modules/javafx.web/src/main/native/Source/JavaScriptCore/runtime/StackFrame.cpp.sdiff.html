<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/StackFrame.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SparseArrayValueMap.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="StackFrame.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/StackFrame.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;StackFrame.h&quot;
 28 
 29 #include &quot;CodeBlock.h&quot;
 30 #include &quot;DebuggerPrimitives.h&quot;
 31 #include &quot;JSCInlines.h&quot;
 32 #include &lt;wtf/text/StringBuilder.h&gt;
 33 
 34 namespace JSC {
 35 
 36 StackFrame::StackFrame(VM&amp; vm, JSCell* owner, JSCell* callee)
 37     : m_callee(vm, owner, callee)
 38 {
 39 }
 40 
<span class="line-modified"> 41 StackFrame::StackFrame(VM&amp; vm, JSCell* owner, JSCell* callee, CodeBlock* codeBlock, unsigned bytecodeOffset)</span>
 42     : m_callee(vm, owner, callee)
 43     , m_codeBlock(vm, owner, codeBlock)
<span class="line-modified"> 44     , m_bytecodeOffset(bytecodeOffset)</span>
 45 {
 46 }
 47 
 48 StackFrame::StackFrame(Wasm::IndexOrName indexOrName)
 49     : m_wasmFunctionIndexOrName(indexOrName)
 50     , m_isWasmFrame(true)
 51 {
 52 }
 53 
 54 intptr_t StackFrame::sourceID() const
 55 {
 56     if (!m_codeBlock)
 57         return noSourceID;
 58     return m_codeBlock-&gt;ownerExecutable()-&gt;sourceID();
 59 }
 60 
 61 String StackFrame::sourceURL() const
 62 {
 63     if (m_isWasmFrame)
 64         return &quot;[wasm code]&quot;_s;
</pre>
<hr />
<pre>
 94     }
 95     String name;
 96     if (m_callee) {
 97         if (m_callee-&gt;isObject())
 98             name = getCalculatedDisplayName(vm, jsCast&lt;JSObject*&gt;(m_callee.get())).impl();
 99     }
100     return name.isNull() ? emptyString() : name;
101 }
102 
103 void StackFrame::computeLineAndColumn(unsigned&amp; line, unsigned&amp; column) const
104 {
105     if (!m_codeBlock) {
106         line = 0;
107         column = 0;
108         return;
109     }
110 
111     int divot = 0;
112     int unusedStartOffset = 0;
113     int unusedEndOffset = 0;
<span class="line-modified">114     m_codeBlock-&gt;expressionRangeForBytecodeOffset(m_bytecodeOffset, divot, unusedStartOffset, unusedEndOffset, line, column);</span>
115 
116     ScriptExecutable* executable = m_codeBlock-&gt;ownerExecutable();
117     if (Optional&lt;int&gt; overrideLineNumber = executable-&gt;overrideLineNumber(m_codeBlock-&gt;vm()))
118         line = overrideLineNumber.value();
119 }
120 
121 String StackFrame::toString(VM&amp; vm) const
122 {
123     StringBuilder traceBuild;
124     String functionName = this-&gt;functionName(vm);
125     String sourceURL = this-&gt;sourceURL();
126     traceBuild.append(functionName);
127     if (!sourceURL.isEmpty()) {
128         if (!functionName.isEmpty())
129             traceBuild.append(&#39;@&#39;);
130         traceBuild.append(sourceURL);
131         if (hasLineAndColumnInfo()) {
132             unsigned line;
133             unsigned column;
134             computeLineAndColumn(line, column);
</pre>
</td>
<td>
<hr />
<pre>
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;StackFrame.h&quot;
 28 
 29 #include &quot;CodeBlock.h&quot;
 30 #include &quot;DebuggerPrimitives.h&quot;
 31 #include &quot;JSCInlines.h&quot;
 32 #include &lt;wtf/text/StringBuilder.h&gt;
 33 
 34 namespace JSC {
 35 
 36 StackFrame::StackFrame(VM&amp; vm, JSCell* owner, JSCell* callee)
 37     : m_callee(vm, owner, callee)
 38 {
 39 }
 40 
<span class="line-modified"> 41 StackFrame::StackFrame(VM&amp; vm, JSCell* owner, JSCell* callee, CodeBlock* codeBlock, BytecodeIndex bytecodeIndex)</span>
 42     : m_callee(vm, owner, callee)
 43     , m_codeBlock(vm, owner, codeBlock)
<span class="line-modified"> 44     , m_bytecodeIndex(bytecodeIndex)</span>
 45 {
 46 }
 47 
 48 StackFrame::StackFrame(Wasm::IndexOrName indexOrName)
 49     : m_wasmFunctionIndexOrName(indexOrName)
 50     , m_isWasmFrame(true)
 51 {
 52 }
 53 
 54 intptr_t StackFrame::sourceID() const
 55 {
 56     if (!m_codeBlock)
 57         return noSourceID;
 58     return m_codeBlock-&gt;ownerExecutable()-&gt;sourceID();
 59 }
 60 
 61 String StackFrame::sourceURL() const
 62 {
 63     if (m_isWasmFrame)
 64         return &quot;[wasm code]&quot;_s;
</pre>
<hr />
<pre>
 94     }
 95     String name;
 96     if (m_callee) {
 97         if (m_callee-&gt;isObject())
 98             name = getCalculatedDisplayName(vm, jsCast&lt;JSObject*&gt;(m_callee.get())).impl();
 99     }
100     return name.isNull() ? emptyString() : name;
101 }
102 
103 void StackFrame::computeLineAndColumn(unsigned&amp; line, unsigned&amp; column) const
104 {
105     if (!m_codeBlock) {
106         line = 0;
107         column = 0;
108         return;
109     }
110 
111     int divot = 0;
112     int unusedStartOffset = 0;
113     int unusedEndOffset = 0;
<span class="line-modified">114     m_codeBlock-&gt;expressionRangeForBytecodeIndex(m_bytecodeIndex, divot, unusedStartOffset, unusedEndOffset, line, column);</span>
115 
116     ScriptExecutable* executable = m_codeBlock-&gt;ownerExecutable();
117     if (Optional&lt;int&gt; overrideLineNumber = executable-&gt;overrideLineNumber(m_codeBlock-&gt;vm()))
118         line = overrideLineNumber.value();
119 }
120 
121 String StackFrame::toString(VM&amp; vm) const
122 {
123     StringBuilder traceBuild;
124     String functionName = this-&gt;functionName(vm);
125     String sourceURL = this-&gt;sourceURL();
126     traceBuild.append(functionName);
127     if (!sourceURL.isEmpty()) {
128         if (!functionName.isEmpty())
129             traceBuild.append(&#39;@&#39;);
130         traceBuild.append(sourceURL);
131         if (hasLineAndColumnInfo()) {
132             unsigned line;
133             unsigned column;
134             computeLineAndColumn(line, column);
</pre>
</td>
</tr>
</table>
<center><a href="SparseArrayValueMap.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="StackFrame.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>