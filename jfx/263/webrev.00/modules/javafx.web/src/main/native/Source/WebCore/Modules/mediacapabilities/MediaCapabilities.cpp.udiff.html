<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/Modules/mediacapabilities/MediaCapabilities.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../indexeddb/shared/IDBTransactionInfo.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MediaCapabilities.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/mediacapabilities/MediaCapabilities.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -26,19 +26,23 @@</span>
  #include &quot;config.h&quot;
  #include &quot;MediaCapabilities.h&quot;
  
  #include &quot;ContentType.h&quot;
  #include &quot;Document.h&quot;
<span class="udiff-line-added">+ #include &quot;JSDOMPromiseDeferred.h&quot;</span>
  #include &quot;JSMediaCapabilitiesDecodingInfo.h&quot;
  #include &quot;JSMediaCapabilitiesEncodingInfo.h&quot;
<span class="udiff-line-added">+ #include &quot;Logging.h&quot;</span>
  #include &quot;MediaCapabilitiesDecodingInfo.h&quot;
  #include &quot;MediaCapabilitiesEncodingInfo.h&quot;
<span class="udiff-line-added">+ #include &quot;MediaCapabilitiesLogging.h&quot;</span>
  #include &quot;MediaDecodingConfiguration.h&quot;
  #include &quot;MediaEncodingConfiguration.h&quot;
  #include &quot;MediaEngineConfigurationFactory.h&quot;
  #include &quot;Settings.h&quot;
  #include &lt;wtf/HashSet.h&gt;
<span class="udiff-line-added">+ #include &lt;wtf/Logger.h&gt;</span>
  
  namespace WebCore {
  
  static const HashSet&lt;String&gt;&amp; bucketMIMETypes()
  {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -164,28 +168,34 @@</span>
  void MediaCapabilities::decodingInfo(Document&amp; document, MediaDecodingConfiguration&amp;&amp; configuration, Ref&lt;DeferredPromise&gt;&amp;&amp; promise)
  {
      // 2.4 Media Capabilities Interface
      // https://wicg.github.io/media-capabilities/#media-capabilities-interface
  
<span class="udiff-line-added">+     auto identifier = WTF::Logger::LogSiteIdentifier(&quot;MediaCapabilities&quot;, __func__, this);</span>
<span class="udiff-line-added">+     Ref&lt;Logger&gt; logger = document.logger();</span>
<span class="udiff-line-added">+ </span>
      // 1. If configuration is not a valid MediaConfiguration, return a Promise rejected with a TypeError.
      // 2. If configuration.video is present and is not a valid video configuration, return a Promise rejected with a TypeError.
      // 3. If configuration.audio is present and is not a valid audio configuration, return a Promise rejected with a TypeError.
      if (!isValidMediaConfiguration(configuration)) {
<span class="udiff-line-added">+ #if !RELEASE_LOG_DISABLED</span>
<span class="udiff-line-added">+         logger-&gt;info(LogMedia, identifier, &quot; - Rejected. configuration: &quot;, configuration);</span>
<span class="udiff-line-added">+ #endif</span>
          promise-&gt;reject(TypeError);
          return;
      }
  
      if (!document.settings().mediaCapabilitiesExtensionsEnabled() &amp;&amp; configuration.video)
          configuration.video.value().alphaChannel.reset();
  
      // 4. Let p be a new promise.
      // 5. In parallel, run the create a MediaCapabilitiesInfo algorithm with configuration and resolve p with its result.
      // 6. Return p.
<span class="udiff-line-modified-removed">-     m_taskQueue.enqueueTask([configuration = WTFMove(configuration), promise = WTFMove(promise)] () mutable {</span>
<span class="udiff-line-modified-added">+     m_taskQueue.enqueueTask([configuration = WTFMove(configuration), promise = WTFMove(promise), logger = WTFMove(logger), identifier = WTFMove(identifier)] () mutable {</span>
  
          // 2.2.3 If configuration is of type MediaDecodingConfiguration, run the following substeps:
<span class="udiff-line-modified-removed">-         MediaEngineConfigurationFactory::DecodingConfigurationCallback callback = [promise = WTFMove(promise)] (auto info) mutable {</span>
<span class="udiff-line-modified-added">+         MediaEngineConfigurationFactory::DecodingConfigurationCallback callback = [promise = WTFMove(promise), logger = WTFMove(logger), identifier = WTFMove(identifier)] (auto info) mutable {</span>
              // 2.2.3.1. If the user agent is able to decode the media represented by
              // configuration, set supported to true. Otherwise set it to false.
              // 2.2.3.2. If the user agent is able to decode the media represented by
              // configuration at a pace that allows a smooth playback, set smooth to
              // true. Otherwise set it to false.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -193,10 +203,13 @@</span>
              // configuration in a power efficient manner, set powerEfficient to
              // true. Otherwise set it to false. The user agent SHOULD NOT take into
              // consideration the current power source in order to determine the
              // decoding power efficiency unless the deviceâ€™s power source has side
              // effects such as enabling different decoding modules.
<span class="udiff-line-added">+ #if !RELEASE_LOG_DISABLED</span>
<span class="udiff-line-added">+             logger-&gt;info(LogMedia, identifier, &quot;::callback() - Resolved. info: &quot;, info);</span>
<span class="udiff-line-added">+ #endif</span>
              promise-&gt;resolve&lt;IDLDictionary&lt;MediaCapabilitiesDecodingInfo&gt;&gt;(WTFMove(info));
          };
  
          MediaEngineConfigurationFactory::createDecodingConfiguration(WTFMove(configuration), WTFMove(callback));
      });
</pre>
<center><a href="../indexeddb/shared/IDBTransactionInfo.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MediaCapabilities.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>