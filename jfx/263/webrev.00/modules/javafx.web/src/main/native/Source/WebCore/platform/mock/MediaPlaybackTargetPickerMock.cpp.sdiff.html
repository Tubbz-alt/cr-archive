<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/platform/mock/MediaPlaybackTargetPickerMock.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MediaEngineConfigurationFactoryMock.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MediaPlaybackTargetPickerMock.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/mock/MediaPlaybackTargetPickerMock.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 23  * THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;MediaPlaybackTargetPickerMock.h&quot;
 28 
 29 #if ENABLE(WIRELESS_PLAYBACK_TARGET) &amp;&amp; !PLATFORM(IOS_FAMILY)
 30 
 31 #include &quot;FloatRect.h&quot;
 32 #include &quot;Logging.h&quot;
 33 #include &quot;MediaPlaybackTargetMock.h&quot;
 34 #include &quot;WebMediaSessionManager.h&quot;
 35 
 36 namespace WebCore {
 37 
 38 static const Seconds timerInterval { 100_ms };
 39 
 40 MediaPlaybackTargetPickerMock::MediaPlaybackTargetPickerMock(MediaPlaybackTargetPicker::Client&amp; client)
 41     : MediaPlaybackTargetPicker(client)
<span class="line-removed"> 42     , m_timer(RunLoop::main(), this, &amp;MediaPlaybackTargetPickerMock::timerFired)</span>
 43 {
 44     LOG(Media, &quot;MediaPlaybackTargetPickerMock::MediaPlaybackTargetPickerMock&quot;);
 45 }
 46 
 47 MediaPlaybackTargetPickerMock::~MediaPlaybackTargetPickerMock()
 48 {
 49     LOG(Media, &quot;MediaPlaybackTargetPickerMock::~MediaPlaybackTargetPickerMock&quot;);
 50     setClient(nullptr);
 51 }
 52 
 53 bool MediaPlaybackTargetPickerMock::externalOutputDeviceAvailable()
 54 {
 55     LOG(Media, &quot;MediaPlaybackTargetPickerMock::externalOutputDeviceAvailable&quot;);
 56     return m_state == MediaPlaybackTargetContext::OutputDeviceAvailable;
 57 }
 58 
 59 Ref&lt;MediaPlaybackTarget&gt; MediaPlaybackTargetPickerMock::playbackTarget()
 60 {
 61     LOG(Media, &quot;MediaPlaybackTargetPickerMock::playbackTarget&quot;);
 62     return WebCore::MediaPlaybackTargetMock::create(m_deviceName, m_state);
 63 }
 64 
<span class="line-removed"> 65 void MediaPlaybackTargetPickerMock::timerFired()</span>
<span class="line-removed"> 66 {</span>
<span class="line-removed"> 67     m_showingMenu = false;</span>
<span class="line-removed"> 68     currentDeviceDidChange();</span>
<span class="line-removed"> 69 }</span>
<span class="line-removed"> 70 </span>
 71 void MediaPlaybackTargetPickerMock::showPlaybackTargetPicker(const FloatRect&amp;, bool checkActiveRoute, bool useDarkAppearance)
 72 {
 73     if (!client() || m_showingMenu)
 74         return;
 75 
 76 #if LOG_DISABLED
 77     UNUSED_PARAM(checkActiveRoute);
 78     UNUSED_PARAM(useDarkAppearance);
 79 #endif

 80     LOG(Media, &quot;MediaPlaybackTargetPickerMock::showPlaybackTargetPicker - checkActiveRoute = %i, useDarkAppearance = %i&quot;, (int)checkActiveRoute, (int)useDarkAppearance);
 81 
 82     m_showingMenu = true;
<span class="line-modified"> 83     m_timer.startOneShot(timerInterval);</span>



 84 }
 85 
 86 void MediaPlaybackTargetPickerMock::startingMonitoringPlaybackTargets()
 87 {
 88     LOG(Media, &quot;MediaPlaybackTargetPickerMock::startingMonitoringPlaybackTargets&quot;);
 89 
<span class="line-modified"> 90     if (m_state == MediaPlaybackTargetContext::OutputDeviceAvailable)</span>
<span class="line-modified"> 91         availableDevicesDidChange();</span>

 92 
<span class="line-modified"> 93     if (!m_deviceName.isEmpty() &amp;&amp; m_state != MediaPlaybackTargetContext::Unknown)</span>
<span class="line-modified"> 94         currentDeviceDidChange();</span>

 95 }
 96 
 97 void MediaPlaybackTargetPickerMock::stopMonitoringPlaybackTargets()
 98 {
 99     LOG(Media, &quot;MediaPlaybackTargetPickerMock::stopMonitoringPlaybackTargets&quot;);
100 }
101 
102 void MediaPlaybackTargetPickerMock::invalidatePlaybackTargets()
103 {
104     LOG(Media, &quot;MediaPlaybackTargetPickerMock::invalidatePlaybackTargets&quot;);
105     setState(emptyString(), MediaPlaybackTargetContext::Unknown);
106 }
107 
108 void MediaPlaybackTargetPickerMock::setState(const String&amp; deviceName, MediaPlaybackTargetContext::State state)
109 {
110     LOG(Media, &quot;MediaPlaybackTargetPickerMock::setState - name = %s, state = 0x%x&quot;, deviceName.utf8().data(), (unsigned)state);
111 
<span class="line-modified">112     if (deviceName != m_deviceName &amp;&amp; state != MediaPlaybackTargetContext::Unknown) {</span>
<span class="line-modified">113         m_deviceName = deviceName;</span>
<span class="line-modified">114         currentDeviceDidChange();</span>
<span class="line-modified">115     }</span>








116 
<span class="line-modified">117     if (m_state != state) {</span>
<span class="line-modified">118         m_state = state;</span>
<span class="line-modified">119         availableDevicesDidChange();</span>
<span class="line-modified">120     }</span>



121 }
122 
123 } // namespace WebCore
124 
125 #endif // ENABLE(WIRELESS_PLAYBACK_TARGET) &amp;&amp; !PLATFORM(IOS_FAMILY)
</pre>
</td>
<td>
<hr />
<pre>
 22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 23  * THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;MediaPlaybackTargetPickerMock.h&quot;
 28 
 29 #if ENABLE(WIRELESS_PLAYBACK_TARGET) &amp;&amp; !PLATFORM(IOS_FAMILY)
 30 
 31 #include &quot;FloatRect.h&quot;
 32 #include &quot;Logging.h&quot;
 33 #include &quot;MediaPlaybackTargetMock.h&quot;
 34 #include &quot;WebMediaSessionManager.h&quot;
 35 
 36 namespace WebCore {
 37 
 38 static const Seconds timerInterval { 100_ms };
 39 
 40 MediaPlaybackTargetPickerMock::MediaPlaybackTargetPickerMock(MediaPlaybackTargetPicker::Client&amp; client)
 41     : MediaPlaybackTargetPicker(client)

 42 {
 43     LOG(Media, &quot;MediaPlaybackTargetPickerMock::MediaPlaybackTargetPickerMock&quot;);
 44 }
 45 
 46 MediaPlaybackTargetPickerMock::~MediaPlaybackTargetPickerMock()
 47 {
 48     LOG(Media, &quot;MediaPlaybackTargetPickerMock::~MediaPlaybackTargetPickerMock&quot;);
 49     setClient(nullptr);
 50 }
 51 
 52 bool MediaPlaybackTargetPickerMock::externalOutputDeviceAvailable()
 53 {
 54     LOG(Media, &quot;MediaPlaybackTargetPickerMock::externalOutputDeviceAvailable&quot;);
 55     return m_state == MediaPlaybackTargetContext::OutputDeviceAvailable;
 56 }
 57 
 58 Ref&lt;MediaPlaybackTarget&gt; MediaPlaybackTargetPickerMock::playbackTarget()
 59 {
 60     LOG(Media, &quot;MediaPlaybackTargetPickerMock::playbackTarget&quot;);
 61     return WebCore::MediaPlaybackTargetMock::create(m_deviceName, m_state);
 62 }
 63 






 64 void MediaPlaybackTargetPickerMock::showPlaybackTargetPicker(const FloatRect&amp;, bool checkActiveRoute, bool useDarkAppearance)
 65 {
 66     if (!client() || m_showingMenu)
 67         return;
 68 
 69 #if LOG_DISABLED
 70     UNUSED_PARAM(checkActiveRoute);
 71     UNUSED_PARAM(useDarkAppearance);
 72 #endif
<span class="line-added"> 73 </span>
 74     LOG(Media, &quot;MediaPlaybackTargetPickerMock::showPlaybackTargetPicker - checkActiveRoute = %i, useDarkAppearance = %i&quot;, (int)checkActiveRoute, (int)useDarkAppearance);
 75 
 76     m_showingMenu = true;
<span class="line-modified"> 77     m_taskQueue.enqueueTask([this] {</span>
<span class="line-added"> 78         m_showingMenu = false;</span>
<span class="line-added"> 79         currentDeviceDidChange();</span>
<span class="line-added"> 80     });</span>
 81 }
 82 
 83 void MediaPlaybackTargetPickerMock::startingMonitoringPlaybackTargets()
 84 {
 85     LOG(Media, &quot;MediaPlaybackTargetPickerMock::startingMonitoringPlaybackTargets&quot;);
 86 
<span class="line-modified"> 87     m_taskQueue.enqueueTask([this] {</span>
<span class="line-modified"> 88         if (m_state == MediaPlaybackTargetContext::OutputDeviceAvailable)</span>
<span class="line-added"> 89             availableDevicesDidChange();</span>
 90 
<span class="line-modified"> 91         if (!m_deviceName.isEmpty() &amp;&amp; m_state != MediaPlaybackTargetContext::Unknown)</span>
<span class="line-modified"> 92             currentDeviceDidChange();</span>
<span class="line-added"> 93     });</span>
 94 }
 95 
 96 void MediaPlaybackTargetPickerMock::stopMonitoringPlaybackTargets()
 97 {
 98     LOG(Media, &quot;MediaPlaybackTargetPickerMock::stopMonitoringPlaybackTargets&quot;);
 99 }
100 
101 void MediaPlaybackTargetPickerMock::invalidatePlaybackTargets()
102 {
103     LOG(Media, &quot;MediaPlaybackTargetPickerMock::invalidatePlaybackTargets&quot;);
104     setState(emptyString(), MediaPlaybackTargetContext::Unknown);
105 }
106 
107 void MediaPlaybackTargetPickerMock::setState(const String&amp; deviceName, MediaPlaybackTargetContext::State state)
108 {
109     LOG(Media, &quot;MediaPlaybackTargetPickerMock::setState - name = %s, state = 0x%x&quot;, deviceName.utf8().data(), (unsigned)state);
110 
<span class="line-modified">111     m_taskQueue.enqueueTask([this, state, deviceName] {</span>
<span class="line-modified">112         if (deviceName != m_deviceName &amp;&amp; state != MediaPlaybackTargetContext::Unknown) {</span>
<span class="line-modified">113             m_deviceName = deviceName;</span>
<span class="line-modified">114             currentDeviceDidChange();</span>
<span class="line-added">115         }</span>
<span class="line-added">116 </span>
<span class="line-added">117         if (m_state != state) {</span>
<span class="line-added">118             m_state = state;</span>
<span class="line-added">119             availableDevicesDidChange();</span>
<span class="line-added">120         }</span>
<span class="line-added">121     });</span>
<span class="line-added">122 }</span>
123 
<span class="line-modified">124 void MediaPlaybackTargetPickerMock::dismissPopup()</span>
<span class="line-modified">125 {</span>
<span class="line-modified">126     if (!m_showingMenu)</span>
<span class="line-modified">127         return;</span>
<span class="line-added">128 </span>
<span class="line-added">129     m_showingMenu = false;</span>
<span class="line-added">130     currentDeviceDidChange();</span>
131 }
132 
133 } // namespace WebCore
134 
135 #endif // ENABLE(WIRELESS_PLAYBACK_TARGET) &amp;&amp; !PLATFORM(IOS_FAMILY)
</pre>
</td>
</tr>
</table>
<center><a href="MediaEngineConfigurationFactoryMock.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MediaPlaybackTargetPickerMock.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>