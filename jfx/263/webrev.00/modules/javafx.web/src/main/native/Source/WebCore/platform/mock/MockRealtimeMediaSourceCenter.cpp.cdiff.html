<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/platform/mock/MockRealtimeMediaSourceCenter.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MockRealtimeAudioSource.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MockRealtimeMediaSourceCenter.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/mock/MockRealtimeMediaSourceCenter.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 39,10 ***</span>
<span class="line-new-header">--- 39,14 ---</span>
  #include &quot;RealtimeMediaSourceSettings.h&quot;
  #include &lt;math.h&gt;
  #include &lt;wtf/NeverDestroyed.h&gt;
  #include &lt;wtf/text/StringView.h&gt;
  
<span class="line-added">+ #if PLATFORM(COCOA)</span>
<span class="line-added">+ #include &quot;CoreAudioCaptureSource.h&quot;</span>
<span class="line-added">+ #endif</span>
<span class="line-added">+ </span>
  namespace WebCore {
  
  static inline Vector&lt;MockMediaDevice&gt; defaultDevices()
  {
      return Vector&lt;MockMediaDevice&gt; {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 77,22 ***</span>
              } },
  
          MockMediaDevice { &quot;SCREEN-1&quot;_s, &quot;Mock screen device 1&quot;_s, MockDisplayProperties { CaptureDevice::DeviceType::Screen, Color::lightGray, { 3840, 2160 } } },
          MockMediaDevice { &quot;SCREEN-2&quot;_s, &quot;Mock screen device 2&quot;_s, MockDisplayProperties { CaptureDevice::DeviceType::Screen, Color::yellow, { 1920, 1080 } } },
  
<span class="line-modified">!         MockMediaDevice { &quot;WINDOW-2&quot;_s, &quot;Mock window 1&quot;_s, MockDisplayProperties { CaptureDevice::DeviceType::Screen, 0xfff1b5, { 640, 480 } } },</span>
<span class="line-modified">!         MockMediaDevice { &quot;WINDOW-2&quot;_s, &quot;Mock window 2&quot;_s, MockDisplayProperties { CaptureDevice::DeviceType::Screen, 0xffd0b5, { 1280, 600 } } },</span>
      };
  }
  
  class MockRealtimeVideoSourceFactory : public VideoCaptureFactory {
  public:
      CaptureSourceOrError createVideoCaptureSource(const CaptureDevice&amp; device, String&amp;&amp; hashSalt, const MediaConstraints* constraints) final
      {
          ASSERT(device.type() == CaptureDevice::DeviceType::Camera);
          if (!MockRealtimeMediaSourceCenter::captureDeviceWithPersistentID(CaptureDevice::DeviceType::Camera, device.persistentId()))
<span class="line-modified">!             return { };</span>
  
          return MockRealtimeVideoSource::create(String { device.persistentId() }, String { device.label() }, WTFMove(hashSalt), constraints);
      }
  
  private:
<span class="line-new-header">--- 81,22 ---</span>
              } },
  
          MockMediaDevice { &quot;SCREEN-1&quot;_s, &quot;Mock screen device 1&quot;_s, MockDisplayProperties { CaptureDevice::DeviceType::Screen, Color::lightGray, { 3840, 2160 } } },
          MockMediaDevice { &quot;SCREEN-2&quot;_s, &quot;Mock screen device 2&quot;_s, MockDisplayProperties { CaptureDevice::DeviceType::Screen, Color::yellow, { 1920, 1080 } } },
  
<span class="line-modified">!         MockMediaDevice { &quot;WINDOW-2&quot;_s, &quot;Mock window 1&quot;_s, MockDisplayProperties { CaptureDevice::DeviceType::Screen, SimpleColor { 0xfff1b5 }, { 640, 480 } } },</span>
<span class="line-modified">!         MockMediaDevice { &quot;WINDOW-2&quot;_s, &quot;Mock window 2&quot;_s, MockDisplayProperties { CaptureDevice::DeviceType::Screen, SimpleColor { 0xffd0b5 }, { 1280, 600 } } },</span>
      };
  }
  
  class MockRealtimeVideoSourceFactory : public VideoCaptureFactory {
  public:
      CaptureSourceOrError createVideoCaptureSource(const CaptureDevice&amp; device, String&amp;&amp; hashSalt, const MediaConstraints* constraints) final
      {
          ASSERT(device.type() == CaptureDevice::DeviceType::Camera);
          if (!MockRealtimeMediaSourceCenter::captureDeviceWithPersistentID(CaptureDevice::DeviceType::Camera, device.persistentId()))
<span class="line-modified">!             return { &quot;Unable to find mock camera device with given persistentID&quot;_s };</span>
  
          return MockRealtimeVideoSource::create(String { device.persistentId() }, String { device.label() }, WTFMove(hashSalt), constraints);
      }
  
  private:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 109,11 ***</span>
  class MockRealtimeDisplaySourceFactory : public DisplayCaptureFactory {
  public:
      CaptureSourceOrError createDisplayCaptureSource(const CaptureDevice&amp; device, const MediaConstraints* constraints) final
      {
          if (!MockRealtimeMediaSourceCenter::captureDeviceWithPersistentID(device.type(), device.persistentId()))
<span class="line-modified">!             return { };</span>
  
          switch (device.type()) {
          case CaptureDevice::DeviceType::Screen:
          case CaptureDevice::DeviceType::Window:
              return MockRealtimeVideoSource::create(String { device.persistentId() }, String { device.label() }, String { }, constraints);
<span class="line-new-header">--- 113,11 ---</span>
  class MockRealtimeDisplaySourceFactory : public DisplayCaptureFactory {
  public:
      CaptureSourceOrError createDisplayCaptureSource(const CaptureDevice&amp; device, const MediaConstraints* constraints) final
      {
          if (!MockRealtimeMediaSourceCenter::captureDeviceWithPersistentID(device.type(), device.persistentId()))
<span class="line-modified">!             return { &quot;Unable to find mock  display device with given persistentID&quot;_s };</span>
  
          switch (device.type()) {
          case CaptureDevice::DeviceType::Screen:
          case CaptureDevice::DeviceType::Window:
              return MockRealtimeVideoSource::create(String { device.persistentId() }, String { device.label() }, String { }, constraints);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 135,21 ***</span>
  public:
      CaptureSourceOrError createAudioCaptureSource(const CaptureDevice&amp; device, String&amp;&amp; hashSalt, const MediaConstraints* constraints) final
      {
          ASSERT(device.type() == CaptureDevice::DeviceType::Microphone);
          if (!MockRealtimeMediaSourceCenter::captureDeviceWithPersistentID(CaptureDevice::DeviceType::Microphone, device.persistentId()))
<span class="line-modified">!             return { };</span>
  
          return MockRealtimeAudioSource::create(String { device.persistentId() }, String { device.label() }, WTFMove(hashSalt), constraints);
      }
  private:
  #if PLATFORM(IOS_FAMILY)
<span class="line-modified">!     void setAudioCapturePageState(bool interrupted, bool pageMuted) final</span>
<span class="line-removed">-     {</span>
<span class="line-removed">-         if (activeSource())</span>
<span class="line-removed">-             activeSource()-&gt;setInterrupted(interrupted, pageMuted);</span>
<span class="line-removed">-     }</span>
  #endif
      CaptureDeviceManager&amp; audioCaptureDeviceManager() final { return MockRealtimeMediaSourceCenter::singleton().audioCaptureDeviceManager(); }
  };
  
  static Vector&lt;MockMediaDevice&gt;&amp; devices()
<span class="line-new-header">--- 139,17 ---</span>
  public:
      CaptureSourceOrError createAudioCaptureSource(const CaptureDevice&amp; device, String&amp;&amp; hashSalt, const MediaConstraints* constraints) final
      {
          ASSERT(device.type() == CaptureDevice::DeviceType::Microphone);
          if (!MockRealtimeMediaSourceCenter::captureDeviceWithPersistentID(CaptureDevice::DeviceType::Microphone, device.persistentId()))
<span class="line-modified">!             return { &quot;Unable to find mock microphone device with given persistentID&quot;_s };</span>
  
          return MockRealtimeAudioSource::create(String { device.persistentId() }, String { device.label() }, WTFMove(hashSalt), constraints);
      }
  private:
  #if PLATFORM(IOS_FAMILY)
<span class="line-modified">!     void setAudioCapturePageState(bool interrupted, bool pageMuted) final { CoreAudioCaptureSourceFactory::singleton().setAudioCapturePageState(interrupted, pageMuted); }</span>
  #endif
      CaptureDeviceManager&amp; audioCaptureDeviceManager() final { return MockRealtimeMediaSourceCenter::singleton().audioCaptureDeviceManager(); }
  };
  
  static Vector&lt;MockMediaDevice&gt;&amp; devices()
</pre>
<hr />
<pre>
<span class="line-old-header">*** 189,20 ***</span>
      return center;
  }
  
  void MockRealtimeMediaSourceCenter::setMockRealtimeMediaSourceCenterEnabled(bool enabled)
  {
<span class="line-modified">!     static bool active = false;</span>
<span class="line-removed">-     if (active == enabled)</span>
<span class="line-removed">-         return;</span>
  
<span class="line-modified">!     active = enabled;</span>
  
      RealtimeMediaSourceCenter&amp; center = RealtimeMediaSourceCenter::singleton();
<span class="line-removed">-     MockRealtimeMediaSourceCenter&amp; mock = singleton();</span>
  
<span class="line-modified">!     if (active) {</span>
          if (mock.m_isMockAudioCaptureEnabled)
              center.setAudioCaptureFactory(mock.audioCaptureFactory());
          if (mock.m_isMockVideoCaptureEnabled)
              center.setVideoCaptureFactory(mock.videoCaptureFactory());
          if (mock.m_isMockDisplayCaptureEnabled)
<span class="line-new-header">--- 189,19 ---</span>
      return center;
  }
  
  void MockRealtimeMediaSourceCenter::setMockRealtimeMediaSourceCenterEnabled(bool enabled)
  {
<span class="line-modified">!     MockRealtimeMediaSourceCenter&amp; mock = singleton();</span>
  
<span class="line-modified">!     if (mock.m_isEnabled == enabled)</span>
<span class="line-added">+         return;</span>
  
<span class="line-added">+     mock.m_isEnabled = enabled;</span>
      RealtimeMediaSourceCenter&amp; center = RealtimeMediaSourceCenter::singleton();
  
<span class="line-modified">!     if (mock.m_isEnabled) {</span>
          if (mock.m_isMockAudioCaptureEnabled)
              center.setAudioCaptureFactory(mock.audioCaptureFactory());
          if (mock.m_isMockVideoCaptureEnabled)
              center.setVideoCaptureFactory(mock.videoCaptureFactory());
          if (mock.m_isMockDisplayCaptureEnabled)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 218,14 ***</span>
          center.unsetDisplayCaptureFactory(mock.displayCaptureFactory());
  }
  
  bool MockRealtimeMediaSourceCenter::mockRealtimeMediaSourceCenterEnabled()
  {
<span class="line-modified">!     MockRealtimeMediaSourceCenter&amp; mock = singleton();</span>
<span class="line-removed">-     RealtimeMediaSourceCenter&amp; center = RealtimeMediaSourceCenter::singleton();</span>
<span class="line-removed">- </span>
<span class="line-removed">-     return &amp;center.audioCaptureFactory() == &amp;mock.audioCaptureFactory() || &amp;center.videoCaptureFactory() == &amp;mock.videoCaptureFactory() || &amp;center.displayCaptureFactory() == &amp;mock.displayCaptureFactory();</span>
  }
  
  static void createCaptureDevice(const MockMediaDevice&amp; device)
  {
      deviceListForDevice(device).append(MockRealtimeMediaSourceCenter::captureDeviceWithPersistentID(device.type(), device.persistentId).value());
<span class="line-new-header">--- 217,11 ---</span>
          center.unsetDisplayCaptureFactory(mock.displayCaptureFactory());
  }
  
  bool MockRealtimeMediaSourceCenter::mockRealtimeMediaSourceCenterEnabled()
  {
<span class="line-modified">!     return singleton().m_isEnabled;</span>
  }
  
  static void createCaptureDevice(const MockMediaDevice&amp; device)
  {
      deviceListForDevice(device).append(MockRealtimeMediaSourceCenter::captureDeviceWithPersistentID(device.type(), device.persistentId).value());
</pre>
<center><a href="MockRealtimeAudioSource.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="MockRealtimeMediaSourceCenter.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>