<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/JavaScriptCore/assembler/MacroAssemblerX86Common.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MacroAssemblerX86.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MacroAssemblerX86Common.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/assembler/MacroAssemblerX86Common.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (C) 2013-2018 Apple Inc. All rights reserved.</span>
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
</pre>
<hr />
<pre>
500 
501         // Do the remaining restoration by popping off the restore area.
502         popfd
503         pop eax
504         pop ecx
505         pop ebp
506         ret
507     }
508 }
509 #endif // COMPILER(MSVC)
510 
511 #endif // CPU(X86)
512 
513 #if CPU(X86_64)
514 #if COMPILER(GCC_COMPATIBLE)
515 asm (
516     &quot;.globl &quot; SYMBOL_STRING(ctiMasmProbeTrampoline) &quot;\n&quot;
517     HIDE_SYMBOL(ctiMasmProbeTrampoline) &quot;\n&quot;
518     SYMBOL_STRING(ctiMasmProbeTrampoline) &quot;:&quot; &quot;\n&quot;
519 



520     &quot;pushfq&quot; &quot;\n&quot;
521 
522     // MacroAssemblerX86Common::probe() has already generated code to store some values.
<span class="line-modified">523     // Together with the rflags pushed above, the top of stack now looks like this:</span>
<span class="line-modified">524     //     rsp[0 * ptrSize]: rflags</span>
<span class="line-modified">525     //     rsp[1 * ptrSize]: return address / saved rip</span>
<span class="line-modified">526     //     rsp[2 * ptrSize]: saved rbx</span>
<span class="line-modified">527     //     rsp[3 * ptrSize]: saved rdx</span>
<span class="line-modified">528     //     rsp[4 * ptrSize]: saved rcx</span>
<span class="line-modified">529     //     rsp[5 * ptrSize]: saved rax</span>

530     //
531     // Incoming registers contain:
532     //     rcx: Probe::executeProbe
533     //     rdx: probe function
534     //     rbx: probe arg
535     //     rax: scratch (was ctiMasmProbeTrampoline)
536 
<span class="line-removed">537     &quot;movq %rsp, %rax&quot; &quot;\n&quot;</span>
538     &quot;subq $&quot; STRINGIZE_VALUE_OF(PROBE_SIZE + OUT_SIZE) &quot;, %rsp&quot; &quot;\n&quot;
539 
540     // The X86_64 ABI specifies that the worse case stack alignment requirement is 32 bytes.
541     &quot;andq $~0x1f, %rsp&quot; &quot;\n&quot;
542     // Since sp points to the Probe::State, we&#39;ve ensured that it&#39;s protected from interrupts before we initialize it.
543 
<span class="line-modified">544     &quot;movq %rbp, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_EBP_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">545     &quot;movq %rsp, %rbp&quot; &quot;\n&quot; // Save the Probe::State*.</span>
<span class="line-modified">546 </span>
<span class="line-modified">547     &quot;movq %rcx, &quot; STRINGIZE_VALUE_OF(PROBE_EXECUTOR_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">548     &quot;movq %rdx, &quot; STRINGIZE_VALUE_OF(PROBE_PROBE_FUNCTION_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">549     &quot;movq %rbx, &quot; STRINGIZE_VALUE_OF(PROBE_ARG_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">550     &quot;movq %rsi, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_ESI_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">551     &quot;movq %rdi, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_EDI_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">552 </span>
<span class="line-modified">553     &quot;movq 0 * &quot; STRINGIZE_VALUE_OF(PTR_SIZE) &quot;(%rax), %rcx&quot; &quot;\n&quot;</span>
<span class="line-modified">554     &quot;movq %rcx, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_EFLAGS_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">555     &quot;movq 1 * &quot; STRINGIZE_VALUE_OF(PTR_SIZE) &quot;(%rax), %rcx&quot; &quot;\n&quot;</span>
<span class="line-modified">556     &quot;movq %rcx, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_EIP_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">557     &quot;movq 2 * &quot; STRINGIZE_VALUE_OF(PTR_SIZE) &quot;(%rax), %rcx&quot; &quot;\n&quot;</span>
<span class="line-modified">558     &quot;movq %rcx, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_EBX_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">559     &quot;movq 3 * &quot; STRINGIZE_VALUE_OF(PTR_SIZE) &quot;(%rax), %rcx&quot; &quot;\n&quot;</span>
<span class="line-modified">560     &quot;movq %rcx, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_EDX_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">561     &quot;movq 4 * &quot; STRINGIZE_VALUE_OF(PTR_SIZE) &quot;(%rax), %rcx&quot; &quot;\n&quot;</span>
<span class="line-modified">562     &quot;movq %rcx, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_ECX_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">563     &quot;movq 5 * &quot; STRINGIZE_VALUE_OF(PTR_SIZE) &quot;(%rax), %rcx&quot; &quot;\n&quot;</span>
<span class="line-modified">564     &quot;movq %rcx, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_EAX_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">565 </span>
<span class="line-removed">566     &quot;movq %rax, %rcx&quot; &quot;\n&quot;</span>
567     &quot;addq $&quot; STRINGIZE_VALUE_OF(6 * PTR_SIZE) &quot;, %rcx&quot; &quot;\n&quot;
<span class="line-modified">568     &quot;movq %rcx, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_ESP_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">569 </span>
<span class="line-modified">570     &quot;movq %r8, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_R8_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">571     &quot;movq %r9, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_R9_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">572     &quot;movq %r10, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_R10_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">573     &quot;movq %r11, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_R11_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">574     &quot;movq %r12, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_R12_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">575     &quot;movq %r13, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_R13_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">576     &quot;movq %r14, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_R14_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">577     &quot;movq %r15, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_R15_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">578 </span>
<span class="line-modified">579     &quot;movq %xmm0, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM0_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">580     &quot;movq %xmm1, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM1_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">581     &quot;movq %xmm2, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM2_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">582     &quot;movq %xmm3, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM3_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">583     &quot;movq %xmm4, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM4_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">584     &quot;movq %xmm5, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM5_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">585     &quot;movq %xmm6, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM6_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">586     &quot;movq %xmm7, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM7_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">587     &quot;movq %xmm8, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM8_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">588     &quot;movq %xmm9, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM9_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">589     &quot;movq %xmm10, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM10_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">590     &quot;movq %xmm11, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM11_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">591     &quot;movq %xmm12, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM12_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">592     &quot;movq %xmm13, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM13_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">593     &quot;movq %xmm14, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM14_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">594     &quot;movq %xmm15, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM15_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
<span class="line-modified">595 </span>
<span class="line-modified">596     &quot;movq %rbp, %rdi&quot; &quot;\n&quot; // the Probe::State* arg.</span>
<span class="line-modified">597     &quot;call *&quot; STRINGIZE_VALUE_OF(PROBE_EXECUTOR_OFFSET) &quot;(%rbp)&quot; &quot;\n&quot;</span>
598 
599     // Make sure the Probe::State is entirely below the result stack pointer so
600     // that register values are still preserved when we call the initializeStack
601     // function.

602     &quot;movq $&quot; STRINGIZE_VALUE_OF(PROBE_SIZE + OUT_SIZE) &quot;, %rcx&quot; &quot;\n&quot;
<span class="line-modified">603     &quot;movq %rbp, %rax&quot; &quot;\n&quot;</span>
604     &quot;movq &quot; STRINGIZE_VALUE_OF(PROBE_CPU_ESP_OFFSET) &quot;(%rbp), %rdx&quot; &quot;\n&quot;
605     &quot;addq %rcx, %rax&quot; &quot;\n&quot;
606     &quot;cmpq %rax, %rdx&quot; &quot;\n&quot;
607     &quot;jge &quot; LOCAL_LABEL_STRING(ctiMasmProbeTrampolineProbeStateIsSafe) &quot;\n&quot;
608 
609     // Allocate a safe place on the stack below the result stack pointer to stash the Probe::State.
610     &quot;subq %rcx, %rdx&quot; &quot;\n&quot;
611     &quot;andq $~0x1f, %rdx&quot; &quot;\n&quot; // Keep the stack pointer 32 bytes aligned.
612     &quot;xorq %rax, %rax&quot; &quot;\n&quot;
613     &quot;movq %rdx, %rsp&quot; &quot;\n&quot;
614 
615     &quot;movq $&quot; STRINGIZE_VALUE_OF(PROBE_SIZE) &quot;, %rcx&quot; &quot;\n&quot;
616 
617     // Copy the Probe::State to the safe place.
618     LOCAL_LABEL_STRING(ctiMasmProbeTrampolineCopyLoop) &quot;:&quot; &quot;\n&quot;
619     &quot;movq (%rbp, %rax), %rdx&quot; &quot;\n&quot;
620     &quot;movq %rdx, (%rsp, %rax)&quot; &quot;\n&quot;
621     &quot;addq $&quot; STRINGIZE_VALUE_OF(PTR_SIZE) &quot;, %rax&quot; &quot;\n&quot;
622     &quot;cmpq %rax, %rcx&quot; &quot;\n&quot;
623     &quot;jg &quot; LOCAL_LABEL_STRING(ctiMasmProbeTrampolineCopyLoop) &quot;\n&quot;
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (C) 2013-2019 Apple Inc. All rights reserved.</span>
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
</pre>
<hr />
<pre>
500 
501         // Do the remaining restoration by popping off the restore area.
502         popfd
503         pop eax
504         pop ecx
505         pop ebp
506         ret
507     }
508 }
509 #endif // COMPILER(MSVC)
510 
511 #endif // CPU(X86)
512 
513 #if CPU(X86_64)
514 #if COMPILER(GCC_COMPATIBLE)
515 asm (
516     &quot;.globl &quot; SYMBOL_STRING(ctiMasmProbeTrampoline) &quot;\n&quot;
517     HIDE_SYMBOL(ctiMasmProbeTrampoline) &quot;\n&quot;
518     SYMBOL_STRING(ctiMasmProbeTrampoline) &quot;:&quot; &quot;\n&quot;
519 
<span class="line-added">520     &quot;pushq %rbp&quot; &quot;\n&quot;</span>
<span class="line-added">521     &quot;movq  %rsp, %rbp&quot; &quot;\n&quot;</span>
<span class="line-added">522 </span>
523     &quot;pushfq&quot; &quot;\n&quot;
524 
525     // MacroAssemblerX86Common::probe() has already generated code to store some values.
<span class="line-modified">526     // Together with the rbp and rflags pushed above, the top of stack now looks like this:</span>
<span class="line-modified">527     //     rbp[-1 * ptrSize]: rflags</span>
<span class="line-modified">528     //     rbp[0 * ptrSize]: rbp / previousCallFrame</span>
<span class="line-modified">529     //     rbp[1 * ptrSize]: return address / saved rip</span>
<span class="line-modified">530     //     rbp[2 * ptrSize]: saved rbx</span>
<span class="line-modified">531     //     rbp[3 * ptrSize]: saved rdx</span>
<span class="line-modified">532     //     rbp[4 * ptrSize]: saved rcx</span>
<span class="line-added">533     //     rbp[5 * ptrSize]: saved rax</span>
534     //
535     // Incoming registers contain:
536     //     rcx: Probe::executeProbe
537     //     rdx: probe function
538     //     rbx: probe arg
539     //     rax: scratch (was ctiMasmProbeTrampoline)
540 

541     &quot;subq $&quot; STRINGIZE_VALUE_OF(PROBE_SIZE + OUT_SIZE) &quot;, %rsp&quot; &quot;\n&quot;
542 
543     // The X86_64 ABI specifies that the worse case stack alignment requirement is 32 bytes.
544     &quot;andq $~0x1f, %rsp&quot; &quot;\n&quot;
545     // Since sp points to the Probe::State, we&#39;ve ensured that it&#39;s protected from interrupts before we initialize it.
546 
<span class="line-modified">547     &quot;movq %rcx, &quot; STRINGIZE_VALUE_OF(PROBE_EXECUTOR_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">548     &quot;movq %rdx, &quot; STRINGIZE_VALUE_OF(PROBE_PROBE_FUNCTION_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">549     &quot;movq %rbx, &quot; STRINGIZE_VALUE_OF(PROBE_ARG_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">550     &quot;movq %rsi, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_ESI_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">551     &quot;movq %rdi, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_EDI_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">552 </span>
<span class="line-modified">553     &quot;movq -1 * &quot; STRINGIZE_VALUE_OF(PTR_SIZE) &quot;(%rbp), %rcx&quot; &quot;\n&quot;</span>
<span class="line-modified">554     &quot;movq %rcx, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_EFLAGS_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">555     &quot;movq 0 * &quot; STRINGIZE_VALUE_OF(PTR_SIZE) &quot;(%rbp), %rcx&quot; &quot;\n&quot;</span>
<span class="line-modified">556     &quot;movq %rcx, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_EBP_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">557     &quot;movq 1 * &quot; STRINGIZE_VALUE_OF(PTR_SIZE) &quot;(%rbp), %rcx&quot; &quot;\n&quot;</span>
<span class="line-modified">558     &quot;movq %rcx, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_EIP_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">559     &quot;movq 2 * &quot; STRINGIZE_VALUE_OF(PTR_SIZE) &quot;(%rbp), %rcx&quot; &quot;\n&quot;</span>
<span class="line-modified">560     &quot;movq %rcx, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_EBX_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">561     &quot;movq 3 * &quot; STRINGIZE_VALUE_OF(PTR_SIZE) &quot;(%rbp), %rcx&quot; &quot;\n&quot;</span>
<span class="line-modified">562     &quot;movq %rcx, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_EDX_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">563     &quot;movq 4 * &quot; STRINGIZE_VALUE_OF(PTR_SIZE) &quot;(%rbp), %rcx&quot; &quot;\n&quot;</span>
<span class="line-modified">564     &quot;movq %rcx, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_ECX_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">565     &quot;movq 5 * &quot; STRINGIZE_VALUE_OF(PTR_SIZE) &quot;(%rbp), %rcx&quot; &quot;\n&quot;</span>
<span class="line-modified">566     &quot;movq %rcx, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_EAX_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">567 </span>
<span class="line-modified">568     &quot;movq %rbp, %rcx&quot; &quot;\n&quot;</span>

569     &quot;addq $&quot; STRINGIZE_VALUE_OF(6 * PTR_SIZE) &quot;, %rcx&quot; &quot;\n&quot;
<span class="line-modified">570     &quot;movq %rcx, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_ESP_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">571 </span>
<span class="line-modified">572     &quot;movq %r8, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_R8_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">573     &quot;movq %r9, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_R9_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">574     &quot;movq %r10, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_R10_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">575     &quot;movq %r11, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_R11_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">576     &quot;movq %r12, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_R12_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">577     &quot;movq %r13, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_R13_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">578     &quot;movq %r14, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_R14_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">579     &quot;movq %r15, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_R15_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">580 </span>
<span class="line-modified">581     &quot;movq %xmm0, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM0_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">582     &quot;movq %xmm1, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM1_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">583     &quot;movq %xmm2, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM2_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">584     &quot;movq %xmm3, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM3_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">585     &quot;movq %xmm4, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM4_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">586     &quot;movq %xmm5, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM5_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">587     &quot;movq %xmm6, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM6_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">588     &quot;movq %xmm7, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM7_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">589     &quot;movq %xmm8, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM8_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">590     &quot;movq %xmm9, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM9_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">591     &quot;movq %xmm10, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM10_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">592     &quot;movq %xmm11, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM11_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">593     &quot;movq %xmm12, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM12_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">594     &quot;movq %xmm13, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM13_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">595     &quot;movq %xmm14, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM14_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">596     &quot;movq %xmm15, &quot; STRINGIZE_VALUE_OF(PROBE_CPU_XMM15_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
<span class="line-modified">597 </span>
<span class="line-modified">598     &quot;movq %rsp, %rdi&quot; &quot;\n&quot; // the Probe::State* arg.</span>
<span class="line-modified">599     &quot;call *&quot; STRINGIZE_VALUE_OF(PROBE_EXECUTOR_OFFSET) &quot;(%rsp)&quot; &quot;\n&quot;</span>
600 
601     // Make sure the Probe::State is entirely below the result stack pointer so
602     // that register values are still preserved when we call the initializeStack
603     // function.
<span class="line-added">604     &quot;movq %rsp, %rbp&quot; &quot;\n&quot;</span>
605     &quot;movq $&quot; STRINGIZE_VALUE_OF(PROBE_SIZE + OUT_SIZE) &quot;, %rcx&quot; &quot;\n&quot;
<span class="line-modified">606     &quot;movq %rsp, %rax&quot; &quot;\n&quot;</span>
607     &quot;movq &quot; STRINGIZE_VALUE_OF(PROBE_CPU_ESP_OFFSET) &quot;(%rbp), %rdx&quot; &quot;\n&quot;
608     &quot;addq %rcx, %rax&quot; &quot;\n&quot;
609     &quot;cmpq %rax, %rdx&quot; &quot;\n&quot;
610     &quot;jge &quot; LOCAL_LABEL_STRING(ctiMasmProbeTrampolineProbeStateIsSafe) &quot;\n&quot;
611 
612     // Allocate a safe place on the stack below the result stack pointer to stash the Probe::State.
613     &quot;subq %rcx, %rdx&quot; &quot;\n&quot;
614     &quot;andq $~0x1f, %rdx&quot; &quot;\n&quot; // Keep the stack pointer 32 bytes aligned.
615     &quot;xorq %rax, %rax&quot; &quot;\n&quot;
616     &quot;movq %rdx, %rsp&quot; &quot;\n&quot;
617 
618     &quot;movq $&quot; STRINGIZE_VALUE_OF(PROBE_SIZE) &quot;, %rcx&quot; &quot;\n&quot;
619 
620     // Copy the Probe::State to the safe place.
621     LOCAL_LABEL_STRING(ctiMasmProbeTrampolineCopyLoop) &quot;:&quot; &quot;\n&quot;
622     &quot;movq (%rbp, %rax), %rdx&quot; &quot;\n&quot;
623     &quot;movq %rdx, (%rsp, %rax)&quot; &quot;\n&quot;
624     &quot;addq $&quot; STRINGIZE_VALUE_OF(PTR_SIZE) &quot;, %rax&quot; &quot;\n&quot;
625     &quot;cmpq %rax, %rcx&quot; &quot;\n&quot;
626     &quot;jg &quot; LOCAL_LABEL_STRING(ctiMasmProbeTrampolineCopyLoop) &quot;\n&quot;
</pre>
</td>
</tr>
</table>
<center><a href="MacroAssemblerX86.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MacroAssemblerX86Common.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>