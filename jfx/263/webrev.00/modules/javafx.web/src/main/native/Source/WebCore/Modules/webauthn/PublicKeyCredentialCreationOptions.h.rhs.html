<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/Modules/webauthn/PublicKeyCredentialCreationOptions.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2018 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 14  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 15  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 17  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 18  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 19  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 20  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 21  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 23  * THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #if ENABLE(WEB_AUTHN)
 29 
 30 #include &quot;AttestationConveyancePreference.h&quot;
 31 #include &quot;AuthenticationExtensionsClientInputs.h&quot;
 32 #include &quot;BufferSource.h&quot;
 33 #include &quot;PublicKeyCredentialDescriptor.h&quot;
 34 #include &quot;PublicKeyCredentialType.h&quot;
 35 #include &quot;UserVerificationRequirement.h&quot;
<a name="1" id="anc1"></a>
 36 #include &lt;wtf/Forward.h&gt;
 37 
 38 namespace WebCore {
 39 
 40 struct PublicKeyCredentialCreationOptions {
 41     enum class AuthenticatorAttachment {
 42         Platform,
 43         CrossPlatform
 44     };
 45 
 46     struct Entity {
 47         String name;
 48         String icon;
 49     };
 50 
 51     struct RpEntity : public Entity {
 52         mutable String id;
 53     };
 54 
 55     struct UserEntity : public Entity {
 56         BufferSource id; // id becomes idVector once it is passed to UIProcess.
 57         Vector&lt;uint8_t&gt; idVector;
 58         String displayName;
 59     };
 60 
 61     struct Parameters {
 62         PublicKeyCredentialType type;
 63         int64_t alg;
 64 
 65         template&lt;class Encoder&gt; void encode(Encoder&amp;) const;
 66         template&lt;class Decoder&gt; static Optional&lt;Parameters&gt; decode(Decoder&amp;);
 67     };
 68 
 69     struct AuthenticatorSelectionCriteria {
 70         Optional&lt;AuthenticatorAttachment&gt; authenticatorAttachment;
 71         bool requireResidentKey { false };
 72         UserVerificationRequirement userVerification { UserVerificationRequirement::Preferred };
 73 
 74         template&lt;class Encoder&gt; void encode(Encoder&amp;) const;
 75         template&lt;class Decoder&gt; static Optional&lt;AuthenticatorSelectionCriteria&gt; decode(Decoder&amp;);
 76     };
 77 
 78     RpEntity rp;
 79     UserEntity user;
 80 
 81     BufferSource challenge;
 82     Vector&lt;Parameters&gt; pubKeyCredParams;
 83 
 84     Optional&lt;unsigned&gt; timeout;
 85     Vector&lt;PublicKeyCredentialDescriptor&gt; excludeCredentials;
 86     Optional&lt;AuthenticatorSelectionCriteria&gt; authenticatorSelection;
 87     AttestationConveyancePreference attestation;
<a name="2" id="anc2"></a><span class="line-modified"> 88     mutable Optional&lt;AuthenticationExtensionsClientInputs&gt; extensions;</span>
 89 
 90     template&lt;class Encoder&gt; void encode(Encoder&amp;) const;
 91     template&lt;class Decoder&gt; static Optional&lt;PublicKeyCredentialCreationOptions&gt; decode(Decoder&amp;);
 92 };
 93 
 94 template&lt;class Encoder&gt;
 95 void PublicKeyCredentialCreationOptions::Parameters::encode(Encoder&amp; encoder) const
 96 {
 97     encoder &lt;&lt; type &lt;&lt; alg;
 98 }
 99 
100 template&lt;class Decoder&gt;
101 Optional&lt;PublicKeyCredentialCreationOptions::Parameters&gt; PublicKeyCredentialCreationOptions::Parameters::decode(Decoder&amp; decoder)
102 {
103     PublicKeyCredentialCreationOptions::Parameters result;
104     if (!decoder.decodeEnum(result.type))
105         return WTF::nullopt;
106     if (!decoder.decode(result.alg))
107         return WTF::nullopt;
108     return result;
109 }
110 
111 template&lt;class Encoder&gt;
112 void PublicKeyCredentialCreationOptions::AuthenticatorSelectionCriteria::encode(Encoder&amp; encoder) const
113 {
114     encoder &lt;&lt; authenticatorAttachment &lt;&lt; requireResidentKey &lt;&lt; userVerification;
115 }
116 
117 template&lt;class Decoder&gt;
118 Optional&lt;PublicKeyCredentialCreationOptions::AuthenticatorSelectionCriteria&gt; PublicKeyCredentialCreationOptions::AuthenticatorSelectionCriteria::decode(Decoder&amp; decoder)
119 {
120     PublicKeyCredentialCreationOptions::AuthenticatorSelectionCriteria result;
121 
122     Optional&lt;Optional&lt;AuthenticatorAttachment&gt;&gt; authenticatorAttachment;
123     decoder &gt;&gt; authenticatorAttachment;
124     if (!authenticatorAttachment)
125         return WTF::nullopt;
126     result.authenticatorAttachment = WTFMove(*authenticatorAttachment);
127 
128     Optional&lt;bool&gt; requireResidentKey;
129     decoder &gt;&gt; requireResidentKey;
130     if (!requireResidentKey)
131         return WTF::nullopt;
132     result.requireResidentKey = *requireResidentKey;
133 
134     if (!decoder.decodeEnum(result.userVerification))
135         return WTF::nullopt;
136     return result;
137 }
138 
139 // Not every member is encoded.
140 template&lt;class Encoder&gt;
141 void PublicKeyCredentialCreationOptions::encode(Encoder&amp; encoder) const
142 {
143     encoder &lt;&lt; rp.id &lt;&lt; rp.name &lt;&lt; rp.icon;
144     encoder &lt;&lt; static_cast&lt;uint64_t&gt;(user.id.length());
145     encoder.encodeFixedLengthData(user.id.data(), user.id.length(), 1);
<a name="3" id="anc3"></a><span class="line-modified">146     encoder &lt;&lt; user.displayName &lt;&lt; user.name &lt;&lt; user.icon &lt;&lt; pubKeyCredParams &lt;&lt; timeout &lt;&lt; excludeCredentials &lt;&lt; authenticatorSelection &lt;&lt; attestation &lt;&lt; extensions;</span>
147 }
148 
149 template&lt;class Decoder&gt;
150 Optional&lt;PublicKeyCredentialCreationOptions&gt; PublicKeyCredentialCreationOptions::decode(Decoder&amp; decoder)
151 {
152     PublicKeyCredentialCreationOptions result;
153     if (!decoder.decode(result.rp.id))
154         return WTF::nullopt;
155     if (!decoder.decode(result.rp.name))
156         return WTF::nullopt;
157     if (!decoder.decode(result.rp.icon))
158         return WTF::nullopt;
159     if (!decoder.decode(result.user.idVector))
160         return WTF::nullopt;
161     if (!decoder.decode(result.user.displayName))
162         return WTF::nullopt;
163     if (!decoder.decode(result.user.name))
164         return WTF::nullopt;
165     if (!decoder.decode(result.user.icon))
166         return WTF::nullopt;
167     if (!decoder.decode(result.pubKeyCredParams))
168         return WTF::nullopt;
169 
170     Optional&lt;Optional&lt;unsigned&gt;&gt; timeout;
171     decoder &gt;&gt; timeout;
172     if (!timeout)
173         return WTF::nullopt;
174     result.timeout = WTFMove(*timeout);
175 
176     if (!decoder.decode(result.excludeCredentials))
177         return WTF::nullopt;
178 
179     Optional&lt;Optional&lt;AuthenticatorSelectionCriteria&gt;&gt; authenticatorSelection;
180     decoder &gt;&gt; authenticatorSelection;
181     if (!authenticatorSelection)
182         return WTF::nullopt;
183     result.authenticatorSelection = WTFMove(*authenticatorSelection);
184 
185     Optional&lt;AttestationConveyancePreference&gt; attestation;
186     decoder &gt;&gt; attestation;
187     if (!attestation)
188         return WTF::nullopt;
189     result.attestation = WTFMove(*attestation);
190 
<a name="4" id="anc4"></a><span class="line-added">191     Optional&lt;Optional&lt;AuthenticationExtensionsClientInputs&gt;&gt; extensions;</span>
<span class="line-added">192     decoder &gt;&gt; extensions;</span>
<span class="line-added">193     if (!extensions)</span>
<span class="line-added">194         return WTF::nullopt;</span>
<span class="line-added">195     result.extensions = WTFMove(*extensions);</span>
<span class="line-added">196 </span>
197     return result;
198 }
199 
200 } // namespace WebCore
201 
202 namespace WTF {
<a name="5" id="anc5"></a>
















203 
204 template&lt;&gt; struct EnumTraits&lt;WebCore::PublicKeyCredentialCreationOptions::AuthenticatorAttachment&gt; {
205     using values = EnumValues&lt;
206         WebCore::PublicKeyCredentialCreationOptions::AuthenticatorAttachment,
207         WebCore::PublicKeyCredentialCreationOptions::AuthenticatorAttachment::Platform,
208         WebCore::PublicKeyCredentialCreationOptions::AuthenticatorAttachment::CrossPlatform
209     &gt;;
210 };
211 
212 } // namespace WTF
213 
214 #endif // ENABLE(WEB_AUTHN)
<a name="6" id="anc6"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="6" type="hidden" />
</body>
</html>